[{"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1454534649, "post_id": 35187986, "comment_id": 58093175, "body": "What are you doing that doesn&#39;t work? That&#39;s a shell command, so giving to a shell should work fine."}, {"owner": {"reputation": 1923, "user_id": 1351876, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/8028d0785748380250974c5424b07af2?s=128&d=identicon&r=PG", "display_name": "Nithin", "link": "https://stackoverflow.com/users/1351876/nithin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454534754, "post_id": 35187986, "comment_id": 58093219, "body": "in this particular case i get the following error <code>Error response from daemon: no such id: $(docker-compose</code> see what it does?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454535189, "post_id": 35187986, "comment_id": 58093461, "body": "Please show the code you&#39;re using, so we don&#39;t have to guess what that is."}, {"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1454535240, "post_id": 35187986, "comment_id": 58093493, "body": "@Nithin that command doesn&#39;t seem to be the problem, it seems there&#39;s more here"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 2, "creation_date": 1454545918, "post_id": 35187986, "comment_id": 58097997, "body": "<a href=\"http://stackoverflow.com/questions/34669561/exit-status-2-on-running-grep-command-using-golang/34669821\" title=\"exit status 2 on running grep command using golang\">stackoverflow.com/questions/34669561/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 26448, "user_id": 10322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa46a3814b72439b1d2efa8f7c9162c2?s=128&d=identicon&r=PG", "display_name": "ctcherry", "link": "https://stackoverflow.com/users/10322/ctcherry"}, "is_accepted": true, "score": 4, "last_activity_date": 1454609286, "last_edit_date": 1454609286, "creation_date": 1454536586, "answer_id": 35188542, "question_id": 35187986, "link": "https://stackoverflow.com/questions/35187986/how-to-pass-a-command-with-to-exec-command-in-golang/35188542#35188542", "title": "How to pass a command with $() to exec.command() in golang", "body": "<p>The command inside of <code>$()</code> is executed and replaced with its output by your shell on the command line (typically <code>bash</code> but can be <code>sh</code> or others). exec.Command is running the program directly, so that replacement isn't happening. This means you need to pass that command into bash so it will interpret and execute the command:</p>\n\n<p><code>bash -c \"docker exec \\\"$(docker-compose ps -q web)\\\" start.sh\"</code></p>\n\n<p>Code Example:</p>\n\n<p><code>exec.Command(\"/bin/sh\", \"-c\", \"docker exec \\\"$(docker-compose ps -q web)\\\" start.sh\")</code></p>\n\n<p>Alternatively, you can run <code>docker-compose ps -q web</code> yourself, get its output and do the substitution instead of having bash do it for you.</p>\n"}], "owner": {"reputation": 1923, "user_id": 1351876, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/8028d0785748380250974c5424b07af2?s=128&d=identicon&r=PG", "display_name": "Nithin", "link": "https://stackoverflow.com/users/1351876/nithin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1080, "favorite_count": 0, "accepted_answer_id": 35188542, "answer_count": 1, "score": 0, "last_activity_date": 1454609286, "creation_date": 1454534589, "last_edit_date": 1454539944, "question_id": 35187986, "link": "https://stackoverflow.com/questions/35187986/how-to-pass-a-command-with-to-exec-command-in-golang", "title": "How to pass a command with $() to exec.command() in golang", "body": "<p>I want to execute a command like <code>docker exec \"$(docker-compose ps -q web)\" start.sh</code> from golang script using <code>exec.command()</code>. The problem is getting the command inside <code>$()</code> to execute.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "edited": false, "score": 1, "creation_date": 1454543279, "post_id": 35187450, "comment_id": 58097091, "body": "I don&#39;t know why this is down voted so much, but i see it as a perfectly valid question."}], "answers": [{"tags": [], "owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "is_accepted": false, "score": 3, "last_activity_date": 1454543249, "creation_date": 1454543249, "answer_id": 35189995, "question_id": 35187450, "link": "https://stackoverflow.com/questions/35187450/method-vs-functions-usage-golang/35189995#35189995", "title": "Method vs Functions Usage golang", "body": "<p>This is expected as per the spec: </p>\n\n<blockquote>\n  <p>The type of a method is the type of a function with the receiver as first argument.</p>\n</blockquote>\n\n<p>See <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow\">https://golang.org/ref/spec#Method_declarations</a></p>\n\n<p>So when you declare the <code>Add</code> method on <code>Product</code>, you get a function that accepts a pointer to a <code>Product</code> as its first argument. So you end up with </p>\n\n<pre><code>func (p *Product) Add() \n</code></pre>\n\n<p>being translated to</p>\n\n<pre><code>func Add(p *Product)\n</code></pre>\n\n<p>So both your calls are valid and end up doing the same</p>\n"}, {"comments": [{"owner": {"reputation": 221, "user_id": 2903988, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9be6fde3fe1d53740666ae966c2680f7?s=128&d=identicon&r=PG&f=1", "display_name": "LanMan", "link": "https://stackoverflow.com/users/2903988/lanman"}, "edited": false, "score": 0, "creation_date": 1454613473, "post_id": 35197210, "comment_id": 58134609, "body": "Thank you very much for detailed explanation!"}], "tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": true, "score": 5, "last_activity_date": 1483923236, "last_edit_date": 1483923236, "creation_date": 1454578220, "answer_id": 35197210, "question_id": 35187450, "link": "https://stackoverflow.com/questions/35187450/method-vs-functions-usage-golang/35197210#35197210", "title": "Method vs Functions Usage golang", "body": "<p>These are two distinct cases, one which is a <strong>method</strong> belongs to <code>Product</code> instance and one is a <strong>global function</strong> belongs to <code>products</code> package.</p>\n\n<pre><code>type Product struct {\n        Title string\n        Brand string\n        Model string\n}\n\n// This method add value to a field in Product\nfunc (p *Product) Add(field, value string) {\n        switch field {\n        case \"Title\":\n                p.Title = value\n        case \"Brand\":\n                p.Brand = value\n        case \"Model\":\n                p.Model = value\n        }\n}\n</code></pre>\n\n<p>The above provide a method to add value to itself as an instance of <code>Product</code>, i.e.</p>\n\n<pre><code>product1 := &amp;Product{}\nproduct1.Add(\"Title\", \"first_title\")\n</code></pre>\n\n<p>The second case is a public function exposed from a <code>product</code> package. In this case, an instance (or a pointer) of a <code>Product</code> must be supplied as an argument.</p>\n\n<pre><code>package products\n\nfunc Add(p *Product, field, value string) {\n        // Same switch-case as above\n}\n</code></pre>\n\n<p><code>Add</code> function then can be used from any other package.</p>\n\n<pre><code>package main\n\nimport (\n        \"path/to/products\"\n)\n\ntype Product struct {\n        // ...\n}\n\nfunc main() {\n        product1 := &amp;Product{}\n        products.Add(product1, \"Title\", \"first_title\")\n</code></pre>\n\n<p>Normally in your scenario, the first approach is preferred since it encapsulates the functionality of managing its attributes to itself. </p>\n\n<p>The second scenario might be seen as a \"class method approach\" (for those coming from OOP like Python or Java) where the package is similar to class and the exposed functions similar to class methods which are more generic and can be used across many types which implement the same interface, like so:</p>\n\n<pre><code>package products\n\n// where p is a Product interface\nfunc Add(p Product, field, value string) {\n        // Same switch-case as above\n}\n\ntype Product interface {\n        someMethod()\n}\n</code></pre>\n\n<p>And from another package:</p>\n\n<pre><code>package main\n\nimport (\n        \"path/to/products\"\n)\n\ntype Car struct {\n        Title string\n        Brand string\n        Model string\n}\n\ntype Ship struct {\n        // ...\n}\n\ntype Airplane struct {\n        // ...\n}\n\n// All types implement `Product` and can be used in `products.Add`\nfunc (c *Car) someMethod() {}\nfunc (s *Ship) someMethod() {}\nfunc (a *Airplane) someMethod() {}\n\nfunc main() {\n       plane := &amp;Airplane{}\n       products.Add(plane, \"Model\", \"Boeing-747\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "is_accepted": false, "score": 0, "last_activity_date": 1599532275, "last_edit_date": 1599532275, "creation_date": 1586499125, "answer_id": 61134922, "question_id": 35187450, "link": "https://stackoverflow.com/questions/35187450/method-vs-functions-usage-golang/61134922#61134922", "title": "Method vs Functions Usage golang", "body": "<p>Extending the fantastic answer by @Danilo:</p>\n<pre><code>package main\n\nimport &quot;fmt&quot;\n\ntype T struct {\n    i int\n}\n\nfunc (t *T) F() {\n    t = &amp;T{1}\n    fmt.Println(t.i)\n}\n\nfunc F(t *T) {\n    fmt.Println(t.i)\n}\n\nfunc main() {\n    t := T{2}\n    (&amp;t).F()\n    F(&amp;t)\n}\n</code></pre>\n<p>The type of the method <code>func (t *T) F()</code> is the type of the function <code>func F(t *T)</code> with the receiver <code>(t *T)</code> as first argument.</p>\n"}], "owner": {"reputation": 221, "user_id": 2903988, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9be6fde3fe1d53740666ae966c2680f7?s=128&d=identicon&r=PG&f=1", "display_name": "LanMan", "link": "https://stackoverflow.com/users/2903988/lanman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1907, "favorite_count": 2, "accepted_answer_id": 35197210, "answer_count": 3, "score": 4, "last_activity_date": 1599532275, "creation_date": 1454532705, "last_edit_date": 1488042175, "question_id": 35187450, "link": "https://stackoverflow.com/questions/35187450/method-vs-functions-usage-golang", "title": "Method vs Functions Usage golang", "body": "<p>I know differences between func and method. But I am confusing for usages between:</p>\n\n<pre><code>prod:=Product{\"title\",\"brand\",\"model\"}\nprod.Add()\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>prod:=Product{\"title\",\"brand\",\"model\"}\nproducts.Add(&amp;prod) // products is package\n</code></pre>\n"}, {"tags": ["go", "tcp"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1454528615, "last_edit_date": 1454528615, "creation_date": 1454528217, "answer_id": 35186107, "question_id": 35185789, "link": "https://stackoverflow.com/questions/35185789/go-get-error-i-o-timeout-in-server-program/35186107#35186107", "title": "Go. Get error i/o timeout in server program", "body": "<p>Syntax errors and undeclared variables aside, what you're showing us can't possibly be walking the Read/Write deadline forward indefinitely. </p>\n\n<p>The longest this could run is until a fixed duration after the first <code>time.Now()</code> (<code>c.kickTime.Add(c.durationToKick)</code>). You probably want something like:</p>\n\n<pre><code>c.conn.SetDeadline(time.Now().Add(c.durationToKick))\n</code></pre>\n"}], "owner": {"reputation": 1366, "user_id": 4931643, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/702807200eaef92e4d1c6896893d7888?s=128&d=identicon&r=PG&f=1", "display_name": "Mbded", "link": "https://stackoverflow.com/users/4931643/mbded"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1166, "favorite_count": 0, "accepted_answer_id": 35186107, "answer_count": 1, "score": 0, "last_activity_date": 1454528615, "creation_date": 1454527158, "question_id": 35185789, "link": "https://stackoverflow.com/questions/35185789/go-get-error-i-o-timeout-in-server-program", "title": "Go. Get error i/o timeout in server program", "body": "<p>I wrote simply server program to received data form client. I little not understand what sometimes i get error <strong>read tcp4 IP:PORT i/o timeout</strong>  from function\n<code>int, err := conn.Read([]byte)</code> event time set in function <code>SetDeadline()</code> not was exceeded. I present some part of my code, but I think that this is will enought.</p>\n\n<p>main loop where I recieve data is below.</p>\n\n<pre><code>c := NewClient()\nc.kickTime: time.Now()\nfunc (c *Client) Listen(){\n\n    durationToClose := time.Minute*time.Duration(5),\n    c.conn.SetDeadline(c.kickTime.Add(c.durationToClose))\n    buffer := make([]byte, 1024)\n        for{\n            reqLen, err := c.conn.Read(buffer)\n            if err != nil || reqLen == 0 {\n                fmt.Printf(err)\n                break\n            }\n            if err = c.CheckData(buffer) ; err != nil{ \n            fmt.Printf(\"something is bad\")\n            }else{\n            result := c.PrepareDataToSendInOtherPlace(buffer)\n            go c.RecievedData(result)\n\n            }\n            c.conn.SetDeadline(c.kickTime.Add(c.durationToKick))\n        }\n}\n</code></pre>\n\n<p>For me only suspicious can be additional function as <code>PrepareDataToSendInOtherPlace() , CheckData()</code> which may take some times CPU, and then new data was be send by client, and server at the time doing something else and rejects connect. This is only my supposition, but I not sure.</p>\n"}, {"tags": ["xml", "go", "format", "marshalling"], "answers": [{"comments": [{"owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "edited": false, "score": 0, "creation_date": 1454522115, "post_id": 35183819, "comment_id": 58085525, "body": "Thank you! How would I handle the <code>omitempty</code> xml tag? Now <code>0.00</code> gets written to the attribute. (added edit to question)"}, {"owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "edited": false, "score": 0, "creation_date": 1454527300, "post_id": 35183819, "comment_id": 58088627, "body": "Ok, I see. Currently on the phone so I haven&#39;t tried it yet, but wouldn&#39;t a float like <code>0.000000012252</code> mess it up?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "edited": false, "score": 0, "creation_date": 1454534999, "post_id": 35183819, "comment_id": 58093353, "body": "Depending on what you mean by &quot;messing it up&quot;."}, {"owner": {"reputation": 3769, "user_id": 1686511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8038258c9e59d54c0a9b294a986ef456?s=128&d=identicon&r=PG", "display_name": "Garry Polley", "link": "https://stackoverflow.com/users/1686511/garry-polley"}, "edited": false, "score": 1, "creation_date": 1508349862, "post_id": 35183819, "comment_id": 80580198, "body": "As an option closer to the go implementation: <a href=\"https://play.golang.org/p/DK9wDZ2d_I\" rel=\"nofollow noreferrer\">play.golang.org/p/DK9wDZ2d_I</a>     It uses strconv"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 6, "last_activity_date": 1454526791, "last_edit_date": 1454526791, "creation_date": 1454520745, "answer_id": 35183819, "question_id": 35183690, "link": "https://stackoverflow.com/questions/35183690/golang-change-xml-marshal-format-of-float/35183819#35183819", "title": "Golang change xml marshal format of float", "body": "<p>You can create your own number type that marshals the way you like it:</p>\n\n<pre><code>type prettyFloat float64\n\nfunc (f prettyFloat) MarshalXMLAttr(name xml.Name) (xml.Attr, error) {\n    s := fmt.Sprintf(\"%.2f\", f)\n    return xml.Attr{Name: name, Value: s}, nil\n}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/2moWdAwXrd\" rel=\"nofollow\">http://play.golang.org/p/2moWdAwXrd</a>.</p>\n\n<p><strong>EDIT:</strong> <code>,omitempty</code> version:</p>\n\n<pre><code>type prettyFloat float64\n\nfunc (f prettyFloat) MarshalXMLAttr(name xml.Name) (xml.Attr, error) {\n    if f == 0 {\n        return xml.Attr{}, nil\n    }\n    s := fmt.Sprintf(\"%.2f\", f)\n    return xml.Attr{Name: name, Value: s}, nil\n}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/myBrjGGSJY\" rel=\"nofollow\">http://play.golang.org/p/myBrjGGSJY</a>.</p>\n"}], "owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1045, "favorite_count": 0, "accepted_answer_id": 35183819, "answer_count": 1, "score": 4, "last_activity_date": 1454526791, "creation_date": 1454520346, "last_edit_date": 1454522172, "question_id": 35183690, "link": "https://stackoverflow.com/questions/35183690/golang-change-xml-marshal-format-of-float", "title": "Golang change xml marshal format of float", "body": "<p>When I marshal <code>float64</code> to an xml file:</p>\n\n<pre><code>type X struct {\n    Value float64 `xml:\",attr,omitempty\"`\n}\nvar x X\nx.Value = 1000000.04\n</code></pre>\n\n<p>I get value like:</p>\n\n<pre><code>&lt;X Value=\"1.00000004e+06\"&gt;&lt;/X&gt;\n</code></pre>\n\n<p>How to change the output format, such that the full value (1000000.04) is written (and the <code>omitempty</code> tag is still working)?</p>\n"}, {"tags": ["regex", "go"], "answers": [{"comments": [{"owner": {"reputation": 2169, "user_id": 974936, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/92bf3deb0a4fa650b44e7706b0736adb?s=128&d=identicon&r=PG", "display_name": "watzon", "link": "https://stackoverflow.com/users/974936/watzon"}, "edited": false, "score": 0, "creation_date": 1454518869, "post_id": 35183194, "comment_id": 58083367, "body": "Well don&#39;t I feel dumb haha. Thanks!"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 12, "last_activity_date": 1454518879, "last_edit_date": 1454518879, "creation_date": 1454518811, "answer_id": 35183194, "question_id": 35183103, "link": "https://stackoverflow.com/questions/35183103/escaping-parentheses-in-go-regexp/35183194#35183194", "title": "Escaping parentheses in Go regexp", "body": "<p>You need to escape the backslashes, because <code>\\(</code> isn't a valid excape sequence. </p>\n\n<pre><code>\"\\\\(([0-9]+),([0-9.]+),(?:$([0-9]+))\\\\)\"\n</code></pre>\n\n<p>More commonly you would use backticks for string literals without escaping:</p>\n\n<pre><code>`\\(([0-9]+),([0-9.]+),(?:$([0-9]+))\\)`\n</code></pre>\n"}], "owner": {"reputation": 2169, "user_id": 974936, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/92bf3deb0a4fa650b44e7706b0736adb?s=128&d=identicon&r=PG", "display_name": "watzon", "link": "https://stackoverflow.com/users/974936/watzon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2678, "favorite_count": 0, "accepted_answer_id": 35183194, "answer_count": 1, "score": 4, "last_activity_date": 1454518879, "creation_date": 1454518591, "question_id": 35183103, "link": "https://stackoverflow.com/questions/35183103/escaping-parentheses-in-go-regexp", "title": "Escaping parentheses in Go regexp", "body": "<p>I am tying to run the following regular expression on a string in Go </p>\n\n<p><code>\\(([0-9]+),([0-9.]+),(?:$([0-9]+))\\)</code></p>\n\n<p>but I keep getting the error <code>unknown escape sequence: (</code></p>\n\n<p>the string that I'm running it on is <code>(1,53.38,$45) (2,88.62,$98) (3,78.48,$3) (4,72.30,$76) (5,30.18,$9) (6,46.34,$48)</code></p>\n\n<p>So my question is, how do you escape parentheses in Go's regexp?</p>\n"}, {"tags": ["time", "go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 7, "last_activity_date": 1454518346, "last_edit_date": 1454518346, "creation_date": 1454517945, "answer_id": 35182855, "question_id": 35182556, "link": "https://stackoverflow.com/questions/35182556/get-last-day-in-month-of-time-time/35182855#35182855", "title": "Get last day in month of time.Time", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/time/\">Package time</a></p>\n  \n  <p><a href=\"https://golang.org/pkg/time/#Date\">func Date</a></p>\n\n<pre><code>func Date(year int, month Month, day, hour, min, sec, nsec int, loc *Location) Time\n</code></pre>\n  \n  <p>Date returns the Time corresponding to</p>\n  \n  <p>yyyy-mm-dd hh:mm:ss + nsec nanoseconds</p>\n  \n  <p>in the appropriate zone for that time in the given location.</p>\n  \n  <p>The month, day, hour, min, sec, and nsec values may be outside their\n  usual ranges and will be normalized during the conversion. For\n  example, October 32 converts to November 1.</p>\n</blockquote>\n\n<p>For example, normalizing a date,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    // January, 29th\n    t, _ := time.Parse(\"2006-01-02\", \"2016-01-29\")\n    fmt.Println(t.Date())\n    // January, 31st\n    y,m,_ := t.Date()\n    lastday:= time.Date(y,m+1,0,0,0,0,0,time.UTC)\n    fmt.Println(lastday.Date())\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2016 January 29\n2016 January 31\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1454520989, "post_id": 35182930, "comment_id": 58084809, "body": "The question: &quot;How can I get a <code>time.Time</code> which represents January 31st?&quot; Your benchmarks are invalid. They have different inputs and outputs. They don&#39;t do the same thing. To paraphrase: There are lies, damn lies, and benchmarks!"}, {"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1454521974, "post_id": 35182930, "comment_id": 58085438, "body": "(Your answer should be the accepted one; readability is key, even if it solves a slightly harder problem than the question asked for, i.e. keeping track of the current year)"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1454527144, "post_id": 35182930, "comment_id": 58088532, "body": "Your benchmarks are still invalid. For example, you use a precomputed month and year for your function. For the other functions you parse a string and then extract the month and year. You also calculate just the day instead of the date. For a valid benchmark, use the same function signature: <code>func (time.Time) time.Time</code>, the same <code>time.Time</code> argument, and return the same <code>time.Time</code> value. My results from a fair benchmark: LastDay1 287, LastDay2 286, LastDay3 682.. What results do you get from a fair benchmark: <a href=\"http://play.golang.org/p/fwlTn2zYGU\" rel=\"nofollow noreferrer\">play.golang.org/p/fwlTn2zYGU</a>."}], "tags": [], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "is_accepted": false, "score": 2, "last_activity_date": 1454521647, "last_edit_date": 1454521647, "creation_date": 1454518092, "answer_id": 35182930, "question_id": 35182556, "link": "https://stackoverflow.com/questions/35182556/get-last-day-in-month-of-time-time/35182930#35182930", "title": "Get last day in month of time.Time", "body": "<p>You could write a function yourself, maybe something like this:</p>\n\n<pre><code>func daysInMonth(month, year int) int {\n    switch time.Month(month) {\n    case time.April, time.June, time.September, time.November:\n        return 30\n    case time.February:\n        if year%4 == 0 &amp;&amp; (year%100 != 0 || year%400 == 0) { // leap year\n            return 29\n        }\n        return 28\n    default: \n    return 31\n    }\n}\n</code></pre>\n\n<p>EDIT: since I really like measuring things:</p>\n\n<pre><code>$ go test -bench .\ntesting: warning: no tests to run\nPASS\nBenchmarkDim2-8         200000000                7.26 ns/op\nBenchmarkDim-8          1000000000               2.80 ns/op // LIES!\nBenchmarkTime-8         10000000               169 ns/op\nBenchmarkTime2-8        10000000               234 ns/op\nok      github.com/drathier/scratchpad/go       9.741s\n</code></pre>\n\n<p>BenchMarkDim2: not tested, but very fast. </p>\n\n<pre><code>func daysInMonthTime(month, year int) time.Time {\n    return time.Time{}.Add(time.Hour * 10 + time.Hour*24*30*time.Duration(month-1) + time.Second * time.Duration(daysInMonth(month, year)) * 24 * 60 + 1337)\n}\n</code></pre>\n\n<p>BenchmarkDim: // LIES</p>\n\n<pre><code>func daysInMonth(month, year int) int {\n    switch time.Month(month) {\n    case time.April, time.June, time.September, time.November:\n        return 30\n    case time.February:\n        if year%4 == 0 &amp;&amp; (year%100 != 0 || year%400 == 0) {\n            // leap year\n            return 29\n        }\n        return 28\n    default:\n        return 31\n    }\n}\n</code></pre>\n\n<p>BenchmarkTime:</p>\n\n<pre><code>func timeDaysInMonth() time.Time {\n    // January, 29th\n    t, _ := time.Parse(\"2006-01-02\", \"2016-01-29\")\n    y, m, _ := t.Date()\n    lastday := time.Date(y, m+1, 0, 0, 0, 0, 0, time.UTC)\n    return lastday\n}\n</code></pre>\n\n<p>BenchmarkTime2</p>\n\n<pre><code>func time2daysinmonth() time.Time {\n    t, _ := time.Parse(\"2006-01-02\", \"2016-01-01\")\n    t = t.AddDate(0, 1, 0).AddDate(0, 0, -1)\n    return t\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 4090541, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vFuCy1k0FXU/AAAAAAAAAAI/AAAAAAAAFSw/BIF4X_2O7rw/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u043e\u043b\u0430\u0439 \u041a\u043e\u043b\u0435\u0432", "link": "https://stackoverflow.com/users/4090541/%d0%9d%d0%b8%d0%ba%d0%be%d0%bb%d0%b0%d0%b9-%d0%9a%d0%be%d0%bb%d0%b5%d0%b2"}, "is_accepted": false, "score": 0, "last_activity_date": 1454519829, "creation_date": 1454519829, "answer_id": 35183554, "question_id": 35182556, "link": "https://stackoverflow.com/questions/35182556/get-last-day-in-month-of-time-time/35183554#35183554", "title": "Get last day in month of time.Time", "body": "<p>It's not Go specific but usually I do following in any language:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n\n    t, _ := time.Parse(\"2006-01-02\", \"2016-01-01\")\n    t = t.AddDate(0, 1, 0).AddDate(0,0,-1)\n    fmt.Printf(\"Last day: %v\\n\", t)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/JhpOZvEhBw\" rel=\"nofollow\">http://play.golang.org/p/JhpOZvEhBw</a></p>\n"}, {"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 1, "last_activity_date": 1454520017, "creation_date": 1454520017, "answer_id": 35183610, "question_id": 35182556, "link": "https://stackoverflow.com/questions/35182556/get-last-day-in-month-of-time-time/35183610#35183610", "title": "Get last day in month of time.Time", "body": "<p>I've used something similar to this in my own code:</p>\n\n<pre><code>func lastDayOfTheMonth(year, month int) time.Time {\n    if month++; month &gt; 12 {\n        month = 1\n    }\n    t := time.Date(year, time.Month(month), 0, 0, 0, 0, 0, time.UTC)\n    return t\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/JHYBAlloe6\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}], "owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1253, "favorite_count": 1, "accepted_answer_id": 35182855, "answer_count": 4, "score": 6, "last_activity_date": 1454521647, "creation_date": 1454517144, "question_id": 35182556, "link": "https://stackoverflow.com/questions/35182556/get-last-day-in-month-of-time-time", "title": "Get last day in month of time.Time", "body": "<p>When I have a <code>time.Time</code>:</p>\n\n<pre><code>// January, 29th\nt, _ := time.Parse(\"2006-01-02\", \"2016-01-29\")\n</code></pre>\n\n<p>How can I get a <code>time.Time</code> which represents January 31st? This example is trivial, but when there's a date in February, the last day might be 28th or 29th.</p>\n"}, {"tags": ["go", "slice", "chunking"], "answers": [{"comments": [{"owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "edited": false, "score": 0, "creation_date": 1454511377, "post_id": 35179941, "comment_id": 58077637, "body": "Ahhhhhhh that&#39;s what I was missing. I kept trying to iterate over a limited range instead of iterating via chunk length. I spent 8 hours trying to figure out how to get mine working, lol. Thanks for the answer, super helpful."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1454519150, "post_id": 35179941, "comment_id": 58083579, "body": "You look to be off by one in the length of <code>divided</code>. For example, <code>numCPU = 3; logs = logs[:8]; chunkSize := len(logs) &#47; numCPU; if chunkSize == 0 { chunkSize = 1 };</code> divides into 4, not 3, for 3 cpus and 8 logs: <a href=\"http://play.golang.org/p/EdhiclVR0q\" rel=\"nofollow noreferrer\">play.golang.org/p/EdhiclVR0q</a>. For <code>chunkSize</code>, write <code>chunkSize := (len(logs) + numCPU - 1) &#47; numCPU;</code>: <a href=\"http://play.golang.org/p/xDyFXt45Fz\" rel=\"nofollow noreferrer\">play.golang.org/p/xDyFXt45Fz</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1454519622, "post_id": 35179941, "comment_id": 58083881, "body": "@peterSO: thanks, just copied that from the original and didn&#39;t think to check."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 72, "last_activity_date": 1454519448, "last_edit_date": 1454519448, "creation_date": 1454510288, "answer_id": 35179941, "question_id": 35179656, "link": "https://stackoverflow.com/questions/35179656/slice-chunking-in-go/35179941#35179941", "title": "Slice chunking in Go", "body": "<p>You don't need to make new slices, just append slices of <code>logs</code> to the <code>divided</code> slice.</p>\n\n<p><a href=\"http://play.golang.org/p/vyihJZlDVy\" rel=\"noreferrer\">http://play.golang.org/p/vyihJZlDVy</a></p>\n\n<pre><code>var divided [][]string\n\nchunkSize := (len(logs) + numCPU - 1) / numCPU\n\nfor i := 0; i &lt; len(logs); i += chunkSize {\n    end := i + chunkSize\n\n    if end &gt; len(logs) {\n        end = len(logs)\n    }\n\n    divided = append(divided, logs[i:end])\n}\n\nfmt.Printf(\"%#v\\n\", divided)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 137, "user_id": 15533231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YXlYh.png?s=128&g=1", "display_name": "SIREN", "link": "https://stackoverflow.com/users/15533231/siren"}, "is_accepted": false, "score": 2, "last_activity_date": 1617932024, "last_edit_date": 1617932024, "creation_date": 1617915550, "answer_id": 67011816, "question_id": 35179656, "link": "https://stackoverflow.com/questions/35179656/slice-chunking-in-go/67011816#67011816", "title": "Slice chunking in Go", "body": "<p>Another variant. It works about 2.5 times faster than the one proposed by <a href=\"https://stackoverflow.com/users/32880/jimb\">JimB</a>. The tests and benchmarks are <a href=\"https://github.com/bcmk/chunks-benchmarks\" rel=\"nofollow noreferrer\">here</a>.</p>\n<p><a href=\"https://play.golang.org/p/WoXHqGjozMI\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WoXHqGjozMI</a></p>\n<pre><code>func chunks(xs []string, chunkSize int) [][]string {\n    if len(xs) == 0 {\n        return nil\n    }\n    divided := make([][]string, (len(xs)+chunkSize-1)/chunkSize)\n    prev := 0\n    i := 0\n    till := len(xs) - chunkSize\n    for prev &lt; till {\n        next := prev + chunkSize\n        divided[i] = xs[prev:next]\n        prev = next\n        i++\n    }\n    divided[i] = xs[prev:]\n    return divided\n}\n</code></pre>\n"}], "owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31015, "favorite_count": 7, "accepted_answer_id": 35179941, "answer_count": 2, "score": 26, "last_activity_date": 1617932024, "creation_date": 1454509429, "question_id": 35179656, "link": "https://stackoverflow.com/questions/35179656/slice-chunking-in-go", "title": "Slice chunking in Go", "body": "<p>I have a slice with ~2.1 million log strings in it, and I would like to create a slice of slices with the strings being as evenly distributed as possible.</p>\n\n<p>Here is what I have so far:</p>\n\n<pre><code>// logs is a slice with ~2.1 million strings in it.\nvar divided = make([][]string, 0)\nNumCPU := runtime.NumCPU()\nChunkSize := len(logs) / NumCPU\nfor i := 0; i &lt; NumCPU; i++ {\n    temp := make([]string, 0)\n    idx := i * ChunkSize\n    end := i * ChunkSize + ChunkSize\n    for x := range logs[idx:end] {\n        temp = append(temp, logs[x])\n    }\n    if i == NumCPU {\n        for x := range logs[idx:] {\n            temp = append(temp, logs[x])\n        }\n    }\n    divided = append(divided, temp)\n}\n</code></pre>\n\n<p>The <code>idx := i * ChunkSize</code> will give me the current \"chunk start\" for the <code>logs</code> index, and <code>end := i * ChunkSize + ChunkSize</code> will give me the \"chunk end\", or the end of the range of that chunk. I couldn't find any documentation or examples on how to chunk/split a slice or iterate over a limited range in Go, so this is what I came up with. However, it only copies the first chunk multiple times, so it doesn't work.</p>\n\n<p>How do I (as evenly as possible) chunk an slice in Go?</p>\n"}, {"tags": ["go", "endianness", "boltdb"], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 2, "last_activity_date": 1454514558, "creation_date": 1454514558, "answer_id": 35181528, "question_id": 35179563, "link": "https://stackoverflow.com/questions/35179563/key-order-in-boltdb/35181528#35181528", "title": "Key Order in BoltDB", "body": "<p>To have the keys naturally ordered, use BigEndian</p>\n\n<p>In LittleEndian, the bytes are swapped, which would give it to you out of order.</p>\n"}], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1432, "favorite_count": 0, "accepted_answer_id": 35181528, "answer_count": 1, "score": 3, "last_activity_date": 1454514558, "creation_date": 1454509193, "question_id": 35179563, "link": "https://stackoverflow.com/questions/35179563/key-order-in-boltdb", "title": "Key Order in BoltDB", "body": "<p>Which endian should be used for a boltdb's key? Should I get the endian of the machine first and use that?</p>\n\n<p>I need the keys to be ordered properly - just as a sequence of bytes, no specific logic for ordering them. For example which endian should be used here (the <code>Key</code> is a sequential <code>id</code>, like a <code>mongodb</code>'s one):</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"fmt\"\n    \"log\"\n    \"time\"\n\n    \"github.com/boltdb/bolt\"\n)\n\nvar (\n    Endian = binary.BigEndian // Which endian?\n)\n\nfunc main() {\n    db, err := bolt.Open(\"temp.db\", 0600, nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n    defer time.Sleep(time.Second)\n\n    tempBucket := []byte(\"TMP\")\n\n    db.Update(func(tx *bolt.Tx) error {\n        data := Row{\n            Key: Key{\n                Head:    0x1A1A1A,\n                Mark:    0x1010,\n                Counter: 0x01,\n            },\n            At:      time.Now().UTC().Unix(),\n            Payload: 10,\n        }\n\n        keyBytes, err := marshal(&amp;data.Key)\n        if err != nil {\n            return erp(err)\n        }\n\n        dataBytes, err := marshal(&amp;data)\n        if err != nil {\n            return erp(err)\n        }\n\n        b, err := tx.CreateBucketIfNotExists(tempBucket)\n        if err != nil {\n            return erp(err)\n        }\n\n        err = b.Put(keyBytes, dataBytes)\n        if err != nil {\n            return erp(err)\n        }\n\n        return nil\n    })\n\n    db.View(func(tx *bolt.Tx) error {\n        b := tx.Bucket(tempBucket)\n\n        c := b.Cursor()\n\n        for k, v := c.First(); k != nil; k, v = c.Next() {\n            k, v := k, v\n            fmt.Println(k, v)\n\n            dt := Row{}\n            err := unmarshal(&amp;dt, v)\n            if err != nil {\n                return erp(err)\n            }\n            fmt.Printf(\"key=%X, value=%v\\n\", k, dt)\n        }\n\n        return nil\n    })\n}\n\nfunc erp(e error) error {\n    log.Println(e)\n    return e\n}\n\nfunc marshal(pointerToData interface{}) ([]byte, error) {\n    buf := new(bytes.Buffer)\n    err := binary.Write(buf, Endian, pointerToData)\n    if err != nil {\n        return nil, err\n    }\n    return buf.Bytes(), nil\n}\n\nfunc unmarshal(pointerToData interface{}, bs []byte) error {\n    buffer := bytes.NewBuffer(bs)\n    err := binary.Read(buffer, Endian, pointerToData)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n\ntype Row struct {\n    Key\n    At      int64\n    Payload int64\n}\n\ntype Key struct {\n    Head    uint32\n    Mark    uint16\n    Counter uint16\n}\n</code></pre>\n"}, {"tags": ["go", "logstash", "elastic-stack", "logstash-forwarder", "filebeat"], "comments": [{"owner": {"reputation": 15576, "user_id": 677561, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/95077e3dc8c640d554cfa97da3dc6131?s=128&d=identicon&r=PG&f=1", "display_name": "Alain Collins", "link": "https://stackoverflow.com/users/677561/alain-collins"}, "edited": false, "score": 0, "creation_date": 1454511143, "post_id": 35179234, "comment_id": 58077464, "body": "The first line looks like you&#39;re trying to rename a file that&#39;s open.  Perhaps something else has it open?"}, {"owner": {"reputation": 678, "user_id": 1035596, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5ab84827dd84cf733e28796d8eced786?s=128&d=identicon&r=PG", "display_name": "Itay Weiss", "link": "https://stackoverflow.com/users/1035596/itay-weiss"}, "reply_to_user": {"reputation": 15576, "user_id": 677561, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/95077e3dc8c640d554cfa97da3dc6131?s=128&d=identicon&r=PG&f=1", "display_name": "Alain Collins", "link": "https://stackoverflow.com/users/677561/alain-collins"}, "edited": false, "score": 0, "creation_date": 1454513753, "post_id": 35179234, "comment_id": 58079402, "body": "@AlainCollins- It doesn&#39;t seem to be open (lsof) and it&#39;s not supposed to be. And I don&#39;t really think it&#39;s renaming the file."}, {"owner": {"reputation": 2698, "user_id": 138163, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9XdWa.png?s=128&g=1", "display_name": "alfredocambera", "link": "https://stackoverflow.com/users/138163/alfredocambera"}, "edited": false, "score": 0, "creation_date": 1454515293, "post_id": 35179234, "comment_id": 58080607, "body": "try with    lsof /path/to/file.txt   to check who has the file opened"}, {"owner": {"reputation": 678, "user_id": 1035596, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5ab84827dd84cf733e28796d8eced786?s=128&d=identicon&r=PG", "display_name": "Itay Weiss", "link": "https://stackoverflow.com/users/1035596/itay-weiss"}, "edited": false, "score": 0, "creation_date": 1454516661, "post_id": 35179234, "comment_id": 58081659, "body": "@alfredocambera- I did"}, {"owner": {"reputation": 15576, "user_id": 677561, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/95077e3dc8c640d554cfa97da3dc6131?s=128&d=identicon&r=PG&f=1", "display_name": "Alain Collins", "link": "https://stackoverflow.com/users/677561/alain-collins"}, "edited": false, "score": 0, "creation_date": 1454521244, "post_id": 35179234, "comment_id": 58084971, "body": "file_other.go at that line does talk about renaming the file: <a href=\"https://github.com/elastic/filebeat/blob/master/input/file_other.go#L36\" rel=\"nofollow noreferrer\">github.com/elastic/filebeat/blob/master/input/file_other.go#&zwnj;&#8203;L36</a>"}], "answers": [{"tags": [], "owner": {"reputation": 6782, "user_id": 2240409, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/0b52128e90fc2a35f1540edd4a9ac06f?s=128&d=identicon&r=PG", "display_name": "dazito", "link": "https://stackoverflow.com/users/2240409/dazito"}, "is_accepted": true, "score": 1, "last_activity_date": 1473419086, "creation_date": 1473419086, "answer_id": 39410142, "question_id": 35179234, "link": "https://stackoverflow.com/questions/35179234/making-filebeat-start-with-old-files-offsets-using-old-registry/39410142#39410142", "title": "Making Filebeat start with old files offsets using old registry", "body": "<p>With Filebeat version 1.2.3 (other versions may be the same, version 1.3 just came out a few days ago and I've not tried it yet) you will need to specify the path to the registry file. The registry file is the file where Filebeat keeps it read offset (in other words, the current read point in the log(s) file(s) it is processing).</p>\n\n<p>You need to specify the registry path in your <code>filebeat.yml</code> file, after the <code>prospectors</code> section.</p>\n\n<p>Something like:</p>\n\n<pre><code>filebeat:\n  prospectors:\n    -\n      document_type: wildfly-server\n      input_type: log\n      paths:\n        - /path/to/my/log.log\n      multiline:\n         pattern: 'your pattern'\n         negate: true\n         match: after\n\n  registry_file: /data/.filebeat\n\nlogging:\n  level: debug\n  to_syslog: true\n\noutput:\n  logstash:\n    hosts:\n      - \"127.0.0.1:5000\"\n</code></pre>\n\n<p>Then in your docker compose file you need to mount a volume pointing to your <code>registry_file</code> path. Something like:</p>\n\n<pre><code>filebeat:\n  image: prima/filebeat:latest\n  volumes:\n     - /data/filebeat:/data\n  hostname: qa\n</code></pre>\n\n<p>Then you should see in the host the <code>.filebeat</code> file located in the <code>/data/filebeat</code> folder.</p>\n"}], "owner": {"reputation": 678, "user_id": 1035596, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5ab84827dd84cf733e28796d8eced786?s=128&d=identicon&r=PG", "display_name": "Itay Weiss", "link": "https://stackoverflow.com/users/1035596/itay-weiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1672, "favorite_count": 1, "accepted_answer_id": 39410142, "answer_count": 1, "score": 1, "last_activity_date": 1473419086, "creation_date": 1454508291, "question_id": 35179234, "link": "https://stackoverflow.com/questions/35179234/making-filebeat-start-with-old-files-offsets-using-old-registry", "title": "Making Filebeat start with old files offsets using old registry", "body": "<p>I'm running Filebeat (used to be know as \"logstash-forwarder\") on a docker container using prima/filebeat image.</p>\n\n<p>The log files are located in a volume loaded to the container and I want to be able to remove the container and rerun it without it re-sending the logs to the logstash.</p>\n\n<p>I tried to load the /.filebeat registry file as a volume so it will be reloaded on startup but all I get are these errors:</p>\n\n<pre><code>2016/02/03 13:47:29.107457 file_other.go:39: ERR Rotate error: rename /.filebeat.new /.filebeat: device or resource busy\n2016/02/03 13:47:29.107788 registrar.go:105: ERR Writing of registry returned error: rename /.filebeat.new /.filebeat: device or resource busy. Continuing..\n</code></pre>\n\n<p>Does anybody happen to know how to do such a thing?</p>\n"}, {"tags": ["xml", "go", "epp"], "answers": [{"comments": [{"owner": {"reputation": 358, "user_id": 4536186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/nNlUY.png?s=128&g=1", "display_name": "Harlam", "link": "https://stackoverflow.com/users/4536186/harlam"}, "edited": false, "score": 0, "creation_date": 1454554949, "post_id": 35183192, "comment_id": 58100508, "body": "thanks for answer. I know it all. Main problem is for me that function IsError() must be copied again and again for each struct (SomeCommand, OtherCommand, ...) for realization Command interface in this cases. And I don&#39;t want to do it."}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 358, "user_id": 4536186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/nNlUY.png?s=128&g=1", "display_name": "Harlam", "link": "https://stackoverflow.com/users/4536186/harlam"}, "edited": false, "score": 1, "creation_date": 1454579538, "post_id": 35183192, "comment_id": 58111577, "body": "@Harlam I don&#39;t understand what do you mean by &quot;again and again&quot;. If you embedding <code>CommandResult</code> into <code>SomeCommand</code> <code>SomeCommand</code> automatically &quot;inhirits&quot; <code>IsError</code> method. I&#39;ve added full example in update."}], "tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 1, "last_activity_date": 1454579272, "last_edit_date": 1454579272, "creation_date": 1454518810, "answer_id": 35183192, "question_id": 35178998, "link": "https://stackoverflow.com/questions/35178998/how-to-parse-xml-correctly/35183192#35183192", "title": "How to parse xml correctly", "body": "<ol>\n<li><p>I think paths in embedded structure should be absolute as all \"parent's\" structures are part of the \"child\". So your </p>\n\n<pre><code> type CommandResult struct {\n     Code    int    `xml:\"code,attr\" json:\"code\"`\n     Message string `xml:\"msg\" json:\"msg\"`\n }\n</code></pre>\n\n<p>Should be more like</p>\n\n<pre><code> type CommandResult struct {\n     Code    int    `xml:\"response&gt;result&gt;code,attr\" json:\"code\"`\n     Message string `xml:\"response&gt;result&gt;msg\" json:\"msg\"`\n }\n</code></pre>\n\n<p>BUT! There we are facing Go's limitation.</p></li>\n<li><p>You can't use <code>attr</code> with chaining. There is <a href=\"https://github.com/golang/go/issues/3688\" rel=\"nofollow\">issue on Github</a> but looks like it is not in priority list. So if I right understand shortest version of your <code>CommandResult</code> declaration would be:</p>\n\n<pre><code>type CommandResult struct {\n    Result struct {\n        Code    int    `xml:\"code,attr\" json:\"code\"`\n        Message string `xml:\"msg\" json:\"msg\"`\n    } `xml:\"response&gt;result\" json:\"response\"`\n}\n</code></pre></li>\n<li><p>Not a real problem but in case if you will decide to convert <code>Command</code> back to XML would be nice to declare its <code>XMLName</code>. Something like</p>\n\n<pre><code>type CommandResult struct {\n    XMLName xml.Name `xml:\"epp\"`\n    Result  struct {\n        Code    int    `xml:\"code,attr\" json:\"code\"`\n        Message string `xml:\"msg\" json:\"msg\"`\n    } `xml:\"response&gt;result\" json:\"response\"`\n}\n</code></pre>\n\n<p>Because without it XML encoder will produce something like <code>&lt;SomeCommand&gt;&lt;response&gt;...&lt;/response&gt;&lt;/SomeCommand&gt;</code></p></li>\n</ol>\n\n<p><strong>Update with full example</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"encoding/xml\"\n    \"log\"\n)\n\ntype Command interface {\n    IsError() bool\n\n    Request(buf *bufio.Writer, params interface{}) error\n}\n\n// Result of request\ntype CommandResult struct {\n    XMLName xml.Name `xml:\"epp\"`\n    Result  struct {\n        Code    int    `xml:\"code,attr\" json:\"code\"`\n        Message string `xml:\"msg\" json:\"msg\"`\n    } `xml:\"response&gt;result\" json:\"response\"`\n}\n\n// this Command's func is realized by CommandResult\nfunc (self CommandResult) IsError() bool {\n    return true\n}\n\n// some command\ntype SomeCommand struct {\n    CommandResult\n}\n\n// this Command's func is realized by SomeCommand\nfunc (self SomeCommand) Request(buf *bufio.Writer, params interface{}) error {\n    return nil\n}\n\ntype AnotherCommand struct {\n    CommandResult\n}\n\nfunc (self AnotherCommand) Request(buf *bufio.Writer, params interface{}) error {\n    return nil\n}\n\nfunc main() {\n    var c Command\n\n    c = SomeCommand{}\n    log.Println(c.IsError())\n\n    c = AnotherCommand{}\n    log.Println(c.IsError())\n}\n</code></pre>\n"}], "owner": {"reputation": 358, "user_id": 4536186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/nNlUY.png?s=128&g=1", "display_name": "Harlam", "link": "https://stackoverflow.com/users/4536186/harlam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "accepted_answer_id": 35183192, "answer_count": 1, "score": 2, "last_activity_date": 1454579272, "creation_date": 1454507672, "question_id": 35178998, "link": "https://stackoverflow.com/questions/35178998/how-to-parse-xml-correctly", "title": "How to parse xml correctly", "body": "<p>I want to create structs = each type of command. </p>\n\n<p>Commands have common part of xml - CommandResult. I created interface Command. I need to SomeCommand implements Command and can to be parsed as xml, also IsError must be realized in CommandResult, other functions must be realized by SomeCommand.</p>\n\n<p>Code:</p>\n\n<pre><code>type Command interface {\n    IsError() bool\n\n    Request(buf *bufio.Writer, params interface{}) error\n    ...\n}\n\n// Result of request\ntype CommandResult struct {\n    Code    int    `xml:\"code,attr\" json:\"code\"`\n    Message string `xml:\"msg\" json:\"msg\"`\n}\n\n// this Command's func is realized by CommandResult \nfunc (self CommandResult) IsError() bool {\n    return true\n}\n\n\n// some command\ntype SomeCommand struct {\n    CommandResult // CommandResult `xml:\"response&gt;result\" json:\"result\"`\n}\n\n// this Command's func is realized by SomeCommand \nfunc (self SomeCommand) Request(buf *bufio.Writer, params interface{}) error {\n    return nil\n}\n\n// other Command's functions are realized by CommandResult too\n</code></pre>\n\n<p>XML:</p>\n\n<pre><code>&lt;epp&gt;\n  &lt;response&gt;\n    &lt;result code=\"1000\"&gt;\n      &lt;msg&gt;Command completed successfully&lt;/msg&gt;\n    &lt;/result&gt;\n    &lt;trID&gt;\n      &lt;svTRID&gt;asd&lt;/svTRID&gt;\n    &lt;/trID&gt;\n  &lt;/response&gt;\n&lt;/epp&gt;\n</code></pre>\n\n<p>Expected result:</p>\n\n<pre><code>a := SomeCommand\nxml.NewDecoder(reader).Decode(&amp;a)\n// a.CommandResult.Code = 1000\n// a.CommandResult.Message = 'Command completed successfully'\n\n// a implements Command\n</code></pre>\n"}, {"tags": ["go", "go-imagick"], "comments": [{"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "edited": false, "score": 5, "creation_date": 1454510486, "post_id": 35178934, "comment_id": 58076983, "body": "A quick inspection of the imagick API lead me to <a href=\"https://gowalker.org/github.com/gographics/imagick/imagick#MagickWand_GetImageBlob\" rel=\"nofollow noreferrer\">gowalker.org/github.com/gographics/imagick/&hellip;</a> which seems to return an already encoded []byte in the needed format (JPEG, Gif...). Isn&#39;t it what you need ?"}, {"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "reply_to_user": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "edited": false, "score": 0, "creation_date": 1454517356, "post_id": 35178934, "comment_id": 58082216, "body": "@SirDarius Thanks, didn&#39;t notice that."}, {"owner": {"reputation": 82600, "user_id": 496445, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/db00d7b4388686c6d280e8f0578c7e39?s=128&d=identicon&r=PG", "display_name": "jdi", "link": "https://stackoverflow.com/users/496445/jdi"}, "edited": false, "score": 0, "creation_date": 1454529385, "post_id": 35178934, "comment_id": 58089981, "body": "Also, <code>SetImageFormat()</code> can convert the format before you call <code>GetImageBlob()</code>"}], "answers": [{"tags": [], "owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "is_accepted": false, "score": 2, "last_activity_date": 1454517756, "creation_date": 1454517756, "answer_id": 35182787, "question_id": 35178934, "link": "https://stackoverflow.com/questions/35178934/golang-converting-image-magick-object-to-byte/35182787#35182787", "title": "Golang Converting Image magick object to []byte", "body": "<p>You need to use the <code>func (mw *MagickWand) GetImageBlob() []byte</code> function.</p>\n\n<p>It returns a slice of bytes containing a complete encoded image for the current file format (JPEG, gif, PNG...).</p>\n\n<p>The returned data can therefore be saved to disk, or sent to s3 as-is.</p>\n\n<p>See <a href=\"https://gowalker.org/github.com/gographics/imagick/imagick#MagickWand_GetImageBlob\" rel=\"nofollow\">https://gowalker.org/github.com/gographics/imagick/imagick#MagickWand_GetImageBlob</a> for the documentation.</p>\n"}, {"comments": [{"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1454568933, "post_id": 35186712, "comment_id": 58105462, "body": "But here you are not taking use of aspect ratio. I have the requirement like let&#39;s say image is in 16:9 aspect ratio and then i need to convert it in nearest 4:3 aspect ratio. So, how do i it using above method"}, {"owner": {"reputation": 82600, "user_id": 496445, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/db00d7b4388686c6d280e8f0578c7e39?s=128&d=identicon&r=PG", "display_name": "jdi", "link": "https://stackoverflow.com/users/496445/jdi"}, "reply_to_user": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1454569253, "post_id": 35186712, "comment_id": 58105604, "body": "Oh you don&#39;t want a center crop then. You want a fit and pad"}, {"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1454570776, "post_id": 35186712, "comment_id": 58106383, "body": "Currently, I am using <code>mw.CropImage(uint(originalWidth), (uint(originalWidth &#47; masterAspectRatio)), 0, 0)</code>. But it crops the image from origin and keep the width and height as mentioned. So, if let&#39;s say i want to change the aspect ratio from 16:9 to 4:3 then i want to crop the width from both the side and similarly if i want to change the aspect ration from 4:3 to 16:9 then i need to crop the height from both the side to get the image in desired aspect ratio ."}, {"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1454570991, "post_id": 35186712, "comment_id": 58106477, "body": "So, how as i mentioned in the question in the .net it could be done like <code>imgStream.Crop((int)originalWidth, ((int)(originalWidth &#47; masterAspectRatio)), Gravity.Center</code>. Similarly how do i do it in go that is my question"}, {"owner": {"reputation": 82600, "user_id": 496445, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/db00d7b4388686c6d280e8f0578c7e39?s=128&d=identicon&r=PG", "display_name": "jdi", "link": "https://stackoverflow.com/users/496445/jdi"}, "reply_to_user": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1454578884, "post_id": 35186712, "comment_id": 58111131, "body": "Out of curiosity have you even tried my suggestion or did you just look at it and assume it isn&#39;t what you want? because after yout comment, now it does sound like you want a proper center crop, which is what mine does"}, {"owner": {"reputation": 82600, "user_id": 496445, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/db00d7b4388686c6d280e8f0578c7e39?s=128&d=identicon&r=PG", "display_name": "jdi", "link": "https://stackoverflow.com/users/496445/jdi"}, "reply_to_user": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1454579007, "post_id": 35186712, "comment_id": 58111209, "body": "I resize it down to match a smaller target if necessary and then I crop it at the center"}, {"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "reply_to_user": {"reputation": 82600, "user_id": 496445, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/db00d7b4388686c6d280e8f0578c7e39?s=128&d=identicon&r=PG", "display_name": "jdi", "link": "https://stackoverflow.com/users/496445/jdi"}, "edited": false, "score": 0, "creation_date": 1454580093, "post_id": 35186712, "comment_id": 58111970, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/102573/discussion-between-naresh-and-jdi\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 82600, "user_id": 496445, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/db00d7b4388686c6d280e8f0578c7e39?s=128&d=identicon&r=PG", "display_name": "jdi", "link": "https://stackoverflow.com/users/496445/jdi"}, "is_accepted": true, "score": 1, "last_activity_date": 1454530141, "creation_date": 1454530141, "answer_id": 35186712, "question_id": 35178934, "link": "https://stackoverflow.com/questions/35178934/golang-converting-image-magick-object-to-byte/35186712#35186712", "title": "Golang Converting Image magick object to []byte", "body": "<p>This question is actually two questions, and @SirDarius answered one of them, by suggesting the use of <a href=\"https://godoc.org/github.com/gographics/imagick/imagick#MagickWand.GetImageBlob\" rel=\"nofollow\"><code>GetImageBlob()</code></a>. You can also use <a href=\"https://godoc.org/github.com/gographics/imagick/imagick#MagickWand.SetImageFormat\" rel=\"nofollow\"><code>SetImageFormat()</code></a> to change the image format before generating the blob.</p>\n\n<p>For the part about the crop, I am sure there are a bunch of ways to do this with ImageMagick. The way I have done it, to achieve a center crop is to first transform the image so that the smaller dimension fits into my desired target resolution. And then to crop away the parts that overflow.</p>\n\n<pre><code>// Create a new image where smallest dimension is fit\n// and the rest overflows the dimensions\nsize := fmt.Sprintf(\"%dx%d^+0+0\", w, h)\ntx := wand.TransformImage(\"\", size)\n\n// Center Crop away the extra parts of the image, to perform\ntx.SetImageGravity(imagick.GRAVITY_CENTER)\noffsetX := -(int(w) - int(tx.GetImageWidth())) / 2\noffsetY := -(int(h) - int(tx.GetImageHeight())) / 2\nerr := tx.ExtentImage(w, h, offsetX, offsetY)\n...\n</code></pre>\n"}], "owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2037, "favorite_count": 2, "accepted_answer_id": 35186712, "answer_count": 2, "score": 0, "last_activity_date": 1454530141, "creation_date": 1454507491, "last_edit_date": 1454516513, "question_id": 35178934, "link": "https://stackoverflow.com/questions/35178934/golang-converting-image-magick-object-to-byte", "title": "Golang Converting Image magick object to []byte", "body": "<p>I am using the following code which fetch the object from Amazon s3 and after performing resizing and cropping. I want to store it on s3. But the problem is i am not able convert the <code>mw (Image maigck object)</code> to byte array. Which will be used for storing it on s3. Moreover in current method it uses jpeg.Encode. What if the image in .png or .gif format. How will we convert it to []byte?  </p>\n\n<p>Could you please also tell me how to evenly crop an image just passing the aspect ratio not cropping coordinates. <code>imgStream.Crop((int)originalWidth, ((int)(originalWidth / masterAspectRatio)), Gravity.Center)</code> like we do it in .net. Reason i am asking is there is no method in library which provides this flexibility. </p>\n\n<pre><code>s3Client := s3.New(session.New(), &amp;aws.Config{Region: aws.String(region)})\n            params := &amp;s3.GetObjectInput{\n            Bucket: aws.String(bucketName),\n            Key: aws.String(keyName),\n            }\n\n        out, err := s3Client.GetObject(params)\n\n        if err != nil {\n             log.Fatal(err)\n        }\n\n        img, err := ioutil.ReadAll(out.Body)\n        if err != nil {\n            log.Fatal(err)\n        }      \n\n        mw := imagick.NewMagickWand()   \n\n        err = mw.ReadImageBlob(img)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        //Perform resizing and cropping on mw object\n\n        buf := new(bytes.Buffer)\n        err = jpeg.Encode(buf, mw, nil)\n        sendmw_s3 := buf.Bytes()\n\n         paramsPut := &amp;s3.PutObjectInput{\n                        Bucket:         aws.String(masterBucketName),\n                        Key:            aws.String(keyName),\n                        Body:         bytes.NewReader(sendmw_s3),\n                }\n\n        resp, err := s3Client.PutObject(paramsPut)\n        if err != nil {\n            log.Fatal(err)\n        }\n</code></pre>\n\n<p>Error : </p>\n\n<pre><code> cannot use mw (type *imagick.MagickWand) as type image.Image in argument to jpeg.Encode:\n    *imagick.MagickWand does not implement image.Image (missing At method)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1454500288, "post_id": 35175107, "comment_id": 58069562, "body": "Order the fields alphabetical before calculating the hash."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 1, "creation_date": 1454500595, "post_id": 35175107, "comment_id": 58069778, "body": "@TheHippo You can&#39;t. A map never guarantees to preserve order, even after a sort operation. You need a slice or array, which guarantees preservation of order, sort it and access the map via these sorted keys. See below."}, {"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1454500684, "post_id": 35175107, "comment_id": 58069852, "body": "@MarkusWMahlberg I never explicitly said to order the map. ;-)"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 1, "creation_date": 1454501246, "post_id": 35175107, "comment_id": 58070195, "body": "@TheHippo Just wanted to make sure nobody falls into the sorted map trap."}], "answers": [{"comments": [{"owner": {"reputation": 2337, "user_id": 1192134, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/425e8d7681582a05884d498eb9fec507?s=128&d=identicon&r=PG", "display_name": "Roy van Zanten", "link": "https://stackoverflow.com/users/1192134/roy-van-zanten"}, "edited": false, "score": 0, "creation_date": 1454508698, "post_id": 35176337, "comment_id": 58075571, "body": "The request of the user isnt sorted. And what you do here is sorting the map using Sort. Its just the particular order the user submits there fields is what i would like to preserve."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 2337, "user_id": 1192134, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/425e8d7681582a05884d498eb9fec507?s=128&d=identicon&r=PG", "display_name": "Roy van Zanten", "link": "https://stackoverflow.com/users/1192134/roy-van-zanten"}, "edited": false, "score": 0, "creation_date": 1454512047, "post_id": 35176337, "comment_id": 58078105, "body": "@RoyvanZanten What you described was that you wanted the fields in a <i>specific</i> order to be able to create a hash sum. And read the code closely: That&#39;s exactly what it does. A request is sent as one, there is no order of fields not should you rely on it. If you need an order, you need to apply one."}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1454500453, "creation_date": 1454500453, "answer_id": 35176337, "question_id": 35175107, "link": "https://stackoverflow.com/questions/35175107/r-parseform-field-order/35176337#35176337", "title": "r.ParseForm field order", "body": "<p><strong>tl;dr</strong>: You can't implicitly. The <a href=\"https://golang.org/src/net/url/url.go?s=18971:19022#L651\" rel=\"nofollow\">underlying data structure is a map</a>, for which the order is not guaranteed. You need to take additional steps.</p>\n\n<p>However <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow\">Go maps in action</a> shows an easy way to access the map in a sorted way. You create a slice of the keys, sort that slice and access the map value by iterating over the keys in the sorted slice.</p>\n\n<p>For your example, it would look something like this</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/md5\"\n    \"fmt\"\n    \"io\"\n    \"sort\"\n)\n\nfunc main() {\n    // Which is the same structure as url.Values()\n    var m map[string][]string = make(map[string][]string)\n    m[\"c\"] = []string{\"19.95\"}\n    m[\"b\"] = []string{\"foo\", \"bar\", \"baz\"}\n    m[\"a\"] = []string{\"1\"}\n\n    // Note that playground is deterministic, so the order should be preserved there\n    // However, you can not rely on that in the real world\n    fmt.Println(\"Unsorted\")\n    for k, v := range m {\n        fmt.Println(\"Key:\", k, \"Value:\", v)\n    }\n\n    var keys []string\n    for k := range m {\n        keys = append(keys, k)\n    }\n    sort.Strings(keys)\n\n    hash := md5.New()\n    fmt.Println(\"\\nSorted\")\n    for _, k := range keys {\n\n        fmt.Println(\"Key:\", k, \"Value:\", m[k])\n\n        // Add Key/Value pair to hash\n        fmt.Printf(\"\\tAdding KEY '%s' to hash\\n\", k)\n        io.WriteString(hash, k)\n        for _, v := range m[k] {\n            fmt.Printf(\"\\tAdding VALUE '%s' to hash\\n\", v)\n            io.WriteString(hash, v)\n        }\n    }\n    fmt.Printf(\"\\nHash: %x\", hash.Sum(nil))\n}\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/82vMst0Tnl\" rel=\"nofollow\">Run above code on Playground</a></kbd></p>\n"}, {"tags": [], "owner": {"reputation": 200, "user_id": 2520654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8d427c521de710be9699674208b28ddc?s=128&d=identicon&r=PG", "display_name": "Shalin LK", "link": "https://stackoverflow.com/users/2520654/shalin-lk"}, "is_accepted": false, "score": 0, "last_activity_date": 1454502141, "creation_date": 1454502141, "answer_id": 35176977, "question_id": 35175107, "link": "https://stackoverflow.com/questions/35175107/r-parseform-field-order/35176977#35176977", "title": "r.ParseForm field order", "body": "<p>You can read the request body and check for the form parameters. They will appear in the same order as in the request(hope your client application is also aware of this order preserving)</p>\n\n<p>You can create a reader for reading the request body. A <strong>sample</strong> code looks like</p>\n\n<pre><code>body, err := ioutil.ReadAll(r.Body)\nif err != nil {\n    fmt.Println(\"Reading Error \")\n    return \n}\nfmt.Println(\"Req Body  :  \", string(body))\n</code></pre>\n\n<p>Note : Be aware of the content type</p>\n"}, {"comments": [{"owner": {"reputation": 2337, "user_id": 1192134, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/425e8d7681582a05884d498eb9fec507?s=128&d=identicon&r=PG", "display_name": "Roy van Zanten", "link": "https://stackoverflow.com/users/1192134/roy-van-zanten"}, "edited": false, "score": 0, "creation_date": 1454508776, "post_id": 35178540, "comment_id": 58075612, "body": "Hmm okay. Thats true. Ill see what i can do to get this working."}], "tags": [], "owner": {"reputation": 373, "user_id": 745933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356a3a553d3d1a5a3f5b4f9cbce48f83?s=128&d=identicon&r=PG", "display_name": "GerritS", "link": "https://stackoverflow.com/users/745933/gerrits"}, "is_accepted": true, "score": 1, "last_activity_date": 1454506410, "creation_date": 1454506410, "answer_id": 35178540, "question_id": 35175107, "link": "https://stackoverflow.com/questions/35175107/r-parseform-field-order/35178540#35178540", "title": "r.ParseForm field order", "body": "<p>In the same area as other answers, you will need the clients to calculate their hash by alphabetizing all parameters before hashing. The code you've supplied should work fine; <code>values.Encode()</code> will <a href=\"https://golang.org/pkg/net/url/#Values.Encode\" rel=\"nofollow\">sort the values by key</a> on it's own:</p>\n\n<blockquote>\n  <p>Encode encodes the values into \u201cURL encoded\u201d form (\"bar=baz&amp;foo=quux\") <strong>sorted by key</strong>.</p>\n</blockquote>\n\n<p>There's no way to preserve the ordering of the client; in fact, what you receive may not even be how it was ordered on the client end. However unlikely, there's no guarantee that intermediate processes won't change things.</p>\n"}], "owner": {"reputation": 2337, "user_id": 1192134, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/425e8d7681582a05884d498eb9fec507?s=128&d=identicon&r=PG", "display_name": "Roy van Zanten", "link": "https://stackoverflow.com/users/1192134/roy-van-zanten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "accepted_answer_id": 35178540, "answer_count": 3, "score": 0, "last_activity_date": 1454506410, "creation_date": 1454496970, "last_edit_date": 1454499009, "question_id": 35175107, "link": "https://stackoverflow.com/questions/35175107/r-parseform-field-order", "title": "r.ParseForm field order", "body": "<p>So I would like to preserve the order of the post fields.\nBut now using the http <code>ParseForm</code> function it will put the fields into a map which will have a different order each time.</p>\n\n<p>The original query : <code>a=1&amp;b=2&amp;c=3</code> can become <code>b=2&amp;c=3&amp;a=1</code> or any random order.</p>\n\n<p>Since I hash the query and compare it with the hash of the user his query the hash on my side changes all the time since the order of the fields are random. </p>\n\n<p>Code:</p>\n\n<pre><code>func parsePostQuery(r *http.Request, hashQuery string) bool {\n    urlquery := url.Values{}\n\n    r.ParseForm()\n\n    for k, p := range r.Form {\n        urlquery.Set(k, p[0])\n    }\n\n    //some psuedo code\n    if hashQuery == hash(urlquery.Encode()){\n        return true\n    }\n\n    return false\n}\n</code></pre>\n\n<p>How can I parse the fields that are submitted by the user and keep the field order of the user?</p>\n\n<p>Sidenote: I do not know the field names in advance.</p>\n"}, {"tags": ["go", "multipartform-data"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454507676, "post_id": 35176396, "comment_id": 58074832, "body": "a <code>LimitReader</code> will essentially show the same condition, since most clients (browsers) don&#39;t stop sending data to check the response, so the connection will have to be forcefully closed anyway."}], "tags": [], "owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "is_accepted": false, "score": 4, "last_activity_date": 1454500603, "creation_date": 1454500603, "answer_id": 35176396, "question_id": 35173819, "link": "https://stackoverflow.com/questions/35173819/request-body-too-large-causing-connection-reset-in-go/35176396#35176396", "title": "Request body too large causing connection reset in Go", "body": "<p>This code works as intended. Description of <code>http.MaxBytesReader</code></p>\n\n<blockquote>\n  <p>MaxBytesReader is similar to io.LimitReader but is intended for\n  limiting the size of incoming request bodies. In contrast to\n  io.LimitReader, MaxBytesReader's result is a ReadCloser, returns a\n  non-EOF error for a Read beyond the limit, and closes the underlying\n  reader when its Close method is called.</p>\n  \n  <p>MaxBytesReader prevents clients from accidentally or maliciously\n  sending a large request and wasting server resources.</p>\n</blockquote>\n\n<p>You could use <a href=\"https://golang.org/pkg/io/#LimitReader\"><code>io.LimitReader</code></a> to read just N bytes and then do the handling of the HTTP request on your own.</p>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 3, "last_activity_date": 1454510591, "last_edit_date": 1454510591, "creation_date": 1454506850, "answer_id": 35178703, "question_id": 35173819, "link": "https://stackoverflow.com/questions/35173819/request-body-too-large-causing-connection-reset-in-go/35178703#35178703", "title": "Request body too large causing connection reset in Go", "body": "<p>The only way to force a client to stop sending data is to forcefully close the connection, which is what you're doing with <a href=\"https://golang.org/pkg/net/http/#MaxBytesReader\" rel=\"nofollow\"><code>http.MaxBytesReader</code></a>. </p>\n\n<p>You could use a <a href=\"https://golang.org/pkg/io/#LimitReader\" rel=\"nofollow\"><code>io.LimitReader</code></a> wrapped in a <a href=\"https://golang.org/pkg/io/ioutil/#NopCloser\" rel=\"nofollow\"><code>ioutil.NopCloser</code></a>, and notify the client of the error state. You could then check for more data, and try and drain the connection up to another limit to keep it open.  However, clients that aren't responding correctly to <code>MaxBytesReader</code> may not work in this case either. </p>\n\n<p>The graceful way to handle something like this is using <code>Expect: 100-continue</code>, but that only really applies to clients other than web browsers.</p>\n"}], "owner": {"reputation": 1414, "user_id": 822779, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/aJm0V.jpg?s=128&g=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/822779/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1339, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1454510591, "creation_date": 1454493717, "question_id": 35173819, "link": "https://stackoverflow.com/questions/35173819/request-body-too-large-causing-connection-reset-in-go", "title": "Request body too large causing connection reset in Go", "body": "<p>I have a simple multipart form which uploads to a Go app. I wanted to set a restriction on the upload size, so I did the following:</p>\n\n<pre><code>func myHandler(rw http.ResponseWriter, request *http.Request){  \n    request.Body = http.MaxBytesReader(rw, request.Body, 1024)\n    err := request.ParseMultipartForm(1024)\n    if err != nil{\n    // Some response.\n    } \n}  \n</code></pre>\n\n<p>Whenever an upload exceeds the maximum size, I get a connection reset like the following:\n<a href=\"https://i.stack.imgur.com/ewWMg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ewWMg.png\" alt=\"enter image description here\"></a></p>\n\n<p>and yet the code continues executing. I can't seem to provide any feedback to the user. Instead of severing the connection I'd prefer to say \"You've exceeded the size limit\". Is this possible?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 5714642, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-OuEqbhklsiQ/AAAAAAAAAAI/AAAAAAAAABQ/shZ76dy2rd4/photo.jpg?sz=128", "display_name": "Xie Jinke", "link": "https://stackoverflow.com/users/5714642/xie-jinke"}, "edited": false, "score": 0, "creation_date": 1454551138, "post_id": 35174263, "comment_id": 58099538, "body": ",Thanks for detailed explanation.But I notice some strange thing. When I update the credit5 to the value less than 1000000,e.g 999999,the error won&#39;t comes out. The column credit5 type is double(11,3) NOT NULL DEFAULT &#39;0.000&#39;.Seems golang has it&#39;s special way parse float  to int ?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 113, "user_id": 5714642, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-OuEqbhklsiQ/AAAAAAAAAAI/AAAAAAAAABQ/shZ76dy2rd4/photo.jpg?sz=128", "display_name": "Xie Jinke", "link": "https://stackoverflow.com/users/5714642/xie-jinke"}, "edited": false, "score": 0, "creation_date": 1454551884, "post_id": 35174263, "comment_id": 58099701, "body": "I&#39;d guess it is the driver. But I honestly don&#39;t know why it gets parsed."}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 1, "last_activity_date": 1454494817, "creation_date": 1454494817, "answer_id": 35174263, "question_id": 35173233, "link": "https://stackoverflow.com/questions/35173233/scan-error-on-column-index-converting-string-to-a-int/35174263#35174263", "title": "Scan error on column index converting string to a int", "body": "<p>Exponent notations can not be parsed easily, since the value denoted by the string may well exceed anything a 64bit integer can hold, e.g \"2.00+e1024\". Furthermore, if you look closely, the string does <em>not</em> represent an integer. The <em>point</em> clearly denotes a floating <em>point</em> number.</p>\n\n<p>So, you have to take some additional steps (<kbd><a href=\"http://play.golang.org/p/skGaaNJzTc\" rel=\"nofollow\">Run on Playground</a></kbd>)</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strconv\"\nimport \"math/big\"\n\nfunc main() {\n\n    in := \"1.461988e+06\"\n    fmt.Printf(\"Input:\\t\\t%v\\t(Type: %[1]T)\\n\",in)\n\n    // The value denoted by in is NOT an integer\n    // It is a float with an exponent notation\n    // It can not be directly parsed since with exponent notation\n    // the integer value represented by in may well exceed anything\n    // one of the int types can hold\n    if e,err := strconv.ParseFloat(\"1.461988e+06\",10); err != nil {\n        fmt.Printf(\"%v\\n\",err)\n    } else {\n        fmt.Printf(\"Parsed:\\t\\t%#v\\t(Type:%[1]T)\\n\",e)\n\n        // Hence, we have to use the \"big\" package\n        // And use it's facilities to retrieve the integer\n        b := big.NewFloat(e)\n        v,p := b.Int64()\n        fmt.Printf(\"Integer:\\t%v\\t\\t(Type:%[1]T,Precision: %v)\",v,p)\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 5714642, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-OuEqbhklsiQ/AAAAAAAAAAI/AAAAAAAAABQ/shZ76dy2rd4/photo.jpg?sz=128", "display_name": "Xie Jinke", "link": "https://stackoverflow.com/users/5714642/xie-jinke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2031, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1454494817, "creation_date": 1454492177, "question_id": 35173233, "link": "https://stackoverflow.com/questions/35173233/scan-error-on-column-index-converting-string-to-a-int", "title": "Scan error on column index converting string to a int", "body": "<p>I use go-sql-driver, but when I run the code .</p>\n\n<p>Errors comes with: \nsql: Scan error on column index 7: <em>converting string \"1.461988e+06\" to a int: strconv.ParseInt: parsing</em> \"1.461988e+06\": invalid syntax , </p>\n\n<p>Ooops ! what's the problem ? Int type can not assigned a value more than 1461988 ?</p>\n\n<pre><code>qs := `SELECT stepdistance,(CASE WHEN stepnumber&gt;=10000 THEN 1 ELSE 0 END),stepnumber,credit1,credit2,credit3,credit4,credit5,credit6,credit7,credit8,stepdaypass,timestamp,walkdate FROM wanbu_stat_activeuser_day_v1_n0 WHERE  activeid=?  AND userid=? AND  walkdate&gt;=? AND walkdate&lt;=? ORDER BY walkdate`\nrows, err := db.Query(qs, arg.Aid, uid, start, end)\nif err != nil {\n    fmt.Println(\"49\", err)\n    return err\n}\ndefer rows.Close()\nvar tmp Userdaytotalstat_s = Userdaytotalstat_s{}\nvar udts Userdaytotalstat_s = Userdaytotalstat_s{}\nvar snap Userdaytotalstat_s\nvar ifarrive = false\n\nfor rows.Next() {\n\n    err := rows.Scan(&amp;udts.Stepdistance, &amp;udts.Stepdaywanbu, &amp;udts.Stepnumber,&amp;udts.Credit1, &amp;udts.Credit2, &amp;udts.Credit3, &amp;udts.Credit4, &amp;udts.Credit5, &amp;udts.Credit6,&amp;udts.Credit7, &amp;udts.Credit8, &amp;udts.Stepdaypass, &amp;udts.Timestamp, &amp;udts.Walkdate)\n\n    if err != nil {\n\n        fmt.Println(\"68\", err)\n        fmt.Println(qs, arg.Aid, uid, start, end)\n\n        return err\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1454515099, "post_id": 35171293, "comment_id": 58080433, "body": "the image tag itself is 404&#39;d?  or the whole page?  You also don&#39;t show where where Photo comes from. I assume it&#39;s an attribute of your viewmodel?  Is it a url?  what&#39;s the value of .Photo?"}, {"owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1454515383, "post_id": 35171293, "comment_id": 58080676, "body": "@David Budworth Page is loading. Image shows as broken image link. The image link is coming from the DB. When I take tdate image li"}, {"owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1454515598, "post_id": 35171293, "comment_id": 58080834, "body": "(Sorry accidentally tapped on post button..) when I take take inspect element image link is present there. But when I try to open the link it is giving me a 404. The link is stored in the DB at the time of image upload. I will add the code ASAP."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1454516113, "post_id": 35171293, "comment_id": 58081195, "body": "and you are running you app from whatever the part dir of frontend is?"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1454516178, "post_id": 35171293, "comment_id": 58081247, "body": "also, just noticed.  you create a mux.NewRouter but never pass it to listen and serve.  you are currently mixing gorilla and stdlib http muxes"}, {"owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1454516612, "post_id": 35171293, "comment_id": 58081614, "body": "@David Budworth My main function is in root just where the dir frontend is. Can you please explain me how to pass mux to listener"}], "answers": [{"comments": [{"owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "edited": false, "score": 0, "creation_date": 1454567607, "post_id": 35185561, "comment_id": 58104836, "body": "Thanks man. I had changed the code as you instructed. But the image problem is still there. Edited the question with the new code and value of {{.Photo}}"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "edited": false, "score": 0, "creation_date": 1454597115, "post_id": 35185561, "comment_id": 58123570, "body": "And when you start your app, your shell is sitting in the parent directory of <code>.&#47;frontend&#47;images&#47;</code>?  What is the photo url (img tag source)?"}, {"owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "edited": false, "score": 0, "creation_date": 1454597957, "post_id": 35185561, "comment_id": 58124214, "body": "My photo path is stored in the DB. {{.Photo}} is meant to populate different images into a list. When I login to the list page it is supposed to show different photos which were previously uploaded. I managed to pass different paths in my db which were inserted at the time of photo upload. Hoping this is what you asked."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "edited": false, "score": 0, "creation_date": 1454598126, "post_id": 35185561, "comment_id": 58124338, "body": "i mean, literally, what directory are you in when you run your app.  when you tell fileserver ./frontend/images, that means &quot;from where i was when I ran my app&quot;, not &quot;relative to my source code&quot;.  And I was asking for an exact example of a url (without hostname)... le: /images/foo.png.  The next step was to ask if you could (from your bash or cmd prompt) type ls (or dir) ./frontend/images/foo.png  and find it.   because, if not, you will get a 404"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 1, "last_activity_date": 1454526421, "creation_date": 1454526421, "answer_id": 35185561, "question_id": 35171293, "link": "https://stackoverflow.com/questions/35171293/gorilla-mux-image-not-displaying/35185561#35185561", "title": "Gorilla/mux: Image not displaying", "body": "<p>You are mixing two routers here.</p>\n\n<p>First off, the http package has a package global default handler called: <a href=\"https://golang.org/pkg/net/http/#pkg-variables\" rel=\"nofollow\">DefaultServeMux</a>.  This is an instance of <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow\">http.ServeMux</a></p>\n\n<p>When you call <a href=\"https://golang.org/pkg/net/http/#HandleFunc\" rel=\"nofollow\">http.HandleFunc</a>, DefaultServeMux is where that handler gets registered (<a href=\"https://golang.org/src/net/http/server.go?s=51688:51759#L1745\" rel=\"nofollow\">source</a>)</p>\n\n<p>When you call <a href=\"https://golang.org/pkg/net/http/#ListenAndServe\" rel=\"nofollow\">http.ListenAndServe</a>, the second parameter is what handler to use for HTTP requests that come in on your specified port.</p>\n\n<p>If you pass nil as the handler (like you do in your code), you are telling the http server to use http.DefaultServeMux</p>\n\n<p><a href=\"http://www.gorillatoolkit.org/pkg/mux\" rel=\"nofollow\">Gorilla mux</a> is an alternative to http.ServeMux.  In general, you use one or the other.</p>\n\n<p>In your case, you are registering your file server with a gorilla mux, but then telling http.ListenAndServe to use http.DefaultServeMux (by omitting the handler).</p>\n\n<p>You can either register your file serve with the standard http library's default mux (via: <a href=\"https://golang.org/pkg/net/http/#Handle\" rel=\"nofollow\">http.Handle</a>) or change your function mappings to register with your Gorilla mux (via: <a href=\"http://www.gorillatoolkit.org/pkg/mux#Route.HandlerFunc\" rel=\"nofollow\">r.HandlerFunc</a>).</p>\n\n<p>If you choose to use Gorilla (more flexible solution, but is not really necessary given your example code), then pass that instead of nil to ListenAndServe.</p>\n"}], "owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 0, "accepted_answer_id": 35185561, "answer_count": 1, "score": 0, "last_activity_date": 1454567401, "creation_date": 1454485841, "last_edit_date": 1454567401, "question_id": 35171293, "link": "https://stackoverflow.com/questions/35171293/gorilla-mux-image-not-displaying", "title": "Gorilla/mux: Image not displaying", "body": "<p>I am new in Golang. I need display an image. I tried using Gorilla/mux.\nBut I am still getting Error:404. I thing may be the place where I used mux code is not correct.</p>\n\n<p>Main func</p>\n\n<pre><code>    package main\n    import (\n        \"net/http\"\n        \"mytestsite/handlers\"\n         \"log\"\n         \"github.com/gorilla/mux\"\n     )\n\n\n    func main() {\n\n    r := mux.NewRouter()\n    r.HandleFunc(\"/register\", handlers.RegisterHandler)\n    r.HandleFunc(\"/sucess\", handlers.Sucess)\n    r.HandleFunc(\"/login\", handlers.Login)\n    r.HandleFunc(\"/list\", handlers.ViewList)\n    r.HandleFunc(\"/logout\", handlers.Logout)\n    r.HandleFunc(\"/edit\", handlers.Edit)\n    r.HandleFunc(\"/EditnList\", handlers.EditnList)\n    r.HandleFunc(\"/notvalid\", handlers.NotValid)\n    r.HandleFunc(\"/delete\", handlers.Delete)\n    r.HandleFunc(\"/listchoose\", handlers.ListChoose)\n    r.HandleFunc(\"/email\", handlers.SendEmail)\n    images := http.StripPrefix(\"/images/\", http.FileServer(http.Dir(\"./frontend/images/\")))\n    r.PathPrefix(\"/images/\").Handler(images)\n\n    if err := http.ListenAndServe(\":8181\", r); err != nil {\n        log.Fatal(\"http.ListenAndServe: \", err)\n    }        \n}\n</code></pre>\n\n<p>Func which pass data to html</p>\n\n<pre><code>func ViewList(w http.ResponseWriter, r *http.Request) {\n    viewModel:=viewmodels.RegisterViewModel{}\n    user:=models.User{}\n    dbResults := user.ViewDB() \n\n    //Cookies below\n    cookieCheck := getCookie(r)\n\n    if (cookieCheck != \"\"){\n        err:=GetTemplate(\"list\").Execute(w,dbResults)\n        if err!=nil{\n            panic(err)\n        }\n    } else { \n        viewModel.ErrorMessage=\"Please Enter Email Id and Password..\"\n        err:=GetTemplate(\"login\").Execute(w,viewModel)\n        if err!=nil{\n            panic(err)\n        }\n    }\n}\n</code></pre>\n\n<p>Usage in html file</p>\n\n<pre><code>&lt;td&gt;&lt;img src=\"{{.Photo}}\" alt=\"{{.Photo}}\" style=\"width:50px;height:50px;\"/&gt;&lt;/td&gt;\n</code></pre>\n\n<p>Value of {{.Photo}} is stored to Db by following code:</p>\n\n<pre><code>ctime := time.Now()\nuploadedfile := \"frontend/images\"+ctime.Format(\"20060102150405\")+\".jpg\"\nout, err := os.Create(uploadedfile)\n</code></pre>\n\n<p>SO value of {{.Photo}} will be like as follows</p>\n\n<pre><code>frontend/images/20160202171411.jpg\n</code></pre>\n"}, {"tags": ["go", "imagick", "go-imagick"], "answers": [{"comments": [{"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1454494719, "post_id": 35169895, "comment_id": 58065722, "body": "Could you please also tell me how to evenly crop an image just passing the aspect ratio not cropping coordinates.  <code>imgStream.Crop((int)originalWidth, ((int)(originalWidth &#47; masterAspectRatio)), Gravity.Center)</code> like we do it in .net"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1454512664, "post_id": 35169895, "comment_id": 58078567, "body": "@Naresh I&#39;m not sure, I&#39;ve never used it before."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 2, "last_activity_date": 1454480579, "creation_date": 1454480579, "answer_id": 35169895, "question_id": 35169590, "link": "https://stackoverflow.com/questions/35169590/create-a-function-with-return-type-of-image-magick-object-in-go-lang/35169895#35169895", "title": "Create a function with return type of image magick object in go lang", "body": "<p>Well, <a href=\"https://github.com/gographics/imagick/blob/943dd0909306f8bea46cc7f855de8ae6790730d4/imagick/magick_wand.go#L25\" rel=\"nofollow\"><code>NewMagickWand()</code></a> returns a <code>*MagickWand</code>, so you can create your function like:</p>\n\n<pre><code>func ObjImagick(bktName string, kName string, region string) *imagick.MagickWand {\n    .......................\n    mw := imagick.NewMagickWand()\n    // defer mw.Destroy() this destroys the wand when ObjMagick returns.\n    // so you can't do this here, your func caller needs to handle destroying the object.\n\n    err = mw.ReadImageBlob(img)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return mw\n}\n</code></pre>\n\n<p>Then the caller has to call <code>.Destroy()</code>, for example:</p>\n\n<pre><code>func main() {\n    mw := ObjImagick(bucketName, keyName, region)\n    defer mw.Destroy()\n}\n</code></pre>\n"}], "owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 1, "accepted_answer_id": 35169895, "answer_count": 1, "score": 0, "last_activity_date": 1454480579, "creation_date": 1454479324, "question_id": 35169590, "link": "https://stackoverflow.com/questions/35169590/create-a-function-with-return-type-of-image-magick-object-in-go-lang", "title": "Create a function with return type of image magick object in go lang", "body": "<p>I want to create image magick object corresponding to images stroed in S3. So, i was writing a function which will take necessary arguments and return the image magick object. But, no luck with it. This is the <a href=\"https://github.com/gographics/imagick\" rel=\"nofollow\">Imagick Library</a> which i am using.</p>\n\n<pre><code>     func main() {\n        mw := imagick.NewMagickWand()\n        defer mw.Destroy()\n        mw = ObjImagick(bucketName, keyName, region)\n    }\n\n\n\n  func ObjImagick(bktName string, kName string, region string) ( ) {\n\n    s3Client := s3.New(session.New(), &amp;aws.Config{Region: aws.String(region)})\n        params := &amp;s3.GetObjectInput{\n        Bucket: aws.String(bktName),\n        Key: aws.String(kName),\n        }\n\n    out, err := s3Client.GetObject(params)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    img, err := ioutil.ReadAll(out.Body)\n    if err != nil {\n        log.Fatal(err)\n    }      \n\n    mw := imagick.NewMagickWand()\n    defer mw.Destroy()\n\n    err = mw.ReadImageBlob(img)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n       return mw\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1454474335, "post_id": 35168558, "comment_id": 58055332, "body": "did you run <code>go get -u github.com&#47;golang&#47;lint&#47;golint</code>?"}, {"owner": {"reputation": 152, "user_id": 1657083, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KD4f8.jpg?s=128&g=1", "display_name": "RadekSohlich", "link": "https://stackoverflow.com/users/1657083/radeksohlich"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1454474588, "post_id": 35168558, "comment_id": 58055418, "body": "Yes.I&#39;ve also tried to update all packages in my GOPATH by <code>go get -u all</code>, but it was a blind shot and did not work."}, {"owner": {"reputation": 457, "user_id": 957936, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/2656eba8a324b297f94ed97c9806e15a?s=128&d=identicon&r=PG", "display_name": "Caleb Spare", "link": "https://stackoverflow.com/users/957936/caleb-spare"}, "edited": false, "score": 4, "creation_date": 1454478431, "post_id": 35168558, "comment_id": 58056642, "body": "How did you install Go 1.6? Also, can you include the output of <code>which go</code>?"}, {"owner": {"reputation": 152, "user_id": 1657083, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KD4f8.jpg?s=128&g=1", "display_name": "RadekSohlich", "link": "https://stackoverflow.com/users/1657083/radeksohlich"}, "edited": false, "score": 0, "creation_date": 1454481434, "post_id": 35168558, "comment_id": 58057952, "body": "Just unpacked the binary and changed GOROOT.  This happend to me for go 1.6. If I changed back to 1.5.3 everything works ok."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1454511174, "post_id": 35168558, "comment_id": 58077490, "body": "but are you sure you&#39;re running <code>$GOROOT&#47;bin&#47;go</code> and not an older version?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1454515326, "post_id": 35168558, "comment_id": 58080633, "body": "If you are running the correct binary, with the correct env variables, it&#39;s possible you have a /vendor directory caught in there. You can try building with go1.5.3 and <code>GO15VENDOREXPERIMENT=1</code> set and see if you have the same error."}, {"owner": {"reputation": 152, "user_id": 1657083, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KD4f8.jpg?s=128&g=1", "display_name": "RadekSohlich", "link": "https://stackoverflow.com/users/1657083/radeksohlich"}, "edited": false, "score": 1, "creation_date": 1454516563, "post_id": 35168558, "comment_id": 58081565, "body": "Thanks guys, seems that I did not update the PATH variable to go binaries. Well I feel pretty lame now. Reboot worked, since the terminal loaded the env variables from scratch."}], "answers": [{"comments": [{"owner": {"reputation": 9858, "user_id": 973380, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/b760f503c84d1bf47322f401066c753f?s=128&d=identicon&r=PG", "display_name": "fiatjaf", "link": "https://stackoverflow.com/users/973380/fiatjaf"}, "edited": false, "score": 2, "creation_date": 1474898084, "post_id": 35169756, "comment_id": 66707671, "body": "This doesn&#39;t seem to be a specific answer to the question. If it is and I can&#39;t understand why, then I guess you should explain the relation better."}, {"owner": {"reputation": 208, "user_id": 4123716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcb43fc8e331b08706c439643b56e390?s=128&d=identicon&r=PG", "display_name": "Dustin", "link": "https://stackoverflow.com/users/4123716/dustin"}, "reply_to_user": {"reputation": 9858, "user_id": 973380, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/b760f503c84d1bf47322f401066c753f?s=128&d=identicon&r=PG", "display_name": "fiatjaf", "link": "https://stackoverflow.com/users/973380/fiatjaf"}, "edited": false, "score": 0, "creation_date": 1475346970, "post_id": 35169756, "comment_id": 66911729, "body": "This happened quite awhile ago so I can&#39;t remember the details. That being said, I believe if your PATH (or other go vars) point to a different Go version, then the imports get confused at build time and leads to the cycles. Setting the env variables properly avoids the issue."}, {"owner": {"reputation": 9858, "user_id": 973380, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/b760f503c84d1bf47322f401066c753f?s=128&d=identicon&r=PG", "display_name": "fiatjaf", "link": "https://stackoverflow.com/users/973380/fiatjaf"}, "edited": false, "score": 0, "creation_date": 1475359821, "post_id": 35169756, "comment_id": 66915140, "body": "In my case the problem was something much less complicated: a package was importing itself."}, {"owner": {"reputation": 208, "user_id": 4123716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcb43fc8e331b08706c439643b56e390?s=128&d=identicon&r=PG", "display_name": "Dustin", "link": "https://stackoverflow.com/users/4123716/dustin"}, "reply_to_user": {"reputation": 9858, "user_id": 973380, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/b760f503c84d1bf47322f401066c753f?s=128&d=identicon&r=PG", "display_name": "fiatjaf", "link": "https://stackoverflow.com/users/973380/fiatjaf"}, "edited": false, "score": 0, "creation_date": 1475548984, "post_id": 35169756, "comment_id": 66976222, "body": "Yes, that&#39;s what the error message describes. But that is not what was wrong in this particular case. Usually when you see that error, you have an import cycle, however in this particular question&#39;s case it was an environment variable misconfiguration."}], "tags": [], "owner": {"reputation": 208, "user_id": 4123716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcb43fc8e331b08706c439643b56e390?s=128&d=identicon&r=PG", "display_name": "Dustin", "link": "https://stackoverflow.com/users/4123716/dustin"}, "is_accepted": true, "score": 3, "last_activity_date": 1454479981, "creation_date": 1454479981, "answer_id": 35169756, "question_id": 35168558, "link": "https://stackoverflow.com/questions/35168558/go-1-5-to-1-6-import-cycle-not-allowed/35169756#35169756", "title": "Go 1.5 to 1.6: import cycle not allowed", "body": "<p>I had this happen to me the other day. It had something to do with my environment variables being setup wrong.</p>\n\n<p>do <code>go version</code> and check that you are building with the expected go distribution.</p>\n\n<p>If it's not the version you were expecting, make sure you update your <code>$GOROOT</code> and or <code>$GOPATH</code> variables to the correct settings.</p>\n\n<p><a href=\"https://golang.org/doc/install\" rel=\"nofollow\">https://golang.org/doc/install</a></p>\n"}, {"comments": [{"owner": {"reputation": 152, "user_id": 1657083, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KD4f8.jpg?s=128&g=1", "display_name": "RadekSohlich", "link": "https://stackoverflow.com/users/1657083/radeksohlich"}, "edited": false, "score": 0, "creation_date": 1475469874, "post_id": 39811969, "comment_id": 66939442, "body": "Yes this case is clear to me. The problem there was some kind of mixed versions in my local env when I migrate from 1.5 to 1.6 and didn&#39;t refresh the terminal."}], "tags": [], "owner": {"reputation": 9858, "user_id": 973380, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/b760f503c84d1bf47322f401066c753f?s=128&d=identicon&r=PG", "display_name": "fiatjaf", "link": "https://stackoverflow.com/users/973380/fiatjaf"}, "is_accepted": false, "score": 1, "last_activity_date": 1475360211, "creation_date": 1475360211, "answer_id": 39811969, "question_id": 35168558, "link": "https://stackoverflow.com/questions/35168558/go-1-5-to-1-6-import-cycle-not-allowed/39811969#39811969", "title": "Go 1.5 to 1.6: import cycle not allowed", "body": "<p>This error is what is shown when <strong>there is a package importing itself</strong>. For example, in <code>$GOPATH/src/github.com/myawesome/mistakes</code>, you have a file that like this:</p>\n\n<pre><code>package mistakes\n\nimport (\n    \"github.com/myawesome/mistakes\"\n)\n\nfunc CreateComplicatedBugFromSimpleMistake(m mistakes.Mistake) {\n    // done.\n}\n</code></pre>\n\n<p>That was what I was doing. You should know how to solve it, if this is your case too.</p>\n"}, {"tags": [], "owner": {"reputation": 719, "user_id": 1083220, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/0e36597bde57aaf26954f464b79f5df4?s=128&d=identicon&r=PG&f=1", "display_name": "Misgevolution", "link": "https://stackoverflow.com/users/1083220/misgevolution"}, "is_accepted": false, "score": 0, "last_activity_date": 1559113569, "creation_date": 1559113569, "answer_id": 56354840, "question_id": 35168558, "link": "https://stackoverflow.com/questions/35168558/go-1-5-to-1-6-import-cycle-not-allowed/56354840#56354840", "title": "Go 1.5 to 1.6: import cycle not allowed", "body": "<p>Compare the output of <code>readlink -f $(which go)</code> and <code>echo $GOROOT</code> and if they are different, you should set $GOROOT to point to the root directory of the go binary you are running or vice versa.</p>\n"}], "owner": {"reputation": 152, "user_id": 1657083, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KD4f8.jpg?s=128&g=1", "display_name": "RadekSohlich", "link": "https://stackoverflow.com/users/1657083/radeksohlich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9134, "favorite_count": 2, "accepted_answer_id": 35169756, "answer_count": 3, "score": 2, "last_activity_date": 1559113569, "creation_date": 1454473877, "last_edit_date": 1467147538, "question_id": 35168558, "link": "https://stackoverflow.com/questions/35168558/go-1-5-to-1-6-import-cycle-not-allowed", "title": "Go 1.5 to 1.6: import cycle not allowed", "body": "<p>I'm trying to migrate from Go 1.5.3 to Go 1.6 and for some packages I encounter \"import cycle not allowed\" error, when I'm trying to build them for 1.6 .</p>\n\n<p>e.g for building the golint tool I'm getting:</p>\n\n<pre><code>import cycle not allowed\npackage github.com/golang/lint/golint\n    imports flag\n    imports errors\n    imports runtime\n    imports runtime/internal/atomic\n    imports runtime\n</code></pre>\n\n<p>Is there eny problem in my local env or is there any way how to fix this?</p>\n\n<pre><code>go env\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/radek/Projekty/Go\"\nGORACE=\"\"\nGOROOT=\"/home/radek/Software/Go/go1.6\"\nGOTOOLDIR=\"/home/radek/Software/Go/go1.6/pkg/tool/linux_amd64\"\nGO15VENDOREXPERIMENT=\"\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n"}, {"tags": ["go", "tcp", "ip", "icmp"], "answers": [{"tags": [], "owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "is_accepted": true, "score": 4, "last_activity_date": 1454464527, "creation_date": 1454464527, "answer_id": 35167159, "question_id": 35166895, "link": "https://stackoverflow.com/questions/35166895/can-you-target-a-specific-port-using-icmp/35167159#35167159", "title": "Can you target a specific port using icmp?", "body": "<p>No. There are no ports in ICMP.</p>\n\n<p>If you want to know whether a specific TCP server is running, try to connect to it.</p>\n"}], "owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 35167159, "answer_count": 1, "score": 1, "last_activity_date": 1454464527, "creation_date": 1454462671, "question_id": 35166895, "link": "https://stackoverflow.com/questions/35166895/can-you-target-a-specific-port-using-icmp", "title": "Can you target a specific port using icmp?", "body": "<p>I believe the title is pretty self explanatory, but just in case, I'll explain further. </p>\n\n<p>I am writing a function in Go that uses icmp to check if a particular service is running.  I got this idea from ping implemented in Go.  When I try command line ping, it can not resolve <code>127.0.0.1:8080</code>, and the function follows suit, which makes sense.  But can I use icmp to check that address and port with something I missing? Or should I just stick something like tcp to target a port?</p>\n\n<p>Right now I have this simple function, and I <em>could</em> just use tcp, but I'm curious if I could use something like icmp.</p>\n\n<pre><code>func (c *Controller) Ping() error {\n    conn, connErr := net.Dial(\"ip4:icmp\", c.APIServerIP)\n    if connErr != nil {\n        return connErr\n    }\n    conn.SetDeadline(time.Now().Add(3 * time.Second))\n    defer conn.Close()\n    return nil\n}\n</code></pre>\n"}, {"tags": ["optimization", "reflection", "go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 4, "creation_date": 1454455035, "post_id": 35165615, "comment_id": 58049710, "body": "<code>reflect.TypeOf((*DummySolution)(nil)).Elem()</code> I think."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1454455863, "post_id": 35165615, "comment_id": 58049998, "body": "@twotwotwo you should just put that as an answer."}, {"owner": {"reputation": 225, "user_id": 2134916, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1ad4f94b617720a84f30980bf0c2d316?s=128&d=identicon&r=PG", "display_name": "Jansen du Plessis", "link": "https://stackoverflow.com/users/2134916/jansen-du-plessis"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1454456046, "post_id": 35165615, "comment_id": 58050067, "body": "@twotwotwo, Thanks, that works perfectly."}, {"owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "edited": false, "score": 0, "creation_date": 1454481926, "post_id": 35165615, "comment_id": 58058167, "body": "Just a suggestion that might improve this code: register a factory function rather than the type itself. Then you don&#39;t have to bother with any of the reflection."}, {"owner": {"reputation": 225, "user_id": 2134916, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1ad4f94b617720a84f30980bf0c2d316?s=128&d=identicon&r=PG", "display_name": "Jansen du Plessis", "link": "https://stackoverflow.com/users/2134916/jansen-du-plessis"}, "reply_to_user": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "edited": false, "score": 0, "creation_date": 1454534481, "post_id": 35165615, "comment_id": 58093075, "body": "@Endophage The Load() function is in essence a factory function. I use reflection to avoid having to maintain a big switch statement every time I add a new solution. The register function allows me to register a class in the same file as it&#39;s definition."}, {"owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "edited": false, "score": 1, "creation_date": 1454656435, "post_id": 35165615, "comment_id": 58151166, "body": "@JansenduPlessis this is what I was suggesting: <a href=\"http://play.golang.org/p/WcLCKuI4HD\" rel=\"nofollow noreferrer\">play.golang.org/p/WcLCKuI4HD</a> It achieves exactly the same functionality but is frankly much simpler by avoiding reflection, which is rarely the right answer to a problem. It also decouples your solution name from your struct name. If you wanted to change the struct name in your original version, you&#39;d have to change all the places you <code>Load</code>&#39;ed that solution."}], "answers": [{"tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": true, "score": 4, "last_activity_date": 1454456863, "creation_date": 1454456863, "answer_id": 35166009, "question_id": 35165615, "link": "https://stackoverflow.com/questions/35165615/how-can-you-get-a-reflect-type-instance-of-an-struct-without-physically-creating/35166009#35166009", "title": "How can you get a reflect.Type instance of an struct without physically creating the struct?", "body": "<p>You can use <code>reflect.TypeOf((*DummySolution)(nil)).Elem()</code>. Making a <code>nil</code> pointer doesn't allocate space for the whole struct, and <code>Elem</code> (described under the definition of <a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"nofollow\"><code>reflect.Type</code></a>) gets you from a pointer (or slice, array, channel, or map) to its element type.</p>\n"}], "owner": {"reputation": 225, "user_id": 2134916, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1ad4f94b617720a84f30980bf0c2d316?s=128&d=identicon&r=PG", "display_name": "Jansen du Plessis", "link": "https://stackoverflow.com/users/2134916/jansen-du-plessis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 727, "favorite_count": 1, "accepted_answer_id": 35166009, "answer_count": 1, "score": 3, "last_activity_date": 1581789306, "creation_date": 1454454772, "last_edit_date": 1581789306, "question_id": 35165615, "link": "https://stackoverflow.com/questions/35165615/how-can-you-get-a-reflect-type-instance-of-an-struct-without-physically-creating", "title": "How can you get a reflect.Type instance of an struct without physically creating the struct?", "body": "<p>I want to create a registry of struct types to enable dynamic loading of solutions to 'Project Euler' problems. My current solution however requires the struct to first be created and zeroed before it's type can be registered: </p>\n\n<pre><code>package solution\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"os\"\n    \"reflect\"\n)\n\ntype Solution interface {\n    Load()\n    Solve() string\n}\n\ntype SolutionRegister map[string]reflect.Type\n\nfunc (sr SolutionRegister) Set(t reflect.Type) {\n    fmt.Printf(\"Registering %s\\n\", t.Name())\n    sr[t.Name()] = t\n}\n\nfunc (sr SolutionRegister) Get(name string) (Solution, error) {\n    if typ, ok := sr[name]; ok {\n        sol := reflect.New(typ).Interface().(Solution)\n        return sol, nil\n    }\n    return nil, errors.New(\"Invalid solution: \" + name)\n}\n\nvar solutionsRegistry = make(SolutionRegister)\n\nfunc Register(sol Solution) {\n    solutionsRegistry.Set(reflect.TypeOf(sol).Elem())\n}\n\nfunc Load(s string) Solution {\n    sol, err := solutionsRegistry.Get(s)\n    if err != nil {\n        fmt.Printf(\"Error loading solution  %s (%s)\\n\", s, err)\n        os.Exit(-1)\n    }\n    sol.Load()\n    return sol\n}\n\ntype DummySolution struct {\n    data [100 * 1024 * 1024 * 1024]uint8\n}\n\nfunc (s *DummySolution) Load() {\n}\n\nfunc (s *DummySolution) Solve() string {\n    return \"\"\n}\n\nfunc Init() {\n    Register(&amp;DummySolution{})\n}\n</code></pre>\n\n<p>In this example the type of 'DummySolution struct' is registered inside the Init() function. This structure is purposefully absurdly large to illustrate the problem.</p>\n\n<p>Is there a way I could access the type of DummySolution and other Solutions without having to create an instance of the structure beforehand?</p>\n"}, {"tags": ["go", "benchmarking"], "comments": [{"owner": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 0, "creation_date": 1454442990, "post_id": 35162611, "comment_id": 58043611, "body": "you&#39;re not timing JUST flops. you&#39;re also timing function call (which means stack operations, memory allocation, blah blah blah) + integer operations (for loop overhead)"}, {"owner": {"reputation": 1956, "user_id": 1516072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/yVU2W.jpg?s=128&g=1", "display_name": "nlassaux", "link": "https://stackoverflow.com/users/1516072/nlassaux"}, "reply_to_user": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 0, "creation_date": 1454444316, "post_id": 35162611, "comment_id": 58044377, "body": "I&#39;ve edited the code with only the part with the float operation benchmarked, and each operation takes more time. It can&#39;t be explained neither"}, {"owner": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 0, "creation_date": 1454444429, "post_id": 35162611, "comment_id": 58044441, "body": "don&#39;t assume that just because <code>float = float + float</code> is &quot;one&quot; operation in C that it also compiles down to &quot;one&quot; operation at the assembler level. you&#39;d have to get an asm dump of your program to see what&#39;s going on at the machine level."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454444500, "post_id": 35162611, "comment_id": 58044491, "body": "Beside the fact you&#39;re assuming that single operations in Go equate to single machine instructions; you&#39;re also not taking into account the runtime, scheduler, memory allocations, garbage collection, etc"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 3, "creation_date": 1454450601, "post_id": 35162611, "comment_id": 58047807, "body": "@Nico401: You are not measuring what you think you are measuring and you are doing it imprecisely. The statement sequence <code>t1 := time.Now(); result = 1.0 + 312.232; elapsed := time.Since(t1)</code> has a large overhead and is imprecise due to the relatively large clock resolution. The constants in the statement <code>result = 1.0 + 312.232</code> will be simplified by the compiler to <code>result = 313.232</code>, a variable assignment with no floating-point arithmetic."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1454450622, "post_id": 35162611, "comment_id": 58047817, "body": "@peterSO&#39;s answer is much closer. Note to extract all your CPU&#39;s scalar FLOPS you  have to keep all floating-point execution units of your core busy (which requires balancing the mix of ops w/more fast ones, fewer slow ones) and use all cores. To get all of your CPU&#39;s FLOPS, you also need to use vector operations (on Intel, AVX). To get all your computer&#39;s FLOPS you gotta use your GPU too."}], "answers": [{"comments": [{"owner": {"reputation": 1956, "user_id": 1516072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/yVU2W.jpg?s=128&g=1", "display_name": "nlassaux", "link": "https://stackoverflow.com/users/1516072/nlassaux"}, "edited": false, "score": 0, "creation_date": 1454466143, "post_id": 35163475, "comment_id": 58053017, "body": "Does the built-in benchmark count the for-loop? And I would like to try to becnhmark manually."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1956, "user_id": 1516072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/yVU2W.jpg?s=128&g=1", "display_name": "nlassaux", "link": "https://stackoverflow.com/users/1516072/nlassaux"}, "edited": false, "score": 0, "creation_date": 1454467394, "post_id": 35163475, "comment_id": 58053335, "body": "@Nico401: The benchmark time includes the for loop. The for-loop time, by design, is amortized over 20 floating-point operations."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1956, "user_id": 1516072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/yVU2W.jpg?s=128&g=1", "display_name": "nlassaux", "link": "https://stackoverflow.com/users/1516072/nlassaux"}, "edited": false, "score": 0, "creation_date": 1454469749, "post_id": 35163475, "comment_id": 58053988, "body": "@Nico401: I&#39;ve revised the code in my answer to provide a testing package benchmark and a manual benchmark. Within measurement error, the results are the same."}, {"owner": {"reputation": 1956, "user_id": 1516072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/yVU2W.jpg?s=128&g=1", "display_name": "nlassaux", "link": "https://stackoverflow.com/users/1516072/nlassaux"}, "edited": false, "score": 0, "creation_date": 1454549551, "post_id": 35163475, "comment_id": 58099102, "body": "Can we explain the shift between 1GFLOP and 1xxGFLOPs because of GO intern operations (like GC)?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1956, "user_id": 1516072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/yVU2W.jpg?s=128&g=1", "display_name": "nlassaux", "link": "https://stackoverflow.com/users/1516072/nlassaux"}, "edited": false, "score": 1, "creation_date": 1454554918, "post_id": 35163475, "comment_id": 58100497, "body": "@Nico401: No. If you look at the object code that I&#39;ve added to my answer, you will see that the <code>benchmarkFloatOps</code> function doesn&#39;t use any memory managed by the GC or call any functions. How are you calculating GFLOPs?"}, {"owner": {"reputation": 1956, "user_id": 1516072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/yVU2W.jpg?s=128&g=1", "display_name": "nlassaux", "link": "https://stackoverflow.com/users/1516072/nlassaux"}, "edited": false, "score": 0, "creation_date": 1454555179, "post_id": 35163475, "comment_id": 58100569, "body": "For the memory, I got it, thanks! I calculate GFLOPS like: 1 operation/ns, I count 1GFLOP, because its 10^9 operations/sec. If I use goroutines to execute the function <code>benchmarkFloatOps()</code>, the number of operations/sec is just insane, even with <code>GOMAXPROCS=1</code>, do you know why ?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1454554247, "last_edit_date": 1454554247, "creation_date": 1454445992, "answer_id": 35163475, "question_id": 35162611, "link": "https://stackoverflow.com/questions/35162611/measure-flops-in-go/35163475#35163475", "title": "Measure FLOPS in Go", "body": "<p>Here's a (simplistic) Go benchmark which times a loop and twenty floating point operations.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"runtime\"\n    \"testing\"\n    \"time\"\n)\n\nvar (\n    f  float64\n    e  float64 = math.E\n    pi float64 = math.Pi\n)\n\nconst nFlop = 20 // benchmarkFloatOps\n\nfunc benchmarkFloatOps(n int) {\n    for i := 0; i &lt; n; i++ {\n        f = pi + e\n        f = pi - e\n        f = pi * e\n        f = pi / e\n        f = pi + e\n        f = pi - e\n        f = pi * e\n        f = pi / e\n        f = pi + e\n        f = pi - e\n        f = pi * e\n        f = pi / e\n        f = pi + e\n        f = pi - e\n        f = pi * e\n        f = pi / e\n        f = pi + e\n        f = pi - e\n        f = pi * e\n        f = pi / e\n    }\n}\n\nfunc BenchmarkFloatOps(b *testing.B) {\n    benchmarkFloatOps(b.N)\n}\n\nfunc Results(t time.Duration, n int, nFlop int) {\n    fmt.Println(\n        t, nFlop*n, \"ops\",\n        float64(t)/float64(time.Duration((nFlop*n))), \"ns/op\",\n    )\n}\n\nfunc main() {\n    runtime.GOMAXPROCS(1)\n\n    // testing benchmark\n    br := testing.Benchmark(BenchmarkFloatOps)\n    Results(br.T, br.N, nFlop)\n\n    // manual benchmark\n    n := br.N\n    start := time.Now()\n    benchmarkFloatOps(n)\n    end := time.Now()\n    elapsed := end.Sub(start)\n    Results(elapsed, n, nFlop)\n}\n</code></pre>\n\n<p>Output: Intel i7-6700 CPU 3.40GHz:</p>\n\n<pre><code>1.296967371s 4000000000 ops 0.32424184275 ns/op\n1.299078813s 4000000000 ops 0.32476970325 ns/op\n</code></pre>\n\n<p>Go pseudocode for <code>benchmarkFloatOps</code>:</p>\n\n<pre><code>$ go tool compile -S flops.go\n\n\"\".benchmarkFloatOps t=1 size=592 value=0 args=0x8 locals=0x0\n    0x0000 00000 (flops.go:19)  TEXT    \"\".benchmarkFloatOps(SB), $0-8\n    0x0000 00000 (flops.go:19)  NOP\n    0x0000 00000 (flops.go:19)  NOP\n    0x0000 00000 (flops.go:19)  MOVQ    \"\".n+8(FP), CX\n    0x0005 00005 (flops.go:19)  FUNCDATA    $0, gclocals\u00b75184031d3a32a42d85027f073f873668(SB)\n    0x0005 00005 (flops.go:19)  FUNCDATA    $1, gclocals\u00b733cdeccccebe80329f1fdbee7f5874cb(SB)\n    0x0005 00005 (flops.go:20)  MOVQ    $0, AX\n    0x0007 00007 (flops.go:20)  CMPQ    AX, CX\n    0x000a 00010 (flops.go:20)  JGE $0, 588\n    0x0010 00016 (flops.go:21)  MOVSD   \"\".pi(SB), X0\n    0x0018 00024 (flops.go:21)  MOVSD   \"\".e(SB), X1\n    0x0020 00032 (flops.go:21)  ADDSD   X1, X0\n    0x0024 00036 (flops.go:21)  MOVSD   X0, \"\".f(SB)\n    0x002c 00044 (flops.go:22)  MOVSD   \"\".pi(SB), X0\n    0x0034 00052 (flops.go:22)  MOVSD   \"\".e(SB), X1\n    0x003c 00060 (flops.go:22)  SUBSD   X1, X0\n    0x0040 00064 (flops.go:22)  MOVSD   X0, \"\".f(SB)\n    0x0048 00072 (flops.go:23)  MOVSD   \"\".pi(SB), X0\n    0x0050 00080 (flops.go:23)  MOVSD   \"\".e(SB), X1\n    0x0058 00088 (flops.go:23)  MULSD   X1, X0\n    0x005c 00092 (flops.go:23)  MOVSD   X0, \"\".f(SB)\n    0x0064 00100 (flops.go:24)  MOVSD   \"\".pi(SB), X0\n    0x006c 00108 (flops.go:24)  MOVSD   \"\".e(SB), X1\n    0x0074 00116 (flops.go:24)  DIVSD   X1, X0\n    0x0078 00120 (flops.go:24)  MOVSD   X0, \"\".f(SB)\n    0x0080 00128 (flops.go:25)  MOVSD   \"\".pi(SB), X0\n    0x0088 00136 (flops.go:25)  MOVSD   \"\".e(SB), X1\n    0x0090 00144 (flops.go:25)  ADDSD   X1, X0\n    0x0094 00148 (flops.go:25)  MOVSD   X0, \"\".f(SB)\n    0x009c 00156 (flops.go:26)  MOVSD   \"\".pi(SB), X0\n    0x00a4 00164 (flops.go:26)  MOVSD   \"\".e(SB), X1\n    0x00ac 00172 (flops.go:26)  SUBSD   X1, X0\n    0x00b0 00176 (flops.go:26)  MOVSD   X0, \"\".f(SB)\n    0x00b8 00184 (flops.go:27)  MOVSD   \"\".pi(SB), X0\n    0x00c0 00192 (flops.go:27)  MOVSD   \"\".e(SB), X1\n    0x00c8 00200 (flops.go:27)  MULSD   X1, X0\n    0x00cc 00204 (flops.go:27)  MOVSD   X0, \"\".f(SB)\n    0x00d4 00212 (flops.go:28)  MOVSD   \"\".pi(SB), X0\n    0x00dc 00220 (flops.go:28)  MOVSD   \"\".e(SB), X1\n    0x00e4 00228 (flops.go:28)  DIVSD   X1, X0\n    0x00e8 00232 (flops.go:28)  MOVSD   X0, \"\".f(SB)\n    0x00f0 00240 (flops.go:29)  MOVSD   \"\".pi(SB), X0\n    0x00f8 00248 (flops.go:29)  MOVSD   \"\".e(SB), X1\n    0x0100 00256 (flops.go:29)  ADDSD   X1, X0\n    0x0104 00260 (flops.go:29)  MOVSD   X0, \"\".f(SB)\n    0x010c 00268 (flops.go:30)  MOVSD   \"\".pi(SB), X0\n    0x0114 00276 (flops.go:30)  MOVSD   \"\".e(SB), X1\n    0x011c 00284 (flops.go:30)  SUBSD   X1, X0\n    0x0120 00288 (flops.go:30)  MOVSD   X0, \"\".f(SB)\n    0x0128 00296 (flops.go:31)  MOVSD   \"\".pi(SB), X0\n    0x0130 00304 (flops.go:31)  MOVSD   \"\".e(SB), X1\n    0x0138 00312 (flops.go:31)  MULSD   X1, X0\n    0x013c 00316 (flops.go:31)  MOVSD   X0, \"\".f(SB)\n    0x0144 00324 (flops.go:32)  MOVSD   \"\".pi(SB), X0\n    0x014c 00332 (flops.go:32)  MOVSD   \"\".e(SB), X1\n    0x0154 00340 (flops.go:32)  DIVSD   X1, X0\n    0x0158 00344 (flops.go:32)  MOVSD   X0, \"\".f(SB)\n    0x0160 00352 (flops.go:33)  MOVSD   \"\".pi(SB), X0\n    0x0168 00360 (flops.go:33)  MOVSD   \"\".e(SB), X1\n    0x0170 00368 (flops.go:33)  ADDSD   X1, X0\n    0x0174 00372 (flops.go:33)  MOVSD   X0, \"\".f(SB)\n    0x017c 00380 (flops.go:34)  MOVSD   \"\".pi(SB), X0\n    0x0184 00388 (flops.go:34)  MOVSD   \"\".e(SB), X1\n    0x018c 00396 (flops.go:34)  SUBSD   X1, X0\n    0x0190 00400 (flops.go:34)  MOVSD   X0, \"\".f(SB)\n    0x0198 00408 (flops.go:35)  MOVSD   \"\".pi(SB), X0\n    0x01a0 00416 (flops.go:35)  MOVSD   \"\".e(SB), X1\n    0x01a8 00424 (flops.go:35)  MULSD   X1, X0\n    0x01ac 00428 (flops.go:35)  MOVSD   X0, \"\".f(SB)\n    0x01b4 00436 (flops.go:36)  MOVSD   \"\".pi(SB), X0\n    0x01bc 00444 (flops.go:36)  MOVSD   \"\".e(SB), X1\n    0x01c4 00452 (flops.go:36)  DIVSD   X1, X0\n    0x01c8 00456 (flops.go:36)  MOVSD   X0, \"\".f(SB)\n    0x01d0 00464 (flops.go:37)  MOVSD   \"\".pi(SB), X0\n    0x01d8 00472 (flops.go:37)  MOVSD   \"\".e(SB), X1\n    0x01e0 00480 (flops.go:37)  ADDSD   X1, X0\n    0x01e4 00484 (flops.go:37)  MOVSD   X0, \"\".f(SB)\n    0x01ec 00492 (flops.go:38)  MOVSD   \"\".pi(SB), X0\n    0x01f4 00500 (flops.go:38)  MOVSD   \"\".e(SB), X1\n    0x01fc 00508 (flops.go:38)  SUBSD   X1, X0\n    0x0200 00512 (flops.go:38)  MOVSD   X0, \"\".f(SB)\n    0x0208 00520 (flops.go:39)  MOVSD   \"\".pi(SB), X0\n    0x0210 00528 (flops.go:39)  MOVSD   \"\".e(SB), X1\n    0x0218 00536 (flops.go:39)  MULSD   X1, X0\n    0x021c 00540 (flops.go:39)  MOVSD   X0, \"\".f(SB)\n    0x0224 00548 (flops.go:40)  MOVSD   \"\".pi(SB), X0\n    0x022c 00556 (flops.go:40)  MOVSD   \"\".e(SB), X1\n    0x0234 00564 (flops.go:40)  DIVSD   X1, X0\n    0x0238 00568 (flops.go:40)  MOVSD   X0, \"\".f(SB)\n    0x0240 00576 (flops.go:20)  INCQ    AX\n    0x0243 00579 (flops.go:20)  NOP\n    0x0243 00579 (flops.go:20)  CMPQ    AX, CX\n    0x0246 00582 (flops.go:20)  JLT $0, 16\n    0x024c 00588 (flops.go:42)  RET\n</code></pre>\n\n<p>Go object code for <code>benchmarkFloatOps</code>:</p>\n\n<pre><code>$ go build flops.go &amp;&amp; go tool objdump -s benchmarkFloatOps ./flops\n\nTEXT main.benchmarkFloatOps(SB) /home/peter/Dropbox/gopath/src/so/benchmark/flops.go\n    flops.go:19 0x401000    488b4c2408      MOVQ 0x8(SP), CX\n    flops.go:20 0x401005    31c0            XORL AX, AX\n    flops.go:20 0x401007    4839c8          CMPQ CX, AX\n    flops.go:20 0x40100a    0f8d3c020000        JGE 0x40124c\n    flops.go:21 0x401010    f20f1005e8801b00    REPNE MOVSD_XMM 0x1b80e8(IP), X0\n    flops.go:21 0x401018    f20f100dd8801b00    REPNE MOVSD_XMM 0x1b80d8(IP), X1\n    flops.go:21 0x401020    f20f58c1        REPNE ADDSD X1, X0\n    flops.go:21 0x401024    f20f110544451e00    REPNE MOVSD_XMM X0, 0x1e4544(IP)\n    flops.go:22 0x40102c    f20f1005cc801b00    REPNE MOVSD_XMM 0x1b80cc(IP), X0\n    flops.go:22 0x401034    f20f100dbc801b00    REPNE MOVSD_XMM 0x1b80bc(IP), X1\n    flops.go:22 0x40103c    f20f5cc1        REPNE SUBSD X1, X0\n    flops.go:22 0x401040    f20f110528451e00    REPNE MOVSD_XMM X0, 0x1e4528(IP)\n    flops.go:23 0x401048    f20f1005b0801b00    REPNE MOVSD_XMM 0x1b80b0(IP), X0\n    flops.go:23 0x401050    f20f100da0801b00    REPNE MOVSD_XMM 0x1b80a0(IP), X1\n    flops.go:23 0x401058    f20f59c1        REPNE MULSD X1, X0\n    flops.go:23 0x40105c    f20f11050c451e00    REPNE MOVSD_XMM X0, 0x1e450c(IP)\n    flops.go:24 0x401064    f20f100594801b00    REPNE MOVSD_XMM 0x1b8094(IP), X0\n    flops.go:24 0x40106c    f20f100d84801b00    REPNE MOVSD_XMM 0x1b8084(IP), X1\n    flops.go:24 0x401074    f20f5ec1        REPNE DIVSD X1, X0\n    flops.go:24 0x401078    f20f1105f0441e00    REPNE MOVSD_XMM X0, 0x1e44f0(IP)\n    flops.go:25 0x401080    f20f100578801b00    REPNE MOVSD_XMM 0x1b8078(IP), X0\n    flops.go:25 0x401088    f20f100d68801b00    REPNE MOVSD_XMM 0x1b8068(IP), X1\n    flops.go:25 0x401090    f20f58c1        REPNE ADDSD X1, X0\n    flops.go:25 0x401094    f20f1105d4441e00    REPNE MOVSD_XMM X0, 0x1e44d4(IP)\n    flops.go:26 0x40109c    f20f10055c801b00    REPNE MOVSD_XMM 0x1b805c(IP), X0\n    flops.go:26 0x4010a4    f20f100d4c801b00    REPNE MOVSD_XMM 0x1b804c(IP), X1\n    flops.go:26 0x4010ac    f20f5cc1        REPNE SUBSD X1, X0\n    flops.go:26 0x4010b0    f20f1105b8441e00    REPNE MOVSD_XMM X0, 0x1e44b8(IP)\n    flops.go:27 0x4010b8    f20f100540801b00    REPNE MOVSD_XMM 0x1b8040(IP), X0\n    flops.go:27 0x4010c0    f20f100d30801b00    REPNE MOVSD_XMM 0x1b8030(IP), X1\n    flops.go:27 0x4010c8    f20f59c1        REPNE MULSD X1, X0\n    flops.go:27 0x4010cc    f20f11059c441e00    REPNE MOVSD_XMM X0, 0x1e449c(IP)\n    flops.go:28 0x4010d4    f20f100524801b00    REPNE MOVSD_XMM 0x1b8024(IP), X0\n    flops.go:28 0x4010dc    f20f100d14801b00    REPNE MOVSD_XMM 0x1b8014(IP), X1\n    flops.go:28 0x4010e4    f20f5ec1        REPNE DIVSD X1, X0\n    flops.go:28 0x4010e8    f20f110580441e00    REPNE MOVSD_XMM X0, 0x1e4480(IP)\n    flops.go:29 0x4010f0    f20f100508801b00    REPNE MOVSD_XMM 0x1b8008(IP), X0\n    flops.go:29 0x4010f8    f20f100df87f1b00    REPNE MOVSD_XMM 0x1b7ff8(IP), X1\n    flops.go:29 0x401100    f20f58c1        REPNE ADDSD X1, X0\n    flops.go:29 0x401104    f20f110564441e00    REPNE MOVSD_XMM X0, 0x1e4464(IP)\n    flops.go:30 0x40110c    f20f1005ec7f1b00    REPNE MOVSD_XMM 0x1b7fec(IP), X0\n    flops.go:30 0x401114    f20f100ddc7f1b00    REPNE MOVSD_XMM 0x1b7fdc(IP), X1\n    flops.go:30 0x40111c    f20f5cc1        REPNE SUBSD X1, X0\n    flops.go:30 0x401120    f20f110548441e00    REPNE MOVSD_XMM X0, 0x1e4448(IP)\n    flops.go:31 0x401128    f20f1005d07f1b00    REPNE MOVSD_XMM 0x1b7fd0(IP), X0\n    flops.go:31 0x401130    f20f100dc07f1b00    REPNE MOVSD_XMM 0x1b7fc0(IP), X1\n    flops.go:31 0x401138    f20f59c1        REPNE MULSD X1, X0\n    flops.go:31 0x40113c    f20f11052c441e00    REPNE MOVSD_XMM X0, 0x1e442c(IP)\n    flops.go:32 0x401144    f20f1005b47f1b00    REPNE MOVSD_XMM 0x1b7fb4(IP), X0\n    flops.go:32 0x40114c    f20f100da47f1b00    REPNE MOVSD_XMM 0x1b7fa4(IP), X1\n    flops.go:32 0x401154    f20f5ec1        REPNE DIVSD X1, X0\n    flops.go:32 0x401158    f20f110510441e00    REPNE MOVSD_XMM X0, 0x1e4410(IP)\n    flops.go:33 0x401160    f20f1005987f1b00    REPNE MOVSD_XMM 0x1b7f98(IP), X0\n    flops.go:33 0x401168    f20f100d887f1b00    REPNE MOVSD_XMM 0x1b7f88(IP), X1\n    flops.go:33 0x401170    f20f58c1        REPNE ADDSD X1, X0\n    flops.go:33 0x401174    f20f1105f4431e00    REPNE MOVSD_XMM X0, 0x1e43f4(IP)\n    flops.go:34 0x40117c    f20f10057c7f1b00    REPNE MOVSD_XMM 0x1b7f7c(IP), X0\n    flops.go:34 0x401184    f20f100d6c7f1b00    REPNE MOVSD_XMM 0x1b7f6c(IP), X1\n    flops.go:34 0x40118c    f20f5cc1        REPNE SUBSD X1, X0\n    flops.go:34 0x401190    f20f1105d8431e00    REPNE MOVSD_XMM X0, 0x1e43d8(IP)\n    flops.go:35 0x401198    f20f1005607f1b00    REPNE MOVSD_XMM 0x1b7f60(IP), X0\n    flops.go:35 0x4011a0    f20f100d507f1b00    REPNE MOVSD_XMM 0x1b7f50(IP), X1\n    flops.go:35 0x4011a8    f20f59c1        REPNE MULSD X1, X0\n    flops.go:35 0x4011ac    f20f1105bc431e00    REPNE MOVSD_XMM X0, 0x1e43bc(IP)\n    flops.go:36 0x4011b4    f20f1005447f1b00    REPNE MOVSD_XMM 0x1b7f44(IP), X0\n    flops.go:36 0x4011bc    f20f100d347f1b00    REPNE MOVSD_XMM 0x1b7f34(IP), X1\n    flops.go:36 0x4011c4    f20f5ec1        REPNE DIVSD X1, X0\n    flops.go:36 0x4011c8    f20f1105a0431e00    REPNE MOVSD_XMM X0, 0x1e43a0(IP)\n    flops.go:37 0x4011d0    f20f1005287f1b00    REPNE MOVSD_XMM 0x1b7f28(IP), X0\n    flops.go:37 0x4011d8    f20f100d187f1b00    REPNE MOVSD_XMM 0x1b7f18(IP), X1\n    flops.go:37 0x4011e0    f20f58c1        REPNE ADDSD X1, X0\n    flops.go:37 0x4011e4    f20f110584431e00    REPNE MOVSD_XMM X0, 0x1e4384(IP)\n    flops.go:38 0x4011ec    f20f10050c7f1b00    REPNE MOVSD_XMM 0x1b7f0c(IP), X0\n    flops.go:38 0x4011f4    f20f100dfc7e1b00    REPNE MOVSD_XMM 0x1b7efc(IP), X1\n    flops.go:38 0x4011fc    f20f5cc1        REPNE SUBSD X1, X0\n    flops.go:38 0x401200    f20f110568431e00    REPNE MOVSD_XMM X0, 0x1e4368(IP)\n    flops.go:39 0x401208    f20f1005f07e1b00    REPNE MOVSD_XMM 0x1b7ef0(IP), X0\n    flops.go:39 0x401210    f20f100de07e1b00    REPNE MOVSD_XMM 0x1b7ee0(IP), X1\n    flops.go:39 0x401218    f20f59c1        REPNE MULSD X1, X0\n    flops.go:39 0x40121c    f20f11054c431e00    REPNE MOVSD_XMM X0, 0x1e434c(IP)\n    flops.go:40 0x401224    f20f1005d47e1b00    REPNE MOVSD_XMM 0x1b7ed4(IP), X0\n    flops.go:40 0x40122c    f20f100dc47e1b00    REPNE MOVSD_XMM 0x1b7ec4(IP), X1\n    flops.go:40 0x401234    f20f5ec1        REPNE DIVSD X1, X0\n    flops.go:40 0x401238    f20f110530431e00    REPNE MOVSD_XMM X0, 0x1e4330(IP)\n    flops.go:20 0x401240    48ffc0          INCQ AX\n    flops.go:20 0x401243    4839c8          CMPQ CX, AX\n    flops.go:20 0x401246    0f8cc4fdffff        JL 0x401010\n    flops.go:42 0x40124c    c3          RET\n</code></pre>\n"}], "owner": {"reputation": 1956, "user_id": 1516072, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/yVU2W.jpg?s=128&g=1", "display_name": "nlassaux", "link": "https://stackoverflow.com/users/1516072/nlassaux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 2, "accepted_answer_id": 35163475, "answer_count": 1, "score": 5, "last_activity_date": 1454554247, "creation_date": 1454442696, "last_edit_date": 1454444183, "question_id": 35162611, "link": "https://stackoverflow.com/questions/35162611/measure-flops-in-go", "title": "Measure FLOPS in Go", "body": "<p>I would like to write a go program to benchmark my CPU and figure out my laptop's GFLOPS.</p>\n\n<pre><code>func benchmarkFlopTime(){\n    num_operations := int(100000000)\n    var timeArray[] time.Duration;\n\n    var result float64\n    for i:=0; i &lt; num_operations; i++ {\n        t1 := time.Now()\n        result = 1.0 + 312.232\n        elapsed := time.Since(t1)\n        timeArray = append(timeArray, elapsed)\n        result += 1.0\n    }\n\n    fmt.Println(\"Result (ns):\", float64(sumTimeArray(timeArray))/float64(time.Duration(num_operations)))\n}\n</code></pre>\n\n<blockquote>\n  <p>Ouput1: Result (ns): 9.99604753ns</p>\n</blockquote>\n\n<h3>Interpretation:</h3>\n\n<p>This code gives me around <strong>0.1 GFLOPS</strong> ((1sec/10ns)/10^-9). I know my CPU can do something like 8 Operations Per Cycle and I only do one, so I can have a factor 8, let's assume I've <strong>1GFLOPS</strong></p>\n\n<h3>Problems:</h3>\n\n<ul>\n<li>Although, the theoretical number of GFLOPS for my laptop with a 2.5GHZ i7, 8 cores, should be: 8*2.5*8 = <strong>160GFLOPS</strong>. I'm far below this result.</li>\n</ul>\n\n<hr>\n\n<p>I precise that I don't activate the optimisation when I compile <code>go install -gcflags '-N -l' github.com/golang/cpu-benchmark</code>.</p>\n\n<p>Can we explain this value, far below the theoretical value? Is Go ok to measure that?</p>\n"}, {"tags": ["macos", "go", "exec", "fork"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1454432185, "creation_date": 1454432185, "answer_id": 35159340, "question_id": 35159117, "link": "https://stackoverflow.com/questions/35159117/go-build-exec-fork-exec-permission-denied/35159340#35159340", "title": "Go build &amp; exec: fork/exec: permission denied", "body": "<p>You're changing the command path from the location of your <code>go</code> binary, to <code>abc</code>.</p>\n\n<blockquote>\n<pre><code>type Cmd struct {\n        // Path is the path of the command to run.\n        //\n        // This is the only field that must be set to a non-zero\n        // value. If Path is relative, it is evaluated relative\n        // to Dir.\n        Path string\n</code></pre>\n</blockquote>\n\n<p>If you want to change the working directory, use <a href=\"https://golang.org/pkg/os/exec/#Cmd\" rel=\"nofollow\"><code>Cmd.Dir</code></a></p>\n"}], "owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4459, "favorite_count": 1, "accepted_answer_id": 35159340, "answer_count": 1, "score": 2, "last_activity_date": 1454432185, "creation_date": 1454431588, "question_id": 35159117, "link": "https://stackoverflow.com/questions/35159117/go-build-exec-fork-exec-permission-denied", "title": "Go build &amp; exec: fork/exec: permission denied", "body": "<p>I need to build a program using the Go toolchain and then execute it. For some reasons I get a permission error due the forking. Is there a way to circumvent this error or any best practice? I think my program does something similar with <code>Go test</code> tool, though <code>go test</code> doesn't get this kind of error.</p>\n\n<pre><code>package main\n\nimport(\n    \"os\"\n    \"os/exec\"\n    \"flag\"\n    log \"github.com/golang/glog\"\n)\n\nfunc main(){\n    flag.Parse()\n    tdir := \"abc\"\n    if err := os.MkdirAll(tdir, 0777); err !=nil{\n        log.Error(err)\n        return\n    }\n    f, err := os.Create(tdir + \"/main.go\")\n    if err !=nil{\n        log.Error(err)\n        return\n    }\n    if err = f.Chmod(0777); err !=nil{\n        log.Error(err)\n        return\n    }\n    defer f.Close()\n    defer os.Remove(f.Name())\n    if _, err = f.Write([]byte(tpl)); err !=nil{\n        log.Error(err)\n        return\n    }\n    cmd := exec.Command(\"go\", \"build\", \"-o\", \"edoc\")\n    cmd.Path = tdir\n    b, err := cmd.CombinedOutput()\n    if err !=nil{\n        log.Errorf(\"%s, err %v\", b, err)\n        return\n    }\n\n}\n\nvar tpl = `package main\n\nimport(\n    \"fmt\"\n    \"flag\"\n)\n\nfunc main(){\n    flag.Parse()\n    fmt.Printf(\"Hello World\")\n\n}`\n</code></pre>\n\n<p>Error: </p>\n\n<pre><code>E0202 18:24:42.359008   13600 main.go:36] , err fork/exec abc: permission denied\n</code></pre>\n\n<p>OS: OSX 10.11</p>\n"}, {"tags": ["optimization", "go", "pprof"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1454422186, "post_id": 35155119, "comment_id": 58029588, "body": "Your graphs are illegible. You don&#39;t tell us what your program is doing. <a href=\"http://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example.</a>."}, {"owner": {"reputation": 566, "user_id": 4934782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae4c1c1fd0fa82205af63dc62eeb347f?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/4934782/aaron"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454422348, "post_id": 35155119, "comment_id": 58029708, "body": "@JimB not using cgo; everything pure Go"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1454422699, "post_id": 35155119, "comment_id": 58029986, "body": "I would guess that your program is blocked, and that why it yields the CPU so frequently. You could run a blocking profile, but without actual code and data there&#39;s much we can do here."}, {"owner": {"reputation": 566, "user_id": 4934782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae4c1c1fd0fa82205af63dc62eeb347f?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/4934782/aaron"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454436095, "post_id": 35155119, "comment_id": 58039501, "body": "@JimB definitely blocked (which is pretty clear by calling yield &amp; sleep) but difficult to reconsile with the 100% utilization on main cpu. Seems like multiple goroutines are running then?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1454436292, "post_id": 35155119, "comment_id": 58039623, "body": "@Aaron: there are <i>always</i> multiple goroutines running (and multiple OS threads). GOMAXPROCS only controls how many OS threads are available to run user level code."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454436660, "post_id": 35160587, "comment_id": 58039866, "body": "Which SQL driver? (BTW, I also find that the cumulative output is helpful, since that shows the time in function calls more like the call stack)"}, {"owner": {"reputation": 566, "user_id": 4934782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae4c1c1fd0fa82205af63dc62eeb347f?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/4934782/aaron"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454442844, "post_id": 35160587, "comment_id": 58043526, "body": "The driver is the Go-SQL-driver at: <a href=\"https://github.com/go-sql-driver/mysql\" rel=\"nofollow noreferrer\">github.com/go-sql-driver/mysql</a>  I came to the conclusion that my database driver was the thread which was yielding because under the output at <a href=\"http://localhost:6060/debug/pprof/goroutine?debug=1\" rel=\"nofollow noreferrer\">localhost:6060/debug/pprof/goroutine?debug=1</a> I see   <code>1 @ 0x43079c 0x43086b 0x40487d 0x4043bb 0x5451ec 0x45f0e1     #\t0x5451ec\tdatabase&#47;sql.(*DB).connectionOpener+0x4c\t    C:&#47;Go&#47;src&#47;database&#47;sql&#47;sql.go:727</code> along with my goroutine (next comment)"}, {"owner": {"reputation": 566, "user_id": 4934782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae4c1c1fd0fa82205af63dc62eeb347f?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/4934782/aaron"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454442951, "post_id": 35160587, "comment_id": 58043584, "body": "<code>1 @ 0x441d10 0x53447a 0x48ba79 0x48d7f7 0x48cfe5 0x49b7da 0x48dc02 0x49a8db 0x480e9f 0x45f0e1 #\t0x53447a\t_&#47;C_&#47;code&#47;sc_proto&#47;cloudgraph.(*Node).AddChild+0x&zwnj;&#8203;8a\tC:&#47;code&#47;sc_proto&#47;&zwnj;&#8203;cloudgraph&#47;cloudgrap&zwnj;&#8203;h.go:92 #\t0x49b7da\t_&#47;C_&#47;code&#47;sc_proto.main.func3+0x7a\t\t\tC:&#47;code&#47;sc_p&zwnj;&#8203;roto&#47;main.go:887 #\t0x48dc02\t_&#47;C_&#47;code&#47;sc_proto.main+0x1d2\t\t\t\tC:&#47;code&#47;sc_proto&zwnj;&#8203;&#47;main.go:908 #\t0x49a8db\t_&#47;C_&#47;code&#47;sc_proto.Test_main+0x1b\t\t\tC:&#47;code&#47;sc_pr&zwnj;&#8203;oto&#47;main_test.go:100&zwnj;&#8203;2 #\t0x480e9f\ttesting.tRunner+0x9f\t\t\t\t\tC:&#47;Go&#47;src&#47;testing&#47;testin&zwnj;&#8203;g.go:473</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454443911, "post_id": 35160587, "comment_id": 58044118, "body": "I&#39;m not sure what you&#39;re inferring from that, but the existence of a goroutine doesn&#39;t mean it&#39;s consuming any CPU."}], "tags": [], "owner": {"reputation": 566, "user_id": 4934782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae4c1c1fd0fa82205af63dc62eeb347f?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/4934782/aaron"}, "is_accepted": true, "score": 9, "last_activity_date": 1455066956, "last_edit_date": 1455066956, "creation_date": 1454435868, "answer_id": 35160587, "question_id": 35155119, "link": "https://stackoverflow.com/questions/35155119/how-to-optimize-golang-program-that-spends-most-time-in-runtime-osyield-and-runt/35160587#35160587", "title": "How to optimize golang program that spends most time in runtime.osyield and runtime.usleep", "body": "<p>Found the answer myself, so I'm posting this here for anyone else who is having a similar problem. And special thanks to @JimB for sending me down the right path.</p>\n\n<p>As can be seen from the graph, the paths which lead to osyield and usleep are garbage collection routines. This program was using a linked list which generated a lot of pointers, which created a lot of work for the gc, which occasionally blocked execution of my code while it cleaned up my mess.</p>\n\n<p>Ultimately the solution to this problem came from <a href=\"https://software.intel.com/en-us/blogs/2014/05/10/debugging-performance-issues-in-go-programs\" rel=\"noreferrer\">https://software.intel.com/en-us/blogs/2014/05/10/debugging-performance-issues-in-go-programs</a> (which was an awesome resource btw). I followed the instructions about the memory profiler there; and the recommendation to replace collections of pointers with slices cleared up my garbage collection issues, and <em>my code is much faster now</em>!</p>\n"}], "owner": {"reputation": 566, "user_id": 4934782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae4c1c1fd0fa82205af63dc62eeb347f?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/4934782/aaron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7283, "favorite_count": 6, "accepted_answer_id": 35160587, "answer_count": 1, "score": 13, "last_activity_date": 1455066956, "creation_date": 1454420491, "last_edit_date": 1454435921, "question_id": 35155119, "link": "https://stackoverflow.com/questions/35155119/how-to-optimize-golang-program-that-spends-most-time-in-runtime-osyield-and-runt", "title": "How to optimize golang program that spends most time in runtime.osyield and runtime.usleep", "body": "<p>I've been working on optimizing code that analyzes social graph data (with lots of help from <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"noreferrer\">https://blog.golang.org/profiling-go-programs</a>) and I've successfully reworked a lot of slow code.</p>\n\n<p>All data is loaded into memory from db first, and the data analysis from there appears CPU bound (max memory consumption &lt; 10MB, CPU1 @ 100%)</p>\n\n<p>But now most of my program's time seems to be in runtime.osyield and runtime.usleep. What's the way to prevent that?</p>\n\n<p>I've set GOMAXPROCS=1 and the code does not spawn any goroutines (other than what the golang libraries may call).</p>\n\n<p>This is my top10 output from pprof</p>\n\n<pre><code>(pprof) top10\n62550ms of 72360ms total (86.44%)\nDropped 208 nodes (cum &lt;= 361.80ms)\nShowing top 10 nodes out of 77 (cum &gt;= 1040ms)\n      flat  flat%   sum%        cum   cum%\n   20760ms 28.69% 28.69%    20850ms 28.81%  runtime.osyield\n   14070ms 19.44% 48.13%    14080ms 19.46%  runtime.usleep\n   11740ms 16.22% 64.36%    23100ms 31.92%  _/C_/code/sc_proto/cloudgraph.(*Graph).LeafProb\n    6170ms  8.53% 72.89%     6170ms  8.53%  runtime.memmove\n    4740ms  6.55% 79.44%    10660ms 14.73%  runtime.typedslicecopy\n    2040ms  2.82% 82.26%     2040ms  2.82%  _/C_/code/sc_proto.mAvg\n     890ms  1.23% 83.49%     1590ms  2.20%  runtime.scanobject\n     770ms  1.06% 84.55%     1420ms  1.96%  runtime.mallocgc\n     760ms  1.05% 85.60%      760ms  1.05%  runtime.heapBitsForObject\n     610ms  0.84% 86.44%     1040ms  1.44%  _/C_/code/sc_proto/cloudgraph.(*Node).DeepestChildren\n(pprof)\n</code></pre>\n\n<p>The _ /C_/code/sc_proto/* functions are my code.</p>\n\n<p>And the output from web:\n<a href=\"https://i.stack.imgur.com/Xjbvb.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/Xjbvb.png\" alt=\"output from web\"></a></p>\n\n<p>(better, SVG version of graph here: <a href=\"https://goo.gl/Tyc6X4\" rel=\"noreferrer\">https://goo.gl/Tyc6X4</a>)</p>\n"}, {"tags": ["go", "go-imagick"], "answers": [{"comments": [{"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1454420181, "post_id": 35154920, "comment_id": 58028149, "body": "what is the difference between uint, and uint32 or uint and uint64?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 4, "creation_date": 1454420490, "post_id": 35154920, "comment_id": 58028386, "body": "<code>uint32</code> is 32 bits, <code>uint64</code> is 64 bits, <code>uint</code> is implementation defined, either 32 or 64 bits. See <a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"nofollow noreferrer\">The Go Programming Language Specification: Numeric types</a>."}, {"owner": {"reputation": 629, "user_id": 3737786, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/aa0d239b2b0aaba3206246d52a87f268?s=128&d=identicon&r=PG&f=1", "display_name": "bsbak", "link": "https://stackoverflow.com/users/3737786/bsbak"}, "edited": false, "score": 2, "creation_date": 1499255081, "post_id": 35154920, "comment_id": 76825928, "body": "variable need to be u32, err ... not u64 =)"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 32, "last_activity_date": 1454424152, "last_edit_date": 1454424152, "creation_date": 1454419940, "answer_id": 35154920, "question_id": 35154875, "link": "https://stackoverflow.com/questions/35154875/convert-string-to-uint-in-go-lang/35154920#35154920", "title": "convert string to uint in go lang", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/strconv/\" rel=\"noreferrer\">Package strconv</a></p>\n  \n  <p><a href=\"https://golang.org/pkg/strconv/#ParseUint\" rel=\"noreferrer\">func ParseUint</a></p>\n\n<pre><code>func ParseUint(s string, base int, bitSize int) (n uint64, err error)\n</code></pre>\n  \n  <p>ParseUint is like ParseInt but for unsigned numbers. </p>\n  \n  <p><a href=\"https://golang.org/pkg/strconv/#ParseInt\" rel=\"noreferrer\">func ParseInt</a></p>\n\n<pre><code>func ParseInt(s string, base int, bitSize int) (i int64, err error)\n</code></pre>\n  \n  <p>ParseInt interprets a string s in the given base (2 to 36) and returns\n  the corresponding value i. If base == 0, the base is implied by the\n  string's prefix: base 16 for \"0x\", base 8 for \"0\", and base 10\n  otherwise.</p>\n  \n  <p>The bitSize argument specifies the integer type that the result must\n  fit into. Bit sizes 0, 8, 16, 32, and 64 correspond to int, int8,\n  int16, int32, and int64.</p>\n  \n  <p>The errors that ParseInt returns have concrete type *NumError and\n  include err.Num = s. If s is empty or contains invalid digits, err.Err\n  = ErrSyntax and the returned value is 0; if the value corresponding to s cannot be represented by a signed integer of the given size, err.Err\n  = ErrRange and the returned value is the maximum magnitude integer of the appropriate bitSize and sign.</p>\n</blockquote>\n\n<p>The <code>bitSize</code> argument specifies the integer type that the result must\nfit into. The <code>uint</code> type size is implementation defined, either 32 or 64 bits. The <code>ParseUint</code> return type is always <code>uint64</code>. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    width := \"42\"\n    u64, err := strconv.ParseUint(width, 10, 32)\n    if err != nil {\n        fmt.Println(err)\n    }\n    wd := uint(u64)\n    fmt.Println(wd)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>42\n</code></pre>\n"}], "owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34015, "favorite_count": 4, "accepted_answer_id": 35154920, "answer_count": 1, "score": 23, "last_activity_date": 1454442120, "creation_date": 1454419812, "last_edit_date": 1454442120, "question_id": 35154875, "link": "https://stackoverflow.com/questions/35154875/convert-string-to-uint-in-go-lang", "title": "convert string to uint in go lang", "body": "<p>I am trying to convert the string to uint on 32-bit ubuntu using the following code. But it always convert it in uint64 despite explicitly passing 32 as the argument in the function. Below in the code mw is the object of the <a href=\"https://github.com/gographics/imagick\" rel=\"noreferrer\">image magick</a> library. Which returns <code>uint</code> when <code>mw.getImageWidth()</code> and <code>mw.getImageHeight()</code> is called. Also, it accepts the <code>uint</code> type argument in the <a href=\"https://github.com/gographics/imagick/blob/master/imagick/magick_wand_image.go\" rel=\"noreferrer\">resize</a> function.   </p>\n\n<pre><code>    width :=  strings.Split(imgResize, \"x\")[0]\n    height := strings.Split(imgResize, \"x\")[1]\n\n    var masterWidth uint = mw.GetImageWidth() \n    var masterHeight uint = mw.GetImageHeight() \n\n    mw := imagick.NewMagickWand()\n    defer mw.Destroy()\n\n    err = mw.ReadImageBlob(img)\n    if err != nil {\n            log.Fatal(err)\n        } \n\n    var masterWidth uint = mw.GetImageWidth() \n    var masterHeight uint = mw.GetImageHeight()\n\n    wd, _ := strconv.ParseUint(width, 10, 32)\n    ht, _ := strconv.ParseUint(height, 10, 32)\n\n   if masterWidth &lt; wd || masterHeight &lt; ht { \n     err = mw.ResizeImage(wd, ht, imagick.FILTER_BOX, 1)\n     if err != nil {\n        panic(err)\n    } \n   }\n</code></pre>\n\n<p>Error is :</p>\n\n<pre><code># command-line-arguments\ntest.go:94: invalid operation: masterWidth &lt; wd (mismatched types uint and uint64)\ngoImageCode/test.go:94: invalid operation: masterHeight &lt; ht (mismatched types uint and uint64)\ngoImageCode/test.go:100: cannot use wd (type uint64) as type uint in argument to mw.ResizeImage\ngoImageCode/AmazonAWS.go:100: cannot use ht (type uint64) as type uint in argument to mw.ResizeImage\n</code></pre>\n"}, {"tags": ["windows", "go", "user-management", "netapi32"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454433763, "post_id": 35154074, "comment_id": 58038008, "body": "The syscall packages are mostly machine generated. Have you looked at the <code>go generate</code> code?"}, {"owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "edited": false, "score": 0, "creation_date": 1455758561, "post_id": 35154074, "comment_id": 58637461, "body": "Did you ever get this figured out?"}, {"owner": {"reputation": 363, "user_id": 2656351, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2145f303214260c85edc32b3f701dd9d?s=128&d=identicon&r=PG", "display_name": "iamacarpet", "link": "https://stackoverflow.com/users/2656351/iamacarpet"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456143793, "post_id": 35154074, "comment_id": 58794939, "body": "I&#39;m afraid I haven&#39;t yet, I have to move onto a different project for a while. I&#39;ll be coming back to this in a week or two. Thanks @JimB , I&#39;ll start by looking there next."}], "answers": [{"comments": [{"owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "edited": false, "score": 0, "creation_date": 1456634375, "post_id": 35678560, "comment_id": 59035757, "body": "Yeah, I was able to run the messageBox example is on github: <a href=\"https://github.com/golang/go/wiki/WindowsDLLs\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/WindowsDLLs</a>. It&#39;s more specific to the functions that are listed in the original question. Can yo show an example on how to call any of the functions in the example code? Thank you."}, {"owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "edited": false, "score": 0, "creation_date": 1456634610, "post_id": 35678560, "comment_id": 59035788, "body": "I know and have used <a href=\"https://github.com/AllenDang/w32\" rel=\"nofollow noreferrer\">github.com/AllenDang/w32</a> also but there are no user based wrappers"}, {"owner": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "reply_to_user": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "edited": false, "score": 0, "creation_date": 1456729661, "post_id": 35678560, "comment_id": 59064495, "body": "I updated the example to use the functions you are interested in. Let me know if that clarifies anything."}, {"owner": {"reputation": 363, "user_id": 2656351, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2145f303214260c85edc32b3f701dd9d?s=128&d=identicon&r=PG", "display_name": "iamacarpet", "link": "https://stackoverflow.com/users/2656351/iamacarpet"}, "edited": false, "score": 0, "creation_date": 1456745897, "post_id": 35678560, "comment_id": 59073593, "body": "Thanks @chowey, that&#39;s exactly the help I was after :).. I had a little poke around with the types for another one of my posts about Windows Service calls to the DLLs, so this was the final piece in the puzzle. Once I move back around to this project, if I&#39;m going to put the time in to create a higher level API for those functions, I&#39;ll try and publish to GitHub, if you&#39;re ok with me using your code as part of that?"}, {"owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "edited": false, "score": 0, "creation_date": 1456807468, "post_id": 35678560, "comment_id": 59105995, "body": "Dude, that&#39;s awesome. Thank you!"}, {"owner": {"reputation": 363, "user_id": 2656351, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2145f303214260c85edc32b3f701dd9d?s=128&d=identicon&r=PG", "display_name": "iamacarpet", "link": "https://stackoverflow.com/users/2656351/iamacarpet"}, "reply_to_user": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "edited": false, "score": 0, "creation_date": 1461832890, "post_id": 35678560, "comment_id": 61381644, "body": "@vinniyo <a href=\"https://github.com/iamacarpet/go-win64api\" rel=\"nofollow noreferrer\">github.com/iamacarpet/go-win64api</a>"}], "tags": [], "owner": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "is_accepted": true, "score": 6, "last_activity_date": 1456729610, "last_edit_date": 1456729610, "creation_date": 1456632426, "answer_id": 35678560, "question_id": 35154074, "link": "https://stackoverflow.com/questions/35154074/how-do-i-manage-windows-user-accounts-in-go/35678560#35678560", "title": "How do I manage Windows User Accounts in Go?", "body": "<h2>Using Windows DLLs is (in my opinion) the best way to directly use the Win32 API.</h2>\n\n<p>If you look in the <code>src/syscall</code> directory of your Go installation, you can find a file called <a href=\"https://golang.org/src/syscall/mksyscall_windows.go\" rel=\"noreferrer\">mksyscall_windows.go</a>. This seems to be how the Go team manages all their DLL wrappers.</p>\n\n<h2>Use <code>go generate</code> to generate your code</h2>\n\n<p>Take a look at how <a href=\"https://golang.org/src/syscall/syscall_windows.go\" rel=\"noreferrer\">syscall_windows.go</a> uses it. Specifically it has the following <code>go generate</code> command:</p>\n\n<blockquote>\n  <p>//go:generate go run mksyscall_windows.go -output zsyscall_windows.go syscall_windows.go security_windows.go</p>\n</blockquote>\n\n<h2>Define the Win32 API types</h2>\n\n<p>They then define their types. You will need to do this yourself manually.</p>\n\n<p>It is a challenge sometimes because it is vital you preserve the size and alignment of the struct fields. I use <a href=\"https://www.visualstudio.com/en-us/products/visual-studio-community-vs.aspx\" rel=\"noreferrer\">Visual Studio Community Edition</a> to poke around at the plethora of Microsoft's defined basic types in an effort to determine their Go equivalents.</p>\n\n<p>Windows uses UTF16 for strings. So you will be representing these as a <code>*uint16</code>. Use <code>syscall.UTF16PtrFromString</code> to generate one from a Go string.</p>\n\n<h2>Annotate Win32 API functions to export</h2>\n\n<p>The whole point of <code>mksyscall_windows.go</code> is to generate all the boilerplate code so you end up with a Go function that calls the DLL for you.</p>\n\n<p>This is accomplished by adding annotations (Go comments).</p>\n\n<p>For example, in <code>syscall_windows.go</code> you have these annotations:</p>\n\n<pre><code>//sys   GetLastError() (lasterr error)\n//...\n//sys   CreateHardLink(filename *uint16, existingfilename *uint16, reserved uintptr) (err error) [failretval&amp;0xff==0] = CreateHardLinkW\n</code></pre>\n\n<p><code>mksyscall_windows.go</code> has doc comments to help you figure out how this works. You can also look at the go-generated code in <a href=\"https://golang.org/src/syscall/zsyscall_windows.go\" rel=\"noreferrer\">zsyscall_windows.go</a>.</p>\n\n<h2>Run <code>go generate</code></h2>\n\n<p>Its easy, just run:</p>\n\n<pre><code>go generate\n</code></pre>\n\n<h2>Example:</h2>\n\n<p>For your example, create a file called <code>win32_windows.go</code>:</p>\n\n<pre><code>package win32\n\n//go generate go run mksyscall_windows.go -output zwin32_windows.go win32_windows.go\n\ntype (\n    LPVOID         uintptr\n    LMSTR          *uint16\n    DWORD          uint32\n    LPBYTE         *byte\n    LPDWORD        *uint32\n    LPWSTR         *uint16\n    NET_API_STATUS DWORD\n\n    USER_INFO_1 struct {\n        Usri1_name         LPWSTR\n        Usri1_password     LPWSTR\n        Usri1_password_age DWORD\n        Usri1_priv         DWORD\n        Usri1_home_dir     LPWSTR\n        Usri1_comment      LPWSTR\n        Usri1_flags        DWORD\n        Usri1_script_path  LPWSTR\n    }\n\n    GROUP_USERS_INFO_0 struct {\n        Grui0_name LPWSTR\n    }\n\n    USER_INFO_1003 struct {\n        Usri1003_password LPWSTR\n    }\n)\n\nconst (\n    // from LMaccess.h\n\n    USER_PRIV_GUEST = 0\n    USER_PRIV_USER  = 1\n    USER_PRIV_ADMIN = 2\n\n    UF_SCRIPT                          = 0x0001\n    UF_ACCOUNTDISABLE                  = 0x0002\n    UF_HOMEDIR_REQUIRED                = 0x0008\n    UF_LOCKOUT                         = 0x0010\n    UF_PASSWD_NOTREQD                  = 0x0020\n    UF_PASSWD_CANT_CHANGE              = 0x0040\n    UF_ENCRYPTED_TEXT_PASSWORD_ALLOWED = 0x0080\n\n    UF_TEMP_DUPLICATE_ACCOUNT    = 0x0100\n    UF_NORMAL_ACCOUNT            = 0x0200\n    UF_INTERDOMAIN_TRUST_ACCOUNT = 0x0800\n    UF_WORKSTATION_TRUST_ACCOUNT = 0x1000\n    UF_SERVER_TRUST_ACCOUNT      = 0x2000\n\n    UF_ACCOUNT_TYPE_MASK = UF_TEMP_DUPLICATE_ACCOUNT |\n        UF_NORMAL_ACCOUNT |\n        UF_INTERDOMAIN_TRUST_ACCOUNT |\n        UF_WORKSTATION_TRUST_ACCOUNT |\n        UF_SERVER_TRUST_ACCOUNT\n\n    UF_DONT_EXPIRE_PASSWD                     = 0x10000\n    UF_MNS_LOGON_ACCOUNT                      = 0x20000\n    UF_SMARTCARD_REQUIRED                     = 0x40000\n    UF_TRUSTED_FOR_DELEGATION                 = 0x80000\n    UF_NOT_DELEGATED                          = 0x100000\n    UF_USE_DES_KEY_ONLY                       = 0x200000\n    UF_DONT_REQUIRE_PREAUTH                   = 0x400000\n    UF_PASSWORD_EXPIRED                       = 0x800000\n    UF_TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION = 0x1000000\n    UF_NO_AUTH_DATA_REQUIRED                  = 0x2000000\n    UF_PARTIAL_SECRETS_ACCOUNT                = 0x4000000\n    UF_USE_AES_KEYS                           = 0x8000000\n\n    UF_SETTABLE_BITS = UF_SCRIPT |\n        UF_ACCOUNTDISABLE |\n        UF_LOCKOUT |\n        UF_HOMEDIR_REQUIRED |\n        UF_PASSWD_NOTREQD |\n        UF_PASSWD_CANT_CHANGE |\n        UF_ACCOUNT_TYPE_MASK |\n        UF_DONT_EXPIRE_PASSWD |\n        UF_MNS_LOGON_ACCOUNT |\n        UF_ENCRYPTED_TEXT_PASSWORD_ALLOWED |\n        UF_SMARTCARD_REQUIRED |\n        UF_TRUSTED_FOR_DELEGATION |\n        UF_NOT_DELEGATED |\n        UF_USE_DES_KEY_ONLY |\n        UF_DONT_REQUIRE_PREAUTH |\n        UF_PASSWORD_EXPIRED |\n        UF_TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION |\n        UF_NO_AUTH_DATA_REQUIRED |\n        UF_USE_AES_KEYS |\n        UF_PARTIAL_SECRETS_ACCOUNT\n\n    FILTER_TEMP_DUPLICATE_ACCOUNT    = (0x0001)\n    FILTER_NORMAL_ACCOUNT            = (0x0002)\n    FILTER_INTERDOMAIN_TRUST_ACCOUNT = (0x0008)\n    FILTER_WORKSTATION_TRUST_ACCOUNT = (0x0010)\n    FILTER_SERVER_TRUST_ACCOUNT      = (0x0020)\n\n    LG_INCLUDE_INDIRECT = (0x0001)\n\n    // etc...\n)\n\n//sys NetApiBufferFree(Buffer LPVOID) (status NET_API_STATUS) = netapi32.NetApiBufferFree\n//sys NetUserAdd(servername LMSTR, level DWORD, buf LPBYTE, parm_err LPDWORD) (status NET_API_STATUS) = netapi32.NetUserAdd\n//sys NetUserChangePassword(domainname LPCWSTR, username LPCWSTR, oldpassword LPCWSTR, newpassword LPCWSTR) (status NET_API_STATUS) = netapi32.NetUserChangePassword\n//sys NetUserDel(servername LPCWSTR, username LPCWSTR) (status NET_API_STATUS) = netapi32.NetUserDel\n//sys NetUserEnum(servername LPCWSTR, level DWORD, filter DWORD, bufptr *LPBYTE, prefmaxlen DWORD, entriesread LPDWORD, totalentries LPDWORD, resume_handle LPDWORD) (status NET_API_STATUS) = netapi32.NetUserEnum\n//sys NetUserGetGroups(servername LPCWSTR, username LPCWSTR, level DWORD, bufptr *LPBYTE, prefmaxlen DWORD, entriesread LPDWORD, totalentries LPDWORD) (status NET_API_STATUS) = netapi32.NetUserGetGroups\n//sys NetUserSetGroups(servername LPCWSTR, username LPCWSTR, level DWORD, buf LPBYTE, num_entries DWORD) (status NET_API_STATUS) = netapi32.NetUserSetGroups\n//sys NetUserSetInfo(servername LPCWSTR, username LPCWSTR, level DWORD, buf LPBYTE, parm_err LPDWORD) (status NET_API_STATUS) = netapi32.NetUserSetInfo\n</code></pre>\n\n<p>After running <code>go generate</code> (so long as you copied <code>mksyscall_windows.go</code> to the same directory) you will have a file called \"zwin32_windows.go\" (something like this):</p>\n\n<pre><code>// MACHINE GENERATED BY 'go generate' COMMAND; DO NOT EDIT\n\npackage win32\n\nimport \"unsafe\"\nimport \"syscall\"\n\nvar _ unsafe.Pointer\n\nvar (\n    modnetapi32 = syscall.NewLazyDLL(\"netapi32.dll\")\n\n    procNetApiBufferFree      = modnetapi32.NewProc(\"NetApiBufferFree\")\n    procNetUserAdd            = modnetapi32.NewProc(\"NetUserAdd\")\n    procNetUserChangePassword = modnetapi32.NewProc(\"NetUserChangePassword\")\n    procNetUserDel            = modnetapi32.NewProc(\"NetUserDel\")\n    procNetUserEnum           = modnetapi32.NewProc(\"NetUserEnum\")\n    procNetUserGetGroups      = modnetapi32.NewProc(\"NetUserGetGroups\")\n    procNetUserSetGroups      = modnetapi32.NewProc(\"NetUserSetGroups\")\n    procNetUserSetInfo        = modnetapi32.NewProc(\"NetUserSetInfo\")\n)\n\nfunc NetApiBufferFree(Buffer LPVOID) (status NET_API_STATUS) {\n    r0, _, _ := syscall.Syscall(procNetApiBufferFree.Addr(), 1, uintptr(Buffer), 0, 0)\n    status = NET_API_STATUS(r0)\n    return\n}\n\nfunc NetUserAdd(servername LMSTR, level DWORD, buf LPBYTE, parm_err LPDWORD) (status NET_API_STATUS) {\n    r0, _, _ := syscall.Syscall6(procNetUserAdd.Addr(), 4, uintptr(servername), uintptr(level), uintptr(buf), uintptr(parm_err), 0, 0)\n    status = NET_API_STATUS(r0)\n    return\n}\n\nfunc NetUserChangePassword(domainname LPCWSTR, username LPCWSTR, oldpassword LPCWSTR, newpassword LPCWSTR) (status NET_API_STATUS) {\n    r0, _, _ := syscall.Syscall6(procNetUserChangePassword.Addr(), 4, uintptr(domainname), uintptr(username), uintptr(oldpassword), uintptr(newpassword), 0, 0)\n    status = NET_API_STATUS(r0)\n    return\n}\n\nfunc NetUserDel(servername LPCWSTR, username LPCWSTR) (status NET_API_STATUS) {\n    r0, _, _ := syscall.Syscall(procNetUserDel.Addr(), 2, uintptr(servername), uintptr(username), 0)\n    status = NET_API_STATUS(r0)\n    return\n}\n\nfunc NetUserEnum(servername LPCWSTR, level DWORD, filter DWORD, bufptr *LPBYTE, prefmaxlen DWORD, entriesread LPDWORD, totalentries LPDWORD, resume_handle LPDWORD) (status NET_API_STATUS) {\n    r0, _, _ := syscall.Syscall9(procNetUserEnum.Addr(), 8, uintptr(servername), uintptr(level), uintptr(filter), uintptr(unsafe.Pointer(bufptr)), uintptr(prefmaxlen), uintptr(entriesread), uintptr(totalentries), uintptr(resume_handle), 0)\n    status = NET_API_STATUS(r0)\n    return\n}\n\nfunc NetUserGetGroups(servername LPCWSTR, username LPCWSTR, level DWORD, bufptr *LPBYTE, prefmaxlen DWORD, entriesread LPDWORD, totalentries LPDWORD) (status NET_API_STATUS) {\n    r0, _, _ := syscall.Syscall9(procNetUserGetGroups.Addr(), 7, uintptr(servername), uintptr(username), uintptr(level), uintptr(unsafe.Pointer(bufptr)), uintptr(prefmaxlen), uintptr(entriesread), uintptr(totalentries), 0, 0)\n    status = NET_API_STATUS(r0)\n    return\n}\n\nfunc NetUserSetGroups(servername LPCWSTR, username LPCWSTR, level DWORD, buf LPBYTE, num_entries DWORD) (status NET_API_STATUS) {\n    r0, _, _ := syscall.Syscall6(procNetUserSetGroups.Addr(), 5, uintptr(servername), uintptr(username), uintptr(level), uintptr(buf), uintptr(num_entries), 0)\n    status = NET_API_STATUS(r0)\n    return\n}\n\nfunc NetUserSetInfo(servername LPCWSTR, username LPCWSTR, level DWORD, buf LPBYTE, parm_err LPDWORD) (status NET_API_STATUS) {\n    r0, _, _ := syscall.Syscall6(procNetUserSetInfo.Addr(), 5, uintptr(servername), uintptr(username), uintptr(level), uintptr(buf), uintptr(parm_err), 0)\n    status = NET_API_STATUS(r0)\n    return\n}\n</code></pre>\n\n<p>Obviously most of the work is in translating the Win32 types to their Go equivalents.</p>\n\n<p>Feel free to poke around in the <code>syscall</code> package - they often have already defined structs you may be interested in.</p>\n\n<h2>ZOMG sriously??1! 2 much work!</h2>\n\n<p>Its better than writing that code by hand. And no CGo required!</p>\n\n<p><strong>Disclamer:</strong> I have not tested the above code to verify it actually does what you want. Working with the Win32 API is its own barrel of fun.</p>\n"}], "owner": {"reputation": 363, "user_id": 2656351, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2145f303214260c85edc32b3f701dd9d?s=128&d=identicon&r=PG", "display_name": "iamacarpet", "link": "https://stackoverflow.com/users/2656351/iamacarpet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1552, "favorite_count": 2, "accepted_answer_id": 35678560, "answer_count": 1, "score": 3, "last_activity_date": 1456729610, "creation_date": 1454417537, "question_id": 35154074, "link": "https://stackoverflow.com/questions/35154074/how-do-i-manage-windows-user-accounts-in-go", "title": "How do I manage Windows User Accounts in Go?", "body": "<p>I need to be able to manage Windows Local User Accounts from a Go application and it appears that without using CGo, there are no native bindings.</p>\n\n<p>My initial search led me to people saying it was best to use \"exec.Command\" to run the \"net user\" command, but that seems messy and unreliable when it comes to parsing the response codes.</p>\n\n<p>I've found the functions to handle this type of thing are in the netapi32.dll library, but with Go not natively supporting the Windows header files, it doesn't appear easy to call those functions.</p>\n\n<p>Taking an example from <a href=\"https://github.com/golang/sys/tree/master/windows\" rel=\"nofollow\">https://github.com/golang/sys/tree/master/windows</a> it appears the Go team have been redefining everything in their code then calling the DLL functions.</p>\n\n<p>I'm having a hard time wrapping it together, but I've got this template of the low level API I'm aiming for, then wrapping a higher level API on top of it, much like the core Go runtime does.</p>\n\n<pre><code>type LMSTR          ????\ntype DWORD          ????\ntype LPBYTE         ????\ntype LPDWORD        ????\ntype LPWSTR         ????\ntype NET_API_STATUS DWORD;\n\ntype USER_INFO_1 struct {\n    usri1_name              LPWSTR\n    usri1_password          LPWSTR\n    usri1_password_age      DWORD\n    usri1_priv              DWORD\n    usri1_home_dir          LPWSTR\n    usri1_comment           LPWSTR\n    usri1_flags             DWORD\n    usri1_script_path       LPWSTR\n}\n\ntype GROUP_USERS_INFO_0 struct {\n    grui0_name              LPWSTR\n}\n\ntype USER_INFO_1003 struct {\n    usri1003_password       LPWSTR\n}\n\nconst (\n    USER_PRIV_GUEST         = ????\n    USER_PRIV_USER          = ????\n    USER_PRIV_ADMIN         = ????\n\n    UF_SCRIPT               = ????\n    UF_ACCOUNTDISABLE       = ????\n    UF_HOMEDIR_REQUIRED     = ????\n    UF_PASSWD_NOTREQD       = ????\n    UF_PASSWD_CANT_CHANGE   = ????\n    UF_LOCKOUT              = ????\n    UF_DONT_EXPIRE_PASSWD   = ????\n    UF_ENCRYPTED_TEXT_PASSWORD_ALLOWED = ????\n    UF_NOT_DELEGATED        = ????\n    UF_SMARTCARD_REQUIRED   = ????\n    UF_USE_DES_KEY_ONLY     = ????\n    UF_DONT_REQUIRE_PREAUTH = ????\n    UF_TRUSTED_FOR_DELEGATION = ????\n    UF_PASSWORD_EXPIRED     = ????\n    UF_TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION = ????\n\n    UF_NORMAL_ACCOUNT       = ????\n    UF_TEMP_DUPLICATE_ACCOUNT = ????\n    UF_WORKSTATION_TRUST_ACCOUNT = ????\n    UF_SERVER_TRUST_ACCOUNT = ????\n    UF_INTERDOMAIN_TRUST_ACCOUNT = ????\n\n    NERR_Success            = ????\n    NERR_InvalidComputer    = ????\n    NERR_NotPrimary         = ????\n    NERR_GroupExists        = ????\n    NERR_UserExists         = ????\n    NERR_PasswordTooShort   = ????\n    NERR_UserNotFound       = ????\n    NERR_BufTooSmall        = ????\n    NERR_InternalError      = ????\n    NERR_GroupNotFound      = ????\n    NERR_BadPassword        = ????\n    NERR_SpeGroupOp         = ????\n    NERR_LastAdmin          = ????\n\n    ERROR_ACCESS_DENIED     = ????\n    ERROR_INVALID_PASSWORD  = ????\n    ERROR_INVALID_LEVEL     = ????\n    ERROR_MORE_DATA         = ????\n    ERROR_BAD_NETPATH       = ????\n    ERROR_INVALID_NAME      = ????\n    ERROR_NOT_ENOUGH_MEMORY = ????\n    ERROR_INVALID_PARAMETER = ????\n\n    FILTER_TEMP_DUPLICATE_ACCOUNT = ????\n    FILTER_NORMAL_ACCOUNT   = ????\n    FILTER_INTERDOMAIN_TRUST_ACCOUNT = ????\n    FILTER_WORKSTATION_TRUST_ACCOUNT = ????\n    FILTER_SERVER_TRUST_ACCOUNT = ????\n)\n\nfunc NetApiBufferFree(Buffer LPVOID) (NET_API_STATUS);\n\nfunc NetUserAdd(servername LMSTR, level DWORD, buf LPBYTE, parm_err LPDWORD) (NET_API_STATUS);\n\nfunc NetUserChangePassword(domainname LPCWSTR, username LPCWSTR, oldpassword LPCWSTR, newpassword LPCWSTR) (NET_API_STATUS);\n\nfunc NetUserDel(servername LPCWSTR, username LPCWSTR) (NET_API_STATUS);\n\nfunc NetUserEnum(servername LPCWSTR, level DWORD, filter DWORD, bufptr *LPBYTE, prefmaxlen DWORD, entriesread LPDWORD, totalentries LPDWORD, resume_handle LPDWORD) (NET_API_STATUS);\n\nfunc NetUserGetGroups(servername LPCWSTR, username LPCWSTR, level DWORD, bufptr *LPBYTE, prefmaxlen DWORD, entriesread LPDWORD, totalentries LPDWORD) (NET_API_STATUS);\n\nfunc NetUserSetGroups(servername LPCWSTR, username LPCWSTR, level DWORD, buf LPBYTE, num_entries DWORD) (NET_API_STATUS);\n\nfunc NetUserSetInfo(servername LPCWSTR, username LPCWSTR, level DWORD, buf LPBYTE, parm_err LPDWORD) (NET_API_STATUS);\n</code></pre>\n\n<p>What is the best way of wrapping this together?</p>\n"}, {"tags": ["sockets", "go", "goroutine"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1454418423, "post_id": 35153324, "comment_id": 58026941, "body": "you could create POC using both approaches and benchmark them.  I would also look at standard library.  How does go built in net/http work?? (I think number 1 from things i&#39;ve read online, but i don&#39;t really know). The source is there and easily accessible"}, {"owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 0, "creation_date": 1454418699, "post_id": 35153324, "comment_id": 58027128, "body": "Have a look at this blog post <a href=\"http://marcio.io/2015/07/handling-1-million-requests-per-minute-with-golang/\" rel=\"nofollow noreferrer\">marcio.io/2015/07/&hellip;</a>"}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 1, "creation_date": 1454418702, "post_id": 35153324, "comment_id": 58027131, "body": "<code>net&#47;http</code> actually spawn one routine per request."}], "answers": [{"tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": true, "score": 2, "last_activity_date": 1454432461, "last_edit_date": 1454432461, "creation_date": 1454418675, "answer_id": 35154478, "question_id": 35153324, "link": "https://stackoverflow.com/questions/35153324/golang-channels-vs-routine-spawn-for-performance/35154478#35154478", "title": "golang channels vs. routine spawn for performance", "body": "<p>Generally speaking, I tend to find that spawning countless routines without re-using them is wasting: even if goroutines are cheap, they aren't free, and imply a scheduling cost. </p>\n\n<p>Now, both methods have drawbacks under high load: spawning routines will cost you memory, scheduling, and may grind your program to a halt, while using channels your requests will hang until the previous one is processed.</p>\n\n<p>My usual approach is to do a batch-based pipeline (inspired by the excellent <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow\">Go Concurrency Patterns: Pipelines and cancellations</a> blog post):</p>\n\n<ul>\n<li>The listener send requests in a channel</li>\n<li>One aggregation routine put requests in a buffer</li>\n<li>N processing routines requests chunks of the bufer whenever they are free</li>\n</ul>\n\n<p>That way you can control precisely the flow and behavior of your pipeline, while keeping the advantages of multiple workers. You can easily implement an overflow mechanism by dropping the incomming requests if the buffer get over a limit size, spawn or kill new workers to acomodate the load, etc.</p>\n"}], "owner": {"reputation": 211, "user_id": 1098536, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/dd207c67ca26b003aee8f0420ba60d93?s=128&d=identicon&r=PG", "display_name": "Sam", "link": "https://stackoverflow.com/users/1098536/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2024, "favorite_count": 0, "accepted_answer_id": 35154478, "answer_count": 1, "score": 3, "last_activity_date": 1454432461, "creation_date": 1454415517, "last_edit_date": 1454415877, "question_id": 35153324, "link": "https://stackoverflow.com/questions/35153324/golang-channels-vs-routine-spawn-for-performance", "title": "golang channels vs. routine spawn for performance", "body": "<p>i was curious if anyone has analyzed the performance difference between these two paradigms.</p>\n\n<ol>\n<li><p>Have a listener goroutine (maybe a few) that listen on a socket and spawn a new goroutine to process that information and send it along to wherever it has to go. After the send command the routine will finish and will be destroyed. Every request will create a routine and then destroy it when finished.</p></li>\n<li><p>Have a listener goroutine (maybe a few) that listen on a socket and passes the data to a channel. Many goroutines are blocking on a channel receive and will take turns taking things out of the channel and processing them. When done, the routine will wait on the channel to get more information. Routines are never destroyed in this paradigm. A couple master routines receiving socket info on channels and the other routines waiting on channels to process information. Routines are never destroyed.</p></li>\n</ol>\n\n<p>The question i have is for a system that receives lots of small bits of information in a receive (0.5-1.5kb per message) but has lots of messages coming in at once (high volume, low size) what paradigm is better for speed and processing. Having a bunch of routines sitting and using channels to spread them over a bunch of listening routines? Or, creating a routing for each request and having that routine end after each request?</p>\n\n<p>even rudimentary ideology and conjecture is cool.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1454415104, "post_id": 35153010, "comment_id": 58024397, "body": "which go version are you using?"}, {"owner": {"reputation": 63, "user_id": 2253881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94294d4a3c7ed310922ed65797c54d5b?s=128&d=identicon&r=PG", "display_name": "NicG", "link": "https://stackoverflow.com/users/2253881/nicg"}, "reply_to_user": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1454415279, "post_id": 35153010, "comment_id": 58024516, "body": "sorry, 1.5.2 - locally, and whatever is running on the playground"}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 1, "creation_date": 1454416156, "post_id": 35153010, "comment_id": 58025194, "body": "I would guess this is because go doesn&#39;t randomize how goroutines are scheduled nor does the operating system randomize how it schedules threads. And the data structures/algorithms they use internally are quite deterministic. But. Add some more work into the goroutines, maybe some waiting for I/O, put some load on the system, maybe an interrupt at the wrong time and the ordering will become much less predictable."}, {"owner": {"reputation": 63, "user_id": 2253881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94294d4a3c7ed310922ed65797c54d5b?s=128&d=identicon&r=PG", "display_name": "NicG", "link": "https://stackoverflow.com/users/2253881/nicg"}, "edited": false, "score": 0, "creation_date": 1454416870, "post_id": 35153010, "comment_id": 58025757, "body": "makes sense - I suspect that it&#39;s just the fact that with &quot;no load&quot;, they seem to run in a predictable order, with all of them in the order you&#39;d expect, apart from the last one, which runs first. I am not relying on goroutines running in order, but just wanted to make sure that I wasn&#39;t missing something obvious."}, {"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "edited": false, "score": 0, "creation_date": 1454417117, "post_id": 35153010, "comment_id": 58025951, "body": "the strangeness go further - putting 1 second sleep on your <code>show</code> function changes all the order: <code>0 9 8 7 6 5 4 3 2 1</code>  <a href=\"https://play.golang.org/p/pMpOxgp59h\" rel=\"nofollow noreferrer\">play.golang.org/p/pMpOxgp59h</a> - now they are even sorted in the other order but the &#39;0&#39; come as first... why?"}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 2253881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94294d4a3c7ed310922ed65797c54d5b?s=128&d=identicon&r=PG", "display_name": "NicG", "link": "https://stackoverflow.com/users/2253881/nicg"}, "edited": false, "score": 0, "creation_date": 1454418019, "post_id": 35154059, "comment_id": 58026652, "body": "It took me 10 runs to get any change in order - but yes, If I&#39;d run it more, I&#39;d have seen this. it was the fact that the last consistently comes first (in this case) - just wanted to make sure that I didn&#39;t have some kind of warped understanding of how goroutines work...so, will accept this and close."}, {"owner": {"reputation": 63, "user_id": 2253881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94294d4a3c7ed310922ed65797c54d5b?s=128&d=identicon&r=PG", "display_name": "NicG", "link": "https://stackoverflow.com/users/2253881/nicg"}, "edited": false, "score": 0, "creation_date": 1454418120, "post_id": 35154059, "comment_id": 58026723, "body": "the comment about the playground was spot on."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1454419621, "last_edit_date": 1454419621, "creation_date": 1454417514, "answer_id": 35154059, "question_id": 35153010, "link": "https://stackoverflow.com/questions/35153010/goroutines-always-execute-last-in-first-out/35154059#35154059", "title": "goroutines always execute &quot;last in first out&quot;", "body": "<p>As expected, the ouput is pseudo-random,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"sync\"\n)\n\ntype Test struct {\n    me int\n}\n\ntype Tests []Test\n\nfunc (test *Test) show(wg *sync.WaitGroup) {\n    fmt.Println(test.me)\n    wg.Done()\n\n}\n\nfunc main() {\n    fmt.Println(\"GOMAXPROCS\", runtime.GOMAXPROCS(0))\n    var tests Tests\n    for i := 0; i &lt; 10; i++ {\n        test := Test{\n            me: i,\n        }\n        tests = append(tests, test)\n    }\n\n    var wg sync.WaitGroup\n    wg.Add(10)\n    for _, test := range tests {\n        go func(t Test) {\n            t.show(&amp;wg)\n        }(test)\n    }\n    wg.Wait()\n\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go version\ngo version devel +af15bee Fri Jan 29 18:29:10 2016 +0000 linux/amd64\n$ go run goroutine.go\nGOMAXPROCS 4\n9\n4\n5\n6\n7\n8\n1\n2\n3\n0\n$ go run goroutine.go\nGOMAXPROCS 4\n9\n3\n0\n1\n2\n7\n4\n8\n5\n6\n$ go run goroutine.go\nGOMAXPROCS 4\n1\n9\n6\n8\n4\n3\n0\n5\n7\n2\n$ \n</code></pre>\n\n<p>Are you running in the Go playground? The Go playground, by design, is deterministic, which makes it easier to cache programs.</p>\n\n<p>Or, are you running with runtime.GOMAXPROCS = 1? This runs one thing at a time, sequentially. This is what the Go playground does.</p>\n"}, {"tags": [], "owner": {"reputation": 4025, "user_id": 763799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r4nZd.jpg?s=128&g=1", "display_name": "basgys", "link": "https://stackoverflow.com/users/763799/basgys"}, "is_accepted": false, "score": 2, "last_activity_date": 1454441713, "creation_date": 1454441713, "answer_id": 35162323, "question_id": 35153010, "link": "https://stackoverflow.com/questions/35153010/goroutines-always-execute-last-in-first-out/35162323#35162323", "title": "goroutines always execute &quot;last in first out&quot;", "body": "<p>Go routines are scheduled randomly since Go 1.5. So, even if the order looks consistent, <strong>don't rely on it</strong>.</p>\n\n<p>See <a href=\"https://golang.org/doc/go1.5\" rel=\"nofollow\">Go 1.5 release</a> note :</p>\n\n<blockquote>\n  <p>In Go 1.5, the order in which goroutines are scheduled has been changed. The properties of the scheduler were never defined by the language, but programs that depend on the scheduling order may be broken by this change. We have seen a few (erroneous) programs affected by this change. If you have programs that implicitly depend on the scheduling order, you will need to update them.</p>\n  \n  <p>Another potentially breaking change is that the runtime now sets the default number of threads to run simultaneously, defined by GOMAXPROCS, to the number of cores available on the CPU. In prior releases the default was 1. Programs that do not expect to run with multiple cores may break inadvertently. They can be updated by removing the restriction or by setting GOMAXPROCS explicitly. For a more detailed discussion of this change, see the design document.</p>\n</blockquote>\n"}], "owner": {"reputation": 63, "user_id": 2253881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94294d4a3c7ed310922ed65797c54d5b?s=128&d=identicon&r=PG", "display_name": "NicG", "link": "https://stackoverflow.com/users/2253881/nicg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 2, "accepted_answer_id": 35154059, "answer_count": 2, "score": 6, "last_activity_date": 1454441713, "creation_date": 1454414625, "question_id": 35153010, "link": "https://stackoverflow.com/questions/35153010/goroutines-always-execute-last-in-first-out", "title": "goroutines always execute &quot;last in first out&quot;", "body": "<p>in the interests of learning more about Go, I have been playing with goroutines, and have noticed something - but am not sure what exactly I'm seeing, and hope someone out there might be able to explain the following behaviour.</p>\n\n<p>the following code does exactly what you'd expect:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n)\n\ntype Test struct {\n  me int\n}\n\ntype Tests []Test\n\nfunc (test *Test) show() {\n  fmt.Println(test.me)\n\n}\n\nfunc main() {\n  var tests Tests\n  for i := 0; i &lt; 10; i++ {\n    test := Test{\n      me: i,\n    }\n    tests = append(tests, test)\n  }\n\n  for _, test := range tests {\n    test.show()\n  }\n\n}\n</code></pre>\n\n<p>and prints 0 - 9, in order.</p>\n\n<p>now, when the code is changed as shown below, it always returns with the last one first - doesn't matter which numbers I use:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype Test struct {\n    me int\n}\n\ntype Tests []Test\n\nfunc (test *Test) show(wg *sync.WaitGroup) {\n    fmt.Println(test.me)\n    wg.Done()\n\n}\n\nfunc main() {\n    var tests Tests\n    for i := 0; i &lt; 10; i++ {\n        test := Test{\n            me: i,\n        }\n        tests = append(tests, test)\n    }\n\n    var wg sync.WaitGroup\n    wg.Add(10)\n    for _, test := range tests {\n        go func(t Test) {\n            t.show(&amp;wg)\n        }(test)\n    }\n    wg.Wait()\n\n}\n</code></pre>\n\n<p>this will return:\n9\n0\n1\n2\n3\n4\n5\n6\n7\n8</p>\n\n<p>the order of iteration of the loop isn't changing, so I guess that it is something to do with the goroutines...\nbasically, I am trying to understand why it behaves like this...I understand that goroutines can run in a different order than the order in which they're spawned, but, my question is why this always runs like this. as if there's something really obvious I'm missing...</p>\n"}, {"tags": ["memory", "memory-management", "go", "compression", "zlib"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1454414220, "post_id": 35152532, "comment_id": 58023788, "body": "Just run your program and read the MemStats or use gctrace to see exactly how much memory is being used <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">golang.org/pkg/runtime</a>"}, {"owner": {"reputation": 526, "user_id": 5397795, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/898232106936756/picture?type=large", "display_name": "Dharani Dharan", "link": "https://stackoverflow.com/users/5397795/dharani-dharan"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454419697, "post_id": 35152532, "comment_id": 58027824, "body": "I need clarification about my case."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454420313, "post_id": 35152532, "comment_id": 58028250, "body": "You need to run it to find out. You have provided no code, and we have no idea what the data looks like. There&#39;s no reason to guess when it&#39;s simple to run the program and see. (though, if you have exactly 1GB of data, and exactly 1GB of memory, there no room left to actually do anything)"}], "answers": [{"tags": [], "owner": {"reputation": 10392, "user_id": 2031419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FVum0.jpg?s=128&g=1", "display_name": "Glenn Randers-Pehrson", "link": "https://stackoverflow.com/users/2031419/glenn-randers-pehrson"}, "is_accepted": true, "score": 2, "last_activity_date": 1454441403, "last_edit_date": 1454441403, "creation_date": 1454429215, "answer_id": 35158250, "question_id": 35152532, "link": "https://stackoverflow.com/questions/35152532/memory-allocation-while-zlib-compressing-data/35158250#35158250", "title": "Memory allocation while zlib-compressing data?", "body": "<p>zlib itself will need a relatively trivial amount of memory, up to 256kb per thread. This will be dominated by the memory you use to store your input and output, if you are keeping those in memory.  For details, see the\n<a href=\"http://www.zlib.net/zlib_tech.html\" rel=\"nofollow\">zlib web site</a> (Look for the \"Memory Footprint\" topic).</p>\n"}], "owner": {"reputation": 526, "user_id": 5397795, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/898232106936756/picture?type=large", "display_name": "Dharani Dharan", "link": "https://stackoverflow.com/users/5397795/dharani-dharan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 400, "favorite_count": 0, "accepted_answer_id": 35158250, "answer_count": 1, "score": 0, "last_activity_date": 1454441403, "creation_date": 1454413422, "last_edit_date": 1454415939, "question_id": 35152532, "link": "https://stackoverflow.com/questions/35152532/memory-allocation-while-zlib-compressing-data", "title": "Memory allocation while zlib-compressing data?", "body": "<p><strong>Go:</strong></p>\n\n<p>Assume, there are 10 threads running in parallel to compress the 100 MB of data each. For each and every thread going to compress 100 MB of data. I am using zlib compression to compress the data.</p>\n\n<p>Consider one process took nearly 2 sec to compress the 100 MB of data. So What happens if all the threads running parallel to compress the data.</p>\n\n<p>And also i need clarification about Memory allocation for each thread.</p>\n\n<p><strong>Case 1:</strong>\nhaving 1 GB RAM memory, Now the 10 threads going to run parallel to start the compression means , Whether it will take all the RAM Memory for the process of compression?</p>\n\n<pre><code> 10 Threads * 100 MB = 1000 (Approx)\n</code></pre>\n"}, {"tags": ["windows", "service", "go", "advapi32"], "answers": [{"tags": [], "owner": {"reputation": 363, "user_id": 2656351, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2145f303214260c85edc32b3f701dd9d?s=128&d=identicon&r=PG", "display_name": "iamacarpet", "link": "https://stackoverflow.com/users/2656351/iamacarpet"}, "is_accepted": true, "score": 2, "last_activity_date": 1456406861, "last_edit_date": 1495542371, "creation_date": 1456406861, "answer_id": 35628643, "question_id": 35151052, "link": "https://stackoverflow.com/questions/35151052/how-do-i-configure-failure-actions-of-a-windows-service-written-in-go/35628643#35628643", "title": "How do I configure failure actions of a Windows service written in Go?", "body": "<p>After some guidance from <a href=\"https://stackoverflow.com/questions/22949444/using-go-golang-to-get-windows-idle-time-getlastinputinfo-or-similar\">here</a>, plus reading through the source code for the existing Go Windows Service interface, I came up with my own answer, which I'll try to document below.</p>\n\n<p>For type reference when working with the Windows DLLs, the MSDN docs are <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa383751(v=vs.85).aspx\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>My code looks like this:</p>\n\n<pre><code>import (\n    \"unsafe\"\n    \"golang.org/x/sys/windows\"\n)\n\nconst (\n    SC_ACTION_NONE                      = 0\n    SC_ACTION_RESTART                   = 1\n    SC_ACTION_REBOOT                    = 2\n    SC_ACTION_RUN_COMMAND               = 3\n\n    SERVICE_CONFIG_FAILURE_ACTIONS      = 2\n)\n\ntype SERVICE_FAILURE_ACTIONS struct {\n    ResetPeriod     uint32\n    RebootMsg       *uint16\n    Command         *uint16\n    ActionsCount    uint32\n    Actions         uintptr\n}\n\ntype SC_ACTION struct {\n    Type            uint32\n    Delay           uint32\n}\n\nfunc setServiceFailureActions(handle windows.Handle) error {\n    t := []SC_ACTION{\n        { Type: SC_ACTION_RESTART, Delay: uint32(1000) },\n        { Type: SC_ACTION_RESTART, Delay: uint32(10000) },\n        { Type: SC_ACTION_RESTART, Delay: uint32(60000) },\n    }\n    m := SERVICE_FAILURE_ACTIONS{ ResetPeriod: uint32(60), ActionsCount: uint32(3), Actions: uintptr(unsafe.Pointer(&amp;t[0])) }\n\n    return windows.ChangeServiceConfig2(handle, SERVICE_CONFIG_FAILURE_ACTIONS, (*byte)(unsafe.Pointer(&amp;m)))\n}\n</code></pre>\n\n<p>In my basic example, you need to pass a Service Handle, then it'll set the failure actions to a hard coded default of:</p>\n\n<ol>\n<li>Restart the first time after 1 second.</li>\n<li>Restart the second time after 10 seconds.</li>\n<li>Restart the third time and any subsequent times after 60 seconds.</li>\n<li>Reset the failure counter after 60 seconds.</li>\n</ol>\n\n<p>I've just tested and it seems to work ok.</p>\n"}], "owner": {"reputation": 363, "user_id": 2656351, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2145f303214260c85edc32b3f701dd9d?s=128&d=identicon&r=PG", "display_name": "iamacarpet", "link": "https://stackoverflow.com/users/2656351/iamacarpet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1435, "favorite_count": 1, "accepted_answer_id": 35628643, "answer_count": 1, "score": 4, "last_activity_date": 1456406861, "creation_date": 1454409325, "last_edit_date": 1495541887, "question_id": 35151052, "link": "https://stackoverflow.com/questions/35151052/how-do-i-configure-failure-actions-of-a-windows-service-written-in-go", "title": "How do I configure failure actions of a Windows service written in Go?", "body": "<p>I'm writing a Windows Service in Go using the <code>golang.org/x/sys/windows/svc</code> package.</p>\n\n<p>So far, it's all working great and so easy to get started with, I love it.</p>\n\n<p>I've written in some auto update functionality and I'm wanting the service to restart itself when it has completed an update.</p>\n\n<p>I've tried spawning a process that will restart the service using the <code>SCM</code>, but it logs an error message which seems to be to do with trying to control the service while running as Local System.</p>\n\n<pre><code>The service process could not connect to the service controller. \n</code></pre>\n\n<p>A better/easier way seems to be to <code>os.Exit(1)</code> and have the service <code>Failure Actions</code> set to <code>Restart on Failure</code>, which works brilliantly!</p>\n\n<p>The only trouble is, there doesn't seem to be the functionality to configure those options programatically using Go.</p>\n\n<p>I've done some digging and it looks like they are configured by passing a struct to <code>ChangeServiceConfig2</code> in <code>advapi32.dll</code> - <a href=\"https://stackoverflow.com/questions/3242505/how-to-create-service-which-restarts-on-crash\">How to create service which restarts on crash</a></p>\n\n<p>In <em>golang/sys/blob/master/windows/svc/mgr/config.go</em> - <code>func updateDescription(handle windows.Handle, desc string) error</code></p>\n\n<p>The code already calls <code>windows.ChangeServiceConfig2</code> which is a link to the DLL call.</p>\n\n<p>And the Microsoft docs for the <code>SERVICE_FAILURE_ACTIONS</code> struct are <a href=\"https://msdn.microsoft.com/en-us/library/ms685939(v=vs.85).aspx\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>I'm having trouble figuring out how to build and pass that struct using Go - does anyone have any insights?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 2865, "user_id": 3020833, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2a347de99239446083536e39c88ac46a?s=128&d=identicon&r=PG", "display_name": "letmejustfixthat", "link": "https://stackoverflow.com/users/3020833/letmejustfixthat"}, "edited": false, "score": 0, "creation_date": 1454569968, "post_id": 35152915, "comment_id": 58105966, "body": "Thanks for your answer. Maybe a comparision to OOP/Java makes my problem a bit clearer: <code>Parent</code> would be a super-type, and <code>ChildA</code> and <code>ChildB</code> subtypes of <code>Parent</code>. In Java I could create a generic collection of <code>Parent</code> like <code>Collection&lt;Parent&gt; foo = new Collection&lt;Parent&gt;();</code>. So the static type is <code>Parent</code>, I could, how ever, add dynamic types like subtypes: <code>foo.add(new ChildA());</code>. So my question actually is: Is there a concept of static &amp; dynamic types (from what I&#39;ve learnt from digging further there is no such concept)."}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "reply_to_user": {"reputation": 2865, "user_id": 3020833, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2a347de99239446083536e39c88ac46a?s=128&d=identicon&r=PG", "display_name": "letmejustfixthat", "link": "https://stackoverflow.com/users/3020833/letmejustfixthat"}, "edited": false, "score": 0, "creation_date": 1454578671, "post_id": 35152915, "comment_id": 58110975, "body": "First of all go is not Java. Have a look at <a href=\"https://github.com/luciotato/golang-notes/blob/master/OOP.md\" rel=\"nofollow noreferrer\">github.com/luciotato/golang-notes/blob/master/OOP.md</a>  Secondly, mgo uses structures to marshal/unmarshal bson documents, read the docs how embedding may affect your models. Finally, design your structures and unittest them without  database to ensure it does what you expect."}], "tags": [], "owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "is_accepted": false, "score": 0, "last_activity_date": 1454414404, "last_edit_date": 1495541246, "creation_date": 1454414404, "answer_id": 35152915, "question_id": 35149849, "link": "https://stackoverflow.com/questions/35149849/how-to-dynamically-cast-result-documents-in-mgo/35152915#35152915", "title": "How to dynamically cast result-documents in mGo", "body": "<p>First of all your <code>NestedObjects []*Parent</code> is a slice of <code>Parent</code>s, not children.</p>\n\n<p>Secondly, it is not clear how you are going to discriminate your children and what you would expect in the result of, for example, <code>Collection.Find().One(?)</code></p>\n\n<p>It may worth to read <a href=\"https://stackoverflow.com/questions/18340031/unstructured-mongodb-collections-with-mgo\">Unstructured MongoDB collections with mgo</a> for good examples of how to use <a href=\"https://godoc.org/labix.org/v2/mgo/bson\" rel=\"nofollow noreferrer\">bson.*</a> types.</p>\n"}], "owner": {"reputation": 2865, "user_id": 3020833, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2a347de99239446083536e39c88ac46a?s=128&d=identicon&r=PG", "display_name": "letmejustfixthat", "link": "https://stackoverflow.com/users/3020833/letmejustfixthat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 580, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1454414404, "creation_date": 1454406314, "question_id": 35149849, "link": "https://stackoverflow.com/questions/35149849/how-to-dynamically-cast-result-documents-in-mgo", "title": "How to dynamically cast result-documents in mGo", "body": "<p>I want to load and cast a structure from a mongoDB with a few different document types that can nest them-selfes. Let's say we have three different struct types, with one parent and two children</p>\n\n<pre><code>type Parent struct {\n    ID bson.ObjectId `bson:\"_id,omitempty`\n    Title string\n    Description string\n    NestedObjects []*Parent\n}\n\ntype ChildA struct {\n    Parent\n    DateFrom time.Time\n    DateTo time.Time\n}    \n\ntype ChildB struct {\n    Parent\n    Options []string\n}    \n</code></pre>\n\n<p>The idea is to have a root-document holding other <code>ChildA</code> or <code>ChildB</code> documents. So an example document could look like this:</p>\n\n<pre><code>{\n    \"Title\": \"test event\",\n    \"Description\": \"description goes here\",\n    \"NestedObjects\": [\n        {\n            \"Title\": \"test event\",\n            \"Description\": \"description goes here\",\n            \"NestedObjects\": [],\n            \"Options\": [\"foo\", \"bar\"]\n        }\n    ],\n    DateFrom: ISODate(...),\n    DateTo: ISODate(...)\n}\n</code></pre>\n\n<p>How can I now cast them dynamically into a struct (of the correct type)? The root-document is of the Type <code>ChildA</code> and the first nested document of the type <code>ChildB</code>. And the result I want is some kind of static type <code>[]Parent</code> which can be dynamically be casted to the sub types, somehow like this (pseudo-code)</p>\n\n<pre><code>for _ ele := range results {\n    if ele typeof ChildA {\n       ...\n    }\n    if ele typeof ChildB {\n       ...\n    }\n}\n</code></pre>\n\n<p>(Just for some explaination: I want to build events like ToDo Lists, Polls, and some others which can contain each other. So like a event \"Netflix&amp;chill\" can have a Poll &amp; ToDos, example: ToDos: \"Buy popcorn\", \"Decide which movie to watch -> [Poll: \"Jurassic Park\", \"Inception\", ...]\".)</p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1454395694, "post_id": 35146671, "comment_id": 58012724, "body": "If you have no already done so, run your program with the <a href=\"http://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">race detector</a> enabled. It might flag some issues in your application. Separate from whatever this problem is, take a look at the <a href=\"https://github.com/gorilla/websocket\" rel=\"nofollow noreferrer\">Gorilla Websocket Package</a>.  The Gorilla package is better <a href=\"https://github.com/gorilla/websocket#gorilla-websocket-compared-with-other-packages\" rel=\"nofollow noreferrer\">maintained and has better protocol compliance than the x/net/websocket package</a>."}, {"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1454396024, "post_id": 35146671, "comment_id": 58012858, "body": "Looks like <code>webSocketClients[]</code> is a global array that&#39;s accessed from multiple goroutines (each socket handler HTTP request is its own goroutine). You&#39;ll need to use channels or mutexes to synchronise access to <code>webSocketClients[]</code> as concurrent access is not safe."}, {"owner": {"reputation": 442, "user_id": 1251469, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/e6b775c55bcf32d02c62446b6bb48ef6?s=128&d=identicon&r=PG", "display_name": "sorabh solanki", "link": "https://stackoverflow.com/users/1251469/sorabh-solanki"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1454397057, "post_id": 35146671, "comment_id": 58013321, "body": "@MuffinTop sure i will run my program with race detector. I have looked into the Gorilla API, but the problem is how can i use the same websocket connection to send the message, as send message will be called as a separate unit. To cater this problem i kept this webscoket object in an array."}, {"owner": {"reputation": 442, "user_id": 1251469, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/e6b775c55bcf32d02c62446b6bb48ef6?s=128&d=identicon&r=PG", "display_name": "sorabh solanki", "link": "https://stackoverflow.com/users/1251469/sorabh-solanki"}, "reply_to_user": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1454397124, "post_id": 35146671, "comment_id": 58013347, "body": "@Nadh thanks. For the time being i have only one client, but i will make use of mutexes for synchronization."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1454398313, "post_id": 35146671, "comment_id": 58013952, "body": "This is off track from the question, but the gorilla/websocket package has all of the functionality of the x/net/websocket package and more.  Even if you don&#39;t choose to use the gorilla package, you might want to take a peek at the  <a href=\"https://github.com/gorilla/websocket#documentation\" rel=\"nofollow noreferrer\">examples</a>. They are a good starting point for many types of applications can can be adapted to use x/net/websocket (after stripping important functionality like pinging)."}], "answers": [{"tags": [], "owner": {"reputation": 357, "user_id": 3201908, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c40ecb54450d141b033a1acc20380c32?s=128&d=identicon&r=PG", "display_name": "Pawel Kowalak", "link": "https://stackoverflow.com/users/3201908/pawel-kowalak"}, "is_accepted": false, "score": 1, "last_activity_date": 1454413842, "creation_date": 1454413842, "answer_id": 35152694, "question_id": 35146671, "link": "https://stackoverflow.com/questions/35146671/golang-websocket-nil-memory-error/35152694#35152694", "title": "Golang websocket nil memory error", "body": "<p>Pinging websocket connection on interval is normal thing to do, please check how it's done in <a href=\"https://github.com/gorilla/websocket/tree/master/examples/chat\" rel=\"nofollow\">Gorilla Websocket Chat Example</a>. I know you're using <code>net/websocket</code>, but the idea should be similar. The problem is that you can't rely that your long-time TCP connection will remain active, especially in public networks. Some firewalls silently RST connections without traffic flow after some period of time.</p>\n"}], "owner": {"reputation": 442, "user_id": 1251469, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/e6b775c55bcf32d02c62446b6bb48ef6?s=128&d=identicon&r=PG", "display_name": "sorabh solanki", "link": "https://stackoverflow.com/users/1251469/sorabh-solanki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1454676904, "creation_date": 1454395070, "last_edit_date": 1454676904, "question_id": 35146671, "link": "https://stackoverflow.com/questions/35146671/golang-websocket-nil-memory-error", "title": "Golang websocket nil memory error", "body": "<p>Below is the code of my websocket server.</p>\n\n<pre><code>http.Handle(\"/gatewayconnector\", websocket.Handler(socketHandler))\n</code></pre>\n\n<p>Method socketHandler has the code below:</p>\n\n<pre><code>func socketHandler(ws *websocket.Conn) {\n    LoadClient(ws)\n    var msg []byte\n    for {\n        if err := websocket.Message.Receive(ws, &amp;msg); err != nil {\n            log.Error(\"Error in socketHandler: \", err)\n            break\n        }\n        validateMessage(msg)\n    }\n}\n</code></pre>\n\n<p>The socket handler call back method get called when handshake happened from client and it also initiate the websocket object. So at very first step of this method i stored this websocket object into an array, so that i can retrieve it at the send method call (<strong>used to send message to client</strong>). </p>\n\n<p><strong>The issue is sometimes I'm getting nil memory reference in ws i.e. the websocket while trying to send some message to client.</strong></p>\n\n<p>Below is the send method code:</p>\n\n<pre><code>func Send(msg interface{}) error {\n    ws := webSocketClients[0]\n    if (ws == nil) {\n        log.Error(\"Websocket connection is nil, gateway should initiate the connection.\")\n    }\n    return websocket.JSON.Send(ws, msg)\n}\n</code></pre>\n\n<p><strong>This issue arises when websocket connection remanis idle for a longer persiod of time and I call directly the send method.</strong></p>\n\n<p>Right now i have put one hack that client will ping my websocket server at regular interval to avoid this.</p>\n\n<p>How to avoid this kind of problem?</p>\n"}, {"tags": ["parsing", "time", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1454397612, "post_id": 35146579, "comment_id": 58013605, "body": "<code>t2, _ := time.Parse()</code>. The &quot;error&quot; is with you omitting the returned <code>error</code> (the 2nd return value is an <code>error</code>). Never omit errors. Would you have printed it, you would have seen: <code>hour out of range</code>"}], "answers": [{"tags": [], "owner": {"reputation": 3874, "user_id": 227556, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/39c93c540c86e33f2c9a3dfd581206e6?s=128&d=identicon&r=PG", "display_name": "shauvik", "link": "https://stackoverflow.com/users/227556/shauvik"}, "is_accepted": false, "score": 1, "last_activity_date": 1454394688, "creation_date": 1454394688, "answer_id": 35146580, "question_id": 35146579, "link": "https://stackoverflow.com/questions/35146579/go-time-parse-returning-different-values/35146580#35146580", "title": "Go time parse returning different values", "body": "<p>Found my mistake. The layout expects a 24 hour times.\nFixed with:</p>\n\n<pre><code>layout := \"Mon, 2 Jan 2006 15:04:05 -0700 (MST)\"\n</code></pre>\n"}], "owner": {"reputation": 3874, "user_id": 227556, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/39c93c540c86e33f2c9a3dfd581206e6?s=128&d=identicon&r=PG", "display_name": "shauvik", "link": "https://stackoverflow.com/users/227556/shauvik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1459896100, "creation_date": 1454394688, "last_edit_date": 1459896100, "question_id": 35146579, "link": "https://stackoverflow.com/questions/35146579/go-time-parse-returning-different-values", "title": "Go time parse returning different values", "body": "<p>I'm facing an issue where Go time parse is returning different values for two times in the same timezone.</p>\n\n<pre><code>func timeParse() {\n    layout := \"Mon, 2 Jan 2006 03:04:05 -0700 (MST)\"\n\n    value1 := \"Mon, 18 Jan 2016 01:48:52 -0800 (PST)\"\n    value2 :=  \"Tue, 19 Jan 2016 17:49:33 -0800 (PST)\"\n\n    t1, _ := time.Parse(layout, value1)\n    fmt.Println(t1)\n\n    t2, _ := time.Parse(layout, value2)\n    fmt.Println(t2)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2016-01-18 01:48:52 -0800 PST\n0001-01-01 00:00:00 +0000 UTC\n</code></pre>\n\n<p>Notice that the second one didn't parse properly.</p>\n"}, {"tags": ["pointers", "go", "constants"], "answers": [{"comments": [{"owner": {"reputation": 2388, "user_id": 1752114, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/778377fd64568f1a23968400a7477306?s=128&d=identicon&r=PG", "display_name": "Arvind", "link": "https://stackoverflow.com/users/1752114/arvind"}, "edited": false, "score": 1, "creation_date": 1454396982, "post_id": 35146856, "comment_id": 58013291, "body": "so we can not find the address of constant :)"}, {"owner": {"reputation": 1863, "user_id": 226630, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3197aa6cd4214fa0839e66bda0246438?s=128&d=identicon&r=PG", "display_name": "dSebastien", "link": "https://stackoverflow.com/users/226630/dsebastien"}, "edited": false, "score": 0, "creation_date": 1531606514, "post_id": 35146856, "comment_id": 89660843, "body": "At least the constant is constant, the world is safe :)"}, {"owner": {"reputation": 1744, "user_id": 4372452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OlDV3.png?s=128&g=1", "display_name": "mtraceur", "link": "https://stackoverflow.com/users/4372452/mtraceur"}, "edited": false, "score": 0, "creation_date": 1580270331, "post_id": 35146856, "comment_id": 106038613, "body": "The second reason is wrong, unless Go intentionally supports runtimes with no MMU (in which case that should be said explicitly to make the reason not wrong): Preventing taking an address is not necessary to keep a value in memory constant - such constants could be stored in a memory page marked read-only. Every modern operating system running on hardware with an MMU can do this, and in fact does by default for many of the memory pages that the process starts with."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1744, "user_id": 4372452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OlDV3.png?s=128&g=1", "display_name": "mtraceur", "link": "https://stackoverflow.com/users/4372452/mtraceur"}, "edited": false, "score": 0, "creation_date": 1580286201, "post_id": 35146856, "comment_id": 106043103, "body": "@mtraceur Whether it&#39;s possible to mark the memory read-only falls outside of Go&#39;s grammar. If you have a non-<code>nil</code> pointer and you assign something to the pointed value, you expect it to change.  The spec does not allow &quot;conditional success&quot; of such assignment."}, {"owner": {"reputation": 1744, "user_id": 4372452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OlDV3.png?s=128&g=1", "display_name": "mtraceur", "link": "https://stackoverflow.com/users/4372452/mtraceur"}, "edited": false, "score": 0, "creation_date": 1580290956, "post_id": 35146856, "comment_id": 106045598, "body": "@icza I don&#39;t see how that has anything to do with what I said. Where did you get anything about conditional success? Conditional success is not necessary for nor logically implied by  anything I said, and I cannot even word how infuriatingly frustrating it is for me to communicate with someone who managed to think their way to this response to my comment, so I&#39;m gonna just walk away from this until maybe one day I have the patience to try to clarify constructively."}, {"owner": {"reputation": 1744, "user_id": 4372452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OlDV3.png?s=128&g=1", "display_name": "mtraceur", "link": "https://stackoverflow.com/users/4372452/mtraceur"}, "edited": false, "score": 0, "creation_date": 1580292932, "post_id": 35146856, "comment_id": 106046705, "body": "Go&#39;s authors had other options, as language designers, to help the runtime keep constants constant. So it is wrong to just say it is a reason for doing so, because by itself that is not sufficient reason to do that, yet saying it like that implies that it logically is sufficient - but there must also be additional reasoning to prefer that to the other viable alternatives. That additional reasoning was probably that they prefered to not do any of the other alternatives because they would impose more complexity or special cases or {implementation ,un}defined behavior to the language."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1744, "user_id": 4372452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OlDV3.png?s=128&g=1", "display_name": "mtraceur", "link": "https://stackoverflow.com/users/4372452/mtraceur"}, "edited": false, "score": 0, "creation_date": 1580294094, "post_id": 35146856, "comment_id": 106047392, "body": "@mtraceur Robert Griesemer (one of Go&#39;s authors) wrote why it&#39;s not allowed to take a string literal&#39;s address: &quot;<i>If you could take the address of a string constant, you could call a function [that assigns to the pointed value resulting in]  possibly strange effects - you certainly wouldn&#39;t want the literal string constant to change.&quot;</i> <a href=\"https://groups.google.com/d/msg/golang-nuts/mKJbGRRJm7c/K3k3x6-huw4J\" rel=\"nofollow noreferrer\">source</a>"}, {"owner": {"reputation": 1744, "user_id": 4372452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OlDV3.png?s=128&g=1", "display_name": "mtraceur", "link": "https://stackoverflow.com/users/4372452/mtraceur"}, "edited": false, "score": 0, "creation_date": 1580343008, "post_id": 35146856, "comment_id": 106070343, "body": "@icza Thank you. I thought this might come up. His own reasoning would be wrong in the sense of &quot;logically incomplete&quot; <b>if</b> his reasoning is <i>completely</i> represented by that quote and didn&#39;t include other thinking about why to prefer the way of disallowing address-taking given the tradeoffs of other alternatives. It does mean that you would be correct to say that it is this way because one of the creators working on the language thought this. But personally I would explicitly indicate that by quoting and citing it to not implicitly endorse it as objectively sound reasoning <i>in isolation</i>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 43, "last_activity_date": 1580371634, "last_edit_date": 1580371634, "creation_date": 1454395859, "answer_id": 35146856, "question_id": 35146286, "link": "https://stackoverflow.com/questions/35146286/find-address-of-constant-in-go/35146856#35146856", "title": "Find address of constant in go", "body": "<p>In short: <strong>you can't</strong>.</p>\n\n<p>The error message says:</p>\n\n<blockquote>\n  <p>cannot take the address of k</p>\n</blockquote>\n\n<p>There are limitations on the operand of the address operator <code>&amp;</code>. <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"noreferrer\">Spec: Address operators:</a></p>\n\n<blockquote>\n  <p>For an operand <code>x</code> of type <code>T</code>, the address operation <code>&amp;x</code> generates a pointer of type <code>*T</code> to <code>x</code>. The operand must be <em>addressable</em>, that is, either a variable, pointer indirection, or slice indexing operation; or a field selector of an addressable struct operand; or an array indexing operation of an addressable array. As an exception to the addressability requirement, <code>x</code> may also be a (possibly parenthesized) <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"noreferrer\">composite literal</a>. If the evaluation of <code>x</code> would cause a <a href=\"https://golang.org/ref/spec#Run_time_panics\" rel=\"noreferrer\">run-time panic</a>, then the evaluation of <code>&amp;x</code> does too.</p>\n</blockquote>\n\n<p>Constants are <strong>not</strong> listed as <em>addressable</em>, and things that are not listed in the spec as <em>addressable</em> (quoted above) <strong>cannot</strong> be the operand of the address operator <code>&amp;</code> (you can't take the address of them).</p>\n\n<p>It is not allowed to take the address of a constant. This is for 2 reasons:</p>\n\n<ol>\n<li>A constant may not have an address at all.</li>\n<li>And even if a constant value is stored in memory at runtime, this is to help the runtime to keep constants that: <em>constant</em>. If you could take the address of a constant value, you could assign the address (pointer) to a variable and you could change that (the pointed value, the value of the constant). Robert Griesemer (one of Go's authors) wrote why it's not allowed to take a string literal's address: <em>\"If you could take the address of a string constant, you could call a function [that assigns to the pointed value resulting in] possibly strange effects - you certainly wouldn't want the literal string constant to change.\"</em> (<a href=\"https://groups.google.com/d/msg/golang-nuts/mKJbGRRJm7c/K3k3x6-huw4J\" rel=\"noreferrer\">source</a>)</li>\n</ol>\n\n<p>If you need a pointer to a value being equal to that constant, assign it to a variable of which is addressable so you can take its address, e.g.</p>\n\n<pre><code>func main() {\n    const k = 5\n    v := k\n    address := &amp;v // This is allowed\n}\n</code></pre>\n\n<p>But know that in Go numeric constants represent values of arbitrary precision and do not overflow. When you assign the value of a constant to a variable, it may not be possible (e.g. the constant may be greater than the max value of the variable's type you're assigning it to - resulting in compile-time error), or it may not be the same (e.g. in case of floating point constants, it may lose precision).</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1454412111, "post_id": 35149723, "comment_id": 58022342, "body": "Not all constants are untyped. There are <i>typed</i> and <i>untyped</i> constants."}], "tags": [], "owner": {"reputation": 956, "user_id": 1207791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f097e2409f02bfcaf6f53cfca268401f?s=128&d=identicon&r=PG", "display_name": "cfstras", "link": "https://stackoverflow.com/users/1207791/cfstras"}, "is_accepted": false, "score": -3, "last_activity_date": 1454405951, "creation_date": 1454405951, "answer_id": 35149723, "question_id": 35146286, "link": "https://stackoverflow.com/questions/35146286/find-address-of-constant-in-go/35149723#35149723", "title": "Find address of constant in go", "body": "<p>What the <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow\">constants</a> section does not make very clear: Constants are, unlike variables, not present in the compiled code or running program. They are <strong>untyped</strong> and will only be in memory once they are assigned to a variable.</p>\n\n<p>As a result, they seem<sup>1</sup> to have infinite precision. If you look at <a href=\"http://play.golang.org/p/OZH9FHSBDS\" rel=\"nofollow\">this example</a>, you can see that I can assign the constant to a variable without casting it, and the variable will hold as much of the constants precision as it can.</p>\n\n<hr>\n\n<p><sup>1</sup> As the <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow\">spec</a> also points out, integers have at least 256 bits, floats at least 256 bits mantissa and 32 bits exponent, and the compiler will throw an error if its internal constructs cannot accurately store a constant.\n</p>\n"}, {"tags": [], "owner": {"reputation": 2080, "user_id": 3100456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3749442ae7500c62ca244a0631024055?s=128&d=identicon&r=PG&f=1", "display_name": "Orphid", "link": "https://stackoverflow.com/users/3100456/orphid"}, "is_accepted": false, "score": 13, "last_activity_date": 1612905802, "last_edit_date": 1612905802, "creation_date": 1553414970, "answer_id": 55321839, "question_id": 35146286, "link": "https://stackoverflow.com/questions/35146286/find-address-of-constant-in-go/55321839#55321839", "title": "Find address of constant in go", "body": "<p>I often hit this problem when creating large, nested JSON objects during unit tests. I might have a structure where all the fields are pointers to strings/ints:</p>\n<pre><code>type Obj struct {\n    Prop1  *string\n    Prop2  *int\n    Status *string\n}\n</code></pre>\n<p>and want to write something like:</p>\n<pre><code>obj := Obj{\n    Prop1:  &amp;&quot;a string property&quot;,\n    Prop2:  &amp;5,\n    Status: &amp;statuses.Awesome,\n}\n</code></pre>\n<p>When I initialise it, but the language doesn't allow this directly. A quick way to bypass this is to define a function that takes a constant and returns its address:</p>\n<pre><code> s := func(s string) *string { return &amp;s }\n i := func(i int) *int { return &amp;i }\n\n obj := Obj{\n    Prop1:  s(&quot;a string property&quot;),\n    Prop2:  i(5),\n    Status: s(statuses.Awesome)\n}\n</code></pre>\n<p>This works due to the fact that when the constant is passed as a parameter to the function, a copy of the constant is made which means the pointer created in the function does not point to the address of the constant, but to the address of its copy, in the same way as when a constant value is assigned to a <code>var</code>. However, using a function to do this makes it more readable/less cumbersome IMO than having to forward declare large blocks of variables.</p>\n<p>The AWS SDK uses <a href=\"https://github.com/aws/aws-sdk-go/blob/9d10b7469ebfe21f9ab825461b034f5ac6fc4b8b/aws/convert_types.go#L64\" rel=\"nofollow noreferrer\">this technique</a>. I now find myself regularly adding a package to my projects that looks something like:</p>\n<pre><code>package ref\n\nimport &quot;time&quot;\n\nfunc Bool(i bool) *bool {\n    return &amp;i\n}\n\nfunc Int(i int) *int {\n    return &amp;i\n}\n\nfunc Int64(i int64) *int64 {\n    return &amp;i\n}\n\nfunc String(i string) *string {\n    return &amp;i\n}\n\nfunc Duration(i time.Duration) *time.Duration {\n    return &amp;i\n}\n\nfunc Strings(ss []string) []*string {\n    r := make([]*string, len(ss))\n    for i := range ss {\n        r[i] = &amp;ss[i]\n    }\n    return r\n}\n</code></pre>\n<p>Which I call in the following way:</p>\n<pre><code>func (t: Target) assignString(to string, value string) {\n    if to == tags.AuthorityId {\n        t.authorityId = ref.String(value)\n    }\n    // ...\n}\n</code></pre>\n<p>You can also add a <code>deref</code> package, though I have generally found this to be less useful:</p>\n<pre><code>package deref\n\nfunc String(s *string, d string) string {\n    if s != nil { return *s }\n    return d\n}\n\n// more derefs here.\n</code></pre>\n"}], "owner": {"reputation": 2388, "user_id": 1752114, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/778377fd64568f1a23968400a7477306?s=128&d=identicon&r=PG", "display_name": "Arvind", "link": "https://stackoverflow.com/users/1752114/arvind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16098, "favorite_count": 7, "accepted_answer_id": 35146856, "answer_count": 3, "score": 26, "last_activity_date": 1612905802, "creation_date": 1454393515, "last_edit_date": 1454396381, "question_id": 35146286, "link": "https://stackoverflow.com/questions/35146286/find-address-of-constant-in-go", "title": "Find address of constant in go", "body": "<p>We have written one program by which we try to find an address of a constant. Is it possible to do it like that?</p>\n\n<pre><code>package main\n\nfunc main() {\n        const k = 5\n        address := &amp;k\n}\n</code></pre>\n\n<p>It gives an error, can anyone tell how can we find the address of a constant?</p>\n"}, {"tags": ["function", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1454387462, "post_id": 35144998, "comment_id": 58009950, "body": "<code>return io.ReadCloser</code> instead of <code>return []byte</code>. I <i>strongly</i> suggest running through <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">tour.golang.org</a> from start to finish."}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 1, "creation_date": 1454387924, "post_id": 35144998, "comment_id": 58010070, "body": "You should take more time to write better question and code. The functions&#39; signatures aren&#39;t even correct without the argument&#39;s type."}, {"owner": {"reputation": 821, "user_id": 3314723, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/YHenk.png?s=128&g=1", "display_name": "cfernandezlinux", "link": "https://stackoverflow.com/users/3314723/cfernandezlinux"}, "edited": false, "score": 0, "creation_date": 1454466647, "post_id": 35144998, "comment_id": 58053161, "body": "pie it was just a on the fly example to not actually copy paste the real stuff. but thanks to your response below I got it working. thanks."}], "answers": [{"comments": [{"owner": {"reputation": 821, "user_id": 3314723, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/YHenk.png?s=128&g=1", "display_name": "cfernandezlinux", "link": "https://stackoverflow.com/users/3314723/cfernandezlinux"}, "edited": false, "score": 0, "creation_date": 1454466595, "post_id": 35145276, "comment_id": 58053147, "body": "thanks! that was it :) now I understand this better. thank you."}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "reply_to_user": {"reputation": 821, "user_id": 3314723, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/YHenk.png?s=128&g=1", "display_name": "cfernandezlinux", "link": "https://stackoverflow.com/users/3314723/cfernandezlinux"}, "edited": false, "score": 1, "creation_date": 1454469824, "post_id": 35145276, "comment_id": 58054009, "body": "@cfernandezlinux please accept it as the answer thanks."}], "tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": true, "score": 1, "last_activity_date": 1454388569, "creation_date": 1454388569, "answer_id": 35145276, "question_id": 35144998, "link": "https://stackoverflow.com/questions/35144998/golang-http-get-returns/35145276#35145276", "title": "golang: http.get() returns", "body": "<p><code>myfunction</code> has the wrong return type. Instead of <code>[]byte</code> it should return <code>*http.Response</code>.</p>\n\n<pre><code>func myfunction(site string) *http.Response {\n        resp, err := client.Get(site) \n        if err != nil {\n                log.Fatal(err)\n        }\n\n        return resp\n}\n</code></pre>\n"}], "owner": {"reputation": 821, "user_id": 3314723, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/YHenk.png?s=128&g=1", "display_name": "cfernandezlinux", "link": "https://stackoverflow.com/users/3314723/cfernandezlinux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2236, "favorite_count": 1, "accepted_answer_id": 35145276, "answer_count": 1, "score": 0, "last_activity_date": 1454388662, "creation_date": 1454386928, "last_edit_date": 1454388662, "question_id": 35144998, "link": "https://stackoverflow.com/questions/35144998/golang-http-get-returns", "title": "golang: http.get() returns", "body": "<p>ok so yes im new to golang, but not to coding, I'm a bit confused with the way functions are working with golang, in this 2 weeks I have 9 times out or 10 I had an issue it was related to funtions... I'm no lazy I have search all over for examples to inspire me, but they are all under one main() funtion.\nI'm trying to have a http.get in one funtion and many other functions call this funtion everytime we need to use http.get so we dont repeat code over and over.. example:(this is not the actual code)</p>\n\n<pre><code>func myfunction(site) []byte {\n        resp, err := client.Get(site) // client is because Im tunneling thing on a proxy TOR and had to create some helpers.. but this is working ok.\n\n        return resp\n}\n\nfunc magic(staff) string {\n        // do things and create websiteurl with staff and onther contants\n        site := myfunction(website)\n        contents, err := html.Parse(site.Body)\n        //....\n        //....\n        return  result\n}\n\nmain() {\n\n        //... stuff happens :)\n}\n</code></pre>\n\n<p>well the error is for example because I keep changing things around and getting different errors. or not at all.. but then no result..</p>\n\n<p>cannot use <code>resp.Body</code> (type io.ReadCloser) as type <code>[]byte</code> in return argument\n./gobot.go:71: cannot use site (type []byte) as type io.Reader in argument to html.Parse:</p>\n\n<p>when I do not get an error that is how I did it the first time the Site.Body\nwill do nothing when parsing... I put a couple of debug prints to STDOUT and I had results like two sequence of numbers.</p>\n\n<p>so basically how do I return a \"result\" of my query from one function to the original so it can then be parse and used? \nI hate to repeat code so trying to keep the repetitive code in one function and have it get it call when needed it.</p>\n\n<p>thanks</p>\n"}, {"tags": ["html", "templates", "go", "lexer"], "answers": [{"comments": [{"owner": {"reputation": 442, "user_id": 3158232, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ol4CR.jpg?s=128&g=1", "display_name": "deankarn", "link": "https://stackoverflow.com/users/3158232/deankarn"}, "edited": false, "score": 0, "creation_date": 1454382810, "post_id": 35143713, "comment_id": 58008729, "body": "Thanks! Seems so silly now, I did try changing the header like you did but didn&#39;t even think to also make the change to the content."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1454377852, "creation_date": 1454377852, "answer_id": 35143713, "question_id": 35143278, "link": "https://stackoverflow.com/questions/35143278/golang-html-template-executetemplate-errant-byte-where-is-it-coming-from/35143713#35143713", "title": "golang html/template ExecuteTemplate errant byte where is it coming from?", "body": "<p>Because template content starts immediately following the closing braces in the define directive, the root, header and footer templates start with a newline.</p>\n\n<p>The single newline is written at the start because the template flushes output before invoking a sub-template.</p>\n\n<p>Change the definitions to start with </p>\n\n<pre><code>header = `{{define \"header\"}}&lt;!DOCTYPE html&gt;\n...\ncontent = `{{define \"root\"}}{{template \"header\" .}}\n</code></pre>\n\n<p>to eliminate the extra newlines.</p>\n\n<p>See <a href=\"https://play.golang.org/p/AzD98cD7c0\" rel=\"nofollow\">https://play.golang.org/p/AzD98cD7c0</a> for a fix.</p>\n"}], "owner": {"reputation": 442, "user_id": 3158232, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ol4CR.jpg?s=128&g=1", "display_name": "deankarn", "link": "https://stackoverflow.com/users/3158232/deankarn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 35143713, "answer_count": 1, "score": 0, "last_activity_date": 1454378024, "creation_date": 1454374787, "question_id": 35143278, "link": "https://stackoverflow.com/questions/35143278/golang-html-template-executetemplate-errant-byte-where-is-it-coming-from", "title": "golang html/template ExecuteTemplate errant byte where is it coming from?", "body": "<p><strong>Background</strong>\nI was trying to write some GZIP middleware for Go, but ran into a problem as http.DetectContentType() was returning text/plain instead of text/html so I tracked it down to the first text being written was some sort or errant byte, that I am still trying to track down. I know there are lots of ways around it, like setting the ContentType explicitly or using a bytes.Buffer when Executing the template and writing all at once, but I really want to find out what is causing this single byte to be written.</p>\n\n<p><strong>Example</strong>\nHere is a very contrived example that shows the same issue <a href=\"https://play.golang.org/p/SSrWP9jLRq\" rel=\"nofollow\">https://play.golang.org/p/SSrWP9jLRq</a> </p>\n\n<p>when run you will see the first thing that is printed is: \"LEN BYTES: 1 String: \"</p>\n\n<p><strong>Suspects</strong>\nIt appears, as the example shows, that this line \"{{template \"header\" .}}\" within the content template is the culprit, but why would it be outputting this extra content.</p>\n\n<p><strong>Question</strong>\nDoes anybody know where this errant byte is coming from? see the html header, footer and content templates in the example.</p>\n"}, {"tags": ["http", "go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1454373122, "creation_date": 1454373122, "answer_id": 35143028, "question_id": 35143009, "link": "https://stackoverflow.com/questions/35143009/http-response-iteration-in-go/35143028#35143028", "title": "http response iteration in go", "body": "<p>You can use <a href=\"https://godoc.org/bytes#Split\" rel=\"nofollow\">bytes.Split</a> to break the response body into lines:</p>\n\n<pre><code> lines := bytes.Split(body, []byte{'\\n'})  // lines is a [][]byte\n</code></pre>\n\n<p>You can also use a <a href=\"https://godoc.org/bufio#Scanner\" rel=\"nofollow\">scanner</a> to iterate over the lines:</p>\n\n<pre><code>response, err := client.Do(request)\nif err != nil {\n    log.Errorf(\"Error with request: %s\", err)\n}\ndefer response.Body.Close()\ns := bufio.NewScanner(response.Body)\nfor s.Scan() {\n    // do something with s.Bytes() or s.Text()\n}\nif err := s.Err(); err != nil {\n    // handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 560, "favorite_count": 0, "accepted_answer_id": 35143028, "answer_count": 1, "score": 2, "last_activity_date": 1454373122, "creation_date": 1454372993, "question_id": 35143009, "link": "https://stackoverflow.com/questions/35143009/http-response-iteration-in-go", "title": "http response iteration in go", "body": "<p>I have an HTTP endpoint that returns lines of text. Here is how I'm fetching it.</p>\n\n<pre><code>response, err := client.Do(request)\nif err != nil {\n    log.Errorf(\"Error with request: %s\", err)\n}\ndefer response.Body.Close()\nbody, err := ioutil.ReadAll(response.Body)\nif err != nil {\n    log.Errorf(\"Error: %s\", err)\n}\n</code></pre>\n\n<p>This is how I'm reading the body. The problem is that I have one large byte array from the reader, but I'm not entirely sure how to convert it from a byte array to a slice of lines.</p>\n\n<p>How would I convert the byte array to a slice of lines?</p>\n"}, {"tags": ["go", "gofmt"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 17, "last_activity_date": 1618537413, "last_edit_date": 1618537413, "creation_date": 1454370296, "answer_id": 35142573, "question_id": 35142532, "link": "https://stackoverflow.com/questions/35142532/how-to-split-long-lines-for-fmt-sprintf/35142573#35142573", "title": "how to split long lines for fmt.sprintf", "body": "<p>Use <a href=\"https://golang.org/ref/spec#String_concatenation\" rel=\"nofollow noreferrer\">string concatenation</a> to construct a single string value on multiple lines:</p>\n<pre><code> fmt.Sprintf(&quot;a:%s, b:%s &quot; +\n    &quot; ...... this goes really long&quot;,\n    s1, s2)\n</code></pre>\n<p>The long string in this example is built at compile time because the string concatenation is a constant expression.</p>\n<p>You can split the string at contained newlines using a <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">raw string literal</a>:</p>\n<pre><code>     fmt.Sprintf(`this text is on the first line\nand this text is on the second line,\nand third`)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1199, "user_id": 3168770, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/8lafT.jpg?s=128&g=1", "display_name": "Paulo", "link": "https://stackoverflow.com/users/3168770/paulo"}, "is_accepted": false, "score": 1, "last_activity_date": 1454370386, "last_edit_date": 1454370386, "creation_date": 1454370305, "answer_id": 35142576, "question_id": 35142532, "link": "https://stackoverflow.com/questions/35142532/how-to-split-long-lines-for-fmt-sprintf/35142576#35142576", "title": "how to split long lines for fmt.sprintf", "body": "<p>Why don't you split it out:</p>\n\n<pre><code>fmt.Sprintf(\"a:%s, b:%s \", x1, x2)\n\nfmt.Sprintf(\"...... \")\n\nfmt.Sprintf(\"this goes really long\")\n</code></pre>\n\n<p>Or you can split them out with the plus sign as indicated by MuffinTop.</p>\n"}, {"comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1454374917, "post_id": 35142631, "comment_id": 58006700, "body": "Seems like it would be better to concatenate the strings so the long string is built at compile time instead of at run time as the above would do. (Unless that&#39;s optimized somehow.)"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1454434773, "post_id": 35142631, "comment_id": 58038681, "body": "@AndySchweig I&#39;m not sure what optimizations the Go compiler makes however there is no reason this couldn&#39;t be optimized the same as concatenation. The same rules apply, if all values are known at compile time then the calculation can be done, if one or more values isn&#39;t known until runtime then it cannot."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 2, "last_activity_date": 1454434299, "last_edit_date": 1454434299, "creation_date": 1454370666, "answer_id": 35142631, "question_id": 35142532, "link": "https://stackoverflow.com/questions/35142532/how-to-split-long-lines-for-fmt-sprintf/35142631#35142631", "title": "how to split long lines for fmt.sprintf", "body": "<p>Since you're using <code>Sprintf</code> already (meaning you'll have a string like \"this is the string with %s placeholders in it\") you could just add more place holders to the string and then put the values you'd like there on their own lines like;</p>\n\n<pre><code>fmt.Sprintf(\"This %s is so long that I need %s%s%s for the other three strings,\n\"string\",\n\"some super long statement that I don't want to type on 50 lines\",\n\"another one of those\",\n\"yet another one of those\")\n</code></pre>\n\n<p>Another option is just to use string concatenation like <code>\"string 1\" + \"string 2\"</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 8079, "user_id": 1748679, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/afebaed9a11b4b56934add3801429c9c?s=128&d=identicon&r=PG", "display_name": "Kyle Heuton", "link": "https://stackoverflow.com/users/1748679/kyle-heuton"}, "is_accepted": false, "score": 2, "last_activity_date": 1522871691, "creation_date": 1522871691, "answer_id": 49659361, "question_id": 35142532, "link": "https://stackoverflow.com/questions/35142532/how-to-split-long-lines-for-fmt-sprintf/49659361#49659361", "title": "how to split long lines for fmt.sprintf", "body": "<p>You can also use <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">raw string literals</a> inside backticks, like this: </p>\n\n<pre><code>columns := \"id, name\"\ntable := \"users\"\nquery := fmt.Sprintf(`\n    SELECT %s\n    FROM %s\n  `, columns, table)\nfmt.Println(query)\n</code></pre>\n\n<p>There are a few caveats to this approach: </p>\n\n<ol>\n<li>Raw strings don't parse escape sequences</li>\n<li>All the whitespace will be preserved, so there will be a newline and then several tabs before the <code>FROM</code> clause in this query.</li>\n</ol>\n\n<p>These problems can be a challenge for some, and the whitespace will produce some ugly resulting strings. However, I prefer this approach as it allows you to copy and paste long, complex SQL queries outside of your code and into other contexts, like sql worksheets for testing.</p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1618536389, "creation_date": 1618536389, "answer_id": 67117931, "question_id": 35142532, "link": "https://stackoverflow.com/questions/35142532/how-to-split-long-lines-for-fmt-sprintf/67117931#67117931", "title": "how to split long lines for fmt.sprintf", "body": "<p>Another option is <code>strings.Builder</code>:</p>\n<pre><code>package main\n\nimport (\n   &quot;fmt&quot;\n   &quot;strings&quot;\n)\n\nfunc main() {\n   b := new(strings.Builder)\n   fmt.Fprint(b, &quot;North&quot;)\n   fmt.Fprint(b, &quot;South&quot;)\n   println(b.String() == &quot;NorthSouth&quot;)\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/strings#Builder\" rel=\"nofollow noreferrer\">https://golang.org/pkg/strings#Builder</a></p>\n"}], "owner": {"reputation": 2820, "user_id": 1804543, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/u2EW6.jpg?s=128&g=1", "display_name": "WhatABeautifulWorld", "link": "https://stackoverflow.com/users/1804543/whatabeautifulworld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6814, "favorite_count": 0, "answer_count": 5, "score": 12, "last_activity_date": 1618537413, "creation_date": 1454370090, "question_id": 35142532, "link": "https://stackoverflow.com/questions/35142532/how-to-split-long-lines-for-fmt-sprintf", "title": "how to split long lines for fmt.sprintf", "body": "<p>I have a very long line in fmt.Sprintf. How do I split it in the code? I don't want to put everything in a single line so the code looks ugly.</p>\n\n<pre><code>fmt.Sprintf(\"a:%s, b:%s  ...... this goes really long\")\n</code></pre>\n"}, {"tags": ["go", "protocol-buffers"], "comments": [{"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 0, "creation_date": 1454367909, "post_id": 35141669, "comment_id": 58004571, "body": "Yes, *pb_obj.Score is fine. And also don&#39;t make sense to change fixed64 to int64. If score is allways positive use uint64 and fixed64 in proto. If can be negative prefer int64 and sfixed64 in proto files."}], "answers": [{"tags": [], "owner": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "is_accepted": false, "score": 2, "last_activity_date": 1454366257, "creation_date": 1454366257, "answer_id": 35141761, "question_id": 35141669, "link": "https://stackoverflow.com/questions/35141669/read-int64-from-fixed64-protobuf-field-in-golang/35141761#35141761", "title": "read int64 from fixed64 protobuf field in golang", "body": "<p>Based on the compile error you're working with a uint64 pointer and not a uint64 value.  You may get what you want by referencing the value directly using the * operator. I've never worked with protobuf, so I could be off but that should get you moving.  Here's a nice reference that may help <a href=\"https://www.golang-book.com/books/intro/8\" rel=\"nofollow\">golang pointers</a></p>\n"}, {"tags": [], "owner": {"reputation": 42860, "user_id": 54937, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d968f2f1240bf3e2c4080e773cc95129?s=128&d=identicon&r=PG", "display_name": "Sedat Kapanoglu", "link": "https://stackoverflow.com/users/54937/sedat-kapanoglu"}, "is_accepted": true, "score": 3, "last_activity_date": 1454366660, "last_edit_date": 1454366660, "creation_date": 1454366330, "answer_id": 35141771, "question_id": 35141669, "link": "https://stackoverflow.com/questions/35141669/read-int64-from-fixed64-protobuf-field-in-golang/35141771#35141771", "title": "read int64 from fixed64 protobuf field in golang", "body": "<p><code>pb_obj.Score</code>'s type seems to be <code>*uint64</code> (pointer to <code>uint64</code>), not <code>uint64</code>. You just need to access to the value the pointer is referencing:</p>\n\n<pre><code>score := int64(*pb_obj.Score)\n</code></pre>\n\n<p>(See the <code>*</code> prefix as the difference)</p>\n"}], "owner": {"reputation": 4478, "user_id": 557406, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/99836456ec6d87389df32d2cdcf8d825?s=128&d=identicon&r=PG", "display_name": "Charles L.", "link": "https://stackoverflow.com/users/557406/charles-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 598, "favorite_count": 0, "accepted_answer_id": 35141771, "answer_count": 2, "score": 1, "last_activity_date": 1454366660, "creation_date": 1454365860, "last_edit_date": 1454366193, "question_id": 35141669, "link": "https://stackoverflow.com/questions/35141669/read-int64-from-fixed64-protobuf-field-in-golang", "title": "read int64 from fixed64 protobuf field in golang", "body": "<p>I have a field that is of type <code>fixed64</code> in a .proto file.</p>\n\n<p>I want to read it as an int64 field:</p>\n\n<pre><code>score := int64(pb_obj.Score)\n</code></pre>\n\n<p>When I try to compile the line agove I get the error message <code>cannot convert pb_obj.Score (type *uint64) to type int64</code>.  I tried converting the a uint64 as well, and got an almost identical message.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 15792, "user_id": 816721, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8444cf72fac7e9065e0c68d70246a36d?s=128&d=identicon&r=PG", "display_name": "rkmax", "link": "https://stackoverflow.com/users/816721/rkmax"}, "edited": false, "score": 0, "creation_date": 1454365384, "post_id": 35141526, "comment_id": 58003513, "body": "So. it&#39;s better that each moduleX have its own folders model, handle, etc?"}, {"owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "reply_to_user": {"reputation": 15792, "user_id": 816721, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8444cf72fac7e9065e0c68d70246a36d?s=128&d=identicon&r=PG", "display_name": "rkmax", "link": "https://stackoverflow.com/users/816721/rkmax"}, "edited": false, "score": 2, "creation_date": 1454366375, "post_id": 35141526, "comment_id": 58003983, "body": "Think of packages as namespaces. They isolate code from other packages.  I&#39;m assuming all your files under <code>model</code> folder belong to the <code>model</code> package. Same for <code>handler</code> folder will contain files that have <code>package handler</code>."}, {"owner": {"reputation": 15792, "user_id": 816721, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8444cf72fac7e9065e0c68d70246a36d?s=128&d=identicon&r=PG", "display_name": "rkmax", "link": "https://stackoverflow.com/users/816721/rkmax"}, "edited": false, "score": 0, "creation_date": 1454371137, "post_id": 35141526, "comment_id": 58005665, "body": "Finally I decide an approch <code>modulea&#47;{handler,model,modulea_test}.go</code> thanks"}], "tags": [], "owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "is_accepted": true, "score": 4, "last_activity_date": 1454365252, "creation_date": 1454365252, "answer_id": 35141526, "question_id": 35141487, "link": "https://stackoverflow.com/questions/35141487/how-to-split-tests-into-many-files-on-go/35141526#35141526", "title": "How to split tests into many files on go", "body": "<p>You should place the tests for <code>modulea</code> in a file called <code>modulea_test.go</code> in the same folder and package as <code>modulea</code>. </p>\n\n<p>Unit tests should be tested in the same package as the functions being tested. </p>\n\n<p>Then to test it you can do <code>go test ./...</code> which will execute the tests for every package in your app. </p>\n"}], "owner": {"reputation": 15792, "user_id": 816721, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8444cf72fac7e9065e0c68d70246a36d?s=128&d=identicon&r=PG", "display_name": "rkmax", "link": "https://stackoverflow.com/users/816721/rkmax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 538, "favorite_count": 0, "accepted_answer_id": 35141526, "answer_count": 1, "score": 2, "last_activity_date": 1454365252, "creation_date": 1454365136, "question_id": 35141487, "link": "https://stackoverflow.com/questions/35141487/how-to-split-tests-into-many-files-on-go", "title": "How to split tests into many files on go", "body": "<p>I'm learning Go through writing a web app with the following structure</p>\n\n<pre><code>myapp/\n  db/\n    dbconf.yml\n    migrations/\n      *.sql\n  handler\n    modulea.go\n    moduleb.go\n  model\n    init.go\n    modulea.go\n    moduleb.go\n  myapp.go &lt;-- this is my main package with main func\n</code></pre>\n\n<p>I added my some tests for the modulea in a file <code>myapp_test.go</code> on project root, I want to organize the tests by module but I dont know how-to</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1454360393, "post_id": 35140177, "comment_id": 58000744, "body": "Get a stack trace to see where exactly it&#39;s blocked. Check your syslog and dmesg."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454425674, "post_id": 35140177, "comment_id": 58032269, "body": "Waiting on a futex doesn&#39;t mean anything. What does the stack trace show?"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454367711, "post_id": 35141900, "comment_id": 58004503, "body": "you need <code>strace -f</code> to follow a multithreaded program (and because it&#39;s multithreaded, go programs can&#39;t fork)."}], "tags": [], "owner": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "is_accepted": false, "score": 1, "last_activity_date": 1454366811, "creation_date": 1454366811, "answer_id": 35141900, "question_id": 35140177, "link": "https://stackoverflow.com/questions/35140177/go-application-hangs-when-starting-subprocess-with-another-users-credentials/35141900#35141900", "title": "Go application hangs when starting subprocess with another user&#39;s credentials", "body": "<p>You should execute your application with strace.  So <code>strace myapp</code> and see where it locks up.  It could be you have something else that's forking before your application executes, which is causing it to hang.</p>\n"}], "owner": {"reputation": 37, "user_id": 2194934, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9f496aa3c6a47b4b46459e6855ecbcfe?s=128&d=identicon&r=PG", "display_name": "jussi", "link": "https://stackoverflow.com/users/2194934/jussi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1454389093, "creation_date": 1454360274, "last_edit_date": 1454389093, "question_id": 35140177, "link": "https://stackoverflow.com/questions/35140177/go-application-hangs-when-starting-subprocess-with-another-users-credentials", "title": "Go application hangs when starting subprocess with another user&#39;s credentials", "body": "<p>I've been using a simple game server management application on Ubuntu 14.04 for the last 6 months or so. After a recent server update &amp; reboot the application would hang on when trying to start a subprocess. After some debugging it seems that whenever I try to start a subprocess with another user's credentials (I'm running as a root) any command will hang. </p>\n\n<p>Here's a simple application to demonstrate what causes the hang:</p>\n\n<pre><code>package main\nimport (\n    \"os/exec\"\n    \"syscall\"\n    \"fmt\"\n)\n\nfunc main() {\n    proc := exec.Command(\"ls\")\n\n    proc.SysProcAttr = &amp;syscall.SysProcAttr{}\n    proc.SysProcAttr.Credential = &amp;syscall.Credential{Uid: 1022, Gid: 1023}\n    err := proc.Run()\n    if err != nil {\n        fmt.Printf(\"err: %v\", err)\n    }\n}\n</code></pre>\n\n<p>By removing the  syscall.Credential part, the application will run without any issues.</p>\n\n<p>My question is: is there some platform/update specific reason that causes this behaviour? Is this no longer a correct way to run a subprocess as another user?</p>\n\n<p>EDIT:\nHere's the last 5 lines of strace -f</p>\n\n<pre><code>[pid  3994] futex(0xc21000a888, FUTEX_WAKE, 1 &lt;unfinished ...&gt;\n[pid  3995] &lt;... futex resumed&gt; )       = 0\n[pid  3994] &lt;... futex resumed&gt; )       = 1\n[pid  3995] futex(0xc21000a888, FUTEX_WAIT, 0, NULL &lt;unfinished ...&gt;\n[pid  3994] select(0, NULL, NULL, NULL, {0, 20}) = 0 (Timeout)\n[pid  3994] futex(0x7f615c51a4f8, FUTEX_WAIT, 0, NULL\n</code></pre>\n\n<p>So apparently if I'm interpreting this right it's blocking at futex_wait.</p>\n"}, {"tags": ["go", "uuid"], "comments": [{"owner": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 0, "creation_date": 1454358617, "post_id": 35139682, "comment_id": 57999683, "body": "why not just generate two random longints in the first place?"}, {"owner": {"reputation": 4478, "user_id": 557406, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/99836456ec6d87389df32d2cdcf8d825?s=128&d=identicon&r=PG", "display_name": "Charles L.", "link": "https://stackoverflow.com/users/557406/charles-l"}, "reply_to_user": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 0, "creation_date": 1454359731, "post_id": 35139682, "comment_id": 58000349, "body": "that would solve this problem for now, but longer term I&#39;ll receive generated uuids as well."}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1454360130, "post_id": 35139816, "comment_id": 58000586, "body": "<a href=\"https://godoc.org/github.com/satori/go.uuid#UUID\" rel=\"nofollow noreferrer\"><code>UUID</code></a> is <code>[16]byte</code>, so you can simply slice it. E.g. instead of <code>u1.Bytes()[:8]</code> use <code>u1[:8]</code>."}], "tags": [], "owner": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "is_accepted": true, "score": 3, "last_activity_date": 1454360297, "last_edit_date": 1454360297, "creation_date": 1454358961, "answer_id": 35139816, "question_id": 35139682, "link": "https://stackoverflow.com/questions/35139682/how-can-i-get-2-long-numbers-from-a-uuid/35139816#35139816", "title": "How can I get 2 long numbers from a uuid?", "body": "<p>You can use the <code>Bytes()</code> function to get the bytes and then convert to a long with <code>encoding/binary</code>. As @icza mentioned, you can also slice the UUID object directly, so you don't even need to call <code>Bytes()</code>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"encoding/binary\"\nimport \"github.com/satori/go.uuid\"\n\nfunc main() {\n    u1 := uuid.NewV4()\n    fmt.Printf(\"UUIDv4: %s\\n\", u1)\n\n    l1 := binary.BigEndian.Uint64(u1[:8])\n    l2 := binary.BigEndian.Uint64(u1[8:])\n\n    fmt.Printf(\"%x %x\\n\", l1, l2)\n    fmt.Printf(\"%v %v\\n\", l1, l2)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1454360334, "creation_date": 1454360334, "answer_id": 35140194, "question_id": 35139682, "link": "https://stackoverflow.com/questions/35139682/how-can-i-get-2-long-numbers-from-a-uuid/35140194#35140194", "title": "How can I get 2 long numbers from a uuid?", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/binary\"\n    \"fmt\"\n\n    \"github.com/satori/go.uuid\"\n)\n\nfunc main() {\n    u := uuid.NewV4()\n    fmt.Printf(\"%s\\n\", u)\n    u1 := binary.BigEndian.Uint64(u[0:8])\n    u2 := binary.BigEndian.Uint64(u[8:16])\n    fmt.Printf(\"%x %x\\n\", u1, u2)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>eb33dcfa-e439-4ff9-b366-bcd397e0852f\neb33dcfae4394ff9 b366bcd397e0852f\n</code></pre>\n"}], "owner": {"reputation": 4478, "user_id": 557406, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/99836456ec6d87389df32d2cdcf8d825?s=128&d=identicon&r=PG", "display_name": "Charles L.", "link": "https://stackoverflow.com/users/557406/charles-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1410, "favorite_count": 1, "accepted_answer_id": 35139816, "answer_count": 2, "score": 3, "last_activity_date": 1454360334, "creation_date": 1454358452, "question_id": 35139682, "link": "https://stackoverflow.com/questions/35139682/how-can-i-get-2-long-numbers-from-a-uuid", "title": "How can I get 2 long numbers from a uuid?", "body": "<p>I'm using this library to generate a v4 uuid:</p>\n\n<p><a href=\"https://github.com/satori/go.uuid\" rel=\"nofollow\">https://github.com/satori/go.uuid</a></p>\n\n<p>What is the most efficient way to get 2 long ints from the generated uuid?</p>\n"}, {"tags": ["go", "profiling", "pprof"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1454358632, "post_id": 35139106, "comment_id": 57999690, "body": "Get rid of <code>-s</code> and  the external linker with <code>-static</code>. What is &quot;brains&quot;, and what is being done in cgo?"}, {"owner": {"reputation": 1239, "user_id": 856769, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/691ecfb55a585a28ed57916b7cd1bd46?s=128&d=identicon&r=PG", "display_name": "nfirvine", "link": "https://stackoverflow.com/users/856769/nfirvine"}, "edited": false, "score": 0, "creation_date": 1454368305, "post_id": 35139106, "comment_id": 58004714, "body": "Yeah, what is the purpose of all the extra flags?"}], "owner": {"reputation": 569, "user_id": 1132127, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/3161b3c11553ddadbadc1456e9823578?s=128&d=identicon&r=PG", "display_name": "Niels", "link": "https://stackoverflow.com/users/1132127/niels"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 162, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1454356348, "creation_date": 1454356348, "question_id": 35139106, "link": "https://stackoverflow.com/questions/35139106/why-cant-i-see-my-own-application-functions-in-golangs-pprof", "title": "Why can&#39;t I see my own application functions in golang&#39;s pprof", "body": "<p>I'm trying to debug the performance characterics of my own program so I'm following the tutorial on the <a href=\"http://blog.golang.org/profiling-go-programs\" rel=\"nofollow\">golang blog</a>. But I have 1 small issues I can't investigate the my own functions or call in the resulting profiling output. I'm using this command to build my binary:</p>\n\n<pre><code>go build -ldflags \"-s -extldflags -static\" -a -installsuffix cgo -o bin/brains\n</code></pre>\n\n<p>And when I use go tool pprof to examine the result I can only</p>\n\n<pre><code>(pprof) top10 -cum\n2.38mins of 5.25mins total (45.32%)\nDropped 125 nodes (cum &lt;= 0.03mins)\nShowing top 10 nodes out of 82 (cum &gt;= 0.81mins)\n      flat  flat%   sum%        cum   cum%\n  0.33mins  6.24%  6.24%   4.82mins 91.69%  encoding/xml.(*printer).marshalStruct\n  0.77mins 14.62% 20.86%   4.07mins 77.51%  [brains]\n  0.04mins  0.79% 21.64%   1.92mins 36.50%  encoding/xml.(*printer).writeEnd\n  0.12mins  2.24% 23.88%   1.47mins 28.06%  encoding/xml.(*Decoder).unmarshal\n  0.31mins  5.83% 29.71%   1.27mins 24.14%  github.com/aws/aws-sdk-go/vendor/github.com/jmespath/go-jmespath.(*Parser).nud\n  0.02mins  0.41% 30.12%   1.07mins 20.43%  golang.org/x/net/html.parseForeignContent\n  0.52mins  9.89% 40.00%   0.98mins 18.64%  golang.org/x/net/html.render1\n  0.15mins  2.76% 42.77%   0.95mins 18.01%  github.com/aws/aws-sdk-go/vendor/github.com/jmespath/go-jmespath.(*Parser).parseMultiSelectHash\n  0.10mins  2.00% 44.77%   0.83mins 15.86%  golang.org/x/net/html.initialIM\n  0.03mins  0.55% 45.32%   0.81mins 15.42%  golang.org/x/net/html.beforeHeadIM \n</code></pre>\n\n<p>As you can see a large amount of time is spend in the [brains] package, but I can't see any details of which functions like I do see for other packages!\nI probably doing something very stupid wrong of course so if somebody notices my mistake I would be very thankful if you point it out to me :D</p>\n\n<p>ps: I'm doing the profiling on a linux environment and the analysis on my Macbook, but I think it shouldn't matter since the binary is statically build the same for both environments</p>\n\n<p>Thanks,</p>\n\n<p>Niels</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1454343385, "post_id": 35135081, "comment_id": 57990325, "body": "The go tools expect 1 package per directory. Everything in <code>todinfo</code> either need to be <code>package todinfo</code> or <code>package main</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1454343468, "post_id": 35135081, "comment_id": 57990381, "body": "The document <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a> describes how to setup a workspace."}, {"owner": {"reputation": 8757, "user_id": 9634, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6181812b2747dc091b4b7ec97fb67c2f?s=128&d=identicon&r=PG", "display_name": "Brent.Longborough", "link": "https://stackoverflow.com/users/9634/brent-longborough"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454349515, "post_id": 35135081, "comment_id": 57994359, "body": "@JimB That&#39;s precisely what I&#39;ve got. <code>todinfo.go</code> has <code>package todinfo</code> and <code>untod.go</code> has <code>package main</code>."}, {"owner": {"reputation": 8757, "user_id": 9634, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6181812b2747dc091b4b7ec97fb67c2f?s=128&d=identicon&r=PG", "display_name": "Brent.Longborough", "link": "https://stackoverflow.com/users/9634/brent-longborough"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1454349555, "post_id": 35135081, "comment_id": 57994393, "body": "@MuffinTop I had already read that document before coming here. It doesn&#39;t address my use case."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1454349668, "post_id": 35135081, "comment_id": 57994480, "body": "@Brent.Longborough: no, they both need to be the <i>same</i> package, if they are in the same directory. You can&#39;t have both <code>package todinfo</code> and <code>package main</code> in the same directory."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1454351136, "post_id": 35135081, "comment_id": 57995317, "body": "The <a href=\"https://golang.org/doc/code.html#Library\" rel=\"nofollow noreferrer\">section on libraries</a> in code.html shows how arrange a workspace with a package and a program."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1454355750, "post_id": 35135081, "comment_id": 57997961, "body": "@Brent.Longborough -- note JimB&#39;s first comment says &quot;1 package per directory,&quot; not &quot;1 per file.&quot; It&#39;s common to put commands under a <code>cmd&#47;[binary name]</code> dir; see <a href=\"http://stackoverflow.com/questions/14867452/what-is-a-sensible-way-to-layout-a-go-project\">the top answer here</a> for more."}, {"owner": {"reputation": 8757, "user_id": 9634, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6181812b2747dc091b4b7ec97fb67c2f?s=128&d=identicon&r=PG", "display_name": "Brent.Longborough", "link": "https://stackoverflow.com/users/9634/brent-longborough"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454436996, "post_id": 35135081, "comment_id": 58040057, "body": "@Jimb Thanks for the clarification. I missed the <i>either</i>."}], "answers": [{"comments": [{"owner": {"reputation": 8757, "user_id": 9634, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6181812b2747dc091b4b7ec97fb67c2f?s=128&d=identicon&r=PG", "display_name": "Brent.Longborough", "link": "https://stackoverflow.com/users/9634/brent-longborough"}, "edited": false, "score": 0, "creation_date": 1454437196, "post_id": 35142337, "comment_id": 58040170, "body": "Thanks for the reference. I&#39;ve moved <code>untod.go</code> to <code>github.com&#47;longborough&#47;todinfo&#47;untod&#47;untod.go</code> -- solved, and still part of the todinfo repo!!"}, {"owner": {"reputation": 1239, "user_id": 856769, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/691ecfb55a585a28ed57916b7cd1bd46?s=128&d=identicon&r=PG", "display_name": "nfirvine", "link": "https://stackoverflow.com/users/856769/nfirvine"}, "reply_to_user": {"reputation": 8757, "user_id": 9634, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6181812b2747dc091b4b7ec97fb67c2f?s=128&d=identicon&r=PG", "display_name": "Brent.Longborough", "link": "https://stackoverflow.com/users/9634/brent-longborough"}, "edited": false, "score": 1, "creation_date": 1454440309, "post_id": 35142337, "comment_id": 58042001, "body": "Yep, that works too. It&#39;s just my personal preference to keep it close and separate."}], "tags": [], "owner": {"reputation": 1239, "user_id": 856769, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/691ecfb55a585a28ed57916b7cd1bd46?s=128&d=identicon&r=PG", "display_name": "nfirvine", "link": "https://stackoverflow.com/users/856769/nfirvine"}, "is_accepted": true, "score": 1, "last_activity_date": 1454368925, "creation_date": 1454368925, "answer_id": 35142337, "question_id": 35135081, "link": "https://stackoverflow.com/questions/35135081/golang-how-must-i-arrange-my-workspace-for-a-package-with-a-sample-program/35142337#35142337", "title": "Golang - How must I arrange my workspace for a package with a sample program?", "body": "<p>This got me too. Think of it this way: <code>untod</code> is not part of the <code>todinfo</code> package, it's a consumer of the <code>todinfo</code> package (library). In fact, <code>main</code> is not really a package at all, just a marker to say that it's got an entrypoint and should be compiled into a binary.</p>\n\n<p>TLDR: you can put <code>untod</code> anywhere. In the root is probably sensible: it will then be named whatever the last dir component of your <code>$GOPATH</code> is. Alternatively, put it in <code>cmd/untod/untod.go</code> if you've got multiple binaries. </p>\n\n<p>After some more development, you might consider making a separate repo like <code>github.com/longborough/todinfo-bins</code> to keep them apart.</p>\n\n<p><a href=\"http://dave.cheney.net/2014/12/01/five-suggestions-for-setting-up-a-go-project\" rel=\"nofollow\">Dave Cheney has some decent advice on the subject.</a></p>\n"}], "owner": {"reputation": 8757, "user_id": 9634, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6181812b2747dc091b4b7ec97fb67c2f?s=128&d=identicon&r=PG", "display_name": "Brent.Longborough", "link": "https://stackoverflow.com/users/9634/brent-longborough"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 1, "accepted_answer_id": 35142337, "answer_count": 1, "score": 2, "last_activity_date": 1454368925, "creation_date": 1454343055, "question_id": 35135081, "link": "https://stackoverflow.com/questions/35135081/golang-how-must-i-arrange-my-workspace-for-a-package-with-a-sample-program", "title": "Golang - How must I arrange my workspace for a package with a sample program?", "body": "<p>I'm still trying to get my head around the Go workspace layout. I have a package, <code>todinfo</code> and a sample program which uses it, <code>untod</code>.</p>\n\n<p>I currently have this arrangement of directories:</p>\n\n<pre><code>$GOPATH\n+- bin...\n+- pkg ...\n+- src\n   +- github.com\n      +- longborough\n         +- (others)...\n         +- todinfo\n            +- todinfo.go\n            +- untod.go\n</code></pre>\n\n<p>I originally developed these two programs in separate directories. However, since <code>untod</code> is really part of the todinfo package, it seems more sensible to package it up as a single project, in the same directory.</p>\n\n<p>But when I try to install (I've wrapped the reply onto three lines for clarity):</p>\n\n<pre><code>D:\\Development\\Go\\src\\github.com\\longborough\\todinfo&gt;go install\n can''t load package: package github.com/longborough/todinfo: \n found packages todinfo (todinfo.go) and main (untod.go) \n in D:\\Development\\Go\\src\\github.com\\longborough\\todinfo\n</code></pre>\n\n<p>I hope I'm mistaken, but this smells a bit like Java, at least to the uninitiated.</p>\n\n<p>What am I doing wrong? What Go commands should I use to install the package and then install the sample? Or, what is the correct directory arrangement? </p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 2, "creation_date": 1454330262, "post_id": 35130590, "comment_id": 57981052, "body": "Did you read the docs <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Remove\" rel=\"nofollow noreferrer\">godoc.org/gopkg.in/mgo.v2#Collection.Remove</a> ?"}, {"owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "reply_to_user": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1454330704, "post_id": 35130590, "comment_id": 57981325, "body": "@Alex Blex thanks man.."}], "answers": [{"tags": [], "owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "is_accepted": true, "score": 8, "last_activity_date": 1454401279, "creation_date": 1454401279, "answer_id": 35148258, "question_id": 35130590, "link": "https://stackoverflow.com/questions/35130590/how-to-remove-a-single-document-from-mongodb-using-go/35148258#35148258", "title": "How to remove a single document from MongoDB using Go", "body": "<p>The following example demonstrates how to delete a single document with the <code>name</code> \"Foo Bar\" from a <code>people</code> collection in <code>test</code> database on <code>localhost</code>, it uses the <strong><a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Remove\" rel=\"noreferrer\"><code>Remove()</code></a></strong> method from the API:</p>\n\n<pre><code>// Get session\nsession, err := mgo.Dial(\"localhost\")\nif err != nil {\n    fmt.Printf(\"dial fail %v\\n\", err)\n    os.Exit(1)\n}\ndefer session.Close()\n\n// Error check on every access\nsession.SetSafe(&amp;mgo.Safe{})\n\n// Get collection\ncollection := session.DB(\"test\").C(\"people\")\n\n// Delete record\nerr = collection.Remove(bson.M{\"name\": \"Foo Bar\"})\nif err != nil {\n    fmt.Printf(\"remove fail %v\\n\", err)\n    os.Exit(1)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 316, "user_id": 3197193, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a90bbdba091870c0635c48b12c8d6560?s=128&d=identicon&r=PG&f=1", "display_name": "Simdi", "link": "https://stackoverflow.com/users/3197193/simdi"}, "is_accepted": false, "score": 3, "last_activity_date": 1569476523, "creation_date": 1569476523, "answer_id": 58110242, "question_id": 35130590, "link": "https://stackoverflow.com/questions/35130590/how-to-remove-a-single-document-from-mongodb-using-go/58110242#58110242", "title": "How to remove a single document from MongoDB using Go", "body": "<p>MongoDB officially supports golang. Here is a demostration of deleting an item from MongoDB:</p>\n\n<pre><code>// Assuming you've setup your mongoDB client\ncollection := client.Database(\"database_name\").Collection(\"collection_hero\")\n\ndeleteResult, _ := collection.DeleteOne(context.TODO(), bson.M{\"_id\": \nprimitive.ObjectIDFromHex(\"_id\")})\nif deleteResult.DeletedCount == 0 {\n    log.Fatal(\"Error on deleting one Hero\", err)\n}\nreturn deleteResult.DeletedCount\n</code></pre>\n\n<p>For more information visit: <a href=\"https://www.mongodb.com/blog/post/mongodb-go-driver-tutorial\" rel=\"nofollow noreferrer\">https://www.mongodb.com/blog/post/mongodb-go-driver-tutorial</a></p>\n"}], "owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8972, "favorite_count": 1, "accepted_answer_id": 35148258, "answer_count": 2, "score": 6, "last_activity_date": 1569476523, "creation_date": 1454329842, "question_id": 35130590, "link": "https://stackoverflow.com/questions/35130590/how-to-remove-a-single-document-from-mongodb-using-go", "title": "How to remove a single document from MongoDB using Go", "body": "<p>I am new in golang and MongoDb.\nHow can I delete a single document identified by \"name\" from a collection in MongoDB?\nThanks in Advance</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1649, "user_id": 2947610, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/aa4d4e94c2f574604e8ed2994e19e594?s=128&d=identicon&r=PG&f=1", "display_name": "Bogdan Bogdanov", "link": "https://stackoverflow.com/users/2947610/bogdan-bogdanov"}, "edited": false, "score": 0, "creation_date": 1454328513, "post_id": 35130116, "comment_id": 57979925, "body": "Waht do you try so far?"}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 3, "last_activity_date": 1454328687, "creation_date": 1454328687, "answer_id": 35130215, "question_id": 35130116, "link": "https://stackoverflow.com/questions/35130116/golang-convert-float-to-hex-string/35130215#35130215", "title": "Golang: Convert float to hex string", "body": "<p>Use <a href=\"https://golang.org/pkg/math/#Float64bits\" rel=\"nofollow\"><code>math.Float(64|32)bits</code></a>:</p>\n\n<pre><code>fmt.Printf(\"%x\\n\", math.Float32bits(-561.2863))\nfmt.Printf(\"%x\\n\", math.Float64bits(-561.2863))\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/WEZEtCU1Zl\" rel=\"nofollow\">http://play.golang.org/p/WEZEtCU1Zl</a>.</p>\n"}], "owner": {"reputation": 101, "user_id": 5867551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae7b2654b24e4f691b8b24734f033e89?s=128&d=identicon&r=PG&f=1", "display_name": "syfro", "link": "https://stackoverflow.com/users/5867551/syfro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1579, "favorite_count": 0, "accepted_answer_id": 35130215, "answer_count": 1, "score": 1, "last_activity_date": 1454328687, "creation_date": 1454328351, "question_id": 35130116, "link": "https://stackoverflow.com/questions/35130116/golang-convert-float-to-hex-string", "title": "Golang: Convert float to hex string", "body": "<p>How to convert a <strong>float64</strong> value to <strong>hex string</strong> in golang?(IEEE 754 format)</p>\n\n<p>Sample:\n-561.2863 to 0xc40c5253</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "edited": false, "score": 6, "creation_date": 1454324886, "post_id": 35128427, "comment_id": 57977735, "body": "If I right understand there is error in your code. You should <code>defer resp.Body.Close()</code> after checking for errors as <code>resp.Body</code> could be <code>nil</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1950, "user_id": 229034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1ee1d09b1401451cc0516e64721cbc5?s=128&d=identicon&r=PG", "display_name": "artyom", "link": "https://stackoverflow.com/users/229034/artyom"}, "is_accepted": false, "score": 0, "last_activity_date": 1454325152, "last_edit_date": 1454325152, "creation_date": 1454324556, "answer_id": 35128885, "question_id": 35128427, "link": "https://stackoverflow.com/questions/35128427/golang-panic-when-invoke-http-get/35128885#35128885", "title": "golang panic when invoke http.Get", "body": "<p>You probably hit os thread limit for single go process due to simultaneous hostname resolving using system (cgo-based) resolving. For using pure-go resolving which does not occupy one system thread per resolve request, try setting <code>GOBEBUG</code> environment variable like this <code>export GODEBUG=netdns=go</code> (see <a href=\"https://golang.org/pkg/net\" rel=\"nofollow\">https://golang.org/pkg/net</a> doc, \"Name Resolution\" section).</p>\n\n<p>The default os thread limit for single Go process is set to 10000: <a href=\"https://golang.org/pkg/runtime/debug/#SetMaxThreads\" rel=\"nofollow\">https://golang.org/pkg/runtime/debug/#SetMaxThreads</a></p>\n\n<p>Also it seems that you're running latest Go runtime which outputs trace of a single goroutine by default; running with <code>GOTRACEBACK=all</code> environment variable set will give you much bigger stacktrace \u2014\u00a0it's always better to post it in full.</p>\n"}, {"tags": [], "owner": {"reputation": 1336, "user_id": 3331750, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MlZX7.jpg?s=128&g=1", "display_name": "Justlike", "link": "https://stackoverflow.com/users/3331750/justlike"}, "is_accepted": true, "score": 5, "last_activity_date": 1454325128, "creation_date": 1454325128, "answer_id": 35129049, "question_id": 35128427, "link": "https://stackoverflow.com/questions/35128427/golang-panic-when-invoke-http-get/35129049#35129049", "title": "golang panic when invoke http.Get", "body": "<pre><code>resp, err := http.Get(url)\ndefer resp.Body.Close()\nif err != nil {\n    fmt.Println(\"err:\", err)\n    return\n}\n</code></pre>\n\n<p>If <code>err</code>!= nil, then <code>resp</code>==nil, so crash with nil pointer dereference.\nFix ur code with:</p>\n\n<pre><code>resp, err := http.Get(url)\nif err != nil {\n    fmt.Println(\"err:\", err)\n    return\n}\ndefer resp.Body.Close()\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 3029973, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UgCUc.jpg?s=128&g=1", "display_name": "teaey", "link": "https://stackoverflow.com/users/3029973/teaey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 923, "favorite_count": 0, "accepted_answer_id": 35129049, "answer_count": 2, "score": 2, "last_activity_date": 1454343961, "creation_date": 1454323210, "last_edit_date": 1454343961, "question_id": 35128427, "link": "https://stackoverflow.com/questions/35128427/golang-panic-when-invoke-http-get", "title": "golang panic when invoke http.Get", "body": "<p>error message:</p>\n\n<pre><code>goroutine 11357 [runnable]:\nnet.runtime_pollWait(0x1737f28, 0x77, 0x4fa90)\n    /usr/local/go/src/runtime/netpoll.go:157 +0x60\nnet.(*pollDesc).Wait(0xc829571bf0, 0x77, 0x0, 0x0)\n    /usr/local/go/src/net/fd_poll_runtime.go:73 +0x3a\nnet.(*pollDesc).WaitWrite(0xc829571bf0, 0x0, 0x0)\n    /usr/local/go/src/net/fd_poll_runtime.go:82 +0x36\nnet.(*netFD).connect(0xc829571b90, 0x0, 0x0, 0x1714f80, 0xc829572f20, 0xece412272, 0x33aa2325, 0x473ea0, 0x0, 0x0)\n    /usr/local/go/src/net/fd_unix.go:114 +0x1f6\nnet.(*netFD).dial(0xc829571b90, 0x1714f38, 0x0, 0x1714f38, 0xc8295755c0, 0xece412272, 0x33aa2325, 0x473ea0, 0x0, 0x0)\n    /usr/local/go/src/net/sock_posix.go:137 +0x351\nnet.socket(0x3050e8, 0x3, 0x2, 0x1, 0x0, 0xc829575500, 0x1714f38, 0x0, 0x1714f38, 0xc8295755c0, ...)\n    /usr/local/go/src/net/sock_posix.go:89 +0x411\nnet.internetSocket(0x3050e8, 0x3, 0x1714f38, 0x0, 0x1714f38, 0xc8295755c0, 0xece412272, 0xc833aa2325, 0x473ea0, 0x1, ...)\n    /usr/local/go/src/net/ipsock_posix.go:160 +0x141\nnet.dialTCP(0x3050e8, 0x3, 0x0, 0xc8295755c0, 0xece412272, 0xc833aa2325, 0x473ea0, 0x2, 0x0, 0x0)\n    /usr/local/go/src/net/tcpsock_posix.go:171 +0x11e\nnet.dialSingle(0xc829580b80, 0x1714ea8, 0xc8295755c0, 0xece412272, 0x33aa2325, 0x473ea0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/dial.go:364 +0x3f5\nnet.dialSerial.func1(0xece412272, 0x33aa2325, 0x473ea0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/dial.go:336 +0x75\nnet.dial(0x3050e8, 0x3, 0x1714ea8, 0xc8295755c0, 0xc8232f96e8, 0xece412272, 0x33aa2325, 0x473ea0, 0x0, 0x0, ...)\n    /usr/local/go/src/net/fd_unix.go:40 +0x60\nnet.dialSerial(0xc829580b80, 0xc829572f00, 0x2, 0x2, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/dial.go:338 +0x760\nnet.(*Dialer).Dial(0xc8200783c0, 0x3050e8, 0x3, 0xc823166ed0, 0x10, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/dial.go:232 +0x50f\nnet.(*Dialer).Dial-fm(0x3050e8, 0x3, 0xc823166ed0, 0x10, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/http/transport.go:38 +0x6e\nnet/http.(*Transport).dial(0xc820092090, 0x3050e8, 0x3, 0xc823166ed0, 0x10, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/http/transport.go:499 +0x79\nnet/http.(*Transport).dialConn(0xc820092090, 0x0, 0x7fff5fbff92a, 0x4, 0xc823166ed0, 0x10, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/http/transport.go:596 +0x19a9\nnet/http.(*Transport).getConn.func4(0xc820092090, 0x0, 0x7fff5fbff92a, 0x4, 0xc823166ed0, 0x10, 0xc8232a9560)\n    /usr/local/go/src/net/http/transport.go:549 +0x66\ncreated by net/http.(*Transport).getConn\n    /usr/local/go/src/net/http/transport.go:551 +0x265\n</code></pre>\n\n<p>source</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"os\"\n    \"strconv\"\n    \"time\"\n)\n\nfunc golanggo(url string, round int, c chan int64) {\n    for i := 0; i &lt; round; i++ {\n        call(url, c)\n    }\n}\n\nfunc call(url string, c chan int64) {\n    eslap := int64(0)\n    defer func() {\n        c &lt;- eslap\n        //fmt.Println(\"put\", eslap)\n        // if err := recover(); err != nil {\n        //  fmt.Println(err)\n        // }\n    }()\n    now := time.Now()\n    resp, err := http.Get(url)\n    defer resp.Body.Close()\n    if err != nil {\n        fmt.Println(\"err:\", err)\n        return\n    }\n    if resp.StatusCode == 200 {\n        ioutil.ReadAll(resp.Body)\n        //fmt.Println(string(data[:]))\n    }\n    eslap = time.Now().Sub(now).Nanoseconds()\n}\n\nfunc main() {\n    url := os.Args[1]\n    size, _ := strconv.Atoi(os.Args[2])\n    round, _ := strconv.Atoi(os.Args[3])\n    c := make(chan int64)\n\n    for i := 0; i &lt; size; i++ {\n        go golanggo(url, round, c)\n    }\n\n    var total int64 = 0\n\n    var nanos int64\n    for i := 0; i &lt; (size * round); i++ {\n        //fmt.Print(i)\n        nanos = &lt;-c\n        //fmt.Println(i, \"get\", nanos)\n        total += nanos\n    }\n\n    fmt.Println(total / 1000000)\n}\n</code></pre>\n\n<p>when exec go run client.go <a href=\"http://www.baidu.com\" rel=\"nofollow\">http://www.baidu.com</a> 10000 1, and after a few seconds program crash. \nwhen exec go run client.go <a href=\"http://www.baidu.com\" rel=\"nofollow\">http://www.baidu.com</a> 100 1, it's ok.</p>\n\n<p>How much of goroutine will cause this error?</p>\n\n<p>Please help me! Thanks.</p>\n"}, {"tags": ["unit-testing", "reflection", "go"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1454322384, "post_id": 35127922, "comment_id": 57976080, "body": "Why are you decoding transport from JSON?"}, {"owner": {"reputation": 2100, "user_id": 3296947, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/fce43fe11b462f0881bafc600a4bf9db?s=128&d=identicon&r=PG&f=1", "display_name": "NewestStackOverflowUser", "link": "https://stackoverflow.com/users/3296947/neweststackoverflowuser"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1454323196, "post_id": 35127922, "comment_id": 57976593, "body": "I assume you are asking why am I wrapping the JSON api. It is because I am using a set of validation rules that will be applied to the decoded struct from the json object. That way I can guarantee that non valid structs will enter my api further down the chain."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1454331916, "post_id": 35127922, "comment_id": 57982176, "body": "You need to provide more details about structure of your program, it is quite difficult to give any advice based on the information you provided."}, {"owner": {"reputation": 2100, "user_id": 3296947, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/fce43fe11b462f0881bafc600a4bf9db?s=128&d=identicon&r=PG&f=1", "display_name": "NewestStackOverflowUser", "link": "https://stackoverflow.com/users/3296947/neweststackoverflowuser"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1454358682, "post_id": 35127922, "comment_id": 57999717, "body": "I have added a gist that shows what I am currently doing in order to stub the value."}, {"owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 0, "creation_date": 1454364622, "post_id": 35127922, "comment_id": 58003087, "body": "I think your reflect part is wrong. Is that what you want? <a href=\"http://play.golang.org/p/khUJv2t6W6\" rel=\"nofollow noreferrer\">play.golang.org/p/khUJv2t6W6</a>"}, {"owner": {"reputation": 2100, "user_id": 3296947, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/fce43fe11b462f0881bafc600a4bf9db?s=128&d=identicon&r=PG&f=1", "display_name": "NewestStackOverflowUser", "link": "https://stackoverflow.com/users/3296947/neweststackoverflowuser"}, "edited": false, "score": 0, "creation_date": 1454939611, "post_id": 35127922, "comment_id": 58254026, "body": "I&#39;m not sure what is the difference between reflect.Indirect and reflect.ValueOf().Elem() it seems to work both ways as long as I pass a pointer."}], "owner": {"reputation": 2100, "user_id": 3296947, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/fce43fe11b462f0881bafc600a4bf9db?s=128&d=identicon&r=PG&f=1", "display_name": "NewestStackOverflowUser", "link": "https://stackoverflow.com/users/3296947/neweststackoverflowuser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 154, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1454358631, "creation_date": 1454321744, "last_edit_date": 1454358631, "question_id": 35127922, "link": "https://stackoverflow.com/questions/35127922/go-stub-method-that-outputs-result-in-its-input-parameter", "title": "go: stub method that outputs result in its input parameter", "body": "<p>In the past few days I have been trying to solve a problem, and I understand that I don't have enough insight to do so.</p>\n\n<p><b>Intro</b> </p>\n\n<p>I have wrapped a <code>json.NewDecoder(r).Decode(v)</code> in a struct that looks like this</p>\n\n<pre><code>t := new(validTransport)\nv := make([]foo, 0)\nt.Decode(r, &amp;v)\n</code></pre>\n\n<p>and now <code>v</code> holds all the foos that are read from <code>r</code>.</p>\n\n<p><b>Problem</b></p>\n\n<p>My problem is how do I stub the values that will be set to <code>v</code> when I try to unit test something that has a dependency to <code>validTransport</code>.</p>\n\n<p>In my attempt to fix this I have defined a interface <code>Transport</code> on which my functionallity will depend.</p>\n\n<pre><code>type Transport interface{\n  Decode(r io.Reader, v interface{})\n}\n</code></pre>\n\n<p>In the unit test I define a <code>fakeTransport</code> and pass it instead of the real implementation. <b>The problem is how do I stub what values will be set to <code>v</code></b> when <code>Decode</code> gets called.</p>\n\n<p><b>My not working solution</b></p>\n\n<p>I have been using <a href=\"https://github.com/stretchr/testify\" rel=\"nofollow\">testify</a> in order to mock my dependencies that provides a quite nice api to do so.</p>\n\n<p>Code sample:</p>\n\n<pre><code>type fakeTransport struct{\n   mock.Mock\n   stubValue interface{}\n}\n\nfunc (f *fakeTransport) Decode(r io.Reader, v interface{}){\n   f.Called(r,v)  // assert that this function has been called\n   want := reflect.ValueOf(f.stubValue)\n   reflect.ValueOf(v).Set(want) //stub my value here\n}\n</code></pre>\n\n<p><b>Question</b></p>\n\n<p>So my question is how exactly should I deal with methods with such signature that they have their return value actually be one of the input parameters.</p>\n\n<p>If the signature was something like:</p>\n\n<pre><code>type Transport interface{\n   Decode(r io.Reader) interface{}\n}\n</code></pre>\n\n<p>then i will just have my stubbed value returned (but that would also enforce the need to do a type assertion which I don't want).</p>\n\n<p><b>Edit</b></p>\n\n<p>Here is a pseudo <a href=\"https://gist.github.com/NewestUser/631b7f52ef1b812f1d2f\" rel=\"nofollow\">gist</a> illustrating how currently I am accomplishing this.</p>\n"}, {"tags": ["algorithm", "templates", "go"], "answers": [{"comments": [{"owner": {"reputation": 136, "user_id": 2632893, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PHgQM.png?s=128&g=1", "display_name": "Johnson", "link": "https://stackoverflow.com/users/2632893/johnson"}, "edited": false, "score": 0, "creation_date": 1454320573, "post_id": 35127189, "comment_id": 57974875, "body": "I wrote it manually. Sorry for no testing. Do you mean I must define a new field for Item type? But I have many structs like Item. Has other way to do it instead of defining the new field for all structs."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 136, "user_id": 2632893, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PHgQM.png?s=128&g=1", "display_name": "Johnson", "link": "https://stackoverflow.com/users/2632893/johnson"}, "edited": false, "score": 0, "creation_date": 1454320619, "post_id": 35127189, "comment_id": 57974925, "body": "@Johnson Please edited answer. You don&#39;t need to add a new field to <code>Item</code>. You just need to change <code>.Number</code> to <code>$.Number</code> and it will work."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1615045079, "last_edit_date": 1615045079, "creation_date": 1454319610, "answer_id": 35127189, "question_id": 35127051, "link": "https://stackoverflow.com/questions/35127051/golang-multiplication-algorithm-in-html-template/35127189#35127189", "title": "golang multiplication algorithm in html template", "body": "<p><a href=\"https://golang.org/pkg/html/template/#Template.Execute\" rel=\"nofollow noreferrer\"><code>template.Execute()</code></a> returns an <a href=\"https://golang.org/pkg/builtin/#error\" rel=\"nofollow noreferrer\"><code>error</code></a>, you should always check that. Would you have done so:</p>\n<blockquote>\n<p>template: item.gtpl:3:33: executing &quot;item.gtpl&quot; at &lt;.Number&gt;: Number is not a field of struct type main.Item</p>\n</blockquote>\n<p>The &quot;problem&quot; is that <code>{{range}}</code> changes the pipeline (the <em>dot</em>, <code>.</code>) to the current item, so inside the <code>{{range}}</code>:</p>\n<pre><code>{{add $i (mul .ID .Number)}}\n</code></pre>\n<p><code>.Number</code> will refer to a field or method of your <code>Item</code> type since you are looping over a <code>[]Item</code>. But your <code>Item</code> type has no such method or field.</p>\n<p>Use <code>$.Number</code> which will refer to the &quot;top-level&quot; <code>Number</code> and not a field of the current <code>Item</code> value:</p>\n<pre><code>{{add $i (mul .ID $.Number)}}\n</code></pre>\n<p>Try your modified, working code on the <a href=\"http://play.golang.org/p/34HgBb_OhZ\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n<p><code>$</code> is documented at <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\"><code>text/template</code></a>:</p>\n<blockquote>\n<p>When execution begins, $ is set to the data argument passed to Execute, that is, to the starting value of dot.</p>\n</blockquote>\n"}], "owner": {"reputation": 136, "user_id": 2632893, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PHgQM.png?s=128&g=1", "display_name": "Johnson", "link": "https://stackoverflow.com/users/2632893/johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2176, "favorite_count": 1, "accepted_answer_id": 35127189, "answer_count": 1, "score": 4, "last_activity_date": 1615045079, "creation_date": 1454319192, "last_edit_date": 1454378175, "question_id": 35127051, "link": "https://stackoverflow.com/questions/35127051/golang-multiplication-algorithm-in-html-template", "title": "golang multiplication algorithm in html template", "body": "<p>I am new for golang. I met a problem when I use multiplication in html/template.\nSome code like below.</p>\n\n<p>template code:   </p>\n\n<pre><code> {{range $i,$e:=.Items}}\n      &lt;tr&gt;\n           &lt;td&gt;{{add $i (mul .ID .Number)}}&lt;/td&gt;\n           &lt;td&gt;{{.Name}}&lt;/td&gt;\n      &lt;/tr&gt;\n  {{end}}\n</code></pre>\n\n<p>.go code</p>\n\n<pre><code>type Item struct{\n        ID int\n        Name string\n    }\nfunc init() {\n    itemtpl,_:=template.New(\"item.gtpl\").\n        Funcs(template.FuncMap{\"mul\": Mul, \"add\": Add}).\n        ParseFiles(\"./templates/item.gtpl\")\n}\n\nfunc itemHandle(w http.ResponseWriter, req *http.Request) {\n\n    items:=[]Item{Item{1,\"name1\"},Item{2,\"name2\"}}\n    data := struct {\n            Items []Item\n            Number int\n            Number2 int\n        }{\n            Items:    items,\n            Number:   5,\n            Number2:  2,\n        }\n        itemtpl.Execute(w, data)\n}\nfunc Mul(param1 int, param2 int) int {\n    return param1 * param2\n}\nfunc Add(param1 int, param2 int) int {\n    return param1 + param2\n}\n</code></pre>\n\n<p>It will output nothing when I use the code above. But It will output 10 when I use the code outside of array below.</p>\n\n<pre><code>&lt;html&gt;\n&lt;body&gt;\n    {{mul .Number .Number2}}\n&lt;/html&gt;\n&lt;/body&gt;\n</code></pre>\n\n<p>I google a lot. I cannot find the usable like mine. I want to use multiplication in array inside of html/template. Can someone tell me what is wrong with my code?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 2, "creation_date": 1454319643, "post_id": 35126830, "comment_id": 57974301, "body": "You asked this question once. <a href=\"http://stackoverflow.com/questions/35084208/how-to-change-static-ip-to-dynamic-ip-in-golang\" title=\"how to change static ip to dynamic ip in golang\">stackoverflow.com/questions/35084208/&hellip;</a>"}, {"owner": {"reputation": 1, "user_id": 5856935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52e24b97ee6955f8f60b39f1b87f9354?s=128&d=identicon&r=PG&f=1", "display_name": "jeeva", "link": "https://stackoverflow.com/users/5856935/jeeva"}, "reply_to_user": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1454323026, "post_id": 35126830, "comment_id": 57976495, "body": "ya but  i dnt got the answer for that"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1454323182, "post_id": 35126830, "comment_id": 57976583, "body": "It&#39;s really not clear what you are asking. If you&#39;re looking for a dynamic endpoint management system, look at consul <a href=\"https://www.consul.io/\" rel=\"nofollow noreferrer\">consul.io</a>"}, {"owner": {"reputation": 1, "user_id": 5856935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52e24b97ee6955f8f60b39f1b87f9354?s=128&d=identicon&r=PG&f=1", "display_name": "jeeva", "link": "https://stackoverflow.com/users/5856935/jeeva"}, "edited": false, "score": 0, "creation_date": 1454323658, "post_id": 35126830, "comment_id": 57976895, "body": "c i have a dynamic config file there i am specifying db type,ip,port as shown below"}, {"owner": {"reputation": 1, "user_id": 5856935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52e24b97ee6955f8f60b39f1b87f9354?s=128&d=identicon&r=PG&f=1", "display_name": "jeeva", "link": "https://stackoverflow.com/users/5856935/jeeva"}, "edited": false, "score": 0, "creation_date": 1454323765, "post_id": 35126830, "comment_id": 57976963, "body": "&lt;DB_info type =&quot;postgres&quot; ip=&quot;10.11.0.17&quot; port=&quot;5432&quot; so instead of hard coding the ip value i need to take it dynamically"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1454325695, "post_id": 35126830, "comment_id": 57978228, "body": "@jeeva really look at consul, it has its own DNS service that will allow you to just write something like <code>ip=&quot;mydb.mydomain&quot;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": false, "score": 0, "last_activity_date": 1454328767, "last_edit_date": 1454328767, "creation_date": 1454328223, "answer_id": 35130086, "question_id": 35126830, "link": "https://stackoverflow.com/questions/35126830/how-to-change-static-ip-to-dynamic-ip-in-web-application-using-golang/35130086#35130086", "title": "How to change static ip to dynamic ip in web application using golang?", "body": "<p>It's hard to understand what you are really need but my telepathy skill says me that you just want to know how to load DB configuration from file. If I'm right there is solution.</p>\n\n<p>Your <code>config.xml</code></p>\n\n<pre><code>&lt;config&gt;\n    &lt;DB_info type =\"postgres\" ip=\"10.11.0.17\" port=\"5432\" /&gt;\n&lt;/config&gt;\n</code></pre>\n\n<p>Code for this <code>config.xml</code></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"log\"\n    \"os\"\n)\n\ntype Configuration struct {\n    DBInfo  struct {\n        Type string `xml:\"type,attr\"`\n        IP   string `xml:\"ip,attr\"`\n        Port int    `xml:\"port,attr\"`\n    } `xml:\"DB_info\"`\n}\n\nfunc main() {\n    file, err := os.Open(\"config.xml\")\n    if err != nil {\n        log.Panic(err)\n    }\n\n    config := Configuration{}\n    err = xml.NewDecoder(file).Decode(&amp;config)\n    if err != nil {\n        log.Panic(err)\n    }\n\n    log.Println(config.DBInfo.IP)\n}\n</code></pre>\n\n<p>You can use <code>config.DBInfo</code> elements as you wish - init DB, display to user, etc. More about XML parsing in Go <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow\">here</a>.</p>\n"}], "owner": {"reputation": 1, "user_id": 5856935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52e24b97ee6955f8f60b39f1b87f9354?s=128&d=identicon&r=PG&f=1", "display_name": "jeeva", "link": "https://stackoverflow.com/users/5856935/jeeva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 174, "favorite_count": 1, "answer_count": 1, "score": -5, "last_activity_date": 1457293750, "creation_date": 1454318518, "last_edit_date": 1457293750, "question_id": 35126830, "link": "https://stackoverflow.com/questions/35126830/how-to-change-static-ip-to-dynamic-ip-in-web-application-using-golang", "title": "How to change static ip to dynamic ip in web application using golang?", "body": "<p>I googled it but they are showing to change the ip of system. But I need to change for my particular web application as I have a config file in that I have tagged with ip port number as shown DB_info type =\"postgres\" <strong>ip=\"10.11.0.17\"</strong> port=\"5432\" but for every time I need to change the ip for other system.</p>\n\n<p>So I need to make it as dynamic ip instead of static ip in golang.</p>\n"}, {"tags": ["go", "portable-executable"], "answers": [{"tags": [], "owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "is_accepted": true, "score": 8, "last_activity_date": 1454317956, "last_edit_date": 1454317956, "creation_date": 1454317304, "answer_id": 35126461, "question_id": 35126344, "link": "https://stackoverflow.com/questions/35126344/how-to-set-the-file-version-field-in-pe-header-of-exe-files/35126461#35126461", "title": "How to set the &quot;file version&quot; field in PE header of EXE files?", "body": "<p>The EXE file version and other info are embedded as resources, which are specific to Windows and thus not supported by the Go compiler. You can use <a href=\"https://github.com/josephspurrier/goversioninfo\" rel=\"noreferrer\">the package GoVersionInfo</a> to accomplish this (it also supports embedding an icon). I haven't tried it myself, but it looks promising and well documented.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 15345590, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-B-T-enhrXXU/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucksU2ojSVP88Fif4Y4RQi6I9s1lOw/s96-c/photo.jpg?sz=128", "display_name": "John N", "link": "https://stackoverflow.com/users/15345590/john-n"}, "is_accepted": false, "score": 1, "last_activity_date": 1615113622, "last_edit_date": 1615113622, "creation_date": 1615085192, "answer_id": 66512743, "question_id": 35126344, "link": "https://stackoverflow.com/questions/35126344/how-to-set-the-file-version-field-in-pe-header-of-exe-files/66512743#66512743", "title": "How to set the &quot;file version&quot; field in PE header of EXE files?", "body": "<p>There is <a href=\"https://github.com/tc-hib/go-winres\" rel=\"nofollow noreferrer\">go-winres</a> which lets you do this, either before or after <code>go build</code>.</p>\n<p>Run <code>go install github.com/tc-hib/go-winres@latest</code> to install it.\nThen, inside your project folder, run <code>go-winres init</code>. This creates a subfolder named <code>winres</code>.</p>\n<p>Modify <code>winres/winres.json</code>, and replace the icon.</p>\n<p>Run <code>go-winres make</code>. This creates a <code>.syso</code> file.\nRun <code>go build</code> and see the result.</p>\n<p>If you want to add a language, there's an example in the readme file. I didn't manage to do it with <code>goversioninfo</code>, while it works with <code>go-winres</code>.</p>\n"}], "owner": {"reputation": 715, "user_id": 5324031, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/310ce145233b69bc87af1c03f63a6168?s=128&d=identicon&r=PG&f=1", "display_name": "Dev Zhou", "link": "https://stackoverflow.com/users/5324031/dev-zhou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1128, "favorite_count": 2, "accepted_answer_id": 35126461, "answer_count": 2, "score": 4, "last_activity_date": 1615113622, "creation_date": 1454316912, "last_edit_date": 1454319734, "question_id": 35126344, "link": "https://stackoverflow.com/questions/35126344/how-to-set-the-file-version-field-in-pe-header-of-exe-files", "title": "How to set the &quot;file version&quot; field in PE header of EXE files?", "body": "<p>I use <code>go build</code> to build a <code>exe</code> file.Then i view the property of the file(Right click the file -> property),In <code>detail</code> tab,the file's version is empty.</p>\n\n<p>How i to set the version of the <code>exe</code> file.</p>\n\n<p><a href=\"https://i.stack.imgur.com/cQSn5.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/cQSn5.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["security", "go", "sandbox", "blacklist"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1454321715, "post_id": 35125097, "comment_id": 57975623, "body": "I seriously hope you don&#39;t find anything :) You can read about how the Go team sandboxed the playground to see that these guys mean business <a href=\"https://blog.golang.org/playground\" rel=\"nofollow noreferrer\">blog.golang.org/playground</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454334498, "post_id": 35125097, "comment_id": 57983905, "body": "What &quot;sandbox&quot; are you talking about? A bsd jail? linux namespaces? chroot? docker? qemu?"}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "edited": false, "score": 0, "creation_date": 1454359768, "post_id": 35125097, "comment_id": 58000373, "body": "I&#39;m using the term &quot;sandbox&quot; loosely here - the only sandboxing that&#39;s performed is blacklisting certain packages and refusing to compile code that imports packages on this blacklist."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454369329, "post_id": 35125097, "comment_id": 58005098, "body": "If you&#39;re only blacklisting module name at compile time, it&#39;s not really a sandbox then. If I wanted to break out of this, I would drop an assembly thunk into the source to call into whatever runtime function I wanted, or just implement <code>Syscall</code>."}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "edited": false, "score": 0, "creation_date": 1454371722, "post_id": 35125097, "comment_id": 58005823, "body": "An assembly thunk? You mean like inline assembly? I wasn&#39;t aware that was possible in Go."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454425234, "post_id": 35125097, "comment_id": 58031961, "body": "There&#39;s no inline assembly, it needs to be in its own .s file, but you can do pretty much anything you want in there (though now that I think about it, I&#39;m not sure if you can still JMP or CALL into arbitrary runtime functions)."}], "owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 159, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1454311959, "creation_date": 1454311959, "question_id": 35125097, "link": "https://stackoverflow.com/questions/35125097/what-is-the-least-obvious-go-standard-library-package-you-can-use-to-escape-a-sa", "title": "What is the least obvious Go standard library package you can use to escape a sandbox?", "body": "<p>I'm designing a project for a college-level computer security course, and I'm trying to include a vulnerability where code which is \"clean\" by virtue of a number of risky packages being blacklisted (<code>unsafe</code>, <code>os</code>, <code>ioutil</code>, etc). The question is this: can you think of a way to use other non-obvious Go standard library packages to escape the sandbox? \"Escape the sandbox\" here means reading/writing files, making network connections, breaking memory safety (which would allow you to do any of the other things), etc.</p>\n\n<p>Things I've tried so far that haven't worked:</p>\n\n<ul>\n<li>Using the <code>reflect</code> package to do unsafe pointer conversions (the <code>reflect</code> package seems really safe against this sort of abuse)</li>\n<li>Using the <code>reflect</code> package to get access to a reference held by a random stdlib package to some sensitive function like <code>os.Open</code> (I haven't found any that actually keep function pointers or anything like that)</li>\n</ul>\n"}, {"tags": ["selenium", "go", "phantomjs"], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 1776346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60d7350f7b240d6bd4ae616016d46da6?s=128&d=identicon&r=PG", "display_name": "Oleh Luchkiv", "link": "https://stackoverflow.com/users/1776346/oleh-luchkiv"}, "is_accepted": true, "score": 0, "last_activity_date": 1481194735, "last_edit_date": 1481194735, "creation_date": 1481182188, "answer_id": 41034039, "question_id": 35124283, "link": "https://stackoverflow.com/questions/35124283/sending-phantomjs-setting-in-golang/41034039#41034039", "title": "sending phantomjs setting in golang", "body": "<p>You should set driver binary path and browser name:</p>\n\n<pre><code>caps := selenium.Capabilities{\n    \"browserName\":           \"phantomjs\", // \"chrome\", or any other\n    \"phantomjs.binary.path\": \"/path/to/phantomjs\", // path to binary from http://phantomjs.org/\n}\n</code></pre>\n\n<p>PhantomJS should be installed in your system.</p>\n"}], "owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 825, "favorite_count": 0, "accepted_answer_id": 41034039, "answer_count": 1, "score": 0, "last_activity_date": 1481194735, "creation_date": 1454308384, "question_id": 35124283, "link": "https://stackoverflow.com/questions/35124283/sending-phantomjs-setting-in-golang", "title": "sending phantomjs setting in golang", "body": "<p>I'm using the go selenium package: <code>https://github.com/tebeka/selenium</code> and using the phantomjs browser:</p>\n\n<pre><code>caps := selenium.Capabilities{\n    \"browserName\": \"phantomjs\",\n}\n\nwd, err := selenium.NewRemote(caps, \"\")\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>I'm trying to also send along some phantomjs settings so I can set the user-agent string. I'm trying to make a crawler and certain websites won't load with a headless browser user-agent. I know this can be done with python and other languages but I haven't seen any examples in go. </p>\n"}, {"tags": ["macos", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454343946, "post_id": 35123907, "comment_id": 57990709, "body": "Possibly the majority of go binaries on osx use cgo, so that in itself shouldn&#39;t affect your results. What are you doing with cgo? What is showing <code>exit status 1</code>? Building the binary on the second machine might show you what shared libs are missing."}, {"owner": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "edited": false, "score": 0, "creation_date": 1454362970, "post_id": 35123907, "comment_id": 58237579, "body": "If I had to hazard a guess I would say there is likely a missing library. You should use <code>dtruss myapp</code> to see what your application is doing right before it exits."}], "owner": {"reputation": 7906, "user_id": 244009, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bd8e93613dba2b3b39c97afd6d065279?s=128&d=identicon&r=PG", "display_name": "codefx", "link": "https://stackoverflow.com/users/244009/codefx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1454362970, "creation_date": 1454306487, "last_edit_date": 1454306927, "question_id": 35123907, "link": "https://stackoverflow.com/questions/35123907/cgo-binary-does-not-run-in-osx", "title": "CGO binary does not run in OSX", "body": "<p>I am facing a weird issue in running a cgo binary in MAC OSX. The binary builds on my first Mac will work on my second Mac but shows <code>exit status 1</code> on my first mac. I don't see any difference in <code>go env</code>. Is there any way I can debug this issue to understand what is wrong and hopefully fix it? I reinstall os in the first mac. Things started working after that. Then it stopped working. I can build the binary at all time.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 4, "last_activity_date": 1454296963, "creation_date": 1454296963, "answer_id": 35122558, "question_id": 35122482, "link": "https://stackoverflow.com/questions/35122482/how-to-remove-special-char-in-golang-when-reading-file/35122558#35122558", "title": "How to remove special char in golang when reading file?", "body": "<p>The default line separator in text files on Windows is a sequence of two characters: <code>\\r\\n</code>. <code>^M</code> character that you see in your strings is <code>\\r</code>.</p>\n\n<p><a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"nofollow\">bufio.Scanner</a> can take care of splitting the input into lines in a platform independent way:</p>\n\n<pre><code>scanner := bufio.NewScanner(file)\nfor scanner.Scan() {\n    fmt.Println(scanner.Text())\n}\nif err := scanner.Err(); err != nil {\n    fmt.Fprintln(os.Stderr, \"error reading from the file:\", err)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 391, "user_id": 4100453, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/vAyr8.jpg?s=128&g=1", "display_name": "Alexander Falk", "link": "https://stackoverflow.com/users/4100453/alexander-falk"}, "edited": false, "score": 0, "creation_date": 1517855471, "post_id": 35124459, "comment_id": 84255190, "body": "Thank you. This was what I was missing. I just want to point out, that in your trim line (For Windows), I did this instead: line = strings.TrimRight(line, &quot;\\r\\n&quot;) .This was my solution to remove the special characters"}], "tags": [], "owner": {"reputation": 3468, "user_id": 71978, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/Ex4dt.jpg?s=128&g=1", "display_name": "TomOnTime", "link": "https://stackoverflow.com/users/71978/tomontime"}, "is_accepted": false, "score": 2, "last_activity_date": 1454309257, "creation_date": 1454309257, "answer_id": 35124459, "question_id": 35122482, "link": "https://stackoverflow.com/questions/35122482/how-to-remove-special-char-in-golang-when-reading-file/35124459#35124459", "title": "How to remove special char in golang when reading file?", "body": "<p>Less elegant but...</p>\n\n<p>You can strip the <code>\\r</code> from the end of the string with:</p>\n\n<p><code>\n        line, err := buf.ReadString('\\n')\n        line = strings.TrimRight(line, \"\\r\")\n</code></p>\n\n<p>It will remove multiple <code>\\r</code> (^M) and is a no-op if there are none.</p>\n"}], "owner": {"reputation": 83, "user_id": 5865819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9eadb4643b08dcf737a316f0f63f6f35?s=128&d=identicon&r=PG&f=1", "display_name": "windy_zhh", "link": "https://stackoverflow.com/users/5865819/windy-zhh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2821, "favorite_count": 0, "accepted_answer_id": 35122558, "answer_count": 2, "score": 4, "last_activity_date": 1454309257, "creation_date": 1454296296, "question_id": 35122482, "link": "https://stackoverflow.com/questions/35122482/how-to-remove-special-char-in-golang-when-reading-file", "title": "How to remove special char in golang when reading file?", "body": "<p>I have a file like this:\n<a href=\"http://i.stack.imgur.com/KY4Ai.png\" rel=\"nofollow\">Each line represents a Website</a></p>\n\n<pre><code>1 www.google.com$\n2 www.apple.com$\n3 www.facebook.com$\n</code></pre>\n\n<p>I read it in golang like this:</p>\n\n<pre><code>type ListConf struct {\n    File  string\n    Datas map[string]struct{}\n}\n\nfunc loadListConf(conf *ListConf, path string) {\n    file, err := os.Open(path + \"/\" + conf.File)\n    if err != nil {\n        fmt.Println(\"Load conf \" + conf.File + \" error: \" + err.Error())\n        return\n    }\n    defer file.Close()\n    conf.Datas = make(map[string]struct{})\n    buf := bufio.NewReader(file)\n    end := false\n    for !end {\n        line, err := buf.ReadString('\\n')\n        if err != nil {\n            if err != io.EOF {\n                fmt.Println(\"Load conf \" + conf.File + \" error: \" + err.Error())\n                return\n            } else {\n                end = true\n            }\n        }\n        item := strings.Trim(line, \"\\n\")\n        if item == \"\" {\n            continue\n        }\n        conf.Datas[item] = struct{}{}\n    }\n}\n</code></pre>\n\n<p>But when I search key such like \"www.google.com\" in the map, it shows that there is not a \"www.google.com\" in the map.</p>\n\n<pre><code>website := \"www.google.com\"\nif _, ok := conf.Datas[website]; ok {\n    fmt.Printf(\"%s is in the map.\", website)\n} else {\n    fmt.Printf(\"%s is not in the map.\", website)\n}\n</code></pre>\n\n<p>It print \"www.google.com is not in the map\".\nI found that a ^M in the end of each key in the map, my question is how can I remove the ^M character?</p>\n\n<pre><code>www.google.com^M\nwww.apple.com^M\nwww.facebook.com^M\n</code></pre>\n"}, {"tags": ["json", "rest", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1454293747, "creation_date": 1454293747, "answer_id": 35122180, "question_id": 35122105, "link": "https://stackoverflow.com/questions/35122105/mapping-json-returned-by-rest-api-containing-dynamic-keys-to-a-struct-in-golang/35122180#35122180", "title": "Mapping JSON returned by REST API containing dynamic keys to a struct in Golang", "body": "<p>Use a map:</p>\n\n<pre><code>type Item struct {\n    Name string `json:\"name\"`\n    Success bool `json:\"success\"`\n} \ntype Response struct {\n    Data map[string]Item `json:\"data\"`\n}\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/stgE2SB6tw\" rel=\"nofollow\">Run it on the playground</a></kbd></p>\n"}, {"tags": [], "owner": {"reputation": 1398, "user_id": 254695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b88a2153da1b439de174b694d74b0764?s=128&d=identicon&r=PG", "display_name": "Emmanuel Ay", "link": "https://stackoverflow.com/users/254695/emmanuel-ay"}, "is_accepted": false, "score": 0, "last_activity_date": 1472206116, "creation_date": 1472206116, "answer_id": 39163750, "question_id": 35122105, "link": "https://stackoverflow.com/questions/35122105/mapping-json-returned-by-rest-api-containing-dynamic-keys-to-a-struct-in-golang/39163750#39163750", "title": "Mapping JSON returned by REST API containing dynamic keys to a struct in Golang", "body": "<p>Here is some sample code that utilizes Mellow Marmots answer and shows how to iterate over the items in the response.</p>\n\n<p><strong>test.json</strong></p>\n\n<pre><code>{\n \"data\": {\n  \"1018089108070373346\": {\n    \"name\": \"A Nice Hotel\",\n    \"success\": true\n   },\n  \"2017089208070373346\": {\n    \"name\": \"Another Nice Hotel\",\n    \"success\": true\n   }\n  }\n}\n</code></pre>\n\n<p><strong>test.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\n// Item struct\ntype Item struct {\n    Name    string `json:\"name\"`\n    Success bool   `json:\"success\"`\n}\n\n// Response struct\ntype Response struct {\n    Data map[string]Item `json:\"data\"`\n}\n\nfunc main() {\n    jsonFile, err := os.Open(\"test.json\")\n    if err != nil {\n        fmt.Println(\"Error opening test file\\n\", err.Error())\n        return\n    }\n\n    jsonParser := json.NewDecoder(jsonFile)\n    var filedata Response\n    if err = jsonParser.Decode(&amp;filedata); err != nil {\n        fmt.Println(\"Error while reading test file.\\n\", err.Error())\n        return\n    }\n\n    for key, value := range filedata.Data {\n        fmt.Println(key, value.Name, value.Success)\n    }\n}\n</code></pre>\n\n<p>Which outputs:</p>\n\n<pre><code>1018089108070373346 A Nice Hotel true\n2017089208070373346 Another Nice Hotel true\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 5865732, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3f48df6b447464ff72e0d413a23ad40?s=128&d=identicon&r=PG&f=1", "display_name": "Ramesh", "link": "https://stackoverflow.com/users/5865732/ramesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1177, "favorite_count": 1, "accepted_answer_id": 35122180, "answer_count": 2, "score": 1, "last_activity_date": 1491707970, "creation_date": 1454293095, "last_edit_date": 1491707970, "question_id": 35122105, "link": "https://stackoverflow.com/questions/35122105/mapping-json-returned-by-rest-api-containing-dynamic-keys-to-a-struct-in-golang", "title": "Mapping JSON returned by REST API containing dynamic keys to a struct in Golang", "body": "<p>I'm calling a REST API from my Go program which takes <em>n</em> number of hotel ids in the request and returns their data as a JSON. The response is like the following when say I pass 2 ids in the request, 1018089108070373346 and 2017089208070373346 :</p>\n\n<pre><code>{\n \"data\": {\n  \"1018089108070373346\": {\n    \"name\": \"A Nice Hotel\",\n    \"success\": true\n   },\n  \"2017089208070373346\": {\n    \"name\": \"Another Nice Hotel\",\n    \"success\": true\n   }\n  }\n}\n</code></pre>\n\n<p>Since I'm new to Golang I using a JSON Go tool available at <a href=\"http://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">http://mholt.github.io/json-to-go/</a> to get the struct representation for the above response. What I get is:</p>\n\n<pre><code>type Autogenerated struct {\n    Data struct {\n        Num1017089108070373346 struct {\n            Name string `json:\"name\"`\n            Success bool `json:\"success\"`\n        } `json:\"1017089108070373346\"`\n        Num2017089208070373346 struct {\n            Name string `json:\"name\"`\n            Success bool `json:\"success\"`\n        } `json:\"2017089208070373346\"`\n    } `json:\"data\"`\n}\n</code></pre>\n\n<p>I cannot use the above struct because the actual id values and the number of ids I pass can be different each time, the JSON returned will have different keys. How can this situation be mapped to a struct ?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "struct", "composite-literals"], "answers": [{"comments": [{"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "edited": false, "score": 0, "creation_date": 1454283402, "post_id": 35120825, "comment_id": 57962405, "body": "Thank you very much! Seems like a Gosublime has different error output..without these suggestions.."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "edited": false, "score": 0, "creation_date": 1576587089, "post_id": 35120825, "comment_id": 104941611, "body": "@bigless, (sorry to excavate an old thread but) the output of the compiler may depend on its version: the exact wording of the error messages produced by the toolchain is not covered by the <a href=\"https://golang.org/doc/go1compat\" rel=\"nofollow noreferrer\">Go (v1) compatibility guarantees</a>, so it&#39;s quite possible that icza merely has a version of Go installed different from that of yours."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 15, "last_activity_date": 1454283274, "last_edit_date": 1454283274, "creation_date": 1454282904, "answer_id": 35120825, "question_id": 35120724, "link": "https://stackoverflow.com/questions/35120724/struct-in-for-loop-initializer/35120825#35120825", "title": "Struct in for loop initializer", "body": "<p>Simplifying you code:</p>\n\n<pre><code>for r := Request{}; r.err == nil; r.id++ {\n    r.line, r.err = input.ReadSlice(0x0a)\n    channel &lt;- r\n}\n</code></pre>\n\n<p>Gives compile time error:</p>\n\n<blockquote>\n  <p>expected boolean or range expression, found simple statement (missing parentheses around composite literal?) (and 1 more errors)</p>\n</blockquote>\n\n<p>This construct is ambiguous to parse. The opening brace <code>'{'</code> is not obvious whether it is part of a <a href=\"https://golang.org/ref/spec#Composite_literals\">composite literal</a> or the opening brace of the <code>for</code> statement itself (the <code>for</code> <a href=\"https://golang.org/ref/spec#Block\">block</a>).</p>\n\n<p>You can make it obvious by using parentheses around the composite literal (as the error suggests):</p>\n\n<pre><code>for r := (Request{}); r.err == nil; r.id++ {\n    r.line, r.err = input.ReadSlice(0x0a)\n    channel &lt;- r\n}\n</code></pre>\n"}], "owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1931, "favorite_count": 2, "accepted_answer_id": 35120825, "answer_count": 1, "score": 6, "last_activity_date": 1528871472, "creation_date": 1454282167, "last_edit_date": 1528871472, "question_id": 35120724, "link": "https://stackoverflow.com/questions/35120724/struct-in-for-loop-initializer", "title": "Struct in for loop initializer", "body": "<p>Any idea why this struct expression in for loop initializer makes syntax error in compile-time? Pointer to struct works fine in this case but ofc I need local variable like bellow. Thanks for advices!</p>\n\n<pre><code>type Request struct {\n    id   int\n    line []byte\n    err  error\n}\n\ngo func() {\n    for r := Request{}; r.err == nil; r.id++ {\n        r.line, r.err = input.ReadSlice(0x0a)\n        channel &lt;- r\n    }\n}()\n</code></pre>\n"}, {"tags": ["arrays", "math", "random", "go", "generator"], "comments": [{"owner": {"reputation": 1257, "user_id": 928121, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/pp9W3.jpg?s=128&g=1", "display_name": "Mark Manning", "link": "https://stackoverflow.com/users/928121/mark-manning"}, "edited": false, "score": 0, "creation_date": 1454279764, "post_id": 35120321, "comment_id": 57961402, "body": "Sounds like you are using a standard random number generator. Although this is PHP - I would suggest looking at the write-up about the two types of random number generators that are used in PHP.<a href=\"http://php.net/docs.php\" rel=\"nofollow noreferrer\">php.net/docs.php</a>. Look for rand and mt_rand. You also might want to look at <a href=\"http://stackoverflow.com/questions/4720822/best-pseudo-random-number-generator\" title=\"best pseudo random number generator\">stackoverflow.com/questions/4720822/&hellip;</a>. Which is a possible duplicate of what you are asking about."}], "answers": [{"tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": false, "score": 2, "last_activity_date": 1454281036, "creation_date": 1454281036, "answer_id": 35120581, "question_id": 35120321, "link": "https://stackoverflow.com/questions/35120321/random-number-generator-repeates-some-numbers-too-often/35120581#35120581", "title": "Random number generator repeates some numbers too often", "body": "<p>I believe you are solving a different problem, the likelihood that two identical draws show up is much higher than one specific one will show up.</p>\n\n<p>This is known as <a href=\"https://en.wikipedia.org/wiki/Birthday_problem\" rel=\"nofollow\">Birthday Problem</a></p>\n"}, {"comments": [{"owner": {"reputation": 42860, "user_id": 54937, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d968f2f1240bf3e2c4080e773cc95129?s=128&d=identicon&r=PG", "display_name": "Sedat Kapanoglu", "link": "https://stackoverflow.com/users/54937/sedat-kapanoglu"}, "edited": false, "score": 0, "creation_date": 1454296794, "post_id": 35120696, "comment_id": 57965624, "body": "--Dali, &quot;On probability&quot;."}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": true, "score": 7, "last_activity_date": 1454282869, "last_edit_date": 1495540863, "creation_date": 1454281872, "answer_id": 35120696, "question_id": 35120321, "link": "https://stackoverflow.com/questions/35120321/random-number-generator-repeates-some-numbers-too-often/35120696#35120696", "title": "Random number generator repeates some numbers too often", "body": "<p>In my opinion you have a couple of problems here. </p>\n\n<ol>\n<li>You use Go playground, where your randomness is fixed. This line <code>rand.Seed(time.Now().UnixNano())</code> always produce the same seed because <code>time.Now()</code> is the same.</li>\n<li>You test completely different things with your simulation. I will write about it in the end.</li>\n<li>if you want to do something similar to gambling - you have to use <a href=\"https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator\" rel=\"nofollow noreferrer\">cryptographically secure PRNG</a> and <a href=\"https://golang.org/pkg/crypto/rand/\" rel=\"nofollow noreferrer\">Go has it</a>. If you want you can read <a href=\"https://stackoverflow.com/questions/1041509/generate-cryptographically-secure-random-numbers-in-php\">more details here</a> (the answer is to php question, but it explains the difference).</li>\n</ol>\n\n<hr>\n\n<p><strong>On the probability part:</strong></p>\n\n<p>The probability of winning your lottery is indeed <code>1/C(49, 6) = 1/13,983,816</code>. But this is the probability that someone would select an already predefined set of numbers. For example you claim that your winner is <code>{1, 5, 47, 3, 4, 5}</code> and now the probability that someone would win is approximately 1 in 14 mln. So you have to do the following. Randomly select a set of 6 numbers and then compare your new selection in a loop to already found.</p>\n\n<p>But what you do is to check the probability of collision. That having N people some of them would select the same sets (not necessarily even the winning set). This is known as the <a href=\"https://en.wikipedia.org/wiki/Birthday_problem\" rel=\"nofollow noreferrer\">birthday paradox</a>. And as you see there, the probability of collision increase dramatically with the increase of number of people N.</p>\n\n<p>This is absolutely the same problem, but your number of days in the year is <code>13,983,816</code> and you can <a href=\"https://lazycackle.com/Probability_of_repeated_event_online_calculator__birthday_problem_.html\" rel=\"nofollow noreferrer\">check here</a> that for this number of days you need only 5000 iterations to guarantee with 0.59 percents that you will get a collision. And with 9000 iterations you will find the collision with probability 0.94.</p>\n"}, {"tags": [], "owner": {"reputation": 460, "user_id": 3489783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/724bfd79f1cf35aca3dc2d7647f4cda1?s=128&d=identicon&r=PG&f=1", "display_name": "Fab", "link": "https://stackoverflow.com/users/3489783/fab"}, "is_accepted": false, "score": 0, "last_activity_date": 1473709226, "creation_date": 1473709226, "answer_id": 39457621, "question_id": 35120321, "link": "https://stackoverflow.com/questions/35120321/random-number-generator-repeates-some-numbers-too-often/39457621#39457621", "title": "Random number generator repeates some numbers too often", "body": "<p>BTW, a rough rule of thumb for the birthday paradox is that if you have N days, you need roundabout sqrt(N) people to get a good chance (around 50%) of a collision. </p>\n\n<p>So, for the original birthday paradox, you have 365 days, so the rule of thumb gives you that with 365^.5 or about 19 people you already have a decent chance of collision (true answer for >50%: 23 people). </p>\n\n<p>Here, with 13,983,816 possible outcomes, the rule of thumb tells you that with 3739 draws you have a pretty good chance of collision (true answer for 50%: 4400 draws).</p>\n"}], "owner": {"reputation": 955, "user_id": 4134847, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/513b1d7f1e558bd8b063bfcb508a9e5b?s=128&d=identicon&r=PG", "display_name": "Daniel Huckson", "link": "https://stackoverflow.com/users/4134847/daniel-huckson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 35120696, "answer_count": 3, "score": 1, "last_activity_date": 1473709226, "creation_date": 1454279323, "last_edit_date": 1454749283, "question_id": 35120321, "link": "https://stackoverflow.com/questions/35120321/random-number-generator-repeates-some-numbers-too-often", "title": "Random number generator repeates some numbers too often", "body": "<p>I'm writing a lottery draw simulation program as a project. The way the game works is you need to pick the 6 numbers that are draw from the 49 to win.</p>\n\n<p>Your chance of winning is 1/13,983,816 because that's how many combinations of 6 in 49 there are. The <kbd><a href=\"https://play.golang.org/p/1jdfnW4FOc\" rel=\"nofollow\">demo program on Go playground </a></kbd> generates six new numbers each time around the loop forever. </p>\n\n<p>Each time a new set of numbers is generated I test to see if it already exists and if it does I break out of the loop. With 13,983,816 combinations you would think it would be a long time before the same 6 numbers would repeat but, in testing it fails always before 10000 iteration. Does anyone know why this is happening?</p>\n"}, {"tags": ["linux", "go", "archlinux", "gccgo"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 1, "creation_date": 1454290525, "post_id": 35119578, "comment_id": 57964129, "body": "Does <b>go run form.go</b> have the same problem?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454334999, "post_id": 35119578, "comment_id": 57984238, "body": "Use the <code>go</code> tool to build the program. gccgo is a compiler, but doesn&#39;t know anything about the rest of the toolchain, or GOPATH. (and don&#39;t use gccgo unless you have a specific need for it)"}, {"owner": {"reputation": 11, "user_id": 5617566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b0b2597b288cdcbc3183c3d1af825c?s=128&d=identicon&r=PG&f=1", "display_name": "continue", "link": "https://stackoverflow.com/users/5617566/continue"}, "edited": false, "score": 0, "creation_date": 1454342790, "post_id": 35119578, "comment_id": 57989921, "body": "[continue@LenovoG780 user]$ go build # _/home/continue/~go/src/github.com/user ./form.go:44:7: \u043e\u0448\u0438\u0431\u043a\u0430: reference to undefined identifier &#171;gxui.EventLoop&#187;   gxui.EventLoop(driver)        ^ ./form.go:34:11: \u043e\u0448\u0438\u0431\u043a\u0430: reference to undefined field or method &#171;SetOrientation&#187;   btnLayout.SetOrientation(gxui.Horizontal)            ^ ./form.go:48:17: \u043e\u0448\u0438\u0431\u043a\u0430: argument 1 has incompatible type   gl.StartDriver(&quot;&quot;, appMain)                  ^ ./form.go:48:5: \u043e\u0448\u0438\u0431\u043a\u0430: too man"}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1454369730, "post_id": 35119578, "comment_id": 58005249, "body": "<a href=\"https://github.com/google/gxui\" rel=\"nofollow noreferrer\">gxui</a> has many dependencies. It looks like some are missing. The readme says to run <b>go get -u github.com/google/gxui/...</b> (don&#39;t forget the ...) to get everything. By the way, gxui is unmaintained, alternatives are listed on the github page."}, {"owner": {"reputation": 11, "user_id": 5617566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b0b2597b288cdcbc3183c3d1af825c?s=128&d=identicon&r=PG&f=1", "display_name": "continue", "link": "https://stackoverflow.com/users/5617566/continue"}, "edited": false, "score": 0, "creation_date": 1454422619, "post_id": 35119578, "comment_id": 58029922, "body": "I am use &lt;b&gt;&quot;get -u github.com/google/gxui/...&lt;/b&gt;.  The result is still the same"}, {"owner": {"reputation": 11, "user_id": 5617566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b0b2597b288cdcbc3183c3d1af825c?s=128&d=identicon&r=PG&f=1", "display_name": "continue", "link": "https://stackoverflow.com/users/5617566/continue"}, "edited": false, "score": 0, "creation_date": 1454454249, "post_id": 35119578, "comment_id": 58049448, "body": "<a href=\"http://pastebin.com/T5iqCGVU\" rel=\"nofollow noreferrer\">pastebin.com/T5iqCGVU</a>  Error&#39;s/ at ge &quot;get -u github.com/google/gxui/...&quot;"}], "owner": {"reputation": 11, "user_id": 5617566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b0b2597b288cdcbc3183c3d1af825c?s=128&d=identicon&r=PG&f=1", "display_name": "continue", "link": "https://stackoverflow.com/users/5617566/continue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 282, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1454275081, "creation_date": 1454275081, "question_id": 35119578, "link": "https://stackoverflow.com/questions/35119578/setting-up-the-workspace-in-golang", "title": "Setting up the workspace in GOLang?", "body": "<p>I can not in any way to customize the workspace in ArchLinux.\n    <pre>\n    form.go:6:24: \u043e\u0448\u0438\u0431\u043a\u0430: import file \u00abgithub.com/google/gxui\u00bb not found\n      \"github.com/google/gxui\"\n                            ^\n    form.go:7:35: \u043e\u0448\u0438\u0431\u043a\u0430: import file \u00abgithub.com/google/gxui/drivers/gl\u00bb not found\n      \"github.com/google/gxui/drivers/gl\"\n                                       ^\n    form.go:8:36: \u043e\u0448\u0438\u0431\u043a\u0430: import file \u00abgithub.com/google/gxui/themes/dark\u00bb not found\n      \"github.com/google/gxui/themes/dark\"\n                                        ^\n    form.go:11:25: \u043e\u0448\u0438\u0431\u043a\u0430: expected package\n     func appMain(driver gxui.Driver) {\n                             ^\n    form.go:19:32: \u043e\u0448\u0438\u0431\u043a\u0430: expected package\n      yesButton.OnClick(func(ev gxui.MouseEvent) {\n                                    ^\n    form.go:24:31: \u043e\u0448\u0438\u0431\u043a\u0430: expected package\n      noButton.OnClick(func(ev gxui.MouseEvent) {\n                                   ^\n    form.go:12:11: \u043e\u0448\u0438\u0431\u043a\u0430: reference to undefined name \u00abdark\u00bb\n      theme := dark.CreateTheme(driver)\n               ^\n    form.go:34:27: \u043e\u0448\u0438\u0431\u043a\u0430: reference to undefined name \u00abgxui\u00bb\n      btnLayout.SetOrientation(gxui.Horizontal)\n                               ^\n    form.go:37:32: \u043e\u0448\u0438\u0431\u043a\u0430: reference to undefined name \u00abgxui\u00bb\n      layout.SetHorizontalAlignment(gxui.AlignCenter)\n                                    ^\n    form.go:38:30: \u043e\u0448\u0438\u0431\u043a\u0430: reference to undefined name \u00abgxui\u00bb\n      layout.SetVerticalAlignment(gxui.AlignMiddle)\n                                  ^\n    form.go:44:2: \u043e\u0448\u0438\u0431\u043a\u0430: reference to undefined name \u00abgxui\u00bb\n      gxui.EventLoop(driver)\n      ^\n    form.go:48:2: \u043e\u0448\u0438\u0431\u043a\u0430: reference to undefined name \u00abgl\u00bb\n      gl.StartDriver(\"\", appMain)\n      ^\n    </pre>\n    Getting libraries:\n    <pre>\n    go get -u github.com/google/gxui\n    go get -u github.com/google/gxui/drivers/gl\n    go get -u github.com/google/gxui/themes/dark\n    </pre>\n    Exhaust go env:\n    <pre>\n    [continue@LenovoG780 user]$ go env\n    GOARCH=\"amd64\"\n    GOBIN=\"\"\n    GOCHAR=\"6\"\n    GOEXE=\"\"\n    GOHOSTARCH=\"amd64\"\n    GOHOSTOS=\"linux\"\n    GOOS=\"linux\"\n    GOPATH=\"/home/continue/go\"\n    GORACE=\"\"\n    GOROOT=\"/usr\"\n    GOTOOLDIR=\"/usr/lib/gcc/x86_64-unknown-linux-gnu/5.3.0\"\n    CC=\"/usr/bin/gcc\"\n    GOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\n    CXX=\"/usr/bin/g++\"\n    CGO_ENABLED=\"1\"\n    </pre>\n    Compilation:\n    <pre>\n    gccgo form.go -fuse-ld=gold -o form\n    </pre>\n    What could be the problem?\n    Thank you in advance.</p>\n"}, {"tags": ["go", "monitoring", "prometheus"], "answers": [{"tags": [], "owner": {"reputation": 2445, "user_id": 1505341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9XpLu.jpg?s=128&g=1", "display_name": "Kerem", "link": "https://stackoverflow.com/users/1505341/kerem"}, "is_accepted": false, "score": 0, "last_activity_date": 1454282249, "last_edit_date": 1454282249, "creation_date": 1454281757, "answer_id": 35120684, "question_id": 35117993, "link": "https://stackoverflow.com/questions/35117993/how-to-disable-go-collector-metrics-in-prometheus-client-golang/35120684#35120684", "title": "How to disable go_collector metrics in prometheus/client_golang", "body": "<p>It's not really helpful as an answer to say \"you'd have to go and do it yourself\" but it seems like the only option for now.</p>\n\n<p>Since Prometheus is open source and if you really need to do that; I believe you'd have to fork <a href=\"https://github.com/prometheus/client_golang/search?q=go_gc_duration_seconds&amp;type=Code&amp;utf8=%E2%9C%93\" rel=\"nofollow\">this one</a> go_collector.go line #28 and the related sections, or better yet modify it to make all those metrics optional and make a PR so other people may also benefit from that in the future.</p>\n"}, {"comments": [{"owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "edited": false, "score": 0, "creation_date": 1454320585, "post_id": 35125826, "comment_id": 57974893, "body": "hmm, if I remember correctly prometheus claims not to be opinionated... If say I maintain a network of humidity sensors for my potted plants. I think it is odd if a plant reports its number of goroutines, gc statistics and such. Good to know that this is already been worked on. Thanks for the metrics article!"}, {"owner": {"reputation": 24634, "user_id": 83591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CuiTl.jpg?s=128&g=1", "display_name": "brian-brazil", "link": "https://stackoverflow.com/users/83591/brian-brazil"}, "reply_to_user": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "edited": false, "score": 0, "creation_date": 1454335495, "post_id": 35125826, "comment_id": 57984560, "body": "Prometheus is quite opinionated, as a lot of things that seem like a good idea at first glance are actually anti-patterns. It&#39;s important to have all the key systems metrics, and that includes how the exporter itself is performing. Getting that automatically with the scrape is almost always the right thing to do. Something for potted plants may fall into the category where it doesn&#39;t make sense and you should monitor the exporter separately, depending on the exact architecture."}, {"owner": {"reputation": 4687, "user_id": 2176740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09c0ea83bcb343688502045304a0474?s=128&d=identicon&r=PG", "display_name": "joonas.fi", "link": "https://stackoverflow.com/users/2176740/joonas-fi"}, "edited": false, "score": 1, "creation_date": 1491288668, "post_id": 35125826, "comment_id": 73472291, "body": "It looks like that issue is complete but there&#39;s still no way to disable this. There&#39;s <code>init()</code> (Golang calls this) down there that uncondititionally starts the Go runtime and Process collectors: <a href=\"https://github.com/prometheus/client_golang/blob/69bb3870645f63c67a8dc9c9ef94585fd0d98c80/prometheus/registry.go#L51\" rel=\"nofollow noreferrer\">github.com/prometheus/client_golang/blob/&hellip;</a>"}], "tags": [], "owner": {"reputation": 24634, "user_id": 83591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CuiTl.jpg?s=128&g=1", "display_name": "brian-brazil", "link": "https://stackoverflow.com/users/83591/brian-brazil"}, "is_accepted": true, "score": 1, "last_activity_date": 1454314812, "creation_date": 1454314812, "answer_id": 35125826, "question_id": 35117993, "link": "https://stackoverflow.com/questions/35117993/how-to-disable-go-collector-metrics-in-prometheus-client-golang/35125826#35125826", "title": "How to disable go_collector metrics in prometheus/client_golang", "body": "<p>This is not currently possible in the Go client, once <a href=\"https://github.com/prometheus/client_golang/issues/46\" rel=\"nofollow\">https://github.com/prometheus/client_golang/issues/46</a> is complete you'll have a way to do this.</p>\n\n<p>In general you want your custom exporter to export these, the only ones I'm aware of where it doesn't currently make sense are the snmp and blackbox exporter.</p>\n\n<p>Incidentally <code>timestamp</code> seems odd as a label, if you want that you should likely be using logging rather than metrics. See <a href=\"https://blog.raintank.io/logs-and-metrics-and-graphs-oh-my/\" rel=\"nofollow\">https://blog.raintank.io/logs-and-metrics-and-graphs-oh-my/</a>\nThe Prometheus way would be to have the timestamp as a value, not as a label.</p>\n"}, {"comments": [{"owner": {"reputation": 866, "user_id": 4779556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06acde1d128b9fadc43f9a486318c13e?s=128&d=identicon&r=PG", "display_name": "Roald Nefs", "link": "https://stackoverflow.com/users/4779556/roald-nefs"}, "edited": false, "score": 0, "creation_date": 1561579102, "post_id": 50745945, "comment_id": 100115223, "body": "Just verified that is also works with version <a href=\"https://github.com/prometheus/client_golang/releases/tag/v1.0.0\" rel=\"nofollow noreferrer\">1.0.0</a> of the codebase."}], "tags": [], "owner": {"reputation": 171, "user_id": 697580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/428ce71b4bb228964b189a9bccfbf8b6?s=128&d=identicon&r=PG", "display_name": "Ruben Jenster", "link": "https://stackoverflow.com/users/697580/ruben-jenster"}, "is_accepted": false, "score": 10, "last_activity_date": 1528388294, "creation_date": 1528388294, "answer_id": 50745945, "question_id": 35117993, "link": "https://stackoverflow.com/questions/35117993/how-to-disable-go-collector-metrics-in-prometheus-client-golang/50745945#50745945", "title": "How to disable go_collector metrics in prometheus/client_golang", "body": "<p>Well the topic is rather old but in case others have to deal with it.\nThe following code works fine with current codebase <a href=\"https://github.com/prometheus/client_golang/tree/v0.9.0-pre1\" rel=\"noreferrer\">v0.9.0-pre1</a></p>\n\n<pre><code>// [...] imports, metric initialization ...\n\nfunc main() {\n  // go get rid of any additional metrics \n  // we have to expose our metrics with a custom registry\n  r := prometheus.NewRegistry()\n  r.MustRegister(myMetrics)\n  handler := promhttp.HandlerFor(r, promhttp.HandlerOpts{})\n\n  // [...] update metrics within a goroutine\n\n  http.Handle(\"/metrics\", handler)\n  log.Fatal(http.ListenAndServe(\":12345\", nil))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1473, "user_id": 2687547, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fc2ebef6d56ff917d93f6f295fd59b4?s=128&d=identicon&r=PG&f=1", "display_name": "dganesh2002", "link": "https://stackoverflow.com/users/2687547/dganesh2002"}, "is_accepted": false, "score": 0, "last_activity_date": 1599421961, "creation_date": 1599421961, "answer_id": 63768316, "question_id": 35117993, "link": "https://stackoverflow.com/questions/35117993/how-to-disable-go-collector-metrics-in-prometheus-client-golang/63768316#63768316", "title": "How to disable go_collector metrics in prometheus/client_golang", "body": "<p>I would simply do it this way -&gt;</p>\n<pre><code>// Register your collectors\nelapsed := prometheus.NewGaugeVec(prometheus.GaugeOpts{\n    Name: &quot;gogrinder_elapsed_ms&quot;,\n    Help: &quot;Current time elapsed of gogrinder teststep&quot;,\n}, []string{&quot;teststep&quot;, &quot;user&quot;, &quot;iteration&quot;, &quot;timestamp&quot;})\nprometheus.MustRegister(elapsed)\n// Remove Go collector\nprometheus.Unregister(prometheus.NewGoCollector())\n</code></pre>\n"}], "owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4600, "favorite_count": 1, "accepted_answer_id": 35125826, "answer_count": 4, "score": 5, "last_activity_date": 1599421961, "creation_date": 1454266782, "last_edit_date": 1454267462, "question_id": 35117993, "link": "https://stackoverflow.com/questions/35117993/how-to-disable-go-collector-metrics-in-prometheus-client-golang", "title": "How to disable go_collector metrics in prometheus/client_golang", "body": "<p>I am using a NewGaugeVec to report my metrics:</p>\n\n<pre><code>elapsed := prometheus.NewGaugeVec(prometheus.GaugeOpts{\n    Name: \"gogrinder_elapsed_ms\",\n    Help: \"Current time elapsed of gogrinder teststep\",\n}, []string{\"teststep\", \"user\", \"iteration\", \"timestamp\"})\nprometheus.MustRegister(elapsed)\n</code></pre>\n\n<p>All works fine but I noticed that my custom exporter contains all metrics from prometheus/go_collector.go:</p>\n\n<pre><code># HELP go_gc_duration_seconds A summary of the GC invocation durations.\n# TYPE go_gc_duration_seconds summary\ngo_gc_duration_seconds{quantile=\"0\"} 0.00041795300000000004\ngo_gc_duration_seconds{quantile=\"0.25\"} 0.00041795300000000004\ngo_gc_duration_seconds{quantile=\"0.5\"} 0.00041795300000000004\n...\n</code></pre>\n\n<p>I suspect that this is kind of a default behavior but I did not find anything in the documentation on how to disable that. Any ideas on how to configure my custom exporter so that these default metrics disappear?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 1106495, "user_id": 1144035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e514b017977ebf742a418cac697d8996?s=128&d=identicon&r=PG", "display_name": "Gordon Linoff", "link": "https://stackoverflow.com/users/1144035/gordon-linoff"}, "edited": false, "score": 0, "creation_date": 1454265632, "post_id": 35117714, "comment_id": 57955928, "body": "You are passing in three arguments to the <code>Scan()</code>.  The format string is only expecting one."}], "answers": [{"comments": [{"owner": {"reputation": 755, "user_id": 1901005, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/ZWY6X.png?s=128&g=1", "display_name": "Chandu", "link": "https://stackoverflow.com/users/1901005/chandu"}, "edited": false, "score": 0, "creation_date": 1454266669, "post_id": 35117772, "comment_id": 57956320, "body": "Yes, Its working @MuffinTop. I have lot of data-&gt;&gt; fields in my table. Can you please share a piece of code how to use &quot;data as a single field and decode the result with the encoding/json package.&quot;"}, {"owner": {"reputation": 755, "user_id": 1901005, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/ZWY6X.png?s=128&g=1", "display_name": "Chandu", "link": "https://stackoverflow.com/users/1901005/chandu"}, "edited": false, "score": 0, "creation_date": 1454266888, "post_id": 35117772, "comment_id": 57956402, "body": "Thanks a lot @MuffinTop :)"}, {"owner": {"reputation": 755, "user_id": 1901005, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/ZWY6X.png?s=128&g=1", "display_name": "Chandu", "link": "https://stackoverflow.com/users/1901005/chandu"}, "edited": false, "score": 0, "creation_date": 1454267838, "post_id": 35117772, "comment_id": 57956753, "body": "Just to notify you json.Unmarshal instead of json.Decode. Code working as a charm. thanks again"}, {"owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1578400765, "post_id": 35117772, "comment_id": 105419112, "body": "The solution really looks good. But I am not able to implement it. I am still getting the same error. You can see my code here - <a href=\"https://play.golang.org/p/x_P50Ode4QU\" rel=\"nofollow noreferrer\">play.golang.org/p/x_P50Ode4QU</a>. Do you have any idea what mistake I am doing?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1578411883, "post_id": 35117772, "comment_id": 105425474, "body": "@RahulSatal  The details of this answer are only relevant to your application if you are using a Postgres JSONB field. Fix your application by passing the address of the individual fields to Scan."}, {"owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1578422759, "post_id": 35117772, "comment_id": 105430823, "body": "@CeriseLim&#243;n Yes, I am using SQL Server and this fix is not working for it. Thanks for your response."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1463035980, "last_edit_date": 1463035980, "creation_date": 1454265659, "answer_id": 35117772, "question_id": 35117714, "link": "https://stackoverflow.com/questions/35117714/panic-sql-expected-1-destination-arguments-in-scan-not-number-golang-pq-s/35117772#35117772", "title": "panic: sql: expected 1 destination arguments in Scan, not &lt;number&gt; golang, pq, sql", "body": "<p>The query returns one field per row. The code is scanning for three. Perhaps you want something like:</p>\n\n<pre><code>err := db.QueryRow(\"SELECT data-&gt;&gt;'id', data-&gt;&gt;'type', data-&gt;&gt;'title' FROM message WHERE data-&gt;&gt;'id'=$1\", id).Scan(m.Id, m.Type, m.Title)\n</code></pre>\n\n<p>Also, pass pointers to the values:</p>\n\n<pre><code>err := db.QueryRow(\"SELECT data-&gt;&gt;'id', data-&gt;&gt;'type', data-&gt;&gt;'title' FROM message WHERE data-&gt;&gt;'id'=$1\", id).Scan(&amp;m.Id, &amp;m.Type, &amp;m.Title)\n</code></pre>\n\n<p>Another option is to fetch the data as a single field and decode the result with the encoding/json package.</p>\n\n<pre><code>var p []byte\nerr := db.QueryRow(\"SELECT data FROM message WHERE data-&gt;&gt;'id'=$1\", id).Scan(&amp;p)\nif err != nil {\n    // handle error\n}\nvar m Message\nerr := json.Unmarshal(p, &amp;m)\nif err != nil {\n    // handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 755, "user_id": 1901005, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/ZWY6X.png?s=128&g=1", "display_name": "Chandu", "link": "https://stackoverflow.com/users/1901005/chandu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13903, "favorite_count": 2, "accepted_answer_id": 35117772, "answer_count": 1, "score": 5, "last_activity_date": 1504018125, "creation_date": 1454265417, "last_edit_date": 1504018125, "question_id": 35117714, "link": "https://stackoverflow.com/questions/35117714/panic-sql-expected-1-destination-arguments-in-scan-not-number-golang-pq-s", "title": "panic: sql: expected 1 destination arguments in Scan, not &lt;number&gt; golang, pq, sql", "body": "<p>I am fetching the data using db.QueryRow. Table created using Postgresql with data type jsonb. Below is code in golang</p>\n\n<pre><code>m := Message{}\nerr := db.QueryRow(\"SELECT data FROM message WHERE data-&gt;&gt;'id'=$1\", id).Scan(m.Id, m.Type, m.Title)\n</code></pre>\n\n<p>panic: sql: expected 1 destination arguments in Scan, not 3. As per <a href=\"https://golang.org/pkg/database/sql/#Row.Scan\" rel=\"noreferrer\">row.Scan</a> can pass n number of destination arguments. Whats wrong with this code?</p>\n"}, {"tags": ["reflection", "go"], "answers": [{"comments": [{"owner": {"reputation": 18922, "user_id": 3633742, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/thyJX.jpg?s=128&g=1", "display_name": "n00dl3", "link": "https://stackoverflow.com/users/3633742/n00dl3"}, "edited": false, "score": 0, "creation_date": 1454257260, "post_id": 35116049, "comment_id": 57952677, "body": "hmmm... I think I get it, thank you. Another last question, is there another way to achieve this without reflection api ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 18922, "user_id": 3633742, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/thyJX.jpg?s=128&g=1", "display_name": "n00dl3", "link": "https://stackoverflow.com/users/3633742/n00dl3"}, "edited": false, "score": 1, "creation_date": 1454257715, "post_id": 35116049, "comment_id": 57952854, "body": "You can use the ini package&#39;s MapTo functionality (see methods on <a href=\"https://godoc.org/gopkg.in/ini.v1#File.MapTo\" rel=\"nofollow noreferrer\">File</a> and <a href=\"https://godoc.org/gopkg.in/ini.v1#Section.MapTo\" rel=\"nofollow noreferrer\">Section</a>), but that uses reflect under the hood."}, {"owner": {"reputation": 18922, "user_id": 3633742, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/thyJX.jpg?s=128&g=1", "display_name": "n00dl3", "link": "https://stackoverflow.com/users/3633742/n00dl3"}, "edited": false, "score": 0, "creation_date": 1454257860, "post_id": 35116049, "comment_id": 57952911, "body": "Oh... Indeed, I didn&#39;t see that method. Thanks for the tips."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1454351349, "last_edit_date": 1454351349, "creation_date": 1454256967, "answer_id": 35116049, "question_id": 35115906, "link": "https://stackoverflow.com/questions/35115906/how-to-initialize-a-struct-value-fields-using-reflection/35116049#35116049", "title": "How to initialize a struct value fields using reflection?", "body": "<p>Use the <a href=\"https://godoc.org/reflect#Value.Type\" rel=\"nofollow\">type</a> to <a href=\"https://godoc.org/reflect#Type.Field\" rel=\"nofollow\">get a StructField</a>. The StructField has the <a href=\"https://godoc.org/reflect#StructField.Name\" rel=\"nofollow\">name</a>:</p>\n\n<pre><code> name := value.Type().Field(i).Name\n</code></pre>\n\n<p>Note that the ini package's <a href=\"https://godoc.org/gopkg.in/ini.v1#File.MapTo\" rel=\"nofollow\">File.MapTo</a> and <a href=\"https://godoc.org/gopkg.in/ini.v1#Section.MapTo\" rel=\"nofollow\">Section.MapTo</a> methods implement this functionality.</p>\n"}, {"comments": [{"owner": {"reputation": 18922, "user_id": 3633742, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/thyJX.jpg?s=128&g=1", "display_name": "n00dl3", "link": "https://stackoverflow.com/users/3633742/n00dl3"}, "edited": false, "score": 0, "creation_date": 1454338326, "post_id": 35133361, "comment_id": 57986755, "body": "actualy @MuffinTop pointed this out in the comments. I was pretty sure it existed such implementations, but as a real Go-newbie, I was more curious about the underlying bare-metal way as it&#39;s a common process to assing values to dynamic Object/Struct properties. Anyway, I agree with you, it&#39;s much cleaner using libraries&#39;s built-in mapping functionality. Thanks for taking the time to answer."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 18922, "user_id": 3633742, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/thyJX.jpg?s=128&g=1", "display_name": "n00dl3", "link": "https://stackoverflow.com/users/3633742/n00dl3"}, "edited": false, "score": 0, "creation_date": 1454350755, "post_id": 35133361, "comment_id": 57995082, "body": "@n00dl3, oh silly me: I got so fixated on your direct usage of reflection I did not spot you were already using <code>gopkg.in&#47;ini.v1</code> to parse your INI data! So yeah, the @MuffinTop&#39;s answer plus their comment is a spot-on."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 18922, "user_id": 3633742, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/thyJX.jpg?s=128&g=1", "display_name": "n00dl3", "link": "https://stackoverflow.com/users/3633742/n00dl3"}, "edited": false, "score": 0, "creation_date": 1454351118, "post_id": 35133361, "comment_id": 57995303, "body": "JFTR: the <code>gopkg.in&#47;ini.v1</code> package wasn&#39;t among those I recommended because in my personal opinion that package is a prime example of typical overengeneering with its built-in locking for serializing R/W access being a clear Go anti-pattern. It&#39;s okay for a start though so don&#39;t bother with this for now, @n00dl3, so long it works ;-)"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1454350572, "last_edit_date": 1454350572, "creation_date": 1454337809, "answer_id": 35133361, "question_id": 35115906, "link": "https://stackoverflow.com/questions/35115906/how-to-initialize-a-struct-value-fields-using-reflection/35133361#35133361", "title": "How to initialize a struct value fields using reflection?", "body": "<p>While @MuffinTop solved your immediate issue, I'd say you may be solving a wrong problem.  I personally know of at least two packages, <a href=\"https://godoc.org/github.com/Thomasdezeeuw/ini\" rel=\"nofollow\"><code>github.com/Thomasdezeeuw/ini</code></a> and <a href=\"https://godoc.org/gopkg.in/gcfg.v1\" rel=\"nofollow\"><code>gopkg.in/gcfg.v1</code></a>, which are able to parse INI-style files (of the various level of \"INI-ness\", FWIW) and automatically populate your <code>struct</code>-typed values using reflection, so for you it merely amounts to properly setting tags on the fields of your struct (if needed at all).</p>\n\n<p>I used both of these packages in production so am able to immediately recommend them.  You might find more packages dedicated to parsing INI files <a href=\"https://godoc.org/?q=ini\" rel=\"nofollow\">on <code>godoc.org</code></a>.</p>\n"}], "owner": {"reputation": 18922, "user_id": 3633742, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/thyJX.jpg?s=128&g=1", "display_name": "n00dl3", "link": "https://stackoverflow.com/users/3633742/n00dl3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 0, "accepted_answer_id": 35116049, "answer_count": 2, "score": 0, "last_activity_date": 1454351349, "creation_date": 1454256187, "last_edit_date": 1454337464, "question_id": 35115906, "link": "https://stackoverflow.com/questions/35115906/how-to-initialize-a-struct-value-fields-using-reflection", "title": "How to initialize a struct value fields using reflection?", "body": "<p>I got a <code>.ini</code> configuration file that I want to use to initialize a <code>Configuration</code> struct.</p>\n\n<p>I'd like to use the <code>Configuration</code> fields names and loop over them to populate my new instance with the corresponding value in the .ini file. </p>\n\n<p>I thought the best way to achieve this might be reflection API (maybe I'm totally wrong, tell me...)</p>\n\n<p>My problem here is that I cannot figure out how to access field's name (if it is at least possible)</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package test\nimport(\n     \"reflect\"\n     \"gopkg.in/ini.v1\"\n )\n\ntype Config struct {\n    certPath string\n    keyPath  string\n    caPath   string\n}\n\nfunc InitConfig(iniConf *ini.File) *Config{\n    config:=new(Config)\n    var valuePtr reflect.Value = reflect.ValueOf(config)\n    var value reflect.Value = valuePtr.Elem()\n    for i := 0; i &lt; value.NumField(); i++ {\n        field := value.Field(i)\n        if field.Type() == reflect.TypeOf(\"\") {\n            //here is my problem, I can't get the field name, this method does not exist... :'(\n            value:=cfg.GetSection(\"section\").GetKey(field.GetName())\n            field.SetString(value)\n        }\n    }\n    return config\n}\n</code></pre>\n\n<p>Any help appreciated...</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1454256280, "post_id": 35115868, "comment_id": 57952330, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/33206059/go-converting-float64-to-int-with-multiplier\">Go: Converting float64 to int with multiplier</a>"}, {"owner": {"reputation": 28131, "user_id": 1956010, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bfdcb4596e9da98cccbf9a0069fdff6c?s=128&d=identicon&r=PG", "display_name": "nwellnhof", "link": "https://stackoverflow.com/users/1956010/nwellnhof"}, "edited": false, "score": 3, "creation_date": 1454256746, "post_id": 35115868, "comment_id": 57952499, "body": "Related issue: <a href=\"https://github.com/golang/go/issues/4594\" rel=\"nofollow noreferrer\">math: add a Round function</a>"}, {"owner": {"reputation": 471, "user_id": 2660816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4335a1d3fa709681a163f5cac336c4ca?s=128&d=identicon&r=PG", "display_name": "Levsero", "link": "https://stackoverflow.com/users/2660816/levsero"}, "edited": false, "score": 0, "creation_date": 1454258639, "post_id": 35115868, "comment_id": 57953221, "body": "@Akavall edited title,"}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1594337730, "post_id": 35115868, "comment_id": 111099083, "body": "<code>int(Round(f))</code> to round a float to an int. See <a href=\"https://stackoverflow.com/a/62753031/12817546\">stackoverflow.com/a/62753031/12817546</a>.  <code>float64(i)</code> to set an int to a float. See <a href=\"https://stackoverflow.com/a/62737936/12817546\">stackoverflow.com/a/62737936/12817546</a>."}], "answers": [{"comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1454317948, "post_id": 35115876, "comment_id": 57973209, "body": "This provides a <i>type conversion</i>; please note that the term <i>cast</i> is not used."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1454318038, "post_id": 35115876, "comment_id": 57973261, "body": "Also, your type conversion will not work well with negative numbers if you intended the rounding to be to the <i>nearest</i> whole integer."}], "tags": [], "owner": {"reputation": 471, "user_id": 2660816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4335a1d3fa709681a163f5cac336c4ca?s=128&d=identicon&r=PG", "display_name": "Levsero", "link": "https://stackoverflow.com/users/2660816/levsero"}, "is_accepted": true, "score": 6, "last_activity_date": 1454317968, "last_edit_date": 1454317968, "creation_date": 1454255995, "answer_id": 35115876, "question_id": 35115868, "link": "https://stackoverflow.com/questions/35115868/how-to-round-to-nearest-int-when-casting-float-to-int-in-go/35115876#35115876", "title": "How to round to nearest int when casting float to int in go", "body": "<p><code>int(f+0.5)</code> will cause for it to round upwards if it's >= .5</p>\n"}, {"comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1594114039, "post_id": 62753031, "comment_id": 111005447, "body": "A boolean, numeric, or string type can be set to another type. For<code>[]byte</code> see <a href=\"https://stackoverflow.com/a/62725637/12817546\">stackoverflow.com/a/62725637/12817546</a>, <code>int</code> see <a href=\"https://stackoverflow.com/a/62737936/12817546\">stackoverflow.com/a/62737936/12817546</a>, <code>[]rune</code> see <a href=\"https://stackoverflow.com/a/62739051/12817546\">stackoverflow.com/a/62739051/12817546</a>, <code>string</code> see <a href=\"https://stackoverflow.com/a/62740786/12817546\">stackoverflow.com/a/62740786/12817546</a> and for <code>bool</code> see <a href=\"https://stackoverflow.com/a/62726854/12817546\">stackoverflow.com/a/62726854/12817546</a>."}], "tags": [], "owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "is_accepted": false, "score": 3, "last_activity_date": 1594037891, "last_edit_date": 1594037891, "creation_date": 1594027452, "answer_id": 62753031, "question_id": 35115868, "link": "https://stackoverflow.com/questions/35115868/how-to-round-to-nearest-int-when-casting-float-to-int-in-go/62753031#62753031", "title": "How to round to nearest int when casting float to int in go", "body": "<p>You could use <code>int(math.Round(f))</code> to round to the nearest whole number when converting a float to an int in Go. The decimal is also discarded when a float is set to a byte or a rune. Truncation doesn't happen when it's set to a string or a bool.</p>\n<pre><code>package main\n\nimport (\n  . &quot;fmt&quot;\n  . &quot;math&quot;\n)\n\nfunc main() {\n  f := 3.6\n  c := []interface{}{byte(f), f, int(Round(f)), rune(f), Sprintf(&quot;%.f&quot;, f), f != 0}\n  checkType(c)\n}\nfunc checkType(s []interface{}) {\n  for k, _ := range s {\n     Printf(&quot;%T %v\\n&quot;, s[k], s[k])\n  }\n}\n</code></pre>\n<p>Round returns the nearest integer, rounding half away from zero. See <a href=\"https://golang.org/pkg/math/#Round\" rel=\"nofollow noreferrer\">https://golang.org/pkg/math/#Round</a>. See <a href=\"https://stackoverflow.com/a/61503758/12817546\">https://stackoverflow.com/a/61503758/12817546</a>.</p>\n<p><code>f := 3.6</code> truncates to \u201cuint8 3\u201d, <code>f</code> is \u201cfloat64 3.6\u201d, <code>int(Round(f))</code> rounds up to \u201cint 4\u201d,  <code>rune(f)</code> truncates to \u201cint32 3\u201d,  <code>Sprintf(&quot;%.f&quot;, f)</code> is \u201cstring 3.6\u201d and <code>f != 0</code> outputs \u201cbool true\u201d.</p>\n"}], "owner": {"reputation": 471, "user_id": 2660816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4335a1d3fa709681a163f5cac336c4ca?s=128&d=identicon&r=PG", "display_name": "Levsero", "link": "https://stackoverflow.com/users/2660816/levsero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3395, "favorite_count": 0, "accepted_answer_id": 35115876, "answer_count": 2, "score": 8, "last_activity_date": 1594037891, "creation_date": 1454255942, "last_edit_date": 1454258349, "question_id": 35115868, "link": "https://stackoverflow.com/questions/35115868/how-to-round-to-nearest-int-when-casting-float-to-int-in-go", "title": "How to round to nearest int when casting float to int in go", "body": "<p>When casting float to int the decimal is discarded. What's a clean way to cast so that it rounds to the nearest whole number instead.</p>\n\n<p><code>x := int(3.6)</code>\nshould equal 4 instead of 3.</p>\n"}, {"tags": ["oop", "go", "polymorphism"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 1, "creation_date": 1454253769, "post_id": 35115385, "comment_id": 57951450, "body": "I think you could Create and return an interface <a href=\"https://gobyexample.com/interfaces\" rel=\"nofollow noreferrer\">gobyexample.com/interfaces</a>"}], "answers": [{"comments": [{"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 1, "creation_date": 1454254850, "post_id": 35115676, "comment_id": 57951848, "body": "I&#39;ve heard the problem with interface is that it loses compile time type checking, right?"}, {"owner": {"reputation": 490, "user_id": 3310759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/409b69c3ae7b431fc16129ccdadae9cd?s=128&d=identicon&r=PG", "display_name": "driusan", "link": "https://stackoverflow.com/users/3310759/driusan"}, "edited": false, "score": 7, "creation_date": 1454255654, "post_id": 35115676, "comment_id": 57952103, "body": "I think you&#39;re confusing &quot;interface&quot; with &quot;interface {}&quot;.. Go will still type check interfaces at compile time, it&#39;ll just check that the variable is an instance of that interface. The problem with &quot;interface{}&quot; is that, since the functions that need to be matched for the interface is the empty set, everything matches it, and you lose compile time type checking."}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "reply_to_user": {"reputation": 490, "user_id": 3310759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/409b69c3ae7b431fc16129ccdadae9cd?s=128&d=identicon&r=PG", "display_name": "driusan", "link": "https://stackoverflow.com/users/3310759/driusan"}, "edited": false, "score": 0, "creation_date": 1454255879, "post_id": 35115676, "comment_id": 57952176, "body": "@driusan awesome reply! Thanks"}, {"owner": {"reputation": 15998, "user_id": 770425, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f87997cd806a0495c0b677f5a7728319?s=128&d=identicon&r=PG", "display_name": "Jeff Widman", "link": "https://stackoverflow.com/users/770425/jeff-widman"}, "edited": false, "score": 1, "creation_date": 1571255162, "post_id": 35115676, "comment_id": 103183533, "body": "It appears <code>Bar2</code> is not needed in this example?"}], "tags": [], "owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "is_accepted": true, "score": 16, "last_activity_date": 1454254793, "creation_date": 1454254793, "answer_id": 35115676, "question_id": 35115385, "link": "https://stackoverflow.com/questions/35115385/polymorphism-in-go-lang/35115676#35115676", "title": "Polymorphism in Go lang", "body": "<p>Go is not a typical OO language. Also each language has it own way of doing things. You can use interface and composition to achieve what you desire to, as shown below:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Foo interface {\n   printFoo()\n}\n\ntype FooImpl struct {\n\n}\n\ntype Bar struct {\n   FooImpl\n}\n\ntype Bar2 struct {\n   FooImpl\n}\n\nfunc (f FooImpl)printFoo(){\n    fmt.Println(\"Print Foo Impl\")\n}\n\nfunc getFoo() Foo {\n   return Bar{}\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    b := getFoo()\n    b.printFoo()\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/iR8QkD3DnP\">http://play.golang.org/p/iR8QkD3DnP</a></p>\n"}, {"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": 5, "last_activity_date": 1454334223, "last_edit_date": 1454334223, "creation_date": 1454293866, "answer_id": 35122196, "question_id": 35115385, "link": "https://stackoverflow.com/questions/35115385/polymorphism-in-go-lang/35122196#35122196", "title": "Polymorphism in Go lang", "body": "<p>In Go, polymorphism is achieved by implementing interfaces.</p>\n\n<pre><code>type Being interface {\n        somemethod()\n}\n\ntype Foo struct {}\n\ntype Bar struct {\n        Foo\n}\n\ntype Baz struct {\n        Foo\n}\n\n// `Bar` and `Baz` implement `Being`\nfunc (b *Bar) somemethod() {}\nfunc (b *Baz) somemethod() {}\n\nfunc getAnyFoo(b *Being) Foo {\n   return b.Foo\n}\n</code></pre>\n\n<p>Therefore, anything implements an empty interface.</p>\n\n<pre><code>type Foo struct {}\n\ntype Bar struct {\n        Foo\n}\n\n// Get anything and extract its `Foo` if anything is a Bar\nfunc getAnyFoo(i interface{}) Foo {\n        // Normally this would need a type switch to check the type\n        mybar := i.(Bar)\n        return mybar.Foo\n}\n</code></pre>\n"}], "owner": {"reputation": 3386, "user_id": 4158603, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/6A1qm.png?s=128&g=1", "display_name": "areller", "link": "https://stackoverflow.com/users/4158603/areller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9818, "favorite_count": 1, "accepted_answer_id": 35115676, "answer_count": 2, "score": 16, "last_activity_date": 1454334223, "creation_date": 1454253113, "last_edit_date": 1454253508, "question_id": 35115385, "link": "https://stackoverflow.com/questions/35115385/polymorphism-in-go-lang", "title": "Polymorphism in Go lang", "body": "<p>I am learning go lang and i was wondering if there is a way to do something like this:</p>\n\n<pre><code>type Foo struct {\n   ...\n}\n\ntype Bar struct {\n   Foo\n   ...\n}\n\nfunc getFoo() Foo {\n   return Bar{...}\n}\n</code></pre>\n\n<p>In an object oriented language, such code should work without problems, but in go it throws me an error, saying that <code>getFoo()</code> must return an instance of class Foo.</p>\n\n<p>Is there a way to do polymorphism similar to what i've described in Go?</p>\n"}, {"tags": ["rest", "oop", "go", "dry"], "answers": [{"comments": [{"owner": {"reputation": 2800, "user_id": 878244, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/f31ec619b91d3fb589c67ef04e13beaa?s=128&d=identicon&r=PG", "display_name": "Yehonatan", "link": "https://stackoverflow.com/users/878244/yehonatan"}, "edited": false, "score": 0, "creation_date": 1454272544, "post_id": 35114801, "comment_id": 57958771, "body": "Thank you very much for the well detailed answer!"}], "tags": [], "owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "is_accepted": true, "score": 5, "last_activity_date": 1454249726, "creation_date": 1454249726, "answer_id": 35114801, "question_id": 35114289, "link": "https://stackoverflow.com/questions/35114289/dynamic-casting-in-golang/35114801#35114801", "title": "Dynamic casting in Golang", "body": "<p>There are a few things you can do to reduce code duplication, but unfortunately, you will always be writing some boilerplate in go, because of it's explicit error handling and lack of OOP-ness. (which is not necessarily a bad thing!). </p>\n\n<p>So my only suggestions at the moment is to put common functionality in middleware handlers and restructure your code a litte, for example:</p>\n\n<pre><code>parseIdMiddleware := func(c *gin.Context) {\n  id, err := strconv.Atoi(c.Param(\"id\"))\n  if businessID == 0 || err != nil {\n    c.AbortWithError(http.StatusBadRequest, errors.New(\"Missing ID\"))\n    return\n  }\n  c.Set(\"id\", id)\n}\n...\ngin.Use(gin.ErrorLogger(), parseIdMiddleware)\n</code></pre>\n\n<p>and rewrite your handlers to</p>\n\n<pre><code>func GetBusiness(c *gin.Context) {\n  id := c.MustGet(\"id\").(int)\n  business, err := store.GetBusiness(id)\n  if err != nil {\n    c.AbortWithError(http.StatusBadRequest, err)\n    return // don't forget this!\n  }\n  c.JSON(http.StatusOK, business)\n}\n</code></pre>\n\n<p>And as always, read other people's code! I recommend <a href=\"https://github.com/drone/drone\">https://github.com/drone/drone</a>. That should give you a pretty good overview of how to structure your code.</p>\n"}], "owner": {"reputation": 2800, "user_id": 878244, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/f31ec619b91d3fb589c67ef04e13beaa?s=128&d=identicon&r=PG", "display_name": "Yehonatan", "link": "https://stackoverflow.com/users/878244/yehonatan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 887, "favorite_count": 0, "accepted_answer_id": 35114801, "answer_count": 1, "score": 1, "last_activity_date": 1454249726, "creation_date": 1454246416, "question_id": 35114289, "link": "https://stackoverflow.com/questions/35114289/dynamic-casting-in-golang", "title": "Dynamic casting in Golang", "body": "<p>So... I'm creating a RESTful API for my idea using Gin framework and I've came into the following problem - \nLet's say that I've got the following endpoints:</p>\n\n<p><code>/a/:id/*action\n/b/:id/*action\n/c/:id/*action\n</code>\nSo, obviously, when I'm not giving any action then I want to return the data for the given ID. Meaning, I'm doing nothing but querying some data and returning it, this means that the functionality is basically the same and only the returned data is different.</p>\n\n<p>Here's an example code of mine - </p>\n\n<pre><code>   func GetBusiness(c *gin.Context) {                                                                                                                                                                                     \n       businessID, err := strconv.Atoi(c.Param(\"id\"))                                                                                                                                                                                  \n       if businessID == 0 || err != nil {                                                                                                                                                                                               \n           c.JSON(http.StatusBadRequest, gin.H{\"success\": false, \"errorMessage\": \"Missing ID\"})                                                                                                                                         \n       }                                                                                                                                                                                                                                 \n       business := &amp;Business{}                                                                                                                                                                                                           \n       business, err = business.Get(businessID)                                                                                                                                                                                         \n       if err != nil {                                                                                                                                                                                                                  \n           c.JSON(http.StatusBadRequest, gin.H{\"success\": false, \"errorMessage\": \"Business not found\"})                                                                                                                                \n       }                                                                                                                                                                                                                                \n      c.JSON(http.StatusOK, business)                                                                                                                                                                                                   \n   }   \n</code></pre>\n\n<p>So, obviously, business can become user or anything else. So, after this long exposition, my question to you goers, is, how can I prevent code duplication in this kind of situation? I've tried using an interface but I'm still struggling with the OO nature of Go, so I would really appriciate any help.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["go", "redis"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1454246593, "post_id": 35113331, "comment_id": 57948969, "body": "LPOP will consume 100% in a loop because it returns immediately. BLPOP will block for as long as you ask it when run in a loop, so you can control this and not get into 100% CPU."}, {"owner": {"reputation": 1889, "user_id": 892404, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6c64aa7f128d8b6e4cfeafae93782ec7?s=128&d=identicon&r=PG", "display_name": "Parham Doustdar", "link": "https://stackoverflow.com/users/892404/parham-doustdar"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1454265757, "post_id": 35113331, "comment_id": 57955980, "body": "So the reason for the 100% CPU usage is that <code>LPOP</code> returns too fast. I thought you can only do 5 or 6 <code>LPOP</code>s in a second."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1454266992, "post_id": 35113331, "comment_id": 57956447, "body": "no, you can probably do 150k per second easily"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1454272384, "last_edit_date": 1454272384, "creation_date": 1454248325, "answer_id": 35114581, "question_id": 35113331, "link": "https://stackoverflow.com/questions/35113331/why-is-lpop-increasing-redis-cpu-usage/35114581#35114581", "title": "Why is lpop increasing Redis CPU usage?", "body": "<blockquote>\n  <p><a href=\"https://github.com/RichardKnop/machinery/commit/54315dd9fe56a13b8aba2d2a8868fc48dfbb5795\" rel=\"nofollow\">Using timed BLPOP instead of LPOP to avoid massive cpu\n  usage</a></p>\n  \n  <p>committed 7 days ago</p>\n  \n  <p>commit 54315dd9fe56a13b8aba2d2a8868fc48dfbb5795</p>\n\n<pre><code>machinery/v1/brokers/redis.go\n\n- itemBytes, err := conn.Do(\"LPOP\", redisBroker.config.DefaultQueue)\n+ itemBytes, err := conn.Do(\"BLPOP\", redisBroker.config.DefaultQueue, \"1\")\n</code></pre>\n</blockquote>\n\n<p>Use the latest version of <code>machinery/v1/brokers/redis.go</code> \nwhich changes <code>LPOP</code> to <code>BLPOP</code>.</p>\n\n<p>Reference: <a href=\"http://redis.io/commands/BLPOP\" rel=\"nofollow\">Redis commands: BLPOP</a></p>\n"}], "owner": {"reputation": 1889, "user_id": 892404, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6c64aa7f128d8b6e4cfeafae93782ec7?s=128&d=identicon&r=PG", "display_name": "Parham Doustdar", "link": "https://stackoverflow.com/users/892404/parham-doustdar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 1, "accepted_answer_id": 35114581, "answer_count": 1, "score": 2, "last_activity_date": 1454272384, "creation_date": 1454239817, "question_id": 35113331, "link": "https://stackoverflow.com/questions/35113331/why-is-lpop-increasing-redis-cpu-usage", "title": "Why is lpop increasing Redis CPU usage?", "body": "<p>I have an application which keeps looping while calling <code>lpop</code>. Using the <code>top</code> command, I can see that redis is using 64% of CPU, while my application uses 101%.</p>\n\n<p>I'm using redis to create a queue and worker. My worker is in an infinite loop, calling <code>lpop</code> and waiting for the next job to come in.</p>\n\n<p>For this, I'm using the <a href=\"https://github.com/RichardKnop/machinery\" rel=\"nofollow\">machinery</a> package. There is an issue for this <a href=\"https://github.com/RichardKnop/machinery/issues/49\" rel=\"nofollow\">here</a>, where the problem is said to be from <code>lpop</code>. However, since the comments are confusing, I'm at a loss as to what the difference is between <code>LPOP</code> and <code>BLPOP</code>, apart from the fact that one doesn't block and the other does.</p>\n"}, {"tags": ["mysql", "sql", "search", "go"], "comments": [{"owner": {"reputation": 2903, "user_id": 3384658, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/MeUGD.jpg?s=128&g=1", "display_name": "Amitesh Kumar", "link": "https://stackoverflow.com/users/3384658/amitesh-kumar"}, "edited": false, "score": 0, "creation_date": 1454218437, "post_id": 35110656, "comment_id": 57942281, "body": "i asked almost same question <a href=\"http://stackoverflow.com/questions/34998874/how-to-search-keyword-and-hashtags-or-symbol\" title=\"how to search keyword and hashtags or symbol\">stackoverflow.com/questions/34998874/&hellip;</a>"}], "owner": {"reputation": 632, "user_id": 1879976, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o8Fh4.png?s=128&g=1", "display_name": "pram", "link": "https://stackoverflow.com/users/1879976/pram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1454218061, "creation_date": 1454218061, "question_id": 35110656, "link": "https://stackoverflow.com/questions/35110656/formatting-string-for-mysql-match-query", "title": "Formatting string for MySQL MATCH query", "body": "<p>I'm trying to construct a MySQL fulltext search query from user input, but I'm confused as how to best format it for insertion into the prepared statement the sql module creates. Essentially right now I'm taking the term, splitting it on spaces, and creating a slice with the words. Then I format the slice parts with a + in front. So right now the input will look like \"+my +cool +search\"</p>\n\n<p>A small snippet example</p>\n\n<pre><code>terms := strings.Split(strings.TrimSpace(\"my cool search\"), \" \")\n\nvar searchquery []string\n\nfor _, term := range terms {\n    searchquery = append(searchquery, fmt.Sprintf(\"+%s\", term))\n}\n\ndbase.Query(`SELECT blah FROM blah WHERE blah\nAND MATCH(title) AGAINST (? IN BOOLEAN MODE)`, strings.Join(searchquery, \" \"))\n</code></pre>\n\n<p>The problem is it doesn't seem to escape characters the way I'd expect, because the IN BOOLEAN MODE has certain special operators like the +, -, >, &lt; symbols. If a user inserts any of those characters it messes up the search. I've read you need to enclose terms with double quotes, but does that mean the sql driver isn't doing it when it inserts the parameter? It's ambiguous as to what the '?' is being replaced with, I guess. </p>\n\n<p>I haven't been able to find many examples of how to dynamically construct these types of queries on the internet either, so maybe theres a completely better way to do it in general? Thanks!</p>\n"}, {"tags": ["go", "buffer"], "answers": [{"comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 19241, "user_id": 614944, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/f92772ec8a16758d669026f736aa7f0f?s=128&d=identicon&r=PG", "display_name": "daisy", "link": "https://stackoverflow.com/users/614944/daisy"}, "edited": false, "score": 0, "creation_date": 1454220221, "post_id": 35110623, "comment_id": 57942596, "body": "@warl0ck Keep in mind that this is effectively like doing <code>b = b[:0]</code>, it doesn&#39;t actually &quot;free&quot; the internal buffer."}, {"owner": {"reputation": 2061, "user_id": 1520291, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9d8e7bdd418d0b727f76b47e655bc465?s=128&d=identicon&r=PG", "display_name": "Dmytro Titov", "link": "https://stackoverflow.com/users/1520291/dmytro-titov"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1581950318, "post_id": 35110623, "comment_id": 106598296, "body": "@OneOfOne, so how would one actually clear the underlying array?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 2061, "user_id": 1520291, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9d8e7bdd418d0b727f76b47e655bc465?s=128&d=identicon&r=PG", "display_name": "Dmytro Titov", "link": "https://stackoverflow.com/users/1520291/dmytro-titov"}, "edited": false, "score": 0, "creation_date": 1583430037, "post_id": 35110623, "comment_id": 107123127, "body": "Clear or free? @DmytroTitov"}, {"owner": {"reputation": 2061, "user_id": 1520291, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/9d8e7bdd418d0b727f76b47e655bc465?s=128&d=identicon&r=PG", "display_name": "Dmytro Titov", "link": "https://stackoverflow.com/users/1520291/dmytro-titov"}, "edited": false, "score": 0, "creation_date": 1583443847, "post_id": 35110623, "comment_id": 107129041, "body": "\u201cFree\u201d, I guess."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 39, "last_activity_date": 1454217907, "last_edit_date": 1454217907, "creation_date": 1454217662, "answer_id": 35110623, "question_id": 35110610, "link": "https://stackoverflow.com/questions/35110610/whats-the-right-way-to-clear-a-bytes-buffer-in-golang/35110623#35110623", "title": "What&#39;s the right way to clear a bytes.Buffer in golang?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/bytes/\">Package bytes</a></p>\n  \n  <p>func (*Buffer) Reset</p>\n\n<pre><code>func (b *Buffer) Reset()\n</code></pre>\n  \n  <p>Reset resets the buffer so it has no content. b.Reset() is the same as\n  b.Truncate(0).</p>\n  \n  <p>func (*Buffer) Truncate</p>\n\n<pre><code>func (b *Buffer) Truncate(n int)\n</code></pre>\n  \n  <p>Truncate discards all but the first n unread bytes from the buffer. It\n  panics if n is negative or greater than the length of the buffer.</p>\n</blockquote>\n\n<pre><code>buffer.Reset()\n</code></pre>\n"}], "owner": {"reputation": 19241, "user_id": 614944, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/f92772ec8a16758d669026f736aa7f0f?s=128&d=identicon&r=PG", "display_name": "daisy", "link": "https://stackoverflow.com/users/614944/daisy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19644, "favorite_count": 5, "accepted_answer_id": 35110623, "answer_count": 1, "score": 22, "last_activity_date": 1454217907, "creation_date": 1454217531, "question_id": 35110610, "link": "https://stackoverflow.com/questions/35110610/whats-the-right-way-to-clear-a-bytes-buffer-in-golang", "title": "What&#39;s the right way to clear a bytes.Buffer in golang?", "body": "<p>I'm trying to clear a <code>bytes.Buffer</code>, but there's no such function in the document</p>\n\n<p>Maybe I should just renew the buffer? What's the right way to do it?</p>\n\n<pre><code>buffer   = bytes.NewBufferString(\"\")\nbuffer.Grow (30000)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1595013449, "post_id": 35111108, "comment_id": 111338741, "body": "i&#39;m afraid your example doesn&#39;t go alogn with interfaces with pointers to &quot;typed&quot; nils. Please refeer to this example: <a href=\"https://play.golang.org/p/1Q8ZNAqYtxV\" rel=\"nofollow noreferrer\">play.golang.org/p/1Q8ZNAqYtxV</a>. Sorry to bother.. i&#39;m researching how to transform to get (*byte[])(nil) when the value behind an interface is nil (regarless how nested the actual value is)."}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1595014879, "post_id": 35111108, "comment_id": 111339277, "body": "i had figure out other implementation of the method <code>PrintReflectionInfo</code> <a href=\"https://play.golang.org/p/EX3gK_T3q74\" rel=\"nofollow noreferrer\">play.golang.org/p/EX3gK_T3q74</a> that works with nils behind an interface. You may see it and validate it."}, {"owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "edited": false, "score": 0, "creation_date": 1602766914, "post_id": 35111108, "comment_id": 113828362, "body": "The playground example panics if I put it pointer to integer."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 19, "last_activity_date": 1595016543, "last_edit_date": 1595016543, "creation_date": 1454222064, "answer_id": 35111108, "question_id": 35110366, "link": "https://stackoverflow.com/questions/35110366/how-to-get-the-value-type-of-a-pointer-through-an-interface/35111108#35111108", "title": "How to get the value type of a pointer through an interface?", "body": "<p>To get the struct value, you need to get the interface value's <a href=\"https://godoc.org/reflect#Value.Elem\" rel=\"nofollow noreferrer\">element</a>:</p>\n<pre><code>fmt.Println(&quot;Indirect type is:&quot;, reflect.Indirect(reflect.ValueOf(v)).Elem().Type()) // prints main.CustomStruct\n\nfmt.Println(&quot;Indirect value type is:&quot;, reflect.Indirect(reflect.ValueOf(v)).Elem().Kind()) // prints struct\n</code></pre>\n<p><a href=\"http://play.golang.org/p/drWo_inYWY\" rel=\"nofollow noreferrer\">playground example</a></p>\n<p>This code is helpful for understanding the types in the example:</p>\n<pre><code>rv := reflect.ValueOf(v)\nfor rv.Kind() == reflect.Ptr || rv.Kind() == reflect.Interface {\n    fmt.Println(rv.Kind(), rv.Type(), rv)\n    rv = rv.Elem()\n}\nif rv.IsValid() {\n    fmt.Println(rv.Kind(), rv.Type(), rv)\n}\n</code></pre>\n<p>The output for <code>&amp;s</code> is:</p>\n<pre><code>ptr *interface {} 0xc000010200\ninterface interface {} {}\nstruct main.CustomStruct {}\n</code></pre>\n<p><a href=\"https://play.golang.org/p/UCORoShXlv1\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 2887, "user_id": 3068541, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/787075573/picture?type=large", "display_name": "JackyJohnson", "link": "https://stackoverflow.com/users/3068541/jackyjohnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17109, "favorite_count": 6, "accepted_answer_id": 35111108, "answer_count": 1, "score": 10, "last_activity_date": 1595016543, "creation_date": 1454214761, "last_edit_date": 1504363069, "question_id": 35110366, "link": "https://stackoverflow.com/questions/35110366/how-to-get-the-value-type-of-a-pointer-through-an-interface", "title": "How to get the value type of a pointer through an interface?", "body": "<p>This <a href=\"http://play.golang.org/p/bXPV58DGF4\" rel=\"noreferrer\">playground</a> illustrates my question.</p>\n\n<p>Basically I have a function that accepts an empty interface as argument.  I want to pass anything in and print information on the types and values.  </p>\n\n<p>It works as expected except when I pass a pointer to a custom type (in my example, of underlying struct type).  I am not entirely sure how the reflection model is structured at that point.  Since the function signature specifies an <code>interface{}</code> argument when I call <code>reflect.Indirect(v).Kind()</code> it naturally returns <code>interface</code> but I want to know the type when the function is called.</p>\n\n<p>Below is the same code from playground:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    var s interface{}\n    s = CustomStruct{}\n\n    PrintReflectionInfo(s)\n    PrintReflectionInfo(&amp;s)\n}\n\ntype CustomStruct struct {}\n\nfunc PrintReflectionInfo(v interface{}) {\n    // expect CustomStruct if non pointer\n    fmt.Println(\"Actual type is:\", reflect.TypeOf(v))\n\n    // expect struct if non pointer\n    fmt.Println(\"Value type is:\", reflect.ValueOf(v).Kind())\n\n    if reflect.ValueOf(v).Kind() == reflect.Ptr {\n        // expect: CustomStruct\n        fmt.Println(\"Indirect type is:\", reflect.Indirect(reflect.ValueOf(v)).Kind()) // prints interface\n\n        // expect: struct\n        fmt.Println(\"Indirect value type is:\", reflect.Indirect(reflect.ValueOf(v)).Kind()) // prints interface\n    }\n\n    fmt.Println(\"\")\n}\n</code></pre>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1454222463, "post_id": 35110335, "comment_id": 57943042, "body": "As the readme states, <a href=\"https://github.com/gorilla/http#image-of-an-under-construction-gif\" rel=\"nofollow noreferrer\">the package is still under construction</a>. I suggest using the net/http package."}], "answers": [{"tags": [], "owner": {"reputation": 632, "user_id": 1879976, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o8Fh4.png?s=128&g=1", "display_name": "pram", "link": "https://stackoverflow.com/users/1879976/pram"}, "is_accepted": true, "score": 2, "last_activity_date": 1454221433, "creation_date": 1454221433, "answer_id": 35111034, "question_id": 35110335, "link": "https://stackoverflow.com/questions/35110335/infinite-redirect-loop-with-gorilla-toolkit/35111034#35111034", "title": "Infinite redirect loop with Gorilla toolkit", "body": "<p>Apparently that library doesn't support https (lol)</p>\n\n<p><a href=\"https://github.com/gorilla/http/issues/8\" rel=\"nofollow\">https://github.com/gorilla/http/issues/8</a></p>\n\n<p>So just use the stdlib http module:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nfunc main() {\n\n    res, err := http.Get(\"https://www.telegram.org\")\n    if err != nil {\n        return\n    }\n    defer res.Body.Close()\n\n    body, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        return\n    }\n\n    fmt.Printf(\"%s\", body)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 155, "user_id": 375621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8729b2bc46f96f84d0d3bf80a84041e?s=128&d=identicon&r=PG", "display_name": "kinslayer_e", "link": "https://stackoverflow.com/users/375621/kinslayer-e"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 35111034, "answer_count": 1, "score": 1, "last_activity_date": 1454221433, "creation_date": 1454214432, "question_id": 35110335, "link": "https://stackoverflow.com/questions/35110335/infinite-redirect-loop-with-gorilla-toolkit", "title": "Infinite redirect loop with Gorilla toolkit", "body": "<p>I have this simple code:</p>\n\n<pre><code>import (\n   \"log\"\n   \"github.com/gorilla/http\"\n   \"bytes\"\n)\n\nfunc main() {\n url := \"https://www.telegram.org\"\n log.Println(\"url: \" + url)\n var b bytes.Buffer\n http.Get(&amp;b, url)\n log.Println(\"Get done\")\n}\n</code></pre>\n\n<p>and it freezes on the line making the GET request. It seems that it enters an infinite loop of 302 responses which redirects to the same url (\"<a href=\"https://www.telegram.org\" rel=\"nofollow\">https://www.telegram.org</a>\").\nAm I doing or assuming something wrong?</p>\n\n<p>Thanks and regards.</p>\n"}, {"tags": ["xml", "go"], "answers": [{"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 3, "last_activity_date": 1454212170, "creation_date": 1454212170, "answer_id": 35110120, "question_id": 35110107, "link": "https://stackoverflow.com/questions/35110107/cant-decode-xml-with-golang-always-empty-struct/35110120#35110120", "title": "Can&#39;t decode XML with golang, always empty struct", "body": "<p>You need to export your struct fields as per <a href=\"https://golang.org/pkg/encoding/xml/#Unmarshal\" rel=\"nofollow\">https://golang.org/pkg/encoding/xml/#Unmarshal</a></p>\n\n<blockquote>\n  <p>Because Unmarshal uses the reflect package, it can only assign to exported (upper case) fields. Unmarshal uses a case-sensitive comparison to match XML element names to tag values and struct field names.</p>\n</blockquote>\n\n<p>e.g.</p>\n\n<pre><code>type Proto struct {\n    XMLName xml.Name `xml:\"field\"`\n    Name      string `xml:\"name,attr\"`\n    Shownameg string `xml:\"showname,attr\"`\n    Fields []Field\n}\n</code></pre>\n"}], "owner": {"reputation": 19241, "user_id": 614944, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/f92772ec8a16758d669026f736aa7f0f?s=128&d=identicon&r=PG", "display_name": "daisy", "link": "https://stackoverflow.com/users/614944/daisy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1020, "favorite_count": 0, "accepted_answer_id": 35110120, "answer_count": 1, "score": 1, "last_activity_date": 1454212170, "creation_date": 1454212002, "question_id": 35110107, "link": "https://stackoverflow.com/questions/35110107/cant-decode-xml-with-golang-always-empty-struct", "title": "Can&#39;t decode XML with golang, always empty struct", "body": "<p>I'm trying to decode XML with golang, but the following code gives an empty struct</p>\n\n<p>Anyone can help?</p>\n\n<p>When I run the following code, I always get </p>\n\n<pre><code>{{ packet} []}\n</code></pre>\n\n<p>Attached source code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/xml\"\n//    \"io/ioutil\"\n)\n\ntype Field struct {\n    XMLName xml.Name `xml:\"field\"`\n    name      string `xml:\"name,attr\"`\n    shownameg string `xml:\"showname,attr\"`\n    fields []Field\n}\n\ntype Proto struct {\n    XMLName xml.Name `xml:\"proto\"`\n    name      string `xml:\"name,attr\"`\n    shownameg string `xml:\"showname,attr\"`\n    fields []Field\n}\n\ntype Packet struct {\n    XMLName xml.Name `xml:\"packet\"`\n    protos []Proto   `xml:\"proto\"`\n}\n\nfunc main () {   \n    data := []byte(`\n&lt;packet&gt;\n  &lt;proto name=\"geninfo\" pos=\"0\" showname=\"General information\" size=\"122\"&gt;\n    &lt;field name=\"timestamp\" pos=\"0\" show=\"Jul 17, 2008 15:50:25.136434000 CST\" showname=\"Captured Time\" value=\"1216281025.136434000\" size=\"122\"/&gt;\n  &lt;/proto&gt;\n&lt;/packet&gt;\n    `)\n\n    packet := Packet{}\n\n    err := xml.Unmarshal([]byte(data), &amp;packet)\n    if err != nil {\n        fmt.Println (err)\n        return\n    }\n\n    fmt.Println (packet)\n\n    for proto, _ := range (packet.protos) {\n        fmt.Println (proto)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 21, "user_id": 5862861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6273d868ad651ddad77ebe0794081ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Hanna", "link": "https://stackoverflow.com/users/5862861/hanna"}, "edited": false, "score": 0, "creation_date": 1454211190, "post_id": 35110003, "comment_id": 57941034, "body": "we need to write only one main function() and a simple for loop to get the result"}, {"owner": {"reputation": 21, "user_id": 5862861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6273d868ad651ddad77ebe0794081ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Hanna", "link": "https://stackoverflow.com/users/5862861/hanna"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1454220966, "post_id": 35110003, "comment_id": 57942748, "body": "I totally haven&#39;t any idea about that, i&#39;m thinking to use defer and put into the for loop, but it doesn&#39;t working properly."}, {"owner": {"reputation": 21, "user_id": 5862861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6273d868ad651ddad77ebe0794081ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Hanna", "link": "https://stackoverflow.com/users/5862861/hanna"}, "edited": false, "score": 0, "creation_date": 1454224178, "post_id": 35110003, "comment_id": 57943342, "body": "Do we really need &quot;strconv&quot; in this program. I&#39;m thinking we don&#39;t really need this import."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1454225275, "post_id": 35110003, "comment_id": 57943533, "body": "@MR.S: You need <code>strconv</code> for numbers greater than one decimal digit."}, {"owner": {"reputation": 21, "user_id": 5862861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6273d868ad651ddad77ebe0794081ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Hanna", "link": "https://stackoverflow.com/users/5862861/hanna"}, "edited": false, "score": 0, "creation_date": 1454226373, "post_id": 35110003, "comment_id": 57943714, "body": "Can you help me to fix this issue since i already update the new code for this program.."}, {"owner": {"reputation": 21782, "user_id": 176646, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/HsQyV.png?s=128&g=1", "display_name": "ThisSuitIsBlackNot", "link": "https://stackoverflow.com/users/176646/thissuitisblacknot"}, "edited": false, "score": 1, "creation_date": 1465830551, "post_id": 35110003, "comment_id": 63052555, "body": "Stop editing your old questions into completely different questions. If you have a new question, post a new question."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 5862861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6273d868ad651ddad77ebe0794081ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Hanna", "link": "https://stackoverflow.com/users/5862861/hanna"}, "edited": false, "score": 0, "creation_date": 1454223358, "post_id": 35111174, "comment_id": 57943198, "body": "Hmm. We should use leave() function and &quot;strconv&quot;, Can we do this way?"}, {"owner": {"reputation": 21, "user_id": 5862861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6273d868ad651ddad77ebe0794081ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Hanna", "link": "https://stackoverflow.com/users/5862861/hanna"}, "edited": false, "score": 0, "creation_date": 1454223919, "post_id": 35111174, "comment_id": 57943294, "body": "Thanks, it makes sense."}, {"owner": {"reputation": 21, "user_id": 5862861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6273d868ad651ddad77ebe0794081ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Hanna", "link": "https://stackoverflow.com/users/5862861/hanna"}, "edited": false, "score": 0, "creation_date": 1454224006, "post_id": 35111174, "comment_id": 57943308, "body": "One more question, Do we really need &quot;strconv&quot; in this program? If we need how can we use &quot;strconv&quot;?"}, {"owner": {"reputation": 21, "user_id": 5862861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6273d868ad651ddad77ebe0794081ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Hanna", "link": "https://stackoverflow.com/users/5862861/hanna"}, "edited": false, "score": 0, "creation_date": 1454225634, "post_id": 35111174, "comment_id": 57943589, "body": "But we should use it...."}, {"owner": {"reputation": 21, "user_id": 5862861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6273d868ad651ddad77ebe0794081ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Hanna", "link": "https://stackoverflow.com/users/5862861/hanna"}, "edited": false, "score": 0, "creation_date": 1454230527, "post_id": 35111174, "comment_id": 57944625, "body": "&#39;package main  import (     &quot;fmt&quot;     &quot;strconv&quot;  ) type Student struct {     Name string } func (stu *Student) Leave() {     fmt.Println(stu.Name + &quot; Leaving&quot;)  }  func (stu *Student) Present() {      fmt.Println(&quot;I am &quot; + stu.Name)  } func main(){ fmt.Println(&quot;Start of session&quot;) defer fmt.Println(&quot;Room Empty&quot;) for i := 0; i &lt; 6; i++ {     s := Student{Name: &quot;Student&quot; + strconv.Itoa(i)}     s.Present()     defer s.Leave() } fmt.Println(&quot;End of session&quot;) }&#39;"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1454256755, "last_edit_date": 1454256755, "creation_date": 1454222869, "answer_id": 35111174, "question_id": 35110003, "link": "https://stackoverflow.com/questions/35110003/go-basic-for-loop-and-strconv/35111174#35111174", "title": "Go: basic for loop and strconv", "body": "<p>Here's one way to do it:</p>\n\n<pre><code>fmt.Println(\"Start of session\")\ndefer fmt.Println(\"Room Empty\")\nfor i := 0; i &lt; 6; i++ {\n    s := Student{Name: \"Student\" + strconv.Itoa(i)}\n    s.Present()\n    defer s.Leave()\n}\nfmt.Println(\"End of session\")\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/_wGvap-g4o\" rel=\"nofollow\">playground example</a></p>\n\n<p>The deferred functions are executed on return from the function in reverse order. </p>\n"}], "owner": {"reputation": 21, "user_id": 5862861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6273d868ad651ddad77ebe0794081ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Hanna", "link": "https://stackoverflow.com/users/5862861/hanna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 1, "closed_date": 1520590577, "accepted_answer_id": 35111174, "answer_count": 1, "score": -5, "last_activity_date": 1465830477, "creation_date": 1454210872, "last_edit_date": 1465830477, "question_id": 35110003, "link": "https://stackoverflow.com/questions/35110003/go-basic-for-loop-and-strconv", "closed_reason": "Needs more focus", "title": "Go: basic for loop and strconv", "body": "<p>I'm a freshman for go language, and some basic things i want to ask how can we make sense for this function.<br>\nwe need to use \"strconv\" to fix this issue.</p>\n\n<pre><code>  package main\n\nimport (\n    \"fat\"\n    \"strconv\"\n\n)\ntype Student struct {\n    Name string\n}\nfunc (stu *Student) Leave() {\n    fmt.Println(stu.Name + \" Leaving\")\n\n}\n\nfunc (stu *Student) Present() {\n     fmt.Println(\"I am \" + stu.Name)\n\n}\n\nfunc main() {\n  fmt.Println(\"Start of session\")\n  for i := 0; i &lt; 6; i++ {\n    s := Student{Name: fmt.Sprintf(\"Student%d\", i)}\n    s.Present()\n    fmt.Println(\"Room Empty\")\n    defer s.Leave()\n}\n  fmt.Println(\"End of session\")\n} \n</code></pre>\n\n<p>The output should be like this </p>\n\n<pre><code>Start of session \nI am Student0\nI am Student1\nI am Student2\nI am Student3\nI am Student4\nI am Student5 \nEnd of session \nStudent5 Leaving \nStudent4 Leaving \nStudent3 Leaving \nStudent2 Leaving \nStudent1 Leaving \nStudent0 Leaving \nRoom Empty\n</code></pre>\n\n<p>We need to write only one main function() and a simple for loop to get the result.</p>\n"}, {"tags": ["go", "terminology"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1454206604, "post_id": 35109393, "comment_id": 57940087, "body": "Related / Possible duplicate of <a href=\"http://stackoverflow.com/questions/34775722/package-version-management-in-go-1-5\">Package version management in Go 1.5</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1011, "user_id": 3891638, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pqkeX.jpg?s=128&g=1", "display_name": "cozyconemotel", "link": "https://stackoverflow.com/users/3891638/cozyconemotel"}, "edited": false, "score": 3, "creation_date": 1508217896, "post_id": 35109534, "comment_id": 80512301, "body": "The definition is same as in a Ruby context."}], "tags": [], "owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "is_accepted": true, "score": 22, "last_activity_date": 1454206571, "last_edit_date": 1454206571, "creation_date": 1454205918, "answer_id": 35109534, "question_id": 35109393, "link": "https://stackoverflow.com/questions/35109393/what-does-vendoring-mean-in-go/35109534#35109534", "title": "What does &quot;vendoring&quot; mean in Go?", "body": "<p>Defined <a href=\"http://www.goinggo.net/2013/10/manage-dependencies-with-godep.html\">here</a> for Go as:</p>\n\n<blockquote>\n  <p>Vendoring is the act of making your own copy of the 3rd party packages\n  your project is using. Those copies are traditionally placed inside\n  each project and then saved in the project repository.</p>\n</blockquote>\n\n<p>I don't know squirt about Ruby.</p>\n\n<p>Essentially you're taking a package, storing it within your own project and using that version to build from. I liken it to how you might have a \"vendors\" folder where you put third party css or js when building a web page.</p>\n"}], "owner": {"reputation": 2818, "user_id": 839558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0055a22b3b210f8306cf2462990c2b4d?s=128&d=identicon&r=PG", "display_name": "djsmith", "link": "https://stackoverflow.com/users/839558/djsmith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4340, "favorite_count": 4, "accepted_answer_id": 35109534, "answer_count": 1, "score": 19, "last_activity_date": 1454206571, "creation_date": 1454204427, "last_edit_date": 1495540484, "question_id": 35109393, "link": "https://stackoverflow.com/questions/35109393/what-does-vendoring-mean-in-go", "title": "What does &quot;vendoring&quot; mean in Go?", "body": "<p>When learning about Go's dependency management, I often hear the term \"vendor\" used as a verb. Example: \"The dependencies that your application vendors...\"</p>\n\n<p>What does it mean to <strong>vendor a dependency</strong> in this context?</p>\n\n<hr>\n\n<p>Examples:</p>\n\n<blockquote>\n  <p>\"Dependencies that are vendored with your application\"</p>\n</blockquote>\n\n<p>Source: <a href=\"https://devcenter.heroku.com/articles/getting-started-with-go#declare-app-dependencies\" rel=\"noreferrer\">https://devcenter.heroku.com/articles/getting-started-with-go#declare-app-dependencies</a></p>\n\n<blockquote>\n  <p>\"godep will write the vendored code\"</p>\n</blockquote>\n\n<p>Source: <a href=\"https://github.com/tools/godep#go-15-vendor-experiment\" rel=\"noreferrer\">https://github.com/tools/godep#go-15-vendor-experiment</a></p>\n\n<hr>\n\n<p><em>Follow-up questions:</em></p>\n\n<ul>\n<li><p>Is this related to <a href=\"https://stackoverflow.com/questions/11378921/what-does-the-term-vendoring-or-to-vendor-mean-for-ruby-on-rails\">vendoring in Ruby</a>?</p></li>\n<li><p>Is this term fully defined in the <a href=\"https://docs.google.com/document/d/1Bz5-UB7g2uPBdOx-rw5t9MxJwkfpx90cqG9AFL0JAYo/edit\" rel=\"noreferrer\">Go 1.5 Vendor Experiment</a>, or is there a separate conventional definition?</p></li>\n</ul>\n"}, {"tags": ["web-applications", "go", "cluster-computing", "high-availability", "distributed-system"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1454196151, "post_id": 35108372, "comment_id": 57937786, "body": "RAFT is the way to go (etcd uses it as well). but you can&#39;t cheat the CAP theorem :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454196773, "post_id": 35108372, "comment_id": 57937952, "body": "Just use an implementation that&#39;s solved this already, like etcd, or consul."}], "answers": [{"comments": [{"owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "edited": false, "score": 0, "creation_date": 1454216452, "post_id": 35109288, "comment_id": 57941999, "body": "Well said, thanks.  I don&#39;t want to depend on an external service for coordination; I was looking to embed it in my Go webapp itself.  Something <a href=\"https://medium.com/@siddontang/use-hashicorp-raft-to-build-a-redis-sentinel-f3aa2e84c91e#.zgmj697fi\" rel=\"nofollow noreferrer\">like this</a>, actually!"}], "tags": [], "owner": {"reputation": 6335, "user_id": 1766816, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYq9v.jpg?s=128&g=1", "display_name": "kuujo", "link": "https://stackoverflow.com/users/1766816/kuujo"}, "is_accepted": true, "score": 2, "last_activity_date": 1454203498, "creation_date": 1454203498, "answer_id": 35109288, "question_id": 35108372, "link": "https://stackoverflow.com/questions/35108372/go-webapp-cluster-leader-election/35109288#35109288", "title": "Go Webapp Cluster Leader Election", "body": "<p>Based on your fault tolerance and consistency requirements - in particular preventing split brain in a partition - a consensus algorithm like Raft is what you most definitely want. But even though Raft was designed for understandability, it still requires significant expertise to implement correctly. Therefore, as others have mentioned you should look into existing services or implementations. </p>\n\n<p><a href=\"http://zookeeper.apache.org\" rel=\"nofollow\">ZooKeeper</a> (ZAB), <a href=\"http://github.com/coreos/etcd\" rel=\"nofollow\">etcd</a> (Raft), and <a href=\"http://consul.io\" rel=\"nofollow\">Consul</a> (Raft) are the most widely used systems for doing things like this. Considering that you want your VMs to scale from 2 to 10 nodes, this is most likely the way you want to go. Raft and other consensus algorithms have quorum requirements that can make scaling in this manner less practical if the algorithm is directly embedded in your VMs. By using an external service, your VMs simply become clients of the consensus service and can scale independently of it.</p>\n\n<p>Alternatively, if you don't want depend on an external service for coordination, the <a href=\"http://raft.github.io\" rel=\"nofollow\">Raft website</a> has an exhaustive list of implementations in various languages, some of which are consensus services and some of which can be embedded. However, note that many of them are incomplete. At a minimum, any Raft implementation suitable for production must have implemented log compaction. Without log compaction, servers can really only operate for a finite amount of time - until the disk fills up with logs.</p>\n"}], "owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1011, "favorite_count": 1, "accepted_answer_id": 35109288, "answer_count": 1, "score": 2, "last_activity_date": 1454203498, "creation_date": 1454195585, "last_edit_date": 1454196170, "question_id": 35108372, "link": "https://stackoverflow.com/questions/35108372/go-webapp-cluster-leader-election", "title": "Go Webapp Cluster Leader Election", "body": "<p>I'm writing a fairly complex Go webapp that I want to make highly available.  I'm planning on having multiple VMs running the app, with a load-balancer directing traffic between them for what I want.</p>\n\n<p>Where it gets complex is that the webapp has a sort of database book-keeping routine running, which I only want (at most) one instance of at any time.  So if I have three webapp VMs, only one of them should be doing the book-keeping.</p>\n\n<p>(Yes, I'm aware that I could split the book-keeping off into a separate VM instance entirely, but the code has been rather heavily integrated with the rest of the webapp.)</p>\n\n<p>I've spent several hours looking at things like <a href=\"https://github.com/coreos/etcd\" rel=\"nofollow\">etcd</a>, <a href=\"https://github.com/hashicorp/raft\" rel=\"nofollow\">raft</a>, <a href=\"https://github.com/monnand/bully\" rel=\"nofollow\">bully</a>, <a href=\"https://github.com/hashicorp/memberlist\" rel=\"nofollow\">memberlist</a>, <a href=\"http://clusterlabs.org/\" rel=\"nofollow\">Pacemaker</a>, and so on and so forth.  These all seem like quite a lot of information to absorb to accomplish what I'm after, or I can't see a clear way of using them.</p>\n\n<p>What I would like, in this specific use case, is a system whereby Go webapp nodes automatically detect each other and elect a \"leader\" to do the book-keeping.  Ideally this would scale anywhere from 2 to 10 nodes, and not require manually adding IP addresses to config files (but possible, if necessary).</p>\n\n<p>I was thinking in the case of a network partition or something, where one node cannot see the others, I wouldn't want it to elect itself as a leader, because it would be possible to have two nodes attempting to do book-keeping at the same time.  That also means that if I stripped down the cluster to being just a single VM, no book-keeping would occur, but that could be tolerated for a brief period during maintenance, or I could set some sort of flag somewhere.</p>\n\n<p>I'm wondering if someone could point me in the right direction, and hopefully how I can accomplish this with low complexity, while leveraging existing code libraries as much as possible.</p>\n"}, {"tags": ["mongodb", "go", "mgo", "gorilla"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1454189519, "post_id": 35107134, "comment_id": 57935757, "body": "Show the code used to create the Gorilla route.  Also, to prevent panic in ObjectIdHex, check for valid input by calling <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#IsObjectIdHex\" rel=\"nofollow noreferrer\">godoc.org/gopkg.in/mgo.v2/bson#IsObjectIdHex</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3212497"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1454190252, "post_id": 35107134, "comment_id": 57935990, "body": "I added the gorilla route. I dont quite understand where should I check if for ObjectIdHex ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3212497"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1454191039, "post_id": 35107134, "comment_id": 57936264, "body": "I prevented the panic but the new page shows nothing about the event... It seems the data from the server is lost."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1454202472, "post_id": 35107134, "comment_id": 57939216, "body": "My suggestion to call IsObjectIdHex is to prevent malformed user input from causing your app to panic. It&#39;s not fix the problem."}], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": false, "score": 1, "last_activity_date": 1454192790, "creation_date": 1454192790, "answer_id": 35107962, "question_id": 35107134, "link": "https://stackoverflow.com/questions/35107134/go-to-a-particular-document-in-mongodb-using-golang/35107962#35107962", "title": "Go to a particular document in MongoDB using golang", "body": "<p>Try to remove spaces from your router as \"eventId\" != \" eventId \"</p>\n\n<pre><code>router.HandleFunc(\"/event/view/{eventId}/\", handlers.ViewEventHandler)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3212497"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 664, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1454192790, "creation_date": 1454188142, "last_edit_date": 1454191604, "question_id": 35107134, "link": "https://stackoverflow.com/questions/35107134/go-to-a-particular-document-in-mongodb-using-golang", "title": "Go to a particular document in MongoDB using golang", "body": "<p>I am having a problem to go to a particular document (in this case an event) using gorilla and mgo.</p>\n\n<p><strong>The event model :</strong></p>\n\n<pre><code>Id              bson.ObjectId `bson:\"_id,omitempty\"`\nEmail           string        `bson:\"user_email\"`\nName            string        `bson:\"name\"`\nCategory        string        `bson:\"category\"`\nDescription     string        `bson:\"description\"`\nStatus          string        `bson:\"status\"`\n</code></pre>\n\n<p><strong>The event handler</strong></p>\n\n<pre><code>func ViewEventHandler(w http.ResponseWriter, r *http.Request) {\n  vars := mux.Vars(r)\n  eventId := vars[\"eventId\"]\n  session, err := mgo.Dial(\"mongodb://DATABASE_URL\")\n\n  defer session.Close()\n  session.SetMode(mgo.Monotonic, true)\n  c := session.DB(\"DATABASE_NAME\").C(\"event\")\n\n  result := model.EventModel{}\n\n  // the following line is probably the problem\n  err = c.FindId(bson.ObjectIdHex(eventId)).One(&amp;result)\n\n  if r.Method == \"GET\" {\n    t, _ := template.ParseFiles(\"templates/view/event.html\");\n    t.Execute(w, result);\n  }\n}\n</code></pre>\n\n<p><strong>Gorilla route in main</strong></p>\n\n<pre><code>router.HandleFunc(\"/event/view/{ eventId }/\", handlers.ViewEventHandler)\n</code></pre>\n\n<p><strong>The View (html)</strong></p>\n\n<pre><code>&lt;td&gt;&lt;a href=\"/event/view/{{ .Id.Hex }}/\"&gt;{{ .Name }}&lt;/a&gt;&lt;/td&gt;\n</code></pre>\n\n<p><strong>The Error</strong></p>\n\n<pre><code>2016/01/30 22:06:01 http: panic serving 127.0.0.1:41254: Invalid input to ObjectIdHex: \"\"\n</code></pre>\n\n<p>What I want is to go to the route /event/view/Id and show the particular page of the event.</p>\n\n<p>My guess is that there is probably a data type parsing problem, but still tried a few ways and failed.</p>\n"}, {"tags": ["javascript", "go", "build", "web-component"], "answers": [{"tags": [], "owner": {"reputation": 632, "user_id": 1879976, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o8Fh4.png?s=128&g=1", "display_name": "pram", "link": "https://stackoverflow.com/users/1879976/pram"}, "is_accepted": true, "score": 0, "last_activity_date": 1454306719, "creation_date": 1454306719, "answer_id": 35123955, "question_id": 35104582, "link": "https://stackoverflow.com/questions/35104582/go-lang-builder-task-runner/35123955#35123955", "title": "Go lang builder / task runner", "body": "<p>If you're doing a SPA you should just stick with gulp and others. You'll probably end up using npm stuff like browserify, autoprefix, etc, and you'll basically end up reinventing the wheel with your own asset pipeline.</p>\n\n<p>With that said I've seen a couple, but none of them looked very mature last time I looked:\n<a href=\"https://github.com/jbowens/assets\" rel=\"nofollow\">https://github.com/jbowens/assets</a></p>\n\n<p><a href=\"https://github.com/shaoshing/train\" rel=\"nofollow\">https://github.com/shaoshing/train</a></p>\n\n<p>and you're going to need npm installed to use them regardless. </p>\n"}], "owner": {"reputation": 1040, "user_id": 5081185, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/yQ8Wl.jpg?s=128&g=1", "display_name": "Mat&#250;\u0161 \u010congr&#225;dy", "link": "https://stackoverflow.com/users/5081185/mat%c3%ba%c5%a1-%c4%8congr%c3%a1dy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "accepted_answer_id": 35123955, "answer_count": 1, "score": 0, "last_activity_date": 1454306719, "creation_date": 1454173930, "question_id": 35104582, "link": "https://stackoverflow.com/questions/35104582/go-lang-builder-task-runner", "title": "Go lang builder / task runner", "body": "<p>I'm creating a little SPA framework (might be a full-feature framework).\nFrontend is based on native javascript (including ES6 features and web-components).\nBackend is written in Go.</p>\n\n<p>Here is a list of my needs, that I'd like to do automatically:</p>\n\n<ol>\n<li><p>Minify my javascript files</p></li>\n<li><p>Transpile ES6 code to ES5 (with something like babel.js)</p></li>\n<li><p>Polyfill my web-components</p></li>\n</ol>\n\n<p>Is there a way to achieve this without using node.js? Are there already go packages that can make those 3 things happen, with a \"simple\" grunt/gulp-like way?</p>\n\n<p>I would like to avoid installing node.js, npm, bower... etc.\nIn my (not very classified) oppinion, using those node.js tools makes my application a mess adding a lot of unnecessery overhead to my application folder and makes my framework dependant on a lot of stuff (that application programmer has to learn, understand and know how to use).</p>\n\n<p>Thanks for any tips/oppinions.</p>\n"}, {"tags": ["perl", "sockets", "go", "pack"], "comments": [{"owner": {"reputation": 21782, "user_id": 176646, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/HsQyV.png?s=128&g=1", "display_name": "ThisSuitIsBlackNot", "link": "https://stackoverflow.com/users/176646/thissuitisblacknot"}, "edited": false, "score": 0, "creation_date": 1454169848, "post_id": 35103503, "comment_id": 57928627, "body": "See <a href=\"http://perldoc.perl.org/perlpacktut.html\" rel=\"nofollow noreferrer\">perlpacktut</a> and the <a href=\"http://perldoc.perl.org/functions/pack.html\" rel=\"nofollow noreferrer\">documentation for <code>pack</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 121105, "user_id": 2766176, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/edd8638efe875601bfe394a8aea5b16d?s=128&d=identicon&r=PG", "display_name": "brian d foy", "link": "https://stackoverflow.com/users/2766176/brian-d-foy"}, "is_accepted": false, "score": 2, "last_activity_date": 1454310814, "last_edit_date": 1454310814, "creation_date": 1454170315, "answer_id": 35103958, "question_id": 35103503, "link": "https://stackoverflow.com/questions/35103503/unpack-a-buffer-which-is-packed-by-perl-with-template-n-a-n-a-in-golang/35103958#35103958", "title": "Unpack a buffer which is packed by perl with template &quot;N/a* N/a*&quot; in golang", "body": "<p>From <a href=\"http://perldoc.perl.org/functions/pack.html\" rel=\"nofollow\">the pack documentation</a>:</p>\n\n<ul>\n<li><code>N</code> is an unsigned long in network format</li>\n<li><code>a</code> is a string with arbitrary binary data</li>\n<li><code>*</code> is a repeat count that uses up the rest of the characters in the string</li>\n<li>the <code>/</code> notes that you're packing a length of the item and then the packed item.</li>\n</ul>\n\n<p>You can write a small program to check it out:</p>\n\n<pre><code>use v5.10;\nmy $first  = 'dog';\nmy $second = 'parrot';\n\nmy $packed = pack \"N/a* N/a*\", $first, $second;\n\nsay $packed;\n</code></pre>\n\n<p>Run it and you won't see the number, but you can hexdump it to see everything:</p>\n\n<pre><code>$ perl5.22.0 pack.pl\ndogparrot\n\n$ perl5.22.0 pack.pl | hexdump -C\n00000000  00 00 00 03 64 6f 67 00  00 00 06 70 61 72 72 6f  |....dog....parro|\n00000010  74 0a                                             |t.|\n00000012\n</code></pre>\n\n<p>There's a <code>00_00_00_03</code> in front of <code>dog</code> and a <code>00_00_00_06</code> in front of <code>parrot</code>. Those are the lengths of the packed strings. This probably means the other side scans the string by reading the number, then grabbing that number of succeeding octets.</p>\n"}], "owner": {"reputation": 1783, "user_id": 4569273, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a57a59c27de3760066076765f8dacc2c?s=128&d=identicon&r=PG&f=1", "display_name": "auxdx", "link": "https://stackoverflow.com/users/4569273/auxdx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1454310814, "creation_date": 1454167676, "last_edit_date": 1454235368, "question_id": 35103503, "link": "https://stackoverflow.com/questions/35103503/unpack-a-buffer-which-is-packed-by-perl-with-template-n-a-n-a-in-golang", "title": "Unpack a buffer which is packed by perl with template &quot;N/a* N/a*&quot; in golang", "body": "<p>I am new to perl. I need to write a golang code which read UDP package sent from a perl UDP socket client. Basically, the perl client packs data using the template \"N/a* N/a*\" like the following:</p>\n\n<pre><code>$them = pack($sockaddr,&amp;AF_INET, $data_port, $broadaddr);\n$actual_data = pack(\"N/a* N/a*\", $string1, $string2);\nsend(S,$actual_data,0,$them) || die $!;\n</code></pre>\n\n<p>My question is:</p>\n\n<ol>\n<li>What does \"N/a* N/a*\" actually means? A simple explanation would be helpful. How two strings are actually packed?</li>\n<li>How i can write a similar packing function in golang given two unicode strings; and if I got a packed buffer sent from perl UDP client, how i can write a corresponding function \"in golang\" to unpack it. Is there any library which can handle this so that I can use golang on par with perl for socket programming.</li>\n</ol>\n"}, {"tags": ["go", "cross-compiling"], "answers": [{"tags": [], "owner": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "is_accepted": true, "score": 3, "last_activity_date": 1454163295, "creation_date": 1454163295, "answer_id": 35102814, "question_id": 35102668, "link": "https://stackoverflow.com/questions/35102668/cross-compiled-pkg-import-in-go/35102814#35102814", "title": "Cross compiled pkg import in Go", "body": "<p>According to the go-yara instructions you need to compile both on the Debian machine.  The Go compilation instructions on go-yara shows it is cross compiling on the debian machine for windows 386.  So you would run both on your Debian build machine and then copy over the windows binary to run the application.</p>\n"}], "owner": {"reputation": 379, "user_id": 1405695, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iChib.jpg?s=128&g=1", "display_name": "JohnGalt", "link": "https://stackoverflow.com/users/1405695/johngalt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 35102814, "answer_count": 1, "score": 0, "last_activity_date": 1454164094, "creation_date": 1454162440, "last_edit_date": 1454164094, "question_id": 35102668, "link": "https://stackoverflow.com/questions/35102668/cross-compiled-pkg-import-in-go", "title": "Cross compiled pkg import in Go", "body": "<p>I would like to use a go module named <a href=\"https://github.com/hillu/go-yara\" rel=\"nofollow noreferrer\">\"go-yara\"</a> on Windows, which I cross-compiled on a Debian based Linux system. Everything works as expected. The build creates a <code>go-yara.a</code> file in the <code>$GOPATH/pkg/windows_386/github.com/hillu/</code> folder. </p>\n\n<p><a href=\"https://i.stack.imgur.com/JGLO6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/JGLO6.png\" alt=\"enter image description here\"></a></p>\n\n<p>However when I try to use the module in a go program it seem that it tries to recompile the module from the src stating that a <code>yara.h</code> file is missing. Yes, that's correct. There is no yara.h on Windows. It's much easier for me to  compile yara and its headers on Linux.  </p>\n\n<p><a href=\"https://i.stack.imgur.com/P9WuX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/P9WuX.png\" alt=\"enter image description here\"></a></p>\n\n<p>This file is indeed needed during during cross-compilation on Linux. Why do I need it on Windows too? Isn't the <code>go-yara.a</code> in the pkg folder enough? Why does it ignore the .a file and tries to compile the module from its source? Can I force it to use the precompiled module in the <code>pkg</code> folder?</p>\n\n<p>I am new to Golang so please excuse my ignorance. </p>\n"}, {"tags": ["windows", "go", "sublimetext2", "sublimetext3"], "comments": [{"owner": {"reputation": 10611, "user_id": 366299, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0e8e3739ae9c55898c284aaf5ba164ba?s=128&d=identicon&r=PG", "display_name": "atamanroman", "link": "https://stackoverflow.com/users/366299/atamanroman"}, "edited": false, "score": 0, "creation_date": 1454163702, "post_id": 35102616, "comment_id": 57926589, "body": "Related (with alternative solution): <a href=\"http://stackoverflow.com/questions/31516808/sublime-text-margo-missing-required-environment-variables-gopath?rq=1\" title=\"sublime text margo missing required environment variables gopath\">stackoverflow.com/questions/31516808/&hellip;</a>"}, {"owner": {"reputation": 702, "user_id": 5105411, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ad132.jpg?s=128&g=1", "display_name": "Gopherine", "link": "https://stackoverflow.com/users/5105411/gopherine"}, "reply_to_user": {"reputation": 10611, "user_id": 366299, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0e8e3739ae9c55898c284aaf5ba164ba?s=128&d=identicon&r=PG", "display_name": "atamanroman", "link": "https://stackoverflow.com/users/366299/atamanroman"}, "edited": false, "score": 0, "creation_date": 1454217039, "post_id": 35102616, "comment_id": 57942076, "body": "@atamanroman i dont think you got the point there it is for windows i already mentioned that link above and it is not working out for me and am still getting the error more over the problem is soleved using the shell script which i dont think is viable for windows there must be some command inplace of that for windows."}], "answers": [{"comments": [{"owner": {"reputation": 702, "user_id": 5105411, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ad132.jpg?s=128&g=1", "display_name": "Gopherine", "link": "https://stackoverflow.com/users/5105411/gopherine"}, "edited": false, "score": 0, "creation_date": 1454216717, "post_id": 35102855, "comment_id": 57942048, "body": "I did setup that workspace now cleanly its compilable and the hello world program is running.when i am using notepad but the error still seems to arise in sublime text and it is still saying mar go missing required variable path GOPATH"}, {"owner": {"reputation": 10611, "user_id": 366299, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0e8e3739ae9c55898c284aaf5ba164ba?s=128&d=identicon&r=PG", "display_name": "atamanroman", "link": "https://stackoverflow.com/users/366299/atamanroman"}, "reply_to_user": {"reputation": 702, "user_id": 5105411, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ad132.jpg?s=128&g=1", "display_name": "Gopherine", "link": "https://stackoverflow.com/users/5105411/gopherine"}, "edited": false, "score": 0, "creation_date": 1454260639, "post_id": 35102855, "comment_id": 57953947, "body": "Did you restart sublime after setting GOPATH?"}, {"owner": {"reputation": 702, "user_id": 5105411, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ad132.jpg?s=128&g=1", "display_name": "Gopherine", "link": "https://stackoverflow.com/users/5105411/gopherine"}, "edited": false, "score": 0, "creation_date": 1454332476, "post_id": 35102855, "comment_id": 57982529, "body": "ok i figured it out and finally removed the margo problem but the only problem now is i cant build the program what i did is i went into gosublime default setting and set the path and gopath in the env then the error was gone but i cant build my code it generates a dialogue box telling to see the documentation and fails to build it .....    i followed        &quot;<a href=\"https://github.com/golang/sublime-build/blob/master/docs/configuration.md\" rel=\"nofollow noreferrer\">github.com/golang/sublime-build/blob/master/docs/&hellip;</a>&quot; this link"}], "tags": [], "owner": {"reputation": 10611, "user_id": 366299, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0e8e3739ae9c55898c284aaf5ba164ba?s=128&d=identicon&r=PG", "display_name": "atamanroman", "link": "https://stackoverflow.com/users/366299/atamanroman"}, "is_accepted": true, "score": 1, "last_activity_date": 1454163547, "creation_date": 1454163547, "answer_id": 35102855, "question_id": 35102616, "link": "https://stackoverflow.com/questions/35102616/how-to-setup-gosublime-in-sublime-text-3-in-windows/35102855#35102855", "title": "How to setup Gosublime in sublime text 3 in Windows?", "body": "<p>You have to set the <code>GOPATH</code> environment variable to something like <code>d:\\myprojects\\go</code>. That's where your code and libraries will be stored.</p>\n\n<p>Your code should be located in a folder like <code>d:\\myprojects\\go\\src\\github.com\\pandey\\coolproject</code>.</p>\n\n<p>Relevant section from the docs:</p>\n\n<blockquote>\n  <p>[...]</p>\n  \n  <p>Test your installation</p>\n  \n  <p>Check that Go is installed correctly by setting up a workspace and\n  building a simple program, as follows.</p>\n  \n  <p>Create a directory to contain your workspace, $HOME/work for example,\n  and set the GOPATH environment variable to point to that location.</p>\n  \n  <p>$ export GOPATH=$HOME/work You should put the above command in your\n  shell startup script ($HOME/.profile for example) or, if you use\n  Windows, follow the instructions above to set the GOPATH environment\n  variable on your system.</p>\n  \n  <p>Next, make the directories src/github.com/user/hello inside your\n  workspace (if you use GitHub, substitute your user name for user), and\n  inside the hello directory create a file named hello.go with the\n  following contents:</p>\n  \n  <p>[...]</p>\n</blockquote>\n\n<p>(<a href=\"https://golang.org/doc/install#testing\" rel=\"nofollow\">https://golang.org/doc/install#testing</a>)</p>\n\n<p>See the Go docs for more details, especially on how to do it on windows: <a href=\"https://golang.org/doc/install\" rel=\"nofollow\">https://golang.org/doc/install</a></p>\n"}, {"tags": [], "owner": {"reputation": 1242, "user_id": 7303415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b7b878a1c284c4c123fe635f1774252?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek D K", "link": "https://stackoverflow.com/users/7303415/abhishek-d-k"}, "is_accepted": false, "score": 2, "last_activity_date": 1540455087, "creation_date": 1540455087, "answer_id": 52984399, "question_id": 35102616, "link": "https://stackoverflow.com/questions/35102616/how-to-setup-gosublime-in-sublime-text-3-in-windows/52984399#52984399", "title": "How to setup Gosublime in sublime text 3 in Windows?", "body": "<p>in windows sublime text 3<br>\n<strong>ctrl+shift+p</strong> <br>\ntype <strong>install package</strong> enter <br>\nsearch for <strong>golang build</strong>  enter</p>\n"}, {"tags": [], "owner": {"reputation": 4554, "user_id": 192221, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/38504ff52422b72b239a7b05ef0ccaae?s=128&d=identicon&r=PG", "display_name": "kristianp", "link": "https://stackoverflow.com/users/192221/kristianp"}, "is_accepted": false, "score": 0, "last_activity_date": 1582266409, "creation_date": 1582266409, "answer_id": 60333200, "question_id": 35102616, "link": "https://stackoverflow.com/questions/35102616/how-to-setup-gosublime-in-sublime-text-3-in-windows/60333200#60333200", "title": "How to setup Gosublime in sublime text 3 in Windows?", "body": "<p>I haven't had a good experience installing gosublime recently, the margo instructions are not very helpful.  You could try gopls instead, it's still in alpha, but it's developed by the go team.  It's a language server for go, that works with a Sublime LSP plugin.</p>\n\n<p><a href=\"https://github.com/golang/tools/tree/master/gopls\" rel=\"nofollow noreferrer\">https://github.com/golang/tools/tree/master/gopls</a></p>\n\n<p>Instructions for Sublime <a href=\"https://github.com/golang/tools/blob/master/gopls/doc/subl.md\" rel=\"nofollow noreferrer\">are here</a>.</p>\n"}], "owner": {"reputation": 702, "user_id": 5105411, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ad132.jpg?s=128&g=1", "display_name": "Gopherine", "link": "https://stackoverflow.com/users/5105411/gopherine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3269, "favorite_count": 0, "accepted_answer_id": 35102855, "answer_count": 3, "score": 1, "last_activity_date": 1582266409, "creation_date": 1454162066, "last_edit_date": 1495540956, "question_id": 35102616, "link": "https://stackoverflow.com/questions/35102616/how-to-setup-gosublime-in-sublime-text-3-in-windows", "title": "How to setup Gosublime in sublime text 3 in Windows?", "body": "<p>The main problem here is .. that i have installed the package control and also the gosublime plugin but it is not working also it is not working in the command promt when i type go it gives info proving that the go is installed correctly in path i am actually trying to use a seprator to set paths for go and java simultaneously which i might be doing wrong</p>\n\n<p><a href=\"https://i.stack.imgur.com/8kslx.png\" rel=\"nofollow noreferrer\">ENVIRONMENT VARIABLE</a></p>\n\n<p>Now in sublime text 3 i am receiving an error as </p>\n\n<blockquote>\n  <p>MarGo: Missing required environment variables: GOPATH\n  |                > See the <code>Quirks</code> section of USAGE.md for info</p>\n</blockquote>\n\n<p>I went through  this but it didnt help me</p>\n\n<blockquote>\n  <p><a href=\"https://stackoverflow.com/questions/31516808/sublime-text-margo-missing-required-environment-variables-gopath\">Sublime Text: &quot;MarGo: Missing required environment variables: GOPATH&quot;</a></p>\n</blockquote>\n"}, {"tags": ["go", "go-interface"], "answers": [{"comments": [{"owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "edited": false, "score": 0, "creation_date": 1454223191, "post_id": 35101925, "comment_id": 57943170, "body": "You might have done double diapatch instead of type assertion"}, {"owner": {"reputation": 5619, "user_id": 2055854, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/974156d755f10981aba40d96375b7af5?s=128&d=identicon&r=PG", "display_name": "Orest", "link": "https://stackoverflow.com/users/2055854/orest"}, "reply_to_user": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "edited": false, "score": 0, "creation_date": 1454234288, "post_id": 35101925, "comment_id": 57945500, "body": "@Ezequiel Moreno Could you post example please?"}, {"owner": {"reputation": 3099, "user_id": 1595320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7394f8a600a66b2dfaf6613fd32f8fc?s=128&d=identicon&r=PG", "display_name": "Riscie", "link": "https://stackoverflow.com/users/1595320/riscie"}, "edited": false, "score": 0, "creation_date": 1454597652, "post_id": 35101925, "comment_id": 58123966, "body": "To those who downvote, what is my error here? Thank you!"}], "tags": [], "owner": {"reputation": 3099, "user_id": 1595320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7394f8a600a66b2dfaf6613fd32f8fc?s=128&d=identicon&r=PG", "display_name": "Riscie", "link": "https://stackoverflow.com/users/1595320/riscie"}, "is_accepted": true, "score": 4, "last_activity_date": 1454157840, "creation_date": 1454157840, "answer_id": 35101925, "question_id": 35101768, "link": "https://stackoverflow.com/questions/35101768/how-can-i-implement-comparable-interface-in-go/35101925#35101925", "title": "How can I implement comparable interface in go?", "body": "<p>Your Interface demands a method</p>\n\n<p><code>compare(Comparable) int</code></p>\n\n<p>but you have implemented</p>\n\n<p><code>func (item T) compare(other T) int {</code> (other T instead of other Comparable)</p>\n\n<p>you should do something like this:</p>\n\n<pre><code>func (item T) compare(other Comparable) int {\n    otherT, ok := other.(T) //  getting  the instance of T via type assertion.\n    if !ok{\n        //handle error (other was not of type T)\n    }\n    if item.value &lt; otherT.value {\n        return -1\n    } else if item.value == otherT.value {\n        return 0\n    }\n    return 1\n}\n</code></pre>\n"}], "owner": {"reputation": 5619, "user_id": 2055854, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/974156d755f10981aba40d96375b7af5?s=128&d=identicon&r=PG", "display_name": "Orest", "link": "https://stackoverflow.com/users/2055854/orest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2302, "favorite_count": 0, "accepted_answer_id": 35101925, "answer_count": 1, "score": 6, "last_activity_date": 1454157840, "creation_date": 1454156804, "question_id": 35101768, "link": "https://stackoverflow.com/questions/35101768/how-can-i-implement-comparable-interface-in-go", "title": "How can I implement comparable interface in go?", "body": "<p>I've recently started studying Go and faced next issue. I want to implement Comparable interface. I have next code:</p>\n\n<pre><code>type Comparable interface {\n    compare(Comparable) int\n}\ntype T struct {\n    value int\n}\nfunc (item T) compare(other T) int {\n    if item.value &lt; other.value {\n        return -1\n    } else if item.value == other.value {\n        return 0\n    }\n    return 1\n}\nfunc doComparison(c1, c2 Comparable) {\n    fmt.Println(c1.compare(c2))\n}\nfunc main() {\n    doComparison(T{1}, T{2})\n}\n</code></pre>\n\n<p>So I'm getting error</p>\n\n<pre><code>cannot use T literal (type T) as type Comparable in argument to doComparison:\n    T does not implement Comparable (wrong type for compare method)\n        have compare(T) int\n        want compare(Comparable) int\n</code></pre>\n\n<p>And I guess I understand the problem that <code>T</code> doesn't implement <code>Comparable</code> because compare method take as a parameter <code>T</code> but not <code>Comparable</code>.</p>\n\n<p>Maybe I missed something or didn't understand but is it possible to do such thing?</p>\n"}, {"tags": ["ubuntu", "go", "package"], "answers": [{"comments": [{"owner": {"reputation": 1688, "user_id": 2058355, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/F4ysP.jpg?s=128&g=1", "display_name": "prashantitis", "link": "https://stackoverflow.com/users/2058355/prashantitis"}, "edited": false, "score": 0, "creation_date": 1454166787, "post_id": 35103295, "comment_id": 57927598, "body": "but i did sudo apt-get --upgrade golang in my ubnutu and it said  my Go version is latest. So I have to do it manually?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1688, "user_id": 2058355, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/F4ysP.jpg?s=128&g=1", "display_name": "prashantitis", "link": "https://stackoverflow.com/users/2058355/prashantitis"}, "edited": false, "score": 0, "creation_date": 1454169549, "post_id": 35103295, "comment_id": 57928510, "body": "@Prashant: yes <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">golang.org/doc/install</a>. The distri packages don&#39;t keep up with tools like this."}], "tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": false, "score": 0, "last_activity_date": 1454166231, "creation_date": 1454166231, "answer_id": 35103295, "question_id": 35101689, "link": "https://stackoverflow.com/questions/35101689/golang-error-in-getting-a-package/35103295#35103295", "title": "golang error in getting a package", "body": "<p>You probably don't have the newest go. Try </p>\n\n<blockquote>\n  <p>go version</p>\n</blockquote>\n\n<p>In go 1.5.1 that I have net.Dialer has also member KeepAlive. In your version probably don't. You can check </p>\n\n<blockquote>\n  <p>go doc net.Dialer</p>\n</blockquote>\n"}], "owner": {"reputation": 1688, "user_id": 2058355, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/F4ysP.jpg?s=128&g=1", "display_name": "prashantitis", "link": "https://stackoverflow.com/users/2058355/prashantitis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1454166231, "creation_date": 1454156290, "question_id": 35101689, "link": "https://stackoverflow.com/questions/35101689/golang-error-in-getting-a-package", "title": "golang error in getting a package", "body": "<p>While trying to download the package in golang in my project using this command\nI go this error</p>\n\n<p>/home$ <strong>go get golang.org/x/oauth2/google</strong></p>\n\n#google.golang.org/cloud/compute/metadata\n\n<p>prashant/.go/src/google.golang.org/cloud/compute/metadata/metadata.go:55: unknown net.Dialer field 'KeepAlive' in struct literal</p>\n\n<p>Tried searching on google and have updated my golang version as well.\nbut the error is still coming.\nOS: Ubuntu 14.04</p>\n\n<p>Any suggestions?</p>\n"}, {"tags": ["unit-testing", "go", "dependency-injection", "inversion-of-control"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1454156546, "post_id": 35101663, "comment_id": 57924350, "body": "this is a rather decent dependency injection framework from Parse (R.I.P). <a href=\"https://godoc.org/github.com/facebookgo/inject\" rel=\"nofollow noreferrer\">godoc.org/github.com/facebookgo/inject</a>"}], "answers": [{"tags": [], "owner": {"reputation": 678, "user_id": 595362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sx7ju.png?s=128&g=1", "display_name": "noisewaterphd", "link": "https://stackoverflow.com/users/595362/noisewaterphd"}, "is_accepted": false, "score": 0, "last_activity_date": 1454304972, "creation_date": 1454304972, "answer_id": 35123621, "question_id": 35101663, "link": "https://stackoverflow.com/questions/35101663/how-can-i-mock-go-functions-in-my-tests/35123621#35123621", "title": "How can I mock Go functions in my tests?", "body": "<p>Besides enabling you to easily mock these functions, writing 'adapters' (your own interface) for such things has the advantage of abstracting your code from any individual implementation.</p>\n\n<p>Passing structs around in your code also keeps your app from external dependencies on some kind of injection framework (many of which just violate the principle of IOC anyway).</p>\n\n<p>In addition to writing your own interfaces to these dependencies, certain design philosophies can help you to mock .</p>\n\n<p>For example, using domain driven design patterns, you can simply mock your \"repository\" in unit tests rather than mocking a database library.</p>\n\n<p>In Go, all of this ends up very clean, and succinct, without the burden of a horde of third party frameworks magically doing the work for you.</p>\n"}], "owner": {"reputation": 1889, "user_id": 892404, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6c64aa7f128d8b6e4cfeafae93782ec7?s=128&d=identicon&r=PG", "display_name": "Parham Doustdar", "link": "https://stackoverflow.com/users/892404/parham-doustdar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1454304972, "creation_date": 1454156109, "question_id": 35101663, "link": "https://stackoverflow.com/questions/35101663/how-can-i-mock-go-functions-in-my-tests", "title": "How can I mock Go functions in my tests?", "body": "<p>I have read a few questions on StackOverflow that ask how functions such as <code>time.Now()</code> can be mocked. The solution seems to be to write a struct that implements a particular interface, and then in the tests, pass in that mock instead.</p>\n\n<p>Is there a better way of doing this? Since there is no good enough implementation of a dependency injection container in Golang, I don't want to pass structs around manually, or to create a struct that only has something like this inside:</p>\n\n<pre><code>func (s MyStruct) Now() {\n    return time.Now()\n}\n</code></pre>\n\n<p>Because, first, I can't test <em>this</em> function. It might be nothing when you are dealing with one line that has no variables in it, but I have a function that connects to a TCP port. Doing stuff like this would require me to create adapters to everything it uses (eg <code>net.Dial()</code>, <code>time.Now()</code>, <code>io.Copy()</code>, <code>bufio.Read()</code>, and many others).</p>\n\n<p>Second, since there is no DI, I will have to pass structs around, which will end up cluttering my code, rather than making it easier to read like DI does in other languages.</p>\n"}, {"tags": ["go", "libgit2"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 2188638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1856a21723edda1e496124179e9a2c8a?s=128&d=identicon&r=PG", "display_name": "ksmigiel", "link": "https://stackoverflow.com/users/2188638/ksmigiel"}, "edited": false, "score": 0, "creation_date": 1454244072, "post_id": 35108193, "comment_id": 57948253, "body": "Thank you for help! I will take those hints to ask questions more precisely in future."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1454197117, "last_edit_date": 1495541724, "creation_date": 1454194327, "answer_id": 35108193, "question_id": 35101616, "link": "https://stackoverflow.com/questions/35101616/git2go-patch-returns-diff-for-first-file-only/35108193#35108193", "title": "git2go Patch() returns diff for first file only", "body": "<p>You need to post all the necessary elements to reproduce your problem: <a href=\"https://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example</a>. This includes input and expected output.</p>\n\n<p>For example, in reproducible form, to show all file patch diffs in a commit:</p>\n\n<p><code>patchdiffs.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/libgit2/git2go\"\n    \"log\"\n)\n\n/*\ngithub.com/libgit2/git2go\ncommit 80cf533fe4e48ddfab3015d9570f2833951c1dea\nAuthor: David Pierce &lt;david.pierce@moz.com&gt;\nDate:   Sat Sep 26 15:37:48 2015 -0700\n\n    Config#LookupString uses git_buf to load value\n\n config.go      |  8 +++++---\n config_test.go | 58 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n 2 files changed, 63 insertions(+), 3 deletions(-)\n*/\n\nfunc main() {\n    // After go get -v github.com/libgit2/git2go\n    // path to git2go repository in your $GOPATH\n    repoPath := `/home/peter/gopath/src/github.com/libgit2/git2go`\n    gitRepo, err := git.OpenRepository(repoPath)\n    if err != nil {\n        log.Fatal(err)\n    }\n    // commit SHA-1 checksum\n    commitID := `80cf533fe4e48ddfab3015d9570f2833951c1dea`\n    commitOid, err := git.NewOid(commitID)\n    if err != nil {\n        log.Fatal(err)\n    }\n    commit, err := gitRepo.LookupCommit(commitOid)\n    if err != nil {\n        log.Fatal(err)\n    }\n    commitTree, err := commit.Tree()\n    if err != nil {\n        log.Fatal(err)\n    }\n    options, err := git.DefaultDiffOptions()\n    if err != nil {\n        log.Fatal(err)\n    }\n    options.IdAbbrev = 40\n    var parentTree *git.Tree\n    if commit.ParentCount() &gt; 0 {\n        parentTree, err = commit.Parent(0).Tree()\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n    gitDiff, err := gitRepo.DiffTreeToTree(parentTree, commitTree, &amp;options)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Show all file patch diffs in a commit.\n    numDeltas, err := gitDiff.NumDeltas()\n    if err != nil {\n        log.Fatal(err)\n    }\n    for d := 0; d &lt; numDeltas; d++ {\n        patch, err := gitDiff.Patch(d)\n        if err != nil {\n            log.Fatal(err)\n        }\n        patchString, err := patch.String()\n        if err != nil {\n            log.Fatal(err)\n        }\n        log.Printf(\"\\n%s\", patchString)\n        patch.Free()\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run patchdiffs.go\n2016/01/30 18:35:44 \ndiff --git a/config.go b/config.go\nindex 9d25e3571de22b4121d66bb88949d0e292f1a836..c4c40281abb85a861ba1bf760011e2990cf151b3 100644\n--- a/config.go\n+++ b/config.go\n@@ -115,18 +115,20 @@ func (c *Config) LookupInt64(name string) (int64, error) {\n }\n\n func (c *Config) LookupString(name string) (string, error) {\n-   var ptr *C.char\n    cname := C.CString(name)\n    defer C.free(unsafe.Pointer(cname))\n\n+   valBuf := C.git_buf{}\n+\n    runtime.LockOSThread()\n    defer runtime.UnlockOSThread()\n\n-   if ret := C.git_config_get_string(&amp;ptr, c.ptr, cname); ret &lt; 0 {\n+   if ret := C.git_config_get_string_buf(&amp;valBuf, c.ptr, cname); ret &lt; 0 {\n        return \"\", MakeGitError(ret)\n    }\n+   defer C.git_buf_free(&amp;valBuf)\n\n-   return C.GoString(ptr), nil\n+   return C.GoString(valBuf.ptr), nil\n }\n\n func (c *Config) LookupBool(name string) (bool, error) {\n2016/01/30 18:35:44 \ndiff --git a/config_test.go b/config_test.go\nnew file mode 100644\nindex 0000000000000000000000000000000000000000..e4a2c1f310f1beb9bcb70be50320c53e22417e2a\n--- /dev/null\n+++ b/config_test.go\n@@ -0,0 +1,58 @@\n+package git\n+\n+import (\n+   \"os\"\n+   \"testing\"\n+)\n+\n+func setupConfig() (*Config, error) {\n+   var (\n+       c   *Config\n+       err error\n+       p   string\n+   )\n+\n+   p, err = ConfigFindGlobal()\n+   if err != nil {\n+       return nil, err\n+   }\n+\n+   c, err = OpenOndisk(nil, p)\n+   if err != nil {\n+       return nil, err\n+   }\n+\n+   c.SetString(\"foo.bar\", \"baz\")\n+\n+   return c, err\n+}\n+\n+func cleanupConfig() {\n+   os.Remove(tempConfig)\n+}\n+\n+func TestConfigLookupString(t *testing.T) {\n+   var (\n+       err error\n+       val string\n+       c   *Config\n+   )\n+\n+   c, err = setupConfig()\n+   defer cleanupConfig()\n+   if err != nil {\n+       t.Errorf(\"Setup error: '%v'. Expected none\\n\", err)\n+       t.FailNow()\n+   }\n+   defer c.Free()\n+\n+   val, err = c.LookupString(\"foo.bar\")\n+   if err != nil {\n+       t.Errorf(\"Got error: '%v', expected none\\n\", err)\n+       t.FailNow()\n+   }\n+\n+   if val != \"baz\" {\n+       t.Errorf(\"Got '%s', expected 'bar'\\n\", val)\n+   }\n+}\n$\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 2188638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1856a21723edda1e496124179e9a2c8a?s=128&d=identicon&r=PG", "display_name": "ksmigiel", "link": "https://stackoverflow.com/users/2188638/ksmigiel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 1, "accepted_answer_id": 35108193, "answer_count": 1, "score": 2, "last_activity_date": 1454197117, "creation_date": 1454155820, "last_edit_date": 1454163601, "question_id": 35101616, "link": "https://stackoverflow.com/questions/35101616/git2go-patch-returns-diff-for-first-file-only", "title": "git2go Patch() returns diff for first file only", "body": "<p>I was trying to configure <a href=\"https://github.com/reviewboard/rb-gateway\" rel=\"nofollow\">rb-gateway</a> (simple proxy written in Go, which supports custom repositories for ReviewBoard).\ngit2go is built from <em>next</em> branch together with <em>libgit2</em>.\nProblem occurs during generation patch from diff. Code below returns always first file changes only.</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/libgit2/git2go\"\n    \"log\"\n)\n\nfunc main() {\n    gitRepo, err := git.OpenRepository(\"repo_path\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    commitOid, err := git.NewOid(\"commit_id_sha1\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    commit, err := gitRepo.LookupCommit(commitOid)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    commitTree, err := commit.Tree()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    options, err := git.DefaultDiffOptions()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Specifying full patch indices.\n    options.IdAbbrev = 40\n\n    var parentTree *git.Tree\n    if commit.ParentCount() &gt; 0 {\n        parentTree, err = commit.Parent(0).Tree()\n        if err != nil {\n            log.Fatal(err)\n         }\n    }\n\n    gitDiff, err := gitRepo.DiffTreeToTree(parentTree, commitTree, &amp;options)\n    if err != nil {\n         log.Fatal(err)\n    }\n\n    patch, err := gitDiff.Patch(0)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    patchString, err := patch.String()\n    if err != nil {\n         log.Fatal(err)\n    }\n\n    log.Printf(\"%s\", patchString)\n\n    patch.Free()\n}\n</code></pre>\n\n<p>Environment:\n<code>go version go1.4.2 linux/amd64</code>\n<code>git version 1.8.3.1</code>\n<code>libgit2 and git2go latest</code>\n<code>Linux 3.10.0-327.4.5.el7.x86_64 (CentOS)</code></p>\n"}, {"tags": ["unit-testing", "go"], "answers": [{"comments": [{"owner": {"reputation": 2269, "user_id": 3016716, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wCaTR.jpg?s=128&g=1", "display_name": "shivams", "link": "https://stackoverflow.com/users/3016716/shivams"}, "edited": false, "score": 1, "creation_date": 1454140861, "post_id": 35099468, "comment_id": 57919980, "body": "Can you please elaborate it a little ?"}, {"owner": {"reputation": 1441, "user_id": 5151441, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WvqLN.png?s=128&g=1", "display_name": "Jessica", "link": "https://stackoverflow.com/users/5151441/jessica"}, "edited": false, "score": 2, "creation_date": 1583681892, "post_id": 35099468, "comment_id": 107191209, "body": "This seems like a silly language feature, as it means you can&#39;t store _test.go files in the same directory as the rest of your go package. Unless I&#39;m misunderstanding?"}], "tags": [], "owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "is_accepted": false, "score": 10, "last_activity_date": 1454143197, "last_edit_date": 1454143197, "creation_date": 1454140729, "answer_id": 35099468, "question_id": 35099417, "link": "https://stackoverflow.com/questions/35099417/go-not-running-program-with-name-package-test-go/35099468#35099468", "title": "go not running program with name package_test.go", "body": "<p>Not a bug, it's designed so. <code>go run</code> detects the <code>_test</code> files and consider them as test files for a package, test files will be compiled as a separate package, and then linked and run with the main test binary.<br>\nIt's recommended to put your package file to <code>GOPATH/src/PACK_NAME/</code>, then run your <code>*_test.go</code> with <code>go test</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 7, "last_activity_date": 1454142013, "creation_date": 1454142013, "answer_id": 35099585, "question_id": 35099417, "link": "https://stackoverflow.com/questions/35099417/go-not-running-program-with-name-package-test-go/35099585#35099585", "title": "go not running program with name package_test.go", "body": "<p>You can't name your program files as <code>*_test.go</code> as this is part of integrated Go <a href=\"https://golang.org/pkg/testing/\" rel=\"noreferrer\">testing system</a></p>\n\n<blockquote>\n  <p>To write a new test suite, <strong>create a file whose name ends _test.go</strong> that contains the TestXxx functions as described here. Put the file in the same package as the one being tested. The file will be excluded from regular package builds but will be included when the \u201cgo test\u201d command is run. For more detail, run \u201cgo help test\u201d and \u201cgo help testflag\u201d. </p>\n</blockquote>\n\n<p>Just rename <code>package_test.go</code> to <code>packagetest.go</code></p>\n"}], "owner": {"reputation": 2269, "user_id": 3016716, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wCaTR.jpg?s=128&g=1", "display_name": "shivams", "link": "https://stackoverflow.com/users/3016716/shivams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7745, "favorite_count": 1, "accepted_answer_id": 35099585, "answer_count": 2, "score": 7, "last_activity_date": 1569167271, "creation_date": 1454140314, "last_edit_date": 1569167271, "question_id": 35099417, "link": "https://stackoverflow.com/questions/35099417/go-not-running-program-with-name-package-test-go", "title": "go not running program with name package_test.go", "body": "<p>I have following code under package <em>pack1</em>. Name of file is <code>pack1.go</code></p>\n\n<pre><code>package pack1\n\nvar Pack1Int int = 42\nvar pack1Float = 3.14\n\nfunc ReturnStr() string {\n    return \"Hello world!\"\n}\n</code></pre>\n\n<p>And following code in main program. Name of file is <code>package_test.go</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"./pack1\"\n)\n\nfunc main() {\n    var test1 string\n    test1 = pack1.ReturnStr()\n    fmt.Printf(\"Return string from pack1 : %s\\n\", test1)\n    fmt.Printf(\"Integer from pack1 : %d\\n\", pack1.Pack1Int)\n}\n</code></pre>\n\n<p>When I try to run it with command <code>go run package_test.go</code> I get following error: </p>\n\n<p><code>go run: cannot run *_test.go files (package_test.go)</code></p>\n\n<p>But if I rename file to <code>abc.go</code> then I am getting proper output i.e. </p>\n\n<pre><code>Return string from pack1 : Hello world!\nInteger from pack1 : 42\n</code></pre>\n\n<p>I am curious about what is wrong with using <code>package_test.go</code> as file name. \nFor code with only main package this name is working fine. </p>\n\n<p>Is this a bug in Go or I am doing something wrong ? </p>\n"}, {"tags": ["go", "character-encoding", "decode", "non-ascii-characters"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": false, "score": 0, "last_activity_date": 1454143823, "last_edit_date": 1454143823, "creation_date": 1454142500, "answer_id": 35099633, "question_id": 35097318, "link": "https://stackoverflow.com/questions/35097318/email-subject-header-decoding-in-different-charset-like-iso-2022-jp-gb-2312-e/35099633#35099633", "title": "Email subject, header decoding in different charset like ISO-2022-JP, GB-2312, etc", "body": "<p>I'm not sure it is what you are looking for but there is <code>golang.org/x/text</code> package which I'm using to convert Windows-1251 to UTF-8. Code looks like</p>\n\n<pre><code>import (\n    \"golang.org/x/text/encoding/charmap\"\n    \"golang.org/x/text/transform\"\n    \"io/ioutil\"\n    \"strings\"\n)\n\nfunc convert(s string) string {\n    sr := strings.NewReader(s)\n    tr := transform.NewReader(sr, charmap.Windows1251.NewDecoder())\n    buf, err := ioutil.ReadAll(tr)\n    if err != nil {\n        return \"\"\n    }\n    return string(buf)\n}\n</code></pre>\n\n<p>I think in your case if you want to avoid \"a big 'switch-case'\" you can create kind of map with full list of available encodings and just make something like:</p>\n\n<pre><code>var encodings = map[string]transform.Transformer{\n    \"win-1251\": charmap.Windows1251.NewDecoder(),\n}\n\nfunc convert(s, charset string) string {\n    buf, err := ioutil.ReadAll(transform.NewReader(strings.NewReader(s), encodings[charset]))\n    if err != nil {\n        return \"\"\n    }\n    return string(buf)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1783, "user_id": 4569273, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a57a59c27de3760066076765f8dacc2c?s=128&d=identicon&r=PG&f=1", "display_name": "auxdx", "link": "https://stackoverflow.com/users/4569273/auxdx"}, "is_accepted": false, "score": 1, "last_activity_date": 1454203619, "creation_date": 1454203619, "answer_id": 35109300, "question_id": 35097318, "link": "https://stackoverflow.com/questions/35097318/email-subject-header-decoding-in-different-charset-like-iso-2022-jp-gb-2312-e/35109300#35109300", "title": "Email subject, header decoding in different charset like ISO-2022-JP, GB-2312, etc", "body": "<p>Thanks. It seems that the package golang.org/x/net/html/charset already provided a map with available encoding. The following code works for me:</p>\n\n<pre><code>import \"golang.org/x/net/html/charset\"\n\nCharsetReader := func (label string, input io.Reader) (io.Reader, error) {\n    label = strings.Replace(label, \"windows-\", \"cp\", -1)\n    encoding, _ := charset.Lookup(label)\n    return encoding.NewDecoder().Reader(input), nil\n}\ndec := mime.WordDecoder{CharsetReader: CharsetReader}\ntext := \"=?iso-2022-jp?b?GyRCRW1CQE86GyhCIDxtb21vQHRhcm8ubmUuanA=?=\"\nheader, err := dec.DecodeHeader(text)\n</code></pre>\n\n<p>Thanks for your help!</p>\n"}], "owner": {"reputation": 1783, "user_id": 4569273, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a57a59c27de3760066076765f8dacc2c?s=128&d=identicon&r=PG&f=1", "display_name": "auxdx", "link": "https://stackoverflow.com/users/4569273/auxdx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 862, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1454203619, "creation_date": 1454121023, "question_id": 35097318, "link": "https://stackoverflow.com/questions/35097318/email-subject-header-decoding-in-different-charset-like-iso-2022-jp-gb-2312-e", "title": "Email subject, header decoding in different charset like ISO-2022-JP, GB-2312, etc", "body": "<p>I am working on a project which needs to deal with email encoding/decoding in different charsets. A python code for this can be shown in the below:</p>\n\n<pre><code>from email.header import Header, decode_header, make_header\nfrom charset import text_to_utf8    \n\nclass ....\ndef decode_header(self, header):\n    decoded_header = decode_header(header)\n\n    if decoded_header[0][1] is None:\n        return text_to_utf8(decoded_header[0][0]).decode(\"utf-8\", \"replace\")\n    else:\n        return decoded_header[0][0].decode(decoded_header[0][1].replace(\"windows-\", \"cp\"), \"replace\")\n</code></pre>\n\n<p>Basically, for the text like \"=?iso-2022-jp?b?GyRCRW1CQE86GyhCIDxtb21vQHRhcm8ubmUuanA=?=\"; the \"decode_header\" function just tries to find the encoding: 'iso-2022-jp'; then it will use the \"decode\" function to decode the charset to unicode. </p>\n\n<p>Now, in go, i can do something similar to like: </p>\n\n<pre><code>import \"mime\"\n\ndec := new(mime.WordDecoder)\ntext := \"=?utf-8?q?=C3=89ric?= &lt;eric@example.org&gt;, =?utf-8?q?Ana=C3=AFs?= &lt;anais@example.org&gt;\"\nheader, err := dec.DecodeHeader(text)\n\nSeems that there mime.WordDecoder allow to put a charset decoder \"hook\": \ntype WordDecoder struct {\n   // CharsetReader, if non-nil, defines a function to generate\n   // charset-conversion readers, converting from the provided\n   // charset into UTF-8.\n   // Charsets are always lower-case. utf-8, iso-8859-1 and us-ascii charsets\n   // are handled by default.\n   // One of the the CharsetReader's result values must be non-nil.\n   CharsetReader func(charset string, input io.Reader) (io.Reader, error)\n}           \n</code></pre>\n\n<p>I am wondering is there any library which can allow me to convert arbitrary charset like the \"decode\" function in python as shown in the above example. I don't want to write a big \"switch-case\"like the one being used in mime/encodedword.go:</p>\n\n<pre><code>func (d *WordDecoder) convert(buf *bytes.Buffer, charset string, content []byte) error {\n   switch {\n   case strings.EqualFold(\"utf-8\", charset):\n      buf.Write(content)\n   case strings.EqualFold(\"iso-8859-1\", charset):\n      for _, c := range content {\n         buf.WriteRune(rune(c))\n      }\n....\n</code></pre>\n\n<p>Any help would be very appreciated.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1454097351, "last_edit_date": 1454097351, "creation_date": 1454096728, "answer_id": 35092768, "question_id": 35092641, "link": "https://stackoverflow.com/questions/35092641/input-type-text-value-form-enctype-multipart-form-data-returns-null/35092768#35092768", "title": "Input TYPE TEXT Value form (enctype=\u201cmultipart/form-data\u201d) returns null", "body": "<p><a href=\"https://golang.org/pkg/net/http/#Request.ParseForm\" rel=\"nofollow\"><code>ParseForm</code></a> only parses the query parameters. From the docs:</p>\n\n<blockquote>\n  <p>ParseForm parses the raw query from the URL and updates r.Form.</p>\n  \n  <p>For POST or PUT requests, it also parses the request body as a form\n  and put the results into both r.PostForm and r.Form. POST and PUT body\n  parameters take precedence over URL query string values in r.Form.</p>\n  \n  <p>If the request Body's size has not already been limited by\n  MaxBytesReader, the size is capped at 10MB.</p>\n  \n  <p>ParseMultipartForm calls ParseForm automatically. It is idempotent.</p>\n</blockquote>\n\n<p>Either use <a href=\"https://golang.org/pkg/net/http/#Request.ParseMultipartForm\" rel=\"nofollow\"><code>ParseMultipartForm</code></a> if you want to handle \"multipart/form-data\", or don't call either and let <code>FormValue</code> call what's needed. </p>\n"}, {"tags": [], "owner": {"reputation": 136, "user_id": 2632893, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PHgQM.png?s=128&g=1", "display_name": "Johnson", "link": "https://stackoverflow.com/users/2632893/johnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1454464595, "last_edit_date": 1454464595, "creation_date": 1454463428, "answer_id": 35167002, "question_id": 35092641, "link": "https://stackoverflow.com/questions/35092641/input-type-text-value-form-enctype-multipart-form-data-returns-null/35167002#35167002", "title": "Input TYPE TEXT Value form (enctype=\u201cmultipart/form-data\u201d) returns null", "body": "<p>Yes, you should use enctype=\"multipart/form-data\". But you should not use ParseForm() method if you already use FormValue(key string) or FormFile(key string) method.</p>\n\n<p><a href=\"https://golang.org/pkg/net/http/#Request.FormFile\" rel=\"nofollow\">Request.FormFile</a></p>\n\n<blockquote>\n  <p>FormFile returns the first file for the provided form key. FormFile\n  calls ParseMultipartForm and ParseForm if necessary.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/pkg/net/http/#Request.FormValue\" rel=\"nofollow\">Request.FormValue</a></p>\n\n<blockquote>\n  <p>FormValue returns the first value for the named component of the\n  query. POST and PUT body parameters take precedence over URL query\n  string values. FormValue calls ParseMultipartForm and ParseForm if\n  necessary and ignores any errors returned by these functions. If key\n  is not present, FormValue returns the empty string. To access multiple\n  values of the same key, call ParseForm and then inspect Request.Form\n  directly.</p>\n</blockquote>\n\n<pre><code>&lt;form action=\"/fupload\" method=\"POST\" enctype=\"multipart/form-data\"&gt;\n   &lt;input type=\"file\" name=\"fileupload\"&gt;\n&lt;/form&gt;\n\n\nfile, _, err := req.FormFile(\"fileupload\")\n    switch err {\n    case nil:\n        defer file.Close()\n        fileData, err := ioutil.ReadAll(file)\n        //check err\n    case http.ErrMissingFile:\n        //do something\n    default:\n        //do something\n    }\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 5775232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/470d0463b80960c71b631f7a5bc6df84?s=128&d=identicon&r=PG&f=1", "display_name": "ssenthil", "link": "https://stackoverflow.com/users/5775232/ssenthil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 488, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1454464595, "creation_date": 1454096240, "last_edit_date": 1454100077, "question_id": 35092641, "link": "https://stackoverflow.com/questions/35092641/input-type-text-value-form-enctype-multipart-form-data-returns-null", "title": "Input TYPE TEXT Value form (enctype=\u201cmultipart/form-data\u201d) returns null", "body": "<pre><code>func fupload(w http.ResponseWriter, r *http.Request) {\n    if r.Method == \"POST\" {\n        r.ParseForm()\n        company := r.FormValue(\"company\")\n        fmt.Println(company)\n        _, header, _ := r.FormFile(\"upfile\")\n        fmt.Println(header.Filename)\n        return\n    }\n    w.Write([]byte(\"&lt;html&gt;&lt;body&gt;\"))\n    w.Write([]byte(fmt.Sprintf(\"&lt;form method=\\\"POST\\\" enctype=\\\"multipart/form-data\\\"&gt;\")))\n    w.Write([]byte(\"Enter Company &lt;input type=\\\"text\\\" maxlength=\\\"80\\\" size=\\\"80\\\" name=\\\"company\\\" &gt;&lt;br/&gt;\"))\n    w.Write([]byte(\"File to upload: &lt;input type=\\\"file\\\" name=\\\"upfile\\\" /&gt;&lt;br/&gt;\"))\n    w.Write([]byte(\"&lt;input type=\\\"submit\\\"  value=\\\"Submit\\\"/&gt;\"))\n    w.Write([]byte(\"&lt;/form&gt;\"))\n    w.Write([]byte(\"&lt;/body&gt;&lt;/html&gt;\"))\n    return\n}\n</code></pre>\n\n<p>For the input type Text (eg) Company here always return NULL, when enctype=\"multipart/form-data\"</p>\n"}, {"tags": ["json", "go", "deserialization"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1454096161, "post_id": 35092395, "comment_id": 57907043, "body": "I would probably unmarshal into a temp <code>map[string]interface{}</code>, and have a method to manually map the fields into your struct."}, {"owner": {"reputation": 5072, "user_id": 537500, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/cd1f9e76e6bc4adaa787e84f15b63eb6?s=128&d=identicon&r=PG", "display_name": "Rana", "link": "https://stackoverflow.com/users/537500/rana"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454096288, "post_id": 35092395, "comment_id": 57907109, "body": "I thought about that already. But that would be error prone and time consuming to do it manually(as its a pretty large json with lots of fields) for all fields as most of them are straight forward fixed fields."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454096470, "post_id": 35092395, "comment_id": 57907201, "body": "You could unmarshal twice, once into the struct to get all the defined fields, and once into a map, then clean up the rest. It&#39;s less efficient, but would take care of the manual labor. Maybe you could even just dump the entire map into the struct&#39;s map and ignore the extra values that were already deserialized."}, {"owner": {"reputation": 5072, "user_id": 537500, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/cd1f9e76e6bc4adaa787e84f15b63eb6?s=128&d=identicon&r=PG", "display_name": "Rana", "link": "https://stackoverflow.com/users/537500/rana"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454102346, "post_id": 35092395, "comment_id": 57910324, "body": "Interesting idea. Thanks! I am gonna try this"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 1, "last_activity_date": 1454103183, "creation_date": 1454103183, "answer_id": 35094415, "question_id": 35092395, "link": "https://stackoverflow.com/questions/35092395/deserialize-patterned-fields-in-golang/35094415#35094415", "title": "Deserialize patterned fields In Golang", "body": "<p>It's less efficient, but you could unmarshal twice to avoid manually mapping the fields. Once to put all the properly tagged fields into the struct, and then again into a <code>map[string]interface{}</code> to get everything else. If you don't care about the duplicate fields, you don't even need to filter the second map.</p>\n\n<p>You can even do this in an <code>UnmarshalJSON</code>method to automatically populate the struct</p>\n\n<pre><code>type S struct {\n    A   string `json:\"a\"`\n    B   string `json:\"b\"`\n    All map[string]interface{}\n}\n\nfunc (s *S) UnmarshalJSON(b []byte) error {\n    // create a new type to hide the UnmarshalJSON method\n    // otherwise we'll recurse indefinitely.\n    type ss S\n\n    err := json.Unmarshal(b, (*ss)(s))\n    if err != nil {\n        return err\n    }\n    // now unmarshal again into the All map\n    err = json.Unmarshal(b, &amp;s.All)\n    if err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/VBVlRjNlHy\" rel=\"nofollow\">http://play.golang.org/p/VBVlRjNlHy</a></p>\n"}], "owner": {"reputation": 5072, "user_id": 537500, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/cd1f9e76e6bc4adaa787e84f15b63eb6?s=128&d=identicon&r=PG", "display_name": "Rana", "link": "https://stackoverflow.com/users/537500/rana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1454103183, "creation_date": 1454095258, "question_id": 35092395, "link": "https://stackoverflow.com/questions/35092395/deserialize-patterned-fields-in-golang", "title": "Deserialize patterned fields In Golang", "body": "<p>I am writing golang struct, which are compatible with some json structure. However, those most of the fields are know, there will be few fields following some specific patterns(like \"x-{randomName}\") in the json definition, which I also want to get deserialized to a certain field as <code>map[string]interface{}</code> as well.</p>\n\n<p>Is there any descent way to achieve it?</p>\n"}, {"tags": ["go", "sqlite", "sqlx"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 4, "last_activity_date": 1454096919, "creation_date": 1454096919, "answer_id": 35092830, "question_id": 35090436, "link": "https://stackoverflow.com/questions/35090436/struct-time-property-doesnt-load-from-go-sqlx-library/35092830#35092830", "title": "struct Time property doesn&#39;t load from Go sqlx library", "body": "<p>There is no official package for Sqlite so I assume you are using <a href=\"https://github.com/mattn/go-sqlite3\" rel=\"nofollow\">https://github.com/mattn/go-sqlite3</a> Probably your issue is result of wrong <code>created_at</code> field declaration in database which should be <code>DATETIME</code> because the next code works perfectly on my machine (I've removed all error checks):</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/jmoiron/sqlx\"\n    _ \"github.com/mattn/go-sqlite3\"\n    \"log\"\n    \"time\"\n)\n\ntype Post struct {\n    Id      int64     `db:\"post_id\"`\n    Created time.Time `db:\"created\"`\n}\n\nfunc main() {\n    db, _ := sqlx.Connect(\"sqlite3\", \"post_db.db\")\n    db.MustExec(\"DROP TABLE IF EXISTS posts; CREATE TABLE posts (post_id INT, created DATETIME);\")\n\n    p1 := Post{Id: 1, Created: time.Now().UTC()}\n    p2 := Post{}\n\n    tx := db.MustBegin()\n    tx.NamedExec(\"INSERT INTO posts (post_id, created) VALUES (:post_id, :created)\", &amp;p1)\n    tx.Commit()\n\n    db.Get(&amp;p2, \"SELECT post_id, created FROM posts WHERE post_id = $1\", p1.Id)\n    log.Println(p2.Created.Format(\"2006-01-02\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 620, "user_id": 347641, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fi6dx.jpg?s=128&g=1", "display_name": "Shah-G", "link": "https://stackoverflow.com/users/347641/shah-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1991, "favorite_count": 0, "accepted_answer_id": 35092830, "answer_count": 1, "score": 5, "last_activity_date": 1454098467, "creation_date": 1454088320, "last_edit_date": 1454098467, "question_id": 35090436, "link": "https://stackoverflow.com/questions/35090436/struct-time-property-doesnt-load-from-go-sqlx-library", "title": "struct Time property doesn&#39;t load from Go sqlx library", "body": "<p>I have a struct with a property time:</p>\n\n<pre><code>type Basket struct {  \n  ...  \n  Created_at time.Time `db:\"created_at\"`\n}\n</code></pre>\n\n<p>with the time saved as:</p>\n\n<pre><code>basket.Created_at = time.Now().UTC()\n</code></pre>\n\n<p>If I save it using Insert sql statement, it saves the time nicely in the SQLite3 but when I select the desired record using:  </p>\n\n<pre><code>ret_basket := Basket{}\nerr := database.DB.Get(&amp;ret_basket, \"SELECT id, ..., created_at FROM baskets WHERE user_id = ?\", some_user_id)\n</code></pre>\n\n<p>It returns the record with other properties loaded properly except the time property which is <code>ret_basket.Created_at</code> as <code>0001-01-01 00:00:00 +0000 UTC</code>  </p>\n\n<p>Any suggestions?</p>\n"}, {"tags": ["http", "redirect", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454085584, "post_id": 35089052, "comment_id": 57901084, "body": "possible duplicates: <a href=\"http://stackoverflow.com/questions/24518945/\">stackoverflow.com/questions/24518945</a> <a href=\"http://stackoverflow.com/questions/29865691/\">stackoverflow.com/questions/29865691</a>, <a href=\"http://stackoverflow.com/questions/27814942/\">stackoverflow.com/questions/27814942</a>"}], "answers": [{"comments": [{"owner": {"reputation": 581, "user_id": 5903242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/232ac8e4aaf83a023522fe58d6e9ef6b?s=128&d=identicon&r=PG&f=1", "display_name": "Thykof", "link": "https://stackoverflow.com/users/5903242/thykof"}, "edited": false, "score": 0, "creation_date": 1601229388, "post_id": 35089094, "comment_id": 113334949, "body": "<code>response.StatusCode</code> triggers an error: <code>panic: runtime error: invalid memory address or nil pointer dereference [signal SIGSEGV: segmentation violation code=0x1 addr=0x10 pc=0x647069]</code>"}], "tags": [], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "is_accepted": true, "score": 19, "last_activity_date": 1496829328, "last_edit_date": 1496829328, "creation_date": 1454084184, "answer_id": 35089094, "question_id": 35089052, "link": "https://stackoverflow.com/questions/35089052/how-to-get-the-redirect-url-instead-of-page-content-in-golang/35089094#35089094", "title": "how to get the redirect url instead of page content in golang?", "body": "<p>You need to check for redirect and stop(capture) them. If you capture a redirection then you can get the redirect URL (to which redirection was happening) using location method of response struct.</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    req, err := http.NewRequest(\"GET\", \"https://www.google.com\", nil)\n    if err != nil {\n        panic(err)\n    }\n    client := new(http.Client)\n    client.CheckRedirect = func(req *http.Request, via []*http.Request) error {\n        return errors.New(\"Redirect\")\n    }\n\n    response, err := client.Do(req)\n    if err != nil {\n        if response.StatusCode == http.StatusFound { //status code 302\n            fmt.Println(response.Location())\n        } else {\n            panic(err)\n        }\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 5857853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf276920ffffb62ef56304871d82383?s=128&d=identicon&r=PG&f=1", "display_name": "murli", "link": "https://stackoverflow.com/users/5857853/murli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6420, "favorite_count": 4, "accepted_answer_id": 35089094, "answer_count": 1, "score": 8, "last_activity_date": 1496829328, "creation_date": 1454084035, "question_id": 35089052, "link": "https://stackoverflow.com/questions/35089052/how-to-get-the-redirect-url-instead-of-page-content-in-golang", "title": "how to get the redirect url instead of page content in golang?", "body": "<p>I am sending a request to server but it is returning a web page. Is there a way to get the url of the web page instead?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nfunc main() {\n    req, err := http.NewRequest(\"GET\", \"https://www.google.com\", nil)\n    if err != nil {\n        panic(err)\n    }\n\n    client := new(http.Client)\n    response, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(ioutil.ReadAll(response.Body))\n}\n</code></pre>\n"}, {"tags": ["windows", "macos", "go", "cross-compiling"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1454077975, "post_id": 35086770, "comment_id": 57895623, "body": "just build the package, and don&#39;t specify individual files."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1454079606, "post_id": 35086770, "comment_id": 57896838, "body": "e.g. <code>GOOS=windows go build -o upload.exe</code> (optionally, you can specify the import path of a package to build that instead of the package in the current directory)."}, {"owner": {"reputation": 2038, "user_id": 1034658, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/d3fc5887a2f39f2e0c8989d39ce5e6f9?s=128&d=identicon&r=PG", "display_name": "Bharat", "link": "https://stackoverflow.com/users/1034658/bharat"}, "edited": false, "score": 0, "creation_date": 1454081117, "post_id": 35086770, "comment_id": 57897870, "body": "Sorry, if this is a naive question (I am a Go beginner :), but how do you build just the &quot;main&quot; package?  Because that is all the three source files are in the main package.  The code lives in my home directory in the path ~/go/src/github.com/bruparel/Projects.  All the source files are under Projects.  My $GOPATH is set to &#39;~/go&#39;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1454083440, "post_id": 35086770, "comment_id": 57899587, "body": "Start here: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>. You either need to have your 3 files be part of the same main package, or put them in their own package and import the common dependencies."}, {"owner": {"reputation": 2038, "user_id": 1034658, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/d3fc5887a2f39f2e0c8989d39ce5e6f9?s=128&d=identicon&r=PG", "display_name": "Bharat", "link": "https://stackoverflow.com/users/1034658/bharat"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1456501442, "post_id": 35086770, "comment_id": 58992279, "body": "@JimB, Thank you.  I have now been able to get the cross platform build go without any problems.  For those who may be in the same boat as I was:  skip the -v main.go part in my original post and you will be all right, i.e., type env GOOS=window GOARCH386 go build"}], "owner": {"reputation": 2038, "user_id": 1034658, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/d3fc5887a2f39f2e0c8989d39ce5e6f9?s=128&d=identicon&r=PG", "display_name": "Bharat", "link": "https://stackoverflow.com/users/1034658/bharat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1518, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1454077245, "creation_date": 1454077245, "question_id": 35086770, "link": "https://stackoverflow.com/questions/35086770/golang-cross-compilation-on-mac-for-windows", "title": "golang cross compilation on mac for windows", "body": "<p>I am writing a go program to parse csv files and upload them to a postgres database in the Heroku cloud.  The program works fine on my mac laptop.  Eventual target platform for deploying the code is Windows though.  I did some research and found that the following command creates a Windows executable on my Mac.</p>\n\n<pre><code> env GOOS=windows GOARCH=386 go build -v main.go\n</code></pre>\n\n<p>This produced an executable called main.exe when I had just one file called main.go.  The program has grown since then and I have it now split into three source files:</p>\n\n<pre><code>main.go\ncommon.go\nspecific.go\n</code></pre>\n\n<p>They are all in the same source directory though.  Moreover, since the program is relatively small, I have all functions in the 'main' package.  What is the command now to cross-compile on mac for windows for multiple source files belonging to the same package?  The previous command did not work since the other two file common.go and specific.go are not included.  Also, I would like to know how to rename the Windows 'exe' file to something else than main.exe, e.g., upload.exe?  I am using go version go1.5 darwin/amd64</p>\n"}, {"tags": ["session", "caching", "go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": false, "score": 6, "last_activity_date": 1454077711, "creation_date": 1454077711, "answer_id": 35086923, "question_id": 35086688, "link": "https://stackoverflow.com/questions/35086688/golang-gorilla-sessions-cache-prevents-logout-functionality/35086923#35086923", "title": "Golang &amp; Gorilla Sessions - Cache Prevents Logout Functionality", "body": "<p>Set the correct cache headers in your handler(s):</p>\n\n<pre><code>w.Header().Set(\"Cache-Control\", \"no-cache, private, max-age=0\")\nw.Header().Set(\"Expires\", time.Unix(0, 0).Format(http.TimeFormat))\nw.Header().Set(\"Pragma\", \"no-cache\")\nw.Header().Set(\"X-Accel-Expires\", \"0\")\n</code></pre>\n\n<p>Note that we set multiple headers to account for proxies and HTTP/1.0 clients.</p>\n\n<p>You can wrap these into middleware you can apply as well:</p>\n\n<pre><code>func NoCache(h http.Handler) http.Handler) {\n    fn := func(w http.ResponseWriter, r *http.Request) {\n        // Set the headers\n    }\n\n    return http.HandlerFunc(fn)\n}\n\n// In your router\nhttp.Handle(\"/user-dashboard\", NoCache(http.HandlerFunc(YourDashboardHandler))\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 5559226, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/2db6ec22bed47d6ba22da0fd9df3c75d?s=128&d=identicon&r=PG&f=1", "display_name": "David Kane", "link": "https://stackoverflow.com/users/5559226/david-kane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1847, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1454077711, "creation_date": 1454077002, "question_id": 35086688, "link": "https://stackoverflow.com/questions/35086688/golang-gorilla-sessions-cache-prevents-logout-functionality", "title": "Golang &amp; Gorilla Sessions - Cache Prevents Logout Functionality", "body": "<p>I've built an application that uses the Go Gorilla sessions package. Everything seems fine, except when on logout I implement</p>\n\n<pre><code>func logout(w http.ResponseWriter, r *http.Request) {\n  session, _ := store.Get(r, \"authsesh\")\n  session.Values[\"access\"] = \"denied\"\n  session.Save(r, w)\n  http.Redirect(w, r, \"/\", 302)\n  return\n}\n</code></pre>\n\n<p>Because the page requiring authentication is cached by the browser, it can still be accessed after logout. How can I get around that? Is there a way to prevent the browser from caching the page? There's nothing wrong with the cookie, if I clear the cache and keep the cookie I can see the logout has had the desired effect. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3, "user_id": 5857149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f509179f684fb3507caa98c0b91d423c?s=128&d=identicon&r=PG&f=1", "display_name": "Anand Thakur", "link": "https://stackoverflow.com/users/5857149/anand-thakur"}, "edited": false, "score": 0, "creation_date": 1454072691, "post_id": 35084919, "comment_id": 57892066, "body": "Thanks Riscie, curl -X POST worked for me too. But still, POSTMAN should work as well, not sure if you use it, but I find it pretty handy."}, {"owner": {"reputation": 3099, "user_id": 1595320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7394f8a600a66b2dfaf6613fd32f8fc?s=128&d=identicon&r=PG", "display_name": "Riscie", "link": "https://stackoverflow.com/users/1595320/riscie"}, "edited": false, "score": 0, "creation_date": 1454072720, "post_id": 35084919, "comment_id": 57892089, "body": "So I just tested it with POSTMAN (the chrome extension) and it detects my POSTs as POST and GETs as GET. Not sure what is going wrong there..."}, {"owner": {"reputation": 3099, "user_id": 1595320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7394f8a600a66b2dfaf6613fd32f8fc?s=128&d=identicon&r=PG", "display_name": "Riscie", "link": "https://stackoverflow.com/users/1595320/riscie"}, "edited": false, "score": 1, "creation_date": 1454072827, "post_id": 35084919, "comment_id": 57892172, "body": "I think I know whats wrong here. Did you enter the complete url into POSTMAN? including the last slash? Because if I don&#39;t enter the last slash, my POST is discovered as GET as well...."}, {"owner": {"reputation": 3, "user_id": 5857149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f509179f684fb3507caa98c0b91d423c?s=128&d=identicon&r=PG&f=1", "display_name": "Anand Thakur", "link": "https://stackoverflow.com/users/5857149/anand-thakur"}, "reply_to_user": {"reputation": 3099, "user_id": 1595320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7394f8a600a66b2dfaf6613fd32f8fc?s=128&d=identicon&r=PG", "display_name": "Riscie", "link": "https://stackoverflow.com/users/1595320/riscie"}, "edited": false, "score": 0, "creation_date": 1454072883, "post_id": 35084919, "comment_id": 57892224, "body": "That was it... so frustrating, but that shouldn&#39;t have mattered right?"}, {"owner": {"reputation": 3099, "user_id": 1595320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7394f8a600a66b2dfaf6613fd32f8fc?s=128&d=identicon&r=PG", "display_name": "Riscie", "link": "https://stackoverflow.com/users/1595320/riscie"}, "edited": false, "score": 0, "creation_date": 1454072979, "post_id": 35084919, "comment_id": 57892282, "body": "Well I am not quite sure what POSTMAN does but actually, the request shouldn&#39;t even get to your handlefunc. If I do the same test with curl, the request ends in the nirvana, which is what I would expect, because we don&#39;t have a route for /cart, only for /cart/"}, {"owner": {"reputation": 3, "user_id": 5857149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f509179f684fb3507caa98c0b91d423c?s=128&d=identicon&r=PG&f=1", "display_name": "Anand Thakur", "link": "https://stackoverflow.com/users/5857149/anand-thakur"}, "reply_to_user": {"reputation": 3099, "user_id": 1595320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7394f8a600a66b2dfaf6613fd32f8fc?s=128&d=identicon&r=PG", "display_name": "Riscie", "link": "https://stackoverflow.com/users/1595320/riscie"}, "edited": false, "score": 1, "creation_date": 1454073084, "post_id": 35084919, "comment_id": 57892352, "body": "Ok. Anyways, thanks for figuring this out."}, {"owner": {"reputation": 3099, "user_id": 1595320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7394f8a600a66b2dfaf6613fd32f8fc?s=128&d=identicon&r=PG", "display_name": "Riscie", "link": "https://stackoverflow.com/users/1595320/riscie"}, "edited": false, "score": 0, "creation_date": 1454073411, "post_id": 35084919, "comment_id": 57892567, "body": "Btw. Here is a discussion about wether to use trailing slashes or not in URLs. Might be relevant. <a href=\"http://stackoverflow.com/questions/5948659/trailing-slash-in-urls-which-style-to-use\" title=\"trailing slash in urls which style to use\">stackoverflow.com/questions/5948659/&hellip;</a>"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1454077236, "post_id": 35084919, "comment_id": 57895078, "body": "Probably a prefetch of sorts. Like how chrome will GET <code>&#47;favicon.ico</code> for a domain."}, {"owner": {"reputation": 3099, "user_id": 1595320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7394f8a600a66b2dfaf6613fd32f8fc?s=128&d=identicon&r=PG", "display_name": "Riscie", "link": "https://stackoverflow.com/users/1595320/riscie"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1454081204, "post_id": 35084919, "comment_id": 57897936, "body": "Could be @thwd. However it seems like not the right thing to do in a tool specially designed for testing http backends..."}, {"owner": {"reputation": 3099, "user_id": 1595320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7394f8a600a66b2dfaf6613fd32f8fc?s=128&d=identicon&r=PG", "display_name": "Riscie", "link": "https://stackoverflow.com/users/1595320/riscie"}, "edited": false, "score": 0, "creation_date": 1454158759, "post_id": 35084919, "comment_id": 57925003, "body": "fwiw: I asked about this within the POSTMAN project over at github. If someone likes to know more about why this happens... <a href=\"https://github.com/postmanlabs/postman-app-support/issues/1687\" rel=\"nofollow noreferrer\">github.com/postmanlabs/postman-app-support/issues/1687</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3099, "user_id": 1595320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7394f8a600a66b2dfaf6613fd32f8fc?s=128&d=identicon&r=PG", "display_name": "Riscie", "link": "https://stackoverflow.com/users/1595320/riscie"}, "is_accepted": true, "score": 3, "last_activity_date": 1454073047, "creation_date": 1454073047, "answer_id": 35085415, "question_id": 35084919, "link": "https://stackoverflow.com/questions/35084919/go-http-request-detecting-post-as-get/35085415#35085415", "title": "Go http Request detecting POST as GET", "body": "<p>In your HandleFunc remove the last trailing slash</p>\n\n<pre><code>    http.HandleFunc(\"/cart\", cartHandler)\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>    http.HandleFunc(\"/cart/\", cartHandler)\n</code></pre>\n\n<p>Or if you want your URL like that, enter it with the slash in POSTMAN and it should work like expected.</p>\n"}], "owner": {"reputation": 3, "user_id": 5857149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f509179f684fb3507caa98c0b91d423c?s=128&d=identicon&r=PG&f=1", "display_name": "Anand Thakur", "link": "https://stackoverflow.com/users/5857149/anand-thakur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 35085415, "answer_count": 1, "score": 0, "last_activity_date": 1454073047, "creation_date": 1454071584, "last_edit_date": 1454071766, "question_id": 35084919, "link": "https://stackoverflow.com/questions/35084919/go-http-request-detecting-post-as-get", "title": "Go http Request detecting POST as GET", "body": "<p>I am very new to Go, infact started today. But have run into a weird and frustrating problem. Simply put, the following code prints <code>r.Method</code> as GET when I make a POST request via POSTMAN.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"routes\"\n)\n\nfunc cartHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Printf(r.Method);\n    if r.Method == \"GET\" {\n        cart.GetHandler(w,r)\n    } else if r.Method == \"POST\" {\n        cart.PostHandler(w,r)\n    }\n    //fmt.Fprintf(w, \"Hi there, I love %s!\", r.Method)\n}\n\nfunc main() {\n    http.HandleFunc(\"/cart/\", cartHandler)\n    http.ListenAndServe(\":8010\", nil)\n}\n</code></pre>\n\n<p>The request being made is fine because a similar piece of code in nodejs detects it as a POST request.</p>\n"}, {"tags": ["go", "concurrency", "synchronization", "mutex", "goroutine"], "comments": [{"owner": {"reputation": 3099, "user_id": 1595320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7394f8a600a66b2dfaf6613fd32f8fc?s=128&d=identicon&r=PG", "display_name": "Riscie", "link": "https://stackoverflow.com/users/1595320/riscie"}, "edited": false, "score": 4, "creation_date": 1454071790, "post_id": 35084268, "comment_id": 57891468, "body": "Just from playing around with your code and running it with <code>go run --race</code> it seems like there is no mutex needed for exclusiveCounter. Also if I understand structs right, they are just holding references to their values, so you are actually accessing sharedCounter and exclusiveCounter directly.  I would however also like to hear from more experinced go programmers if these assumptions are true."}], "answers": [{"tags": [], "owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "is_accepted": true, "score": 4, "last_activity_date": 1454073018, "creation_date": 1454073018, "answer_id": 35085405, "question_id": 35084268, "link": "https://stackoverflow.com/questions/35084268/within-golang-struct-shared-among-multiple-goroutines-do-non-shared-members-nee/35085405#35085405", "title": "Within Golang struct shared among multiple goroutines, do non-shared members need mutex protection?", "body": "<p>If only a single goroutine accesses the struct member, you don't need to have a mutex to control access. I would, probably, use one anyway (either re-use the existing mutex in the struct, or another one), on the basis that while there may only be one goroutine accessing that struct member today, there's nothing enforce that.</p>\n"}, {"comments": [{"owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "edited": false, "score": 0, "creation_date": 1454330631, "post_id": 35094402, "comment_id": 57981274, "body": "I know I don&#39;t need another mutex for the exclusiveCounter member. My doubt is, does it need any kind of protection at all, since it is accessed by a single goroutine?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "edited": false, "score": 1, "creation_date": 1454365883, "post_id": 35094402, "comment_id": 58003758, "body": "@Everton nope, it&#39;s safe to use, also always use the <a href=\"http://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">-race</a> when in doubt."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 2, "last_activity_date": 1454103104, "creation_date": 1454103104, "answer_id": 35094402, "question_id": 35084268, "link": "https://stackoverflow.com/questions/35084268/within-golang-struct-shared-among-multiple-goroutines-do-non-shared-members-nee/35094402#35094402", "title": "Within Golang struct shared among multiple goroutines, do non-shared members need mutex protection?", "body": "<p>You do not need another mutex for it, also if you're just operating on int* types, you can ditch the mutex all together and use <a href=\"https://golang.org/pkg/sync/atomic/#StoreInt64\" rel=\"nofollow\"><code>atomic.*</code></a></p>\n\n<pre><code>type shared struct {\n    sharedCounter    int64 // member shared between multiple goroutines, protected by mutex\n    exclusiveCounter int64 // member exclusive of one goroutine -- is mutex needed?\n}\n\nfunc (s *shared) readCounter() int64 {\n    return atomic.LoadInt64(&amp;s.sharedCounter)\n}\n\nfunc (s *shared) setCounter(i int64) {\n    atomic.StoreInt64(&amp;s.sharedCounter, i)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/bd-Fefw12A\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}], "owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4968, "favorite_count": 2, "accepted_answer_id": 35085405, "answer_count": 2, "score": 6, "last_activity_date": 1454103104, "creation_date": 1454069430, "question_id": 35084268, "link": "https://stackoverflow.com/questions/35084268/within-golang-struct-shared-among-multiple-goroutines-do-non-shared-members-nee", "title": "Within Golang struct shared among multiple goroutines, do non-shared members need mutex protection?", "body": "<p>I have one Golang struct shared among multiple goroutines.\nFor concurrent access to struct members, there is the mutex sync.RWMutex.\nFor struct member that is accessed by one single goroutine, is there need of mutex protection?</p>\n\n<p>For example, in the code below, one single writer goroutine accesses the member shared.exclusiveCounter, without any lock protection. Is this correct/safe? Or is there need of mutex because the whole struct is accessed by multiple goroutines thru a shared pointer?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    s := &amp;shared{mutex: &amp;sync.RWMutex{}}\n\n    readerDone := make(chan int)\n    writerDone := make(chan int)\n\n    go reader(s, readerDone)\n    go writer(s, writerDone)\n\n    &lt;-readerDone\n    &lt;-writerDone\n}\n\ntype shared struct {\n    mutex            *sync.RWMutex\n    sharedCounter    int // member shared between multiple goroutines, protected by mutex\n    exclusiveCounter int // member exclusive of one goroutine -- is mutex needed?\n}\n\nfunc (s *shared) readCounter() int {\n    defer s.mutex.RUnlock()\n    s.mutex.RLock()\n    return s.sharedCounter\n}\n\nfunc (s *shared) setCounter(i int) {\n    defer s.mutex.Unlock()\n    s.mutex.Lock()\n    s.sharedCounter = i\n}\n\nfunc reader(s *shared, done chan&lt;- int) {\n    for {\n        time.Sleep(2 * time.Second)\n        counter := s.readCounter()\n        fmt.Printf(\"reader: read counter=%d\\n\", counter)\n        if counter &gt; 5 {\n            break\n        }\n    }\n    fmt.Printf(\"reader: exiting\\n\")\n    done &lt;- 1\n}\n\nfunc writer(s *shared, done chan&lt;- int) {\n    s.exclusiveCounter = 0\n    for {\n        time.Sleep(1 * time.Second)\n        s.exclusiveCounter++\n        fmt.Printf(\"writer: writing counter=%d\\n\", s.exclusiveCounter)\n        s.setCounter(s.exclusiveCounter)\n        if s.exclusiveCounter &gt; 5 {\n            break\n        }\n    }\n    fmt.Printf(\"writer: exiting\\n\")\n    done &lt;- 1\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/gzOsuYOAKm\" rel=\"noreferrer\" title=\"Run it on playground\">Run it on playground</a></p>\n"}, {"tags": ["c++", "qt", "go", "multipartform-data"], "answers": [{"comments": [{"owner": {"reputation": 229, "user_id": 2593209, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/CybVs.jpg?s=128&g=1", "display_name": "calmandniceperson", "link": "https://stackoverflow.com/users/2593209/calmandniceperson"}, "edited": false, "score": 0, "creation_date": 1454082584, "post_id": 35085772, "comment_id": 57898967, "body": "I don&#39;t know what to say. This actually worked. I just added the file name and did nothing else and now it works. Thank you very much!"}], "tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 1, "last_activity_date": 1454074139, "creation_date": 1454074139, "answer_id": 35085772, "question_id": 35083636, "link": "https://stackoverflow.com/questions/35083636/go-http-no-such-file-after-sending-image-from-qt-client/35085772#35085772", "title": "Go http: no such file after sending image from Qt client", "body": "<p>I'm not sure but you can try to change</p>\n\n<pre><code>image_part.setHeader(QNetworkRequest::ContentDispositionHeader,  QVariant(\"form-data; name=\\\"image\\\"\"));\n</code></pre>\n\n<p>to something like</p>\n\n<pre><code>image_part.setHeader(QNetworkRequest::ContentDispositionHeader,  QVariant(\"form-data; name=\\\"image\\\"; filename=\\\"Screenshot.png\\\"\"));\n</code></pre>\n"}], "owner": {"reputation": 229, "user_id": 2593209, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/CybVs.jpg?s=128&g=1", "display_name": "calmandniceperson", "link": "https://stackoverflow.com/users/2593209/calmandniceperson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 564, "favorite_count": 0, "accepted_answer_id": 35085772, "answer_count": 1, "score": 1, "last_activity_date": 1454074139, "creation_date": 1454067592, "question_id": 35083636, "link": "https://stackoverflow.com/questions/35083636/go-http-no-such-file-after-sending-image-from-qt-client", "title": "Go http: no such file after sending image from Qt client", "body": "<p>I have a Go API that should save an image sent by a client. I know that the Go code works when the POST request comes from a HTML form. \nWhen sending a multipart post request from my Qt C++ client though, the server returns an error</p>\n\n<blockquote>\n  <p>http: no such file</p>\n</blockquote>\n\n<p>On the client side I have a QPixmap, which I transform to a QByteArray, which I then send, but somehow I get that error from Go. I know that the length of the data sent by the client decreases when I remove </p>\n\n<pre><code>multi_part-&gt;append(image_part);\n</code></pre>\n\n<p>so the QPixmap should be sent.</p>\n\n<p>Go code:</p>\n\n<pre><code>func apiUploadHandler(w http.ResponseWriter, req *http.Request) {\nif req.Method == \"POST\" {\n    req.ParseMultipartForm(0)\n    fmt.Printf(\"%v %v %v\", req.RemoteAddr, req.ContentLength, req.Body)\n    file, fileheader, err := req.FormFile(\"image\")\n    if err != nil {\n        cio.PrintMessage(1, err.Error())\n        return\n    }\n    defer file.Close()\n    var id string\n    created := false\n    for created != true {\n        id = generateImageID()\n        err = db.CheckIfImageIDInUse(id)\n        if err != nil {\n            if err.Error() == \"Image ID '\"+id+\"' exists.'\" {\n                created = false\n                continue\n            } else {\n                created = false\n                cio.PrintMessage(1, err.Error())\n                return\n            }\n        }\n        created = true\n    }\n    filePath := fsys.ImgStoragePath + id + \".\" + strings.Split(fileheader.Filename, \".\")[1]\n    err = db.StoreImage(id, strings.Split(fileheader.Filename, \".\")[0] /*image name*/, filePath, strings.Split(fileheader.Filename, \".\")[1] /*extension*/)\n    if err != nil {\n        cio.PrintMessage(1, err.Error())\n        return\n    }\n    bytesCopied, err := fsys.StoreImage(filePath, file)\n    if err != nil {\n        cio.PrintMessage(1, err.Error())\n        return\n    }\n    cio.PrintMessage(0, \"File \"+filePath+\" has been created.\")\n    if err != nil {\n        cio.PrintMessage(1, err.Error())\n        return\n    }\n    cio.PrintMessage(0, \"Content of uploaded image (\"+strconv.FormatInt(bytesCopied, 10)+\" Bytes) has been copied to \"+filePath+\".\")\n    http.Redirect(w, req, \"/\"+id, http.StatusFound)\n}\n\n}\n</code></pre>\n\n<p>Qt C++ client code:</p>\n\n<pre><code>void Share::upload(const QByteArray &amp;data) {\n    QHttpMultiPart *multi_part = new          QHttpMultiPart(QHttpMultiPart::FormDataType);\n    QHttpPart text_part;\n    text_part.setHeader(QNetworkRequest::ContentDispositionHeader,   QVariant(\"form-data; name=\\\"text\\\"\\\"\"));\n    text_part.setBody(\"Screenshot.png\");\n    QHttpPart image_part;\n    image_part.setHeader(QNetworkRequest::ContentTypeHeader, QVariant(\"image/png\"));\n    image_part.setHeader(QNetworkRequest::ContentDispositionHeader,  QVariant(\"form-data; name=\\\"image\\\"\"));\n    image_part.setBody(data);\n    multi_part-&gt;append(text_part);\n    multi_part-&gt;append(image_part);\n    QNetworkRequest request(QUrl(\"http://localhost:8000/api/upload\"));\n    QNetworkAccessManager *manager = new QNetworkAccessManager();\n    connect(manager, SIGNAL(finished(QNetworkReply *)), this,    SLOT(reply_finished(QNetworkReply *)));\n    manager-&gt;post(request, multi_part);\n    qDebug() &lt;&lt; QString(data);\n}\n</code></pre>\n"}, {"tags": ["mongodb", "cookies", "go", "bson"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 3, "creation_date": 1454077592, "post_id": 35082618, "comment_id": 57895331, "body": "<code>http.Cookie</code> and your <code>Cookie</code> type are not the same. A <code>http.Cookie</code> has no field <code>Id</code>."}, {"owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1454170866, "post_id": 35082618, "comment_id": 57928966, "body": "@thwd What should I do? Can you please suggest me a solution. I need to store the Id in the cookie."}], "answers": [{"tags": [], "owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "is_accepted": true, "score": 0, "last_activity_date": 1454911799, "creation_date": 1454911799, "answer_id": 35263355, "question_id": 35082618, "link": "https://stackoverflow.com/questions/35082618/how-to-assign-bson-id-to-a-cookie-go-mongodb/35263355#35263355", "title": "How to assign BSON _Id to a cookie (Go, Mongodb)", "body": "<p>Here is a solution for this problem. </p>\n\n<p>Cookie struct below:</p>\n\n<pre><code>type Cookie struct {    \n    Name       string\n    Value      string\n    Path       string\n    Domain     string\n    Expires    time.Time\n    RawExpires string\n    MaxAge   int\n    Secure   bool\n    HttpOnly bool\n    Raw      string\n    Unparsed []string\n}\n</code></pre>\n\n<p>Cookie Creation</p>\n\n<pre><code> value := map[string]string{\n        \"id\": cookieId,\n    }\n    if encoded, err := ckieHandler.Encode(\"session\", value); err == nil {\n        cookie := &amp;http.Cookie{\n        Name:  \"session\",\n        Value: encoded,\n        Path:  \"/\",\n        }\n        http.SetCookie(response, cookie)\n    }\n</code></pre>\n\n<p>Cookie Call</p>\n\n<pre><code>if cookie, err := request.Cookie(\"session\"); err == nil {\n        cookieValue := make(map[string]string)\n        if err = ckieHandler.Decode(\"session\", cookie.Value, &amp;cookieValue); err == nil {\n            id = cookieValue[\"id\"] // **Pass BSON ID here**\n        }\n    }\n</code></pre>\n\n<p>For more details <a href=\"https://mschoebel.info/2014/03/09/snippet-golang-webapp-login-logout/\" rel=\"nofollow\">Click Here</a>. This link helped me a lot. Hoping someone will find this answer useful.</p>\n"}], "owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 35263355, "answer_count": 1, "score": 0, "last_activity_date": 1454911799, "creation_date": 1454064600, "last_edit_date": 1454077445, "question_id": 35082618, "link": "https://stackoverflow.com/questions/35082618/how-to-assign-bson-id-to-a-cookie-go-mongodb", "title": "How to assign BSON _Id to a cookie (Go, Mongodb)", "body": "<p>I was trying to create a go cookie. I want to assign Id from Mongodb to be stored in the Cookie. But while compiling I am getting an error as follows:-</p>\n\n<p>\"unknown http.Cookie field 'Id' in struct literal\"</p>\n\n<p>The following is my code:-</p>\n\n<pre><code>getUser := user.CheckDB()\nexpiration := time.Now().Add(365 * 24 * time.Hour)\n\n//The Error is Caused by the Next Line\ncookie := http.Cookie{Id: getUser[0].Id, Name: getUser[0].Email, Value: getUser[0].Password, Expires: expiration}\nhttp.SetCookie(w, &amp;cookie)\n\n\n\nfunc (this *User) CheckDB() []User {\n    var results []User\n    sess, db := GetDatabase()\n    defer sess.Close()\n    c := db.C(\"user\")\n    uname := &amp;this.Email\n    err := c.Find(bson.M{\"email\": *uname}).Sort(\"-id\").All(&amp;results)\n    if err != nil {\n        panic(err)\n    } else {\n        fmt.Println(\"Results All: \", results)\n        return results\n    }\n}\n\ntype Cookie struct {\n    Id         bson.ObjectId `bson:\"_id,omitempty\"`\n    Name       string\n    Value      string\n    Path       string\n    Domain     string\n    Expires    time.Time\n    RawExpires string\n    MaxAge     int\n    Secure     bool\n    HttpOnly   bool\n    Raw        string\n    Unparsed   []string\n}\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454075202, "post_id": 35081627, "comment_id": 57893691, "body": "This is isn&#39;t an error handling problem, it&#39;s a documentation problem. An unexpected error type is no different than an unexpected exception type bubbling up, except in the former case you know you&#39;re getting <i>something</i>."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454077649, "post_id": 35081627, "comment_id": 57895386, "body": "I know that it&#39;s a problem with documentation. The real problem is that golang supplied packages has that problem and because of that most of third-party packages inherently has that problem. If I want to take different actions depending on error type most of the time I have to go through the source code. And in some cases I find code like <code>errors.New()</code> which is just useless exactly like <code>new Exception()</code> is useless. And that&#39;s what bothering me - golang documentation doesn&#39;t suggest that it&#39;s a good thing to document returned errors. That&#39;s not the case with exception-based languages"}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1454078478, "post_id": 35081627, "comment_id": 57895974, "body": "But there is also a error handling problem. <code>error</code> interface hides what kind of error it is. And because errors in Go has to be explicitly handled (because they&#39;re ignored by default and not enforced by any means) you don&#39;t know the type and value until you print it. In contrast with exceptions where program will crash and display you nice crash report. And that&#39;s exactly what we are seeing here - some error popped up, just printing it is useless. Don&#39;t get me wrong, I like Go very much but not it&#39;s C-like error handling. At least we can do this <a href=\"https://github.com/facebookgo/stackerr\" rel=\"nofollow noreferrer\">github.com/facebookgo/stackerr</a>"}], "tags": [], "owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "is_accepted": false, "score": -1, "last_activity_date": 1454061674, "creation_date": 1454061674, "answer_id": 35081627, "question_id": 35081310, "link": "https://stackoverflow.com/questions/35081310/how-can-i-distinguish-connection-error-with-other-errors-when-using-go-sql-drive/35081627#35081627", "title": "how can i distinguish connection error with other errors when using go-sql-driver", "body": "<p>That's where go's error handling is really bothering me. Most of the time actual error types are not documented so you have to go through the source and check which errors the code can return. And in some cases those are just generic string errors because the code is platform specific and, thus, errors are also platform specific.</p>\n\n<p>You can do that, check the source code, or you can print the error type to know exactly which one it is.</p>\n\n<pre><code>log.Printf(\"%T\", err)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 1, "last_activity_date": 1454075508, "creation_date": 1454075508, "answer_id": 35086216, "question_id": 35081310, "link": "https://stackoverflow.com/questions/35081310/how-can-i-distinguish-connection-error-with-other-errors-when-using-go-sql-drive/35086216#35086216", "title": "how can i distinguish connection error with other errors when using go-sql-driver", "body": "<p>Network errors will be of a type that satisfies the <code>net.Error</code> interface. </p>\n\n<pre><code>if err, ok := err.(net.Error); ok {\n    log.Println(\"network error:\", err)\n} else {\n    log.Println(\"other error:\", err)\n}\n</code></pre>\n\n<p>In most cases it won't really matter, because the action failed for <em>some</em> reason, and you need to handle it regardless. It's only if you want to take a different action based on a network error that you really need to check. </p>\n"}], "owner": {"reputation": 49, "user_id": 5797406, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rO76N.jpg?s=128&g=1", "display_name": "rench", "link": "https://stackoverflow.com/users/5797406/rench"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 572, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1454075508, "creation_date": 1454060720, "question_id": 35081310, "link": "https://stackoverflow.com/questions/35081310/how-can-i-distinguish-connection-error-with-other-errors-when-using-go-sql-drive", "title": "how can i distinguish connection error with other errors when using go-sql-driver", "body": "<pre><code>func mainloop(db *sql.DB) {\n        type pushTask struct {\n            TaskId string\n            Uri    string\n        }\n\n        stmt, err := db.Prepare(\"INSERT INTO ErrPushCache(TaskId, Uri) VALUES(?, ?)\")\n        if err != nil {\n            log.Fatal(\"db.Prepare Failed \", err)\n        }\n\n        var (\n            mysqlOk bool = true\n            task    pushTask\n        )\n        for {\n            task.TaskId = RandStringRunes(8)\n            task.Uri = RandStringRunes(16)\n\n            res, err := stmt.Exec(task.TaskId, task.Uri)\n            if err != nil {\n                if err == driver.ErrBadConn {\n                    if mysqlOk {\n                        log.Print(\"Connection with mysql seems down, %s\", err.Error())\n                        mysqlOk = false\n                        os.Exit(1)\n                    }\n                } else {\n                    log.Print(\"Exec failed \", err)\n                }\n\n                time.Sleep(2 * time.Second)\n                continue\n            }\n            if !mysqlOk {\n                log.Print(\"Connection with mysql is ok now\")\n                mysqlOk = true\n            }\n            lastId, err := res.LastInsertId()\n            if err != nil {\n                log.Print(\"LastInsertId failed \", err)\n            }\n            rowCnt, err := res.RowsAffected()\n            if err != nil {\n                log.Print(\"RowsAffected failed \", err)\n            }\n            log.Printf(\"ID = %d, affected = %d\\n\", lastId, rowCnt)\n\n            time.Sleep(20 * time.Second)\n        }\n    }\n\n    func main() {\n        db, err := sql.Open(\"mysql\",\n            \"rench:ren123@tcp(192.168.1.61:3306)/hunanTV\")\n        if err != nil {\n            log.Fatal(\"sql.Open Failed \", err)\n        }\n\n        mainloop(db)\n\n        defer db.Close()\n    }\n</code></pre>\n\n<p>in the mainloop function, if the connection between mysql and client is broken,stmt.Exec will be failed, it will return a error, how can i distinguish connection error with other errors.(err == driver.ErrBadConn is always false).</p>\n\n<p>if the connection is broken, the log is :</p>\n\n<p>2016/01/29 17:21:31 Exec failed dial tcp 192.168.1.61:3306: getsockopt: connection refused\n2016/01/29 17:21:33 Exec failed dial tcp 192.168.1.61:3306: getsockopt: connection refused\n2016/01/29 17:21:35 Exec failed dial tcp 192.168.1.61:3306: getsockopt: connection refused\n2016/01/29 17:21:37 Exec failed dial tcp 192.168.1.61:3306: getsockopt: connection refused\n2016/01/29 17:21:39 Exec failed dial tcp 192.168.1.61:3306: getsockopt: connection refused</p>\n\n<p>...</p>\n"}, {"tags": ["file", "go", "readfile"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1454059047, "last_edit_date": 1454059047, "creation_date": 1454056997, "answer_id": 35080193, "question_id": 35080109, "link": "https://stackoverflow.com/questions/35080109/golang-how-to-read-input-filename-in-go/35080193#35080193", "title": "Golang How to read input filename in Go", "body": "<p>Please take a look at the package documentation of <a href=\"https://golang.org/pkg/io/ioutil/\" rel=\"noreferrer\"><code>io/ioutil</code></a> which you are already using.</p>\n\n<p>It has a function exactly for this: <a href=\"https://golang.org/pkg/io/ioutil/#ReadFile\" rel=\"noreferrer\"><code>ReadFile()</code></a></p>\n\n<pre><code>func ReadFile(filename string) ([]byte, error)\n</code></pre>\n\n<p>Example usage:</p>\n\n<pre><code>func main() {\n    // First element in os.Args is always the program name,\n    // So we need at least 2 arguments to have a file name argument.\n    if len(os.Args) &lt; 2 {\n        fmt.Println(\"Missing parameter, provide file name!\")\n        return\n    }\n    data, err := ioutil.ReadFile(os.Args[1])\n    if err != nil {\n        fmt.Println(\"Can't read file:\", os.Args[1])\n        panic(err)\n    }\n    // data is the file content, you can use it\n    fmt.Println(\"File content is:\")\n    fmt.Println(string(data))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 1, "last_activity_date": 1454057879, "creation_date": 1454057879, "answer_id": 35080451, "question_id": 35080109, "link": "https://stackoverflow.com/questions/35080109/golang-how-to-read-input-filename-in-go/35080451#35080451", "title": "Golang How to read input filename in Go", "body": "<p>Firs you check for the provided argument. If the first argument satisfy the condition of an input file, then you use the <code>ioutil.ReadFile</code> method, providing parameter the <code>os.Args</code> result.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    if len(os.Args) &lt; 1 {\n        fmt.Println(\"Usage : \" + os.Args[0] + \" file name\")\n        os.Exit(1)\n    }\n\n    file, err := ioutil.ReadFile(os.Args[1])\n    if err != nil {\n        fmt.Println(\"Cannot read the file\")\n        os.Exit(1)\n    }\n    // do something with the file\n    fmt.Print(string(file))\n}\n</code></pre>\n\n<p>Another possibility is to use:</p>\n\n<pre><code>f, err := os.Open(os.Args[0])\n</code></pre>\n\n<p>but for this you need to provide the bytes lenght to read:</p>\n\n<pre><code>b := make([]byte, 5) // 5 is the length\nn, err := f.Read(b)\nfmt.Printf(\"%d bytes: %s\\n\", n, string(b))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6326149, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cx3G6.jpg?s=128&g=1", "display_name": "Elshan Abdullayev", "link": "https://stackoverflow.com/users/6326149/elshan-abdullayev"}, "is_accepted": false, "score": 0, "last_activity_date": 1518266976, "last_edit_date": 1518266976, "creation_date": 1518266052, "answer_id": 48720819, "question_id": 35080109, "link": "https://stackoverflow.com/questions/35080109/golang-how-to-read-input-filename-in-go/48720819#48720819", "title": "Golang How to read input filename in Go", "body": "<p>For running .go file from command-line by input parameter like file (for example abc.txt).We need use mainly  <strong>os, io/ioutil, fmt</strong>  packages. Additionally for reading command line parameters we use\n<strong>os.Args</strong> Here is example code </p>\n\n<pre><code>package main\n import (\n  \"fmt\"\n  \"os\"\n  \"io/ioutil\"\n)\nfunc main()  {\nfmt.Println(\" Hi guys  ('-') \")\ninput_files := os.Args[1:]\n//input_files2 := os.Args[0];\n//fmt.Println(\"if2 : \",input_files2)\nif len(input_files) &lt; 1{\nfmt.Println(\"Not detected files.\")\n}else{\nfmt.Println(\"File_name is : \",input_files[0])\ncontent, err := ioutil.ReadFile(input_files[0])\nif err != nil {\nfmt.Println(\"Can't read file :\", input_files[0],\"Error : \",err)\n}else {\nfmt.Println(\"Output file content is(like string type) : \\n\",string(content))//string Output\nfmt.Println(\"Output file content is(like byte type) : \\n\",content)//bytes Output\n}\n}\n}\n</code></pre>\n\n<p>Args holds command line arguments, including the command as Args[0].\nIf the Args field is empty or nil, Run uses {Path}.\nIn typical use, both Path and Args are set by calling Command.\nArgs []string\nfunction. This function return back array on string type <a href=\"https://golang.org/pkg/io/ioutil/#ReadFile\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/exec/</a>.Args hold the command-line arguments, starting with the program name. In this case short way to take filename from command-line is this functions <strong>os.Args[1:]</strong> . And  here is output </p>\n\n<pre><code>elshan_abd$ go run main.go abc.txt\nHi guys  ('-')\nFile_name is :  abc.txt\nOutput file content is(like string type) : \naaa\nbbb\nccc\n1234\nOutput file content is(like byte type) : \n[97 97 97 10 98 98 98 10 99 99 99 10 49 50 51 52 10] \n</code></pre>\n\n<p>Finally we need for reading content file this function \n<code>func ReadFile(filename string) ([]byte, error)</code>  source is  <a href=\"https://golang.org/pkg/io/ioutil/#ReadFile\" rel=\"nofollow noreferrer\">https://golang.org/pkg/io/ioutil/#ReadFile</a> </p>\n"}], "owner": {"reputation": 559, "user_id": 5856131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1a2d1dfeeae0dadd9f495b3b3f11b26?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/5856131/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8835, "favorite_count": 0, "accepted_answer_id": 35080193, "answer_count": 3, "score": 11, "last_activity_date": 1518266976, "creation_date": 1454056680, "last_edit_date": 1454059341, "question_id": 35080109, "link": "https://stackoverflow.com/questions/35080109/golang-how-to-read-input-filename-in-go", "title": "Golang How to read input filename in Go", "body": "<p>I would like to run my go file on my <code>input.txt</code> where my go program will read the <code>input.txt</code> file when I type in go run command ie: </p>\n\n<pre><code>go run goFile.go input.txt\n</code></pre>\n\n<p>I don't want to put <code>input.txt</code> in my <code>goFile.go</code> code since my go file should run on any input name not just <code>input.txt</code>.</p>\n\n<p>I try <code>ioutil.ReadAll(os.Stdin)</code> but I need to change my command to</p>\n\n<pre><code>go run goFile.go &lt; input.txt\n</code></pre>\n\n<p>I only use package <code>fmt</code>, <code>os</code>, <code>bufio</code> and <code>io/ioutil</code>. Is it possible to do it without any other packages?</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 509, "user_id": 5855483, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-DY7shgLgls8/AAAAAAAAAAI/AAAAAAAAABo/T2Z_XtPcG6c/photo.jpg?sz=128", "display_name": "Rui Yang", "link": "https://stackoverflow.com/users/5855483/rui-yang"}, "edited": false, "score": 0, "creation_date": 1454084944, "post_id": 35078143, "comment_id": 57900623, "body": "I found that this issue only exhibit when my go project is setup with multiple sub directory with different package name. If everything in the same folder and all test file using same package name, it works. Has anyone tried to make TestMain works for multiple package case? I need to be able to run the test using go test ./..."}, {"owner": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "edited": false, "score": 0, "creation_date": 1455213202, "post_id": 35078143, "comment_id": 58400154, "body": "The only time I&#39;ve seen anything similar to that was when the goapp was having trouble starting a new dev_appserver.py instance."}], "answers": [{"comments": [{"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 0, "creation_date": 1522678547, "post_id": 39608061, "comment_id": 86232377, "body": "This is the correct answer - os.Exit does not &quot;respect&quot; defer."}], "tags": [], "owner": {"reputation": 29797, "user_id": 112, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8cff214f16c7c8e73244a8ed8dea7e0e?s=128&d=identicon&r=PG", "display_name": "Jesse Beder", "link": "https://stackoverflow.com/users/112/jesse-beder"}, "is_accepted": true, "score": 1, "last_activity_date": 1474434954, "creation_date": 1474434954, "answer_id": 39608061, "question_id": 35078143, "link": "https://stackoverflow.com/questions/35078143/how-to-use-testmain-with-global-aetest-newinstance/39608061#39608061", "title": "how to use TestMain with global aetest.NewInstance", "body": "<p>You're calling <code>defer tearDown()</code> and then <code>os.Exit(code)</code>, which calls <code>tearDown</code> <em>after</em> <code>os.Exit</code> (i.e., never). You need to either explicitly call <code>tearDown</code> before <code>os.Exit</code>, or make a new function that you defer from that <em>doesn't</em> call <code>os.Exit</code>.</p>\n"}], "owner": {"reputation": 509, "user_id": 5855483, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-DY7shgLgls8/AAAAAAAAAAI/AAAAAAAAABo/T2Z_XtPcG6c/photo.jpg?sz=128", "display_name": "Rui Yang", "link": "https://stackoverflow.com/users/5855483/rui-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 39608061, "answer_count": 1, "score": 3, "last_activity_date": 1474434954, "creation_date": 1454048576, "question_id": 35078143, "link": "https://stackoverflow.com/questions/35078143/how-to-use-testmain-with-global-aetest-newinstance", "title": "how to use TestMain with global aetest.NewInstance", "body": "<p>I am using\n    \"google.golang.org/appengine/aetest\"\npackage and setup my TestMain like this:</p>\n\n<pre><code>var myAeInst aetest.Instance\n\n\nfunc TestMain(m *testing.M) {\n    var err error\n    myAeInst, err = aetest.NewInstance(&amp;aetest.Options{StronglyConsistentDatastore: true})\n    defer tearDown()\n\n    c := m.Run()\n\n    os.Exit(code)\n}\n\nfunc tearDown() {\n    if myAeInst != nil {\n        myAeInst.Close()\n    }\n}\n</code></pre>\n\n<p>But it stuck at aetest.NewInstance, any one encounter similar issue?</p>\n"}, {"tags": ["shell", "go", "exec"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1454332767, "post_id": 35077757, "comment_id": 57982719, "body": "Have you tried calling <a href=\"https://golang.org/pkg/os/#File.Sync\" rel=\"nofollow noreferrer\"><code>Sync</code></a> after running but before closing the file?"}, {"owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1454338787, "post_id": 35077757, "comment_id": 57987098, "body": "@Ainar-G I tried it now, and it does not seem to have an effect."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1454339099, "post_id": 35077757, "comment_id": 57987324, "body": "And <code>Sync</code> doesn&#39;t return any errors either? If you set a <code>bytes.Buffer</code> as stdout, and then print the buffer&#39;s contents after running, is it empty as well?"}, {"owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1454340983, "post_id": 35077757, "comment_id": 57988655, "body": "No error from <code>Sync</code>. If I set <code>bytes.Buffer</code> as stdout, it&#39;s still empty the majority of the time, yes. One out of 20 or 30 times it has something, but this is also the case when writing to file (without the timeout--with the timeout it always writes it, but I&#39;m not sure if it would continue if the script were to take more than 500ms to execute, or if the output would always be complete)"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1454341697, "post_id": 35077757, "comment_id": 57989111, "body": "Then I don&#39;t have any other guesses besides checking the error returned by <code>cmd.Wait</code> and trying to do the same in e.g. Python to see if the issue is Go-specific. Sorry."}, {"owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1454341946, "post_id": 35077757, "comment_id": 57989305, "body": "@Ainar-G Thanks! Trying the same thing in Python is a good idea - so far I&#39;ve only tested that it works consistently from the shell (it does). That should shed some light on what&#39;s going on."}], "answers": [{"comments": [{"owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "edited": false, "score": 0, "creation_date": 1454053768, "post_id": 35078356, "comment_id": 57880645, "body": "If I run your example as is, it reports <code>exec: already started</code> (<code>cmd.Output()</code> runs the command, a second <code>cmd.Run()</code> is not necessary). Even so, after removing the <code>cmd.Run()</code> part, with the <code>echo</code> command it writes the arguments to file, but with the <code>snt2cooc</code> command there is no output in the file. So it still seems to me like it does indeed have something to do <code>snt2cooc</code> command itself."}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "reply_to_user": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "edited": false, "score": 0, "creation_date": 1454054570, "post_id": 35078356, "comment_id": 57881063, "body": "You&#39;re right thanks for correcting. Have you tried using <code>cmd.Start()</code> with <code>cmd.Wait()</code>  before writing to the file?"}, {"owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "edited": false, "score": 0, "creation_date": 1454072425, "post_id": 35078356, "comment_id": 57891900, "body": "Yeah, I just tried using <code>cmd.Start()</code> and then <code>cmd.Wait()</code>, but no luck. It seems like <code>snt2cooc</code> is writing to stdout in a different thread from the main thread, maybe?"}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "reply_to_user": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "edited": false, "score": 0, "creation_date": 1454294016, "post_id": 35078356, "comment_id": 57964953, "body": "Try debugging the race condition? <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">golang.org/doc/articles/race_detector.html</a>"}, {"owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "edited": false, "score": 0, "creation_date": 1454305648, "post_id": 35078356, "comment_id": 57967820, "body": "Good idea, but unfortunately the race detector doesn&#39;t pick up anything. I have meanwhile confirmed that using <code>stdout, err := cmd.StdoutPipe()</code> and adding <code>time.Sleep(500 * time.Millisecond)</code> after that line consistently writes output to the file. The question is just whether this will still work if the command takes longer than 500ms to run..."}], "tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": -1, "last_activity_date": 1454054324, "last_edit_date": 1454054324, "creation_date": 1454049573, "answer_id": 35078356, "question_id": 35077757, "link": "https://stackoverflow.com/questions/35077757/failure-to-write-output-of-shell-command-to-file-in-go/35078356#35078356", "title": "Failure to write output of shell command to file in Go", "body": "<p>The problem isn't with the innard of <code>SNTtoCooc</code> but how you write to the file itself using <code>cmd.Stdout</code>:</p>\n\n<pre><code>func anyWrite(args []string, outpath string) error {\n        outfile, err := os.Create(outpath)\n        if err != nil {\n                return err\n        }\n\n        defer outfile.Close()\n\n        // I use simple \"echo\" here\n        cmd := exec.Command(\"echo\", args...)\n        stdout, err := cmd.Output()\n        if err != nil {\n                return err\n        }\n\n        // Use this instead of cmd.Stdout seems to solve the problem\n        outfile.Write(stdout)\n\n        return nil\n}\n\nfunc main() {\n        args := []string{\"Line 1\", \"Line 2\", \"Line 3\"}\n        if err := anyWrite(args, \"./outfile.txt\"); err != nil {\n                panic(err) \n        }\n} \n</code></pre>\n\n<p>As per the <a href=\"https://golang.org/src/os/exec/exec.go?s=844:3484#L28\" rel=\"nofollow\">comments</a> in <code>os/exec</code> </p>\n\n<blockquote>\n  <p>Stdout and Stderr specify the process's standard output and error. If\n  either is nil, Run connects the corresponding file descriptor to the\n  null device (os.DevNull).</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "edited": false, "score": 2, "creation_date": 1454388966, "post_id": 35142787, "comment_id": 58010348, "body": "Thanks, this led me to discovering the real problem, which was in a function called before <code>SNTToCooc</code>--the one which generates <code>file3.snt</code>--I was using <code>cmd.Start()</code> there instead of <code>cmd.Run()</code>, so it wasn&#39;t finished before <code>snt2cooc</code> was called, and so <code>snt2cooc</code> was working with an empty input file. Of course, by the time I check from the shell, all the files (except snt2cooc&#39;s) have content, so that&#39;s why I didn&#39;t notice. My apologies for framing the question too narrowly to have been able to spot that, but thanks for your help!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1454372527, "last_edit_date": 1454372527, "creation_date": 1454371540, "answer_id": 35142787, "question_id": 35077757, "link": "https://stackoverflow.com/questions/35077757/failure-to-write-output-of-shell-command-to-file-in-go/35142787#35142787", "title": "Failure to write output of shell command to file in Go", "body": "<p>First, clean up your code.</p>\n\n<p><code>cmd.Stderr = os.DevNull</code>, so you ignore stderr. Stdout and Stderr specify the process's standard output and error. If either is nil, Run connects the corresponding file descriptor to the null device (os.DevNull).</p>\n\n<p><code>cmd.Wait()</code> returns <code>error,</code> you ignore it. <code>func (c *Cmd) Wait() error</code>.</p>\n\n<p><code>Wait</code> waits for the command to exit. It must have been started by <code>Start.</code> You use <code>Run,</code> not <code>Start.</code></p>\n\n<p>What output do you get when you run this code?</p>\n\n<p><code>failure.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    err := SNTToCOOC(\"file1.vcb\", \"file2.vcb\", \"file3.snt\", \"out.txt\")\n    if err != nil {\n        fmt.Println(err)\n    }\n}\n\nfunc SNTToCOOC(srcVocab, tgtVocab, sntPath, outpath string) error {\n    outfile, err := os.Create(outpath)\n    if err != nil {\n        return err\n    }\n    defer outfile.Close()\n    cmdStr := \"snt2cooc\"\n    args := []string{srcVocab, tgtVocab, sntPath}\n    cmd := exec.Command(cmdStr, args...)\n    cmd.Stdout = outfile\n    cmd.Stderr = os.Stderr\n    err = cmd.Run()\n    if err != nil {\n        return err\n    }\n    return err\n}\n</code></pre>\n\n<p>Run:</p>\n\n<pre><code>$ rm -f out.txt &amp;&amp; go run failure.go &amp;&amp; cat out.txt\n</code></pre>\n\n<p>Also, what output do you get when you run this code with <code>cmd.Stdout = os.Stdout</code> substituting for <code>cmd.Stdout = outfile</code>.</p>\n"}], "owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1073, "favorite_count": 2, "accepted_answer_id": 35142787, "answer_count": 2, "score": 3, "last_activity_date": 1454372527, "creation_date": 1454046606, "last_edit_date": 1454305950, "question_id": 35077757, "link": "https://stackoverflow.com/questions/35077757/failure-to-write-output-of-shell-command-to-file-in-go", "title": "Failure to write output of shell command to file in Go", "body": "<p>I have written the following function for executing the <code>snt2cooc</code> command (one of the preprocessing steps for running <a href=\"http://www.statmt.org/moses/giza/GIZA++.html\" rel=\"nofollow\">GIZA++</a>. For our purposes I think we can consider the <code>snt2cooc</code> script to be a black box):</p>\n\n<pre><code>func SNTToCOOC(srcVocab, tgtVocab, sntPath, outpath string) error {\n    // open the out file for writing\n    outfile, err := os.Create(outpath)\n    if err != nil {\n        return err\n    }\n    defer outfile.Close()\n\n    cmdStr := \"snt2cooc\"\n    args := []string{srcVocab, tgtVocab, sntPath}\n    cmd := exec.Command(cmdStr, args...)\n    cmd.Stdout = outfile\n    if err = cmd.Run(); err != nil {\n        return err\n    }\n    cmd.Wait()\n    return err\n}\n</code></pre>\n\n<p>When running, the function executes without an error, but the output file is empty. This same code works for other similar commands, but not for this specific <code>snt2cooc</code> command, and I noticed that when I run this command in the shell directly: </p>\n\n<p>snt2cooc file1.vcb file2.vcb file3.snt</p>\n\n<p>I get the following output:</p>\n\n<pre><code>END.\n0 2\n0 3\n0 4\n0 5\n0 6\n</code></pre>\n\n<p>(truncated for brevity)</p>\n\n<p>And if I send the output of the command to a file directly from the shell:</p>\n\n<pre><code>snt2cooc file1.vcb file2.vcb file3.snt &gt; out.txt\n</code></pre>\n\n<p>The contents of <code>out.txt</code> are as expected:</p>\n\n<pre><code>0 2\n0 3\n0 4\n0 5\n0 6\n</code></pre>\n\n<p>Notice how in the first case, the line <code>END.</code> is output to stdout first, and only then is the real output of the command sent to stdout. I therefore think there is a race condition going on, where the Go code finishes executing before the command's final output is written to file. This despite calling <code>cmd.Wait()</code>. I'm not too sure what exactly the <code>snt2cooc</code> command is doing internally. Could someone provide a hint on how to solve this?</p>\n\n<p><strong>Edit 1:</strong></p>\n\n<p>It seems like the following code, with the sleep of 500ms included, consistently writes output to the file for the <code>snt2cooc</code> command:</p>\n\n<pre><code>cmdStr := \"snt2cooc\"\nargs := []string{srcVocab, tgtVocab, sntPath}\ncmd := exec.Command(cmdStr, args...)\nstdout, err := cmd.StdoutPipe()\ntime.Sleep(500 * time.Millisecond)\nif err != nil {\n    return err\n}\nerr = cmd.Start()\nif err != nil {\n    return err\n}\n\nout := bufio.NewScanner(stdout)\nfor out.Scan() {\n    outfile.Write(out.Bytes())\n    outfile.WriteString(\"\\n\")\n}\nif err := out.Err(); err != nil {\n    return err\n}\n</code></pre>\n\n<p>This proves to me that there is some race condition going on, with the Go program exiting before all output is written to file. I added a bounty to this question, with the hope that someone can 1) explain why this is happening and 2) provide a non-hacky way (i.e. 500ms sleep) to fix it. </p>\n"}, {"tags": ["ruby-on-rails", "ruby", "go"], "comments": [{"owner": {"reputation": 5695, "user_id": 3003432, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/835081031b807fb7f1bc8eb683dd4626?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.D", "link": "https://stackoverflow.com/users/3003432/mr-d"}, "edited": false, "score": 0, "creation_date": 1454042410, "post_id": 35076977, "comment_id": 57876374, "body": "You must write Ruby Interpreter in Go language from scratch. Standard MRI is written on C/C++. jRuby is written on Java. It will take A LOT OF WORK for you to reinvent this in Go."}, {"owner": {"reputation": 7, "user_id": 5749574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BufBB.jpg?s=128&g=1", "display_name": "LoveDogzzZZ", "link": "https://stackoverflow.com/users/5749574/lovedogzzzz"}, "reply_to_user": {"reputation": 5695, "user_id": 3003432, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/835081031b807fb7f1bc8eb683dd4626?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.D", "link": "https://stackoverflow.com/users/3003432/mr-d"}, "edited": false, "score": 0, "creation_date": 1454042637, "post_id": 35076977, "comment_id": 57876451, "body": "@QQQ could I not run both languages simultaneously on my server? And create a sort of bridge to communicate between Go and Ruby?"}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "edited": false, "score": 0, "creation_date": 1454042685, "post_id": 35076977, "comment_id": 57876462, "body": "Alternatively, you could run a few Ruby subprocesses and communicate with them over inter-process communication (stdin/stdout, unix sockets, etc).  However, it sounds like what you really need is the reverse - a Ruby on Rails app which has the functionality to talk across an IPC channel to a Go process which does all of the low-level stuff. For example, want to call out to a Go function from Ruby? Write the arguments and a unique &quot;call ID&quot; to the channel, and then when the Go function returns, write the return values along with the same call ID so that Ruby knows which function just returned."}, {"owner": {"reputation": 20735, "user_id": 307106, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6a13e655e637138f8d571cec3f9cea76?s=128&d=identicon&r=PG", "display_name": "jrochkind", "link": "https://stackoverflow.com/users/307106/jrochkind"}, "edited": false, "score": 0, "creation_date": 1454043115, "post_id": 35076977, "comment_id": 57876573, "body": "no, you can&#39;t really do that. It took many many developer-hours to create JRuby. Nobody has yet created a GoRuby."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1454057217, "post_id": 35076977, "comment_id": 57882547, "body": "Have you actually tried to build a simple web app in Go? Examples, including step-by-step tutorials are ubiquitous in the internets. I&#39;d get some of them a go (pun intended)."}], "answers": [{"tags": [], "owner": {"reputation": 10490, "user_id": 513951, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6cace4406e1ea825e78ec0134a5ea6fd?s=128&d=identicon&r=PG&f=1", "display_name": "user513951", "link": "https://stackoverflow.com/users/513951/user513951"}, "is_accepted": true, "score": 4, "last_activity_date": 1454048068, "creation_date": 1454048068, "answer_id": 35078026, "question_id": 35076977, "link": "https://stackoverflow.com/questions/35076977/go-concurrency-in-ruby/35078026#35078026", "title": "Go concurrency in Ruby", "body": "<p>Starting in Go 1.5, there is a build mode called <code>c-shared</code>, which allows you to build C shared libraries in Go. These can then be loaded into Ruby using FFI and used in your Rails app. See <a href=\"https://c7.se/go-and-ruby-ffi/\" rel=\"nofollow\">this brief introduction to the concept</a>.</p>\n"}], "owner": {"reputation": 7, "user_id": 5749574, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BufBB.jpg?s=128&g=1", "display_name": "LoveDogzzZZ", "link": "https://stackoverflow.com/users/5749574/lovedogzzzz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "closed_date": 1454088506, "accepted_answer_id": 35078026, "answer_count": 1, "score": -2, "last_activity_date": 1454192570, "creation_date": 1454042242, "last_edit_date": 1454192570, "question_id": 35076977, "link": "https://stackoverflow.com/questions/35076977/go-concurrency-in-ruby", "closed_reason": "Needs details or clarity", "title": "Go concurrency in Ruby", "body": "<p>I wish to use threads and concurrency features of Go language in my Ruby on Rails project. I have several alternatives, one of them is jRuby. But, I don't like Java (personal preference). I have heard that Go Lang is a perfect replacement for Java. Its even more faster &amp; secure than Java. I saw people comparing its speed to C++ as some of its part is in Assembly itself. People can even write a complete web server like Apache from scratch in Go.</p>\n\n<p>What I am really planning for is: All the low level stuff in Go and rest of it Ruby on Rails. I still want to have the ease of development that RoR has to offer.</p>\n"}, {"tags": ["sorting", "go", "alphabetical-sort"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 2, "creation_date": 1454036531, "post_id": 35076109, "comment_id": 57874900, "body": "Do you want <code>&quot;A&quot;</code> to ALWAYS precede <code>&quot;a&quot;</code>? Can you give some sample in/out?"}, {"owner": {"reputation": 1923, "user_id": 298275, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/959931af6b71c9c3c9f1ed621ff09f61?s=128&d=identicon&r=PG", "display_name": "Koala3", "link": "https://stackoverflow.com/users/298275/koala3"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1454055153, "post_id": 35076109, "comment_id": 57881345, "body": "Yes ALWAYS. Eg: A a X x Y y Z z (assume these are all strings). I had expected there to be a standard alphabetical ordering string function, but I didn&#39;t find one."}], "answers": [{"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1454087761, "post_id": 35087122, "comment_id": 57902428, "body": "This might be more terse if the comparison is <code>if ir == jr { &#47;&#47; compare upper vs lower } else { return lir &lt; jir } </code>. It makes it look more like a special case and less like totally new logic."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1454088371, "post_id": 35087122, "comment_id": 57902755, "body": "@AdamSmith: I don&#39;t think that quite works (if they&#39;re equal, there&#39;s nothing to compare). I wanted this to be very explicit for the OP, but I think I like this condensed logic better <a href=\"http://play.golang.org/p/twDrCxdYoi\" rel=\"nofollow noreferrer\">play.golang.org/p/twDrCxdYoi</a>"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1454088673, "post_id": 35087122, "comment_id": 57902913, "body": "Ah yes, I was backwards :)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 6, "last_activity_date": 1616540490, "last_edit_date": 1616540490, "creation_date": 1454078350, "answer_id": 35087122, "question_id": 35076109, "link": "https://stackoverflow.com/questions/35076109/in-golang-how-can-i-sort-a-list-of-strings-alphabetically-without-completely-ig/35087122#35087122", "title": "In Golang, how can I sort a list of strings alphabetically without completely ignoring case?", "body": "<p>instead of comparing the entire string using <code>strings.ToLower</code>, compare the individual runes.</p>\n<p><a href=\"https://play.golang.org/p/RUMlmrb7C3g\" rel=\"nofollow noreferrer\">https://play.golang.org/p/RUMlmrb7C3g</a></p>\n<pre><code>type ByCase []string\n\nfunc (s ByCase) Len() int      { return len(s) }\nfunc (s ByCase) Swap(i, j int) { s[i], s[j] = s[j], s[i] }\n\nfunc (s ByCase) Less(i, j int) bool {\n    iRunes := []rune(s[i])\n    jRunes := []rune(s[j])\n\n    max := len(iRunes)\n    if max &gt; len(jRunes) {\n        max = len(jRunes)\n    }\n\n    for idx := 0; idx &lt; max; idx++ {\n        ir := iRunes[idx]\n        jr := jRunes[idx]\n\n        lir := unicode.ToLower(ir)\n        ljr := unicode.ToLower(jr)\n\n        if lir != ljr {\n            return lir &lt; ljr\n        }\n\n        // the lowercase runes are the same, so compare the original\n        if ir != jr {\n            return ir &lt; jr\n        }\n    }\n\n    // If the strings are the same up to the length of the shortest string, \n    // the shorter string comes first\n    return len(iRunes) &lt; len(jRunes)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1923, "user_id": 298275, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/959931af6b71c9c3c9f1ed621ff09f61?s=128&d=identicon&r=PG", "display_name": "Koala3", "link": "https://stackoverflow.com/users/298275/koala3"}, "is_accepted": false, "score": 5, "last_activity_date": 1527470460, "last_edit_date": 1527470460, "creation_date": 1454140577, "answer_id": 35099450, "question_id": 35076109, "link": "https://stackoverflow.com/questions/35076109/in-golang-how-can-i-sort-a-list-of-strings-alphabetically-without-completely-ig/35099450#35099450", "title": "In Golang, how can I sort a list of strings alphabetically without completely ignoring case?", "body": "<p>This may be a solution:</p>\n\n<pre><code>package main\n\nimport (\n    \"strings\"\n    \"sort\"\n    \"fmt\"\n)\n\nvar listOfStrings []string = []string{\n    \"mars bar\",\n    \"milk-duds\",\n    \"Mars bar\",\n    \"milk\",\n    \"milky-way\",\n    \"Milk\",\n    \"Milky-way\",\n    \"mars\",\n}\n\ntype Alphabetic []string\n\nfunc (list Alphabetic) Len() int { return len(list) }\n\nfunc (list Alphabetic) Swap(i, j int) { list[i], list[j] = list[j], list[i] }\n\nfunc (list Alphabetic) Less(i, j int) bool {\n    var si string = list[i]\n    var sj string = list[j]\n    var si_lower = strings.ToLower(si)\n    var sj_lower = strings.ToLower(sj)\n    if si_lower == sj_lower {\n        return si &lt; sj\n    }\n    return si_lower &lt; sj_lower\n}\n\nfunc main() {\n    fmt.Println(\"UNSORTED\")\n    printStrings(listOfStrings)\n    sort.Sort(Alphabetic(listOfStrings))\n    fmt.Println()\n    fmt.Println(\"SORTED ALPHABETICALLY\")\n    printStrings(listOfStrings)\n}\n\nfunc printStrings(slice []string) {\n    for i := 0; i &lt; len(slice); i++ {\n        fmt.Println(slice[i])\n    }\n}\n</code></pre>\n\n<p>Here's the output:</p>\n\n<pre><code>UNSORTED\nmars bar\nmilk-duds\nMars bar\nmilk\nmilky-way\nMilk\nMilky-way\nmars\n\nSORTED ALPHABETICALLY\nmars\nMars bar\nmars bar\nMilk\nmilk\nmilk-duds\nMilky-way\nmilky-way\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1619138515, "creation_date": 1619138515, "answer_id": 67222540, "question_id": 35076109, "link": "https://stackoverflow.com/questions/35076109/in-golang-how-can-i-sort-a-list-of-strings-alphabetically-without-completely-ig/67222540#67222540", "title": "In Golang, how can I sort a list of strings alphabetically without completely ignoring case?", "body": "<p>Heres a Unicode friendly method that utilizes <code>strings.Map</code>:</p>\n<pre><code>package main\n\nimport (\n   &quot;fmt&quot;\n   &quot;sort&quot;\n   &quot;strings&quot;\n   &quot;unicode&quot;\n)\n\ntype slice struct { sort.StringSlice }\n\nfunc (s slice) Less(d, e int) bool {\n   t := strings.Map(unicode.ToUpper, s.StringSlice[d])\n   u := strings.Map(unicode.ToUpper, s.StringSlice[e])\n   return t &lt; u\n}\n\nfunc main() {\n   a := slice{\n      sort.StringSlice{&quot;a&quot;, &quot;b&quot;, &quot;A&quot;, &quot;B&quot;},\n   }\n   sort.Sort(a)\n   fmt.Println(a.StringSlice) // [a A b B]\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/strings#Map\" rel=\"nofollow noreferrer\">https://golang.org/pkg/strings#Map</a></p>\n"}], "owner": {"reputation": 1923, "user_id": 298275, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/959931af6b71c9c3c9f1ed621ff09f61?s=128&d=identicon&r=PG", "display_name": "Koala3", "link": "https://stackoverflow.com/users/298275/koala3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10775, "favorite_count": 0, "answer_count": 3, "score": 7, "last_activity_date": 1619138515, "creation_date": 1454036232, "question_id": 35076109, "link": "https://stackoverflow.com/questions/35076109/in-golang-how-can-i-sort-a-list-of-strings-alphabetically-without-completely-ig", "title": "In Golang, how can I sort a list of strings alphabetically without completely ignoring case?", "body": "<p>I want the strings to be sorted alphabetically with control over whether \"A\" comes before \"a\".</p>\n\n<p>In the Less() function using strings.ToLower() doesn't achieve this. Sometimes \"A\" comes before \"a\", and sometimes after.</p>\n"}, {"tags": ["reflection", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1454081011, "last_edit_date": 1454081011, "creation_date": 1454035605, "answer_id": 35076017, "question_id": 35075278, "link": "https://stackoverflow.com/questions/35075278/reflect-is-it-possible-to-get-the-underlying-typed-type-information/35076017#35076017", "title": "reflect: Is it possible to get the underlying typed type information?", "body": "<p>The underlying type of <code>main.T</code> is <code>int</code>, not <code>main.TT</code>. The reflect package has no knowledge that <code>main.T</code> was declared with <code>main.TT</code>.</p>\n\n<p>Here's what the <a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow\">specification has to say about underlying types</a>:</p>\n\n<blockquote>\n  <p>Each type T has an underlying type: If T is one of the predeclared boolean, numeric, or string types, or a type literal, the corresponding underlying type is T itself. Otherwise, T's underlying type is the underlying type of the type to which T refers in its type declaration.</p>\n\n<pre><code>type T1 string\ntype T2 T1\ntype T3 []T1\ntype T4 T3\n</code></pre>\n  \n  <p>The underlying type of string, T1, and T2 is string. The underlying type of []T1, T3, and T4 is []T1.</p>\n</blockquote>\n"}], "owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 35076017, "answer_count": 1, "score": 0, "last_activity_date": 1454086065, "creation_date": 1454030295, "question_id": 35075278, "link": "https://stackoverflow.com/questions/35075278/reflect-is-it-possible-to-get-the-underlying-typed-type-information", "title": "reflect: Is it possible to get the underlying typed type information?", "body": "<p>I'm porting a program from <a href=\"http://golang.org/pkg/go/ast\" rel=\"nofollow\"><code>go/ast</code></a> to <a href=\"http://golang.org/pkg/reflect\" rel=\"nofollow\"><code>reflect</code></a>. In order to pass the tests I need to get not only the top type information but also the underlying type if the underlying type is not built-in. </p>\n\n<p>In the example below, is it possible for a program to know that the underlying type of main.T is main.TT?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"reflect\"\n\nfunc main() {\n    type TT int\n    type T TT\n\n    x := T(0)\n    fmt.Println(reflect.TypeOf(x))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code> main.T\n</code></pre>\n"}]