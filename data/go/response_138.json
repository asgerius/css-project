[{"tags": ["elasticsearch", "go", "elasticsearch-5"], "answers": [{"tags": [], "owner": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "is_accepted": false, "score": 7, "last_activity_date": 1504137626, "last_edit_date": 1504137626, "creation_date": 1504137234, "answer_id": 45971310, "question_id": 45971228, "link": "https://stackoverflow.com/questions/45971228/how-to-filter-elasticsearch-results-in-go-by-time-ranges/45971310#45971310", "title": "How to filter Elasticsearch results in Go by time ranges?", "body": "<p>I think you're looking for <a href=\"https://godoc.org/github.com/olivere/elastic#RangeQuery\" rel=\"noreferrer\">Range Query</a>.</p>\n\n<p>You'd use it something like this...</p>\n\n<pre><code>query := elastic.NewBoolQuery().\n    Filter(elastic.NewRangeQuery(\"timestamp\").\n        From(start).\n        To(end))\n</code></pre>\n\n<p>Where <code>start</code> and <code>end</code> are <a href=\"https://golang.org/pkg/time/#Time\" rel=\"noreferrer\">time.Time</a> values and <code>\"timestamp\"</code> is the name of your time field.</p>\n\n<p>I should note that wrapping it in a filter of a Bool Query is just one way to use it. It can be used anywhere you can pass a Query.</p>\n"}], "owner": {"reputation": 1811, "user_id": 3004041, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e9c675dd9408721a8e8e1106774a9d11?s=128&d=identicon&r=PG&f=1", "display_name": "covfefe", "link": "https://stackoverflow.com/users/3004041/covfefe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3487, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1504137626, "creation_date": 1504136607, "question_id": 45971228, "link": "https://stackoverflow.com/questions/45971228/how-to-filter-elasticsearch-results-in-go-by-time-ranges", "title": "How to filter Elasticsearch results in Go by time ranges?", "body": "<p>I'm using olivere's v.5 elasticsearch library - <a href=\"https://godoc.org/github.com/olivere/elastic\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/olivere/elastic</a></p>\n\n<p>Trying to do something similar to this post which uses the v.2 library - <a href=\"https://stackoverflow.com/questions/32674666/how-to-search-in-elasticsearch-with-go-filtering-results-by-time-frames\">How to search in elasticsearch with Go filtering results by time frames</a></p>\n\n<p>But 'NewRangeFilter' and 'NewFilteredQuery' are not available in v.5.\nThere is a 'DateRange' API in v.5 (<a href=\"https://godoc.org/github.com/olivere/elastic#Aggregations.DateRange\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/olivere/elastic#Aggregations.DateRange</a>) that I can call from an Aggregation, but it takes in a string, so I don't know what I'm supposed to pass in. </p>\n\n<p>This is what I've tried so far to build an aggregation. After that, I'm not sure what to pass into the DateRange function. I have an index called 'tmpindex' and type called 'user' and each document has a 'timestamp' property which is an integer.</p>\n\n<pre><code>timeline := elasticClient.NewTermsAggregation().Field(\"timestamp\").Size(10).OrderByCountDesc()\n\n    searchResult, err := elasticClient.Search().\n        Index(\"tmpindex\"). // search in index \"tmpindex\"\n        Aggregation(\"timeline\", timeline).\n        From(0).Size(10).        // take documents 0-9\n        Pretty(true).            // pretty print request and response JSON\n        Do(context.Background()) // execute\n    if err != nil {\n        return err\n    }\n</code></pre>\n"}, {"tags": ["go", "x509"], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 8181815, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/cf817e25694843bbee3b913731ff36fd?s=128&d=identicon&r=PG&f=1", "display_name": "kajaptz", "link": "https://stackoverflow.com/users/8181815/kajaptz"}, "edited": false, "score": 0, "creation_date": 1504547582, "post_id": 45970465, "comment_id": 79044336, "body": "Thanks, especially for the link. In my case, I didn&#39;t use <code>VerifyOptions.DNSName</code>. Is there any specific reason to (not) use it?"}, {"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "reply_to_user": {"reputation": 133, "user_id": 8181815, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/cf817e25694843bbee3b913731ff36fd?s=128&d=identicon&r=PG&f=1", "display_name": "kajaptz", "link": "https://stackoverflow.com/users/8181815/kajaptz"}, "edited": false, "score": 0, "creation_date": 1504551273, "post_id": 45970465, "comment_id": 79045608, "body": "That depends on your use case. As a general rule, if you are a client you should use it and if you are a server you cannot use it. Using DNSName lets the library validate against all possible names the certificate covers. If you are a client, you know the server you are trying to connect to and therefore should check for a man in the middle attack. If you are a server, chances are you don&#39;t know who is connecting and plan to implement your own authorization checks."}], "tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": true, "score": 6, "last_activity_date": 1504132150, "last_edit_date": 1504132150, "creation_date": 1504131188, "answer_id": 45970465, "question_id": 45970008, "link": "https://stackoverflow.com/questions/45970008/how-to-check-validity-of-pem-certificate-issued-by-ca/45970465#45970465", "title": "How to check validity of PEM certificate issued by CA", "body": "<p>You need to use <a href=\"https://golang.org/pkg/crypto/x509/#Certificate.Verify\" rel=\"nofollow noreferrer\"><code>Certificate.Verify()</code></a>. There is an example for exactly what you want to do in the docs:</p>\n\n<p><a href=\"https://golang.org/pkg/crypto/x509/#example_Certificate_Verify\" rel=\"nofollow noreferrer\">https://golang.org/pkg/crypto/x509/#example_Certificate_Verify</a></p>\n\n<pre><code>func verifyCert(rootPEM, certPEM string, name string) error {\n    roots := x509.NewCertPool()\n    ok := roots.AppendCertsFromPEM([]byte(rootPEM))\n    if !ok {\n        return fmt.Errorf(\"failed to parse root certificate\")\n    }\n\n    block, _ := pem.Decode([]byte(certPEM))\n    if block == nil {\n        return fmt.Errorf(\"failed to parse certificate PEM\")\n    }\n    cert, err := x509.ParseCertificate(block.Bytes)\n    if err != nil {\n        return fmt.Errorf(\"failed to parse certificate: %v\", err.Error())\n    }\n\n    opts := x509.VerifyOptions{\n        DNSName: name,\n        Roots:   roots,\n    }\n\n    if _, err := cert.Verify(opts); err != nil {\n        return fmt.Errorf(\"failed to verify certificate: %v\", err.Error())\n    }\n\n    return nil\n}\n</code></pre>\n\n<p><strong>DISCLAIMER:</strong> I reorganized it as a function and removed the panics for error handling. The code is otherwise unchanged from the example in the official documentation.</p>\n"}], "owner": {"reputation": 133, "user_id": 8181815, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/cf817e25694843bbee3b913731ff36fd?s=128&d=identicon&r=PG&f=1", "display_name": "kajaptz", "link": "https://stackoverflow.com/users/8181815/kajaptz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1590, "favorite_count": 1, "accepted_answer_id": 45970465, "answer_count": 1, "score": 3, "last_activity_date": 1504274478, "creation_date": 1504128722, "last_edit_date": 1504274478, "question_id": 45970008, "link": "https://stackoverflow.com/questions/45970008/how-to-check-validity-of-pem-certificate-issued-by-ca", "title": "How to check validity of PEM certificate issued by CA", "body": "<p>I have a certificate (PEM), and I'd like to check if the certificate is valid and signed by CA. I already have the CA certificate (PEM). What is a simple, but secure way to check the certificate in Go, using the standard <code>crypto/x509</code> package?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504126480, "post_id": 45969234, "comment_id": 78898339, "body": "Where did you get <code>\\035</code>? The ESC character is <code>\\x1b</code> (or 27, or <code>\\033</code> if you want octal for some reason)."}, {"owner": {"reputation": 49, "user_id": 4227571, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/10889dd325a47cb208cc09b1d8ec4b0d?s=128&d=identicon&r=PG&f=1", "display_name": "aealvarez3", "link": "https://stackoverflow.com/users/4227571/aealvarez3"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504628674, "post_id": 45969234, "comment_id": 79079308, "body": "@JimB I got <code>\\035</code> from running <code>od -c</code> and using the key combination ctrl+]. I have tried your suggestions, but am still seeing the same result (hangs after password entry)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504629345, "post_id": 45969234, "comment_id": 79079654, "body": "Are you sure it doesn&#39;t require another newline or carriage return in there?"}, {"owner": {"reputation": 49, "user_id": 4227571, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/10889dd325a47cb208cc09b1d8ec4b0d?s=128&d=identicon&r=PG&f=1", "display_name": "aealvarez3", "link": "https://stackoverflow.com/users/4227571/aealvarez3"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505153242, "post_id": 45969234, "comment_id": 79285749, "body": "@JimB I have tried many different combinations, with newline, with carriage return, with both on each suggested escape character and still get no luck. It just hangs after the password prompt and the virsh console does not terminate till I explicitly send ctrl+c."}], "owner": {"reputation": 49, "user_id": 4227571, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/10889dd325a47cb208cc09b1d8ec4b0d?s=128&d=identicon&r=PG&f=1", "display_name": "aealvarez3", "link": "https://stackoverflow.com/users/4227571/aealvarez3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1506961383, "creation_date": 1504125112, "last_edit_date": 1506961383, "question_id": 45969234, "link": "https://stackoverflow.com/questions/45969234/ctrl-in-gexpect", "title": "Ctrl+] in gexpect", "body": "<pre><code>func checkInst(kingdom ,pass string) {\n    var z = fmt.Sprintf(\"rbs -k %v -r inst -a console\", kingdom)\n    var x = fmt.Sprintf(\"scc -n ops0-host1-1-%v.eng.host.net &amp;\", kingdom)\n\n    child, err :=gexpect.Spawn(z)\n    if err != nil {\n        panic(err)\n    }\n    child.Expect(\"Escape character is ^]\")\n    child.SendLine(\"\\n\")\n    child.ExpectRegex(`ops\\d-host\\d-\\d-\\w\\w\\w.\\w\\w\\w.host.net login:`)\n    child.SendLine(\"root\")\n    child.Expect(\"Password:\")\n    child.SendLine(pass)\n    child.ExpectRegex(`\\[(\\w*)\\@(\\w*)-host\\d-\\d-(\\w*) \\~\\]\\#`)\n    child.SendLine(x)\n    child.ExpectRegex(`\\[(\\w*)\\@(\\w*)-host\\d-\\d-(\\w*) \\~\\]\\#`)\n    child.SendLine(\"exit\")\n    child.ExpectRegex(`ops\\d-host\\d-\\d-\\w\\w\\w.\\w\\w\\w.host.net login:`)\n    child.SendLine(\"\\035\")\n    child.Close()\n\n}\n</code></pre>\n\n<p>I am running a command from a VM to a remote server. This is done with virsh console to the server and gexepect to login, run the command and then logout. My issue comes when trying to exit the console between the hosts. Virsh asks for <kbd>CTRL</kbd> +<kbd>]</kbd> in order to exit the console. I discovered that the octal for that is \\035 and try sending that but nothing happens. I also specify child.Close() which should close the spawned process, which would be the console command, but i still get nothing. The terminal just hangs after the Password is inputted. Everything is executed as expected up until <code>child.SendLine(\"\\035)</code>. My command is run on the remote server in the background, and logs off back to the OS login screen, but never terminates the virsh console to the remote host. </p>\n\n<p>How would I go about sending <kbd>CTRL</kbd> +<kbd>]</kbd> through gexpect to exit a virsh console?     </p>\n"}, {"tags": ["json", "go", "struct", "unmarshalling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504122287, "post_id": 45968476, "comment_id": 78896230, "body": "You could implement the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">json.Unmarshaler</a> interface."}], "answers": [{"comments": [{"owner": {"reputation": 22034, "user_id": 21699, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1c27bc77c7d5d9506958e3f9164341b7?s=128&d=identicon&r=PG", "display_name": "Tigraine", "link": "https://stackoverflow.com/users/21699/tigraine"}, "edited": false, "score": 2, "creation_date": 1504123220, "post_id": 45968682, "comment_id": 78896699, "body": "Thanks - I also thought about that. But this is a really big struct.. Is there a way how I can implement the unmarshaler only for the problematic field?"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 3, "last_activity_date": 1504123120, "last_edit_date": 1504123120, "creation_date": 1504122799, "answer_id": 45968682, "question_id": 45968476, "link": "https://stackoverflow.com/questions/45968476/json-unmarshal-integer-field-into-a-string/45968682#45968682", "title": "JSON unmarshal integer field into a string", "body": "<p>You can customize how the data structure is unamrshaled by implementing the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>json.Unamrshaler</code></a> interface.</p>\n\n<p>The simplest way to handle unknown types is to nnmarshal the JSON into an intermediate structure, and handle the type assertions and validation during deserialization:</p>\n\n<pre><code>type test struct {\n    Foo string `json:\"foo\"`\n}\n\nfunc (t *test) UnmarshalJSON(d []byte) error {\n    tmp := struct {\n        Foo interface{} `json:\"foo\"`\n    }{}\n\n    if err := json.Unmarshal(d, &amp;tmp); err != nil {\n        return err\n    }\n\n    switch v := tmp.Foo.(type) {\n    case float64:\n        t.Foo = strconv.Itoa(int(v))\n    case string:\n        t.Foo = v\n    default:\n        return fmt.Errorf(\"invalid value for Foo: %v\", v)\n    }\n\n    return nil\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/t0eI4wCxdB\" rel=\"nofollow noreferrer\">https://play.golang.org/p/t0eI4wCxdB</a></p>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1504123677, "post_id": 45968805, "comment_id": 78896925, "body": "Good example (but that&#39;s not an <a href=\"https://golang.org/ref/spec#Alias_declarations\" rel=\"nofollow noreferrer\">alias</a>)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504123881, "post_id": 45968805, "comment_id": 78897023, "body": "I know it&#39;s not the 1.9 alias, but wasn&#39;t this called aliasing before?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1504124426, "post_id": 45968805, "comment_id": 78897331, "body": "Nope, it&#39;s never been called an alias because it creates a new type. Doesn&#39;t mean others haven&#39;t called it an &quot;alias&quot; in the past, but I&#39;ve been doing my best to be pedantic on the matter for years, especially once the real alias idea was brought up ;) The only <i>real</i> aliases previously were <code>byte</code> and <code>rune</code>, for <code>uint8</code> and <code>int32</code> respectively."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504124828, "post_id": 45968805, "comment_id": 78897545, "body": "Ah yes, I think it&#39;s because of <code>rune</code> and friends that I was calling every <code>type T2 T1</code> an alias. Anyway thanks for the clarification."}, {"owner": {"reputation": 22034, "user_id": 21699, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1c27bc77c7d5d9506958e3f9164341b7?s=128&d=identicon&r=PG", "display_name": "Tigraine", "link": "https://stackoverflow.com/users/21699/tigraine"}, "edited": false, "score": 0, "creation_date": 1504129699, "post_id": 45968805, "comment_id": 78899656, "body": "This is exactly what I was looking for.. Thanks so much! I&#39;ll have to read up on embedding."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1504157285, "post_id": 45968805, "comment_id": 78906369, "body": "Love the way you get around a recursive <code>Unmarshal</code>. It&#39;s a better hack than what I came up with trying to <code>Unmarshal</code> the same struct in the <code>UnmarshalJSON</code> implementation."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 6, "last_activity_date": 1504124342, "last_edit_date": 1504124342, "creation_date": 1504123320, "answer_id": 45968805, "question_id": 45968476, "link": "https://stackoverflow.com/questions/45968476/json-unmarshal-integer-field-into-a-string/45968805#45968805", "title": "JSON unmarshal integer field into a string", "body": "<p>To handle big structs you can use embedding.</p>\n\n<p>Updated to not discard possibly previously set field values.</p>\n\n<pre><code>func (t *T) UnmarshalJSON(d []byte) error {\n    type T2 T // create new type with same structure as T but without its method set!\n    x := struct{\n        T2 // embed\n        Foo json.Number `json:\"foo\"`\n    }{T2: T2(*t)} // don't forget this, if you do and 't' already has some fields set you would lose them\n\n    if err := json.Unmarshal(d, &amp;x); err != nil {\n        return err\n    }\n    *t = T(x.T2)\n    t.Foo = x.Foo.String()\n    return nil\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/BytXCeHMvt\" rel=\"noreferrer\">https://play.golang.org/p/BytXCeHMvt</a></p>\n"}], "owner": {"reputation": 22034, "user_id": 21699, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1c27bc77c7d5d9506958e3f9164341b7?s=128&d=identicon&r=PG", "display_name": "Tigraine", "link": "https://stackoverflow.com/users/21699/tigraine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5736, "favorite_count": 5, "accepted_answer_id": 45968805, "answer_count": 2, "score": 6, "last_activity_date": 1504274496, "creation_date": 1504121867, "last_edit_date": 1504274496, "question_id": 45968476, "link": "https://stackoverflow.com/questions/45968476/json-unmarshal-integer-field-into-a-string", "title": "JSON unmarshal integer field into a string", "body": "<p>I am struggling with deserializing a integer into a string struct field.\nThe struct field is a string and is expected to be assignable from users of my library. That's why I want it to be a string, since for the purpose of writing it to the database I actually don't care about the value inside.\nThe users can supply text, but some just assign integers.</p>\n\n<p>Consider this struct:</p>\n\n<pre><code>type Test struct {\n  Foo string\n}\n</code></pre>\n\n<p>Sometimes I end up with a JSON value that is valid but won't deserialize into the struct due to the Foo field being a integer instead of a string:</p>\n\n<pre><code>{ \"foo\": \"1\" } // works\n{ \"foo\": 1 } // doesn't\n</code></pre>\n\n<p>json.Unmarshal will blow up with the following error:\n<code>json: cannot unmarshal number into Go struct field test.Foo of type string</code> </p>\n\n<p>See the reproduction: <a href=\"https://play.golang.org/p/4Qau3umaVm\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4Qau3umaVm</a></p>\n\n<p>Now in every other JSON library (in other languages) I have worked in so far, if the target field is a string and you get a integer the deserializer will usually just wrap the int in a string and be done with it. Can this be achieved in Go?</p>\n\n<p>Since I can't really control how the data comes in I need to make <code>json.Unmarshal</code> unsensitive to this - the other solution would be to define Foo as <code>interface{}</code> which needlessly complicates my code with type assertions etc..</p>\n\n<p>Any ideas on how to do this? I basically need the inverse of <code>json:\",string\"</code></p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504118252, "post_id": 45967591, "comment_id": 78894153, "body": "Can you show the headers on a response as seen in the chrome console?"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504118474, "post_id": 45967591, "comment_id": 78894281, "body": "@captncraig surely! I just add it at the end of the post"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1504118548, "post_id": 45967591, "comment_id": 78894308, "body": "Looks like you are serving via caddy as well? Caddy has it&#39;s own cors plugin if thats easier, but I think your issue is the caddy proxy not allowing the headers through."}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504118623, "post_id": 45967591, "comment_id": 78894347, "body": "@captncraig yes, I am using Caddy. But, in that server I have others API&#39;s and they are working great. Should be an specific configuration for the site?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504118698, "post_id": 45967591, "comment_id": 78894403, "body": "I believe caddy limits which headers are passed between the client and the backend. See <a href=\"https://caddyserver.com/docs/proxy\" rel=\"nofollow noreferrer\">the proxy docs</a>."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504118907, "post_id": 45967591, "comment_id": 78894521, "body": "Looking at the source, I am not sure if it does or does not allow the cors headers through. Can you access the app directly, without caddy, and see if it works?"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504118947, "post_id": 45967591, "comment_id": 78894546, "body": "@captncraig ok, let me check if accessing directly it works"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504119473, "post_id": 45967591, "comment_id": 78894821, "body": "@captncraig no, nothing. Worst becase not even one header is sent"}, {"owner": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 0, "creation_date": 1504131972, "post_id": 45967591, "comment_id": 78900405, "body": "The image shows you\u2019re getting a 403 Forbidden for the CORS preflight OPTIONS request the browser\u2019s sending. <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#Preflighted_requests\" rel=\"nofollow noreferrer\">developer.mozilla.org/en-US/docs/Web/HTTP/&hellip;</a>. That indicates the server\u2019s requiring authentication for OPTIONS requests. It shouldn\u2019t be. As long as the server is requiring authentication for OPTIONS requests, cross-origin requests you try to make from frontend code aren\u2019t going be able to work. The server\u2019s expecting an Authorization header in every request? If so, the browser doesn\u2019t send the Authorization in the preflight OPTIONS."}, {"owner": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 0, "creation_date": 1504132163, "post_id": 45967591, "comment_id": 78900456, "body": "I think the only reason you\u2019re seeing that error message about the missing Access-Control-Allow-Origin is that the server only sends that header in success responses, but doesn\u2019t send it in error responses such as the 403 response you\u2019re getting to the OPTIONS request. But if you fix the server so that it\u2019s sending a 200 OK or 204 for responses to OPTIONS requests, then I think you\u2019ll get the Access-Control-Allow-Origin header in that response as expected."}, {"owner": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 0, "creation_date": 1504132405, "post_id": 45967591, "comment_id": 78900518, "body": "It would help if you use <a href=\"https://stackoverflow.com/posts/45967591/edit\">stackoverflow.com/posts/45967591/edit</a> to edit/update your question to add the frontend code you\u2019re using to make the request. Because there\u2019s at least one problem with your request code: That code seems to be adding the Access-Control-Allow-Origin header to the request. But that header is strictly a <i>response</i> header for servers to send. Adding it to requests will just break things. For one thing, adding that will trigger a CORS preflight."}, {"owner": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 1, "creation_date": 1504132505, "post_id": 45967591, "comment_id": 78900545, "body": "Your request code also seems to be adding an &quot;<code>osn</code>&quot; header. So even when you remove the Access-Control-Allow-Origin from the request, that <code>osn</code> header will also still trigger a preflight OPTIONS request. So if you want to prevent the browser from doing that preflight OPTIONS, you could do that by not adding the <code>osn</code> header from the request (along with not adding the Access-Control-Allow-Origin header to the request)."}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 0, "creation_date": 1504136857, "post_id": 45967591, "comment_id": 78901601, "body": "@sideshowbarker correct, I have that header but I need it in the backend. I don&#39;t post the code of the front because I have a generic class to dispatch all the requests and it&#39;s little difficult to post all that code here. However, i can say that it works to make POST request to others API&#39;s that are hosted in the same server because I already checked it."}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 1, "creation_date": 1504291077, "post_id": 45967591, "comment_id": 78973396, "body": "I had a similar issue. I solved using <a href=\"https://github.com/rs/cors\" rel=\"nofollow noreferrer\">rs/cors</a>. I made an easy configuration following the code on the Parameters tab."}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1504470897, "post_id": 45967591, "comment_id": 79015015, "body": "@AndreaM16 totally correct! I made it and it worked"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 685, "favorite_count": 0, "closed_date": 1537876204, "answer_count": 0, "score": 2, "last_activity_date": 1576688738, "creation_date": 1504118205, "last_edit_date": 1576688738, "question_id": 45967591, "link": "https://stackoverflow.com/questions/45967591/config-cors-in-gorilla-mux", "closed_reason": "Duplicate", "title": "config CORS in Gorilla Mux", "body": "<p>I am working in a golang project, using gorilla/mux as the router, and now I have problems related with CORS: I cannot make a <code>POST</code> request using ajax in another application.</p>\n\n<p>My current configuration for the router is as follows:</p>\n\n<pre><code>r := mux.NewRouter()\n    r.HandleFunc(\"/\", handleHome)\n    //Other routes\n\n    headersOk := handlers.AllowedHeaders([]string{\"*\"})\n    originsOk := handlers.AllowedOrigins([]string{\"*\"})\n    methodsOk := handlers.AllowedMethods([]string{\"GET\", \"HEAD\", \"POST\", \"PUT\", \"OPTIONS\"})\n\n    // Start http server\n    port := fmt.Sprintf(\":%d\", some_Port)\n    http.ListenAndServe(port, handlers.CORS(originsOk, headersOk, methodsOk)(r))\n</code></pre>\n\n<p>I am using:</p>\n\n<pre><code>\"github.com/gorilla/mux\"\n\"github.com/gorilla/handlers\"\n</code></pre>\n\n<p>The message that I am getting in the browser is (in Spanish):</p>\n\n<blockquote>\n  <p>Solicitud desde otro origen bloqueada: la pol\u00edtica de mismo origen\n  impide leer el recurso remoto en <a href=\"https://miURL\" rel=\"nofollow noreferrer\">https://miURL</a> (raz\u00f3n: falta la\n  cabecera CORS 'Access-Control-Allow-Origin').</p>\n</blockquote>\n\n<p>In English: basically the server is rejecting the request because the CORS header is not present.</p>\n\n<p>So, what have I done wrong in my router configuration?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/DtR5l.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/DtR5l.png\" alt=\"The request sent\"></a></p>\n"}, {"tags": ["for-loop", "go", "reference"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504117403, "post_id": 45967305, "comment_id": 78893683, "body": "What are you trying to accomplish here? Why do you want int pointers at all? Seems like you are just trying to collect all map keys?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504117454, "post_id": 45967305, "comment_id": 78893708, "body": "If you want a copy of the value, you need to copy the value. Your last example is one way, but why are you trying to get a pointer to a copy of the index value of a for loop in the first place?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504117507, "post_id": 45967305, "comment_id": 78893741, "body": "The loop variables are allocated once. The map key/value are copied into the same location on each iteration. You should not depend on the address of those, as they have no connection to the address in the underlying map."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1504117513, "post_id": 45967305, "comment_id": 78893746, "body": "That is exactly what I am trying to do. I found this situation when working with the Go SDK for Google Cloud Datastore. I need an <code>[]*datastore.Key</code> to pass to some of the functions. I have a <code>map[datastore.Key]interface{}</code>."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504117572, "post_id": 45967305, "comment_id": 78893778, "body": "@ralph, yeah, that makes a little more sense than ints."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1504117605, "post_id": 45967305, "comment_id": 78893802, "body": "I was trying to make a short sample that didn&#39;t need hundreds of lines. :-) The pattern of copying from an <code>x</code> to a <code>*x</code> when traversing a <code>map</code> is what I am interested in."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504117862, "post_id": 45967305, "comment_id": 78893921, "body": "&quot;the address of the current value of <code>k</code>&quot; doesn&#39;t make any sense. You can only get the address of a variable, where the current value of <code>k</code> is stored - a value that will change whenever <code>k</code> is changed. There is no separate address of the current value that changes when the value changes. That isn&#39;t how programs use memory."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1504117972, "post_id": 45967305, "comment_id": 78893996, "body": "I realized that when I was debugging the code. That I why I came up with the alternate, correct code. I was hoping for a shorter version of my code. See @captncraig&#39;s <a href=\"https://stackoverflow.com/a/45967429/96233\">answer</a>."}], "answers": [{"comments": [{"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1504117767, "post_id": 45967429, "comment_id": 78893873, "body": "I almost tried that, but then I thought that the compiler would only allocate a single location for <code>key</code> and I would have the same problem. I guess I should have tried it."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1504117842, "post_id": 45967429, "comment_id": 78893917, "body": "Yeah, this is a common gotcha in go. The scope of <code>key</code> is inside the loop, so it is limited to this iteration. Not sure what kind of escape analysis leads to it getting allocated on heap vs stack, but it does work."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1504118295, "post_id": 45967429, "comment_id": 78894185, "body": "It&#39;s also actually common to see <code>k := k</code> to shadow the variable with the same name. It&#39;s not escape analysis, the lexical scoping says the new declaration is valid for the remainder of the block."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504118396, "post_id": 45967429, "comment_id": 78894241, "body": "@JimB what I was getting at was: if you never add <code>key</code> to <code>dst</code>, the compiler could re-use a single stack location for every iteration. Saving it to the slice means it can&#39;t be overwritten. I don&#39;t know enough about the compiler to know how that works."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504119100, "post_id": 45967429, "comment_id": 78894633, "body": "@captncraig: Ah, I see what you mean. That is an <i>optimization</i> that can be made, but it&#39;s not anything you would ever need to be aware of. If you ever use <code>&amp;i</code>, it&#39;s going to escape, so escape analysis prevents it. Here&#39;s an unsafe example that makes sure the pointer doesn&#39;t escape: <a href=\"https://play.golang.org/p/6rVGNZHe5K\" rel=\"nofollow noreferrer\">play.golang.org/p/6rVGNZHe5K</a> ;) (at least as of go1.9)"}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 5, "last_activity_date": 1504117935, "last_edit_date": 1504117935, "creation_date": 1504117702, "answer_id": 45967429, "question_id": 45967305, "link": "https://stackoverflow.com/questions/45967305/copying-the-address-of-a-loop-variable-in-go/45967429#45967429", "title": "Copying the address of a loop variable in Go", "body": "<p>If you have a <code>map[T]X</code> and you want to get a <code>[]*T</code>, you are on the right track with copying the loop variable and getting an address to it.</p>\n\n<p>There is a slightly slimmer way to do it than your way:</p>\n\n<pre><code>for k := range src {\n    key := k\n    dst = append(dst, &amp;key)\n}\n</code></pre>\n\n<p>What you are adding to dst is not the address of the keys or values in the map, but rather the address of a <strong>copy</strong> of the key. That distinction may or may not matter to you.</p>\n\n<p>The reason that using the address of the loop variables doesn't work, is that the loop variables are single locations that get updated on each iteration. Value types like ints and structs are copyed each time you assign it to a new variable.</p>\n"}], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1168, "favorite_count": 1, "accepted_answer_id": 45967429, "answer_count": 1, "score": 0, "last_activity_date": 1504117935, "creation_date": 1504117252, "question_id": 45967305, "link": "https://stackoverflow.com/questions/45967305/copying-the-address-of-a-loop-variable-in-go", "title": "Copying the address of a loop variable in Go", "body": "<p>In the following code sample, the result is not what I would expect:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    src := map[int]int{1: 1, 2: 2, 3: 3}\n    fmt.Println(\"src \", src)\n\n    dst := make([]*int, 0, len(src))\n    for k, _ := range src {\n        dst = append(dst, &amp;k)\n    }\n    for _, a := range dst {\n        fmt.Print(*a, \" \")\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>src map[1:1 2:2 3:3]\n3 3 3\n</code></pre>\n\n<p>Go Playground: <a href=\"https://play.golang.org/p/BSDsd3nojz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/BSDsd3nojz</a></p>\n\n<p>but I understand what is happening. The unchanging address of <code>k</code> is being added to <code>dst</code>, so when I loop over <code>dst</code>, the same value is in every location: <code>3</code>.</p>\n\n<p>The address of <code>k</code> never changes in the loop, so the second loop keeps referring to that location, containing the last value it had, <code>3</code>.</p>\n\n<p>How can I get the address of the current value of <code>k</code> to be copied? Do I need something like this:</p>\n\n<pre><code>for k, _ := range src {\n    key = new(int)\n    *key = k\n    dst = append(dst, key)\n}\n</code></pre>\n\n<p>That seems awkward.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504115945, "post_id": 45966825, "comment_id": 78892870, "body": "Can you post the code you&#39;ve tried to implement this with?"}, {"owner": {"reputation": 37, "user_id": 2045354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a582bd15889b6e8f3a47a807066b876a?s=128&d=identicon&r=PG", "display_name": "pythoncoder", "link": "https://stackoverflow.com/users/2045354/pythoncoder"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504116073, "post_id": 45966825, "comment_id": 78892961, "body": "@Adrian, no impemetantion code, i dont know from where start do this :("}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1504117920, "post_id": 45966825, "comment_id": 78893962, "body": "Then this question is much too broad for SO. This is not a code-writing service. Do some research, attempt an implementation, and if you have trouble, post a new question."}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 0, "last_activity_date": 1504140073, "creation_date": 1504140073, "answer_id": 45971594, "question_id": 45966825, "link": "https://stackoverflow.com/questions/45966825/simple-static-server-who-return-static-files-in-rotation-for-every-request/45971594#45971594", "title": "simple static server who return static files in rotation for every request", "body": "<p>Below is a simple server that should get you started toward your goal. A couple of things to note about the implementation:</p>\n\n<ol>\n<li>The file names are loaded only once during program startup. If a file disappears while the program is running, the server will return a 404 when it comes up in the rotation.</li>\n<li>We need to use locking (in this case, via <code>sync.Mutex</code>) as each request will run in its own go routine.</li>\n</ol>\n\n\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"net/http\"\n    \"os\"\n    \"path/filepath\"\n    \"sync\"\n)\n\nfunc main() {\n    dir := flag.String(\"dir\", \".\", \"directory of files to serve\")\n    flag.Parse()\n\n    f, err := os.Open(*dir)\n    if err != nil {\n        panic(err)\n    }\n    files, err := f.Readdir(0)\n    if err != nil {\n        panic(err)\n    }\n\n    filenames := make([]string, 0, len(files))\n    for _, file := range files {\n        if !file.IsDir() {\n            filenames = append(filenames, file.Name())\n        }\n    }\n\n    var (\n        idxLock sync.Mutex\n        idx     int\n    )\n\n    http.HandleFunc(\"/rotate\", func(w http.ResponseWriter, r *http.Request) {\n        if len(filenames) == 0 {\n            http.NotFound(w, r)\n            return\n        }\n\n        idxLock.Lock()\n        i := idx\n        idx++\n        if idx &gt;= len(filenames) {\n            idx = 0\n        }\n        idxLock.Unlock()\n\n        http.ServeFile(w, r, filepath.Join(*dir, filenames[i]))\n    })\n\n    if err := http.ListenAndServe(\":3000\", nil); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 2045354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a582bd15889b6e8f3a47a807066b876a?s=128&d=identicon&r=PG", "display_name": "pythoncoder", "link": "https://stackoverflow.com/users/2045354/pythoncoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 45971594, "answer_count": 1, "score": -4, "last_activity_date": 1504140073, "creation_date": 1504115426, "question_id": 45966825, "link": "https://stackoverflow.com/questions/45966825/simple-static-server-who-return-static-files-in-rotation-for-every-request", "title": "simple static server who return static files in rotation for every request", "body": "<p>i have this simple server writed in golang :</p>\n\n<pre><code>package main\n\nimport (\n        \"net/http\"\n)\n\nfunc main() {\n        http.Handle(\"/\", http.FileServer(http.Dir(\"./static\")))\n        http.ListenAndServe(\":3000\", nil)\n}\n</code></pre>\n\n<p>I want add new function :\nevery request GET /rotate return one file content in rotation from /static folder.\nfor example in /static folder exist 7 file, for every request server return : file1, file2, file3 ...</p>\n\n<p>How i can do this in go ?</p>\n"}, {"tags": ["reactjs", "post", "go", "http-post", "gorilla"], "comments": [{"owner": {"reputation": 2688, "user_id": 2718295, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/7a0108422b842227a6b9cc92a5c114a5?s=128&d=identicon&r=PG", "display_name": "cowbert", "link": "https://stackoverflow.com/users/2718295/cowbert"}, "edited": false, "score": 2, "creation_date": 1504112147, "post_id": 45965812, "comment_id": 78890745, "body": "This has nothing to do with reactjs but ajax and your api in general. What request headers are you sending? If you send any headers other than those listed in <a href=\"https://fetch.spec.whatwg.org/#cors-safelisted-request-header\" rel=\"nofollow noreferrer\">fetch.spec.whatwg.org/#cors-safelisted-request-header</a> is causing it to prefligh the request and your api is sending 403 on the OPTIONS request. Check your API."}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 2688, "user_id": 2718295, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/7a0108422b842227a6b9cc92a5c114a5?s=128&d=identicon&r=PG", "display_name": "cowbert", "link": "https://stackoverflow.com/users/2718295/cowbert"}, "edited": false, "score": 0, "creation_date": 1504114377, "post_id": 45965812, "comment_id": 78891994, "body": "@cowbert correct! that are the only headers that are being sent"}, {"owner": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 0, "creation_date": 1504137550, "post_id": 45965812, "comment_id": 78901711, "body": "As noted in comments at <a href=\"https://stackoverflow.com/questions/45967591/config-cors-in-gorilla-mux\" title=\"config cors in gorilla mux\">stackoverflow.com/questions/45967591/config-cors-in-gorilla-&zwnj;&#8203;mux</a> it seems your request is adding an &quot;<code>osn</code>&quot; request header\u2014along with adding an Access-Control-Allow-Origin that it definitely has no need to be adding\u2014&amp; that\u2019s what\u2019s triggering the browser to do the preflight OPTIONS. And as also mentioned in the comments in that other question, the problem\u2019s that your server\u2019s responding with a 403 for OPTIONS request to whatever URL you\u2019re sending the request to. So you need to configure the backend to not require authentication for OPTIONS request to that route"}], "answers": [{"tags": [], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "is_accepted": true, "score": 6, "last_activity_date": 1504537957, "last_edit_date": 1504537957, "creation_date": 1504512223, "answer_id": 46032716, "question_id": 45965812, "link": "https://stackoverflow.com/questions/45965812/config-cors-in-gorilla-mux-403-error-on-post-request/46032716#46032716", "title": "config CORS in Gorilla Mux: 403 error on POST request", "body": "<p>With <a href=\"https://github.com/rs/cors\" rel=\"noreferrer\">rs/cors</a> you should solve CORS issues pretty easily.</p>\n\n<p>On your <strong>server.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    . . .       \n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"github.com/gorilla/mux\"\n    \"github.com/rs/cors\"\n    \"../myhandler\"\n)\n\nfunc main() {\n\nfmt.Println(\"Settin up server, enabling CORS . . .\")\n\n  c := cors.New(cors.Options{\n      AllowedOrigins: []string{\"*\"}, // All origins\n      AllowedMethods: []string{\"GET\"}, // Allowing only get, just an example\n  })\n\n  router := mux.NewRouter()\n  // Example handler\n  router.HandleFunc(\"/test\", myhandler.TestHandler())\n  http.Handle(\"/\", router)\n\n  // Bind to port 8000 and pass our router in and pass the cors Handler\n  log.Fatal(http.ListenAndServe(\":8000\"), c.Handler(router)))\n\n  fmt.Println(\"Server is ready and is listening at port :8000 . . .\")\n\n}\n</code></pre>\n\n<p>And on your <strong>testhandler.go</strong>, let's suppose you want to accept <code>Content-Type: application/json</code></p>\n\n<pre><code>. . .\n\nfunc TestHandler func(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(http.StatusOK)\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3702, "favorite_count": 0, "accepted_answer_id": 46032716, "answer_count": 1, "score": 1, "last_activity_date": 1549614103, "creation_date": 1504111643, "last_edit_date": 1504545839, "question_id": 45965812, "link": "https://stackoverflow.com/questions/45965812/config-cors-in-gorilla-mux-403-error-on-post-request", "title": "config CORS in Gorilla Mux: 403 error on POST request", "body": "<p>I have an API, currently am trying to consume one of its endpoints. The endpoint is for POST requests, the endpoint is working as expected. The API is running in the cloud, I tested it with <code>curl</code> and it was perfect, then from my react app I was trying to consume it but I get <code>403 status code</code>.</p>\n\n<p>Watching in the console of the browser I see that I get that error on a OPTIONS request, and the POST never get done. Here is a screenshot of the result displayed in the console:</p>\n\n<p><a href=\"https://i.stack.imgur.com/0U7Wu.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0U7Wu.png\" alt=\"enter image description here\"></a></p>\n\n<p>Then, I made a simple HTML file with a form, there I placed the required inputs, and the action pointing to this endpoint and it worked pretty well. Then, I don't know where would be the error? I have enabled CORS in the API</p>\n\n<p>In the API I am using Gorilla/mux and I have something like this:</p>\n\n<pre><code>// Set up a router and some routes\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", handleHome)\n    //some other routes\n\n    headersOk := handlers.AllowedHeaders([]string{\"*\"})\n    originsOk := handlers.AllowedOrigins([]string{\"*\"})\n    methodsOk := handlers.AllowedMethods([]string{\"GET\", \"HEAD\", \"POST\", \"PUT\", \"OPTIONS\"})\n\n    // Start http server\n    port := fmt.Sprintf(\":%d\", SomePort)\n    http.ListenAndServe(port, handlers.CORS(originsOk, headersOk, methodsOk)(r))\n</code></pre>\n\n<p>Using:</p>\n\n<pre><code>\"github.com/gorilla/mux\"\n\"github.com/gorilla/handlers\"\n</code></pre>\n\n<p>The message that I am getting in the browser is (in Spanish):</p>\n\n<blockquote>\n  <p>Solicitud desde otro origen bloqueada: la pol\u00edtica de mismo origen\n  impide leer el recurso remoto en <a href=\"https://miURL\" rel=\"nofollow noreferrer\">https://miURL</a> (raz\u00f3n: falta la\n  cabecera CORS 'Access-Control-Allow-Origin').</p>\n</blockquote>\n\n<p>In English: basically the server is rejecting the request because the CORS header is not present.</p>\n\n<p>So, what have I done wrong in my router configuration?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1504107934, "post_id": 45964047, "comment_id": 78888183, "body": "That&#39;s not a slice; that&#39;s a map."}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1504108167, "post_id": 45964047, "comment_id": 78888352, "body": "You write &quot;The goal is to match the first three countries with the lowest &#39;score&#39; into its own group of three&quot; but as far as I can see the groups contain two countries."}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1504108253, "post_id": 45964047, "comment_id": 78888394, "body": "Wouldn&#39;t a tree structure be more appropriate than a map?"}, {"owner": {"reputation": 43, "user_id": 8537167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1feb5a370afc6f979f9f05981160b50b?s=128&d=identicon&r=PG&f=1", "display_name": "Mat&#237;as Salen", "link": "https://stackoverflow.com/users/8537167/mat%c3%adas-salen"}, "reply_to_user": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1504108279, "post_id": 45964047, "comment_id": 78888409, "body": "Thanks.. Sorry the three vs two is a typo. I&#39;ll update"}, {"owner": {"reputation": 43, "user_id": 8537167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1feb5a370afc6f979f9f05981160b50b?s=128&d=identicon&r=PG&f=1", "display_name": "Mat&#237;as Salen", "link": "https://stackoverflow.com/users/8537167/mat%c3%adas-salen"}, "reply_to_user": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1504108386, "post_id": 45964047, "comment_id": 78888462, "body": "In the example listed in the play link, there is somewhat of a tree structure. But not sure how to get this further. Any help would be appreciated."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504116169, "post_id": 45964047, "comment_id": 78893010, "body": "Silly question, but can we assume this list isn&#39;t going to be huge? As in, even an O(n^2) or even maybe O(n^3) algorithm would suffice? Trying to take some shortcuts ;)"}, {"owner": {"reputation": 189, "user_id": 2016779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72a0c26a5ae386f8b4cd169ca40b25e4?s=128&d=identicon&r=PG", "display_name": "uoryon", "link": "https://stackoverflow.com/users/2016779/uoryon"}, "edited": false, "score": 0, "creation_date": 1504173743, "post_id": 45964047, "comment_id": 78916092, "body": "Could you try <code>map[string]interface{}</code>? and compare the score with <code>type assert</code>\uff1f"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 8537167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1feb5a370afc6f979f9f05981160b50b?s=128&d=identicon&r=PG&f=1", "display_name": "Mat&#237;as Salen", "link": "https://stackoverflow.com/users/8537167/mat%c3%adas-salen"}, "edited": false, "score": 0, "creation_date": 1504222409, "post_id": 45967601, "comment_id": 78943124, "body": "thanks for the detailed comments. since the result will end up being a type (Team), that implements Scoreable, is there a trick to be able to iterate through them? I would like to show them as a list to my users but not sure how."}, {"owner": {"reputation": 43, "user_id": 8537167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1feb5a370afc6f979f9f05981160b50b?s=128&d=identicon&r=PG&f=1", "display_name": "Mat&#237;as Salen", "link": "https://stackoverflow.com/users/8537167/mat%c3%adas-salen"}, "edited": false, "score": 0, "creation_date": 1504259819, "post_id": 45967601, "comment_id": 78955287, "body": "For example, iterate through the slice of Scorable, so we can see the new groups that were created md2perpe. Any ideas?"}, {"owner": {"reputation": 43, "user_id": 8537167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1feb5a370afc6f979f9f05981160b50b?s=128&d=identicon&r=PG&f=1", "display_name": "Mat&#237;as Salen", "link": "https://stackoverflow.com/users/8537167/mat%c3%adas-salen"}, "edited": false, "score": 0, "creation_date": 1504259953, "post_id": 45967601, "comment_id": 78955375, "body": "Then hopefully I can track the relation of the group to the one above them. For example, with <code>(Canada [7] + (Korea [4] + (US [2] + Germany [3])))</code> we can prove that US and Gemany is a sub group with Korea"}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "reply_to_user": {"reputation": 43, "user_id": 8537167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1feb5a370afc6f979f9f05981160b50b?s=128&d=identicon&r=PG&f=1", "display_name": "Mat&#237;as Salen", "link": "https://stackoverflow.com/users/8537167/mat%c3%adas-salen"}, "edited": false, "score": 0, "creation_date": 1504273146, "post_id": 45967601, "comment_id": 78963557, "body": "Here I have added a printout in a simple tree structure: <a href=\"https://play.golang.org/p/6b8JNHrmQA\" rel=\"nofollow noreferrer\">play.golang.org/p/6b8JNHrmQA</a>"}], "tags": [], "owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "is_accepted": true, "score": 2, "last_activity_date": 1504118233, "creation_date": 1504118233, "answer_id": 45967601, "question_id": 45964047, "link": "https://stackoverflow.com/questions/45964047/how-to-recursively-loop-through-map-using-different-data-structures/45967601#45967601", "title": "How to recursively loop through map using different data structures", "body": "<p>Your problem can \"easy\" be solved using a <a href=\"https://en.wikipedia.org/wiki/Heap_(data_structure)\" rel=\"nofollow noreferrer\">heap data structure</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"container/heap\"\n    \"fmt\"\n)\n\n\n\n// Something that has a score\ntype Scoreable interface {\n    fmt.Stringer\n    Score() int\n}\n\n\n\n// A country has a name and a score\ntype Country struct {\n    name  string\n    score int\n}\n\n// Country implements Scoreable\nfunc (c Country) Score() int {\n    return c.score\n}\n\n// ... and fmt.Stringer\nfunc (c Country) String() string {\n    return fmt.Sprintf(\"%s [%d]\", c.name, c.score)\n}\n\n\n\n// A team consists of two Scoreable's and has itself a score\ntype Team struct {\n    team1, team2 Scoreable\n    score        int\n}\n\n// Team implements Scoreable\nfunc (t Team) Score() int {\n    return t.score\n}\n\n// ... and fmt.Stringer\nfunc (t Team) String() string {\n    return fmt.Sprintf(\"(%s + %s)\", t.team1.String(), t.team2.String())\n}\n\n\n\n// The heap will be implemented using a slice of Scoreables\ntype TeamHeap []Scoreable\n\n// TeamHeap implements heap.Interface\nfunc (th TeamHeap) Len() int {\n    return len(th)\n}\n\nfunc (th TeamHeap) Less(i, j int) bool {\n    return th[i].Score() &lt; th[j].Score()\n}\n\nfunc (th TeamHeap) Swap(i, j int) {\n    th[i], th[j] = th[j], th[i]\n}\n\nfunc (th *TeamHeap) Push(t interface{}) {\n    *th = append(*th, t.(Scoreable))\n}\n\nfunc (th *TeamHeap) Pop() interface{} {\n    old := *th\n    n := len(old)\n    t := old[n-1]\n    *th = old[0 : n-1]\n    return t\n}\n\n\n// The main function\nfunc main() {\n\n    // Create a heap and initialize it\n    teams := &amp;TeamHeap{}\n    heap.Init(teams)\n\n    // Push the countries (NB: heap.Push(), not teams.Push())\n    heap.Push(teams, Country{\"Canada\", 7})\n    heap.Push(teams, Country{\"US\", 2})\n    heap.Push(teams, Country{\"Germany\", 3})\n    heap.Push(teams, Country{\"Korea\", 4})\n\n    // Take the two teams with lowest score and make a new team of them\n    // Repeat this until there's only one team left\n    for teams.Len() &gt; 1 {\n        t1 := heap.Pop(teams).(Scoreable)\n        t2 := heap.Pop(teams).(Scoreable)\n        heap.Push(teams, Team{t1, t2, t1.Score() + t2.Score()})\n    }\n\n    // Print the teams that we now have in the heap\n    for teams.Len() &gt; 0 {\n        t := heap.Pop(teams).(Team)\n        fmt.Println(t)\n    }\n}\n</code></pre>\n\n<p>You can find <a href=\"https://play.golang.org/p/WI48kkU2L1\" rel=\"nofollow noreferrer\">runnable code</a> on the Go Playground.</p>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 2, "last_activity_date": 1504118883, "creation_date": 1504118883, "answer_id": 45967761, "question_id": 45964047, "link": "https://stackoverflow.com/questions/45964047/how-to-recursively-loop-through-map-using-different-data-structures/45967761#45967761", "title": "How to recursively loop through map using different data structures", "body": "<pre><code>package main\n\nimport (\n    \"container/heap\"\n    \"fmt\"\n)\n\n//Recursive data structure may looks something like\ntype Group struct {\n    Score   int\n    Left    *Group\n    Right   *Group\n    Country string\n}\n\n//You can use slice to hold them organized in tree\ntype GrHeap []Group\n\n//To implement your logic you can use stdlib/container/heap Heap interface\n//you must implement Heap interface for your slice\nfunc (h GrHeap) Len() int           { return len(h) }\nfunc (h GrHeap) Less(i, j int) bool { return h[i].Score &lt; h[j].Score }\nfunc (h GrHeap) Swap(i, j int)      { h[i], h[j] = h[j], h[i] }\n\nfunc (h *GrHeap) Push(x interface{}) {\n    // Push and Pop use pointer receivers because they modify the slice's length,\n    // not just its contents.\n    *h = append(*h, x.(Group))\n}\n\nfunc (h *GrHeap) Pop() interface{} {\n    old := *h\n    n := len(old)\n    x := old[n-1]\n    *h = old[0 : n-1]\n    return x\n}\n\nfunc main() {\n    //you most likely already have a map\n    //anyway it will be handy to keep it for convenient access to individual country\n    score := map[string]int{\n        \"Canada\":  7,\n        \"US\":      2,\n        \"Germany\": 3,\n        \"Korea\":   4,\n    }\n    //here we allocate heap\n    gr := make(GrHeap, 0)\n    //populate it from map\n    for k, v := range score {\n        g := Group{v, nil, nil, k}\n        gr = append(gr, g)\n    }\n    //and initialize\n    heap.Init(&amp;gr)\n    //and here we use heap magic to implement your logic\n    for len(gr) &gt; 2 {\n        l := heap.Pop(&amp;gr).(Group)\n        r := heap.Pop(&amp;gr).(Group)\n        ng := Group{l.Score + r.Score, &amp;l, &amp;r, \"\"}\n        heap.Push(&amp;gr, ng)\n    }\n    fmt.Println(gr)\n    fmt.Println(gr[1].Left)\n    fmt.Println(gr[1].Right.Left)\n//and you can see it works https://play.golang.org/p/gugJxJb7rr\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 189, "user_id": 2016779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72a0c26a5ae386f8b4cd169ca40b25e4?s=128&d=identicon&r=PG", "display_name": "uoryon", "link": "https://stackoverflow.com/users/2016779/uoryon"}, "is_accepted": false, "score": 0, "last_activity_date": 1504175222, "creation_date": 1504175222, "answer_id": 45979169, "question_id": 45964047, "link": "https://stackoverflow.com/questions/45964047/how-to-recursively-loop-through-map-using-different-data-structures/45979169#45979169", "title": "How to recursively loop through map using different data structures", "body": "<p>You can try <code>map[string]interface{}</code> with <code>Type assertion</code>\u3002\nHere is the demo</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nconst total = \"total\"\n\n\nfunc GetValue(i interface{}) int {\n    value, ok := i.(int)\n    if ok {\n        return value\n    }\n    return i.(map[string]interface{})[total].(int)\n}\n\nfunc main() {\n    score := map[string]interface{}{\n        \"Canada\":  7,\n        \"US\":      2,\n        \"Germany\": 3,\n        \"Korea\":   4,\n    }\n    groupCount := 0\n\n    for len(score) &gt; 2 {\n        var (\n            firstMin  = math.MaxInt32\n            secondMin = math.MaxInt32\n            firstKey  = \"\"\n            secondKey = \"\"\n        )\n        for k, v := range score {\n            iv := GetValue(v)\n            if iv &lt; firstMin {\n                secondMin = firstMin\n                secondKey = firstKey\n                firstMin = iv\n                firstKey = k\n                continue\n            }\n            if iv &lt; secondMin {\n                secondMin = iv\n                secondKey = k\n                continue\n            }\n\n        }\n        groupCount++\n\n        score[fmt.Sprintf(\"Group%d\", groupCount)] = map[string]interface{}{\n            firstKey:  score[firstKey],\n            secondKey: score[secondKey],\n            total:     GetValue(score[firstKey])+ GetValue(score[secondKey]),\n        }\n        delete(score, firstKey)\n        delete(score, secondKey)\n    }\n    fmt.Println(score)\n}\n</code></pre>\n\n<p>Here is the link <a href=\"https://play.golang.org/p/qq5qwAsh1m\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qq5qwAsh1m</a></p>\n"}], "owner": {"reputation": 43, "user_id": 8537167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1feb5a370afc6f979f9f05981160b50b?s=128&d=identicon&r=PG&f=1", "display_name": "Mat&#237;as Salen", "link": "https://stackoverflow.com/users/8537167/mat%c3%adas-salen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 807, "favorite_count": 1, "accepted_answer_id": 45967601, "answer_count": 3, "score": 3, "last_activity_date": 1504175222, "creation_date": 1504105918, "last_edit_date": 1504110079, "question_id": 45964047, "link": "https://stackoverflow.com/questions/45964047/how-to-recursively-loop-through-map-using-different-data-structures", "title": "How to recursively loop through map using different data structures", "body": "<p>I'm trying to figure out the best way to recursively go through a <code>[string]int</code> map in Go. I'm building a game in which multiple countries are involved, and grouped together by teams of two in the end.</p>\n\n<p>The goal is to match the first two countries with the lowest 'score' into its own group of two, and add it back to the collection giving the new map a total value of the scores of those countries.</p>\n\n<p>Then recursively doing that to all the groups, ending up with one group and one total value in the end.</p>\n\n<p>For example, if you had:</p>\n\n<pre><code>score := map[string]int{\n        \"Canada\": 7,\n        \"US\": 2,\n        \"Germany\": 3,\n        \"Korea\": 4,\n}\n</code></pre>\n\n<p>group1 = <code>{[US:2] [Germany:3]}</code> with a total of 5</p>\n\n<p>group1 would now be put back into the initial collection with a 'score' of 5 since it takes the two lowest scores. We would now have:</p>\n\n<pre><code>score := map[string]int{\n        \"Canada\": 7,\n        \"Korea\": 4,\n        group1: `US:2 Germany:3` with a total of 5\n}\n</code></pre>\n\n<p>If this was now the lowest score in the collection, the next iteration would be:</p>\n\n<p>group2 = <code>{[Korea:4] [group1:5]}</code></p>\n\n<pre><code> score := map[string]int{\n            \"Canada\": 7,\n            group2: `Korea:4 group1:5` with a total of 9\n  }\n</code></pre>\n\n<p>And so on until you're left with one.. I think the basic structure should be something like this. However, I'm unsure of the proper way to do this since the data structure is now encompassing a <code>[string]int</code> map, as well as this new map. </p>\n\n<p>I realize this is not such a generic question, but could an interface be used for this? I'm very new to Go, so advice would be helpful.</p>\n\n<p>Here is an example to further illustrate what I mean:\n<a href=\"https://play.golang.org/p/cnkTc0HBY4\" rel=\"nofollow noreferrer\">https://play.golang.org/p/cnkTc0HBY4</a></p>\n"}, {"tags": ["go", "go-templates", "hugo"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1504104915, "post_id": 45963231, "comment_id": 78886025, "body": "Try <code>{{ partial &quot;li.html&quot; (dict &quot;test&quot; $test &quot;Term&quot; $root.Data.Term ) }}</code>, then access them with <code>.test</code> and <code>.Term</code>. Based-on: <a href=\"https://gohugo.io/functions/dict/\" rel=\"nofollow noreferrer\">https://gohugo.io/functions/dict/</a>"}], "answers": [{"tags": [], "owner": {"reputation": 361, "user_id": 2201872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/541f6517b1b15698ca9ea2607191810a?s=128&d=identicon&r=PG", "display_name": "Boehrsi", "link": "https://stackoverflow.com/users/2201872/boehrsi"}, "is_accepted": true, "score": 13, "last_activity_date": 1582326141, "last_edit_date": 1582326141, "creation_date": 1529259051, "answer_id": 50899259, "question_id": 45963231, "link": "https://stackoverflow.com/questions/45963231/in-a-hugo-partial-template-how-do-i-access-secondary-additional-parameters/50899259#50899259", "title": "In a Hugo partial template, how do I access secondary/additional parameters?", "body": "<p>I would suggest using the hugo <strong>dict</strong> function. It allows you to use key/value pairs to pass information. The <a href=\"https://gohugo.io/functions/dict/\" rel=\"noreferrer\">documentation</a> states that for your use case.</p>\n\n<pre><code>{{ partial \"yourPartial\" (dict \"test\" \"yourTestData\" \"term\" \"yourTerm\") }}\n</code></pre>\n\n<p>You can then access the values by just using <strong>{{ .test }}</strong> and <strong>{{ .term }}</strong>.</p>\n\n<p>Alternatively you can use the <a href=\"https://gohugo.io/functions/scratch/\" rel=\"noreferrer\">scratch</a> function, which is a more \"global\" approach.</p>\n"}], "owner": {"reputation": 1897, "user_id": 473368, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4e24aa1cfabf417ef8833ea8721a66a8?s=128&d=identicon&r=PG", "display_name": "01AutoMonkey", "link": "https://stackoverflow.com/users/473368/01automonkey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2291, "favorite_count": 2, "accepted_answer_id": 50899259, "answer_count": 1, "score": 9, "last_activity_date": 1582326141, "creation_date": 1504103659, "question_id": 45963231, "link": "https://stackoverflow.com/questions/45963231/in-a-hugo-partial-template-how-do-i-access-secondary-additional-parameters", "title": "In a Hugo partial template, how do I access secondary/additional parameters?", "body": "<p>Say I have <code>{{ partial \"li.html\" $test $root.Data.Term }}</code>.</p>\n\n<p>With this I can can access the first parameter, or <code>$test</code>, by simply refering to <code>.</code> within the <code>li.html</code> template, but how do I access the second or additional parameter (<code>$root.Data.Term</code>) from within the same template?</p>\n"}, {"tags": ["mysql", "database", "go", "many-to-many", "go-gorm"], "comments": [{"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1504715701, "post_id": 45961815, "comment_id": 79122093, "body": "Is &quot;recursive&quot; the correct term for this?"}, {"owner": {"reputation": 1041, "user_id": 7730968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kCdXw.png?s=128&g=1", "display_name": "kenfire", "link": "https://stackoverflow.com/users/7730968/kenfire"}, "reply_to_user": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1504716058, "post_id": 45961815, "comment_id": 79122304, "body": "@RickJames Yes absolutely, maybe in English there is another word for this but here is an example: <a href=\"http://www.tomjewett.com/dbdesign/dbdesign.php?page=recursive.php\" rel=\"nofollow noreferrer\">tomjewett.com/dbdesign/dbdesign.php?page=recursive.php</a>"}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1504716463, "post_id": 45961815, "comment_id": 79122556, "body": "Oh, in SQL terminology, that is &quot;hierarchical&quot;.  And the Manager-Employee example is 1:Many, not many:many.  Notice this single <code>parent_id</code> link.  Granted the &quot;matrix&quot; organization leads to the need for many:many."}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 1, "creation_date": 1504716508, "post_id": 45961815, "comment_id": 79122587, "body": "Since I don&#39;t have a concept of &quot;manual equipment&quot; and &quot;auto equipment&quot;, I am having trouble wrapping my head around the problem space."}, {"owner": {"reputation": 1041, "user_id": 7730968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kCdXw.png?s=128&g=1", "display_name": "kenfire", "link": "https://stackoverflow.com/users/7730968/kenfire"}, "reply_to_user": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1504717461, "post_id": 45961815, "comment_id": 79123095, "body": "@RickJames Edited the question, hope this is more clear"}, {"owner": {"reputation": 5938, "user_id": 7284356, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FW3hS.png?s=128&g=1", "display_name": "Rei", "link": "https://stackoverflow.com/users/7284356/rei"}, "edited": false, "score": 0, "creation_date": 1504725145, "post_id": 45961815, "comment_id": 79127282, "body": "If I&#39;m reading your question correctly, you don&#39;t need many-to-many, you need one-to-one. An alternative simpler design would be storing user modifications in separate fields in the same record."}, {"owner": {"reputation": 1041, "user_id": 7730968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kCdXw.png?s=128&g=1", "display_name": "kenfire", "link": "https://stackoverflow.com/users/7730968/kenfire"}, "reply_to_user": {"reputation": 5938, "user_id": 7284356, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FW3hS.png?s=128&g=1", "display_name": "Rei", "link": "https://stackoverflow.com/users/7284356/rei"}, "edited": false, "score": 0, "creation_date": 1504864500, "post_id": 45961815, "comment_id": 79189457, "body": "@Rei Yes you are right about one-to-one association."}], "answers": [{"comments": [{"owner": {"reputation": 1041, "user_id": 7730968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kCdXw.png?s=128&g=1", "display_name": "kenfire", "link": "https://stackoverflow.com/users/7730968/kenfire"}, "edited": false, "score": 0, "creation_date": 1505112329, "post_id": 46095192, "comment_id": 79260756, "body": "How can I distinguish manual equipment from automatic ones ? Do I have to add a type in the structure ?"}], "tags": [], "owner": {"reputation": 768, "user_id": 1038386, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SOhSk.jpg?s=128&g=1", "display_name": "Meehow", "link": "https://stackoverflow.com/users/1038386/meehow"}, "is_accepted": true, "score": 1, "last_activity_date": 1511658952, "last_edit_date": 1511658952, "creation_date": 1504783630, "answer_id": 46095192, "question_id": 45961815, "link": "https://stackoverflow.com/questions/45961815/how-can-i-create-a-recursive-association-using-gorm/46095192#46095192", "title": "How can I create a recursive association using GORM?", "body": "<p>When it's \"many\", then you need an array/slice:</p>\n\n<pre><code>type Equipment struct {\n    ID        uint\n    Ip        string\n    Equipment []Equipment `gorm:\"many2many:manual_auto\"`\n}\n</code></pre>\n\n<p>also names of your manually created schema does not match names from struct. Or you can use <a href=\"http://jinzhu.me/gorm/database.html#migration\" rel=\"nofollow noreferrer\">db.AutoMigrate</a> or define column names in gorm tags:</p>\n\n<pre><code>type Equipment struct {\n    ID        uint        `gorm:\"column:equipment_id\"`\n    Ip        string      `gorm:\"column:manage_ip\"`\n    Equipment []Equipment `gorm:\"many2many:manual_auto\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 1041, "user_id": 7730968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kCdXw.png?s=128&g=1", "display_name": "kenfire", "link": "https://stackoverflow.com/users/7730968/kenfire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 674, "favorite_count": 2, "accepted_answer_id": 46095192, "answer_count": 1, "score": 1, "last_activity_date": 1523978337, "creation_date": 1504099785, "last_edit_date": 1523978337, "question_id": 45961815, "link": "https://stackoverflow.com/questions/45961815/how-can-i-create-a-recursive-association-using-gorm", "title": "How can I create a recursive association using GORM?", "body": "<p><strong>Question:</strong> How can I create a recursive association using <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">GORM</a>?</p>\n\n<p><strong>Context:</strong> I have an equipment that can be define manually as well as automatically. I want to associate a manual equipment with the automatically defined one.\nSo I decided to create a table for this many2many association.\n</p>\n\n<pre><code>CREATE TABLE `equipment` (\n  `equipment_id` int(11) NOT NULL,\n  `manage_ip` varchar(50) CHARACTER SET utf8 COLLATE utf8_unicode_ci NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\nALTER TABLE `equipment`\n  ADD PRIMARY KEY (`equipment_id`),\n  ADD UNIQUE KEY `unique_equipment` (`model_id`,`manage_ip`);\n\nCREATE TABLE `manual_auto` (\n  `manual_id` int(11) NOT NULL,\n  `auto_id` int(11) NOT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\nALTER TABLE `manual_auto`\n  ADD PRIMARY KEY (`manual_id`,`auto_id`),\n  ADD KEY `FK_AUTO` (`auto_id`);\n\nALTER TABLE `manual_auto`\n  ADD CONSTRAINT `FK_AUTO` FOREIGN KEY (`auto_id`) REFERENCES `equipment` (`equipment_id`),\n  ADD CONSTRAINT `FK_MANUAL` FOREIGN KEY (`manual_id`) REFERENCES `equipment` (`equipment_id`);\n</code></pre>\n\n<p>I know that I can create a many2many association table using <code>gorm:\"many2many:manual_auto\"</code>.\nMore info on associations with GORM: <a href=\"http://jinzhu.me/gorm/associations.html#belongs-to\" rel=\"nofollow noreferrer\">http://jinzhu.me/gorm/associations.html#belongs-to</a></p>\n\n<pre class=\"lang-go prettyprint-override\"><code>type Equipment struct {\n    ID        uint\n    Ip        string\n    Equipment Equipment `gorm:\"many2many:manual_auto\"`\n}\n</code></pre>\n\n<p>Thank you in advance.</p>\n\n<p><strong>Edit:</strong> More information about the context</p>\n\n<p>I want to have two version of an equipment, one will be created automaticity by fetching another database. Then if any user make a modification about the description of the equipment I want to have 2 version of this equipment, \"manual_equipement\" and \"automatic_equipment\".</p>\n"}, {"tags": ["go", "aerospike"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1504099075, "post_id": 45961495, "comment_id": 78881330, "body": "Where is your code? What didn&#39;t work about it?"}, {"owner": {"reputation": 365, "user_id": 4209197, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-S-iRCg3HGPI/AAAAAAAAAAI/AAAAAAAAAD8/liPIrcpt7_4/photo.jpg?sz=128", "display_name": "Dipen Adroja", "link": "https://stackoverflow.com/users/4209197/dipen-adroja"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1504099261, "post_id": 45961495, "comment_id": 78881507, "body": "I am not able to figure out a way to map the recordSet to array of my struct :(. What I initially tried was converting the record.Bins to json object and then tried to unmarshal it to struct object. But that didn&#39;t work. If there is any other way then let me know. Any references/examples? @Flimzy"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1504099388, "post_id": 45961495, "comment_id": 78881613, "body": "Please show us your code, and explain what didn&#39;t work."}, {"owner": {"reputation": 365, "user_id": 4209197, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-S-iRCg3HGPI/AAAAAAAAAAI/AAAAAAAAAD8/liPIrcpt7_4/photo.jpg?sz=128", "display_name": "Dipen Adroja", "link": "https://stackoverflow.com/users/4209197/dipen-adroja"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1504099395, "post_id": 45961495, "comment_id": 78881622, "body": "why down vote??"}, {"owner": {"reputation": 365, "user_id": 4209197, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-S-iRCg3HGPI/AAAAAAAAAAI/AAAAAAAAAD8/liPIrcpt7_4/photo.jpg?sz=128", "display_name": "Dipen Adroja", "link": "https://stackoverflow.com/users/4209197/dipen-adroja"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1504099865, "post_id": 45961495, "comment_id": 78882007, "body": "updated the question with the code in which I am trying to map the individual records to struct @Flimzy"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1504099953, "post_id": 45961495, "comment_id": 78882071, "body": "That&#39;s an improvement, thanks. But it&#39;s not complete code... where are you defining a variable of type <code>map[interface{}]interface{}</code>?"}, {"owner": {"reputation": 365, "user_id": 4209197, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-S-iRCg3HGPI/AAAAAAAAAAI/AAAAAAAAAD8/liPIrcpt7_4/photo.jpg?sz=128", "display_name": "Dipen Adroja", "link": "https://stackoverflow.com/users/4209197/dipen-adroja"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1504100021, "post_id": 45961495, "comment_id": 78882119, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/153258/discussion-between-dipen-adroja-and-flimzy\">continue this discussion in chat</a>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504100438, "post_id": 45961495, "comment_id": 78882482, "body": "Is the error you&#39;re getting from Marshal, or Unmarshal?"}, {"owner": {"reputation": 365, "user_id": 4209197, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-S-iRCg3HGPI/AAAAAAAAAAI/AAAAAAAAAD8/liPIrcpt7_4/photo.jpg?sz=128", "display_name": "Dipen Adroja", "link": "https://stackoverflow.com/users/4209197/dipen-adroja"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504100532, "post_id": 45961495, "comment_id": 78882562, "body": "From Marshal @mkopriva"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1504100810, "post_id": 45961495, "comment_id": 78882782, "body": "That means that one of the <a href=\"https://godoc.org/github.com/aerospike/aerospike-client-go#BinMap\" rel=\"nofollow noreferrer\">BinMap</a> values in <code>Record.Bins</code> is of the type <code>map[interface{}]interface{}</code>, which, as you can see by the error, is unsupported by <code>encoding&#47;json</code>. So marshaling/unmarshaling is not gonna help you, you&#39;ll have to look for a different solution."}, {"owner": {"reputation": 365, "user_id": 4209197, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-S-iRCg3HGPI/AAAAAAAAAAI/AAAAAAAAAD8/liPIrcpt7_4/photo.jpg?sz=128", "display_name": "Dipen Adroja", "link": "https://stackoverflow.com/users/4209197/dipen-adroja"}, "edited": false, "score": 0, "creation_date": 1504101268, "post_id": 45961495, "comment_id": 78883195, "body": "ohh... thanks... I am trying to map individual element by iterating the map.. I will let you know if that works"}], "owner": {"reputation": 365, "user_id": 4209197, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-S-iRCg3HGPI/AAAAAAAAAAI/AAAAAAAAAD8/liPIrcpt7_4/photo.jpg?sz=128", "display_name": "Dipen Adroja", "link": "https://stackoverflow.com/users/4209197/dipen-adroja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 264, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504099754, "creation_date": 1504098907, "last_edit_date": 1504099754, "question_id": 45961495, "link": "https://stackoverflow.com/questions/45961495/how-to-convert-aerospike-binmap-to-array-of-struct-in-go-lang", "title": "How to convert aerospike binMap to array of struct in Go lang?", "body": "<p>I am reading all record set from aerospike set as below:</p>\n\n<pre><code>stmt :=  as.NewStatement(namespace, set)\nrecordSet, err := db.AerospikeClient.Query(nil,stmt)\n</code></pre>\n\n<p>now I want to map the result records to the struct of the set. How can I do that?</p>\n\n<p>I tried mapping record.Bins to struct but it didn't worked.\nThe result should be array of below struct:</p>\n\n<pre><code>type MyStruct struct {\n  name           string     `as:\"userId\" json:\"userId\"`\n  UserList  []UserList `as:\"userList\" json:\"userList\"`\n  CreatedAt        int64      `as:\"createdAt\" json:\"createdAt\"`\n  UpdatedAt        int64      `as:\"updatedAt\" json:\"updatedAt\"`\n}\n</code></pre>\n\n<p>Here is the code that I tried:</p>\n\n<pre><code>for rec := range recordSet.Records {\n    var myStruct MyStruct\n    jsonString, err := json.Marshal(rec.Bins)\n    if err != nil {\n        utils.LogErr(\"\",\"\", \"Error occurred while marshling all the records from old set to my struct\", err)\n        return nil, err\n    }\n    err = json.Unmarshal(jsonString,&amp;myStruct)\n}\n</code></pre>\n\n<p>It is giving below error:</p>\n\n<blockquote>\n  <p>\"error\":\"json: unsupported type: map[interface {}]interface {}\"</p>\n</blockquote>\n"}, {"tags": ["go", "visual-studio-code", "vscode-settings"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1504098043, "post_id": 45961085, "comment_id": 78880418, "body": "You can&#39;t have more than one <code>main</code> in a single program. All files in a directory are part of the same package. If you want A and B to be separate &quot;services&quot;, they need to live in different directories."}, {"owner": {"reputation": 680, "user_id": 2970729, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9a4c525a91ef9d26bfb3e97233f8fda3?s=128&d=identicon&r=PG&f=1", "display_name": "DotnetProg", "link": "https://stackoverflow.com/users/2970729/dotnetprog"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1504098095, "post_id": 45961085, "comment_id": 78880466, "body": "It&#39;s not a single program, it&#39;s 2 different programs sitting under the same directory. In Goland you can have configuration profiles for each service."}, {"owner": {"reputation": 680, "user_id": 2970729, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9a4c525a91ef9d26bfb3e97233f8fda3?s=128&d=identicon&r=PG&f=1", "display_name": "DotnetProg", "link": "https://stackoverflow.com/users/2970729/dotnetprog"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1504098175, "post_id": 45961085, "comment_id": 78880540, "body": "Then how come it works with Goland?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1504098187, "post_id": 45961085, "comment_id": 78880551, "body": "It doesn&#39;t. I assure you."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 6, "creation_date": 1504098252, "post_id": 45961085, "comment_id": 78880608, "body": "One directory, one package. Never more. That simple. No reason to argue here."}, {"owner": {"reputation": 680, "user_id": 2970729, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9a4c525a91ef9d26bfb3e97233f8fda3?s=128&d=identicon&r=PG&f=1", "display_name": "DotnetProg", "link": "https://stackoverflow.com/users/2970729/dotnetprog"}, "edited": false, "score": 0, "creation_date": 1504098302, "post_id": 45961085, "comment_id": 78880653, "body": "Ok saying stuff like that isn&#39;t helping. In Goland you have the option to choose what file to run. I&#39;m pretty sure it&#39;s possible to choose that also in VS code."}, {"owner": {"reputation": 680, "user_id": 2970729, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9a4c525a91ef9d26bfb3e97233f8fda3?s=128&d=identicon&r=PG&f=1", "display_name": "DotnetProg", "link": "https://stackoverflow.com/users/2970729/dotnetprog"}, "edited": false, "score": 0, "creation_date": 1504098346, "post_id": 45961085, "comment_id": 78880703, "body": "I have both Goland and VS code on machine - and it works with goland. You can&#39;t argue with that."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1504099253, "post_id": 45961085, "comment_id": 78881500, "body": "@DotnetProg I have a vague feeling that you might be bit by having a habit of using <code>go run file1 [file2 [...]]</code> to do compile&amp;run rounds outside of vscode.  The &quot;problem&quot; is that it&#39;s a &quot;degraded&quot; case not normally used for &quot;real&quot; Go projects. When working on a project &quot;the regular way&quot;, you typically do <code>go install [package_spec]</code> which either uses <i>the whole</i> current directory or walks a tree of them speficied by <code>package_spec</code>, builds and installs everything there which is not up-to-date. <i>This</i> won&#39;t work with two files in the same difectory both containing <code>main()</code> in package &quot;main&quot;."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1504099308, "post_id": 45961085, "comment_id": 78881552, "body": "@DotnetProg, \u2026so it may well be the case then when you hit whatever stands for &quot;run&quot; in vscode, it really attempts to do something akin to <code>go install</code>, and fails."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1504103604, "post_id": 45961085, "comment_id": 78885038, "body": "VSCode does <code>go build</code> then runs the executable, which is what an IDE <i>should</i> do. Gogland is probably doing <code>go run</code>, which is a terrible practice, and should be avoided - one reason being that it masks exactly these kinds of issues, where you have an invalid package with multiple <code>main</code> declarations in one package."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1504163715, "post_id": 45961085, "comment_id": 78909351, "body": "@DotnetProg JFTR you might find these <a href=\"https://dave.cheney.net/2014/06/04/what-does-go-build-build\" rel=\"nofollow noreferrer\">two</a> short <a href=\"https://dave.cheney.net/2014/01/21/using-go-test-build-and-install\" rel=\"nofollow noreferrer\">posts</a> to be of interest as they basically serve as a quick intro to what <code>go</code> tool can do with the Go code."}, {"owner": {"reputation": 680, "user_id": 2970729, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9a4c525a91ef9d26bfb3e97233f8fda3?s=128&d=identicon&r=PG&f=1", "display_name": "DotnetProg", "link": "https://stackoverflow.com/users/2970729/dotnetprog"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1504170660, "post_id": 45961085, "comment_id": 78913801, "body": "@kostix and Adrian Thanks a lot for all the information and people who tried to help. I&#39;ll look into it later on today. In the meanwhile, I decided not to waste anymore time on VS code for now, I&#39;ll go with Gogland for now, and when I have more time (and experience with go) I&#39;ll try to get my project to work with VS code."}], "answers": [{"comments": [{"owner": {"reputation": 680, "user_id": 2970729, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9a4c525a91ef9d26bfb3e97233f8fda3?s=128&d=identicon&r=PG&f=1", "display_name": "DotnetProg", "link": "https://stackoverflow.com/users/2970729/dotnetprog"}, "edited": false, "score": 0, "creation_date": 1504170751, "post_id": 45963008, "comment_id": 78913865, "body": "Thanks a lot, tried to get this configuration to work but no success. In the meanwhile - I&#39;ll just go with Gogland, and look into your answer more thoroughly when I have more experience with Go."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "reply_to_user": {"reputation": 680, "user_id": 2970729, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9a4c525a91ef9d26bfb3e97233f8fda3?s=128&d=identicon&r=PG&f=1", "display_name": "DotnetProg", "link": "https://stackoverflow.com/users/2970729/dotnetprog"}, "edited": false, "score": 0, "creation_date": 1504173312, "post_id": 45963008, "comment_id": 78915750, "body": "@DotnetProg, What was the error? I&#39;ve tried it, and it works. You have to open and view the file that you want to run."}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 10, "last_activity_date": 1563737886, "last_edit_date": 1563737886, "creation_date": 1504103025, "answer_id": 45963008, "question_id": 45961085, "link": "https://stackoverflow.com/questions/45961085/visual-studio-code-with-go-multiple-main-declarations-launch-settings/45963008#45963008", "title": "Visual Studio Code with GO - Multiple main declarations (launch settings)", "body": "<p><em>Disclaimer</em>: <strong>this is not the recommended approach</strong>, I agree with others, you shall separate the <em>service</em> A and B into different directory. </p>\n\n<p>Answer to your question: To launch a specific file, use the following configuration to emulate <code>go run current-file</code>:</p>\n\n<pre><code>{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"Run current file\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"exec\",\n            \"program\": \"full-path-to-go.exe\",\n            \"args\": [\"run\", \"${file}\"],\n            \"showLog\": true\n        }\n    ]\n}\n</code></pre>\n\n<p>Mode <code>exec</code> is for launching pre-built binary given in the property <code>program</code> (you must specify full path to <code>go</code> binary). Then as the arguments, just add <code>run</code> and filename (<code>${file}</code>) to property <code>args</code>. </p>\n"}], "owner": {"reputation": 680, "user_id": 2970729, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9a4c525a91ef9d26bfb3e97233f8fda3?s=128&d=identicon&r=PG&f=1", "display_name": "DotnetProg", "link": "https://stackoverflow.com/users/2970729/dotnetprog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5168, "favorite_count": 2, "accepted_answer_id": 45963008, "answer_count": 1, "score": 0, "last_activity_date": 1563737886, "creation_date": 1504097819, "last_edit_date": 1504106274, "question_id": 45961085, "link": "https://stackoverflow.com/questions/45961085/visual-studio-code-with-go-multiple-main-declarations-launch-settings", "title": "Visual Studio Code with GO - Multiple main declarations (launch settings)", "body": "<p>I'm new to VS code and Golang.<br>\nI have an existing project containing 2 different services - let's call one A and the second one B.<br>\nBoth A and B sits under the same directory.</p>\n\n<p>Whenever I try to run A or B, I get the following error :</p>\n\n<pre><code># directory/directory/directory/A&amp;B_Directory\n./A.go:12:6: main redeclared in this block\n    previous declaration at ./B.go:18:6\n</code></pre>\n\n<p>I tried playing with the <code>launch.json</code> file, adding the following sections : </p>\n\n<pre><code>   {\n        \"name\": \"Launch Program\",\n        \"type\": \"go\",\n        \"request\": \"launch\",\n        \"mode\": \"debug\",\n        \"program\": \"FullDirectory/A.go\"\n    }\n</code></pre>\n\n<p>Also tried in the program attribute to set to <code>${file}</code> and many other variations that failed.</p>\n\n<p>I'd love for some direction, I'm kinda lost.\nThanks.</p>\n"}, {"tags": ["regex", "go"], "answers": [{"tags": [], "owner": {"reputation": 4196, "user_id": 7653073, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xjiZj.jpg?s=128&g=1", "display_name": "Malte Hartwig", "link": "https://stackoverflow.com/users/7653073/malte-hartwig"}, "is_accepted": false, "score": 1, "last_activity_date": 1504095913, "creation_date": 1504095913, "answer_id": 45960376, "question_id": 45960277, "link": "https://stackoverflow.com/questions/45960277/capturing-uppercase-words-in-text-with-regex/45960376#45960376", "title": "Capturing uppercase words in text with regex", "body": "<p>Replace the <code>*</code>s by <code>+</code>s, and your regex only matches the words in the first sentence.</p>\n\n<p><code>.*</code> also matches the empty string. Looking at you regex and ignoring both <code>[A-Z]*</code>, all that remains is a sequence of spaces. Using <code>+</code> makes sure that there is at least one uppercase char between every now and then.</p>\n"}, {"comments": [{"owner": {"reputation": 7490, "user_id": 1515697, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/733f4b3d2139b2faa5188c9656785e50?s=128&d=identicon&r=PG", "display_name": "Romeo Mihalcea", "link": "https://stackoverflow.com/users/1515697/romeo-mihalcea"}, "edited": false, "score": 0, "creation_date": 1504097207, "post_id": 45960392, "comment_id": 78879743, "body": "Good catch. Any way I can make sure the match starts with a letter and not with a space?"}, {"owner": {"reputation": 16241, "user_id": 4927984, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/cKD3n.png?s=128&g=1", "display_name": "Mistalis", "link": "https://stackoverflow.com/users/4927984/mistalis"}, "reply_to_user": {"reputation": 7490, "user_id": 1515697, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/733f4b3d2139b2faa5188c9656785e50?s=128&d=identicon&r=PG", "display_name": "Romeo Mihalcea", "link": "https://stackoverflow.com/users/1515697/romeo-mihalcea"}, "edited": false, "score": 0, "creation_date": 1504097291, "post_id": 45960392, "comment_id": 78879796, "body": "@RomeoMihalcea Of course, change the first <code>*</code> to a <code>+</code> as well! ;-)"}], "tags": [], "owner": {"reputation": 16241, "user_id": 4927984, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/cKD3n.png?s=128&g=1", "display_name": "Mistalis", "link": "https://stackoverflow.com/users/4927984/mistalis"}, "is_accepted": true, "score": 2, "last_activity_date": 1504095965, "creation_date": 1504095965, "answer_id": 45960392, "question_id": 45960277, "link": "https://stackoverflow.com/questions/45960277/capturing-uppercase-words-in-text-with-regex/45960392#45960392", "title": "Capturing uppercase words in text with regex", "body": "<p>In your regex, you just need to change the second <code>*</code> for a <code>+</code>:</p>\n\n<pre><code>[A-Z]*(?: +[A-Z]+){4,}\n</code></pre>\n\n<h3>Explanation</h3>\n\n<p>While using <code>(?: +[A-Z]*)</code>, you are matchin \"<em>a space followed by 0+ letters</em>\". So you are matching spaces. When replacing the <code>*</code> by a <code>+</code>, you matches spaces if there are uppercase after.</p>\n\n<h2><a href=\"https://regex101.com/r/BmXHFP/4\" rel=\"nofollow noreferrer\">Demo on regex101</a></h2>\n"}, {"tags": [], "owner": {"reputation": 46525, "user_id": 7294900, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/Pdqi4.gif?s=128&g=1", "display_name": "user7294900", "link": "https://stackoverflow.com/users/7294900/user7294900"}, "is_accepted": false, "score": 1, "last_activity_date": 1504096718, "last_edit_date": 1504096718, "creation_date": 1504095969, "answer_id": 45960394, "question_id": 45960277, "link": "https://stackoverflow.com/questions/45960277/capturing-uppercase-words-in-text-with-regex/45960394#45960394", "title": "Capturing uppercase words in text with regex", "body": "<p>You had to mark at least 1 upper case as <code>[A-Z]*(?: +[A-Z]+){4,}</code> see updated <a href=\"https://regex101.com/r/BmXHFP/3\" rel=\"nofollow noreferrer\">regex</a>.</p>\n\n<p>A better Regex will allow non spaces as <code>[A-Z]*(?: *[A-Z]+){4,}</code>.see better <a href=\"https://regex101.com/r/BmXHFP/5\" rel=\"nofollow noreferrer\">regex</a></p>\n\n<p><code>*</code> After <code></code> will indicate to allow at least upper case even without spaces.</p>\n"}], "owner": {"reputation": 7490, "user_id": 1515697, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/733f4b3d2139b2faa5188c9656785e50?s=128&d=identicon&r=PG", "display_name": "Romeo Mihalcea", "link": "https://stackoverflow.com/users/1515697/romeo-mihalcea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 45960392, "answer_count": 3, "score": 1, "last_activity_date": 1504096718, "creation_date": 1504095642, "last_edit_date": 1504096148, "question_id": 45960277, "link": "https://stackoverflow.com/questions/45960277/capturing-uppercase-words-in-text-with-regex", "title": "Capturing uppercase words in text with regex", "body": "<p>I'm trying to find words that are in uppercase in a given piece of text. The words must be one after the other to be considered and they must be at least 4 of them.</p>\n\n<p>I have a \"almost\" working code but it captures much more: <code>[A-Z]*(?: +[A-Z]*){4,}</code>. The capture group also includes spaces at the start or the end of those words (like a boundary).</p>\n\n<p>I have a playground if you want to test it out: <a href=\"https://regex101.com/r/BmXHFP/2\" rel=\"nofollow noreferrer\">https://regex101.com/r/BmXHFP/2</a></p>\n\n<p>Is there a way to make the regex in example capture only the words in the first sentence? The language I'm using is <code>Go</code> and it has no look-behind/ahead.</p>\n"}, {"tags": ["go", "terraform"], "comments": [{"owner": {"reputation": 1904, "user_id": 4199257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a35d9af9e7b63ce83be860f2ddcfa7c?s=128&d=identicon&r=PG&f=1", "display_name": "fernandezcuesta", "link": "https://stackoverflow.com/users/4199257/fernandezcuesta"}, "edited": false, "score": 4, "creation_date": 1504090359, "post_id": 45957208, "comment_id": 78874656, "body": "This may happen if you use go &lt; 1.9 (see <a href=\"https://github.com/hashicorp/terraform#developing-terraform\" rel=\"nofollow noreferrer\">Developing Terraform</a>)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504098928, "post_id": 45957208, "comment_id": 78881205, "body": "See <a href=\"https://golang.org/doc/go1.9#test-helper\" rel=\"nofollow noreferrer\">golang.org/doc/go1.9#test-helper</a>"}], "answers": [{"tags": [], "owner": {"reputation": 28957, "user_id": 281848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w7nJW.jpg?s=128&g=1", "display_name": "Martin Atkins", "link": "https://stackoverflow.com/users/281848/martin-atkins"}, "is_accepted": false, "score": 1, "last_activity_date": 1504219348, "creation_date": 1504219348, "answer_id": 45991063, "question_id": 45957208, "link": "https://stackoverflow.com/questions/45957208/building-a-custom-terraform-provider-errors-out/45991063#45991063", "title": "Building a custom terraform provider errors out", "body": "<p>As of the 0.10.3 release, Terraform core now requires Go 1.9 due to the use of the new \"test helper\" feature.</p>\n\n<p>Since providers depend on some packages from the core system as libraries, this dependency is unfortunately then inherited by the providers too. If you're using <em>vendoring</em> to make Terraform core available to the provider (recommended!) then you can potentially wind back the vendored version to <a href=\"https://github.com/hashicorp/terraform/commit/b6047dcf9ee42abc415fe769ed5ef643972f6aef\" rel=\"nofollow noreferrer\">the final commit before this change</a> in order to build with 1.8, though over time this strategy will of course cause the vendored package to fall behind the latest changes.</p>\n\n<p>Upgrading Go to 1.9 should address this in a more permanent way.</p>\n"}], "owner": {"reputation": 31, "user_id": 6182908, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/39ad7338aa17f1f8e28b504f042117ce?s=128&d=identicon&r=PG&f=1", "display_name": "Rakshith", "link": "https://stackoverflow.com/users/6182908/rakshith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1504219348, "creation_date": 1504086745, "question_id": 45957208, "link": "https://stackoverflow.com/questions/45957208/building-a-custom-terraform-provider-errors-out", "title": "Building a custom terraform provider errors out", "body": "<p>I am hitting this error while i try to compile GO code    </p>\n\n<pre><code>[root@scsor0014444001 Netapp]# go build -o terraform-provider-xxxx\n# github.com/hashicorp/terraform/config\n../go/src/github.com/hashicorp/terraform/config/testing.go:9: t.Helper undefined (type *testing.T has no field or method Helper)\n\n[root@scsor0014444001 Netapp]# go version\ngo version go1.8.3 linux/amd64\n</code></pre>\n\n<p>Can someone help me in understanding whats wrong here ?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1504076360, "post_id": 45953307, "comment_id": 78865668, "body": "you need to enclose the numbers into double quotes."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504076709, "post_id": 45953307, "comment_id": 78865851, "body": "<a href=\"https://play.golang.org/p/krzFBLJWwG\" rel=\"nofollow noreferrer\">play.golang.org/p/krzFBLJWwG</a>"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1504078175, "post_id": 45953307, "comment_id": 78866721, "body": "Is there a special reason not to use a slice? A list of something should be represented as an array in JSOn."}, {"owner": {"reputation": 1478, "user_id": 4728650, "user_type": "registered", "accept_rate": 91, "profile_image": "https://graph.facebook.com/1642705992615708/picture?type=large", "display_name": "Viet Phan", "link": "https://stackoverflow.com/users/4728650/viet-phan"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1504078962, "post_id": 45953307, "comment_id": 78867179, "body": "@MarkusWMahlberg it&#39;s the design of other people, I have to follow it"}, {"owner": {"reputation": 1478, "user_id": 4728650, "user_type": "registered", "accept_rate": 91, "profile_image": "https://graph.facebook.com/1642705992615708/picture?type=large", "display_name": "Viet Phan", "link": "https://stackoverflow.com/users/4728650/viet-phan"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504079468, "post_id": 45953307, "comment_id": 78867497, "body": "@mkopriva oh my god. damn it. thank you"}], "answers": [{"comments": [{"owner": {"reputation": 1478, "user_id": 4728650, "user_type": "registered", "accept_rate": 91, "profile_image": "https://graph.facebook.com/1642705992615708/picture?type=large", "display_name": "Viet Phan", "link": "https://stackoverflow.com/users/4728650/viet-phan"}, "edited": false, "score": 0, "creation_date": 1504080125, "post_id": 45954576, "comment_id": 78867896, "body": "many answers had pointed me the cause of problem- double quotes. I will choose this best because of improvement on performance. thanks everyone btw"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 2, "last_activity_date": 1504078966, "last_edit_date": 1504078966, "creation_date": 1504078523, "answer_id": 45954576, "question_id": 45953307, "link": "https://stackoverflow.com/questions/45953307/marshal-int-slice-to-string-line/45954576#45954576", "title": "Marshal int slice to string line", "body": "<p>I think you have it backwards.\nUse the <code>bytes.Buffer</code> type to incrementally build up the string representation of your data.</p>\n\n<p>The program</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"os\"\n    \"strconv\"\n)\n\ntype Int64Slice []int64\n\nfunc (s Int64Slice) MarshalJSON() ([]byte, error) {\n    if s == nil {\n        return []byte(\"null\"), nil\n    }\n\n    var b bytes.Buffer\n    b.WriteByte('\"')\n    for i, v := range s {\n        if i &gt; 0 {\n            b.WriteByte('\\x20')\n        }\n        b.WriteString(strconv.FormatInt(v, 10))\n    }\n\n    b.WriteByte('\"')\n    return b.Bytes(), nil\n}\n\nfunc main() {\n    var (\n        a Int64Slice = nil\n        b = Int64Slice{\n            42,\n            12,\n            0,\n        }\n    )\n    enc := json.NewEncoder(os.Stdout)\n    enc.Encode(a)\n    enc.Encode(b)\n}\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>null\n\"42 12 0\"\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iVUGumDWOO\" rel=\"nofollow noreferrer\">Playground link</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1504079222, "creation_date": 1504079222, "answer_id": 45954781, "question_id": 45953307, "link": "https://stackoverflow.com/questions/45953307/marshal-int-slice-to-string-line/45954781#45954781", "title": "Marshal int slice to string line", "body": "<p><code>20170830090317506 20170830090026319 20170830111023194 201708301043081</code> is not a valid JSON value.  It is interpreted as a valid number (<code>20170830090317506</code>) followed by a valid space, followed by invalid data, beginning with the <code>2</code> character; thus the error you observed.</p>\n\n<p>It needs quotes around it:</p>\n\n<p>Try something like:</p>\n\n<pre><code>result = `\"` + strings.Trim(strings.Join(strings.Fields(fmt.Sprint(u)), \" \"), \"[]\") + `\"`\n</code></pre>\n"}], "owner": {"reputation": 1478, "user_id": 4728650, "user_type": "registered", "accept_rate": 91, "profile_image": "https://graph.facebook.com/1642705992615708/picture?type=large", "display_name": "Viet Phan", "link": "https://stackoverflow.com/users/4728650/viet-phan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 873, "favorite_count": 1, "accepted_answer_id": 45954576, "answer_count": 2, "score": 0, "last_activity_date": 1504079222, "creation_date": 1504074153, "last_edit_date": 1592644375, "question_id": 45953307, "link": "https://stackoverflow.com/questions/45953307/marshal-int-slice-to-string-line", "title": "Marshal int slice to string line", "body": "<p>I have a struct as this:</p>\n<pre><code>type Int64Slice []int64\ntype DataWrapper struct {\n    ListId Int64Slice    `json:&quot;listid&quot; required`\n    Domain string `json:&quot;domain&quot; required`\n    Name   string `json:&quot;name,omitempty&quot;`\n}\n</code></pre>\n<p>And I need it become:</p>\n<pre><code>{\n    &quot;listid&quot;: &quot;1 2 3 4 5&quot;,\n    &quot;domain&quot;: &quot;mydomain&quot;\n}\n</code></pre>\n<p>I have wrote custom MarshalJSON:</p>\n<pre><code>func (u Int64Slice) MarshalJSON() ([]byte, error) {\n    var result string\n    if u == nil {\n        result = &quot;null&quot;\n    } else {\n        result = strings.Trim(strings.Join(strings.Fields(fmt.Sprint(u)), &quot; &quot;), &quot;[]&quot;)\n        Logger.Debugln(result)\n    }\n    return []byte(result), nil\n}\n\nfunc (d *DataWrapper) ToJSON() []byte {\n    result, err := json.Marshal(d)\n    if err != nil {\n        log.Fatalln(err)\n        panic(err)\n    }\n    return result\n}\n</code></pre>\n<p>At the line <code>Logger.Debugln(result)</code>, it prints this result:</p>\n<blockquote>\n<p>20170830090317506 20170830090026319 20170830111023194 201708301043081 ...</p>\n<p>json: error calling MarshalJSON for type models.Int64Slice: invalid\ncharacter '2' after top-level value</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1504073937, "post_id": 45953170, "comment_id": 78864290, "body": "I don&#39;t think this is possible. In anycase, I can&#39;t help but feel you are trying to do something terribly, horribly, wrong. Why in the world would you ever need to abuse the type system this way?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504078330, "post_id": 45953170, "comment_id": 78866809, "body": "What is it that you&#39;re trying to accomplish? To get the <code>reflect.Type&#47;Value</code> of some arbitrary Go value you don&#39;t need to use <code>unsafe.Pointer</code>."}, {"owner": {"reputation": 11, "user_id": 7315315, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-w8zSmbgGX0o/AAAAAAAAAAI/AAAAAAAAAK4/IHHgfm_1XUM/photo.jpg?sz=128", "display_name": "Roc Altair", "link": "https://stackoverflow.com/users/7315315/roc-altair"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1504174370, "post_id": 45953170, "comment_id": 78916571, "body": "@MiloChristiansen I&#39;m trying to dump all the values &amp; names of local variables in each traceback frames. It would be convenience to debug if succeed. I can get the address(as type uintptr) of each variables in stack frame."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7315315, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-w8zSmbgGX0o/AAAAAAAAAAI/AAAAAAAAAK4/IHHgfm_1XUM/photo.jpg?sz=128", "display_name": "Roc Altair", "link": "https://stackoverflow.com/users/7315315/roc-altair"}, "edited": false, "score": 0, "creation_date": 1504173660, "post_id": 45957139, "comment_id": 78916023, "body": "cool~ but how can I list all the types in runtime?I&#39;m trying to dump all   the values &amp; names of  local variables in each traceback frames. I read the source code of golang reflect.TypeOf, see the code <a href=\"https://github.com/golang/go/blob/master/src/reflect/type.go#L1395\" rel=\"nofollow noreferrer\">reflect.TypeOf</a>,  I found a pointer(unsafe.Pointer) can be converted to reflect.Type internal. So can I try in user-runtime?"}], "tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": false, "score": 1, "last_activity_date": 1504087161, "last_edit_date": 1504087161, "creation_date": 1504086539, "answer_id": 45957139, "question_id": 45953170, "link": "https://stackoverflow.com/questions/45953170/how-to-convert-unsafe-pointer-to-reflect-type-or-reflect-value/45957139#45957139", "title": "How to convert unsafe.Pointer to reflect.Type or reflect.Value", "body": "<p>Why would you need the pointer to get the Type? All you need is the type name.</p>\n\n<p>In Go, it is not possible to get the <code>reflect.Type</code> from a string directly. The type must be referenced somewhere in order for the compiler to know it is to be included. However, you can get the same effect using <code>map[string]reflect.Type</code>.</p>\n\n<p>If your types are static, just declare:</p>\n\n<pre><code>var types = map[string]reflect.Type{\n    \"int64\": reflect.TypeOf(int64(0)),\n    \"string\": reflect.TypeOf(string(\"\")),\n    // ... and so on\n}\n</code></pre>\n\n<p>If your types are registered dynamically from different packages, you can register your types from <code>init</code> functions like this:</p>\n\n<pre><code>var types = make(map[string]reflect.Type)\n\nfunc AddType(name string, i interface{}) {\n    if _, ok := types[name]; ok {\n        panic(\"Type \" + name + \" registered multiple times\")\n    }\n    types[name] = reflect.TypeOf(i)\n}\n\n// Called somewhere else\n\nfunc init() {\n    AddType(\"struct main.Person\", Person{})\n}\n</code></pre>\n\n<p>If you want to get the <code>reflect.Value</code> from a pointer and a type name, you can do the following:</p>\n\n<pre><code>func ValueOfByAddr(addr unsafe.Pointer, typName string) reflect.Value {\n    t, ok := types[typName]\n    if !ok {\n        panic(\"Unknown type name\")\n    }\n    return reflect.NewAt(t, addr)\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 7315315, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-w8zSmbgGX0o/AAAAAAAAAAI/AAAAAAAAAK4/IHHgfm_1XUM/photo.jpg?sz=128", "display_name": "Roc Altair", "link": "https://stackoverflow.com/users/7315315/roc-altair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1352, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1504274517, "creation_date": 1504073569, "last_edit_date": 1504274517, "question_id": 45953170, "link": "https://stackoverflow.com/questions/45953170/how-to-convert-unsafe-pointer-to-reflect-type-or-reflect-value", "title": "How to convert unsafe.Pointer to reflect.Type or reflect.Value", "body": "<p>I got one variable's address which type is converted to unsafe.Pointer, and I got its type name, such as \"int64\" or \"struct main.Person\" or others.</p>\n\n<p>see the code:</p>\n\n<pre><code>package main\n\ntype Person struct {\n    Name string\n    Age int\n}\n\np := Person{\"john\", 25}\naddr := unsafe.Pointer(&amp;p)\ntypName := \"struct main.Person\"\n\ntyp := module.TypeOfByAddr(addr, typName)\n\n// now, I got variable addr, typName in func module.TypeOfByAddr\n// how can I get reflect.Type of variable p without using package.Person to convert?\n\npackage module\n\nfunc TypeOfByAddr(addr unsafe.Pointer, typName string) reflect.Type {\n    // how to convert addr to reflect.Type?\n}\n</code></pre>\n"}, {"tags": ["html", "css", "go"], "comments": [{"owner": {"reputation": 144, "user_id": 8075949, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeTbN.png?s=128&g=1", "display_name": "nk2ge5k", "link": "https://stackoverflow.com/users/8075949/nk2ge5k"}, "edited": false, "score": 0, "creation_date": 1504073948, "post_id": 45951044, "comment_id": 78864297, "body": "You can do sonething like this: <a href=\"https://github.com/google/shenzhen-go/blob/master/cmd/shenzhen-go/main.go\" rel=\"nofollow noreferrer\">github.com/google/shenzhen-go/blob/master/cmd/shenzhen-go/&hellip;</a> <a href=\"https://github.com/google/shenzhen-go/blob/master/view/static.go\" rel=\"nofollow noreferrer\">github.com/google/shenzhen-go/blob/master/view/static.go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 233, "user_id": 7754272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cfeb16e28f562b8aedfe985ce41553ab?s=128&d=identicon&r=PG&f=1", "display_name": "GoofBall101", "link": "https://stackoverflow.com/users/7754272/goofball101"}, "edited": false, "score": 0, "creation_date": 1504061513, "post_id": 45951089, "comment_id": 78860750, "body": "I get a panic -- panic: http: multiple registrations for /. Would I place this somewhere specifically?"}, {"owner": {"reputation": 150, "user_id": 8503922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zljrt.jpg?s=128&g=1", "display_name": "jek", "link": "https://stackoverflow.com/users/8503922/jek"}, "reply_to_user": {"reputation": 233, "user_id": 7754272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cfeb16e28f562b8aedfe985ce41553ab?s=128&d=identicon&r=PG&f=1", "display_name": "GoofBall101", "link": "https://stackoverflow.com/users/7754272/goofball101"}, "edited": false, "score": 0, "creation_date": 1504061802, "post_id": 45951089, "comment_id": 78860817, "body": "I guess that&#39;s an issue due to vendoring. Anyway you can refer to this <a href=\"https://stackoverflow.com/questions/43601359/how-do-i-serve-css-and-js-in-go-lang\">issue</a>."}], "tags": [], "owner": {"reputation": 150, "user_id": 8503922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zljrt.jpg?s=128&g=1", "display_name": "jek", "link": "https://stackoverflow.com/users/8503922/jek"}, "is_accepted": false, "score": 0, "last_activity_date": 1504061172, "creation_date": 1504061172, "answer_id": 45951089, "question_id": 45951044, "link": "https://stackoverflow.com/questions/45951044/properly-serve-a-css-file-golang/45951089#45951089", "title": "Properly serve a CSS file Golang", "body": "<p>You can try this instead. </p>\n\n<pre><code>http.Handle(\"/\", http.FileServer(http.Dir(\"css/\")))\n</code></pre>\n\n<p>Let me know if it helped you to your problem.</p>\n"}, {"tags": [], "owner": {"reputation": 15582, "user_id": 1420625, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wJ6T0.png?s=128&g=1", "display_name": "sensorario", "link": "https://stackoverflow.com/users/1420625/sensorario"}, "is_accepted": true, "score": 0, "last_activity_date": 1504068251, "creation_date": 1504068251, "answer_id": 45952054, "question_id": 45951044, "link": "https://stackoverflow.com/questions/45951044/properly-serve-a-css-file-golang/45952054#45952054", "title": "Properly serve a CSS file Golang", "body": "<p>I always do this:</p>\n\n<pre><code>http.HandleFunc(\"/game.css\", serveCss)\n</code></pre>\n\n<p>and this:</p>\n\n<pre><code>func serveCss(w http.ResponseWriter, r *http.Request) {\n    http.ServeFile(w, r, \"client/game.css\")\n}\n</code></pre>\n\n<p>Hope this help</p>\n"}], "owner": {"reputation": 233, "user_id": 7754272, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cfeb16e28f562b8aedfe985ce41553ab?s=128&d=identicon&r=PG&f=1", "display_name": "GoofBall101", "link": "https://stackoverflow.com/users/7754272/goofball101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 896, "favorite_count": 0, "accepted_answer_id": 45952054, "answer_count": 2, "score": 0, "last_activity_date": 1597502651, "creation_date": 1504060707, "last_edit_date": 1510968719, "question_id": 45951044, "link": "https://stackoverflow.com/questions/45951044/properly-serve-a-css-file-golang", "title": "Properly serve a CSS file Golang", "body": "<p>I have a CSS file and I am trying to serve it on my Web Server (New with the http package). I have tried </p>\n\n<pre><code>http. (ServeFile, and Handle)\n</code></pre>\n\n<p>I have also tried serving it as a template, but the issue is that on the bottom of the HTML page, it prints the CSS. What is the proper way of serving the CSS file without it printing the whole CSS file on the bottom of the page? </p>\n"}, {"tags": ["algorithm", "nginx", "go", "data-structures"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1504049470, "post_id": 45948719, "comment_id": 78858110, "body": "To search in realtime in your corpus you will need datastructure with predictable search/insert time like balansed binary tree or hashmap or sorted array at least. You can compact this structure periodicaly. I&#39;d suggest Bloom filter which has constant search/insert time and constant size and several implementations in Go."}, {"owner": {"reputation": 35084, "user_id": 585411, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/xvEpe.jpg?s=128&g=1", "display_name": "btilly", "link": "https://stackoverflow.com/users/585411/btilly"}, "edited": false, "score": 0, "creation_date": 1504050086, "post_id": 45948719, "comment_id": 78858258, "body": "Do you need exact counts, or will probabilistic estimates be sufficient?"}, {"owner": {"reputation": 35084, "user_id": 585411, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/xvEpe.jpg?s=128&g=1", "display_name": "btilly", "link": "https://stackoverflow.com/users/585411/btilly"}, "edited": false, "score": 2, "creation_date": 1504110484, "post_id": 45948719, "comment_id": 78889846, "body": "I am curious if someone who thinks that this is off topic could explain why it doesn&#39;t fit <a href=\"https://stackoverflow.com/help/on-topic\">stackoverflow.com/help/on-topic</a>.  The question asks for an <i>algorithm</i> for the <i>specific programming problem</i> of how to keep a real time top-20 list of terms showing up in user searches.  This is <i>a practical, answerable problem that is unique to software development</i> - find me anyone else who would want to solve this kind of problem!  It is none of the 6 kinds of problems that are not on topic despite fitting the initial criteria.  So why did 4 people conclude that it is off topic?"}, {"owner": {"reputation": 21557, "user_id": 1122270, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1ab0e19086582d27abe75b0635f57f43?s=128&d=identicon&r=PG", "display_name": "cnst", "link": "https://stackoverflow.com/users/1122270/cnst"}, "reply_to_user": {"reputation": 35084, "user_id": 585411, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/xvEpe.jpg?s=128&g=1", "display_name": "btilly", "link": "https://stackoverflow.com/users/585411/btilly"}, "edited": false, "score": 0, "creation_date": 1504111054, "post_id": 45948719, "comment_id": 78890197, "body": "@btilly, I&#39;d prefer an exact count, subject to the same conditions as documented of the nginx implementation, that the least-recently-inserted element (hopefully, one that also doesn&#39;t currently have any duplicates at all) gets the boot."}, {"owner": {"reputation": 35084, "user_id": 585411, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/xvEpe.jpg?s=128&g=1", "display_name": "btilly", "link": "https://stackoverflow.com/users/585411/btilly"}, "edited": false, "score": 1, "creation_date": 1504117355, "post_id": 45948719, "comment_id": 78893657, "body": "@cnst The nginx implementation is described at <a href=\"https://www.nginx.com/blog/rate-limiting-nginx/\" rel=\"nofollow noreferrer\">nginx.com/blog/rate-limiting-nginx</a>.  The least-recently-inserted bit can be kept track of in an lru cache.  Google turned up <a href=\"https://github.com/hashicorp/golang-lru\" rel=\"nofollow noreferrer\">github.com/hashicorp/golang-lru</a> for a sample implementation.  But do note that the fact that nginx throttles active IP addresses reduces how much data they need to track, and also they do not try to track for an hour.  You probably want to somehow limit how much information you need to keep track of for this feature."}], "answers": [{"comments": [{"owner": {"reputation": 21557, "user_id": 1122270, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1ab0e19086582d27abe75b0635f57f43?s=128&d=identicon&r=PG", "display_name": "cnst", "link": "https://stackoverflow.com/users/1122270/cnst"}, "edited": false, "score": 0, "creation_date": 1504114187, "post_id": 45951357, "comment_id": 78891868, "body": "Thank you for your answer.  Do you know how nginx implements this?  The docs don&#39;t appear to mention any sort of probabilistic uncertainties."}, {"owner": {"reputation": 35084, "user_id": 585411, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/xvEpe.jpg?s=128&g=1", "display_name": "btilly", "link": "https://stackoverflow.com/users/585411/btilly"}, "reply_to_user": {"reputation": 21557, "user_id": 1122270, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1ab0e19086582d27abe75b0635f57f43?s=128&d=identicon&r=PG", "display_name": "cnst", "link": "https://stackoverflow.com/users/1122270/cnst"}, "edited": false, "score": 0, "creation_date": 1504117662, "post_id": 45951357, "comment_id": 78893827, "body": "@cnst I answered that above.  The probabilistic design here allows this to be carried out with limited memory requirements even if the number of individual search terms is extremely large. And on a large cluster it can be adapted to allow the computation to be carried out and then merged on many machines.  But depending on your problem, it may be overkill."}], "tags": [], "owner": {"reputation": 35084, "user_id": 585411, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/xvEpe.jpg?s=128&g=1", "display_name": "btilly", "link": "https://stackoverflow.com/users/585411/btilly"}, "is_accepted": false, "score": -1, "last_activity_date": 1504063191, "creation_date": 1504063191, "answer_id": 45951357, "question_id": 45948719, "link": "https://stackoverflow.com/questions/45948719/top-most-common-duplicate-elements-over-a-time-period-in-realtime/45951357#45951357", "title": "top most common/duplicate elements over a time period in realtime", "body": "<p>This is two problems.</p>\n\n<ol>\n<li>Keeping track of names that you've chosen to keep track of.</li>\n<li>Noticing names that are trending that aren't in your list to keep track of.</li>\n</ol>\n\n<p>For the first problem I'd recommend keeping track per name, per minute, how many there were.  As they finish, add them to a running total, and add to a queue of things to subtract back out in an hour.  This gives you 60 small objects per name, and on a running basis you'll be keeping a hash going.</p>\n\n<p>The second problem is more challenging.  For this I'd use a probabilistic approach.  The idea is that each name is hashed with a unique id, and you keep only the thousand smallest hash values (and associated names) that you see in a minute.  (I'll give an algorithm for that in a minute.)  Your hash values should be evenly distributed among the 2^64 largest independently of the name, so common names will eventually show up in this list.  When they do, you start counting them!  (You will lose the first few, but with more work you can estimate how many you missed.  This optimization may be more work than it is worth though.)</p>\n\n<p>Now how do we keep the thousand smallest hash values?  You use a <em>priority queue</em>, which is often implemented with a <em>heap</em> to create an updatable data structure where it is easy to pull out the largest hash value.  So you run the following pseudo-code.</p>\n\n<pre><code>create your priority queue of (hash, name)\nfor each name:\n   hash hash of name and unique new id\n   entry = (hash, name)\n   if queue size &lt; 1000:\n       insert entry\n   else if hash is smaller than the current max in the queue\n      insert entry\n      remove the largest entry\n</code></pre>\n"}], "owner": {"reputation": 21557, "user_id": 1122270, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1ab0e19086582d27abe75b0635f57f43?s=128&d=identicon&r=PG", "display_name": "cnst", "link": "https://stackoverflow.com/users/1122270/cnst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 146, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1504063191, "creation_date": 1504042789, "question_id": 45948719, "link": "https://stackoverflow.com/questions/45948719/top-most-common-duplicate-elements-over-a-time-period-in-realtime", "title": "top most common/duplicate elements over a time period in realtime", "body": "<p><strong><em>I have user-generated strings coming in at an undefined rate, some of which is duplicate data, and I'd like to keep the count of the top-20 most common duplicates in real time, over a given constant time period (e.g., over the last hour), in Go.</em></strong></p>\n\n<p><em>The number of unique strings is not limited in any way, so, to avoid DoS, the datastructure probably has to have a defined size of the most number of elements (e.g., top-10k-elements and/or 1MB overall size), and drop the least recently inserted elements if they don't have any duplicates yet (but never drop any newly incoming elements!).</em></p>\n\n<p>My understanding is that this is exactly how <a href=\"http://ngx.su/src/http/modules/ngx_http_limit_req_module.c\" rel=\"nofollow noreferrer\"><code>ngx_http_limit_req_module.c</code></a> is <a href=\"http://ngx.su/src/http/modules/ngx_http_limit_req_module.c#ngx_http_limit_req_rbtree_insert_value\" rel=\"nofollow noreferrer\">implemented</a>, and this method is referred to in the <a href=\"http://nginx.org/en/docs/http/ngx_http_limit_req_module.html\" rel=\"nofollow noreferrer\">documentation</a> as \u201cleaky bucket\u201d, however, the <a href=\"//en.wikipedia.org/wiki/Leaky_bucket\" rel=\"nofollow noreferrer\">wikipedia</a> page appears to suggest that it's the new data that'd be dropped from the queue, not the old one, so, not sure if the concept applies.</p>\n\n<p>Regardless, I tried looking for a \u201cleaky bucket\u201d implementation in Golang, and by far the most popular result I found is <a href=\"//github.com/uber-go/ratelimit\" rel=\"nofollow noreferrer\"><code>uber-go/ratelimit</code></a>, whose API doesn't appear to fit my problem statement at all \u2014 it simply implements some actual rate-limiting queue, not a top X over the last Y count in realtime.</p>\n\n<p>Can anyone suggest the proper name for what I'm looking for, and the best way to accomplish this, preferably in Go?</p>\n"}, {"tags": ["docker", "go", "dockerfile"], "answers": [{"tags": [], "owner": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "is_accepted": true, "score": 0, "last_activity_date": 1504190252, "last_edit_date": 1504190252, "creation_date": 1504080835, "answer_id": 45955269, "question_id": 45948537, "link": "https://stackoverflow.com/questions/45948537/golang-app-deployment-in-docker-container/45955269#45955269", "title": "Golang app deployment in docker container", "body": "<p>I got some experience with deploying Go apps using Docker.</p>\n\n<h2>TL;DR</h2>\n\n<p>This is how my project looks like in <code>${GOPATH}/src/github.com/githubhandle/project</code></p>\n\n<pre><code>main.go\nvendor.conf\nvendor/\n    github.com/gorilla/mux\n    github.com/sirupsen/logrus\n    github.com/bshuster-repo/logrus-logstash-hook\n    ...\nDockerfile\n</code></pre>\n\n<p>And the Dockerfile looks like this:</p>\n\n<pre><code>FROM golang:1.8\nWORKDIR /go/src/app\nCOPY . .\nRUN go-wrapper download\nRUN go-wrapper install\nEXPOSE [8080]\nENTRYPOINT [\"go-wrapper\", \"run\", \"main.go\"]\n</code></pre>\n\n<p>Pretty much</p>\n\n<h2>Long answer</h2>\n\n<p>In general, I like to put my Dockerfile inside the server directory:</p>\n\n<pre><code>go/\n    src/\n        github.com/\n            mygithub/\n                serverproject/\n                    main.go\n                    Dockerfile\n</code></pre>\n\n<p>If I am using non standard packages in my projects such as (gorilla/mux) I would probably use <a href=\"https://github.com/LK4D4/vndr\" rel=\"nofollow noreferrer\"><code>vndr</code></a> to create a vendor directory where I put all these packages and manage their versions.</p>\n\n<p>After that my Dockerfile would probably look like that:</p>\n\n<pre><code>FROM golang:1.8\nWORKDIR /go/src/app\nCOPY . .\nRUN go-wrapper download\nRUN go-wrapper install\nENTRYPOINT [\"go-wrapper\", \"run\", \"main.go\"]\n</code></pre>\n\n<p><strong>Note</strong> You may want to automatically expose port number. For example, adding this line will expose port 8080 inside the container to the host.</p>\n\n<pre><code>PORT 8080\n</code></pre>\n\n<p>What is left to do is to build the image from within <code>go/src/github.com/mygithub/serverproject</code>: </p>\n\n<pre><code>docker build -t serverproject .\n</code></pre>\n\n<p>And to deploy it into a container:</p>\n\n<pre><code>docker run -P --rm --name myserver1 serverproject\n</code></pre>\n\n<p>If you want to pass arguments to the server you can do that like the following:</p>\n\n<pre><code>docker run -P --rm --name myserver1 serverproject --arg1 --arg2=bla\n</code></pre>\n\n<p><strong>Note</strong> in case you didn't specify <code>PORT</code> in your Dockerfile and would like to expose it to the host, replace <code>-P</code> with <code>-p</code> before <code>--name</code> and specify <code>&lt;host-port&gt;:&lt;container-port&gt;</code>:</p>\n\n<pre><code>docker run --rm -p 8080:8080 ...\n</code></pre>\n\n<p>This will actually port forward from your host to the container.</p>\n"}], "owner": {"reputation": 3, "user_id": 4096012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efc78320258ad80c104146f72f99fbc9?s=128&d=identicon&r=PG&f=1", "display_name": "BuckIt", "link": "https://stackoverflow.com/users/4096012/buckit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 571, "favorite_count": 0, "accepted_answer_id": 45955269, "answer_count": 1, "score": 0, "last_activity_date": 1504190252, "creation_date": 1504041792, "last_edit_date": 1504042108, "question_id": 45948537, "link": "https://stackoverflow.com/questions/45948537/golang-app-deployment-in-docker-container", "title": "Golang app deployment in docker container", "body": "<p>i need to deploy go restful app into Docker container.</p>\n\n<p>My project has the following structure</p>\n\n<p>go_proj </p>\n\n<blockquote>\n<pre><code>  |- bin\n  |- src |\n  |      |- com.example |\n  |      |              |- web_service.go\n  |      |\n  |      |- github.com.gorilla.mux |\n  |                                | - ...\n  |- Dockerfile\n</code></pre>\n</blockquote>\n\n<p>How should my Dockerfile look like?\nAnd maybe I should download the library(mux) from the container?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1504040570, "post_id": 45948230, "comment_id": 78855124, "body": "Did you look at the examples for <a href=\"https://godoc.org/encoding/base64#example-Encoding-DecodeString\" rel=\"nofollow noreferrer\">godoc.org/encoding/base64#example-Encoding-DecodeString</a> and <a href=\"https://godoc.org/encoding/base64#example-Encoding-EncodeToString\" rel=\"nofollow noreferrer\">godoc.org/encoding/base64#example-Encoding-EncodeToString</a> ?"}, {"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1504040693, "post_id": 45948230, "comment_id": 78855176, "body": "don&#39;t want to cast it back and forth to string tbh."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 3, "creation_date": 1504040866, "post_id": 45948230, "comment_id": 78855267, "body": "I feel that pain... but specifically you don&#39;t need to create a new decoder each time. You can use the default ones (<a href=\"https://godoc.org/encoding/base64#pkg-variables\" rel=\"nofollow noreferrer\">godoc.org/encoding/base64#pkg-variables</a>) and use <code>Decode</code> and <code>Encode</code>. Then you don&#39;t have to worry about closing the encoder yourself."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1504083845, "post_id": 45948230, "comment_id": 78870119, "body": "<code>Can&#39;t understand why this is not conveniently provided in the stdlib</code> -- It is:  <code>base64.StdEncoding.Encode(dst, src []byte)</code> and <code>base64.StdEncoding.Decode(dst, src []byte) error</code>."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1504041315, "post_id": 45948285, "comment_id": 78855493, "body": "Nice catch. When dealing with Close-ables, I personally follow the convention: if you know you can close it now, do it... defer (too) if something could cause the function to return early. Close-ables are <b>always</b> (AFAIK) idempotent, and you might as well free up whatever it cleans up ASAP anyway."}, {"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "edited": false, "score": 0, "creation_date": 1504042692, "post_id": 45948285, "comment_id": 78856049, "body": "I like the second approach, tried that initially \u2014 but do you know why it appends an extra byte at the end? <a href=\"https://play.golang.org/p/5wZOrcFz0Z\" rel=\"nofollow noreferrer\">play.golang.org/p/5wZOrcFz0Z</a> is it because it&#39;s not possible to calculate the length exactly before hand?"}, {"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 0, "creation_date": 1504043279, "post_id": 45948285, "comment_id": 78856273, "body": "Correct. I focused on encoding since that is the one you made a mistake on the first time. Anyways, given only the encoded data&#39;s length, you can only get the decoded length within 3 bytes. The DecodedLen function returns the largest possible value."}], "tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": true, "score": 8, "last_activity_date": 1504042531, "last_edit_date": 1504042531, "creation_date": 1504040572, "answer_id": 45948285, "question_id": 45948230, "link": "https://stackoverflow.com/questions/45948230/base64-encode-decode-results-in-corrupted-output/45948285#45948285", "title": "Base64 encode/decode results in corrupted output", "body": "<p>The defer executes when the function ends. That is AFTER the return statement has been evaluated.</p>\n\n<p>The following works: <a href=\"https://play.golang.org/p/sYn-W6fZh1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/sYn-W6fZh1</a></p>\n\n<pre><code>func b64encode(b []byte) []byte {\n    encodedData := &amp;bytes.Buffer{}\n    encoder := base64.NewEncoder(base64.URLEncoding, encodedData)\n    encoder.Write(b)\n    encoder.Close()\n    return encodedData.Bytes()\n}\n</code></pre>\n\n<hr>\n\n<p>That being said, if it really is all in memory, you can avoid creating an encoder entirely. Instead, you can do something like:</p>\n\n<pre><code>func b64encode(b []byte) []byte {\n    ret := make([]byte, base64.URLEncoding.EncodedLen(len(b)))\n    base64.URLEncoding.Encode(ret, b)\n    return ret\n}\n</code></pre>\n\n<p>An added benefit of doing it this way it it is more efficient since it only needs to allocate once. It also allows you to no longer ignore errors in the <code>Write</code> and <code>Close</code> methods.</p>\n"}], "owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 605, "favorite_count": 0, "accepted_answer_id": 45948285, "answer_count": 1, "score": -1, "last_activity_date": 1504042531, "creation_date": 1504040365, "question_id": 45948230, "link": "https://stackoverflow.com/questions/45948230/base64-encode-decode-results-in-corrupted-output", "title": "Base64 encode/decode results in corrupted output", "body": "<p>I'm trying to write some convenience wrapper funcs that <code>base64</code> encodes and decodes byte slices. (Can't understand why this is not conveniently provided in the stdlib.)</p>\n\n<p>However this code (in <a href=\"https://play.golang.org/p/CQbBzfcrkU\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<pre><code>func b64encode(b []byte) []byte {\n    encodedData := &amp;bytes.Buffer{}\n    encoder := base64.NewEncoder(base64.URLEncoding, encodedData)\n    defer encoder.Close()\n    encoder.Write(b)\n    return encodedData.Bytes()\n}\n\nfunc b64decode(b []byte) ([]byte, error) {\n    dec := base64.NewDecoder(base64.URLEncoding, bytes.NewReader(b))\n    buf := &amp;bytes.Buffer{}\n    _, err := io.Copy(buf, dec)\n    if err != nil {\n        return nil, err\n    }\n    return buf.Bytes(), nil\n}\n\n\nfunc main() {\n    b := []byte(\"hello\")\n    e := b64encode(b)\n    d, err := b64decode(e)\n    if err != nil {\n        log.Fatalf(\"could not decode: %s\", err)\n    }\n    fmt.Println(string(d))\n}\n</code></pre>\n\n<p>generates truncated output when I try to print it:</p>\n\n<pre><code>hel\n</code></pre>\n\n<p>What's going on?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 1, "creation_date": 1504028032, "post_id": 45945016, "comment_id": 78848616, "body": "What is your <code>GOPATH</code>? Why are you storing the project in <code>&#47;usr&#47;local&#47;go&#47;src</code> instead of a subfolder of <code>&#47;home&#47;$USER&#47;</code>?"}, {"owner": {"reputation": 5185, "user_id": 2180770, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/i1yKC.jpg?s=128&g=1", "display_name": "Melvin", "link": "https://stackoverflow.com/users/2180770/melvin"}, "edited": false, "score": 1, "creation_date": 1504028110, "post_id": 45945016, "comment_id": 78848660, "body": "Possible duplicate? <a href=\"https://stackoverflow.com/questions/36901658/error-non-standard-import-gopkg-in-yaml-v2-in-standard-package\" title=\"error non standard import gopkg in yaml v2 in standard package\">stackoverflow.com/questions/36901658/&hellip;</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1504028661, "post_id": 45945016, "comment_id": 78848993, "body": "<code>go env &amp;&amp; cd $GOPATH&#47;src&#47; &amp;&amp; tree -L 2</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1504029377, "post_id": 45945016, "comment_id": 78849424, "body": "You can&#39;t have your source in GOROOT. Your &quot;redis_exporter&quot; package (<code>&#47;usr&#47;local&#47;go&#47;src&#47;redis_exporter&#47;</code>) needs to go in your GOPATH (<a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>)"}, {"owner": {"reputation": 13866, "user_id": 54200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6261c8ab215b8069e8290516c80445d8?s=128&d=identicon&r=PG", "display_name": "KevinDTimm", "link": "https://stackoverflow.com/users/54200/kevindtimm"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504031540, "post_id": 45945016, "comment_id": 78850531, "body": "@JimB - thanks for the link"}], "owner": {"user_type": "does_not_exist", "display_name": "user4889345"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3048, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1504030874, "creation_date": 1504027623, "last_edit_date": 1504030874, "question_id": 45945016, "link": "https://stackoverflow.com/questions/45945016/cant-load-package", "title": "Can&#39;t load package", "body": "<p>I am having issues loading a package in GO.</p>\n\n<p>My main.go file needs ::</p>\n\n<pre><code>import (\n        \"encoding/csv\"\n        \"flag\"\n        \"net/http\"\n        \"os\"\n        \"runtime\"\n        \"strings\"\n\n        log \"github.com/Sirupsen/logrus\"\n        \"github.com/oliver006/redis_exporter/exporter\"\n        \"github.com/prometheus/client_golang/prometheus\"\n)\n</code></pre>\n\n<p>Now in my SRC folder of <code>go</code> I have,</p>\n\n<pre><code>[root@node src]# pwd\n/usr/local/go/src\n\n[root@node src]# ls -tlrh github.com/\ntotal 12K\ndrwxr-xr-x 3 root root 4.0K Aug 29 17:12 Sirupsen\ndrwxr-xr-x 3 root root 4.0K Aug 29 17:14 oliver006\ndrwxr-xr-x 3 root root 4.0K Aug 29 17:14 garyburd\n</code></pre>\n\n<p>When I am trying to build my project, the ERROR I get is :</p>\n\n<pre><code>[root@node redis_exporter]# go build\ncan't load package: /usr/local/go/src/redis_exporter/main.go:11:2: non-standard import \"github.com/Sirupsen/logrus\" in standard package \"redis_exporter\"\n</code></pre>\n\n<p>At one point I accidentally ran a command :</p>\n\n<pre><code>go get github.com/prometheus/client_golang/prometheus\n</code></pre>\n\n<p>Im not sure if this is causing an issue. Is there a way to revert this back ? </p>\n"}, {"tags": ["go", "design-patterns", "decorator", "demo"], "comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 1, "creation_date": 1599552459, "post_id": 45944781, "comment_id": 112800775, "body": "A simple Go example of a decorator pattern and 23 other kinds of GoF design patterns can be found here <a href=\"https://github.com/Margular/hello-design-pattern\" rel=\"nofollow noreferrer\">github.com/Margular/hello-design-pattern</a>."}], "answers": [{"comments": [{"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1504028623, "post_id": 45945229, "comment_id": 78848968, "body": "The difficult for me is to apply the principle elsewhere. Looking at the code you quoted unfortunately doesn&#39;t give me a better understanding of it and the sense of how to <i>apply</i> it for my own problems. It is still too complicated for me to wrap my head around it."}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "reply_to_user": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1504029914, "post_id": 45945229, "comment_id": 78849730, "body": "I&#39;ve created a simple example, please see this: <a href=\"https://gist.github.com/steven-ferrer/e4c1eb973a930c2205039448cda6d3d9\" rel=\"nofollow noreferrer\">gist.github.com/steven-ferrer/e4c1eb973a930c2205039448cda6d3&zwnj;&#8203;d9</a>"}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1504032589, "post_id": 45945229, "comment_id": 78851096, "body": "Thanks for your help. Upvoated!"}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "reply_to_user": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1504032663, "post_id": 45945229, "comment_id": 78851137, "body": "Glad It helped :)"}, {"owner": {"reputation": 3806, "user_id": 1335793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jnl3V.png?s=128&g=1", "display_name": "Davos", "link": "https://stackoverflow.com/users/1335793/davos"}, "edited": false, "score": 0, "creation_date": 1557308051, "post_id": 45945229, "comment_id": 98717619, "body": "Very interesting example, I thought they were called closures. I thought a decorator function would take a function as parameter and return a wrapped function of the same type, although I guess naming of patterns doesn&#39;t fully transfer between different langs."}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "reply_to_user": {"reputation": 3806, "user_id": 1335793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jnl3V.png?s=128&g=1", "display_name": "Davos", "link": "https://stackoverflow.com/users/1335793/davos"}, "edited": false, "score": 1, "creation_date": 1557338618, "post_id": 45945229, "comment_id": 98734855, "body": "@Davos, tbh, i&#39;m not completely sure now if this is good example of decorator pattern :) I always look at the accepted answer if I want to refresh my knowledge"}], "tags": [], "owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "is_accepted": false, "score": 4, "last_activity_date": 1510209349, "last_edit_date": 1510209349, "creation_date": 1504028361, "answer_id": 45945229, "question_id": 45944781, "link": "https://stackoverflow.com/questions/45944781/decorator-functions-in-go/45945229#45945229", "title": "Decorator functions in Go", "body": "<p>I know a very good example of decorators/middlewares that utilizes the same technique that you demonstrated. This is not specific to string manipulation though, but I find it really beautifully crafted, here it is (scan through the code):</p>\n\n<p><a href=\"https://github.com/basvanbeek/pubsub/blob/master/kafka/publisher.go\" rel=\"nofollow noreferrer\">https://github.com/basvanbeek/pubsub/blob/master/kafka/publisher.go</a></p>\n\n<p>Take a look at the <code>type PublisherOption func(*publisherConfig) error</code></p>\n\n<p>You will notice that some of the functions returns <code>PublisherOption</code> type. These are the decorators/middleware.</p>\n\n<p>The action happens on <code>NewKafkaPublisher</code> function:</p>\n\n<pre><code>func NewKafkaPublisher(\n  broker, topic string,\n  options ...PublisherOption,\n  ) (pubsub.Publisher, error) {\n  if len(strings.Trim(broker, \" \\t\")) == 0 {\n      return nil, ErrNoBrokers\n  }\n  brokerHosts := strings.Split(broker, \",\")\n\n  if len(topic) == 0 {\n      return nil, ErrNoTopic\n  }\n  // set sensible defaults\n  pc := &amp;publisherConfig{\n    syncPublisher: defaultSyncPublisher,\n    ackMode:       defaultRequiredAcks,\n    successes:     nil,\n    logger:        log.NewNopLogger(),\n    topic:         topic,\n    partitioner:   sarama.NewManualPartitioner(topic),\n    partition:     0,\n  }\n\n // parse optional parameters\n for _, option := range options {\n     if err := option(pc); err != nil {\n        return nil, err\n     }\n }\n</code></pre>\n\n<p>Notice that it loops through the <code>option</code> and calls each decorator/middleware. </p>\n\n<p>Supplemental example is here: <a href=\"https://gist.github.com/steven-ferrer/e4c1eb973a930c2205039448cda6d3d9\" rel=\"nofollow noreferrer\">https://gist.github.com/steven-ferrer/e4c1eb973a930c2205039448cda6d3d9</a></p>\n\n<p>Runnable code: <a href=\"https://play.golang.org/p/ZXixnyTHXH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ZXixnyTHXH</a></p>\n\n<p>Hope that helped :)</p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1504030710, "post_id": 45945530, "comment_id": 78850100, "body": "@srxf type aliases were just added in Go 1.9, released last week."}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1504032391, "post_id": 45945530, "comment_id": 78851005, "body": "Upvoting! however I was looking for the Decorator functions pattern in the form of <code>return func(s string) string</code> etc. and moreover, examples for &quot;<a href=\"http://xion.io/post/code/go-decorated-functions.html\" rel=\"nofollow noreferrer\"><i>This technique proves especially valuable if the decorators themselves are parameterized</i></a>&quot;"}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1504039572, "post_id": 45945530, "comment_id": 78854642, "body": "Thanks for the update on the <i>parametrized decorator</i>. Looking at the code again now, I think your example is more suitable as the example that is easier to understand. Had you put that in first, I would have chosen yours as the answer. Now I wish I could choose both. Thanks again for your valuable help!"}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1504055847, "post_id": 45945530, "comment_id": 78859644, "body": "Hi @syntagma, FYI, I put your demo code together at <a href=\"https://play.golang.org/p/s4tWssqb_3\" rel=\"nofollow noreferrer\">play.golang.org/p/s4tWssqb_3</a> and I was looking for reason why your <code>Decorator</code> function applying order is not reversed when I realized that, strictly speaking, what you&#39;ve coded is not the Decorator functions pattern that everyone else is talking about. The best article that explains this Decorator functions pattern for Go is <a href=\"http://xion.io/post/code/go-decorated-functions.html\" rel=\"nofollow noreferrer\">xion.io/post/code/go-decorated-functions.html</a>, for your convenience."}], "tags": [], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "is_accepted": false, "score": 5, "last_activity_date": 1504034285, "last_edit_date": 1504034285, "creation_date": 1504029403, "answer_id": 45945530, "question_id": 45944781, "link": "https://stackoverflow.com/questions/45944781/decorator-functions-in-go/45945530#45945530", "title": "Decorator functions in Go", "body": "<blockquote>\n  <p>A string manipulation according to different option/instruction, e.g., to upper, to lower, adding prefix/suffix, to base64, etc, would be the best example IMO.</p>\n</blockquote>\n\n<p>This is the example you asked about:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nconst (\n    prefix = \"PREFIX\"\n    suffix = \"SUFFIX\"\n)\n\ntype Decorated=string\n\nfunc addConstPrefix(s string) string {\n    return prefix + s\n}\n\nfunc addConstSuffix(s string) string {\n    return s + suffix\n}\n\ntype Decorator=func(string) string\n\nfunc Decorate(c Decorated, ds ...Decorator) Decorated {\n    decorated := c\n    for _, decorator := range ds {\n        decorated = decorator(decorated)\n    }\n    return decorated\n}\n\nfunc main() {\n\n    var toLower Decorator = strings.ToLower\n    var toUpper Decorator = strings.ToUpper\n    var dec3 Decorator = addConstPrefix\n    var dec4 Decorator = addConstSuffix\n\n    input := \"Let's decorate me!\"\n    inputUppercase := Decorate(input, []Decorator{toUpper}...)\n    fmt.Println(inputUppercase)\n\n    allDecorators := []Decorator{toUpper, toLower, dec3, dec4}\n    output := Decorate(input, allDecorators...)\n    fmt.Println(output)\n}\n</code></pre>\n\n<p>Note that for the sake of simplicity, it uses Golang's <strong>type aliases</strong>, which were introduced in Go 1.9. These are the two aliases we are using:</p>\n\n<pre><code>type Decorated=string\ntype Decorator=func(string)string\n</code></pre>\n\n<p>so that your <code>Decorate()</code> function could later be applied. Then we are simply creating few decorators (functions) which match the type signature we defined:</p>\n\n<pre><code>var toLower Decorator = strings.ToLower\nvar toUpper Decorator = strings.ToUpper\nvar dec3 Decorator = addConstPrefix\nvar dec4 Decorator = addConstSuffix\n</code></pre>\n\n<p>and apply them:</p>\n\n<pre><code>allDecorators := []Decorator{toUpper, toLower, dec3, dec4}\noutput := Decorate(input, allDecorators...)\n</code></pre>\n\n<p><strong>EDIT:</strong></p>\n\n<p>A <em>parametrized</em> decorator would simply be a function which returns another function, for example:</p>\n\n<pre><code>func addPrefix(prefix string) func(string) string {\n    return func(s string) string {\n        return prefix + s\n    }\n}\n</code></pre>\n\n<p>It could then be applied in the following way:</p>\n\n<pre><code>input2 := \"Let's decorate me!\"\nprefixed := Decorate(input2, []Decorator{addPrefix(\"Well, \")}...)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1504032231, "post_id": 45945743, "comment_id": 78850918, "body": "This is exactly the Decorator functions pattern in Go that I was looking for thanks a lot!"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504033130, "post_id": 45945743, "comment_id": 78851384, "body": "If I understand correctly, <code>AppendDecorator</code> as it is defined, can only be used to append as the first operation?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504033199, "post_id": 45945743, "comment_id": 78851415, "body": "<a href=\"https://play.golang.org/p/rrBnAJOIc2\" rel=\"nofollow noreferrer\">play.golang.org/p/rrBnAJOIc2</a> no, <code>AppendDecorator</code> is a little different from the other ones in that you need to call it to return the actual decorator, which than gets called with the function you want to decorate. Basically it just creates a closure for the string you pass to <code>AppendDecorator</code> and returns a new decorator which then has access to that string..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504033582, "post_id": 45945743, "comment_id": 78851624, "body": "@RayfenWindspear probably a name like <code>AppendDecoratorFactory</code> would be more appropriate."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504033590, "post_id": 45945743, "comment_id": 78851629, "body": "Aha, that makes sense now. I wasn&#39;t looking closely enough at the return type. Thanks. AHHH don&#39;t use the word Factory regarding Go!! Evil Java voodoo!"}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1504038347, "post_id": 45945743, "comment_id": 78854039, "body": "@mkopriva, can you help make the following code work please? <a href=\"https://play.golang.org/p/3ox9dYJGMk\" rel=\"nofollow noreferrer\">play.golang.org/p/3ox9dYJGMk</a> I.e., I added <code>func Decorate</code> and want to make it works. Thanks."}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1504038891, "post_id": 45945743, "comment_id": 78854316, "body": "Also, for the expression <code>AppendDecorator(&quot; -GOLANG&quot;)(ToLower(PrependDecorator(&quot;DECORATED: &quot;, fn3))</code>, intuitive thinking is that the inner most function get applied first, however, the test result show that it is actually the outer most function get applied first. That&#39;s totally against my intuition. Can you explain a bit why <code>ToLower</code> is applied to <code>AppendDecorator</code> but not the <code>PrependDecorator</code>, which is the inner function, please? Thx"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504039337, "post_id": 45945743, "comment_id": 78854528, "body": "If you use the decorator pattern as is demonstrated in my answer you need to <b>pass a function to the decorators</b>. This gets weird when you want to loop over <code>StringManipulator</code>s, because the &quot;decorators&quot; aren&#39;t &quot;manipulators&quot; they just return them, so you need to pass a manipulator to the decorator to get the decorated manipulator... if it sounds confusing, that&#39;s because it is :) here&#39;s the example <a href=\"https://play.golang.org/p/WzbN0dUEQA\" rel=\"nofollow noreferrer\">play.golang.org/p/WzbN0dUEQA</a> and give me a second i&#39;ll fix it to something less cryptic."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504040243, "post_id": 45945743, "comment_id": 78854961, "body": "So, <a href=\"https://play.golang.org/p/YWySMO61os\" rel=\"nofollow noreferrer\">here you create a slice of decorators, as opposed to manipulators</a>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1504042178, "post_id": 45945743, "comment_id": 78855875, "body": "@xpt here&#39;s a demonstration of the order <a href=\"https://play.golang.org/p/zj-wnlXS2O\" rel=\"nofollow noreferrer\">play.golang.org/p/zj-wnlXS2O</a> hope that helps to explain it a little."}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1504053698, "post_id": 45945743, "comment_id": 78859182, "body": "Thanks a lot @mkopriva! Your answer is a masterpiece that I&#39;ll surely come back and revisit again and again whenever I need to do this, and I truly hope that anyone who is benefit from it will upvote it. Oh, BTW, interesting to see that the order was different whether ToLower is applied to AppendDecorator or PrependDecorator first. No wonder I saw one <code>Decorate()</code> function loop is in reverse order. PS. like that &quot;<i>different take</i>&quot; better!"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 19, "last_activity_date": 1504054004, "last_edit_date": 1504054004, "creation_date": 1504030165, "answer_id": 45945743, "question_id": 45944781, "link": "https://stackoverflow.com/questions/45944781/decorator-functions-in-go/45945743#45945743", "title": "Decorator functions in Go", "body": "<p>First of all, a decorator is basically a function that takes another function of a specific type as its argument and returns a function of the a same type. This essentially allows you to create a chain of functions. So in Go it would look something like this:</p>\n\n<pre><code>// this is the type of functions you want to decorate\ntype StringManipulator func(string) string\n\n// this is your decorator.\nfunc ToLower(m StringManipulator) StringManipulator {\n    return func(s string) string {\n        lower := strings.ToLower(s)\n        return m(lower)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/4ee4eDVhQS\" rel=\"noreferrer\">here's a more complete example</a></p>\n"}], "owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10777, "favorite_count": 6, "accepted_answer_id": 45945743, "answer_count": 3, "score": 14, "last_activity_date": 1510209349, "creation_date": 1504026871, "last_edit_date": 1592644375, "question_id": 45944781, "link": "https://stackoverflow.com/questions/45944781/decorator-functions-in-go", "title": "Decorator functions in Go", "body": "<p>Decorator pattern (functions) has <a href=\"https://github.com/smaxwellstewart/golang-decorator-pattern\" rel=\"noreferrer\">many benefits</a>:</p>\n<blockquote>\n<p>It is very useful when a method has many orthogonal concerns... I.e., None of these concerns are related, other than that we wanna do all (or some) of them whenever we call our method. This is where the decorator pattern really helps.</p>\n<p>By implementing the decorator pattern we subscribe to the open-closed principal. Our method is open to future extension but closed to future modification. There's a lot of groovy benefits to obeying the open-closed principle.</p>\n</blockquote>\n<p>However, all the examples that I found are really complicated (e.g., writing HTTP servers with many middlewares). This make it difficult for me to apply the principle elsewhere. I need something that I can easily try on so as to wrap my head around it.</p>\n<p>Can someone give me an simpler example that can best illustrate how to do Decorator pattern (functions) in Go please?</p>\n<p><a href=\"https://gist.github.com/alehano/8785933\" rel=\"noreferrer\">This example by Alex Alehano</a>, is too simple to be put into practical use. I need something that can illustrate this:</p>\n<pre><code>func Decorate(c Decorated, ds ...Decorator) Decorated {\n    decorated := c\n    for _, decorate := range ds {\n        decorated = decorate(decorated)\n    }\n    return decorated\n}\n</code></pre>\n<p>A string manipulation according to different option/instruction, e.g., to upper, to lower, to base64, etc, would be the best example IMO, and adding prefix/suffix too, as &quot;<a href=\"http://xion.io/post/code/go-decorated-functions.html\" rel=\"noreferrer\"><em>This technique proves especially valuable if the decorators themselves are parameterized</em></a>&quot;.</p>\n"}, {"tags": ["asynchronous", "go", "nats.io"], "answers": [{"comments": [{"owner": {"reputation": 159, "user_id": 1457011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65aa00068c785ac022d93478c0b9b000?s=128&d=identicon&r=PG", "display_name": "Karlik_B", "link": "https://stackoverflow.com/users/1457011/karlik-b"}, "edited": false, "score": 0, "creation_date": 1504077400, "post_id": 45949301, "comment_id": 78866238, "body": "Thank you very much for clarification and working example! It works flawless."}, {"owner": {"reputation": 101, "user_id": 7600667, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hmixp.jpg?s=128&g=1", "display_name": "Peter Miron", "link": "https://stackoverflow.com/users/7600667/peter-miron"}, "edited": false, "score": 0, "creation_date": 1504101891, "post_id": 45949301, "comment_id": 78883671, "body": "One minor note, if you want your counter to work correctly, you need to wrap it with a mutex e.g. <a href=\"https://stackoverflow.com/questions/16783273/golang-best-way-to-implement-global-counters-for-highly-concurrent-applications\" title=\"golang best way to implement global counters for highly concurrent applications\">stackoverflow.com/questions/16783273/&hellip;</a>"}], "tags": [], "owner": {"reputation": 4072, "user_id": 2068077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b5610681612bdc756a85d009e399f33?s=128&d=identicon&r=PG", "display_name": "ivoszz", "link": "https://stackoverflow.com/users/2068077/ivoszz"}, "is_accepted": true, "score": 2, "last_activity_date": 1504046447, "creation_date": 1504046447, "answer_id": 45949301, "question_id": 45944632, "link": "https://stackoverflow.com/questions/45944632/nats-async-reply-to-request-is-not-asynchronnous/45949301#45949301", "title": "NATS async reply to request is not asynchronnous", "body": "<p>Gnatsd reply to <code>Request</code> in async manner, but it doesn't start goroutine for each request, just pure async. And because you simulate processing load using <code>time.Sleep</code>, which pauses calling goroutine, it looks like sync processing. If you modify your example to use goroutines, everything works well.</p>\n\n<pre><code>...\nnc.Subscribe(subj, func(msg *nats.Msg) {\n    go handler(msg, i, nc)\n})\n...\n\nfunc handler(msg *nats.Msg, i int, nc *nats.Conn) {\n    i++\n    printMsg(msg, i)\n    //simulation of some processing time\n    time.Sleep(1 * time.Second)\n    newreply := []byte(fmt.Sprintf(\"REPLY TO request \\\"%s\\\", GoroutineId:%d\", string(msg.Data), getGID()))\n    nc.Publish(msg.Reply, []byte(newreply))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>./nats-rply test\n2017/08/30 00:17:05 Main goroutine ID:1\n2017/08/30 00:17:05 Listening on [test]\n2017/08/30 00:17:11 [#1] Received on [test]: 'Request6'\n2017/08/30 00:17:11 [#1] Received on [test]: 'Request5'\n2017/08/30 00:17:11 [#1] Received on [test]: 'Request1'\n2017/08/30 00:17:11 [#1] Received on [test]: 'Request8'\n2017/08/30 00:17:11 [#1] Received on [test]: 'Request3'\n2017/08/30 00:17:11 [#1] Received on [test]: 'Request7'\n2017/08/30 00:17:11 [#1] Received on [test]: 'Request9'\n2017/08/30 00:17:11 [#1] Received on [test]: 'Request4'\n2017/08/30 00:17:11 [#1] Received on [test]: 'Request2'\n2017/08/30 00:17:11 [#1] Received on [test]: 'Request10'\n\n./nats-req test\n2017/08/30 00:17:12 Published [test] : 'Request3'\n2017/08/30 00:17:12 Received [_INBOX.xoG573m0V7dVoIJxojm6Bq] : 'REPLY TO request \"Request3\", GoroutineId:37'\n2017/08/30 00:17:12 Published [test] : 'Request7'\n2017/08/30 00:17:12 Received [_INBOX.xoG573m0V7dVoIJxojm5z6] : 'REPLY TO request \"Request7\", GoroutineId:42'\n2017/08/30 00:17:12 Published [test] : 'Request10'\n2017/08/30 00:17:12 Received [_INBOX.xoG573m0V7dVoIJxojm5wY] : 'REPLY TO request \"Request10\", GoroutineId:43'\n2017/08/30 00:17:12 Published [test] : 'Request5'\n2017/08/30 00:17:12 Received [_INBOX.xoG573m0V7dVoIJxojm6EO] : 'REPLY TO request \"Request5\", GoroutineId:34'\n2017/08/30 00:17:12 Published [test] : 'Request8'\n2017/08/30 00:17:12 Received [_INBOX.xoG573m0V7dVoIJxojm66k] : 'REPLY TO request \"Request8\", GoroutineId:36'\n2017/08/30 00:17:12 Published [test] : 'Request1'\n2017/08/30 00:17:12 Received [_INBOX.xoG573m0V7dVoIJxojm64C] : 'REPLY TO request \"Request1\", GoroutineId:35'\n2017/08/30 00:17:12 Published [test] : 'Request2'\n2017/08/30 00:17:12 Received [_INBOX.xoG573m0V7dVoIJxojm6Gw] : 'REPLY TO request \"Request2\", GoroutineId:41'\n2017/08/30 00:17:12 Published [test] : 'Request4'\n2017/08/30 00:17:12 Received [_INBOX.xoG573m0V7dVoIJxojm69I] : 'REPLY TO request \"Request4\", GoroutineId:40'\n2017/08/30 00:17:12 Published [test] : 'Request9'\n2017/08/30 00:17:12 Received [_INBOX.xoG573m0V7dVoIJxojm61e] : 'REPLY TO request \"Request9\", GoroutineId:39'\n2017/08/30 00:17:12 Published [test] : 'Request6'\n2017/08/30 00:17:12 Received [_INBOX.xoG573m0V7dVoIJxojm5u0] : 'REPLY TO request \"Request6\", GoroutineId:38'\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 676, "user_id": 7817149, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x4Mpb.jpg?s=128&g=1", "display_name": "I. Kozlovic", "link": "https://stackoverflow.com/users/7817149/i-kozlovic"}, "is_accepted": false, "score": 1, "last_activity_date": 1504105298, "creation_date": 1504105298, "answer_id": 45963807, "question_id": 45944632, "link": "https://stackoverflow.com/questions/45944632/nats-async-reply-to-request-is-not-asynchronnous/45963807#45963807", "title": "NATS async reply to request is not asynchronnous", "body": "<p>Keep in mind that by starting a go-routine from the message handler, your processing order goes out of the window. This is the reason NATS is calling the message handler serially, to give user a guaranteed order. If order is not important to you, then indeed, it is easy to start processing of the message in a separate go-routine (or pool of go-routines).</p>\n"}], "owner": {"reputation": 159, "user_id": 1457011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65aa00068c785ac022d93478c0b9b000?s=128&d=identicon&r=PG", "display_name": "Karlik_B", "link": "https://stackoverflow.com/users/1457011/karlik-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1204, "favorite_count": 0, "accepted_answer_id": 45949301, "answer_count": 2, "score": 1, "last_activity_date": 1504105298, "creation_date": 1504026123, "question_id": 45944632, "link": "https://stackoverflow.com/questions/45944632/nats-async-reply-to-request-is-not-asynchronnous", "title": "NATS async reply to request is not asynchronnous", "body": "<p>I am trying to implement request/response functinonality in gnatsd using GO language and I realized that gnatsd does not reply to request in async manner.</p>\n\n<p>I started my investigation using NATS github examples <a href=\"https://github.com/nats-io/go-nats/tree/master/examples\" rel=\"nofollow noreferrer\">https://github.com/nats-io/go-nats/tree/master/examples</a> - examples nats-req.go and nats-rply.go. The examples works well.</p>\n\n<p>Then I modified them simply to test parallel requests on gnatsd and also to provide some debug info in which goroutine ID the async reply is processed.\nThere is source code of modified examples.</p>\n\n<p><strong>nats-rply.go</strong> has been modified to simply return back text of incoming request with information on current goroutine ID. I have also add to the async processing function 1 second sleep to simulate some processing time.</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"github.com/nats-io/go-nats\"\n    \"flag\"\n    \"log\"\n    \"runtime\"\n    \"time\"\n    \"bytes\"\n    \"strconv\"\n)\n\n// NOTE: Use tls scheme for TLS, e.g. nats-rply -s tls://demo.nats.io:4443 foo hello\nfunc usage() {\n    log.Fatalf(\"Usage: nats-rply [-s server][-t] &lt;subject&gt; \\n\")\n}\n\nfunc printMsg(m *nats.Msg, i int) {\n    log.Printf(\"[#%d] Received on [%s]: '%s'\\n\", i, m.Subject, string(m.Data))\n}\n\nfunc main() {\n    log.Printf(\"Main goroutine ID:%d\\n\", getGID())\n    var urls = flag.String(\"s\", nats.DefaultURL, \"The nats server URLs (separated by comma)\")\n    var showTime = flag.Bool(\"t\", false, \"Display timestamps\")\n\n    //log.SetFlags(0)\n    flag.Usage = usage\n    flag.Parse()\n\n    args := flag.Args()\n    if len(args) &lt; 1 {\n        usage()\n    }\n\n    nc, err := nats.Connect(*urls)\n    if err != nil {\n        log.Fatalf(\"Can't connect: %v\\n\", err)\n    }\n\n    subj, i := args[0], 0\n\n    nc.Subscribe(subj, func(msg *nats.Msg) {\n        i++\n        printMsg(msg, i)\n        //simulation of some processing time\n        time.Sleep(1 * time.Second)\n        newreply := []byte(fmt.Sprintf(\"REPLY TO request \\\"%s\\\", GoroutineId:%d\", string(msg.Data), getGID()))\n        nc.Publish(msg.Reply, []byte(newreply))\n    })\n    nc.Flush()\n\n    if err := nc.LastError(); err != nil {\n        log.Fatal(err)\n    }\n\n    log.Printf(\"Listening on [%s]\\n\", subj)\n    if *showTime {\n        log.SetFlags(log.LstdFlags)\n    }\n\n    runtime.Goexit()\n}\n\nfunc getGID() uint64 {\n    b := make([]byte, 64)\n    b = b[:runtime.Stack(b, false)]\n    b = bytes.TrimPrefix(b, []byte(\"goroutine \"))\n    b = b[:bytes.IndexByte(b, ' ')]\n    n, _ := strconv.ParseUint(string(b), 10, 64)\n    return n\n}\n</code></pre>\n\n<p><strong>nats-req.go</strong> has been modified to send 10 requests in separate 10 goroutines started in parallel, the request timeout has been set to 3,5 seconds. I tried goroutines with shared NATS connection (function oneReq()) and also goroutines with its own NATS connections (function onReqSeparateConnect()) - with the same unsuccessful results.</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"github.com/nats-io/go-nats\"\n    \"sync\"\n    \"time\"\n    \"log\"\n)\n\n// NOTE: Use tls scheme for TLS, e.g. nats-req -s tls://demo.nats.io:4443 foo hello\nfunc usage() {\n    log.Fatalf(\"Usage: nats-req [-s server (%s)] &lt;subject&gt; \\n\", nats.DefaultURL)\n}\n\nfunc main() {\n    //var urls = flag.String(\"s\", nats.DefaultURL, \"The nats server URLs (separated by comma)\")\n\n    //log.SetFlags(0)\n    flag.Usage = usage\n    flag.Parse()\n\n    args := flag.Args()\n    if len(args) &lt; 1 {\n        usage()\n    }\n\n    nc, err := nats.Connect(nats.DefaultURL)\n    if err != nil {\n        log.Fatalf(\"Can't connect: %v\\n\", err)\n    }\n    defer nc.Close()\n    subj := args[0]\n\n    var wg sync.WaitGroup\n    wg.Add(10)\n    for i := 1; i &lt;= 10; i++ {\n        //go oneReq(subj, fmt.Sprintf(\"Request%d\", i), nc, &amp;wg)\n        go oneReqSeparateConnect(subj, fmt.Sprintf(\"Request%d\", i), &amp;wg)\n    }\n\n    wg.Wait()\n\n}\n\nfunc oneReq(subj string, payload string, nc *nats.Conn, wg *sync.WaitGroup) {\n    defer wg.Done()\n    msg, err := nc.Request(subj, []byte(payload), 3500*time.Millisecond)\n    if err != nil {\n        if nc.LastError() != nil {\n            log.Printf(\"Error in Request: %v\\n\", nc.LastError())\n        }\n        log.Printf(\"Error in Request: %v\\n\", err)\n    } else {\n        log.Printf(\"Published [%s] : '%s'\\n\", subj, payload)\n        log.Printf(\"Received [%v] : '%s'\\n\", msg.Subject, string(msg.Data))\n    }\n}\n\nfunc oneReqSeparateConnect(subj string, payload string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    nc, err := nats.Connect(nats.DefaultURL)\n    if err != nil {\n        log.Printf(\"Can't connect: %v\\n\", err)\n        return\n    }\n    defer nc.Close()\n    msg, err := nc.Request(subj, []byte(payload), 3500*time.Millisecond)\n    if err != nil {\n        if nc.LastError() != nil {\n            log.Printf(\"Error in Request: %v\\n\", nc.LastError())\n        }\n        log.Printf(\"Error in Request: %v\\n\", err)\n    } else {\n        log.Printf(\"Published [%s] : '%s'\\n\", subj, payload)\n        log.Printf(\"Received [%v] : '%s'\\n\", msg.Subject, string(msg.Data))\n    }\n}\n</code></pre>\n\n<p>And there is result - unwanted behaviour, it looks that nats-rply.go creates only one goroutine for processing incoming reqests and the requests are processed in serial way.\nThe nats-req.go sends all 10 requests in one time with timeout set to 3,5 seconds. The nats-rply.go starts responding to the request with one second intervals in serial way, so only 3 requests are satisfied until 3,5sec timeout is breached - rest of requests timeouts. The response message also contains GoroutineID which is the same for all incoming requests! Even when nats-req is started again the goroutine id is the same, the ID changes only when nats-rply.go server is restarted.</p>\n\n<p><strong>nats-req.go log</strong></p>\n\n<pre><code>D:\\PRAC\\TSP\\AMON&gt;nats-req foo\n2017/08/29 18:46:48 Sending: 'Request9'\n2017/08/29 18:46:48 Sending: 'Request7'\n2017/08/29 18:46:48 Sending: 'Request10'\n2017/08/29 18:46:48 Sending: 'Request4'\n2017/08/29 18:46:48 Sending: 'Request8'\n2017/08/29 18:46:48 Sending: 'Request6'\n2017/08/29 18:46:48 Sending: 'Request1'\n2017/08/29 18:46:48 Sending: 'Request5'\n2017/08/29 18:46:48 Sending: 'Request2'\n2017/08/29 18:46:48 Sending: 'Request3'\n2017/08/29 18:46:49 Published [foo] : 'Request9'\n2017/08/29 18:46:49 Received [_INBOX.xrsXYOB2QmW1f52pkfLHya.xrsXYOB2QmW1f52pkfLHzJ] : 'REPLY TO request \"Request9\", GoroutineId:36'\n2017/08/29 18:46:50 Published [foo] : 'Request7'\n2017/08/29 18:46:50 Received [_INBOX.xrsXYOB2QmW1f52pkfLI02.xrsXYOB2QmW1f52pkfLI0l] : 'REPLY TO request \"Request7\", GoroutineId:36'\n2017/08/29 18:46:51 Published [foo] : 'Request10'\n2017/08/29 18:46:51 Received [_INBOX.xrsXYOB2QmW1f52pkfLI1U.xrsXYOB2QmW1f52pkfLI2D] : 'REPLY TO request \"Request10\", GoroutineId:36'\n2017/08/29 18:46:52 Error in Request: nats: timeout\n2017/08/29 18:46:52 Error in Request: nats: timeout\n2017/08/29 18:46:52 Error in Request: nats: timeout\n2017/08/29 18:46:52 Error in Request: nats: timeout\n2017/08/29 18:46:52 Error in Request: nats: timeout\n2017/08/29 18:46:52 Error in Request: nats: timeout\n2017/08/29 18:46:52 Error in Request: nats: timeout\n</code></pre>\n\n<p><strong>nats-rply.go log</strong></p>\n\n<pre><code>C:\\Users\\belunek&gt;nats-rply foo\n2017/08/29 18:46:46 Main goroutine ID:1\n2017/08/29 18:46:46 Listening on [foo]\n2017/08/29 18:46:48 [#1] Received on [foo]: 'Request9'\n2017/08/29 18:46:49 [#2] Received on [foo]: 'Request7'\n2017/08/29 18:46:50 [#3] Received on [foo]: 'Request10'\n2017/08/29 18:46:51 [#4] Received on [foo]: 'Request4'\n2017/08/29 18:46:52 [#5] Received on [foo]: 'Request8'\n2017/08/29 18:46:53 [#6] Received on [foo]: 'Request6'\n2017/08/29 18:46:54 [#7] Received on [foo]: 'Request1'\n2017/08/29 18:46:55 [#8] Received on [foo]: 'Request5'\n2017/08/29 18:46:56 [#9] Received on [foo]: 'Request2'\n2017/08/29 18:46:57 [#10] Received on [foo]: 'Request3'\n</code></pre>\n\n<p>Please any ideas, how to correctly implement request/response communication in NATS with asyns (parallel) response processing?\nThanks for any info.</p>\n"}, {"tags": ["go", "mime", "gob"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 3, "creation_date": 1504024532, "post_id": 45944128, "comment_id": 78846792, "body": "AFAIK, the gob format isn&#39;t formalised anywhere. So I would think that <code>application&#47;octet-stream</code> would fit."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1504081100, "post_id": 45944128, "comment_id": 78868505, "body": "<code>application&#47;octet-stream</code> is a catch-all and tells you <i>nothing</i> about the content. Your network connection must be between your own private nodes, I presume (gob makes little sense for a public endpoint). Should you consider transcoding into a recognised content type, e.g. to JSON?"}, {"owner": {"reputation": 4025, "user_id": 763799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r4nZd.jpg?s=128&g=1", "display_name": "basgys", "link": "https://stackoverflow.com/users/763799/basgys"}, "reply_to_user": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1504095051, "post_id": 45944128, "comment_id": 78878061, "body": "@Rick-777 Yes that&#39;s one of the trade-offs. I opted for the custom type <code>application&#47;x-gob</code> internally, and use <code>application&#47;octet-stream</code> when knowing the content type is not necessary. Yes JSON could be used for public APIs, but protobuf is a &quot;recognised&quot; type and has a generic type."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1504186640, "post_id": 45944128, "comment_id": 78925228, "body": "Looks like protobuf might have erred. See <a href=\"https://www.w3.org/Protocols/rfc1341/4_Content-Type.html\" rel=\"nofollow noreferrer\">w3.org/Protocols/rfc1341/4_Content-Type.html</a> - this suggests <code>application&#47;x-gob</code> is your best bet."}], "owner": {"reputation": 4025, "user_id": 763799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r4nZd.jpg?s=128&g=1", "display_name": "basgys", "link": "https://stackoverflow.com/users/763799/basgys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 400, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1580847039, "creation_date": 1504024234, "question_id": 45944128, "link": "https://stackoverflow.com/questions/45944128/is-there-any-gob-mime-type", "title": "Is there any Gob MIME type?", "body": "<p>Is there any (un)official Gob MIME Type, such as <code>application/x-gob</code>? The official documentation never mentions any MIME type.</p>\n\n<p>I am not sure if I should use the same approach as Protobuf, which stopped using specific types in favour of the generic <code>application/octet-stream</code> (see <a href=\"https://github.com/google/protorpc/commit/eb03145a6a7c72ae6cc43867d9635a5b8d8c4545\" rel=\"nofollow noreferrer\">Protobuffer uses octet-stream as its default content type</a>)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1504024657, "post_id": 45944052, "comment_id": 78846874, "body": "My two cents <a href=\"https://tour.golang.org/methods/9\" rel=\"nofollow noreferrer\">tour.golang.org/methods/9</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504025688, "post_id": 45944052, "comment_id": 78847421, "body": "<code>print()</code> is not the same as <code>Print()</code>. Also you aren&#39;t actually using the interface type anywhere in your example Go code. There&#39;s no reason (with the <code>Print</code> method correctly named) this wouldn&#39;t work for as many types as you need it to. What is the actual problem you&#39;re having?"}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1504025324, "post_id": 45944180, "comment_id": 78847243, "body": "as a side note, mixing pointer method / non pointer methods breaks the interface signature compatibility (must be all pointer or all non pointer)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1504025492, "post_id": 45944180, "comment_id": 78847320, "body": "@mh-cbon maybe I&#39;m misunderstading but it seems like you&#39;re saying if you mix pointer-reciever and value-receiver methods on a struct it can&#39;t fulfill an interface, which isn&#39;t true. Only the methods that are specified in the interface matter, other methods can use any receiver type (mixing pointer/value receivers is fine). It&#39;s generally a bad practice to mix receivers, but that has nothing to do with interfaces."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 3, "last_activity_date": 1504025236, "last_edit_date": 1504025236, "creation_date": 1504024429, "answer_id": 45944180, "question_id": 45944052, "link": "https://stackoverflow.com/questions/45944052/one-interface-many-implementations/45944180#45944180", "title": "One Interface, Many Implementations", "body": "<p>Any type that you define, and on which you implement a set of methods that are equal in their signatures to those defined by an interface, that type can be used in place where you expect that interface. </p>\n\n<pre><code>type NamePrinter interface {\n    print()\n}\n\ntype NamePrinterWithoutGreeting struct {\n    name string\n}\n\nfunc (p *NamePrinterWithoutGreeting) print() {\n    fmt.Println(p.name)\n}\n\ntype NamePrinterWithGreeting struct {\n    name string\n}\n\nfunc (p *NamePrinterWithGreeting) print() {\n    fmt.Println(\"Hello, \", p.name)\n}\n\ntype MyInt int\n\nfunc (i MyInt) print() {\n    fmt.Printf(\"Hello, %d\\n\", i)\n}\n\ntype MyFunc func() string\n\nfunc (f MyFunc) print() {\n    fmt.Println(\"Hello,\", f())\n}\nfunc main() {\n    var a NamePrinter = &amp;NamePrinterWithoutGreeting{\"joe\"}\n    var b NamePrinter = &amp;NamePrinterWithGreeting{\"joe\"}\n    var i NamePrinter = MyInt(2345)\n    var f NamePrinter = MyFunc(func() string { return \"funk\" })\n    a.print()\n    b.print()\n    i.print()\n    f.print()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/hW1q8eMve3\" rel=\"nofollow noreferrer\">https://play.golang.org/p/hW1q8eMve3</a></p>\n"}], "owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 45944180, "answer_count": 1, "score": -2, "last_activity_date": 1504080923, "creation_date": 1504023939, "last_edit_date": 1504080923, "question_id": 45944052, "link": "https://stackoverflow.com/questions/45944052/one-interface-many-implementations", "title": "One Interface, Many Implementations", "body": "<p>How do I translate the following Java code to Go?</p>\n\n<pre><code>interface NamePrinter {\n    void print();\n}\n\nclass NamePrinterWithoutGreeting implements NamePrinter {\n    private string name;\n\n    public NamePrinterWithoutGreeting(string name) {\n        this.name = name;\n    }\n\n    public void print() {\n        System.out.println(this.name);\n    }\n}\n\nclass NamePrinterWithGreeting implements NamePrinter {\n    private string name;\n\n    public NamePrinterWithoutGreeting(string name) {\n        this.name = name;\n    }\n\n    public void print() {\n        System.out.println(\"Hello, \" + this.name);\n    }\n}\n</code></pre>\n\n<p>Type <code>NamePrinter</code> can reference an instance of both <code>NamePrinterWithoutGreeting</code> and <code>NamePrinterWithGreeting</code>:</p>\n\n<pre><code>void main(String[] args) {\n    a NamePrinter = new NamePrinterWithoutGreeting(\"Joe\");\n    b NamePrinter = new NamePrinterWithGreeting(\"Joe\");\n\n    a.print(); // prints \"Joe\"\n    b.print(); // prints \"Hello, Joe\"\n}\n</code></pre>\n\n<p>Back to <code>go</code>... I'd like to have an <code>interface</code> of type <code>NamePrinter</code> that could reference many different implementations... but I don't know how to do it. Here below is an implementation... but it is fine for just one case:</p>\n\n<pre><code>type Person struct {\n    name string\n}\n\ntype NamePrinter interface {\n    Create(name string)\n    Print()\n}\n\nfunc Create(name string) *Person {\n    n := Person{name}\n    return &amp;n\n}\n\nfunc (p *Person) print() {\n    fmt.Println(p.name)\n}\n\nfunc main() {\n    p := Create(\"joe\")\n    fmt.Println(p.Print())\n}\n</code></pre>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "websocket", "gorilla", "redigo"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1504022296, "last_edit_date": 1504022296, "creation_date": 1504021978, "answer_id": 45943467, "question_id": 45943414, "link": "https://stackoverflow.com/questions/45943414/encode-websockets-in-go-with-gob/45943467#45943467", "title": "Encode websockets in Go with gob", "body": "<p><a href=\"https://golang.org/pkg/encoding/gob/#NewEncoder\" rel=\"nofollow noreferrer\">As detailed in the documentation</a>, argument to <code>gob.NewEncoder</code> is the <code>io.Writer</code> you want the encoded result written to. This returns an encoder, to which you pass the object you want encoded. It will encode the object and write the result to the writer.</p>\n\n<p>Assuming that <code>conn</code> is your redis connection, you want something like:</p>\n\n<pre><code>buff := new(bytes.Buffer)\nerr := gob.NewEncoder(buff).Encode(ws)\nif err != nil {\n    // handle error\n}\n_,err := conn.Do(\"RPUSH\", room, buff.Bytes())\n</code></pre>\n"}], "owner": {"reputation": 749, "user_id": 3034488, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fcfd5caca3a62bec03e4f7b3c973db31?s=128&d=identicon&r=PG&f=1", "display_name": "Galil", "link": "https://stackoverflow.com/users/3034488/galil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 45943467, "answer_count": 1, "score": -1, "last_activity_date": 1504022296, "creation_date": 1504021752, "question_id": 45943414, "link": "https://stackoverflow.com/questions/45943414/encode-websockets-in-go-with-gob", "title": "Encode websockets in Go with gob", "body": "<p>I am writing a chat application using websockets in Go. </p>\n\n<p>There will be multiple chat rooms and the idea is to store all the websockets connected to a chat room in a Redis list.</p>\n\n<p>In order to store and retrieve the websockets in Redis I have to encode/decode them and (following <a href=\"https://stackoverflow.com/questions/19055306/whats-the-best-way-to-store-websocket-connection-in-golang\">this</a> question) I thought that I can use gob for that.</p>\n\n<p>I am using <code>github.com/garyburd/redigo/redis</code> for Redis and    <code>github.com/gorilla/websocket</code> as my websocket library.</p>\n\n<p>My function looks like:</p>\n\n<pre><code>func addWebsocket(room string, ws *websocket.Conn) {\n    conn := pool.Get()\n    defer conn.Close()\n\n    enc := gob.NewEncoder(ws)\n\n    _, err := conn.Do(\"RPUSH\", room, enc)\n    if err != nil {\n        panic(err.Error())\n    }\n}\n</code></pre>\n\n<p>However, I am getting this error:</p>\n\n<p><code>cannot use ws (type *websocket.Conn) as type io.Writer in argument to gob.NewEncoder:\n        *websocket.Conn does not implement io.Writer (missing Write method)\n                have websocket.write(int, time.Time, ...[]byte) error\n                want Write([]byte) (int, error)</code></p>\n\n<p>What does this error mean? Is the whole idea of encoding the <code>*websocket.Conn</code> wrong or type conversion is required? </p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 15, "user_id": 7411239, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h08Cs.jpg?s=128&g=1", "display_name": "AndresJay", "link": "https://stackoverflow.com/users/7411239/andresjay"}, "edited": false, "score": 0, "creation_date": 1504021317, "post_id": 45943254, "comment_id": 78844758, "body": "I know it might be quite easy but im stuck in this, pls help!"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 7411239, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h08Cs.jpg?s=128&g=1", "display_name": "AndresJay", "link": "https://stackoverflow.com/users/7411239/andresjay"}, "edited": false, "score": 0, "creation_date": 1504023051, "post_id": 45943392, "comment_id": 78845867, "body": "Sorry but I don&#39;t understand ur code. Cause I don&#39;t need to Unmarshal, I need to Marshal."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 15, "user_id": 7411239, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h08Cs.jpg?s=128&g=1", "display_name": "AndresJay", "link": "https://stackoverflow.com/users/7411239/andresjay"}, "edited": false, "score": 0, "creation_date": 1504023146, "post_id": 45943392, "comment_id": 78845938, "body": "OK, you use the same code, but you populate the struct fields in your code, then <code>Marshal</code> it."}, {"owner": {"reputation": 15, "user_id": 7411239, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h08Cs.jpg?s=128&g=1", "display_name": "AndresJay", "link": "https://stackoverflow.com/users/7411239/andresjay"}, "edited": false, "score": 0, "creation_date": 1504023731, "post_id": 45943392, "comment_id": 78846313, "body": "Yes yes that&#39;s what I mean!"}, {"owner": {"reputation": 15, "user_id": 7411239, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h08Cs.jpg?s=128&g=1", "display_name": "AndresJay", "link": "https://stackoverflow.com/users/7411239/andresjay"}, "edited": false, "score": 0, "creation_date": 1504024204, "post_id": 45943392, "comment_id": 78846593, "body": "lov u windspear"}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 0, "last_activity_date": 1504023379, "last_edit_date": 1504023379, "creation_date": 1504021677, "answer_id": 45943392, "question_id": 45943254, "link": "https://stackoverflow.com/questions/45943254/how-to-build-a-three-layers-xml-in-go/45943392#45943392", "title": "How to build a three layers xml in Go", "body": "<p>You just have to nest the structs. You can go as deep as you want e.g. <code>Info</code> could have yet another struct inside it.</p>\n\n<p><a href=\"https://play.golang.org/p/pADEJXj8En\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pADEJXj8En</a></p>\n\n<pre><code>type Person struct {\n    Id int\n    Information Info\n}\n\ntype Info struct {\n    Name string `xml:\"name\"`\n}\n\nfunc main() {\n    p := &amp;Person{\n        Id: 233,\n        Information: Info {\n            Name: \"aaa\",\n        },\n    }\n    dat, err := xml.Marshal(p)\n    if err != nil {\n        return\n    }\n    fmt.Println(string(dat))\n}\n</code></pre>\n\n<p>For further information, refer to the documentation <a href=\"https://godoc.org/encoding/xml#Marshal\" rel=\"nofollow noreferrer\">https://godoc.org/encoding/xml#Marshal</a> and the example given there: <a href=\"https://godoc.org/encoding/xml?play=MarshalIndent\" rel=\"nofollow noreferrer\">https://godoc.org/encoding/xml?play=MarshalIndent</a></p>\n"}], "owner": {"reputation": 15, "user_id": 7411239, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h08Cs.jpg?s=128&g=1", "display_name": "AndresJay", "link": "https://stackoverflow.com/users/7411239/andresjay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 45943392, "answer_count": 1, "score": 0, "last_activity_date": 1504023379, "creation_date": 1504021255, "question_id": 45943254, "link": "https://stackoverflow.com/questions/45943254/how-to-build-a-three-layers-xml-in-go", "title": "How to build a three layers xml in Go", "body": "<p>I`ve do enough homework that i know how to build a one laver xml just like</p>\n\n<pre><code>&lt;name&gt;aaa&lt;/name&gt;&lt;id&gt;233&lt;/id&gt;\n</code></pre>\n\n<p>But im puzzled by how to build a three or more layers xml in go now.</p>\n\n<pre><code>&lt;Person&gt;\n    &lt;Id&gt;233&lt;/Id&gt;\n    &lt;Information&gt;\n        &lt;name&gt;aaa&lt;/name&gt;\n    &lt;/Information&gt;\n&lt;/Person&gt;\n</code></pre>\n\n<p>I know i can use Person.Id = 233 but i cant do more.\nNeed help, im a new, thks a lot!</p>\n"}, {"tags": ["unit-testing", "http", "post", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1504020335, "post_id": 45942832, "comment_id": 78844172, "body": "<a href=\"https://play.golang.org/p/KLhNHbbNWl\" rel=\"nofollow noreferrer\">play.golang.org/p/KLhNHbbNWl</a>"}, {"owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504020567, "post_id": 45942832, "comment_id": 78844324, "body": "@mkopriva Ugh, I could have thought of that myself. Would you mind adding that as an answer? Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 5, "last_activity_date": 1504020685, "creation_date": 1504020685, "answer_id": 45943065, "question_id": 45942832, "link": "https://stackoverflow.com/questions/45942832/how-do-i-mock-a-simple-post-body-when-creating-a-test-request/45943065#45943065", "title": "How do I mock a simple POST body when creating a test request", "body": "<p>You just need to set the <code>Content-Type</code> header on the request.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"net/http\"\n    \"net/http/httptest\"\n\n)\n\nfunc main() {\n    w := httptest.NewRecorder()\n    r := httptest.NewRequest(http.MethodPost, \"/\", strings.NewReader(\"a=1&amp;b=2\"))\n    r.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    handler(w, r)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    r.ParseForm()\n    fmt.Printf(\"form: %#v\\n\", r.Form)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/KLhNHbbNWl\" rel=\"noreferrer\">https://play.golang.org/p/KLhNHbbNWl</a></p>\n"}], "owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2262, "favorite_count": 1, "accepted_answer_id": 45943065, "answer_count": 1, "score": 4, "last_activity_date": 1504020685, "creation_date": 1504020022, "question_id": 45942832, "link": "https://stackoverflow.com/questions/45942832/how-do-i-mock-a-simple-post-body-when-creating-a-test-request", "title": "How do I mock a simple POST body when creating a test request", "body": "<p>I'm trying to write a unit test for a simple form handler. I cannot find any info on how to create the form body in a way that it is being picked up by <code>r.ParseForm()</code> in my handler. I can see and read from the body myself, but <code>r.Form</code> in my test will always be <code>url.Values{}</code> when it works as expected in my application.</p>\n\n<p>The code boils down to <a href=\"https://play.golang.org/p/-M0BsArcEl\" rel=\"nofollow noreferrer\">the following example</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"net/http\"\n    \"net/http/httptest\"\n\n)\n\nfunc main() {\n    w := httptest.NewRecorder()\n    r := httptest.NewRequest(http.MethodPost, \"/\", strings.NewReader(\"a=1&amp;b=2\"))\n    handler(w, r)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    r.ParseForm()\n    fmt.Printf(\"form: %#v\\n\", r.Form)\n}\n</code></pre>\n\n<p>that prints</p>\n\n<pre><code>form: url.Values{}\n</code></pre>\n\n<p>when I'd expect it to print:</p>\n\n<pre><code>form: url.Values{\"a\": []string{\"1\"}, \"b\": []string{\"2\"}}\n</code></pre>\n\n<p>How do I actually pass the body to <code>httptest.NewRequest</code> so that it gets picked up by <code>r.ParseForm</code>?</p>\n"}, {"tags": ["go", "cron"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1504018532, "post_id": 45942266, "comment_id": 78842909, "body": "Just put something like <code>if time.Now().After(targetDate)</code> in the code you&#39;re executing."}, {"owner": {"reputation": 1550, "user_id": 3281900, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100000487316008/picture?type=large", "display_name": "Pig", "link": "https://stackoverflow.com/users/3281900/pig"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504018602, "post_id": 45942266, "comment_id": 78842970, "body": "@Adrian Then I guess I would need some kind of loop to check the current time every now and then?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504018644, "post_id": 45942266, "comment_id": 78843008, "body": "That should be unnecessary since you&#39;re already scheduling it to execute on a repeating schedule right?"}, {"owner": {"reputation": 1550, "user_id": 3281900, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100000487316008/picture?type=large", "display_name": "Pig", "link": "https://stackoverflow.com/users/3281900/pig"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504019322, "post_id": 45942266, "comment_id": 78843462, "body": "@Adrian Right! Thanks!"}, {"owner": {"reputation": 1550, "user_id": 3281900, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100000487316008/picture?type=large", "display_name": "Pig", "link": "https://stackoverflow.com/users/3281900/pig"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504019638, "post_id": 45942266, "comment_id": 78843665, "body": "@Adrian But I still have no way to make sure that it starts at exactly (for example) 10:30am, since the time check could be invoke every hour like 10am, 11am, 12am, etc..."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1504020327, "post_id": 45942266, "comment_id": 78844166, "body": "It&#39;s a cron library, it looks perfectly capable of handling that sort of schedule."}, {"owner": {"reputation": 3335, "user_id": 3824876, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rFDWl.png?s=128&g=1", "display_name": "vishnu narayanan", "link": "https://stackoverflow.com/users/3824876/vishnu-narayanan"}, "edited": false, "score": 0, "creation_date": 1504029996, "post_id": 45942266, "comment_id": 78849769, "body": "Using the same go package, to invoke the cron on 9:30 am,10:30 am, 11:30 am etc...  Use  c := cron.New() c.AddFunc(&quot;0 30 * * * *&quot;, func() { fmt.Println(&quot;Every hour on the half hour&quot;)"}], "answers": [{"comments": [{"owner": {"reputation": 1550, "user_id": 3281900, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100000487316008/picture?type=large", "display_name": "Pig", "link": "https://stackoverflow.com/users/3281900/pig"}, "edited": false, "score": 0, "creation_date": 1504039039, "post_id": 45946242, "comment_id": 78854390, "body": "Thanks for the explaination. What if I want to start it at &#39;t&#39; and then every 30 minutes after?"}, {"owner": {"reputation": 3335, "user_id": 3824876, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rFDWl.png?s=128&g=1", "display_name": "vishnu narayanan", "link": "https://stackoverflow.com/users/3824876/vishnu-narayanan"}, "reply_to_user": {"reputation": 1550, "user_id": 3281900, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100000487316008/picture?type=large", "display_name": "Pig", "link": "https://stackoverflow.com/users/3281900/pig"}, "edited": false, "score": 0, "creation_date": 1504071246, "post_id": 45946242, "comment_id": 78863218, "body": "You could achieve the same in two ways :              1.  c.AddFunc(&quot;0 0,30 * * * *&quot;, func() {fmt.Println(&quot;Every thirty minutes&quot;)})           2. c.AddFunc(&quot;@every 30m&quot;, func() { fmt.Println(&quot;Every thirty minutes&quot;) })"}], "tags": [], "owner": {"reputation": 3335, "user_id": 3824876, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rFDWl.png?s=128&g=1", "display_name": "vishnu narayanan", "link": "https://stackoverflow.com/users/3824876/vishnu-narayanan"}, "is_accepted": false, "score": 1, "last_activity_date": 1504032202, "creation_date": 1504032202, "answer_id": 45946242, "question_id": 45942266, "link": "https://stackoverflow.com/questions/45942266/is-there-a-way-to-invoke-a-cron-job-on-a-certain-date-time/45946242#45946242", "title": "Is there a way to invoke a cron job on a certain date/time?", "body": "<p>Adding to @Adrians Comments,</p>\n\n<p>The package <a href=\"http://github.com/robfig/cron\" rel=\"nofollow noreferrer\">robfig/cron</a> supports cron expression format. To have the cron run 30 mins past every hour viz on 9:30 am,10:30 am, 11:30 am. You could use  </p>\n\n<blockquote>\n  <p>c.AddFunc(\"0 30 * * * *\", func() {})</p>\n</blockquote>\n\n<p>an implementation to have the cron run after Sep 1, 2017</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"github.com/robfig/cron\"\n)\n\nfunc main() {\n\n    // time set to Sep 1, 2017 00:00 Hours UTC\n    t := time.Date(2017, time.September, 1, 0, 0, 0, 0, time.UTC) \n\n    c := cron.New()\n\n    //using cron expression format to have the function run every hour on the half hour\n    c.AddFunc(\"0 30 * * * *\", func() {      \n\n        if time.Now.After(t){\n        fmt.Println(\"yay\")\n        //insert logic block\n        } \n     })\n\n}\n</code></pre>\n\n<p>Note: The cron expression format used by this package is different from the standard unix cron format. The expression format used by this package  allows for second precision unlike unix cron format.</p>\n"}, {"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": false, "score": 2, "last_activity_date": 1504081205, "creation_date": 1504081205, "answer_id": 45955384, "question_id": 45942266, "link": "https://stackoverflow.com/questions/45942266/is-there-a-way-to-invoke-a-cron-job-on-a-certain-date-time/45955384#45955384", "title": "Is there a way to invoke a cron job on a certain date/time?", "body": "<p>If you want a custom scheduling, implements your own <a href=\"https://godoc.org/github.com/robfig/cron#Schedule\" rel=\"nofollow noreferrer\"><em>scheduler</em></a>, then register the job using <a href=\"https://godoc.org/github.com/robfig/cron#Cron.Schedule\" rel=\"nofollow noreferrer\">Cron.Schedule</a>. Below is an example implementation of repeating a CRON job after a certain time:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"github.com/robfig/cron\"\n)\n\ntype MyScheduler struct {\n    At    time.Time\n    Every time.Duration\n}\n\nfunc (s *MyScheduler) Next(t time.Time) time.Time {\n    if t.After(s.At) {\n        return t.Add(s.Every)\n    }\n\n    return s.At\n}\n\nfunc main() {\n    c := cron.New()\n\n    //Execute every 2 seconds after a certain time (5 second from now)\n    now := time.Now()\n    at := now.Add(5 * time.Second) //In your case, this should be: Sep 1st, 2017\n    s := &amp;MyScheduler{at, 2 * time.Second}\n\n    c.Schedule(s, cron.FuncJob(\n        func() {\n            cur := time.Now()\n            fmt.Printf(\"  [%v] CRON job executed after %v\\n\", cur, cur.Sub(now))\n        }))\n\n    fmt.Printf(\"Now: %v\\n\", now)\n    c.Start()\n    time.Sleep(10 * time.Second)\n    c.Stop()\n}\n</code></pre>\n"}], "owner": {"reputation": 1550, "user_id": 3281900, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/100000487316008/picture?type=large", "display_name": "Pig", "link": "https://stackoverflow.com/users/3281900/pig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1510, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1504081205, "creation_date": 1504018373, "last_edit_date": 1504037157, "question_id": 45942266, "link": "https://stackoverflow.com/questions/45942266/is-there-a-way-to-invoke-a-cron-job-on-a-certain-date-time", "title": "Is there a way to invoke a cron job on a certain date/time?", "body": "<p>I am using what seems to be the most popular cron package by robfig: <a href=\"https://godoc.org/github.com/robfig/cron\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/robfig/cron</a>. Currently I know that I can invoke an hourly cron job with:</p>\n\n<pre><code>c.AddFunc(\"@hourly\", func() { fmt.Println(\"Every hour\") })\n</code></pre>\n\n<p>However I wonder if it is possible to set it so that it only starts after (for example) Sep 1st, 2017? If it's not possible using that package, how else can I achieve that? Thanks.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 10, "last_activity_date": 1504017342, "creation_date": 1504017342, "answer_id": 45941910, "question_id": 45941821, "link": "https://stackoverflow.com/questions/45941821/how-do-you-get-full-paths-of-all-files-in-a-directory-in-go/45941910#45941910", "title": "How do you get full paths of all files in a directory in Go?", "body": "<p>If you want to see a full path, you should start with a full path. <code>.</code> is a relative path.</p>\n\n<p>You can get the working path with <a href=\"https://golang.org/pkg/os/#Getwd\" rel=\"noreferrer\">os.Getwd</a></p>\n\n<pre><code>path, err := os.Getwd()\n// handle err\nprintFiles(path)\n</code></pre>\n\n<p>The rest is simply appending the file name to the directory path. You should use the <a href=\"https://golang.org/pkg/path/filepath/\" rel=\"noreferrer\"><code>path/filepath</code></a> package for that:</p>\n\n<pre><code>for _, file := range fileInfos {\n    fmt.Println(filepath.Join(path, file.Name())\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1718, "user_id": 4178785, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/i2w9D.jpg?s=128&g=1", "display_name": "Aniruddha Chakraborty", "link": "https://stackoverflow.com/users/4178785/aniruddha-chakraborty"}, "edited": false, "score": 0, "creation_date": 1615715429, "post_id": 60624229, "comment_id": 117772400, "body": "ioutil.ReadDir(dirPath) is deprecated it&#39;s os.ReadDir() now"}], "tags": [], "owner": {"reputation": 1801, "user_id": 4482269, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/00fe165b96c14b609710b822674239c4?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfack", "link": "https://stackoverflow.com/users/4482269/wolfack"}, "is_accepted": false, "score": 0, "last_activity_date": 1583866669, "creation_date": 1583866669, "answer_id": 60624229, "question_id": 45941821, "link": "https://stackoverflow.com/questions/45941821/how-do-you-get-full-paths-of-all-files-in-a-directory-in-go/60624229#60624229", "title": "How do you get full paths of all files in a directory in Go?", "body": "<p>You already have the directory path simply append them to the file name something like:</p>\n\n<pre><code>files, err := ioutil.ReadDir(dirPath)\ncheck(err)\n\nfor _, file := range files {\n    fmt.Println(dirPath + file.Name())\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 93, "user_id": 11386050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a9930117ad30cba677da5b9aa8cbc3c?s=128&d=identicon&r=PG&f=1", "display_name": "Villahousut", "link": "https://stackoverflow.com/users/11386050/villahousut"}, "edited": false, "score": 1, "creation_date": 1613757451, "post_id": 64499397, "comment_id": 117184063, "body": "ioutil.ReadDir() is deprecated since Go 1.16, you should use os.ReadDir() instead"}, {"owner": {"reputation": 563, "user_id": 921684, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pUbv3.png?s=128&g=1", "display_name": "nobody", "link": "https://stackoverflow.com/users/921684/nobody"}, "reply_to_user": {"reputation": 93, "user_id": 11386050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a9930117ad30cba677da5b9aa8cbc3c?s=128&d=identicon&r=PG&f=1", "display_name": "Villahousut", "link": "https://stackoverflow.com/users/11386050/villahousut"}, "edited": false, "score": 1, "creation_date": 1613982650, "post_id": 64499397, "comment_id": 117234195, "body": "Thank you @Villahousut, I updated the answer accordingly"}], "tags": [], "owner": {"reputation": 563, "user_id": 921684, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pUbv3.png?s=128&g=1", "display_name": "nobody", "link": "https://stackoverflow.com/users/921684/nobody"}, "is_accepted": false, "score": 0, "last_activity_date": 1613982592, "last_edit_date": 1613982592, "creation_date": 1603453536, "answer_id": 64499397, "question_id": 45941821, "link": "https://stackoverflow.com/questions/45941821/how-do-you-get-full-paths-of-all-files-in-a-directory-in-go/64499397#64499397", "title": "How do you get full paths of all files in a directory in Go?", "body": "<p>You can also use the <a href=\"https://golang.org/pkg/path/filepath/#Abs\" rel=\"nofollow noreferrer\">filepath.Abs</a> method from the standard library</p>\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    &quot;fmt&quot;\n    &quot;os&quot;\n    &quot;path/filepath&quot;\n)\n\nfiles, _ = os.ReadDir(dir)\npath, _ := filepath.Abs(dir)\nfor _, file := range files {\n    fmt.Println(filepath.Join(path, file.Name())\n}\n</code></pre>\n"}], "owner": {"reputation": 1302, "user_id": 1931698, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/XMKhh.jpg?s=128&g=1", "display_name": "Prakhar Mishra", "link": "https://stackoverflow.com/users/1931698/prakhar-mishra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6417, "favorite_count": 0, "accepted_answer_id": 45941910, "answer_count": 3, "score": 6, "last_activity_date": 1613982592, "creation_date": 1504017136, "last_edit_date": 1504020997, "question_id": 45941821, "link": "https://stackoverflow.com/questions/45941821/how-do-you-get-full-paths-of-all-files-in-a-directory-in-go", "title": "How do you get full paths of all files in a directory in Go?", "body": "<p>I am using Go to iterate over all the files in a directory. This is how I am doing it:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    printFiles(\".\")\n}\n\nfunc printFiles(dir string) {\n    fileInfos, err := ioutil.ReadDir(dir)\n    if err != nil {\n        fmt.Println(\"Error in accessing directory:\", err)\n    }\n\n    for _, file := range fileInfos {\n        fmt.Printf(\"%T: %+v\\n\", file, file)\n    }\n}\n</code></pre>\n\n<p>When I run this code, this is the output I get:</p>\n\n<pre><code>*os.fileStat: &amp;{name:main.go sys:{FileAttributes:32 CreationTime:{LowDateTime:2993982878 HighDateTime:30613689} LastAccessTime:{LowDateTime:2993982878 HighDateTime:30613689} LastWriteTime:{LowDateTime:4004986069 HighDateTime:30613714} FileSizeHigh:0 FileSizeLow:320} pipe:false Mutex:{state:0 sema:0} path:C:\\Users\\Prakhar.Mishra\\go\\src\\mistdatafilter\\main.go vol:0 idxhi:0 idxlo:0}\n</code></pre>\n\n<p>I can see a property named <strong>path</strong>, but I can't access it (due to small case initial, I suppose?). Can anyone please tell me how to get full file path of all the files in a given folder?</p>\n"}, {"tags": ["for-loop", "go", "closures", "goroutine", "for-range"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1504017328, "post_id": 45941794, "comment_id": 78841989, "body": "what&#39;s the point of the second one? you&#39;re just printing the whole slice after you&#39;ve printed <code>&quot;asd&quot;</code> 3 times. <a href=\"https://play.golang.org/p/rNEGrgS3AT\" rel=\"nofollow noreferrer\">play.golang.org/p/rNEGrgS3AT</a>"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1504017363, "post_id": 45941794, "comment_id": 78842004, "body": "<a href=\"https://github.com/golang/go/wiki/CommonMistakes#using-goroutines-on-loop-iterator-variables\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1504017687, "post_id": 45941794, "comment_id": 78842259, "body": "<a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow noreferrer\">golang.org/doc/faq#closures_and_goroutines</a>"}], "answers": [{"tags": [], "owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "is_accepted": false, "score": 0, "last_activity_date": 1504019980, "creation_date": 1504019980, "answer_id": 45942817, "question_id": 45941794, "link": "https://stackoverflow.com/questions/45941794/range-over-string-slice-is-inconsistent/45942817#45942817", "title": "Range over string slice is inconsistent", "body": "<p>When uses goroutine you must assume that it will running in parallelo. So in this case might occur 'c c c' as too 'b b b' or 'a a a'</p>\n\n<p>On run in 3 times this code:</p>\n\n<pre><code>for _,s:=range string_slice \\\\run t0, t1, t2 \n</code></pre>\n\n<p>You <strong>will send for running</strong> 3 times this code:</p>\n\n<pre><code>go func(){\n  fmt.Println(s)\n}()//send in t0, t1, t2\n</code></pre>\n\n<p>So, might occur of func() start running in t2, per example. In this case the result will 'c c c' because <em>s</em> equals latest value (string_slice[2]).</p>\n\n<p>The solution is copy value by func params:</p>\n\n<pre><code>for _, s := range string_slice{\n    go func(x string){\n        time.Sleep(1*time.Second)\n        fmt.Println(x)\n    }(s)\n}\n</code></pre>\n\n<p>Or create new value per iteration</p>\n\n<pre><code>//creating new value per iteration\nfor i := range string_slice{\n    s := string_slice[i]\n    go func(){\n        time.Sleep(1*time.Second)\n        fmt.Println(s)\n    }()\n}\n</code></pre>\n\n<p>See working in <a href=\"https://play.golang.org/p/uRD6Qy6xSw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uRD6Qy6xSw</a></p>\n"}], "owner": {"reputation": 1, "user_id": 7801568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b488883fc7aa9dcd89d0403d59f9d65a?s=128&d=identicon&r=PG&f=1", "display_name": "MyPasswordIs1password", "link": "https://stackoverflow.com/users/7801568/mypasswordis1password"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1504274561, "creation_date": 1504017086, "last_edit_date": 1504274561, "question_id": 45941794, "link": "https://stackoverflow.com/questions/45941794/range-over-string-slice-is-inconsistent", "title": "Range over string slice is inconsistent", "body": "<p>This code:</p>\n\n<pre><code>import \"fmt\"\nimport \"time\"\nfunc main() {\n    string_slice:=[]string{\"a\",\"b\",\"c\"}\n\n    for _,s:=range string_slice{\n        go func(){\n            time.Sleep(1*time.Second)\n            fmt.Println(s)\n        }()\n    }\n\n    time.Sleep(3*time.Second)\n}\n</code></pre>\n\n<p>produces the output \"c c c\", while this code:</p>\n\n<pre><code>import \"fmt\"\nfunc main() {\n    string_slice:=[]string{\"a\",\"b\",\"c\"}\n\n    for _,s:=range string_slice{\n        s=\"asd\"\n        fmt.Println(s)\n    }\n    fmt.Println(string_slice)\n}\n</code></pre>\n\n<p>produces the output \"[a b c]\"</p>\n\n<p>The first one would suggest that for range iterates over references (which it should not), and the second one suggests that it iterates over copies of values (which it should).</p>\n\n<p>Why doesn't the first one produce the output \"a b c\"?</p>\n"}, {"tags": ["go", "mocking"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504017043, "post_id": 45941260, "comment_id": 78841764, "body": "One way to solve this is to have a mediator between the interface and the implementation, basically a thin wrapper that implements the interface that you want to use and then passes the correct types to the underlying concrete type. E.g.; somthing that takes a <code>Transactioner</code>, converts it to <code>*datastore.Transaction</code>, and then passes it to <code>*datastore.Client</code>."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504017139, "post_id": 45941260, "comment_id": 78841829, "body": "That is what I&#39;m realizing. I&#39;ve made some progress, but am running into new problems with the <code>datastore.Query</code> type. If I find a complete solution, I&#39;ll post it as an answer."}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504019231, "post_id": 45942304, "comment_id": 78843415, "body": "Might be better to use <code>Querier</code> instead of <code>interface{}</code>, then have another type, let&#39;s say <code>DSQuery</code> that implements <code>Querier</code> and wraps around <code>*datastore.Query</code>, then you can get rid of type assertions and it&#39;s easy to then add and use Fake/Stub/Mock <code>Querier</code> implementations."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504027698, "post_id": 45942304, "comment_id": 78848426, "body": "last suggestion: Also wrap the constructor so that you don&#39;t have to do <code>(*Query)(q)</code> every time you want to pass a <code>Querier</code> to func. <a href=\"https://play.golang.org/p/Pql9bhJLUE\" rel=\"nofollow noreferrer\">simplified example</a>"}], "tags": [], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "is_accepted": true, "score": 3, "last_activity_date": 1504026759, "last_edit_date": 1504026759, "creation_date": 1504018458, "answer_id": 45942304, "question_id": 45941260, "link": "https://stackoverflow.com/questions/45941260/mocking-a-go-database-sdk/45942304#45942304", "title": "Mocking a Go database SDK", "body": "<p>I've gotten it to compile by using this code:</p>\n\n<pre><code>package google\n\nimport (\n    \"context\"\n\n    \"cloud.google.com/go/datastore\"\n)\n\ntype (\n    // Datastore is a wrapper for the Google Cloud Datastore Client.\n    Datastore struct {\n        *datastore.Client\n    }\n\n    // Datastorer represents things that can operate like a datastore.Client.\n    Datastorer interface {\n        Delete(context.Context, *datastore.Key) error\n        Get(context.Context, *datastore.Key, interface{}) error\n        GetAll(context.Context, interface{}, interface{}) ([]*datastore.Key, error)\n        Put(context.Context, *datastore.Key, interface{}) (*datastore.Key, error)\n        PutMulti(context.Context, []*datastore.Key, interface{}) ([]*datastore.Key, error)\n        RunInTransaction(context.Context, func(Transactioner) error, ...datastore.TransactionOption) (*datastore.Commit, error)\n    }\n\n    // Querier represents things that can operate like a datastore.Query.\n    Querier interface {\n        Filter(string, interface{}) Querier\n    }\n\n    // Transactioner represents things that can operate like a datastore.Transaction.\n    Transactioner interface {\n        Commit() (*datastore.Commit, error)\n        Delete(*datastore.Key) error\n        DeleteMulti([]*datastore.Key) error\n        Get(*datastore.Key, interface{}) error\n        GetMulti([]*datastore.Key, interface{}) error\n        Put(*datastore.Key, interface{}) (*datastore.PendingKey, error)\n        PutMulti([]*datastore.Key, interface{}) ([]*datastore.PendingKey, error)\n        Rollback() error\n    }\n)\n\n// Delete deletes the entity for the given key.\nfunc (d *Datastore) Delete(ctx context.Context, key *datastore.Key) error {\n    return d.Client.Delete(ctx, key)\n}\n\n// Get retrieves the entity for the given key.\nfunc (d *Datastore) Get(ctx context.Context, key *datastore.Key, dst interface{}) error {\n    return d.Client.Get(ctx, key, dst)\n}\n\n// GetAll retrieves all entities for the given query.\nfunc (d *Datastore) GetAll(ctx context.Context, q interface{}, dst interface{}) ([]*datastore.Key, error) {\n    return d.Client.GetAll(ctx, q.(*datastore.Query), dst)\n}\n\n// Put stores an entity for the given key.\nfunc (d *Datastore) Put(ctx context.Context, key *datastore.Key, src interface{}) (*datastore.Key, error) {\n    return d.Client.Put(ctx, key, src)\n}\n\n// PutMulti is a batch version of Put.\nfunc (d *Datastore) PutMulti(ctx context.Context, keys []*datastore.Key, src interface{}) ([]*datastore.Key, error) {\n    return d.Client.PutMulti(ctx, keys, src)\n}\n\n// RunInTransaction runs the given function in a transaction.\nfunc (d *Datastore) RunInTransaction(ctx context.Context, f func(tx Transactioner) error, opts ...datastore.TransactionOption) (*datastore.Commit, error) {\n    return d.Client.RunInTransaction(ctx, func(t *datastore.Transaction) error {\n        return f(t)\n    }, opts...)\n}\n</code></pre>\n\n<p>I changed <code>DataStore</code> to a <code>struct</code> containing the <code>datastore.Client</code> and added a new interface <code>Querier</code> that contains the functions that I am using from <code>datastore.Query</code>. I also updated <code>GetAll</code> to accept an <code>interface{}</code> instead of a <code>*datastore.Query</code> and then type-assert it to be a <code>*datastore.Query</code>. I cannot have it accept a <code>Querier</code> because then I cannot pass variables of type <code>*datastore.Query</code> because they do not satisfy the <code>Querier</code> interface (<code>Filter</code> returns a <code>Querier</code> instead of a <code>*datastore.Query</code>).</p>\n\n<p>All existing tests using the emulator running in a separate process are passing.</p>\n\n<p><strong>UPDATE</strong>:</p>\n\n<p>I changed <code>Datastore</code> to</p>\n\n<pre><code>Datastore datastore.Client\n</code></pre>\n\n<p>and added a wrapper <code>Query</code> around <code>datastore.Query</code>:</p>\n\n<pre><code>Query datastore.Query\n</code></pre>\n\n<p>Now, the <code>Datastorer</code> interface contains</p>\n\n<pre><code>GetAll(context.Context, Querier, interface{}) ([]*datastore.Key, error)\n</code></pre>\n\n<p>and the <code>GetAll</code> function is defined as</p>\n\n<pre><code>func (d *Datastore) GetAll(ctx context.Context, q Querier, dst interface{}) ([]*datastore.Key, error) {\n    return (*datastore.Client)(d).GetAll(ctx, (*datastore.Query)(q.(*Query)), dst)\n}\n</code></pre>\n\n<p>and <code>Query.Filter</code> is defined as</p>\n\n<pre><code>func (q *Query) Filter(filterStr string, value interface{}) Querier {\n    return (*Query)((*datastore.Query)(q).Filter(filterStr, value))\n}\n</code></pre>\n\n<p>In calling code, I use</p>\n\n<pre><code>q := datastore.NewQuery(entity).Filter(\"Deleted =\", false)\n_, err := r.client.GetAll(ctx, (*Query)(q), data)\n</code></pre>\n\n<p>This compiles and all tests are passing.</p>\n"}, {"comments": [{"owner": {"reputation": 459, "user_id": 437894, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/z0fyo.png?s=128&g=1", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/437894/ashwin"}, "edited": false, "score": 0, "creation_date": 1575930761, "post_id": 54695383, "comment_id": 104724575, "body": "Thanks for this :)"}], "tags": [], "owner": {"reputation": 21, "user_id": 7075246, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jPq4y.jpg?s=128&g=1", "display_name": "Michael Chemani", "link": "https://stackoverflow.com/users/7075246/michael-chemani"}, "is_accepted": false, "score": 1, "last_activity_date": 1550163225, "creation_date": 1550163225, "answer_id": 54695383, "question_id": 45941260, "link": "https://stackoverflow.com/questions/45941260/mocking-a-go-database-sdk/54695383#54695383", "title": "Mocking a Go database SDK", "body": "<p>I know that question has been asked a long time ago but in case one still may wondering how to Mock Google Datastore Client and Transaction here is a snapshot of how I got it to work.</p>\n\n<pre><code>type Client interface {\n    Get(ctx context.Context, key *datastore.Key, dst interface{}) (err error)\n    NewTransaction(ctx context.Context, opts ...datastore.TransactionOption) (t Transaction, err error)\n    Put(ctx context.Context, key *datastore.Key, src interface{}) (*datastore.Key, error)\n}\n\ntype Transaction interface {\n    Commit() (c *datastore.Commit, err error)\n    Rollback() (err error)\n    Get(key *datastore.Key, dst interface{}) (err error)\n    Put(key *datastore.Key, src interface{}) (*datastore.PendingKey, error)\n    Delete(key *datastore.Key) error\n}\n\ntype Datastore struct {\n    *datastore.Client\n}\n\nfunc (d *Datastore) NewTransaction(ctx context.Context, opts ...datastore.TransactionOption) (t Transaction, err error) {\n    return d.Client.NewTransaction(ctx, opts...)\n}\n\n\n</code></pre>\n\n<p>Of course, If you are using different method against Datastore it's up to you to implement them. </p>\n\n<p>In my tests, I can now Mock Datastore Client and Transaction like :</p>\n\n<pre><code>mockedClient := mock_gcloud.NewMockClient(ctrl)\nmockedTransaction := mock_gcloud.NewMockTransaction(ctrl)\n...\nmockedClient.EXPECT().NewTransaction(context.Background()).Return(mockedTransaction, nil).Times(1)\n\n</code></pre>\n\n<p>Et voil\u00e0.</p>\n"}], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 0, "accepted_answer_id": 45942304, "answer_count": 2, "score": 3, "last_activity_date": 1550163225, "creation_date": 1504015660, "last_edit_date": 1504015993, "question_id": 45941260, "link": "https://stackoverflow.com/questions/45941260/mocking-a-go-database-sdk", "title": "Mocking a Go database SDK", "body": "<p>I am attempting to create a wrapper for test emulating around the <a href=\"https://godoc.org/cloud.google.com/go/datastore\" rel=\"nofollow noreferrer\">Go Flex SDK for Google Cloud Datastore</a>. While I am currently successfully running the localhost emulator using</p>\n\n<pre><code>gcloud beta emulators datastore start --no-store-on-disk\n</code></pre>\n\n<p>in a separate terminal from my testing window, I would prefer to create a mock database emulator that runs as part of the test process itself (without <code>exec</code>ing the above) so that I can run multiple tests in parallel, each with its own database emulator.</p>\n\n<p>I have run into a problem with the Google SDK not implementing my interface.</p>\n\n<p>My wrapper contains this code:</p>\n\n<pre><code>package google\n\nimport (\n    \"context\"\n\n    \"cloud.google.com/go/datastore\"\n)\n\ntype (\n    // Datastore is a wrapper for the Google Cloud Datastore Client.\n    Datastore datastore.Client\n\n    // Datastorer represents things that can operate like a datastore.Client.\n    Datastorer interface {\n        Delete(context.Context, *datastore.Key) error\n        Get(context.Context, *datastore.Key, interface{}) error\n        GetAll(context.Context, *datastore.Query, interface{}) ([]*datastore.Key, error)\n        Put(context.Context, *datastore.Key, interface{}) (*datastore.Key, error)\n        PutMulti(context.Context, []*datastore.Key, interface{}) ([]*datastore.Key, error)\n        RunInTransaction(context.Context, func(Transactioner) error, ...datastore.TransactionOption) (*datastore.Commit, error)\n    }\n\n    // Transactioner represents things that can operate like a datastore.Transaction.\n    Transactioner interface {\n        Commit() (*datastore.Commit, error)\n        Delete(*datastore.Key) error\n        DeleteMulti([]*datastore.Key) error\n        Get(*datastore.Key, interface{}) error\n        GetMulti([]*datastore.Key, interface{}) error\n        Put(*datastore.Key, interface{}) (*datastore.PendingKey, error)\n        PutMulti([]*datastore.Key, interface{}) ([]*datastore.PendingKey, error)\n        Rollback() error\n    }\n)\n\n// Delete deletes the entity for the given key.\nfunc (d *Datastore) Delete(ctx context.Context, key *datastore.Key) error {\n    return (*datastore.Client)(d).Delete(ctx, key)\n}\n\n// Get retrieves the entity for the given key.\nfunc (d *Datastore) Get(ctx context.Context, key *datastore.Key, dst interface{}) error {\n    return (*datastore.Client)(d).Get(ctx, key, dst)\n}\n\n// GetAll retrieves all entities for the given query.\nfunc (d *Datastore) GetAll(ctx context.Context, q *datastore.Query, dst interface{}) ([]*datastore.Key, error) {\n    return (*datastore.Client)(d).GetAll(ctx, q, dst)\n}\n\n// Put stores an entity for the given key.\nfunc (d *Datastore) Put(ctx context.Context, key *datastore.Key, src interface{}) (*datastore.Key, error) {\n    return (*datastore.Client)(d).Put(ctx, key, src)\n}\n\n// PutMulti is a batch version of Put.\nfunc (d *Datastore) PutMulti(ctx context.Context, keys []*datastore.Key, src interface{}) ([]*datastore.Key, error) {\n    return (*datastore.Client)(d).PutMulti(ctx, keys, src)\n}\n\n// RunInTransaction runs the given function in a transaction.\nfunc (d *Datastore) RunInTransaction(ctx context.Context, f func(tx Transactioner) error, opts ...datastore.TransactionOption) (*datastore.Commit, error) {\n    return (*datastore.Client)(d).RunInTransaction(ctx, func(t *datastore.Transaction) error {\n        return f(t)\n    }, opts...)\n}\n</code></pre>\n\n<p>Note that these interfaces do not emulate the complete SDK. I am only including functions that I actually call in my code. I'll add new ones as needed later.</p>\n\n<p>When I try to use an instance of <code>*datastore.Client</code> as a <code>Datastorer</code>, I get the following error:</p>\n\n<pre><code>cannot use client (type *\"cloud.google.com/go/datastore\".Client) as type Datastorer in field value:\n    *\"cloud.google.com/go/datastore\".Client does not implement Datastorer (wrong type for RunInTransaction method)\n        have RunInTransaction(context.Context, func(*\"cloud.google.com/go/datastore\".Transaction) error, ...\"cloud.google.com/go/datastore\".TransactionOption) (*\"cloud.google.com/go/datastore\".Commit, error)\n        want RunInTransaction(context.Context, func(Transactioner) error, ...\"cloud.google.com/go/datastore\".TransactionOption) (*\"cloud.google.com/go/datastore\".Commit, error)\n</code></pre>\n\n<p>because <code>*datastore.Client</code> requires a function that takes a <code>func(*datastore.Transaction) error</code> and my interface wants a <code>func(Transactioner) error</code>.</p>\n\n<p>Is there any way to change this so that it compiles?</p>\n\n<p>If I can get it working, I plan to create types that implement my <code>Datastorer</code> and <code>Transactioner</code> interfaces and use maps to mock the real database. As far as tranactions go, for testing I can use <code>sync.Mutex</code> if I need them, but since each test is a single thread and will get its own database object, I may not need to lock them.</p>\n"}, {"tags": ["mongodb", "go", "aggregation-framework", "mgo"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 1, "creation_date": 1504012092, "post_id": 45939899, "comment_id": 78838013, "body": "It&#39;s not a &quot;map&quot; but just a regular list."}], "answers": [{"tags": [], "owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "is_accepted": true, "score": 2, "last_activity_date": 1504012900, "creation_date": 1504012900, "answer_id": 45940306, "question_id": 45939899, "link": "https://stackoverflow.com/questions/45939899/how-to-use-indexofarray-with-go/45940306#45940306", "title": "How to use $indexOfArray with Go?", "body": "<p>The argument to <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/indexOfArray/\" rel=\"nofollow noreferrer\"><code>$indexOfArray</code></a> is simply a list of \"string\" so <code>[]string</code>:</p>\n\n<pre><code>bson.M{\"$indexOfArray\": []string{\"$shops.name\", \"shop_name2\"}}\n</code></pre>\n\n<p>Or in full context:</p>\n\n<pre><code>err := c.Pipe([]bson.M{\n {\"$match\": bson.M{\"customer\": \"cust1\"}},\n {\"$project\": bson.M{\n   \"matchedIndex\": bson.M{\"$indexOfArray\": []string{\"$shops.name\", \"shop_name2\"}}\n }}\n}).One(&amp;hehehe)\n</code></pre>\n"}], "owner": {"reputation": 11643, "user_id": 239923, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/f4ZA3.jpg?s=128&g=1", "display_name": "xiaodai", "link": "https://stackoverflow.com/users/239923/xiaodai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 45940306, "answer_count": 1, "score": 0, "last_activity_date": 1504012913, "creation_date": 1504011720, "last_edit_date": 1504012913, "question_id": 45939899, "link": "https://stackoverflow.com/questions/45939899/how-to-use-indexofarray-with-go", "title": "How to use $indexOfArray with Go?", "body": "<p>Say I have the following data in my mongo customers collection</p>\n\n<pre><code>{customer:\"cust1\", \n shops:[\n   {name:\"shop_name1\", sales:200}, \n   {name:\"shop_name2\", sales:300}\n ]}\n</code></pre>\n\n<p>In mongo shell I can do this command and it return the index of shop_name2 in the shops array which is 1</p>\n\n<pre><code>db.customers.aggregate([{\"$match\":{customer:\"cust1\"}},{\"$project\":{\"matchedIndex\":{\"$indexOfArray\":[\"$shops.name\",\"shop_name2\"]}}}])\n</code></pre>\n\n<p>However in mgo </p>\n\n<pre><code>err := c.Pipe([]bson.M{{\"$match\": bson.M{\"customer\": \"cust1\"}}, {\"$project\": bson.M{\"matchedIndex\": bson.M{\"$indexOfArray\": []bson.M{{\"$shops.name\": \"shop_name2\"}}}}}}).One(&amp;hehehe)\n</code></pre>\n\n<p>fails with the following message </p>\n\n<blockquote>\n  <p>Unrecognized expression '$shops.name'</p>\n</blockquote>\n\n<p>When I check the documentation for <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/indexOfArray/\" rel=\"nofollow noreferrer\">$indexOfArray</a> I note the second argument is an array. So I suspect I am specifying the array wrong but I can't find any reference on how to set this up for mgo.</p>\n"}, {"tags": ["go", "web-scraping", "web-crawler", "headless-browser"], "comments": [{"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1504013488, "post_id": 45938288, "comment_id": 78839083, "body": "@TimCooper: This question is specifically about the chromedp package."}], "answers": [{"comments": [{"owner": {"reputation": 2038, "user_id": 648913, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ae5ffe0f6fb08ddb16ef0af9f39f1eaf?s=128&d=identicon&r=PG", "display_name": "DonSeba", "link": "https://stackoverflow.com/users/648913/donseba"}, "edited": false, "score": 1, "creation_date": 1581682771, "post_id": 46353922, "comment_id": 106527757, "body": "This is not useful at all, why does someone has to scrape through your code to find a solution with a problem. If you want to be helpful post the code here."}], "tags": [], "owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "is_accepted": true, "score": -2, "last_activity_date": 1506031939, "creation_date": 1506031939, "answer_id": 46353922, "question_id": 45938288, "link": "https://stackoverflow.com/questions/45938288/chromedp-package-how-to-get-updated-html-source-of-the-webpage-which-has-dynami/46353922#46353922", "title": "Chromedp Package: How to get updated HTML source of the webpage which has dynamically loaded contents by using chromedp", "body": "<p>After many attempts, Finally, I found the way and solved my query.\nYou can check my <a href=\"https://github.com/yogesh-desai/WebCrawlerTokopedia\" rel=\"nofollow noreferrer\">GitHub</a> repository for this query.\nThank you.</p>\n"}], "owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1287, "favorite_count": 1, "accepted_answer_id": 46353922, "answer_count": 1, "score": 1, "last_activity_date": 1613513673, "creation_date": 1504007112, "last_edit_date": 1613513673, "question_id": 45938288, "link": "https://stackoverflow.com/questions/45938288/chromedp-package-how-to-get-updated-html-source-of-the-webpage-which-has-dynami", "title": "Chromedp Package: How to get updated HTML source of the webpage which has dynamically loaded contents by using chromedp", "body": "<p>I am trying to scrape the video links on the web page, <a href=\"https://www.tokopedia.com/chocoapple/ready-stock-bnib-iphone-128gb-7-plus-jet-black-garansi-apple-1-tahun-10?src=topads\" rel=\"nofollow noreferrer\">https://www.tokopedia.com/chocoapple/ready-stock-bnib-iphone-128gb-7-plus-jet-black-garansi-apple-1-tahun-10?src=topads</a>\nThere are links, which are getting generated through &quot;webyclip&quot; service which loads the data after the page is loaded. I want the updated HTML source of the page after all the JavaScripts and AJAX are loaded (Similar when we do &quot;Inspect element&quot; on a browser). How to get it done through the chromedp package (<a href=\"https://github.com/knq/chromedp\" rel=\"nofollow noreferrer\">https://github.com/knq/chromedp</a>). It is a headless browser for GoLang. Please help. I am a newbie in web scraping.</p>\n<p>EDIT: It is not similar to the another question mentioned in the link. As this is specific to chromedp package. The one in the comments ask for how to/ what to use to scrape dynamic contents.</p>\n"}, {"tags": ["performance", "go", "closures"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1504006388, "post_id": 45937924, "comment_id": 78833789, "body": "The overhead of a either is so small compared to anything that package does you likely couldn&#39;t even test it. You can easily write a benchmark to compare the two directly."}, {"owner": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1504006509, "post_id": 45937924, "comment_id": 78833902, "body": "@JimB The question isn\u2019t about that package. Such a situation could arise in many different circumstances."}], "answers": [{"comments": [{"owner": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "edited": false, "score": 2, "creation_date": 1504014030, "post_id": 45938622, "comment_id": 78839468, "body": "\u201cI don&#39;t think scope of function declaration can harm performance\u201d \u2014 I think it can, because in general, an anonymous function closes over local variables at runtime. I cannot accept your answer without further substantiation."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "edited": false, "score": 0, "creation_date": 1504015499, "post_id": 45938622, "comment_id": 78840576, "body": "Doesn&#39;t global named function closes over global variables at runtime? What&#39;s the performance difference?"}, {"owner": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "edited": false, "score": 2, "creation_date": 1504030631, "post_id": 45938622, "comment_id": 78850065, "body": "No, not at runtime. There is only one instance of each global variable and function, they are static, their locations are known at compile time. (I assume this works in Go like it does in C.) A closure, on the other hand, may be different at least for each invocation of the enclosing function."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1504008047, "creation_date": 1504008047, "answer_id": 45938622, "question_id": 45937924, "link": "https://stackoverflow.com/questions/45937924/in-go-do-non-capturing-closures-harm-performance/45938622#45938622", "title": "In Go, do non-capturing closures harm performance?", "body": "<p>I don't think scope of function declaration can harm performance. Also it's common to inline lambda in call. I'd write it</p>\n\n<pre><code>body, ok := scrape.Find(root, func (n *html.Node) bool {return n.DataAtom == atom.Body})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "edited": false, "score": 0, "creation_date": 1504624165, "post_id": 46022687, "comment_id": 79076545, "body": "Your benchmark misses the point a bit. You create a closure once, then call it in a loop from the containing function. My scenario is when the containing function is called (and thus the closure is created?) in a loop."}, {"owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "reply_to_user": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "edited": false, "score": 0, "creation_date": 1504653563, "post_id": 46022687, "comment_id": 79090032, "body": "Well, it still depends on the compiler logic and your particular case. If this was java (for example) then yes, your point would make a perfect sense as closures there are just glorified instances of anonymous classes. But you don&#39;t always need a new object to capture the scope. In fact, analyzing compiled code for my benchmark with <code>go tool objdump</code> it looks like both closures were compiled as code-only (accessing &quot;captured&quot; variable directly). I.e. they all ended up as just functions in the end."}, {"owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "reply_to_user": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "edited": false, "score": 0, "creation_date": 1504653972, "post_id": 46022687, "comment_id": 79090110, "body": "However, if you return a closure from your function, I would expect an allocation per closure instance. Still, I would expect &quot;non-capturing&quot; closures to stay code-only as they capture all their scope in their code and thus there is no need for new instance each time. But once again, if that&#39;s important in your case - benchmark it and check compiled code with <code>go tool objdump</code> as we can only guess based on what a compiler <i>tends</i> to do, but in the end it is compiler that makes the decision."}, {"owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "edited": false, "score": 0, "creation_date": 1554280790, "post_id": 46022687, "comment_id": 97688914, "body": "Definitely have to benchmark it.  Testing a similar thing I found that calling a closure vs non-closure didn&#39;t have a big difference but if I eliminated <i>all</i> closures (replacing them with regular top level funcs) the compiler seemed to be able to do some optimization that made things run more fasterer than any of the code that had closures."}], "tags": [], "owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "is_accepted": false, "score": 1, "last_activity_date": 1504435936, "creation_date": 1504435936, "answer_id": 46022687, "question_id": 45937924, "link": "https://stackoverflow.com/questions/45937924/in-go-do-non-capturing-closures-harm-performance/46022687#46022687", "title": "In Go, do non-capturing closures harm performance?", "body": "<p>It generally should. And probably even more so with compiler optimization taken into account (as reasoning about a function is generally easier then about a closure, so I would expect a compiler to tend to optimize a function more often then an equivalent closure). But it is not exactly black and white as many factors may affect the final code produced, including your platform and version of the compiler itself. And more importantly, your other code will typically affect performance much more then speed of making a call (both algorithm wise and lines of code wise), which seems to be the point JimB made.</p>\n\n<p>For example, I wrote following sample code and then benchmarked it.</p>\n\n<pre><code>var (\n    test int64\n)\n\nconst (\n    testThreshold = int64(1000000000)\n)\n\nfunc someFunc() {\n    test += 1\n}\n\nfunc funcTest(threshold int64) int64 {\n    test = 0\n    for i := int64(0); i &lt; threshold; i++ {\n        someFunc()\n    }\n    return test\n}\n\nfunc closureTest(threshold int64) int64 {\n    someClosure := func() {\n        test += 1\n    }\n\n    test = 0\n    for i := int64(0); i &lt; threshold; i++ {\n        someClosure()\n    }\n    return test\n}\n\nfunc closureTestLocal(threshold int64) int64 {\n    var localTest int64\n    localClosure := func() {\n        localTest += 1\n    }\n\n    localTest = 0\n    for i := int64(0); i &lt; threshold; i++ {\n        localClosure()\n    }\n    return localTest\n}\n</code></pre>\n\n<p>On my laptop, funcTest takes 2.0 ns per iteration, closureTest takes 2.2 ns and \nclosureTestLocal takes 1.9ns. Here, closureTest vs funcTest appears confirming your (and mine) assumption that a closure call will be slower then a function call. But please note that those test functions were intentionally made simple and small to make call speed difference to stand out and it's still only 10% difference. In fact, checking compiler output shows that actually in funcTest case compiler did inline funcTest instead of calling it. So, I would expect the difference be even smaller if it didn't. But more importantly, I'd like to point out that closureTestLocal is 5% faster then the (inlined) function even though this one is actually a capturing closure. Please note that neither of the closures was inlined or optimized out - both closure tests faithfully make all the calls. The only difference I see in the compiled code for local closure case  operates completely on the stack, while both other functions access a global variable (somewhere in memory) by it's address. But whilst I easily can reason about the difference by looking at the compiled code, my point is - it's not exactly black and white even in the simplest cases.</p>\n\n<p>So, if speed is really that important in your case, I would suggest benchmarking it instead (and with actual code). You also could use <code>go tool objdump</code> to analyze actual code produced to get a clue where difference comes from. But as a rule of thumb, I would suggest to rather focus on writing better code (whatever that means for you) and ignore speed of actual calls (as in \"avoid premature optimization\").</p>\n"}, {"comments": [{"owner": {"reputation": 338, "user_id": 9819139, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-NLKOVJhJiK4/AAAAAAAAAAI/AAAAAAAAATI/bS_q408N-vo/photo.jpg?sz=128", "display_name": "Bill", "link": "https://stackoverflow.com/users/9819139/bill"}, "edited": false, "score": 1, "creation_date": 1598790908, "post_id": 48097706, "comment_id": 112567137, "body": "Revisiting this with Go 1.14.7, <code>-gcflags &#39;-m -m&#39;</code> indicates that both <code>topLevelFunction</code> and <code>innerFunction</code> are so small that they get inlined, so it would make sense for the assembly output to be the same.  For this to be a real comparison, I think the functions need to be slightly larger so they don&#39;t get inlined."}], "tags": [], "owner": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "is_accepted": true, "score": 6, "last_activity_date": 1515077189, "creation_date": 1515077189, "answer_id": 48097706, "question_id": 45937924, "link": "https://stackoverflow.com/questions/45937924/in-go-do-non-capturing-closures-harm-performance/48097706#48097706", "title": "In Go, do non-capturing closures harm performance?", "body": "<p>It seems like there is no difference. We can check in the generated machine code.</p>\n\n<p>Here is a toy program:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc topLevelFunction(x int) int {\n    return x + 4\n}\n\nfunc useFunction(fn func(int) int) {\n    fmt.Println(fn(10))\n}\n\nfunc invoke() {\n    innerFunction := func(x int) int {\n        return x + 8\n    }\n    useFunction(topLevelFunction)\n    useFunction(innerFunction)\n}\n\nfunc main() {\n    invoke()\n}\n</code></pre>\n\n<p>And here is its disassembly:</p>\n\n<pre><code>$ go version\ngo version go1.8.5 linux/amd64\n\n$ go tool objdump -s 'main\\.(invoke|topLevel)' bin/toy \nTEXT main.topLevelFunction(SB) /home/vasiliy/cur/work/learn-go/src/my/toy/toy.go\n    toy.go:6    0x47b7a0    488b442408  MOVQ 0x8(SP), AX    \n    toy.go:6    0x47b7a5    4883c004    ADDQ $0x4, AX       \n    toy.go:6    0x47b7a9    4889442410  MOVQ AX, 0x10(SP)   \n    toy.go:6    0x47b7ae    c3      RET         \n\nTEXT main.invoke(SB) /home/vasiliy/cur/work/learn-go/src/my/toy/toy.go\n    toy.go:13   0x47b870    64488b0c25f8ffffff  FS MOVQ FS:0xfffffff8, CX       \n    toy.go:13   0x47b879    483b6110        CMPQ 0x10(CX), SP           \n    toy.go:13   0x47b87d    7638            JBE 0x47b8b7                \n    toy.go:13   0x47b87f    4883ec10        SUBQ $0x10, SP              \n    toy.go:13   0x47b883    48896c2408      MOVQ BP, 0x8(SP)            \n    toy.go:13   0x47b888    488d6c2408      LEAQ 0x8(SP), BP            \n    toy.go:17   0x47b88d    488d052cfb0200      LEAQ 0x2fb2c(IP), AX            \n    toy.go:17   0x47b894    48890424        MOVQ AX, 0(SP)              \n    toy.go:17   0x47b898    e813ffffff      CALL main.useFunction(SB)       \n    toy.go:14   0x47b89d    488d0514fb0200      LEAQ 0x2fb14(IP), AX            \n    toy.go:18   0x47b8a4    48890424        MOVQ AX, 0(SP)              \n    toy.go:18   0x47b8a8    e803ffffff      CALL main.useFunction(SB)       \n    toy.go:19   0x47b8ad    488b6c2408      MOVQ 0x8(SP), BP            \n    toy.go:19   0x47b8b2    4883c410        ADDQ $0x10, SP              \n    toy.go:19   0x47b8b6    c3          RET                 \n    toy.go:13   0x47b8b7    e874f7fcff      CALL runtime.morestack_noctxt(SB)   \n    toy.go:13   0x47b8bc    ebb2            JMP main.invoke(SB)         \n\nTEXT main.invoke.func1(SB) /home/vasiliy/cur/work/learn-go/src/my/toy/toy.go\n    toy.go:15   0x47b8f0    488b442408  MOVQ 0x8(SP), AX    \n    toy.go:15   0x47b8f5    4883c008    ADDQ $0x8, AX       \n    toy.go:15   0x47b8f9    4889442410  MOVQ AX, 0x10(SP)   \n    toy.go:15   0x47b8fe    c3      RET         \n</code></pre>\n\n<p>As we can see, at least in this simple case, there is no structural difference in how <code>topLevelFunction</code> and <code>innerFunction</code> (<code>invoke.func1</code>), and their passing to <code>useFunction</code>, are translated to machine code.</p>\n\n<p>(It is instructive to compare this to the case where <code>innerFunction</code> does capture a local variable; and to the case where, moreover, <code>innerFunction</code> is passed via a global variable rather than a function argument \u2014 but these are left as an exercise to the reader.)</p>\n"}], "owner": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2922, "favorite_count": 1, "accepted_answer_id": 48097706, "answer_count": 3, "score": 5, "last_activity_date": 1515077189, "creation_date": 1504005931, "question_id": 45937924, "link": "https://stackoverflow.com/questions/45937924/in-go-do-non-capturing-closures-harm-performance", "title": "In Go, do non-capturing closures harm performance?", "body": "<p>For instance, <a href=\"https://godoc.org/github.com/yhat/scrape#Find\" rel=\"noreferrer\">github.com/yhat/scrape</a> suggests using a closure like this:</p>\n\n<pre><code>func someFunc() {\n    ...\n    matcher := func(n *html.Node) bool {\n        return n.DataAtom == atom.Body\n    }\n    body, ok := scrape.Find(root, matcher)\n    ...\n}\n</code></pre>\n\n<p>Since <code>matcher</code> doesn\u2019t actually capture any local variables, this could equivalently be written as:</p>\n\n<pre><code>func someFunc() {\n    ...\n    body, ok := scrape.Find(root, matcher)\n    ...\n}\n\nfunc matcher(n *html.Node) bool {\n    return n.DataAtom == atom.Body\n}\n</code></pre>\n\n<p>The first form looks better, because the matcher function is quite specific to that place in the code. But does it perform worse at runtime (assuming <code>someFunc</code> may be called often)?</p>\n\n<p>I guess there must be some overhead to creating a closure, but this kind of closure could be optimized into a regular function by the compiler?</p>\n\n<p>(Obviously the language spec doesn\u2019t require this; I\u2019m interested in what gc actually does.)</p>\n"}, {"tags": ["assembly", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1504004795, "post_id": 45937105, "comment_id": 78832697, "body": "Does Go assembly even support defining methods? I&#39;ve only seen functions defined in assembly, never methods."}, {"owner": {"reputation": 149, "user_id": 6581912, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/5f01ffd293668d9f604ab20986d4b247?s=128&d=identicon&r=PG&f=1", "display_name": "mc.robin", "link": "https://stackoverflow.com/users/6581912/mc-robin"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1504005230, "post_id": 45937105, "comment_id": 78833019, "body": "No, T.MyTest is work. But T.MyTestp cannot compile"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504012896, "post_id": 45937105, "comment_id": 78838658, "body": "What are you using to compile the assembly?"}, {"owner": {"reputation": 149, "user_id": 6581912, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/5f01ffd293668d9f604ab20986d4b247?s=128&d=identicon&r=PG&f=1", "display_name": "mc.robin", "link": "https://stackoverflow.com/users/6581912/mc-robin"}, "edited": false, "score": 0, "creation_date": 1504015092, "post_id": 45937105, "comment_id": 78840245, "body": "I use  go build to compile the project."}], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 5314203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b878acd08fee0e8b8626176c3a8c236?s=128&d=identicon&r=PG&f=1", "display_name": "doubletoker", "link": "https://stackoverflow.com/users/5314203/doubletoker"}, "is_accepted": false, "score": 0, "last_activity_date": 1505630585, "creation_date": 1505630585, "answer_id": 46261420, "question_id": 45937105, "link": "https://stackoverflow.com/questions/45937105/underline-implement-of-golang-method-using-golang-assembly-language/46261420#46261420", "title": "underline implement of golang method using golang assembly language", "body": "<p>ok well you have 3 different tools you're talking about, as for go object dump it does dump the correct symbols. The go compiler compiles go source code and generates symbols such as the above. The go assembler can't use without modification symbols with '(', \"*\", \")\" and many others. When it see's the parentheses it expects what's inside to be a register. So you got a few options, like use a different assembler that supports symbols like that, you could modify the assembler to allow symbols like that or you could rename your symbols to something that the go assembler allows.</p>\n"}], "owner": {"reputation": 149, "user_id": 6581912, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/5f01ffd293668d9f604ab20986d4b247?s=128&d=identicon&r=PG&f=1", "display_name": "mc.robin", "link": "https://stackoverflow.com/users/6581912/mc-robin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 235, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1505630585, "creation_date": 1504003522, "last_edit_date": 1504065745, "question_id": 45937105, "link": "https://stackoverflow.com/questions/45937105/underline-implement-of-golang-method-using-golang-assembly-language", "title": "underline implement of golang method using golang assembly language", "body": "<p>I wrote a simple go package as follows:</p>\n\n<pre><code>package mytest\n\ntype T int32\n\nfunc (a T) MyTest(b T) (T, T)\nfunc (p *T) MyTestp(b T) (T, T)\nfunc MyTest(a, b T) (T, T)\nfunc MyTestp(p *T, b T) (T, T)\n</code></pre>\n\n<p>The corresponding assembly code(generated by go tool objdump), as follows:</p>\n\n<pre><code>TEXT \u00b7MyTest(SB), $0-16\nMOVL a + 0x0(FP), AX\nMOVL b + 0x4(FP), BX\nMOVL BX, CX\nADDL AX, CX\nMOVL CX, r1 + 0x8(FP)\nSUBL BX, AX\nMOVL AX, r2 + 0xc(FP)\nRET\n\nTEXT \u00b7MyTestp(SB), $0-24\nMOVQ p + 0x0(FP), CX\nMOVL b + 0x8(FP), BX\nMOVL (CX), AX\nMOVL BX, CX\nADDL AX, CX\nMOVL CX, r1 + 0x10(FP)\nSUBL BX, AX\nMOVL AX, r2 + 0x14(FP)\nRET\n\nTEXT \u00b7T\u00b7MyTest(SB), $0-16\nMOVL a + 0x0(FP), AX\nMOVL b + 0x4(FP), BX\nMOVL BX, CX\nADDL AX, CX\nMOVL CX, r1 + 0x8(FP)\nSUBL BX, AX\nMOVL AX, r2 + 0xc(FP)\nRET\n\nTEXT \u00b7(*T)\u00b7MyTestp(SB), $0-24\nMOVQ p + 0x0(FP), CX\nMOVL b + 0x8(FP), BX\nMOVL (CX), AX\nMOVL BX, CX\nADDL AX, CX\nMOVL CX, r1 + 0xC(FP)\nSUBL BX, AX\nMOVL AX, r2 + 0x10(FP)\nRET\n</code></pre>\n\n<p>when I compile these assembly code, all is ok except \"TEXT \u00b7(*T)\u00b7MyTestp(SB), $0-24\", error message as follows:</p>\n\n<pre><code>expected identifier, found *\n</code></pre>\n\n<p>I think objdump using a readable denotion (*T) for output, but for complier, it is wrong. so any one know the correct denotion? Thanks in advance!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1504002824, "post_id": 45936745, "comment_id": 78831462, "body": "Looks like a MySQL driver bug, not <code>database&#47;sql</code>&#39;s. Either way, you should almost never use <code>interface{}</code> when scanning results. If <code>id</code> is an integer, scan into <code>int64</code>."}], "answers": [{"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 1, "last_activity_date": 1504073378, "creation_date": 1504073378, "answer_id": 45953119, "question_id": 45936745, "link": "https://stackoverflow.com/questions/45936745/go-package-database-sql-got-the-diff-result-when-use-the-same-sql-query/45953119#45953119", "title": "Go package &quot;database/sql&quot; got the diff-result when use the same SQL-query", "body": "<p>This is related to issue <a href=\"https://github.com/go-sql-driver/mysql/issues/366\" rel=\"nofollow noreferrer\">#366</a>. There are two protocols in MySQL: </p>\n\n<ol>\n<li><strong>Text protocol</strong>. When text protocol is used, regardless of column's type, the query result will be stored as <code>[]byte</code>. Related source code can be found at method <a href=\"https://github.com/go-sql-driver/mysql/blob/26471af196a17ee75a22e6481b5a5897fb16b081/packets.go#L733\" rel=\"nofollow noreferrer\"><code>textRows.readRow</code></a>. Further conversion will be done during <a href=\"https://golang.org/pkg/database/sql/#Rows.Scan\" rel=\"nofollow noreferrer\"><code>rows.Scan</code></a> which is part of <code>database/sql</code> package. Here, the result will be converted (if convertible) from <code>[]byte</code> to the type of argument being passed to <code>Scan</code>.     </li>\n<li>Newer <strong>binary protocol</strong>. When this protocol is used, the query result will be converted to appropriate type based on column's type. Related source code can be found at <a href=\"https://github.com/go-sql-driver/mysql/blob/26471af196a17ee75a22e6481b5a5897fb16b081/packets.go#L1143\" rel=\"nofollow noreferrer\"><code>binaryRows.readRow</code></a>. </li>\n</ol>\n\n<p>In this question, since the type of <code>Scan</code> argument is <code>interface{}</code>, in <code>database/sql</code> side, no conversion will occurs. When issuing a <code>query without args</code>, it seems that the driver will used <em>text protocol</em>, but when the query has argument(s), the driver will create prepared-statement then communicate to the server using <em>binary protocol</em>. In short:</p>\n\n<ol>\n<li>Query no args: <em>text protocol</em> &#8594; result in <code>[]byte</code> &#8594; result scanned to <code>interface{}</code> &#8594; result is returned as ASCII code of <code>123456</code> (i.e. <code>[49 50 51 52 53 54]</code>).</li>\n<li>Query with args: <em>binary protocol</em> &#8594; conversion based on column type (<code>int64</code>) &#8594; result scanned to <code>interface{}</code> &#8594; result returned as <code>int64</code>. </li>\n</ol>\n\n<p>If you want to get same result, use the following code for first query (for clarity, error handling is omitted):</p>\n\n<pre><code>//Comment out\n//rows, _ := db.Query(\"SELECT id FROM test_1 WHERE id=123456\")\n\n//then replace with\nstmt, _ := db.Prepare(\"SELECT id FROM test_1 WHERE id=123456\")\ndefer stmt.Close()\nrows, _ := stmt.Query()\n</code></pre>\n"}], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 45953119, "answer_count": 1, "score": 2, "last_activity_date": 1504073378, "creation_date": 1504002493, "last_edit_date": 1504002795, "question_id": 45936745, "link": "https://stackoverflow.com/questions/45936745/go-package-database-sql-got-the-diff-result-when-use-the-same-sql-query", "title": "Go package &quot;database/sql&quot; got the diff-result when use the same SQL-query", "body": "<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nfunc main() {\n    db, _ := sql.Open(\"mysql\", \"root:root@tcp(127.0.0.1:3306)/test\")\n\n    // Just Query\n    rows, _ := db.Query(\"SELECT id FROM test_1 WHERE id=123456\")\n    for rows.Next() {\n        var id interface{}\n        rows.Scan(&amp;id)\n        fmt.Println(\"Query no args =&gt;\", id)\n    }\n\n    // Query with args\n    rows, _ = db.Query(\"SELECT id FROM test_1 WHERE id=?\", 123456)\n    for rows.Next() {\n        var id interface{}\n        rows.Scan(&amp;id)\n        fmt.Println(\"Query has args =&gt;\", id)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run main.go\nQuery no args =&gt; [49 50 51 52 53 54]\nQuery has args =&gt; 123456\n</code></pre>\n\n<p>Question:</p>\n\n<p>In my mind, <code>\"SELECT id FROM test_1 WHERE id=123456\"</code> and <code>\"SELECT id FROM test_1 WHERE id=?\", 123456</code> are same SQL-query.</p>\n\n<p>Why the result's TYPE is not same?</p>\n\n<p>Is it a bug or just unfriendly API design?</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "answers": [{"tags": [], "owner": {"reputation": 1041, "user_id": 7730968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kCdXw.png?s=128&g=1", "display_name": "kenfire", "link": "https://stackoverflow.com/users/7730968/kenfire"}, "is_accepted": true, "score": 4, "last_activity_date": 1503991023, "creation_date": 1503991023, "answer_id": 45932958, "question_id": 45932957, "link": "https://stackoverflow.com/questions/45932957/how-to-read-multiple-json-objects-from-one-file-in-go/45932958#45932958", "title": "How to read multiple JSON objects from one file in Go", "body": "<p>To do this, you need to wrap the <code>Mysql</code> and <code>Postgres</code> structure into a <code>Configuration</code> structure then pass it to Unmarshal function:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>type Configuration struct {\n    Mysql    Mysql\n    Postgres Postgres\n}\n\nfunc main() {\n    content, err := ioutil.ReadFile(confPath)\n    var conf Configuration\n    err = json.Unmarshal(content, &amp;conf)\n}\n</code></pre>\n\n<p>See full working example: <a href=\"https://play.golang.org./p/7CtALgsjK3\" rel=\"nofollow noreferrer\">https://play.golang.org./p/7CtALgsjK3</a></p>\n\n<p>Hope this will help some people.</p>\n"}, {"comments": [{"owner": {"reputation": 1041, "user_id": 7730968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kCdXw.png?s=128&g=1", "display_name": "kenfire", "link": "https://stackoverflow.com/users/7730968/kenfire"}, "edited": false, "score": 0, "creation_date": 1503999772, "post_id": 45935517, "comment_id": 78829365, "body": "Thank you for the alternative but to me your solution is less easy to read/understand"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 1, "last_activity_date": 1504002542, "last_edit_date": 1504002542, "creation_date": 1503999138, "answer_id": 45935517, "question_id": 45932957, "link": "https://stackoverflow.com/questions/45932957/how-to-read-multiple-json-objects-from-one-file-in-go/45935517#45935517", "title": "How to read multiple JSON objects from one file in Go", "body": "<p>Just another way:</p>\n\n<pre><code>m := make(map[string]Db)\nerr := json.Unmarshal([]byte(input), &amp;m)\n</code></pre>\n\n<p>try <a href=\"https://play.golang.org/p/GDPE3eWASA\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    m := make(map[string]Db)\n    err := json.Unmarshal([]byte(input), &amp;m)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(m)\n}\n\ntype Db struct {\n    Address  string\n    Port     string\n    User     string\n    Password string\n    Database string\n}\n\nconst input = `{\n  \"mysql\": {\n    \"address\": \"127.0.0.1\",\n    \"port\": \"3306\",\n    \"user\": \"user\",\n    \"password\": \"password\",\n    \"database\": \"database\"\n  },\n  \"postgres\": {\n    \"address\": \"127.0.0.2\",\n    \"port\": \"3306\",\n    \"user\": \"user2\",\n    \"password\": \"password2\",\n    \"database\": \"database2\"\n  }\n}`\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>map[mysql:{127.0.0.1 3306 user password database} postgres:{127.0.0.2 3306 user2 password2 database2}]\n</code></pre>\n\n<hr>\n\n<p>Even this works for you:</p>\n\n<pre><code>m := make(map[string]map[string]string)\nerr := json.Unmarshal([]byte(input), &amp;m)\n</code></pre>\n\n<p>try <a href=\"https://play.golang.org/p/ZpfUOb9sB8\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    m := make(map[string]map[string]string)\n    err := json.Unmarshal([]byte(input), &amp;m)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(m)\n}\n\nconst input = `{\n  \"mysql\": {\n    \"address\": \"127.0.0.1\",\n    \"port\": \"3306\",\n    \"user\": \"user\",\n    \"password\": \"password\",\n    \"database\": \"database\"\n  },\n  \"postgres\": {\n    \"address\": \"127.0.0.2\",\n    \"port\": \"3306\",\n    \"user\": \"user2\",\n    \"password\": \"password2\",\n    \"database\": \"database2\"\n  }\n}`\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>map[mysql:map[address:127.0.0.1 port:3306 user:user password:password database:database] postgres:map[database:database2 address:127.0.0.2 port:3306 user:user2 password:password2]]\n</code></pre>\n"}], "owner": {"reputation": 1041, "user_id": 7730968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kCdXw.png?s=128&g=1", "display_name": "kenfire", "link": "https://stackoverflow.com/users/7730968/kenfire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2219, "favorite_count": 1, "accepted_answer_id": 45932958, "answer_count": 2, "score": 0, "last_activity_date": 1504254103, "creation_date": 1503991023, "last_edit_date": 1504254103, "question_id": 45932957, "link": "https://stackoverflow.com/questions/45932957/how-to-read-multiple-json-objects-from-one-file-in-go", "title": "How to read multiple JSON objects from one file in Go", "body": "<p>How can I read a JSON file where there is two different objects using Unmarshal ?</p>\n\n<h2>JSON example:</h2>\n\n<p>This is the structure corresponding to the JSON file.</p>\n\n<pre><code>{\n  \"mysql\": {\n    \"address\": \"127.0.0.1\",\n    \"port\": \"3306\",\n    \"user\": \"user\",\n    \"password\": \"password\",\n    \"database\": \"database\"\n  },\n  \"postgres\": {\n    \"address\": \"127.0.0.2\",\n    \"port\": \"3306\",\n    \"user\": \"user2\",\n    \"password\": \"password2\",\n    \"database\": \"database2\"\n  }\n}\n</code></pre>\n\n<h2>Code snippet:</h2>\n\n<pre class=\"lang-go prettyprint-override\"><code>type Database struct {\n    Address  string\n    Port     string\n    User     string\n    Password string\n    Database string\n}\ntype Mysql struct {\n    Database\n}\ntype Postgres struct {\n    Database\n}\n</code></pre>\n"}, {"tags": ["go", "import", "path"], "answers": [{"tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": false, "score": 2, "last_activity_date": 1503989992, "creation_date": 1503989992, "answer_id": 45932658, "question_id": 45932523, "link": "https://stackoverflow.com/questions/45932523/import-package-path-issues-in-go/45932658#45932658", "title": "Import package Path issues in Go", "body": "<p>To import <code>collections</code> inside bstAvl.go, use the full path:</p>\n\n<pre><code>import \"github.com/user/collections\"\n</code></pre>\n\n<p>When it comes to structure, it all depends on types of package, and I do not know Java collections enough to give advice in this specific case.  </p>\n\n<p>However, to avoid getting a repeating <em>collections/collections</em>, I would suggest placing the <em>bstAvl</em> folder directly under the initial <em>collections</em>-folder:</p>\n\n<pre><code>+/$GOPATH\n    /bin  \n    /pkg  \n    /src  \n        /github.com\n            /user\n               /collections\n                   collections.go\n                   main.go\n                   /bstAvl\n                      bstAvl.go\n</code></pre>\n"}], "owner": {"reputation": 926, "user_id": 3083825, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a0acf64bb8976dcf3dc0a2a1e3994ca8?s=128&d=identicon&r=PG", "display_name": "SomeGuyFortune", "link": "https://stackoverflow.com/users/3083825/someguyfortune"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503991624, "creation_date": 1503989460, "last_edit_date": 1503991624, "question_id": 45932523, "link": "https://stackoverflow.com/questions/45932523/import-package-path-issues-in-go", "title": "Import package Path issues in Go", "body": "<p>I am trying to build a collections package in Go, and I am having trouble with import paths. </p>\n\n<p>I am modeling the Java Collections interface. Here is my file structure </p>\n\n<pre><code>+/$GOPATH\n    /bin  \n    /pkg  \n    /src  \n        /github.com\n            /user\n               /collections\n                   collections.go\n                   main.go\n                  /collections\n                      /bstAvl\n                         bstAvl.go\n</code></pre>\n\n<p>My collections.go file looks like this:</p>\n\n<pre><code>package collections\n\ntype Collection interface {\n    Add(interface{}) (bool, error)\n    AddAll(Collection) (bool, error)\n    Clear()\n    Contains(interface{}) (bool, error)\n    Remove(interface{}) (bool, error)\n    Size() uint\n}\n</code></pre>\n\n<p>In <code>bstAvl.go</code> i am trying to use the <code>Collection</code> interface in <code>Collections.go</code></p>\n\n<p>How do I import the required package to access the Collection interface?</p>\n\n<p>I think I have gone overboard with the paths, probably made it more complicated than it should be. Is the simpler structure you recommend?</p>\n\n<p>Ideally, I would want all my collections to be under the <code>collections</code> package so that it could be exported as a library and used in other applications if need be.</p>\n\n<p>P.S I have read <a href=\"https://medium.com/@benbjohnson/structuring-applications-in-go-3b04be4ff091\" rel=\"nofollow noreferrer\">Structuring applications in Go by Ben Johnson</a>. But I am still confused. Any help is greatly appreciated.</p>\n\n<p>EDIT:\nI guess i over worked the package structure. I have decided to stick with this:</p>\n\n<pre><code>+/$GOPATH\n    /bin  \n    /pkg  \n    /src  \n        /github.com\n            /user\n               /collections\n                   collections.go\n                   main.go\n                   bstAvl.go\n</code></pre>\n"}, {"tags": ["go", "byte", "bit"], "answers": [{"comments": [{"owner": {"reputation": 52, "user_id": 2733452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a29f6760a686121f6fdd1ce7c02f1ed8?s=128&d=identicon&r=PG&f=1", "display_name": "Leonel Franchelli", "link": "https://stackoverflow.com/users/2733452/leonel-franchelli"}, "edited": false, "score": 0, "creation_date": 1504022599, "post_id": 45931354, "comment_id": 78845593, "body": "Thx so much for taking the time to respond, your answer is really helpfull to me.  Ps: sry for my english"}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 5, "last_activity_date": 1503984912, "creation_date": 1503984912, "answer_id": 45931354, "question_id": 45930589, "link": "https://stackoverflow.com/questions/45930589/golang-int24-to-int32/45931354#45931354", "title": "GoLang Int24 to Int32", "body": "<p>Your solution is very readable, does what you want, and is <em>fast enough</em>.</p>\n\n<p>If you want to make it faster you can just do the bit shifting and or'ing yourself,</p>\n\n<pre><code>func int24ToInt32(bs []byte) uint32 {\n    return uint32(bs[2]) | uint32(bs[1])&lt;&lt;8 | uint32(bs[0])&lt;&lt;16\n}\n</code></pre>\n\n<p>This has no allocations, and doesn't do bounds checking like the standard library.  It's also a couple orders of magnitude faster than using binary package, but we are talking nanoseconds so whether it is worth the hit to readability is really the question.</p>\n"}], "owner": {"reputation": 52, "user_id": 2733452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a29f6760a686121f6fdd1ce7c02f1ed8?s=128&d=identicon&r=PG&f=1", "display_name": "Leonel Franchelli", "link": "https://stackoverflow.com/users/2733452/leonel-franchelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1039, "favorite_count": 0, "closed_date": 1503999120, "accepted_answer_id": 45931354, "answer_count": 1, "score": -1, "last_activity_date": 1503984912, "creation_date": 1503980154, "question_id": 45930589, "link": "https://stackoverflow.com/questions/45930589/golang-int24-to-int32", "closed_reason": "Opinion-based", "title": "GoLang Int24 to Int32", "body": "<p>Hi guys i wrote this function in GoLang to cast a 24 bit int (3 bytes) to a 32 bit int (4 bytes)</p>\n\n<pre><code>func int24ToInt32(bytes []byte) uint32 {\n    return binary.BigEndian.Uint32(append([]byte{0x00}, bytes...))\n}\n</code></pre>\n\n<p>I want to know if this is a bad solution to the problem. Maybe someone can guide me out to a better and efficient solution</p>\n"}, {"tags": ["go", "go-templates", "go-html-template"], "answers": [{"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 2, "last_activity_date": 1503975104, "creation_date": 1503975104, "answer_id": 45929998, "question_id": 45929461, "link": "https://stackoverflow.com/questions/45929461/how-to-calculate-a-total-for-a-column-inside-a-golang-template/45929998#45929998", "title": "How to calculate a total for a column inside a golang template?", "body": "<p>In Go's template, once you declare a variable and assign value to it, you can't change its value. What happen in your code are:</p>\n\n<ol>\n<li>The value of outer total price which is declared as <code>$TotalPrice := 0.0</code> is always <code>0.0</code>, and the variable scope is extended to the end of the template. </li>\n<li>When you defined a variable named <code>$TotalPrice</code> inside <code>range</code>, although the variable name is the same, a completely new variable will be allocated. The value assigned to this variable is given by <code>FloatInc($TotalPrice, .TotalPrice)</code>. Note that argument <code>$TotalPrice</code> refers to outer total price which is <code>0.0</code>, so the statement will be equal to <code>$TotalPrice := 0.0 + .TotalPrice</code>. Thus, when you print the <code>$TotalPrice</code> in each iteration, you got <em>current</em> <code>.TotalPrice</code> instead of accumulated total price. </li>\n<li>The scope of variable declared in (2) is between <code>range</code> and <code>end</code>. Thus when you print <code>$TotalPrice</code> at the last row, you got the value of outer total price declared in (1), i.e. <code>0.0</code>.</li>\n</ol>\n\n<p>In your case, you need to declare a function which takes <code>Transactions</code> as its argument then calculate the total inside the function, e.g.</p>\n\n<pre><code>tmpl.AddFunc(\"sum\", func(transactions []Transaction) float64 {\n    sum := 0.0\n    for _, t := range transactions {\n        if v, err := strconv.ParseFloat(t.TotalPrice, 64); err == nil {\n            sum += v\n        }\n    }\n    return sum\n})\n</code></pre>\n\n<p>then use it in the template as:</p>\n\n<pre><code>{{ $TotalPrice := sum .Transactions }}\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 6471502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2e374da7ef445717c5e09c4e26bbe37?s=128&d=identicon&r=PG&f=1", "display_name": "Sr. Libre", "link": "https://stackoverflow.com/users/6471502/sr-libre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1423, "favorite_count": 0, "accepted_answer_id": 45929998, "answer_count": 1, "score": 0, "last_activity_date": 1503975104, "creation_date": 1503970558, "question_id": 45929461, "link": "https://stackoverflow.com/questions/45929461/how-to-calculate-a-total-for-a-column-inside-a-golang-template", "title": "How to calculate a total for a column inside a golang template?", "body": "<p>I have this code inside a html/template:</p>\n\n<pre><code>{{ $TotalPrice := 0.0 }}\n{{ range $i, $tx := .Transactions }}\n{{ $TotalPrice := FloatInc $TotalPrice (StrToFloat .TotalPrice) }}\n  &lt;tr&gt;\n    &lt;td&gt;{{ inc $i 1 }}&lt;/td&gt; \n    &lt;td&gt;{{ .Description.String }}&lt;/td&gt;\n    &lt;td&gt;{{ .Type }}&lt;/td&gt;\n    &lt;td&gt;{{ .TotalPrice }}&lt;/td&gt;\n    &lt;td&gt;{{ .Note }}&lt;/td&gt;  \n  &lt;/tr&gt;  \n{{ end }}\n&lt;tr&gt;\n  &lt;td&gt;&lt;/td&gt; \n  &lt;td&gt;&lt;/td&gt;\n  &lt;td&gt;&lt;/td&gt;\n  &lt;td&gt;{{ $TotalPrice }}&lt;/td&gt;\n  &lt;td&gt;&lt;/td&gt;\n  &lt;td&gt;&lt;/td&gt;\n&lt;/tr&gt; \n</code></pre>\n\n<p>Transactions are Money Transaction with TotalPrice DB Fields and I have 4 functions according <a href=\"https://iris-go.com/\" rel=\"nofollow noreferrer\">Iris framework</a> spec.</p>\n\n<pre><code>tmpl.AddFunc(\"dec\", func(num int, step int) int {\n    return num - step\n})\n\ntmpl.AddFunc(\"inc\", func(num int, step int) int {\n    return num + step\n})\n\ntmpl.AddFunc(\"FloatDec\", func(num float64, step float64) float64 {\n    return num - step\n})\n\ntmpl.AddFunc(\"FloatInc\", func(num float64, step float64) float64 {\n    return num + step\n})\n\ntmpl.AddFunc(\"StrToFloat\", func(s string) (float64, error) {\n    return strconv.ParseFloat(s, 64)\n}) \n</code></pre>\n\n<p>I've note the $TotalPrice keeps the initial value (0.0) for every iteration so {{ $TotalPrice }} inside the range will print the .TotalPrice value and the value of $TotalPrice at the last row will be 0.0 too then what is the equivalent, inside go template, of:</p>\n\n<pre><code>nums := []int{2, 3, 4}\nsum := 0\nfor _, num := range nums {\n    sum += num\n}\nfmt.Println(\"sum:\", sum)\n</code></pre>\n"}, {"tags": ["go", "oauth-2.0"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503955321, "post_id": 45927519, "comment_id": 78813779, "body": "Please <code>fmt</code> your code before posting it... that was a pain to fix for you."}, {"owner": {"reputation": 11, "user_id": 7786541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c89b8f231e7f6dc0a7f52e4e6ee3fee5?s=128&d=identicon&r=PG&f=1", "display_name": "Sunny", "link": "https://stackoverflow.com/users/7786541/sunny"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503955641, "post_id": 45927519, "comment_id": 78813893, "body": "I did fmt the code. It is displaying properly now. Have you seen it same way?"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1503959088, "post_id": 45927519, "comment_id": 78814939, "body": "Is the OAuth server &quot;broken&quot; (i.e. does it expect client_id and client_secret to be passed via query parameters instead of basic auth.)? If so, you need to first call <a href=\"https://godoc.org/golang.org/x/oauth2#RegisterBrokenAuthHeaderProvider\" rel=\"nofollow noreferrer\"><code>oauth2.RegisterBrokenAuthHeaderProvider</code></a>."}, {"owner": {"reputation": 11, "user_id": 7786541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c89b8f231e7f6dc0a7f52e4e6ee3fee5?s=128&d=identicon&r=PG&f=1", "display_name": "Sunny", "link": "https://stackoverflow.com/users/7786541/sunny"}, "edited": false, "score": 0, "creation_date": 1503966793, "post_id": 45927519, "comment_id": 78816769, "body": "Awesome. It worked after adding that. Thanks Tim"}], "owner": {"reputation": 11, "user_id": 7786541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c89b8f231e7f6dc0a7f52e4e6ee3fee5?s=128&d=identicon&r=PG&f=1", "display_name": "Sunny", "link": "https://stackoverflow.com/users/7786541/sunny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 234, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1503955574, "creation_date": 1503955114, "last_edit_date": 1503955574, "question_id": 45927519, "link": "https://stackoverflow.com/questions/45927519/goalng-oauth2-cannot-fetch-token-client-id-cannot-be-null", "title": "goalng oauth2: cannot fetch token: &quot;client_id cannot be null&quot;", "body": "<p>I am working on OAuth2 authentication, Here is the code snippet for that, </p>\n\n<pre><code>import (\n    \"context\"\n    \"fmt\"\n    \"net/http\"\n    \"golang.org/x/oauth2\"\n)\n\nvar (\n    ctx  context.Context\n    conf = &amp;oauth2.Config{\n        RedirectURL:  \"http://localhost:3001/ApiCallback\",\n        ClientID:     \"C1c179367105720f145aecefa4fafdd587f3\",\n        ClientSecret: \"ff3abcfad5acfe03ff64e9ca56c636e72b12\",\n        Scopes:       []string{\"all\"},\n        Endpoint: oauth2.Endpoint{AuthURL: \"https://api.example.com/v1/authorize\",\n            TokenURL: \"https://api.example.com/v1/access_token\",\n        },\n    }\n    url = conf.AuthCodeURL(\"state\", oauth2.AccessTypeOnline)\n)\n\nfunc main() {\n\n    ctx = context.Background()\n    http.HandleFunc(\"/\", handler)\n    http.HandleFunc(\"/ApiLogin\", handleOAuthAPILogin)\n    http.HandleFunc(\"/ApiCallback\", handleAPICallback)\n    fmt.Println(http.ListenAndServe(\":3001\", nil))\n\n    fmt.Printf(\"Visit the URL for the auth dialog: %v\", url)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi there, I love %s!\", r.URL.Path[1:])\n}\n\nfunc handleOAuthAPILogin(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"Came to Spark Login\")\n    http.Redirect(w, r, url, http.StatusTemporaryRedirect)\n}\n\nfunc handleAPICallback(w http.ResponseWriter, r *http.Request) {\n\n    fmt.Println(\"Came to Callback\")\n    code := r.FormValue(\"code\")\n\n    fmt.Println(\"Auth Code:\", code)\n    fmt.Println(\"Client ID:\", conf.ClientID)\n    fmt.Println(\"Client Secret:\", conf.ClientSecret)\n\n    token, err := conf.Exchange(ctx, code)\n    if err != nil {\n        fmt.Println(\"Code exchange failed with '%s'\\n\", err)\n        http.Redirect(w, r, \"/\", http.StatusTemporaryRedirect)\n    }\n    fmt.Println(\"Token Code:\", token)\n}\n</code></pre>\n\n<p>Using above code snippet, \nI am able to get the code(Authorization code) after log in, but it is failing while it exchanges that code. It is throwing the error saying that \"client_id\" is null.</p>\n\n<p>I have verified my \"conf\" object , there are values exist. </p>\n\n<p>But it still throws this error. Can any one please help me to fix this</p>\n\n<p>Here is the output</p>\n\n<pre><code>$ go run main.go\nCame to Spark Login\nCame to Callback\nAuth Code: YzdjZGZmZTgtYTllYi00zQ1OTI2OTNiZTQtYmQx\nClient ID: C1c179367145aecefa4fafdd587f3\nClient Secret: ff3abcfad5acfe034b9531ff64e9ca56c636e72b12\nCode exchange failed with '%s'\n oauth2: cannot fetch token: 400 Bad Request\nResponse: {\"errorCode\":0,\"message\":\"client_id cannot be null\",\"errors\":[{\"errorCode\":0,\"description\":\"client_id cannot be null\"}],\"trackingId\":\"NA_3ca9eb7e-f3ce-406\n2-8c29-7030ea9b1a08\"}\n</code></pre>\n"}, {"tags": ["postgresql", "datetime", "go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503953985, "post_id": 45926555, "comment_id": 78813228, "body": "I don&#39;t see what the problem is. It DOES retain the timezone. <a href=\"https://play.golang.org/p/Lj_uxCts1R\" rel=\"nofollow noreferrer\">play.golang.org/p/Lj_uxCts1R</a> . Oh wait... I see, your qualm is with how <code>sqlx</code> is parsing it."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503955079, "post_id": 45926555, "comment_id": 78813691, "body": "Have you tried using <code>string</code> in your struct instead of <code>time.Time</code> and then parsing it yourself with the layout as in my playground link?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503958486, "post_id": 45926555, "comment_id": 78814779, "body": "I&#39;m actually starting to wonder if you might have an old version of the <code>pq</code> driver and need an update. According to the code I&#39;ve looked through and the test cases I&#39;ve seen (<a href=\"https://github.com/lib/pq/blob/e42267488fe361b9dc034be7a6bffef5b195bceb/encode_test.go#L191\" rel=\"nofollow noreferrer\">github.com/lib/pq/blob/e42267488fe361b9dc034be7a6bffef5b195&zwnj;&#8203;bceb/&hellip;</a>), it should have NO problem handling TimeZones properly. I suggest you run <code>go get -u github.com&#47;lib&#47;pq</code>"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1503980820, "post_id": 45926555, "comment_id": 78819729, "body": "What exactly do yo mean with <code>retain time zone information</code>? <code>Date:&quot;2017-08-28T07:00:00Z&quot;</code> is equal to <code>2017-08-28 09:00:00+02</code> and <code>sec:63650354400</code> is number of seconds since <i>zero time</i> (January 1, year 1, 00:00:00.000000000 UTC) which is equal to <code>2017-12-31 23:00:00+01</code>"}, {"owner": {"reputation": 4255, "user_id": 319826, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/TLA0j.jpg?s=128&g=1", "display_name": "kometen", "link": "https://stackoverflow.com/users/319826/kometen"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504007365, "post_id": 45926555, "comment_id": 78834454, "body": "@RayfenWindspear Thank you for your input. The pq-driver was installed a few days ago so updating did not change the parsing. Date is parsed as string, RepeatUntil as time.Time. If you are being sarcastic by using the word &#39;qualm&#39; I&#39;d appreciate you refrain from that and rather not answer."}, {"owner": {"reputation": 4255, "user_id": 319826, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/TLA0j.jpg?s=128&g=1", "display_name": "kometen", "link": "https://stackoverflow.com/users/319826/kometen"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1504007852, "post_id": 45926555, "comment_id": 78834815, "body": "@putu If the date could be passed with timezone unchanged when the db is configured to a certain timezone. I was not aware seconds was relative to year 1. Could not find the info at <a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">golang.org/pkg/time</a>. Thank you."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504019564, "post_id": 45926555, "comment_id": 78843631, "body": "@kometen Hah, seems I&#39;ve been misusing the word &quot;qualm&quot; all my life. I meant it meaning &quot;quarrel&quot;, or &quot;issue/problem&quot;."}, {"owner": {"reputation": 4255, "user_id": 319826, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/TLA0j.jpg?s=128&g=1", "display_name": "kometen", "link": "https://stackoverflow.com/users/319826/kometen"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504019824, "post_id": 45926555, "comment_id": 78843808, "body": "@RayfenWindspear Pardon. :-)"}], "answers": [{"tags": [], "owner": {"reputation": 4255, "user_id": 319826, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/TLA0j.jpg?s=128&g=1", "display_name": "kometen", "link": "https://stackoverflow.com/users/319826/kometen"}, "is_accepted": false, "score": 1, "last_activity_date": 1504010907, "creation_date": 1504010907, "answer_id": 45939613, "question_id": 45926555, "link": "https://stackoverflow.com/questions/45926555/retain-time-zone-information-from-postgresql-timestamp-in-go/45939613#45939613", "title": "Retain time zone information from postgresql timestamp in go", "body": "<p>The timezone can be configured during a single connection or by <a href=\"https://www.postgresql.org/message-id/ii01ob%24dad%241%40reversiblemaps.ath.cx\" rel=\"nofollow noreferrer\">altering</a> the timezone setting in the database.</p>\n\n<p><code>alter database foo set timezone to 'Europe/Oslo';</code></p>\n\n<p>This will return the date formatted for that timezone.</p>\n"}, {"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 4, "last_activity_date": 1504010976, "creation_date": 1504010976, "answer_id": 45939633, "question_id": 45926555, "link": "https://stackoverflow.com/questions/45926555/retain-time-zone-information-from-postgresql-timestamp-in-go/45939633#45939633", "title": "Retain time zone information from postgresql timestamp in go", "body": "<p>The timezone in PostgreSQL is session parameter, i.e. it can be specified for each session (connection). If you don't specify it, the timezone will be inferred from setting parameters in <code>pg_hba.conf</code>. When you select records, the date/time data then will be converted automatically from database timezone to session (connection) timezone. </p>\n\n<p>In your case, to get the time in specific timezone, specify it explicitly in the <em>connection parameters</em>, e.g.</p>\n\n<pre><code>psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\n    \"dbname=%s sslmode=disable TimeZone=Europe/Paris\",\n    host, port, user, dbname)\ndb, err := sqlx.Open(\"postgres\", psqlInfo)\n</code></pre>\n\n<p>The <code>TimeZone</code> can be obtained by </p>\n\n<pre><code>select * from pg_timezone_names;\n</code></pre>\n"}], "owner": {"reputation": 4255, "user_id": 319826, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/TLA0j.jpg?s=128&g=1", "display_name": "kometen", "link": "https://stackoverflow.com/users/319826/kometen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3064, "favorite_count": 1, "accepted_answer_id": 45939633, "answer_count": 2, "score": 2, "last_activity_date": 1504010976, "creation_date": 1503950613, "question_id": 45926555, "link": "https://stackoverflow.com/questions/45926555/retain-time-zone-information-from-postgresql-timestamp-in-go", "title": "Retain time zone information from postgresql timestamp in go", "body": "<p>I have a postgresql db with the columns date and repeat_until as timestamp with time zone. The example dates have a time zone specific format. The latter is winter time.</p>\n\n<p><code>2017-08-28 09:00:00+02</code>, <code>2017-12-31 23:00:00+01</code></p>\n\n<p>Using string and time.Time the first gives the time relative to GMT+0, the latter seconds (not unix timestamp).</p>\n\n<pre><code>import (\n    _ \"github.com/lib/pq\"\n    \"fmt\"\n    \"github.com/gorilla/mux\"\n    \"github.com/jmoiron/sqlx\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\ntype Event struct {\n    Date            string\n    RepeatUntil     time.Time   `db:\"repeat_until\"`\n}\n\n\nevent := Event{}\nrows, _ := db.Queryx(\"select * from events order by date\")\nfor rows.Next() {\n    err := rows.StructScan(&amp;event)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    fmt.Printf(\"%#v\", event)\n}\n</code></pre>\n\n<p><code>Date:\"2017-08-28T07:00:00Z\"</code></p>\n\n<p><code>RepeatUntil:time.Time{sec:63650354400, nsec:0, loc:(*time.Location)(nil)}</code></p>\n\n<p>What is the recommended way to retain time zone information? time.Time seems obvious but I am not sure how it got to seconds which is in year 3986 in unixtime.</p>\n\n<p>I'm using <a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow noreferrer\">sqlx</a>.</p>\n"}, {"tags": ["android", "go", "webview", "android-webview", "gomobile"], "owner": {"reputation": 1951, "user_id": 1442219, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6398031dc321aa3c975436e11d752f6b?s=128&d=identicon&r=PG", "display_name": "Lanti", "link": "https://stackoverflow.com/users/1442219/lanti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 287, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1504081423, "creation_date": 1503945741, "last_edit_date": 1504081423, "question_id": 45925453, "link": "https://stackoverflow.com/questions/45925453/parsing-assets-from-src-main-assets-folder-with-gomobile", "title": "Parsing assets from src/main/assets folder with gomobile", "body": "<p>I have a <code>gomobile</code> native Android app which embedded into <code>webview</code>. This setup works nice, I even managed to use the gorilla mux router, but I wanted to use <code>pongo2</code> templating engine also and I run into a problem when I try to parse my template html files.</p>\n\n<p>I have the following line in my <code>./app/build.gradle</code> file:</p>\n\n<pre><code>android {\n  sourceSets {\n    main {\n      assets.srcDirs = ['assets']\n    }\n  }\n}\n</code></pre>\n\n<p>I placed my html file here, which I try to parse on the index route: <code>./app/src/main/assets/views/index.html</code>.</p>\n\n<pre><code>func index(w http.ResponseWriter, r *http.Request) {\n  w.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n  //res, err := http.Get(\"https://google.com\")\n  res, err := http.Get(\"file:///android_asset/views/index.html\")\n  if err != nil {\n    fmt.Fprintf(w, \"could not execute: %v\\n\", err)\n  }\n  text, err := ioutil.ReadAll(res.Body)\n  res.Body.Close()\n  if err != nil {\n    fmt.Fprintf(w, \"could not execute: %v\\n\", err)\n  }\n  fmt.Fprintf(w, \"%s\", text)\n}\n</code></pre>\n\n<p>This setup without the <code>pongo2</code> rendering, only for the simpler example. Parsing the html file from google works and displayed in the app when I open it. But when I try to parse <code>file:///android_asset/views/index.html</code> file, I'm getting the following error:</p>\n\n<p><a href=\"https://i.stack.imgur.com/uADkz.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uADkz.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I discovered <a href=\"https://godoc.org/golang.org/x/mobile/asset\" rel=\"nofollow noreferrer\">asset.Open</a> in godoc, so I modified my code:</p>\n\n<pre><code>func index(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n\n    a, err := asset.Open(\"views/index.html\")\n    if err != nil {\n        fmt.Fprintf(w, \"could not execute: %v\\n\", err)\n    }\n    defer a.Close()\n    fmt.Fprintf(w, \"File contents: %s\\n\", a)\n}\n</code></pre>\n\n<p>I still manually copy my template files to <code>./app/src/main/assets/views/index.html</code> folder, but the end result is the same.</p>\n\n<p><strong>EDIT2:</strong></p>\n\n<p>I realised the problem was when I copied my template files into <code>./app/src/main/assets/views</code> folder, there wasn't any file in the <code>./app/src/main/assets</code> folder (just only the <code>views</code> subfolder), hence these assets didn't copied into the apk beause of that. So now I copy my files directly in the assets folder and my index.html location is <code>./app/src/main/assets/index.html</code>. This way my templates do gets copied into the apk... Now I'm getting the following screen. I think I should decode somehow the text:</p>\n\n<p><a href=\"https://i.stack.imgur.com/CDyUb.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CDyUb.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>Solution for embedding a single html file:</strong></p>\n\n<p>I had to use <code>ioutil.ReadAll</code>, because <code>asset.File</code> is implemented as the following interface:</p>\n\n<pre><code>type File interface {\n    io.ReadSeeker\n    io.Closer\n}\n</code></pre>\n\n<p>So my final code to parsing html files:</p>\n\n<pre><code>func index(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n\n    a, err := asset.Open(\"index.html\")\n    if err != nil {\n        fmt.Fprintf(w, \"could not execute: %v\\n\", err)\n    }\n    defer a.Close()\n\n    b, err := ioutil.ReadAll(a)\n    if err != nil {\n        fmt.Fprintf(w, \"could not execute: %v\\n\", err)\n    }\n    fmt.Fprintf(w, \"File contents: %s\\n\", b)\n}\n</code></pre>\n\n<p>Which resulting:</p>\n\n<p><a href=\"https://i.stack.imgur.com/K2LCR.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/K2LCR.png\" alt=\"enter image description here\"></a></p>\n\n<p>However, this still not solving why referencing files with <code>file:///android_asset/views/index.html</code> not working, which is needed for static files like css/js, so the question remains open. Maybe serving the assets from the java code?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 13866, "user_id": 54200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6261c8ab215b8069e8290516c80445d8?s=128&d=identicon&r=PG", "display_name": "KevinDTimm", "link": "https://stackoverflow.com/users/54200/kevindtimm"}, "edited": false, "score": 2, "creation_date": 1503953402, "post_id": 45925388, "comment_id": 78812969, "body": "You need a better book / tutorial."}, {"owner": {"reputation": 2130, "user_id": 7386637, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b132e53835fe3b80fef2879b3bb142ad?s=128&d=identicon&r=PG&f=1", "display_name": "rpivovar", "link": "https://stackoverflow.com/users/7386637/rpivovar"}, "reply_to_user": {"reputation": 13866, "user_id": 54200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6261c8ab215b8069e8290516c80445d8?s=128&d=identicon&r=PG", "display_name": "KevinDTimm", "link": "https://stackoverflow.com/users/54200/kevindtimm"}, "edited": false, "score": 1, "creation_date": 1503979877, "post_id": 45925388, "comment_id": 78819504, "body": "I think the tutorial is operating under the assumption that the student has some knowledge of all operators - no fault to the tutorial itself. I just don&#39;t know what I&#39;m doing, and a Google search with whatever arrangement of keywords I was trying wasn&#39;t turning up anything. Stack Overflow has no truck for basic questions - I&#39;ve posted dozens of questions, and I know this, but it&#39;s an invaluable resource for newbies. I learned something and lost some internet points in the process."}, {"owner": {"reputation": 13866, "user_id": 54200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6261c8ab215b8069e8290516c80445d8?s=128&d=identicon&r=PG", "display_name": "KevinDTimm", "link": "https://stackoverflow.com/users/54200/kevindtimm"}, "edited": false, "score": 1, "creation_date": 1504014006, "post_id": 45925388, "comment_id": 78839451, "body": "Just an FYI, typing your subject line into google the first response that wasn&#39;t your question was <code>https:&#47;&#47;golang.org&#47;ref&#47;spec</code> which describes all of the operators of the language. Granted, it was the 6th occurrence of the character <code>%</code> that defined it as <code>remainder</code>, a euphemism for <code>modulo division</code>.  So, a little more diligence saves you -10 in reputation :)"}, {"owner": {"reputation": 2130, "user_id": 7386637, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b132e53835fe3b80fef2879b3bb142ad?s=128&d=identicon&r=PG&f=1", "display_name": "rpivovar", "link": "https://stackoverflow.com/users/7386637/rpivovar"}, "reply_to_user": {"reputation": 13866, "user_id": 54200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6261c8ab215b8069e8290516c80445d8?s=128&d=identicon&r=PG", "display_name": "KevinDTimm", "link": "https://stackoverflow.com/users/54200/kevindtimm"}, "edited": false, "score": 0, "creation_date": 1504035214, "post_id": 45925388, "comment_id": 78852462, "body": "I didn&#39;t know I was even looking at an operator, so even though that information was valuable to me, I wasn&#39;t aware it was valuable information. The only reason I said &quot;operator&quot; in my previous reply was because of the good answers I got on this post. It was -20 reputation, but I learned more making the post than doing the search."}, {"owner": {"reputation": 2130, "user_id": 7386637, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b132e53835fe3b80fef2879b3bb142ad?s=128&d=identicon&r=PG&f=1", "display_name": "rpivovar", "link": "https://stackoverflow.com/users/7386637/rpivovar"}, "reply_to_user": {"reputation": 13866, "user_id": 54200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6261c8ab215b8069e8290516c80445d8?s=128&d=identicon&r=PG", "display_name": "KevinDTimm", "link": "https://stackoverflow.com/users/54200/kevindtimm"}, "edited": false, "score": 0, "creation_date": 1504036203, "post_id": 45925388, "comment_id": 78852922, "body": "Google searching before making a post here is common courtesy, or it should be, anyway. I didn&#39;t find the answer that way, or if I found it, I did not know I was looking at it. It&#39;s an internet catch-22, where you post in an educational forum (where questions are meant to be asked and answered), and someone says &quot;are you really that stupid?&quot;, and you have to admit, &quot;Yes, I&#39;m that stupid. Please help me.&quot; Lo and behold, the site works, a question was asked, and answers were provided. 20 points, vapor reputation, were lost."}], "answers": [{"tags": [], "owner": {"reputation": 6363, "user_id": 1666569, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lJxtP.jpg?s=128&g=1", "display_name": "Cameron Roberts", "link": "https://stackoverflow.com/users/1666569/cameron-roberts"}, "is_accepted": true, "score": 9, "last_activity_date": 1503945592, "creation_date": 1503945592, "answer_id": 45925418, "question_id": 45925388, "link": "https://stackoverflow.com/questions/45925388/what-kind-of-operation-is-xy-in-golang/45925418#45925418", "title": "What kind of operation is x%y in golang?", "body": "<p>This is called a modulus operator, it returns the remainder of a division operation.  Hence == 0 will be true when X can be evenly divided by Y.</p>\n\n<p>This operator and % to represent it is common in many languages.</p>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/17524673/understanding-the-modulus-operator\">Understanding The Modulus Operator %</a></p>\n"}, {"tags": [], "owner": {"reputation": 929, "user_id": 7855177, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh6.googleusercontent.com/-avNsBxd4mKE/AAAAAAAAAAI/AAAAAAAAABQ/dSTXwqwzagQ/photo.jpg?sz=128", "display_name": "Piwo", "link": "https://stackoverflow.com/users/7855177/piwo"}, "is_accepted": false, "score": 2, "last_activity_date": 1503945671, "creation_date": 1503945671, "answer_id": 45925434, "question_id": 45925388, "link": "https://stackoverflow.com/questions/45925388/what-kind-of-operation-is-xy-in-golang/45925434#45925434", "title": "What kind of operation is x%y in golang?", "body": "<p>It's the remainder/modulo-operator. This returns the rest of the division with the given number:\n<a href=\"https://en.wikipedia.org/wiki/Modulo_operation\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Modulo_operation</a></p>\n\n<p>This code fragment calculates all uneven numbers.</p>\n"}], "owner": {"reputation": 2130, "user_id": 7386637, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b132e53835fe3b80fef2879b3bb142ad?s=128&d=identicon&r=PG&f=1", "display_name": "rpivovar", "link": "https://stackoverflow.com/users/7386637/rpivovar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6290, "favorite_count": 0, "accepted_answer_id": 45925418, "answer_count": 2, "score": -4, "last_activity_date": 1503945671, "creation_date": 1503945469, "question_id": 45925388, "link": "https://stackoverflow.com/questions/45925388/what-kind-of-operation-is-xy-in-golang", "title": "What kind of operation is x%y in golang?", "body": "<p>I'm going through some golang tutorials, and I came across this <code>for</code> loop:</p>\n\n<pre><code>for n := 0; n &lt;= 5; n++ {\n    if n%2 == 0 {\n        continue\n    }\n    fmt.Println(n)\n}\n</code></pre>\n\n<p>I'm confused by the <code>n%2</code> statement.</p>\n\n<p>The output of this is:</p>\n\n<pre><code>1\n3\n5\n</code></pre>\n\n<p>It looks like these are not multiples of 2, but I'm not understanding the <code>== 0</code> part of the statement if that's the case? Is there a resource that talks about this operation, or something I should look up?</p>\n"}, {"tags": ["go", "pipe"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1503934428, "post_id": 45922528, "comment_id": 78803891, "body": "What do you mean that there is no way to &quot;close opened command&quot;? You terminate a process by sending it a signal to exit, which you can do with the <code>Kill</code> or <code>Signal</code> methods."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1503940512, "post_id": 45922528, "comment_id": 78806927, "body": "If the command reads stdin and exits on EOF, then close stdin to the command. Otherwise, send a signal as mentioned in other comments."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1503946023, "post_id": 45922528, "comment_id": 78809636, "body": "Just to add a bit more detail, if you close stdin then the sub-process&#39;s stdout writes will cause it to receive a SIGPIPE signal (by default, unless this behavior is overridden). So you are sending a signal one way or another."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1503934516, "creation_date": 1503934516, "answer_id": 45922614, "question_id": 45922528, "link": "https://stackoverflow.com/questions/45922528/how-to-force-golang-to-close-opened-pipe/45922614#45922614", "title": "How to force golang to close opened pipe", "body": "<p>As it stands, you can't do this from <code>processOutput</code> because all it receives is a <code>bufio.Reader</code>. You would need to pass the <code>exec.Cmd</code> to it for it to do anything with the forked process.</p>\n\n<p>To kill the forked process, you can send it a signal, e.g.: <code>cmd.Process.Kill()</code> or <code>cmd.Process.Signal(os.SIGINT)</code>. See documentation on <a href=\"https://golang.org/pkg/os/exec/#Cmd\" rel=\"nofollow noreferrer\"><code>exec.Cmd</code></a> and <a href=\"https://golang.org/pkg/os/#Process\" rel=\"nofollow noreferrer\"><code>os.Process</code></a>.</p>\n"}, {"comments": [{"owner": {"reputation": 131, "user_id": 2770473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1a379598144290bd653c932acaa81f3?s=128&d=identicon&r=PG&f=1", "display_name": "tahoe", "link": "https://stackoverflow.com/users/2770473/tahoe"}, "edited": false, "score": 1, "creation_date": 1519954294, "post_id": 45927090, "comment_id": 85127938, "body": "This answer is gold, it should be the top answer."}], "tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": 2, "last_activity_date": 1503953117, "creation_date": 1503953117, "answer_id": 45927090, "question_id": 45922528, "link": "https://stackoverflow.com/questions/45922528/how-to-force-golang-to-close-opened-pipe/45927090#45927090", "title": "How to force golang to close opened pipe", "body": "<p>You could probably use \"<a href=\"https://golang.org/pkg/os/exec/#CommandContext\" rel=\"nofollow noreferrer\">context</a>\" for example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bufio\"\n    \"context\"\n    \"os/exec\"\n)\n\nfunc processOutput(r *bufio.Reader, cancel context.WithCancel) {\n    for {\n        line, _, err := r.ReadLine()\n        if some_condition_meet {\n            break\n        }\n    }\n    cancel()\n    return\n}\n\nfunc main() {\n    ctx, cancel := context.WithCancel(context.Background())\n    defer cancel()\n    cmdToExecute := \"......\"\n    cmd := exec.CommandContext(ctx, \"bash\", \"-c\", cmdToExecute)\n    output, _ := cmd.StdoutPipe()\n\n    cmd.Start()\n    r := bufio.NewReader(output)\n    go processOutput(r, cancel)\n    cmd.Wait()\n    return\n}\n</code></pre>\n\n<p>In case need to end with a timeout this could work (example is taken from here: <a href=\"https://golang.org/src/os/exec/example_test.go\" rel=\"nofollow noreferrer\">https://golang.org/src/os/exec/example_test.go</a>) </p>\n\n<pre><code>func ExampleCommandContext() {\n    ctx, cancel := context.WithTimeout(context.Background(), 100*time.Millisecond)\n    defer cancel()\n\n    if err := exec.CommandContext(ctx, \"sleep\", \"5\").Run(); err != nil {\n    // This will fail after 100 milliseconds. The 5 second sleep\n    // will be interrupted.\n    }\n  }\n</code></pre>\n\n<p>A basic example just using sleep but closing it after 1 second: <a href=\"https://play.golang.org/p/gIXKuf5Oga\" rel=\"nofollow noreferrer\">https://play.golang.org/p/gIXKuf5Oga</a></p>\n"}], "owner": {"reputation": 2644, "user_id": 956548, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1aae6638a9e6c445a90467bc045071ab?s=128&d=identicon&r=PG", "display_name": "ravnur", "link": "https://stackoverflow.com/users/956548/ravnur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1500, "favorite_count": 0, "accepted_answer_id": 45922614, "answer_count": 2, "score": 2, "last_activity_date": 1503953117, "creation_date": 1503934184, "question_id": 45922528, "link": "https://stackoverflow.com/questions/45922528/how-to-force-golang-to-close-opened-pipe", "title": "How to force golang to close opened pipe", "body": "<p>I have to process a long output of a script and find some data. This data most likely will be located at the almost very beginning of the output. After data found I do not need to process output anymore and can quit.</p>\n\n<p>The issue that I cannot stop processing output because <code>exec.Cmd</code> does not have any function to close opened command.</p>\n\n<p>Here are some simplified code (error handling was ommited):</p>\n\n<pre><code>func processOutput(r *bufio.Reader)(){\n   for {\n      line, _, err := r.ReadLine()\n      if some_condition_meet {\n         break\n      }\n      ......\n   }\n   return\n}\n\nfunc execExternalCommand(){\n   cmdToExecute := \"......\"\n   cmd := exec.Command(\"bash\", \"-c\", cmdToExecute)\n   output, _ := cmd.StdoutPipe()\n\n   cmd.Start()\n   r := bufio.NewReader(output)\n   go processOutput(r)\n   cmd.Wait()\n   return\n}  \n</code></pre>\n\n<p>What should I do at the end at <code>processOutput</code> function to stop cmd? Maybe there is another way how to solve it.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "postfix-operator"], "answers": [{"comments": [{"owner": {"reputation": 2623, "user_id": 5241780, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/8542490e5ecda0cf556cb0e7403f0812?s=128&d=identicon&r=PG&f=1", "display_name": "chefcurry7", "link": "https://stackoverflow.com/users/5241780/chefcurry7"}, "edited": false, "score": 0, "creation_date": 1503932091, "post_id": 45921859, "comment_id": 78802444, "body": "ok, I wasn&#39;t getting the result I was looking for so thought it may have had something to do with that. but good to know, thanks."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1503933313, "last_edit_date": 1503933313, "creation_date": 1503932036, "answer_id": 45921859, "question_id": 45921822, "link": "https://stackoverflow.com/questions/45921822/convert-prefix-to-post/45921859#45921859", "title": "Convert prefix to post", "body": "<p>Use a postfix <a href=\"https://golang.org/ref/spec#IncDec_statements\" rel=\"nofollow noreferrer\">increment statement</a>, it doesn't make any difference in this case:</p>\n\n<pre><code>for i := l + 1; i &lt; r; i++ {\n    ans = max(ans, nums[l]*nums[i]*nums[r]+maxCoin(dp, l, i, nums)+maxCoin(dp, i, r, nums))\n}\n</code></pre>\n\n<p>The difference only matters when you're using the result of the expression formed by the increment / decrement operator, but since in Go they're not even operators but statements, it doesn't matter. For reasoning, see <a href=\"https://golang.org/doc/faq#inc_dec\" rel=\"nofollow noreferrer\">FAQ: Why are ++ and -- statements and not expressions? And why postfix, not prefix?</a></p>\n"}], "owner": {"reputation": 2623, "user_id": 5241780, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/8542490e5ecda0cf556cb0e7403f0812?s=128&d=identicon&r=PG&f=1", "display_name": "chefcurry7", "link": "https://stackoverflow.com/users/5241780/chefcurry7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 45921859, "answer_count": 1, "score": 1, "last_activity_date": 1503933313, "creation_date": 1503931919, "question_id": 45921822, "link": "https://stackoverflow.com/questions/45921822/convert-prefix-to-post", "title": "Convert prefix to post", "body": "<p>I am trying to convert some C code into Go. </p>\n\n<pre><code>for i := l + 1; i &lt; r; ++i {\n    ans = max(ans, nums[l]*nums[i]*nums[r]+maxCoin(dp, l, i, nums)+maxCoin(dp, i, r, nums))\n}\n</code></pre>\n\n<p>Go doesn't have prefix operator, how can I convert this loop to use postfix?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 6, "last_activity_date": 1503926197, "last_edit_date": 1592644375, "creation_date": 1503926197, "answer_id": 45920013, "question_id": 45919758, "link": "https://stackoverflow.com/questions/45919758/formatting-the-string-by-substitute-the-same-substring/45920013#45920013", "title": "Formatting the string by substitute the same substring", "body": "<p>Use <code>%[1]s</code>:</p>\n<pre><code>const query = `select * \n           from %[1]s.dbo.table1 \n           join %[1]s.dbo.table2\n             on ....\n           join %[1]s.dbo.table3\n             on ....\n           join %[1]s.dbo.table4\n             on ....`\nq := fmt.Sprintf(query, dbName)\n</code></pre>\n<p>Playground: <a href=\"https://play.golang.org/p/2DDiGfxLPk\" rel=\"noreferrer\">https://play.golang.org/p/2DDiGfxLPk</a>.</p>\n<p>Documentation: <a href=\"https://golang.org/pkg/fmt/\" rel=\"noreferrer\">https://golang.org/pkg/fmt/</a>.</p>\n<blockquote>\n<p>For example,</p>\n<pre><code>fmt.Sprintf(&quot;%[2]d %[1]d\\n&quot;, 11, 22)\n</code></pre>\n<p>will yield &quot;22 11&quot;, while</p>\n<pre><code>fmt.Sprintf(&quot;%[3]*.[2]*[1]f&quot;, 12.0, 2, 6)\n</code></pre>\n<p>equivalent to</p>\n<pre><code>fmt.Sprintf(&quot;%6.2f&quot;, 12.0)\n</code></pre>\n<p>will yield &quot; 12.00&quot;. (\u2026)</p>\n</blockquote>\n"}], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "closed_date": 1503930298, "accepted_answer_id": 45920013, "answer_count": 1, "score": 2, "last_activity_date": 1503926197, "creation_date": 1503925433, "last_edit_date": 1503925904, "question_id": 45919758, "link": "https://stackoverflow.com/questions/45919758/formatting-the-string-by-substitute-the-same-substring", "closed_reason": "Duplicate", "title": "Formatting the string by substitute the same substring", "body": "<p>I have a code which looks like:</p>\n\n<pre><code>const query = `select * \n               from %s.dbo.table1 \n               join %s.dbo.table2\n                 on ....\n               join %s.dbo.table3\n                 on ....\n               join %s.dbo.table4\n                 on ....`\n\n fmt.Sprintf(query, dbName, dbName, dbName, dbName)\n</code></pre>\n\n<p>I just create a SQL query by inserting the database name to all <code>%s</code> occurrences.  Is the a better way to do it without repeating <code>dbName</code> ?</p>\n"}, {"tags": ["go", "webserver", "prometheus"], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 3, "last_activity_date": 1503926883, "creation_date": 1503926883, "answer_id": 45920238, "question_id": 45918567, "link": "https://stackoverflow.com/questions/45918567/how-to-monitor-request-cost-time-with-prometheus-in-golang-webserver/45920238#45920238", "title": "how to monitor request cost-time with prometheus in golang webserver", "body": "<p>Prometheus recommends you use a <a href=\"https://prometheus.io/docs/concepts/metric_types/#histogram\" rel=\"nofollow noreferrer\">histogram</a> to store such things. It essentially counts requests based on which time \"bucket\" it falls into. There is an example of how to use this in the <a href=\"https://godoc.org/github.com/prometheus/client_golang/prometheus#Histogram\" rel=\"nofollow noreferrer\">godoc</a>.</p>\n\n<p>I prefer histograms to the \"summary\" type, because it is easier to aggregate when you have many servers in play. If all you are keeping is the average / 99th percentile time on each server, it is hard to know the global averages from that information alone. </p>\n\n<p>Histograms keep running counts per bucket per server, and so you can aggregate data across servers without significant loss in the future. </p>\n\n<p>A good rundown of those types is available on <a href=\"https://prometheus.io/docs/practices/histograms/\" rel=\"nofollow noreferrer\">this page</a>.</p>\n"}], "owner": {"reputation": 51, "user_id": 7675536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78df3de8e5e23456cc361f0bfa7fa7d8?s=128&d=identicon&r=PG&f=1", "display_name": "Poisoner", "link": "https://stackoverflow.com/users/7675536/poisoner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1192, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1503926883, "creation_date": 1503921844, "question_id": 45918567, "link": "https://stackoverflow.com/questions/45918567/how-to-monitor-request-cost-time-with-prometheus-in-golang-webserver", "title": "how to monitor request cost-time with prometheus in golang webserver", "body": "<p>I have a couple of urls to access,and i want to monitor every request's cost time with prometheus.</p>\n\n<p>but i don't know use what kind of metric to collect data.any help?</p>\n\n<p>this is demo code:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/prometheus/client_golang/prometheus\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"fmt\"\n    \"time\"\n)\nvar (\n    resTime = prometheus.NewSummaryVec(\n        prometheus.SummaryOpts{\n            Name: \"response_time\",\n            Help: \"cost time per request\",\n        },\n        []string{\"costTime\"},\n    )\n)\n\n\nfunc main() {\n    urls := []string{\"http://www.google.com\",\"http://www.google.com\"}\n\n    for _,url := range urls {\n        request(url)\n    }\n}\n\nfunc request(url string){\n    startTime := time.Now()\n    response,_ := http.Get(url)\n    defer response.Body.Close()\n    _,err := ioutil.ReadAll(response.Body)\n    if err != nil {\n        fmt.Println(err)\n    }\n    costTime := time.Since(startTime)\n    resTime.WithLabelValues(fmt.Sprintf(\"%d\", costTime)).Observe(costTime.Seconds())\n}\n</code></pre>\n"}, {"tags": ["go", "http-headers"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1503921127, "post_id": 45918273, "comment_id": 78795037, "body": "What do you mean? What returns two results? None of your functions even return anything. Do you mean the body of the HTTP response is duplicated? How? Show us exactly what you mean."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 3, "creation_date": 1503921224, "post_id": 45918273, "comment_id": 78795080, "body": "Is your browser requesting <code>&#47;favicon.ico</code>?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1503921242, "post_id": 45918273, "comment_id": 78795090, "body": "Sounds like you&#39;re getting two requests. How are you making the requests? Did you try logging the requests?"}, {"owner": {"reputation": 1413, "user_id": 7474529, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10154971830248249/picture?type=large", "display_name": "&#214;zg&#252;r Yal&#231;\u0131n", "link": "https://stackoverflow.com/users/7474529/%c3%96zg%c3%bcr-yal%c3%a7%c4%b1n"}, "edited": false, "score": 0, "creation_date": 1503921284, "post_id": 45918273, "comment_id": 78795120, "body": "I use google chrome for request"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1503921304, "post_id": 45918273, "comment_id": 78795135, "body": "@TimCooper: Fair enough; admittedly I&#39;ve never used the standard router :)"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1503921335, "post_id": 45918273, "comment_id": 78795158, "body": "@&#214;zg&#252;rYal&#231;\u0131n: Have you attempted to print <code>r.URL</code> to see what URLs are being requested?"}, {"owner": {"reputation": 1413, "user_id": 7474529, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10154971830248249/picture?type=large", "display_name": "&#214;zg&#252;r Yal&#231;\u0131n", "link": "https://stackoverflow.com/users/7474529/%c3%96zg%c3%bcr-yal%c3%a7%c4%b1n"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1503921416, "post_id": 45918273, "comment_id": 78795216, "body": "Thanks @TimCooper. It requesting favicon.ico."}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1503923994, "creation_date": 1503923994, "answer_id": 45919288, "question_id": 45918273, "link": "https://stackoverflow.com/questions/45918273/two-results-are-printed-when-headers-are-used-in-golang/45919288#45919288", "title": "Two results are printed when headers are used in golang", "body": "<p>Your browser is likely requesting <code>/favicon.ico</code>. Printing out the value of <code>r.URL</code> in the request handler will confirm this.</p>\n"}], "owner": {"reputation": 1413, "user_id": 7474529, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10154971830248249/picture?type=large", "display_name": "&#214;zg&#252;r Yal&#231;\u0131n", "link": "https://stackoverflow.com/users/7474529/%c3%96zg%c3%bcr-yal%c3%a7%c4%b1n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 45919288, "answer_count": 1, "score": -5, "last_activity_date": 1503923994, "creation_date": 1503920944, "last_edit_date": 1503921246, "question_id": 45918273, "link": "https://stackoverflow.com/questions/45918273/two-results-are-printed-when-headers-are-used-in-golang", "title": "Two results are printed when headers are used in golang", "body": "<p>This is the code I'm working with:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", TestFunc)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc TestFunc(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"test\")\n\n    // --------------------- headers ------------------------\n    w.Header().Set(\"Accept-Charset\", \"utf-8\")\n    w.Header().Set(\"Accept-Encoding\", \"gzip\")\n    w.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n    w.WriteHeader(http.StatusOK)\n}\n</code></pre>\n\n<p>The code above works and prints two result (test test) every time.</p>\n\n<p>When I remove the headers, code works fine and returns only \"test\".</p>\n\n<p>What is the issue in this code?</p>\n"}, {"tags": ["mongodb", "algorithm", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1503920145, "post_id": 45917769, "comment_id": 78794409, "body": "What is it you want to do exactly? Change status to <code>&quot;CLOSED&quot;</code> of all documents where it is not <code>&quot;OPEN&quot;</code> (and not already <code>&quot;CLOSED&quot;</code> of course)?"}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1503920187, "post_id": 45917769, "comment_id": 78794436, "body": "See <a href=\"https://docs.mongodb.com/manual/reference/method/db.collection.update/#multi-parameter\" rel=\"nofollow noreferrer\">&quot;multi&quot;</a> in the options to <code>.update()</code>. Same thing applies to every language implemented driver. Probably a bit better than &quot;strings&quot; is to use <a href=\"https://docs.mongodb.com/manual/reference/operator/update/bit/\" rel=\"nofollow noreferrer\"><code>$bit</code></a> with <code>xor</code> if there is only one item meant to be &quot;turned on&quot;. Using <code>$bit</code> you can do one update statement then rather than two. But the value needs to be &quot;numeric&quot; instead."}, {"owner": {"reputation": 438, "user_id": 1699865, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7dfd127ca79430fed151aa1665ac7c84?s=128&d=identicon&r=PG", "display_name": "Elwyn", "link": "https://stackoverflow.com/users/1699865/elwyn"}, "edited": false, "score": 0, "creation_date": 1503920581, "post_id": 45917769, "comment_id": 78794678, "body": "Thanks for help. From the remote API, I only pull the objects that are OPEN because it is the information I need to have very quickly. That being collected, I know that all the documents in my database that are not in the list of object that I got from the remote API are closed, because they are not in the list of OPEN. So I perform a loop to <code>.update()</code> them as CLOSED. My need is to do not perform the loop and set to CLOSED all the object that are not in the list of OPEN."}], "answers": [{"tags": [], "owner": {"reputation": 438, "user_id": 1699865, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7dfd127ca79430fed151aa1665ac7c84?s=128&d=identicon&r=PG", "display_name": "Elwyn", "link": "https://stackoverflow.com/users/1699865/elwyn"}, "is_accepted": true, "score": 0, "last_activity_date": 1504102840, "creation_date": 1504102840, "answer_id": 45962949, "question_id": 45917769, "link": "https://stackoverflow.com/questions/45917769/update-documents-without-loop-in-mongodb-with-golang/45962949#45962949", "title": "Update documents without loop in MongoDB with Golang", "body": "<p>Solution was to use <code>func (c *Collection) UpdateAll(selector interface{}, update interface{}) (info *ChangeInfo, err error)</code> with the <code>$nin</code> for the selector and <code>$set</code> for the update.</p>\n"}], "owner": {"reputation": 438, "user_id": 1699865, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7dfd127ca79430fed151aa1665ac7c84?s=128&d=identicon&r=PG", "display_name": "Elwyn", "link": "https://stackoverflow.com/users/1699865/elwyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 45962949, "answer_count": 1, "score": 0, "last_activity_date": 1504102840, "creation_date": 1503919187, "last_edit_date": 1504102753, "question_id": 45917769, "link": "https://stackoverflow.com/questions/45917769/update-documents-without-loop-in-mongodb-with-golang", "title": "Update documents without loop in MongoDB with Golang", "body": "<p>I have a collector module that pulls a remote API every 30 seconds.\nThat gives me a list of objects that I insert or update in a MongoDB database.</p>\n\n<pre><code>{\n   \"id\" : \"oulkhhvoiupokb\",\n   \"name\" : \"test1\",\n   \"status\" : \"OPEN\"\n},\n{\n   \"id\" : \"oulkhhvoisksbsjkkb\",\n   \"name\" : \"test2\",\n   \"status\" : \"CLOSED\"\n}\n</code></pre>\n\n<p>In fact, I only collect the objects that have the OPEN status. And with a loop, I set the rest of the object as CLOSED (because they are not OPEN).\nBut in the future, it will take a lot of time because the amont of object will grow.</p>\n\n<p>I work with Golang and MGO package.</p>\n\n<p>Is there a way to do it faster and cleaner please ? Something like setting a basic field value for Mongo documents ?</p>\n\n<p>To explain it differently, when I will insert the OPEN objects in the database, all the other ones that are already in database must be CLOSED. Can Mongo do it ?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 35134, "user_id": 50543, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RCFWL.jpg?s=128&g=1", "display_name": "Julian Reschke", "link": "https://stackoverflow.com/users/50543/julian-reschke"}, "edited": false, "score": 0, "creation_date": 1503921875, "post_id": 45917169, "comment_id": 78795511, "body": "And why is that a problem?"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1503924725, "creation_date": 1503924725, "answer_id": 45919535, "question_id": 45917169, "link": "https://stackoverflow.com/questions/45917169/why-go-http-client-puts-transfer-encoding-chunked-header-while-processing-post/45919535#45919535", "title": "Why go http client puts transfer-encoding=chunked header while processing POST", "body": "<p>You're passing a <code>bufio.Reader</code> to the http request. Since you can't determine the length of a <code>bufio.Reader</code>, the http package overrides the <code>Content-Length</code> to ensure the request is valid. </p>\n\n<p>If you have the content buffered, and you know the length, there's no reason to wrap it in a <code>bufio.Reader</code>, just pass the buffer in directly. If you don't have the content buffered already, allow it to use chunked encoding which shouldn't make any functional difference in the request.</p>\n"}], "owner": {"reputation": 369, "user_id": 2262486, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b4855dab30e8ae49d0e2d2e77050c9a6?s=128&d=identicon&r=PG", "display_name": "AntonK", "link": "https://stackoverflow.com/users/2262486/antonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 327, "favorite_count": 0, "accepted_answer_id": 45919535, "answer_count": 1, "score": 0, "last_activity_date": 1503924725, "creation_date": 1503917072, "question_id": 45917169, "link": "https://stackoverflow.com/questions/45917169/why-go-http-client-puts-transfer-encoding-chunked-header-while-processing-post", "title": "Why go http client puts transfer-encoding=chunked header while processing POST", "body": "<p>I make POST request like so:</p>\n\n<pre><code>// ...pack non-zero buf\nreq, _ := http.NewRequest(\"POST\", url, bufio.NewReader(buf))\nreq.Header.Add(\"X-Uid\", \"12345\")\nreq.Header.Add(\"Content-Length\", strconv.Itoa(buf.Len()))\n\nclient := http.Client{}\nresp, err := client.Do(req)\n</code></pre>\n\n<p>I expect that no \"Transfer-Encoding\" header would be passed, but I see in server logs that \"Transfer-Encoding: chunked\" header is passed.</p>\n"}, {"tags": ["go", "jquery-selectors", "goquery"], "answers": [{"comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1504103909, "post_id": 45921572, "comment_id": 78885274, "body": "@Acidic: Does this help you?"}, {"owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1505112044, "post_id": 45921572, "comment_id": 79260611, "body": "yep, that&#39;s the solution. Thanks!"}, {"owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1515563022, "post_id": 45921572, "comment_id": 83341839, "body": "Actually I&#39;m having trouble with this again, it seems like <code>ChildrenFiltered</code> still captures deep children when I only want to restrict it to direct children."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "reply_to_user": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1515583932, "post_id": 45921572, "comment_id": 83352555, "body": "@Acidic: please post a reproducible example of HTML and Go code of this behaviour."}, {"owner": {"reputation": 1429, "user_id": 384316, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2dff2663778048d49ebb542735b2c22e?s=128&d=identicon&r=PG", "display_name": "Ben Parsons", "link": "https://stackoverflow.com/users/384316/ben-parsons"}, "edited": false, "score": 0, "creation_date": 1548861145, "post_id": 45921572, "comment_id": 95696583, "body": "Great answer, thanks. Comparing <a href=\"https://github.com/andybalholm/cascadia/issues/18\" rel=\"nofollow noreferrer\">github.com/andybalholm/cascadia/issues/18</a> and <a href=\"https://github.com/PuerkitoBio/goquery/issues/117\" rel=\"nofollow noreferrer\">github.com/PuerkitoBio/goquery/issues/117</a> was very frustrating!"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 4, "last_activity_date": 1503931073, "creation_date": 1503931073, "answer_id": 45921572, "question_id": 45915940, "link": "https://stackoverflow.com/questions/45915940/cannot-select-direct-child-from-goquery-selection/45921572#45921572", "title": "Cannot Select Direct Child from *goquery.Selection", "body": "<p>As noted in <a href=\"https://github.com/andybalholm/cascadia/issues/18\" rel=\"nofollow noreferrer\">this cascadia ticket</a> (the selector library that goquery uses), this functionality is not (and will not be) implemented.</p>\n\n<p>The simplest workaround would be to use the <a href=\"https://godoc.org/github.com/PuerkitoBio/goquery#Selection.ChildrenFiltered\" rel=\"nofollow noreferrer\"><code>ChildrenFiltered()</code></a> method on your selection:</p>\n\n<pre><code>doc.Find(\"body &gt; ul &gt; li\").Each(func(i int, s *goquery.Selection) {\n    s.ChildrenFiltered(\"ul\")\n})\n</code></pre>\n"}], "owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1006, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1503931127, "creation_date": 1503912966, "last_edit_date": 1503931127, "question_id": 45915940, "link": "https://stackoverflow.com/questions/45915940/cannot-select-direct-child-from-goquery-selection", "title": "Cannot Select Direct Child from *goquery.Selection", "body": "<p>In jQuery and CSS, you can use the <code>&gt;</code> character which points to only the direct child element.</p>\n\n<p>This works in <a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"nofollow noreferrer\">Goquery</a> with something like <code>doc.Find(\"body &gt; ul\")</code>, but when you already have a <code>*goquery.Selection</code> and you want to select a <strong>direct</strong> child element of the selection, how can this be done?</p>\n\n<p>For example:</p>\n\n<pre><code>doc.Find(\"body &gt; ul &gt; li\") // Works\n\ndoc.Find(\"body &gt; ul &gt; li\").Each(func(i int, s *goquery.Selection) {\n    s.Find(\"&gt; ul\") // Does not work\n})\n</code></pre>\n\n<p>I want to accomplish what you'd expect to be selected from the second block of code but I haven't had any success with this.</p>\n\n<p>How can this be done?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1503910005, "post_id": 45914931, "comment_id": 78788498, "body": "It is not missing, you just did not have time to consume it: the program exited by that moment. Also: <a href=\"https://play.golang.org/p/6fKTsbMncK\" rel=\"nofollow noreferrer\">play.golang.org/p/6fKTsbMncK</a>"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1503915984, "post_id": 45914931, "comment_id": 78791980, "body": "see: <a href=\"https://stackoverflow.com/questions/16228887/why-does-fmt-println-inside-a-goroutine-not-print-a-line\" title=\"why does fmt println inside a goroutine not print a line\">stackoverflow.com/questions/16228887/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 6, "last_activity_date": 1503910280, "creation_date": 1503910280, "answer_id": 45915130, "question_id": 45914931, "link": "https://stackoverflow.com/questions/45914931/multiple-go-routines-consuming-from-a-channel-causing-loss-of-data/45915130#45915130", "title": "Multiple go routines consuming from a channel causing loss of data", "body": "<p>As soon as <code>5</code> is consumed, the program exits. There's no time for it to print the output.  If you run the program enough times, you may find that on some occasions, it does happen to print the output before it closes, but it'll be purely random.</p>\n\n<p>You need to add some mechanism to wait for your channels to finish, before exiting the program.</p>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 2, "last_activity_date": 1503911575, "creation_date": 1503911575, "answer_id": 45915544, "question_id": 45914931, "link": "https://stackoverflow.com/questions/45914931/multiple-go-routines-consuming-from-a-channel-causing-loss-of-data/45915544#45915544", "title": "Multiple go routines consuming from a channel causing loss of data", "body": "<p>What @Flimzy mentions is correct, after the read is over the send unblocks and the main go routine exits after closing the channel even before the print could complete (sometimes it may complete so you may see it once in a while). Once the main go routine exits, so do all other go routines. Here's a solution which uses <code>WaitGroup</code> for synchronization <a href=\"https://play.golang.org/p/i2uHw3X1G3\" rel=\"nofollow noreferrer\">https://play.golang.org/p/i2uHw3X1G3</a> - with this you should not see any missouts. Hope this helps.</p>\n\n<p>For buffered channel, the main go routine doesn't have to wait for the read to complete after writing the values, so it just exits after it sends all the values. So again, you need to use synchronization for this.</p>\n"}, {"comments": [{"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1503912075, "post_id": 45915607, "comment_id": 78789669, "body": "@Mayank: I hope this helps."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 1, "creation_date": 1503912400, "post_id": 45915607, "comment_id": 78789843, "body": "This code seems incorrect, it can still exit without printing since the <code>wg.Wait</code> will be waiting for only atmost two go routine executions (may be more than 2 values, bcos in one of the routines it can read multiple values), to complete (instead of the 5)."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1503914358, "post_id": 45915607, "comment_id": 78791025, "body": "@Ravi using <code>sync.WaitGroup</code> is the idiomatic way. here there are only two extra goroutines to wait not 5!"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1503922483, "post_id": 45915607, "comment_id": 78795932, "body": "Sorry, wrong comment, but your code is incorrect. Let&#39;s understand: suppose the goroutine g gets executed only after goroutine f has consumed all the values sent. Finally the <code>wg.Wait</code> will still be waiting, till <code>wg.Done</code> in g gets executed. Now the channel read in g will receive a 0 value (since channel is closed, but this value was never sent!) &amp; incorrectly print it out. Here&#39;s your code with an added sleep to (g) to simulate: <a href=\"https://play.golang.org/p/L98ZNhV-XA\" rel=\"nofollow noreferrer\">play.golang.org/p/L98ZNhV-XA</a> . To compare added a sleep (to g) in the code I shared earlier - same input as yours : <a href=\"https://play.golang.org/p/MXV7_pDAye\" rel=\"nofollow noreferrer\">play.golang.org/p/MXV7_pDAye</a>"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1503923080, "post_id": 45915607, "comment_id": 78796311, "body": "The guideline is simple - keep N in <code>wg.Add(N)</code> always equal to the number of jobs you are generating and never the number of go routines or threads, you may be creating to handle them! Hope this helps."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1503925411, "post_id": 45915607, "comment_id": 78797832, "body": "Glad you changed your comment and also improved your code to check if the channel is closed in g, now add a small fix to check if ok is true/false &amp; print based on that - it&#39;ll finally be correct. Always better to keep things clean and simple - that is idiomatic Go! And we never know which code gets into production, we mostly have professionals from the real field here, so we must take care on what we post!"}, {"owner": {"reputation": 245, "user_id": 8526089, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/e4614326f7e4c828342bd85fc8a7447c?s=128&d=identicon&r=PG&f=1", "display_name": "zaRRoc", "link": "https://stackoverflow.com/users/8526089/zarroc"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 1, "creation_date": 1503994623, "post_id": 45915607, "comment_id": 78826144, "body": "@Ravi  / @ A.R - Thank you for the detailed explanation and outlining the proper solution. Helped a lot :)"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 1, "last_activity_date": 1503996115, "last_edit_date": 1503996115, "creation_date": 1503911761, "answer_id": 45915607, "question_id": 45914931, "link": "https://stackoverflow.com/questions/45914931/multiple-go-routines-consuming-from-a-channel-causing-loss-of-data/45915607#45915607", "title": "Multiple go routines consuming from a channel causing loss of data", "body": "<p><strong>You need to wait for goroutines to finish</strong>:  </p>\n\n<hr>\n\n<p>method 1: using <code>sync.WaitGroup</code>:    </p>\n\n<blockquote>\n<pre><code>// A WaitGroup waits for a collection of goroutines to finish.\n// The main goroutine calls Add to set the number of\n// goroutines to wait for. Then each of the goroutines\n// runs and calls Done when finished. At the same time,\n// Wait can be used to block until all goroutines have finished.\n</code></pre>\n</blockquote>\n\n<p>try <a href=\"https://play.golang.org/p/0giDGiwGdk\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar c = make(chan int)\nvar wg sync.WaitGroup\n\nfunc f() {\n    defer wg.Done()\n    for val := range c {\n        fmt.Printf(\"routine 1 : %v\\n\", val)\n    }\n}\n\nfunc g() {\n    defer wg.Done()\n    if data, ok := &lt;-c; ok {\n        fmt.Println(\"routine 2 :\", data)\n    }\n}\n\nfunc main() {\n    wg.Add(2)\n    defer wg.Wait()\n    go f()\n    go g()\n    c &lt;- 0\n    c &lt;- 1\n    c &lt;- 2\n    c &lt;- 3\n    c &lt;- 4\n    c &lt;- 5\n    close(c)\n}\n</code></pre>\n\n<p>sample output:</p>\n\n<pre><code>routine 2 : 0\nroutine 1 : 1\nroutine 1 : 2\nroutine 1 : 3\nroutine 1 : 4\nroutine 1 : 5\n</code></pre>\n\n<hr>\n\n<p>method 2: using quit channel, try <a href=\"https://play.golang.org/p/rNhxHx--1h\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    go f()\n    go g()\n    c &lt;- 0\n    c &lt;- 1\n    c &lt;- 2\n    c &lt;- 3\n    c &lt;- 4\n    c &lt;- 5\n    close(c)\n    &lt;-quit\n    &lt;-quit\n}\nfunc f() {\n    defer done()\n    for val := range c {\n        fmt.Printf(\"routine 1 : %v\\n\", val)\n    }\n}\nfunc g() {\n    defer done()\n    if data, ok := &lt;-c; ok {\n        fmt.Println(\"routine 2 :\", data)\n    }\n}\nfunc done() {\n    quit &lt;- struct{}{}\n}\n\nvar c = make(chan int)\nvar quit = make(chan struct{}, 2)\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>routine 2 : 0\nroutine 1 : 1\nroutine 1 : 2\nroutine 1 : 3\nroutine 1 : 4\nroutine 1 : 5\n</code></pre>\n"}], "owner": {"reputation": 245, "user_id": 8526089, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/e4614326f7e4c828342bd85fc8a7447c?s=128&d=identicon&r=PG&f=1", "display_name": "zaRRoc", "link": "https://stackoverflow.com/users/8526089/zarroc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1907, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1503996115, "creation_date": 1503909502, "last_edit_date": 1503917025, "question_id": 45914931, "link": "https://stackoverflow.com/questions/45914931/multiple-go-routines-consuming-from-a-channel-causing-loss-of-data", "title": "Multiple go routines consuming from a channel causing loss of data", "body": "<p>I am a newbie to Go. In my example below, multiple go routines are consuming from an unbuffered channel. </p>\n\n<p>Code : </p>\n\n<pre><code>var c = make(chan int)\n\nfunc f() {\n    for val := range c {    \n        fmt.Printf(\"routine 1 : %v\\n\", val)\n    }\n}   \n\nfunc g() {\n    fmt.Printf(\"routine 2 : %v\\n\", &lt;-c)\n}\n\nfunc main() {\n    go f()\n    go g()\n    c &lt;- 0\n    c &lt;- 1\n    c &lt;- 2\n    c &lt;- 3\n    c &lt;- 4\n    c &lt;- 5\n    close(c) \n}\n</code></pre>\n\n<p>The output was : </p>\n\n<pre><code>routine 1 : 0\nroutine 1 : 2\nroutine 2 : 1\nroutine 1 : 3\nroutine 1 : 4\n</code></pre>\n\n<p>Value 5 is missing from this and never gets printed ! Why is this happening? If I remove the call -  <code>go g()</code>, it works perfectly.</p>\n\n<p>Also, if I make the channel buffered, say :</p>\n\n<pre><code>var c = make(chan int, 10)\n</code></pre>\n\n<p>There is no output at all. I understand that for unbuffered channel, the send completes after receive completes, which is not the case for buffered. Still, for buffered case, if channel has not yet sent any int, wouldn't the for loop be blocked considering it a nil channel?</p>\n\n<p>Please help out with both my queries. Appreciate all the inputs.</p>\n"}, {"tags": ["json", "rest", "go"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 3, "creation_date": 1503911020, "post_id": 45914863, "comment_id": 78789064, "body": "Backslash is a special character, it must be escaped, i.e. converted from \\ to \\\\. So the encoder is correct. Why do you want to disable the conversion?"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1503912119, "post_id": 45914863, "comment_id": 78789693, "body": "If your <code>data</code> is already a <i>valid JSON</i>, then define the <code>Data</code> in <code>message</code> struct as <code>json.RawMessage</code>. Then in the encoder, define the message as <code>message{Data: json.RawMessage(data)}</code>"}, {"owner": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 1, "creation_date": 1503991825, "post_id": 45914863, "comment_id": 78824424, "body": "<code>{&quot;data&quot;: &quot;asdasdasd\\\\asdasdasd&quot;}</code> is the correct JSON representation of the string <code>asdasdasd\\asdasdasd</code>\u2026"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 8526226, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-G2NzE5X8oWg/AAAAAAAAAAI/AAAAAAAAALA/MF83vJ97HyM/photo.jpg?sz=128", "display_name": "tinthid", "link": "https://stackoverflow.com/users/8526226/tinthid"}, "edited": false, "score": 0, "creation_date": 1503913192, "post_id": 45915330, "comment_id": 78790302, "body": "Thank you for your solution. It works!! But there is some issue you need to fix in this code. You have to use backtick <b>(`)</b> instead of  double-qoute <b>(&quot;)</b>"}, {"owner": {"reputation": 33, "user_id": 8526226, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-G2NzE5X8oWg/AAAAAAAAAAI/AAAAAAAAALA/MF83vJ97HyM/photo.jpg?sz=128", "display_name": "tinthid", "link": "https://stackoverflow.com/users/8526226/tinthid"}, "edited": false, "score": 0, "creation_date": 1503913498, "post_id": 45915330, "comment_id": 78790490, "body": "It seem that your fixed version using single-quote, not backtick or grave accent."}, {"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "reply_to_user": {"reputation": 33, "user_id": 8526226, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-G2NzE5X8oWg/AAAAAAAAAAI/AAAAAAAAALA/MF83vJ97HyM/photo.jpg?sz=128", "display_name": "tinthid", "link": "https://stackoverflow.com/users/8526226/tinthid"}, "edited": false, "score": 0, "creation_date": 1503913869, "post_id": 45915330, "comment_id": 78790734, "body": "Edit my answer by clicking edit link. I&#39;m from smartphone and I&#39;ll accept your edit"}], "tags": [], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "is_accepted": true, "score": -1, "last_activity_date": 1503914319, "last_edit_date": 1503914319, "creation_date": 1503910900, "answer_id": 45915330, "question_id": 45914863, "link": "https://stackoverflow.com/questions/45914863/how-to-return-json-data-without-escape-string-in-restful-api-on-golang/45915330#45915330", "title": "How to return Json data without escape string in RESTful api on Golang", "body": "<p>You can create a custom method and replace double backslashes with a single one.<br>\nSomething like that:  </p>\n\n<pre><code>func JSONMarshal(v interface{}, backslashEscape bool) ([]byte, error) {\n    b, err := json.Marshal(v)\n\n    if backslashEscape {\n        b = bytes.Replace(b, []byte(`\\\\`), []byte(`\\`), -1)\n    }\n    return b, err\n}\n</code></pre>\n\n<p>The <code>json/encoder</code> packages has also <code>DisableHTMLEscaping</code>, if set to true, default is false, it allows you to escape HTML chars.</p>\n"}, {"tags": [], "owner": {"reputation": 1963, "user_id": 6020412, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a0c26de71499fc6adfae5cbdccd1ee7a?s=128&d=identicon&r=PG", "display_name": "Antoine Thiry", "link": "https://stackoverflow.com/users/6020412/antoine-thiry"}, "is_accepted": false, "score": 0, "last_activity_date": 1503990795, "last_edit_date": 1503990795, "creation_date": 1503989674, "answer_id": 45932574, "question_id": 45914863, "link": "https://stackoverflow.com/questions/45914863/how-to-return-json-data-without-escape-string-in-restful-api-on-golang/45932574#45932574", "title": "How to return Json data without escape string in RESTful api on Golang", "body": "<p>I asked pretty much the same question a couple days ago, <a href=\"https://stackoverflow.com/questions/45889437/is-there-a-way-to-format-this-json-in-golang\">here</a>'s the post.</p>\n\n<p>Basically you don't want your Data to be a <code>string</code> but an <code>interface{}</code> instead.</p>\n\n<pre><code>type message struct {\n    Data interface{} `json:\"data\"`\n}\n</code></pre>\n\n<p>I think this may apply to you also. And if you want to go RESTFul and return different types of structs, this is definitely the way to go.</p>\n"}], "owner": {"reputation": 33, "user_id": 8526226, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-G2NzE5X8oWg/AAAAAAAAAAI/AAAAAAAAALA/MF83vJ97HyM/photo.jpg?sz=128", "display_name": "tinthid", "link": "https://stackoverflow.com/users/8526226/tinthid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2638, "favorite_count": 0, "accepted_answer_id": 45915330, "answer_count": 2, "score": 2, "last_activity_date": 1503990795, "creation_date": 1503909278, "question_id": 45914863, "link": "https://stackoverflow.com/questions/45914863/how-to-return-json-data-without-escape-string-in-restful-api-on-golang", "title": "How to return Json data without escape string in RESTful api on Golang", "body": "<p>I have written an API with Golang. This API does receive data from other services then it responses to users in type of JSON string. Here is the problems I got.</p>\n\n<pre><code>type message struct {\n    Data string `json:\"data\"`\n}\n\nfunc test(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    data := // Retrieve message that contain backslash\n    json.NewEncoder(w).Encode(message{Data: data})\n}\n</code></pre>\n\n<p>`\nIf there is a backslash in data that receive from other API. This API will send the response with double backslashes.</p>\n\n<p>Example.</p>\n\n<p>Received data:\n<code>\"asdasdasd\\asdasdasd\"</code></p>\n\n<p>Response data:\n<code>{\"data\": \"asdasdasd\\\\asdasdasd\"}</code></p>\n\n<p>I have try to figure this out. Here what I got. All of this will be fine if I try to print out in the screen by using <code>fmt.Println()</code>.</p>\n\n<p>I only get problem when I try to send those out put in JSON string. Therefore, is there any way to send those data without double backslashes?</p>\n"}, {"tags": ["go", "stdin"], "answers": [{"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 10, "last_activity_date": 1567879077, "last_edit_date": 1567879077, "creation_date": 1503907168, "answer_id": 45914294, "question_id": 45914003, "link": "https://stackoverflow.com/questions/45914003/reading-input-from-stdin-in-golang/45914294#45914294", "title": "Reading input from stdin in golang", "body": "<p>For simple uses, a <code>Scanner</code> may be more convenient.<br>\nYou should not use two readers, <strong>first read, buffers 4096 bytes of input</strong>:</p>\n\n<blockquote>\n<pre><code>// NewReader returns a new Reader whose buffer has the default size.\nfunc NewReader(rd io.Reader) *Reader {\n  return NewReaderSize(rd, defaultBufSize)\n}\n</code></pre>\n</blockquote>\n\n<p>and <code>defaultBufSize = 4096</code></p>\n\n<p>and even your input contains 4000 bytes, still second read got nothing to read.\nbut if you enter input more than 4096 bytes it will work.</p>\n\n<hr>\n\n<blockquote>\n  <p>If ReadString encounters an error before finding a delimiter, it\n  returns the data read before the error and the error itself (often\n  io.EOF).</p>\n</blockquote>\n\n<p>it is by design, see doc:</p>\n\n<pre><code>// ReadString reads until the first occurrence of delim in the input,\n// returning a string containing the data up to and including the delimiter.\n// If ReadString encounters an error before finding a delimiter,\n// it returns the data read before the error and the error itself (often io.EOF).\n// ReadString returns err != nil if and only if the returned data does not end in\n// delim.\n// For simple uses, a Scanner may be more convenient.\nfunc (b *Reader) ReadString(delim byte) (string, error) {\n    bytes, err := b.ReadBytes(delim)\n    return string(bytes), err\n}\n</code></pre>\n\n<hr>\n\n<p>try this:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    scanner := bufio.NewScanner(os.Stdin)\n    for scanner.Scan() {\n        fmt.Println(scanner.Text()) // Println will add back the final '\\n'\n    }\n    if err := scanner.Err(); err != nil {\n        fmt.Fprintln(os.Stderr, \"reading standard input:\", err)\n    }\n}\n</code></pre>\n\n<p>run:</p>\n\n<pre><code>go run m.go &lt; in.txt\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>hello\nbye\n</code></pre>\n\n<p><code>in.txt</code> file:</p>\n\n<pre><code>hello\nbye\n</code></pre>\n\n<p>I hope this helps.</p>\n"}], "owner": {"reputation": 19583, "user_id": 3026283, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/SyT5b.png?s=128&g=1", "display_name": "H&#233;ctor", "link": "https://stackoverflow.com/users/3026283/h%c3%a9ctor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17396, "favorite_count": 1, "accepted_answer_id": 45914294, "answer_count": 1, "score": 3, "last_activity_date": 1567879077, "creation_date": 1503905996, "question_id": 45914003, "link": "https://stackoverflow.com/questions/45914003/reading-input-from-stdin-in-golang", "title": "Reading input from stdin in golang", "body": "<p>I have this go code:</p>\n\n<pre><code>func readTwoLines() {\n    reader := bufio.NewReader(os.Stdin)\n    line, _ := reader.ReadString('\\n')\n    fmt.Println(line)\n    line, _ = reader.ReadString('\\n')\n    fmt.Println(line)\n}\n</code></pre>\n\n<p>For the input:</p>\n\n<pre><code>hello\nbye\n</code></pre>\n\n<p>the output is:</p>\n\n<pre><code>hello\nbye\n</code></pre>\n\n<p>Everything ok. But now, if I create one reader per line:</p>\n\n<pre><code>func readTwoLines() {\n  line, _ := bufio.NewReader(os.Stdin).ReadString('\\n')\n  fmt.Println(line)\n  line, err := bufio.NewReader(os.Stdin).ReadString('\\n')\n  if err != nil {\n    fmt.Println(err)\n  }    \n  fmt.Println(line)\n}\n</code></pre>\n\n<p>there is an <code>EOF</code> error, in the second line reading.</p>\n\n<p>Why is it happening?</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1503899909, "post_id": 45912331, "comment_id": 78783619, "body": "Why do you want to construct JSON manually?  Use struct or <code>map[string]interface{}</code>. Take a look at <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">https://blog.golang.org/json-and-go</a>"}, {"owner": {"reputation": 3158, "user_id": 7925197, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M21lU.png?s=128&g=1", "display_name": "papey", "link": "https://stackoverflow.com/users/7925197/papey"}, "edited": false, "score": 2, "creation_date": 1503904605, "post_id": 45912331, "comment_id": 78785735, "body": "This is not the idomatic way of doing json in golang. Here is some examples : <a href=\"https://gobyexample.com/json\" rel=\"nofollow noreferrer\">gobyexample.com/json</a>"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 5378681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b4ce798629b93192bb0632cc8844232?s=128&d=identicon&r=PG&f=1", "display_name": "gamage", "link": "https://stackoverflow.com/users/5378681/gamage"}, "is_accepted": false, "score": -2, "last_activity_date": 1503904652, "creation_date": 1503904652, "answer_id": 45913646, "question_id": 45912331, "link": "https://stackoverflow.com/questions/45912331/how-to-append-slice-to-byte-array-in-golang/45913646#45913646", "title": "How to append slice to byte array in golang", "body": "<pre><code>data := make(map[string]interface{})\n        data[\"categoryList\"] = catlist\n        bytearray, err := json.Marshal(data)\n        req, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(bytearray))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 473, "user_id": 3314232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S3Bym.jpg?s=128&g=1", "display_name": "Saeed Falsafin", "link": "https://stackoverflow.com/users/3314232/saeed-falsafin"}, "is_accepted": false, "score": -1, "last_activity_date": 1503917671, "creation_date": 1503917671, "answer_id": 45917332, "question_id": 45912331, "link": "https://stackoverflow.com/questions/45912331/how-to-append-slice-to-byte-array-in-golang/45917332#45917332", "title": "How to append slice to byte array in golang", "body": "<p>You are concating <code>string</code> and <code>[]string</code>!! this is impossible!\nYou must use <code>json</code> package:\n<a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">Package json</a></p>\n"}], "owner": {"reputation": 11, "user_id": 5378681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b4ce798629b93192bb0632cc8844232?s=128&d=identicon&r=PG&f=1", "display_name": "gamage", "link": "https://stackoverflow.com/users/5378681/gamage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 679, "favorite_count": 0, "answer_count": 2, "score": -5, "last_activity_date": 1503917671, "creation_date": 1503898742, "last_edit_date": 1503906457, "question_id": 45912331, "link": "https://stackoverflow.com/questions/45912331/how-to-append-slice-to-byte-array-in-golang", "title": "How to append slice to byte array in golang", "body": "<p>I try to pass dynamic slic to this jsonstr slice </p>\n\n<pre><code>var catlist []string\nvar jsonStr = []byte(`{\"categoryList\":`+catlist+`}`)\n</code></pre>\n\n<p>But i'm getting this error</p>\n\n<pre><code> invalid operation: \"{\\\"categoryList\\\":\" + catlist (mismatched types string and []string)\n</code></pre>\n\n<p>How can I fix this error </p>\n"}, {"tags": ["go", "terminal", "bash-on-windows"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1503904818, "post_id": 45911874, "comment_id": 78785852, "body": "How did you compile it? As windows application (compiled in command prompt then run it from Bash terminal) or Linux application? Bash on Ubuntu on Windows is in Beta stage, perhaps some part of the linux syscall not yet implemented or having a bug."}, {"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1503906683, "post_id": 45911874, "comment_id": 78786796, "body": "@putu Thank you for your advices. I tried it. But the same error appeared. This may be one of bugs by beta version, as you say. I had thought that this might be able to be used for testing to Linux."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1503974076, "post_id": 45911874, "comment_id": 78818296, "body": "@Elsa: Your program still fails on the latest versions of Windows 10 (Insider Build 16275) and the Ubuntu app from the Windows Store."}, {"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1503975299, "post_id": 45911874, "comment_id": 78818564, "body": "@peterSO Thank you for the information. Although I had thought that it might be able to be used by modifying the library, it was not easy for me yet. I would like to wait for the next update of Ubuntu on Windows."}], "owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 380, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1503902509, "creation_date": 1503895224, "last_edit_date": 1503902509, "question_id": 45911874, "link": "https://stackoverflow.com/questions/45911874/termbox-library-can-not-be-initialized-at-termbox-go", "title": "Termbox library can not be initialized at termbox-go", "body": "<p>I'm creating an application using <a href=\"https://github.com/nsf/termbox-go\" rel=\"nofollow noreferrer\">termbox-go</a>. This library works fine at windows DOS (windows10). But at Bash on Ubuntu on Windows, it was found that when <code>termbox.Init()</code> is run, an error of <code>invalid argument</code> occurs. I thought that as a reason, tty of the terminal may be not raw mode. But I don't know the reason and method to avoid this problem.</p>\n\n<p>My questions are below.</p>\n\n<ul>\n<li>Why does this error occur?</li>\n<li>What is the solution of this problem?</li>\n</ul>\n\n<p>The version of Bash on Ubuntu on Windows is <code>Ubuntu 16.04.3 LTS</code>. The version of Go is 1.8.3. When <code>runtime.GOOS</code> is used, windows DOS and Bash on Ubuntu on Windows show <code>windows</code> and <code>linux</code>, respectively.</p>\n\n<h3>Script</h3>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n\n    \"github.com/nsf/termbox-go\"\n)\n\nfunc main() {\n    err := termbox.Init()\n    if err != nil {\n        log.Println(err.Error())\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<h3>Result</h3>\n\n<pre><code>invalid argument\n</code></pre>\n\n<h3>Error position</h3>\n\n<p>This error position was the below script at <a href=\"https://github.com/nsf/termbox-go/blob/master/api.go\" rel=\"nofollow noreferrer\"><code>api.go</code></a>.</p>\n\n<pre><code>_, err = fcntl(in, syscall.F_SETFL, syscall.O_ASYNC|syscall.O_NONBLOCK)\n</code></pre>\n\n<p><code>fcntl()</code> is in <a href=\"https://github.com/nsf/termbox-go/blob/master/termbox.go\" rel=\"nofollow noreferrer\"><code>termbox.go</code></a>.</p>\n\n<pre><code>func fcntl(fd int, cmd int, arg int) (val int, err error) {\n    r, _, e := syscall.Syscall(syscall.SYS_FCNTL, uintptr(fd), uintptr(cmd),\n        uintptr(arg))\n    val = int(r)\n    if e != 0 {\n        err = e\n    }\n    return\n}\n</code></pre>\n\n<p>I don't know whether this position will be a solution.</p>\n\n<p>Thank you so much for your time and advices. And I'm sorry for my immature question.</p>\n"}, {"tags": ["go", "gnupg", "pgp"], "answers": [{"tags": [], "owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "is_accepted": false, "score": 0, "last_activity_date": 1503942164, "creation_date": 1503942164, "answer_id": 45924629, "question_id": 45911254, "link": "https://stackoverflow.com/questions/45911254/golang-pgp-without-secring/45924629#45924629", "title": "Golang pgp without secring", "body": "<p>I got sick of dealing with this, so I've decided it's easier to just shell out to <code>gpg -dq</code> from the <code>os.Exec</code>. Sample:</p>\n\n<pre><code>package gpg\n\nimport (\n    \"bytes\"\n    \"encoding/base64\"\n    \"os/exec\"\n)\n\nfunc Decrypt(key string) (string, error) {\n\n    var cmd exec.Cmd\n    var output bytes.Buffer\n\n    gpgCmd, err := exec.LookPath(\"gpg\")\n\n    if err != nil {\n        return \"\", err\n    }\n\n    cmd.Path = gpgCmd\n    cmd.Args = []string{\"--decrypt\", \"--quiet\"}\n\n    dec, err := base64.StdEncoding.DecodeString(key)\n    if err != nil {\n        return \"\", err\n    }\n\n    // return the reader interface for dec (byte array)\n    d := bytes.NewReader(dec)\n\n    // pipe d to gpg commands stdin\n    cmd.Stdin = d\n    cmd.Stdout = &amp;output\n\n    if err := cmd.Run(); err != nil {\n        return \"\", err\n    }\n\n    // return the output from the gpg command\n    return output.String(), nil\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 33721, "user_id": 695343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/KX04R.jpg?s=128&g=1", "display_name": "Jens Erat", "link": "https://stackoverflow.com/users/695343/jens-erat"}, "is_accepted": false, "score": 1, "last_activity_date": 1503953692, "creation_date": 1503953692, "answer_id": 45927220, "question_id": 45911254, "link": "https://stackoverflow.com/questions/45911254/golang-pgp-without-secring/45927220#45927220", "title": "Golang pgp without secring", "body": "<p>GnuPG 2.1 introduced two changes:</p>\n\n<ul>\n<li>Merging the <code>secring.gpg</code> into the <code>pubring.gpg</code> file, you should be able to read the secret keys from the <code>pubring.gpg</code> file.</li>\n<li>For new installations, the new keybox format is used, which is not supported by the go library (as of today, at least). Old installations (thus, with keyrings in the old format), are not automatically merged.</li>\n</ul>\n\n<p>If you want to use GnuPG's keyring, directly call GnuPG. If you want to use Go's library, don't mess with GnuPG's keyring files and store your own copy of the keys.</p>\n"}], "owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 779, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1503953692, "creation_date": 1503889194, "question_id": 45911254, "link": "https://stackoverflow.com/questions/45911254/golang-pgp-without-secring", "title": "Golang pgp without secring", "body": "<p>I have an app that uses gpg secret keys and prompts for a password to read it. Here's the way I do that (based on an example I found elsewhere:</p>\n\n<pre><code>func Decrypt(publicKeyring string, secretKeyring string, key string, password string) (string, error) {\n\n    var entity *openpgp.Entity\n    var entityList openpgp.EntityList\n\n    keyringFileBuffer, err := os.Open(secretKeyring)\n    if err != nil {\n        return \"\", err\n    }\n\n    defer keyringFileBuffer.Close()\n    entityList, err = openpgp.ReadKeyRing(keyringFileBuffer)\n    if err != nil {\n        return \"\", err\n    }\n    entity = entityList[0]\n\n    passphraseByte := []byte(password)\n    entity.PrivateKey.Decrypt(passphraseByte)\n    for _, subkey := range entity.Subkeys {\n        subkey.PrivateKey.Decrypt(passphraseByte)\n    }\n\n    dec, err := base64.StdEncoding.DecodeString(key)\n    if err != nil {\n        return \"\", err\n    }\n\n    // Decrypt it with the contents of the private key\n    md, err := openpgp.ReadMessage(bytes.NewBuffer(dec), entityList, nil, nil)\n    if err != nil {\n        return \"\", err\n    }\n    bytes, err := ioutil.ReadAll(md.UnverifiedBody)\n    if err != nil {\n        return \"\", err\n    }\n    decStr := string(bytes)\n\n    return decStr, nil\n\n} \n</code></pre>\n\n<p>The assumption made here is that the user has a KeyRin which is passed, and the default value for this is the secring, like so:</p>\n\n<pre><code>viper.SetDefault(\"gpgsecretkeyring\", home+\"/.gnupg/secring.gpg\")\n</code></pre>\n\n<p>However,</p>\n\n<p>I was getting reports that some users on macs were struggling to get the app working, and the reason was they didn't know how to define the secring.</p>\n\n<p>It seems newer versions of GnuPG have deprecated the secring.</p>\n\n<p><a href=\"https://www.gnupg.org/faq/whats-new-in-2.1.html#nosecring\" rel=\"nofollow noreferrer\">https://www.gnupg.org/faq/whats-new-in-2.1.html#nosecring</a></p>\n\n<p>I have no idea how to read the secret key using <code>golang.org/x/crypto/openpgp</code> at this point. Are there any examples of the best way to do this?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 5, "last_activity_date": 1503887729, "last_edit_date": 1503887729, "creation_date": 1503884810, "answer_id": 45910847, "question_id": 45910807, "link": "https://stackoverflow.com/questions/45910807/how-to-build-differently-for-linux-vs-windows/45910847#45910847", "title": "How to build differently for Linux vs Windows", "body": "<p>Use build constraints and file names. See <a href=\"https://golang.org/pkg/go/build/\" rel=\"nofollow noreferrer\">Package build</a>. The source code for <a href=\"https://golang.org/pkg/os/\" rel=\"nofollow noreferrer\">Package os</a> has many examples: <a href=\"https://golang.org/src/os/\" rel=\"nofollow noreferrer\">https://golang.org/src/os/</a>. Go Source Code: <a href=\"https://go.googlesource.com/go\" rel=\"nofollow noreferrer\">https://go.googlesource.com/go</a> or <a href=\"https://github.com/golang/go\" rel=\"nofollow noreferrer\">https://github.com/golang/go</a>.</p>\n\n<p>A build contraint for Unix:</p>\n\n<pre><code>// +build darwin dragonfly freebsd linux nacl netbsd openbsd solaris\n</code></pre>\n\n<p>Some build file names:</p>\n\n<pre><code>stat_darwin.go     stat_linux.go   stat_openbsd.go  stat_unix.go\nstat_dragonfly.go  stat_nacl.go    stat_plan9.go    stat_windows.go\nstat_freebsd.go    stat_netbsd.go  stat_solaris.go\n</code></pre>\n\n<p>The Go tools and standard library started out using build file names and then, as the requirements became more complex, began using build constraints. </p>\n"}], "owner": {"reputation": 378, "user_id": 3768314, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/0a8a10125b97833c96e90e1b55dd3b06?s=128&d=identicon&r=PG&f=1", "display_name": "user64675", "link": "https://stackoverflow.com/users/3768314/user64675"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 411, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1503914127, "creation_date": 1503884314, "last_edit_date": 1503914127, "question_id": 45910807, "link": "https://stackoverflow.com/questions/45910807/how-to-build-differently-for-linux-vs-windows", "title": "How to build differently for Linux vs Windows", "body": "<p>I'm taking look on Go language.\nAnd I have a question: for example I will create a new library, that should use methods from one Go package for Windows and from other for Linux.</p>\n\n<p>I'm just asking, is there a convenient way of organizing build process?\nOf course, I can just make a project for every OS and change import name for every OS.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1503871682, "post_id": 45909745, "comment_id": 78778201, "body": "<code>fmt.Println</code>?."}, {"owner": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1503871793, "post_id": 45909745, "comment_id": 78778223, "body": "this is my first day developing in golang, i dont know how call ip and request"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1503871935, "post_id": 45909745, "comment_id": 78778258, "body": "<code>r *http.Request</code> &lt;-- you have it already here. Check the type structure."}], "answers": [{"comments": [{"owner": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "edited": false, "score": 1, "creation_date": 1503872674, "post_id": 45909815, "comment_id": 78778418, "body": "what is wrong ? <a href=\"https://gist.github.com/anonymous/65ba98783c4e4d00ac6c1326853220c3\" rel=\"nofollow noreferrer\">gist.github.com/anonymous/65ba98783c4e4d00ac6c1326853220c3</a>"}, {"owner": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "edited": false, "score": 1, "creation_date": 1503872694, "post_id": 45909815, "comment_id": 78778419, "body": "root@kali:~/ss# go run 111.go  # command-line-arguments ./111.go:14: undefined: wrapperHandler in wrapperHandler.ServeHTTP ./111.go:27: cannot use helloHandler (type func(http.ResponseWriter, *http.Request)) as type http.Handler in argument to wrapHandlerWithLogging: \tfunc(http.ResponseWriter, *http.Request) does not implement http.Handler (missing ServeHTTP method) ./111.go:27: cannot use wrapHandlerWithLogging(helloHandler) (type http.Handler) as type func(http.ResponseWriter, *http.Request) in argument to http.HandleFunc"}, {"owner": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "reply_to_user": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "edited": false, "score": 0, "creation_date": 1503873247, "post_id": 45909815, "comment_id": 78778525, "body": "@kingcope I fixed the code. Please feel free to test."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "edited": false, "score": 2, "creation_date": 1503874329, "post_id": 45909815, "comment_id": 78778711, "body": "@kingcope why haven&#39;t you checked the <code>http.Request</code> as I suggested 40 minutes ago? How are you supposed to learn, if you don&#39;t even bother reading the documentation?"}], "tags": [], "owner": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "is_accepted": true, "score": 2, "last_activity_date": 1503874748, "last_edit_date": 1503874748, "creation_date": 1503872198, "answer_id": 45909815, "question_id": 45909745, "link": "https://stackoverflow.com/questions/45909745/golang-simple-static-server-print-on-terminal/45909815#45909815", "title": "golang simple static server print on terminal", "body": "<p>The best thing about Golang is interfaces.\nYour <code>helloHandler</code> actually implements the <a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"nofollow noreferrer\"><code>HandlerFunc</code></a> interface.\nUsing the <a href=\"https://en.wikipedia.org/wiki/Open/closed_principle\" rel=\"nofollow noreferrer\">Open/Close Principle</a> we can take <code>helloHandler</code> and extend it for logging the request in the following way:</p>\n\n<pre><code>func wrapHandlerWithLogging(wrappedHandler http.Handler) http.HandlerFunc {\n    return http.HandlerFunc(func(w http.ResponseWriter, req *http.Request) {\n       log.Printf(\"--&gt; %s %s\", req.Method, req.URL.Path)\n       wrappedHandler.ServeHTTP(w, req)\n    })\n}\n\nfunc main() {\n    ...\n    http.HandleFunc(\"/\", wrapHandlerWithLogging(http.HandlerFunc(helloHandler)))\n    ...\n }\n</code></pre>\n\n<p>So basically, we wrap <code>helloHandler</code> which implements <code>HandlerFunc</code> with another <code>HandlerFunc</code>.</p>\n\n<p>In this example, we only log the request method (GET, POST, PUT and etc) and the request path (e.g. '/'). However, you can log other data:</p>\n\n<ul>\n<li><code>req.RemoteAddr</code> network address that sent the request</li>\n<li><code>req.Proto</code> the protocol version</li>\n<li><code>req.Host</code> specifies the host on which URL is sought</li>\n</ul>\n"}], "owner": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1213, "favorite_count": 0, "accepted_answer_id": 45909815, "answer_count": 1, "score": -3, "last_activity_date": 1503874748, "creation_date": 1503871483, "last_edit_date": 1503871720, "question_id": 45909745, "link": "https://stackoverflow.com/questions/45909745/golang-simple-static-server-print-on-terminal", "title": "golang simple static server print on terminal", "body": "<p>this is my initial golang code : </p>\n\n<pre><code>package main\nimport (\n    \"net/http\"\n    \"io\"\n)\n\nconst hello = `hello world`\n\n\nfunc helloHandler(w http.ResponseWriter, r *http.Request) {\n    io.WriteString(w, hello)\n}\n\n\nfunc main() {\n    http.HandleFunc(\"/\", helloHandler)\n    http.ListenAndServe(\":1088\", nil)\n}\n</code></pre>\n\n<p>it is a simple http server, i need add new function, every get request print in linux terminal ip, METHOD, /request.</p>\n\n<p>example output in terminal need:</p>\n\n<pre><code>95.250.33.36 GET /\n95.250.33.36 GET /favicon.ico\n95.250.33.36 GET /robots.txt\n</code></pre>\n\n<p>how i can do this ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1503870614, "post_id": 45909535, "comment_id": 78777992, "body": "&quot;but we wrote to the client before(?) it was closed.&quot; I bet its the other way around."}, {"owner": {"reputation": 374, "user_id": 2191327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e2d23ec4edc6915a63ad495cc6b2ac?s=128&d=identicon&r=PG", "display_name": "user2191327", "link": "https://stackoverflow.com/users/2191327/user2191327"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1503871266, "post_id": 45909535, "comment_id": 78778122, "body": "I would not bet on any one option) But I&#39;ve added time.Sleep and log after client.Write to be sure. Nothing has changed so I removed it to make it easier to read."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1503871698, "post_id": 45909535, "comment_id": 78778204, "body": "Typical Go approach is to start goroutine to read connection.  With this approach, there&#39;s no need to check status of channel separate from the Read return values."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1503876621, "post_id": 45909535, "comment_id": 78779106, "body": "You cannot check the status of a <code>net.Conn</code>, you simply read from it."}, {"owner": {"reputation": 374, "user_id": 2191327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e2d23ec4edc6915a63ad495cc6b2ac?s=128&d=identicon&r=PG", "display_name": "user2191327", "link": "https://stackoverflow.com/users/2191327/user2191327"}, "edited": false, "score": 0, "creation_date": 1503916271, "post_id": 45909535, "comment_id": 78792161, "body": "yeah, and this is exactly what I do, I try to simply read from it, so I have to check the errors, all my post just about it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1503917950, "post_id": 45909535, "comment_id": 78793167, "body": "Reading 0 bytes isn&#39;t reading, and isn&#39;t guaranteed to do anything useful. Your second test has no synchronization with its goroutine, which may not run until after the test, or at all, and any error it encounters is discarded. Don&#39;t try to &quot;check&quot; connections, just use them and handle the errors appropriately."}, {"owner": {"reputation": 374, "user_id": 2191327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e2d23ec4edc6915a63ad495cc6b2ac?s=128&d=identicon&r=PG", "display_name": "user2191327", "link": "https://stackoverflow.com/users/2191327/user2191327"}, "edited": false, "score": 0, "creation_date": 1504273520, "post_id": 45909535, "comment_id": 78963795, "body": "-&gt;  Your second test has no synchronization with its goroutine, which may not run until after the test yes, but please, look at error, it is very unexpected"}], "owner": {"reputation": 374, "user_id": 2191327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e2d23ec4edc6915a63ad495cc6b2ac?s=128&d=identicon&r=PG", "display_name": "user2191327", "link": "https://stackoverflow.com/users/2191327/user2191327"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1788, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1503869385, "creation_date": 1503869385, "question_id": 45909535, "link": "https://stackoverflow.com/questions/45909535/golang-net-conn-check-conn-status", "title": "golang: net.Conn: check conn status", "body": "<p>I encountered a strange behavior of the conn.Read:\nlet's presume that I have a couple of  functions for testing net.Conn:</p>\n\n<pre><code>package example\n\nimport (\n    \"io\"\n    \"log\"\n    \"net\"\n    \"os\"\n    \"time\"\n)\n\nfunc CheckConn(conn net.Conn) (net.Conn, error) {\n    conn.SetReadDeadline(time.Now())\n    var one = []byte{}\n    _, err := conn.Read(one)\n    if err != nil {\n        log.Println(\"Net err: \", err)\n    }\n    if err == io.EOF {\n        return conn, err\n    }\n    var zero time.Time\n    conn.SetReadDeadline(zero)\n    return conn, nil\n}\n\nfunc CheckConnWithTimeout(conn net.Conn) (net.Conn, error) {\n    ch := make(chan bool, 1)\n    defer func() {\n        ch &lt;- true\n    }()\n    go func() {\n        select {\n        case &lt;-ch:\n        case &lt;-time.After(1 * time.Second):\n            log.Println(\"It works too long\")\n            os.Exit(1)\n        }\n    }()\n    return CheckConn(conn)\n}\n</code></pre>\n\n<p>And I want to implement tests for it, lets start with this one:</p>\n\n<pre><code>package example\n\nimport (\n    \"io\"\n    \"net\"\n    \"testing\"\n)\n\n\nfunc TestClosedConn(t *testing.T) {\n    server, client := net.Pipe()\n    client.Close()\n    defer server.Close()\n    _, err := CheckConn(server)\n    if err != io.EOF {\n        t.Errorf(\"Not equal:\\nExpected: %v\\nactual: %v\", io.EOF, err)\n    }\n}\n</code></pre>\n\n<p>this works pretty well, we will receive io.EOF from CheckConn function, lets add one more test:</p>\n\n<pre><code>func TestClosedConnAfterWrite(t *testing.T) {\n    server, client := net.Pipe()\n    go func() {\n        client.Write([]byte{0xb})\n    }()\n    client.Close()\n    defer server.Close()\n    _, err := CheckConn(server)\n    err = nil\n    if err != io.EOF {\n        t.Errorf(\"Not equal:\\nExpected: %v\\nactual: %v\", io.EOF, err)\n    }\n}\n</code></pre>\n\n<p>looks like the first test, but we wrote to the client before(?) it was closed.</p>\n\n<p>And this will not pass!</p>\n\n<p>conn.Read will return &amp;errors.errorString{s:\"EOF\"}, instead of io.EOF, so CheckConn will return error == nil,</p>\n\n<p>It looks so weird!</p>\n\n<p>But let's continue the tests, now I want to check unclosed connections:</p>\n\n<pre><code>func TestActiveConn(t *testing.T) {\n       server, client := net.Pipe()\n       defer client.Close()\n       defer server.Close()\n       _, err := CheckConnWithTimeout(server)\n       if err != nil {\n           t.Errorf(\"Not equal:\\nExpected: %v\\nactual: %v\", nil, err)\n       }\n}\n</code></pre>\n\n<p>I think you noticed that I use the function with a timeout just because SetReadDeadline will not work in this case(I have no idea why!)</p>\n\n<p>So what is going wrong in last two test cases? Is there a normal way to test the connection? Why SetReadDeadline is not working in this case?</p>\n"}, {"tags": ["go", "methods", "types", "overriding", "type-safety"], "answers": [{"comments": [{"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "edited": false, "score": 0, "creation_date": 1503906998, "post_id": 45912574, "comment_id": 78786976, "body": "I don&#39;t understand how it can be written differently (the idiomatic Go way). Could you please provide a counter example that solves the problem mentioned in the first sentence of my question.  I used <code>parent</code> due to the lack of a better word."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "edited": false, "score": 1, "creation_date": 1503911833, "post_id": 45912574, "comment_id": 78789510, "body": "@FanusduToit You wrote &quot;all the embedded structs has to be updated to reflect the new parent struct methods&quot; which is wrong. Struct embedding promotes methods. If an embedded type has a method then the embedding type&#39;s method set is augmented by this method (given some technical details). Just get rid of this nonsensical Setters and read <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Struct_types</a> with focus on the method set."}, {"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "edited": false, "score": 1, "creation_date": 1503916061, "post_id": 45912574, "comment_id": 78792025, "body": "Your last comment is a much better answer than the initial answer. I now understand why my <code>setters</code> are useless because you actually helped me understand why. Thank you!"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 2, "last_activity_date": 1503900154, "creation_date": 1503900154, "answer_id": 45912574, "question_id": 45909197, "link": "https://stackoverflow.com/questions/45909197/changing-a-property-of-a-embedded-struct-using-a-method-from-its-parent/45912574#45912574", "title": "Changing a property of a embedded struct using a method from it&#39;s parent", "body": "<blockquote>\n  <p>Are both these concerns valid and is there a way I can avoid them?</p>\n</blockquote>\n\n<p>No and yes.</p>\n\n<p>Just write idiomatic GO and do <em>not</em> try to write traditional OO in Go. E.g. Setters and Getters are not common in Go. And stop thinking of embedding as a parent/child relation.</p>\n"}], "owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 45912574, "answer_count": 1, "score": -2, "last_activity_date": 1503900154, "creation_date": 1503866779, "question_id": 45909197, "link": "https://stackoverflow.com/questions/45909197/changing-a-property-of-a-embedded-struct-using-a-method-from-its-parent", "title": "Changing a property of a embedded struct using a method from it&#39;s parent", "body": "<p>I have to periodically call a method of a parent struct but when called, it must update extended properties unique to the embedded struct (in my case the structs have different id data types).</p>\n\n<p>The only solution I could think of was to override the a method of the parent struct so that, when the periodic method is called again, it uses the method of the embedded struct instead of the parent's original.</p>\n\n<p>The code looks as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Fruit struct {\n    image *Image\n    tree  *Tree\n\n    SetImage func(*Image)\n    SetTree  func(*Tree) // #2 (always nil for Strawberry)\n}\n\nfunc NewFruit() *Fruit {\n    f := &amp;Fruit{}\n    f.SetImage = f.setImage\n    f.SetTree = f.setTree\n    return f\n}\n\nfunc (f *Fruit) Image() *Image {\n    return f.image\n}\nfunc (f *Fruit) Tree() *Tree {\n    return f.tree\n}\n\nfunc (f *Fruit) setImage(i *Image) {\n    f.image = i\n}\nfunc (f *Fruit) setTree(t *Tree) {\n    f.tree = t\n}\n\ntype Strawberry struct {\n    *Fruit\n    id int\n}\n\nfunc NewStrawberry(f *Fruit) *Strawberry {\n    strawberry := &amp;Strawberry{Fruit: f}\n    return strawberry\n}\nfunc (s *Strawberry) SetID(i int) {\n    s.id = i\n}\nfunc (s *Strawberry) ID() int {\n    return s.id\n}\nfunc (s *Strawberry) setImage(i *Image) {\n    s.id = 6\n    s.image = i\n}\n\ntype Kiwi struct {\n    *Fruit\n    id string\n}\n\nfunc NewKiwi(f *Fruit) *Kiwi {\n    kiwi := &amp;Kiwi{Fruit: f}\n    return kiwi\n}\nfunc (k *Kiwi) SetID(i string) {\n    k.id = i\n}\n\nfunc (k *Kiwi) ID() string {\n    return k.id\n}\nfunc (k *Kiwi) setImage(i *Image) {\n    k.id = \"abc\"\n    k.image = i\n}\nfunc (k *Kiwi) setTree(t *Tree) {\n    k.tree = t\n}\n\ntype Image struct {\n    path string\n}\n\ntype Tree struct {\n    height int\n}\n\nfunc main() {\n    f := NewFruit()\n    f.SetImage(&amp;Image{\"kiwi1.jpg\"})\n\n    /*s := NewStrawberry(f)\n    s.SetImage = s.setImage\n    fmt.Println(s, s.ID(), s.Image())\n    f.SetImage(&amp;Image{\"strawberry.jpg\"})\n    fmt.Println(s, s.ID(), s.Image())*/\n\n    k := NewKiwi(f)\n    k.SetImage = k.setImage\n    k.SetTree = k.setTree\n    fmt.Println(k, k.ID(), k.Image())\n    f.SetImage(&amp;Image{\"kiwi2.jpg\"})\n    f.SetTree(&amp;Tree{2})\n    fmt.Println(k, k.ID(), k.Image(), k.Tree())\n}\n</code></pre>\n\n<p>While the above code does work, I have two concerns when the parent struct <code>Fruit</code> needs eg. 10 additional properties with their required <code>SetXXX(*XXX)</code> methods:</p>\n\n<ol>\n<li><p>Then all the embedded structs has to be updated to reflect the new parent struct methods. Which seems like a lot of necessary coding per property.</p></li>\n<li><p>Some of these embedded structs will not need all of the property methods, leaving a few <code>nil</code>. A good example being not all fruit grow on trees. Leaving property at comment <code>#2</code> useless for <code>Strawberry</code>.</p></li>\n</ol>\n\n<p>Are both these concerns valid and is there a way I can avoid them?</p>\n\n<p>P.S.\nThe application requires a lot of operational throughput so ideally the code should be type safe and optimal without the use of reflection and the overuse of type assertion (can't make every property <code>interface{}</code>).</p>\n"}, {"tags": ["go", "ssh"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1504629119, "post_id": 45908955, "comment_id": 79079522, "body": "Have you tried executing a simple command like <code>ls</code> to see if you get anything back? You can also try something like this <a href=\"https://github.com/marcsantiago/ringzer0team/blob/7acca0ad566f76ecf26053fa3269b27d241b253c/challege130/challege_130.go#L143\" rel=\"nofollow noreferrer\">github.com/marcsantiago/ringzer0team/blob/&hellip;</a>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1504629686, "post_id": 45908955, "comment_id": 79079807, "body": "Also Session.Run() can fail. You&#39;re not checking for an error <a href=\"https://godoc.org/golang.org/x/crypto/ssh#Session.Run\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/crypto/ssh#Session.Run</a> so <code>session.Run(cmd)</code> should become <code>if err := session.Run(cmd); err != nil{&#47;&#47;DO SOMETHING WITH ERROR}</code>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1504630070, "post_id": 45908955, "comment_id": 79079986, "body": "Also I&#39;m not sure <code>&#47;bin&#47;sh &lt; dummy.sh</code> is correct.. why are you redirecting the executable <code>sh</code> to the shell file??? <a href=\"https://askubuntu.com/questions/420981/how-do-i-save-terminal-output-to-a-file\" title=\"how do i save terminal output to a file\">askubuntu.com/questions/420981/&hellip;</a>"}], "owner": {"reputation": 105, "user_id": 5292517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f7fb395ee7b9bdd6874ae1ad1bf8897?s=128&d=identicon&r=PG", "display_name": "notacyborg", "link": "https://stackoverflow.com/users/5292517/notacyborg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 648, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1503864927, "creation_date": 1503864927, "question_id": 45908955, "link": "https://stackoverflow.com/questions/45908955/run-local-script-in-remote-host-using-crypto-ssh-in-golang", "title": "Run local script in remote host using crypto/ssh in golang", "body": "<p>I am trying to replicate this command </p>\n\n<p><code>ssh user@host /bin/bash &lt; dummy.sh</code></p>\n\n<p>using golang's crypto <a href=\"https://godoc.org/golang.org/x/crypto\" rel=\"nofollow noreferrer\">library</a>. </p>\n\n<p>I am opening a connection the remote host using ssh-agent. Then I am trying to run the command. Below is the snippet.</p>\n\n<pre><code>func executeSSHCmdToBuffer(cmd, hostname string, config *ssh.ClientConfig) (string, error) {\n    conn, err := getSSHConnection(hostname, sshPort, config)\n    if err != nil {\n        return \"\", err\n    }\n    session, err := conn.NewSession()\n    if err != nil {\n        return \"\", err\n    }\n    defer session.Close()\n\n    var stdoutBuf bytes.Buffer\n    session.Stdout = &amp;stdoutBuf\n    session.Run(cmd)\n    output := stdoutBuf.String()\n    log.Printf(\"SSH Output %s\", output)\n    return output, nil\n}\n\nfunc ExecuteSSHCommand(cmd, hostname string) (string, error) {\n    sshAuth, err := sshAgent()\n    log.Printf(\"Executing %s on %s\", cmd, hostname)\n    if err != nil {\n        log.Fatalf(\"SSH Agent Failed to init: %s\", err)\n    }\n\n    sshConfig := &amp;ssh.ClientConfig{\n        User: sshUser,\n        Auth: []ssh.AuthMethod{\n            sshAuth,\n        },\n        Timeout:         time.Duration(1 * time.Minute),\n        HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n    }\n    return executeSSHCmdToBuffer(cmd, hostname, sshConfig)\n}\n\nfunc main() {\n    out, err := ExecuteSSHCommand(\"/bin/sh &lt; dummy.sh\", \"test.example.com\")\n\n    if err != nil {\n        log.Print(\"Cannot execute the command\")\n        log.Print(err)\n    }\n\n    log.Print(out)\n}\n</code></pre>\n\n<p>This seems to give out empty output. Anyone have an idea how this can be achieved? </p>\n"}, {"tags": ["database", "go", "key-value", "in-memory-database", "boltdb"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503928758, "post_id": 45908166, "comment_id": 78800194, "body": "Sure, if you&#39;re OK with the potential data loss. Anything that has not been flushed will be lost if the program exits due to a crash, system failure, etc."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1503941055, "post_id": 45908166, "comment_id": 78807165, "body": "Did you experience actual performance problems? Bolt is quite fast. And in case you have, are you positively sure that they are stemming from Bolt?"}, {"owner": {"reputation": 765, "user_id": 999097, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b7432c73c96ac9ccbc85a770ba158a88?s=128&d=identicon&r=PG&f=1", "display_name": "Roper", "link": "https://stackoverflow.com/users/999097/roper"}, "edited": false, "score": 0, "creation_date": 1504026958, "post_id": 45908166, "comment_id": 78848039, "body": "Thanks for your responses. I was asking out of precaution because I have an insanely work-heavy task at hand that is likely to run for days. Therefore I want to get as much performance as possible and committing each write seemed to be a very bad idea to me. Now I&#39;ve started experimenting with Bolt and it seems to run fine. The only issue I&#39;m facing is that with a growing DB size that now exceeds my memory, the system is constantly swapping. However, this may very well be totally unrelated to Bolt and a memory leak of my application."}, {"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 0, "creation_date": 1573185199, "post_id": 45908166, "comment_id": 103807595, "body": "Bolt uses memory mapped files so that makes sense"}], "owner": {"reputation": 765, "user_id": 999097, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b7432c73c96ac9ccbc85a770ba158a88?s=128&d=identicon&r=PG&f=1", "display_name": "Roper", "link": "https://stackoverflow.com/users/999097/roper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 683, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1503859182, "creation_date": 1503859182, "question_id": 45908166, "link": "https://stackoverflow.com/questions/45908166/boltdb-periodically-flush-to-disk", "title": "BoltDB: periodically flush to disk", "body": "<p>I'm writing an application that requires me to store a very large map with key-value pairs. So relying solely on a Golang map in memory will not cut it. \nBoltDB looks like it might be the right thing for this scenario. </p>\n\n<p>My application will continuously write and delete (+retrieve the deleted value) values on a single key-value store. <strong>For performance reasons I want to avoid a new BoltDB db.Update every time I write a value as this would also write to disk.</strong> However, I want to periodically flush the in-memory state back to the file the BoltDB relies on to avoid running out-of-memory. </p>\n\n<p>How can this be achieved with BoltDB? Is it feasible to create a single BoltDB transaction (db.Update) for my application and call tx.Commit periodically to flush to disk? </p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 3, "creation_date": 1503856240, "post_id": 45907588, "comment_id": 78774088, "body": "it will never enter the condition."}], "answers": [{"comments": [{"owner": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "edited": false, "score": 0, "creation_date": 1503926614, "post_id": 45917001, "comment_id": 78798652, "body": "thanks for the hard work on this in the first place! But you are comparing version with atomic to without. As far as I know, atomic does not  guarantee visibility in the other goroutine. So if you are trying to prove the point that there is no difference between the two therefore it must be safe, that argument is not working. If this test can never fail it&#39;s presumably in the (accidental or undocumented) properties of Wait call."}, {"owner": {"reputation": 2590, "user_id": 1209451, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1700220388/picture?type=large", "display_name": "Oleg", "link": "https://stackoverflow.com/users/1209451/oleg"}, "reply_to_user": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "edited": false, "score": 0, "creation_date": 1503927434, "post_id": 45917001, "comment_id": 78799219, "body": "do You mean that this case  : <a href=\"https://play.golang.org/p/3MCpNJ7YKd\" rel=\"nofollow noreferrer\">play.golang.org/p/3MCpNJ7YKd</a> , can also fail  (if we assume that Your test can fail )?"}, {"owner": {"reputation": 2590, "user_id": 1209451, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1700220388/picture?type=large", "display_name": "Oleg", "link": "https://stackoverflow.com/users/1209451/oleg"}, "reply_to_user": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "edited": false, "score": 0, "creation_date": 1503928763, "post_id": 45917001, "comment_id": 78800198, "body": "Now Actually I have got your question. It would be nice to know that this case can fail. By the way Wait just tests inner state variable and if needed do goyield."}, {"owner": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "edited": false, "score": 0, "creation_date": 1503929633, "post_id": 45917001, "comment_id": 78800813, "body": "Actually, I did some more research on the topic. And it&#39;s complicated: official go spec does not say anything about atomic. But there is something they call &#39;litmus tests&#39; and it tests that atomic operations are actually useful and yes the visibility is there! For sure atomic prevents data race. It&#39;s visibility guarantees are given by those litmus tests. Have to find out more about them (which platforms, etc...) It&#39;s covered here: <a href=\"https://github.com/golang/go/issues/5045\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/5045</a>"}, {"owner": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "edited": false, "score": 0, "creation_date": 1503929804, "post_id": 45917001, "comment_id": 78800964, "body": "and if you add atomic and remove wait group from this example it is still incorrect, that is more then clear..."}, {"owner": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "edited": false, "score": 0, "creation_date": 1503930269, "post_id": 45917001, "comment_id": 78801287, "body": "I remember somebody having issue with atomic and visibility in go, but I can not find the article or which platform it was, but that was some time ago..."}, {"owner": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "edited": false, "score": 0, "creation_date": 1503930805, "post_id": 45917001, "comment_id": 78801672, "body": "but that can be only optimized compilation for this example, possible?"}, {"owner": {"reputation": 2590, "user_id": 1209451, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1700220388/picture?type=large", "display_name": "Oleg", "link": "https://stackoverflow.com/users/1209451/oleg"}, "reply_to_user": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "edited": false, "score": 0, "creation_date": 1503932477, "post_id": 45917001, "comment_id": 78802692, "body": "I dont think so , but what should / could be called to release memory barrier  ?"}, {"owner": {"reputation": 2590, "user_id": 1209451, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1700220388/picture?type=large", "display_name": "Oleg", "link": "https://stackoverflow.com/users/1209451/oleg"}, "reply_to_user": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "edited": false, "score": 0, "creation_date": 1503933360, "post_id": 45917001, "comment_id": 78803258, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/153044/discussion-between-oleg-golovanov-and-honzajde\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 2590, "user_id": 1209451, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1700220388/picture?type=large", "display_name": "Oleg", "link": "https://stackoverflow.com/users/1209451/oleg"}, "is_accepted": false, "score": 0, "last_activity_date": 1503919984, "last_edit_date": 1503919984, "creation_date": 1503916426, "answer_id": 45917001, "question_id": 45907588, "link": "https://stackoverflow.com/questions/45907588/can-you-make-this-incorrectly-synchronized-test-fail/45917001#45917001", "title": "Can you make this &#39;incorrectly synchronized&#39; test fail?", "body": "<p>I have changed abit your test to make comparsion between atomic module:</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    // \"sync/atomic\"\n    \"fmt\"\n)\n\nfunc main() {\n    var condition int32\n    var wg sync.WaitGroup\n    wg.Add(1)\n    go func() {\n        condition = 101\n        //atomic.StoreInt32(&amp;condition,101)\n        wg.Done()\n    }()\n    wg.Wait()\n    if condition != 101 {\n        fmt.Println(\"Condition is false. But expected was true.\")\n    } else {\n        fmt.Println(\"Ok.\")\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/8ewy2uMNNH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/8ewy2uMNNH</a></p>\n\n<p>With go asm we can check what code will be produced </p>\n\n<pre><code>go tool compile -S t.go\n</code></pre>\n\n<p>Here is production of inline code from </p>\n\n<p><em>atomic.StoreInt32(&amp;condition,101)</em></p>\n\n<pre><code>    0x001d 00029 (t.go:15)  MOVL    $101, AX\n    0x0022 00034 (t.go:15)  MOVQ    \"\".&amp;condition+24(FP), CX\n    0x0027 00039 (t.go:15)  XCHGL   AX, (CX)\n    0x0029 00041 (t.go:16)  MOVQ    \"\".&amp;wg+32(FP), AX\n    0x002e 00046 (t.go:16)  MOVQ    AX, (SP)\n    0x0032 00050 (t.go:16)  PCDATA  $0, $1\n\n    0x0032 00050 (t.go:16)  CALL    sync.(*WaitGroup).Done(SB)\n</code></pre>\n\n<p>Here is production of </p>\n\n<p><em>condition = 101</em></p>\n\n<pre><code>0x001d 00029 (t.go:14)  MOVQ    \"\".&amp;condition+24(FP), AX\n0x0022 00034 (t.go:14)  MOVL    $101, (AX)\n0x0028 00040 (t.go:16)  MOVQ    \"\".&amp;wg+32(FP), AX\n0x002d 00045 (t.go:16)  MOVQ    AX, (SP)\n0x0031 00049 (t.go:16)  PCDATA  $0, $1\n\n0x0031 00049 (t.go:16)  CALL    sync.(*WaitGroup).Done(SB)\n</code></pre>\n\n<p>As You see there is not so much difference on the code. I have used int32 just to make the clean the difference for both cases. \nbut go produces , more or less the same code for other atomic types including bool</p>\n\n<p>If You look at the implementation of atomic/store function on i386 platform it acttually do nothing: </p>\n\n<p><em>sync/atomic/asm_amd64.s</em></p>\n\n<pre><code>TEXT \u00b7StoreUint32(SB),NOSPLIT,$0-8\n        MOVL    addr+0(FP), BP\n        MOVL    val+4(FP), AX\n        XCHGL   AX, 0(BP)\n        RET\n</code></pre>\n\n<p>But store 64 bit on 32 platform is already tricky and of course can not be replaced with simple \"=\" operation.</p>\n\n<p>Thats why my answer is: This test will always pass on atleast 386 and amd64 platforms. The other thing that it is a bad practice - but it is actually the story from the other ticket.</p>\n"}, {"tags": [], "owner": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "is_accepted": false, "score": 0, "last_activity_date": 1503992302, "creation_date": 1503992302, "answer_id": 45933332, "question_id": 45907588, "link": "https://stackoverflow.com/questions/45907588/can-you-make-this-incorrectly-synchronized-test-fail/45933332#45933332", "title": "Can you make this &#39;incorrectly synchronized&#39; test fail?", "body": "<p>It can't. See <a href=\"https://stackoverflow.com/questions/45894997/does-waitgroup-wait-imply-memory-barrier-in-this-case\">Does WaitGroup.Wait() imply memory barrier in this case?</a>. Thanks a lot to @OlegGolovanov for looking at go's ASM.</p>\n"}], "owner": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 119, "favorite_count": 2, "answer_count": 2, "score": 1, "last_activity_date": 1503992302, "creation_date": 1503855295, "last_edit_date": 1503856146, "question_id": 45907588, "link": "https://stackoverflow.com/questions/45907588/can-you-make-this-incorrectly-synchronized-test-fail", "title": "Can you make this &#39;incorrectly synchronized&#39; test fail?", "body": "<ol>\n<li>Can this test ever fail on x86, x64, ARM?</li>\n<li><p>If so, is it possible to make it fail (in some sort of setup) and without changing the test code itself?</p>\n\n<pre><code>func Test_WaitGroup_Simple(t *testing.T) {\n    var condition bool\n    var wg sync.WaitGroup\n    wg.Add(1)\n    go func() {\n        condition = true\n        wg.Done()\n    }()\n    wg.Wait()\n    if !condition {\n        t.Error(\"Condition is false. But expected was true.\")\n    }\n}\n</code></pre></li>\n</ol>\n"}, {"tags": ["heroku", "go"], "answers": [{"tags": [], "owner": {"reputation": 7537, "user_id": 4263818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AzSa2.jpg?s=128&g=1", "display_name": "R Menke", "link": "https://stackoverflow.com/users/4263818/r-menke"}, "is_accepted": true, "score": -1, "last_activity_date": 1503852965, "last_edit_date": 1503852965, "creation_date": 1503852465, "answer_id": 45907187, "question_id": 45907131, "link": "https://stackoverflow.com/questions/45907131/how-to-run-go-generate-on-heroku/45907187#45907187", "title": "How to run go generate on Heroku", "body": "<p><code>go generate</code> should be run locally while developing, not on heroku. If you run it on heroku it will lead to very hard to debug issues. If <code>go generate</code> has unexpected results you wont be able to easily inspect this.</p>\n\n<p>You could run <code>go generate</code> with a tool like <a href=\"https://github.com/cortesi/modd\" rel=\"nofollow noreferrer\">modd</a> or with a git hook.\nHaving the results of <code>go generate</code> tracked by git also means that you can track which changes affected generated code.</p>\n\n<p>In a language like ruby it might be customary to run <code>bundle install</code> on the server and omit dependencies from git. For go programs this is not so. Dependencies should be vendored and tracked by git. Same for generated code.</p>\n\n<p>The rest is not at all advised for this case and I would never do something like this.</p>\n\n<ul>\n<li>fork the go heroku buildpack</li>\n<li>add a line to run <code>go generate</code></li>\n<li>use your modified go heroku buildpack</li>\n<li>deploy your app</li>\n</ul>\n\n<p><a href=\"https://github.com/heroku/heroku-buildpack-go/blob/c11f285fa49bf545a63bbd6331192937d89eec2d/bin/compile#L421\" rel=\"nofollow noreferrer\">around this line</a></p>\n\n<p><a href=\"https://devcenter.heroku.com/articles/buildpacks\" rel=\"nofollow noreferrer\">more on buildpacks</a></p>\n"}], "owner": {"reputation": 23, "user_id": 3425127, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FolkD.jpg?s=128&g=1", "display_name": "mgierok", "link": "https://stackoverflow.com/users/3425127/mgierok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 45907187, "answer_count": 1, "score": 1, "last_activity_date": 1503852965, "creation_date": 1503852088, "last_edit_date": 1503852460, "question_id": 45907131, "link": "https://stackoverflow.com/questions/45907131/how-to-run-go-generate-on-heroku", "title": "How to run go generate on Heroku", "body": "<p>I am using <a href=\"http://github.com/tmthrgd/go-bindata\" rel=\"nofollow noreferrer\">http://github.com/tmthrgd/go-bindata</a> to embed static files and templates within Go executable file. It requires to run <code>go generate</code> to run a Go code that read each file and write binary representation as standard go file. <code>go generate</code> have to be fired before build process.\nIs there a chance to configure Heroku to handle this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1503850572, "post_id": 45906808, "comment_id": 78772261, "body": "Of course you can delete the source files and use just the .a files in pkg: All you have to do is invoke the Go compiler and linker by hand, that is not via the <code>go tool</code>. What you encountered is how the <code>go</code> tool works and has nothing to do with Go as a language or &quot;how packages work&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1503850662, "last_edit_date": 1503850662, "creation_date": 1503850018, "answer_id": 45906876, "question_id": 45906808, "link": "https://stackoverflow.com/questions/45906808/go-why-do-i-need-the-pkg-directory-if-i-cannot-delete-the-source-files-in-src/45906876#45906876", "title": "go: Why do I need the pkg directory if I cannot delete the source files in src?", "body": "<p>The pkg dir is just a local cache for compiling, it's not something you can depend upon and it doesn't replace .go files, it's not a static lib dir but a temp build products dir. It speeds up compilation, so you don't need the pkg dir, but compiles might be slower if it is empty, and it is for the compiler's use, not yours.</p>\n\n<p>As you've discovered, you <em>do</em> need the src dir.</p>\n\n<p>To link a static library to your project, you could copy out that .a file and use ldflags to link but then you lose all the nice things like cross-compiling and having the entire source for your app, so unlike c for example people don't typically do that.</p>\n"}, {"comments": [{"owner": {"reputation": 491, "user_id": 4699030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PtpXlAvuawc/AAAAAAAAAAI/AAAAAAAABgA/eeoUql28GSs/photo.jpg?sz=128", "display_name": "Juan Carlos Garcia", "link": "https://stackoverflow.com/users/4699030/juan-carlos-garcia"}, "edited": false, "score": 0, "creation_date": 1503851450, "post_id": 45907028, "comment_id": 78772517, "body": "There&#39;s a mention in the <a href=\"https://golang.org/pkg/go/build/#hdr-Binary_Only_Packages\" rel=\"nofollow noreferrer\">official docs</a> of the feature, but is not as detailed as one might want"}], "tags": [], "owner": {"reputation": 491, "user_id": 4699030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PtpXlAvuawc/AAAAAAAAAAI/AAAAAAAABgA/eeoUql28GSs/photo.jpg?sz=128", "display_name": "Juan Carlos Garcia", "link": "https://stackoverflow.com/users/4699030/juan-carlos-garcia"}, "is_accepted": false, "score": 2, "last_activity_date": 1503851264, "creation_date": 1503851264, "answer_id": 45907028, "question_id": 45906808, "link": "https://stackoverflow.com/questions/45906808/go-why-do-i-need-the-pkg-directory-if-i-cannot-delete-the-source-files-in-src/45907028#45907028", "title": "go: Why do I need the pkg directory if I cannot delete the source files in src?", "body": "<p>It is true that the pkg dir is usually used as a cache directory, but also It is possible to use packages without having the source code available, with a feature named <a href=\"https://github.com/golang/proposal/blob/master/design/2775-binary-only-packages.md\" rel=\"nofollow noreferrer\">binary only packages</a> AFAIK It was implemented since Go 1.7. \nHowever, there's a caveat for this approach: Versions of the compiler used to build the package and the compiler to 'use' the package to generate a new library/executable must match. Also, the files must match the pair of os/architecture to build against. If you want cross-compiling, you'll need to distribute your package to every pair of os/architecture you'll want to build.</p>\n\n<p><a href=\"https://github.com/tcnksm/go-binary-only-package\" rel=\"nofollow noreferrer\">This</a> project has a demo for the aforementioned feature.</p>\n\n<p>I hope my explanation was detailed enough :)</p>\n"}], "owner": {"reputation": 29, "user_id": 8010084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/909a026c016703b6938324234741078b?s=128&d=identicon&r=PG&f=1", "display_name": "Pan Delia", "link": "https://stackoverflow.com/users/8010084/pan-delia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 441, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1503851264, "creation_date": 1503849548, "question_id": 45906808, "link": "https://stackoverflow.com/questions/45906808/go-why-do-i-need-the-pkg-directory-if-i-cannot-delete-the-source-files-in-src", "title": "go: Why do I need the pkg directory if I cannot delete the source files in src?", "body": "<p>I wrote a function (<strong>not</strong>! main) and prompted <code>go install</code>. This command generated a path and a package in my <em>pkg-directory</em>. I tested the function by using it in a <em>main function</em>, generated the .exe and everything worked just fine. \nAfter that, I wanted to see if I understood the concept of packages in <em>go</em> correctly and deleted the source file of the function in the <em>src-directory</em> and deleted the <em>main .exe</em>. I did <strong>not</strong> remove the package file in my <em>pkg-directory</em>. Then I tried to <code>go install</code> the <em>main .exe</em> again, but it didn't work: \"package can not be found\". I obviously missunderstood the whole concept because I thought I could use the packages in <em>pkg</em> without the source files in <em>src</em>. If my conclusion was correct, why do I need the \"pkg\" directory at all? </p>\n\n<hr>\n\n<p><a href=\"https://i.stack.imgur.com/acEWw.jpg\" rel=\"nofollow noreferrer\">For more explanation take a look at this picture please:</a></p>\n\n<p>In /bin is the binary code of the main function \"hello\". This main function also contains the function \"reverse\" of the \"stringutil\" package. </p>\n\n<p>By generating the \"hello.exe\", Go also generates the package \"stringutil\" into pkg. </p>\n\n<p>My question is: Should I not be able to delete \"reverse.go\" in src and still be able to use the same function because it was already put into pkg?</p>\n\n<hr>\n\n<p>Is it just the way the AST works now that they've rewritten the compiler in go? It checks for GOPATH/src/**/.go when it parses the \"imports\", then when the linker goes to build the final binary, it'll go check pkg. So the compiler errors out first when trying to feed the ast to the assembler because of the incomplete source tree.</p>\n\n<p>Thank you very much!!!</p>\n"}, {"tags": ["go", "sublimetext3", "sublimetext"], "answers": [{"comments": [{"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1503945743, "post_id": 45909955, "comment_id": 78809491, "body": "What do you mean by &quot;followed by running the app by name as a second command&quot;? Please show a complete config/command example"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1503973309, "post_id": 45909955, "comment_id": 78818135, "body": "There isn&#39;t anything to show, GoSublime adds a shell proxy that you can run any command in. Pressing ctrl+b (build) just brings this shell up with the last command already entered. Hence you run <code>go build .</code> to build the current package, the run the binary you just built by typing in its name. Frankly you should probably only use this shell for building and do your running elsewhere."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1504075420, "post_id": 45909955, "comment_id": 78865138, "body": "If you mean <b>Ctrl+B</b> and to type there <b>./program</b> - it runs, but still no output for me"}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 1, "last_activity_date": 1503874225, "last_edit_date": 1503874225, "creation_date": 1503873589, "answer_id": 45909955, "question_id": 45906619, "link": "https://stackoverflow.com/questions/45906619/run-golang-project-in-sublime-text-3/45909955#45909955", "title": "Run Golang project in Sublime Text 3", "body": "<p>I personally use GoSublime and <code>go build .</code> followed by running the app by name as a second command. Obviously this sucks in a lot of ways, but it kinda sorta works most of the time. It provides a nice fast way to check for compile errors, which is most of what I need.</p>\n\n<p>Honestly, just running in a dedicated shell is nicer in every way.</p>\n\n<p>AFAIK, there is no better Go build system available for Sublime Text (that isn't an endorsement, it sucks, just less than most).</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 13327772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/992ad150ad2b8db4fde3c0d0e0b4b0f4?s=128&d=identicon&r=PG&f=1", "display_name": "chrisper", "link": "https://stackoverflow.com/users/13327772/chrisper"}, "is_accepted": false, "score": 0, "last_activity_date": 1600621813, "creation_date": 1600621813, "answer_id": 63981612, "question_id": 45906619, "link": "https://stackoverflow.com/questions/45906619/run-golang-project-in-sublime-text-3/63981612#63981612", "title": "Run Golang project in Sublime Text 3", "body": "<p>I found a tutorial where I was able to run Go files on build in Sublime Text 3 here: <a href=\"https://www.alexedwards.net/blog/streamline-your-sublime-text-and-go-workflow\" rel=\"nofollow noreferrer\">https://www.alexedwards.net/blog/streamline-your-sublime-text-and-go-workflow</a></p>\n<p>If you use <code>Build With: Go - Run</code> you get outputs, but if you are running for example a net/http local host in Go you won't be able to run multiple programs and cancel build also does not work.</p>\n<p>Here is an example of simple fmt.Println output in Sublime Text 3:</p>\n<pre><code>&gt; Environment:\n&gt;   GOPATH=C:/Users/Christiaan/go\n&gt; Directory: C:\\Users\\Christiaan\\Documents\\02_Personal\\04_Learning\\09_Go\\01_test\n&gt; Command: C:\\Users\\Christiaan\\go\\go1.15rc1\\bin\\go.exe run -v C:\\Users\\Christiaan\\Documents\\02_Personal\\04_Learning\\09_Go\\01_test\\test2.go\n&gt; Output:\ncommand-line-arguments\ngas_pedal: 22314 brake_pedal: 0 steering_wheel: 12562\n&gt; Elapsed: 3.856s\n&gt; Result: Success\n</code></pre>\n"}], "owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1389, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1600621813, "creation_date": 1503848123, "last_edit_date": 1592644375, "question_id": 45906619, "link": "https://stackoverflow.com/questions/45906619/run-golang-project-in-sublime-text-3", "title": "Run Golang project in Sublime Text 3", "body": "<p>I cannot find a suitable solution for my needs with running a Go project inside a Sublime Text 3 and seeing it's output in real-time.</p>\n<p>If I try a build system from:</p>\n<ol>\n<li><p><strong>GoSublime</strong> - I can use <code>run</code>, it even runs and stops, but there is no output, which I need. It appears only when I <strong>cancel build</strong> - it's too late.</p>\n</li>\n<li><p>Official <strong>Golang Build</strong> from Go developers - I can build the project, and that's it. It allows to <strong>run</strong> 1 file (current) only, but I need the whole project.</p>\n<p>I've tried to use flags for <strong>run</strong> command and to add <code>*.go</code>, but then I get <code>*.go: no such file or directory</code></p>\n</li>\n</ol>\n<p>How do I see the output in real-time in one of these solutions? I've tried to create my own build system with <strong>shell_cmd</strong> = <code>go run *.go</code>, but stopping the process with <strong>Cancel build</strong> is not working then. Maybe you can explain how do I stop a running Go program? My <strong>mybuild.sublime-build</strong> is similar to this:</p>\n<pre><code>{\n    &quot;env&quot;: {\n        &quot;GOROOT&quot;: &quot;/path/gosrc/go&quot;,\n        &quot;GOPATH&quot;: &quot;/path/godev&quot;\n    },\n    &quot;path&quot;: &quot;$PATH:/path/gosrc/go/bin&quot;,\n    &quot;working_dir&quot;: &quot;/path/godev/src/github.com/user/program&quot;,\n    &quot;cmd&quot;: &quot;go run *.go&quot;,\n    &quot;shell&quot;: true\n}\n</code></pre>\n<p>..I can run <strong>Build</strong> and see the needed output, but how do I then stop a running process?</p>\n<p>P.S. Program is not just executing and exiting - it's a service, so I should see the output when the needed actions happens.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 1, "creation_date": 1503854386, "post_id": 45906589, "comment_id": 78773461, "body": "What role is <code>F</code> playing here? If it&#39;s just the length of the slice, why not compute it in a method? It&#39;s also unclear what your desired result represents. Why the <code>if len(sc) == 2</code> special case? What do 6, 2, and 4 represent here (and how are they related to the 1, 2, 3, and 4)? You mention that you want recursion, but there&#39;s no recursion in your type. (See <a href=\"https://stackoverflow.com/questions/37366219/golang-recursive-data-structures#37366490\" title=\"golang recursive data structures%2337366490\">stackoverflow.com/questions/37366219/&hellip;</a> for an example of recursive data structures in Go.)"}], "answers": [{"tags": [], "owner": {"reputation": 266, "user_id": 7796750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01bf1edde54704f5d81583a9ac80ff47?s=128&d=identicon&r=PG", "display_name": "LEI", "link": "https://stackoverflow.com/users/7796750/lei"}, "is_accepted": false, "score": 0, "last_activity_date": 1503851350, "creation_date": 1503851350, "answer_id": 45907040, "question_id": 45906589, "link": "https://stackoverflow.com/questions/45906589/how-to-use-join-multiple-structs-into-the-same-one/45907040#45907040", "title": "How to use join multiple structs into the same one", "body": "<p>I attempted to get close to the desired output without being sure about the exact goal, you will find below a modified version of the snippet you provided.</p>\n\n<p>You can use the <code>String() string</code> method on a collection to customize the format.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype ContainerCollection struct {\n    Count int\n    List  []Container\n}\n\nfunc (cc ContainerCollection) String() string {\n    total := 0\n    for _, c := range cc.List {\n        total += c.F\n    }\n    return fmt.Sprintf(\"{%d %v}\", total, cc.List)\n}\n\ntype Container struct {\n    F          int\n    Collection []SubContainer\n}\n\ntype SubContainer struct {\n    Key   string\n    Value int\n}\n\nfunc main() {\n    commits := map[string]int{\n        \"a\": 1,\n        \"b\": 2,\n        \"c\": 3,\n        \"d\": 4,\n    }\n\n    c := ContainerCollection{Count: 0}\n    sc := []SubContainer{}\n\n    for k, v := range commits {\n        sc = append(sc, SubContainer{Key: k, Value: v})\n        c.Count++\n        if len(sc) == 2 {\n            c.List = append(c.List, Container{Collection: sc, F: c.Count})\n            sc = []SubContainer{}\n        }\n    }\n    // Should also cover odd number of commits\n    if len(sc) != 0 {\n        c.Count++\n        c.List = append(c.List, Container{Collection: sc, F: c.Count})\n    }\n\n    // for _, r := range c.List { fmt.Println(r) }\n\n    fmt.Println(c)\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>{6 [{2 [{a 1} {b 2}]} {4 [{c 3} {d 4}]}]}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/TxwpE08Ay5\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 0, "last_activity_date": 1503896170, "creation_date": 1503896170, "answer_id": 45911975, "question_id": 45906589, "link": "https://stackoverflow.com/questions/45906589/how-to-use-join-multiple-structs-into-the-same-one/45911975#45911975", "title": "How to use join multiple structs into the same one", "body": "<p>Here's something with minimal modification to your code (just added a 'super' container, which is basically a summary struct). One probably need this only if this is being passed to another library/package/over the net etc., otherwise just maintaining the <code>totalCount</code> may be enough. </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype SuperContainer struct {\n    TotalCount int\n    Containers []Container\n}\n\ntype Container struct {\n    F          int\n    Collection []SubContainer\n}\n\ntype SubContainer struct {\n    Key   string\n    Value int\n}\n\nfunc main() {\n    var totalCount int\n    commits := map[string]int{\n        \"a\": 1,\n        \"b\": 2,\n        \"c\": 3,\n        \"d\": 4,\n    }\n\n    sc := []SubContainer{}\n    c := []Container{}\n    count := 0\n\n    for k, v := range commits {\n        sc = append(sc, SubContainer{Key: k, Value: v})\n        count++\n\n        if len(sc) == 2 {\n            totalCount += count\n            c = append(c, Container{Collection: sc, F: count})\n            sc = nil\n        }\n    }\n\n    for _, r := range c {\n        fmt.Println(r)\n    }\n    supC := SuperContainer{TotalCount: totalCount, Containers: c}\n    fmt.Println(supC)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/yN3N3gHaCX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/yN3N3gHaCX</a></p>\n"}], "owner": {"reputation": 11, "user_id": 8516393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3de159540b0690a3f88d070f76a3168c?s=128&d=identicon&r=PG&f=1", "display_name": "tom contrars", "link": "https://stackoverflow.com/users/8516393/tom-contrars"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 367, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1503896170, "creation_date": 1503847895, "question_id": 45906589, "link": "https://stackoverflow.com/questions/45906589/how-to-use-join-multiple-structs-into-the-same-one", "title": "How to use join multiple structs into the same one", "body": "<p>I'm trying to play around with recursive structs, where when I have multiple I can add them together, creating a new struct with those embedded. However, I'm not sure what the proper way to approach this is.</p>\n\n<p>I've included a code snippet below to further illustrate what I mean.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Container struct {\n    F          int\n    Collection []SubContainer\n}\n\ntype SubContainer struct {\n    Key    string\n    Value  int\n}\n\nfunc main() {\n    commits := map[string]int{\n        \"a\": 1,\n        \"b\": 2,\n        \"c\": 3,\n        \"d\": 4,\n    }\n\n    sc := []SubContainer{}\n    c := []Container{}\n    count := 0\n\n    for k, v := range commits {\n        sc = append(sc, SubContainer{Key: k, Value: v})\n        count++\n\n        if len(sc) == 2 {\n            c = append(c, Container{Collection: sc, F: count})\n            sc = nil\n        }\n    }\n\n    for _, r := range c {\n        fmt.Println(r)\n    }\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>{2 [{a 1} {b 2}]}\n{4 [{c 3} {d 4}]}\n</code></pre>\n\n<p>Desired result:</p>\n\n<pre><code>{6 {2 [{a 1} {b 2}]} {4 [{c 3} {d 4}]}}\n</code></pre>\n\n<p>Playground link: <a href=\"https://play.golang.org/p/j6rbhgcOoT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/j6rbhgcOoT</a></p>\n\n<p>One caveat I'm having trouble wrapping my head around is that the <code>commits</code> length may change (I was initially thinking I could just create a different parent struct). Any suggestions would be appreciated... Is doing this somehow with recursive structs the right approach to accomplish this? Thanks!</p>\n"}, {"tags": ["go", "web", "web-scraping", "web-crawler"], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1503847201, "post_id": 45906107, "comment_id": 78771321, "body": "in the nodejs world it worth to note you can also use nitghmarejs <a href=\"https://github.com/segmentio/nightmare\" rel=\"nofollow noreferrer\">github.com/segmentio/nightmare</a>"}, {"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "edited": false, "score": 0, "creation_date": 1503848812, "post_id": 45906107, "comment_id": 78771773, "body": "@schollz Processing webpage with headless WebKit, is it the standard way? Also, will it work on large scale in terms of performance?"}, {"owner": {"reputation": 168, "user_id": 8133281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58e0683d8ff22a5a23bff1a842479b4a?s=128&d=identicon&r=PG&f=1", "display_name": "schollz", "link": "https://stackoverflow.com/users/8133281/schollz"}, "reply_to_user": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "edited": false, "score": 0, "creation_date": 1503851312, "post_id": 45906107, "comment_id": 78772476, "body": "@yogesh_desai As far as I know, it is the standard way. Headless webkits leverage browsers to do the rendering and I don&#39;t know another way to do that. As for performance scaling, you might look into chromeless which might let you scale via AWS Lambda"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1503854164, "post_id": 45906107, "comment_id": 78773390, "body": "performance is a goal, not a metric. Not sure how we can help about that as there is not so many solution available afaik. go is good at concurrency which in such case is proven useful to reach a goal of performance."}], "tags": [], "owner": {"reputation": 168, "user_id": 8133281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58e0683d8ff22a5a23bff1a842479b4a?s=128&d=identicon&r=PG&f=1", "display_name": "schollz", "link": "https://stackoverflow.com/users/8133281/schollz"}, "is_accepted": true, "score": 3, "last_activity_date": 1503844564, "creation_date": 1503844564, "answer_id": 45906107, "question_id": 45905550, "link": "https://stackoverflow.com/questions/45905550/golang-scraper-how-to-scrape-dynamically-generated-links-on-a-website/45906107#45906107", "title": "GoLang Scraper. How to scrape dynamically generated links on a website?", "body": "<p>If the tag is not in the source, then GoQuery will not work. GoQuery is for parsing HTML source using a jQuery-like API.</p>\n\n<p>You need to first process the webpage with a headless WebKit like phantomjs, <a href=\"https://github.com/graphcool/chromeless\" rel=\"nofollow noreferrer\">chromeless</a>, or <a href=\"https://github.com/GoogleChrome/puppeteer\" rel=\"nofollow noreferrer\">puppeteer</a>. Each of these tools will allow you to process all the Javascript on the webpage before processing it. This way, the AJAX for rendering the video you are interest in will be processed and the source will be updated. You can then download the corresponding source which should have the div in it.</p>\n"}, {"comments": [{"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "edited": false, "score": 0, "creation_date": 1503848500, "post_id": 45906455, "comment_id": 78771685, "body": "Will it work for multiple videos? As the link, I have shared has 4 videos. Also, when you say find the next tag what does that mean?"}, {"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "edited": false, "score": 0, "creation_date": 1503849885, "post_id": 45906455, "comment_id": 78772096, "body": "The tag you mentioned &lt;img class is visible when I do &quot;inspect element&quot; but not in &quot;page source&quot;. Please let me know how to find it?"}], "tags": [], "owner": {"reputation": 817, "user_id": 283217, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8a6faf7c379b1fdc940594d7706e48eb?s=128&d=identicon&r=PG", "display_name": "Oleh Herych", "link": "https://stackoverflow.com/users/283217/oleh-herych"}, "is_accepted": false, "score": 1, "last_activity_date": 1503846957, "creation_date": 1503846957, "answer_id": 45906455, "question_id": 45905550, "link": "https://stackoverflow.com/questions/45905550/golang-scraper-how-to-scrape-dynamically-generated-links-on-a-website/45906455#45906455", "title": "GoLang Scraper. How to scrape dynamically generated links on a website?", "body": "<p>Please find the next tag <code>&lt;img class=\"thumbnail-img horizontal\" src=\"//i.ytimg.com/vi/oKR2fh09Nic/mqdefault.jpg\"&gt;</code>. As you see src contain ID \"oKR2fh09Nic\". This is need path <a href=\"https://www.youtube.com/watch?v=oKR2fh09Nic\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=oKR2fh09Nic</a></p>\n\n<p>Also, you can use <code>http://youtube.com/get_video_info?video_id= oKR2fh09Nic</code> for loading video information. </p>\n\n<p>Example here <a href=\"https://github.com/kkdai/youtube/blob/master/youtube.go\" rel=\"nofollow noreferrer\">https://github.com/kkdai/youtube/blob/master/youtube.go</a></p>\n"}, {"comments": [{"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "edited": false, "score": 0, "creation_date": 1503849086, "post_id": 45906504, "comment_id": 78771866, "body": "Thank you, I will definitely check it out and give it a try. Also, please my comment on schollz&#39;s answer and provide more details."}, {"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "edited": false, "score": 0, "creation_date": 1503939962, "post_id": 45906504, "comment_id": 78806663, "body": "To evaluate, means do I need to load the page through chromedp? How will I get updated source of the page? Which functions from chromedp are useful for me? Any idea?"}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 1, "last_activity_date": 1503847330, "creation_date": 1503847330, "answer_id": 45906504, "question_id": 45905550, "link": "https://stackoverflow.com/questions/45905550/golang-scraper-how-to-scrape-dynamically-generated-links-on-a-website/45906504#45906504", "title": "GoLang Scraper. How to scrape dynamically generated links on a website?", "body": "<p>You probably need to evaluate the page like a browser does. As schollz answered it, this is possible via so called headless browser (browsers usable via the cli or an api, which does not show their gui).</p>\n\n<p>In go world there is chromedp</p>\n\n<p><a href=\"https://github.com/knq/chromedp\" rel=\"nofollow noreferrer\">https://github.com/knq/chromedp</a></p>\n\n<p><a href=\"https://www.youtube.com/watch?v=_7pWCg94sKw\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=_7pWCg94sKw</a></p>\n"}], "owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5695, "favorite_count": 0, "accepted_answer_id": 45906107, "answer_count": 3, "score": 1, "last_activity_date": 1503847330, "creation_date": 1503841159, "question_id": 45905550, "link": "https://stackoverflow.com/questions/45905550/golang-scraper-how-to-scrape-dynamically-generated-links-on-a-website", "title": "GoLang Scraper. How to scrape dynamically generated links on a website?", "body": "<p>I am trying to scrape product video links (which are generated dynamically by another web service. The location is under the product images on the left side). You can check following link,\n<a href=\"https://www.tokopedia.com/chocoapple/ready-stock-bnib-iphone-128gb-7-plus-jet-black-garansi-apple-1-tahun-10?src=topads\" rel=\"nofollow noreferrer\">https://www.tokopedia.com/chocoapple/ready-stock-bnib-iphone-128gb-7-plus-jet-black-garansi-apple-1-tahun-10?src=topads</a>\nThe google chrome \"inspect element\" shows the div tag. But The same tag is not present in the page source.\nHow to do it? I am looking into goQuery to implement the task but not sure will it work or not. I am not a web developer so please consider giving suggestions if my question description is not specific.\nThank you.</p>\n"}, {"tags": ["go", "hyperledger-fabric"], "comments": [{"owner": {"reputation": 1339, "user_id": 682485, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ea1e106f2d083f0624c0c4f48ae1c18b?s=128&d=identicon&r=PG", "display_name": "Malice", "link": "https://stackoverflow.com/users/682485/malice"}, "edited": false, "score": 0, "creation_date": 1503836454, "post_id": 45904865, "comment_id": 78768228, "body": "<code>(t* SimpleAsset)</code> says that this is a method for <code>SimpleAsset</code> struct"}, {"owner": {"reputation": 113, "user_id": 5396455, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_vZR9QgkiuI/AAAAAAAAAAI/AAAAAAAADec/BGsSuwlCyik/photo.jpg?sz=128", "display_name": "Paras Jain", "link": "https://stackoverflow.com/users/5396455/paras-jain"}, "reply_to_user": {"reputation": 1339, "user_id": 682485, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ea1e106f2d083f0624c0c4f48ae1c18b?s=128&d=identicon&r=PG", "display_name": "Malice", "link": "https://stackoverflow.com/users/682485/malice"}, "edited": false, "score": 0, "creation_date": 1503836568, "post_id": 45904865, "comment_id": 78768260, "body": "Does that mean in go structs have methods like classes or something else?"}, {"owner": {"reputation": 1339, "user_id": 682485, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ea1e106f2d083f0624c0c4f48ae1c18b?s=128&d=identicon&r=PG", "display_name": "Malice", "link": "https://stackoverflow.com/users/682485/malice"}, "edited": false, "score": 2, "creation_date": 1503836622, "post_id": 45904865, "comment_id": 78768274, "body": "This should clear everything :-). <a href=\"https://gobyexample.com/methods\" rel=\"nofollow noreferrer\">gobyexample.com/methods</a>"}, {"owner": {"reputation": 113, "user_id": 5396455, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_vZR9QgkiuI/AAAAAAAAAAI/AAAAAAAADec/BGsSuwlCyik/photo.jpg?sz=128", "display_name": "Paras Jain", "link": "https://stackoverflow.com/users/5396455/paras-jain"}, "reply_to_user": {"reputation": 1339, "user_id": 682485, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/ea1e106f2d083f0624c0c4f48ae1c18b?s=128&d=identicon&r=PG", "display_name": "Malice", "link": "https://stackoverflow.com/users/682485/malice"}, "edited": false, "score": 0, "creation_date": 1503840971, "post_id": 45904865, "comment_id": 78769402, "body": "@Malice  thank you it was very helpful"}, {"owner": {"reputation": 7694, "user_id": 5529712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7uvxg.png?s=128&g=1", "display_name": "Gari Singh", "link": "https://stackoverflow.com/users/5529712/gari-singh"}, "edited": false, "score": 0, "creation_date": 1503861478, "post_id": 45904865, "comment_id": 78775614, "body": "Sorry for overstepping, but I don&#39;t think this deserves a -1 as it can be confusing to understand that Go chaincode is really just pure Go"}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 3, "last_activity_date": 1503841005, "creation_date": 1503841005, "answer_id": 45905527, "question_id": 45904865, "link": "https://stackoverflow.com/questions/45904865/what-is-t-simpleasset-in-this-function/45905527#45905527", "title": "What is (t *SimpleAsset) in this function", "body": "<p>In the following code:</p>\n\n<pre><code>func (t *SimpleAsset) Init(stub shim.ChaincodeStubInterface) peer.Response\n</code></pre>\n\n<p><code>(t *SimpleAsset)</code> is the <em>receiver</em>. Go, unlike many other languages allows you to add methods to <em>any</em> (user defined) type (including functions!), and the type you are adding the method to is refered to here.</p>\n\n<p>Notice that the author of this code names his receiver <code>t</code> instead of something like <code>self</code> or <code>this</code>? In Go there is no special rule for naming a receiver, you just name it like you would a parameter.</p>\n\n<p><a href=\"https://gobyexample.com/methods\" rel=\"nofollow noreferrer\">Go by example</a> has a nice clear explanation of the basics, but <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow noreferrer\">the Go specification</a> is also very helpful.</p>\n"}], "owner": {"reputation": 113, "user_id": 5396455, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_vZR9QgkiuI/AAAAAAAAAAI/AAAAAAAADec/BGsSuwlCyik/photo.jpg?sz=128", "display_name": "Paras Jain", "link": "https://stackoverflow.com/users/5396455/paras-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "closed_date": 1503943193, "accepted_answer_id": 45905527, "answer_count": 1, "score": 1, "last_activity_date": 1503895616, "creation_date": 1503836265, "last_edit_date": 1503895616, "question_id": 45904865, "link": "https://stackoverflow.com/questions/45904865/what-is-t-simpleasset-in-this-function", "closed_reason": "Duplicate", "title": "What is (t *SimpleAsset) in this function", "body": "<pre><code>func (t *SimpleAsset) Init(stub shim.ChaincodeStubInterface) peer.Response  \n</code></pre>\n\n<p>I have been trying to understand <code>hyperledger</code> in which we use <code>Go</code> language for <code>Chaincode</code>. But here I am unable to understand what the <code>(t* SimpleAsset)</code> is.\nI do understand that unit is the name of the function, stub part is the argument and <code>peer.Response</code> is the return type. As I am new to <code>Go</code> please help me thank you.</p>\n"}, {"tags": ["arrays", "go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1503844516, "last_edit_date": 1503844516, "creation_date": 1503830151, "answer_id": 45904023, "question_id": 45903776, "link": "https://stackoverflow.com/questions/45903776/2d-array-different-column-sizes/45904023#45904023", "title": "2d Array different column sizes", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    matrix := make([][]int, 4)\n    for i := range matrix {\n        matrix[i] = make([]int, i+1)\n    }\n    fmt.Println(matrix)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[[0] [0 0] [0 0 0] [0 0 0 0]]\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    matrix := [][]int{{2}, {3, 4}, {6, 5, 7}, {4, 1, 8, 3}}\n    fmt.Println(matrix)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[[2] [3 4] [6 5 7] [4 1 8 3]]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "is_accepted": true, "score": 1, "last_activity_date": 1503830318, "creation_date": 1503830318, "answer_id": 45904049, "question_id": 45903776, "link": "https://stackoverflow.com/questions/45903776/2d-array-different-column-sizes/45904049#45904049", "title": "2d Array different column sizes", "body": "<p>You can create slices of different sizes at <code>matrix[i]</code>:</p>\n\n<pre><code>matrix := make([][]int, 4)\nfor i := range matrix {\n    matrix[i] = make([]int, i+1)\n}\n</code></pre>\n"}], "owner": {"reputation": 2623, "user_id": 5241780, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/8542490e5ecda0cf556cb0e7403f0812?s=128&d=identicon&r=PG&f=1", "display_name": "chefcurry7", "link": "https://stackoverflow.com/users/5241780/chefcurry7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 1, "accepted_answer_id": 45904049, "answer_count": 2, "score": 2, "last_activity_date": 1503844516, "creation_date": 1503828134, "question_id": 45903776, "link": "https://stackoverflow.com/questions/45903776/2d-array-different-column-sizes", "title": "2d Array different column sizes", "body": "<p>Lets say I want to create a two dimensional array that looks like</p>\n\n<pre><code>/* [\n     [2],\n    [3,4],\n   [6,5,7],\n  [4,1,8,3]\n] */\n</code></pre>\n\n<p>How do can I create it using go? </p>\n\n<p>Typically if I have a 2d array with equal size columns like</p>\n\n<pre><code> /*   [4,1,8,1],\n      [2,1,3,3],\n      [7,1,4,3]\n */\n\nmatrix := make([][]int, 4)\nfor i := range matrix {\n    matrix[i] = make([]int, 3)\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 583, "user_id": 1125767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MlPwU.jpg?s=128&g=1", "display_name": "Rakib", "link": "https://stackoverflow.com/users/1125767/rakib"}, "edited": false, "score": 0, "creation_date": 1503820787, "post_id": 45902847, "comment_id": 78764388, "body": "You want to see it formatted in chrome browser then use JSON Formatter extension."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 3, "creation_date": 1503820817, "post_id": 45902847, "comment_id": 78764393, "body": "use <code>MarshalIndent</code>"}, {"owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "reply_to_user": {"reputation": 583, "user_id": 1125767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MlPwU.jpg?s=128&g=1", "display_name": "Rakib", "link": "https://stackoverflow.com/users/1125767/rakib"}, "edited": false, "score": 0, "creation_date": 1503820830, "post_id": 45902847, "comment_id": 78764396, "body": "@Rakib no, just want to print it to console or save to file"}], "answers": [{"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 12, "last_activity_date": 1503820962, "creation_date": 1503820962, "answer_id": 45902887, "question_id": 45902847, "link": "https://stackoverflow.com/questions/45902847/format-json-with-indentation-in-go/45902887#45902887", "title": "Format JSON with indentation in Go", "body": "<p>Use <code>json.MarshalIndent(group, \"\", \"\\t\")</code>, try <a href=\"https://play.golang.org/p/ZNUizMYoFj\" rel=\"noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    type ColorGroup struct {\n        ID     int\n        Name   string\n        Colors []string\n    }\n    group := ColorGroup{\n        ID:     1,\n        Name:   \"Reds\",\n        Colors: []string{\"Crimson\", \"Red\", \"Ruby\", \"Maroon\"},\n    }\n    b, err := json.MarshalIndent(group, \"\", \"\\t\")\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n    os.Stdout.Write(b)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{\n    \"ID\": 1,\n    \"Name\": \"Reds\",\n    \"Colors\": [\n        \"Crimson\",\n        \"Red\",\n        \"Ruby\",\n        \"Maroon\"\n    ]\n}\n</code></pre>\n"}], "owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5704, "favorite_count": 0, "closed_date": 1503822516, "answer_count": 1, "score": 6, "last_activity_date": 1503820962, "creation_date": 1503820620, "question_id": 45902847, "link": "https://stackoverflow.com/questions/45902847/format-json-with-indentation-in-go", "closed_reason": "Duplicate", "title": "Format JSON with indentation in Go", "body": "<p>After I do</p>\n\n<pre><code>    json, err := json.Marshal(buf)\n</code></pre>\n\n<p>I get something like:</p>\n\n<pre><code>{\"a\":123,\"b\":\"abc\"}\n</code></pre>\n\n<p>But what I want is an indented version of this:</p>\n\n<pre><code>{\n    \"a\": 123,\n    \"b\": \"abc\"\n}\n</code></pre>\n\n<p>How?</p>\n"}, {"tags": ["rest", "go"], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 5416504, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l2Fj4.jpg?s=128&g=1", "display_name": "pellucid", "link": "https://stackoverflow.com/users/5416504/pellucid"}, "edited": false, "score": 0, "creation_date": 1504271294, "post_id": 45940179, "comment_id": 78962297, "body": "Thank you Yugui. It explains the behaviour of grpc-gateway, since it&#39;s from spec."}, {"owner": {"reputation": 125, "user_id": 5416504, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l2Fj4.jpg?s=128&g=1", "display_name": "pellucid", "link": "https://stackoverflow.com/users/5416504/pellucid"}, "edited": false, "score": 0, "creation_date": 1504272068, "post_id": 45940179, "comment_id": 78962834, "body": "However, it&#39;s very confusing. A GET HTTP call always has the lenth limitation. The api designer needs to take care if the length of an api&#39;s URL may exceed the allowance. It should not be the responsibility of grpc-gateway to do the trick. If I define a &quot;get&quot; in .proto file, then ONLY &quot;get&quot; requests are able to reach it."}, {"owner": {"reputation": 952, "user_id": 2091965, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/1c1285c630291af3766d5b8c6cd80a15?s=128&d=identicon&r=PG", "display_name": "eignhpants", "link": "https://stackoverflow.com/users/2091965/eignhpants"}, "edited": false, "score": 0, "creation_date": 1538956771, "post_id": 45940179, "comment_id": 92314590, "body": "Is it possible to get <code>x-url-form-encoded</code> data over grpc? I haven&#39;t figured it out. Whenever I try and use <code>httpbody</code> from <code>googleapis</code> I get not found. Am I looking in the right place?"}], "tags": [], "owner": {"reputation": 56, "user_id": 8532767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae3f34822b09a63e20380ff615058cc6?s=128&d=identicon&r=PG", "display_name": "Yugui Sonoda", "link": "https://stackoverflow.com/users/8532767/yugui-sonoda"}, "is_accepted": false, "score": 1, "last_activity_date": 1504012547, "creation_date": 1504012547, "answer_id": 45940179, "question_id": 45901389, "link": "https://stackoverflow.com/questions/45901389/why-golang-grpc-gateways-get-route-matches-post-request/45940179#45940179", "title": "Why Golang grpc-gateway&#39;s GET route matches POST request?", "body": "<h1>Short answer</h1>\n\n<p>It is because you did not specify the content-type of the request.</p>\n\n<h1>Long answer</h1>\n\n<p>By spec, it is allowed for you to encode your <code>GET</code> request into a <code>POST</code> method with <code>Content-Type: application/x-www-url-encoded</code>.</p>\n\n<p>So the request routing table in grpc-gateway tries to fallback from <code>POST</code> method to <code>GET</code> when the Content-Type of your request is <code>application/x-www-url-encoded</code>.</p>\n\n<p>ref.\n<a href=\"https://groups.google.com/d/msg/grpc-io/Xqx80hG0D44/1gwmwBcnNScJ\" rel=\"nofollow noreferrer\">https://groups.google.com/d/msg/grpc-io/Xqx80hG0D44/1gwmwBcnNScJ</a></p>\n\n<blockquote>\n  <p>\"(Note) URL has a length limitation (go/longer-urls). It's enfoced by some browsers and proxies. If your GET request exceeds the limitation, browser may reject to send them. You may change to use a POST request with content type application/x-www-form-urlencoded instead. If the POST + URL is already been mapped to another backend function, you shall add \"X-HTTP-Method-Override: GET\" header to override the HTTP method and obtain the correct mapping.</p>\n</blockquote>\n"}], "owner": {"reputation": 125, "user_id": 5416504, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l2Fj4.jpg?s=128&g=1", "display_name": "pellucid", "link": "https://stackoverflow.com/users/5416504/pellucid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 809, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1504012547, "creation_date": 1503803899, "question_id": 45901389, "link": "https://stackoverflow.com/questions/45901389/why-golang-grpc-gateways-get-route-matches-post-request", "title": "Why Golang grpc-gateway&#39;s GET route matches POST request?", "body": "<p>I found a \"get\" route will match both HTTP GET and HTTP POST requests.\nFor example:</p>\n\n<pre><code>rpc aaa(User) returns (User) {\n  option (google.api.http) = {\n  get: \"/api/v1/aaa\"\n};\n</code></pre>\n\n<p>It matches both <code>curl -v -X GET -k https://127.0.0.1/api/v1/aaa</code> and <code>curl -v -X POST -k https://127.0.0.1/api/v1/aaa</code>.</p>\n\n<p>I was wondering if it's possible to strictly match all routes including methods?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 18, "last_activity_date": 1503796889, "creation_date": 1503796889, "answer_id": 45900944, "question_id": 45900911, "link": "https://stackoverflow.com/questions/45900911/multiple-value-json-marshal-in-single-value-context/45900944#45900944", "title": "multiple-value json.Marshal() in single-value context", "body": "<p>The string conversion you are trying to perform requires a single argument, but the <code>json.Marshal</code> function returns two (<code>[]byte</code> and <code>error</code>). You need to store the first return value and then do the conversion:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    map1 := map[string]map[string]interface{}{}\n    map2 := map[string]interface{}{}\n    map2[\"map2item\"] = \"map2item\"\n    map1[\"map2\"] = map2\n    b, err := json.Marshal(map1)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(b))\n}\n</code></pre>\n"}], "owner": {"reputation": 15582, "user_id": 1420625, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wJ6T0.png?s=128&g=1", "display_name": "sensorario", "link": "https://stackoverflow.com/users/1420625/sensorario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13685, "favorite_count": 0, "closed_date": 1503802626, "accepted_answer_id": 45900944, "answer_count": 1, "score": 10, "last_activity_date": 1503802846, "creation_date": 1503796438, "last_edit_date": 1503796931, "question_id": 45900911, "link": "https://stackoverflow.com/questions/45900911/multiple-value-json-marshal-in-single-value-context", "closed_reason": "Duplicate", "title": "multiple-value json.Marshal() in single-value context", "body": "<p><a href=\"https://play.golang.org/p/8MWR8-AeD9\" rel=\"noreferrer\">Here</a> you can see this code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    map1 := map[string]map[string]interface{}{}\n    map2 := map[string]interface{}{}\n    map2[\"map2item\"] = \"map2item\"\n    map1[\"map2\"] = map2\n    fmt.Println(string(json.Marshal(map1)))\n}\n</code></pre>\n\n<p>that returns this error:</p>\n\n<pre><code>tmp/sandbox100532722/main.go:13:33: multiple-value json.Marshal() in single-value context.\n</code></pre>\n\n<p>How do I fix this?</p>\n"}, {"tags": ["json", "go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 789, "user_id": 7641174, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-mT1i-1QabTQ/AAAAAAAAAAI/AAAAAAAAAcU/tMWPD90e4Uw/photo.jpg?sz=128", "display_name": "Mustansir Zia", "link": "https://stackoverflow.com/users/7641174/mustansir-zia"}, "is_accepted": true, "score": 0, "last_activity_date": 1503786279, "creation_date": 1503786279, "answer_id": 45900145, "question_id": 45900081, "link": "https://stackoverflow.com/questions/45900081/adding-entries-to-nested-json-in-golang/45900145#45900145", "title": "Adding entries to nested json in Golang", "body": "<p>Change line number two to </p>\n\n<p><code>t := map[string]map[string]interface{}{\"internal\":internal_map}</code></p>\n\n<p>Access it like this <code>t[\"internal\"][\"key_in_internal_map\"]</code>.</p>\n\n<p>This is essentially a map of maps. You can add as many embedded levels as you want.</p>\n\n<p>Goplayground <a href=\"https://play.golang.org/p/0644j5qz1i\" rel=\"nofollow noreferrer\">example</a>.\nAlthough I would recommend making nested structs to avoid map chaining.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3292534"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "accepted_answer_id": 45900145, "answer_count": 1, "score": 0, "last_activity_date": 1503786279, "creation_date": 1503785633, "question_id": 45900081, "link": "https://stackoverflow.com/questions/45900081/adding-entries-to-nested-json-in-golang", "title": "Adding entries to nested json in Golang", "body": "<p>I need to create a nested JSON in Go. Then, on runtime, append values into inner object, and those values will be of different types. This is why I initiate a interface{}.</p>\n\n<pre><code>i := map[string]interface{}{\"name\":\"name\"}\nt := map[string]interface{}{\"internal\":internal_map}\n\nif somestuff != \"\"{\ntemplate_map[\"internal\"][\"somestuff\"] = somestuff\n}\n\nif somestuff2 != true{\ntemplate_map[\"internal\"][\"somestuff2\"] = somestuff2\n}\n</code></pre>\n\n<p>Now, the code above does not run due to <code>type interface {} does not support indexing</code> error.</p>\n\n<p>I need all 3 - nested JSON, different types and run-time construction of internal object.</p>\n"}, {"tags": ["json", "postgresql", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "edited": false, "score": 0, "creation_date": 1503789525, "post_id": 45900290, "comment_id": 78759812, "body": "thanks man! turns out i don&#39;t need to marshal/unmarshal too since the data is in retData.Poke already"}], "tags": [], "owner": {"reputation": 789, "user_id": 7641174, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-mT1i-1QabTQ/AAAAAAAAAAI/AAAAAAAAAcU/tMWPD90e4Uw/photo.jpg?sz=128", "display_name": "Mustansir Zia", "link": "https://stackoverflow.com/users/7641174/mustansir-zia"}, "is_accepted": true, "score": 2, "last_activity_date": 1503787784, "creation_date": 1503787784, "answer_id": 45900290, "question_id": 45899964, "link": "https://stackoverflow.com/questions/45899964/golang-querying-database-using-gorm-and-returning-json-in-http-response/45900290#45900290", "title": "golang querying database using Gorm and returning json in http response", "body": "<p><code>DB.Where(&amp;Pokemon{Type: t}).Find(&amp;retData.Poke)</code> esentially returns back the <code>*db</code> pointer which you can use to chain further methods.\nYou're already deserializing postgre rows into your struct slice when you do <code>.Find(&amp;retData.Poke)</code>. Thus, <code>pokemon</code> isn't actually what you think it is. </p>\n\n<p>The only thing left now is to chain <code>.Find()</code> with a <code>.Error()</code> so that you can return and check any error in your query. Just like this :</p>\n\n<pre><code>for _, t := range pokemonTypes {\n    err := DB.Where(&amp;Pokemon{Type: t}).Find(&amp;retData.Poke).Error()\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    p, _ := json.Marshal(retData.Poke)\n    err = json.Unmarshal(p, &amp;retData.Poke) \n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    m[category] = retData.Poke\n}\n</code></pre>\n\n<p>Hope it helps!</p>\n"}], "owner": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1394, "favorite_count": 0, "accepted_answer_id": 45900290, "answer_count": 1, "score": 0, "last_activity_date": 1503787784, "creation_date": 1503784395, "last_edit_date": 1503786832, "question_id": 45899964, "link": "https://stackoverflow.com/questions/45899964/golang-querying-database-using-gorm-and-returning-json-in-http-response", "title": "golang querying database using Gorm and returning json in http response", "body": "<p>I'm new to Go and am using Gorm to query my postgres database but am having trouble returning my data in a dictionary format, where the pokemon's type serves as a key to an array of all the pokemon of that type</p>\n\n<blockquote>\n  <p>json: cannot unmarshal object into Go value of type []models.Pokemon</p>\n</blockquote>\n\n<p>here's my code:</p>\n\n<pre><code>type Pokemon struct {\n    Name   string   `db:\"name\"`\n    Type   string   `db:\"type\"`\n}\n\npokemonTypes := [6]string{\n    \"fire\",\n    \"electric\",\n    \"water\",\n    \"grass\",\n}\n\nvar retData struct {\n   Poke []Pokemon\n}\n\nm := make(map[string][]Pokemon)\n\nfor _, t := range pokemonTypes {\n    pokemon := DB.Where(&amp;Pokemon{Type: t}).Find(&amp;retData.Poke)\n    p, _ := json.Marshal(pokemon)\n    err = json.Unmarshal(p, &amp;retData.Poke)  // getting error here\n    if err != nil {\n        fmt.Println(err)\n    }\n    m[category] = retData.Poke\n}\n\ndata, _ := json.Marshal(m) \nw.Write(data)  // http repsonse\n</code></pre>\n\n<p>I have this in my database</p>\n\n<pre><code>name       | type\n----------------------\npikachu    | electric\ncharmander | fire\nblaziken   | fire\nvenusaur   | grass\ntreeko     | grass\nsquirtle   | water\n</code></pre>\n\n<p>I want to return data in this json format  </p>\n\n<pre><code>{\n  \u201celectric\u201d: [\n    {\"name\": \"pikachu\", \"type\": \"electric\"},\n  ],\n  \"fire\": [\n    {\"name\": \"charmander\", \"type\": \"fire\"},\n    {\"name\": \"blaziken\", \"type\": \"fire\"}\n  ],\n  \"grass\": [\n    {\"name\": \"venusaur\", \"type\": \"grass\"},\n    {\"name\": \"treeko\", \"type\": \"grass\"},\n  ],\n  \"water\": [\n    {\"name\": \"squirtle\", \"type\": \"water\"},\n  ]\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": true, "score": 3, "last_activity_date": 1503783669, "creation_date": 1503783669, "answer_id": 45899902, "question_id": 45899868, "link": "https://stackoverflow.com/questions/45899868/how-can-i-convert-function-types-with-the-same-signature/45899902#45899902", "title": "How can I convert function types with the same signature?", "body": "<p>The usual type conversions work for function types just as well as they work for non-function types:</p>\n\n<pre><code>pkg1.PkgApiCall(SomeFuncType(x))\n</code></pre>\n"}], "owner": {"reputation": 9620, "user_id": 1783163, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/BfUwH.jpg?s=128&g=1", "display_name": "peterh", "link": "https://stackoverflow.com/users/1783163/peterh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 45899902, "answer_count": 1, "score": -2, "last_activity_date": 1503783669, "creation_date": 1503783401, "question_id": 45899868, "link": "https://stackoverflow.com/questions/45899868/how-can-i-convert-function-types-with-the-same-signature", "title": "How can I convert function types with the same signature?", "body": "<p>In a package, I have this:</p>\n\n<pre><code>package pkg1\n\ntype SomeFuncType func (a interface{}, b interface{}) int\n\nfunc PkgApiCall (x SomeFuncType) {\n   ...\n}\n</code></pre>\n\n<p>In my code using this package, I have some very similar:</p>\n\n<pre><code>type MyFuncType func (a interface{}, b interface{}) int\n</code></pre>\n\n<p>Now I want to call <code>pkg1.PkgApiCall()</code>, but with a variable of <code>MyFuncType</code> as argument:</p>\n\n<pre><code>package mypackage\n\nfunc doingSomeThing(x MyFuncType) {\n  pkg1.PkgApiCall(x)\n}\n</code></pre>\n\n<p>It doesn't compile. I get the error</p>\n\n<pre><code>./src1.go:97:7: error: incompatible type in initialization (cannot use type mypackage.MyFuncType as type pkg1.SomeFuncType)\n</code></pre>\n\n<p>How could I get over this? These function types define functions with exactly the same signature.</p>\n"}, {"tags": ["go", "aws-sdk-go"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 2, "creation_date": 1503783365, "post_id": 45899840, "comment_id": 78758728, "body": "A pointer isn&#39;t a boolean."}, {"owner": {"reputation": 611, "user_id": 4574049, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b73ddf536276d10f5c73adb3f192a535?s=128&d=identicon&r=PG&f=1", "display_name": "Mo Ali", "link": "https://stackoverflow.com/users/4574049/mo-ali"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1503783463, "post_id": 45899840, "comment_id": 78758743, "body": "@user2357112 I understand that, what I don&#39;t understand is how to check in boolean fashion if the pointer points to a boolean.  If *bool points to a <code>bool</code> that is <code>true</code> how would you check that in a condition."}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 3, "creation_date": 1503783510, "post_id": 45899840, "comment_id": 78758754, "body": "Dereference the pointer."}, {"owner": {"reputation": 611, "user_id": 4574049, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b73ddf536276d10f5c73adb3f192a535?s=128&d=identicon&r=PG&f=1", "display_name": "Mo Ali", "link": "https://stackoverflow.com/users/4574049/mo-ali"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1503783901, "post_id": 45899840, "comment_id": 78758829, "body": "user2357112  Thanks that was the solution."}], "answers": [{"tags": [], "owner": {"reputation": 2374, "user_id": 400262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7184a5d85b7c0dcb10167ba164e078d?s=128&d=identicon&r=PG", "display_name": "BryceH", "link": "https://stackoverflow.com/users/400262/bryceh"}, "is_accepted": false, "score": 1, "last_activity_date": 1503787697, "creation_date": 1503787697, "answer_id": 45900279, "question_id": 45899840, "link": "https://stackoverflow.com/questions/45899840/difference-between-bool-and-bool/45900279#45900279", "title": "Difference between bool and *bool", "body": "<p>You need to dereference to a struct. You need to use the := operator to do so. Something like -</p>\n\n<pre><code>new_struct := *your_pointer\n</code></pre>\n\n<p>You would then use the new_struct instead. </p>\n"}, {"tags": [], "owner": {"reputation": 3381, "user_id": 3964654, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ITt1C.jpg?s=128&g=1", "display_name": "wingerse", "link": "https://stackoverflow.com/users/3964654/wingerse"}, "is_accepted": false, "score": 5, "last_activity_date": 1503788286, "creation_date": 1503788286, "answer_id": 45900333, "question_id": 45899840, "link": "https://stackoverflow.com/questions/45899840/difference-between-bool-and-bool/45900333#45900333", "title": "Difference between bool and *bool", "body": "<p>From <a href=\"https://golang.org/ref/spec#If_statements\" rel=\"noreferrer\">standard reference</a>:</p>\n\n<blockquote>\n  <p>\"If\" statements specify the conditional execution of two branches according to the value of a boolean expression. </p>\n</blockquote>\n\n<p>So, to answer your question, <code>if</code> statements explicitly require boolean expressions. <code>*bool</code> is still not <code>bool</code>. You need to explicitly dereference the pointer (which could even be nil in which case your program will panic).  </p>\n\n<p>Here's how you would re-write your if statement:</p>\n\n<pre><code>if *zones.IsTruncated {\n    fmt.Printf(\"%v\", zones.NextMarker)\n}\n</code></pre>\n\n<p>but make sure it is not nil</p>\n"}], "owner": {"reputation": 611, "user_id": 4574049, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b73ddf536276d10f5c73adb3f192a535?s=128&d=identicon&r=PG&f=1", "display_name": "Mo Ali", "link": "https://stackoverflow.com/users/4574049/mo-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4190, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1503825711, "creation_date": 1503783145, "last_edit_date": 1503825711, "question_id": 45899840, "link": "https://stackoverflow.com/questions/45899840/difference-between-bool-and-bool", "title": "Difference between bool and *bool", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/route53\"\n)\n\nfunc main() {\n    sess := session.Must(session.NewSession())\n    client := route53.New(sess)\n    zones, err := client.ListHostedZones(&amp;route53.ListHostedZonesInput{\n        MaxItems: aws.String(\"100\"),\n    })\n    if err != nil {\n        fmt.Printf(\"Error occurred\")\n    }\n    fmt.Printf(\"%v\", zones)\n    if zones.IsTruncated {\n        fmt.Printf(\"%v\", zones.NextMarker)\n    }\n}\n</code></pre>\n\n<p>The code above fails due to the following condition.</p>\n\n<pre><code>if zones.IsTruncated {\n    fmt.Printf(\"%v\", zones.NextMarker)\n}\n</code></pre>\n\n<p>with the result of </p>\n\n<pre><code>non-bool zones.IsTruncated (type *bool) used as if condition\n</code></pre>\n\n<p>What I want to know is why is there a difference between a regular type(bool) and type(*bool).  I understand one is a pointer value however, the condition should still be useful.  </p>\n\n<p>Here is a tailed snippet of the output without the condition in place</p>\n\n<pre><code>IsTruncated: true,\nMaxItems: \"100\",\nNextMarker: \"Wouldn'tYouLikeToKnow\"\n}\n</code></pre>\n"}, {"tags": ["go", "go-templates", "fileserver", "go-html-template", "gopath"], "comments": [{"owner": {"reputation": 1204, "user_id": 726786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/906ddd2af9fd394ea34a09dee9ce8d9b?s=128&d=identicon&r=PG", "display_name": "gabeio", "link": "https://stackoverflow.com/users/726786/gabeio"}, "edited": false, "score": 0, "creation_date": 1503785368, "post_id": 45899656, "comment_id": 78759095, "body": "templates folder only needs to be near the binary you make when you build to a binary. the src folder is only required for sources. since the templates are loaded at runtime <i>not</i> compile time it doesn&#39;t need to be in the src folder."}, {"owner": {"reputation": 51, "user_id": 8239214, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/M2pqU.jpg?s=128&g=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/8239214/ahmed-nader"}, "reply_to_user": {"reputation": 1204, "user_id": 726786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/906ddd2af9fd394ea34a09dee9ce8d9b?s=128&d=identicon&r=PG", "display_name": "gabeio", "link": "https://stackoverflow.com/users/726786/gabeio"}, "edited": false, "score": 0, "creation_date": 1503785767, "post_id": 45899656, "comment_id": 78759176, "body": "so you mean that when i go to production i will be using the bin folder not the src folder ? so i am sorry to ask but what the src is used for in production then ? i mean if someone used my code how will he use my codes ? from package ?"}, {"owner": {"reputation": 51, "user_id": 8239214, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/M2pqU.jpg?s=128&g=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/8239214/ahmed-nader"}, "reply_to_user": {"reputation": 1204, "user_id": 726786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/906ddd2af9fd394ea34a09dee9ce8d9b?s=128&d=identicon&r=PG", "display_name": "gabeio", "link": "https://stackoverflow.com/users/726786/gabeio"}, "edited": false, "score": 0, "creation_date": 1503786141, "post_id": 45899656, "comment_id": 78759250, "body": "so you mean that i get out the folder from <code>src</code>and put it under the <code>project</code> folder and then change the <code>parseGlob</code> from <code>templates&#47;*.html</code> to <code>src&#47;templates&#47;*.html</code> ?"}, {"owner": {"reputation": 1204, "user_id": 726786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/906ddd2af9fd394ea34a09dee9ce8d9b?s=128&d=identicon&r=PG", "display_name": "gabeio", "link": "https://stackoverflow.com/users/726786/gabeio"}, "edited": false, "score": 0, "creation_date": 1503786448, "post_id": 45899656, "comment_id": 78759311, "body": "<code>templates&#47;*.html</code> is relative to where you launch the binary file it has nothing to do with the rest of the golang setup. If you are going to build and leave the binary in bin then you want to copy the templates folder there. If you are going to put it in pkg then you need to have templates there."}, {"owner": {"reputation": 51, "user_id": 8239214, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/M2pqU.jpg?s=128&g=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/8239214/ahmed-nader"}, "reply_to_user": {"reputation": 1204, "user_id": 726786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/906ddd2af9fd394ea34a09dee9ce8d9b?s=128&d=identicon&r=PG", "display_name": "gabeio", "link": "https://stackoverflow.com/users/726786/gabeio"}, "edited": false, "score": 0, "creation_date": 1503787091, "post_id": 45899656, "comment_id": 78759418, "body": "do i make it for public folder too ? i put public and template folders all outside src and i put them under the project folder beside the bin ?"}], "answers": [{"tags": [], "owner": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "is_accepted": true, "score": 2, "last_activity_date": 1503831988, "last_edit_date": 1503831988, "creation_date": 1503825978, "answer_id": 45903523, "question_id": 45899656, "link": "https://stackoverflow.com/questions/45899656/golang-error-when-serving-static-files/45903523#45903523", "title": "golang error when serving static files", "body": "<p>I personally find the standard <code>http</code> library very good and simple for such tasks. However, if you insist on Gorilla's <code>mux</code> here is the problem I found in your code:</p>\n\n<pre><code>func main() {\n    ...\n    http.Handle(\"/public/\", http.StripPrefix(\"/public/\", http.FileServer(http.Dir(\"/pub\"))))\n    http.ListenAndServe(\":8080\", r)\n}\n</code></pre>\n\n<p>On one hand you are using <code>http.Handle</code> to serve static files but on the other hand you're giving <code>r</code> to <code>http.ListenAndServe</code>.</p>\n\n<p>To fix this just change that line into:</p>\n\n<pre><code>r.PathPrefix(\"/public/\").Handler(\n       http.StripPrefix(\"/public/\",\n           http.FileServer(http.Dir(\"/pub/\"))))\n</code></pre>\n\n<p>If I may, I would like to suggest using <code>flag</code> to set a different path to the templates directory and to the public directory so it would be easy to deploy and run your server.</p>\n\n<p>In other words, instead of hardcoding the path to these directories you can run:</p>\n\n<pre><code>./myserver -templates=/loca/templates -public=/home/root/public\n</code></pre>\n\n<p>To do that just add the following:</p>\n\n<pre><code>import \"flag\"\n....\nfunc main() {\n    var tpl *template.Template\n    var templatesPath, publicPath string\n    flag.StringVar(&amp;templatesPath, \"templates\", \"./templates\", \"Path to templates\")\n    flag.StringVar(&amp;publicPath, \"public\", \"./public\", \"Path to public\")\n\n    flag.Parse()\n    tpl = template.Must(template.ParseGlob(templatesPath+\"/*.html\"))\n    r.HandleFunc(\"/\", handlerHomeTemplates(tpl))\n    r.PathPrefix(\"/public/\").Handler(http.StripPrefix(\"/public/\", http.FileServer(http.Dir(publicPath))))\n    ...\n}\n\nfunc handlerHomeTemplates(tpl *template.Template) http.HandlerFunc {\n    return http.HandlerFunc(func((writer http.ResponseWriter, request *http.Request) {\n        err := tpl.ExecuteTemplate(writer, \"index.html\", nil)\n        if err != nil {\n            ...\n        }\n    })\n}\n</code></pre>\n\n<p>Even thought the <code>init</code> function is a good place to do part of it, I think it's a good practice to avoid it unless it's needed. That's why I did all the initialization in the <code>main</code> function and used <code>handlerHomeTemplates</code> to return a new <code>http.HandleFunc</code> that uses <code>templatesPath</code>.</p>\n"}], "owner": {"reputation": 51, "user_id": 8239214, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/M2pqU.jpg?s=128&g=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/8239214/ahmed-nader"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1509, "favorite_count": 0, "accepted_answer_id": 45903523, "answer_count": 1, "score": -1, "last_activity_date": 1503831988, "creation_date": 1503781390, "last_edit_date": 1503793336, "question_id": 45899656, "link": "https://stackoverflow.com/questions/45899656/golang-error-when-serving-static-files", "title": "golang error when serving static files", "body": "<p>I can't figure out this error in go lang when executing a template</p>\n\n<pre><code>panic: open templates/*.html: The system cannot find the path specified.\n</code></pre>\n\n<p>another problem is that my public folder can't be served from css and I don't know why.</p>\n\n<p>code:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"github.com/gorilla/mux\"\n    \"html/template\"\n    \"log\"\n)\n\nvar tpl *template.Template\n\nfunc init() {\n    tpl = template.Must(template.ParseGlob(\"templates/*.html\"))\n}\n\nfunc main() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\",home)\n    http.Handle(\"/public/\", http.StripPrefix(\"/public/\", \n    http.FileServer(http.Dir(\"/pub\"))))\n    http.ListenAndServe(\":8080\", r)\n}\n\nfunc home(writer http.ResponseWriter, request *http.Request) {\n    err := tpl.ExecuteTemplate(writer, \"index.html\", nil)\n    if err != nil {\n        log.Println(err)\n        http.Error(writer, \"Internal server error\", http.StatusInternalServerError)\n    }\n}\n</code></pre>\n\n<p>my folder is like that:</p>\n\n<pre>bin\npkg\npub\n   css\n     home.css\n   js\nsrc\n   github.com\n        gorila/mux\ntemplates\n        index.html</pre>\n\n<p>my GOROOT is pointing to the folder <code>project</code> which contains the <code>bin</code> <code>pkg</code> <code>src</code> </p>\n\n<p>when I make the <code>templates</code> folder outside <code>src</code> it works fine but I thinks that's not right everything must be in <code>src</code> right ?</p>\n\n<p>index.html</p>\n\n<pre><code>    &lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;test&lt;/title&gt;\n    &lt;link href=\"../public/css/home.css\" type=\"text/css\" rel=\"stylesheet\" /&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;welcome! hi&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>here i can't serve the css</p>\n\n<p><strong>UPDATE::</strong></p>\n\n<p>the first problem is solved of the templates folder .</p>\n\n<p>but I am still cannot solve the second issue</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 9620, "user_id": 1783163, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/BfUwH.jpg?s=128&g=1", "display_name": "peterh", "link": "https://stackoverflow.com/users/1783163/peterh"}, "is_accepted": false, "score": -1, "last_activity_date": 1503778941, "creation_date": 1503778941, "answer_id": 45899365, "question_id": 45899203, "link": "https://stackoverflow.com/questions/45899203/can-i-develop-a-go-package-in-multiple-source-directories/45899365#45899365", "title": "Can I develop a go package in multiple source directories?", "body": "<p>Inside your package source code, you have to differentiate your source directories by <em>renamed imports</em>. You can declare the same <code>package mypackage</code> in all of your source files (even if they are in different directories).</p>\n\n<p>However, while you import them, you should give an induvidual names to the directories. In your source <code>src1.go</code>, import the other directories on this way:</p>\n\n<pre><code>import (\n  \"mypackage\"\n  submodule1 \"mypackage/mySubDir\"\n)\n</code></pre>\n\n<p>And you will be able to reach the API defined in \"mypackage\" as <code>mypackage.AnyThing()</code>, and the API defined in <code>mySubDir</code> as <code>submodule1.AnyThing()</code>.</p>\n\n<p>The external world (i.e. the users of your package) will see all exported entities in <code>myPackage.AnyThing()</code>.</p>\n\n<p>Avoid namespace collisions. And use better understable, intuitive naming as in the example.</p>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1503815180, "creation_date": 1503815180, "answer_id": 45902260, "question_id": 45899203, "link": "https://stackoverflow.com/questions/45899203/can-i-develop-a-go-package-in-multiple-source-directories/45902260#45902260", "title": "Can I develop a go package in multiple source directories?", "body": "<p>Yes, this is doable without any problems, just invoke the Go compiler by hand, that is not via the <code>go</code> tool.</p>\n\n<p>But the best advice is: Don't do that. It's ugly and unnecessarily complicated. Just design your package properly.</p>\n"}, {"comments": [{"owner": {"reputation": 816, "user_id": 2359010, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/612536ffc2d4cb3a96b794da6113b8e9?s=128&d=identicon&r=PG", "display_name": "Arlo Guthrie", "link": "https://stackoverflow.com/users/2359010/arlo-guthrie"}, "edited": false, "score": 0, "creation_date": 1600971724, "post_id": 45902409, "comment_id": 113265544, "body": "I liked this answer, but I really wanted to hate it.  Coming from the java world, it&#39;s hard not to instinctively want to divide your source up logically into multiple folders.  :D"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 816, "user_id": 2359010, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/612536ffc2d4cb3a96b794da6113b8e9?s=128&d=identicon&r=PG", "display_name": "Arlo Guthrie", "link": "https://stackoverflow.com/users/2359010/arlo-guthrie"}, "edited": false, "score": 0, "creation_date": 1601017840, "post_id": 45902409, "comment_id": 113278279, "body": "@ArloGuthrie But you can divide your source into multiple folders, that&#39;s standard, they just can&#39;t be part of the same package. You also have packages in Java too, in different folders."}, {"owner": {"reputation": 816, "user_id": 2359010, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/612536ffc2d4cb3a96b794da6113b8e9?s=128&d=identicon&r=PG", "display_name": "Arlo Guthrie", "link": "https://stackoverflow.com/users/2359010/arlo-guthrie"}, "edited": false, "score": 0, "creation_date": 1601296487, "post_id": 45902409, "comment_id": 113354437, "body": "java.util is a package.  under it are any number of &quot;folders&quot; ... collections, etc.  I&#39;m a serious newbie with golang, but it seems that if you want to write an API you really need to stuff everything into one folder so that the user only needs to import one package, otherwise you get circular dependency issues.  am I understanding golang package structure incorrectly?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 816, "user_id": 2359010, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/612536ffc2d4cb3a96b794da6113b8e9?s=128&d=identicon&r=PG", "display_name": "Arlo Guthrie", "link": "https://stackoverflow.com/users/2359010/arlo-guthrie"}, "edited": false, "score": 0, "creation_date": 1601297347, "post_id": 45902409, "comment_id": 113354826, "body": "@ArloGuthrie Yes, it&#39;s correct that files of a package must be in a single folder. But you are not limited to use only a single package. E.g. the standard lib has an <code>image</code> package with several others for image types (e.g. <code>image&#47;jpeg</code>), and some parts in differnet packages, e.g. <code>image&#47;color</code>, <code>image&#47;draw</code> etc. There are techniques to resolve cyclic dependencies, see <a href=\"https://stackoverflow.com/questions/29271440/registering-packages-in-go-without-cyclic-dependency/29272910#29272910\">Registering packages in Go without cyclic dependency</a>. And there&#39;s also the mentioned internal packages."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 816, "user_id": 2359010, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/612536ffc2d4cb3a96b794da6113b8e9?s=128&d=identicon&r=PG", "display_name": "Arlo Guthrie", "link": "https://stackoverflow.com/users/2359010/arlo-guthrie"}, "edited": false, "score": 1, "creation_date": 1601297424, "post_id": 45902409, "comment_id": 113354861, "body": "I don&#39;t see a limitation that&#39;s not solvable with Go&#39;s package system. They&#39;re just not a one-to-one equivalent to Java&#39;s packages. It&#39;s a different language with different rules and principles. Developing in Go is not Developing in Java."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1503829146, "last_edit_date": 1503829146, "creation_date": 1503816736, "answer_id": 45902409, "question_id": 45899203, "link": "https://stackoverflow.com/questions/45899203/can-i-develop-a-go-package-in-multiple-source-directories/45902409#45902409", "title": "Can I develop a go package in multiple source directories?", "body": "<p>You should not do this in any case, as the language spec allows a compiler implementation to reject such constructs. Quoting from <a href=\"https://golang.org/ref/spec#Package_clause\" rel=\"noreferrer\">Spec: Package clause:</a></p>\n\n<blockquote>\n  <p>A set of files sharing the same PackageName form the implementation of a package. <strong>An implementation may require that all source files for a package inhabit the same directory.</strong></p>\n</blockquote>\n\n<p>Instead \"structure\" your file names to mimic the folder structure; e.g. instead of files of</p>\n\n<pre><code>foo/foo1.go\nfoo/bar/bar1.go\nfoo/bar/bar2.go\n</code></pre>\n\n<p>You could simply use:</p>\n\n<pre><code>foo/foo1.go\nfoo/bar-bar1.go\nfoo/bar-bar2.go\n</code></pre>\n\n<p>Also if your package is so big that you would need multiple folders to even \"host\" the files of the package implementation, you should really consider not implementing it as a single package, but break it into multiple packages.</p>\n\n<p>Also note that <a href=\"https://golang.org/doc/go1.5\" rel=\"noreferrer\">Go 1.5</a> introduced <a href=\"https://docs.google.com/document/d/1e8kOo3r51b2BWtTs_1uADIA5djfXhPT36s6eHVRIvaU/edit\" rel=\"noreferrer\">internal packages</a>. If you create a special <code>internal</code> subfolder inside your package folder, you may create any number of subpackages inside that (even using multiple levels). Your package will be able to import and use them (or to be more precise all packages rooted at your package folder), but no one else outside will be able to do so, it would be a compile time error.</p>\n\n<p>E.g. you may create a <code>foo</code> package, have a <code>foo/foo.go</code> file, and <code>foo/internal/bar</code> package. <code>foo</code> will be able to import <code>foo/internal/bar</code>, but e.g. <code>boo</code> won't. Also <code>foo/baz</code> will also be able to import and use <code>foo/internal/bar</code> because it's rooted at <code>foo/</code>.</p>\n\n<p>So you may use internal packages to break down your big package into smaller ones, effectively grouping your source files into multiple folders. Only thing you have to pay attention to is to put everything your package wants to export into the package and not into the internal packages (as those are not importable / visible from the \"outside\").</p>\n"}], "owner": {"reputation": 9620, "user_id": 1783163, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/BfUwH.jpg?s=128&g=1", "display_name": "peterh", "link": "https://stackoverflow.com/users/1783163/peterh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4677, "favorite_count": 3, "accepted_answer_id": 45902409, "answer_count": 3, "score": 6, "last_activity_date": 1503829146, "creation_date": 1503777643, "last_edit_date": 1503778377, "question_id": 45899203, "link": "https://stackoverflow.com/questions/45899203/can-i-develop-a-go-package-in-multiple-source-directories", "title": "Can I develop a go package in multiple source directories?", "body": "<p>I am developing a go package, which is a little bit complex and thus I want to organize the source code into multiple directories.</p>\n\n<p>However, I don't want the users of the package to have to use too long imports. Anyways, the internal structure of the package isn't their concern.</p>\n\n<p>Thus, my package structure looks so:</p>\n\n<pre><code>subDir1\n  subSubDir1\n  subSubDir2\nsubDir2\n  subSubDir3\n</code></pre>\n\n<p>...and so on. All of them have their exported calls.</p>\n\n<p>I would like to avoid that my users have to import</p>\n\n<pre><code>import (\n  \"mypackage/subDir1\"\n  \"mypackage/subDir1/subSubDir2\"\n)\n</code></pre>\n\n<p>...and so on.</p>\n\n<p>I only want, if they want to use an exported function from my package, they should have access all of them by simply importing <code>mypackage</code>.</p>\n\n<p>I tried that I declare <code>package mypackage</code> in all of the <code>.go</code> files. Thus, I had source files in different directories, but with the same package declaration.</p>\n\n<p>In this case, the problem what I've confronted was that I simply couldn't import multiple directories from the same package. It said:</p>\n\n<pre><code>./src1.go:6:15: error: redefinition of \u2018mypackage\u2019\n   \"mypackage/mysubdir1\"\n               ^\n./src1.go:4:10: note: previous definition of \u2018mypackage\u2019 was here\n   \"mypackage\"\n          ^\n./src1.go:5:15: error: redefinition of \u2018mypackage\u2019\n   \"mypackage/mysubdir2\"\n               ^\n./src1.go:4:10: note: previous definition of \u2018mypackage\u2019 was here\n   \"mypackage\"\n          ^\n</code></pre>\n\n<p>Is it somehow possible?</p>\n"}, {"tags": ["go", "methods", "struct"], "answers": [{"tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": false, "score": 2, "last_activity_date": 1503777062, "creation_date": 1503777062, "answer_id": 45899128, "question_id": 45898990, "link": "https://stackoverflow.com/questions/45898990/understanding-struct-embedding/45899128#45899128", "title": "Understanding struct embedding", "body": "<p>Its important to know, that when you create another name for a type, you <em>can not</em> use the types interchangeably. They are <em>two distinct types</em> for Go's typesystem, even though they share the same underlying representation.</p>\n\n<p>You have two distinct types, <code>S2</code> and <code>S3</code>. <code>S2</code> has a function <code>Say</code>, <code>S3</code> however <em>has not</em>. But since <code>S3</code> has the same underlying struct as <code>S2</code>, it <em>does</em> have a <code>S1</code> embedded, which <em>does</em> have a function <code>Say</code>, so thats what gets called.</p>\n"}, {"comments": [{"owner": {"reputation": 331, "user_id": 440204, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/9c364594f3313bb143652866f0763c23?s=128&d=identicon&r=PG", "display_name": "rene marxis", "link": "https://stackoverflow.com/users/440204/rene-marxis"}, "edited": false, "score": 0, "creation_date": 1503814746, "post_id": 45899201, "comment_id": 78763056, "body": "Ok. Think i start understanding... That&#39;s why <a href=\"https://play.golang.org/p/QM_ppjBTcz\" rel=\"nofollow noreferrer\">play.golang.org/p/QM_ppjBTcz</a> prints 1,2."}, {"owner": {"reputation": 331, "user_id": 440204, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/9c364594f3313bb143652866f0763c23?s=128&d=identicon&r=PG", "display_name": "rene marxis", "link": "https://stackoverflow.com/users/440204/rene-marxis"}, "edited": false, "score": 0, "creation_date": 1503815558, "post_id": 45899201, "comment_id": 78763216, "body": "So when i create a new type for a present one and that type has embedded structs, only the methods of the embedded structs will be promoted, but not the once from the present type itself. Why? What&#39;s the purpose of this? Just the way go implemnts it or is this good for some reason?"}, {"owner": {"reputation": 331, "user_id": 440204, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/9c364594f3313bb143652866f0763c23?s=128&d=identicon&r=PG", "display_name": "rene marxis", "link": "https://stackoverflow.com/users/440204/rene-marxis"}, "edited": false, "score": 0, "creation_date": 1503815584, "post_id": 45899201, "comment_id": 78763224, "body": "I ran into this, when trying to create a new helper method for an struct definied in an other package.I have (db)models, that have embedded structs for relations (sqlx). All models have an Insert method. To be able to create the method (in another package than models) i had to create a new type, but calling Insert called the method of the embedded struct.  Even if i understand now, why this happens i&#39;d like to understand why google implemented it this way."}, {"owner": {"reputation": 331, "user_id": 440204, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/9c364594f3313bb143652866f0763c23?s=128&d=identicon&r=PG", "display_name": "rene marxis", "link": "https://stackoverflow.com/users/440204/rene-marxis"}, "edited": false, "score": 0, "creation_date": 1503815587, "post_id": 45899201, "comment_id": 78763225, "body": "Couldn&#39;t this lead to a realy mess, if you create new types of structs defined in external librarys? You have to know, if the struct embedds other structs, if not, you can&#39;t even say what methods will be called. I fixed this by creating a function right now, and for 1.9 i could use type aliases but still, why is it implemented like this?"}, {"owner": {"reputation": 13033, "user_id": 4029014, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ndZhu.jpg?s=128&g=1", "display_name": "aghast", "link": "https://stackoverflow.com/users/4029014/aghast"}, "reply_to_user": {"reputation": 331, "user_id": 440204, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/9c364594f3313bb143652866f0763c23?s=128&d=identicon&r=PG", "display_name": "rene marxis", "link": "https://stackoverflow.com/users/440204/rene-marxis"}, "edited": false, "score": 0, "creation_date": 1503817226, "post_id": 45899201, "comment_id": 78763568, "body": "Keep in mind that there are two &quot;sources&quot; for this. First, the embedded fields: I don&#39;t know why this is a thing - that is, I don&#39;t know why it&#39;s possible to include anonymous sub-structures. But, once that decision was made, it&#39;s just a matter of consistency- any structure that includes an embedded S1 as a child struct will automatically get the fields and methods, because that&#39;s how it is. So S3 gets S1.Say that way. I believe that the decision to not share methods between aliased types is part of emphasizing the separate-ness of the types. That&#39;s the second source: so, no S2.Say."}], "tags": [], "owner": {"reputation": 13033, "user_id": 4029014, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ndZhu.jpg?s=128&g=1", "display_name": "aghast", "link": "https://stackoverflow.com/users/4029014/aghast"}, "is_accepted": true, "score": 7, "last_activity_date": 1503777638, "creation_date": 1503777638, "answer_id": 45899201, "question_id": 45898990, "link": "https://stackoverflow.com/questions/45898990/understanding-struct-embedding/45899201#45899201", "title": "Understanding struct embedding", "body": "<p>See <a href=\"https://stackoverflow.com/a/34083564/4029014\">this answer</a>.</p>\n\n<p>Specifically, from <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"noreferrer\">the Go spec</a> we have <strong>Method Sets:</strong></p>\n\n<blockquote>\n  <p><strong>Method sets</strong></p>\n  \n  <p>A type may have a method set associated with it. The method set of an\n  interface type is its interface. The method set of any other type T\n  consists of all methods declared with receiver type T. The method set\n  of the corresponding pointer type *T is the set of all methods\n  declared with receiver *T or T (that is, it also contains the method\n  set of T). Further rules apply to structs containing embedded fields,\n  as described in the section on struct types. Any other type has an\n  empty method set. In a method set, each method must have a unique\n  non-blank method name.</p>\n</blockquote>\n\n<p>Then Struct typess:</p>\n\n<blockquote>\n  <p><strong>Struct types</strong></p>\n  \n  <p>A struct is a sequence of named elements, called fields, each of which\n  has a name and a type. Field names may be specified explicitly\n  (IdentifierList) or implicitly (EmbeddedField). Within a struct,\n  non-blank field names must be unique.</p>\n</blockquote>\n\n<p>Then this:</p>\n\n<blockquote>\n  <p>A field declared with a type but no explicit field name is called an <em>embedded field.</em></p>\n</blockquote>\n\n<p>Finally, this:</p>\n\n<blockquote>\n  <p>A field or method f of an embedded field in a struct x is called\n  <em>promoted</em> if <code>x.f</code> is a legal selector that denotes that field or method <code>f</code>.</p>\n  \n  <p>Promoted fields act like ordinary fields of a struct except that they\n  cannot be used as field names in composite literals of the struct.</p>\n  \n  <p>Given a struct type S and a type named T, promoted methods are\n  included in the method set of the struct as follows:</p>\n\n<pre><code>If S contains an embedded field T, the method sets of S and *S \nboth include promoted methods with receiver T. The method set of *S\nalso includes promoted methods with receiver *T.\n\nIf S contains an embedded field *T, the method sets of S and *S \nboth include promoted methods with receiver T or *T.\n</code></pre>\n</blockquote>\n\n<p>How does all that combine?</p>\n\n<p>You have </p>\n\n<pre><code>type S2 struct{\n    S1\n    f2 string\n}\n</code></pre>\n\n<p>which makes S1 an embedded field, and makes S1.Say visible.</p>\n\n<p>Then you have:</p>\n\n<pre><code>type S3 S2\n</code></pre>\n\n<p>Which makes S3 have the same memory layout and fields as S2, but <em>does not</em> create a type equivalence. This is not saying that S3 \"is a\" S2, but rather that S3 <strong>is not</strong> the same as S2, but they do have the same layout. </p>\n\n<p>That layout includes embedded fields, which happens to bring S1.Say into the equation.</p>\n\n<p>Put another way, type S2 has an underlying type of:</p>\n\n<pre><code>struct { S1; f2 string }\n</code></pre>\n\n<p>and a method called Say.</p>\n\n<p>Type S3 has an <em>identical</em> underlying type of:</p>\n\n<pre><code>struct { S1; f2 string }\n</code></pre>\n\n<p>But S3 and S2 are not the same, and so S3 does not \"inherit\" any methods from S2. Instead, S3 inherits only the fields/methods from its underlying type, which are f2, and S1.* (including \"Say\").</p>\n"}], "owner": {"reputation": 331, "user_id": 440204, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/9c364594f3313bb143652866f0763c23?s=128&d=identicon&r=PG", "display_name": "rene marxis", "link": "https://stackoverflow.com/users/440204/rene-marxis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 582, "favorite_count": 2, "accepted_answer_id": 45899201, "answer_count": 2, "score": 1, "last_activity_date": 1503777638, "creation_date": 1503775988, "last_edit_date": 1503777567, "question_id": 45898990, "link": "https://stackoverflow.com/questions/45898990/understanding-struct-embedding", "title": "Understanding struct embedding", "body": "<p>Can someone explain me why this code  prints 1 and not 2?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype S1 struct{\n    f1 string\n}\n\ntype S2 struct{\n    S1\n    f2 string\n}   \n\nfunc (s *S1) Say(){\n    fmt.Println(\"1\")\n}   \n\nfunc (s *S2) Say(){\n    fmt.Println(\"2\")\n}       \n\ntype S3 S2\n\nfunc main() {\n    var s3 S3\n    s3.Say()\n}\n</code></pre>\n\n<p>(Runnable at: <a href=\"https://play.golang.org/p/_cjNxBKgSf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_cjNxBKgSf</a>)</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1503764993, "post_id": 45897476, "comment_id": 78753813, "body": "It&#39;s normal, postgres does not return an error if you&#39;re deleting a row that does not exists, therefore Go does not return an error as well."}, {"owner": {"reputation": 415, "user_id": 6021348, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/ddc2ecdf76091c717de352c775ee9e55?s=128&d=identicon&r=PG&f=1", "display_name": "amanda45", "link": "https://stackoverflow.com/users/6021348/amanda45"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1503765255, "post_id": 45897476, "comment_id": 78753893, "body": "@mkopriva-ok, thanks"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1503765397, "post_id": 45897476, "comment_id": 78753949, "body": "And if you want to determine if a row was deleted or not you can change your query, like so <code>err := db.QueryRow(&quot;DELETE FROM Users WHERE user_id=$1 RETURNING user_id&quot;, ID).Scan(&amp;ID)</code> and if the resulting <code>err</code> is equal to <code>sql.ErrNoRows</code> then zero rows were deleted."}], "answers": [{"tags": [], "owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "is_accepted": true, "score": 5, "last_activity_date": 1503765262, "creation_date": 1503765262, "answer_id": 45897536, "question_id": 45897476, "link": "https://stackoverflow.com/questions/45897476/db-delete-query-always-returns-true/45897536#45897536", "title": "Db delete query always returns true", "body": "<p>Try this</p>\n\n<pre><code>func DeleteUser(ID int){\n    err = nil\n    res, err := DB.Exec(\"DELETE FROM Users WHERE user_id=$1\", ID)\n\n    if err == nil {\n\n       count, err := res.RowsAffected()  \n       if err == nil {\n          /* check count and return true/false */\n       }\n\n    }\n\n    return false\n\n}\n</code></pre>\n"}], "owner": {"reputation": 415, "user_id": 6021348, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/ddc2ecdf76091c717de352c775ee9e55?s=128&d=identicon&r=PG&f=1", "display_name": "amanda45", "link": "https://stackoverflow.com/users/6021348/amanda45"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3804, "favorite_count": 0, "accepted_answer_id": 45897536, "answer_count": 1, "score": 1, "last_activity_date": 1503765262, "creation_date": 1503764743, "question_id": 45897476, "link": "https://stackoverflow.com/questions/45897476/db-delete-query-always-returns-true", "title": "Db delete query always returns true", "body": "<p>I am using golang with postgres. I want to delete users from my table by passing in the Id for that user. When I run the code below I always get true. Even when I pass in a ID that does not exist in the table. Is that normal? Does DB.Exec return err if the user ID is not in the database? </p>\n\n<pre><code>func DeleteUser(ID int){\n    err = nil\n    _, err := DB.Exec(\"DELETE FROM Users WHERE user_id=$1\", ID)\n\n    if err == nil {\n\n        return true\n    }\n\n    return false\n\n}\n</code></pre>\n"}, {"tags": ["inheritance", "go", "struct", "embed"], "comments": [{"owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "edited": false, "score": 3, "creation_date": 1503764210, "post_id": 45897371, "comment_id": 78753574, "body": "<code>callMyName</code> is not a public method"}], "answers": [{"tags": [], "owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "is_accepted": true, "score": 1, "last_activity_date": 1503766061, "creation_date": 1503766061, "answer_id": 45897635, "question_id": 45897371, "link": "https://stackoverflow.com/questions/45897371/how-to-embed-other-packages-struct-in-golang/45897635#45897635", "title": "How to embed other package&#39;s struct in golang", "body": "<p>@simon_xia is right and it looks like you <em>might</em> be a little new to Go.</p>\n\n<p>First off, welcome to the community!!</p>\n\n<p>Now to expand a bit on his comment... instead of providing public/private scope for a member/method, Go has the concept of <a href=\"https://tour.golang.org/basics/3\" rel=\"nofollow noreferrer\">Exporting</a>. So if you want to allow a method to be accessed from another package, just capitalize the method's signature :)</p>\n\n<p>Most of the <em>basic</em> features of OOP are satisfied in some way by Go, but it's important to understand that <a href=\"https://golang.org/doc/faq#Is_Go_an_object-oriented_language\" rel=\"nofollow noreferrer\">Go is not an object-oriented language</a>.</p>\n\n<p>I'd <strong>highly recommend</strong> working your way through the entire <a href=\"https://tour.golang.org/list\" rel=\"nofollow noreferrer\">Tour of Go</a> since it hits this concept of Exporting as well as many, many other key features of the Go language. The entire tour can be finished in an afternoon and it did <strong>a lot</strong> to get me up to speed on the language a few years back.</p>\n\n<p>If you're still hungry for more after that, I found <a href=\"https://gobyexample.com\" rel=\"nofollow noreferrer\">Go By Example</a> to be an awesome point of reference for a bit of a deeper study into some major topics.</p>\n"}], "owner": {"reputation": 25, "user_id": 8521041, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ab3072d7ccfc69c2a2c79329da5518?s=128&d=identicon&r=PG&f=1", "display_name": "cyent", "link": "https://stackoverflow.com/users/8521041/cyent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1160, "favorite_count": 0, "accepted_answer_id": 45897635, "answer_count": 1, "score": 2, "last_activity_date": 1503766061, "creation_date": 1503764042, "question_id": 45897371, "link": "https://stackoverflow.com/questions/45897371/how-to-embed-other-packages-struct-in-golang", "title": "How to embed other package&#39;s struct in golang", "body": "<h3>I know how to embed other struct in struct within a same package, but how to embed other package's struct?</h3>\n\n<p>dog.go</p>\n\n<pre><code>package dog\n\nimport \"fmt\"\n\ntype Dog struct {\n    Name string\n}\n\nfunc (this *Dog) callMyName() {\n    fmt.Printf(\"Dog my name is %q\\n\", this.Name)\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport \"/path/to/dog\"\n\ntype BDog struct {\n    dog.Dog\n    name string\n}\n\nfunc main() {\n    b := new(BDog)\n    b.Name = \"this is a Dog name\"\n    b.name = \"this is a BDog name\"\n    b.callMyName()\n}\n</code></pre>\n\n<p>When I run main.go, it tell me a error:</p>\n\n<pre><code>./main.go:14: b.callMyName undefined (type *BDog has no field or method callMyName)\n</code></pre>\n"}, {"tags": ["json", "go", "struct", "marshalling", "unmarshalling"], "comments": [{"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 1, "creation_date": 1503763120, "post_id": 45896930, "comment_id": 78753271, "body": "The right option may be to use interfaces, see <a href=\"http://gregtrowbridge.com/golang-json-serialization-with-interfaces/\" rel=\"nofollow noreferrer\">gregtrowbridge.com/golang-json-serialization-with-interfaces</a> - haven&#39;t tried out this code, but this approach looks correct."}, {"owner": {"reputation": 831, "user_id": 3023734, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c3549d5a62905af4f11d877205699f90?s=128&d=identicon&r=PG&f=1", "display_name": "ma77c", "link": "https://stackoverflow.com/users/3023734/ma77c"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1503765321, "post_id": 45896930, "comment_id": 78753920, "body": "@Ravi | I believe this is the approach I will have to take. If you put it into some form of answer, I will accept it."}], "answers": [{"comments": [{"owner": {"reputation": 831, "user_id": 3023734, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c3549d5a62905af4f11d877205699f90?s=128&d=identicon&r=PG&f=1", "display_name": "ma77c", "link": "https://stackoverflow.com/users/3023734/ma77c"}, "edited": false, "score": 0, "creation_date": 1503764278, "post_id": 45897208, "comment_id": 78753601, "body": "While this approach is definitely handy, the scope of the real project is much larger than the example given."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 1, "last_activity_date": 1503762836, "creation_date": 1503762836, "answer_id": 45897208, "question_id": 45896930, "link": "https://stackoverflow.com/questions/45896930/golang-unmarshalling-arbitrary-data/45897208#45897208", "title": "golang | unmarshalling arbitrary data", "body": "<pre><code>type Message struct  {\n    Code int `json:\"cc\"`\n    Range *Range `json:\"vvv,omitempty\"`\n    User *User `json:\"fff,omitempty\"`\n}\n</code></pre>\n\n<p>then given code == x, use range, if Y, use User.</p>\n"}, {"comments": [{"owner": {"reputation": 831, "user_id": 3023734, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c3549d5a62905af4f11d877205699f90?s=128&d=identicon&r=PG&f=1", "display_name": "ma77c", "link": "https://stackoverflow.com/users/3023734/ma77c"}, "edited": false, "score": 0, "creation_date": 1503785392, "post_id": 45897737, "comment_id": 78759100, "body": "This is exactly what I am looking for"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 1, "last_activity_date": 1503766819, "creation_date": 1503766819, "answer_id": 45897737, "question_id": 45896930, "link": "https://stackoverflow.com/questions/45896930/golang-unmarshalling-arbitrary-data/45897737#45897737", "title": "golang | unmarshalling arbitrary data", "body": "<p>You can unmarshall bottom half in json.RawMessage first, something like</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Message struct {\n    Code    int\n    Payload json.RawMessage // delay parsing until we know the code\n}\ntype Range struct {\n    Start int\n    End   int\n}\ntype User struct {\n    ID   int\n    Pass int\n}\n\nfunc MyUnmarshall(m []byte) {\n    var message Message\n    var payload interface{}\n    json.Unmarshal(m, &amp;message) // delay parsing until we know the color space\n    switch message.Code {\n    case 3:\n        payload = new(User)\n    case 4:\n        payload = new(Range)\n    }\n    json.Unmarshal(message.Payload, payload) //err check ommited for readability\n    fmt.Printf(\"\\n%v%+v\", message.Code, payload) //do something with data\n}\n\nfunc main() {\n    json := []byte(`{\"Code\": 4, \"Payload\": {\"Start\": 1, \"End\": 10}}`)\n    MyUnmarshall(json)\n    json = []byte(`{\"Code\": 3, \"Payload\": {\"ID\": 1, \"Pass\": 1234}}`)\n    MyUnmarshall(json)\n}\n</code></pre>\n"}], "owner": {"reputation": 831, "user_id": 3023734, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c3549d5a62905af4f11d877205699f90?s=128&d=identicon&r=PG&f=1", "display_name": "ma77c", "link": "https://stackoverflow.com/users/3023734/ma77c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 356, "favorite_count": 0, "accepted_answer_id": 45897737, "answer_count": 2, "score": 0, "last_activity_date": 1503933426, "creation_date": 1503760891, "last_edit_date": 1503933426, "question_id": 45896930, "link": "https://stackoverflow.com/questions/45896930/golang-unmarshalling-arbitrary-data", "title": "golang | unmarshalling arbitrary data", "body": "<p><strong>QUESTION</strong></p>\n\n<p>Is there a way to marshall JSON data in such a way that it can be unmarshalled in parts / sections? </p>\n\n<p>Let's say that the top half of data is a \"code\" which would signal what to do with the bottom half ... such as unmarshall the bottom half into a specific struct depending on the \"code\".</p>\n\n<hr>\n\n<p>There are two structs that may be sent as the bottom half ...</p>\n\n<pre><code>type Range Struct {\n    Start int\n    End   int\n\n}\n\ntype User struct {\n    ID    int\n    Pass  int\n}\n</code></pre>\n\n<p><strong>PSEUDO CODE EXAMPLE</strong></p>\n\n<p>It may look like this ...</p>\n\n<pre><code>message := &amp;Message{\n    Code: 4,\n    &amp;Range {\n        Start: 1,\n        End: 10,\n    }\n}\n</code></pre>\n\n<p>Itt may look like this ...</p>\n\n<pre><code>message := &amp;Message{\n    Code: 3,\n    &amp;User {\n        ID: 1,\n        Pass: 1234,\n    }\n}\n</code></pre>\n\n<p>So, when unmarshalling that data I could ...</p>\n\n<pre><code>// get code from top half\nm := Message{}\nerr = json.UnMarshallTopHalf(byteArray, &amp;m)\nif m.Code == 4 {\n    // ok, the code was four, lets unmarshall into type Range\n    r := Range{}\n    json.UnmarshalBottomHalf(byteArray, &amp;r)\n}\n</code></pre>\n\n<p>I have looked at <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">JSON &amp; Go</a> to learn how to marshall and unmarshall defined structs. I can do this, but I cannot figure out a way for arbitrary data as in the example above ...</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1503763972, "creation_date": 1503763972, "answer_id": 45897360, "question_id": 45896910, "link": "https://stackoverflow.com/questions/45896910/split-string-while-keeping-separators/45897360#45897360", "title": "split string while keeping separators", "body": "<p>use <a href=\"https://golang.org/pkg/regexp/#Regexp.FindAllString\" rel=\"nofollow noreferrer\">FindAllString</a>  </p>\n\n<pre><code>  regexp.MustCompile(`[-+\\?=]?([0-9]|x)`).FindAllString(\"x+5-3+x=6+x-2\", -1)\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 8516253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1210a44899833f6abfc9a106ce2d78ae?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/8516253/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 45897360, "answer_count": 1, "score": 1, "last_activity_date": 1503763972, "creation_date": 1503760759, "question_id": 45896910, "link": "https://stackoverflow.com/questions/45896910/split-string-while-keeping-separators", "title": "split string while keeping separators", "body": "<p>any way I can split this string <code>x+5-3+x=6+x-2</code> while keeping the separators, I tried regex split on <code>[\\+\\-]</code> but this gives me, <code>x, 5, 3, ...</code> and I need <code>x, +5, -3, +x</code> using <code>(?=[-+])</code> as in Java doesn't work.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["jquery", "go", "fullcalendar", "smarty"], "answers": [{"comments": [{"owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1503760689, "post_id": 45896783, "comment_id": 78752529, "body": "Excellent @mkopriva, I just have one small issue, with above code I end up adding additional COMMA at the end. Do you know how can I identify whether last element during iteration, so that I will not add that COMMA and everything will be great?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1503761370, "post_id": 45896783, "comment_id": 78752741, "body": "@NikhilJoshi One way is to use a custom template function like here <a href=\"https://stackoverflow.com/questions/22367337/last-item-in-a-golang-template-range\" title=\"last item in a golang template range\">stackoverflow.com/questions/22367337/&hellip;</a> mainly this example <a href=\"https://play.golang.org/p/V94BPN0uKD\" rel=\"nofollow noreferrer\">play.golang.org/p/V94BPN0uKD</a>. Or you can, in Go, construct the school slice as a <code>[]map[string]interface{}</code> where the keys are fromatted the same as they need to be in the js calendar and then just drop that in as is, without <code>range</code> and Go template will create a js array of objects from that slice of maps..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1503761410, "post_id": 45896783, "comment_id": 78752749, "body": "... maybe that&#39;s what @mh-cbon was trying to point out, who knows. Anyway here&#39;s an example: <a href=\"https://play.golang.org/p/z-Pqnce_bq\" rel=\"nofollow noreferrer\">play.golang.org/p/z-Pqnce_bq</a>"}, {"owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1503761864, "post_id": 45896783, "comment_id": 78752887, "body": "You are doing it in GO file, but mine is &quot;print.tpl&quot; file, see UPDATE in the original post. Sorry but I am a newbie in these languages, please suggest how can I get rid of the last COMMA inside &quot;print.tpl&quot; file?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1503762347, "post_id": 45896783, "comment_id": 78753042, "body": "@mkopriva when a value is printed within a script tag, it automatically prints json. so you just put <code>var ...</code> in front of it to consume it in the js. assuming $.Schools is an array of map/struct, <code>var event = {{$.Schools}}</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1503763398, "post_id": 45896783, "comment_id": 78753335, "body": "@NikhilJoshi If you&#39;re using the <code>html&#47;template</code> package to render the <code>print.tpl</code> file you should be able to do all of the things in the provided examples, it doesn&#39;t matter if the file extension is <code>.go</code>, <code>.tpl</code>, <code>.tmpl</code>, <code>.html</code>, <code>.js</code> or what have you. If you&#39;re using some other package to render the file, then you should mention that and provide a link to it in the original question."}, {"owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1503763683, "post_id": 45896783, "comment_id": 78753416, "body": "I am using &quot;.tpl&quot; extension, but you saved me, thanks a lot, accepting your answer!"}, {"owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "edited": false, "score": 0, "creation_date": 1592767355, "post_id": 45896783, "comment_id": 110536015, "body": "Just for the record, <a href=\"https://www.smarty.net/\" rel=\"nofollow noreferrer\">Smarty</a> is a famous PHP templating system, dating from the turn of the century and still being under continuous development &amp; maintenance, which is well-known for being super-fast. The forum software phpBB used to be based on Smarty templates, and, to an extent, so does Go \u2014 it&#39;s definitely <i>inspired</i> on Smarty, even though, because of the differences between Go and PHP, Go templates are quite different. I assume that the OP mentioned &#39;smarty&#39; because he&#39;s familiar with <code>.tpl</code> files used by Smarty."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1503760005, "creation_date": 1503760005, "answer_id": 45896783, "question_id": 45896605, "link": "https://stackoverflow.com/questions/45896605/golang-jquery-smarty-how-to-iterate-over-object/45896783#45896783", "title": "Golang + JQuery + Smarty: How to iterate over object?", "body": "<p>Go templates support js and css and the evaluation of <em>actions</em> (<code>{{ ... }}</code>) is contextual so you can iterate over schools in js the same as you do in html. Although I have no idea what smarty is, so if this isn't working you need to check smarty's documentation.</p>\n\n<pre><code>events: [\n    {{range $.Schools}}\n    {\n        title: {{.Course}},\n        start: {{.Duration}}\n    },\n    {{end}}\n]\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/LBDBAMY4cL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LBDBAMY4cL</a></p>\n"}], "owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 45896783, "answer_count": 1, "score": 0, "last_activity_date": 1503761738, "creation_date": 1503758629, "last_edit_date": 1503761738, "question_id": 45896605, "link": "https://stackoverflow.com/questions/45896605/golang-jquery-smarty-how-to-iterate-over-object", "title": "Golang + JQuery + Smarty: How to iterate over object?", "body": "<p>Golang server is sending <code>schools</code> object to <code>print.tpl</code> smarty file like: <code>tplData[\"Schools\"] = schools</code></p>\n\n<p>In <code>print.tpl</code> file, I am able to print it using below:</p>\n\n<pre><code>{{range $.Schools}}\n    {{.Course}} --  {{.Duration}}\n{{end}}\n</code></pre>\n\n<p>In <code>print.tpl</code> file, I need to use <a href=\"https://fullcalendar.io\" rel=\"nofollow noreferrer\">https://fullcalendar.io</a> JQuery component and it works fine with static data like below:</p>\n\n<pre><code>&lt;script&gt;\n    $(document).ready(function() {\n         $('#calendar').fullCalendar({             \n             header: {\n                 left: 'prev,next today myCustomButton',\n                 center: 'title',\n                 right: 'month,agendaWeek,agendaDay,listMonth'\n             },\n             events: [\n                  {\n                      title  : 'event1',\n                      start  : '2017-08-01'\n                  }\n              ]\n         });\n    });\n&lt;/script&gt;\n</code></pre>\n\n<p><strong>Question</strong>: How can I iterate <code>$.Schools</code> object in my JQuery function?</p>\n\n<p><strong>Note</strong>: Hosting REST in Golang and calling in JQuery is an option, but I don't want to go that route.</p>\n\n<hr>\n\n<p><strong>Update</strong>: New enhanced code as per @mkopriva brilliant answer:</p>\n\n<pre><code>&lt;script&gt;\n        $(document).ready(function() {\n             $('#calendar').fullCalendar({             \n                 header: {\n                     left: 'prev,next today myCustomButton',\n                     center: 'title',\n                     right: 'month,agendaWeek,agendaDay,listMonth'\n                 },\n                 events: [\n                      {{range $.Schools}}\n                      {\n                        title  : {{.Course}},\n                        start  : {{.Duration}}\n                      },\n                  {{end}}\n                  ]\n             });\n        });\n    &lt;/script&gt;\n</code></pre>\n"}, {"tags": ["go", "concurrency"], "answers": [{"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 1, "last_activity_date": 1503761530, "last_edit_date": 1503761530, "creation_date": 1503761051, "answer_id": 45896950, "question_id": 45894997, "link": "https://stackoverflow.com/questions/45894997/does-waitgroup-wait-imply-memory-barrier-in-this-case/45896950#45896950", "title": "Does WaitGroup.Wait() imply memory barrier in this case?", "body": "<p>Well, it is absolutely safe to check <code>condition</code> after <code>wg.Wait()</code>, <strong>but</strong> you should protect <code>condition</code>  with a mutex to avoid it being \"written to\" simultaneously by multiple go routines. That's why @peterSO is hitting a race condition b'cos at line 20 in his code which is setting <code>condition = true</code> multiple go routines are trying to set <code>condition</code> at the same time. Here's a sample <a href=\"https://play.golang.org/p/o3v6s_2qsY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/o3v6s_2qsY</a> with 20k go rountines. </p>\n\n<p>As a best practice I recommend, one adds <code>defer wg.Done()</code> right in the beginning of the go routine function, so that even if there are return statements in between, <code>wg.Done()</code> still gets called.</p>\n"}, {"tags": [], "owner": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "is_accepted": false, "score": 2, "last_activity_date": 1504798817, "last_edit_date": 1504798817, "creation_date": 1503991984, "answer_id": 45933248, "question_id": 45894997, "link": "https://stackoverflow.com/questions/45894997/does-waitgroup-wait-imply-memory-barrier-in-this-case/45933248#45933248", "title": "Does WaitGroup.Wait() imply memory barrier in this case?", "body": "<p>Yes. There is happens-before relationship between <code>wg.Wait()</code> and <code>wg.Done()</code>. This simple fact is for whatever reason not mentioned in doc or go MM <a href=\"https://github.com/golang/go/issues/7948\" rel=\"nofollow noreferrer\">#7948</a>. Thanks Ian Lance Taylor for clarifying it <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/5oHzhzXCcmM\" rel=\"nofollow noreferrer\">golang-nuts/5oHzhzXCcmM</a>. About the race condition you can read more in the same thread.</p>\n\n<p>A bit disappointing that in a language that calls itself concurrent one has to rely on a 'good word' to do the basic stuff (right). </p>\n"}], "owner": {"reputation": 1734, "user_id": 271996, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/MuIHF.jpg?s=128&g=1", "display_name": "honzajde", "link": "https://stackoverflow.com/users/271996/honzajde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 492, "favorite_count": 3, "answer_count": 2, "score": 4, "last_activity_date": 1504798817, "creation_date": 1503747965, "last_edit_date": 1503855656, "question_id": 45894997, "link": "https://stackoverflow.com/questions/45894997/does-waitgroup-wait-imply-memory-barrier-in-this-case", "title": "Does WaitGroup.Wait() imply memory barrier in this case?", "body": "<pre><code>var condition bool\nvar wg sync.WaitGroup\nfor _, item := range items {\n    wg.Add(1)\n    go func(item) {\n        if meetsCondition(item) {\n            condition = true\n        }\n        wg.Done()\n    }(item)\n}\nwg.Wait()\n// is it safe to check condition here?\n</code></pre>\n\n<p>There is a discussion of this question at the old go forum here:\n<a href=\"https://groups.google.com/forum/#!topic/golang-nuts/5oHzhzXCcmM\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!topic/golang-nuts/5oHzhzXCcmM</a> The answer there was yes, it is safe. Then the discussion digress to use of atomic, etc., which is not what I want to ask about.</p>\n\n<p>There is not even one mention of WaitGroup in the spec and it's documentation is saying  WaitGroup.Wait: \"Wait blocks until the WaitGroup counter is zero.\" which does \nnot set any happens-before relationship (or does it?). </p>\n\n<p>Does it mean that the first answer \"It is safe to check condition after wg.Wait returns\" is unofficial? If it's official what are the reasons for it I am missing? Thanks alot if you answer.</p>\n\n<p><strong>Update:</strong>\nThis is update after @peterSO's @ravi's answers. Thanks.</p>\n\n<p>Well, obviously there can be a race condition if you choose number of items > 1. Hint: condition can be set only to true. Still, I have the same question. </p>\n\n<p>And probably, I should have stated that: </p>\n\n<ol>\n<li>underlying architectures can be only x86, x64 or ARM</li>\n<li>number of items can be 1</li>\n</ol>\n\n<p><strong>Update 2</strong>\nI created followup question for the case when number of items == 1 here:\n<a href=\"https://stackoverflow.com/questions/45907588/can-you-make-this-incorrectly-synchronized-test-fail\">Can you make this &#39;incorrectly synchronized&#39; test fail?</a> </p>\n"}, {"tags": ["git", "docker", "go", "godeps"], "answers": [{"tags": [], "owner": {"reputation": 817, "user_id": 283217, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8a6faf7c379b1fdc940594d7706e48eb?s=128&d=identicon&r=PG", "display_name": "Oleh Herych", "link": "https://stackoverflow.com/users/283217/oleh-herych"}, "is_accepted": false, "score": 0, "last_activity_date": 1503847704, "creation_date": 1503847704, "answer_id": 45906563, "question_id": 45894917, "link": "https://stackoverflow.com/questions/45894917/dep-xxx-restored-but-was-unable-to-load-it-with-error-package-xxx-not-found/45906563#45906563", "title": "Dep xxx restored, but was unable to load it with error: Package xxx not found", "body": "<p>Looks like you don't have setup GOPATH inside Docker container</p>\n"}], "owner": {"reputation": 9868, "user_id": 6077803, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1a7abebd7e0f177743b3a9c2e7070ffc?s=128&d=identicon&r=PG&f=1", "display_name": "DenCowboy", "link": "https://stackoverflow.com/users/6077803/dencowboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 318, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505326266, "creation_date": 1503747397, "last_edit_date": 1505326266, "question_id": 45894917, "link": "https://stackoverflow.com/questions/45894917/dep-xxx-restored-but-was-unable-to-load-it-with-error-package-xxx-not-found", "title": "Dep xxx restored, but was unable to load it with error: Package xxx not found", "body": "<p>I have a golang app inside <code>my-app</code> (cloned git repo). The folder myapp is on the same place as my Dockerfile. I copy my project in it.\nHere is my dockerfile:</p>\n\n<pre><code>FROM golang:1.7\nRUN go get github.com/tools/godep\nADD priv/.netrc /root/.netrc\n\nWORKDIR /go/src/my-app\nADD ./my-app .\n\nRUN godep restore -v\n</code></pre>\n\n<p>Now the godep restore -v is failing.\nA lot of repo's are restored well, some are skipped:</p>\n\n<pre><code>godep: Restoring dependency ..\ngodep: Restoring dependency (if needed): github.com/xxx\ngodep: Skipping already restored repo\n</code></pre>\n\n<p>It works all fine till the moment it need to restore dependencies which are inside the <code>my-app</code> repo?</p>\n\n<pre><code>godep: Dep (github.com/otherrepo/random/random) restored, but was unable to load it with error:\n    Package (github.com/my-name/my-app/subpath)  not found\n</code></pre>\n\n<p>The path exist (on every branch). \nWhen I <code>cd</code> inside my-app I can see the <code>subpath</code> folder and I can also visit it on github: </p>\n\n<pre><code>https://github.com/my-name/my-repo/tree/branch/subpath\n</code></pre>\n\n<p>What am I missing or what is going wrong?</p>\n"}, {"tags": ["go", "websocket"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1503723178, "creation_date": 1503723178, "answer_id": 45892056, "question_id": 45891799, "link": "https://stackoverflow.com/questions/45891799/cannot-use-ccc-type-int-as-type-websocket-conn-in-argument-to-websocket-messa/45892056#45892056", "title": "cannot use ccc (type int) as type *websocket.Conn in argument to websocket.Message.Send", "body": "<p>Not sure what you're trying to do with <code>lll</code> but without using it your code should not event compile.</p>\n\n<hr>\n\n<p>When <code>range</code>ing over slices/arrays with a <em>single iteration variable</em> on the left of <code>:=</code> it will be assigned the index of the iteration. So in your case <code>ccc</code> is the index.</p>\n\n<p>One thing you can do is:</p>\n\n<pre><code>for ccc := range connections {\n    websocket.Message.Send(connections[ccc], \"Another connection!!!\")\n}\n</code></pre>\n\n<p>But what you probably really want is, drop the index and get the element right away which you can do using two iteration variables with the <code>_</code> as the first one if you don't inted to use the index at all.</p>\n\n<pre><code>for _, ccc := range connections {\n    websocket.Message.Send(ccc, \"Another connection!!!\")\n}\n</code></pre>\n\n<p>read more here: <a href=\"https://golang.org/ref/spec#For_range\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#For_range</a></p>\n"}], "owner": {"reputation": 15582, "user_id": 1420625, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wJ6T0.png?s=128&g=1", "display_name": "sensorario", "link": "https://stackoverflow.com/users/1420625/sensorario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 45892056, "answer_count": 1, "score": 2, "last_activity_date": 1503723178, "creation_date": 1503719933, "question_id": 45891799, "link": "https://stackoverflow.com/questions/45891799/cannot-use-ccc-type-int-as-type-websocket-conn-in-argument-to-websocket-messa", "title": "cannot use ccc (type int) as type *websocket.Conn in argument to websocket.Message.Send", "body": "<p>I am trying to send a broadcast message to clients using websockets. How to fix this code to send message properly to all clients and without that error?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"golang.org/x/net/websocket\"\n    \"net/http\"\n)\n\nvar connections []websocket.Conn\n\nfunc main() {\n    fmt.Println(\"vim-go\")\n    http.Handle(\"/\", websocket.Handler(Server))\n    err := http.ListenAndServe(\":8888\", nil)\n    if err != nil {\n        panic(\"ListenAndServe: \" + err.Error())\n    }\n}\n\nfunc Server(ws *websocket.Conn) {\n    lll := append(connections, *ws)\n    var message string\n    websocket.Message.Receive(ws, &amp;message)\n    fmt.Println(message)\n    for ccc := range connections {\n        websocket.Message.Send(ccc, \"Another connection!!!\")\n    }\n}\n</code></pre>\n"}, {"tags": ["http", "go", "synchronization"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": false, "score": 0, "last_activity_date": 1503732613, "creation_date": 1503732613, "answer_id": 45893030, "question_id": 45891769, "link": "https://stackoverflow.com/questions/45891769/is-it-safe-to-use-sync-pool-reference-as-context-value/45893030#45893030", "title": "Is it safe to use sync.Pool reference as context value?", "body": "<p>There are three points to make:</p>\n\n<h1>Usage of sync.Pool</h1>\n\n<p>Your usage of pool is as intended. From <a href=\"https://golang.org/pkg/sync/#Pool\" rel=\"nofollow noreferrer\">golang Documentation</a> </p>\n\n<blockquote>\n  <p>A Pool is safe for use by multiple goroutines simultaneously.</p>\n</blockquote>\n\n<h1>Retrieving users</h1>\n\n<p><code>getUser</code> uses <code>func (p *Pool) Get() interface{}</code> which removes the returned item from the pool, afterwards you can do whatever you please \nwith that value. In your case, thats a <code>*User</code>. Whether the associated\nressource is safe to use, well, depends on your usage of those values in the rest of the program.</p>\n\n<h1>Recycling users</h1>\n\n<p>Calling <code>recycleUser</code> within the hander is potentially dangerous, depending on your environment.</p>\n\n<p>What could possibly go wrong?</p>\n\n<p>After <code>recycleUser</code> returned your <code>*User</code> back to the pool, it could be retrieved and used by a different goroutine immediately. But at the same time, <code>*User</code> is still stored in the context assiociated with the request. So it depends if any of the functions of your middleware use the <code>*User</code> from the context, too and wether they store the <code>*User</code> value. Or if you later add some code after the <code>recycleUser</code>, which uses the <code>*User</code> value. After the <code>recycleUser</code> call, all those usages probably operate on the wrong user, which is already used by some different request.</p>\n\n<h1>How to solve those issues</h1>\n\n<ol>\n<li><p>coding convention</p>\n\n<ul>\n<li>if you retrieve the user in middleware functions, don't store it</li>\n<li>if you retrieve the user in middleware functions, don't use it after the call to the next handler in the chain.</li>\n<li>don't call <code>recycleUser</code> in middleware functions</li>\n<li>retrieve the user in the leaf handler (last handler in the chain, doesn't calls any further handlers propagating the context and thus the <code>*User</code>) and use <code>defer recycleUser(user)</code> to put back the <code>*User</code> in the pool and make it impossible that later added code uses <code>*User</code> after the call to <code>recycleUser(user)</code>.</li>\n<li>in the leaf handler, don't use <code>*User</code> in code which is called by some <code>defer</code> usage in the leaf handler, other than <code>recycleUser</code>.</li>\n</ul></li>\n<li><p>ensuring the coding convention by technical means. My only idea here would be to place the <code>*User</code> inside some struct and only use that struct for one request and mark it as empty, once <code>*User</code> is put back into the pool. Make all access methods of that struct check for emptyness and panic/log/whatever, if an empty struct is accessed. Place a pointer to that struct in the context. But that is probably pointless, as you now allocate that struct for each request, instead of a <code>User</code>, which probably was, what you tried to avoid.</p></li>\n</ol>\n\n<h1>A minor remark</h1>\n\n<p>You probably meant your middleware function to read like:</p>\n\n<pre><code>func middleware(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        // get user from pool\n        user := getUser()\n        // user must be recycled \n        ctx := context.WithValue(r.Context(), \"user\", user)\n        // probably do something more\n        next(w, r.WithContext(ctx))\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 375, "user_id": 7586020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7579bdcac485b4049acfbd184604219?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7586020/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 417, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1503767805, "creation_date": 1503719469, "last_edit_date": 1503767805, "question_id": 45891769, "link": "https://stackoverflow.com/questions/45891769/is-it-safe-to-use-sync-pool-reference-as-context-value", "title": "Is it safe to use sync.Pool reference as context value?", "body": "<p>I have struct that uses <code>sync.Pool</code>.</p>\n\n<p>Is it safe to use this reference as context value?</p>\n\n<pre><code>type User struct {\n    ID string\n}\n\nvar userPool = sync.Pool{\n    New: func() interface{} {\n        return &amp;User{}\n    },\n}\n\nfunc getUser() *User {\n    return userPool.Get().(*User)\n}\n\nfunc recycleUser(user *User) {\n    userPool.Put(user)\n}\n</code></pre>\n\n<p>The user struct is retrieved from pool in middleware.</p>\n\n<pre><code>func middleware(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        // get user from pool\n        user := getUser()\n        // user must be recycled \n        ctx := context.WithValue(r.Context(), \"user\", user)\n    }\n}\n</code></pre>\n\n<p>And recycled in handler.</p>\n\n<pre><code>func getUser(w http.ResponseWriter, r *http.Request) {\n    user := r.Context().Value(\"user\").(*User)\n\n    // TODO: do something with user\n\n    // put user struct back into pool\n    recycleUser(user)\n}\n</code></pre>\n\n<p>Edit: </p>\n\n<p>My question is more about how context deals with pointer to my object. Does it make a copy? Is it safe to use non-primitive object with context?</p>\n"}, {"tags": ["string", "go", "type-conversion"], "comments": [{"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 3, "creation_date": 1503727568, "post_id": 45891600, "comment_id": 78744032, "body": "Creating a type that&#39;s just a string is not all that bizarre. For example, if a you know that certain string is always a country name you could create a <code>type Country string</code>; this will make the code easier to read."}, {"owner": {"reputation": 2136, "user_id": 1654226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91e57d0a853efdd8ade9241a1a44b141?s=128&d=identicon&r=PG", "display_name": "squgeim", "link": "https://stackoverflow.com/users/1654226/squgeim"}, "reply_to_user": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 0, "creation_date": 1541321935, "post_id": 45891600, "comment_id": 93170495, "body": "@Akavall How about restricting <code>Country</code> type to a known list of values? Can we do that?"}], "answers": [{"comments": [{"owner": {"reputation": 880, "user_id": 6632214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7a11555b6759a1bd6c0205720f6dda?s=128&d=identicon&r=PG", "display_name": "TheDiveO", "link": "https://stackoverflow.com/users/6632214/thediveo"}, "edited": false, "score": 0, "creation_date": 1558702632, "post_id": 45891610, "comment_id": 99198688, "body": "Very useful if one hasn&#39;t control over the string type-alias; in those sitations adding a <code>String</code> method is impossible."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 42, "last_activity_date": 1503717454, "creation_date": 1503717454, "answer_id": 45891610, "question_id": 45891600, "link": "https://stackoverflow.com/questions/45891600/converting-a-custom-type-to-string-in-go/45891610#45891610", "title": "Converting a custom type to string in Go", "body": "<p><a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">Convert</a> the value to a string:</p>\n\n<pre><code>func SomeFunction() string {\n        return string(Foobar)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 16, "last_activity_date": 1503740189, "last_edit_date": 1503740189, "creation_date": 1503727961, "answer_id": 45892486, "question_id": 45891600, "link": "https://stackoverflow.com/questions/45891600/converting-a-custom-type-to-string-in-go/45892486#45892486", "title": "Converting a custom type to string in Go", "body": "<p>Better to define a <code>String</code> function for the <code>Customtype</code> - it can make your life easier over time - you have better control over things as and if the structure evolves. If you really need <code>SomeFunction</code> then let it return <code>Foobar.String()</code></p>\n\n<pre><code>   package main\n\n    import (\n        \"fmt\"\n    )\n\n    type CustomType string\n\n    const (\n        Foobar CustomType = \"somestring\"\n    )\n\n    func main() {\n        fmt.Println(\"Hello, playground\", Foobar)\n        fmt.Printf(\"%s\", Foobar)\n        fmt.Println(\"\\n\\n\")\n        fmt.Println(SomeFunction())\n    }\n\n    func (c CustomType) String() string {\n        fmt.Println(\"Executing String() for CustomType!\")\n        return string(c)\n    }\n\n    func SomeFunction() string {\n        return Foobar.String()\n    }\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/jMKMcQjQj3\" rel=\"noreferrer\">https://play.golang.org/p/jMKMcQjQj3</a></p>\n"}, {"tags": [], "owner": {"reputation": 1104, "user_id": 6438430, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VRc3dZXdns/AAAAAAAAAAI/AAAAAAAAAeI/nemPXRtg3JU/photo.jpg?sz=128", "display_name": "Ashish Tiwari", "link": "https://stackoverflow.com/users/6438430/ashish-tiwari"}, "is_accepted": false, "score": 2, "last_activity_date": 1503729485, "creation_date": 1503729485, "answer_id": 45892641, "question_id": 45891600, "link": "https://stackoverflow.com/questions/45891600/converting-a-custom-type-to-string-in-go/45892641#45892641", "title": "Converting a custom type to string in Go", "body": "<p>You can convert like this:</p>\n\n<p><code>var i int = 42\nvar f float64 = float64(i)</code></p>\n\n<p>check <a href=\"https://tour.golang.org/basics/13\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>you can return like this:</p>\n\n<p><code>return string(Foobar)</code></p>\n"}, {"tags": [], "owner": {"reputation": 3868, "user_id": 2295484, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BAohf.png?s=128&g=1", "display_name": "Krishnadas PC", "link": "https://stackoverflow.com/users/2295484/krishnadas-pc"}, "is_accepted": false, "score": 3, "last_activity_date": 1549647092, "creation_date": 1549647092, "answer_id": 54597531, "question_id": 45891600, "link": "https://stackoverflow.com/questions/45891600/converting-a-custom-type-to-string-in-go/54597531#54597531", "title": "Converting a custom type to string in Go", "body": "<blockquote>\n  <p>For every type T, there is a corresponding conversion operation T(x)\n  that converts the value x to type T. A conversion from one type to\n  another is allowed if both have the same underlying type, or if both\n  are unnamed pointer types that point to variables of the same\n  underlying type; these conversions change the type but not the\n  representation of the value. If x is assignable to T, a conversion\n  is permitted but is usually redundant.  - Taken from <a href=\"https://www.amazon.com/Programming-Language-Addison-Wesley-Professional-Computing/product-reviews/0134190440/ref=cm_cr_getr_d_paging_btm_next_4?ie=UTF8&amp;reviewerType=all_reviews&amp;pageNumber=4\" rel=\"nofollow noreferrer\">The Go\n  Programming Language - by Alan A. A. Donovan</a></p>\n</blockquote>\n\n<p>As per your example here are some of the different examples which will return the value.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype CustomType string\n\nconst (\n    Foobar CustomType = \"somestring\"\n)\n\nfunc SomeFunction() CustomType {\n    return Foobar\n}\nfunc SomeOtherFunction() string {\n    return string(Foobar)\n}\nfunc SomeOtherFunction2() CustomType {\n    return CustomType(\"somestring\") // Here value is a static string.\n}\nfunc main() {\n    fmt.Println(SomeFunction())\n    fmt.Println(SomeOtherFunction())\n    fmt.Println(SomeOtherFunction2())\n}\n</code></pre>\n\n<p>It will output:</p>\n\n<pre><code>somestring\nsomestring\nsomestring\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/v6fvjlb1DKS\" rel=\"nofollow noreferrer\">The Go Playground link</a></p>\n"}], "owner": {"reputation": 910, "user_id": 774909, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4396a8df0321f019a5eef1595f881373?s=128&d=identicon&r=PG", "display_name": "DaveUK", "link": "https://stackoverflow.com/users/774909/daveuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56979, "favorite_count": 7, "accepted_answer_id": 45891610, "answer_count": 4, "score": 31, "last_activity_date": 1591999864, "creation_date": 1503717310, "last_edit_date": 1528047236, "question_id": 45891600, "link": "https://stackoverflow.com/questions/45891600/converting-a-custom-type-to-string-in-go", "title": "Converting a custom type to string in Go", "body": "<p>In this bizarre example, someone has created a new type which is really just a string: </p>\n\n<pre><code>type CustomType string\n\nconst (\n        Foobar CustomType = \"somestring\"\n)\n\nfunc SomeFunction() string {\n        return Foobar\n}\n</code></pre>\n\n<p>However, this code fails to compile:</p>\n\n<blockquote>\n  <p>cannot use Foobar (type CustomType) as type string in return argument</p>\n</blockquote>\n\n<p>How would you fix SomeFunction so that it is able to return the string value of Foobar (\"somestring\") ?</p>\n"}, {"tags": ["mysql", "heroku", "go", "web-deployment"], "comments": [{"owner": {"reputation": 817, "user_id": 283217, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8a6faf7c379b1fdc940594d7706e48eb?s=128&d=identicon&r=PG", "display_name": "Oleh Herych", "link": "https://stackoverflow.com/users/283217/oleh-herych"}, "edited": false, "score": 0, "creation_date": 1503848118, "post_id": 45890979, "comment_id": 78771597, "body": "<a href=\"https://stackoverflow.com/questions/15191259/how-to-deploy-local-mysql-database-to-heroku\" title=\"how to deploy local mysql database to heroku\">stackoverflow.com/questions/15191259/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 8647329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08fc994c9c5e13f3f418e3d339645060?s=128&d=identicon&r=PG&f=1", "display_name": "Bynov", "link": "https://stackoverflow.com/users/8647329/bynov"}, "is_accepted": false, "score": 1, "last_activity_date": 1505983458, "creation_date": 1505983458, "answer_id": 46339303, "question_id": 45890979, "link": "https://stackoverflow.com/questions/45890979/how-to-deploy-go-server-on-heroku-with-a-mysql-database/46339303#46339303", "title": "How to deploy Go server on Heroku with a MySQL database?", "body": "<p>To fix this problem you need to use some of vendoring tools - e.g. Godep, dep etc.\nHeroku can't deploy golang app without 'vendor' folder</p>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 7853228, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Yk4zVMr8kxU/AAAAAAAAAAI/AAAAAAAAAEE/mVCZkdZoqso/photo.jpg?sz=128", "display_name": "Fath", "link": "https://stackoverflow.com/users/7853228/fath"}, "is_accepted": false, "score": 0, "last_activity_date": 1605145502, "creation_date": 1605145502, "answer_id": 64796732, "question_id": 45890979, "link": "https://stackoverflow.com/questions/45890979/how-to-deploy-go-server-on-heroku-with-a-mysql-database/64796732#64796732", "title": "How to deploy Go server on Heroku with a MySQL database?", "body": "<p>just run this command:</p>\n<pre><code>go mod init [app-name]\n</code></pre>\n<p>this will create a go mod file and a go sum for you\nthen run:</p>\n<pre><code>go get\n</code></pre>\n<p>to install those packages you called in your go app.\ndevelopers usually use go mod init github.com/name/repo\nbut go mod init [app-name]\nwill do the job!</p>\n"}], "owner": {"reputation": 11, "user_id": 8519008, "user_type": "registered", "profile_image": "https://graph.facebook.com/1588500421210644/picture?type=large", "display_name": "Minjun Seong", "link": "https://stackoverflow.com/users/8519008/minjun-seong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 489, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1605145502, "creation_date": 1503708778, "last_edit_date": 1503751960, "question_id": 45890979, "link": "https://stackoverflow.com/questions/45890979/how-to-deploy-go-server-on-heroku-with-a-mysql-database", "title": "How to deploy Go server on Heroku with a MySQL database?", "body": "<p>I am a complete beginner at hosting applications right now but am trying to get a hold of it.\n- I have the MySQL database running locally on my PC. How to exactly should I host it somewhere online.\n- When I tried to deploy my Go server on Heroku, I got the following error and couldn't find a solution for it anywhere online.</p>\n\n<p><code>\n-----&gt; App not compatible with buildpack: https://codon-buildpacks.s3.amazonaws.com/buildpacks/heroku/go.tgz\n       More info: https://devcenter.heroku.com/articles/buildpacks#detection-failure\n !     Push failed\n</code></p>\n\n<p>Any help in this regard would be appreciated!</p>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "edited": false, "score": 0, "creation_date": 1503705833, "post_id": 45890716, "comment_id": 78741071, "body": "Actually, found some of my coworker&#39;s code that&#39;s solving this problem with <a href=\"http://github.com/mitchellh/mapstructure\" rel=\"nofollow noreferrer\">github.com/mitchellh/mapstructure</a> \u2013 I&#39;ll update this question shortly if I can get that to work."}], "answers": [{"tags": [], "owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "is_accepted": true, "score": 0, "last_activity_date": 1503707514, "creation_date": 1503707514, "answer_id": 45890882, "question_id": 45890716, "link": "https://stackoverflow.com/questions/45890716/whats-the-idiomatic-way-of-parsing-dynamic-yaml-in-go/45890882#45890882", "title": "What&#39;s the idiomatic way of parsing dynamic YAML in Go?", "body": "<p>Here's what I came up with instead. Much more readable.</p>\n\n<pre><code>// Config represents TAXII 2.0 plugin structure\ntype Config struct {\n    DefaultRoot string\n    APIRoots    []model.APIRoot\n}\n\n// Intermediate config for mapstructure\ntype configRaw struct {\n    DefaultRoot string                `mapstructure:\"default\"`\n    APIRoots    map[string]apiRootRaw `mapstructure:\"api_roots\"`\n}\ntype apiRootRaw struct {\n    AuthMethods []string                 `mapstructure:\"auth\"`\n    Collections map[string]collectionRaw `mapstructure:\"collections\"`\n}\ntype collectionRaw struct {\n    Selector          string `mapstructure:\"selector\"`\n    SelectorQueryLang string `mapstructure:\"selector_query_lang\"`\n}\n\nfunc parseTaxiiConfig() error {\n    plg.ConfigMutex.Lock()\n    defer plg.ConfigMutex.Unlock()\n\n    taxiiConfig := plg.ConfigData.Plugins[\"taxii20\"].(map[interface{}]interface{})\n    fmt.Println(taxiiConfig)\n    ConfigData = &amp;Config{}\n    raw := &amp;configRaw{}\n    err := mapstructure.Decode(taxiiConfig, raw)\n    if err != nil {\n        return err\n    }\n\n    ConfigData.DefaultRoot = raw.DefaultRoot\n    ConfigData.APIRoots = make([]model.APIRoot, 0)\n    for name, root := range raw.APIRoots {\n        apiRoot := model.APIRoot{Name: name}\n        apiRoot.AuthMethods = root.AuthMethods\n        apiRoot.Collections = make([]model.Collection, 0)\n        for colName, col := range root.Collections {\n            collection := model.Collection{Name: colName}\n            collection.Selector = col.Selector\n            collection.SelectorQueryLang = col.SelectorQueryLang\n            apiRoot.Collections = append(apiRoot.Collections, collection)\n        }\n        ConfigData.APIRoots = append(ConfigData.APIRoots, apiRoot)\n    }\n\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 45890882, "answer_count": 1, "score": 0, "last_activity_date": 1503707514, "creation_date": 1503705394, "question_id": 45890716, "link": "https://stackoverflow.com/questions/45890716/whats-the-idiomatic-way-of-parsing-dynamic-yaml-in-go", "title": "What&#39;s the idiomatic way of parsing dynamic YAML in Go?", "body": "<p>I have some code for handling a YAML config file that's getting a little out-of-control w/ type assertions and I feel like there must be a better way to do this.</p>\n\n<p>Here's the relevant snippet from my config file:</p>\n\n<pre><code>plugins:\n  taxii20:\n    default: default\n    api_roots:\n      default:\n        auth:\n          - ldap\n          - mutualtls\n        collections:\n          all:\n            selector: g.V().Save(\"&lt;type&gt;\").Save(\"&lt;created&gt;\").All()\n            selector_query_lang: gizmo\n</code></pre>\n\n<p>And here's my parsing code:</p>\n\n<pre><code>func parseTaxiiConfig() {\n    plg.ConfigMutex.Lock()\n    taxiiConfig := plg.ConfigData.Plugins[\"taxii20\"].(map[interface{}]interface{})\n    ConfigData = &amp;Config{}\n    if taxiiConfig[\"default\"] != nil {\n        ConfigData.DefaultRoot = taxiiConfig[\"default\"].(string)\n    }\n    if taxiiConfig[\"api_roots\"] != nil {\n        ConfigData.APIRoots = make([]model.APIRoot, 0)\n        iroots := taxiiConfig[\"api_roots\"].(map[interface{}]interface{})\n        for iname, iroot := range iroots {\n            root := model.APIRoot{Name: iname.(string)}\n            authMethods := iroot.(map[interface{}]interface{})[\"auth\"].([]interface{})\n            root.AuthMethods = make([]string, 0)\n            for _, method := range authMethods {\n                root.AuthMethods = append(root.AuthMethods, method.(string))\n            }\n            collections := iroot.(map[interface{}]interface{})[\"collections\"].(map[interface{}]interface{})\n            root.Collections = make([]model.Collection, 0)\n            for icolName, icollection := range collections {\n                collection := model.Collection{Name: icolName.(string)}\n                collection.Selector = icollection.(map[interface{}]interface{})[\"selector\"].(string)\n                collection.SelectorQueryLang = icollection.(map[interface{}]interface{})[\"selector_query_lang\"].(string)\n                root.Collections = append(root.Collections, collection)\n            }\n            ConfigData.APIRoots = append(ConfigData.APIRoots, root)\n        }\n    }\n    plg.ConfigMutex.Unlock()\n\n    // debug\n    fmt.Println(ConfigData)\n}\n</code></pre>\n\n<p>The code works as intended, but there's just so many type assertions here and I can't shake the feeling that I'm missing a better way.</p>\n\n<p>One possible critical item of note, as the config implies, this is configuration for a Caddy-style plugin system, so the main config parser cannot know ahead of time what the shape of the plugin config will look like. It has to delegate processing of the plugin's portion of the config file to the plugin itself.</p>\n"}, {"tags": ["c++", "c", "go", "segmentation-fault", "taglib"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1503701053, "post_id": 45890244, "comment_id": 78740127, "body": "Is <code>apicBase64.data()</code> nul-terminated?"}, {"owner": {"reputation": 63, "user_id": 1751441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12885e27b0f7be03e5d398d0f4ad3b5c?s=128&d=identicon&r=PG", "display_name": "Stoyvo", "link": "https://stackoverflow.com/users/1751441/stoyvo"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1503701248, "post_id": 45890244, "comment_id": 78740178, "body": "@tkausl How is the best way to identify this? According to TagLib Documentation: frame-&gt;picture(): <a href=\"http://taglib.org/api/classTagLib_1_1ID3v2_1_1AttachedPictureFrame.html#afd21599ba7fa9a237ec5f1f1cad78e24\" rel=\"nofollow noreferrer\">taglib.org/api/&hellip;</a>  ByteVector.data(): <a href=\"http://taglib.org/api/classTagLib_1_1ByteVector.html#a55d40ed1e9b9749e3895c845f1f26901\" rel=\"nofollow noreferrer\">taglib.org/api/&hellip;</a>"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1503701324, "post_id": 45890244, "comment_id": 78740200, "body": "Nul-Terminate it yourself and see if it still crashes."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1503703407, "post_id": 45890244, "comment_id": 78740643, "body": "If it&#39;s not null terminated, how are you supposed to know the length of the string?"}, {"owner": {"reputation": 63, "user_id": 1751441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12885e27b0f7be03e5d398d0f4ad3b5c?s=128&d=identicon&r=PG", "display_name": "Stoyvo", "link": "https://stackoverflow.com/users/1751441/stoyvo"}, "edited": false, "score": 0, "creation_date": 1503715375, "post_id": 45890244, "comment_id": 78742178, "body": "Thanks all, this is the causing issue. I am surprised that only 1/76000 files had this issue, I assumed due to it&#39;s size it was another cause."}], "answers": [{"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 1, "last_activity_date": 1503707625, "creation_date": 1503707625, "answer_id": 45890888, "question_id": 45890244, "link": "https://stackoverflow.com/questions/45890244/golang-cgo-with-large-char-pointer-segserv/45890888#45890888", "title": "Golang CGO with large char pointer - SEGSERV", "body": "<p>The data stored in <code>val</code> is not null-terminated. In your C code, when you make a copy using <code>memcpy</code>, the null terminator is not included. In the C code, change the code to:</p>\n\n<pre><code>// Generate memory for picture data\nchar* val = new char[len+1];\nmemcpy (val, apicBase64.data(), len);\nval[len] = '\\0';\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 1751441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12885e27b0f7be03e5d398d0f4ad3b5c?s=128&d=identicon&r=PG", "display_name": "Stoyvo", "link": "https://stackoverflow.com/users/1751441/stoyvo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "accepted_answer_id": 45890888, "answer_count": 1, "score": 2, "last_activity_date": 1503707625, "creation_date": 1503700753, "question_id": 45890244, "link": "https://stackoverflow.com/questions/45890244/golang-cgo-with-large-char-pointer-segserv", "title": "Golang CGO with large char pointer - SEGSERV", "body": "<p>I have a large amount of data being read from TagLib library and passed to GoLang (mpeg image data).</p>\n\n<p>Here is where data is fetched:</p>\n\n<pre><code>void audiotags_mpeg_artwork(TagLib::MPEG::File *mpegFile, int id) {\n    TagLib::ID3v2::Tag *id3v2 = mpegFile-&gt;ID3v2Tag(false);\n    if (id3v2!=nullptr) {\n        const TagLib::ID3v2::FrameList frameList = id3v2-&gt;frameListMap()[\"APIC\"];\n        for(auto it = frameList.begin(); it != frameList.end(); it++) {\n            TagLib::ID3v2::AttachedPictureFrame * frame = (TagLib::ID3v2::AttachedPictureFrame *)(*it);\n            if (frame!=nullptr &amp;&amp; frame-&gt;size() &gt; 0) {\n                const auto &amp;apicBase64 = frame-&gt;picture().toBase64();\n                auto len = apicBase64.size();\n                if (len &gt; 0) {\n                    // Generate memory for key\n                    char* key = new char[5];\n                    memcpy(key, \"APIC\", 4);\n                    key[4]='\\0';\n\n                    // Generate memory for picture data\n                    char* val = new char[len];\n                    memcpy (val, apicBase64.data(), len);\n\n                    // Send to GoLang\n                    go_map_audiotags(id, key, val);\n\n                    // Free memory\n                    delete[] key;\n                    delete[] val;\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>At this point, go_map_autotags works (I use a similar method for other data). This also works for other picture data, however depending on the size this will crash with:</p>\n\n<blockquote>\n  <p>unexpected fault address 0x766a000</p>\n  \n  <p>fatal error: fault</p>\n  \n  <p>[signal SIGSEGV: segmentation violation code=0x1 addr=0x766a000 pc=0x404530b]</p>\n</blockquote>\n\n<p>Within GoLang, I have the following export:</p>\n\n<pre><code>//export go_map_audiotags\nfunc go_map_audiotags(id C.int, key *C.char, val *C.char) {\n    m := maps[int(id)]\n    k := strings.ToLower(C.GoString(key))\n    log.Println(\"go_map_audiotags k:\", k) // &lt;--- works\n    v := C.GoString(val) // &lt;--- crashes\n    log.Println(\"go_map_audiotags v:\", v) // &lt;--- Does not reach\n    m[k] = v\n}\n</code></pre>\n\n<p>Is there a bette way I should be transporting this data? I assume what's happening is:\n1) The C.char limit be being reached\n2) C++ is, for some reason, recycling the memory before setting v in GoLang</p>\n"}, {"tags": ["go", "kubernetes", "prometheus", "kubernetes-go-client", "prometheus-operator"], "comments": [{"owner": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "edited": false, "score": 0, "creation_date": 1503722421, "post_id": 45889970, "comment_id": 78743093, "body": "Not sure about the operator, never used this one but I manually deployed Prometheus on Kube <a href=\"https://github.com/openshift-demos/resorcerer#launch-prometheus\" rel=\"nofollow noreferrer\">like so</a> (and in case you wonder, you can ignore the OpenShift specific things, that&#39;s just convenience). The biggest help and my permanent reference was indeed the official <a href=\"https://prometheus.io/docs/operating/configuration/#&lt;kubernetes_sd_config&gt;\" rel=\"nofollow noreferrer\">docs</a> on this topic."}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 4142736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f83818c194f578aa637f6957113f3fbc?s=128&d=identicon&r=PG&f=1", "display_name": "bashxx", "link": "https://stackoverflow.com/users/4142736/bashxx"}, "is_accepted": false, "score": 0, "last_activity_date": 1503783344, "creation_date": 1503783344, "answer_id": 45899861, "question_id": 45889970, "link": "https://stackoverflow.com/questions/45889970/how-to-show-custom-application-metrics-in-prometheus-captured-using-the-golang-c/45899861#45899861", "title": "How to show custom application metrics in Prometheus captured using the golang client library from all pods running in Kubernetes", "body": "<p>Can you share the prometheus config that you are using to scrape the metrics. The config will control what all sources to scrape the metrics from. Here are a few links that you can refer to : <a href=\"https://groups.google.com/forum/#!searchin/prometheus-users/Application\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!searchin/prometheus-users/Application</a>$20metrics$20monitoring$20of$20Kubernetes$20Pods%7Csort:relevance/prometheus-users/uNPl4nJX9yk/cSKEBqJlBwAJ</p>\n"}, {"tags": [], "owner": {"reputation": 702, "user_id": 4763788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1198fc0b5df4d03d7be86092b8182192?s=128&d=identicon&r=PG", "display_name": "slintes", "link": "https://stackoverflow.com/users/4763788/slintes"}, "is_accepted": true, "score": 0, "last_activity_date": 1503822644, "creation_date": 1503822644, "answer_id": 45903093, "question_id": 45889970, "link": "https://stackoverflow.com/questions/45889970/how-to-show-custom-application-metrics-in-prometheus-captured-using-the-golang-c/45903093#45903093", "title": "How to show custom application metrics in Prometheus captured using the golang client library from all pods running in Kubernetes", "body": "<p>You need 2 things:</p>\n\n<ul>\n<li>a ServiceMonitor for the Prometheus Operator, which specifies which services will be scraped for metrics</li>\n<li>a Service which matches the ServiceMonitor and points to your pods</li>\n</ul>\n\n<p>There is an example in the docs over here: <a href=\"https://coreos.com/operators/prometheus/docs/latest/user-guides/running-exporters.html\" rel=\"nofollow noreferrer\">https://coreos.com/operators/prometheus/docs/latest/user-guides/running-exporters.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 58, "user_id": 3691424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OXegP.gif?s=128&g=1", "display_name": "Vect0r", "link": "https://stackoverflow.com/users/3691424/vect0r"}, "is_accepted": false, "score": 2, "last_activity_date": 1504511418, "creation_date": 1504511418, "answer_id": 46032535, "question_id": 45889970, "link": "https://stackoverflow.com/questions/45889970/how-to-show-custom-application-metrics-in-prometheus-captured-using-the-golang-c/46032535#46032535", "title": "How to show custom application metrics in Prometheus captured using the golang client library from all pods running in Kubernetes", "body": "<p>The kubernetes_sd_config directive can be used to discover all pods with a given tag. Your Prometheus.yml config file should have something like so:\n<code>\n- job_name: 'some-app'\n  kubernetes_sd_configs:\n    - role: pod\n  relabel_configs:\n    - source_labels: [__meta_kubernetes_pod_label_app]\n      regex: python-app\n      action: keep\n</code></p>\n\n<p>The source label [__meta_kubernetes_pod_label_app] is basically using the Kubernetes api to look at pods that have a label of 'app' and whose value is captured by the regex expression, given on the line below (in this case, matching 'python-app').</p>\n\n<p>Once you've done this Prometheus will automatically discover the pods you want and start scraping the metrics from your app.</p>\n\n<p>Hope that helps. You can follow blog post <a href=\"http://burhan.io/flask-application-monitoring-with-prometheus/\" rel=\"nofollow noreferrer\">here</a> for more detail.</p>\n\n<p><strong>Note:</strong> it is worth mentioning that at the time of writing, kubernetes_sd_config is still in beta. Thus breaking changes to configuration may occur in future releases.</p>\n"}], "owner": {"reputation": 5915, "user_id": 314014, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/073082ecd111b943f92b919e10a2e992?s=128&d=identicon&r=PG", "display_name": "Steve Sheldon", "link": "https://stackoverflow.com/users/314014/steve-sheldon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2586, "favorite_count": 2, "accepted_answer_id": 45903093, "answer_count": 3, "score": 5, "last_activity_date": 1504511418, "creation_date": 1503698775, "question_id": 45889970, "link": "https://stackoverflow.com/questions/45889970/how-to-show-custom-application-metrics-in-prometheus-captured-using-the-golang-c", "title": "How to show custom application metrics in Prometheus captured using the golang client library from all pods running in Kubernetes", "body": "<p>I am trying to get some custom application metrics captured in golang using the prometheus client library to show up in Prometheus.</p>\n\n<p>I have the following working:</p>\n\n<ul>\n<li><p>I have a go application which is exposing metrics on localhost:8080/metrics as described in this article:</p>\n\n<p><a href=\"https://godoc.org/github.com/prometheus/client_golang/prometheus\" rel=\"noreferrer\">https://godoc.org/github.com/prometheus/client_golang/prometheus</a></p></li>\n<li><p>I have a kubernates minikube running which has Prometheus, Grafana and AlertManager running using the operator from this article:</p>\n\n<p><a href=\"https://github.com/coreos/prometheus-operator/tree/master/contrib/kube-prometheus\" rel=\"noreferrer\">https://github.com/coreos/prometheus-operator/tree/master/contrib/kube-prometheus</a></p></li>\n<li><p>I created a docker image for my go app, when I run it and go to localhost:8080/metrics I can see the prometheus metrics showing up in a browser.</p></li>\n<li><p>I use the following pod.yaml to deploy my docker image to a pod in k8s</p></li>\n</ul>\n\n<blockquote>\n<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-app-pod\n  labels:\n    zone: prod\n    version: v1\n  annotations:\n   prometheus.io/scrape: 'true'\n   prometheus.io/port: '8080'\n\nspec:\n   containers:\n    - name: my-container\n      image: name/my-app:latest\n      imagePullPolicy: IfNotPresent\n      ports:\n      - containerPort: 8080\n</code></pre>\n</blockquote>\n\n<ul>\n<li>If I connect to my pod using:</li>\n</ul>\n\n<blockquote>\n  <p>kubectl exec -it my-app-pod -- /bin/bash</p>\n</blockquote>\n\n<p>then do wget on \"localhost:8080/metrics\", I can see my metrics</p>\n\n<p>So far so good, here is where I am hitting a wall. I could have multiple pods running this same image. I want to expose all the images to prometheus as targets. How do I configure my pods so that they show up in prometheus so I can report on my custom metrics?</p>\n\n<p>Thanks for any help offered!</p>\n"}, {"tags": ["go", "tensorflow", "bazel"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503931791, "post_id": 45889740, "comment_id": 78802259, "body": "You would have to ask the authors of that library."}, {"owner": {"reputation": 21, "user_id": 8518650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cfa629b21f2fa83d24156b733f83c0b?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Bouhenguel", "link": "https://stackoverflow.com/users/8518650/adam-bouhenguel"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504021474, "post_id": 45889740, "comment_id": 78844840, "body": "Posted here at the request of the authors of that library, so they could answer it in a public, accessible format"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504021623, "post_id": 45889740, "comment_id": 78844908, "body": "This is not the appropriate forum for that - if they want to explain their design decisions, that should be posted to their own project space, not on StackOverflow. This question, and its answer, are not useful to the broader community."}, {"owner": {"reputation": 21, "user_id": 8518650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cfa629b21f2fa83d24156b733f83c0b?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Bouhenguel", "link": "https://stackoverflow.com/users/8518650/adam-bouhenguel"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1504127838, "post_id": 45889740, "comment_id": 78898940, "body": "I see, that&#39;s too bad. I would disagree that the question and answer aren&#39;t useful to the broader community. Bazel and the rules_go repository are young projects that are seeing increasing popularity. Using other Google projects, like TensorFlow, to understand what the proper way to apply concepts from Bazel and rules_go seems like a good way to learn. My question is intended to understand whether or not the technique used in TensorFlow&#39;s go subfolder should be imitated elsewhere. Based on the answer below, it appears that it should not be. But I am certainly not an authority on SO. :/"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8518650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cfa629b21f2fa83d24156b733f83c0b?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Bouhenguel", "link": "https://stackoverflow.com/users/8518650/adam-bouhenguel"}, "edited": false, "score": 0, "creation_date": 1504021658, "post_id": 45924882, "comment_id": 78844928, "body": "Got it, thanks! I&#39;m working on integrating a large Go project with TensorFlow, so I&#39;d be happy to help when the time comes."}], "tags": [], "owner": {"reputation": 26173, "user_id": 1891, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c40d475927f7a86639ec54aa32517572?s=128&d=identicon&r=PG", "display_name": "Jay Conrod", "link": "https://stackoverflow.com/users/1891/jay-conrod"}, "is_accepted": true, "score": 1, "last_activity_date": 1503943246, "creation_date": 1503943246, "answer_id": 45924882, "question_id": 45889740, "link": "https://stackoverflow.com/questions/45889740/why-doesnt-tensorflows-go-subdirectory-use-go-library-from-bazel-rules-go/45924882#45924882", "title": "Why doesn&#39;t tensorflow&#39;s go/ subdirectory use go_library from Bazel rules_go?", "body": "<p>There's no good reason for this, other than \"historical accident\". Tensorflow had Go code before rules_go was very mature, so they implemented their own rules.</p>\n\n<p>I've worked on rules_go full time for the past several months. Our main priority this year has been to support Kubernetes' migration to Bazel by building out the features they need and making the rules simple to use. When that effort is completed (soon), we'll move on to supporting other projects using Bazel and Go more directly. I hope this will include Tensorflow.</p>\n"}], "owner": {"reputation": 21, "user_id": 8518650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cfa629b21f2fa83d24156b733f83c0b?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Bouhenguel", "link": "https://stackoverflow.com/users/8518650/adam-bouhenguel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "accepted_answer_id": 45924882, "answer_count": 1, "score": 0, "last_activity_date": 1503943246, "creation_date": 1503697263, "question_id": 45889740, "link": "https://stackoverflow.com/questions/45889740/why-doesnt-tensorflows-go-subdirectory-use-go-library-from-bazel-rules-go", "title": "Why doesn&#39;t tensorflow&#39;s go/ subdirectory use go_library from Bazel rules_go?", "body": "<p>The README in <a href=\"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/go\" rel=\"nofollow noreferrer\">https://github.com/tensorflow/tensorflow/tree/master/tensorflow/go</a> describes a build process that's a bit disjointed.</p>\n\n<p>Why not use SWIG and the go rules in <a href=\"https://github.com/bazelbuild/rules_go\" rel=\"nofollow noreferrer\">https://github.com/bazelbuild/rules_go</a>?</p>\n"}, {"tags": ["json", "rest", "go", "webserver"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1503695391, "post_id": 45889437, "comment_id": 78738389, "body": "It&#39;s only double-encoded because your code double-encodes it. You encode the body into JSON, then put that JSON into a field of another struct, then encode <i>that</i> to JSON. If you don&#39;t do that, you&#39;ll get the results you want."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1503695804, "post_id": 45889437, "comment_id": 78738530, "body": "This is useful too <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/json-to-go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1963, "user_id": 6020412, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a0c26de71499fc6adfae5cbdccd1ee7a?s=128&d=identicon&r=PG", "display_name": "Antoine Thiry", "link": "https://stackoverflow.com/users/6020412/antoine-thiry"}, "edited": false, "score": 0, "creation_date": 1503695946, "post_id": 45889524, "comment_id": 78738571, "body": "Yes ! Thanks ! I started to learn it like 4 hours ago but didn&#39;t learned about interface type yet, I&#39;ll go read a bit about that."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1503695789, "creation_date": 1503695789, "answer_id": 45889524, "question_id": 45889437, "link": "https://stackoverflow.com/questions/45889437/is-there-a-way-to-format-this-json-in-golang/45889524#45889524", "title": "Is there a way to format this json in golang?", "body": "<p>No point in marshalling the <strong>body</strong> separately from the <code>HttpResp</code>. Instead change the <code>Body</code> field's type to <code>interface{}</code> and then set the field to any value of a concrete type as opposed to a json string, e.g. <code>[]Article</code> and then marshal the resp once.</p>\n\n<pre><code>type HttpResp struct{\n    Status      int         `json:\"status\"`\n    Description string      `json:\"description\"`\n    Body        interface{} `json:\"body\"`\n}\n</code></pre>\n\n<p>And the rest...</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"net/http\"\n    \"log\"\n)\n\ntype Article struct{\n    Id          string  `json:\"id\"`\n    Title       string  `json:\"title\"`\n    Body        string  `json:\"body\"`\n    Description string  `json:\"description\"`\n}\n\nfunc AllArticles(w http.ResponseWriter, r *http.Request){\n    log.Print(\"/articles - GET\")\n    db := connect()\n    defer db.Close()\n\n    var articles []Article\n    results, err := db.Query(\"SELECT * FROM Articles\")\n\n    if err != nil{\n        log.Print(err)\n        return\n    }\n\n    for results.Next(){\n        var article Article\n        err = results.Scan(&amp;article.Title, &amp;article.Description, &amp;article.Body, &amp;article.Id)\n\n        if err != nil{\n            serr, _ := json.Marshal(err)\n            json.NewEncoder(w).Encode(HttpResp{Status: 500, Description: \"Failed to retrieve all articles\", Body: string(serr)})\n        }\n\n        articles = append(articles, article)\n    }\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    json.NewEncoder(w).Encode(HttpResp{Status: 200, Body: articles})\n}\n</code></pre>\n"}], "owner": {"reputation": 1963, "user_id": 6020412, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a0c26de71499fc6adfae5cbdccd1ee7a?s=128&d=identicon&r=PG", "display_name": "Antoine Thiry", "link": "https://stackoverflow.com/users/6020412/antoine-thiry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 463, "favorite_count": 1, "accepted_answer_id": 45889524, "answer_count": 1, "score": 2, "last_activity_date": 1503695789, "creation_date": 1503695307, "question_id": 45889437, "link": "https://stackoverflow.com/questions/45889437/is-there-a-way-to-format-this-json-in-golang", "title": "Is there a way to format this json in golang?", "body": "<p>I'm just starting to learn GoLang today, I'm trying to build a simple Rest API Web server.</p>\n\n<p>Here's the response Struct I want to send for each request to the web server : </p>\n\n<pre><code>package main\n\ntype HttpResp struct{\n    Status      int         `json:\"status\"`\n    Description string      `json:\"description\"`\n    Body        string      `json:\"body\"`\n}\n</code></pre>\n\n<p>And here's my <strong>articles.go</strong> file who have the function who gets all the articles in the database :</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"net/http\"\n    \"log\"\n)\n\ntype Article struct{\n    Id          string  `json:\"id\"`\n    Title       string  `json:\"title\"`\n    Body        string  `json:\"body\"`\n    Description string  `json:\"description\"`\n}\n\nfunc AllArticles(w http.ResponseWriter, r *http.Request){\n    log.Print(\"/articles - GET\")\n    db := connect()\n    defer db.Close()\n\n    var articles []Article\n    results, err := db.Query(\"SELECT * FROM Articles\")\n\n    if err != nil{\n        log.Print(err)\n        return\n    }\n\n    for results.Next(){\n        var article Article\n        err = results.Scan(&amp;article.Title, &amp;article.Description, &amp;article.Body, &amp;article.Id)\n\n        if err != nil{\n            serr, _ := json.Marshal(err)\n            json.NewEncoder(w).Encode(HttpResp{Status: 500, Description: \"Failed to retrieve all articles\", Body: string(serr)})\n        }\n\n        articles = append(articles, article)\n    }   \n    sarr, _ := json.Marshal(articles)\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    json.NewEncoder(w).Encode(HttpResp{Status: 200, Body: string(sarr)})\n}\n</code></pre>\n\n<p>The issue I'm facing here is that the response is like this : </p>\n\n<blockquote>\n  <p>{\"status\":200,\"description\":\"\",\"body\":\"[{\\\"id\\\":\\\"1\\\",\\\"title\\\":\\\"First\\\",\\\"body\\\":\\\"This\n  is a test body\\\",\\\"description\\\":\\\"This is a test\\\"}]\"}</p>\n</blockquote>\n\n<p>I'd like the body to be just JSON and not a string. How can I acheive that ?</p>\n"}]