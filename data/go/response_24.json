[{"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 1023, "user_id": 18933, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/1f1e8008a09a9d4cfe528e25cebe0b25?s=128&d=identicon&r=PG", "display_name": "gregf", "link": "https://stackoverflow.com/users/18933/gregf"}, "edited": false, "score": 0, "creation_date": 1435240552, "post_id": 31040730, "comment_id": 50125827, "body": "I don&#39;t believe this is the case. I can run the query just fine in sqlite3 as I showed above. It&#39;s only in gorm I run into the issue."}, {"owner": {"reputation": 468, "user_id": 1117026, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/1b833426c9221e4b886def0ddd170d05?s=128&d=identicon&r=PG", "display_name": "elgris", "link": "https://stackoverflow.com/users/1117026/elgris"}, "reply_to_user": {"reputation": 1023, "user_id": 18933, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/1f1e8008a09a9d4cfe528e25cebe0b25?s=128&d=identicon&r=PG", "display_name": "gregf", "link": "https://stackoverflow.com/users/18933/gregf"}, "edited": false, "score": 0, "creation_date": 1435279015, "post_id": 31040730, "comment_id": 50146425, "body": "You&#39;ve probably built your sqlite3 client with this flag, but gorm uses <code>github.com&#47;mattn&#47;go-sqlite3</code> driver which comes with its own sqlite3 client: <a href=\"https://github.com/mattn/go-sqlite3/blob/master/sqlite3-binding.c\" rel=\"nofollow noreferrer\">github.com/mattn/go-sqlite3/blob/master/sqlite3-binding.c</a>"}, {"owner": {"reputation": 1023, "user_id": 18933, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/1f1e8008a09a9d4cfe528e25cebe0b25?s=128&d=identicon&r=PG", "display_name": "gregf", "link": "https://stackoverflow.com/users/18933/gregf"}, "edited": false, "score": 0, "creation_date": 1435283580, "post_id": 31040730, "comment_id": 50147466, "body": "Thanks for clarifying."}], "tags": [], "owner": {"reputation": 468, "user_id": 1117026, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/1b833426c9221e4b886def0ddd170d05?s=128&d=identicon&r=PG", "display_name": "elgris", "link": "https://stackoverflow.com/users/1117026/elgris"}, "is_accepted": true, "score": 1, "last_activity_date": 1435202989, "last_edit_date": 1495539828, "creation_date": 1435202989, "answer_id": 31040730, "question_id": 31038805, "link": "https://stackoverflow.com/questions/31038805/how-to-delete-range-of-items-from-database-with-gorm/31040730#31040730", "title": "How to delete range of items from database with gorm", "body": "<p>Looks like it's a problem of sqlite3 driver.\nPlease check this thread: <a href=\"https://stackoverflow.com/questions/1824490/how-do-you-enable-limit-for-delete-in-sqlite\">How do you enable LIMIT for DELETE in SQLite?</a></p>\n\n<p>You need to pass flag SQLITE_ENABLE_UPDATE_DELETE_LIMIT to this driver somehow. Unfortunately, I have no idea how, because the driver uses \"amalgamation\" of SQLite source code and documentation says that you cannot use SQLITE_ENABLE_UPDATE_DELETE_LIMIT with it (<a href=\"https://www.sqlite.org/compile.html\" rel=\"nofollow noreferrer\">https://www.sqlite.org/compile.html</a>).</p>\n"}], "owner": {"reputation": 1023, "user_id": 18933, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/1f1e8008a09a9d4cfe528e25cebe0b25?s=128&d=identicon&r=PG", "display_name": "gregf", "link": "https://stackoverflow.com/users/18933/gregf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2427, "favorite_count": 1, "accepted_answer_id": 31040730, "answer_count": 1, "score": 2, "last_activity_date": 1435202989, "creation_date": 1435188361, "last_edit_date": 1435190550, "question_id": 31038805, "link": "https://stackoverflow.com/questions/31038805/how-to-delete-range-of-items-from-database-with-gorm", "title": "How to delete range of items from database with gorm", "body": "<p>Every time I run a gorm query to delete a range of rows from a table I get the following error.</p>\n\n<pre><code>(/home/gregf/code/go/src/github.com/gregf/gormtest/main.go:39)\n[2015-06-24 18:55:56]  [0.34ms]  SELECT  id FROM \"podcasts\"\n\n(/home/gregf/code/go/src/github.com/gregf/gormtest/main.go:50)\n[2015-06-24 18:55:56]  near \"LIMIT\": syntax error\n\n(/home/gregf/code/go/src/github.com/gregf/gormtest/main.go:50)\n[2015-06-24 18:55:56]  [0.82ms]  DELETE FROM \"episodes\"  WHERE (podcast_id = '1') LIMIT 4 OFFSET 2\n2015/06/24 18:55:56 &amp;{{0 0   false } near \"LIMIT\": syntax error 0 &lt;nil&gt; 0xc20802c280 0xc20802c140 0xc20802f900 2 &lt;nil&gt; &lt;nil&gt; false  map[gorm:started_transaction0xc2080380c00xc20805a1c0:true] map[]}\n</code></pre>\n\n<p>Running the query in sqlite3 directly returns just fine</p>\n\n<pre><code>DELETE FROM \"episodes\"  WHERE (podcast_id = '1') LIMIT 4 OFFSET 2;\nRun Time: real 0.000 user 0.000000 sys 0.000000\n</code></pre>\n\n<p>Example code</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/mattn/go-sqlite3\"\n)\n\ntype Podcast struct {\n    Id       int\n    Title    string\n    RssUrl   string `sql:\"unique_index\"`\n    Episodes []Episode\n}\n\ntype Episode struct {\n    Id         int\n    PodcastID  int\n    Title      string\n    Url        string `sql:\"unique_index\"`\n    Downloaded bool\n    Guid       string `sql:\"unique_index\"`\n}\n\nfunc main() {\n    db, err := gorm.Open(\"sqlite3\", \"cache.db\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    db.LogMode(true)\n\n    db.CreateTable(&amp;Podcast{})\n    db.CreateTable(&amp;Episode{})\n\n    rows, err := db.Table(\"podcasts\").Select(\"id\").Rows()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    for rows.Next() {\n        var podcastId int\n        rows.Scan(&amp;podcastId)\n        err := db.Table(\"episodes\").Where(\"podcast_id = ?\", podcastId).\n            Limit(4).\n            Offset(2).\n            Delete(Episode{})\n\n        if err != nil {\n            log.Printf(\"%s\\n\", err)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "stdout", "stdin", "console-input"], "comments": [{"owner": {"reputation": 3027, "user_id": 560382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1741fdf36945df8f3e26c4f1abd24cad?s=128&d=identicon&r=PG", "display_name": "Alvivi", "link": "https://stackoverflow.com/users/560382/alvivi"}, "edited": false, "score": 0, "creation_date": 1435184814, "post_id": 31037821, "comment_id": 50100343, "body": "Take a look at <a href=\"http://stackoverflow.com/questions/30655143/call-source-from-inside-a-go-program/30657036#30657036\" title=\"call source from inside a go program\">stackoverflow.com/questions/30655143/&hellip;</a> But do not send a &quot;\\n&quot; at the end of the command."}, {"owner": {"reputation": 449, "user_id": 4279822, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/cV51E.png?s=128&g=1", "display_name": "David Tootill", "link": "https://stackoverflow.com/users/4279822/david-tootill"}, "reply_to_user": {"reputation": 3027, "user_id": 560382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1741fdf36945df8f3e26c4f1abd24cad?s=128&d=identicon&r=PG", "display_name": "Alvivi", "link": "https://stackoverflow.com/users/560382/alvivi"}, "edited": false, "score": 0, "creation_date": 1435252268, "post_id": 31037821, "comment_id": 50134421, "body": "Thanks - this is a good find and is close to what I want.  Unfortunately, it&#39;s OS dependent (doesn&#39;t even compile in Windows).  Also, the output is messy in Linux (prints the command twice).   It has promise, though, and I&#39;ll work with it and post it as a solution to my own question if I can get it going satisfactorily."}], "answers": [{"comments": [{"owner": {"reputation": 449, "user_id": 4279822, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/cV51E.png?s=128&g=1", "display_name": "David Tootill", "link": "https://stackoverflow.com/users/4279822/david-tootill"}, "edited": false, "score": 0, "creation_date": 1435252469, "post_id": 31046441, "comment_id": 50134532, "body": "This doesn&#39;t do it - I&#39;m looking to provide a way to receive input from the user directly from text written by the application to the console.  It&#39;s straightforward to collect something the user has typed himself.  What I want to do is write something to the console and allow the user to submit it back by pressing Enter.  The solution suggested in alvivi&#39;s comment above is close, though it has the issues noted."}, {"owner": {"reputation": 13457, "user_id": 954376, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/08PZK.jpg?s=128&g=1", "display_name": "NeoWang", "link": "https://stackoverflow.com/users/954376/neowang"}, "reply_to_user": {"reputation": 449, "user_id": 4279822, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/cV51E.png?s=128&g=1", "display_name": "David Tootill", "link": "https://stackoverflow.com/users/4279822/david-tootill"}, "edited": false, "score": 0, "creation_date": 1435284652, "post_id": 31046441, "comment_id": 50147726, "body": "You mean curses-like application? Please see if the curses lib in my update is helpful."}], "tags": [], "owner": {"reputation": 13457, "user_id": 954376, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/08PZK.jpg?s=128&g=1", "display_name": "NeoWang", "link": "https://stackoverflow.com/users/954376/neowang"}, "is_accepted": false, "score": 1, "last_activity_date": 1435284746, "last_edit_date": 1435284746, "creation_date": 1435224767, "answer_id": 31046441, "question_id": 31037821, "link": "https://stackoverflow.com/questions/31037821/in-go-is-it-possible-to-write-to-the-console-and-read-back/31046441#31046441", "title": "In Go, is it possible to write to the console and read back?", "body": "<p>For getting input directly from user:</p>\n\n<pre><code>var s string\n_, err := fmt.Scanf(\"%s\", &amp;s)\n</code></pre>\n\n<p>For curses-like application, look here:\n<a href=\"https://github.com/rthornton128/goncurses/blob/master/ncurses.go\" rel=\"nofollow\">https://github.com/rthornton128/goncurses/blob/master/ncurses.go</a></p>\n\n<p>It has C bindings.</p>\n"}, {"tags": [], "owner": {"reputation": 449, "user_id": 4279822, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/cV51E.png?s=128&g=1", "display_name": "David Tootill", "link": "https://stackoverflow.com/users/4279822/david-tootill"}, "is_accepted": false, "score": 0, "last_activity_date": 1436545465, "creation_date": 1436545465, "answer_id": 31345792, "question_id": 31037821, "link": "https://stackoverflow.com/questions/31037821/in-go-is-it-possible-to-write-to-the-console-and-read-back/31345792#31345792", "title": "In Go, is it possible to write to the console and read back?", "body": "<p>I've found a Go command line editor package, <a href=\"https://github.com/peterh/liner\" rel=\"nofollow\">https://github.com/peterh/liner</a>, that incorporates the capability requested and a good deal more.  It allows you to write a CLI with history and command completion, with the command completion feature providing exactly what I asked for in the question: it presents text that the user can edit and submit to the CLI.  It supports Windows, Linux, and Mac.  Here's a slightly modified version of the example in its README that runs a simple CLI with command completion.  For example, the user can type \"j\" and press Tab to cycle through a list of names, edit one to taste, and press Enter to submit.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"strings\"\n\n    \"github.com/peterh/liner\"\n)\n\nvar (\n    history_fn = \".liner_history\"\n    names      = []string{\"jack\", \"john\", \"james\", \"mary\", \"mike\", \"nancy\"}\n)\n\nfunc main() {\n    line := liner.NewLiner()\n    defer line.Close()\n\n    line.SetCompleter(func(line string) (c []string) {\n        for _, n := range names {\n            if strings.HasPrefix(n, strings.ToLower(line)) {\n                c = append(c, n)\n            }\n        }\n        return\n    })\n\n    if f, err := os.Open(history_fn); err == nil {\n        line.ReadHistory(f)\n        f.Close()\n    }\n\n    line.SetCtrlCAborts(true)\n    for true {\n        if name, err := line.Prompt(\"What is your name? \"); err != nil {\n            if err.Error() == \"EOF\" || err == liner.ErrPromptAborted {\n                break\n            }\n            log.Print(\"Error reading line: \", err)\n        } else {\n            log.Print(\"Got: \", name)\n            line.AppendHistory(name)\n        }\n    }\n    fmt.Printf(\"End of test\\n\")\n\n    if f, err := os.Create(history_fn); err != nil {\n        log.Print(\"Error writing history file: \", err)\n    } else {\n        line.WriteHistory(f)\n        f.Close()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 449, "user_id": 4279822, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/cV51E.png?s=128&g=1", "display_name": "David Tootill", "link": "https://stackoverflow.com/users/4279822/david-tootill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1151, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1436545465, "creation_date": 1435182941, "question_id": 31037821, "link": "https://stackoverflow.com/questions/31037821/in-go-is-it-possible-to-write-to-the-console-and-read-back", "title": "In Go, is it possible to write to the console and read back?", "body": "<p>I'm writing a wizard for a CLI in Go.  What I'd like to do is ask the user what he wants to do, prepare the appropriate CLI command, and write it to the console.  The user then would submit the command to the CLI by pressing Enter, possibly after editing it first.  In other words, I want to write output to stdout that becomes input to stdin when the user presses Enter.  Is there a way to do this in Go?</p>\n"}, {"tags": ["templates", "go", "mux", "gorilla"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435192643, "post_id": 31036523, "comment_id": 50102492, "body": "so your real problem is to find a way loading text from Cloudfiles?"}, {"owner": {"reputation": 1662, "user_id": 1636058, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ciSUe.jpg?s=128&g=1", "display_name": "Josh Holloway", "link": "https://stackoverflow.com/users/1636058/josh-holloway"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435216004, "post_id": 31036523, "comment_id": 50109473, "body": "No, I can load the content of the file from Cloudfiles. That bit is easy. It&#39;s being able to render it as a template using Go"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435217597, "post_id": 31036523, "comment_id": 50110461, "body": "sorry i not know your really question still."}, {"owner": {"reputation": 1662, "user_id": 1636058, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ciSUe.jpg?s=128&g=1", "display_name": "Josh Holloway", "link": "https://stackoverflow.com/users/1636058/josh-holloway"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435217796, "post_id": 31036523, "comment_id": 50110573, "body": "From what I can tell, by default, Go&#39;s templating requires the templates to available at compile-time and you need to re-compile for template changes to take affect. I need to load the templates from a external source (like a database) and parse them on the fly before each request."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435218615, "post_id": 31036523, "comment_id": 50111104, "body": "of cause you can load Go&#39;s template content at runtime, just to read template content &quot;on the fly&quot; and invoke Parse() function."}, {"owner": {"reputation": 1662, "user_id": 1636058, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ciSUe.jpg?s=128&g=1", "display_name": "Josh Holloway", "link": "https://stackoverflow.com/users/1636058/josh-holloway"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435219892, "post_id": 31036523, "comment_id": 50111936, "body": "@JiangYD Ok, That&#39;s what I&#39;m asking. I&#39;ve edited my question."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1435242623, "post_id": 31036523, "comment_id": 50127626, "body": "Note that remotely fetching, parsing and then executing a template during a request/response cycle is hugely inefficient (and very slow). Can you not fetch them at program start, parse them and then make them available in a global or env struct you pass around?"}, {"owner": {"reputation": 1662, "user_id": 1636058, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ciSUe.jpg?s=128&g=1", "display_name": "Josh Holloway", "link": "https://stackoverflow.com/users/1636058/josh-holloway"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1435242746, "post_id": 31036523, "comment_id": 50127723, "body": "@elithrar Unfortunately not as each customer can modify their templates"}, {"owner": {"reputation": 2211, "user_id": 3243814, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/538d7f03357c8012445b79c7ee129aaa?s=128&d=identicon&r=PG&f=1", "display_name": "Etienne Bruines", "link": "https://stackoverflow.com/users/3243814/etienne-bruines"}, "edited": false, "score": 0, "creation_date": 1435261328, "post_id": 31036523, "comment_id": 50139559, "body": "You probably want to do some caching as well (saving the template), otherwise it&#39;d be quite slow."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1435265180, "post_id": 31036523, "comment_id": 50141465, "body": "(be careful with user modified templates: huge security risk)"}], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": true, "score": 0, "last_activity_date": 1435225438, "creation_date": 1435225438, "answer_id": 31046731, "question_id": 31036523, "link": "https://stackoverflow.com/questions/31036523/go-templates-loading-from-an-object-store-database/31046731#31046731", "title": "Go Templates - Loading from an object store / Database", "body": "<p>How can I load a specific template from a datastore on a per-request basis.</p>\n\n<pre><code>//take HTTP for example:\nresp, err := http.Get(\"http://mytemplates.com/template1\")\nif err != nil {\n    // handle error\n}\ndefer resp.Body.Close()\nbody, err := ioutil.ReadAll(resp.Body)\ntemplateString := string(body)\n</code></pre>\n\n<p>How can I then send that as a response to the client</p>\n\n<pre><code>tmpl, err := template.New(\"name\").Parse(templateString)\ntmpl.Execute(rw, &amp;yourDataModel{})\n</code></pre>\n"}], "owner": {"reputation": 1662, "user_id": 1636058, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ciSUe.jpg?s=128&g=1", "display_name": "Josh Holloway", "link": "https://stackoverflow.com/users/1636058/josh-holloway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "accepted_answer_id": 31046731, "answer_count": 1, "score": 2, "last_activity_date": 1435225438, "creation_date": 1435178126, "last_edit_date": 1435220004, "question_id": 31036523, "link": "https://stackoverflow.com/questions/31036523/go-templates-loading-from-an-object-store-database", "title": "Go Templates - Loading from an object store / Database", "body": "<p>I'm rebuilding an app that supports customer specific templating (themes) from node.js to Go.  </p>\n\n<p>I'm currently using <a href=\"https://github.com/unrolled/render\" rel=\"nofollow\">render</a> to render my template files but what I actually need to do access templates that are stored in an object store such as Cloudfiles.</p>\n\n<p>In node.js I've done this with express and I'm overriding the <code>render()</code> method but I've not been able to figure out how to do this in Go.</p>\n\n<p>I essentially need to do something like this:</p>\n\n<pre><code>func (c *Controller) MyRouteHandler (rw http.ResponseWriter, req *http.Request) {\n    // retrieve the store from the context (assigned in middleware chain)\n    store := context.Get(req, \"store\").(*Store) \n\n    ... do some stuff like load the entity from the database\n\n    // retrieve the template from the Object store and \n    // create the template instance (template.New(\"template\").Parse(...))\n    tpl := c.ObjectStore.LoadTemplate(store, entity.TemplateFile)\n\n    // I know render's .HTML function takes the path to the template \n    // so I'll probably need to show the html a different way\n    c.HTML(rw, http.StatusOK, tpl, &amp;PageContext{Title: \"My Page\", Entity: &amp;entity})\n}\n</code></pre>\n\n<p>I can dynamically include sub-templates by doing something like this if needed: <a href=\"http://play.golang.org/p/7BCPHdKRi2\" rel=\"nofollow\">http://play.golang.org/p/7BCPHdKRi2</a> but it doesn't seem like a great way if I'm honest. </p>\n\n<p>I've searched for a solution to this but keep hitting road blocks. Any advice / assistance would be great.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>In essence, I'm asking the following:</p>\n\n<ol>\n<li>How can I load a specific template from a datastore on a per-request basis.</li>\n<li>How can I then send that as a response to the client</li>\n</ol>\n"}, {"tags": ["json", "dictionary", "struct", "go", "composition"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1435177869, "post_id": 31036343, "comment_id": 50097074, "body": "Can you post a pretty printed basic version of the json so I can make a model for it? Sorry, just your goal is to deserialize json but the samples you gave aren&#39;t very readable."}, {"owner": {"reputation": 992, "user_id": 294325, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3a9847a69faff621162e534f491ef1da?s=128&d=identicon&r=PG", "display_name": "ciuncan", "link": "https://stackoverflow.com/users/294325/ciuncan"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1435178201, "post_id": 31036343, "comment_id": 50097267, "body": "I forgot to mention, but actually the point is to have dynamic fields. Those fields in <code>RowData</code> correspond to dynamically changing column keys. I don&#39;t think you can make a useful model from an example, but here you go: <a href=\"http://pastebin.com/16KC2102\" rel=\"nofollow noreferrer\">pastebin.com/16KC2102</a> . You can remove ellipsis to have valid json, but it means there are many other keys that are determined at runtime."}, {"owner": {"reputation": 992, "user_id": 294325, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3a9847a69faff621162e534f491ef1da?s=128&d=identicon&r=PG", "display_name": "ciuncan", "link": "https://stackoverflow.com/users/294325/ciuncan"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1435178436, "post_id": 31036343, "comment_id": 50097409, "body": "Oops, wrong example there. Here is the desired json example: <a href=\"http://pastebin.com/XcHBKhgF\" rel=\"nofollow noreferrer\">pastebin.com/XcHBKhgF</a>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1435178465, "post_id": 31036343, "comment_id": 50097425, "body": "You may not like this answer but it is the right one..."}, {"owner": {"reputation": 992, "user_id": 294325, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3a9847a69faff621162e534f491ef1da?s=128&d=identicon&r=PG", "display_name": "ciuncan", "link": "https://stackoverflow.com/users/294325/ciuncan"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1435178605, "post_id": 31036343, "comment_id": 50097493, "body": "Well, it is the desired output. But if it is not possible this easily, that&#39;s fine too."}], "answers": [{"comments": [{"owner": {"reputation": 992, "user_id": 294325, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3a9847a69faff621162e534f491ef1da?s=128&d=identicon&r=PG", "display_name": "ciuncan", "link": "https://stackoverflow.com/users/294325/ciuncan"}, "edited": false, "score": 0, "creation_date": 1435178722, "post_id": 31036633, "comment_id": 50097539, "body": "Thanks for definitive answer. I wondered if I could keep those two static keys <code>key1</code> and <code>key2</code> statically typed, but it doesn&#39;t seem possible. I guess the easiest solution would be the one you suggested."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 992, "user_id": 294325, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3a9847a69faff621162e534f491ef1da?s=128&d=identicon&r=PG", "display_name": "ciuncan", "link": "https://stackoverflow.com/users/294325/ciuncan"}, "edited": false, "score": 0, "creation_date": 1435178851, "post_id": 31036633, "comment_id": 50097596, "body": "@ciuncan np. I&#39;ll continue thinking about it because it&#39;s an interesting use case."}, {"owner": {"reputation": 992, "user_id": 294325, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3a9847a69faff621162e534f491ef1da?s=128&d=identicon&r=PG", "display_name": "ciuncan", "link": "https://stackoverflow.com/users/294325/ciuncan"}, "edited": false, "score": 0, "creation_date": 1435178892, "post_id": 31036633, "comment_id": 50097620, "body": "@evanmacdonnal Thanks, please post here if you find any nice alternative."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 6, "last_activity_date": 1435178593, "creation_date": 1435178593, "answer_id": 31036633, "question_id": 31036343, "link": "https://stackoverflow.com/questions/31036343/how-to-embed-a-map-into-a-struct-so-that-it-has-a-flat-json-representation/31036633#31036633", "title": "How to embed a map into a struct so that it has a flat json representation", "body": "<p>The short answer is no. The language does not allow you to embed either type (slice or map) in a struct.</p>\n\n<p>Just use a <code>map[string]interface{}</code>. Deal with the fact that the values for \"key1\" and \"key2\" are strings and everything else is a float somewhere else. That's really the only way you're getting that output. You can make the problem as complicated as you'd like beyond this (like transform into a type more like yours or something) but if you're averse to implementing <code>MarshalJSON</code> the only model which will produce the results you want is <code>map[string]interface{}</code></p>\n"}, {"tags": [], "owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "is_accepted": false, "score": -1, "last_activity_date": 1461889873, "creation_date": 1461889873, "answer_id": 36927627, "question_id": 31036343, "link": "https://stackoverflow.com/questions/31036343/how-to-embed-a-map-into-a-struct-so-that-it-has-a-flat-json-representation/36927627#36927627", "title": "How to embed a map into a struct so that it has a flat json representation", "body": "<p>I know there is an accepted answer already but actually you can get the specified \"desired flat json object.\" </p>\n\n<p>\"RowData\" is not exactly a <code>map[string]float</code>; getting it's type will yield \"main.RowData\" (if this is in package main). And it can be embedded in a struct. Take this example, adapted from the original post:</p>\n\n<pre><code>package main\n\nimport (\n\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Row struct {\n    Key1 string\n    Key2 string\n    RowData\n}\n\ntype RowData map[string]float64\n\nfunc main() {\n    row := Row{\n        RowData: make(map[string]float64),\n    }\n    row.RowData[\"15/04\"] = 1.3\n    row.RowData[\"15/05\"] = 1.2\n    row.RowData[\"17/08\"] = 0.8\n    row.Key1 = \"value one\"\n    row.Key2 = \"value two\"\n\n    flatJSON, _ := json.Marshal(row)\n    fmt.Println(string(flatJSON))\n}\n</code></pre>\n\n<p>That will yield:</p>\n\n<pre><code>{\"Key1\":\"value one\",\"Key2\":\"value two\",\"RowData\":{\"15/04\":1.3,\"15/05\":1.2,\"17/08\":0.8}}\n</code></pre>\n\n<p>The field names will have to be capitals in order to be exported but you can make them match the exact string specified in the question using struct tags.</p>\n"}], "owner": {"reputation": 992, "user_id": 294325, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3a9847a69faff621162e534f491ef1da?s=128&d=identicon&r=PG", "display_name": "ciuncan", "link": "https://stackoverflow.com/users/294325/ciuncan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5027, "favorite_count": 1, "accepted_answer_id": 31036633, "answer_count": 2, "score": 3, "last_activity_date": 1569245634, "creation_date": 1435177576, "last_edit_date": 1569245634, "question_id": 31036343, "link": "https://stackoverflow.com/questions/31036343/how-to-embed-a-map-into-a-struct-so-that-it-has-a-flat-json-representation", "title": "How to embed a map into a struct so that it has a flat json representation", "body": "<p>In order to create a table-like structure, I serialized my row data in following format in my previous application:</p>\n\n<pre><code>{ \"key1\": \"...\", \"key2\": \"...\", \"15/04\": 1.3, \"15/05\": 1.2, .... \"17/08\": 0.8 }\n</code></pre>\n\n<p>Now I am trying to rewrite it in Go in order to learn the language with hands-on experience. In Go, one can compose two structs together by embedding them into another struct. The marshalled json out of that struct will have a flat structure, i.e. the resulting json object will have union of fields of first and second structs without nesting. Here is an example: <a href=\"https://play.golang.org/p/jbJykip7pw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/jbJykip7pw</a> (from <a href=\"http://attilaolah.eu/2014/09/10/json-and-struct-composition-in-go/\" rel=\"nofollow noreferrer\">http://attilaolah.eu/2014/09/10/json-and-struct-composition-in-go/</a>)</p>\n\n<p>I guessed I could also embed a map into a struct so that I can marshall above json using following type definitions:</p>\n\n<pre><code>type Row struct {\n    key1 string\n    key2 string\n    RowData\n}\n\ntype RowData map[string]float64\n\n...\nfunc main() {\n    row := Row{\n        \"...\",\n        \"...\",\n        RowData{\n            \"15/04\": 1.3, \"15/05\": 1.2, .... \"17/08\": 0.8,\n        },\n    }\n}\n</code></pre>\n\n<p>But this created a field 'RowData' field in my 'Row' object, instead of appending entries in the RowData into my desired flat json object:</p>\n\n<pre><code>{ \"key1\": \"...\", \"key2\": \"...\", \"RowData\": { \"15/04\": 1.3, \"15/05\": 1.2, .... \"17/08\": 0.8 } }\n</code></pre>\n\n<p>I would like to know, if there is a way to embed maps or slices into a struct so that resulting json object is flat, without defining a <code>MarshalJSON</code> function on type <code>Row</code>?</p>\n"}, {"tags": ["go", "base64"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1435162269, "post_id": 31031589, "comment_id": 50087830, "body": "You need to strip off the &quot;data:image/png;base64,&quot; prefix."}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 2, "last_activity_date": 1435165106, "last_edit_date": 1435165106, "creation_date": 1435162317, "answer_id": 31031691, "question_id": 31031589, "link": "https://stackoverflow.com/questions/31031589/illegal-base64-data-at-input-byte-4-when-using-base64-stdencoding-decodestrings/31031691#31031691", "title": "Illegal base64 data at input byte 4 when using base64.StdEncoding.DecodeString(str)", "body": "<p>It's because your string isn't in base64 until after the comma data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYA... </p>\n\n<p>import \"strings\" and use split to get the half after the comma and then call decodestring with that.</p>\n\n<pre><code>import \"strings\"\n\ndata, errBase := base64.StdEncoding.DecodeString(strings.Split(Base64Image, \"base64,\")[1]))\nif errBase != nil {\n    fmt.Println(\"error:\", errBase)\n    return false\n}\n</code></pre>\n\n<p>EDIT: made the split token <code>base64,</code> because it's more specific to your input.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 17, "last_activity_date": 1471850006, "last_edit_date": 1471850006, "creation_date": 1435174283, "answer_id": 31035384, "question_id": 31031589, "link": "https://stackoverflow.com/questions/31031589/illegal-base64-data-at-input-byte-4-when-using-base64-stdencoding-decodestrings/31035384#31035384", "title": "Illegal base64 data at input byte 4 when using base64.StdEncoding.DecodeString(str)", "body": "<p>Not all of your input string you try to decode is Base64 encoded form.</p>\n\n<p>What you have is a <a href=\"https://en.wikipedia.org/wiki/Data_URI_scheme\" rel=\"noreferrer\">Data URI scheme</a>, that provides a way to include data in-line in web pages as if they were external resources.</p>\n\n<p>It has a format of:</p>\n\n<pre><code>data:[&lt;MIME-type&gt;][;charset=&lt;encoding&gt;][;base64],&lt;data&gt;\n</code></pre>\n\n<p>Where in your case <code>image/png</code> is the MIME-type, the optional charset is missing, and <code>\";base64\"</code> is a constant string indicating that <code>&lt;data&gt;</code> is encoded using Base64 encoding.</p>\n\n<p>To acquire the data (that is the Base64 encoded form), cut off the prefix up to the comma (comma included):</p>\n\n<pre><code>input := \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYA\"\n\nb64data := input[strings.IndexByte(input, ',')+1:]\nfmt.Println(b64data)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYA\n</code></pre>\n\n<p>Of which you can now decode:</p>\n\n<pre><code>data, err := base64.StdEncoding.DecodeString(b64data)\nif err != nil {\n    fmt.Println(\"error:\", err)\n}\nfmt.Println(data)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[137 80 78 71 13 10 26 10 0 0 0 13 73 72 68 82 0 0 0 100 0 0 0 100 8 6 0]\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/oIrLZl698G\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 379, "user_id": 4424548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4b7e210fee0a6c4c2174bb67daeeb2a?s=128&d=identicon&r=PG&f=1", "display_name": "Erkin Djindjiev", "link": "https://stackoverflow.com/users/4424548/erkin-djindjiev"}, "is_accepted": false, "score": 3, "last_activity_date": 1521656273, "creation_date": 1521656273, "answer_id": 49413861, "question_id": 31031589, "link": "https://stackoverflow.com/questions/31031589/illegal-base64-data-at-input-byte-4-when-using-base64-stdencoding-decodestrings/49413861#49413861", "title": "Illegal base64 data at input byte 4 when using base64.StdEncoding.DecodeString(str)", "body": "<p>Sometimes this happens if your base64 string is not properly padded with == at the end.</p>\n"}, {"tags": [], "owner": {"reputation": 68, "user_id": 13696793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a8c529efef37b636edee406f26cc59f?s=128&d=identicon&r=PG&f=1", "display_name": "Grzegorz Bara\u0144ski", "link": "https://stackoverflow.com/users/13696793/grzegorz-bara%c5%84ski"}, "is_accepted": false, "score": 1, "last_activity_date": 1609873293, "creation_date": 1609873293, "answer_id": 65584997, "question_id": 31031589, "link": "https://stackoverflow.com/questions/31031589/illegal-base64-data-at-input-byte-4-when-using-base64-stdencoding-decodestrings/65584997#65584997", "title": "Illegal base64 data at input byte 4 when using base64.StdEncoding.DecodeString(str)", "body": "<p>Also this may happen if you encoded using <code>StdEncoding</code> and trying to decode using <code>RawStdEncoding</code></p>\n"}], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38957, "favorite_count": 4, "accepted_answer_id": 31035384, "answer_count": 4, "score": 7, "last_activity_date": 1609873293, "creation_date": 1435162062, "last_edit_date": 1562957365, "question_id": 31031589, "link": "https://stackoverflow.com/questions/31031589/illegal-base64-data-at-input-byte-4-when-using-base64-stdencoding-decodestrings", "title": "Illegal base64 data at input byte 4 when using base64.StdEncoding.DecodeString(str)", "body": "<p>I am getting: error: <code>illegal base64 data at input byte 4</code></p>\n\n<p>When passing in Base64Image into <code>base64.StdEncoding.DecodeString(str)</code>:</p>\n\n<pre><code>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYA... \n</code></pre>\n\n<p>Let me know if you need the full base64, I have just pasted in the first part as it looks like the problem is within 4 byte?</p>\n\n<pre><code>data, errBase := base64.StdEncoding.DecodeString(Base64Image)\nif errBase != nil {\n    fmt.Println(\"error:\", errBase)\n    return false\n}\n</code></pre>\n\n<p>Do you know why?</p>\n"}, {"tags": ["json", "go", "webserver", "unmarshalling", "flickr"], "answers": [{"comments": [{"owner": {"reputation": 78, "user_id": 3502049, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3f8395910f46e92552edff6fc2681735?s=128&d=identicon&r=PG&f=1", "display_name": "KrithGhosh", "link": "https://stackoverflow.com/users/3502049/krithghosh"}, "edited": false, "score": 0, "creation_date": 1435161467, "post_id": 31031177, "comment_id": 50087261, "body": "Thanks for your help.. but Im still getting an error : cannot use jsonData.Photos.Photo[i].Id (type int) as type uint32 in argument to binary.LittleEndian.PutUint32"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 78, "user_id": 3502049, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3f8395910f46e92552edff6fc2681735?s=128&d=identicon&r=PG&f=1", "display_name": "KrithGhosh", "link": "https://stackoverflow.com/users/3502049/krithghosh"}, "edited": false, "score": 0, "creation_date": 1435161748, "post_id": 31031177, "comment_id": 50087467, "body": "@user3502049 ah yeah, I should have looked at the method definition. I&#39;ll edit with a better option. You could do another cast from int to uint32 but anyway, I think this is easier."}, {"owner": {"reputation": 78, "user_id": 3502049, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3f8395910f46e92552edff6fc2681735?s=128&d=identicon&r=PG&f=1", "display_name": "KrithGhosh", "link": "https://stackoverflow.com/users/3502049/krithghosh"}, "edited": false, "score": 0, "creation_date": 1435162778, "post_id": 31031177, "comment_id": 50088198, "body": "I tried replacing the code with the first edit you gave but still getting an error : invalid argument jsonData (type *Result) for len"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 78, "user_id": 3502049, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3f8395910f46e92552edff6fc2681735?s=128&d=identicon&r=PG&f=1", "display_name": "KrithGhosh", "link": "https://stackoverflow.com/users/3502049/krithghosh"}, "edited": false, "score": 0, "creation_date": 1435162941, "post_id": 31031177, "comment_id": 50088307, "body": "@user3502049 that&#39;s because this code; <code>len(jsonData)</code> isn&#39;t valid. In your for loop. You probably want <code>len(jsonData.Photos.Photo)</code> instead but you can also use the range function <code>for p, i := range jsonData.Photos.Photo</code> p will point to the current item and i will be the index which it&#39;s at."}, {"owner": {"reputation": 78, "user_id": 3502049, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3f8395910f46e92552edff6fc2681735?s=128&d=identicon&r=PG&f=1", "display_name": "KrithGhosh", "link": "https://stackoverflow.com/users/3502049/krithghosh"}, "edited": false, "score": 0, "creation_date": 1435163501, "post_id": 31031177, "comment_id": 50088637, "body": "Can I use it like this : <code>for p,i := range jsonData.Photos.Photo {             w.Write([]byte(strconv.Itoa(p[i].Id)))          }</code>; as its giving an error : invalid operation: p[i] (type int does not support indexing)"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 78, "user_id": 3502049, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3f8395910f46e92552edff6fc2681735?s=128&d=identicon&r=PG&f=1", "display_name": "KrithGhosh", "link": "https://stackoverflow.com/users/3502049/krithghosh"}, "edited": false, "score": 0, "creation_date": 1435164160, "post_id": 31031177, "comment_id": 50089069, "body": "@user3502049 look at my updated answer. Also, check out some resources on the for loop syntax. I misspoke slightly in my comment above. <a href=\"http://golangtutorials.blogspot.com/2011/06/control-structures-go-for-loop-break.html\" rel=\"nofollow noreferrer\">golangtutorials.blogspot.com/2011/06/&hellip;</a>"}, {"owner": {"reputation": 78, "user_id": 3502049, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3f8395910f46e92552edff6fc2681735?s=128&d=identicon&r=PG&f=1", "display_name": "KrithGhosh", "link": "https://stackoverflow.com/users/3502049/krithghosh"}, "edited": false, "score": 0, "creation_date": 1435164872, "post_id": 31031177, "comment_id": 50089506, "body": "Hei the updated code is getting compiled but Im getting only zeros as a response"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 78, "user_id": 3502049, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3f8395910f46e92552edff6fc2681735?s=128&d=identicon&r=PG&f=1", "display_name": "KrithGhosh", "link": "https://stackoverflow.com/users/3502049/krithghosh"}, "edited": false, "score": 0, "creation_date": 1435165001, "post_id": 31031177, "comment_id": 50089591, "body": "@user3502049 my guess is that&#39;s because you have Id as an int in your model but in the json the type is actually a string. All those numbers in quotes are actually strings, you&#39;ll have to write some code to convert them to ints if you need them in that form. Otherwise you could just get rid of that byte stuff. Like this <code>w.Write([]byte(strconv.Itoa(p.Id)))</code> could just be <code>w.Write([]byte(p.Id))</code>. Sorry, I probably should have noticed that earlier but you got many errors and obv I&#39;m not compiling or anything, just editing on here."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 0, "last_activity_date": 1435163999, "last_edit_date": 1495541162, "creation_date": 1435160922, "answer_id": 31031177, "question_id": 31030555, "link": "https://stackoverflow.com/questions/31030555/go-json-parsing/31031177#31031177", "title": "Go JSON parsing", "body": "<p>The problem isn't with your model, that works just fine. You've already finished deserialzing (without errors) when the error occurs which is on this line; <code>w.Write(jsonData.Photos.Photo[i].Id)</code>. You're passing an int when it needs to be a byte array.</p>\n\n<p>This answer explains how to do the conversion; <a href=\"https://stackoverflow.com/questions/16888357/convert-an-integer-to-a-byte-array\">Convert an integer to a byte array</a></p>\n\n<p>So, to make your code into some working form;</p>\n\n<pre><code>import \"encoding/binary\"\n\nbuffer := make([]byte, 4)\nfor i := 0;i &lt; len(jsonData.Photos.Photo); i++ {\n        binary.LittleEndian.PutUint32(buffer, jsonData.Photos.Photo[i].Id)\n        w.Write(buffer)\n     }\n</code></pre>\n\n<p>Note that is writing the binary representation of your value as an unsigned 32 bit int with little endian bit order. That <em>may not</em> work for you. I can't say what will so you gotta make some decisions there like what bit order you want, if you need signed vs unsigned ect.</p>\n\n<p>EDIT: To make the above work I guess you gotta do a cast from int to uint32 as well. Looking more closely at the answer I linked to you can do this instead which is cleaner/simpler imo.</p>\n\n<pre><code>import \"strconv\"\n\nfor _, p := range jsonData.Photos.Photo {\n            w.Write([]byte(strconv.Itoa(p.Id)))\n         }\n</code></pre>\n\n<p>Second EDIT: There's many ways to convert an int to binary. Another good option would be; <code>func Write(w io.Writer, order ByteOrder, data interface{}) error</code></p>\n\n<p>I believe in your code you could use that like;</p>\n\n<pre><code>  import \"encoding/binary\"\n\n  for i := range jsonData.Photo.Photos {\n            binary.Write(w, binary.LittleEndian, jsonData.Photos.Photo[i].Id)\n         }\n</code></pre>\n\n<p><a href=\"http://golang.org/pkg/encoding/binary/#Write\" rel=\"nofollow noreferrer\">http://golang.org/pkg/encoding/binary/#Write</a></p>\n\n<p>EDIT: Updated the three examples to have working for loops of different varieties.</p>\n"}], "owner": {"reputation": 78, "user_id": 3502049, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3f8395910f46e92552edff6fc2681735?s=128&d=identicon&r=PG&f=1", "display_name": "KrithGhosh", "link": "https://stackoverflow.com/users/3502049/krithghosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 585, "favorite_count": 0, "accepted_answer_id": 31031177, "answer_count": 1, "score": 1, "last_activity_date": 1435163999, "creation_date": 1435159253, "last_edit_date": 1435163571, "question_id": 31030555, "link": "https://stackoverflow.com/questions/31030555/go-json-parsing", "title": "Go JSON parsing", "body": "<p>I'm new to Go.\nI have been trying to get the photos from Flickr using <a href=\"https://www.flickr.com/services/api/\" rel=\"nofollow\">their API</a> but I'm facing an issue parsing the JSON response.</p>\n\n<p>I have been writing the server in Go to handle the web service calls.\nMy Output looks something like this: </p>\n\n<pre><code>{\n    \"photos\": {\n        \"page\": 1,\n        \"pages\": 3583,\n        \"perpage\": 100,\n        \"total\": \"358260\",\n        \"photo\": [\n            {\n                \"id\": \"18929318980\",\n                \"owner\": \"125299498@N04\",\n                \"secret\": \"505225f721\",\n                \"server\": \"469\",\n                \"farm\": 1,\n                \"title\": \"\u2764\ufe0f\ud83d\udc3e Puppy Dog Eyes\ud83d\udc3e\u2764\ufe0f #Cute #baby #havanese #puppy #love #petsofinstagram #akc #aplacetolovedogs #all_little_puppies #americankennelclub #beautiful #bestanimal #puppies #cutestdogever #dog #doglife #doglover #dogoftheday\",\n                \"ispublic\": 1,\n                \"isfriend\": 0,\n                \"isfamily\": 0\n            },\n            {\n                \"id\": \"18930020399\",\n                \"owner\": \"125421155@N06\",\n                \"secret\": \"449f493ebc\",\n                \"server\": \"496\",\n                \"farm\": 1,\n                \"title\": \"Titt tei hvem er du for en liten tass \ud83d\ude0a Osvald og King \ud83d\udc9c #cat#kitten #bordercollie #puppy#dog\",\n                \"ispublic\": 1,\n                \"isfriend\": 0,\n                \"isfamily\": 0\n            },\n            {\n                \"id\": \"18929979989\",\n                \"owner\": \"131975470@N02\",\n                \"secret\": \"7da344edcb\",\n                \"server\": \"498\",\n                \"farm\": 1,\n                \"title\": \"Shame, Shame\",\n                \"ispublic\": 1,\n                \"isfriend\": 0,\n                \"isfamily\": 0\n            }\n             ]\n    },\n    \"stat\": \"ok\"\n}\n</code></pre>\n\n<p>When I'm trying to run the code it's showing:</p>\n\n<pre><code>cannot use jsonData.Photos.Photo[i].Id (type int) as type []byte in argument to w.Write\n</code></pre>\n\n<p>My code is given below:</p>\n\n<pre><code>package main\n\nimport(\n        \"os\"\n        \"fmt\"\n        \"log\"\n        \"net/http\"\n        \"io/ioutil\"\n        \"encoding/json\"\n        \"github.com/gorilla/mux\"\n\n)\ntype Result struct {\n        Photos struct {\n        Page int `json: \"page\"`\n        Pages int `json: \"pages\"`\n        PerPage int `json: \"perpage\"`\n        Total int `json: \"total\"`\n        Photo []struct {\n            Id int `json: \"id\"`\n            Owner string `json: \"owner\"`\n            Secret string `json: \"secret\"`\n            Server int `json: \"server\"`\n            Farm int `json: \"farm\"`\n            Title string `json: \"title\"`\n            IsPublic int `json: \"ispublic\"`\n            IsFriend int `json: \"isfriend\"`\n            IsFamily int `json: \"isfamily`\n            } `json: \"photo\"`\n    } `json: \"photos\"`\n    Stat string `json: \"stat\"`\n}\n\nfunc main() {\n\n    router := mux.NewRouter().StrictSlash(true);\n    router.HandleFunc(\"/Index\", Index)\n    log.Fatal(http.ListenAndServe(\":8084\", router))\n}\n\nfunc Index(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json\");\n    url := \"https://api.flickr.com/services/rest/?method=flickr.photos.search&amp;api_key=6b54d86b4e09671ef6a2a8c02b7a3537&amp;text=cute+puppies&amp;format=json&amp;nojsoncallback=1\"\n    res, err := http.Get(url)\n     if err != nil{\n        fmt.Printf(\"%s\", err)\n        os.Exit(1)\n     }\n    body, err := ioutil.ReadAll(res.Body)\n    if err != nil{\n        fmt.Printf(\"%s\", err)\n        os.Exit(1)\n     }\n\n     jsonData := &amp;Result{}\n     err = json.Unmarshal([]byte(body), &amp;jsonData)\n     for i := 0;i &lt; len(jsonData); i++ {\n        w.Write(jsonData.Photos.Photo[i].Id)\n     }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1435157460, "post_id": 31028021, "comment_id": 50084277, "body": "Does <code>token.Extra(&quot;scope&quot;)</code> provide you with anything useful?"}, {"owner": {"reputation": 72977, "user_id": 95944, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/SprKq.jpg?s=128&g=1", "display_name": "Richard Knop", "link": "https://stackoverflow.com/users/95944/richard-knop"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1435159319, "post_id": 31028021, "comment_id": 50085684, "body": "@TimCooper No. Even though my config has Scopes slice specified token.Extra(&quot;scope&quot;) returns nil. I don&#39;t think scope might not be implemented correctly."}, {"owner": {"reputation": 328, "user_id": 1153787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5873791379239c56b80b16ba792d2d68?s=128&d=identicon&r=PG", "display_name": "slv007", "link": "https://stackoverflow.com/users/1153787/slv007"}, "edited": false, "score": 0, "creation_date": 1594436816, "post_id": 31028021, "comment_id": 111133650, "body": "yes, you can get all raw values via token.Extra method. e.g.  token.Extra(&quot;scope&quot;), token.Extra(&quot;expires_in&quot;)"}], "answers": [{"tags": [], "owner": {"reputation": 93, "user_id": 3774838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fed1875a71a16474748146f20f2f5865?s=128&d=identicon&r=PG&f=1", "display_name": "JonPen", "link": "https://stackoverflow.com/users/3774838/jonpen"}, "is_accepted": false, "score": 1, "last_activity_date": 1505496099, "creation_date": 1505496099, "answer_id": 46244729, "question_id": 31028021, "link": "https://stackoverflow.com/questions/31028021/golang-oauth2-get-token-scope/46244729#46244729", "title": "Golang Oauth2 Get Token Scope", "body": "<p>this should do the trick</p>\n\n<pre><code>    func GetTokensScope(tokUrl string, clientId string, secret string) (string,error){\n        body := bytes.NewBuffer([]byte(\"grant_type=client_credentials&amp;client_id=\"+clientId+\"&amp;client_secret=\"+secret+\"&amp;response_type=token\"))\n        req, err := http.NewRequest(\"POST\",tokUrl,body)\n        req.Header.Set(\"Content-Type\",\"application/x-www-form-urlencoded\")  \n        client := &amp;http.Client{}\n        resp, err := client.Do(req)\n        if err != nil {\n            return \"\",err\n        }\n\n        defer resp.Body.Close()\n        rsBody, err := ioutil.ReadAll(resp.Body)\n        type WithScope struct {\n            Scope string `json:\"scope\"`\n        }\n        var dat WithScope\n        err = json.Unmarshal(rsBody,&amp;dat)\n        if err != nil {\n            return \"\",err\n        }\n\n        return dat.Scope,err\n    }\n</code></pre>\n"}], "owner": {"reputation": 72977, "user_id": 95944, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/SprKq.jpg?s=128&g=1", "display_name": "Richard Knop", "link": "https://stackoverflow.com/users/95944/richard-knop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1147, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505496099, "creation_date": 1435152652, "question_id": 31028021, "link": "https://stackoverflow.com/questions/31028021/golang-oauth2-get-token-scope", "title": "Golang Oauth2 Get Token Scope", "body": "<p>When using Golang's Oauth2 library:</p>\n\n<p><a href=\"https://godoc.org/golang.org/x/oauth2#Token\" rel=\"nofollow\">https://godoc.org/golang.org/x/oauth2#Token</a></p>\n\n<p>I exchange the authorisation code for access token and I get back this struct:</p>\n\n<pre><code>type Token struct {\n    // AccessToken is the token that authorizes and authenticates\n    // the requests.\n    AccessToken string `json:\"access_token\"`\n\n    // TokenType is the type of token.\n    // The Type method returns either this or \"Bearer\", the default.\n    TokenType string `json:\"token_type,omitempty\"`\n\n    // RefreshToken is a token that's used by the application\n    // (as opposed to the user) to refresh the access token\n    // if it expires.\n    RefreshToken string `json:\"refresh_token,omitempty\"`\n\n    // Expiry is the optional expiration time of the access token.\n    //\n    // If zero, TokenSource implementations will reuse the same\n    // token forever and RefreshToken or equivalent\n    // mechanisms for that TokenSource will not be used.\n    Expiry time.Time `json:\"expiry,omitempty\"`\n    // contains filtered or unexported fields\n}\n</code></pre>\n\n<p>Now when I am using this access token in my application, I need to know the scope for which the token was granted.</p>\n\n<p>But I don't see any property or method to get the scope?</p>\n\n<p>How to get the token's scope so I can limit user's permissions based on it?</p>\n\n<p>I can see that the Config struct has Scopes slice:</p>\n\n<pre><code>type Config struct {\n    // ClientID is the application's ID.\n    ClientID string\n\n    // ClientSecret is the application's secret.\n    ClientSecret string\n\n    // Endpoint contains the resource server's token endpoint\n    // URLs. These are constants specific to each server and are\n    // often available via site-specific packages, such as\n    // google.Endpoint or github.Endpoint.\n    Endpoint Endpoint\n\n    // RedirectURL is the URL to redirect users going through\n    // the OAuth flow, after the resource owner's URLs.\n    RedirectURL string\n\n    // Scope specifies optional requested permissions.\n    Scopes []string\n}\n</code></pre>\n\n<p>It seems to me there is no way to get scope from a token though?</p>\n\n<p>Surely the point of scope is that it should be part of the access token in order to validate permissions?</p>\n\n<p>See the spec: <a href=\"https://tools.ietf.org/html/rfc6749#page-23\" rel=\"nofollow\">https://tools.ietf.org/html/rfc6749#page-23</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6027, "user_id": 1187471, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/AtK2G.jpg?s=128&g=1", "display_name": "Fernando &#193;.", "link": "https://stackoverflow.com/users/1187471/fernando-%c3%81"}, "edited": false, "score": 4, "creation_date": 1435152404, "post_id": 31027579, "comment_id": 50080245, "body": "Short answer: do not ignore errors in Go"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1435154417, "post_id": 31027579, "comment_id": 50081850, "body": "Yes, there is a way to make it much cleaner: Add error handling. Ignoring error is the complete opposite of clean code."}, {"owner": {"reputation": 289, "user_id": 1107796, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9587ee4ef500bdf95e3f0eca04e3bed9?s=128&d=identicon&r=PG", "display_name": "Kenet Jervet", "link": "https://stackoverflow.com/users/1107796/kenet-jervet"}, "edited": false, "score": 1, "creation_date": 1515657941, "post_id": 31027579, "comment_id": 83385489, "body": "Simply saying &quot;Do NOT...&quot; is not an answer to the question, although the title and the post are not asking the exact same question. I got to say that adding error handing is not making the code &quot;cleaner&quot;, but only more robust. However, maybe the OP is only playing around, or working with some simple one-shot scripting tasks.  Or simply because he can live with the potential consequences. Anyhow, the OP&#39;s original question is valid. Both Rust and Haskell provide some way to leave the error to runtime (in Rust, <code>unwrap</code>; in Haskell, it depending on what error handling mechanism you are using)"}], "answers": [{"tags": [], "owner": {"reputation": 1701, "user_id": 788887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f68a54ea809de360f7049f5c970df1d7?s=128&d=identicon&r=PG", "display_name": "ReyCharles", "link": "https://stackoverflow.com/users/788887/reycharles"}, "is_accepted": false, "score": 5, "last_activity_date": 1435152274, "creation_date": 1435152274, "answer_id": 31027853, "question_id": 31027579, "link": "https://stackoverflow.com/questions/31027579/how-to-ignore-returned-error-in-go/31027853#31027853", "title": "how to ignore returned error in GO", "body": "<p>It is possible to define a function to ignore errors, but Go's lack of generics make it so you'd have to use interface{} and typecasts all over the place, losing a lot of static guarantees from the typechecker in the process. It is extremely ugly. Don't do this.</p>\n\n<pre><code>func ignoreError(val interface {}, err error) interface {} {\n    return val\n}\n</code></pre>\n\n<p>At every call to <code>ignoreError()</code> you would have to make a type cast to the expected return type.</p>\n\n<p><a href=\"http://play.golang.org/p/KGFF4mEkBg\" rel=\"noreferrer\">Playground example</a></p>\n"}, {"comments": [{"owner": {"reputation": 1943, "user_id": 579024, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mccLr.jpg?s=128&g=1", "display_name": "Dani-Br", "link": "https://stackoverflow.com/users/579024/dani-br"}, "edited": false, "score": 0, "creation_date": 1435157623, "post_id": 31028337, "comment_id": 50084383, "body": "Thanks for the advice, I&#39;ll try to follow it. Probably GO has different mindset than PHP-JS."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 1, "creation_date": 1520956258, "post_id": 31028337, "comment_id": 85524286, "body": "Except in the case where the documentation explicitly says that the function returns <code>nil</code>: e.g. <code>strings.WriteString()</code>: &quot;WriteString appends the contents of s to b&#39;s buffer. It returns the length of s and a nil error.&quot;"}, {"owner": {"reputation": 18623, "user_id": 560600, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/cbVC9.jpg?s=128&g=1", "display_name": "Sky Kelsey", "link": "https://stackoverflow.com/users/560600/sky-kelsey"}, "edited": false, "score": 11, "creation_date": 1542396478, "post_id": 31028337, "comment_id": 93567349, "body": "This is not an answer to the question ask, it&#39;s an opinion. There are legitimate reasons to ignore the error value."}, {"owner": {"reputation": 23964, "user_id": 736809, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/en4t4.jpg?s=128&g=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/736809/jimbo"}, "reply_to_user": {"reputation": 18623, "user_id": 560600, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/cbVC9.jpg?s=128&g=1", "display_name": "Sky Kelsey", "link": "https://stackoverflow.com/users/560600/sky-kelsey"}, "edited": false, "score": 5, "creation_date": 1548095264, "post_id": 31028337, "comment_id": 95412055, "body": "Absolutely agree @SkyKelsey. Dogmatic purism is not something to be proud of."}, {"owner": {"reputation": 51, "user_id": 9638678, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-RFd54WkTe8Y/AAAAAAAAAAI/AAAAAAAAFqM/AFAfrQSYkZM/photo.jpg?sz=128", "display_name": "Steven Kaufman", "link": "https://stackoverflow.com/users/9638678/steven-kaufman"}, "edited": false, "score": 0, "creation_date": 1599261718, "post_id": 31028337, "comment_id": 112729923, "body": "Absolutely you can ignore errors in TESTING, where a panic is okay. Ergo httptest.NewRequest (identical to http.NewRequest except it will panic instead of error) FOR TESTING."}], "tags": [], "owner": {"reputation": 2861, "user_id": 929510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z568f.png?s=128&g=1", "display_name": "Staven", "link": "https://stackoverflow.com/users/929510/staven"}, "is_accepted": true, "score": 4, "last_activity_date": 1435153470, "creation_date": 1435153470, "answer_id": 31028337, "question_id": 31027579, "link": "https://stackoverflow.com/questions/31027579/how-to-ignore-returned-error-in-go/31028337#31028337", "title": "how to ignore returned error in GO", "body": "<p>The <em>real</em> answer is: Don't.</p>\n\n<p>Never just ignore the errors.</p>\n\n<p>Seriously. The errors are there for a reason. If a function returns an error,\nit almost always means that it's possible, during the operation of your program,\n<em>even if it's 100% bug-free</em>, for the function to fail. And if it does,\nyou don't usually want to just keep going as if nothing happened.</p>\n\n<p>If you're absolutely sure that you're using a function in a way that ensures that it will <em>never</em> return a non-nil error (unless there's a bug in your program, and there always is), you might want to write a <code>Must</code>-style function like in the <a href=\"http://golang.org/pkg/html/template/#Must\" rel=\"nofollow noreferrer\"><code>template</code> package</a> which panics with the returned error value.</p>\n\n<p>Error handling is not noise. It's not clutter. It's not something you want\nto get rid of. If it looks like 50% of your program is error\nhandling, that's because 50% of your program is, and should be, error handling.</p>\n"}, {"tags": [], "owner": {"reputation": 1723, "user_id": 1178663, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/aee59e011d5f1e561052f8516125a286?s=128&d=identicon&r=PG", "display_name": "okdewit", "link": "https://stackoverflow.com/users/1178663/okdewit"}, "is_accepted": false, "score": 2, "last_activity_date": 1567157229, "creation_date": 1567157229, "answer_id": 57724043, "question_id": 31027579, "link": "https://stackoverflow.com/questions/31027579/how-to-ignore-returned-error-in-go/57724043#57724043", "title": "how to ignore returned error in GO", "body": "<p>One possible abstraction pattern you will often see is to use a generic error handler.</p>\n\n<p>This doesn't prevent you from having to <strong>deal</strong> with error values, but it does <strong>abstract</strong> the handling of errors away from the rest of your code. </p>\n\n<p>Note that abstractions like these are considered \"non-idiomatic\" Go, the \"pure\" way is to explicitly handle errors in-place. This panic-driven alternative can still be very useful though, especially for quickly prototyping a script where you just want to dump all the errors in a console or logfile. </p>\n\n<p>For reusable packages, I would stick to the verbose explicit way though, because others will expect error-producing functions to actually return error values, rather than using a panic-recover mechanism.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    utils\n)\n\nfunc main() {\n    defer func() {\n        utils.Handle(func(err error) {\n            // Handle errors in a generic way, \n            // for example using println, or writing to http \n        })\n    }()\n\n    var result, err := someFragileFunction()\n    Check(err)\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package utils\n\nfunc Check(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n\nfunc Handle(handler func(err error))  {\n    if r := recover(); r != nil {\n        if err, ok := r.(error); ok {\n            handler(err)\n        } else {\n            panic(r)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1943, "user_id": 579024, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mccLr.jpg?s=128&g=1", "display_name": "Dani-Br", "link": "https://stackoverflow.com/users/579024/dani-br"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6636, "favorite_count": 0, "accepted_answer_id": 31028337, "answer_count": 3, "score": 4, "last_activity_date": 1567157229, "creation_date": 1435151556, "last_edit_date": 1435152640, "question_id": 31027579, "link": "https://stackoverflow.com/questions/31027579/how-to-ignore-returned-error-in-go", "title": "how to ignore returned error in GO", "body": "<p>I have started learning Go today.<br>\nOne thing that makes me crazy, it's the <code>err</code> returned parameter.  </p>\n\n<p>Let's assume I need to nest few functions. like this:  </p>\n\n<pre><code>return string(json.Marshal(MyData))\n</code></pre>\n\n<p>or more complex example:  </p>\n\n<pre><code>return func1(func2(func3(MyData)))\n</code></pre>\n\n<p>Is it really necessary to write:  </p>\n\n<pre><code>tmp1 , _ = func3(MyData)\ntmp2 , _ = func2(tmp1)\ntmp3 , _ = func1(tmp2)\nreturn tmp3\n</code></pre>\n\n<p>That's annoying!<br>\nIs there any way to make the code looks cleaner?</p>\n"}, {"tags": ["list", "go", "containers"], "answers": [{"comments": [{"owner": {"reputation": 1193, "user_id": 2182996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57a529bc8861d5f54c464466a2aacb27?s=128&d=identicon&r=PG", "display_name": "Baptiste Donaux", "link": "https://stackoverflow.com/users/2182996/baptiste-donaux"}, "edited": false, "score": 0, "creation_date": 1435151145, "post_id": 31027136, "comment_id": 50079307, "body": "It works and with documentation I could resolve my futures problems."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 6, "last_activity_date": 1435150360, "creation_date": 1435150360, "answer_id": 31027136, "question_id": 31026980, "link": "https://stackoverflow.com/questions/31026980/foo-name-undefined-type-interface-has-no-field-or-method-name/31027136#31027136", "title": "foo.Name undefined (type interface {} has no field or method Name)", "body": "<p>You need to do type-assertion for <code>foo</code> into <code>*inotify.Event</code>, the stack doesn't know what it is, it just holds <code>interface{}</code> objects.</p>\n\n<p>What you need to do is something like:</p>\n\n<pre><code>elem := stack.Front().Value\nif foo, ok := elem.(*inotify.Event); ok {\n       fmt.Printf(\"%#v\\n\", foo)\n       log.Println(\"Name: \", foo.Name)\n}\n</code></pre>\n\n<p>The <code>ok</code> bit makes sure if it's <strong>not</strong> an event, your program won't crash. Of course you need to handle the case that it isn't.</p>\n\n<p>More info on interface conversions and type assertions: <a href=\"https://golang.org/doc/effective_go.html#interface_conversions\">https://golang.org/doc/effective_go.html#interface_conversions</a></p>\n"}], "owner": {"reputation": 1193, "user_id": 2182996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57a529bc8861d5f54c464466a2aacb27?s=128&d=identicon&r=PG", "display_name": "Baptiste Donaux", "link": "https://stackoverflow.com/users/2182996/baptiste-donaux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3062, "favorite_count": 0, "accepted_answer_id": 31027136, "answer_count": 1, "score": 2, "last_activity_date": 1435150372, "creation_date": 1435149938, "question_id": 31026980, "link": "https://stackoverflow.com/questions/31026980/foo-name-undefined-type-interface-has-no-field-or-method-name", "title": "foo.Name undefined (type interface {} has no field or method Name)", "body": "<p>I use the native golang package \"container/list\" to manage inotify event in a stack. When I access at stack's item, I have a fail with the type (I think).</p>\n\n<pre><code>import (\n    \"golang.org/x/exp/inotify\" \n    \"container/list\"\n    \"log\"\n    \"fmt\"\n)\n\nfunc main() {\n    stack := list.New()\n    watcher, err := inotify.NewWatcher()\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n   err = watcher.Watch(os.Args[1])\n   if err != nil {\n       log.Fatal(err)\n   }\n\n   for {\n       select {\n           case ev := &lt;-watcher.Event:\n               stack.PushFront(ev)\n\n               fmt.Printf(\"%#v\\n\", ev)\n        }\n\n        foo := stack.Front().Value\n\n        fmt.Printf(\"%#v\\n\", foo)\n        log.Println(\"Name: \", foo.Name)\n    }\n}\n</code></pre>\n\n<p>When I dump <strong>ev</strong> variable, the object type is <strong>&amp;inotify.Event</strong>.\nWhen I pop one item and I dump the variable, my object type is <strong>&amp;inotify.Event</strong>.</p>\n\n<p>With the error message I think it's a problem with type object accept by interface but I don't find how define type.</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 2, "creation_date": 1435151871, "post_id": 31026593, "comment_id": 50079886, "body": "You&#39;re not checking the error return value from <code>d.Download(fd, params)</code>. Does it return something?"}, {"owner": {"reputation": 349, "user_id": 1105455, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/bb3df7fbe32bd0cadfebe973722133f5?s=128&d=identicon&r=PG", "display_name": "Chris Kong", "link": "https://stackoverflow.com/users/1105455/chris-kong"}, "reply_to_user": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 1, "creation_date": 1435197030, "post_id": 31026593, "comment_id": 50103440, "body": "@jcbwlkr You are right! It turns out that <code>d.Download(fd, params)</code> return an error indicating that there is no region setting in my s3manager. I managed that by <code>manager := s3manager.NewDownloader(&amp;s3manager.DownloadOptions{S3: client})</code>, of which client is already set with a region. Thank you very much!"}], "owner": {"reputation": 349, "user_id": 1105455, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/bb3df7fbe32bd0cadfebe973722133f5?s=128&d=identicon&r=PG", "display_name": "Chris Kong", "link": "https://stackoverflow.com/users/1105455/chris-kong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1044, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1481571356, "creation_date": 1435148946, "question_id": 31026593, "link": "https://stackoverflow.com/questions/31026593/go-fail-to-download-from-s3-using-s3manager", "title": "Go - Fail to download from s3 using s3manager", "body": "<p>I'm using the script from this post to download files from s3.\nEverything works fine except the downloaded files are all 0B.</p>\n\n<p>My script are basically the same as the script above.\nI use <code>~/.aws/credentials</code> to set my keys and set region in the script.</p>\n\n<p>Here is my script:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"path/filepath\"\n\n    \"github.com/aws/aws-sdk-go/service/s3\"\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/service/s3/s3manager\"\n)\n\nvar (\n    Bucket         = \"logs\" // Download from this bucket\n    Prefix         = \"local-dir/my_log/20150611/20150611\"    // Using this key prefix\n    LocalDirectory = \"s3logs\"   // Into this directory\n)\n\nfunc main() {\n    manager := s3manager.NewDownloader(nil)\n    d := downloader{bucket: Bucket, dir: LocalDirectory, Downloader: manager}\n\n    client := s3.New(&amp;aws.Config{Region: \"ap-northeast-1\"})\n    params := &amp;s3.ListObjectsInput{Bucket: &amp;Bucket, Prefix: &amp;Prefix}\n    client.ListObjectsPages(params, d.eachPage)\n}\n\ntype downloader struct {\n    *s3manager.Downloader\n    bucket, dir string\n}\n\nfunc (d *downloader) eachPage(page *s3.ListObjectsOutput, more bool) bool {\n    for _, obj := range page.Contents {\n        d.downloadToFile(*obj.Key)\n    }\n\n    return true\n}\n\nfunc (d *downloader) downloadToFile(key string) {\n    // Create the directories in the path\n    file := filepath.Join(d.dir, key)\n\n    if err := os.MkdirAll(filepath.Dir(file), 0775); err != nil {\n      panic(err)\n    }\n    fmt.Printf(\"Downloading \" + key)\n    // Setup the local file\n    fd, err := os.Create(file)\n    if err != nil {\n        panic(err)\n    }\n\n    defer fd.Close()\n\n    // Download the file using the AWS SDK\n    fmt.Printf(\"Downloading s3://%s/%s to %s...\\n\", d.bucket, key, file)\n    params := &amp;s3.GetObjectInput{Bucket: &amp;d.bucket, Key: &amp;key}\n    d.Download(fd, params)\n}\n</code></pre>\n\n<p>The script listed the objects in the bucket very well, but did not download files into my local file system. And the script did not run into any exception.</p>\n\n<p>Any idea why?\nThanks!</p>\n"}, {"tags": ["go", "type-conversion", "complex-numbers"], "answers": [{"comments": [{"owner": {"reputation": 11224, "user_id": 1620937, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/689410968ffb0f422e790bd6a48b3d9e?s=128&d=identicon&r=PG", "display_name": "Orab&#238;g", "link": "https://stackoverflow.com/users/1620937/orab%c3%aeg"}, "edited": false, "score": 0, "creation_date": 1435137779, "post_id": 31022598, "comment_id": 50070153, "body": "Thx, you&#39;re right, that was what I was searching for."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1485413564, "last_edit_date": 1485413564, "creation_date": 1435137586, "answer_id": 31022598, "question_id": 31022456, "link": "https://stackoverflow.com/questions/31022456/how-to-convert-float-to-complex/31022598#31022598", "title": "How to convert float to complex?", "body": "<p>You don't really want to convert a <code>float64</code> to <code>complex128</code> but rather you want to construct a <code>complex128</code> value where you specify the real part.</p>\n\n<p>For that can use the builtin <a href=\"https://golang.org/pkg/builtin/#complex\" rel=\"nofollow noreferrer\"><code>complex()</code></a> function:</p>\n\n<pre><code>func complex(r, i FloatType) ComplexType\n</code></pre>\n\n<p>Using it your <code>sqrt()</code> function:</p>\n\n<pre><code>func sqrt(x float64) string {\n    if x &lt; 0 {\n        return fmt.Sprint(cmplx.Sqrt(complex(x, 0)))\n    }\n    return fmt.Sprint(math.Sqrt(x))\n}\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/h1ADHAdvoA\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p><strong>Note:</strong></p>\n\n<p>You can calculate the square root of a negative <code>float</code> number without using complex numbers: it will be a complex value whose real part is <code>0</code> and imaginary part is <code>math.Sqrt(-x)i</code> (so the result: <code>(0+math.Sqrt(-x)i)</code>):</p>\n\n<pre><code>func sqrt2(x float64) string {\n    if x &lt; 0 {\n        return fmt.Sprintf(\"(0+%.15fi)\", math.Sqrt(-x))\n    }\n    return fmt.Sprint(math.Sqrt(x))\n}\n</code></pre>\n"}], "owner": {"reputation": 11224, "user_id": 1620937, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/689410968ffb0f422e790bd6a48b3d9e?s=128&d=identicon&r=PG", "display_name": "Orab&#238;g", "link": "https://stackoverflow.com/users/1620937/orab%c3%aeg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3000, "favorite_count": 0, "accepted_answer_id": 31022598, "answer_count": 1, "score": 1, "last_activity_date": 1549205511, "creation_date": 1435137214, "last_edit_date": 1549205511, "question_id": 31022456, "link": "https://stackoverflow.com/questions/31022456/how-to-convert-float-to-complex", "title": "How to convert float to complex?", "body": "<p>With the very simple code :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"math/cmplx\"\n)\n\nfunc sqrt(x float64) string {\n    if x &lt; 0 {\n        return fmt.Sprint(cmplx.Sqrt(complex128(x)))\n    }\n    return fmt.Sprint(math.Sqrt(x))\n}\n\nfunc main() {\n    fmt.Println(sqrt(2), sqrt(-4))\n}\n</code></pre>\n\n<p>I get the following error message :</p>\n\n<pre><code>main.go:11: cannot convert x (type float64) to type complex128\n</code></pre>\n\n<p>I tried different ways, but couldn't find out how to convert a <code>float64</code> to <code>complex128</code> (just to be able to use <code>cmplx.Sqrt()</code> function on a negative number).</p>\n\n<p>Which is the correct way to handle this ?</p>\n"}, {"tags": ["mongodb", "google-chrome", "go", "safari", "gridfs"], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 3547480, "user_type": "registered", "profile_image": "https://graph.facebook.com/581884642/picture?type=large", "display_name": "user3547480", "link": "https://stackoverflow.com/users/3547480/user3547480"}, "edited": false, "score": 0, "creation_date": 1435134709, "post_id": 31021144, "comment_id": 50068187, "body": "yep that&#39;s the problem, should be w.Write(buff[:nread]), thank you!!"}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 2, "last_activity_date": 1435133451, "creation_date": 1435133451, "answer_id": 31021144, "question_id": 31020545, "link": "https://stackoverflow.com/questions/31020545/chrome-and-safari-dont-render-images-in-html-template-served-by-a-go-server-wit/31021144#31021144", "title": "chrome and safari don&#39;t render images in html template served by a go server with Content-Length is set", "body": "<p>the line <code>w.Write(buff)</code> always to write 8192 bytes, which cause the total length of you HTTP body not equals to the file size.</p>\n"}], "owner": {"reputation": 9, "user_id": 3547480, "user_type": "registered", "profile_image": "https://graph.facebook.com/581884642/picture?type=large", "display_name": "user3547480", "link": "https://stackoverflow.com/users/3547480/user3547480"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1435133451, "creation_date": 1435131543, "question_id": 31020545, "link": "https://stackoverflow.com/questions/31020545/chrome-and-safari-dont-render-images-in-html-template-served-by-a-go-server-wit", "title": "chrome and safari don&#39;t render images in html template served by a go server with Content-Length is set", "body": "<p>I stored some images on GridFS and served the resource with a simple Go web server.</p>\n\n<pre><code>func GetFile(w http.ResponseWriter, r *http.Request) {\n    fileObjectId := r.URL.Path[len(\"/file/\"):]\n    gfs := db.GridFS(\"fs\")\n    file, err := gfs.OpenId(bson.ObjectIdHex(fileObjectId))\n    if err != nil {\n        panic(\"file not found\")\n    }\n    w.Header().Set(\"Content-Length\", strconv.FormatInt(file.Size(), 10))\n    w.Header().Set(\"Content-Type\", file.ContentType())\n\n    buff := make([]byte, 8192)\n    nread, _ := file.Read(buff)\n    for nread &gt; 0 {\n        w.Write(buff)\n        nread, _ = file.Read(buff)\n    }\n}\n</code></pre>\n\n<p>The problems:</p>\n\n<p>a. Images don't render in Chrome and Safari if they are placed in img tag in a html template. But firefox does display images pretty well.</p>\n\n<p>b. If access images directly in Chrome and Safari, everything works fine.</p>\n\n<p>c. By removing Content-Length, Chrome and Safari can load images in a html template.</p>\n\n<p>d. I code the same handler with python and pymongo, set both Content-Length and Content-Type, it works in Chrome and Safari.</p>\n"}, {"tags": ["csv", "web", "go", "beego"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1435157937, "post_id": 31018042, "comment_id": 50084623, "body": "FYI (you probably know this, I assume the above code was simplified for the question; but for other readers), if you&#39;re going to loop per record anyway you could just call <code>Write([]string{\u2026})</code> per record rather than storing it in a <code>[][]string</code>. If however you do want to process them all first and store them in a <code>[][]string</code> then you can use <a href=\"https://golang.org/pkg/encoding/csv/#Writer.WriteAll\" rel=\"nofollow noreferrer\"><code>WriteAll</code></a> to write all the records instead of looping again yourself."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1435127618, "last_edit_date": 1435127618, "creation_date": 1435126995, "answer_id": 31019074, "question_id": 31018042, "link": "https://stackoverflow.com/questions/31018042/output-to-csv-file-dumps-the-data-to-browser-but-not-dump-to-file/31019074#31019074", "title": "Output to csv file dumps the data to browser but not dump to file", "body": "<p>You should always set response headers <strong>first</strong> and only after that start writing any data to the output. I know you called <code>writer.Flush()</code> after setting header fields, but that is no guarantee whatsoever that data will not be flushed or sent before that - which will imply default headers being sent. After this no additional headers can be sent or changed.</p>\n\n<p>Also the proper mime type for CSV is <code>text/csv</code> not <code>application/csv</code> (<a href=\"http://tools.ietf.org/html/rfc4180\" rel=\"nofollow\">rfc4180</a>).</p>\n\n<p>Also the headers are more like a <em>\"proposal\"</em> to the browser. That's one thing you suggest the response is a file to be saved, but from the server side you can't force the browser to really save the response to a file and not display it.</p>\n\n<p>See <a href=\"http://www.ietf.org/rfc/rfc1806.txt\" rel=\"nofollow\">rfc1806</a>, <a href=\"http://www.ietf.org/rfc/rfc2183.txt\" rel=\"nofollow\">rfc2183</a> and <a href=\"http://tools.ietf.org/html/rfc6266\" rel=\"nofollow\">rfc6266</a> for more details about the <code>\"Content-Disposition\"</code> header field. Basically it communicates presentation information.</p>\n\n<blockquote>\n  <p>The Content-Disposition response header field is used to convey\n     additional information about how to process the response payload, and\n     also can be used to attach additional metadata, such as the filename\n     to use when saving the response payload locally.</p>\n</blockquote>\n"}], "owner": {"reputation": 1001, "user_id": 4160965, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/fbb0ff599a13cc579cbac731d8d38a81?s=128&d=identicon&r=PG&f=1", "display_name": "want_to_be_calm", "link": "https://stackoverflow.com/users/4160965/want-to-be-calm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1513, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1573921573, "creation_date": 1435122378, "last_edit_date": 1573921573, "question_id": 31018042, "link": "https://stackoverflow.com/questions/31018042/output-to-csv-file-dumps-the-data-to-browser-but-not-dump-to-file", "title": "Output to csv file dumps the data to browser but not dump to file", "body": "<p>I tried to ouput some data to csv file in golang beego framework, here is my code</p>\n\n<pre><code>records := make([][]string,len(devicesData))\n\nfor k,v := range devicesData{\n    records[k] = []string{v.Fields.Country,v.Fields.Imei[0],v.Fields.Number[0]}\n}\n\nwriter := csv.NewWriter(this.Controller.Ctx.ResponseWriter)\nfor _, record := range records {\n    err := writer.Write(record)\n    if err != nil {\n        fmt.Println(\"Error:\", err)\n        return\n    }\n}\n\nthis.Ctx.Output.Header(\"Content-Type\", \"application/csv\")\nthis.Ctx.Output.Header(\"Content-Disposition\", \"attachment; filename=MyVerySpecial.csv\")\n\n    writer.Flush()\n</code></pre>\n\n<p>However, it only shows the record data in browser, it cannot download the file. I have some loging controller and filter function before this download file controller, I do not whether it is affected. What's wrong with my code? Thanks</p>\n"}, {"tags": ["go", "exec", "stdout", "buffering"], "answers": [{"comments": [{"owner": {"reputation": 1782, "user_id": 497142, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/62bc5ef616d250ee3dceeb7a24943ed3?s=128&d=identicon&r=PG", "display_name": "Sean Kelleher", "link": "https://stackoverflow.com/users/497142/sean-kelleher"}, "edited": false, "score": 0, "creation_date": 1435134574, "post_id": 31015992, "comment_id": 50068097, "body": "Perfect answer, thanks! Just for future reference, I was curious as to how Python knows that stdout is a terminal in the latter case and found that the general approach is to use <a href=\"https://en.wikipedia.org/wiki/Ioctl#Unix\" rel=\"nofollow noreferrer\">ioctl</a>."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1435157447, "post_id": 31015992, "comment_id": 50084260, "body": "BTW, Linux (actually GNU coreutils) and FreeBSD (and possibly others) have <code>stdbuf</code> which changes the initial buffering of arbitrary commands. Useful for commands that don&#39;t have options (like the <code>-u</code> shown here or grep&#39;s <code>--line-buffered</code>) for doing it directly."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1435109478, "last_edit_date": 1435109478, "creation_date": 1435108283, "answer_id": 31015992, "question_id": 31015754, "link": "https://stackoverflow.com/questions/31015754/getting-output-from-exec-cmd-in-real-time/31015992#31015992", "title": "Getting output from `exec.Cmd` in &quot;real-time&quot;", "body": "<p>Python buffers stdout by default. Try this program:</p>\n\n<pre><code>import sys\nprint \"hello\"\nsys.stdout.flush()\nwhile True:\n    pass\n</code></pre>\n\n<p>or run Python with unbuffered stdout and stderr:</p>\n\n<pre><code>cmd := exec.Command(\"python\", \"-u\", \"foo.py\")\n</code></pre>\n\n<p>Note the -u flag.</p>\n\n<p>You see different results when using <code>cmd.Stout = os.Stdout</code> because Python uses line buffering when stdout is a terminal.</p>\n"}], "owner": {"reputation": 1782, "user_id": 497142, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/62bc5ef616d250ee3dceeb7a24943ed3?s=128&d=identicon&r=PG", "display_name": "Sean Kelleher", "link": "https://stackoverflow.com/users/497142/sean-kelleher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1013, "favorite_count": 2, "accepted_answer_id": 31015992, "answer_count": 1, "score": 3, "last_activity_date": 1435109478, "creation_date": 1435106315, "last_edit_date": 1495539894, "question_id": 31015754, "link": "https://stackoverflow.com/questions/31015754/getting-output-from-exec-cmd-in-real-time", "title": "Getting output from `exec.Cmd` in &quot;real-time&quot;", "body": "<p>This question is similar to <a href=\"https://stackoverflow.com/questions/25190971/golang-copy-exec-output-to-log\">Golang - Copy Exec output to Log</a> except it is concerned with the buffering of output from <code>exec</code> commands.</p>\n\n<p>I have the following test program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"python\", \"inf_loop.py\")\n    var out outstream\n    cmd.Stdout = out\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(cmd.Wait())\n}\n\ntype outstream struct{}\n\nfunc (out outstream) Write(p []byte) (int, error) {\n    fmt.Println(string(p))\n    return len(p), nil\n}\n</code></pre>\n\n<p><code>inf_loop.py</code>, which the above refers to, simply contains:</p>\n\n<pre><code>print \"hello\"\nwhile True:\n    pass\n</code></pre>\n\n<p>The go program hangs when I run it and doesn't output anything, but if I use <code>os.Stdout</code> instead of <code>out</code> then it outputs \"hello\" before it hangs. Why is there a discrepancy between the two <code>io.Writer</code>s and how can it be fixed?</p>\n\n<p>Some more diagnostic information:</p>\n\n<ul>\n<li>When the loop is removed from <code>inf_loop.py</code> then \"hello\" is output from both programs, as expected.</li>\n<li>When using <code>yes</code> as the program instead of the python script and outputting <code>len(p)</code> in <code>outstream.Write</code> then there is output, and the output is usually 16384 or 32768. This indicates to me that this is a buffering issue, as I originally anticipated, but I still don't understand why the <code>outstream</code> structure is being blocked by buffering but <code>os.Stdout</code> isn't. One possibility is that the behaviour is the result of the way that <code>exec</code> passes the <code>io.Writer</code> directly to <code>os.StartProcess</code> if it is an <code>os.File</code> (see <a href=\"https://golang.org/src/os/exec/exec.go#L209\" rel=\"nofollow noreferrer\">source</a> for details), otherwise it creates an <code>os.Pipe()</code> between the process and the <code>io.Writer</code>, and this pipe may be causing the buffering. However, the operation and possible buffering of <code>os.Pipe()</code> is too low-level for me to investigate.</li>\n</ul>\n"}, {"tags": ["json", "parsing", "go"], "answers": [{"comments": [{"owner": {"reputation": 11762, "user_id": 14540, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/c4ceadae4f61dac8ff3ababc3faa6c42?s=128&d=identicon&r=PG", "display_name": "kolrie", "link": "https://stackoverflow.com/users/14540/kolrie"}, "edited": false, "score": 0, "creation_date": 1435100673, "post_id": 31014853, "comment_id": 50056552, "body": "Thank you so much. When you answered, it became obvious. But the same is true for almost all hard problems :)"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 6, "last_activity_date": 1435100181, "creation_date": 1435100181, "answer_id": 31014853, "question_id": 31014838, "link": "https://stackoverflow.com/questions/31014838/parsing-json-into-a-struct/31014853#31014853", "title": "Parsing JSON into a struct", "body": "<p>The problem is that you're representing <code>Workspaces</code> as an array in your model but it's a dictionary/map in the json. Just make it a <code>map[sting]Workspace</code> and you should be good. First item would be had with <code>instance.Workspaces[\"11\"]</code></p>\n\n<p>A couple hints as to how I knew that; 1) Workspaces is opened with a brace <code>{</code>, an array is never the right type for this (they always are enclosed by <code>[]</code> in json), it's an object or a map. 2) the items within it are denoted like <code>\"11\": { ... }</code>. That means if I represent it with an object in Go I need a property named <code>11</code>, <code>12</code> ect, it's pretty safe to assume that's not what you want here meaning it must be a map.</p>\n"}], "owner": {"reputation": 11762, "user_id": 14540, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/c4ceadae4f61dac8ff3ababc3faa6c42?s=128&d=identicon&r=PG", "display_name": "kolrie", "link": "https://stackoverflow.com/users/14540/kolrie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 31014853, "answer_count": 1, "score": 0, "last_activity_date": 1438071144, "creation_date": 1435100075, "question_id": 31014838, "link": "https://stackoverflow.com/questions/31014838/parsing-json-into-a-struct", "title": "Parsing JSON into a struct", "body": "<p>I have successfully parsed JSON into structs when they have a regular key-value format.</p>\n\n<p>However, how can I parse a JSON like this:</p>\n\n<pre><code>{\n  \"count\": 2,\n  \"results\": [{ key: \"workspaces\", id: \"10\" }, { key: \"workspaces\", id: \"11\" }],\n  \"workspaces\": {\n    \"10\": {\n      id: \"10\",\n      title: \"some project\",\n      participant_ids: [\"2\", \"6\"],\n      primary_counterpart_id: \"6\"\n    },\n    \"11\": {\n      id: \"11\",\n      title: \"another project\",\n      participant_ids: [\"2\", \"8\"],\n      primary_counterpart_id: \"8\"\n    }\n  }\n}\n</code></pre>\n\n<p>Where the keys for the <code>workspaces</code> section is not defined ahead of time, but instead holds the workspace id? </p>\n\n<p>My initial structs were:</p>\n\n<pre><code>type WorkspaceRequest struct {\n    Count      int64       `json:\"count\"`\n    Workspaces []Workspace `json:\"workspaces\"`\n}\n\ntype Workspace struct {\n    Title string `json:\"title\"`\n}\n</code></pre>\n\n<p>How can I get a list of Workspaces from the shown JSON?</p>\n"}, {"tags": ["go", "garbage-collection", "finalizer", "canonicalization"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1435089000, "post_id": 31011765, "comment_id": 50051149, "body": "I assume you&#39;re talking about using runtime.SetFinalizer? I think you need to show some of your implementation. How are you holding the references within your data structure, since if there are any live pointers they won&#39;t be GC&#39;ed and the finalizer won&#39;t be run."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1435089177, "post_id": 31011765, "comment_id": 50051253, "body": "@JimB  - Yes, runtime.SetFinalizer(), edited above."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1435089250, "post_id": 31011765, "comment_id": 50051293, "body": "@JimB - I&#39;m not asking why finalizers are not being run in my cache implementation, they are (eventually).   What I&#39;m asking is how to &quot;trigger&quot; them to run on-demand so that I can write a test case with the &quot;testing&quot; package, rather than just having to observe them being cleaned up in the integrated, long-running, non-unit-test scenario...."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1435089383, "post_id": 31011765, "comment_id": 50051392, "body": "Attempt at the unit test is here:  <a href=\"http://pastebin.com/bZHjDaXc\" rel=\"nofollow noreferrer\">pastebin.com/bZHjDaXc</a>  It&#39;s the last error that is happening, and the reference structure is just an int count and a reference to the object.   (The object does not hold a reference to the reference - I mention this b/c the docs indicate finalizers will not be called on circular reference chians.)  The equivalent condition in the &quot;long running program&quot; does not occur."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1435090087, "post_id": 31011765, "comment_id": 50051767, "body": "In general, <code>runtime.GC</code> will trigger the finalizers, <i>eventually</i>. If you look at <code>runtime&#47;mfinal_test.go</code>, you can see simple tests where they wait for the finalizer to be called via a channel after calling <code>runtime.GC</code>."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1435090594, "post_id": 31011765, "comment_id": 50052048, "body": "Awesome.   So it&#39;s a time thing and not a memory use thing.   Exactly what I was looking for, TYVM.   Make this an answer!"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1435090751, "post_id": 31011765, "comment_id": 50052118, "body": "I remember reading somewhere that finalizers have a high chance of getting dumped after Go 1, just an FYI."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1435090881, "post_id": 31011765, "comment_id": 50052195, "body": "@thwd: well after go1, would be go2 which would be a different language that has no planned release date, so I don&#39;t think we need to worry about that at the moment."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1435090948, "post_id": 31011765, "comment_id": 50052236, "body": "@thwd Presumably go2 would have another mechanism for dealing with this sort of thing - there isn&#39;t even a spec yet, so no sense in planning for it."}], "answers": [{"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1435091577, "post_id": 31012791, "comment_id": 50052625, "body": "Waiting here was the thing I wasn&#39;t doing!   Tests work great now, thanks. (Compared to Java eg, gc request may be started but not finished when the gc request call returns)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1435091037, "creation_date": 1435091037, "answer_id": 31012791, "question_id": 31011765, "link": "https://stackoverflow.com/questions/31011765/finalizer-testing-in-go/31012791#31012791", "title": "Finalizer testing in Go", "body": "<p>You can't explicitly trigger a Finalizer, so the best you can manage is to make sure the GC is started with <code>runtime.GC()</code>, and wait for the finalizer to run.</p>\n\n<p>If you look at <code>runtime/mfinal_test.go</code>, there are some tests that wait for finalizer calls via a channel:</p>\n\n<pre><code>runtime.SetFinalizer(y, func(z *objtype) { fin &lt;- true })\nruntime.GC()\nselect {\ncase &lt;-fin:\ncase &lt;-time.After(4 * time.Second):\n    t.Errorf(\"finalizer of next string in memory didn't run\")\n}\n</code></pre>\n"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 754, "favorite_count": 0, "accepted_answer_id": 31012791, "answer_count": 1, "score": 3, "last_activity_date": 1435091037, "creation_date": 1435087583, "last_edit_date": 1435089148, "question_id": 31011765, "link": "https://stackoverflow.com/questions/31011765/finalizer-testing-in-go", "title": "Finalizer testing in Go", "body": "<p><em>TLDR</em>: Is there any way to reasonably write test cases to test finalizer behaviors?</p>\n\n<p>I'm trying to implement a memory-sensitive canonicalizing map / cache in Go.   Since there is no notion of \"soft reference\" (and because my object graph will always form a DAG), I'm accomplishing this with a tiny interface/framework that tracks counts of references in the userland:</p>\n\n<pre><code>type ReferenceCounted interface {\n   RefCount() int\n   IncRef()\n   DecRef() (bool, error)\n}\n\ntype Finalizable interface {\n   ReferenceCounted\n   Finalize()\n}\n\ntype AbstractCounted struct {\n     // unexported fields\n}\n</code></pre>\n\n<p>The way this works is that you have a struct which embeds AbstractCounted, and implement <code>Finalizable.Finalize()</code> - these together make that struct receive the <code>Finalizable</code> interface.  Then there is a function <code>func MakeRef(obj Finalizable) *Reference</code> which returns a pointer to a struct which receives a method <code>func Get() Finalizable</code>, which gets the reference target, and which is initialized by incrementing the ref count on the unerlying object, then setting a finalizer (via <code>runtime.SetFinalizer()</code>) which will decrement the reference.  <code>AbstractCounted</code>'s <code>Finalizable</code> implementation in turn calls <code>Finalize()</code> on the struct which embeds it when the ref count reaches zero.</p>\n\n<p>So, everything is set up to work very much like soft references / ref queues in Java would now, with the exception that it's reference counting and not a mark/sweep rooted in active lexical scopes that is finding things \"softly\" reachable.</p>\n\n<p>It seems to work great!   But - I would like to write a test case...  </p>\n\n<p>I understand fully that finalizer invocation is deferred, and that no guarantees are made about running them per the <code>reflect</code> package docs.  The situation is the same in other languages with runtime gc and finalizers (C#, VB, Java, Python, etc) as well.</p>\n\n<p>However, in all of those other languages, requesting explicit GC (here through the <code>runtime.GC()</code> function) does seem to cause finalizers to get run. Since that's not the case in Go, I cannot figure out a way to write a test case that will trigger the finalizers.</p>\n\n<p>Is there any trick or code fragment (I'm OK with this being current-implementation dependent, ie. could-break-in-future!) that will reliably trigger those finalizers so I can write my test?</p>\n"}, {"tags": ["java", "go", "distributed", "hazelcast", "etcd"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1435087228, "post_id": 31011105, "comment_id": 50050081, "body": "though off topic here, I would note that etdc and hazelcast are <i>very</i> different things, and comparing them may not be useful."}, {"owner": {"reputation": 605, "user_id": 983835, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/DGXZW.png?s=128&g=1", "display_name": "The Architect", "link": "https://stackoverflow.com/users/983835/the-architect"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1435088078, "post_id": 31011105, "comment_id": 50050598, "body": "Hi, JimB! I am a newbie in such things so I asked for differences/similarities of this technologies, so if you know the answer, could you please share your knowledge with me. Thank you!"}, {"owner": {"reputation": 6335, "user_id": 1766816, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYq9v.jpg?s=128&g=1", "display_name": "kuujo", "link": "https://stackoverflow.com/users/1766816/kuujo"}, "edited": false, "score": 2, "creation_date": 1435095537, "post_id": 31011105, "comment_id": 50054739, "body": "I don&#39;t know why people are downvoting this. A lack of knowledge about distributed systems should not be downvoted on a QA forum."}], "answers": [{"comments": [{"owner": {"reputation": 605, "user_id": 983835, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/DGXZW.png?s=128&g=1", "display_name": "The Architect", "link": "https://stackoverflow.com/users/983835/the-architect"}, "edited": false, "score": 0, "creation_date": 1435097074, "post_id": 31014203, "comment_id": 50055408, "body": "Thank you very much, your answer is a good starting point for me to go deeper."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1435156927, "post_id": 31014203, "comment_id": 50083900, "body": "I believe non-mobile links (en.wikipedia.org vs. en.m.wikipedia.org) are preferred here (and most places?). The former always takes people to the mobile version where-as the later will (I think) redirect to the mobile version as required (depending on client settings, etc) but send others to the full page."}, {"owner": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "edited": false, "score": 0, "creation_date": 1453012443, "post_id": 31014203, "comment_id": 57412577, "body": "Very lucid explanantion. Thanks a lot!"}, {"owner": {"reputation": 381, "user_id": 979258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24a5132dc0a50df3fb331f05f8cf344d?s=128&d=identicon&r=PG", "display_name": "Basri Kahveci", "link": "https://stackoverflow.com/users/979258/basri-kahveci"}, "edited": false, "score": 4, "creation_date": 1551218770, "post_id": 31014203, "comment_id": 96558818, "body": "A bit clarification based on recent developments: as of Hazelcast IMDG version 3.12, Hazelcast now offers linerizable &amp; distributed implementations of the Java concurrency APIs, like Lock, Semaphore, etc. They are built on top of the Raft consensus algorithm and CP with respect to the CAP principle."}], "tags": [], "owner": {"reputation": 6335, "user_id": 1766816, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CYq9v.jpg?s=128&g=1", "display_name": "kuujo", "link": "https://stackoverflow.com/users/1766816/kuujo"}, "is_accepted": true, "score": 38, "last_activity_date": 1475697534, "last_edit_date": 1475697534, "creation_date": 1435096454, "answer_id": 31014203, "question_id": 31011105, "link": "https://stackoverflow.com/questions/31011105/hazelcast-java-and-etcd-golang-differences-similarities/31014203#31014203", "title": "Hazelcast (Java) and ETCD (golang) differences/similarities?", "body": "<p>Hazelcast and etcd are two very different systems. The reason is the <a href=\"https://en.wikipedia.org/wiki/CAP_theorem\" rel=\"noreferrer\">CAP theorem</a>.</p>\n\n<p>The CAP theorem states that no distributed system can have Consistency, Availability, and Partition-tolerance. Distributed systems normally fall closer to CA or CP. Hazelcast is an AP system, and etcd (being a Raft implementation) is CP. So, your choice is between consistency and availability/performance.</p>\n\n<p>In general, Hazelcast will be much more performant and be able to handle more failures than Raft and etcd, but at the cost of potential data loss or consistency issues. The way Hazelcast works is it partitions data and stores pieces of the data on different nodes. So, in a 5 node cluster, the key \"foo\" may be stored on nodes 1 and 2, and bar may be stored on nodes 3 and 4. You can control the number of nodes to which Hazelcast replicates data via the Hazelcast and map configuration. However, during a network or other failure, there is some risk that you'll see old data or even lose data in Hazelcast.</p>\n\n<p>Alternatively, Raft and etcd is a single-leader highly consistent system that stores data on all nodes. This means it's not ideal for storing large amounts of state. But even during a network failure, etcd can guarantee that your data will remain consistent. In other words, you'll never see old/stale data. But this comes at a cost. CP systems require that a majority of the cluster be alive to operate normally.</p>\n\n<p>The consistency issue may or may not be relevant for basic key-value storage, but it can be extremely relevant to locks. If you're expecting your locks to be consistent across the entire cluster - meaning only one node can hold a lock even during a network or other failure - do <em>not</em> use Hazelcast. Because Hazelcast sacrifices consistency in favor of availability (again, see th CAP theorem), it's entirely possible that a network failure can lead two nodes to believe a lock is free to be acquired.</p>\n\n<p>Alternatively, Raft guarantees that during a network failure only one node will remain the leader of the etcd cluster, and therefore all decisions are made through that one node. This means that etcd can guarantee it has a consistent view of the cluster state at all times and can ensure that something like a lock can only be obtained by a single process.</p>\n\n<p>Really, you need to consider what you are looking for in your database and go seek it out. The use cases for CP and AP data stores are vastly different. If you want consistency for storing small amounts of state, consistent locks, leader elections, and other coordination tools, use a CP system like ZooKeeper or Consul. If you want high availability and performance at the potential cost of consistency, use Hazelcast or Cassandra or Riak.</p>\n\n<p>Source: I am the author of <a href=\"http://github.com/kuujo/copycat\" rel=\"noreferrer\">a Raft implementation</a></p>\n"}, {"tags": [], "owner": {"reputation": 206, "user_id": 1267475, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7JQrJ.png?s=128&g=1", "display_name": "David Brimley", "link": "https://stackoverflow.com/users/1267475/david-brimley"}, "is_accepted": false, "score": 8, "last_activity_date": 1551195501, "creation_date": 1551195501, "answer_id": 54889118, "question_id": 31011105, "link": "https://stackoverflow.com/questions/31011105/hazelcast-java-and-etcd-golang-differences-similarities/54889118#54889118", "title": "Hazelcast (Java) and ETCD (golang) differences/similarities?", "body": "<p>Although this question is now over 3 years old, I'd like to inform subsequent readers that Hazelcast as of 3.12 has a CP based subsystem (based on Raft) for its Atomics and Concurrency APIs.  There are plans to roll out CP to more of Hazelcast data structures in the near future.  Giving Hazelcast users a true choice between AP and CP concerns and allowing users to apply Hazelcast to new use cases previously handled by systems such as etcd and Zookeeper.</p>\n\n<p>You can read more here...</p>\n\n<p><a href=\"https://hazelcast.com/blog/hazelcast-imdg-3-12-beta-is-released/\" rel=\"noreferrer\">https://hazelcast.com/blog/hazelcast-imdg-3-12-beta-is-released/</a></p>\n"}], "owner": {"reputation": 605, "user_id": 983835, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/DGXZW.png?s=128&g=1", "display_name": "The Architect", "link": "https://stackoverflow.com/users/983835/the-architect"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3903, "favorite_count": 8, "accepted_answer_id": 31014203, "answer_count": 2, "score": 14, "last_activity_date": 1551195501, "creation_date": 1435085449, "question_id": 31011105, "link": "https://stackoverflow.com/questions/31011105/hazelcast-java-and-etcd-golang-differences-similarities", "title": "Hazelcast (Java) and ETCD (golang) differences/similarities?", "body": "<p>Now we building a realtime analytics system and it should be highly distributed. We plan to use distributed locks and counters to ensure data consistency, and we need a some kind of distributed map to know which client is connected to which server.\nI have no prior experience in distributed systems before, but I think we have two options:</p>\n\n<ol>\n<li><p>Java+Hazelcast</p></li>\n<li><p>Golang+ETCD</p></li>\n</ol>\n\n<p>But what is the pros/cons of each other in topic context?</p>\n"}, {"tags": ["python-2.7", "google-app-engine", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1435081067, "post_id": 31008719, "comment_id": 50046340, "body": "Confirm the location in your config is consistent with the files location on the server. I don&#39;t think you&#39;re going to get much more help on SO, the format is not particularly useful for troubleshooting env specific config problems."}], "answers": [{"tags": [], "owner": {"reputation": 69, "user_id": 4722740, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/88dc974951ed17593f37537b582783a8?s=128&d=identicon&r=PG&f=1", "display_name": "JackS", "link": "https://stackoverflow.com/users/4722740/jacks"}, "is_accepted": false, "score": 0, "last_activity_date": 1435195193, "creation_date": 1435195193, "answer_id": 31039704, "question_id": 31008719, "link": "https://stackoverflow.com/questions/31008719/gae-golang-templates-stopped-working/31039704#31039704", "title": "GAE golang templates stopped working", "body": "<p>I re-installed Python (the module_test and other tests failed) and updated the gae-go sdk.  This fixed my problem.  I believe that a recently identified Flash exploit had something to do with it as I experienced a number of Flash crashes in web page ads just before the problems began.</p>\n"}], "owner": {"reputation": 69, "user_id": 4722740, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/88dc974951ed17593f37537b582783a8?s=128&d=identicon&r=PG&f=1", "display_name": "JackS", "link": "https://stackoverflow.com/users/4722740/jacks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1435195193, "creation_date": 1435077980, "last_edit_date": 1435104654, "question_id": 31008719, "link": "https://stackoverflow.com/questions/31008719/gae-golang-templates-stopped-working", "title": "GAE golang templates stopped working", "body": "<p>I've been successfully using go for months - last night my app started 404 page not found errors but only on pages that use Templates.  Those that don't  use the Template system work fine.<br>\nI re-installed the Go sdk and discovered that the Guestbook demo ( also uses Templates)  doesn't work either.  ... and then I noticed that links to the log files weren't appearing on the Instance page of  the dev console - but when I click the \"default\" link it displayed the guestbook templated page that I had just requested and got the 404.</p>\n\n<p>It seems that the system can't find template folder and that is causing the 404s</p>\n\n<p>My configuration seems to have broken and I haven't been able to figure out why - hope someone can help...</p>\n\n<p>...After messing with environment variables and stuff for a while with no success,  I ran \"test_Python\" file. These all generated Errors: test_too_big_rewrite, module_test, python_sandbox_test all generated errors - the process hung up on \"test_serve\" </p>\n\n<p>This is causing my problems?  Is there a way to correct?  Uninstall and reinstall Python?  Will I have to uninstall/reinstall Go SDK  ? \nthanks!</p>\n"}, {"tags": ["function", "asynchronous", "go", "compare", "task"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1435077683, "post_id": 31008454, "comment_id": 50044281, "body": "Have you looked at any of the documentation for channels and concurrency?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1435078118, "post_id": 31008454, "comment_id": 50044556, "body": "yep, basically google &quot;goroutines and channels example&quot;. I think the golang tutorial has an example of exactly what you want."}, {"owner": {"reputation": 76, "user_id": 2513684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e1vy3.jpg?s=128&g=1", "display_name": "Ricardo Sohn", "link": "https://stackoverflow.com/users/2513684/ricardo-sohn"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1435078948, "post_id": 31008454, "comment_id": 50045077, "body": "@JimB Yes, but I tried, but maybe I have used channels wrong, because It was waiting for all tasks to finish before comparing."}, {"owner": {"reputation": 76, "user_id": 2513684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e1vy3.jpg?s=128&g=1", "display_name": "Ricardo Sohn", "link": "https://stackoverflow.com/users/2513684/ricardo-sohn"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1435078956, "post_id": 31008454, "comment_id": 50045083, "body": "@Not_a_Golfer More or less, I saw these examples and did mine, but as I said, it was waiting for all tasks to finish."}], "answers": [{"comments": [{"owner": {"reputation": 76, "user_id": 2513684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e1vy3.jpg?s=128&g=1", "display_name": "Ricardo Sohn", "link": "https://stackoverflow.com/users/2513684/ricardo-sohn"}, "edited": false, "score": 0, "creation_date": 1435079090, "post_id": 31008860, "comment_id": 50045165, "body": "Thanks, this is more or less what I want, very helpful."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 1, "last_activity_date": 1435078411, "creation_date": 1435078411, "answer_id": 31008860, "question_id": 31008454, "link": "https://stackoverflow.com/questions/31008454/check-what-task-finish-first-in-go/31008860#31008860", "title": "Check what task finish first in Go?", "body": "<p>Here is a basic example though there are plenty of others on the internet...\n<a href=\"https://play.golang.org/p/R__dk09Ymh\" rel=\"nofollow\">https://play.golang.org/p/R__dk09Ymh</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc main() {\n        a := make(chan bool)\n        b := make(chan bool)\n    go MySleep(5000, a)\n    go MySleep(1000, b)\n\n    select {\n        case _ = &lt;-a:\n             fmt.Println(\"a returned first\")\n        case _ = &lt;-b:\n            fmt.Println(\"b returned first\")\n    }\n}\n\nfunc MySleep(t int, sig chan bool) {\n    time.Sleep(time.Duration(t))\n    close(sig)\n    return\n}\n</code></pre>\n\n<p>You can extend this to do whatever you want. For example if you want to spin of some arbitrary number of goroutines <code>N</code> and not stop until they're all complete then you could wrap the select in a for and add a flag to indicate that each goroutine has sent on it's channel. Note that a well made program would also have communication in the other direction so you can shut down your workers.</p>\n"}], "owner": {"reputation": 76, "user_id": 2513684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e1vy3.jpg?s=128&g=1", "display_name": "Ricardo Sohn", "link": "https://stackoverflow.com/users/2513684/ricardo-sohn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 31008860, "answer_count": 1, "score": -2, "last_activity_date": 1435078411, "creation_date": 1435077164, "question_id": 31008454, "link": "https://stackoverflow.com/questions/31008454/check-what-task-finish-first-in-go", "title": "Check what task finish first in Go?", "body": "<p>I was wondering if it's possible to do a task (like a function, with different arguments, e.g. int multipliers) run at the same time, and a variable which receive the return value of the first task finished. Someone has any idea?\n :D</p>\n"}, {"tags": ["go", "connection"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1435077514, "post_id": 31008212, "comment_id": 50044203, "body": "All file descriptors are closed by the OS when your application exits. If you want to <i>try</i> to handle something before exiting, then you can use defer, but there&#39;s no way to guarantee any of your code runs when an application is terminated."}], "answers": [{"comments": [{"owner": {"reputation": 400, "user_id": 1766885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2477ca6031f47576951750c13766c8?s=128&d=identicon&r=PG", "display_name": "Frederick F. Kautz IV", "link": "https://stackoverflow.com/users/1766885/frederick-f-kautz-iv"}, "edited": false, "score": 1, "creation_date": 1435101568, "post_id": 31008295, "comment_id": 50056811, "body": "To complicate matters, defer will not be called on os.Exit. This question is also applicable when you want to flush buffered data out."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 400, "user_id": 1766885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2477ca6031f47576951750c13766c8?s=128&d=identicon&r=PG", "display_name": "Frederick F. Kautz IV", "link": "https://stackoverflow.com/users/1766885/frederick-f-kautz-iv"}, "edited": false, "score": 1, "creation_date": 1435101999, "post_id": 31008295, "comment_id": 50056904, "body": "@ffk perhaps but I think the general idea of my answer is still correct. While <code>defer</code> may not cover <b>all</b> shut down cases, the OP said that if he used it he would have to open a connection for each operation, which is not the case, that means his defer is being declared in the wrong scope. That&#39;s purely an inference on my part, but I think that&#39;s the issue he&#39;s facing. Not the issue of &quot;how do I write/clean up with my computer literally turns off unexpectedly&quot;."}, {"owner": {"reputation": 400, "user_id": 1766885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2477ca6031f47576951750c13766c8?s=128&d=identicon&r=PG", "display_name": "Frederick F. Kautz IV", "link": "https://stackoverflow.com/users/1766885/frederick-f-kautz-iv"}, "edited": false, "score": 0, "creation_date": 1435102870, "post_id": 31008295, "comment_id": 50057136, "body": "I agree, I primarily want to point out that calling os.Exit() will not run defer (which is a perfectly reasonable way to shut down apps, unlike pulling plugs :)"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 1, "last_activity_date": 1435103256, "last_edit_date": 1435103256, "creation_date": 1435076666, "answer_id": 31008295, "question_id": 31008212, "link": "https://stackoverflow.com/questions/31008212/what-is-correct-way-to-close-persistent-connection/31008295#31008295", "title": "What is correct way to close persistent connection?", "body": "<p>You would still use <code>defer</code> if you want to <strong>ensure</strong> some block of code executes before exit. The difference is in it's scope. The scope of your connection and defer statement should be the same. I have no idea what your app is but to provide a concrete example, you need to defer the connection close in the main of you command line app, not in the methods that read and write.</p>\n\n<p>You said \"because I do not want to open connection to Redis for each operation\" but that only makes defer problematic if you defer the close in the scope of some method that does a single IO operation. If you instead do the defer in the scope above a single operation (where all operations occur) then it will do waht you want;</p>\n\n<pre><code>init connection\ndefer connectionClose\n\nbegin execution of code that does db IO\nblock here if above is async\nprogram is exiting, my defer is called here\n</code></pre>\n\n<p>EDIT: As pointed out in the comments, the execution of deferred statements in not guaranteed. I just want to make it clear that you can defer the connection closing at the top level of application.</p>\n"}], "owner": {"reputation": 113, "user_id": 1061776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc00a883b0151561b735574f520c5287?s=128&d=identicon&r=PG", "display_name": "trong", "link": "https://stackoverflow.com/users/1061776/trong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1435103256, "creation_date": 1435076360, "question_id": 31008212, "link": "https://stackoverflow.com/questions/31008212/what-is-correct-way-to-close-persistent-connection", "title": "What is correct way to close persistent connection?", "body": "<p>My case is: long running server with connection to Redis. This server wait for SIGTERM signal for terminating. What is the right way to guarantee to release connection after terminating of my application?</p>\n\n<p>I know about defer - is really great, but not for persistent connection, because I do not want to open connection to Redis for each operation.</p>\n\n<p>Thanks!   </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 62518, "user_id": 469300, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f8256aabf1f8938bc2356b1fbeb227f4?s=128&d=identicon&r=PG", "display_name": "slezica", "link": "https://stackoverflow.com/users/469300/slezica"}, "edited": false, "score": 0, "creation_date": 1611874976, "post_id": 31007943, "comment_id": 116598672, "body": "If I understand correctly, <code>getInput</code> will consume a line from stdin whether <code>main</code> is still waiting for it or not. If this were reused, the line would be lost. Can this be avoided, with a true timeout after which the read is aborted?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 62518, "user_id": 469300, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f8256aabf1f8938bc2356b1fbeb227f4?s=128&d=identicon&r=PG", "display_name": "slezica", "link": "https://stackoverflow.com/users/469300/slezica"}, "edited": false, "score": 0, "creation_date": 1611875579, "post_id": 31007943, "comment_id": 116598807, "body": "@slezica: there is no such thing as a &quot;true timeout&quot;, so you cannot abort the read (that&#39;s what the question is asking). It&#39;s correct that you cannot reuse this function, because it&#39;s a simple example that&#39;s not designed to be reused. Of course there are many other ways to return multiple lines without losing data."}, {"owner": {"reputation": 62518, "user_id": 469300, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f8256aabf1f8938bc2356b1fbeb227f4?s=128&d=identicon&r=PG", "display_name": "slezica", "link": "https://stackoverflow.com/users/469300/slezica"}, "edited": false, "score": 0, "creation_date": 1611876144, "post_id": 31007943, "comment_id": 116598939, "body": "I would love to know how. Would you be so kind as to point me in the right direction? I need to read 2 pieces of input, each with a timeout, and everything I managed to google has the same problem: with unlucky timing, a line will be lost in the abandoned goroutine."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 62518, "user_id": 469300, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f8256aabf1f8938bc2356b1fbeb227f4?s=128&d=identicon&r=PG", "display_name": "slezica", "link": "https://stackoverflow.com/users/469300/slezica"}, "edited": false, "score": 1, "creation_date": 1611876766, "post_id": 31007943, "comment_id": 116599088, "body": "Just make one goroutine that continually returns tokens from the input. It&#39;s not really appropriate to try and format into a a comment. If you&#39;re having trouble I suggest filing a new question."}, {"owner": {"reputation": 62518, "user_id": 469300, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/f8256aabf1f8938bc2356b1fbeb227f4?s=128&d=identicon&r=PG", "display_name": "slezica", "link": "https://stackoverflow.com/users/469300/slezica"}, "edited": false, "score": 0, "creation_date": 1611938516, "post_id": 31007943, "comment_id": 116619537, "body": "No need, I understood perfectly. Sorry for the back and forth."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1435075572, "creation_date": 1435075572, "answer_id": 31007943, "question_id": 31006442, "link": "https://stackoverflow.com/questions/31006442/end-input-programmatically-in-a-golang-terminal-application/31007943#31007943", "title": "end input programmatically in a golang terminal application", "body": "<p>You can't timeout the read on stdin directly, so you need to create a timeout around receiving the result from the reading goroutine:</p>\n\n<pre><code>func getInput(input chan string) {\n    in := bufio.NewReader(os.Stdin)\n    result, err := in.ReadString('\\n')\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    input &lt;- result\n}\n\nfunc main() {\n    input := make(chan string, 1)\n    go getInput(input)\n\n    select {\n    case i := &lt;-input:\n        fmt.Println(i)\n    case &lt;-time.After(3000 * time.Millisecond):\n        fmt.Println(\"timed out\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 0, "accepted_answer_id": 31007943, "answer_count": 1, "score": 2, "last_activity_date": 1435075572, "creation_date": 1435071725, "question_id": 31006442, "link": "https://stackoverflow.com/questions/31006442/end-input-programmatically-in-a-golang-terminal-application", "title": "end input programmatically in a golang terminal application", "body": "<p>I am trying to end terminal input programmatically in 3 seconds and output the result. </p>\n\n<p>My code is the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\nvar (\n    result string\n    err    error\n)\n\nfunc main() {\n    fmt.Println(\"Please input something, you have 3000 milliseconds\")\n    go func() {\n        time.Sleep(time.Millisecond * 3000)\n        fmt.Println(\"It's time to break input and read what you have already typed\")\n        fmt.Println(\"result\")\n        fmt.Println(result)\n    }()\n    in := bufio.NewReader(os.Stdin)\n    result, err = in.ReadString('\\n')\n    if err != nil {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>Please input something, you have 3000 milliseconds\nhello It's time to break input and read what you have already typed\nresult\n</code></pre>\n\n<p>I just printed <code>hello</code> and 3 seconds passed and the program should end the input and read my <code>hello</code> and give output:</p>\n\n<pre><code>result\nhello\n</code></pre>\n\n<p>But I don't know how to provide this. Is it possible to end terminal input without user's intention and read the inputted value?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3376, "user_id": 105194, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a389302e32cd285c6dc556d4d5e96a9a?s=128&d=identicon&r=PG", "display_name": "mash", "link": "https://stackoverflow.com/users/105194/mash"}, "is_accepted": true, "score": 4, "last_activity_date": 1435057034, "creation_date": 1435057034, "answer_id": 31000911, "question_id": 31000378, "link": "https://stackoverflow.com/questions/31000378/comparing-errors-in-golang/31000911#31000911", "title": "Comparing errors in golang", "body": "<p>I had two bcrypt packages imported..\nThe file which has <code>FindAccount</code> imported <code>\"code.google.com/p/go.crypto/bcrypt\"</code>, and the caller imported   <code>\"golang.org/x/crypto/bcrypt\"</code>.</p>\n\n<p>Thus there were multiple </p>\n\n<pre><code>var ErrMismatchedHashAndPassword = errors.New(\"crypto/bcrypt: hashedPassword is not the hash of the given password\")\n</code></pre>\n\n<p>with different pointers.</p>\n\n<p>Replacing all <code>\"code.google.com/p/go.crypto/bcrypt\"</code> with <code>\"golang.org/x/crypto/bcrypt\"</code> fixed the issue.</p>\n"}], "owner": {"reputation": 3376, "user_id": 105194, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a389302e32cd285c6dc556d4d5e96a9a?s=128&d=identicon&r=PG", "display_name": "mash", "link": "https://stackoverflow.com/users/105194/mash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1471, "favorite_count": 0, "accepted_answer_id": 31000911, "answer_count": 1, "score": 3, "last_activity_date": 1435057034, "creation_date": 1435055460, "last_edit_date": 1435055901, "question_id": 31000378, "link": "https://stackoverflow.com/questions/31000378/comparing-errors-in-golang", "title": "Comparing errors in golang", "body": "<p>I'm writing a basic password authentication system in golang.<br>\nI use bcrypt to hash the password and save the hash in a database.<br>\nHere's the function to retrieve an authenticated account from the database.</p>\n\n<pre><code>func FindAccount(db *gorp.DbMap, email, password string) (*Account, error) {\n    account, err := FindByEmail(db, email)\n    if err != nil {\n        return nil, err\n    }\n    if account == nil {\n        return nil, nil\n    }\n    if err := bcrypt.CompareHashAndPassword([]byte(account.HashedPassword), []byte(password)); err != nil {\n        return nil, err\n    }\n    return account, nil\n}\n</code></pre>\n\n<p>And the caller:</p>\n\n<pre><code>account, err := FindAccount(db, email, password)\nif err != nil {\n    if err == bcrypt.ErrMismatchedHashAndPassword {\n        log.Printf(\"Why doesn't this condition match?\")\n        return nil, EmailPasswordInvalidError{}\n    }\n\n    log.Printf(\"bcrypt.Err: %p, %#v\", bcrypt.ErrMismatchedHashAndPassword, bcrypt.ErrMismatchedHashAndPassword)\n    log.Printf(\"err       : %p, %#v\", err, err)\n    return nil, err\n}\n</code></pre>\n\n<p>And when I use this code and provide invalid email and password, here's what happens:</p>\n\n<pre><code>sessions.go:51: bcrypt.Err: 0xc2080290b0, &amp;errors.errorString{s:\"crypto/bcrypt: hashedPassword is not the hash of the given password\"}\nsessions.go:52: err       : 0xc2080291e0, &amp;errors.errorString{s:\"crypto/bcrypt: hashedPassword is not the hash of the given password\"}\n</code></pre>\n\n<p>Why is the pointer address different?\nCan't we just compare errors?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1435073456, "post_id": 30997967, "comment_id": 50041478, "body": "Sounds like what you really want to do is to link staticly."}], "answers": [{"comments": [{"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 0, "creation_date": 1435059652, "post_id": 31001028, "comment_id": 50031303, "body": "Yeah I already saw the bash script method. I wish there would be a pure go-way of doing that because Go offers the ability to modify environement variables. The docker technique is interesting although I&#39;m not sure it&#39;s really the most portable way of doing things (since the user don&#39;t have to install SDL, but he&#39;ll have to install docker to make it work)"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 0, "creation_date": 1435060190, "post_id": 31001028, "comment_id": 50031636, "body": "@Depado Docker seems very portable (provided, indeed, that you have Docker installed). The resulting container is reproducible at will."}, {"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 0, "creation_date": 1435060627, "post_id": 31001028, "comment_id": 50031902, "body": "Yes that&#39;s right. But, on the other hand, the user still have something to install. I was hoping for a pure Go solution though."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1435057375, "creation_date": 1435057375, "answer_id": 31001028, "question_id": 30997967, "link": "https://stackoverflow.com/questions/30997967/is-there-a-way-to-set-an-environment-variable-before-any-import-in-go/31001028#31001028", "title": "Is there a way to set an environment variable before any import in Go?", "body": "<p>One option is to have a script which sets the <code>LD_LIBRARY_PATH</code> environment variable before calling <code>go-sdl2</code> (in the same script).</p>\n\n<p>The other more interesting option is to use a <a href=\"https://registry.hub.docker.com/search\" rel=\"nofollow\">Docker image</a>, make a Dockerfile based on that image, and install SDL and go in it (like in <a href=\"https://registry.hub.docker.com/u/didstopia/sdl2/\" rel=\"nofollow\"><code>didstopia/sdl2</code></a> ad <a href=\"https://github.com/Didstopia/SDL2-Dockerfile/blob/master/Dockerfile\" rel=\"nofollow\">its Dockerfile</a>, combined with a <a href=\"https://github.com/docker-library/golang/blob/396f40c6188614c7acd6d8299a0ea71030a056a6/1.4/cross/Dockerfile\" rel=\"nofollow\">Golang Dockerfile</a>).  </p>\n\n<p>You then have a reproducible standard environment, where you don't need to change <code>LD_LIBRARY_PATH</code>. And you can export that image in order for your friend to experiment with it.</p>\n"}, {"comments": [{"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 0, "creation_date": 1435062876, "post_id": 31002402, "comment_id": 50033423, "body": "Basically it&#39;s the same technique than using bash. I can&#39;t fix it in main because the main.go files imports the go-sdl2 lib, therefore it can&#39;t run if said libs aren&#39;t found (doesn&#39;t even enter in the main method)"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 1, "creation_date": 1435073238, "post_id": 31002402, "comment_id": 50041311, "body": "@Depado, &quot;because the main.go files imports \u2026&quot;; No, <code>main.go</code> does not do any importing. The compiler imports things at compile time. The resulting binary is just a chunk of code, either staticly linked so that it includes all code it needs, or dynamically linked with references to external libraries which the <a href=\"https://en.wikipedia.org/wiki/Dynamic_linking#ELF-based_Unix-like_systems\" rel=\"nofollow noreferrer\">operating system loads</a> <b>before</b> the program itself starts running."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1435075387, "post_id": 31002402, "comment_id": 50042823, "body": "Maybe you can static link in sdl2, so no .so files are needed?  <a href=\"http://stackoverflow.com/questions/17620884/static-linking-of-sdl2-libraries\" title=\"static linking of sdl2 libraries\">stackoverflow.com/questions/17620884/&hellip;</a> for reference"}, {"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 0, "creation_date": 1435154771, "post_id": 31002402, "comment_id": 50082144, "body": "According to the issue I opened on the repository of go-sdl2, there is no way to static-link a Go program with a C library. See here : <a href=\"https://github.com/veandco/go-sdl2/issues/129\" rel=\"nofollow noreferrer\">github.com/veandco/go-sdl2/issues/129</a>"}, {"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 0, "creation_date": 1435593633, "post_id": 31002402, "comment_id": 50253508, "body": "Update, see the above issue : github.com/veandco/go-sdl2/issues/129 There is actually a way to static-link the SDL2 to a Go binary :)"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 0, "last_activity_date": 1435061312, "creation_date": 1435061312, "answer_id": 31002402, "question_id": 30997967, "link": "https://stackoverflow.com/questions/30997967/is-there-a-way-to-set-an-environment-variable-before-any-import-in-go/31002402#31002402", "title": "Is there a way to set an environment variable before any import in Go?", "body": "<p>You <em>could</em>, in main, check to see if LD_LIBRARY_PATH is set, and if not, relaunch (using: <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow\">os.exec</a>)yourself adding the environment variable.</p>\n\n<p>you basically want to use os.Args as your arguments to exec, but also take your environment and add in LD_LIBRARY_PATH</p>\n\n<p>Bash script is definitely a less funky way to do it.  But if you really want the go app to do this, you can.</p>\n\n<p>You want something like: (untested)</p>\n\n<pre><code>cmd := os.Command(os.Args[0],os.Args[1:]...)\ncmd.Env = append(os.Environ, \"LD_LIBRARY_PATH=./wherever\")\ncmd.StdErr = os.StdErr // repeat for StdIn/StdOut\nerr := cmd.Run() //blocks until sub process is complete\nif err != nil {\n   os.Exit(1)\n}\n</code></pre>\n\n<p>Something like that</p>\n"}], "owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1435061312, "creation_date": 1435049122, "question_id": 30997967, "link": "https://stackoverflow.com/questions/30997967/is-there-a-way-to-set-an-environment-variable-before-any-import-in-go", "title": "Is there a way to set an environment variable before any import in Go?", "body": "<p>I'm currently testing the <a href=\"https://github.com/veandco/go-sdl2\" rel=\"nofollow\">Go-SDL2</a> lib, just for fun. I gave the binary to one of my friend but he doesn't have the SDL installed on his machine. So all I want to do (is dance) is to distribute the 4 .so libs with the binary so that it will work fine on other Linux machines. It's pretty easy actually, I just have to set the LD_LIBRARY_PATH to point to the current folder. This is for <strong>testing</strong> purpose.</p>\n\n<p>The problem is, I have to set this environment variable <strong>before</strong> I can import the go-sdl2 lib. For now I have a single source file (main.go  obviously). </p>\n\n<p>How can I achieve this ? (Is it even possible ?)</p>\n"}, {"tags": ["linux", "networking", "go", "network-programming", "wifi"], "answers": [{"comments": [{"owner": {"reputation": 400, "user_id": 1766885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2477ca6031f47576951750c13766c8?s=128&d=identicon&r=PG", "display_name": "Frederick F. Kautz IV", "link": "https://stackoverflow.com/users/1766885/frederick-f-kautz-iv"}, "edited": false, "score": 0, "creation_date": 1435101135, "post_id": 31002180, "comment_id": 50056691, "body": "Completely agree with using C APIs instead of parsing command line tools. In fact, if you implement golang bindings for manipulating networks, you should consider turning it into a library, open sourcing it on github and posting it on hacker news. I think many would find it useful. :)"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 1, "last_activity_date": 1435060733, "creation_date": 1435060733, "answer_id": 31002180, "question_id": 30997778, "link": "https://stackoverflow.com/questions/30997778/accessing-linux-network-apis-from-go/31002180#31002180", "title": "Accessing Linux network APIs from Go", "body": "<p>You very likely want to use <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow\">cgo</a> as it's really easy to call any C API</p>\n\n<p>An added benefit is that C APIs are usually pretty stable over time as the library creators almost always opt for a new function rather than break the API of an existing one.</p>\n\n<p>Running command line tools and parsing output is error prone as the software you call will most likely change it's output overtime, breaking your parsers.</p>\n"}], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 31002180, "answer_count": 1, "score": 0, "last_activity_date": 1435060733, "creation_date": 1435048595, "question_id": 30997778, "link": "https://stackoverflow.com/questions/30997778/accessing-linux-network-apis-from-go", "title": "Accessing Linux network APIs from Go", "body": "<p>I would like to write a simple utility program in Go to manage network (wired and wireless) connections on Linux, a software similar to NetworkManager and WICD.</p>\n\n<p>What would be the correct way to access Linux APIs in Go? Should I use C bindings and native Linux API call, execute a command and parse its output or maybe there is some library designed to do what I want to do?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1435136063, "post_id": 30993736, "comment_id": 50068984, "body": "Just a minor remark on terminology - the Go developers use the term &#39;<a href=\"http://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">type conversion</a>&#39; instead of &#39;casting&#39;."}], "answers": [{"comments": [{"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1435037538, "post_id": 30993964, "comment_id": 50018257, "body": "Thanks for the pointer. I tripped in the interface thingie before and will do it again. I don&#39;t grok the way golang deals with interface{} vs. pointers. I&#39;ll try to read more material about it until it clicks. Stay safe with the tornadoes out there in IL."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1435060178, "post_id": 30993964, "comment_id": 50031624, "body": "Think of an interface as a struct with a type and value field.  The type is checked when you do the assertion someInterfaceVar.(ConcreteType).  Since go values are just raw data, they have to include the type of the data so runtime safety can be maintained."}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1435074782, "post_id": 30993964, "comment_id": 50042366, "body": "Okay that helps. I still believe the compiler could have warned me about this? Apparently the type being displayed correctly when ok == false is a sign that something is not reported correctly. Don&#39;t you think?"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1435075799, "post_id": 30993964, "comment_id": 50043094, "body": "Yeah, it&#39;s confusing.  Probably comes from String() showing the concrete value and never the reference type (ie interface type itself)"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 4, "last_activity_date": 1435034345, "creation_date": 1435034345, "answer_id": 30993964, "question_id": 30993736, "link": "https://stackoverflow.com/questions/30993736/type-assertion-failed-with-correct-casting-from-interface-in-golang/30993964#30993964", "title": "Type assertion failed with correct casting from interface{} in golang", "body": "<p>The error is:</p>\n\n<pre><code>func (buf *Buffer) Get(index int) interface{} {\n    return &amp;buf.values[index]\n}\n</code></pre>\n\n<p>You want to do:</p>\n\n<pre><code>func (buf *Buffer) Get(index int) interface{} {\n    return buf.values[index]\n}\n</code></pre>\n\n<p>When you return &amp;buf.values[index] you are returning a pointer to an interface. Which is a *(*Stub) (in a sense)</p>\n"}], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1340, "favorite_count": 1, "accepted_answer_id": 30993964, "answer_count": 1, "score": 0, "last_activity_date": 1435034345, "creation_date": 1435032799, "last_edit_date": 1435033691, "question_id": 30993736, "link": "https://stackoverflow.com/questions/30993736/type-assertion-failed-with-correct-casting-from-interface-in-golang", "title": "Type assertion failed with correct casting from interface{} in golang", "body": "<p>Here is the output I am getting from the simple repro case below:</p>\n\n<pre><code>2015/06/22 21:09:50 ok: false\n2015/06/22 21:09:50 stub: *main.Stub &lt;nil&gt;\n</code></pre>\n\n<p>Clearly the stub is correctly marked as pointer to Stub type but the casting failed. I am trying to update the content of the array.</p>\n\n<pre><code>package main\n\nimport \"log\"\n\nconst BUFFER_SIZE = 8\n\ntype Value struct {\n    value int\n}\n\nfunc (v Value) Value() int          { return v.value }\nfunc (v *Value) SetValue(value int) { v.value = value }\n\ntype Stub struct {\n    Value\n    testString string\n}\n\ntype StubFactory struct{}\ntype FactoryInterface interface {\n    NewInstance(size int) []interface{}\n}\n\nfunc (factory StubFactory) NewInstance(size int) []interface{} {\n    stubs := make([]interface{}, size)\n    for i, _ := range stubs {\n        stubs[i] = &amp;Stub{Value: Value{i}, testString: \"\"}\n    }\n    return stubs\n}\n\ntype Buffer struct {\n    values []interface{}\n}\n\nfunc NewBuffer(factory FactoryInterface, size int) *Buffer {\n    return &amp;Buffer{values: factory.NewInstance(size)}\n}\n\nfunc (buf *Buffer) Get(index int) interface{} {\n    return &amp;buf.values[index]\n}\n\nfunc main() {\n    stubFactory := &amp;StubFactory{}\n    buffer := NewBuffer(stubFactory, BUFFER_SIZE)\n\n    index := 0\n    if stub, ok := buffer.Get(index).(*Stub); ok { // THIS FAILS :-(\n        log.Printf(\"ok: %+v\\n\", ok)\n        log.Printf(\"stub: %T %+v\\n\", stub, stub)\n        stub.SetValue(1234)\n        log.Printf(\"value:%+v\\n\", buffer.Get(index)) // I WANT \"1234\"\n    } else {\n        log.Printf(\"ok: %+v\\n\", ok)\n        log.Printf(\"stub: %T %+v\\n\", stub, stub) // but this shows the right type\n    }\n\n}\n</code></pre>\n"}, {"tags": ["python", "ruby", "go", "scripting", "command-line-interface"], "answers": [{"comments": [{"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 0, "creation_date": 1435052832, "post_id": 30993983, "comment_id": 50026894, "body": "nCurses is actually the lowest level for making this kind of application. People made things like <a href=\"https://github.com/nsf/termbox-go\" rel=\"nofollow noreferrer\">termbox</a> and such."}, {"owner": {"reputation": 4937, "user_id": 1545014, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/d3a08ae3ab7ee246d592730f0dd2c923?s=128&d=identicon&r=PG", "display_name": "jcoppens", "link": "https://stackoverflow.com/users/1545014/jcoppens"}, "reply_to_user": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 1, "creation_date": 1435065209, "post_id": 30993983, "comment_id": 50035088, "body": "@depado: Actually, the lowest level of implementation is implementing something like Curses yourself, with the actual Esc-code, creation/deletion of the windows. I did that too, time ago :-)"}, {"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 0, "creation_date": 1435065271, "post_id": 30993983, "comment_id": 50035137, "body": "Nice, I did not know it was actually possible to achieve something like that without spending years on it haha. Good to know though :)"}, {"owner": {"reputation": 4937, "user_id": 1545014, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/d3a08ae3ab7ee246d592730f0dd2c923?s=128&d=identicon&r=PG", "display_name": "jcoppens", "link": "https://stackoverflow.com/users/1545014/jcoppens"}, "reply_to_user": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 1, "creation_date": 1435065480, "post_id": 30993983, "comment_id": 50035262, "body": "Well, one learns a lot from doing it. Particularly respect for what they did in nCurses."}], "tags": [], "owner": {"reputation": 4937, "user_id": 1545014, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/d3a08ae3ab7ee246d592730f0dd2c923?s=128&d=identicon&r=PG", "display_name": "jcoppens", "link": "https://stackoverflow.com/users/1545014/jcoppens"}, "is_accepted": true, "score": 2, "last_activity_date": 1435034457, "creation_date": 1435034457, "answer_id": 30993983, "question_id": 30993731, "link": "https://stackoverflow.com/questions/30993731/interactive-cli-packages-checkboxes-selection/30993983#30993983", "title": "Interactive CLI packages - checkboxes &amp; selection", "body": "<p><em>The</em> package which has been around for many years is called Curses. The modern version package is actually called nCurses, but is still compatible with the original one. Here's a sample screenshot:</p>\n\n<p><img src=\"https://i.stack.imgur.com/yyC1I.png\" alt=\"enter image description here\"></p>\n\n<p>I haven't tried it with Unicode characters - it should work, and then you can use more fancy characters to mark checkbuttons and such.</p>\n\n<p>Curses is available for Python, Ruby and Go (and C and many other languages!).</p>\n"}], "owner": {"reputation": 1428, "user_id": 851233, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0961e8831ab014e07196df63abd1fa15?s=128&d=identicon&r=PG&f=1", "display_name": "mrosales", "link": "https://stackoverflow.com/users/851233/mrosales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 499, "favorite_count": 0, "accepted_answer_id": 30993983, "answer_count": 1, "score": -1, "last_activity_date": 1435034457, "creation_date": 1435032753, "question_id": 30993731, "link": "https://stackoverflow.com/questions/30993731/interactive-cli-packages-checkboxes-selection", "title": "Interactive CLI packages - checkboxes &amp; selection", "body": "<p>I am trying to learn more about making some cool CLI interfaces to provide the options for some local scripts. By digging into the source of the <a href=\"http://yeoman.github.io/generator/adapter.js.html\" rel=\"nofollow noreferrer\">yeoman-generator</a> I was able to come across <a href=\"https://www.npmjs.com/package/inquirer\" rel=\"nofollow noreferrer\">inquirer</a> for Node, which is how I learned that it was possible. (Example of what it looks like below)</p>\n\n<p>Specifically I want to be able to do something like display a list of checkboxes and use some key to select multiple options and then continue.</p>\n\n<p>Is anyone familiar with any packages/modules for other CLI languages that would allow me to do something similar? I like Node, but do not generally use it for scripting. Something in Python, Ruby or Go (I just started playing with Go) would be ideal</p>\n\n<p><img src=\"https://i.stack.imgur.com/iS5Wd.png\" alt=\"inquirer-checkbox\"></p>\n"}, {"tags": ["go", "io", "synchronization"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435035804, "post_id": 30993717, "comment_id": 50017599, "body": "why not just shell. <code>php xxx.php &amp;&gt;file</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1435037052, "post_id": 30993717, "comment_id": 50018069, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/30725751/streaming-commands-output-progress\">Streaming commands output progress</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1435042661, "post_id": 30993717, "comment_id": 50020591, "body": "You know that your four points cannot be achieved due to buffering?"}, {"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 0, "creation_date": 1435053170, "post_id": 30993717, "comment_id": 50027136, "body": "<a href=\"http://golang.org/pkg/io/#MultiWriter\" rel=\"nofollow noreferrer\">golang.org/pkg/io/#MultiWriter</a> check out the MultiWriter. It allows to define multiple destinations (stdout and a file, for example ;))"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 1813900, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c135533b1fbac32609afd0ed2eaa5d6?s=128&d=identicon&r=PG", "display_name": "user1813900", "link": "https://stackoverflow.com/users/1813900/user1813900"}, "edited": false, "score": 2, "creation_date": 1435068434, "post_id": 31004293, "comment_id": 50037578, "body": "Depado, you&#39;re a go nut! The answer is so simple I couldn&#39;t see it right in front of my face. Thanks!"}], "tags": [], "owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "is_accepted": true, "score": 17, "last_activity_date": 1435066522, "creation_date": 1435066522, "answer_id": 31004293, "question_id": 30993717, "link": "https://stackoverflow.com/questions/30993717/how-can-i-redirect-the-stdout-and-stderr-of-a-command-to-both-the-console-and-a/31004293#31004293", "title": "How can I redirect the stdout and stderr of a command to both the console and a log file while outputting in real time?", "body": "<p>As I said in the comment section, this can be achieved using <a href=\"http://golang.org/pkg/io/#MultiWriter\" rel=\"noreferrer\">MultiWriter</a></p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    // Logging capability\n    f, err := os.OpenFile(\"log.log\", os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)\n    if err != nil {\n        log.Fatalf(\"Error opening file: %v\", err)\n    }\n    defer f.Close()\n    mwriter := io.MultiWriter(f, os.Stdout)\n    cmd := exec.Command(\"ls\")\n    cmd.Stderr = mwriter\n    cmd.Stdout = mwriter\n    err = cmd.Run() //blocks until sub process is complete\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>When you declare your command, and before you run it, just specify that Stdout and Stderr are using the MultiWriter defined above. This MultiWriter instance contains both a log file and the standard output. </p>\n"}], "owner": {"reputation": 53, "user_id": 1813900, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c135533b1fbac32609afd0ed2eaa5d6?s=128&d=identicon&r=PG", "display_name": "user1813900", "link": "https://stackoverflow.com/users/1813900/user1813900"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6691, "favorite_count": 4, "accepted_answer_id": 31004293, "answer_count": 1, "score": 5, "last_activity_date": 1535598934, "creation_date": 1435032676, "last_edit_date": 1533925342, "question_id": 30993717, "link": "https://stackoverflow.com/questions/30993717/how-can-i-redirect-the-stdout-and-stderr-of-a-command-to-both-the-console-and-a", "title": "How can I redirect the stdout and stderr of a command to both the console and a log file while outputting in real time?", "body": "<p>The following bit of code does exactly what I want, except it only prints to the console. </p>\n\n<pre><code>cmd := exec.Command(\"php\", \"randomcommand.php\")\n\ncmd.Stdout = os.Stdout\ncmd.Stderr = os.Stderr\n\nif err := cmd.Run(); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>randomcommand.php:</p>\n\n<pre><code>// randomcommand.php simply alternates output between stdout and stderr 20 times\n\n$stdout = fopen('php://stdout', 'w+');\n$stderr = fopen('php://stderr', 'w+');\nfor ($i = 1;$i &lt;= 20; $i++) {\n    fwrite($stdout, \"stdout $i\\n\");\n    fwrite($stderr, \"stderr $i\\n\");\n}\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>stdout 1\nstderr 1\nstdout 2\nstderr 2\nstdout 3\nstderr 3\nstdout 4\nstderr 4\nstdout 5\nstderr 5\nstdout 6\nstderr 6\nstdout 7\nstderr 7\nstdout 8\nstderr 8\nstdout 9\nstderr 9\nstdout 10\nstderr 10\nstdout 11\nstderr 11\nstdout 12\nstderr 12\nstdout 13\nstderr 13\nstdout 14\nstderr 14\nstdout 15\nstderr 15\nstdout 16\nstderr 16\nstdout 17\nstderr 17\nstdout 18\nstderr 18\nstdout 19\nstderr 19\nstdout 20\nstderr 20\n</code></pre>\n\n<p>What I'm trying to achieve is:</p>\n\n<ol>\n<li>Print the command's stdout and stderr to the console in real-time;</li>\n<li>Log the command's stdout and stderr to a file, exactly as it appears in the console;</li>\n<li>Respect the exact order of writes to stdout and stderr, and;</li>\n<li>Not modify the command itself</li>\n</ol>\n\n<p>I've tried piping the command stdout and stderr into scanners or using io.Copy, each in a goroutine, but order of the output was not maintained. Probably because alternating between goroutines would have to occur at the same time as output alternates, which is just about impossible. </p>\n\n<p>I also tried the using \"select\" as in the examples from <a href=\"http://golangtutorials.blogspot.ca/2011/06/channels-in-go-range-and-select.html\" rel=\"nofollow\">here</a>. But order of output was not maintained.</p>\n\n<p>Same problem with <a href=\"https://github.com/kvz/logstreamer\" rel=\"nofollow\">Logstreamer</a>.</p>\n\n<p>The other idea I have to try is to see if I can somehow just read from the console buffer, but this just doesn't feel right.</p>\n\n<p>Does anyone know if this is even possible and worth pursuing?</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 0, "creation_date": 1435068207, "post_id": 30993677, "comment_id": 50037419, "body": "You&#39;re not supposed to leave <code>{{ .Object }}</code> it&#39;s not magical. You need, in your template, to do operations on it, cycle through your map, so you can render actual text and not a structure. You can for example render something like this <code>{{ .Object[&#39;foo&#39;][&#39;bar&#39;][0] }}</code> (This is just an example, you need to access the data that is contained IN your object)"}, {"owner": {"reputation": 31, "user_id": 5038351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3864150a3367488caa67fcb056d45268?s=128&d=identicon&r=PG&f=1", "display_name": "Haha", "link": "https://stackoverflow.com/users/5038351/haha"}, "edited": false, "score": 0, "creation_date": 1435085705, "post_id": 30993677, "comment_id": 50049144, "body": "@ Depado I know that I should render an actual text, but if the object is null, how do you refer anything"}, {"owner": {"reputation": 31, "user_id": 5038351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3864150a3367488caa67fcb056d45268?s=128&d=identicon&r=PG&f=1", "display_name": "Haha", "link": "https://stackoverflow.com/users/5038351/haha"}, "edited": false, "score": 0, "creation_date": 1435085838, "post_id": 30993677, "comment_id": 50049225, "body": "@ Dave C see this example <a href=\"http://play.golang.org/p/s8hOuzI-3F\" rel=\"nofollow noreferrer\">play.golang.org/p/s8hOuzI-3F</a>"}], "answers": [{"comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1435095394, "post_id": 30994301, "comment_id": 50054680, "body": "The abstraction can do more than just map strings to strings... It wouldn&#39;t provide much value if that&#39;s all it did. Why bother with the library at all if does nothing more than a good old string.replace?"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435107512, "post_id": 30994301, "comment_id": 50058285, "body": "replacement, not means replace ONE string to ANOTHER, like string.replace does. Maybe, template is for string generation, saying better."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 31, "user_id": 5038351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3864150a3367488caa67fcb056d45268?s=128&d=identicon&r=PG&f=1", "display_name": "Haha", "link": "https://stackoverflow.com/users/5038351/haha"}, "edited": false, "score": 0, "creation_date": 1435107731, "post_id": 30994301, "comment_id": 50058330, "body": "@Haha you say in the example, everywhere you want to generate a string  in place, using {{. xxx }}, the xxx is a primitive value, not a object(struct in golang)."}, {"owner": {"reputation": 31, "user_id": 5038351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3864150a3367488caa67fcb056d45268?s=128&d=identicon&r=PG&f=1", "display_name": "Haha", "link": "https://stackoverflow.com/users/5038351/haha"}, "edited": false, "score": 0, "creation_date": 1435112581, "post_id": 30994301, "comment_id": 50059349, "body": "In a world of your &quot;replacement&quot;, even compilers can only do &quot;string replacement&quot;.  Clearly &quot;replacement&quot; is too vague to explain what happens."}, {"owner": {"reputation": 31, "user_id": 5038351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3864150a3367488caa67fcb056d45268?s=128&d=identicon&r=PG&f=1", "display_name": "Haha", "link": "https://stackoverflow.com/users/5038351/haha"}, "edited": false, "score": 0, "creation_date": 1435113254, "post_id": 30994301, "comment_id": 50059497, "body": "Can you explain this code in your theory of replacement:  var values = {{.Object}}[key];"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435126470, "post_id": 30994301, "comment_id": 50063418, "body": "<code>{{.Object}}[key]</code> presents as a primitive value. if it print in final html"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435126615, "post_id": 30994301, "comment_id": 50063494, "body": "I really mean that you need place a primitive value on where you need them be resolved in final html. no more chat, please."}, {"owner": {"reputation": 31, "user_id": 5038351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3864150a3367488caa67fcb056d45268?s=128&d=identicon&r=PG&f=1", "display_name": "Haha", "link": "https://stackoverflow.com/users/5038351/haha"}, "edited": false, "score": 0, "creation_date": 1438380552, "post_id": 30994301, "comment_id": 51445491, "body": "@Jiang YD Stop finding excuse for your naive anwers. Of source it should be a primitive value eventually. But clearly you don&#39;t know that {{.Object}} is a json object."}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 0, "last_activity_date": 1500203491, "last_edit_date": 1500203491, "creation_date": 1435036351, "answer_id": 30994301, "question_id": 30993677, "link": "https://stackoverflow.com/questions/30993677/template-passes-non-nil-object-becomes-nil-in-frontend/30994301#30994301", "title": "Template passes non-nil object becomes nil in frontend", "body": "<p>No, it does not matter that the type is complicated. Template is not for passing struct from backend in Go to frontend in JavaScript. It is just do string replacement, replace strings in template with variables in Go and send final string.</p>\n"}], "owner": {"reputation": 31, "user_id": 5038351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3864150a3367488caa67fcb056d45268?s=128&d=identicon&r=PG&f=1", "display_name": "Haha", "link": "https://stackoverflow.com/users/5038351/haha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1500203562, "creation_date": 1435032361, "last_edit_date": 1500203562, "question_id": 30993677, "link": "https://stackoverflow.com/questions/30993677/template-passes-non-nil-object-becomes-nil-in-frontend", "title": "Template passes non-nil object becomes nil in frontend", "body": "<p>basically I have an object wanted to pass to the frontend. I logged it in the backend and it was not null, but in the frontend when I alerted it, it becomes null.</p>\n\n<pre><code>...\npresentation := &amp;presentationStruct {\n  Object: object,\n}\nlog.Errorf(\"%v\", object) // not null\ntemplate.Execute(writer, presentation)\n...\n\n// but it becomes null here\nalert({{.Object}})\n</code></pre>\n\n<p>The object is a type of</p>\n\n<pre><code>map[string]map[string]struct {\n  []float32\n  map[int][]struct {\n    string\n    float32\n  }\n}\n</code></pre>\n\n<p>Is it because the type is too complicated?</p>\n"}, {"tags": ["twitter", "go"], "comments": [{"owner": {"reputation": 400, "user_id": 1766885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2477ca6031f47576951750c13766c8?s=128&d=identicon&r=PG", "display_name": "Frederick F. Kautz IV", "link": "https://stackoverflow.com/users/1766885/frederick-f-kautz-iv"}, "edited": false, "score": 0, "creation_date": 1435099717, "post_id": 30992532, "comment_id": 50056261, "body": "This doesn&#39;t look like legal json: tweet := ` &quot;media_ids&quot;: 612877656984416256, &quot;status&quot;: &quot;hello&quot; `"}, {"owner": {"reputation": 400, "user_id": 1766885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2477ca6031f47576951750c13766c8?s=128&d=identicon&r=PG", "display_name": "Frederick F. Kautz IV", "link": "https://stackoverflow.com/users/1766885/frederick-f-kautz-iv"}, "edited": false, "score": 0, "creation_date": 1435099784, "post_id": 30992532, "comment_id": 50056277, "body": "tweet := <code>{ &quot;media_ids&quot;: 612877656984416256, &quot;status&quot;: &quot;hello&quot; }</code>"}, {"owner": {"reputation": 400, "user_id": 1766885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2477ca6031f47576951750c13766c8?s=128&d=identicon&r=PG", "display_name": "Frederick F. Kautz IV", "link": "https://stackoverflow.com/users/1766885/frederick-f-kautz-iv"}, "edited": false, "score": 0, "creation_date": 1435100176, "post_id": 30992532, "comment_id": 50056395, "body": "<a href=\"https://play.golang.org/p/efW0Hw1lic\" rel=\"nofollow noreferrer\">play.golang.org/p/efW0Hw1lic</a> for an example of generating and parsing json in go."}], "answers": [{"tags": [], "owner": {"reputation": 400, "user_id": 1766885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2477ca6031f47576951750c13766c8?s=128&d=identicon&r=PG", "display_name": "Frederick F. Kautz IV", "link": "https://stackoverflow.com/users/1766885/frederick-f-kautz-iv"}, "is_accepted": false, "score": 1, "last_activity_date": 1435172180, "last_edit_date": 1435172180, "creation_date": 1435100945, "answer_id": 31015006, "question_id": 30992532, "link": "https://stackoverflow.com/questions/30992532/go-anaconda-twitter-media-upload-with-tweet/31015006#31015006", "title": "Go Anaconda twitter media upload with tweet", "body": "<p>This is not valid json:</p>\n\n<pre><code>tweet := `\n\"media_ids\": 612877656984416256,\n\"status\": \"hello\"\n`\n</code></pre>\n\n<p>Try using this to generate your json:</p>\n\n<pre><code>type Tweet struct {\n    MediaIds uint64 `json:\"media_ids\"`\n    Status   string `json:\"status\"`\n}\ntweet := Tweet{612877656984416256, \"hello\"}\nb, err := json.Marshal(tweet)\n</code></pre>\n\n<p>This results in :</p>\n\n<pre><code>{\"media_ids\":612877656984416256,\"status\":\"hello\"}\n</code></pre>\n\n<p>This has a few benefits over using a raw string. </p>\n\n<ol>\n<li>It is more go centric. The struct can be passed around with values set and read with proper type checking caught at compile time.</li>\n<li>The generated json string is more likely to be semantically correct. e.g. Go will also escape certain characters to help ensure they will be parsed properly by the receiver.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "is_accepted": false, "score": 3, "last_activity_date": 1435302116, "creation_date": 1435302116, "answer_id": 31066920, "question_id": 30992532, "link": "https://stackoverflow.com/questions/30992532/go-anaconda-twitter-media-upload-with-tweet/31066920#31066920", "title": "Go Anaconda twitter media upload with tweet", "body": "<p>Thanks everyone. I see that the json was invalid but the issue was an error passing the media_ids parameter. The response was: \"errors\":[{\"code\":44,\"message\":\"media_ids parameter is invalid.\"}] which i though erroring out on the formatting but it had to do with not converting the media_ids type int64 to a string correctly. Here is the fixed code:</p>\n\n<pre><code>data, err := ioutil.ReadFile(fileName)\nif err != nil {\n    fmt.Println(err)\n}\n\nmediaResponse, err := api.UploadMedia(base64.StdEncoding.EncodeToString(data))\nif err != nil {\n    fmt.Println(err)\n}\n\nv := url.Values{}\nv.Set(\"media_ids\", strconv.FormatInt(mediaResponse.MediaID, 10))\n\nresult, err := api.PostTweet(posttitle, v)\nif err != nil {\n    fmt.Println(err)\n} else {\n    fmt.Println(result)\n}\n</code></pre>\n"}], "owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 919, "favorite_count": 2, "answer_count": 2, "score": 1, "last_activity_date": 1435302116, "creation_date": 1435023650, "last_edit_date": 1435040303, "question_id": 30992532, "link": "https://stackoverflow.com/questions/30992532/go-anaconda-twitter-media-upload-with-tweet", "title": "Go Anaconda twitter media upload with tweet", "body": "<p>I can tweet, and upload media, but I cannot figure out how to tweet with the media using anaconda(\"github.com/ChimeraCoder/anaconda\"). The media_id in the example was from a sucessfull media upload call. </p>\n\n<pre><code>mediaResponse, err := api.UploadMedia(\"R0lGODlhEAALALMMAOXp8a2503CHtOrt9L3G2+Dl7vL0+J6sy4yew1Jvp/T2+e/y9v///wAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFCwAMACwAAAAAEAALAAAEK5DJSau91KxlpObepinKIi2kyaAlq7pnCq9p3NZ0aW/47H4dBjAEwhiPlAgAIfkECQsADAAsAAAAAAQACwAABA9QpCQRmhbflPnu4HdJVAQAIfkECQsADAAsAAAAABAACwAABDKQySlSEnOGc4JMCJJk0kEQxxeOpImqIsm4KQPG7VnfbEbDvcnPtpINebJNByiTVS6yCAAh+QQJCwAMACwAAAAAEAALAAAEPpDJSaVISVQWzglSgiAJUBSAdBDEEY5JMQyFyrqMSMq03b67WY2x+uVgvGERp4sJfUyYCQUFJjadj3WzuWQiACH5BAkLAAwALAAAAAAQAAsAAAQ9kMlJq73hnGDWMhJQFIB0EMSxKMoiFcNQmKjKugws0+navrEZ49S7AXfDmg+nExIPnU9oVEqmLpXMBouNAAAh+QQFCwAMACwAAAAAEAALAAAEM5DJSau91KxlpOYSUBTAoiiLZKJSMQzFmjJy+8bnXDMuvO89HIuWs8E+HQYyNAJgntBKBAAh+QQFFAAMACwMAAIABAAHAAAEDNCsJZWaFt+V+ZVUBAA7\")\nif err != nil {\n    fmt.Println(err)\n}\n\n//v := url.Values{}\n//v.Set(\"media_ids\", string(mediaResponse.MediaID))\nfmt.Println(mediaResponse)\ntweet := `\n\"media_ids\": 612877656984416256,\n\"status\": \"hello\"\n`\n\nresult, err := api.PostTweet(tweet, nil)\nif err != nil {\n    fmt.Println(err)\n} else {\n    fmt.Println(result)\n}\n</code></pre>\n\n<p>Can someone assist in telling me how to parse the json or call the PostTweet with the media id? I've also tried adding the media to url.Values without sucess.</p>\n"}, {"tags": ["http", "go", "superagent", "beego"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 1, "creation_date": 1435037950, "post_id": 30982891, "comment_id": 50018408, "body": "can you make a HTTP capture to make sure the request body is not empty?"}, {"owner": {"reputation": 319, "user_id": 1156121, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8792b5347d95c6e3d183598a5e28fc48?s=128&d=identicon&r=PG", "display_name": "nightscent", "link": "https://stackoverflow.com/users/1156121/nightscent"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435050563, "post_id": 30982891, "comment_id": 50025384, "body": "heyo how do you suggest i go about that? In chrome&#39;s developer network console i&#39;ve checked to see that the body includes the payload e.g {&quot;code&quot;: &quot;123&quot;} but when printing the entire request on Beego it&#39;s empty :("}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435109561, "post_id": 30982891, "comment_id": 50058728, "body": "so you got print <code>Received []</code>?"}, {"owner": {"reputation": 319, "user_id": 1156121, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8792b5347d95c6e3d183598a5e28fc48?s=128&d=identicon&r=PG", "display_name": "nightscent", "link": "https://stackoverflow.com/users/1156121/nightscent"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435249148, "post_id": 30982891, "comment_id": 50132581, "body": "@JiangYD yep when attempting to use a JSON body it always seems to be empty. However, I&#39;ve tried changing the header to <code>.set(&#39;Content-Type&#39;, &#39;application&#47;x-www-form-urlencoded&#39;)</code> and I am able to retrieve the fields in the <code>c.Ctx.Input.Request.Form.Get(&quot;code&quot;)</code>. Any idea why this is the case?"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435278086, "post_id": 30982891, "comment_id": 50146182, "body": "why you not set content-type to json then? i saw your code <code>.set(&#39;Accept&#39;, &#39;application&#47;json&#39;)</code>, but not <code>Content-Type</code>."}, {"owner": {"reputation": 319, "user_id": 1156121, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8792b5347d95c6e3d183598a5e28fc48?s=128&d=identicon&r=PG", "display_name": "nightscent", "link": "https://stackoverflow.com/users/1156121/nightscent"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1435456647, "post_id": 30982891, "comment_id": 50207108, "body": "I missed it out in the original post but i&#39;ve actually tried it already without any luck. I&#39;ve moved off beego to gin and the exact same superagent code works perfectly. No idea what else I did wrong but seems like too much effort to debug for a simple json POST unwrap. Thanks for trying!"}], "answers": [{"comments": [{"owner": {"reputation": 938, "user_id": 1772722, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/17346489240f67dafa4bad5967fa1aae?s=128&d=identicon&r=PG", "display_name": "lionelmessi", "link": "https://stackoverflow.com/users/1772722/lionelmessi"}, "edited": false, "score": 0, "creation_date": 1452362285, "post_id": 31844953, "comment_id": 57139949, "body": "this is the solution !"}, {"owner": {"reputation": 485, "user_id": 3661376, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/38959b88a8d68571e250fa48afde9ccb?s=128&d=identicon&r=PG&f=1", "display_name": "TDo", "link": "https://stackoverflow.com/users/3661376/tdo"}, "edited": false, "score": 0, "creation_date": 1612318433, "post_id": 31844953, "comment_id": 116727395, "body": "you have no idea how much Googling I have done to get to this answer!"}], "tags": [], "owner": {"reputation": 166, "user_id": 2135777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d0d54119f69682b7ccda25a4172d1d8?s=128&d=identicon&r=PG", "display_name": "Edcyc", "link": "https://stackoverflow.com/users/2135777/edcyc"}, "is_accepted": false, "score": 14, "last_activity_date": 1438821128, "creation_date": 1438821128, "answer_id": 31844953, "question_id": 30982891, "link": "https://stackoverflow.com/questions/30982891/beego-post-request-body-always-empty/31844953#31844953", "title": "Beego POST request body always empty", "body": "<p>You need to configure \"copyrequestbody = true\" in configuration file \"conf/app.conf\".</p>\n\n<p>The default is false so the content is not copied to c.Ctx.Input.RequestBody.</p>\n\n<p>The example is shown section \"Retrieving data from request body\" in the document. (<a href=\"http://beego.me/docs/mvc/controller/params.md\">http://beego.me/docs/mvc/controller/params.md</a>)</p>\n"}], "owner": {"reputation": 319, "user_id": 1156121, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/8792b5347d95c6e3d183598a5e28fc48?s=128&d=identicon&r=PG", "display_name": "nightscent", "link": "https://stackoverflow.com/users/1156121/nightscent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5490, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1438821128, "creation_date": 1434984218, "question_id": 30982891, "link": "https://stackoverflow.com/questions/30982891/beego-post-request-body-always-empty", "title": "Beego POST request body always empty", "body": "<p>I'm working with Beego's convenience methods for parsing request body values and have the following:</p>\n\n<p>Router file:</p>\n\n<pre><code>    apiNamespace := beego.NewNamespace(\"/api\")\n\n    apiNamespace.Router(\"/sessions/google/new\", &amp;controllers.SessionsController{}, \"get:GoogleNewSession\")\n\n    beego.AddNamespace(apiNamespace)\n</code></pre>\n\n<p>Controller code:</p>\n\n<pre><code>func (c *SessionsController) URLMapping() {\n    c.Mapping(\"GoogleNewSession\", c.GoogleNewSession)\n}\n\nfunc (c *SessionsController) GoogleNewSession() {\n\n    // Always serve JSON\n    defer func() {\n        c.ServeJson()\n    }()\n\n    // This is always blank\n    log.Printf(\"'Received %+v'\", c.Ctx.Input.RequestBody)\n\n    c.Ctx.ResponseWriter.WriteHeader(200)\n    return\n\n    // truncated\n}\n</code></pre>\n\n<p>Front end JS (super-agent):</p>\n\n<pre><code>    request\n    .post('/sessions/google/new')\n    .use(prefix)\n    .send({ code: authCode })\n    .set('Accept', 'application/json')\n    .end(function(err, res){\n        console.log(\"******* request\", res.request)\n         if (res.ok) {\n            var body = res.body;\n            console.log('yay got ' + JSON.stringify(res.body));\n         } else {\n            console.log(\"***** err\", err);\n            console.log(\"***** not ok\", res.text);\n         }\n     });\n</code></pre>\n\n<p>When the superagent request fires off, I can see in the logs that the path is getting correctly matched. However, the <code>c.Ctx.Input.RequestBody</code> is always empty.</p>\n\n<p>I have tried using something else to fire the request such as Postman but to no avail. In GET requests I am able to retrieve query params correctly.</p>\n\n<p>Any clues or suggestions to help fix or debug this issue?</p>\n"}, {"tags": ["unit-testing", "testing", "go", "http-post"], "answers": [{"comments": [{"owner": {"reputation": 523, "user_id": 2232308, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b1d346912e7da136d247b3d88f7f52f7?s=128&d=identicon&r=PG", "display_name": "mirage", "link": "https://stackoverflow.com/users/2232308/mirage"}, "edited": false, "score": 0, "creation_date": 1434970879, "post_id": 30978171, "comment_id": 49986809, "body": "I tried that, and...  kaboom! (ran go test)  panic: runtime error: invalid memory address or nil pointer dereference [recovered] \tpanic: runtime error: invalid memory address or nil pointer dereference [signal 0xb code=0x1 addr=0x0 pc=0x1271d0]"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 523, "user_id": 2232308, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b1d346912e7da136d247b3d88f7f52f7?s=128&d=identicon&r=PG", "display_name": "mirage", "link": "https://stackoverflow.com/users/2232308/mirage"}, "edited": false, "score": 0, "creation_date": 1434972175, "post_id": 30978171, "comment_id": 49987623, "body": "@mirage that&#39;s probably a problem in your handler, you&#39;re not giving enough context to see what it is. but at least we know my answer was correct for your specific question."}, {"owner": {"reputation": 523, "user_id": 2232308, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b1d346912e7da136d247b3d88f7f52f7?s=128&d=identicon&r=PG", "display_name": "mirage", "link": "https://stackoverflow.com/users/2232308/mirage"}, "edited": false, "score": 0, "creation_date": 1434972597, "post_id": 30978171, "comment_id": 49987927, "body": "yes, that worked. I had some other issues. Fixed those now. thanks a lot."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 8, "last_activity_date": 1434970588, "creation_date": 1434970588, "answer_id": 30978171, "question_id": 30978105, "link": "https://stackoverflow.com/questions/30978105/adding-post-variables-to-go-test-http-request/30978171#30978171", "title": "Adding POST variables to Go test http Request", "body": "<p>You need to add a <code>Content-Type</code> header to the request so the handler will know how to treat the POST body data:</p>\n\n<pre><code>req, _ := http.NewRequest(\"POST\", \"/my_url\", reader) //BTW check for error\nreq.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n</code></pre>\n"}], "owner": {"reputation": 523, "user_id": 2232308, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b1d346912e7da136d247b3d88f7f52f7?s=128&d=identicon&r=PG", "display_name": "mirage", "link": "https://stackoverflow.com/users/2232308/mirage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4553, "favorite_count": 1, "accepted_answer_id": 30978171, "answer_count": 1, "score": 5, "last_activity_date": 1435148659, "creation_date": 1434970345, "last_edit_date": 1435148659, "question_id": 30978105, "link": "https://stackoverflow.com/questions/30978105/adding-post-variables-to-go-test-http-request", "title": "Adding POST variables to Go test http Request", "body": "<p>I am trying to add form variables to a Go http request.</p>\n\n<p>Here's how my Go test looks:</p>\n\n<pre><code>func sample_test(t *testing.T) {\n    handler := &amp;my_listener_class{}\n    reader := strings.NewReader(\"number=2\")\n    req, _ := http.NewRequest(\"POST\", \"/my_url\", reader)\n    w := httptest.NewRecorder()\n    handler.function_to_test(w, req)\n    if w.Code != http.StatusOK {\n        t.Errorf(\"Home page didn't return %v\", http.StatusOK)\n    }\n}\n</code></pre>\n\n<p>The issue is that the form data never gets passed on to the function I need to test.</p>\n\n<p>The other relevant function is:</p>\n\n<pre><code>func (listener *my_listener_class) function_to_test(writer http.ResponseWriter, request *http.Request) {\n    ...\n}\n</code></pre>\n\n<p>I am using Go version go1.3.3 darwin/amd64.</p>\n"}, {"tags": ["email", "templates", "go", "mandrill"], "answers": [{"tags": [], "owner": {"reputation": 146, "user_id": 3939561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65547558d4906b041dcc64ee9b100cef?s=128&d=identicon&r=PG&f=1", "display_name": "Greg R", "link": "https://stackoverflow.com/users/3939561/greg-r"}, "is_accepted": true, "score": 1, "last_activity_date": 1434965908, "creation_date": 1434965908, "answer_id": 30976628, "question_id": 30976348, "link": "https://stackoverflow.com/questions/30976348/mail-with-html-content-shows-break-lines-or-ignores-newlines/30976628#30976628", "title": "Mail with html content shows break lines or ignores newlines", "body": "<p>Are you sending the mail as HTML? If so, you can wrap everything in the <code>&lt;pre&gt;</code> tag.</p>\n\n<p>If you're not using HTML, setting this header should help: <code>Mime-Type: text/plain</code></p>\n\n<p>Also, try changing your newlines from <code>\\n</code> to <code>\\r\\n</code>. </p>\n"}], "owner": {"reputation": 93, "user_id": 5011492, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206978012152158/picture?type=large", "display_name": "Black Obama", "link": "https://stackoverflow.com/users/5011492/black-obama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 693, "favorite_count": 0, "accepted_answer_id": 30976628, "answer_count": 1, "score": 0, "last_activity_date": 1434965908, "creation_date": 1434965114, "question_id": 30976348, "link": "https://stackoverflow.com/questions/30976348/mail-with-html-content-shows-break-lines-or-ignores-newlines", "title": "Mail with html content shows break lines or ignores newlines", "body": "<p>I am sending mail to users via mandrill and I using both smtp and mandrill api to send.\nContent of the mail is rendered go template (<code>.tpl</code>)\nWhen I put template like</p>\n\n<pre><code>Hi {{.name}},\n&lt;br/&gt;\nThis is support.  \n&lt;br/&gt;\n</code></pre>\n\n<p>it sends via mandrill api ok, but <br/> is visible when I send via smtp, \nwhen use template like ( <code>&lt;br/&gt; replaced with \\n</code>)</p>\n\n<pre><code>Hi {{.name}},\n\nThis is support.  \n</code></pre>\n\n<p>mandrill ignores that and shows everything in one line but smtp shows ok newlines.\nWhat is a solution for this ?</p>\n\n<p>I am rendering template like </p>\n\n<pre><code>frame, err := template.New(\"foo\").Parse( *templateString )\nif err != nil {\n    return nil, err\n}\nvar doc bytes.Buffer\nframe.Execute( &amp;doc, *parameters )\ntemp := doc.String()\n</code></pre>\n"}, {"tags": ["go", "signals"], "comments": [{"owner": {"reputation": 362, "user_id": 2544044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55e4021f92a8fe5f2a4620ef45bfebc6?s=128&d=identicon&r=PG", "display_name": "Chris B.", "link": "https://stackoverflow.com/users/2544044/chris-b"}, "edited": false, "score": 0, "creation_date": 1434971481, "post_id": 30975100, "comment_id": 49987178, "body": "I don&#39;t think it&#39;s possible right now to do this in Go. If you take a look at the implementation of the os.Signal interface you&#39;ll see it&#39;s basically an integer ( <a href=\"http://golang.org/src/syscall/syscall_unix.go?s=2948:2963#L111\" rel=\"nofollow noreferrer\">golang.org/src/syscall/syscall_unix.go?s=2948:2963#L111</a> ). Why do you need to figure this out if I may ask? Maybe there&#39;s another way."}, {"owner": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "edited": false, "score": 0, "creation_date": 1434978083, "post_id": 30975100, "comment_id": 49991592, "body": "When you say process, do you mean a different program that runs in your system or is it a go routine?"}, {"owner": {"reputation": 11347, "user_id": 748175, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/dda7312646314b33d686dc5a3bf05026?s=128&d=identicon&r=PG", "display_name": "qdii", "link": "https://stackoverflow.com/users/748175/qdii"}, "reply_to_user": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "edited": false, "score": 0, "creation_date": 1434981562, "post_id": 30975100, "comment_id": 49994022, "body": "@bshuster13 I don&#39;t mean goroutine nor program, I really mean process, as in BSD process. Not necessarily a different one either, as a process can send itself a signal (<code>man raise</code>)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1434988241, "post_id": 30975100, "comment_id": 49998861, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/30219751/golang-get-signal-origin\">Golang: Get signal origin</a>"}], "owner": {"reputation": 11347, "user_id": 748175, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/dda7312646314b33d686dc5a3bf05026?s=128&d=identicon&r=PG", "display_name": "qdii", "link": "https://stackoverflow.com/users/748175/qdii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1434988761, "creation_date": 1434961284, "question_id": 30975100, "link": "https://stackoverflow.com/questions/30975100/find-who-sent-a-given-signal", "title": "Find who sent a given signal", "body": "<p>I handle signals with a goroutine</p>\n\n<pre><code>func main() {\n    csignals := make(chan os.Signal, 1)\n    signal.Notify(csignals)\n\n    go func() {\n        for {\n            sig := &lt;-csignals\n            logger.Println(\"logger signal re\u00e7u: \", sig)\n        }\n    }()\n\n    ...\n}\n</code></pre>\n\n<p>However, I would like to find which process sent this signal. How could I do that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 954, "user_id": 313941, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/ZAUgh.jpg?s=128&g=1", "display_name": "kainlite", "link": "https://stackoverflow.com/users/313941/kainlite"}, "edited": false, "score": 0, "creation_date": 1434932237, "post_id": 30970542, "comment_id": 49972648, "body": "I think that there is no such thing as <code>Object</code> from java in golang, and the main reason is that golang enforces composability and not inheritance, anyway in general is a bad idea to add things to the global environment... also you should expand your question with the problem that you&#39;re trying to solve..."}, {"owner": {"reputation": 1059, "user_id": 2304441, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/n2dEA.jpg?s=128&g=1", "display_name": "benbot", "link": "https://stackoverflow.com/users/2304441/benbot"}, "edited": false, "score": 0, "creation_date": 1434936371, "post_id": 30970542, "comment_id": 49973408, "body": "There wasn&#39;t a real problem. It was a curiosity question :)"}], "answers": [{"comments": [{"owner": {"reputation": 1059, "user_id": 2304441, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/n2dEA.jpg?s=128&g=1", "display_name": "benbot", "link": "https://stackoverflow.com/users/2304441/benbot"}, "edited": false, "score": 0, "creation_date": 1434949490, "post_id": 30971553, "comment_id": 49976169, "body": "That&#39;s what I was thinking in terms of making a &quot;root&quot; interface. I just wasn&#39;t sure how to put it."}], "tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": true, "score": 3, "last_activity_date": 1434941877, "creation_date": 1434941877, "answer_id": 30971553, "question_id": 30970542, "link": "https://stackoverflow.com/questions/30970542/what-is-the-top-level-interface-in-go/30971553#30971553", "title": "What is the top level interface in go?", "body": "<p>Any type that implements all the methods listed in the interface implements the interface.</p>\n\n<p>The empty interface, <code>interface{}</code>, lists no methods. Therefore, all types implement it.</p>\n\n<p>There is nothing \"top level\" about it however. Interfaces (although they can embed) do not have a hierarchical structure. The empty interface is simply a normal interface with no requirements.</p>\n"}], "owner": {"reputation": 1059, "user_id": 2304441, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/n2dEA.jpg?s=128&g=1", "display_name": "benbot", "link": "https://stackoverflow.com/users/2304441/benbot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "closed_date": 1434958847, "accepted_answer_id": 30971553, "answer_count": 1, "score": 0, "last_activity_date": 1434941877, "creation_date": 1434931524, "question_id": 30970542, "link": "https://stackoverflow.com/questions/30970542/what-is-the-top-level-interface-in-go", "closed_reason": "Duplicate", "title": "What is the top level interface in go?", "body": "<p>Or what is the interface that all types implement?\nI'm looking for something like the <code>Object</code> class in Java.</p>\n\n<p>Is it possible for me to make my own kind of \"Root\" interface?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1434926604, "post_id": 30969811, "comment_id": 49971633, "body": "I think the main problem in regards to having an <code>image.Encode...</code> method, is that it would cause a circular package reference (I would think, anyway). Best to leave such a small implementation up to consumers I would have thought."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1434927234, "post_id": 30969811, "comment_id": 49971771, "body": "@SimonWhitehead Image encoding and decoding packages <a href=\"http://godoc.org/image#RegisterFormat\" rel=\"nofollow noreferrer\">register a decoding function</a> with the image package. If the same is done with encoding functions, there will be no circular package reference."}, {"owner": {"reputation": 5205, "user_id": 1675774, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fOIb8.jpg?s=128&g=1", "display_name": "Tom Manterfield", "link": "https://stackoverflow.com/users/1675774/tom-manterfield"}, "reply_to_user": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1434927339, "post_id": 30969811, "comment_id": 49971798, "body": "@SimonWhitehead I wouldn&#39;t have expected that to be the reasoning, since you could write it in such a way as to not have a circular import pretty trivially (the above being half of one crappy example).  ThunderCat&#39;s answer hits the nail on the head I think, given that the encoding functions each have different options that make no sense for other encoding options."}, {"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 2, "creation_date": 1434928622, "post_id": 30969811, "comment_id": 49972051, "body": "Makes sense (haven&#39;t used the image package or its sub packages to any great extent.. hence why I didn&#39;t stupidly answer this question with that comment :P)"}], "answers": [{"comments": [{"owner": {"reputation": 5205, "user_id": 1675774, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fOIb8.jpg?s=128&g=1", "display_name": "Tom Manterfield", "link": "https://stackoverflow.com/users/1675774/tom-manterfield"}, "edited": false, "score": 1, "creation_date": 1434927199, "post_id": 30970049, "comment_id": 49971761, "body": "Ah yes, of course.  It&#39;s actually pretty fortunate you pointed out the reasoning to me; the next bit of functionality I need to write would use the quality param of the jpeg.Encode, so I would have wasted my effort hiding that away from myself in an abstraction.  Thanks very much!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1434927270, "last_edit_date": 1434927270, "creation_date": 1434926614, "answer_id": 30970049, "question_id": 30969811, "link": "https://stackoverflow.com/questions/30969811/is-there-a-function-in-the-go-standard-library-that-will-encode-a-buffer-to-any/30970049#30970049", "title": "Is there a function in the Go standard library that will encode a buffer to any image format in go", "body": "<p>The standard library does not contain a function for encoding an image to an arbitrary format.</p>\n\n<p>One reason that the library does not have such a function is that there are different encoding options for each image format. For example the <a href=\"http://godoc.org/image/jpeg#Options\" rel=\"nofollow\">JPEG options</a> and <a href=\"http://godoc.org/image/png#Encoder\" rel=\"nofollow\">PNG options</a> are different. </p>\n"}], "owner": {"reputation": 5205, "user_id": 1675774, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fOIb8.jpg?s=128&g=1", "display_name": "Tom Manterfield", "link": "https://stackoverflow.com/users/1675774/tom-manterfield"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 30970049, "answer_count": 1, "score": 1, "last_activity_date": 1434927407, "creation_date": 1434924504, "last_edit_date": 1434927407, "question_id": 30969811, "link": "https://stackoverflow.com/questions/30969811/is-there-a-function-in-the-go-standard-library-that-will-encode-a-buffer-to-any", "title": "Is there a function in the Go standard library that will encode a buffer to any image format in go", "body": "<p>I'm writing a micro-service with some simple image manipulation in go. </p>\n\n<p>When I come to sending the manipulated image back to the user I have to encode it correctly before writing it via a buffer.</p>\n\n<p>I can detect the format easily enough, so it's not precisely a problem. Currently I use my format string and do it like this:</p>\n\n<pre><code>buffer := new(bytes.Buffer)\n\nswitch format { //format is just a string as returned by image.Decode()\ncase \"jpeg\":\n    err := jpeg.Encode(buffer, img, nil) //img is just an image.Image \n    if err != nil {\n        //Do some error handling\n    }\ncase \"png\":\n    err := png.Encode(buffer, img)\n    if err != nil {\n        //Do some error handling\n    }\n//and so on...\n</code></pre>\n\n<p>Now this works just fine, I was about to split it out into my own function when I started to think I must have missed something here. It seems too obvious to not have a function like <code>image.Encode(buffer, image, format)</code>.</p>\n\n<p>It's not exactly hassle to write it, but my code will soon become unnecessarily unwieldy if I start re-implementing core language functionality.</p>\n\n<p>If it's just not there because go is a nice tidy language with a small footprint, I'm cool with that.</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 1023, "user_id": 18933, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/1f1e8008a09a9d4cfe528e25cebe0b25?s=128&d=identicon&r=PG", "display_name": "gregf", "link": "https://stackoverflow.com/users/18933/gregf"}, "is_accepted": true, "score": 1, "last_activity_date": 1434925347, "creation_date": 1434925347, "answer_id": 30969917, "question_id": 30969017, "link": "https://stackoverflow.com/questions/30969017/how-to-insert-a-record-into-an-existing-has-many-table-with-gorm/30969917#30969917", "title": "How to insert a record into an existing has many table with gorm", "body": "<p>I was able to figure it out.</p>\n\n<pre><code>var id int\nrow := db.Table(\"podcasts\").Where(\"id = ?\", 1).Select(\"id\").Row()\nrow.Scan(&amp;id)\n\nepisode := Episode{\n    Title:      \"Episode Two!\",\n    Url:        \"http://www.example.com/episode-two\",\n    Downloaded: true,\n    PodcastID:  id,\n}\n\ndb.Create(&amp;episode)\n</code></pre>\n"}], "owner": {"reputation": 1023, "user_id": 18933, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/1f1e8008a09a9d4cfe528e25cebe0b25?s=128&d=identicon&r=PG", "display_name": "gregf", "link": "https://stackoverflow.com/users/18933/gregf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2051, "favorite_count": 0, "accepted_answer_id": 30969917, "answer_count": 1, "score": 1, "last_activity_date": 1434947388, "creation_date": 1434918541, "last_edit_date": 1434947388, "question_id": 30969017, "link": "https://stackoverflow.com/questions/30969017/how-to-insert-a-record-into-an-existing-has-many-table-with-gorm", "title": "How to insert a record into an existing has many table with gorm", "body": "<p>I have two tables</p>\n\n<pre><code>type Podcast struct {\n    Id       int\n    Title    string\n    RssUrl   string `sql:\"unique_index\"`\n    Episodes []Episode\n}\n\ntype Episode struct {\n    Id         int\n    PodcastID  int\n    Title      string\n    Url        string `sql:\"unique_index\"`\n    Downloaded bool\n}\n</code></pre>\n\n<p>I know how to insert episodes into a new podcast like so.</p>\n\n<pre><code>podcast := Podcast{\n    Title:    \"My Podcast\",\n    RssUrl:   \"http://example.com/feed/\",\n    Url:      \"http://www.example.com\",\n    Episodes: []Episode{{\n        Title:      \"Episode One Point Oh!\", \n        Url:        \"http://www.example.com/one-point-oh\", \n        Downloaded: false,\n    }},\n}\n\ndb.Create(&amp;podcast)\n</code></pre>\n\n<p>How do I go about adding episodes to a podcast that already exists later on?</p>\n"}, {"tags": ["go", "google-cloud-datastore"], "answers": [{"tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": true, "score": 5, "last_activity_date": 1434916269, "last_edit_date": 1434916269, "creation_date": 1434915894, "answer_id": 30968633, "question_id": 30968270, "link": "https://stackoverflow.com/questions/30968270/why-is-a-simple-struct-field-type-not-supported-in-gae-datastore/30968633#30968633", "title": "why is a simple struct field type not supported in GAE datastore?", "body": "<p>The <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference\" rel=\"noreferrer\">datastore package</a> doesn't allow all types to be used. In particular, it only allows the following types to be used:</p>\n\n<pre>\n- signed integers (int, int8, int16, int32 and int64),\n- bool,\n- string,\n- float32 and float64,\n- []byte (up to 1 megabyte in length),\n- any type whose underlying type is one of the above predeclared types,\n- ByteString,\n- *Key,\n- time.Time (stored with microsecond precision),\n- appengine.BlobKey,\n- appengine.GeoPoint,\n- structs whose fields are all valid value types,\n- slices of any of the above.\n</pre>\n\n<p>Note that this doesn't include \"any interface type\".</p>\n"}], "owner": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1201, "favorite_count": 1, "accepted_answer_id": 30968633, "answer_count": 1, "score": 1, "last_activity_date": 1475244493, "creation_date": 1434913651, "last_edit_date": 1475244493, "question_id": 30968270, "link": "https://stackoverflow.com/questions/30968270/why-is-a-simple-struct-field-type-not-supported-in-gae-datastore", "title": "why is a simple struct field type not supported in GAE datastore?", "body": "<p><a href=\"https://github.com/0xor1/gus/blob/master/gus_test.go#L19\" rel=\"nofollow\">my unit test</a> is failing with message:</p>\n\n<blockquote>\n  <p>&amp;errors.errorString{s:\"datastore: unsupported struct field type: sus.Version\"}</p>\n</blockquote>\n\n<p>I have a test struct type that I am trying to save to GAE datastore:</p>\n\n<pre><code>type foo struct{\n    sus.Version\n}\n</code></pre>\n\n<p>where sus.Version is the interface:</p>\n\n<pre><code>type Version interface{\n    GetVersion() int\n    getVersion() int\n    incrementVersion() \n    decrementVersion() \n}\n</code></pre>\n\n<p>I have tried running my test with two Version implementations, first where it is just an alias for an int:</p>\n\n<pre><code>type version int\n</code></pre>\n\n<p>and secondly as a struct:</p>\n\n<pre><code>type version struct{\n    val int\n}\n</code></pre>\n\n<p>where the Version interface methods are given receiver type <code>(v *version)</code>, it needs to be a pointer so decrement and increment actually update the version they are called on and not just a copy. I'm not sure why this isn't working, potentially because it's an anonymous field? or perhaps because it's a pointer to an int or struct rather than an actual int or struct?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1702, "user_id": 3747770, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/cbc0310d87016a34afa034e5e0661fba?s=128&d=identicon&r=PG&f=1", "display_name": "NJMR", "link": "https://stackoverflow.com/users/3747770/njmr"}, "edited": false, "score": 0, "creation_date": 1434883280, "post_id": 30963511, "comment_id": 49959198, "body": "<a href=\"http://play.golang.org/p/wL8rL9fepd\" rel=\"nofollow noreferrer\">play.golang.org/p/wL8rL9fepd</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1702, "user_id": 3747770, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/cbc0310d87016a34afa034e5e0661fba?s=128&d=identicon&r=PG&f=1", "display_name": "NJMR", "link": "https://stackoverflow.com/users/3747770/njmr"}, "edited": false, "score": 1, "creation_date": 1434883607, "post_id": 30963625, "comment_id": 49959269, "body": "Ya, I know, i was just playing with for, break and continue. Thanks for the answer..."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 10, "last_activity_date": 1434883390, "last_edit_date": 1434883390, "creation_date": 1434883323, "answer_id": 30963625, "question_id": 30963511, "link": "https://stackoverflow.com/questions/30963511/getting-syntax-error-unexpected-comma-expecting/30963625#30963625", "title": "Getting syntax error: unexpected comma, expecting {", "body": "<p>You need to initialize both <code>k</code> and <code>i</code>: <code>for k, i := 0, 0;</code></p>\n\n<p>Additionally you can't do: <code>i++, k++</code>. Instead you have to do  <code>i, k = i+1, k+1</code></p>\n\n<p>See <a href=\"https://golang.org/doc/effective_go.html#for\">this reference in Effective Go</a>:</p>\n\n<blockquote>\n  <p>Finally, Go has no comma operator and ++ and -- are statements not\n  expressions. Thus if you want to run multiple variables in a for you\n  should use parallel assignment (although that precludes ++ and --).</p>\n  \n  <p>// Reverse a </p>\n  \n  <p><code>for i, j := 0, len(a)-1; i &lt; j; i, j = i+1, j-1 {\n      a[i], a[j] = a[j], a[i] }</code></p>\n</blockquote>\n\n<pre><code>func main() {\n    for k, i := 0, 0; i &lt; 10;  i, k = i+1, k+1 {\n        for j := 0; j &lt; 10; j++ {\n            if k == 10 {\n                fmt.Println(\"Value of k is:\", k)\n                break\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Note also that <code>k</code> never reaches 10 like this, so your message won't print. You are incrementing <code>i</code> &amp; <code>k</code> at the same time and the outer loop stops at <code>i &lt; 10</code> (and thus <code>k &lt; 10</code>).</p>\n"}], "owner": {"reputation": 1702, "user_id": 3747770, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/cbc0310d87016a34afa034e5e0661fba?s=128&d=identicon&r=PG&f=1", "display_name": "NJMR", "link": "https://stackoverflow.com/users/3747770/njmr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11971, "favorite_count": 2, "accepted_answer_id": 30963625, "answer_count": 1, "score": 8, "last_activity_date": 1434883390, "creation_date": 1434882453, "last_edit_date": 1434883182, "question_id": 30963511, "link": "https://stackoverflow.com/questions/30963511/getting-syntax-error-unexpected-comma-expecting", "title": "Getting syntax error: unexpected comma, expecting {", "body": "<p>I was trying for, break and continue in golang and I did this...</p>\n\n<pre><code>func main() {\n    for k, i := 0, 0; i &lt; 10; i++, k++ {\n        for j := 0; j &lt; 10; j++ {\n            if k == 10 {\n                fmt.Println(\"Value of k is:\", k)\n                break\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I am getting this syntax error on line of the 1st <code>for</code>:</p>\n\n<blockquote>\n  <p>syntax error: unexpected comma, expecting {</p>\n</blockquote>\n\n<p>I don't know, how the correct syntax should be instead.</p>\n"}, {"tags": ["go", "refactoring"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 0, "creation_date": 1434883763, "post_id": 30962088, "comment_id": 49959311, "body": "I think it is better to find a another algorithm"}, {"owner": {"reputation": 1641, "user_id": 3828156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/scFYI.jpg?s=128&g=1", "display_name": "chendesheng", "link": "https://stackoverflow.com/users/3828156/chendesheng"}, "edited": false, "score": 0, "creation_date": 1434886781, "post_id": 30962088, "comment_id": 49960142, "body": "Is the question ask to find number of arr[i]+arr[j]+arr[k]=n ?"}, {"owner": {"reputation": 49583, "user_id": 76509, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/4e88ae5919c2cb224c5484976852a5f0?s=128&d=identicon&r=PG", "display_name": "freddiefujiwara", "link": "https://stackoverflow.com/users/76509/freddiefujiwara"}, "reply_to_user": {"reputation": 1641, "user_id": 3828156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/scFYI.jpg?s=128&g=1", "display_name": "chendesheng", "link": "https://stackoverflow.com/users/3828156/chendesheng"}, "edited": false, "score": 0, "creation_date": 1434956701, "post_id": 30962088, "comment_id": 49978854, "body": "@chendesheng  arr[i]+arr[j]+arr[k]=n  yes that&#39;s right"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1437350814, "last_edit_date": 1437350814, "creation_date": 1434916593, "answer_id": 30968727, "question_id": 30962088, "link": "https://stackoverflow.com/questions/30962088/challenge-of-finding-3-pairs-in-array/30968727#30968727", "title": "Challenge of finding 3 pairs in array", "body": "<p>Your time of almost seven minutes is very, very slow. Ten seconds is slow. One second is more reasonable, a tenth of a second is good. For example, using an O(N*N) algorithm,</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"errors\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"sort\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc triples(l int, b []int) int {\n    t := 0\n    sort.Ints(b)\n    // for i &lt; j &lt; k, b[i] &lt;= b[j] &lt;= b[k]\n    for i := 0; i &lt; len(b)-2; i++ {\n        x := b[i]\n        if x &gt; l {\n            break\n        }\n        lx := l - x\n        j, k := i+1, len(b)-1\n        y := b[j]\n        z := b[k]\n        for j &lt; k {\n            yz := y + z\n            switch {\n            case lx &gt; yz:\n                j++\n                y = b[j]\n            case lx &lt; yz:\n                k--\n                z = b[k]\n            default:\n                // l == b[i]+b[j]+b[k]\n                t++\n                j++\n                k--\n                y = b[j]\n                z = b[k]\n            }\n        }\n    }\n    return t\n}\n\nfunc readInput() (l int, b []int, err error) {\n    r := bufio.NewReader(os.Stdin)\n    for {\n        line, err := r.ReadString('\\n')\n        line = strings.TrimSpace(line)\n        if err == nil &amp;&amp; len(line) == 0 {\n            err = io.EOF\n        }\n        if err != nil {\n            if err == io.EOF {\n                break\n            }\n            return 0, nil, err\n        }\n        i, err := strconv.Atoi(string(line))\n        if err == nil &amp;&amp; i &lt; 0 {\n            err = errors.New(\"Nonpositive number: \" + line)\n        }\n        if err != nil {\n            return 0, nil, err\n        }\n        b = append(b, i)\n    }\n\n    if len(b) &gt; 0 {\n        l = b[0]\n        b = b[1:]\n        if len(b) &gt; 1 {\n            n := b[0]\n            b = b[1:]\n            if n != len(b) {\n                err := errors.New(\"Invalid number of bars: \" + strconv.Itoa(len(b)))\n                return 0, nil, err\n            }\n        }\n    }\n    return l, b, nil\n}\n\nfunc main() {\n    l, b, err := readInput()\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    t := triples(l, b)\n    fmt.Println(t)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>1571200\nreal    0m0.164s\nuser    0m0.161s\nsys     0m0.004s\n</code></pre>\n\n<p>For comparison, your program,</p>\n\n<p>Output:</p>\n\n<pre><code>1571200\nreal    9m24.384s\nuser    16m14.592s\nsys     0m19.129s\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1437262316, "post_id": 30972773, "comment_id": 50956632, "body": "My answer has been revised. It&#39;s much faster."}], "tags": [], "owner": {"reputation": 49583, "user_id": 76509, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/4e88ae5919c2cb224c5484976852a5f0?s=128&d=identicon&r=PG", "display_name": "freddiefujiwara", "link": "https://stackoverflow.com/users/76509/freddiefujiwara"}, "is_accepted": false, "score": 0, "last_activity_date": 1434952290, "last_edit_date": 1434952290, "creation_date": 1434951821, "answer_id": 30972773, "question_id": 30962088, "link": "https://stackoverflow.com/questions/30962088/challenge-of-finding-3-pairs-in-array/30972773#30972773", "title": "Challenge of finding 3 pairs in array", "body": "<p>ive tuned</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"errors\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"sort\"\n    \"strconv\"\n    \"strings\"\n)\n\ntype triple struct {\n    x, y, z int\n}\n\nfunc triples(l int, n []int, list bool) (nt int, t []triple) {\n    num_of_list := len(n)\n    for i := 0; i &lt; num_of_list-2; i++ {\n        x := n[i]\n        if x &gt; l {\n            break\n        }\n        for j := i + 1; j &lt; num_of_list-1; j++ {\n            y := x + n[j]\n            if y &gt; l {\n                break\n            }\n            pos := sort.SearchInts(n[j:], l-y)\n            if j &lt; pos+j &amp;&amp; pos+j &lt; num_of_list &amp;&amp; n[pos+j] == l-y {\n                nt++\n            }\n        }\n    }\n    return nt, t\n}\n\nfunc readInput() (l int, n []int, err error) {\n    r := bufio.NewReader(os.Stdin)\n    for {\n        line, err := r.ReadString('\\n')\n        line = strings.TrimSpace(line)\n        if err == nil &amp;&amp; len(line) == 0 {\n            err = io.EOF\n        }\n        if err != nil {\n            if err == io.EOF {\n                break\n            }\n            return 0, nil, err\n        }\n        i, err := strconv.Atoi(string(line))\n        if err == nil &amp;&amp; i &lt; 0 {\n            err = errors.New(\"Nonpositive number: \" + line)\n        }\n        if err != nil {\n            return 0, nil, err\n        }\n        n = append(n, i)\n    }\n\n    if len(n) &gt; 0 {\n        l = n[0]\n        n = n[1:]\n    }\n    sort.Ints(n)\n    for i := 1; i &lt; len(n); i++ {\n        if n[i] == n[i-1] {\n            copy(n[i:], n[i+1:])\n            n = n[:len(n)-1]\n        }\n    }\n    return l, n, nil\n}\n\nfunc main() {\n    l, n, err := readInput()\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    list := false\n    nt, t := triples(l, n, list)\n    fmt.Println(nt)\n    if list {\n        fmt.Println(t)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 49583, "user_id": 76509, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/4e88ae5919c2cb224c5484976852a5f0?s=128&d=identicon&r=PG", "display_name": "freddiefujiwara", "link": "https://stackoverflow.com/users/76509/freddiefujiwara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 30968727, "answer_count": 2, "score": -2, "last_activity_date": 1438219441, "creation_date": 1434870065, "last_edit_date": 1438219441, "question_id": 30962088, "link": "https://stackoverflow.com/questions/30962088/challenge-of-finding-3-pairs-in-array", "title": "Challenge of finding 3 pairs in array", "body": "<p>The length L at the time of joining, when the length of the bar of the N (1 \u2266 N \u2266 5000) is supplied from standard input, is the L by connecting three lengths among the N number of bars please write a program to find the total number of combinations of. However, and the length of the individual bars, length was pieced together (L) is a positive integer, is sufficient handle range in 32bit integer. In addition, it has all the length of the bar different things.</p>\n\n<p>for example)\ninput:</p>\n\n<pre><code>15\n5\n8\n4\n10\n3\n2\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>2 //{{2, 3, 10}, {3, 4, 8}}\n</code></pre>\n\n<p>example 2)\ninput :</p>\n\n<pre><code>35\n10\n13\n12\n17\n10\n4\n18\n3\n11\n5\n7\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>6 //{{4, 13, 18}, {5, 12, 18}, {5, 13, 17}, {7, 10, 18}, {7, 11, 17}, {10, 12, 13}}\n</code></pre>\n\n<p>and my answer is here</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\nfunc main() {\n    input_count := 0\n    var target int\n    var count int\n    var v int\n    var array []int\n    for read_count, _ := fmt.Scan(&amp;v); read_count != 0; read_count, _ = fmt.Scan(&amp;v) {\n        if 0 == input_count {\n            target = v\n        } else if 1 == input_count {\n            count = v\n            array = make([]int, count)\n        } else {\n            array[input_count-2] = v\n        }\n        input_count++\n    }\n    sort.Ints(array)\n    fmt.Println(Calculate(target, count, array))\n}\n\nfunc Except(pair []int, count int, array []int) []int {\n    except := make([]int, count-pair[2])\n    except_index := 0\n    on := false\n    for _, v := range array {\n        if on {\n            except[except_index] = v\n            except_index++\n        }\n        if v == pair[1] {\n            on = true\n        }\n\n    }\n    return except\n}\n\nfunc ListUp(target int, count int, array []int) [][]int {\n    max := array[count-1]\n    list := make([][]int, Fact(count-1))\n    list_index := 0\n    for i, h := range array {\n        if count &gt; i+1 &amp;&amp; target &gt; h+array[i+1] {\n            for j, v := range array[i+1:] {\n                if count &gt; i+j+1 &amp;&amp; target &lt;= max+h+v &amp;&amp; target &gt; h+v {\n                    list[list_index] = []int{h, v, i + j + 1}\n                    list_index++\n                }\n            }\n        }\n    }\n    return list\n}\n\n//func Calculate(target int, count int, array []int) [][]int {\nfunc Calculate(target int, count int, array []int) int {\n    //  var answers [][]int\n    answer_count := 0\n    for _, pair := range ListUp(target, count, array) {\n        if 3 == len(pair) {\n            pair_sum := pair[0] + pair[1]\n            if target-pair_sum &gt;= array[0] {\n                for _, v := range Except(pair, count, array) {\n                    if target == pair[0]+pair[1]+v {\n                        //                      answers = append(answers, []int{pair[0], pair[1], v})\n                        answer_count++\n\n                    }\n                }\n            }\n        }\n    }\n    return answer_count\n}\n\nfunc Fact(n int) int {\n    if n == 0 {\n        return 0\n    }\n    return n + Fact(n-1)\n}\n</code></pre>\n\n<p>Does anyone who can refactor the code?\nand you should refactor it \nif input \n<a href=\"https://github.com/freddiefujiwara/horiemon-challenge-codeiq/blob/master/sample4.txt\" rel=\"nofollow\">https://github.com/freddiefujiwara/horiemon-challenge-codeiq/blob/master/sample4.txt</a>\nthen output</p>\n\n<pre><code>1571200\n</code></pre>\n\n<p>in 10 seconds</p>\n\n<p>current status is here</p>\n\n<pre><code>time ./horiemon-challenge-codeiq &lt; sample4.txt\n1571200\n\nreal    6m56.584s\nuser    6m56.132s\nsys     0m1.578s\n</code></pre>\n\n<p>very very slow.</p>\n"}, {"tags": ["go", "libxml2", "gokogiri"], "comments": [{"owner": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "edited": false, "score": 0, "creation_date": 1434893060, "post_id": 30961987, "comment_id": 49961792, "body": "try to install libiconv from here: <a href=\"http://gnuwin32.sourceforge.net/packages/libiconv.htm\" rel=\"nofollow noreferrer\">gnuwin32.sourceforge.net/packages/libiconv.htm</a> (<a href=\"http://gnuwin32.sourceforge.net/install.html\" rel=\"nofollow noreferrer\">gnuwin32.sourceforge.net/install.html</a> - installation instructions). you don&#39;t need to worry about the integration between libxml2 and iconv, because gcc will do that for you."}, {"owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "reply_to_user": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "edited": false, "score": 0, "creation_date": 1434896265, "post_id": 30961987, "comment_id": 49962689, "body": "@bshuster13 Thanks for your response. I downloaded the installer, installed to <code>C:\\Lib\\GnuWin32</code>, add the path <code>C:\\Lib\\GnuWin32\\bin</code> to env. variable (not sure if this last step is necessary). But still the same error when I retry the <code>go get</code> command"}, {"owner": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "edited": false, "score": 0, "creation_date": 1434899384, "post_id": 30961987, "comment_id": 49963650, "body": "har07 is there any C:\\Lib\\libiconv-1.7-win32-x86/include/&quot; directory or something similar?"}, {"owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "reply_to_user": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "edited": false, "score": 0, "creation_date": 1434934854, "post_id": 30961987, "comment_id": 49973161, "body": "Sorry for late response, I left this over night. Yes, I do have that &#39;include&#39; directory"}], "owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 180, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1435377582, "creation_date": 1434869055, "last_edit_date": 1495535203, "question_id": 30961987, "link": "https://stackoverflow.com/questions/30961987/how-to-install-gokogiri-on-windows", "title": "How to install gokogiri on Windows?", "body": "<p>I'm trying to install <a href=\"https://github.com/moovweb/gokogiri\" rel=\"nofollow noreferrer\">gokogiri</a> on Windows 8 machine, and these are steps that I have done so far :</p>\n\n<ul>\n<li><p>Download <code>pkg-config_0.26-1_win32.zip</code> from <a href=\"http://ftp.gnome.org/pub/gnome/binaries/win32/dependencies\" rel=\"nofollow noreferrer\">here</a>, unzip/extract, and add the <code>bin</code> folder to <code>path</code> environment variable</p></li>\n<li><p>Donwload <code>libxml2-2.9.2-win32-x86.7z</code> from <a href=\"ftp://ftp.zlatkovic.com/libxml/64bit\" rel=\"nofollow noreferrer\">here</a>, unzip to a location which path doesn't contain space(s) (otherwise <a href=\"https://stackoverflow.com/questions/30960805/error-libxml2-not-found-on-installing-gokogiri-on-windows\"><code>gcc</code> won't be able to find the location</a>). Create new environment variable <code>PKG_CONFIG_PATH</code>, and add libxml's <code>\\lib\\pkgconfig</code> folder location to the env variable.</p></li>\n<li><p>Donwload and install tdm64-gcc from <a href=\"http://downloads.sourceforge.net/project/tdm-gcc/TDM-GCC%20Installer/tdm64-gcc-4.8.1.exe?r=http%3A%2F%2Ftdm-gcc.tdragon.net%2F&amp;ts=1380861880&amp;use_mirror=superb-dca2\" rel=\"nofollow noreferrer\">here</a></p></li>\n<li><p>run the following command (as suggested in the GitHub link above) : <code>go get github.com/moovweb/gokogiri</code></p></li>\n</ul>\n\n<p>but then I get this error :</p>\n\n<p><img src=\"https://i.stack.imgur.com/GFVjt.png\" alt=\"enter image description here\"></p>\n\n<p>What is the error message complaining about now? If I need to download <a href=\"ftp://ftp.zlatkovic.com/libxml/64bit/\" rel=\"nofollow noreferrer\"><code>icnov</code></a> manually, how then I put it together with <code>libxml2</code> to work properly?</p>\n"}, {"tags": ["go", "libxml2", "gokogiri"], "comments": [{"owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "reply_to_user": {"reputation": 6770, "user_id": 1167750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6387e9afe6be3396d9fe83436a2b112c?s=128&d=identicon&r=PG", "display_name": "summea", "link": "https://stackoverflow.com/users/1167750/summea"}, "edited": false, "score": 1, "creation_date": 1434858632, "post_id": 30960805, "comment_id": 49954457, "body": "Thanks for the response, but I&#39;m not using MinGW. I also have liteIDE (just like the OP there) and it&#39;s fine to build &amp; run some of go codes I wrote"}], "answers": [{"comments": [{"owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "edited": false, "score": 0, "creation_date": 1434861145, "post_id": 30961112, "comment_id": 49954859, "body": "The reason makes perfect sense. Moving libxml to a folder that doesn&#39;t contain space (and update env. variable accordingly) solves error in the 2nd screenshot above.Now I&#39;m moving on to the next error message"}], "tags": [], "owner": {"reputation": 1720, "user_id": 989659, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/84d2d1476d96b093bd0f180412db2460?s=128&d=identicon&r=PG", "display_name": "Srgrn", "link": "https://stackoverflow.com/users/989659/srgrn"}, "is_accepted": true, "score": 1, "last_activity_date": 1434871880, "last_edit_date": 1434871880, "creation_date": 1434858755, "answer_id": 30961112, "question_id": 30960805, "link": "https://stackoverflow.com/questions/30960805/error-libxml2-not-found-on-installing-gokogiri-on-windows/30961112#30961112", "title": "error libxml2 not found on installing gokogiri on windows", "body": "<p>you have a space in your path to libxml.</p>\n\n<p>option 1: remove libxml and reinstall it at a path without spaces (not program files)</p>\n\n<p>option 2 (might not work for gcc) in the enviroment variable points to libxml (including your path) use quotes around the name path to libxml</p>\n"}], "owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 557, "favorite_count": 0, "accepted_answer_id": 30961112, "answer_count": 1, "score": 0, "last_activity_date": 1434871880, "creation_date": 1434854814, "last_edit_date": 1592644375, "question_id": 30960805, "link": "https://stackoverflow.com/questions/30960805/error-libxml2-not-found-on-installing-gokogiri-on-windows", "title": "error libxml2 not found on installing gokogiri on windows", "body": "<p>I'm trying to install <a href=\"https://github.com/moovweb/gokogiri\" rel=\"nofollow noreferrer\">gokogiri</a> on Windows 8 machine following instructions in their github page :</p>\n<blockquote>\n<p>To install:</p>\n<ul>\n<li>sudo apt-get install libxml2-dev</li>\n<li>go get github.com/moovweb/gokogiri</li>\n</ul>\n</blockquote>\n<p>skipping the first command (as it isn't available on Windows), I get the following error :</p>\n<p><img src=\"https://i.stack.imgur.com/tkelu.png\" alt=\"enter image description here\" /></p>\n<p>What is the error complaining about? Should I install libxml-2.0 manually before retrying the &quot;go get&quot; command?</p>\n<p><strong>UPDATE :</strong></p>\n<p>The following are the steps I've done, each step based on error message I get from retrying the <code>go get</code> command after completing the previous step :</p>\n<ul>\n<li><p>Download <code>pkg-config_0.26-1_win32.zip</code> from <a href=\"http://ftp.gnome.org/pub/gnome/binaries/win32/dependencies\" rel=\"nofollow noreferrer\">here</a>, unzip/extract, and add the <code>bin</code> folder to <code>path</code> environment variable</p>\n</li>\n<li><p>Donwload <code>libxml2-2.9.2-win32-x86.7z</code> from <a href=\"ftp://ftp.zlatkovic.com/libxml/64bit\" rel=\"nofollow noreferrer\">here</a>, unzip. Create new environment variable <code>PKG_CONFIG_PATH</code>, and add libxml's <code>\\lib\\pkgconfig</code> folder location to the env variable.</p>\n</li>\n<li><p>Donwload and install tdm64-gcc from <a href=\"http://downloads.sourceforge.net/project/tdm-gcc/TDM-GCC%20Installer/tdm64-gcc-4.8.1.exe?r=http%3A%2F%2Ftdm-gcc.tdragon.net%2F&amp;ts=1380861880&amp;use_mirror=superb-dca2\" rel=\"nofollow noreferrer\">here</a></p>\n</li>\n</ul>\n<p>Now the error message is as follow. What should I do next? How to properly make <code>gcc</code> aware of the location of my libxml2 files?</p>\n<p><img src=\"https://i.stack.imgur.com/h5tcA.png\" alt=\"enter image description here\" /></p>\n"}, {"tags": ["unit-testing", "go", "martini"], "answers": [{"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": false, "score": 3, "last_activity_date": 1434840267, "creation_date": 1434840267, "answer_id": 30959585, "question_id": 30958005, "link": "https://stackoverflow.com/questions/30958005/go-martini-unit-test-example/30959585#30959585", "title": "Go Martini Unit Test Example", "body": "<p>The martini-contrib library has a lot of existing code worth looking at: <a href=\"https://github.com/martini-contrib/secure/blob/master/secure_test.go\" rel=\"nofollow\">https://github.com/martini-contrib/secure/blob/master/secure_test.go</a></p>\n\n<p>e.g.</p>\n\n<pre><code>func Test_No_Config(t *testing.T) {\n    m := martini.Classic()\n    m.Use(Secure(Options{\n    // nothing here to configure\n    }))\n\n    m.Get(\"/foo\", func() string {\n        return \"bar\"\n    })\n\n    res := httptest.NewRecorder()\n    req, _ := http.NewRequest(\"GET\", \"/foo\", nil)\n\n    m.ServeHTTP(res, req)\n\n    expect(t, res.Code, http.StatusOK)\n    expect(t, res.Body.String(), `bar`)\n}\n</code></pre>\n\n<p>To sum:</p>\n\n<ol>\n<li>Create a server with <code>martini.Classic()</code></li>\n<li>Create a route to the handler you want to test</li>\n<li>Execute it against a response recorder</li>\n<li>Inspect the results (status code, body) on the response recorder are as expected.  </li>\n</ol>\n"}], "owner": {"reputation": 43, "user_id": 3377078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd5de17aee6a98ce92a113fd5b94f5e9?s=128&d=identicon&r=PG&f=1", "display_name": "user3377078", "link": "https://stackoverflow.com/users/3377078/user3377078"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1434840267, "creation_date": 1434828298, "question_id": 30958005, "link": "https://stackoverflow.com/questions/30958005/go-martini-unit-test-example", "title": "Go Martini Unit Test Example", "body": "<p>I'm very new to Go and was wondering is there any convention/standard with examples on how to test Go Martini's Handler code?</p>\n\n<p>Thanking you in advance!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1043, "user_id": 1072106, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2089a97662ff298a1ec19c874d3be639?s=128&d=identicon&r=PG", "display_name": "JoshStrange", "link": "https://stackoverflow.com/users/1072106/joshstrange"}, "edited": false, "score": 2, "creation_date": 1434824298, "post_id": 30957237, "comment_id": 49947490, "body": "This cannot be done with a map alone <a href=\"http://stackoverflow.com/a/11853555/1072106\">stackoverflow.com/a/11853555/1072106</a>."}, {"owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "edited": false, "score": 0, "creation_date": 1434887715, "post_id": 30957237, "comment_id": 49960375, "body": "Looping over a map gives an intentionally randomized iteration order. If yo want a consistent iteration order, you have to extract the keys and sort them."}], "answers": [{"comments": [{"owner": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 0, "creation_date": 1434824291, "post_id": 30957319, "comment_id": 49947486, "body": "It definitaly works but is there any way to do it without creating an array in addition to the map ?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 5, "creation_date": 1434824762, "post_id": 30957319, "comment_id": 49947620, "body": "Firstly, <code>keys</code> is a slice, not an array. Secondly, no. The order of map iteration is not guaranteed. If you want to reliably iterate over a map in a certain order, you need to create that order yourself."}, {"owner": {"reputation": 1125, "user_id": 4224724, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XMleNi8A3cE/AAAAAAAAAAI/AAAAAAAACzU/_LZ3Rgct8Xk/photo.jpg?sz=128", "display_name": "Danver Braganza", "link": "https://stackoverflow.com/users/4224724/danver-braganza"}, "edited": false, "score": 1, "creation_date": 1435082775, "post_id": 30957319, "comment_id": 50047396, "body": "I agree with your general point that you need to create that order themselves.   I just wanted to add that while <code>keys</code> is a slice, it will be backed by an array. I assume the reason for the question was that they didn&#39;t want to allocate any more memory, and slices aren&#39;t free."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 4, "last_activity_date": 1434823894, "creation_date": 1434823894, "answer_id": 30957319, "question_id": 30957237, "link": "https://stackoverflow.com/questions/30957237/go-loop-through-map-on-the-same-order-multiple-times/30957319#30957319", "title": "Go - loop through map on the same order multiple times", "body": "<p>Save the keys in the first loop and use them in the second loop:</p>\n\n<pre><code>keys := make([]string, 0, len(m))\nfor k, v := range m {\n    fmt.Println(k, v)\n    keys = append(keys, k)\n}\nfor _, k := range keys {\n    fmt.Println(k, m[k])\n}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/MstH20wkNN\" rel=\"nofollow\">http://play.golang.org/p/MstH20wkNN</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 0, "creation_date": 1434831546, "post_id": 30957618, "comment_id": 49949666, "body": "thankyou for you&#39;re answer which explains me why it&#39;s made like so."}], "tags": [], "owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "is_accepted": false, "score": 4, "last_activity_date": 1434825803, "last_edit_date": 1495541164, "creation_date": 1434825803, "answer_id": 30957618, "question_id": 30957237, "link": "https://stackoverflow.com/questions/30957237/go-loop-through-map-on-the-same-order-multiple-times/30957618#30957618", "title": "Go - loop through map on the same order multiple times", "body": "<p>Go makes sure that you cannot rely on a map's order as stated in this blog post <a href=\"https://blog.golang.org/go-maps-in-action#TOC_7\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-maps-in-action#TOC_7</a>. </p>\n\n<blockquote>\n  <p>When iterating over a map with a range loop, the iteration order is not specified and is not guaranteed to be the same from one iteration to the next. Since Go 1 the runtime randomizes map iteration order, as programmers relied on the stable iteration order of the previous implementation. If you require a stable iteration order you must maintain a separate data structure that specifies that order. </p>\n</blockquote>\n\n<p>Ainar-G's answer is correct, but here is a variation of it while incorporating this answer... <a href=\"https://stackoverflow.com/a/27848197/3536948\">https://stackoverflow.com/a/27848197/3536948</a></p>\n\n<pre><code>keys := make([]string, len(m))\ni := 0\nfor k, _ := range m {\n    keys[i] = k\n    i += 1\n}\nfor _, k := range keys {\n    fmt.Println(m[k])\n}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/64onPZNODm\" rel=\"nofollow noreferrer\">http://play.golang.org/p/64onPZNODm</a></p>\n"}], "owner": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1318, "favorite_count": 0, "accepted_answer_id": 30957319, "answer_count": 2, "score": 2, "last_activity_date": 1434825803, "creation_date": 1434823288, "last_edit_date": 1434824336, "question_id": 30957237, "link": "https://stackoverflow.com/questions/30957237/go-loop-through-map-on-the-same-order-multiple-times", "title": "Go - loop through map on the same order multiple times", "body": "<p>How can I loop through a map on a constant order multiple times ?</p>\n\n<p>In my go code I am looping through a map twice but the values are not appearing on the same order on both loops :</p>\n\n<p><code>fieldMap := map[string]int{...}</code></p>\n\n<p>First loop : </p>\n\n<p><code>for k, _ := range fieldMap {...}</code></p>\n\n<p>Second loop : </p>\n\n<p><code>for _, v := range fieldMap {...}</code></p>\n"}, {"tags": ["hash", "go", "cryptography", "sha256"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1434837424, "post_id": 30956244, "comment_id": 49951243, "body": "Note that SHA256 is a <i>terribly insecure</i> way to hash (it&#39;s a hash algorithm, not an encryption algorithm) user passwords. You should be using a key derivation function (KDF) designed for this purpose. bcrypt (<a href=\"https://godoc.org/golang.org/x/crypto/bcrypt\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/crypto/bcrypt</a>) and scrypt (<a href=\"https://github.com/elithrar/simple-scrypt\" rel=\"nofollow noreferrer\">github.com/elithrar/simple-scrypt</a>) are the de facto standards here."}, {"owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1434837590, "post_id": 30956244, "comment_id": 49951279, "body": "Thanks for the pointer, really just programming to spec on this to match the provided test data. The provided design also stores passwords in the clear on a JSON file."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 3, "creation_date": 1434839892, "post_id": 30956244, "comment_id": 49951759, "body": "Yeah I&#39;ve contacted them in the hopes they will use a more suitable construct. It sets up newbies for failure in the long run as lessons like this come across as &quot;authoritative&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 5469, "user_id": 598940, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/3665d076aec49bf74e33d162bde6a710?s=128&d=identicon&r=PG", "display_name": "Alec", "link": "https://stackoverflow.com/users/598940/alec"}, "edited": false, "score": 1, "creation_date": 1434818653, "post_id": 30956460, "comment_id": 49945738, "body": "FWIW <code>b := h.Sum(nil)</code> would also work for your first example."}, {"owner": {"reputation": 876, "user_id": 137196, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/244e6196a79d2f18d873577f0d6459f7?s=128&d=identicon&r=PG", "display_name": "Louie Miranda", "link": "https://stackoverflow.com/users/137196/louie-miranda"}, "edited": false, "score": 0, "creation_date": 1580723415, "post_id": 30956460, "comment_id": 106177356, "body": "This is great. Just have one question, are the result already on digest?"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 10, "last_activity_date": 1434818716, "last_edit_date": 1434818716, "creation_date": 1434818490, "answer_id": 30956460, "question_id": 30956244, "link": "https://stackoverflow.com/questions/30956244/golang-base64-encoded-sha256-digest-of-the-user-s-password/30956460#30956460", "title": "Golang Base64 encoded SHA256 digest of the user\u2019s password", "body": "<p>You're misusing the <code>Sum</code> method. The <a href=\"http://golang.org/pkg/hash/#Hash\" rel=\"noreferrer\">docs</a> for the <code>hash.Hash</code> interface clearly say that</p>\n\n<blockquote>\n  <p>Sum <em>appends</em> the current hash to b and returns the resulting slice.</p>\n</blockquote>\n\n<p>(Emphasis added.)</p>\n\n<p>You need to either write the data to the hash and use <code>h.Sum</code> like this</p>\n\n<pre><code>h.Write([]byte(password))\nb := h.Sum(nil)\n</code></pre>\n\n<p>or just use <a href=\"http://golang.org/pkg/crypto/sha256/#Sum256\" rel=\"noreferrer\"><code>sha256.Sum256</code></a></p>\n\n<pre><code>h := sha256.Sum256([]byte(password))\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/oFBePRQzhN\" rel=\"noreferrer\">http://play.golang.org/p/oFBePRQzhN</a>.</p>\n"}], "owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8756, "favorite_count": 0, "accepted_answer_id": 30956460, "answer_count": 1, "score": 2, "last_activity_date": 1434818716, "creation_date": 1434817174, "last_edit_date": 1434817260, "question_id": 30956244, "link": "https://stackoverflow.com/questions/30956244/golang-base64-encoded-sha256-digest-of-the-user-s-password", "title": "Golang Base64 encoded SHA256 digest of the user\u2019s password", "body": "<p>I am attempting to complete the Top Code Go Learning Challenges as a vehicle to learn go.  I'm currently working on their <a href=\"https://www.topcoder.com/challenge-details/30046011/?type=develop\" rel=\"nofollow\">Simple API Web Server problem</a>.  Part of that problem calls for you to encrypt a password string as such \"\u2018{SHA256}\u2019 + Base64 encoded SHA256 digest of the user\u2019s password\"</p>\n\n<p>I've used the following code to do this, but the results don't match the test case provided.  </p>\n\n<pre><code>import (\n    \"encoding/base64\"\n    \"crypto/sha256\"\n)\n\nfunc encrtyptPasswords(password string) string {\n    h := sha256.New()\n    return \"{SHA256}\" + \n       string(base64.StdEncoding.EncodeToString(h.Sum([]byte(password))))\n}\n</code></pre>\n\n<p>For an input of abcd1234 it should encrypt to: {SHA256}6c7nGrky_ehjM40Ivk3p3-OeoEm9r7NCzmWexUULaa4=</p>\n\n<p>But I get {SHA256}YWJjZDEyMzTjsMRCmPwcFJr79MiZb7kkJ65B5GSbk0yklZkbeFK4VQ== instead.  I suspect I'm using the encryption libraries wrong, but I'm not sure what I should be using as this seems to be the standard library method of encryption to SHA256.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 0, "creation_date": 1434818430, "post_id": 30956258, "comment_id": 49945656, "body": "Thankyou ! It works but is there anyway I could to this without assigning it to a variable. So that if I need to concatenate some strings together I won&#39;t have to create thousands of variable."}, {"owner": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 0, "creation_date": 1434818556, "post_id": 30956258, "comment_id": 49945712, "body": "I get this error : multiple-value fmt.Printf() in single-value context if I don&#39;t do this :  x, _ = fmt.Sprintf(&quot;%02d&quot;, 1)"}, {"owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "reply_to_user": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 0, "creation_date": 1434818566, "post_id": 30956258, "comment_id": 49945716, "body": "I updated the answer to include example code for both printing directly and assigning to a variable."}, {"owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "reply_to_user": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 0, "creation_date": 1434818666, "post_id": 30956258, "comment_id": 49945744, "body": "<code>fmt.Printf()</code> will return an integer and and error. The integer represents the number of bytes printed. If you want to capture that, you need to account for both the byte count and the error."}, {"owner": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 0, "creation_date": 1434818774, "post_id": 30956258, "comment_id": 49945781, "body": "I still get the same error when trying to print directly like this : fmt.Printf(&quot;%02d&quot;, rand.Intn(12))"}, {"owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "reply_to_user": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 0, "creation_date": 1434818920, "post_id": 30956258, "comment_id": 49945832, "body": "The following works for me <code>fmt.Printf(&quot;%02d\\n&quot;, rand.Intn(12))</code> using <code>math&#47;rand</code>. If you are assigning the results to variables you need to do something like <code>byteCount, err := fmt.Printf(&quot;%02d\\n&quot;, rand.Intn(12))</code> or <code>byteCount, _ := fmt.Printf(&quot;%02d\\n&quot;, rand.Intn(12))</code> to ignore the error."}, {"owner": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 0, "creation_date": 1434819407, "post_id": 30956258, "comment_id": 49945977, "body": "Thankyou for your complete answer"}], "tags": [], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "is_accepted": true, "score": 11, "last_activity_date": 1434818845, "last_edit_date": 1434818845, "creation_date": 1434817230, "answer_id": 30956258, "question_id": 30956224, "link": "https://stackoverflow.com/questions/30956224/go-how-to-format-number-digit-count/30956258#30956258", "title": "Go - How to format number digit count", "body": "<p>You can use <a href=\"https://golang.org/pkg/fmt/#Printf\" rel=\"noreferrer\"><code>fmt.Printf()</code></a> or <a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"noreferrer\"><code>fmt.Sprintf()</code></a> to create a string with left-padded zeroes. <code>fmt.Printf()</code> will print the data while <code>fmt.Sprintf()</code> will allow you to assign the resulting string to a variable.</p>\n\n<p>Here are the signatures from the docs:</p>\n\n<pre><code>func Printf(format string, a ...interface{}) (n int, err error)\n\nfunc Sprintf(format string, a ...interface{}) string\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>// Printing directly using fmt.Printf()\nfmt.Printf(\"%02d\\n\", 1)\n\n// With output assignment\ncount, err := fmt.Printf(\"%02d\\n\", 1)\nif err == nil {\n    fmt.Printf(\"Printed %v bytes\\n\", count)\n} else {\n    fmt.Println(\"Error printing\")\n}\n\n// Assigning to variable using fmt.Sprintf()\nformatted := fmt.Sprintf(\"%02d\", 1)\nfmt.Println(formatted)\n</code></pre>\n\n<p>Docs: <a href=\"https://golang.org/pkg/fmt/\" rel=\"noreferrer\">https://golang.org/pkg/fmt/</a></p>\n"}, {"comments": [{"owner": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 0, "creation_date": 1434818313, "post_id": 30956272, "comment_id": 49945623, "body": "An error tells me I need to assign the value to a variable : multiple-value fmt.Printf() in single-value context"}, {"owner": {"reputation": 52334, "user_id": 702638, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/892f65bc0a8a0949ab88598de7d83cab?s=128&d=identicon&r=PG", "display_name": "Hunter McMillen", "link": "https://stackoverflow.com/users/702638/hunter-mcmillen"}, "reply_to_user": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 0, "creation_date": 1434818436, "post_id": 30956272, "comment_id": 49945659, "body": "How are you calling Printf?"}, {"owner": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "edited": false, "score": 0, "creation_date": 1434818861, "post_id": 30956272, "comment_id": 49945814, "body": "fmt.Printf(&quot;%02d&quot;, rand.Intn(12))"}], "tags": [], "owner": {"reputation": 52334, "user_id": 702638, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/892f65bc0a8a0949ab88598de7d83cab?s=128&d=identicon&r=PG", "display_name": "Hunter McMillen", "link": "https://stackoverflow.com/users/702638/hunter-mcmillen"}, "is_accepted": false, "score": 4, "last_activity_date": 1434817337, "creation_date": 1434817337, "answer_id": 30956272, "question_id": 30956224, "link": "https://stackoverflow.com/questions/30956224/go-how-to-format-number-digit-count/30956272#30956272", "title": "Go - How to format number digit count", "body": "<p>You should take a look at the <a href=\"http://golang.org/pkg/fmt/#Printf\" rel=\"nofollow\"><code>fmt.Printf</code></a> documentation. It explains all of the formatting flags. The specific ones you are looking for are <code>0</code> and <code>2</code>. <code>0</code> indicates that you want to pad the number to the specified width with leading zeros. <code>2</code> indicates the width that you want, these two flags together will pad single digits with a leading 0, but ignore numbers that are 2 digits in length or greater.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    for i := 1; i &lt;= 10; i++ {\n        fmt.Printf(\"%02d\\n\", i)\n    }\n}\n</code></pre>\n\n<p>outputs:</p>\n\n<pre><code>01\n02\n03\n04\n05\n06\n07\n08\n09\n10\n</code></pre>\n"}], "owner": {"reputation": 3188, "user_id": 2880366, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/5tyAn.jpg?s=128&g=1", "display_name": "AlexB", "link": "https://stackoverflow.com/users/2880366/alexb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9920, "favorite_count": 0, "accepted_answer_id": 30956258, "answer_count": 2, "score": 7, "last_activity_date": 1525931827, "creation_date": 1434817083, "last_edit_date": 1525931827, "question_id": 30956224, "link": "https://stackoverflow.com/questions/30956224/go-how-to-format-number-digit-count", "title": "Go - How to format number digit count", "body": "<p>How can I format an int in go to make sure there is always two digits? \nFor example, 1 would be formatted to <code>01</code>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1434818706, "post_id": 30955792, "comment_id": 49945757, "body": "Replace every instance of &quot;array&quot; with &quot;slice&quot; in your question. <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">The two are very different things in Go</a>."}], "answers": [{"comments": [{"owner": {"reputation": 31539, "user_id": 367985, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/761edb9c3cf7a0a643e73ef40666a1f7?s=128&d=identicon&r=PG", "display_name": "CuriousMind", "link": "https://stackoverflow.com/users/367985/curiousmind"}, "edited": false, "score": 0, "creation_date": 1434815766, "post_id": 30955831, "comment_id": 49944736, "body": "It makes sense now, Thank you!"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 5, "last_activity_date": 1434814862, "creation_date": 1434814862, "answer_id": 30955831, "question_id": 30955792, "link": "https://stackoverflow.com/questions/30955792/difference-between-for-loop-construct-vs-range-keyword-in-go/30955831#30955831", "title": "Difference between for loop construct vs range keyword in go", "body": "<p>As mentioned in <a href=\"https://github.com/golang/go/wiki/Range\" rel=\"noreferrer\">Range Clauses</a>:</p>\n\n<blockquote>\n  <p>A range clause provides a way to iterate over a array, slice, string, map, or channel.</p>\n</blockquote>\n\n<p>If you want to iterate over an <code>[]string</code>, you need <code>range</code>.</p>\n\n<p>A <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"noreferrer\">For statement</a> doesn't always use range.</p>\n\n<pre><code>ForStmt = \"for\" [ Condition | ForClause | RangeClause ] Block .\n</code></pre>\n\n<p>You have:</p>\n\n<blockquote>\n  <ul>\n  <li><p>In its simplest form, a \"<code>for</code>\" statement specifies the repeated execution of a block as long as a boolean condition evaluates to true</p></li>\n  <li><p>A \"for\" statement with a <code>ForClause</code> is also controlled by its condition, but additionally it may specify an init and a post statement, such as an assignment, an increment or decrement statement</p></li>\n  <li><p>A \"for\" statement with a \"range\" clause iterates through all entries of an array, slice, string or map, or values received on a channel. For each entry it assigns iteration values to corresponding iteration variables if present and then executes the block. </p></li>\n  </ul>\n</blockquote>\n"}], "owner": {"reputation": 31539, "user_id": 367985, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/761edb9c3cf7a0a643e73ef40666a1f7?s=128&d=identicon&r=PG", "display_name": "CuriousMind", "link": "https://stackoverflow.com/users/367985/curiousmind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2267, "favorite_count": 2, "accepted_answer_id": 30955831, "answer_count": 1, "score": 5, "last_activity_date": 1434814862, "creation_date": 1434814681, "question_id": 30955792, "link": "https://stackoverflow.com/questions/30955792/difference-between-for-loop-construct-vs-range-keyword-in-go", "title": "Difference between for loop construct vs range keyword in go", "body": "<p>Consider the following code which just prints all the ENV vars</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    for i, env := range os.Environ() {\n        fmt.Println(i, env)\n    }\n}\n</code></pre>\n\n<p>Here, os.Environ() is supposed to return <a href=\"https://golang.org/src/os/env.go?s=2990:3013#L96\" rel=\"noreferrer\">array of strings([] string</a>), to loop over it. I need to to use range keyword &amp; also for loop. Question is:</p>\n\n<ol>\n<li>Why are both for &amp; range required? is it possible to use for loop for this as <code>[]string</code> is already an array &amp; we can iterate over arrays right?</li>\n<li>In the above code what does <code>range</code> do? and what does <code>for</code> loop does?</li>\n</ol>\n\n<p>Sorry if this question is too stupid, I am just starting with Go</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3140, "user_id": 700650, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9babd166888c602545c93f15f4ce139?s=128&d=identicon&r=PG", "display_name": "Xiaotian Pei", "link": "https://stackoverflow.com/users/700650/xiaotian-pei"}, "reply_to_user": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 2, "creation_date": 1434809541, "post_id": 30954890, "comment_id": 49942820, "body": "you can also check out <a href=\"http://golang.org/pkg/strings/#ContainsAny\" rel=\"nofollow noreferrer\">golang.org/pkg/strings/#ContainsAny</a> There are already a lot of examples there"}], "tags": [], "owner": {"reputation": 3140, "user_id": 700650, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9babd166888c602545c93f15f4ce139?s=128&d=identicon&r=PG", "display_name": "Xiaotian Pei", "link": "https://stackoverflow.com/users/700650/xiaotian-pei"}, "is_accepted": true, "score": 11, "last_activity_date": 1434809297, "creation_date": 1434809297, "answer_id": 30954890, "question_id": 30954852, "link": "https://stackoverflow.com/questions/30954852/differences-between-strings-contains-and-strings-containsany-in-golang/30954890#30954890", "title": "Differences between strings.Contains and strings.ContainsAny in Golang", "body": "<p>I think two functions are totally different. Contains are used to detect if a string contains a substring. ContainsAny are used to detect if a string contains any chars in the provided string.</p>\n"}], "owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6665, "favorite_count": 0, "accepted_answer_id": 30954890, "answer_count": 1, "score": 4, "last_activity_date": 1538575093, "creation_date": 1434809086, "last_edit_date": 1538575093, "question_id": 30954852, "link": "https://stackoverflow.com/questions/30954852/differences-between-strings-contains-and-strings-containsany-in-golang", "title": "Differences between strings.Contains and strings.ContainsAny in Golang", "body": "<p>In the source code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Contains returns true if substr is within s.\nfunc Contains(s, substr string) bool {\n    return Index(s, substr) &gt;= 0\n}\n\n// ContainsAny returns true if any Unicode code points in chars are within s.\nfunc ContainsAny(s, chars string) bool {\n    return IndexAny(s, chars) &gt;= 0\n}\n</code></pre>\n\n<p>the only difference seems to be <code>substr</code> and <code>the Unicode code points in chars</code>. I wrote some test to test both of them. Their behaviors seem to be identical. I don't understand when to use which.</p>\n"}, {"tags": ["go", "static-linking"], "answers": [{"tags": [], "owner": {"reputation": 2295, "user_id": 510091, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/125e5dbc8d42f8766ddf2702ab99e8ce?s=128&d=identicon&r=PG", "display_name": "Mark Larter", "link": "https://stackoverflow.com/users/510091/mark-larter"}, "is_accepted": true, "score": 5, "last_activity_date": 1434804228, "creation_date": 1434804228, "answer_id": 30954160, "question_id": 30954159, "link": "https://stackoverflow.com/questions/30954159/go-program-not-statically-linked-using-1-4-2/30954160#30954160", "title": "Go program not statically linked using 1.4.2", "body": "<p>More searching turned up <a href=\"https://github.com/golang/go/issues/9344\">this thread in the golang issue tracker</a> about being unable to statically link a program that imports the <code>net</code> package due to changes between 1.3 and 1.4.</p>\n\n<p>Reading down I found <a href=\"https://github.com/golang/go/issues/9344#issuecomment-69944514\">this workaround suggested by ianlancetaylor</a> to use the <code>-installsuffix</code> switch to specify <code>cgo</code>. This made my build statement:</p>\n\n<pre><code>CGO_ENABLED=0 go install -a -installsuffix cgo -ldflags '-s' .\n</code></pre>\n\n<p>Which worked for me. Build succeeded and produced a statically linked program.</p>\n"}], "owner": {"reputation": 2295, "user_id": 510091, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/125e5dbc8d42f8766ddf2702ab99e8ce?s=128&d=identicon&r=PG", "display_name": "Mark Larter", "link": "https://stackoverflow.com/users/510091/mark-larter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 880, "favorite_count": 1, "accepted_answer_id": 30954160, "answer_count": 1, "score": 2, "last_activity_date": 1435002506, "creation_date": 1434804228, "last_edit_date": 1435002506, "question_id": 30954159, "link": "https://stackoverflow.com/questions/30954159/go-program-not-statically-linked-using-1-4-2", "title": "Go program not statically linked using 1.4.2", "body": "<p>Trying to build a statically linked version of a go program that runs an http server, and uses the net package to determine and parse the IP address of the incoming request. With this build statement:</p>\n\n<pre><code>CGO_ENABLED=0 go install -a -ldflags '-s' .\n</code></pre>\n\n<p>And this preamble in my program:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n    \"path/filepath\"\n    \"strings\"\n\n    \"golang.org/x/blog/content/context/userip\"\n\n    \"github.com/oschwald/maxminddb-golang\"\n)\n</code></pre>\n\n<p>This worked building with go 1.3, producing a statically linked program, but is not working with go 1.4.2. The build succeeds, but the program is not statically linked.</p>\n\n<p>Does anyone know what is going on?</p>\n"}, {"tags": ["go", "proxy", "listener", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1434794573, "post_id": 30952623, "comment_id": 49938819, "body": "Never use a pointer to an interface, it&#39;s only confusing the issue and probably related to your panic. If the port is bound, then you&#39;re not waiting for the socket to close before binding again. Please show the actual code handling that."}, {"owner": {"reputation": 1701, "user_id": 788887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f68a54ea809de360f7049f5c970df1d7?s=128&d=identicon&r=PG", "display_name": "ReyCharles", "link": "https://stackoverflow.com/users/788887/reycharles"}, "edited": false, "score": 0, "creation_date": 1434795797, "post_id": 30952623, "comment_id": 49939125, "body": "I don&#39;t think you should use <code>l</code> if <code>err != nil</code>. I don&#39;t remember what the conventions are, but I could imagine it&#39;s just garbage."}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1434801690, "post_id": 30952623, "comment_id": 49940668, "body": "@JimB I have edited my original post."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1434803285, "post_id": 30952623, "comment_id": 49941071, "body": "You have to handle the closing socket around the accept loop, so check for the error retuned by http.Serve. Also, don&#39;t set the listener to nil (try running with the race detector)"}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1434816737, "post_id": 30952623, "comment_id": 49945076, "body": "@JimB OK I can test against the .Serve, but if it errors, do I put a delay in or something and call it again? Ok will remove <code>listener = nil</code> in KillProxy(). Sorry whats the race detector? Do you know of an example of this?"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1434989897, "post_id": 30963600, "comment_id": 49999938, "body": "Using a sleep is the worst way to coordinate concurrency, especially since there&#39;s still no guarantee it won&#39;t panic. You need to wait for http.Serve to return, then start a new listener."}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1443001901, "post_id": 30963600, "comment_id": 53313301, "body": "Yeah I&#39;ve fixed this properly now without delays. I now have a struct that wraps around a listener and handles closing itself. Took a while to crack, but got there in the end"}], "tags": [], "owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "is_accepted": false, "score": -1, "last_activity_date": 1434883182, "creation_date": 1434883182, "answer_id": 30963600, "question_id": 30952623, "link": "https://stackoverflow.com/questions/30952623/golang-close-net-listener/30963600#30963600", "title": "Golang close net listener", "body": "<p>Ok this is far from perfect, but the only way I found of not having it error out on me was to artifically put a delay in my code so the socket had time to close.\nThis isn't great as it means the proxy is down for 2 seconds while the socket closes, but at least it doesnt error out. \nIf someone has a better solution I would like to hear it</p>\n\n<pre><code>func KillProxy() {\n    if listener != nil {\n        listener.Close()\n        log.Println(\"waiting for socket to close\")\n        time.Sleep(2 * time.Second)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 5174, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1434883182, "creation_date": 1434793971, "last_edit_date": 1592644375, "question_id": 30952623, "link": "https://stackoverflow.com/questions/30952623/golang-close-net-listener", "title": "Golang close net listener", "body": "<p>I am having trouble closing a listener so that I can reopen it on the same port. I am writing a proxy server that is hot-configurable - i.e what it does (redirects/blocks etc) can be adjusted on the fly. The proxy runs in a go routine. The problem I am having is when I reconfigure the listener and proxy the listener is still using that port from the previous configuration. (FYI listener is a global pointer)\nI'm trying something like:</p>\n<p>to kill the listener:</p>\n<pre><code>func KillProxy() {\n    \n    if listener != nil {\n        log.Println(&quot; *** TRYING TO STOP THE PROXY SERVER&quot;)\n        (*listener).Close()\n        listener = nil\n    }\n}\n</code></pre>\n<p>before reconfiguring it like:</p>\n<pre><code>log.Println(&quot;listener (S1): &quot;, listener)\nif listener == nil {\n    // Start the listener to listen on the connection.\n    l, err := net.Listen(CONN_TYPE, CONN_HOST + &quot;:&quot; + CONN_PORT)\n\n    if err != nil {\n        log.Println(&quot;error here: &quot;, err)\n    }    \n    listener = &amp;l //set it as a pointer to the newly created listener\n} \nlog.Println(&quot;listener (S2): &quot;, listener)\n</code></pre>\n<p>however that doesnt seem to work - I get the error:</p>\n<blockquote>\n<p>listener (S1):  </p>\n<p>error here:  listen tcp 0.0.0.0:8080: bind: address already in use</p>\n<p>listener (S2): 0xc2080015e0</p>\n</blockquote>\n<p>and then a massive stack trace that summizes to:</p>\n<blockquote>\n<p>panic: runtime error: invalid memory address or nil pointer dereference</p>\n</blockquote>\n<p>EDIT IN RESPONSE TO JIM:</p>\n<p>Interesting re pointers. OK. I am not handling waiting for the socket to close, Im not sure how that should be done. The proxy library I am using is this one: <a href=\"https://github.com/abourget/goproxy\" rel=\"nofollow noreferrer\">https://github.com/abourget/goproxy</a>. The order things happen is:</p>\n<pre><code>KillProxy()\nrefreshProxy()\n</code></pre>\n<p>refreshProxy holds the code posted above that tries to repurpose the listener. The last thing that happens in <code>refreshProxy()</code> is:</p>\n<p><code>go http.Serve(*listener, proxy)</code></p>\n<p>So if I revert to listener being a global variable, not a pointer I can make KillProxy():</p>\n<pre><code>func KillProxy() {\n    if listener != nil {\n        listener.Close()\n        listener = nil\n    }\n}\n</code></pre>\n<p>and then setup the listener again as</p>\n<pre><code>listener, err := net.Listen(CONN_TYPE, CONN_HOST + &quot;:&quot; + CONN_PORT) \n    if err != nil {\n        log.Println(&quot;error here: &quot;, err)\n    }    \n</code></pre>\n<p>However I don't know how to wait and check whether the socket has closed before trying to re create the listener object?</p>\n"}, {"tags": ["go", "google-app-engine", "jwt", "jwt-go"], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1434793741, "post_id": 30952516, "comment_id": 49938579, "body": "Correct, although RSA algorithms are part of the JWT &#39;standard&#39; and include in the jwt-go package. However, I would strongly recommend against them: a HMAC construction is much easier to &#39;get right&#39; from an implementation point-of-view and still provides the functionality needed: preventing third party modification of the token."}, {"owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1434793993, "post_id": 30952516, "comment_id": 49938649, "body": "@elithrar thanks. I edited the answer to say &quot;The&quot; JWT instead of &quot;A&quot; JWT. The posted code uses a HMAC."}], "tags": [], "owner": {"reputation": 630270, "user_id": 571407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2f0d9dec16bae1e06552af55ddefc11f?s=128&d=identicon&r=PG", "display_name": "JB Nizet", "link": "https://stackoverflow.com/users/571407/jb-nizet"}, "is_accepted": true, "score": 3, "last_activity_date": 1434793929, "last_edit_date": 1434793929, "creation_date": 1434793283, "answer_id": 30952516, "question_id": 30952434, "link": "https://stackoverflow.com/questions/30952434/confusion-relating-to-public-and-private-keys-and-jwt/30952516#30952516", "title": "Confusion relating to public and private keys and JWT", "body": "<p>The JWT isn't signed using an asymmetric cipher like RSA. It uses a <a href=\"https://en.wikipedia.org/wiki/Hash-based_message_authentication_code\" rel=\"nofollow\">HMAC</a>, which uses a single, secret key. Indeed, the point here is not to prove to someone else that you signed the token. It's to prove to yourself that you signed it, and thus forbid anyone who doesn't have your secret key to modify the token.</p>\n"}, {"tags": [], "owner": {"reputation": 516, "user_id": 1439484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YwPuR.jpg?s=128&g=1", "display_name": "dario nascimento", "link": "https://stackoverflow.com/users/1439484/dario-nascimento"}, "is_accepted": false, "score": 3, "last_activity_date": 1443291367, "creation_date": 1443291367, "answer_id": 32800428, "question_id": 30952434, "link": "https://stackoverflow.com/questions/30952434/confusion-relating-to-public-and-private-keys-and-jwt/32800428#32800428", "title": "Confusion relating to public and private keys and JWT", "body": "<p>You are using <code>jwt.SigningMethodHMAC.</code> Therefore, you are signing using HMAC, the signature is the token ciphered by a symmetric key (secret).</p>\n\n<p>You shall use: <code>jwt.New(jwt.SigningMethodRS256)</code> to sign with an asymmetric key-pair.</p>\n"}, {"tags": [], "owner": {"reputation": 181, "user_id": 7097108, "user_type": "registered", "profile_image": "https://graph.facebook.com/1823197124604715/picture?type=large", "display_name": "Ivan Carmenates Garc&#237;a", "link": "https://stackoverflow.com/users/7097108/ivan-carmenates-garc%c3%ada"}, "is_accepted": false, "score": 0, "last_activity_date": 1517927734, "creation_date": 1517927734, "answer_id": 48645470, "question_id": 30952434, "link": "https://stackoverflow.com/questions/30952434/confusion-relating-to-public-and-private-keys-and-jwt/48645470#48645470", "title": "Confusion relating to public and private keys and JWT", "body": "<p>Very interesting, since I have a similar problem, when I have micro service and a client app that need to verify the token that comes from another internal server, so if you advice using HMAC over RSA them that means that I need to put the private key in both micro service and Client App? that wouldn't be a serious security hole?</p>\n"}], "owner": {"reputation": 8775, "user_id": 821110, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/fa6fca5f613944238a91d2daeba67b9d?s=128&d=identicon&r=PG", "display_name": "W.K.S", "link": "https://stackoverflow.com/users/821110/w-k-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1907, "favorite_count": 0, "accepted_answer_id": 30952516, "answer_count": 3, "score": 1, "last_activity_date": 1588107415, "creation_date": 1434792766, "last_edit_date": 1588107415, "question_id": 30952434, "link": "https://stackoverflow.com/questions/30952434/confusion-relating-to-public-and-private-keys-and-jwt", "title": "Confusion relating to public and private keys and JWT", "body": "<p>I'm trying out JWT (JSON Web Tokens) in a Go web service. Here's what I've done so far:</p>\n\n<pre><code>package jwt\n\nimport(\n    \"fmt\"\n    \"net/http\"\n    \"github.com/gorilla/mux\"\n    \"github.com/dgrijalva/jwt-go\"\n    \"io/ioutil\"\n)\n\nvar privateKey []byte\nvar publicKey []byte \n\nfunc JSONWebTokensHandler(w http.ResponseWriter, r * http.Request){\n\n    // Create the token\n    encodeToken := jwt.New(jwt.SigningMethodHS256)\n    // Set some claims\n    encodeToken.Claims[\"Latitude\"] = \"25.000\"\n    encodeToken.Claims[\"Longitude\"] = \"27.000\"\n    // Sign and get the complete encoded token as a string\n    tokenString, err := encodeToken.SignedString(privateKey)\n\n    decodeToken, err := jwt.Parse(tokenString, func(token *jwt.Token) (interface{}, error) {\n\n        if _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok {\n            return nil, fmt.Errorf(\"Unexpected signing method: %v\", token.Header[\"alg\"])\n        }\n\n        return publicKey,nil\n    })\n\n    if decodeToken.Valid {\n\n        fmt.Fprintf(w,\"Lat:  %s, Lng: %s\",decodeToken.Claims[\"Latitude\"],decodeToken.Claims[\"Longitude\"])\n\n    }  else {\n\n        fmt.Fprintf(w,\"Couldn't handle this token: %s\", err)\n\n    }\n\n}\n\nfunc init(){\n\n    privateKey,_ = ioutil.ReadFile(\"demo.rsa\")\n    publicKey,_ = ioutil.ReadFile(\"demo.rsa.pub\")\n\n    r := mux.NewRouter()\n    r.HandleFunc(\"/jwt\",JSONWebTokensHandler).Methods(\"GET\")\n    http.Handle(\"/\", r)\n\n}\n</code></pre>\n\n<p>Now if my understanding is correct, A token that is encoded using a private key can be decoded using the public key. That is what I've presumed in the code above however when I run the code I get the error:</p>\n\n<blockquote>\n  <p>Couldn't handle this token: signature is invalid</p>\n</blockquote>\n\n<p>If I use the same key for encoding and decoding, then the code works.</p>\n\n<p>What I'd like to know is, is there something wrong with my understanding or in the code? </p>\n"}, {"tags": ["javascript", "node.js", "mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 427, "user_id": 2493094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64712c41ff264e272fb8a41291dddc1a?s=128&d=identicon&r=PG", "display_name": "Juho", "link": "https://stackoverflow.com/users/2493094/juho"}, "edited": false, "score": 0, "creation_date": 1434791456, "post_id": 30952060, "comment_id": 49937958, "body": "Also, the go code example seems to work differently from your code. In the beginning of the function it calls response = make(gonode.CommandData) and in the if-statement the response is assigned like so: response[&quot;text&quot;] = &quot;What?&quot;. Don&#39;t know much about go, but it seems like your variable m isn&#39;t really linked to anything. <a href=\"https://www.npmjs.com/package/gonode\" rel=\"nofollow noreferrer\">npmjs.com/package/gonode</a>"}], "tags": [], "owner": {"reputation": 427, "user_id": 2493094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64712c41ff264e272fb8a41291dddc1a?s=128&d=identicon&r=PG", "display_name": "Juho", "link": "https://stackoverflow.com/users/2493094/juho"}, "is_accepted": false, "score": 0, "last_activity_date": 1434789751, "creation_date": 1434789751, "answer_id": 30952060, "question_id": 30951751, "link": "https://stackoverflow.com/questions/30951751/how-to-make-nodejs-to-talk-with-golang/30952060#30952060", "title": "How to make nodejs to talk with golang", "body": "<p>Based on a very cursive check of the gonode source code, the module seems to spawn go code as a child process and communicate through stdin/-out. EPIPE error means that the other end closed the stream. Based on this it might be that your go process exits prematurely.</p>\n\n<p>You could try to debug the problem by modifying Command.prototype.execute in gonode/lib/command.js to print out the JSON that's sent to the go process. Then you can debug the go program by running it directly and giving it the same input via stdin.</p>\n"}, {"tags": [], "owner": {"reputation": 179, "user_id": 5030632, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-UtEGaTcqGac/AAAAAAAAAAI/AAAAAAAABfc/5yCsXRiLjS0/photo.jpg?sz=128", "display_name": "Murali Manohar", "link": "https://stackoverflow.com/users/5030632/murali-manohar"}, "is_accepted": false, "score": 2, "last_activity_date": 1439830768, "creation_date": 1439830768, "answer_id": 32055895, "question_id": 30951751, "link": "https://stackoverflow.com/questions/30951751/how-to-make-nodejs-to-talk-with-golang/32055895#32055895", "title": "How to make nodejs to talk with golang", "body": "<p>thanks for the response. I got a solution for this. I made 2 different servers. One for NodeJS and another for Golang. I am calling golang uri in Node server and getting data from golang server.</p>\n"}, {"tags": [], "owner": {"reputation": 3184, "user_id": 703264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/d1Se3.jpg?s=128&g=1", "display_name": "Howard", "link": "https://stackoverflow.com/users/703264/howard"}, "is_accepted": false, "score": 3, "last_activity_date": 1558707354, "creation_date": 1558707354, "answer_id": 56294469, "question_id": 30951751, "link": "https://stackoverflow.com/questions/30951751/how-to-make-nodejs-to-talk-with-golang/56294469#56294469", "title": "How to make nodejs to talk with golang", "body": "<p>Golang from 1.5, you can build go to shared object binary file (*.so). This allows you to connect your go compiled library to be called by nodejs, python, ruby, java etc. </p>\n\n<p>Here is a guide you could refer to: <a href=\"https://medium.com/learning-the-go-programming-language/calling-go-functions-from-other-languages-4c7d8bcc69bf\" rel=\"nofollow noreferrer\">https://medium.com/learning-the-go-programming-language/calling-go-functions-from-other-languages-4c7d8bcc69bf</a></p>\n"}], "owner": {"reputation": 179, "user_id": 5030632, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-UtEGaTcqGac/AAAAAAAAAAI/AAAAAAAABfc/5yCsXRiLjS0/photo.jpg?sz=128", "display_name": "Murali Manohar", "link": "https://stackoverflow.com/users/5030632/murali-manohar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7793, "favorite_count": 0, "answer_count": 3, "score": 5, "last_activity_date": 1558707354, "creation_date": 1434787686, "last_edit_date": 1543397142, "question_id": 30951751, "link": "https://stackoverflow.com/questions/30951751/how-to-make-nodejs-to-talk-with-golang", "title": "How to make nodejs to talk with golang", "body": "<p>I am creating a web app in node.js and golang. I need to connect nodejs with golang code which talks to mongodb and returns data to node program. is there any way to connect so? I tried to use gonode API.This is my code using gonode API.</p>\n\n<p>my node.js file contains below code:</p>\n\n<pre><code>var Go = require('gonode').Go;\nvar options = {\npath : 'gofile.go',\ninitAtOnce : true,\n}\n\nvar go = new Go(options,function(err){\nif(err) throw err;\n\ngo.execute({commandText: 'Hello world from gonode!'}, function(result, response) {\n        if(result.ok) {\n            console.log('Go responded: ' + response.responseText);\n        }\n});\n\ngo.close();\n});     `\n</code></pre>\n\n<p>And this is the code in my gofile.go file:</p>\n\n<pre><code>package main\n\nimport(\n    gonode \"github.com/jgranstrom/gonodepkg\"\n    json \"github.com/jgranstrom/go-simplejson\"\n)\n\nfunc main(){\n    gonode.Start(process)\n}\n\nfunc process(cmd *json.Json) (response *json.Json) {    \n    response, m := json.MakeMap()\n\n    if(cmd.Get(\"commandText\").MustString() == \"Hello\") {\n        m[\"responseText\"] = \"Well hello there!\"\n    } else {\n        m[\"responseText\"] = \"What?\"\n    }\n\n    return\n}\n</code></pre>\n\n<p>This is the error am getting while running as node node.js in terminal</p>\n\n<pre><code>events.js:72\n        throw er; // Unhandled 'error' event\n              ^\nError: write EPIPE\n    at errnoException (net.js:905:11)\n    at Object.afterWrite (net.js:721:19)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 0, "last_activity_date": 1434754088, "last_edit_date": 1434754088, "creation_date": 1434753397, "answer_id": 30948260, "question_id": 30948209, "link": "https://stackoverflow.com/questions/30948209/handle-response-from-post-request-to-json/30948260#30948260", "title": "Handle response from post request to Json", "body": "<p>The json is an array of those objects having the strings <code>n_expediente</code> and <code>enviar</code> on each instance. In the Go you'll need an array of your type;</p>\n\n<pre><code>re := []ResponseFromPost{} \nerr := json.Unmarshal([]byte(`[{\"n_expediente\":\"9\",\"enviar\":\"2\"}]`), &amp;re)\nfmt.Println(re[0].Enviar);\n</code></pre>\n\n<p>Here's an example to show what your model needs to be <a href=\"https://play.golang.org/p/d64Sict4AG\" rel=\"nofollow\">https://play.golang.org/p/d64Sict4AG</a></p>\n\n<p>You'll probably want to make some other changes to your code based on that. Like a loop bound by the length of the slice ( <code>for i := range re { print i }</code> ) after the unmarshal and a different name for the type.</p>\n"}], "owner": {"reputation": 9, "user_id": 5029943, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/eceddd1977ae9c8040c5c84818891e21?s=128&d=identicon&r=PG&f=1", "display_name": "lilithbx", "link": "https://stackoverflow.com/users/5029943/lilithbx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 30948260, "answer_count": 1, "score": 0, "last_activity_date": 1434754088, "creation_date": 1434753179, "question_id": 30948209, "link": "https://stackoverflow.com/questions/30948209/handle-response-from-post-request-to-json", "title": "Handle response from post request to Json", "body": "<p>I'm using the following code to get a response from a server after a post request:</p>\n\n<pre><code>type ResponseFromPost struct {\n    N_expediente string\n    Enviar string\n}\n\nfunc main(){\n\n    ......\n\n    res, err := client.Do(req)\n    if err != nil {\n        return\n    }\n\n    defer res.Body.Close()\n\n    body, err := ioutil.ReadAll(res.Body)\n\n    var re ResponseFromPost\n    err = json.Unmarshal(body, &amp;re)\n    fmt.Println(re.Enviar);\n}\n</code></pre>\n\n<p>With this I get:</p>\n\n<pre><code>    error: &amp;{%!e(string=array) %!e(*reflect.rtype=&amp;{32 2509985895 0 8 8 25 0x608170\n[0x7703c0 &lt;nil&gt;] 0x730b80 0x69acb0 0x6116c0 0x7732c0})}\n</code></pre>\n\n<p>The value sent by the server is:</p>\n\n<pre><code>[{\"n_expediente\":\"9\",\"enviar\":\"2\"}]\n</code></pre>\n\n<p>How can I use the json variables?</p>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 1, "creation_date": 1434749945, "post_id": 30947534, "comment_id": 49929746, "body": "What is the error you&#39;re seeing?"}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1434750001, "post_id": 30947534, "comment_id": 49929756, "body": "@AmitKumarGupta i dont get any error , just empty struct"}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1434750133, "post_id": 30947534, "comment_id": 49929807, "body": "Do you think that might be relevant to add to your question?  Also, can you paste the full code that reproduces the problem? <code>package main</code>, what files you&#39;re importing, a <code>main</code> function, etc. so that it&#39;s easy for people trying to help you to copy-paste the code and run it locally.  Think about adding information and code that makes it easy for people to help you, because you want people to help you."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 4, "creation_date": 1434757876, "post_id": 30947534, "comment_id": 49931861, "body": "As mentioned ad-nausem, anything setting fields via reflection (JSON, XML, YAML unmarshalling, etc) can only work on exported fields."}], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1434778936, "post_id": 30950396, "comment_id": 49935108, "body": "The spec on exported identifiers: <a href=\"http://golang.org/doc/go_spec.html#Exported_identifiers\" rel=\"nofollow noreferrer\">golang.org/doc/go_spec.html#Exported_identifiers</a>"}, {"owner": {"reputation": 579, "user_id": 2310837, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/31dd98bf2d532f8d0addfcb5665c3134?s=128&d=identicon&r=PG", "display_name": "joelfischerr", "link": "https://stackoverflow.com/users/2310837/joelfischerr"}, "edited": false, "score": 1, "creation_date": 1583234346, "post_id": 30950396, "comment_id": 107039840, "body": "This doesn&#39;t work for me. I need to change the line <code>err = yaml.Unmarshal(yamlFile, c)</code> to <code>err = yaml.Unmarshal(yamlFile, &amp;c)</code> i.e. pass a pointer not a value. I have no clue why though."}, {"owner": {"reputation": 2380, "user_id": 1059639, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/rzPqE.jpg?s=128&g=1", "display_name": "Mopparthy Ravindranath", "link": "https://stackoverflow.com/users/1059639/mopparthy-ravindranath"}, "edited": false, "score": 0, "creation_date": 1590566886, "post_id": 30950396, "comment_id": 109724177, "body": "It is tied down to code via type conf struct.  Won&#39;t be reusable, if config file is changed.  Is there anything that is dynamic, without having to define a struct in the code?"}, {"owner": {"reputation": 101, "user_id": 7112693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/17e9776c22693642caf2019fc71e1371?s=128&d=identicon&r=PG&f=1", "display_name": "fabulias", "link": "https://stackoverflow.com/users/7112693/fabulias"}, "reply_to_user": {"reputation": 579, "user_id": 2310837, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/31dd98bf2d532f8d0addfcb5665c3134?s=128&d=identicon&r=PG", "display_name": "joelfischerr", "link": "https://stackoverflow.com/users/2310837/joelfischerr"}, "edited": false, "score": 2, "creation_date": 1598827847, "post_id": 30950396, "comment_id": 112576257, "body": "@joelfischerr you&#39;re absolutely right, I had to make the same change to work it fine."}, {"owner": {"reputation": 101, "user_id": 7112693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/17e9776c22693642caf2019fc71e1371?s=128&d=identicon&r=PG&f=1", "display_name": "fabulias", "link": "https://stackoverflow.com/users/7112693/fabulias"}, "reply_to_user": {"reputation": 2380, "user_id": 1059639, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/rzPqE.jpg?s=128&g=1", "display_name": "Mopparthy Ravindranath", "link": "https://stackoverflow.com/users/1059639/mopparthy-ravindranath"}, "edited": false, "score": 0, "creation_date": 1598827962, "post_id": 30950396, "comment_id": 112576278, "body": "@MopparthyRavindranath I think you need to use interfaces to do that, but why a config file will change several times?"}, {"owner": {"reputation": 3359, "user_id": 122727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5e946def051f311e802140ecb9fbf?s=128&d=identicon&r=PG", "display_name": "kubanczyk", "link": "https://stackoverflow.com/users/122727/kubanczyk"}, "reply_to_user": {"reputation": 2380, "user_id": 1059639, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/rzPqE.jpg?s=128&g=1", "display_name": "Mopparthy Ravindranath", "link": "https://stackoverflow.com/users/1059639/mopparthy-ravindranath"}, "edited": false, "score": 0, "creation_date": 1610438374, "post_id": 30950396, "comment_id": 116125404, "body": "@MopparthyRavindranath I think you want <a href=\"https://stackoverflow.com/a/26290943/122727\">something like a map of strings</a>, no?"}], "tags": [], "owner": {"reputation": 2297, "user_id": 661378, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/853372c681dc96b95f42adcb88b0cb3f?s=128&d=identicon&r=PG", "display_name": "qwertmax", "link": "https://stackoverflow.com/users/661378/qwertmax"}, "is_accepted": true, "score": 72, "last_activity_date": 1542054407, "last_edit_date": 1542054407, "creation_date": 1434776038, "answer_id": 30950396, "question_id": 30947534, "link": "https://stackoverflow.com/questions/30947534/how-to-read-a-yaml-file/30950396#30950396", "title": "How to read a YAML file", "body": "<p>your yaml file must be </p>\n\n<pre><code>hits: 5\ntime: 5000000\n</code></pre>\n\n<p>your code should look like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/yaml.v2\"\n    \"io/ioutil\"\n    \"log\"\n)\n\ntype conf struct {\n    Hits int64 `yaml:\"hits\"`\n    Time int64 `yaml:\"time\"`\n}\n\nfunc (c *conf) getConf() *conf {\n\n    yamlFile, err := ioutil.ReadFile(\"conf.yaml\")\n    if err != nil {\n        log.Printf(\"yamlFile.Get err   #%v \", err)\n    }\n    err = yaml.Unmarshal(yamlFile, c)\n    if err != nil {\n        log.Fatalf(\"Unmarshal: %v\", err)\n    }\n\n    return c\n}\n\nfunc main() {\n    var c conf\n    c.getConf()\n\n    fmt.Println(c)\n}\n</code></pre>\n\n<p>the main error was capital letter for your struct.</p>\n"}, {"tags": [], "owner": {"reputation": 3359, "user_id": 122727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5e946def051f311e802140ecb9fbf?s=128&d=identicon&r=PG", "display_name": "kubanczyk", "link": "https://stackoverflow.com/users/122727/kubanczyk"}, "is_accepted": false, "score": 3, "last_activity_date": 1618744282, "last_edit_date": 1618744282, "creation_date": 1599740952, "answer_id": 63829704, "question_id": 30947534, "link": "https://stackoverflow.com/questions/30947534/how-to-read-a-yaml-file/63829704#63829704", "title": "How to read a YAML file", "body": "<p>Using an upgraded <strong>version 3</strong> of yaml package.</p>\n<p>An example <code>conf.yaml</code> file:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>conf:\n  hits: 5\n  time: 5000000\n  camelCase: sometext\n</code></pre>\n<p>The <code>main.go</code> file:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;io/ioutil&quot;\n    &quot;log&quot;\n\n    &quot;gopkg.in/yaml.v3&quot;\n)\n\ntype myData struct {\n    Conf struct {\n        Hits      int64\n        Time      int64\n        CamelCase string `yaml:&quot;camelCase&quot;`\n    }\n}\n\nfunc readConf(filename string) (*myData, error) {\n    buf, err := ioutil.ReadFile(filename)\n    if err != nil {\n        return nil, err\n    }\n\n    c := &amp;myData{}\n    err = yaml.Unmarshal(buf, c)\n    if err != nil {\n        return nil, fmt.Errorf(&quot;in file %q: %v&quot;, filename, err)\n    }\n\n    return c, nil\n}\n\nfunc main() {\n    c, err := readConf(&quot;conf.yaml&quot;)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(&quot;%v&quot;, c)\n}\n</code></pre>\n<p>Running instructions (in case it's the first time you step out of stdlib):</p>\n<pre class=\"lang-sh prettyprint-override\"><code>go mod init example.com/whatever\ngo get gopkg.in/yaml.v3\ncat go.sum\ngo run .\n</code></pre>\n<p>The tags (like <code>yaml:&quot;field&quot;</code>) are optional for any all-lowercase yaml key identifiers. For shows I've included one for a camelCase identifier.</p>\n<p>(Confusingly, this lowercasing behavior of &quot;yaml&quot; is <em>not</em> seen in the standard &quot;json&quot; package. If your structure is used with both JSON and YAML encodings it is best to specify both tags on literally every field. Verbose, but reduces mistakes.)</p>\n"}], "owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67065, "favorite_count": 14, "accepted_answer_id": 30950396, "answer_count": 2, "score": 41, "last_activity_date": 1618744282, "creation_date": 1434749308, "last_edit_date": 1574533665, "question_id": 30947534, "link": "https://stackoverflow.com/questions/30947534/how-to-read-a-yaml-file", "title": "How to read a YAML file", "body": "<p>I have an issue with reading a YAML file.  I think it's something in the file structure but I can't figure out what.</p>\n\n<p><em>YAML file:</em></p>\n\n<pre><code>conf:\n  hits:5\n  time:5000000\n</code></pre>\n\n<p><em>code:</em></p>\n\n<pre><code>type conf struct {\n    hits int64 `yaml:\"hits\"`\n    time int64 `yaml:\"time\"`\n}\n\n\nfunc (c *conf) getConf() *conf {\n\n    yamlFile, err := ioutil.ReadFile(\"conf.yaml\")\n    if err != nil {\n        log.Printf(\"yamlFile.Get err   #%v \", err)\n    }\n    err = yaml.Unmarshal(yamlFile, c)\n    if err != nil {\n        log.Fatalf(\"Unmarshal: %v\", err)\n    }\n\n    return c\n}\n</code></pre>\n"}, {"tags": ["intellij-idea", "go"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1434747617, "post_id": 30947121, "comment_id": 49928889, "body": "Why not update Intellij?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 0, "creation_date": 1434747729, "post_id": 30947121, "comment_id": 49928951, "body": "perhaps it would be better to install LiteIDE"}, {"owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "reply_to_user": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1434749048, "post_id": 30947121, "comment_id": 49929504, "body": "@inf money constraints :)"}, {"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1434749630, "post_id": 30947121, "comment_id": 49929644, "body": "Can you not use the community edition for Go development? (Besides that, is the update from 14.0 to 14.1 not free?)"}], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 0, "last_activity_date": 1435180734, "last_edit_date": 1435180734, "creation_date": 1434792839, "answer_id": 30952448, "question_id": 30947121, "link": "https://stackoverflow.com/questions/30947121/go-lang-plugin-for-intellij-idea-14-0-x/30952448#30952448", "title": "go lang plugin for Intellij IDEA 14.0.x", "body": "<p>Update to IDEA 14.1+ or use the IntelliJ Community.</p>\n\n<p>Original answer:\nYou can use the free version of IntelliJ Community with the latest version of the plugin and everything should work fine. Also, Android Studio for example is compatible with the plugin as well.\nUnfortunately the plugin has some internal dependencies which makes it hard to port back and maintain for multiple IDEA versions. Hope this helps</p>\n"}, {"comments": [{"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1435180832, "post_id": 31032170, "comment_id": 50098627, "body": "But this is not how it should be done. While it&#39;s true that you can download it manually from the website, you should read the readme and get the alpha/nightly repository added to the IDE. Also, we don&#39;t support the 14.0.x branch anymore as it&#39;s too complicated (and soon IDEA 15 will be around)."}], "tags": [], "owner": {"reputation": 164, "user_id": 1957835, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/65d3b38093aa7662cbe0cce12e0d62c4?s=128&d=identicon&r=PG", "display_name": "ahmetlutfu", "link": "https://stackoverflow.com/users/1957835/ahmetlutfu"}, "is_accepted": false, "score": -1, "last_activity_date": 1435163679, "creation_date": 1435163679, "answer_id": 31032170, "question_id": 30947121, "link": "https://stackoverflow.com/questions/30947121/go-lang-plugin-for-intellij-idea-14-0-x/31032170#31032170", "title": "go lang plugin for Intellij IDEA 14.0.x", "body": "<p>I also faced up this problem couple days ago. You can download nightly version of go plugin from this link.</p>\n\n<p><a href=\"https://plugins.jetbrains.com/plugin/5047https://plugins.jetbrains.com/plugin/5047?pr=&amp;showAllUpdates=true\" rel=\"nofollow\" title=\"go plugin&quot; &quot;go plugin\">You must install this plugin via browse your download folder not repository </a></p>\n"}, {"tags": [], "owner": {"reputation": 5125, "user_id": 6468625, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RHnsOSmZM8g/AAAAAAAAAAI/AAAAAAAAAIw/yM_Sg1aLU_s/photo.jpg?sz=128", "display_name": "sourav pandit", "link": "https://stackoverflow.com/users/6468625/sourav-pandit"}, "is_accepted": false, "score": 0, "last_activity_date": 1579160858, "creation_date": 1579160858, "answer_id": 59765030, "question_id": 30947121, "link": "https://stackoverflow.com/questions/30947121/go-lang-plugin-for-intellij-idea-14-0-x/59765030#59765030", "title": "go lang plugin for Intellij IDEA 14.0.x", "body": "<p>It might be not the exact answer your are looking for but their is a separate IDE for go developer . it has some unique features you must try <h3>GOLAND</h3>  First month is free.</p>\n"}], "owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1747, "favorite_count": 0, "accepted_answer_id": 30952448, "answer_count": 3, "score": 0, "last_activity_date": 1579160858, "creation_date": 1434747255, "last_edit_date": 1435700849, "question_id": 30947121, "link": "https://stackoverflow.com/questions/30947121/go-lang-plugin-for-intellij-idea-14-0-x", "title": "go lang plugin for Intellij IDEA 14.0.x", "body": "<p>Is it possible to setup go language pluing for Intellij IDEA 14.0.3 version?</p>\n\n<p>I tried to download the binary plugin (jar) from <a href=\"https://plugins.jetbrains.com/plugin/5047?pr=idea\" rel=\"nofollow\">https://plugins.jetbrains.com/plugin/5047?pr=idea</a> but the version 0.9.15.3 listed here is old and does not recognize GOROOT and GOPATH.\nI tried to build the latest plugin using sources from <a href=\"https://github.com/go-lang-plugin-org/go-lang-idea-plugin\" rel=\"nofollow\">https://github.com/go-lang-plugin-org/go-lang-idea-plugin</a> using Intellij but failed to setup the SDK.</p>\n\n<p>Is there a latest binary version of the go lang plugin available?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1678808"}, "edited": false, "score": 0, "creation_date": 1434746411, "post_id": 30946869, "comment_id": 49928380, "body": "<code>go version go1.3.3 darwin&#47;amd64</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1678808"}, "edited": false, "score": 0, "creation_date": 1440458396, "post_id": 30946869, "comment_id": 52271526, "body": "I really wish I could delete this question :flushed:"}], "answers": [{"tags": [], "owner": {"reputation": 97745, "user_id": 884978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdb4f5f287976278b6e02f66e85c41dc?s=128&d=identicon&r=PG", "display_name": "creack", "link": "https://stackoverflow.com/users/884978/creack"}, "is_accepted": true, "score": 4, "last_activity_date": 1434746865, "creation_date": 1434746865, "answer_id": 30947035, "question_id": 30946869, "link": "https://stackoverflow.com/questions/30946869/how-to-interpolate-a-byte-slice/30947035#30947035", "title": "How to interpolate a byte slice?", "body": "<p>To use <code>%s</code>, you need a formatting function.</p>\n\n<pre><code>var payload = []byte(fmt.Sprintf(`{\"foo\":%q, \"hello\":%q}`, val1, val2))\n</code></pre>\n\n<p>(<code>%q</code> is like <code>%s</code> but adds quotes for you)</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1678808"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 631, "favorite_count": 0, "accepted_answer_id": 30947035, "answer_count": 1, "score": 0, "last_activity_date": 1434746865, "creation_date": 1434746154, "question_id": 30946869, "link": "https://stackoverflow.com/questions/30946869/how-to-interpolate-a-byte-slice", "title": "How to interpolate a byte slice?", "body": "<p>I'm attempting to build a JSON payload for a POST request:</p>\n\n<pre><code>var payload = []byte(`{\"foo\":\"bar\", \"hello\":\"world\"}`)\n</code></pre>\n\n<p>However, I would like the values to be interpolated from an existing string. I've tried to use <code>%s</code>, but this is obviously not syntactically correct:</p>\n\n<pre><code>var payload = []byte(`{\"foo\":%s, \"hello\":%s}`, val1, val2)\n</code></pre>\n\n<p>Feels like I'm going about this the entirely wrong way. Any suggestions would be appreciated. Thanks.</p>\n"}, {"tags": ["string", "go"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1434757701, "post_id": 30946813, "comment_id": 49931825, "body": "wrt <a href=\"https://golang.org/pkg/fmt/#Scanln\" rel=\"nofollow noreferrer\"><code>fmt.Scanln</code></a> it says &quot;Scanln is similar to Scan, but stops scanning at a newline\u2026&quot;; so look at <a href=\"https://golang.org/pkg/fmt/#Scan\" rel=\"nofollow noreferrer\"><code>fmt.Scan</code></a> which says &quot;Scan scans text read from standard input, storing <b>successive space-separated values</b> into successive arguments.&quot; So yeah, the OP effectively asked for the first word not the first line."}], "tags": [], "owner": {"reputation": 97745, "user_id": 884978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdb4f5f287976278b6e02f66e85c41dc?s=128&d=identicon&r=PG", "display_name": "creack", "link": "https://stackoverflow.com/users/884978/creack"}, "is_accepted": true, "score": 0, "last_activity_date": 1434745928, "creation_date": 1434745928, "answer_id": 30946813, "question_id": 30946686, "link": "https://stackoverflow.com/questions/30946686/how-do-i-save-an-entire-string-as-a-txt-file-in-go/30946813#30946813", "title": "How do I save an entire string as a txt file in Go?", "body": "<p>What about using <code>bufio.ReadString</code> instead of <code>fmt.Scanln</code>?\nNot 100% how Scanln works, but I am pretty sure the issue comes from a misuse of that function.\nExample with bufio:</p>\n\n<pre><code>package main\n\nimport (\n        \"bufio\"\n        \"fmt\"\n        \"io/ioutil\"\n        \"log\"\n        \"os\"\n        \"strings\"\n)\n\n// Document represent the document's data.\ntype Document struct {\n        Title string\n        Body  []byte\n}\n\n// Save dumps document as txt file on disc.\nfunc (p *Document) save() error {\n        filename := p.Title + \".txt\"\n        return ioutil.WriteFile(filename, p.Body, 0600)\n}\n\n// loadPage loads a document from disc.\nfunc loadPage(title string) (*Document, error) {\n        filename := title + \".txt\"\n        body, err := ioutil.ReadFile(filename)\n        if err != nil {\n                return nil, err\n        }\n        return &amp;Document{Title: title, Body: body}, nil\n}\n\n// Input document title and body.\nfunc main() {\n        reader := bufio.NewReader(os.Stdin)\n        fmt.Print(\"Enter Title: \")\n        title, err := reader.ReadString('\\n')\n        if err != nil {\n                log.Fatal(err)\n        }\n        title = strings.TrimSpace(title)\n\n        fmt.Print(\"Enter Body: \")\n        body, err := reader.ReadString('\\n')\n        if err != nil {\n                log.Fatal(err)\n        }\n        body = strings.TrimSpace(body)\n\n        //Save document and display on command line\n        p1 := &amp;Document{Title: title, Body: []byte(body)}\n        if err := p1.save(); err != nil {\n                log.Fatal(err)\n        }\n        p2, err := loadPage(title)\n        if err != nil {\n                log.Fatal(err)\n        }\n        fmt.Println(string(p2.Body))\n}\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 5028849, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/10206706253396255/picture?type=large", "display_name": "Kristine Rooks", "link": "https://stackoverflow.com/users/5028849/kristine-rooks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 30946813, "answer_count": 1, "score": 0, "last_activity_date": 1434745928, "creation_date": 1434745457, "question_id": 30946686, "link": "https://stackoverflow.com/questions/30946686/how-do-i-save-an-entire-string-as-a-txt-file-in-go", "title": "How do I save an entire string as a txt file in Go?", "body": "<p>I'm creating a simple word processing program in Go. From the command line, I have two prompts:</p>\n\n<p>$Enter Title:</p>\n\n<p>$Enter Body: </p>\n\n<p>The program is supposed to save the document as a txt file and print it to the command line. The program works if the user user types in a one-word Title and a one-word Body. But if the user types in a several-word title, this will happen:</p>\n\n<pre><code>$Enter Title: Here is a title\n\n$Enter Body: s\n\n$  title\n\n-bash: title: command not found\n</code></pre>\n\n<p>Here is the code I have so far:   </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n)\n\n//Create struct for a document\ntype Document struct {\n    Title string\n    Body []byte\n}\n\n//Save document as txt file\nfunc (p *Document) save() error {\n    filename := p.Title + \".txt\"\n    return ioutil.WriteFile(filename, p.Body, 0600)\n}\n\n//Load document\nfunc loadPage(title string) (*Document, error) {\n    filename := title + \".txt\"\n    body, err := ioutil.ReadFile(filename)\n    if err != nil {\n        return nil, err\n    }\n    return &amp;Document{Title: title, Body: body}, nil\n}\n\n//Input document title and body. \nfunc main() {\n    fmt.Print(\"Enter Title: \")\n    var Title string\n    fmt.Scanln(&amp;Title)\n\n    fmt.Print(\"Enter Body: \")\n    var Body []byte\n    fmt.Scanln(&amp;Body)\n\n//Save document and display on command line\n    p1 := &amp;Document{Title: Title, Body: []byte(Body)}\n    p1.save()\n    p2, _ := loadPage(Title)\n    fmt.Println(string(p2.Body))\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1434743059, "post_id": 30945605, "comment_id": 49926737, "body": "No. The compiler relies on files for input, but you could invoke the compiler directly, though I doubt saving the couple <code>mkdir</code> calls to create the temporary directory is going to save much time."}], "answers": [{"tags": [], "owner": {"reputation": 97745, "user_id": 884978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdb4f5f287976278b6e02f66e85c41dc?s=128&d=identicon&r=PG", "display_name": "creack", "link": "https://stackoverflow.com/users/884978/creack"}, "is_accepted": false, "score": 1, "last_activity_date": 1434745274, "creation_date": 1434745274, "answer_id": 30946646, "question_id": 30945605, "link": "https://stackoverflow.com/questions/30945605/go-run-performance/30946646#30946646", "title": "Go run performance", "body": "<p>You can always create a binary and use it later on.\nExample:</p>\n\n<pre><code>package main\n\nimport (\n        \"io/ioutil\"\n        \"os\"\n        \"os/exec\"\n        \"path\"\n        \"testing\"\n)\n\nfunc BenchmarkRun(b *testing.B) {\n        tmpdir, err := ioutil.TempDir(\"\", \"go-bench-\")\n        if err != nil {\n                b.Fatal(err)\n        }\n        defer os.RemoveAll(tmpdir)\n\n        source := `package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"foo\")\n}`\n        if err := ioutil.WriteFile(path.Join(tmpdir, \"cmd.go\"), []byte(source), 0777); err != nil {\n                b.Fatal(err)\n        }\n        defer os.Remove(path.Join(tmpdir, \"cmd.go\"))\n\n        cmd := exec.Command(\"go\", \"build\", \"-o\", \"cmd\", \".\")\n        cmd.Dir = tmpdir\n        if err := cmd.Run(); err != nil {\n                b.Fatal(err)\n        }\n        defer os.Remove(path.Join(tmpdir, \"cmd\"))\n\n        b.ResetTimer()\n        for i := 0; i &lt; b.N; i++ {\n                if err := exec.Command(path.Join(tmpdir, \"cmd\")).Run(); err != nil {\n                        b.Error(err)\n                }\n        }\n}\n</code></pre>\n"}], "owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1434745274, "creation_date": 1434740970, "question_id": 30945605, "link": "https://stackoverflow.com/questions/30945605/go-run-performance", "title": "Go run performance", "body": "<p>Consider the following benchmark:</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"os\"\n    \"os/exec\"\n    \"testing\"\n)\n\nfunc BenchmarkRun(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        source := `package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"foo\")\n}`\n        if err := ioutil.WriteFile(\"cmd.go\", []byte(source), 0777); err != nil {\n            b.Error(err)\n        }\n        defer os.Remove(\"cmd.go\")\n\n        if err := exec.Command(\"go\", \"run\", \"cmd.go\").Run(); err != nil {\n            b.Error(err)\n        }\n    }\n}\n</code></pre>\n\n<p>This takes around 0.3sec per operation. </p>\n\n<p>Is there any way of speeding up a compile / run cycle?</p>\n\n<p>It seems clumsy to write a temporary file and exec go run. Is there a way to invoke the compiler without doing this?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 9410, "user_id": 177534, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b7b357241e1241a7326c97262a66e4e3?s=128&d=identicon&r=PG", "display_name": "Dan Short", "link": "https://stackoverflow.com/users/177534/dan-short"}, "edited": false, "score": 0, "creation_date": 1434741398, "post_id": 30945357, "comment_id": 49925968, "body": "Thanks, that&#39;s what I get for being a noob. The default database for my user was incorrect, so the .Query was failing with a &quot;table doesn&#39;t exist&quot; style error. Changed the default database for the login, and it&#39;s processing now. Thanks :)."}], "tags": [], "owner": {"reputation": 97745, "user_id": 884978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdb4f5f287976278b6e02f66e85c41dc?s=128&d=identicon&r=PG", "display_name": "creack", "link": "https://stackoverflow.com/users/884978/creack"}, "is_accepted": true, "score": 1, "last_activity_date": 1434740023, "creation_date": 1434740023, "answer_id": 30945357, "question_id": 30945198, "link": "https://stackoverflow.com/questions/30945198/invalid-memory-address-error-with-go-mssql/30945357#30945357", "title": "&#39;invalid memory address&#39; error with go-mssql", "body": "<p>There is probably an error with <code>db.Query</code>. Check your error and if it is not <code>nil</code>, assume that <code>rows</code> is <code>nil</code>. i.e. calling <code>rows.Next()</code> will segfault.\nIf you display the error, you will probably find out what the issue is.</p>\n"}], "owner": {"reputation": 9410, "user_id": 177534, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b7b357241e1241a7326c97262a66e4e3?s=128&d=identicon&r=PG", "display_name": "Dan Short", "link": "https://stackoverflow.com/users/177534/dan-short"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 30945357, "answer_count": 1, "score": -1, "last_activity_date": 1434740023, "creation_date": 1434739426, "question_id": 30945198, "link": "https://stackoverflow.com/questions/30945198/invalid-memory-address-error-with-go-mssql", "title": "&#39;invalid memory address&#39; error with go-mssql", "body": "<p>I'm having an issue that I can't seem to resolve, probably due to my inexperience with GO. I have the following code working on one server, but not on another. Here is the code:</p>\n\n<pre><code>// Build out the connection string to the database, and then open the connection to the database.\nconnString := fmt.Sprintf(\"server=%s;user id=%s;password=%s;port=%d\", *server, *user, *password, *port)\nif *debug { fmt.Printf(\" connString:%s\\n\", connString) }\ndb, err = sql.Open(\"mssql\", connString)\nif err != nil { log.Fatal(\"Open connection failed:\", err.Error()) }\nerr = db.Ping()\nif err != nil {\n    fmt.Println(\"Cannot connect: \", err.Error())\n    return\n}\n\nrows, _ := db.Query( \"SELECT Zip FROM Zip_Rural WHERE Zip = ?\", ZipCode[0:5] )\ndefer rows.Close()\n\nif !rows.Next() {\n    acreageRequirement = .5\n}\n</code></pre>\n\n<p>On the line that reads <code>if !rows.Next()</code> I get the following error:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\npanic: runtime error: invalid memory address or nil pointer dereference [signal 0xc0000005 code=0x0 addr=0x20 pc=0x477918]\n</code></pre>\n\n<p>This same code works just fine on another server, running GO version 1.4.2 on both machines. I have a feeling I just have some bad syntax somewhere in here, but have no idea what the real problem is. A call to <code>db.Exec</code> within the same file works just fine, which leads me to believe that my database connection is perfectly fine, but for some reason <code>db.Query</code> is not executing correctly.</p>\n"}, {"tags": ["security", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1434730697, "post_id": 30942322, "comment_id": 49920562, "body": "Why aren&#39;t you starting the server as the correct user in the first place?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1434731731, "post_id": 30942322, "comment_id": 49921113, "body": "Starting something as <code>root</code> (the only way most OSes let you <code>setuid</code> to a random user) just to quickly make it non-root seems error-prone and problematic. As JimB says, arrange to have it started with the correct permissions in the first place. If required/desired check that you have expected permission (or lack thereof) but IMO it should be considered too late to &quot;fix&quot; it (except by bailing out)."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 7, "last_activity_date": 1434729741, "creation_date": 1434729741, "answer_id": 30942526, "question_id": 30942322, "link": "https://stackoverflow.com/questions/30942322/run-golang-as-www-data/30942526#30942526", "title": "Run Golang as www-data", "body": "<p>No. You can't reliably setuid or setgid in go, because that doesn't work for multithreaded programs. </p>\n\n<p>You need to start the program as the intended user, either directly, through a supervisor of some sort (e.g. supervisord, runit, monit), or through your init system.</p>\n"}, {"comments": [{"owner": {"reputation": 7178, "user_id": 1077485, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408c0c11875e9e3f3432c5ddc9fcddd?s=128&d=identicon&r=PG", "display_name": "DroidOS", "link": "https://stackoverflow.com/users/1077485/droidos"}, "edited": false, "score": 0, "creation_date": 1434729944, "post_id": 30942527, "comment_id": 49920142, "body": "handy to know but not quite what I am looking for."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 2, "last_activity_date": 1434730614, "last_edit_date": 1434730614, "creation_date": 1434729749, "answer_id": 30942527, "question_id": 30942322, "link": "https://stackoverflow.com/questions/30942322/run-golang-as-www-data/30942527#30942527", "title": "Run Golang as www-data", "body": "<p>You can check if the program is running under a certain user with <a href=\"http://golang.org/pkg/os/user/\" rel=\"nofollow\"><code>os/user</code></a> package:</p>\n\n<pre><code>curr, err := user.Current()\n// Check err.\nwww, err := user.Lookup(\"www-data\")\n// Check err.\nif *curr != *www {\n    panic(\"Go away!\")\n}\n</code></pre>\n\n<p>This is not exactly what you want, but it does prevent it from running under any other user. You can run it as <code>www-data</code> by running it with <code>su</code>:</p>\n\n<pre><code>su www-data -c \"myserver\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1434778868, "post_id": 30947885, "comment_id": 49935088, "body": "I believe there are still issues with forking Go programs as this outstanding issue: <a href=\"https://github.com/golang/go/issues/227\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/227</a> - further, better to use <code>setcap</code> to provide the bare minimum privileges (bind to port 80) rather than run as root."}, {"owner": {"reputation": 97745, "user_id": 884978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdb4f5f287976278b6e02f66e85c41dc?s=128&d=identicon&r=PG", "display_name": "creack", "link": "https://stackoverflow.com/users/884978/creack"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1434799175, "post_id": 30947885, "comment_id": 49939953, "body": "fork can be tricky indeed, but in this case, it is safe. Simply start a new process with other privilege and discard old one."}], "tags": [], "owner": {"reputation": 97745, "user_id": 884978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdb4f5f287976278b6e02f66e85c41dc?s=128&d=identicon&r=PG", "display_name": "creack", "link": "https://stackoverflow.com/users/884978/creack"}, "is_accepted": false, "score": 1, "last_activity_date": 1434751491, "last_edit_date": 1434751491, "creation_date": 1434751128, "answer_id": 30947885, "question_id": 30942322, "link": "https://stackoverflow.com/questions/30942322/run-golang-as-www-data/30947885#30947885", "title": "Run Golang as www-data", "body": "<p>A way to achieve this safely would be to fork yourself.</p>\n\n<p>This is a raw untested example on how you could achieve safe setuid:</p>\n\n<p>1) Make sure you are root\n2) Listen on the wanted port (as root)\n3) Fork as <code>www-data</code> user.\n4) Accept and serve requests.</p>\n\n<p><a href=\"http://play.golang.org/p/sT25P0KxXK\" rel=\"nofollow\">http://play.golang.org/p/sT25P0KxXK</a></p>\n\n<pre><code>package main\n\nimport (\n        \"flag\"\n        \"fmt\"\n        \"log\"\n        \"net\"\n        \"net/http\"\n        \"os\"\n        \"os/exec\"\n        \"os/user\"\n        \"strconv\"\n        \"syscall\"\n)\n\nvar listenFD = flag.Int(\"l\", 0, \"listen pid\")\n\nfunc handler(w http.ResponseWriter, req *http.Request) {\n        u, err := user.Current()\n        if err != nil {\n                log.Println(err)\n                return\n        }\n        fmt.Fprintf(w, \"%s\\n\", u.Name)\n}\n\nfunc lookupUser(username string) (uid, gid int, err error) {\n        u, err := user.Lookup(username)\n        if err != nil {\n                return -1, -1, err\n        }\n        uid, err = strconv.Atoi(u.Uid)\n        if err != nil {\n                return -1, -1, err\n        }\n        gid, err = strconv.Atoi(u.Gid)\n        if err != nil {\n                return -1, -1, err\n        }\n        return uid, gid, nil\n}\n\n// FDListener .\ntype FDListener struct {\n        file *os.File\n}\n\n// Accept .\nfunc (ln *FDListener) Accept() (net.Conn, error) {\n        fd, _, err := syscall.Accept(int(*listenFD))\n        if err != nil {\n                return nil, err\n        }\n        conn, err := net.FileConn(os.NewFile(uintptr(fd), \"\"))\n        if err != nil {\n                return nil, err\n        }\n        return conn.(*net.TCPConn), nil\n}\n\n// Close .\nfunc (ln *FDListener) Close() error {\n        return ln.file.Close()\n}\n\n// Addr .\nfunc (ln *FDListener) Addr() net.Addr {\n        return nil\n}\n\nfunc start() error {\n        u, err := user.Current()\n        if err != nil {\n                return err\n        }\n        if u.Uid != \"0\" &amp;&amp; *listenFD == 0 {\n                // we are not root and we have no listen fd. Error.\n                return fmt.Errorf(\"need to run as root: %s\", u.Uid)\n        } else if u.Uid == \"0\" &amp;&amp; *listenFD == 0 {\n                // we are root and we have no listen fd. Do the listen.\n                l, err := net.Listen(\"tcp\", \"0.0.0.0:80\")\n                if err != nil {\n                        return fmt.Errorf(\"Listen error: %s\", err)\n                }\n                f, err := l.(*net.TCPListener).File()\n                if err != nil {\n                        return err\n                }\n\n                uid, gid, err := lookupUser(\"guillaume\")\n                if err != nil {\n                        return err\n                }\n                // First extra file: fd == 3\n                cmd := exec.Command(os.Args[0], \"-l\", fmt.Sprint(3))\n                cmd.Stdin = os.Stdin\n                cmd.Stdout = os.Stdout\n                cmd.Stderr = os.Stderr\n                cmd.ExtraFiles = append(cmd.ExtraFiles, f)\n                cmd.SysProcAttr = &amp;syscall.SysProcAttr{\n                        Credential: &amp;syscall.Credential{\n                                Uid: uint32(uid),\n                                Gid: uint32(gid),\n                        },\n                }\n                if err := cmd.Run(); err != nil {\n                        return fmt.Errorf(\"cmd.Run error: %s\", err)\n                }\n                return nil\n        } else if u.Uid != \"0\" &amp;&amp; *listenFD != 0 {\n                // We are not root and we have a listen fd. Do the accept.\n                ln := &amp;FDListener{file: os.NewFile(uintptr(*listenFD), \"net\")}\n                if err := http.Serve(ln, http.HandlerFunc(handler)); err != nil {\n                        return err\n                }\n        }\n        return fmt.Errorf(\"setuid fail: %s, %d\", u.Uid, *listenFD)\n}\n\nfunc main() {\n        flag.Parse()\n\n        if err := start(); err != nil {\n                log.Fatal(err)\n        }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7178, "user_id": 1077485, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408c0c11875e9e3f3432c5ddc9fcddd?s=128&d=identicon&r=PG", "display_name": "DroidOS", "link": "https://stackoverflow.com/users/1077485/droidos"}, "edited": false, "score": 1, "creation_date": 1434779479, "post_id": 30950683, "comment_id": 49935227, "body": "@elitrar - thanks.  I checked out that article: very well written and, very useful."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 3, "last_activity_date": 1434778771, "creation_date": 1434778771, "answer_id": 30950683, "question_id": 30942322, "link": "https://stackoverflow.com/questions/30942322/run-golang-as-www-data/30950683#30950683", "title": "Run Golang as www-data", "body": "<p>Expanding on @<strong>JimB</strong>'s answer:</p>\n\n<p>Use a process supervisor to run your application as a specific user (and handle restarts/crashes, log re-direction, etc). <code>setuid</code> and <code>setgid</code> are universally bad ideas for multi-threaded applications.</p>\n\n<p>Either use your OS' process manager (Upstart, systemd, sysvinit) or a standalone process manager (Supervisor, runit, monit, etc).</p>\n\n<p>Here's an example for Supervisor:</p>\n\n<pre><code>[program:yourapp]\ncommand=/home/yourappuser/bin/yourapp # the location of your app\nautostart=true\nautorestart=true\nstartretries=10\nuser=yourappuser # the user your app should run as (i.e. *not* root!)\ndirectory=/srv/www/yourapp.com/ # where your application runs from\nenvironment=APP_SETTINGS=\"/srv/www/yourapp.com/prod.toml\" # environmental variables\nredirect_stderr=true\nstdout_logfile=/var/log/supervisor/yourapp.log # the name of the log file.\nstdout_logfile_maxbytes=50MB\nstdout_logfile_backups=10\n</code></pre>\n\n<p>Further: if you're not reverse proxying and your Go application needs to bind to a port &lt; 1024 (e.g. port 80 or 443) then use <a href=\"https://wiki.apache.org/httpd/NonRootPortBinding\" rel=\"nofollow\">setcap</a> - for example: <code>setcap cap_net_bind_service=+ep /home/yourappuser/bin/yourapp</code></p>\n\n<p>PS: I wrote <a href=\"http://elithrar.github.io/article/running-go-applications-in-the-background/\" rel=\"nofollow\">a little article</a> on how to run Go applications with Supervisor (starting from \"I don't have Supervisor installed\").</p>\n"}], "owner": {"reputation": 7178, "user_id": 1077485, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408c0c11875e9e3f3432c5ddc9fcddd?s=128&d=identicon&r=PG", "display_name": "DroidOS", "link": "https://stackoverflow.com/users/1077485/droidos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 904, "favorite_count": 0, "accepted_answer_id": 30950683, "answer_count": 4, "score": 1, "last_activity_date": 1434778771, "creation_date": 1434729024, "question_id": 30942322, "link": "https://stackoverflow.com/questions/30942322/run-golang-as-www-data", "title": "Run Golang as www-data", "body": "<p>When I run a Node HTTP server app I usually call a custom function</p>\n\n<pre><code>function runAsWWW()\n{\n try \n {\n  process.setgid('www-data');\n  process.setuid('www-data');\n } catch (err) \n {\n  console.error('Cowardly refusal to keep the process alive as root.');\n  process.exit(1);\n }\n}\n</code></pre>\n\n<p>from <code>server.listen(8080,'localhost',null,runAsWWW);</code></p>\n\n<p>so the server is actually running as the <code>www-data</code> user to offer a better modicum of security.  Is there something similar I can do when I start up a Golang web server by issuing <code>go run index.go</code>?</p>\n"}, {"tags": ["json", "struct", "go", "channels"], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 443002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a29304fafe3bab0f4510a8242bf9a5b6?s=128&d=identicon&r=PG", "display_name": "Scott S. ", "link": "https://stackoverflow.com/users/443002/scott-s"}, "edited": false, "score": 0, "creation_date": 1434747496, "post_id": 30944727, "comment_id": 49928844, "body": "Thank you for your reply, Evan. I chose to use a buffered channel because I need to convert and print multiple structs. How would I do that without a buffered channel?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 143, "user_id": 443002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a29304fafe3bab0f4510a8242bf9a5b6?s=128&d=identicon&r=PG", "display_name": "Scott S. ", "link": "https://stackoverflow.com/users/443002/scott-s"}, "edited": false, "score": 0, "creation_date": 1434748660, "post_id": 30944727, "comment_id": 49929349, "body": "@ScottS. you can just use an array for those purposes. The idea of the channel is to provide communication between your worker threads and your application layer, you could use a buffered one, it&#39;s just rarely done and changes their mechanics a bit. Typically a channel blocks until it reads so you would use a for loop like the one I had above that just keeps reading off the channel until the goroutine says it&#39;s done or you get a shutdown or abort type of signal from elsewhere."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 143, "user_id": 443002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a29304fafe3bab0f4510a8242bf9a5b6?s=128&d=identicon&r=PG", "display_name": "Scott S. ", "link": "https://stackoverflow.com/users/443002/scott-s"}, "edited": false, "score": 0, "creation_date": 1434748719, "post_id": 30944727, "comment_id": 49929375, "body": "If you&#39;re going to use a buffered channel to just put an entire array into it you may as well not be using a goroutine at all, just use a blocking call cause you&#39;re not streaming your data at that point, you&#39;re just preparing it in asynchronously while doing nothing but waiting for it to be done."}, {"owner": {"reputation": 143, "user_id": 443002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a29304fafe3bab0f4510a8242bf9a5b6?s=128&d=identicon&r=PG", "display_name": "Scott S. ", "link": "https://stackoverflow.com/users/443002/scott-s"}, "edited": false, "score": 0, "creation_date": 1434753104, "post_id": 30944727, "comment_id": 49930748, "body": "I&#39;ll look into using an array as well as your for loop. Thanks for your time, Evan. I appreciate it."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 1, "last_activity_date": 1434737975, "last_edit_date": 1434737975, "creation_date": 1434737556, "answer_id": 30944727, "question_id": 30941706, "link": "https://stackoverflow.com/questions/30941706/goroutine-channels-over-a-for-loop/30944727#30944727", "title": "goroutine channels over a for loop", "body": "<p>You're printing the channels info, not the data it contains. You don't want a loop, you just want to receive then print.</p>\n\n<pre><code>   json := &lt;-index\n   json.NewEncoder(os.Stdout).Encode(json)\n</code></pre>\n\n<p>Now I do I need to point out, that code is not going to block. If you want to keep reading until all work is done you need some kind of locking/coordination mechanism.</p>\n\n<p>You'll often see things like </p>\n\n<pre><code>for {\n   select {\n        case json := &lt;-jsonChannel:\n            // do stuff\n        case &lt;-abort:\n            // get out of here \n   }\n}\n</code></pre>\n\n<p>To deal with that. Also, just fyi you're initializing your channel with a default capacity (meaning it's a buffered channel) which is pretty odd. I'd recommend reviewing some tutorials on the topic cause overall your design needs some work actually be an improvement of non-concurrent implementations. Lastly you can find libraries to abstract some of this work for you and most people would probably recommend you do. Here's an example; <a href=\"https://github.com/lytics/squaredance\" rel=\"nofollow\">https://github.com/lytics/squaredance</a></p>\n"}], "owner": {"reputation": 143, "user_id": 443002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a29304fafe3bab0f4510a8242bf9a5b6?s=128&d=identicon&r=PG", "display_name": "Scott S. ", "link": "https://stackoverflow.com/users/443002/scott-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 419, "favorite_count": 0, "accepted_answer_id": 30944727, "answer_count": 1, "score": 0, "last_activity_date": 1434737975, "creation_date": 1434727023, "last_edit_date": 1434728256, "question_id": 30941706, "link": "https://stackoverflow.com/questions/30941706/goroutine-channels-over-a-for-loop", "title": "goroutine channels over a for loop", "body": "<p>My <code>main</code> function reads json from a file, unmarshals it into a struct, converts it into another struct type and spits out formatted JSON through stdout.</p>\n\n<p>I'm trying to implement goroutines and channels to add concurrency to my <code>for</code> loop.</p>\n\n<pre><code>func main() {\n    muvMap := map[string]string{\"male\": \"M\", \"female\": \"F\"}\n    fileA, err := os.Open(\"serviceAfileultimate.json\")\n    if err != nil {\n        panic(err)\n    }\n    defer fileA.Close()\n\n    data := make([]byte, 10000)\n    count, err := fileA.Read(data)\n    if err != nil {\n        panic(err)\n    }\n\n    dataBytes := data[:count]\n\n    var servicesA ServiceA\n    json.Unmarshal(dataBytes, &amp;servicesA)\n    var servicesB = make([]ServiceB, servicesA.Count)\n    goChannels := make(chan ServiceB, servicesA.Count)\n\n    for i := 0; i &lt; servicesA.Count; i++ {\n        go func() {\n            reflect.ValueOf(&amp;servicesB[i]).Elem().FieldByName(\"Address\").SetString(Merge(&amp;servicesA.Users[i].Location))\n            reflect.ValueOf(&amp;servicesB[i]).Elem().FieldByName(\"Date_Of_Birth\").SetString(dateCopyTransform(servicesA.Users[i].Dob))\n            reflect.ValueOf(&amp;servicesB[i]).Elem().FieldByName(\"Email\").SetString(servicesA.Users[i].Email)\n            reflect.ValueOf(&amp;servicesB[i]).Elem().FieldByName(\"Fullname\").SetString(Merge(&amp;servicesA.Users[i].Name))\n            reflect.ValueOf(&amp;servicesB[i]).Elem().FieldByName(\"Gender\").SetString(muvMap[servicesA.Users[i].Gender])\n            reflect.ValueOf(&amp;servicesB[i]).Elem().FieldByName(\"Phone\").SetString(servicesA.Users[i].Cell)\n            reflect.ValueOf(&amp;servicesB[i]).Elem().FieldByName(\"Username\").SetString(servicesA.Users[i].Username)\n            goChannels &lt;- servicesB[i]\n        }()\n    }\n\n    for index := range goChannels {\n        json.NewEncoder(os.Stdout).Encode(index)\n    }\n\n}\n</code></pre>\n\n<p>It compiles but is returning messages like:</p>\n\n<pre><code>goroutine 1 [chan receive]: main.main() C://.....go.94 +0x55b.\n</code></pre>\n"}, {"tags": ["xml", "reflection", "struct", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1434723934, "post_id": 30940332, "comment_id": 49916111, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/26867417/golang-marshal-dynamic-xml-element-name\">Golang marshal dynamic xml element name</a>"}, {"owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1434724324, "post_id": 30940332, "comment_id": 49916398, "body": ":) Nice, I asked that question a few months ago, but that was the other way around then. Now I need to set the name of a field. I assume I need to wrap every member of my struct into a new struct, and supply the xml.Name."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1434725190, "post_id": 30940332, "comment_id": 49917045, "body": "Yes, you either use different types for different tags, or use <code>XMLName</code>, or create a custom marshaler that builds the XML based on some parameter of the struct."}, {"owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1434725320, "post_id": 30940332, "comment_id": 49917139, "body": "Ok I see, but I can&#39;t make it work for attributes (see edit, because of duplicate vote). How would it work for them?"}], "answers": [{"comments": [{"owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "edited": false, "score": 0, "creation_date": 1434728602, "post_id": 30942109, "comment_id": 49919347, "body": "Can I put <code>xml:&quot;,attr&quot;</code> on the <code>type Val struct</code> definition?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "edited": false, "score": 0, "creation_date": 1434728879, "post_id": 30942109, "comment_id": 49919527, "body": "No, but you can <a href=\"http://play.golang.org/p/pfXzhhekvN\" rel=\"nofollow noreferrer\">create a wrapper and embed it</a>. I personally wouldn&#39;t do it, since it would make the code less explicit, but I don&#39;t know your use case, so it&#39;s up to you."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 2, "last_activity_date": 1434728295, "creation_date": 1434728295, "answer_id": 30942109, "question_id": 30940332, "link": "https://stackoverflow.com/questions/30940332/change-struct-tag-xml-at-runtime/30942109#30942109", "title": "Change struct tag (xml) at runtime", "body": "<p>(I don't know why did the other person delete their answer, but here's mine.)</p>\n\n<p>You can either use a combination of <code>,attr</code> and <code>,omitempty</code></p>\n\n<pre><code>type S struct {\n    Value    string `xml:\"value,attr,omitempty\"`\n    Category string `xml:\"category,attr,omitempty\"`\n}\n</code></pre>\n\n<p>(playground: <a href=\"http://play.golang.org/p/C9tRlA80RV\" rel=\"nofollow\">http://play.golang.org/p/C9tRlA80RV</a>) or create a custom <code>xml.MarshalerAttr</code></p>\n\n<pre><code>type S struct {\n    Value Val `xml:\",attr\"`\n}\n\ntype Val struct{ string }\n\nfunc (v Val) MarshalXMLAttr(name xml.Name) (xml.Attr, error) {\n    if v.string == \"One\" {\n        return xml.Attr{Name: xml.Name{Local: \"value\"}, Value: v.string}, nil\n    }\n\n    return xml.Attr{Name: xml.Name{Local: \"category\"}, Value: v.string}, nil\n}\n</code></pre>\n\n<p>(playground: <a href=\"http://play.golang.org/p/a1Wd2gonb_\" rel=\"nofollow\">http://play.golang.org/p/a1Wd2gonb_</a>).</p>\n\n<p>The first approach is easier but less flexible, and also makes the struct bigger. The second approach is slightly more complex, but also more robust and flexible.</p>\n"}], "owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1385, "favorite_count": 0, "accepted_answer_id": 30942109, "answer_count": 1, "score": 1, "last_activity_date": 1434728295, "creation_date": 1434723127, "last_edit_date": 1434725239, "question_id": 30940332, "link": "https://stackoverflow.com/questions/30940332/change-struct-tag-xml-at-runtime", "title": "Change struct tag (xml) at runtime", "body": "<p>There's a struct:</p>\n\n<pre><code>type S struct {\n  Value string `xml:\"value,attr\"`\n}\n</code></pre>\n\n<p>I want to encode the struct to an XML file. However, I want the attribute name of <code>Value</code> to be different in each file:</p>\n\n<pre><code>s1 := S{\n  Value: \"One\"\n}\n</code></pre>\n\n<p>should encode to:</p>\n\n<pre><code>&lt;S value=\"One\"&gt;&lt;/S&gt;\n</code></pre>\n\n<p>and </p>\n\n<pre><code>s2 := S{\n  Value: \"Two\"\n}\n</code></pre>\n\n<p>should encode to:</p>\n\n<pre><code>&lt;S category=\"Two\"&gt;&lt;/S&gt;\n</code></pre>\n\n<p>So, I need either to change the XML element name somehow, or change the tag on the field. Is this possible?</p>\n\n<p>I checked <code>reflect</code> (<a href=\"https://golang.org/pkg/reflect/#Value.FieldByName\" rel=\"nofollow\">https://golang.org/pkg/reflect/#Value.FieldByName</a>), but since <code>FieldByName</code> returns a value type and there are no <code>Set</code> methods, I don't think it's possible to use reflection.</p>\n"}, {"tags": ["file", "go", "line"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1434722934, "post_id": 30940190, "comment_id": 49915349, "body": "First, don&#39;t ignore errors. Second, you&#39;re not writing to the file at the position you think you are."}, {"owner": {"reputation": 721, "user_id": 4628081, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yGbnkCNSojE/AAAAAAAAAAI/AAAAAAAAAcY/zmn34zFQAVI/photo.jpg?sz=128", "display_name": "Francesco Gualazzi", "link": "https://stackoverflow.com/users/4628081/francesco-gualazzi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1434723856, "post_id": 30940190, "comment_id": 49916054, "body": "Hi Jim, thanks for that, I may have missed a <code>fs.File.Seek(0,0)</code>, but still I would not get any error..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1434724647, "post_id": 30940190, "comment_id": 49916657, "body": "You&#39;re ignoring the error returned by <code>File.WriteString</code>. (also, the <code>ScanLines</code> function strips newline characters, but  if the file isn&#39;t changing, you&#39;re still not writing to it)"}], "answers": [{"comments": [{"owner": {"reputation": 721, "user_id": 4628081, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yGbnkCNSojE/AAAAAAAAAAI/AAAAAAAAAcY/zmn34zFQAVI/photo.jpg?sz=128", "display_name": "Francesco Gualazzi", "link": "https://stackoverflow.com/users/4628081/francesco-gualazzi"}, "edited": false, "score": 0, "creation_date": 1434884279, "post_id": 30948278, "comment_id": 49959447, "body": "Hi Peter, the above code is doing what I expected, thank you! Reading and testing this I believe I misunderstood the documentation of os.Seek and os.Truncate. I did try another version with truncate but couldn&#39;t make it work. Thank you again for pointing me to the right direction :)"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 5, "last_activity_date": 1563067754, "last_edit_date": 1563067754, "creation_date": 1434753510, "answer_id": 30948278, "question_id": 30940190, "link": "https://stackoverflow.com/questions/30940190/remove-first-line-from-text-file-in-golang/30948278#30948278", "title": "Remove first line from text file in Golang", "body": "<blockquote>\n  <p>pop the first line of a file and thus reduce the file lines one by\n  one.</p>\n</blockquote>\n\n<hr>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\nfunc popLine(f *os.File) ([]byte, error) {\n    fi, err := f.Stat()\n    if err != nil {\n        return nil, err\n    }\n    buf := bytes.NewBuffer(make([]byte, 0, fi.Size()))\n\n    _, err = f.Seek(0, io.SeekStart)\n    if err != nil {\n        return nil, err\n    }\n    _, err = io.Copy(buf, f)\n    if err != nil {\n        return nil, err\n    }\n\n    line, err := buf.ReadBytes('\\n')\n    if err != nil &amp;&amp; err != io.EOF {\n        return nil, err\n    }\n\n    _, err = f.Seek(0, io.SeekStart)\n    if err != nil {\n        return nil, err\n    }\n    nw, err := io.Copy(f, buf)\n    if err != nil {\n        return nil, err\n    }\n    err = f.Truncate(nw)\n    if err != nil {\n        return nil, err\n    }\n    err = f.Sync()\n    if err != nil {\n        return nil, err\n    }\n\n    _, err = f.Seek(0, io.SeekStart)\n    if err != nil {\n        return nil, err\n    }\n    return line, nil\n}\n\nfunc main() {\n    fname := `popline.txt`\n    f, err := os.OpenFile(fname, os.O_RDWR|os.O_CREATE, 0666)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    defer f.Close()\n    line, err := popLine(f)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    fmt.Println(\"pop:\", string(line))\n}\n</code></pre>\n\n<pre>\n$ cat popline.txt\nLorem ipsum dolor sit amet, consectetur adipiscing elit, \nsed do eiusmod tempor incididunt ut labore et dolore magna aliqua. \nUt enim ad minim veniam, \nquis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. \nDuis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. \nExcepteur sint occaecat cupidatat non proident, \nsunt in culpa qui officia deserunt mollit anim id est laborum.\n\n$ go run popline.go\npop: Lorem ipsum dolor sit amet, consectetur adipiscing elit, \n\n$ cat popline.txt\nsed do eiusmod tempor incididunt ut labore et dolore magna aliqua. \nUt enim ad minim veniam, \nquis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. \nDuis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. \nExcepteur sint occaecat cupidatat non proident, \nsunt in culpa qui officia deserunt mollit anim id est laborum.\n\n$ \n</pre>\n"}], "owner": {"reputation": 721, "user_id": 4628081, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yGbnkCNSojE/AAAAAAAAAAI/AAAAAAAAAcY/zmn34zFQAVI/photo.jpg?sz=128", "display_name": "Francesco Gualazzi", "link": "https://stackoverflow.com/users/4628081/francesco-gualazzi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6344, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1563067754, "creation_date": 1434722733, "last_edit_date": 1434726548, "question_id": 30940190, "link": "https://stackoverflow.com/questions/30940190/remove-first-line-from-text-file-in-golang", "title": "Remove first line from text file in Golang", "body": "<p>I'm trying to pop the first line of a file and thus reduce the file lines one by one.\nMy implementation for removing the first line is as follows</p>\n\n<pre><code>type FS struct {\n    ...\n    File       *os.File\n}\n\n//File creation ok...\n\n\nfunc (fs *Fs) pop() []byte {\n    var buf []string\n    scanner := bufio.NewScanner(fs.File)\n    //Reading lines\n    for scanner.Scan() {\n        line := scanner.Text()\n        buf = append(buf, line)\n    }\n    //Writing from second line on the same file\n    for s := 1; s &lt; len(buf); s++ {\n        fs.File.WriteString(fmt.Println(buf[s]))\n    }\n    //Commit changes\n    fs.File.Sync()\n    fs.File.Close()\n\n    return []byte(buf[0])\n}\n</code></pre>\n\n<p>I get the returned []byte with the expected string but the file never changes.\nWhat am I missing here?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 7, "last_activity_date": 1434716113, "creation_date": 1434716113, "answer_id": 30937904, "question_id": 30937810, "link": "https://stackoverflow.com/questions/30937810/assign-value-to-parent-golang-structure-field/30937904#30937904", "title": "Assign value to parent golang structure field", "body": "<blockquote>\n  <p>Why the second one is working, but the first one is not?</p>\n</blockquote>\n\n<p>Because</p>\n\n<pre><code>b.A_FIELD = \"aaaa_field\"\n</code></pre>\n\n<p>is actually</p>\n\n<pre><code>b.A.A_FIELD = \"aaaa_field\"\n</code></pre>\n\n<p>in disguise.</p>\n\n<blockquote>\n  <p>How should I change first one to work?</p>\n</blockquote>\n\n<pre><code>func main() {\n    b := &amp;B{\n        A: A{\n            A_FIELD: \"aaaa_field\",\n        },\n        B_FIELD: \"bbbb_field\",\n    }\n}\n</code></pre>\n\n<p>You should read <a href=\"https://golang.org/doc/effective_go.html#embedding\">how embedding work</a> on Effective Go.</p>\n"}], "owner": {"reputation": 217, "user_id": 2047651, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/eb4b591a471ab2bfba93d4ca9a50420e?s=128&d=identicon&r=PG", "display_name": "Hepri", "link": "https://stackoverflow.com/users/2047651/hepri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 427, "favorite_count": 0, "accepted_answer_id": 30937904, "answer_count": 1, "score": 1, "last_activity_date": 1434716113, "creation_date": 1434715801, "question_id": 30937810, "link": "https://stackoverflow.com/questions/30937810/assign-value-to-parent-golang-structure-field", "title": "Assign value to parent golang structure field", "body": "<p>There are two situations:</p>\n\n<pre><code>type A struct {\n    A_FIELD  string\n}\ntype B struct {\n    A\n    B_FIELD  string\n}\n\nfunc main() {\n    b := &amp;B{\n        A_FIELD: \"aaaa_field\",\n        B_FIELD: \"bbbb_field\",\n    } \n}\n</code></pre>\n\n<p>And </p>\n\n<pre><code>type A struct {\n    A_FIELD  string\n}\ntype B struct {\n    A\n    B_FIELD  string\n}\n\nfunc main() {\n    b := &amp;B{}\n    b.A_FIELD = \"aaaa_field\"\n    b.B_FIELD = \"bbbb_field\"\n    fmt.Printf(\"Good!\")\n}\n</code></pre>\n\n<p>Why the second one is working, but the first one is not? I receive compile time exceptions. How should I change first one to work?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "edited": false, "score": 0, "creation_date": 1434710300, "post_id": 30935947, "comment_id": 49906871, "body": "Maybe there is a overhead to start the goroutine that is large enough to put it in the second place. A 1ms sleep before the <code>fmt.Println</code> prints <code>Hello\\nWorld\\n</code>."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 5, "creation_date": 1434710583, "post_id": 30935947, "comment_id": 49907041, "body": "@Tichodroma: assuming GOMAXPROCS=1, <code>time.Sleep</code> just switches context to another routine. This is one of these <i>points</i> where scheduler is happy to do so. (see: <a href=\"http://stackoverflow.com/questions/15771232\">stackoverflow.com/questions/15771232</a>)"}], "answers": [{"comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1434964118, "post_id": 30937378, "comment_id": 49982839, "body": "Especially <b>don&#39;t rely on yield points for your program to work correctly</b>. If you do, it might possibly work now, but there&#39;s <i>no guarantee</i> it will still work in future, or on a different machine with a faster cpu, or on a different OS, or on a system with more I/O load, etc etc."}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": false, "score": 4, "last_activity_date": 1434714400, "creation_date": 1434714400, "answer_id": 30937378, "question_id": 30935947, "link": "https://stackoverflow.com/questions/30935947/what-is-the-execution-time-point-of-goroutine/30937378#30937378", "title": "What is the execution time point of goroutine?", "body": "<blockquote>\n  <p>What is the execution time point of goroutine?</p>\n</blockquote>\n\n<p>The compiler will insert yield points into your program at different locations where it seems adequate. For example, in some function calls and seemingly tight loops. Also, a goroutine will yield when blocking on a syscall. So your program will <em>probably</em> yield execution over to the second goroutine when the first goroutine reaches <code>fmt.Println(\"World\")</code> and enters a write syscall. After that non-determinism ensues because we don't know how long this syscall will take.</p>\n\n<p>This, however, is an implementation detail and you should not be concerned with it. When talking about parallelism, the only timing guarantees (i.e. \"happens before\") you have are those provided by concurrency primitives like those from the standard library's <code>sync/atomic</code> package.</p>\n\n<p>TL;DR: <strong>Don't rely on yield points for your program to work correctly.</strong></p>\n"}], "owner": {"reputation": 14298, "user_id": 2106207, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/960430ab7aba908bb9aa62d530618a75?s=128&d=identicon&r=PG", "display_name": "Nan Xiao", "link": "https://stackoverflow.com/users/2106207/nan-xiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1434714400, "creation_date": 1434709919, "question_id": 30935947, "link": "https://stackoverflow.com/questions/30935947/what-is-the-execution-time-point-of-goroutine", "title": "What is the execution time point of goroutine?", "body": "<p>I run the following Go code 10 times:  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    go fmt.Println(\"Hello\")\n    fmt.Println(\"World\")\n    time.Sleep(1 * time.Millisecond)\n}\n</code></pre>\n\n<p>The output is always \"<code>World</code>\" first:  </p>\n\n<pre><code>World\nHello\n</code></pre>\n\n<p>Does it manifest the <code>goroutine</code> will execute unitl there is a block in <code>main</code> routine? What is the execution time point of <code>goroutine</code>?</p>\n"}, {"tags": ["pointers", "go"], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 2505060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d64ce9895981d7b563a2c6d4d028731?s=128&d=identicon&r=PG", "display_name": "user2505060", "link": "https://stackoverflow.com/users/2505060/user2505060"}, "edited": false, "score": 0, "creation_date": 1434711853, "post_id": 30934843, "comment_id": 49907823, "body": "That works thanks. I had a different issue that caused the straight forward answer not to work. Now the world makes sense again."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 3, "last_activity_date": 1434706803, "creation_date": 1434706803, "answer_id": 30934843, "question_id": 30934792, "link": "https://stackoverflow.com/questions/30934792/golang-down-casting-struct/30934843#30934843", "title": "Golang down casting struct", "body": "<p>The error message is pretty clear. You can't use <code>Car</code> as a pointer to <code>Car</code>. You need to either redefine your <code>Ferrari</code> to embed a pointer to <code>Car</code></p>\n\n<pre><code>type Ferrari struct {\n    *Car\n    driver string\n}\n</code></pre>\n\n<p>or to dereference the pointer in the literal:</p>\n\n<pre><code>ferrari := Ferrari{*car, \"Some Dude\"}\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 2505060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d64ce9895981d7b563a2c6d4d028731?s=128&d=identicon&r=PG", "display_name": "user2505060", "link": "https://stackoverflow.com/users/2505060/user2505060"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 673, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1434706803, "creation_date": 1434706627, "question_id": 30934792, "link": "https://stackoverflow.com/questions/30934792/golang-down-casting-struct", "title": "Golang down casting struct", "body": "<p>I'm relatively new at Go and struggling with initialising structs.</p>\n\n<p>The classic example is </p>\n\n<pre><code>type Car struct {\n    wheelCount int\n}\ntype Ferrari struct {\n   Car\n   driver string\n}\n\n// Initialise Ferrari\nf := Ferrari{Car{4},\"Some Dude\"}\n</code></pre>\n\n<p>My question is, how do I get a *Ferrari if I only have a *Car created with a constructor?</p>\n\n<p>I would like to be able to to something like the following</p>\n\n<pre><code>func NewCar(wheels int) *Car{\n    return &amp;Car{wheels};\n}\n\ncar := NewCar(4);\nferrari := Ferrari{car,\"Some Dude\"}; // ERROR cannot use car (type *Car) as type Car in field value\n</code></pre>\n\n<p>Am I approaching the problem incorrectly? Can one simply dereference the car somehow?</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 0, "creation_date": 1526455982, "post_id": 30935270, "comment_id": 87745879, "body": "This answer doesn&#39;t explain how to allocate a new <code>struct Position</code> value that can be used with the imported <code>read</code> function."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 0, "creation_date": 1526462968, "post_id": 30935270, "comment_id": 87750456, "body": "that&#39;s true. You need know basics cgo inter-calls. Then my answer will fill the gap of alloc and pass struct."}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": -1, "last_activity_date": 1434707961, "creation_date": 1434707961, "answer_id": 30935270, "question_id": 30934394, "link": "https://stackoverflow.com/questions/30934394/how-to-construct-c-struct-in-go-side/30935270#30935270", "title": "How to construct C struct in Go side?", "body": "<p>How call c from golang is clear by the generated stub. use <code>go build -work src/main.go</code> to generate the stub and get the working directory. find the function prototype in <code>_obj/_cgo_gotypes.go</code> file.\ni.e. I can get the following generated go stub:</p>\n\n<pre><code>type _Ctype_Position _Ctype_struct__Position\ntype _Ctype_struct__Position struct {\n//line :1                                                                                                                                                                                                           \n    index   _Ctype_int\n//line :1                                                                                                                                                                                                           \n    offset  _Ctype_int\n//line :1                                                                                                                                                                                                           \n}\nfunc _Cfunc_read(p0 *_Ctype_char, p1 *_Ctype_struct__Position, p2 **_Ctype_char) (r1 _Ctype_int)\n</code></pre>\n\n<p>if i have the c header file like this:</p>\n\n<pre><code>typedef struct _Position\n{\n  int index;\n  int offset;\n}Position;\n\nextern int read(const char* filename, const Position* pos, const char** data);\n</code></pre>\n\n<p>BTW you need reference the c function in go source to make a dependency for <code>go build</code> to generate the referenced function stub.</p>\n"}], "owner": {"reputation": 477, "user_id": 2169469, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4712d1bf23ea18fde09e1eb8f74ee886?s=128&d=identicon&r=PG", "display_name": "Meng", "link": "https://stackoverflow.com/users/2169469/meng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 825, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1434707961, "creation_date": 1434705502, "question_id": 30934394, "link": "https://stackoverflow.com/questions/30934394/how-to-construct-c-struct-in-go-side", "title": "How to construct C struct in Go side?", "body": "<p>I need to call a C function which needs a pointer of struct as argument.\nHere's the C code:</p>\n\n<pre><code>struct Position\n{\n    uint64_t index;\n    uint64_t offset;\n};\n\nint read(const char* filename, const Position* pos, const char** data)\n</code></pre>\n\n<p>So in Go code, I think I have to malloc memory to construct a Position object and pass its pointer to C function. Maybe I also need to free memory. It seems like what C.CString() did. So how can I do that? Is there any code example? THX.</p>\n"}, {"tags": ["go", "couchbase"], "answers": [{"tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 4, "last_activity_date": 1434715384, "creation_date": 1434715384, "answer_id": 30937695, "question_id": 30931951, "link": "https://stackoverflow.com/questions/30931951/how-check-error-codes-with-couchbase-gocb/30937695#30937695", "title": "How check error codes with couchbase gocb?", "body": "<blockquote>\n  <p>Can this be done?</p>\n</blockquote>\n\n<p>In <code>gocbcore</code>, error.go we have the <a href=\"https://github.com/couchbaselabs/gocb/blob/master/gocbcore/error.go#L36\" rel=\"nofollow\">following definition</a>:</p>\n\n<pre><code>type memdError struct {\n    code StatusCode\n}\n\n// ...\n\nfunc (e memdError) KeyNotFound() bool {\n    return e.code == StatusKeyNotFound\n}\nfunc (e memdError) KeyExists() bool {\n    return e.code == StatusKeyExists\n}\nfunc (e memdError) Temporary() bool {\n    return e.code == StatusOutOfMemory || e.code == StatusTmpFail\n}\nfunc (e memdError) AuthError() bool {\n    return e.code == StatusAuthError\n}\nfunc (e memdError) ValueTooBig() bool {\n    return e.code == StatusTooBig\n}\nfunc (e memdError) NotStored() bool {\n    return e.code == StatusNotStored\n}\nfunc (e memdError) BadDelta() bool {\n    return e.code == StatusBadDelta\n}\n</code></pre>\n\n<p>Note that <code>memdError</code> is unexported, so you can't use it in a type assertion.</p>\n\n<p>So, take a different approach: define your own interface:</p>\n\n<pre><code>type MyErrorInterface interface {\n    KeyNotFound() bool\n    KeyExists() bool\n}\n</code></pre>\n\n<p>And assert whatever error you get back from <code>gocb</code> to your interface:</p>\n\n<pre><code>_, err := bucket.Get(key, entity)\n\nif err != nil {\n    if se, ok = err.(MyErrorInterface); ok {\n        if se.KeyNotFound() {\n            // handle KeyNotFound\n        }\n        if se.KeyExists() {\n            // handle KeyExists\n        }\n    } else {\n        // no information about states\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 330735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/593c3c9758c97d0be8f9a8e5d5b284cb?s=128&d=identicon&r=PG", "display_name": "dix", "link": "https://stackoverflow.com/users/330735/dix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "accepted_answer_id": 30937695, "answer_count": 1, "score": 2, "last_activity_date": 1434715384, "creation_date": 1434697361, "question_id": 30931951, "link": "https://stackoverflow.com/questions/30931951/how-check-error-codes-with-couchbase-gocb", "title": "How check error codes with couchbase gocb?", "body": "<p>When handling errors returned by <a href=\"https://github.com/couchbaselabs/gocb\" rel=\"nofollow\">gocb</a> (the official Couchbase Go Client) I would like to check for specific status codes (e.g. <code>StatusKeyNotFound</code> or <code>StatusKeyExists</code>).</p>\n\n<p>Like so</p>\n\n<pre><code>_, err := bucket.Get(key, entity)\nif err != nil {\n    if err == gocb.ErrKeyNotFound {\n        ...\n    }\n}\n</code></pre>\n\n<p>Can this be done?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 1, "last_activity_date": 1434699124, "last_edit_date": 1434699124, "creation_date": 1434695092, "answer_id": 30931282, "question_id": 30931142, "link": "https://stackoverflow.com/questions/30931142/exploring-go-packages/30931282#30931282", "title": "Exploring GO packages", "body": "<p>Go code is distributed with source and documentation tooling so you just need to search for sources in $GOROOT/src directory or use <code>godoc</code> tool  or simply go to <a href=\"http://golang.org/pkg/\" rel=\"nofollow\">http://golang.org/pkg/</a> for standard library or <a href=\"https://godoc.org/\" rel=\"nofollow\">https://godoc.org/</a> for many other libraries.</p>\n\n<p>On command line run <code>godoc &lt;pkg name&gt;</code>, example <code>godoc encoding/json</code>.</p>\n\n<p>By the way, you can also get Java library sources so using <code>javap</code> for this is definitely not the shortest path. It also have documentation available online <a href=\"https://docs.oracle.com/javase/8/docs/api/\" rel=\"nofollow\">https://docs.oracle.com/javase/8/docs/api/</a></p>\n"}], "owner": {"reputation": 1455, "user_id": 465147, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/e824e3adb5aa777566fa8e53f89bebbe?s=128&d=identicon&r=PG", "display_name": "sprabhakaran", "link": "https://stackoverflow.com/users/465147/sprabhakaran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 30931282, "answer_count": 1, "score": 0, "last_activity_date": 1434699124, "creation_date": 1434694562, "question_id": 30931142, "link": "https://stackoverflow.com/questions/30931142/exploring-go-packages", "title": "Exploring GO packages", "body": "<p>Is any way to explore the GO packages?</p>\n\n<p>In java, I have using \"javap java.lang.String\" command for viewing the method inside of the class. Something like this, Is any command is their in GO language ?</p>\n\n<p>I have search the same in google. I didn't get expected result.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1434700601, "post_id": 30931387, "comment_id": 49901015, "body": "It may be worth <a href=\"https://github.com/golang/go/blob/master/CONTRIBUTING.md\" rel=\"nofollow noreferrer\">raising an issue</a> to export error variables from the tls package."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1434696789, "last_edit_date": 1495540022, "creation_date": 1434695431, "answer_id": 30931387, "question_id": 30930042, "link": "https://stackoverflow.com/questions/30930042/managing-errors-in-golang/30931387#30931387", "title": "Managing errors in golang", "body": "<p>There is possibility for good error management in Go.</p>\n\n<p>See <a href=\"https://stackoverflow.com/a/30178766/1705598\">this answer</a> by Dave C for a nice summary and good examples.</p>\n\n<p>Unfortunately in case of the <a href=\"https://golang.org/pkg/crypto/tls/\" rel=\"nofollow noreferrer\"><code>tls</code></a> package, you're out of luck. The errors you try to detect are generated by <a href=\"https://golang.org/pkg/fmt/#Errorf\" rel=\"nofollow noreferrer\"><code>fmt.Errorf()</code></a> calls (which delegate to <a href=\"https://golang.org/pkg/errors/#New\" rel=\"nofollow noreferrer\"><code>errors.New()</code></a>) so they are not special in any way and they are not pre-declared so you can't do significantly better than your current solution to distinguish them. Probably the developers were lazy to provide more sophisticated or more easily traceable errors or simply they thought it is not important and left out for simplicity; so they currently serve more like informational for the developer.</p>\n\n<p>Further reading (quoted from Dave C's answer):</p>\n\n<ul>\n<li><a href=\"https://golang.org/doc/effective_go.html#errors\" rel=\"nofollow noreferrer\">Effective Go on errors</a></li>\n<li>The Go Blog <a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"nofollow noreferrer\">Error handling and Go</a></li>\n<li>Dave Cheney <a href=\"http://dave.cheney.net/2014/12/24/inspecting-errors\" rel=\"nofollow noreferrer\">Inspecting Errors</a></li>\n</ul>\n"}], "owner": {"reputation": 489, "user_id": 1082856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/652d2718c654758a2b7a068a057fdab6?s=128&d=identicon&r=PG", "display_name": "ffyns", "link": "https://stackoverflow.com/users/1082856/ffyns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 468, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1434696789, "creation_date": 1434689042, "question_id": 30930042, "link": "https://stackoverflow.com/questions/30930042/managing-errors-in-golang", "title": "Managing errors in golang", "body": "<p>I'm coming from Ruby and looking at Go at the moment. I start writing a little bit of code to check TLS support for a given host. </p>\n\n<pre>\nvar tls_versions = map[uint16]string{\n  tls.VersionSSL30:  \"SSLv3\",\n  tls.VersionTLS10:  \"TLSv1.0\",\n  tls.VersionTLS11:  \"TLSv1.1\",\n  tls.VersionTLS12:  \"TLSv1.2\",\n}\n\nvar refused_re = regexp.MustCompile(\": connection refused\")\nvar nodns_re = regexp.MustCompile(\": no such host\")\nvar versionnotsupported_re = regexp.MustCompile(\": protocol version not supported\")\n\nfunc checkversion(host string) (map[string]bool, error) { // {{\n  ret := map[string]bool{}\n\n  for version := tls.VersionSSL30; version &lt;= tls.VersionTLS12; version++ {\n    conn, err := tls.Dial(\"tcp\", host+\":443\", &tls.Config{\n       MinVersion: uint16(version),\n    })\n\n    if err != nil && \n        (refused_re.MatchString(err.Error()) == true || nodns_re.MatchString(err.Error()) == true) { \n      log.Println(err)\n      return ret, err\n    }\n\n    if err != nil && versionnotsupported_re.MatchString(err.Error()) == true  {\n      ret[tls_versions[uint16(version)]] = false\n      log.Println(\"Not supported: \"+host+\"  \"+tls_versions[uint16(version)])\n    }\n    ret[tls_versions[uint16(version)]] = true\n\n    if conn != nil {\n      conn.Close()\n    }\n  }\n  return ret, nil\n} \n</pre>\n\n<p>Coming from Ruby I found the error management in this code pretty ugly as I'm one typo/change away from not getting the right reason for the error. I tried to play with reflect but couldn't get it to do what I wanted. I was wondering if I was missing something obvious or if it was the go way? Or is it specific to the crypto/tls library to avoid recovering from any issue?</p>\n\n<p>Thanks for your help.</p>\n"}, {"tags": ["syntax", "go", "syntax-error"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1434696188, "post_id": 30929477, "comment_id": 49898499, "body": "Why does a C compiler complain if you omit the parentheses?"}], "answers": [{"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 0, "last_activity_date": 1434689951, "last_edit_date": 1592644375, "creation_date": 1434689951, "answer_id": 30930201, "question_id": 30929477, "link": "https://stackoverflow.com/questions/30929477/why-does-adding-parentheses-in-if-condition-results-in-compile-error/30930201#30930201", "title": "Why does adding parentheses in if condition results in compile error?", "body": "<p>Because that is how the Go syntax <a href=\"https://golang.org/ref/spec#If_statements\" rel=\"nofollow noreferrer\">defines</a> an <code>if</code> statement.</p>\n<blockquote>\n<p>IfStmt = &quot;if&quot; [ SimpleStmt &quot;;&quot; ] Expression Block [ &quot;else&quot; ( IfStmt |\nBlock ) ] .</p>\n</blockquote>\n<p>And from <a href=\"https://golang.org/doc/effective_go.html#formatting\" rel=\"nofollow noreferrer\">Effective Go</a>:</p>\n<blockquote>\n<p>Parentheses</p>\n<p>Go needs fewer parentheses than C and Java: control\nstructures (if, for, switch) do not have parentheses in their syntax.</p>\n</blockquote>\n<p><a href=\"https://golang.org/doc/effective_go.html#control-structures\" rel=\"nofollow noreferrer\">and</a>:</p>\n<blockquote>\n<p>Control structures</p>\n<p>The control structures of Go are related to those of C but differ in\nimportant ways. There is no do or while loop, only a slightly\ngeneralized for; switch is more flexible; if and switch accept an\noptional initialization statement like that of for; break and continue\nstatements take an optional label to identify what to break or\ncontinue; and there are new control structures including a type switch\nand a multiway communications multiplexer, select. <strong>The syntax is also\nslightly different: there are no parentheses and the bodies must\nalways be brace-delimited.</strong></p>\n</blockquote>\n<p>(Emphasis added)</p>\n"}, {"comments": [{"owner": {"reputation": 992, "user_id": 622447, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/bb6572086668338c73064c0d61ce9a8c?s=128&d=identicon&r=PG", "display_name": "Dmitri Shuralyov", "link": "https://stackoverflow.com/users/622447/dmitri-shuralyov"}, "edited": false, "score": 0, "creation_date": 1434916537, "post_id": 30930629, "comment_id": 49968912, "body": "You can still write <code>if j := 9; (j &gt; 0) { fmt.Println(j) }</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1434692500, "last_edit_date": 1434692500, "creation_date": 1434692170, "answer_id": 30930629, "question_id": 30929477, "link": "https://stackoverflow.com/questions/30929477/why-does-adding-parentheses-in-if-condition-results-in-compile-error/30930629#30930629", "title": "Why does adding parentheses in if condition results in compile error?", "body": "<p>The answer is not simply \"because Go doesn't need parentheses\"; see that the following example is a valid Go syntax:</p>\n\n<pre><code>j := 9\nif (j &gt; 0) {\n    fmt.Println(j)\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/ref/spec#If_statements\" rel=\"noreferrer\">Go Spec: If statements:</a></p>\n\n<pre><code>IfStmt = \"if\" [ SimpleStmt \";\" ] Expression Block [ \"else\" ( IfStmt | Block ) ] .\n</code></pre>\n\n<p>The difference between my example and yours is that my example only contains the Expression block. Expressions can be parenthesized as you want to (it will not be well formatted, but that is another question).</p>\n\n<p>In your example you specified both the Simple statement and the Expression block. If you put the whole into parentheses, the compiler will try to interpret the whole as the <a href=\"https://golang.org/ref/spec#Expression\" rel=\"noreferrer\">Expression Block to which this does not qualify</a>:</p>\n\n<pre><code>Expression = UnaryExpr | Expression binary_op UnaryExpr .\n</code></pre>\n\n<p><code>j &gt; 0</code> is a valid expression, <code>j := 9; j &gt; 0</code> is not a valid expression.</p>\n\n<p>Even <code>j := 9</code> in itself is not an expression, it is a <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"noreferrer\">Short variable declaration</a>. Moreover the simple assignment (e.g. <code>j = 9</code>) is not an expression in Go but a statement (<a href=\"https://golang.org/ref/spec#Assignments\" rel=\"noreferrer\">Spec: Assignments</a>). Note that assignment is usually an expression in other languages like C, Java etc.). This is the reason why for example the following code is also invalid:</p>\n\n<pre><code>x := 3\ny := (x = 4)\n</code></pre>\n"}], "owner": {"reputation": 14298, "user_id": 2106207, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/960430ab7aba908bb9aa62d530618a75?s=128&d=identicon&r=PG", "display_name": "Nan Xiao", "link": "https://stackoverflow.com/users/2106207/nan-xiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1058, "favorite_count": 0, "accepted_answer_id": 30930629, "answer_count": 2, "score": 0, "last_activity_date": 1434693161, "creation_date": 1434684568, "last_edit_date": 1434693161, "question_id": 30929477, "link": "https://stackoverflow.com/questions/30929477/why-does-adding-parentheses-in-if-condition-results-in-compile-error", "title": "Why does adding parentheses in if condition results in compile error?", "body": "<p>The following Go code runs OK:  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    if j := 9; j &gt; 0 {\n        fmt.Println(j)\n    }\n}\n</code></pre>\n\n<p>But after adding parentheses in condition:  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    if (j := 9; j &gt; 0) {\n        fmt.Println(j)\n    }\n}\n</code></pre>\n\n<p>There is compile error:  </p>\n\n<pre><code>.\\Hello.go:7: syntax error: unexpected :=, expecting )\n.\\Hello.go:11: syntax error: unexpected }\n</code></pre>\n\n<p>Why does the compiler complain about it?  </p>\n"}, {"tags": ["xml", "go", "marshalling"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1434725940, "post_id": 30928770, "comment_id": 49917609, "body": "<a href=\"https://golang.org/pkg/encoding/xml/#Marshal\" rel=\"nofollow noreferrer\">The documentation</a> says that <code>xml.Marshal</code> only works on arrays, slices, structs or pointers/interfaces of those and at the end states: &quot;Marshal will return an error if asked to marshal a channel, function, or map.&quot; You can implement the <a href=\"https://golang.org/pkg/encoding/xml/#Marshaler\" rel=\"nofollow noreferrer\"><code>xml.Marshaler</code></a> or <a href=\"https://golang.org/pkg/encoding/#TextMarshaler\" rel=\"nofollow noreferrer\"><code>encoding.TextMarshaler</code></a> on any other type (like a map) to specify how you&#39;d like it marshalled."}], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 0, "last_activity_date": 1434681912, "creation_date": 1434681912, "answer_id": 30929105, "question_id": 30928770, "link": "https://stackoverflow.com/questions/30928770/marshall-map-to-xml-in-go/30929105#30929105", "title": "Marshall map to XML in Go", "body": "<p>I suppose that because XML nodes is sequenced, but map is not. check <a href=\"https://golang.org/src/encoding/xml/marshal.go#L70\" rel=\"nofollow\">this</a>\n<code>\nMarshal handles an array or slice by marshalling each of the elements.\n</code></p>\n"}, {"comments": [{"owner": {"reputation": 2250, "user_id": 5832767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pk3M7.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5832767/tom"}, "edited": false, "score": 0, "creation_date": 1588167981, "post_id": 33110881, "comment_id": 108796023, "body": "nice solution, you could even shorten by doing directly <code>return e.Flush()</code> in the end"}, {"owner": {"reputation": 2250, "user_id": 5832767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pk3M7.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5832767/tom"}, "edited": false, "score": 0, "creation_date": 1588232038, "post_id": 33110881, "comment_id": 108821124, "body": "looks like I can do it  :)"}, {"owner": {"reputation": 985, "user_id": 1345639, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/65bf9f6495938e6dcad5300af72ba5f3?s=128&d=identicon&r=PG", "display_name": "Adam B", "link": "https://stackoverflow.com/users/1345639/adam-b"}, "reply_to_user": {"reputation": 2250, "user_id": 5832767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pk3M7.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5832767/tom"}, "edited": false, "score": 0, "creation_date": 1588238466, "post_id": 33110881, "comment_id": 108824239, "body": "Nice one. Now that you edited it the edit button is back. Strange..."}], "tags": [], "owner": {"reputation": 985, "user_id": 1345639, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/65bf9f6495938e6dcad5300af72ba5f3?s=128&d=identicon&r=PG", "display_name": "Adam B", "link": "https://stackoverflow.com/users/1345639/adam-b"}, "is_accepted": true, "score": 13, "last_activity_date": 1588231992, "last_edit_date": 1588231992, "creation_date": 1444763956, "answer_id": 33110881, "question_id": 30928770, "link": "https://stackoverflow.com/questions/30928770/marshall-map-to-xml-in-go/33110881#33110881", "title": "Marshall map to XML in Go", "body": "<p>I ended up solving this by using the xml.Marshaler as suggested by <a href=\"https://stackoverflow.com/users/55504/dave-c\">Dave C</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// StringMap is a map[string]string.\ntype StringMap map[string]string\n\n// StringMap marshals into XML.\nfunc (s StringMap) MarshalXML(e *xml.Encoder, start xml.StartElement) error {\n\n    tokens := []xml.Token{start}\n\n    for key, value := range s {\n        t := xml.StartElement{Name: xml.Name{\"\", key}}\n        tokens = append(tokens, t, xml.CharData(value), xml.EndElement{t.Name})\n    }\n\n    tokens = append(tokens, xml.EndElement{start.Name})\n\n    for _, t := range tokens {\n        err := e.EncodeToken(t)\n        if err != nil {\n            return err\n        }\n    }\n\n    // flush to ensure tokens are written\n    return e.Flush()\n}\n</code></pre>\n\n<p><sub>Source: <a href=\"https://gist.github.com/jackspirou/4477e37d1f1c043806e0\" rel=\"nofollow noreferrer\">https://gist.github.com/jackspirou/4477e37d1f1c043806e0</a></sub></p>\n\n<p>Now the map can be marshalled by simply calling </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>output, err := xml.MarshalIndent(data, \"\", \"  \")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1626, "user_id": 159762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03896e8a1ac27618c696edb9bb150365?s=128&d=identicon&r=PG", "display_name": "Leigh  McCulloch", "link": "https://stackoverflow.com/users/159762/leigh-mcculloch"}, "is_accepted": false, "score": 3, "last_activity_date": 1490506427, "last_edit_date": 1490506427, "creation_date": 1490506010, "answer_id": 43025351, "question_id": 30928770, "link": "https://stackoverflow.com/questions/30928770/marshall-map-to-xml-in-go/43025351#43025351", "title": "Marshall map to XML in Go", "body": "<p>You can marshal and unmarshal a map, but you need to write the custom MarshalXML and UnmarshalXML function for your map and give you map a type to attach those functions to.</p>\n\n<p>Here's an example that marshals and unmarshals where the key and the value in the map is a string. You can simply change the marshal of the value to int => string and back in the unmarshal:\n<a href=\"https://play.golang.org/p/4Z2C-GF0E7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4Z2C-GF0E7</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"io\"\n)\n\ntype Map map[string]string\n\ntype xmlMapEntry struct {\n    XMLName xml.Name\n    Value   string `xml:\",chardata\"`\n}\n\n// MarshalXML marshals the map to XML, with each key in the map being a\n// tag and it's corresponding value being it's contents.\nfunc (m Map) MarshalXML(e *xml.Encoder, start xml.StartElement) error {\n    if len(m) == 0 {\n        return nil\n    }\n\n    err := e.EncodeToken(start)\n    if err != nil {\n        return err\n    }\n\n    for k, v := range m {\n        e.Encode(xmlMapEntry{XMLName: xml.Name{Local: k}, Value: v})\n    }\n\n    return e.EncodeToken(start.End())\n}\n\n// UnmarshalXML unmarshals the XML into a map of string to strings,\n// creating a key in the map for each tag and setting it's value to the\n// tags contents.\n//\n// The fact this function is on the pointer of Map is important, so that\n// if m is nil it can be initialized, which is often the case if m is\n// nested in another xml structurel. This is also why the first thing done\n// on the first line is initialize it.\nfunc (m *Map) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    *m = Map{}\n    for {\n        var e xmlMapEntry\n\n        err := d.Decode(&amp;e)\n        if err == io.EOF {\n            break\n        } else if err != nil {\n            return err\n        }\n\n        (*m)[e.XMLName.Local] = e.Value\n    }\n    return nil\n}\n\nfunc main() {\n    // The Map\n    m := map[string]string{\n        \"key_1\": \"Value One\",\n        \"key_2\": \"Value Two\",\n    }\n    fmt.Println(m)\n\n    // Encode to XML\n    x, _ := xml.MarshalIndent(Map(m), \"\", \"  \")\n    fmt.Println(string(x))\n\n    // Decode back from XML\n    var rm map[string]string\n    xml.Unmarshal(x, (*Map)(&amp;rm))\n    fmt.Println(rm)\n}\n</code></pre>\n"}], "owner": {"reputation": 985, "user_id": 1345639, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/65bf9f6495938e6dcad5300af72ba5f3?s=128&d=identicon&r=PG", "display_name": "Adam B", "link": "https://stackoverflow.com/users/1345639/adam-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8535, "favorite_count": 5, "accepted_answer_id": 33110881, "answer_count": 3, "score": 7, "last_activity_date": 1588231992, "creation_date": 1434679416, "question_id": 30928770, "link": "https://stackoverflow.com/questions/30928770/marshall-map-to-xml-in-go", "title": "Marshall map to XML in Go", "body": "<p>I'm trying to output a map as XML data, however I receive the following error: </p>\n\n<pre><code>xml: unsupported type: map[string]int\n</code></pre>\n\n<p>Marshalling maps works fine for JSON so I don't get why it wouldn't work the same for XML. Is using a Struct really the only way?</p>\n"}, {"tags": ["xml", "go", "formatting", "date-formatting"], "comments": [{"owner": {"reputation": 3457, "user_id": 3108853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db3d997e8c35cb14623d4dc4de494801?s=128&d=identicon&r=PG&f=1", "display_name": "lsowen", "link": "https://stackoverflow.com/users/3108853/lsowen"}, "edited": false, "score": 0, "creation_date": 1434675917, "post_id": 30928306, "comment_id": 49892949, "body": "Could you include a specific example of the format you want?"}], "answers": [{"tags": [], "owner": {"reputation": 757, "user_id": 2083738, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/dYCwc.png?s=128&g=1", "display_name": "c4pone", "link": "https://stackoverflow.com/users/2083738/c4pone"}, "is_accepted": false, "score": 0, "last_activity_date": 1434676551, "creation_date": 1434676551, "answer_id": 30928403, "question_id": 30928306, "link": "https://stackoverflow.com/questions/30928306/how-to-serialize-a-custom-formatted-time-to-from-xml-in-go/30928403#30928403", "title": "How to serialize a custom formatted time to/from xml in Go?", "body": "<p>It depends how your format looks like, but a good starting point should be the time library. <a href=\"http://golang.org/pkg/time/\" rel=\"nofollow\">http://golang.org/pkg/time/</a></p>\n\n<pre><code>layout := \"2006-01-02T15:04:05.000Z\"\nstr := \"2014-11-12T11:45:26.371Z\"\nt, err := time.Parse(layout, str)\n\nif err != nil {\n    fmt.Println(err)\n}\nfmt.Println(t)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 2, "last_activity_date": 1434725627, "creation_date": 1434725627, "answer_id": 30941233, "question_id": 30928306, "link": "https://stackoverflow.com/questions/30928306/how-to-serialize-a-custom-formatted-time-to-from-xml-in-go/30941233#30941233", "title": "How to serialize a custom formatted time to/from xml in Go?", "body": "<p>Just as you'd implement <code>json.Marshaler</code> and <code>json.Unmarshaler</code> for doing this with JSON (there are many posts about that on StackOverflow and the internet);\none way is to implement a custom time type that implements <a href=\"https://golang.org/pkg/encoding/#TextMarshaler\" rel=\"nofollow\"><code>encoding.TextMarshaler</code></a> and <a href=\"https://golang.org/pkg/encoding/#TextUnmarshaler\" rel=\"nofollow\"><code>encoding.TextUnmarshaler</code></a>.</p>\n\n<p>Those interfaces are used by <code>encoding/xml</code> when encoding items (after first checking for the more specific <code>xml.Marshaler</code> or <code>xml.Unmarshaler</code> interfaces, however those later ones have to do full XML encoding themselves).</p>\n\n<p>E.g.\u00a0something like (<a href=\"https://play.golang.org/p/qgLIu2FbV9\" rel=\"nofollow\">full example on the <kbd>Go Playground</kbd></a>):</p>\n\n<pre><code>const fixedFormat = \"Mon Jan 02 2006\"\n\ntype myTime1 struct {\n    time.Time\n}\n\nfunc (m myTime1) MarshalText() ([]byte, error) {\n    text := m.Time.Format(fixedFormat)\n    return []byte(text), nil\n}\nfunc (m *myTime1) UnmarshalText(text []byte) error {\n    t, err := time.Parse(fixedFormat, string(text))\n    if err == nil {\n        m.Time = t\n    }\n    return err\n}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>type myTime2 time.Time\n\nfunc (m myTime2) MarshalText() ([]byte, error) {\n    text := time.Time(m2).Format(fixedFormat)\n    return []byte(text), nil\n}\nfunc (m *myTime2) UnmarshalText(text []byte) error {\n    t, err := time.Parse(fixedFormat, string(text))\n    if err == nil {\n        *m = myTime2(t)\n    }\n    return err\n}\n</code></pre>\n\n<p>Either of those can be used in place of <code>time.Time</code> as part of a larger data structure used with xml (un)marshalling. E.g.:</p>\n\n<pre><code>type Foo struct {\n    Date1 myTime1 `xml:\"date1\"`\n    Date2 myTime2 `xml:\"date2\"`\n}\n</code></pre>\n\n<p>The difference in how these custom time types are defined changes how you use them with regular <code>time.Time</code> values.\nE.g.</p>\n\n<pre><code>m1 := myTime1{time.Now()}\nfmt.Println(m1)\nif m1.Before(time.Now()) {}\nt1 := m1.Time\n// compared to:\nm2 := myTime2(time.Now())\nfmt.Println(time.Time(m2))\nif time.Time(m2).Before(time.Now()) {}\nt2 := time.Time(m2)\n</code></pre>\n"}], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "accepted_answer_id": 30941233, "answer_count": 2, "score": 0, "last_activity_date": 1434725627, "creation_date": 1434675602, "question_id": 30928306, "link": "https://stackoverflow.com/questions/30928306/how-to-serialize-a-custom-formatted-time-to-from-xml-in-go", "title": "How to serialize a custom formatted time to/from xml in Go?", "body": "<p>When serializing a datetime to/from xml how do I make it use a custom time format?</p>\n"}, {"tags": ["concurrency", "go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 3766, "user_id": 967100, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/lJq6z.jpg?s=128&g=1", "display_name": "Bruno Vieira", "link": "https://stackoverflow.com/users/967100/bruno-vieira"}, "edited": false, "score": 0, "creation_date": 1434693804, "post_id": 30930248, "comment_id": 49897481, "body": "Ok, I get now how wrong I understood the context concept. I&#39;m insisting on using <code>context.Context</code> however. I&#39;ll dig some more about it. Thanks for the article and the help"}], "tags": [], "owner": {"reputation": 1368, "user_id": 209516, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ECJPb.jpg?s=128&g=1", "display_name": "Nicolas Merouze", "link": "https://stackoverflow.com/users/209516/nicolas-merouze"}, "is_accepted": true, "score": 1, "last_activity_date": 1434690155, "creation_date": 1434690155, "answer_id": 30930248, "question_id": 30928002, "link": "https://stackoverflow.com/questions/30928002/correct-use-of-go-context-context/30930248#30930248", "title": "Correct use of go context.Context", "body": "<p>You have a problem with your code because you are storing the user into the app context. With multiple users at the same time, it doesn't work. The context must be related to the request to not be overwrote by other requests. The user must be stored in a request context. In my articles I use the following gorilla function: <code>context.Set(r, \"user\", user)</code>. <code>r</code> is the request.</p>\n\n<p>If you want to use <code>context.Context</code> in your app, you should use their gorilla wrapper (you can find it at the end of this article: <a href=\"https://blog.golang.org/context\" rel=\"nofollow\">https://blog.golang.org/context</a>).</p>\n\n<p>Also, you don't need a context with cancel. <code>context.Background()</code> is okay for the root context.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1466156889, "creation_date": 1466156889, "answer_id": 37878399, "question_id": 30928002, "link": "https://stackoverflow.com/questions/30928002/correct-use-of-go-context-context/37878399#37878399", "title": "Correct use of go context.Context", "body": "<p>Note: go 1.7.0-rc2 does clarify a bit <a href=\"https://github.com/golang/go/commit/c4692da9231c244a1275d42055e703b3f1dac25b\" rel=\"nofollow\">how to release resources associated with Contexts</a> (<a href=\"https://github.com/Sajmani\" rel=\"nofollow\">Sameer Ajmani</a>):</p>\n\n<blockquote>\n  <p><strong>Some users don't realize that creating a <code>Context</code> with a <code>CancelFunc</code> attaches a subtree to the parent, and that that subtree is not released until the <code>CancelFunc</code> is called or the parent is canceled</strong>.  </p>\n  \n  <p>Make this clear early in the package docs, so that people learning about this package have the right conceptual model.</p>\n</blockquote>\n\n<p>The <a href=\"https://github.com/golang/go/blob/c4692da9231c244a1275d42055e703b3f1dac25b/src/context/context.go#L9-L20\" rel=\"nofollow\">documentation now includes</a>:</p>\n\n<blockquote>\n  <p>Incoming requests to a server should create a <code>Context</code>, and outgoing calls to servers should accept a <code>Context</code>.<br>\n  The chain of function calls between them must propagate the <code>Context</code>, optionally replacing it with a derived <code>Context</code> created using <code>WithCancel</code>, <code>WithDeadline</code>, <code>WithTimeout</code>, or <code>WithValue</code>.<br>\n  <strong>These <code>Context</code> values form a tree: when a <code>Context</code> is canceled, all <code>Contexts</code> derived from it are also canceled</strong>.</p>\n  \n  <p>The <code>WithCancel</code>, <code>WithDeadline</code>, and <code>WithTimeout</code> functions return a derived <code>Context</code> and a <code>CancelFunc</code>.<br>\n  Calling the <code>CancelFunc</code> cancels the new <code>Context</code> and any Contexts derived from it, removes the <code>Context</code> from the parent's tree, and stops any associated timers.<br>\n  Failing to call the <code>CancelFunc</code> leaks the associated resources until the parent <code>Context</code> is canceled or the timer fires.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 835, "user_id": 4008473, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/bab2d01a5c2ce91bed8964aabf65527c?s=128&d=identicon&r=PG&f=1", "display_name": "user27111987", "link": "https://stackoverflow.com/users/4008473/user27111987"}, "is_accepted": false, "score": 0, "last_activity_date": 1577127578, "creation_date": 1577127578, "answer_id": 59460112, "question_id": 30928002, "link": "https://stackoverflow.com/questions/30928002/correct-use-of-go-context-context/59460112#59460112", "title": "Correct use of go context.Context", "body": "<p>Two major use cases of Context package are:</p>\n\n<ol>\n<li>For storing request scoped values - Using context.WithValue()</li>\n<li>For cancellation - using context.WithCancel(), context.WithTimeout(), context.WithDeadline()</li>\n</ol>\n\n<p>Use of context forms a context tree with context.Background() as root. WithValue() ,context.WithCancel(), WithTimeout(), WithDeadline() are derived context from root context which can be further divide. An example of each can make it clear so ast to what is the correct use context. Came across this guide which provides the use of all discussed above with proper examples.</p>\n\n<p>Source: <a href=\"https://golangbyexample.com/using-context-in-golang-complete-guide/\" rel=\"nofollow noreferrer\">https://golangbyexample.com/using-context-in-golang-complete-guide/</a></p>\n"}], "owner": {"reputation": 3766, "user_id": 967100, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/lJq6z.jpg?s=128&g=1", "display_name": "Bruno Vieira", "link": "https://stackoverflow.com/users/967100/bruno-vieira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3412, "favorite_count": 1, "accepted_answer_id": 30930248, "answer_count": 3, "score": 2, "last_activity_date": 1577127578, "creation_date": 1434673200, "question_id": 30928002, "link": "https://stackoverflow.com/questions/30928002/correct-use-of-go-context-context", "title": "Correct use of go context.Context", "body": "<p>I just read the article: <a href=\"http://nicolasmerouze.com/build-web-framework-golang/\" rel=\"nofollow\">Build You Own Web Framework In Go</a> and for sharing values among handlers I picked the <a href=\"http://golang.org/x/net/context\" rel=\"nofollow\">context.Context</a> and I'm using it in the following way to share values across handlers and middlewares:</p>\n\n<pre><code>type appContext struct {\n    db     *sql.DB\n    ctx    context.Context\n    cancel context.CancelFunc\n }\n\n\nfunc (c *appContext)authHandler(next http.Handler) http.Handler {\n    fn := func(w http.ResponseWriter, r *http.Request {\n        defer c.cancel() //this feels weird\n        authToken := r.Header.Get(\"Authorization\") // this fakes a form\n        c.ctx = getUser(c.ctx, c.db, authToken) // this also feels weird\n        next.ServeHTTP(w, r)\n    }\n\n    return http.HandlerFunc(fn)\n}\n\nfunc (c *appContext)adminHandler(w http.ResponseWriter, r *http.Request) {\n    defer c.cancel()\n    user := c.ctx.Value(0).(user)\n    json.NewEncoder(w).Encode(user)\n}\n\nfunc getUser(ctx context.Context, db *sql.DB, token string) context.Context{\n    //this function mimics a database access\n    return context.WithValue(ctx, 0, user{Nome:\"Default user\"})\n}\n\nfunc main() {\n    db, err := sql.Open(\"my-driver\", \"my.db\")\n    if err != nil {\n        panic(err)\n    }\n    ctx, cancel := context.WithCancel(context.Background())\n    appC := appContext{db, ctx, cancel}\n    //....\n}\n</code></pre>\n\n<p>Everything is working and handlers are loading faster than using gorilla/context So my questions are:</p>\n\n<ol>\n<li>Is this approach safe?</li>\n<li>Is it really necessary to defer the c.cancel() function the way I'm doing it?</li>\n<li>Can I use it to implement a custom web framework by using controllers like struct to share values with models? </li>\n</ol>\n"}, {"tags": ["go", "gob"], "answers": [{"comments": [{"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1468056209, "post_id": 30928402, "comment_id": 63979174, "body": "Why is it impossible? Is some of the data used when encoding lost when restarting, or is it just a missing api function?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1434676549, "creation_date": 1434676549, "answer_id": 30928402, "question_id": 30927993, "link": "https://stackoverflow.com/questions/30927993/append-to-golang-gob-in-a-file-on-disk/30928402#30928402", "title": "Append to golang gob in a file on disk", "body": "<p>It is not possible to reconstruct an Encoder with the state that some other Encoder had when writing a stream of gob values. If you cannot use the original Encoder when appending values, then you have a couple of options:</p>\n\n<ul>\n<li>Move the data over as you suggest.</li>\n<li>Use a framing mechanism to store multiple gob streams to the single file.  For example, you can prefix each gob stream with the length of that stream. </li>\n</ul>\n"}], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1115, "favorite_count": 0, "accepted_answer_id": 30928402, "answer_count": 1, "score": 2, "last_activity_date": 1434676549, "creation_date": 1434673137, "question_id": 30927993, "link": "https://stackoverflow.com/questions/30927993/append-to-golang-gob-in-a-file-on-disk", "title": "Append to golang gob in a file on disk", "body": "<p>I'm trying to save <code>gob</code>-encoded data in a file on disk as a simple datastore. However, when I open it next time the gob encoder just ignores whatever data is already in the file, and starts over sending definitions of already sent formats before sending data. Seeing that <code>gob.Encoder</code> takes an <code>io.Writer</code>, rather than an <code>io.ReadWriter</code>, this makes sense. The encoder has no idea what's in the file, because it cannot read from it.</p>\n\n<p>This is, however, quite inefficient. It's also unnecessarily hard to parse, since you have to reset the decoder each time the encoder restarted when writing to the file, since the gob type id's might've changed.</p>\n\n<p>How can I continue to write to the end of a file containing gob data? Do I have to create a new file, moving all data over so the gob encoder knows what types it already sent, or is there a way for me to tell the encoder what types it should know about already, or some other way? I need it to work across software restarts.</p>\n"}, {"tags": ["memory-leaks", "go", "profiling", "heap"], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 0, "last_activity_date": 1434673403, "creation_date": 1434673403, "answer_id": 30928034, "question_id": 30927359, "link": "https://stackoverflow.com/questions/30927359/dumping-heap-of-go-process-at-runtime/30928034#30928034", "title": "Dumping heap of Go process at runtime", "body": "<p>for now, you can use <a href=\"http://godoc.org/runtime/pprof\" rel=\"nofollow\">runtime</a> package to write heap profile to a file, and analyze it with <a href=\"https://code.google.com/p/gperftools/w/list\" rel=\"nofollow\">gpreftools</a> visualization tool.</p>\n"}], "owner": {"reputation": 7195, "user_id": 384954, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/eb7bd28bf9bee8c0f477c76c6effd84e?s=128&d=identicon&r=PG", "display_name": "OregonTrail", "link": "https://stackoverflow.com/users/384954/oregontrail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 897, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1434673403, "creation_date": 1434669156, "question_id": 30927359, "link": "https://stackoverflow.com/questions/30927359/dumping-heap-of-go-process-at-runtime", "title": "Dumping heap of Go process at runtime", "body": "<p>We have a <code>go</code> process in production using Gigabytes more memory than usual. It's suffered from an unusual memory leak. We stopped input to this process to allow the GC to settle. It is still running with a RES of multiple Gigabytes. Is there a way to attach to this process and dump heap in a way that can be analyzed using hprof visualization tools?  </p>\n"}, {"tags": ["php", "go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1434664533, "creation_date": 1434664533, "answer_id": 30926467, "question_id": 30926340, "link": "https://stackoverflow.com/questions/30926340/http-newrequest-not-sending-post-data/30926467#30926467", "title": "http.newRequest not sending post data", "body": "<p>You're posting the data as a form in the request body without a content type. You either need to put the values in the request query:</p>\n\n<pre><code>r.URL.RawQuery = data.Encode()\n</code></pre>\n\n<p>or change the Content-Type to \"application/x-www-form-urlencoded\":</p>\n\n<pre><code>r.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n</code></pre>\n"}], "owner": {"reputation": 653, "user_id": 4560325, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/--z_BcWF1Xxk/AAAAAAAAAAI/AAAAAAAAAHE/Acu0y0eCdlU/photo.jpg?sz=128", "display_name": "Moises Zerme&#241;o", "link": "https://stackoverflow.com/users/4560325/moises-zerme%c3%b1o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 30926467, "answer_count": 1, "score": 1, "last_activity_date": 1434664533, "creation_date": 1434663925, "question_id": 30926340, "link": "https://stackoverflow.com/questions/30926340/http-newrequest-not-sending-post-data", "title": "http.newRequest not sending post data", "body": "<p>I have the following code to send post data to a server, but the server is not detecting any post data on the request. Client code:</p>\n\n<pre><code>cookieJar, _ := cookiejar.New(nil)\n        client := &amp;http.Client{\n            Jar: cookieJar,\n        }\n        postUrl := os.Args[1]\n        username := os.Args[2]\n        password := os.Args[3]\n        data := url.Values{}\n        data.Set(\"username\", username)\n        data.Add(\"password\", password)\n        data.Add(\"remember\", \"false\")\n\n        r, _ := http.NewRequest(\"POST\", postUrl, bytes.NewBufferString(data.Encode()))\n        resp, _ := client.Do(r)\n        defer resp.Body.Close()\n        body, err := ioutil.ReadAll(resp.Body)\n        fmt.Printf(\"%s\\n\", string(body))\n</code></pre>\n\n<p>Server code:</p>\n\n<pre><code>if(isset($_POST['username'], $_POST['password'], $_POST['remember'])){\n    echo $username = md5(($_POST['username']));\n    echo $password_original = $_POST['password'];\n    echo $password = md5(($_POST['password']));\n    echo $remember = $_POST['remember'];\n}\n</code></pre>\n"}, {"tags": ["php", "go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 3, "creation_date": 1434659266, "post_id": 30924650, "comment_id": 49887161, "body": "Use <a href=\"https://godoc.org/net/http#Client\" rel=\"nofollow noreferrer\"><code>net&#47;http.Client</code></a> with a <a href=\"https://godoc.org/net/http/cookiejar\" rel=\"nofollow noreferrer\"><code>CookieJar</code> implementation</a>."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1434673607, "post_id": 30924650, "comment_id": 49892411, "body": "or not use cookie to identity the session, but others like url random"}], "owner": {"reputation": 653, "user_id": 4560325, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/--z_BcWF1Xxk/AAAAAAAAAAI/AAAAAAAAAHE/Acu0y0eCdlU/photo.jpg?sz=128", "display_name": "Moises Zerme&#241;o", "link": "https://stackoverflow.com/users/4560325/moises-zerme%c3%b1o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1434657445, "creation_date": 1434657445, "question_id": 30924650, "link": "https://stackoverflow.com/questions/30924650/get-phpsessid-after-login-with-a-desktop-client", "title": "Get phpsessid after login with a desktop client", "body": "<p>I have a webpage with a backend on php and I'm sending some data from a desktop client made with go, is there a way to do a get or post request and retrieve a phpsessid like if I were login from the webpage? also i must keep it for at least 5 minutes on the server</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1434656023, "post_id": 30924144, "comment_id": 49885223, "body": "Related: <a href=\"http://stackoverflow.com/questions/30725751/streaming-commands-output-progress\">Streaming commands output progress</a>"}, {"owner": {"reputation": 1428, "user_id": 851233, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0961e8831ab014e07196df63abd1fa15?s=128&d=identicon&r=PG&f=1", "display_name": "mrosales", "link": "https://stackoverflow.com/users/851233/mrosales"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1434659079, "post_id": 30924144, "comment_id": 49887066, "body": "@icza thanks for pointing me there, but unfortunately it does not help much. The person there has pretty much the same setup as I do. At first I thought the problem was that it couldn&#39;t read the newlines in my file, but the <code>scanner.Scan()</code> loop is executed once per line of the output, so the scan delimiter should work fine"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1434666498, "post_id": 30924144, "comment_id": 49890384, "body": "have you tried just connecting <code>cmd.StdoutPipe</code> to <code>os.Stdout</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 2080, "user_id": 673144, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/B41Mv.png?s=128&g=1", "display_name": "briiC", "link": "https://stackoverflow.com/users/673144/briic"}, "edited": false, "score": 1, "creation_date": 1484481405, "post_id": 30926984, "comment_id": 70519999, "body": "Thanks coming back and writing this answer after figuring it out! I was losing my mind for this! I was similar problem only with python script."}], "tags": [], "owner": {"reputation": 1428, "user_id": 851233, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0961e8831ab014e07196df63abd1fa15?s=128&d=identicon&r=PG&f=1", "display_name": "mrosales", "link": "https://stackoverflow.com/users/851233/mrosales"}, "is_accepted": true, "score": 6, "last_activity_date": 1434667015, "creation_date": 1434667015, "answer_id": 30926984, "question_id": 30924144, "link": "https://stackoverflow.com/questions/30924144/golang-pipe-output-of-subcommand-real-time/30926984#30926984", "title": "Golang pipe output of subcommand real time", "body": "<p>Turns out that the issue was not in the code I posted above. That works as expected. The problem was that the C program that was being executed was not properly flushing <code>stdout</code>. When running it interactively, it worked as expected, but when <code>stdout</code> was piped, it would not actually get written until I called <code>flush</code>. After manually adding some flush statements to the c program, the go code worked as expected.</p>\n"}], "owner": {"reputation": 1428, "user_id": 851233, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0961e8831ab014e07196df63abd1fa15?s=128&d=identicon&r=PG&f=1", "display_name": "mrosales", "link": "https://stackoverflow.com/users/851233/mrosales"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2449, "favorite_count": 1, "accepted_answer_id": 30926984, "answer_count": 1, "score": 3, "last_activity_date": 1434667015, "creation_date": 1434655785, "question_id": 30924144, "link": "https://stackoverflow.com/questions/30924144/golang-pipe-output-of-subcommand-real-time", "title": "Golang pipe output of subcommand real time", "body": "<p>I am trying to pipe the output of a command, but no data seems to be read from the pipe until the write end is closed. Eventually I want this to connect to a websocket that streams the status of a command while it is being executed. The problem is that while this code prints the messages line by line, it does not print anything until the program has finished executing.</p>\n\n<pre><code>cmd := exec.Command(MY_SCRIPT_LOCATION, args)\n\n// create a pipe for the output of the script\n// TODO pipe stderr too\ncmdReader, err := cmd.StdoutPipe()\nif err != nil {\n    fmt.Fprintln(os.Stderr, \"Error creating StdoutPipe for Cmd\", err)\n    return\n}\n\nscanner := bufio.NewScanner(cmdReader)\ngo func() {\n    for scanner.Scan() {\n        fmt.Printf(\"\\t &gt; %s\\n\", scanner.Text())\n    }\n}()\n\nerr = cmd.Start()\nif err != nil {\n    fmt.Fprintln(os.Stderr, \"Error starting Cmd\", err)\n    return\n}\n\nerr = cmd.Wait()\nif err != nil {\n    fmt.Fprintln(os.Stderr, \"Error waiting for Cmd\", err)\n    return\n}\n</code></pre>\n\n<p>Is there any way I can do something similar and have a scanner actually read line by line as it is written to the pipe instead of after everything has been written? The program takes about 20 seconds to run, and there is a steady stream of updates, so it is annoying to have them all go through at once.</p>\n"}, {"tags": ["go", "docker", "skydns"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1434656777, "last_edit_date": 1434656777, "creation_date": 1434654804, "answer_id": 30923845, "question_id": 30922834, "link": "https://stackoverflow.com/questions/30922834/golang-failes-to-change-the-name-of-imported-module/30923845#30923845", "title": "Golang failes to change the name of imported module", "body": "<p>The Go compiler doesn't replace or rewrite anything, the code is just wrong. The <code>github.com/rcrowley/go-metrics/influxdb</code> package was written with some other influxdb client code that no longer exists. (Looks like there are a couple github issues open about this already)</p>\n\n<p>If you look at the current <a href=\"http://godoc.org/github.com/influxdb/influxdb/client\" rel=\"nofollow\">influxdb/client</a> package, you'll see there's no <code>Series</code>, <code>ClientConfig</code>, or <code>Client.WriteSeries</code> at all. You'll need to drop the dependency on <code>github.com/rcrowley/go-metrics/influxdb</code> in order to get your project to build.</p>\n"}], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 30923845, "answer_count": 1, "score": 0, "last_activity_date": 1434656777, "creation_date": 1434651490, "question_id": 30922834, "link": "https://stackoverflow.com/questions/30922834/golang-failes-to-change-the-name-of-imported-module", "title": "Golang failes to change the name of imported module", "body": "<p>I'm trying to bring <a href=\"https://github.com/skynetservices/skydns1\" rel=\"nofollow\">SkyDNSv1</a> back to life and build it from my fork (here is <a href=\"https://github.com/vitalyisaev2/skydns1/blob/master/Dockerfile\" rel=\"nofollow\">Dockerfile</a>). SkyDNS was really good and simple tool for the quick service discovery, but it wasn't updated for a long time.</p>\n\n<p>There is an error in build process and it's caused by third party library. I cannot figure out why does it happen:</p>\n\n<pre><code>$ docker build --no-cache -t skydns1 .\nSending build context to Docker daemon 1.566 MB\nSending build context to Docker daemon \nStep 0 : FROM golang:1.4.2\n ---&gt; 3e8cb8e0c765\nStep 1 : WORKDIR /go/src\n ---&gt; Running in 3a06cf460ad9\n ---&gt; 1dd14a099164\nRemoving intermediate container 3a06cf460ad9\nStep 2 : RUN go get github.com/codegangsta/cli\n ---&gt; Running in eabcfd6fe621\n ---&gt; c9ea222f2d74\nRemoving intermediate container eabcfd6fe621\nStep 3 : RUN go get github.com/vitalyisaev2/skydns1\n ---&gt; Running in 3264582b2e7a\n# github.com/rcrowley/go-metrics/influxdb\ngithub.com/rcrowley/go-metrics/influxdb/influxdb.go:19: undefined: client.ClientConfig\ngithub.com/rcrowley/go-metrics/influxdb/influxdb.go:38: undefined: client.Series\ngithub.com/rcrowley/go-metrics/influxdb/influxdb.go:44: undefined: client.Series\ngithub.com/rcrowley/go-metrics/influxdb/influxdb.go:52: undefined: client.Series\ngithub.com/rcrowley/go-metrics/influxdb/influxdb.go:60: undefined: client.Series\ngithub.com/rcrowley/go-metrics/influxdb/influxdb.go:70: undefined: client.Series\ngithub.com/rcrowley/go-metrics/influxdb/influxdb.go:82: undefined: client.Series\ngithub.com/rcrowley/go-metrics/influxdb/influxdb.go:93: undefined: client.Series\ngithub.com/rcrowley/go-metrics/influxdb/influxdb.go:106: client.WriteSeries undefined (type *client.Client has no field or method WriteSeries)\nINFO[0075] The command [/bin/sh -c go get github.com/vitalyisaev2/skydns1] returned a non-zero code: \n</code></pre>\n\n<p>But if you look through the <a href=\"https://github.com/rcrowley/go-metrics/blob/master/influxdb/influxdb.go#L5\" rel=\"nofollow\">file</a> causing this error, you'll notice that Golang is confused about <code>influxdb/client</code>. <strong>I think that compiler doesn't replace imported name <code>client</code> with <code>influxClient</code> as it should do:</strong></p>\n\n<pre><code>package influxdb\n\nimport (\n    \"fmt\"\n    influxClient \"github.com/influxdb/influxdb/client\"\n    \"github.com/rcrowley/go-metrics\"\n    \"log\"\n    \"time\"\n) \n</code></pre>\n\n<p>Probably I just missing an obvious mistake. Any help will be appreciated.</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "edited": false, "score": 0, "creation_date": 1434642278, "post_id": 30919986, "comment_id": 49877071, "body": "Remove all the code that does not contribute to the error case."}], "answers": [{"comments": [{"owner": {"reputation": 180, "user_id": 3790925, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/49393aac523699a780663ce523c109aa?s=128&d=identicon&r=PG&f=1", "display_name": "jisaw", "link": "https://stackoverflow.com/users/3790925/jisaw"}, "edited": false, "score": 0, "creation_date": 1434648515, "post_id": 30920286, "comment_id": 49880735, "body": "I was having the issues with the /articles/2 end point before I started using the go-errors package. Also, when I make the changes to checkErr I got <code># command-line-arguments .\\main.go:37: cannot refer to unexported name errors.errorString .\\main.go:37: undefined: &quot;github.com&#47;go-errors&#47;errors&quot;.errorString</code>"}], "tags": [], "owner": {"reputation": 4195, "user_id": 2432477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a516bc16804edd78d8f6c2a7e06f07b?s=128&d=identicon&r=PG&f=1", "display_name": "nouney", "link": "https://stackoverflow.com/users/2432477/nouney"}, "is_accepted": false, "score": 2, "last_activity_date": 1434643062, "creation_date": 1434643062, "answer_id": 30920286, "question_id": 30919986, "link": "https://stackoverflow.com/questions/30919986/get-articles-article-id-not-working-gin-gonic-gin/30920286#30920286", "title": "GET /articles/:article_id Not working Gin-Gonic/Gin", "body": "<p>The stacktrace is explicit: <code>interface conversion: error is *errors.errorString, not *errors.Error</code>.</p>\n\n<p>So in <code>checkErr()</code>, the type assertion on <code>err</code> is wrong.</p>\n\n<p>Here is the solution:</p>\n\n<pre><code>func checkErr(err error, msg string) {\n    if err != nil {\n        log.Fatalln(msg, err.(*errors.errorString).ErrorStack())\n    }\n}\n</code></pre>\n\n<p>If you need to understand why you are getting this <code>panic</code>, I'd suggest you to read the <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">Golang specs about type assertions</a>.</p>\n"}], "owner": {"reputation": 180, "user_id": 3790925, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/49393aac523699a780663ce523c109aa?s=128&d=identicon&r=PG&f=1", "display_name": "jisaw", "link": "https://stackoverflow.com/users/3790925/jisaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1020, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1490875097, "creation_date": 1434642206, "last_edit_date": 1490875097, "question_id": 30919986, "link": "https://stackoverflow.com/questions/30919986/get-articles-article-id-not-working-gin-gonic-gin", "title": "GET /articles/:article_id Not working Gin-Gonic/Gin", "body": "<p>I am working on an API and GET and POST are working fine except when I try and get a select record by its ID (e.g. /articles/2). The article exists and when retrieving all records via the /articles route I get a proper response. Here is the stack trace.</p>\n\n<pre><code>    $ go run main.go\n    [GIN-debug] [WARNING] Running in \"debug\" mode. Switch to \"release\" mode in production.\n    - using env:   export GIN_MODE=release\n    - using code:  gin.SetMode(gin.ReleaseMode)\n\n    [GIN-debug] GET   /                         --&gt; main.index (3 handlers)\n    [GIN-debug] GET   /articles                 --&gt; main.ArticlesList (3 handlers)\n    [GIN-debug] POST  /articles                 --&gt; main.ArticlePost (3 handlers)\n    [GIN-debug] GET   /articles/:article_id     --&gt; main.ArticlesDetail (3 handlers)\n    [GIN-debug] Listening and serving HTTP on :8000\n    2015/06/18 10:31:49 Panic recovery -&gt; interface conversion: error is *errors.errorString, not *errors.Error\n    c:/go/src/runtime/panic.go:387 (0x4114b6)\n            gopanic: reflectcall(unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))\n    c:/go/src/runtime/iface.go:181 (0x40ae1a)\n            assertI2T: panic(&amp;TypeAssertionError{*tab.inter.typ._string, *tab._type._string, *t._string, \"\"})\n    c:/Users/Fresh/go/src/github.com/jisaw/portfolio-server/main.go:37 (0x401261)\n            checkErr: log.Fatalln(msg, err.(*errors.Error).ErrorStack())\n    c:/Users/Fresh/go/src/github.com/jisaw/portfolio-server/main.go:97 (0x401e2c)\n            getArticle: checkErr(err, \"selectOne failed\")\n    c:/Users/Fresh/go/src/github.com/jisaw/portfolio-server/main.go:60 (0x4016a7)\n            ArticlesDetail: article := getArticle(a_id)\n    c:/Users/Fresh/go/src/github.com/gin-gonic/gin/context.go:86 (0x43694a)\n            (*Context).Next: c.handlers[c.index](c)\n    c:/Users/Fresh/go/src/github.com/gin-gonic/gin/logger.go:56 (0x442ff0)\n            func.007: c.Next()\n    c:/Users/Fresh/go/src/github.com/gin-gonic/gin/context.go:86 (0x43694a)\n            (*Context).Next: c.handlers[c.index](c)\n    c:/Users/Fresh/go/src/github.com/gin-gonic/gin/recovery.go:43 (0x4437e0)\n            func.009: c.Next()\n    c:/Users/Fresh/go/src/github.com/gin-gonic/gin/context.go:86 (0x43694a)\n            (*Context).Next: c.handlers[c.index](c)\n    c:/Users/Fresh/go/src/github.com/gin-gonic/gin/gin.go:249 (0x43b275)\n            (*Engine).handleHTTPRequest: context.Next()\n    c:/Users/Fresh/go/src/github.com/gin-gonic/gin/gin.go:230 (0x43aff9)\n            (*Engine).ServeHTTP: engine.handleHTTPRequest(c)\n    c:/go/src/net/http/server.go:1703 (0x4ad385)\n            serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)\n    c:/go/src/net/http/server.go:1204 (0x4ab378)\n            (*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)\n    c:/go/src/runtime/asm_386.s:2287 (0x435c01)\n            goexit:\n</code></pre>\n\n<p>And the Code</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gin-gonic/gin\"\n    \"database/sql\"\n    \"github.com/coopernurse/gorp\"\n    _ \"github.com/mattn/go-sqlite3\"\n    \"log\"\n    \"time\"\n    \"strconv\"\n    \"github.com/go-errors/errors\"\n)\n\ntype Article struct {\n    Id int64 `db:\"article_id\"`\n    Created int64\n    Title string\n    Content string\n}\n\nvar dbmap = initDb()\n\nfunc initDb() gorp.DbMap {\n    db, err := sql.Open(\"sqlite3\", \"db.sqlite3\")\n    checkErr(err, \"sql.Open faild\")\n    dbmap := gorp.DbMap{Db: db, Dialect: gorp.SqliteDialect{}}\n    dbmap.AddTableWithName(Article{}, \"articles\").SetKeys(true, \"Id\")\n    err = dbmap.CreateTablesIfNotExists()\n    checkErr(err, \"Create tables failed\")\n    return dbmap\n}\n\nfunc checkErr(err error, msg string) {\n    if err != nil {\n        log.Fatalln(msg, err.(*errors.Error).ErrorStack())\n    }\n}\n\nfunc index (c *gin.Context) {\n    content := gin.H{\"Hello\": \"World\"}\n    c.JSON(200, content)\n}\n\nfunc ArticlesList(c *gin.Context) {\n    var articles []Article\n    _, err := dbmap.Select(&amp;articles, \"select * from articles order by article_id\")\n    checkErr(err, \"Select failed\")\n    content := gin.H{}\n    for k, v := range articles {\n        content[strconv.Itoa(k)] =v\n    }\n    c.JSON(200, content)\n}\n\nfunc ArticlesDetail(c *gin.Context) {\n    article_id := c.Params.ByName(\"id\")\n    a_id, _ := strconv.Atoi(article_id)\n    article := getArticle(a_id)\n    content := gin.H{\"title\": article.Title, \"content\": article.Content}\n    c.JSON(200, content)\n}\n\nfunc ArticlePost(c *gin.Context) {\n    var json Article\n\n    c.Bind(&amp;json)\n    article := createArticle(json.Title, json.Content)\n    if article.Title == json.Title {\n        content := gin.H{\n            \"result\": \"Success\",\n            \"title\": article.Title,\n            \"content\": article.Content,\n        }\n        c.JSON(201, content)\n    } else {\n        c.JSON(500, gin.H{\"result\": \"An error occured\"})\n    }\n}\n\nfunc createArticle(title, body string) Article {\n    article := Article{\n        Created: time.Now().UnixNano(),\n        Title: title,\n        Content: body,\n    }\n\n    err := dbmap.Insert(&amp;article)\n    checkErr(err, \"Insert failed\")\n    return article\n}\n\nfunc getArticle(article_id int) Article {\n    article := Article{}\n    err := dbmap.SelectOne(&amp;article, \"select * from articles where article_id=?\", article_id)\n    checkErr(err, \"selectOne failed\")\n    return article\n}\n\nfunc main() {\n    app := gin.Default()\n    app.GET(\"/\", index)\n    app.GET(\"/articles\", ArticlesList)\n    app.POST(\"/articles\", ArticlePost)\n    app.GET(\"/articles/:article_id\", ArticlesDetail)\n    app.Run(\":8000\")\n}\n</code></pre>\n"}, {"tags": ["struct", "go", "aes"], "comments": [{"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1434642080, "post_id": 30919448, "comment_id": 49876942, "body": "I would not recommend to bother with custom JSON decoding handler but simply create a new struct instance as <code>Secrets{aesDecrypt(s.Username, key), aesDecrypt(s.Password, key)}</code> where <code>s</code> is the struct that is loaded from JSON. Or the key idea is to make it in one &quot;operation&quot;?"}, {"owner": {"reputation": 881, "user_id": 405135, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0aa9058437e39aeae0b3b8db0eb41d5f?s=128&d=identicon&r=PG", "display_name": "Shreyans", "link": "https://stackoverflow.com/users/405135/shreyans"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1434662120, "post_id": 30919448, "comment_id": 49888590, "body": "I don&#39;t care about doing this in one operation, but I would like to do this without having to repeat the json key or the field names."}, {"owner": {"reputation": 881, "user_id": 405135, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0aa9058437e39aeae0b3b8db0eb41d5f?s=128&d=identicon&r=PG", "display_name": "Shreyans", "link": "https://stackoverflow.com/users/405135/shreyans"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1434754821, "post_id": 30919448, "comment_id": 49931190, "body": "Would be great if downvoting and marking to close were accompanied by a reason. Would probably help the community improve. That said, surprising that either action were taken as this seems like a reasonable question involving programming that others might ask and find useful."}], "answers": [{"comments": [{"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1434643804, "post_id": 30920314, "comment_id": 49878078, "body": "This seems convenient, but I think the main challenge in your example is how to be able to provide a custom key for every call to <code>json.Unmarshal()</code>. This is something that is different from the usual unmarshaling scenario, where output depends solely on JSON data input."}, {"owner": {"reputation": 7084, "user_id": 640277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f57fec5c9a807c0eeff896afb5ad86?s=128&d=identicon&r=PG", "display_name": "Ezra", "link": "https://stackoverflow.com/users/640277/ezra"}, "reply_to_user": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1434644241, "post_id": 30920314, "comment_id": 49878343, "body": "@tomasz: Great point. I agree completely that that&#39;s an issue. I was illustrating the <code>Unmarshal</code> code, and consider the handling of keys and actual decryption orthogonal to the question. I don&#39;t think it would be difficult to address in any &quot;real&quot; code. Depending on the requirements, of course."}, {"owner": {"reputation": 881, "user_id": 405135, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0aa9058437e39aeae0b3b8db0eb41d5f?s=128&d=identicon&r=PG", "display_name": "Shreyans", "link": "https://stackoverflow.com/users/405135/shreyans"}, "edited": false, "score": 0, "creation_date": 1434644629, "post_id": 30920314, "comment_id": 49878550, "body": "I like the second approach because it removes the need to type out the json key name a second time. thanks!"}, {"owner": {"reputation": 881, "user_id": 405135, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0aa9058437e39aeae0b3b8db0eb41d5f?s=128&d=identicon&r=PG", "display_name": "Shreyans", "link": "https://stackoverflow.com/users/405135/shreyans"}, "edited": false, "score": 0, "creation_date": 1434662624, "post_id": 30920314, "comment_id": 49888789, "body": "@Ezra sorry I &quot;unaccepted&quot; the answer because thinking more about it - I think it&#39;s important to not have to repeat the json keys or the field names. As the number of secrets grows, this starts to be a lot of duplicated names, and more chances for errors. Open to discuss, of course. Generally I&#39;m curious what the best way is to handle encrypted secrets in Go."}, {"owner": {"reputation": 7084, "user_id": 640277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f57fec5c9a807c0eeff896afb5ad86?s=128&d=identicon&r=PG", "display_name": "Ezra", "link": "https://stackoverflow.com/users/640277/ezra"}, "edited": false, "score": 0, "creation_date": 1434730080, "post_id": 30920314, "comment_id": 49920219, "body": "I&#39;m not sure I understand. If you implement <code>Unmarshaler</code> as in (1), the only code you&#39;d need for any additional secret is (at most) <code>json.Unmarshal(jj, &amp;ss)</code>. It&#39;s impossible to reference them less than zero times for each additional item\u2014I&#39;m not sure what you&#39;re looking for. Good luck finding it! Cheers,"}, {"owner": {"reputation": 881, "user_id": 405135, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0aa9058437e39aeae0b3b8db0eb41d5f?s=128&d=identicon&r=PG", "display_name": "Shreyans", "link": "https://stackoverflow.com/users/405135/shreyans"}, "edited": false, "score": 0, "creation_date": 1434824557, "post_id": 30920314, "comment_id": 49947556, "body": "@Ezra towards the bottom of solution (1), within <code>UnmarshalJSON</code> you have to retype the struct value name, as well as the json key, once for each field - a great place to find bugs."}, {"owner": {"reputation": 881, "user_id": 405135, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0aa9058437e39aeae0b3b8db0eb41d5f?s=128&d=identicon&r=PG", "display_name": "Shreyans", "link": "https://stackoverflow.com/users/405135/shreyans"}, "edited": false, "score": 0, "creation_date": 1434824643, "post_id": 30920314, "comment_id": 49947578, "body": "@Ezra, in fact the code snippet above has exactly this kind of bug in it: `    ss.Username = aesDecrypt(&quot;my key&quot;, *objmap[&quot;password&quot;])`. The struct value name is mismatched with the json key.  In a few languages (e.g. Python) it would be possible to apply a transformation to all the key/value pairs in the object, without having to type out each key/value pair. I&#39;d like to find a way to do this in Go."}], "tags": [], "owner": {"reputation": 7084, "user_id": 640277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f57fec5c9a807c0eeff896afb5ad86?s=128&d=identicon&r=PG", "display_name": "Ezra", "link": "https://stackoverflow.com/users/640277/ezra"}, "is_accepted": true, "score": 2, "last_activity_date": 1434644407, "last_edit_date": 1434644407, "creation_date": 1434643142, "answer_id": 30920314, "question_id": 30919448, "link": "https://stackoverflow.com/questions/30919448/transforming-strings-in-a-golang-struct/30920314#30920314", "title": "transforming strings in a golang struct", "body": "<p>One option is to define a custom JSON Unmarshaler. Another is, as you mention, copy it to another struct.</p>\n\n<ol>\n<li><h2>Implementing the Unmarshaler interface</h2>\n\n<p>The key insight is knowing that you can override <code>json.Unmarshal</code>'s\nbehaviour by implementing <a href=\"http://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow\">the Unmarshaler interface</a>. In our\ncase, that means defining a function <code>func (ss *Secrets)\nUnmarshalJSON(bb []byte) error</code> that will do the AES Decryption when\nyou try to unmarshal any JSON to a <code>Secrets</code>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"encoding/json\"\n\ntype Secrets struct {\n    Username string `json:\"username\"`\n    Password string `json:\"password\"`\n}\n\nfunc main() {\n    jj := []byte(`{\n        \"username\": \"asdf123ASLdf3\",\n        \"password\": \"elisjdvo4etQW\"\n    }`)\n    var ss Secrets\n    json.Unmarshal(jj, &amp;ss)\n    fmt.Println(ss)\n}\n\nfunc aesDecrypt(key, value string) string {\n    return fmt.Sprintf(\"'%s' decrypted with key '%s'\", value, key)\n}\n\nfunc (ss *Secrets) UnmarshalJSON(bb []byte) error {\n    var objmap map[string]*string\n    err := json.Unmarshal(bb, &amp;objmap)\n    ss.Username = aesDecrypt(\"my key\", *objmap[\"password\"])\n    ss.Password = aesDecrypt(\"my key\", *objmap[\"username\"])\n    return err\n}\n</code></pre>\n\n<p>This outputs a <code>Secrets</code> struct:</p>\n\n<pre><code>{'elisjdvo4etQW' decrypted with key 'my key'\n 'asdf123ASLdf3' decrypted with key 'my key'}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/rhJxGIKqpI\" rel=\"nofollow\">See it in action at the Go Playground.</a></p></li>\n<li><h2>Copying to another struct</h2>\n\n<p>You could simply make a new <code>Secrets</code> struct every time you need to\ndecrypt the JSON. This could be tedious if you do it alot, or if you\nhave no need for the intermediate state.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"encoding/json\"\n\ntype Secrets struct {\n    Username string `json:\"username\"`\n    Password string `json:\"password\"`\n}\n\nfunc main() {\n    jj := []byte(`{\n        \"username\": \"asdf123ASLdf3\",\n        \"password\": \"elisjdvo4etQW\"\n    }`)\n    var ss Secrets\n    json.Unmarshal(jj, &amp;ss)\n    decoded := Secrets{\n        aesDecrypt(ss.Username, \"my key\"),\n        aesDecrypt(ss.Password, \"my key\")}\n    fmt.Println(decoded)\n}\n\nfunc aesDecrypt(key, value string) string {\n    return fmt.Sprintf(\"'%s' decrypted with key '%s'\", value, key)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/sXyR4em4oe\" rel=\"nofollow\">Check it out at Go Playground.</a></p>\n\n<p>This has the same output as above:</p>\n\n<pre><code>{'elisjdvo4etQW' decrypted with key 'my key'\n 'asdf123ASLdf3' decrypted with key 'my key'}\n</code></pre></li>\n</ol>\n\n<p>Obviously, you would use a different version of <code>aesDecrypt</code>, mine's\njust a dummy. And, as always, you should actually be checking the\nreturned errors in your own code.</p>\n"}], "owner": {"reputation": 881, "user_id": 405135, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0aa9058437e39aeae0b3b8db0eb41d5f?s=128&d=identicon&r=PG", "display_name": "Shreyans", "link": "https://stackoverflow.com/users/405135/shreyans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 750, "favorite_count": 1, "accepted_answer_id": 30920314, "answer_count": 1, "score": -2, "last_activity_date": 1434662518, "creation_date": 1434640763, "last_edit_date": 1434662518, "question_id": 30919448, "link": "https://stackoverflow.com/questions/30919448/transforming-strings-in-a-golang-struct", "title": "transforming strings in a golang struct", "body": "<p>I've got a json file of AES encrypted secrets. The structure is:</p>\n\n<pre><code>{\n    \"username\": \"asdf123ASLdf3\",\n    \"password\": \"elisjdvo4etQW\"\n}\n</code></pre>\n\n<p>And a struct to hold these values</p>\n\n<pre><code>type Secrets struct {\n    Username string `json:\"username\"`\n    Password string `json:\"password\"`\n}\n</code></pre>\n\n<p>It's easy to load the encrypted json values into the struct, but what I really want is a struct with the unencrypted values.</p>\n\n<p>So, for each value, I'd like to run it though a function:</p>\n\n<p><code>aesDecrypt(key string, value string) string</code></p>\n\n<p>I'm happy to have this done on the first load, or to move everything over into a new struct.</p>\n\n<p>I would like to avoid repeating the json keys or the field names.</p>\n\n<p>What's the best way to do this?</p>\n\n<p>(Also open to other ways to manage encrypted secrets in Go)</p>\n"}, {"tags": ["windows", "powershell", "batch-file", "go"], "comments": [{"owner": {"reputation": 18017, "user_id": 1627055, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/yDnmH.jpg?s=128&g=1", "display_name": "Vesper", "link": "https://stackoverflow.com/users/1627055/vesper"}, "edited": false, "score": 0, "creation_date": 1434635850, "post_id": 30917132, "comment_id": 49872048, "body": "I see that &quot;bytes free&quot; counter is not changed between the two <code>dir</code> commands, while it should, as there were three files in the folder after running Powershell, and two after running Go. Therefore the file was created, although it&#39;s either not visible (check <code>attrib -r -h -s c:\\users\\tom\\whoami.txt</code>) or is located elsewhere. Please search for the file(s) with name containing <code>whoami</code> after you run go command, probably there is an issue with permissions on the file, or folder redirection."}, {"owner": {"reputation": 71, "user_id": 5023934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2850e0c8409560edc4c2d5875fe5ebac?s=128&d=identicon&r=PG", "display_name": "Peter Moore", "link": "https://stackoverflow.com/users/5023934/peter-moore"}, "reply_to_user": {"reputation": 18017, "user_id": 1627055, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/yDnmH.jpg?s=128&g=1", "display_name": "Vesper", "link": "https://stackoverflow.com/users/1627055/vesper"}, "edited": false, "score": 1, "creation_date": 1434637889, "post_id": 30917132, "comment_id": 49873779, "body": "Thanks Vesper, this was a good idea. Unfortunately it is not the reason; the <code>attrib</code> command returned <code>File not found</code> and the file did not turn up in a search. I then did a quick test and created some small files, and the <code>bytes free</code> also did not change when running <code>dir</code> - so I think that might be a red herring. I guess <code>bytes free</code> is not always immediately updated."}, {"owner": {"reputation": 22536, "user_id": 1683264, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1775f6311d777e21ee2c59df9769e60b?s=128&d=identicon&r=PG", "display_name": "rojo", "link": "https://stackoverflow.com/users/1683264/rojo"}, "edited": false, "score": 0, "creation_date": 1434643663, "post_id": 30917132, "comment_id": 49877980, "body": "Could it be that the scope of <code>go</code> makes PowerShell forget that .bat scripts are associated with <code>cmd &#47;c</code>, whereas PowerShell invoked within a batch script maintains the association? Does it make any difference if you <code>Start-Process cmd.exe &quot;&#47;c c:\\stackoverflow\\whoami.bat&quot; -otherargs</code>?  If not, does it make any difference to insert <code>set-executionpolicy remotesigned</code> at the top of demo.ps1?"}, {"owner": {"reputation": 71, "user_id": 5023934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2850e0c8409560edc4c2d5875fe5ebac?s=128&d=identicon&r=PG", "display_name": "Peter Moore", "link": "https://stackoverflow.com/users/5023934/peter-moore"}, "edited": false, "score": 0, "creation_date": 1434644754, "post_id": 30917132, "comment_id": 49878622, "body": "Many thanks rojo, I tried both these suggestions, but unfortunately neither fixed it, and I still get the same results. I also experimented having a batch script to call Powershell, and then invoking the batch script from go rather than Powershell directly, but that also did not fix it. Thanks for you suggestion though."}, {"owner": {"reputation": 6608, "user_id": 2100227, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/uzsFd.png?s=128&g=1", "display_name": "Eris", "link": "https://stackoverflow.com/users/2100227/eris"}, "edited": false, "score": 0, "creation_date": 1435354525, "post_id": 30917132, "comment_id": 50183296, "body": "To clarify, the powershell cmdlets in the demo.ps1 execute correctly, but some part of the Start-Process and/or batch file does not?"}, {"owner": {"reputation": 6608, "user_id": 2100227, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/uzsFd.png?s=128&g=1", "display_name": "Eris", "link": "https://stackoverflow.com/users/2100227/eris"}, "edited": false, "score": 0, "creation_date": 1435357226, "post_id": 30917132, "comment_id": 50184149, "body": "Also, do you have any extra folders in <code>C:\\Users</code>? I&#39;m noticing that when I run the script, it creates a <code>C:\\Users\\Tom.MyHostname</code>"}, {"owner": {"reputation": 71, "user_id": 5023934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2850e0c8409560edc4c2d5875fe5ebac?s=128&d=identicon&r=PG", "display_name": "Peter Moore", "link": "https://stackoverflow.com/users/5023934/peter-moore"}, "edited": false, "score": 0, "creation_date": 1435485475, "post_id": 30917132, "comment_id": 50212371, "body": "Eris, to clarify the problem: demo.ps1 is called from demo.bat and also from demo.go. In both cases it executes. When called from demo.bat it generates 3 files, when called from demo.go it generates only 2. Above I present the output from invoking the powershell both ways, so you can see the difference in results. Hope this helps. Many thanks again for your time and assistance."}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 5023934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2850e0c8409560edc4c2d5875fe5ebac?s=128&d=identicon&r=PG", "display_name": "Peter Moore", "link": "https://stackoverflow.com/users/5023934/peter-moore"}, "edited": false, "score": 0, "creation_date": 1435484419, "post_id": 31082923, "comment_id": 50212090, "body": "Many thanks Eris for the time you have taken to look into my question. Unfortunately I think it hasn&#39;t quite yet answered it for me.  Apologies, I hit enter too soon! Let me continue..."}, {"owner": {"reputation": 71, "user_id": 5023934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2850e0c8409560edc4c2d5875fe5ebac?s=128&d=identicon&r=PG", "display_name": "Peter Moore", "link": "https://stackoverflow.com/users/5023934/peter-moore"}, "edited": false, "score": 0, "creation_date": 1435485126, "post_id": 31082923, "comment_id": 50212273, "body": "The changes you suggested didn&#39;t result in the go program generating the three files. Also the powershell script worked when called from the demo.bat file, so the change (1) to the user account cannot be necessary. Change (2) is useful, but not related to the problem described. Change (3) had no impact for me, and also in the demo.bat file the working directory is C:\\stackoverflow, so equivalent to the go program, so does not explain the discrepancy. Many thanks."}, {"owner": {"reputation": 6608, "user_id": 2100227, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/uzsFd.png?s=128&g=1", "display_name": "Eris", "link": "https://stackoverflow.com/users/2100227/eris"}, "reply_to_user": {"reputation": 71, "user_id": 5023934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2850e0c8409560edc4c2d5875fe5ebac?s=128&d=identicon&r=PG", "display_name": "Peter Moore", "link": "https://stackoverflow.com/users/5023934/peter-moore"}, "edited": false, "score": 0, "creation_date": 1435600391, "post_id": 31082923, "comment_id": 50257226, "body": "The go script is being run as the admin user, the powershell script is run as the admin user. Only the batch file is run using <code>Start-Process</code> as the new user."}], "tags": [], "owner": {"reputation": 6608, "user_id": 2100227, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/uzsFd.png?s=128&g=1", "display_name": "Eris", "link": "https://stackoverflow.com/users/2100227/eris"}, "is_accepted": false, "score": 1, "last_activity_date": 1435358062, "last_edit_date": 1435358062, "creation_date": 1435356879, "answer_id": 31082923, "question_id": 30917132, "link": "https://stackoverflow.com/questions/30917132/why-does-powershell-start-process-not-work-when-called-from-go-golang/31082923#31082923", "title": "Why does Powershell Start-Process not work when called from go (golang)?", "body": "<p>Fixed it. </p>\n\n<ol>\n<li><p>The user Tom cannot access the <code>C:\\Stackoverflow</code> folder by default, in order for anything to run, I had to give Everyone access to Read/Execute items in that folder, else the start-process failed miserably</p></li>\n<li><p>Add profilepath to the net user command. This prevented the extra folders being created that I mentioned in a comment:</p>\n\n<p><code>net user Tom _Jerry123_ /add /expires:never /passwordchg:no /homedir:C:\\Users\\Tom /profilepath:C:\\Users\\Tom /y</code></p></li>\n<li><p>Replace the <code>Start-Process</code> line with:</p>\n\n<p><code>Start-Process C:\\stackoverflow\\whoami.bat -WorkingDirectory C:\\Users\\Tom -Credential ($credentials) -Wait</code></p></li>\n</ol>\n\n<p>Why?</p>\n\n<p>With the working directory set to C:\\StackOverflow, the command interpreter that is executing the batch file finds the <code>whoami.bat</code> before the builtin, and all kinds of broken happens. Once I moved the working directory to Tom's folder, everything worked exactly as you wanted.</p>\n\n<p>Alternative:</p>\n\n<p>Don't name your batch files the same as builtin commands.</p>\n"}], "owner": {"reputation": 71, "user_id": 5023934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2850e0c8409560edc4c2d5875fe5ebac?s=128&d=identicon&r=PG", "display_name": "Peter Moore", "link": "https://stackoverflow.com/users/5023934/peter-moore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3780, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1435358062, "creation_date": 1434635087, "question_id": 30917132, "link": "https://stackoverflow.com/questions/30917132/why-does-powershell-start-process-not-work-when-called-from-go-golang", "title": "Why does Powershell Start-Process not work when called from go (golang)?", "body": "<p>I wish to run a Windows batch script from go, under a different user to the user running the go program. The user running go has more privileges than the user that should run the batch script.</p>\n\n<p>From go there are several options for executing a process under a different user on Windows, such as writing windows calls directly using the syscall package in go. I have not attempted this yet, but I have tried both using PsExec and also Powershell. Powershell is preferred since it comes installed as standard on Windows 2008 R2.</p>\n\n<p>The following code demonstrates the problem I have. In the following demo, I run a batch script. This batch script calls a Powershell script directly, and then calls it from a go program. The results are different. The Powershell script outputs 3 files, yet when called from go, only outputs 2 files.</p>\n\n<p>For the sake of completeness, I also show how the user was created.</p>\n\n<p>C:\\stackoverflow\\demo.bat:</p>\n\n<pre><code>::::: create a new user for the demo :::::\n\n:: first create a home directory\nmkdir C:\\Users\\Tom\n:: remove Users group\nicacls C:\\Users\\Tom /remove:g Users\n:: remove Everyone\nicacls C:\\Users\\Tom /remove:g Everyone\n:: create user Tom and set his home directory\nnet user Tom _Jerry123_ /add /expires:never /passwordchg:no /homedir:C:\\Users\\Tom /y\n:: Give Tom access to his home directory\nicacls C:\\Users\\Tom /grant:r Tom:(CI)F SYSTEM:(CI)F Administrators:(CI)F\n:: give him access to Remote Desktop\nnet localgroup \"Remote Desktop Users\" /add Tom\n\n::::: now call powershell directly :::::\n\npowershell -command C:\\stackoverflow\\demo.ps1\n:: show which files were created\ndir C:\\Users\\Tom\n:: cleanup\ndel /f /q C:\\Users\\Tom\\*\n\n::::: run the go version to do the same thing :::::\n\ngo run C:\\stackoverflow\\demo.go\n:: compare results\ndir C:\\Users\\Tom\n:: cleanup\ndel /f /s /q C:\\Users\\Tom\nrmdir /s /q C:\\Users\\Tom\n:: delete user\nnet user Tom /delete\n</code></pre>\n\n<p>C:\\stackoverflow\\demo.ps1</p>\n\n<pre><code>write-output \"test output\" | out-file C:\\Users\\Tom\\started.txt\n$credentials = New-Object System.Management.Automation.PSCredential -ArgumentList @(\"Tom\",(ConvertTo-SecureString -String \"_Jerry123_\" -AsPlainText -Force))\nStart-Process C:\\stackoverflow\\whoami.bat -WorkingDirectory C:\\stackoverflow -Credential ($credentials) -Wait\nwrite-output \"test output\" | out-file C:\\Users\\Tom\\finished.txt\n</code></pre>\n\n<p>C:\\stackoverflow\\demo.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    run(exec.Command(\"PowerShell\", \"-Command\", \"C:\\\\stackoverflow\\\\demo.ps1\"))\n}\n\nfunc run(cmd *exec.Cmd) {\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    cmd.Stdin = os.Stdin\n    err := cmd.Start()\n    if err != nil {\n        panic(err)\n    }\n    err = cmd.Wait()\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(\"Done\")\n}\n</code></pre>\n\n<p>C:\\stackoverflow\\whoami.bat:</p>\n\n<pre><code>whoami &gt; C:\\Users\\Tom\\whoami.txt\n</code></pre>\n\n<p>And now, the results - here you see when called from batch script, files started.txt, whoami.txt, finished.txt all get created. When called from go, only started.txt and finished.txt get created. Why is that?</p>\n\n<p>Output:</p>\n\n<pre><code>C:\\stackoverflow&gt;demo.bat\n\nC:\\stackoverflow&gt;mkdir C:\\Users\\Tom\n\nC:\\stackoverflow&gt;icacls C:\\Users\\Tom /remove:g Users\nprocessed file: C:\\Users\\Tom\nSuccessfully processed 1 files; Failed processing 0 files\n\nC:\\stackoverflow&gt;icacls C:\\Users\\Tom /remove:g Everyone\nprocessed file: C:\\Users\\Tom\nSuccessfully processed 1 files; Failed processing 0 files\n\nC:\\stackoverflow&gt;net user Tom _Jerry123_ /add /expires:never /passwordchg:no /homedir:C:\\Users\\Tom /y\nThe command completed successfully.\n\n\nC:\\stackoverflow&gt;icacls C:\\Users\\Tom /grant:r Tom:(CI)F SYSTEM:(CI)F Administrators:(CI)F\nprocessed file: C:\\Users\\Tom\nSuccessfully processed 1 files; Failed processing 0 files\n\nC:\\stackoverflow&gt;net localgroup \"Remote Desktop Users\" /add Tom\nThe command completed successfully.\n\n\nC:\\stackoverflow&gt;powershell -command C:\\stackoverflow\\demo.ps1\n\nC:\\stackoverflow&gt;dir C:\\Users\\Tom\n Volume in drive C is OSDisk\n Volume Serial Number is CCD6-C9E7\n\n Directory of C:\\Users\\Tom\n\n06/18/2015  06:36 AM    &lt;DIR&gt;          .\n06/18/2015  06:36 AM    &lt;DIR&gt;          ..\n06/18/2015  06:36 AM                28 finished.txt\n06/18/2015  06:36 AM                28 started.txt\n06/18/2015  06:36 AM                55 whoami.txt\n               3 File(s)            111 bytes\n               2 Dir(s)  16,489,889,792 bytes free\n\nC:\\stackoverflow&gt;del /f /q C:\\Users\\Tom\\*\n\nC:\\stackoverflow&gt;go run C:\\stackoverflow\\demo.go\nDone\n\nC:\\stackoverflow&gt;dir C:\\Users\\Tom\n Volume in drive C is OSDisk\n Volume Serial Number is CCD6-C9E7\n\n Directory of C:\\Users\\Tom\n\n06/18/2015  06:36 AM    &lt;DIR&gt;          .\n06/18/2015  06:36 AM    &lt;DIR&gt;          ..\n06/18/2015  06:36 AM                28 finished.txt\n06/18/2015  06:36 AM                28 started.txt\n               2 File(s)             56 bytes\n               2 Dir(s)  16,489,889,792 bytes free\n\nC:\\stackoverflow&gt;del /f /s /q C:\\Users\\Tom\nDeleted file - C:\\Users\\Tom\\finished.txt\nDeleted file - C:\\Users\\Tom\\started.txt\n\nC:\\stackoverflow&gt;rmdir /s /q C:\\Users\\Tom\n\nC:\\stackoverflow&gt;net user Tom /delete\nThe command completed successfully.\n\n\nC:\\stackoverflow&gt;\n</code></pre>\n"}, {"tags": ["c", "go", "cgo"], "comments": [{"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 2, "creation_date": 1434635603, "post_id": 30917016, "comment_id": 49871842, "body": "Looks as if the Go-string is not NUL-terminated. There might be a length in the structure and you have to <code>memcpy()</code> to a buffer and append <code>\\0</code> yourself? Or there is a conversion function which does that?"}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "reply_to_user": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1434635738, "post_id": 30917016, "comment_id": 49871951, "body": "There is a length indeed, GoString is defined as &quot;typedef struct { char *p; GoInt n; } GoString;&quot;  I&#39;ll try to dig this way, thanks"}, {"owner": {"reputation": 4195, "user_id": 2432477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a516bc16804edd78d8f6c2a7e06f07b?s=128&d=identicon&r=PG&f=1", "display_name": "nouney", "link": "https://stackoverflow.com/users/2432477/nouney"}, "edited": false, "score": 0, "creation_date": 1434640383, "post_id": 30917016, "comment_id": 49875742, "body": "<code>write(STDOUT_FILENO, greeting.p, n)</code> should do the work (if you don&#39;t want to <code>memcpy</code> the buffer)."}], "answers": [{"comments": [{"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 0, "creation_date": 1434803878, "post_id": 30918009, "comment_id": 49941243, "body": "Hi! Thanks for your answer. I tried all code samples with no success.  I then tried to return and print just an Go int (which is a C &quot;long long&quot;) and got a wrong value too.  So it seems my problem is not with string encoding or null termination but probably with how I compile the whole thing"}], "tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": false, "score": 2, "last_activity_date": 1434639017, "last_edit_date": 1434639017, "creation_date": 1434637269, "answer_id": 30918009, "question_id": 30917016, "link": "https://stackoverflow.com/questions/30917016/use-a-gostring-in-c/30918009#30918009", "title": "Use a GoString in C", "body": "<p><code>printf</code> expects a NUL-terminated string, but Go strings aren't NUL-terminated, so your C program exhibits undefined behaviour. Do the following instead:</p>\n\n<pre><code>#include \"_obj/_cgo_export.h\"\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nint main() {\n   GoString greeting = HelloWorld();\n\n   char* cGreeting = malloc(greeting.n + 1);\n   if (!cGreeting) { /* handle allocation failure */ }\n   memcpy(cGreeting, greeting.p, greeting.n);\n   cGreeting[greeting.n] = '\\0';\n\n   printf(\"Greeting message: %s\\n\", cGreeting);\n\n   free(cGreeting);\n\n   return 0;\n}\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>#include \"_obj/_cgo_export.h\"\n#include &lt;stdio.h&gt;\n\nint main() {\n    GoString greeting = HelloWorld();\n\n    printf(\"Greeting message: \");\n    fwrite(greeting.p, 1, greeting.n, stdout);\n    printf(\"\\n\");\n\n    return 0;\n}\n</code></pre>\n\n<p>or, of course:</p>\n\n<pre><code>func HelloWorld() string {\n    return \"Hello World\\x00\"\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 0, "last_activity_date": 1441457539, "creation_date": 1441457539, "answer_id": 32413262, "question_id": 30917016, "link": "https://stackoverflow.com/questions/30917016/use-a-gostring-in-c/32413262#32413262", "title": "Use a GoString in C", "body": "<p>My problem is well described by this comment : <a href=\"https://stackoverflow.com/questions/6125683/call-go-functions-from-c#comment7151711_6125683\">Call go functions from C</a></p>\n\n<blockquote>\n  <p>You can call Go code from C, but at the moment you can't embed the Go\n  runtime into a C app, which is an important, but subtle, difference.</p>\n</blockquote>\n\n<p>That's what I was trying to do and that's why it failed miserably.</p>\n\n<p>I'll now be looking into <a href=\"https://docs.google.com/document/d/1nr-TQHw_er6GOQRsF6T43GGhFDelrAP0NqSS_00RgZQ\" rel=\"nofollow\">the new <code>-buildmode=c-shared</code> option</a></p>\n"}], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2427, "favorite_count": 0, "accepted_answer_id": 32413262, "answer_count": 2, "score": 3, "last_activity_date": 1441457539, "creation_date": 1434634845, "last_edit_date": 1434804090, "question_id": 30917016, "link": "https://stackoverflow.com/questions/30917016/use-a-gostring-in-c", "title": "Use a GoString in C", "body": "<p>I'm trying to use some Go code in a C program thanks to cgo</p>\n\n<p>My Go file looks like this :</p>\n\n<pre><code>package hello\n\nimport (\n    \"C\"\n)\n\n//export HelloWorld\nfunc HelloWorld() string{\n    return \"Hello World\"\n}\n</code></pre>\n\n<p>And my C code something like that :</p>\n\n<pre><code>#include \"_obj/_cgo_export.h\"\n#include &lt;stdio.h&gt;\n\nint main ()\n{\n   GoString greeting = HelloWorld();\n\n   printf(\"Greeting message: %s\\n\", greeting.p );\n\n   return 0;\n}\n</code></pre>\n\n<p>But what I get as output is not what I expected :</p>\n\n<blockquote>\n  <p>Greeting message: \ufffd</p>\n</blockquote>\n\n<p>I'm guessing it's an encoding issue, but there is very little documentation on it and I know next to nothing in C.</p>\n\n<p>Do you know what went wrong in that code?</p>\n\n<p>Edit :</p>\n\n<p>As I just said in a comment below :</p>\n\n<blockquote>\n  <p>I [...] tried to return and print just an Go int (which is a C \"long\n  long\") and got a wrong value too.</p>\n  \n  <p>So it seems my problem is not with string encoding or null termination\n  but probably with how I compile the whole thing</p>\n</blockquote>\n\n<p>I'll be adding all my compilation steps soon</p>\n"}, {"tags": ["pointers", "dictionary", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1434635176, "post_id": 30915821, "comment_id": 49871493, "body": "Tip: Do not use the term &quot;reference&quot;. Maps are not really reference types. Actually nothing in Go is a reference (whatever that means)."}, {"owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1434636929, "post_id": 30915821, "comment_id": 49873025, "body": "According to the Go blog they are: <i>&quot;Map types are reference types, like pointers and slices&quot;</i> - <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">halfway down the Declaration and initialization section</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1434644401, "post_id": 30915821, "comment_id": 49878437, "body": "The term &quot;reference type&quot; was never precisely defined, and many have stopped using that term to avoid confusion. The description of &quot;reference type&quot; can be used as a reminder that those types <i>contain</i> pointers internally, and I guess it could mean anything that could be assigned to nil, but maps, slices, and pointers are all still values."}], "answers": [{"comments": [{"owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "edited": false, "score": 0, "creation_date": 1434632880, "post_id": 30916132, "comment_id": 49869615, "body": "I really should have. I&#39;m getting too reliant on SO."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 2, "last_activity_date": 1434632573, "creation_date": 1434632573, "answer_id": 30916132, "question_id": 30915821, "link": "https://stackoverflow.com/questions/30915821/although-maps-are-always-reference-types-what-if-theyre-returned-from-a-non-po/30916132#30916132", "title": "Although maps are always reference types, what if they&#39;re returned from a non-pointer receiver?", "body": "<p>Why won't you just check it?</p>\n\n<pre><code>emp := ExampleMapHolder{make(map[string]int)}\nm := emp.TheMap()\nm[\"a\"] = 1\nfmt.Println(emp) // Prints {map[a:1]}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/jGZqFr97_y\" rel=\"nofollow\">http://play.golang.org/p/jGZqFr97_y</a></p>\n"}], "owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 30916132, "answer_count": 1, "score": -2, "last_activity_date": 1434632573, "creation_date": 1434631744, "last_edit_date": 1434632285, "question_id": 30915821, "link": "https://stackoverflow.com/questions/30915821/although-maps-are-always-reference-types-what-if-theyre-returned-from-a-non-po", "title": "Although maps are always reference types, what if they&#39;re returned from a non-pointer receiver?", "body": "<p>Supposedly maps are reference types in Go, so when returning them from functions, you don't need to pass as a pointer to the map in order for the changes to be visible outside the function body. But what if said map is returned from a method on a non-pointer struct?</p>\n\n<p>For example:</p>\n\n<pre><code>type ExampleMapHolder struct {\n    theUnexportedMap map[string]int\n}\n\nfunc (emp ExampleMapHolder) TheMap() map[string]int {\n    return emp.theUnexportedMap\n}\n</code></pre>\n\n<p>If I make a call to <code>TheMap()</code>, and then modify a value in it, will this change be visible elsewhere even though the receiver is not a pointer? I imagine it would return a reference to a map that belonged to a copy of ExampleMapHolder, but haven't been able to find an explicit answer in the docs.</p>\n"}, {"tags": ["sorting", "go", "struct"], "comments": [{"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1434625674, "post_id": 30913483, "comment_id": 49864435, "body": "Do you assume all your fields are going to be of the same type?"}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1434635224, "post_id": 30913483, "comment_id": 49871533, "body": "Looking at the question again \u2013 do you want to sort the output by the field name or the value behind it?"}, {"owner": {"reputation": 5138, "user_id": 515244, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/57549020123eef742723dfcfbe9e2039?s=128&d=identicon&r=PG", "display_name": "tomodian", "link": "https://stackoverflow.com/users/515244/tomodian"}, "reply_to_user": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1434638835, "post_id": 30913483, "comment_id": 49874559, "body": "@tomasz by the field name. When I write in Ruby it&#39;s gonna be <code>Hash[{b: 1, a: 2}.sort]</code>."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1434638931, "post_id": 30913483, "comment_id": 49874644, "body": "Ok, misunderstood your intention then. Go for icza&#39;s answer, it hopefully covers all you need."}], "answers": [{"comments": [{"owner": {"reputation": 5138, "user_id": 515244, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/57549020123eef742723dfcfbe9e2039?s=128&d=identicon&r=PG", "display_name": "tomodian", "link": "https://stackoverflow.com/users/515244/tomodian"}, "edited": false, "score": 0, "creation_date": 1434639415, "post_id": 30913719, "comment_id": 49874998, "body": "now I understand what you mean by implementing Stringer interface by reading icza&#39;s answer. Robust!"}, {"owner": {"reputation": 4472, "user_id": 88813, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/81b3151b91c9dfc3d0074cba1a0357c6?s=128&d=identicon&r=PG", "display_name": "Aaron Greenlee", "link": "https://stackoverflow.com/users/88813/aaron-greenlee"}, "edited": false, "score": 1, "creation_date": 1519098198, "post_id": 30913719, "comment_id": 84759084, "body": "You should explain why &quot;this is a stupid idea&quot;. Instead of simply putting someone&#39;s idea down educate them and lift them higher."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1434625782, "creation_date": 1434625782, "answer_id": 30913719, "question_id": 30913483, "link": "https://stackoverflow.com/questions/30913483/how-to-sort-struct-fields-in-alphabetical-order/30913719#30913719", "title": "How to sort struct fields in alphabetical order", "body": "<p>Make <code>T</code> implement the Stringer interface (see package fmt) and do either print A orb B first.</p>\n\n<p>BTW. This is a stupid idea.</p>\n"}, {"comments": [{"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 1, "creation_date": 1434635167, "post_id": 30915092, "comment_id": 49871480, "body": "+1 for a nice complete answer. I somehow jumped into conclusion OP wanted to sort fields by value (not name), but looking at the question again, and per example, it&#39;s now totally ambiguous to me."}, {"owner": {"reputation": 5138, "user_id": 515244, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/57549020123eef742723dfcfbe9e2039?s=128&d=identicon&r=PG", "display_name": "tomodian", "link": "https://stackoverflow.com/users/515244/tomodian"}, "edited": false, "score": 0, "creation_date": 1434638254, "post_id": 30915092, "comment_id": 49874090, "body": "@icza this really helps me to understand the concepts of sorting in Go. The latter one is flexible for sure!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1475402855, "last_edit_date": 1475402855, "creation_date": 1434629738, "answer_id": 30915092, "question_id": 30913483, "link": "https://stackoverflow.com/questions/30913483/how-to-sort-struct-fields-in-alphabetical-order/30915092#30915092", "title": "How to sort struct fields in alphabetical order", "body": "<p>A <code>struct</code> is an <em>ordered</em> collection of fields. The <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow\"><code>fmt</code></a> package uses reflection to get the fields and values of a <code>struct</code> value, and generates output in the order in which they were defined.</p>\n\n<p>So the simplest solution would be to declare your type where you already have your fields arranged in alphabetical order:</p>\n\n<pre><code>type T struct {\n    A int\n    B int\n}\n</code></pre>\n\n<p>If you can't modify the order of fields (e.g. memory layout is important), you can implement the <a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"nofollow\"><code>Stringer</code></a> interface by specifying a <code>String()</code> method for your struct type:</p>\n\n<pre><code>func (t T) String() string {\n    return fmt.Sprintf(\"{%d %d}\", t.A, t.B)\n}\n</code></pre>\n\n<p>The <code>fmt</code> package checks if the passed value implements <code>Stringer</code>, and if it does, calls its <code>String()</code> method to generate the output.</p>\n\n<p>Cons of this solution is that this is not flexible (e.g. if you add a new field, you have to update the <code>String()</code> method too), also you have to do it for every <code>struct</code> type you want it to work (and you can't define methods for types defined in other packages).</p>\n\n<p>The completely flexible solution can use reflection. You can get the names of fields, sort them by name, and then iterate over the sorted names and get the field values (by name).</p>\n\n<p>Pros of this solution is that this works for any <code>struct</code>, and it keeps working without modification even if you add or remove fields from your structs. It also works for fields of any type, not just for <code>int</code> fields.</p>\n\n<p>Here is an example how to do it (try it on the <a href=\"http://play.golang.org/p/giMSVtRMmN\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>func printFields(st interface{}) string {\n    t := reflect.TypeOf(st)\n\n    names := make([]string, t.NumField())\n    for i := range names {\n        names[i] = t.Field(i).Name\n    }\n    sort.Strings(names)\n\n    v := reflect.ValueOf(st)\n    buf := &amp;bytes.Buffer{}\n    buf.WriteString(\"{\")\n    for i, name := range names {\n        val := v.FieldByName(name)\n        if !val.CanInterface() {\n            continue\n        }\n        if i &gt; 0 {\n            buf.WriteString(\" \")\n        }\n        fmt.Fprintf(buf, \"%v\", val.Interface())\n    }\n    buf.WriteString(\"}\")\n\n    return buf.String()\n}\n</code></pre>\n"}], "owner": {"reputation": 5138, "user_id": 515244, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/57549020123eef742723dfcfbe9e2039?s=128&d=identicon&r=PG", "display_name": "tomodian", "link": "https://stackoverflow.com/users/515244/tomodian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2833, "favorite_count": 0, "accepted_answer_id": 30915092, "answer_count": 2, "score": 3, "last_activity_date": 1554204517, "creation_date": 1434625095, "last_edit_date": 1554204517, "question_id": 30913483, "link": "https://stackoverflow.com/questions/30913483/how-to-sort-struct-fields-in-alphabetical-order", "title": "How to sort struct fields in alphabetical order", "body": "<p>How could I get an output of struct, sorted by fields?</p>\n\n<pre><code>type T struct {\n    B int\n    A int\n}\n\nt := &amp;T{B: 2, A: 1}\n\ndoSomething(t)\n\nfmt.Println(t)  // &amp;{1 2} --&gt; Sorted by fields\n</code></pre>\n"}, {"tags": ["go", "rot13"], "answers": [{"tags": [], "owner": {"reputation": 1701, "user_id": 788887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f68a54ea809de360f7049f5c970df1d7?s=128&d=identicon&r=PG", "display_name": "ReyCharles", "link": "https://stackoverflow.com/users/788887/reycharles"}, "is_accepted": false, "score": 3, "last_activity_date": 1434623048, "creation_date": 1434623048, "answer_id": 30912779, "question_id": 30912457, "link": "https://stackoverflow.com/questions/30912457/why-using-naked-return-and-the-normal-return-give-me-different-results/30912779#30912779", "title": "Why using naked return and the normal return give me different results?", "body": "<p>The <code>Read()</code> operation mutates the input array <code>b</code>. In the second example the <code>rot13()</code> operations are overwritten by the <code>Read()</code> operation. Furthermore, the <code>rot13()</code> operation is performed before any data has been read into the array, so you're probably doing <code>rot13()</code> on garbage data.</p>\n\n<p>If you wanted the second example to work you'd need to write something like this:</p>\n\n<pre><code>func (r rot13Reader) Read(b []byte) (int, error) {\n    n, err := r.r.Read(b)\n    for i, v := range b {\n    b[i] = rot13(v)\n    }\n    return n, err \n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1701, "user_id": 788887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f68a54ea809de360f7049f5c970df1d7?s=128&d=identicon&r=PG", "display_name": "ReyCharles", "link": "https://stackoverflow.com/users/788887/reycharles"}, "edited": false, "score": 1, "creation_date": 1434623396, "post_id": 30912835, "comment_id": 49862933, "body": "It&#39;s totally fine to use the whole buffer if they want to. It may be less efficient, but the specification of io.Reader allows for it: &quot;<i>Even if Read returns n &lt; len(p), it may use all of p as scratch space during the call.</i>&quot;"}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "reply_to_user": {"reputation": 1701, "user_id": 788887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f68a54ea809de360f7049f5c970df1d7?s=128&d=identicon&r=PG", "display_name": "ReyCharles", "link": "https://stackoverflow.com/users/788887/reycharles"}, "edited": false, "score": 1, "creation_date": 1434623599, "post_id": 30912835, "comment_id": 49863064, "body": "@ReyCharles sure, that&#39;s why I only <i>suggested</i> it (will make it more clear in the edit). I suspected that maybe the OP didn&#39;t necessarily understand how <code>io.Read</code> interface works, believing <code>b</code> is somehow shrunken by the call."}, {"owner": {"reputation": 436, "user_id": 3398064, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/552564813/picture?type=large", "display_name": "iboss", "link": "https://stackoverflow.com/users/3398064/iboss"}, "edited": false, "score": 0, "creation_date": 1434624857, "post_id": 30912835, "comment_id": 49863896, "body": "I&#39;ve already read the documentation but still don&#39;t get it. And I have two questions from your answer. 1. You said &quot;simply passing what has been read from the underlying reader&quot;. What do you mean by that. Could you give me some more explanation. 2. Since <code>b</code> is passed by value if I get it right, why can we modify it and have an affect to the variable that is passed in to the reader."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 2, "creation_date": 1434625430, "post_id": 30912835, "comment_id": 49864272, "body": "iboss: you get a slice to your rot13Reader.Read (by reference, slices are just pointers). This slice has some lenght and <code>r.r.Read</code> fills <code>b</code> with up to <code>len(b)</code> bytes. Once you have data in your <code>b</code> slice you want to transform it (rot13) and then return to the user how many bytes has been read to buffer <code>b</code>. Everything on the <i>original slice</i> as (once again) slices are not passed by value (in a sense they&#39;re not being copied). Your second example reads the data from the underlying reader <i>after</i> you perform rot13 transformation, that&#39;s why you don&#39;t see the data deciphered."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1434635536, "post_id": 30912835, "comment_id": 49871782, "body": "@tomasz: Slices <i>are</i> passed by value, they <i>are</i> being copied. Which is unrelated to the underlying array (which is not copied)."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "reply_to_user": {"reputation": 436, "user_id": 3398064, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/552564813/picture?type=large", "display_name": "iboss", "link": "https://stackoverflow.com/users/3398064/iboss"}, "edited": false, "score": 1, "creation_date": 1434635730, "post_id": 30912835, "comment_id": 49871945, "body": "Volker you&#39;re 100% correct, again, I should be much more precise at my explanation. @iboss per Volker response, slices are passed by value, but they share the same underlying array (think: pointer to the array is being copied and they point to the same underlying array, hence you&#39;ll see modifications)."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1434636278, "post_id": 30912835, "comment_id": 49872456, "body": "And this is leading to the situation when you can have two slices pointing to the same array, but having different (separate) lengths. That&#39;s why Read method is able to modify the array (visible to the caller) but cannot change the length in the same manner. Volker&#39;s comment is very important here, mine was misleading."}], "tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": true, "score": 3, "last_activity_date": 1434623726, "last_edit_date": 1434623726, "creation_date": 1434623235, "answer_id": 30912835, "question_id": 30912457, "link": "https://stackoverflow.com/questions/30912457/why-using-naked-return-and-the-normal-return-give-me-different-results/30912835#30912835", "title": "Why using naked return and the normal return give me different results?", "body": "<p>It's not a problem with returns, but in the first case you're reading the data in before transforming it and in the second case you're transforming junk in a buffer and only then reading in the data (and simply passing what has been read from the underlying reader).</p>\n\n<p>While this is not required for correctness, I'd suggest you don't transform the whole buffer every time, but only the portion that has been read, i.e. changing your first example from <code>for i, v := range b</code> to <code>for i, v := range b[:n]</code>. That's because <code>io.Read</code> call is not able to modify length of slice <code>b</code>, but just its content.</p>\n\n<p>Take a look at the documentation of <a href=\"http://golang.org/pkg/io/#Reader\" rel=\"nofollow\"><code>io.Reader</code></a>, it should give you some more idea on how this interface is expected to work.</p>\n"}], "owner": {"reputation": 436, "user_id": 3398064, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/552564813/picture?type=large", "display_name": "iboss", "link": "https://stackoverflow.com/users/3398064/iboss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 588, "favorite_count": 0, "accepted_answer_id": 30912835, "answer_count": 2, "score": -2, "last_activity_date": 1434623726, "creation_date": 1434622230, "last_edit_date": 1434622746, "question_id": 30912457, "link": "https://stackoverflow.com/questions/30912457/why-using-naked-return-and-the-normal-return-give-me-different-results", "title": "Why using naked return and the normal return give me different results?", "body": "<p>I'm playing around with Golang tour and I wonder why using naked return give me the correct result but the normal one doesn't. This is the exercise that I have this problem <a href=\"https://tour.golang.org/methods/12\" rel=\"nofollow\">https://tour.golang.org/methods/12</a>.</p>\n\n<p>The objective is to create a reader that can decipher rot13. and the rot13 function is already tested.</p>\n\n<pre><code>func (r rot13Reader) Read(b []byte) (n int, err error) {\n    n, err =  r.r.Read(b)\n    for i, v := range b {\n        b[i] = rot13(v)\n    }\n    return\n}\n</code></pre>\n\n<p>The code above give me the correct result.</p>\n\n<pre><code>func (r rot13Reader) Read(b []byte) (int, error) {\n    for i, v := range b {\n    b[i] = rot13(v)\n    }\n    return r.r.Read(b)\n}\n</code></pre>\n\n<p>And this doesn't change anything from the input stream.</p>\n\n<p>Could anybody explain why? Thank you in advance.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1434622728, "post_id": 30912120, "comment_id": 49862499, "body": "Nice, simple and clean. +1"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1434629862, "post_id": 30912120, "comment_id": 49867320, "body": "Perfect\u2014I&#39;d completely forgotten I could do this as an interim measure (and pretty good alternative). Thanks muchly."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1434646224, "post_id": 30912120, "comment_id": 49879439, "body": "One caveat specific to <code>http.ResponseWriter</code> wrapping is the way that &quot;optional&quot; ResponseWriter interfaces (<code>http.Flusher</code>, <code>http.CloseNotifier</code>, <code>http.Hijacker</code>) are handled means that if you just do simple wrapping you&#39;ll lose those &quot;optional&quot; features of the original writer (<code>rw</code> here). Often that&#39;s not an issue but it is something to be aware of."}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 7, "last_activity_date": 1434621231, "creation_date": 1434621231, "answer_id": 30912120, "question_id": 30911527, "link": "https://stackoverflow.com/questions/30911527/serving-static-files-with-a-http-500-status/30912120#30912120", "title": "Serving Static Files with a HTTP 500 Status", "body": "<p>Wrap <code>http.ResponseWriter</code>:</p>\n\n<pre><code>type MyResponseWriter struct {\n    http.ResponseWriter\n    code int\n}\n\nfunc (m MyResponseWriter) WriteHeader(int) {\n    m.ResponseWriter.WriteHeader(m.code)\n}\n</code></pre>\n\n<p>And then (for an HTTP 500):</p>\n\n<pre><code>http.ServeFile(MyResponseWriter{rw, 500}, rq, \"file.name\")\n</code></pre>\n\n<p>Where <code>rw</code> is the \"actual\" <code>http.ResponseWriter</code> and <code>rq</code> is the <code>*http.Request</code> object.</p>\n"}], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 30912120, "answer_count": 1, "score": 4, "last_activity_date": 1434621231, "creation_date": 1434619679, "question_id": 30911527, "link": "https://stackoverflow.com/questions/30911527/serving-static-files-with-a-http-500-status", "title": "Serving Static Files with a HTTP 500 Status", "body": "<p>Is there a way to serve static files over HTTP in Go with a custom status code (without re-writing a significant amount of private code)?</p>\n\n<p>From what I can see:</p>\n\n<ol>\n<li><a href=\"http://golang.org/src/net/http/fs.go#L426\" rel=\"nofollow\">http.ServeFile</a> calls the helper function <a href=\"http://golang.org/src/net/http/fs.go#L343\" rel=\"nofollow\">http.serveFile</a> </li>\n<li>It then calls <a href=\"http://golang.org/src/net/http/fs.go#L117\" rel=\"nofollow\">http.ServeContent</a> after determining the mod time and size of the file/dir (and if it exists)</li>\n<li>Finally, <a href=\"http://golang.org/src/net/http/fs.go#L142\" rel=\"nofollow\">http.serveContent</a> is called, which sets the correct headers (Content-Type, Content-Length) and sets a <code>http.StatusOK</code> header <a href=\"http://golang.org/src/net/http/fs.go#L254\" rel=\"nofollow\">here</a>.</li>\n</ol>\n\n<p>I think I already know the answer for this, but if someone has an alternative solution it'd be useful.</p>\n\n<p>The use case is serving 500.html, 404.html, et. al files. I'd normally use nginx to catch Go's usual plain <code>http.Error</code> responses and have nginx serve the file off disk, but I'm in an environment where that's not an option.</p>\n"}, {"tags": ["go", "io"], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 5023115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b98172e120bff7fb12c67cb0fd77da7?s=128&d=identicon&r=PG&f=1", "display_name": "joy", "link": "https://stackoverflow.com/users/5023115/joy"}, "edited": false, "score": 1, "creation_date": 1434617967, "post_id": 30910682, "comment_id": 49859237, "body": "Thank you very much. I understand. And Does has any ways that read its content second times?"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 1, "creation_date": 1434629296, "post_id": 30910682, "comment_id": 49866948, "body": "This approach doesn&#39;t copy anything (other than data in to b), just creates a new buffer.  Only way I can see this being faster is to do &quot;return copy(buf.Bytes(),b),nil&quot;  which has the same effect but doesn&#39;t allocate a new buffer.  not sure which is actually faster.  (guessing the copy is)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1434630309, "post_id": 30910682, "comment_id": 49867669, "body": "@DavidBudworth Yeah, you&#39;re right. <code>Buffer.Bytes()</code> just returns a slice sharing the same underlying array. So it&#39;s not bad performance-wise at all."}, {"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 0, "creation_date": 1496166621, "post_id": 30910682, "comment_id": 75545528, "body": "Seems like there be problems using this approach for network buffers that probably don&#39;t have all the data in <code>Buffer.Bytes()</code> yet."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 0, "creation_date": 1496186227, "post_id": 30910682, "comment_id": 75554341, "body": "@Xeoncross <code>bytes.Buffer</code> is an in-memory buffer, it has nothing to do with networking. In case of a network, we have to take care of &quot;replaying&quot; the data read and inspected. An example can be found in this answer: <a href=\"https://stackoverflow.com/questions/43021058/golang-read-request-body/43021236#43021236\">Golang read request body</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 9, "last_activity_date": 1481643224, "last_edit_date": 1481643224, "creation_date": 1434617539, "answer_id": 30910682, "question_id": 30910487, "link": "https://stackoverflow.com/questions/30910487/why-does-an-io-reader-become-empty-after-reading-it/30910682#30910682", "title": "Why does an io.reader become empty after reading it?", "body": "<p>Reading from a <a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"nofollow noreferrer\"><code>bytes.Buffer</code></a> drains or consumes the bytes that were read. This means if you try to read again, those will not be returned.</p>\n\n<p><a href=\"https://golang.org/pkg/bytes/#Buffer.Bytes\" rel=\"nofollow noreferrer\"><code>Buffer.Bytes()</code></a> returns the <strong>unread</strong> portion of the buffer, so it is the expected result for you to see <code>0</code> length after everything has been read (this is exactly what <a href=\"https://golang.org/pkg/io/ioutil/#ReadAll\" rel=\"nofollow noreferrer\"><code>ioutil.ReadAll()</code></a> does).</p>\n\n<hr>\n\n<p>What if you just want to \"peek\" and not really \"read\" bytes?</p>\n\n<p>There is no \"peek\" functionality in <code>bytes.Buffer</code>. The easiest would be to get the bytes of the buffer, and construct another <code>bytes.Buffer</code> from it and read from the new buffer.</p>\n\n<p>It could look something like this:</p>\n\n<pre><code>func peek(buf *bytes.Buffer, b []byte) (int, error) {\n    buf2 := bytes.NewBuffer(buf.Bytes())\n    return buf2.Read(b)\n}\n</code></pre>\n\n<h3><code>peek()</code> in action:</h3>\n\n<p>Error checks omitted for simplicity:</p>\n\n<pre><code>buf := &amp;bytes.Buffer{}\n\nbuf.WriteString(\"Hello\")\nfmt.Printf(\"Len: %d, Content: %s\\n\", buf.Len(), buf)\n\nfmt.Println(\"\\nPeeking...\")\ndata := make([]byte, 4)\npeek(buf, data)\nfmt.Printf(\"Peeked: %s\\n\", data)\nfmt.Printf(\"Len: %d, Content: %s\\n\", buf.Len(), buf)\n\nfmt.Println(\"\\nReading...\")\ndata = make([]byte, buf.Len())\nbuf.Read(data)\nfmt.Printf(\"Read: %s\\n\", data)\nfmt.Printf(\"Len: %d, Content: %s\\n\", buf.Len(), buf)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/mI-nhmdtH4\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Len: 5, Content: Hello\n\nPeeking...\nPeeked: Hell\nLen: 5, Content: Hello\n\nReading...\nRead: Hello\nLen: 0, Content: \n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 5023115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b98172e120bff7fb12c67cb0fd77da7?s=128&d=identicon&r=PG&f=1", "display_name": "joy", "link": "https://stackoverflow.com/users/5023115/joy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6711, "favorite_count": 3, "answer_count": 1, "score": 4, "last_activity_date": 1566394338, "creation_date": 1434616990, "last_edit_date": 1566394338, "question_id": 30910487, "link": "https://stackoverflow.com/questions/30910487/why-does-an-io-reader-become-empty-after-reading-it", "title": "Why does an io.reader become empty after reading it?", "body": "<pre><code>func foo(buf *bytes.Buffer) {\n    fmt.Println(\"0: \", len(buf.Bytes()))\n    ioutil.ReadAll(buf)\n    fmt.Println(\"1: \", len(buf.Bytes()))\n}\n</code></pre>\n\n<p>The code shows the correct length the first time, but the second times it shows the length is zero.</p>\n"}, {"tags": ["go", "embedded-database", "batching", "boltdb"], "answers": [{"comments": [{"owner": {"reputation": 247, "user_id": 4964407, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/957426357643177/picture?type=large", "display_name": "Raunak Dugar", "link": "https://stackoverflow.com/users/4964407/raunak-dugar"}, "edited": false, "score": 1, "creation_date": 1434614196, "post_id": 30909337, "comment_id": 49856890, "body": "Thanks! I saw that,it is using a server.I need a simpler example as I am a beginner."}], "tags": [], "owner": {"reputation": 2562, "user_id": 216636, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e7e9e3684b967676457914eeed61598e?s=128&d=identicon&r=PG", "display_name": "Marko Kevac", "link": "https://stackoverflow.com/users/216636/marko-kevac"}, "is_accepted": false, "score": 2, "last_activity_date": 1434613350, "creation_date": 1434613350, "answer_id": 30909337, "question_id": 30908830, "link": "https://stackoverflow.com/questions/30908830/batching-operations-in-boltdb/30909337#30909337", "title": "Batching Operations in Boltdb", "body": "<p>Just call db.Batch() from your goroutines. Batch() was created to be used this way. There is an example in <a href=\"http://godoc.org/github.com/boltdb/bolt#DB.Batch\" rel=\"nofollow\">documentation</a>.</p>\n"}], "owner": {"reputation": 247, "user_id": 4964407, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/957426357643177/picture?type=large", "display_name": "Raunak Dugar", "link": "https://stackoverflow.com/users/4964407/raunak-dugar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1407, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1434613350, "creation_date": 1434611854, "last_edit_date": 1434612941, "question_id": 30908830, "link": "https://stackoverflow.com/questions/30908830/batching-operations-in-boltdb", "title": "Batching Operations in Boltdb", "body": "<p>Currently using db.Update() to  update the key-value in boltdb.</p>\n\n<pre><code>err := db.Update(func(tx *bolt.Tx) error {\n\n    b, err := tx.CreateBucket([]byte(\"widgets\"))\n    if err != nil {\n        return err\n    }\n    if err := b.Put([]byte(\"foo\"), []byte(\"bar\")); err != nil {\n        return err\n    }\n    return nil\n})\n</code></pre>\n\n<p>How to use db.Batch() operations using go routines? </p>\n"}, {"tags": ["arrays", "struct", "go", "initialization", "custom-type"], "answers": [{"comments": [{"owner": {"reputation": 332, "user_id": 1578705, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/eeb3cf2932577f95689b9b9cf35a8c68?s=128&d=identicon&r=PG", "display_name": "emmerich", "link": "https://stackoverflow.com/users/1578705/emmerich"}, "edited": false, "score": 0, "creation_date": 1434615699, "post_id": 30909618, "comment_id": 49857737, "body": "Thank you icza! The only thing left for me is to write the data_send to a socket. I&#39;m looking now for solutions on how can I pack this into a []byte"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 332, "user_id": 1578705, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/eeb3cf2932577f95689b9b9cf35a8c68?s=128&d=identicon&r=PG", "display_name": "emmerich", "link": "https://stackoverflow.com/users/1578705/emmerich"}, "edited": false, "score": 0, "creation_date": 1434615759, "post_id": 30909618, "comment_id": 49857781, "body": "@emmerich If you change <code>type xchr int8</code> to <code>type xchr byte</code>, then you will already have a <code>[]byte</code>."}, {"owner": {"reputation": 332, "user_id": 1578705, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/eeb3cf2932577f95689b9b9cf35a8c68?s=128&d=identicon&r=PG", "display_name": "emmerich", "link": "https://stackoverflow.com/users/1578705/emmerich"}, "edited": false, "score": 0, "creation_date": 1434616651, "post_id": 30909618, "comment_id": 49858359, "body": "Unfortunately it doesn&#39;t like my custom-type even if is byte  \t\t\t\tcannot use data_send (type [57]xchr) as type []byte in argument to conn.conn.Write  Also, I&#39;ve tried before this to use this:  \t\t\t\tbuf := new(bytes.Buffer) \t\t\t\tif err := binary.Write(buf, binary.BigEndian, &amp;data_send); err != nil { \t\t\t\tfmt.Println(err) \t\t\t\tos.Exit(1) \t\t\t\t}  \t\t\t\t_, err = conn.Write(buf.Bytes())  Also, using tcpdump I&#39;ve noticed that the length differs by 4 bytes between the C++ version and the Go one: <a href=\"http://pastebin.com/g0trm9mC\" rel=\"nofollow noreferrer\">pastebin</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 332, "user_id": 1578705, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/eeb3cf2932577f95689b9b9cf35a8c68?s=128&d=identicon&r=PG", "display_name": "emmerich", "link": "https://stackoverflow.com/users/1578705/emmerich"}, "edited": false, "score": 1, "creation_date": 1434617346, "post_id": 30909618, "comment_id": 49858813, "body": "@emmerich See edited answer which results in <code>[]byte</code> with minimal change."}, {"owner": {"reputation": 1701, "user_id": 788887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f68a54ea809de360f7049f5c970df1d7?s=128&d=identicon&r=PG", "display_name": "ReyCharles", "link": "https://stackoverflow.com/users/788887/reycharles"}, "edited": false, "score": 0, "creation_date": 1434622494, "post_id": 30909618, "comment_id": 49862348, "body": "Int <i>is</i> fixed length and the behavior <i>is</i> deterministic, <i>but it&#39;s platform dependent</i>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1701, "user_id": 788887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f68a54ea809de360f7049f5c970df1d7?s=128&d=identicon&r=PG", "display_name": "ReyCharles", "link": "https://stackoverflow.com/users/788887/reycharles"}, "edited": false, "score": 0, "creation_date": 1434622571, "post_id": 30909618, "comment_id": 49862398, "body": "@ReyCharles Yes, that&#39;s what the 2nd half of the sentence states: <i>&quot;..it may be 32 bit or 64 bit depending on the target architecture you compile to. &quot;</i>"}, {"owner": {"reputation": 1701, "user_id": 788887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f68a54ea809de360f7049f5c970df1d7?s=128&d=identicon&r=PG", "display_name": "ReyCharles", "link": "https://stackoverflow.com/users/788887/reycharles"}, "edited": false, "score": 0, "creation_date": 1434622642, "post_id": 30909618, "comment_id": 49862443, "body": "Yes, that part is correct. Saying that int is not fixed-length and that the behavior is undeterministic is plain wrong, though.  I see you accepted my edit, thanks."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1482146626, "last_edit_date": 1482146626, "creation_date": 1434614255, "answer_id": 30909618, "question_id": 30908818, "link": "https://stackoverflow.com/questions/30908818/golang-structs-initializing-and-memcpy-what-is-the-proper-way/30909618#30909618", "title": "Golang - structs, initializing and memcpy - what is the proper way?", "body": "<p>So basically given these basic types:</p>\n\n<pre><code>type xchr int8\ntype xint int\ntype xdob float64\ntype xflt float32\n</code></pre>\n\n<p>You want to copy the bytes (memory representation) of a value of the following <code>struct</code> type:</p>\n\n<pre><code>type VEH1 struct { // 52 bytes total\n    p              xint    // 4 bytes (READ BELOW)\n    lat_lon_ele    [3]xdob // 24 bytes\n    psi_the_phi    [3]xflt // 12 bytes\n    gear_flap_vect [3]xflt // 12 bytes\n}\n</code></pre>\n\n<p>Note that the length of <code>int</code> in Go is platform dependent, it may be 32 bit or 64 bit depending on the target architecture you compile to. That would lead to platform dependent behavior, so let's fix it to <code>int32</code> for now:</p>\n\n<pre><code>type xint int32\n</code></pre>\n\n<p>This is how the byte sizes of the above <code>struct</code> is calculated. If you need <code>int64</code>, just change it and add 4 additional bytes in size calculation.</p>\n\n<p>Next you want the result in an array whose element types are <code>xchr</code>. You need a big enough array, which is the \"prefix\" being <code>\"VEH1\"</code> followed by the data of the above <code>struct</code>. So it must have a size of <code>4+sizeof(VEH1)</code> which is <code>56</code>.</p>\n\n<p>In Go to copy the bytes of one type to the memory space of another type, you can do it the <a href=\"https://golang.org/pkg/unsafe/\" rel=\"nofollow noreferrer\"><code>unsafe</code></a> package and its general <a href=\"https://golang.org/pkg/unsafe/#Pointer\" rel=\"nofollow noreferrer\"><code>Pointer</code></a> type. Any pointer can be cast to <code>unsafe.Pointer</code> and <code>unsafe.Pointer</code> can be cast to any pointer type, so this is your \"gateway\" between different pointer types.</p>\n\n<p>You can take the address of a <code>struct</code> value of <code>VHE1</code>, convert it to <code>Pointer</code>, and convert the result <code>Pointer</code> to a pointer to the target data type. Dereference the pointer and now you already have the value of the other type.</p>\n\n<p>The builtin <a href=\"https://golang.org/pkg/builtin/#copy\" rel=\"nofollow noreferrer\"><code>copy()</code></a> can only be used with slices, so first you need to slice your data arrays to be able to pass them to <code>copy()</code>.</p>\n\n<p>You can do it like this:</p>\n\n<pre><code>avio := VEH1{0, [3]xdob{47.460058, -122.32104, 8000.000},\n    [3]xflt{110.5, 0.0, 0.0}, [3]xflt{1.0, 0.0, 0.0}}\nfmt.Printf(\"%+v\\n\", avio)\n\npavio := unsafe.Pointer(&amp;avio)\npavio_arr := *((*[52]xchr)(pavio))\n\ndata_send := [56]xchr{'V', 'E', 'H', '1'}\nn := copy(data_send[4:], pavio_arr[:])\nfmt.Printf(\"Copied %d bytes\\n\", n)\n\nfmt.Printf(\"%+v\\n\", data_send)\n</code></pre>\n\n<p>Output, wrapped to fit in screen:</p>\n\n<pre><code>{p:0 lat_lon_ele:[47.460058 -122.32104 8000] psi_the_phi:[110.5 0 0]\n    gear_flap_vect:[1 0 0]}\nCopied 52 bytes\n[86 69 72 49 0 0 0 0 0 0 0 0 -81 33 56 46 -29 -70 71 64 77 45 91 -21 -117\n    -108 94 -64 0 0 0 0 0 64 -65 64 0 0 -35 66 0 0 0 0 0 0 0 0 0 0 -128 63 0 0 0 0]\n</code></pre>\n\n<p>Try the working demo on the <a href=\"http://play.golang.org/p/3abTiv5QuU\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h3>Having the result as <code>[]byte</code></h3>\n\n<p>If you want <code>[]byte</code> result (e.g. you want to write the result to an <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\"><code>io.Writer</code></a>), then use <code>[56]byte</code> type for <code>data_send</code> and of course cast <code>pavio</code> to <code>*[52]byte</code>:</p>\n\n<pre><code>pavio := unsafe.Pointer(&amp;avio)\npavio_arr := *((*[52]byte)(pavio))\n\ndata_send := [56]byte{'V', 'E', 'H', '1'}\nn := copy(data_send[4:], pavio_arr[:])\n</code></pre>\n"}], "owner": {"reputation": 332, "user_id": 1578705, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/eeb3cf2932577f95689b9b9cf35a8c68?s=128&d=identicon&r=PG", "display_name": "emmerich", "link": "https://stackoverflow.com/users/1578705/emmerich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6383, "favorite_count": 0, "accepted_answer_id": 30909618, "answer_count": 1, "score": 1, "last_activity_date": 1482146626, "creation_date": 1434611800, "last_edit_date": 1445931378, "question_id": 30908818, "link": "https://stackoverflow.com/questions/30908818/golang-structs-initializing-and-memcpy-what-is-the-proper-way", "title": "Golang - structs, initializing and memcpy - what is the proper way?", "body": "<p>I'm new to Go and I wish to translate some C/C++ code I have to Go but I haven't been able to. The problem resides in 2 places: how can I initialize a struct I've defined and how to do a \"memcopy\"</p>\n\n<p>The code I'm talking about is this: <a href=\"http://play.golang.org/p/e8N255qEAk\" rel=\"nofollow\">http://play.golang.org/p/e8N255qEAk</a>\nline 69 and 74.</p>\n\n<p>The C/C++ code I wanted to \"translate\" to Go is this:</p>\n\n<pre><code>            typedef char xchr;\n            typedef int xint;\n            typedef double xdob;\n            typedef float xflt;\n            typedef struct\n            {\n               xint p; \n               xdob lat_lon_ele[3];\n               xflt psi_the_phi[3];\n               xflt gear_flap_vect[3];\n            }VEH1;\n\n            avio.p = 0;\n            avio.lat_lon_ele[0] = 47.460058;\n            avio.lat_lon_ele[1] = -122.32104;\n            avio.lat_lon_ele[2] = 8000.000;\n\n            avio.psi_the_phi[0] = 110.5;\n            avio.psi_the_phi[1] = 0.0;\n            avio.psi_the_phi[2] = 0.0;\n\n            avio.gear_flap_vect[0] = 1.0;\n            avio.gear_flap_vect[1] = 0.0;\n            avio.gear_flap_vect[2] = 0.0;\n\n            VEH1* av = &amp;avio;\n\n            xchr data_send[6];\n            data_send[0]='V';\n            data_send[1]='E';\n            data_send[2]='H';\n            data_send[3]='1';\n            data_send[4]=0;\n\n            memcpy(&amp;data_send[5],av,sizeof(VEH1)); // load in the data\n</code></pre>\n\n<p>The Go code looks like this:</p>\n\n<pre><code>            type xchr int8\n            type xint int\n            type xdob float64\n            type xflt float32\n\n            type VEH1 struct {\n                p              xint\n                lat_lon_ele    [3]xdob\n                psi_the_phi    [3]xflt\n                gear_flap_vect [3]xflt\n            }\n\n            type VEHA struct {\n                num_p xint\n\n                lat_lon_ele    [10][3]xdob\n                psi_the_phi    [10][3]xflt\n                gear_flap_vect [10][3]xflt\n\n                lat_view, lon_view, ele_view xdob\n                psi_view, the_view, phi_view xflt\n            }\n\n\n            var avio VEH1\n            avio = &amp;VEH1{0, {47.460058, -122.32104, 8000.000}, {110.5, 0.0, 0.0}, {1.0, 0.0, 0.0}}\n\n            data_send := [6]xchr{'V', 'E', 'H', '1', 0, 0}\n            copy(data_send[5:5], avio);\n</code></pre>\n\n<p>Thank you!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 1, "creation_date": 1434589512, "post_id": 30904885, "comment_id": 49848224, "body": "why not use one channel for all(c1...cN). you can write one channel in multiple go routine."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1434639557, "post_id": 30904885, "comment_id": 49875117, "body": "I know you said you&#39;re aware of many flaws; but two important ones you might not know about that I&#39;d like to point out. First, remove the <code>default:</code> case of your <code>switch</code>; it makes it a non-blocking busy loop rather than blocking until there is something to read. Second, when <code>http.Get</code> returns an error you need to put a return in your <code>if err != nil</code> block since <code>resp.Body.Close()</code> will panic since <code>resp</code> will not be valid."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1434642946, "post_id": 30904885, "comment_id": 49877533, "body": "FYI, here&#39;s a &quot;cleaned up&quot; version based on <a href=\"http://stackoverflow.com/a/30905234/55504\">OneOfOne&#39;s answer</a>: <a href=\"https://play.golang.org/p/5ai9Cbi9Rx\" rel=\"nofollow noreferrer\">play.golang.org/p/5ai9Cbi9Rx</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5661, "user_id": 3179857, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/74a01200b8e1bc8b9b57ddd5633288bc?s=128&d=identicon&r=PG", "display_name": "Evan", "link": "https://stackoverflow.com/users/3179857/evan"}, "edited": false, "score": 0, "creation_date": 1434595569, "post_id": 30905234, "comment_id": 49849566, "body": "If you do want to keep a channel per for some reason, you can take a look at <a href=\"https://godoc.org/github.com/eapache/channels\" rel=\"nofollow noreferrer\">godoc.org/github.com/eapache/channels</a> for some patterns to gather the results of multiple channels; in particular probably the <code>Multiplex</code> function is fairly close to what you&#39;re looking for."}, {"owner": {"reputation": 456, "user_id": 2380024, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/zc2mh.jpg?s=128&g=1", "display_name": "Greg Cobb", "link": "https://stackoverflow.com/users/2380024/greg-cobb"}, "edited": false, "score": 0, "creation_date": 1434618012, "post_id": 30905234, "comment_id": 49859268, "body": "After seeing the 20 added to the make statement i realized I needed to buff up on channels.  I am pretty sure I get it now but just to be clear, you could remove that extra parameter from the make and it would still work but would be less efficient since the senders would always have to block to wait to send, correct?  By creating a buffer the same size as the number of go routines you started, you essentially will never have the channel block on the sending end?  Also could you describe what the for loop with the range is saying in &quot;range [20]struct{}{}&quot;? Anything beyond loop 20 times?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 456, "user_id": 2380024, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/zc2mh.jpg?s=128&g=1", "display_name": "Greg Cobb", "link": "https://stackoverflow.com/users/2380024/greg-cobb"}, "edited": false, "score": 0, "creation_date": 1434635649, "post_id": 30905234, "comment_id": 49871881, "body": "@Fyndor correct, the &quot;20&quot; is a buffer for the channel, it will still work ithout it but the calls will block until you read the result, it can still block if the buffer gets filled and your reader is slow in processing (but it shouldn&#39;t happen with your example) and <code>for i := range [20]struct{}{}</code> is a fancy way of doing <code>for i := 0; i &lt; 20; i++</code>, it creates an array of 20 <code>struct{}</code> elements and loops on them, <code>struct{}</code> is special and uses 1 byte of memory at most."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 2, "last_activity_date": 1434592248, "creation_date": 1434592248, "answer_id": 30905234, "question_id": 30904885, "link": "https://stackoverflow.com/questions/30904885/how-do-i-synchronize-a-variable-number-of-channels-in-go/30905234#30905234", "title": "How do I synchronize a variable number of channels in Go?", "body": "<p>Like @JiangYD suggested, it's easier to just use one channel:</p>\n\n<pre><code>type resp struct {\n    id string\n    i  int\n}\n\nfunc Async(url string, c chan&lt;- resp, id string, count int) {\n    cnt := 0\n    for i := 0; i &lt; count; i++ {\n        GetPage(url)\n        cnt = cnt + 1\n        if cnt == 50 {\n            c &lt;- resp{id, i}\n            cnt = 0\n        }\n    }\n}\n\nfunc CallSync(w http.ResponseWriter, r *http.Request) {\n    t0 := time.Now()\n    ch := make(chan resp, 20)\n    for i := range [20]struct{}{} {\n        go Async(\"http://localhost:8080/\", ch, fmt.Sprintf(\"ch%02d\", i), 2000)\n    }\n    count := 0\n    for count &lt; 4000 {\n        select {\n        case r := &lt;-ch:\n            fmt.Printf(\"%+v\\n\", r)\n        default:\n        }\n    }\n    t1 := time.Now()\n    diff := t1.Sub(t0)\n    num := diff.Nanoseconds() / int64(time.Millisecond)\n    msec := float64(num) / 1000\n    reqsec := float64(count) / msec\n    fmt.Fprintf(w, \"%v requests\\n\", count)\n    fmt.Fprintf(w, \"Performed in %v\\n\", diff)\n    fmt.Fprintf(w, \"At a rate of %v (requests/sec)\\n\", reqsec)\n}\n</code></pre>\n\n<p>Another approach is to use <a href=\"http://golang.org/pkg/reflect/#Select\" rel=\"nofollow\"><code>reflect.Select</code></a> but that would just slow things down.</p>\n"}], "owner": {"reputation": 456, "user_id": 2380024, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/zc2mh.jpg?s=128&g=1", "display_name": "Greg Cobb", "link": "https://stackoverflow.com/users/2380024/greg-cobb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 30905234, "answer_count": 1, "score": 0, "last_activity_date": 1434592248, "creation_date": 1434589253, "question_id": 30904885, "link": "https://stackoverflow.com/questions/30904885/how-do-i-synchronize-a-variable-number-of-channels-in-go", "title": "How do I synchronize a variable number of channels in Go?", "body": "<p>I am testing out concurrency in Go by writing a client (in the form of a web server) that makes many requests to a web server and then returns how long it took to make those requests.  Basically a benchmark tool.  </p>\n\n<p>Here is to code I am using currently: <a href=\"http://pastebin.com/yE3BUbZQ\" rel=\"nofollow\">main.go</a></p>\n\n<p>I know my code has many flaws but the one I am concerned with at the moment is how much effort it takes test how performance would change if I add more go routine calls.  In the <strong>CallSync</strong> function I have to keep adding on to this massive select statement and to the massive list of calls to the func that starts the go routine.  I know there must be a better way.  I probably don't even need to synchronize like I am right now, but if I did how could I do this in a more flexible way?  I want to have code where I can specify the number of \"go routines\" to call and it will call that the routine that number of times and synchronize with all the associated channels without having to hard code it all.</p>\n"}, {"tags": ["json", "curl", "go"], "comments": [{"owner": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "edited": false, "score": 1, "creation_date": 1434588574, "post_id": 30904781, "comment_id": 49848017, "body": "Probably not related, but it&#39;s always a good idea to supply content type in the header as well with <code>-H &quot;Content-Type: application&#47;json&quot;</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": true, "score": 4, "last_activity_date": 1434589222, "creation_date": 1434589222, "answer_id": 30904882, "question_id": 30904781, "link": "https://stackoverflow.com/questions/30904781/json-decoding-in-golang/30904882#30904882", "title": "JSON decoding in golang", "body": "<p>golang use first character of the field to declare public or private for that struct. so change <code>username</code> to <code>Username</code></p>\n"}], "owner": {"reputation": 13743, "user_id": 1349334, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4871cc53634cc37f12e9cbe57ebc8961?s=128&d=identicon&r=PG", "display_name": "Yusuf X", "link": "https://stackoverflow.com/users/1349334/yusuf-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 856, "favorite_count": 0, "accepted_answer_id": 30904882, "answer_count": 1, "score": 0, "last_activity_date": 1434589222, "creation_date": 1434588456, "last_edit_date": 1495540897, "question_id": 30904781, "link": "https://stackoverflow.com/questions/30904781/json-decoding-in-golang", "title": "JSON decoding in golang", "body": "<p>So I tried something based on the example <a href=\"https://stackoverflow.com/questions/15672556/handling-json-post-request-in-go\">here</a> in my code, and get no data, but no error either. The code is:</p>\n\n<pre><code>import (\n    \"io\"\n    \"fmt\"\n    \"net/http\"\n    \"encoding/json\"\n)\n\ntype Credential struct {\n    username string `json:\"username\"`\n    password string `json:\"password\"`\n}\n\nfunc login(res http.ResponseWriter, req *http.Request) {\n    if req.Method == \"POST\" {\n        cred := Credential{}\n        err := json.NewDecoder(req.Body).Decode(&amp;cred)\n        if err != nil {\n            panic(\"can't decode\")\n        }\n        fmt.Println(\"credentials: \" + cred.username + \" , \" + cred.password)\n    }\n}\n</code></pre>\n\n<p>I test with</p>\n\n<blockquote>\n  <p>curl -X POST -H \"Accept: application/json\" --data \"{\\\"username\\\":\\\"x\\\",\\\"password\\\":\\\"y\\\"}\" 127.0.0.1:8000/login -i</p>\n</blockquote>\n\n<p>And the server prints out:</p>\n\n<blockquote>\n  <p>credentials:  , </p>\n</blockquote>\n\n<p>Why is there nothing in cred.username and cred.password?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1434588776, "post_id": 30904581, "comment_id": 49848062, "body": "<a href=\"https://github.com/kisielk/errcheck\" rel=\"nofollow noreferrer\">github.com/kisielk/errcheck</a> can check for ignored errors. I don&#39;t think it can check for ignored return values - i.e. where you don&#39;t check the returned bytes written and error from <code>fmt.Printf</code> and variants."}, {"owner": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1434609721, "post_id": 30904581, "comment_id": 49854241, "body": "Could the people adding -1 kindly explain why ? There is no sense in flagging a question without a comment. I have tried to obtain an answer and have not been able to find one."}], "answers": [{"comments": [{"owner": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "edited": false, "score": 0, "creation_date": 1434587607, "post_id": 30904685, "comment_id": 49847794, "body": "This is not for error alone but any generic return value. The code is with the error is only an example."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "edited": false, "score": 0, "creation_date": 1434588029, "post_id": 30904685, "comment_id": 49847896, "body": "answer still no. even if compile can check the assignment of returned value, how could we know the variable be used in right way?"}, {"owner": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "edited": false, "score": 0, "creation_date": 1434652585, "post_id": 30904685, "comment_id": 49883120, "body": "I want to figure out all instances where it is not assigned. Whether it is used the right way is the halting problem and I am not trying to solve it."}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 0, "last_activity_date": 1434587508, "creation_date": 1434587508, "answer_id": 30904685, "question_id": 30904581, "link": "https://stackoverflow.com/questions/30904581/more-strict-compile-options-in-golang/30904685#30904685", "title": "More strict compile options in GoLang", "body": "<p>No. even if compile can check the assignment of returned error, how could we know  the variable be checked in right way?\n<a href=\"https://golang.org/doc/faq#exceptions\" rel=\"nofollow\">faq</a> <a href=\"http://blog.golang.org/error-handling-and-go\" rel=\"nofollow\">errorhandle</a></p>\n"}, {"comments": [{"owner": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "edited": false, "score": 0, "creation_date": 1434652743, "post_id": 30908771, "comment_id": 49883220, "body": "Thanks. I was looking for something like -Wall -Werror present in gcc. I will look for some external tools if available."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1434611669, "creation_date": 1434611669, "answer_id": 30908771, "question_id": 30904581, "link": "https://stackoverflow.com/questions/30904581/more-strict-compile-options-in-golang/30908771#30908771", "title": "More strict compile options in GoLang", "body": "<p>This is not about the compiler being strict or not. The Go Language Specification allows calling functions and methods without using their return values.</p>\n\n<p>You won't see any compiler options that will stop the building process on use cases which do not violate the lang spec.</p>\n\n<p>What you want may be created or may already exist as an external tool, but not in the Go compiler itself.</p>\n"}], "owner": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 711, "favorite_count": 0, "accepted_answer_id": 30908771, "answer_count": 2, "score": 0, "last_activity_date": 1434611669, "creation_date": 1434586692, "last_edit_date": 1434610058, "question_id": 30904581, "link": "https://stackoverflow.com/questions/30904581/more-strict-compile-options-in-golang", "title": "More strict compile options in GoLang", "body": "<p>Is there an option in golang to fail build if a function returns a value and the returned value is not used? For example, I want an error / warning when we have:</p>\n\n<p><code>func abc() error</code></p>\n\n<p>and it is called without an lvalue as:</p>\n\n<p><code>abc()</code></p>\n\n<p><strong>EDIT</strong>: This is not for errors alone but for return values in general.</p>\n\n<p>Thanks</p>\n"}]