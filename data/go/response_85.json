[{"tags": ["go", "deadlock", "dump"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472072723, "post_id": 39132629, "comment_id": 65611311, "body": "What do you mean by a &quot;dump&quot;? Do you want a stack trace or a core file?"}, {"owner": {"reputation": 5392, "user_id": 361836, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/f426a26f03d7d4d61d354a3b2fc5337d?s=128&d=identicon&r=PG", "display_name": "lucidquiet", "link": "https://stackoverflow.com/users/361836/lucidquiet"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472073408, "post_id": 39132629, "comment_id": 65611626, "body": "I believe a core file.  I think I&#39;d need the entire state in order to figure out a deadlock issue.  A stacktrace would likely depend on the time at which I caused the stacktrace."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472073773, "post_id": 39132629, "comment_id": 65611799, "body": "A core file also depends on the state at the time you create it. A quick google points to <a href=\"https://support.microsoft.com/en-us/kb/241215\" rel=\"nofollow noreferrer\">support.microsoft.com/en-us/kb/241215</a>. A stack trace is a lot easier way to show where each goroutine is blocked."}], "answers": [{"tags": [], "owner": {"reputation": 1114, "user_id": 2774165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa4fc72d68e1c96217d0af4cc8d7a5a?s=128&d=identicon&r=PG", "display_name": "3rf", "link": "https://stackoverflow.com/users/2774165/3rf"}, "is_accepted": false, "score": 1, "last_activity_date": 1472096944, "creation_date": 1472096944, "answer_id": 39136399, "question_id": 39132629, "link": "https://stackoverflow.com/questions/39132629/how-can-you-force-a-dump-of-a-go-program-on-windows/39136399#39136399", "title": "How can you force a dump of a Go program on windows?", "body": "<p>I've done this using the <a href=\"https://golang.org/pkg/runtime/#Stack\" rel=\"nofollow\">runtime.Stack</a> function. Its output is equivalent to what you get from a panic(), but without halting the program. You can set up a signal handler to dump the stack to a file/stdout, or start a goroutine to dump the stack at regular intervals, if you prefer.</p>\n\n<p>You could also check out the <a href=\"https://golang.org/pkg/runtime/debug/#PrintStack\" rel=\"nofollow\">runtime/debug</a> package.</p>\n"}, {"tags": [], "owner": {"reputation": 3800, "user_id": 1037465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b68d0fdfc74f6a893936d043d2f545b?s=128&d=identicon&r=PG", "display_name": "a-h", "link": "https://stackoverflow.com/users/1037465/a-h"}, "is_accepted": false, "score": 0, "last_activity_date": 1472215051, "creation_date": 1472215051, "answer_id": 39166548, "question_id": 39132629, "link": "https://stackoverflow.com/questions/39132629/how-can-you-force-a-dump-of-a-go-program-on-windows/39166548#39166548", "title": "How can you force a dump of a Go program on windows?", "body": "<p>Goroutine deadlock analysis is handled well using the <code>trace</code> command.</p>\n\n<p>First, you need to get data to run a trace against, which you want at any point. You can get this by using the <code>pprof</code> package or the <code>trace</code> package.</p>\n\n<p><a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow\">https://golang.org/pkg/net/http/pprof/</a>\n<a href=\"https://golang.org/pkg/runtime/trace/\" rel=\"nofollow\">https://golang.org/pkg/runtime/trace/</a></p>\n\n<p>The <code>pprof</code> package will add its HTTP handlers to a web server and let you collect trace data while the app is running, while the <code>trace</code> package lets you write out a trace to a stream (e.g. a file), but I haven't tried that myself.</p>\n\n<p>Once you've collected trace data, you can run the <code>trace</code> command against the data you've collected to produce a web view of the state:</p>\n\n<p><a href=\"https://golang.org/cmd/trace/\" rel=\"nofollow\">https://golang.org/cmd/trace/</a></p>\n\n<p>There's an example output here:</p>\n\n<p><a href=\"https://talks.golang.org/2015/dynamic-tools.slide#30\" rel=\"nofollow\">https://talks.golang.org/2015/dynamic-tools.slide#30</a></p>\n"}], "owner": {"reputation": 5392, "user_id": 361836, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/f426a26f03d7d4d61d354a3b2fc5337d?s=128&d=identicon&r=PG", "display_name": "lucidquiet", "link": "https://stackoverflow.com/users/361836/lucidquiet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 692, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1472215051, "creation_date": 1472071012, "question_id": 39132629, "link": "https://stackoverflow.com/questions/39132629/how-can-you-force-a-dump-of-a-go-program-on-windows", "title": "How can you force a dump of a Go program on windows?", "body": "<p>I'm looking to do some kind of debugging on windows where the state of the service appears to be a deadlock.  Perhaps the approach would be to do a dump.  How can you do a program dump of a Go service?  And then analyze that dump?</p>\n"}, {"tags": ["generics", "model-view-controller", "go", "struct", "interface"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1472069582, "post_id": 39132056, "comment_id": 65609842, "body": "@kakysha I hope this helps."}, {"owner": {"reputation": 23, "user_id": 1111641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58924257352d1befc6a3869896a129da?s=128&d=identicon&r=PG", "display_name": "kakysha", "link": "https://stackoverflow.com/users/1111641/kakysha"}, "edited": false, "score": 1, "creation_date": 1472075864, "post_id": 39132056, "comment_id": 65612684, "body": "thank you! Very appreciate your help. Your solution works, but I went a little bit further and created an interface <code>Model</code> with <code>getID() int</code> and <code>setID(int)</code> methods, made <code>User</code> satisfy this interface and used <code>Model</code> instead of <code>interface{}</code> as parameter to method <code>Save(m Model)</code> to not pass id as second argument, only the struct itself. Also I needed it to assign ID field on passed structs after <code>INSERT ... RETURNING id</code>. Thanks again!, you saved me!"}, {"owner": {"reputation": 23, "user_id": 1111641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58924257352d1befc6a3869896a129da?s=128&d=identicon&r=PG", "display_name": "kakysha", "link": "https://stackoverflow.com/users/1111641/kakysha"}, "edited": false, "score": 1, "creation_date": 1472114356, "post_id": 39132056, "comment_id": 65625362, "body": "saw your update about getters and setters. Made User.ID unexported and renamed getID() to ID(), thanks again. For some reason <code>golint</code> didn&#39;t complain about it :("}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 3, "last_activity_date": 1472096750, "last_edit_date": 1472096750, "creation_date": 1472068676, "answer_id": 39132056, "question_id": 39131886, "link": "https://stackoverflow.com/questions/39131886/one-method-to-handle-all-the-struct-types-that-embed-one-common-struct-json-mar/39132056#39132056", "title": "One method to handle all the struct types that embed one common struct (json marshalling)", "body": "<p>You may use one <code>func Save(d interface{})</code> like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype User struct {\n    ID   int\n    Name string\n}\n\ntype Admin struct {\n    User\n    Level int\n}\n\nfunc main() {\n    Save(User{})\n    Save(Admin{})\n}\n\nfunc Save(d interface{}) {\n    body, err := json.Marshal(d)\n    if err != nil {\n        panic(err)\n    }\n    st := string(body)\n    fmt.Println(st)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{\"ID\":0,\"Name\":\"\"}\n{\"ID\":0,\"Name\":\"\",\"Level\":0}\n</code></pre>\n\n<hr>\n\n<p>for your case, use this one function for all types:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Save(i interface{}, id int) {\n    data, err := json.Marshal(i)\n    check(err)\n    if id == 0 {\n        _, err = app.DB.Exec(`INSERT INTO users(data) VALUES ($1) `, string(data))\n    } else {\n        _, err = app.DB.Exec(`UPDATE users SET data = $1 WHERE id=$2`, string(data), id)\n    }\n    check(err)\n}\n</code></pre>\n\n<p>And call it like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>u := User{}\na := Admin{}\n\nSave(u, u.ID)\nSave(a, a.ID)\n</code></pre>\n\n<hr>\n\n<p>And Yes, this is even simplifies call to <code>Save</code> to one parameter:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Model interface {\n    ID() int\n    setID(int)\n}\n\ntype User struct {\n    Id   int\n    Name string\n}\n\nfunc (t User) ID() int      { return t.Id }\nfunc (t User) setID(id int) { t.Id = id }\n\ntype Admin struct {\n    User\n    Level int\n}\n\nfunc main() {\n    Save(User{})\n    Save(Admin{})\n}\n\nfunc Save(d Model) {\n    body, err := json.Marshal(d)\n    if err != nil {\n        panic(err)\n    }\n    st := string(body)\n    fmt.Println(st)\n\n    fmt.Println(\"ID is \", d.ID())\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{\"Id\":0,\"Name\":\"\"}\nID is  0\n{\"Id\":0,\"Name\":\"\",\"Level\":0}\nID is  0\n</code></pre>\n\n<hr>\n\n<p>Now You may use this one function for all types:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Save(i Model) {\n    data, err := json.Marshal(i)\n    check(err)\n    id := i.ID()\n    if id == 0 {\n        _, err = app.DB.Exec(`INSERT INTO users(data) VALUES ($1) `, string(data))\n    } else {\n        _, err = app.DB.Exec(`UPDATE users SET data = $1 WHERE id=$2`, string(data), id)\n    }\n    check(err)\n}\n</code></pre>\n\n<p>And call it like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>u := User{}\na := Admin{}\n\nSave(u)\nSave(a)\n</code></pre>\n\n<hr>\n\n<p><a href=\"https://golang.org/doc/effective_go.html#Getters\" rel=\"nofollow\">Effective Go</a>:</p>\n\n<blockquote>\n  <p>Getters</p>\n  \n  <p>Go doesn't provide automatic support for getters and setters. There's\n  nothing wrong with providing getters and setters yourself, and it's\n  often appropriate to do so, but it's neither idiomatic nor necessary\n  to put Get into the getter's name. If you have a field called owner\n  (lower case, unexported), the getter method should be called Owner\n  (upper case, exported), not GetOwner. The use of upper-case names for\n  export provides the hook to discriminate the field from the method. A\n  setter function, if needed, will likely be called SetOwner. Both names\n  read well in practice:</p>\n\n<pre><code>owner := obj.Owner()\nif owner != user {\n    obj.SetOwner(user)\n}\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 23, "user_id": 1111641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58924257352d1befc6a3869896a129da?s=128&d=identicon&r=PG", "display_name": "kakysha", "link": "https://stackoverflow.com/users/1111641/kakysha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 302, "favorite_count": 0, "accepted_answer_id": 39132056, "answer_count": 1, "score": 1, "last_activity_date": 1472096750, "creation_date": 1472068018, "last_edit_date": 1472069460, "question_id": 39131886, "link": "https://stackoverflow.com/questions/39131886/one-method-to-handle-all-the-struct-types-that-embed-one-common-struct-json-mar", "title": "One method to handle all the struct types that embed one common struct (json marshalling)", "body": "<p>I have a gin-gonic web app with somewhat MVC architecture. I created a couple of models, all of them embed one common struct:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type User struct {\n   ID int\n   Name string\n}\n\ntype Admin struct {\n   User\n   Level int\n}\n\n... {\n   User\n}\n</code></pre>\n\n<p>Now I want to store them in database in json format. The goal I want to accomplish is to code only one function/method that will marshal any model and will save save it into DB. This method must marshal all the fields of current model, not only from User struct, e.g. User must be marshaled into <code>{id: 1, name: \"zhora\"}</code>, while Admin will go into <code>{id: 1, name: \"gena\", level: 2}</code>.</p>\n\n<p>Like this one:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (i *User) Save() {\n  data, err := json.Marshal(i)\n  check(err)\n  if i.ID == 0 {\n    _, err = app.DB.Exec(`INSERT INTO users(data) VALUES ($1) `, string(data))\n  } else {\n    _, err = app.DB.Exec(`UPDATE users SET data = $1 WHERE id=$2`, string(data), i.ID)\n  }\n  check(err)\n}\n</code></pre>\n\n<p>Right now I have to copy/paste this <code>func</code> to every model file, changing only method receiver. Can this be avoided?</p>\n"}, {"tags": ["go", "data-structures"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1472063741, "post_id": 39130593, "comment_id": 65606791, "body": "what is in your data, in runtime?"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472063807, "post_id": 39130593, "comment_id": 65606831, "body": "Check whether the runtime types are the same before doing this using reflect.TypeOf()"}, {"owner": {"reputation": 453, "user_id": 4868267, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d390efb3fd7d28967f9bf357d2d9f48e?s=128&d=identicon&r=PG&f=1", "display_name": "bmacrevolution", "link": "https://stackoverflow.com/users/4868267/bmacrevolution"}, "edited": false, "score": 0, "creation_date": 1472064362, "post_id": 39130593, "comment_id": 65607144, "body": "I plan on it being a string or an integer. Similar to how you can use &lt;T&gt; in java and .compareTo()"}, {"owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "edited": false, "score": 0, "creation_date": 1472065390, "post_id": 39130593, "comment_id": 65607709, "body": "Go is not Java. You might get some inspiration from <a href=\"https://github.com/emirpasic/gods/blob/master/trees/btree/btree.go\" rel=\"nofollow noreferrer\">github.com/emirpasic/gods/blob/master/trees/btree/btree.go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 453, "user_id": 4868267, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d390efb3fd7d28967f9bf357d2d9f48e?s=128&d=identicon&r=PG&f=1", "display_name": "bmacrevolution", "link": "https://stackoverflow.com/users/4868267/bmacrevolution"}, "edited": false, "score": 0, "creation_date": 1472064743, "post_id": 39130940, "comment_id": 65607375, "body": "Could you give me a quick example of how you would use Less in this context?"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 4, "last_activity_date": 1472065629, "last_edit_date": 1472065629, "creation_date": 1472064548, "answer_id": 39130940, "question_id": 39130593, "link": "https://stackoverflow.com/questions/39130593/how-can-i-compare-struct-data-and-interface-data-in-golang/39130940#39130940", "title": "How can I compare struct data and interface data in Golang?", "body": "<p>You have some options:<br>\n1-  Using runtime type switch: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(Less(1, 2))       // true\n    fmt.Println(Less(\"AB\", \"AC\")) // true\n}\n\nfunc Less(a, b interface{}) bool {\n    switch v := a.(type) {\n    case int:\n        w := b.(int)\n        return v &lt; w\n    case string:\n        w := b.(string)\n        return v &lt; w\n\n    }\n    return false\n}\n</code></pre>\n\n<p>then replace <code>} else if cur.data &lt; data {</code> with \n<code>} else if Less(cur.data , data) {</code></p>\n\n<hr>\n\n<p>2- Using <code>Comparer interface</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Comparer interface {\n    // Less reports whether the element  is less than b\n    Less(b interface{}) bool\n}\n\nfunc main() {\n    a, b := Int(1), Int(2)\n    fmt.Println(a.Less(b)) // true\n\n    c, d := St(\"A\"), St(\"B\")\n    fmt.Println(c.Less(d)) // true\n}\n\ntype Int int\n\nfunc (t Int) Less(b interface{}) bool {\n    if v, ok := b.(Int); ok {\n        return int(t) &lt; int(v)\n    }\n    return false\n}\n\ntype St string\n\nfunc (t St) Less(b interface{}) bool {\n    if v, ok := b.(St); ok {\n        return string(t) &lt; string(v)\n    }\n    return false\n}\n</code></pre>\n\n<hr>\n\n<p>3- Using <code>reflect</code></p>\n"}], "owner": {"reputation": 453, "user_id": 4868267, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d390efb3fd7d28967f9bf357d2d9f48e?s=128&d=identicon&r=PG&f=1", "display_name": "bmacrevolution", "link": "https://stackoverflow.com/users/4868267/bmacrevolution"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1100, "favorite_count": 1, "accepted_answer_id": 39130940, "answer_count": 1, "score": 1, "last_activity_date": 1472067272, "creation_date": 1472063334, "last_edit_date": 1472067272, "question_id": 39130593, "link": "https://stackoverflow.com/questions/39130593/how-can-i-compare-struct-data-and-interface-data-in-golang", "title": "How can I compare struct data and interface data in Golang?", "body": "<p>I am trying to create a generic Binary Tree in Golang. How can I compare data from an interface and input data in the code? Here is an example of what I am trying to do. The comparison that is giving me trouble is this</p>\n\n<pre><code> } else if cur.data &lt; data {\n</code></pre>\n\n<p>-</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package DSAA\n\ntype TreeNode struct {\n    data interface{}\n    right *TreeNode\n    left *TreeNode\n}\n\ntype BinarySearchTree struct {\n    root *TreeNode\n}\n\nfunc BSTCreate() *BinarySearchTree {\n    return &amp;BinarySearchTree{nil}\n}\n\nfunc (b *BinarySearchTree) Insert(cur TreeNode, data interface{}) *BinarySearchTree {\n    if &amp;cur == nil {\n        cur := &amp;TreeNode{data, nil, nil}\n    } else if cur.data &lt; data {\n        b = b.Insert(*cur.left, data)\n    } else {\n        b = b.Insert(*cur.right, data)\n    }\n    return b\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "bson"], "comments": [{"owner": {"reputation": 1114, "user_id": 2774165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa4fc72d68e1c96217d0af4cc8d7a5a?s=128&d=identicon&r=PG", "display_name": "3rf", "link": "https://stackoverflow.com/users/2774165/3rf"}, "edited": false, "score": 0, "creation_date": 1472097143, "post_id": 39130567, "comment_id": 65617670, "body": "This sounds like a problem with the BSON document, not your code. Where is the document coming from?"}, {"owner": {"reputation": 127, "user_id": 2076779, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1288330c0412eff3efab846589844d35?s=128&d=identicon&r=PG", "display_name": "ryknow", "link": "https://stackoverflow.com/users/2076779/ryknow"}, "reply_to_user": {"reputation": 1114, "user_id": 2774165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa4fc72d68e1c96217d0af4cc8d7a5a?s=128&d=identicon&r=PG", "display_name": "3rf", "link": "https://stackoverflow.com/users/2774165/3rf"}, "edited": false, "score": 0, "creation_date": 1472120493, "post_id": 39130567, "comment_id": 65629476, "body": "The document is provided by another team.  I am responsible for pulling and ingesting the data into the system that I work with."}, {"owner": {"reputation": 127, "user_id": 2076779, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1288330c0412eff3efab846589844d35?s=128&d=identicon&r=PG", "display_name": "ryknow", "link": "https://stackoverflow.com/users/2076779/ryknow"}, "reply_to_user": {"reputation": 1114, "user_id": 2774165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa4fc72d68e1c96217d0af4cc8d7a5a?s=128&d=identicon&r=PG", "display_name": "3rf", "link": "https://stackoverflow.com/users/2774165/3rf"}, "edited": false, "score": 0, "creation_date": 1472146625, "post_id": 39130567, "comment_id": 65646490, "body": "I spoke with the other team and was told that they have a script for querying MongoDB and dumping the results into a file and that is what I am pulling."}, {"owner": {"reputation": 1114, "user_id": 2774165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa4fc72d68e1c96217d0af4cc8d7a5a?s=128&d=identicon&r=PG", "display_name": "3rf", "link": "https://stackoverflow.com/users/2774165/3rf"}, "edited": false, "score": 1, "creation_date": 1472153836, "post_id": 39130567, "comment_id": 65650231, "body": "Does your BSON literally look like the human-readable <code>{ &quot;group&quot; : { &quot;id&quot;: ObjectId(&quot;11a123456bc345d452d32c0b5&quot;), &quot;name&quot;: &quot;SomeName&quot; }, &quot;count1&quot;: 6, &quot;count2&quot;: 33, &quot;totalCount&quot;: 39 }</code> or is it in binary form?"}, {"owner": {"reputation": 1114, "user_id": 2774165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa4fc72d68e1c96217d0af4cc8d7a5a?s=128&d=identicon&r=PG", "display_name": "3rf", "link": "https://stackoverflow.com/users/2774165/3rf"}, "edited": false, "score": 1, "creation_date": 1472154255, "post_id": 39130567, "comment_id": 65650462, "body": "If they want to get you BSON, they should be using the mongodump tool. I would double-check with them to make sure. It would be really helpful if you could outline their workflow here."}, {"owner": {"reputation": 127, "user_id": 2076779, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1288330c0412eff3efab846589844d35?s=128&d=identicon&r=PG", "display_name": "ryknow", "link": "https://stackoverflow.com/users/2076779/ryknow"}, "reply_to_user": {"reputation": 1114, "user_id": 2774165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa4fc72d68e1c96217d0af4cc8d7a5a?s=128&d=identicon&r=PG", "display_name": "3rf", "link": "https://stackoverflow.com/users/2774165/3rf"}, "edited": false, "score": 0, "creation_date": 1472227101, "post_id": 39130567, "comment_id": 65683045, "body": "They were apparently just issuing queries to MongoDB and dumping the results into a file which as you mention is MongoDB extended JSON.  I have gone to the team and they are now outputting JSON."}], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 2076779, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1288330c0412eff3efab846589844d35?s=128&d=identicon&r=PG", "display_name": "ryknow", "link": "https://stackoverflow.com/users/2076779/ryknow"}, "edited": false, "score": 0, "creation_date": 1472146571, "post_id": 39142411, "comment_id": 65646466, "body": "This does not seem to give the desired effect.  I end up with the whole &quot;bson data&quot; as the key in the map and nil value."}, {"owner": {"reputation": 1114, "user_id": 2774165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fa4fc72d68e1c96217d0af4cc8d7a5a?s=128&d=identicon&r=PG", "display_name": "3rf", "link": "https://stackoverflow.com/users/2774165/3rf"}, "edited": false, "score": 2, "creation_date": 1472153992, "post_id": 39142411, "comment_id": 65650325, "body": "The string you are using as bsonData above is not valid BSON. It&#39;s MongoDB Extended JSON. As the spec explains, BSON is a binary format."}], "tags": [], "owner": {"reputation": 552, "user_id": 2627768, "user_type": "registered", "profile_image": "https://graph.facebook.com/1363681401/picture?type=large", "display_name": "foecum", "link": "https://stackoverflow.com/users/2627768/foecum"}, "is_accepted": false, "score": 2, "last_activity_date": 1472120329, "last_edit_date": 1495542255, "creation_date": 1472119822, "answer_id": 39142411, "question_id": 39130567, "link": "https://stackoverflow.com/questions/39130567/unmarshalling-bson-data-using-gobson-mgo/39142411#39142411", "title": "Unmarshalling BSON data using Gobson/Mgo", "body": "<p>I tried out your code above and I managed to get it to \"work\". The reason you are getting </p>\n\n<pre><code>Unknown element kind (0x7B)\n</code></pre>\n\n<p>is because there is no element of kind <code>0x7B</code>  in the BSON specification. See here <a href=\"http://bsonspec.org/spec.html\" rel=\"nofollow noreferrer\">http://bsonspec.org/spec.html</a>. The particular unknow element I was getting was the byte value for the first curly bracket({) in your document</p>\n\n<pre><code>{ \"group\" : { \"id\": ObjectId(\"11a123456bc345d452d32c0b5\"), \"name\": \"SomeName\" }, \"count1\": 6, \"count2\": 33, \"totalCount\": 39 }\n</code></pre>\n\n<p>after tweaking the code a bit I was able to get it working with out the <code>unknown kind</code> error.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/binary\"\n    \"fmt\"\n\n    \"gopkg.in/mgo.v2/bson\"\n)\n\nfunc main() {\n    bsonData := `{ \"group\" : { \"id\": ObjectId(\"11a123456bc345d452d32c0b5\"), \"name\": \"SomeName\" }, \"count1\": 6, \"count2\": 33, \"totalCount\": 39 }`\n\n    var record map[string]interface{}\n\n    rec := make([]byte, len(bsonData)+6)\n    binary.LittleEndian.PutUint32(rec, uint32(len(rec)))\n    copy(rec[4:], bsonData)\n    //Adding a new line to the front of the rec byte variable seems to do the trick\n    r := []byte(\"\\n\")\n    rec[4] = r[0]\n    err := bson.Unmarshal(rec, &amp;record)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(record)\n}\n</code></pre>\n\n<p>I also found this answer to be of great use <a href=\"https://stackoverflow.com/a/33129119/2627768\">https://stackoverflow.com/a/33129119/2627768</a></p>\n"}], "owner": {"reputation": 127, "user_id": 2076779, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1288330c0412eff3efab846589844d35?s=128&d=identicon&r=PG", "display_name": "ryknow", "link": "https://stackoverflow.com/users/2076779/ryknow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3330, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1472120329, "creation_date": 1472063260, "question_id": 39130567, "link": "https://stackoverflow.com/questions/39130567/unmarshalling-bson-data-using-gobson-mgo", "title": "Unmarshalling BSON data using Gobson/Mgo", "body": "<p>I am receiving different BSON documents, an example seen here:</p>\n\n<pre><code>{ \"group\" : { \"id\": ObjectId(\"11a123456bc345d452d32c0b5\"), \"name\": \"SomeName\" }, \"count1\": 6, \"count2\": 33, \"totalCount\": 39 }\n</code></pre>\n\n<p>I am trying to use mgo/gobson to unmarshal this data into a map[string]interface{}, but keep getting an error.  The unmarshalling code is</p>\n\n<pre><code>var record map[string]interface{}\n\nerr := bson.Unmarshal(data, &amp;record)\n</code></pre>\n\n<p>This resulted in a error saying the document was corrupted.  Looking into the code I saw that it expected the length of the byte array to be the first few bytes so I added code similar to what is found in the tests.</p>\n\n<pre><code>rec := make([]byte, len(data)+6)\nbinary.LittleEndian.PutUint32(rec, uint32(len(rec)))\ncopy(rec[4:], data)\n</code></pre>\n\n<p>This got me past the corrupt document error, but now I am getting </p>\n\n<pre><code>Unknown element kind (0x7B)\n</code></pre>\n\n<p>What am I doing wrong that I can't easily unmarshal the above BSON document into a map?  Is there a problem with the BSON document itself?  I am not the creator of the BSON document, but am able to provide feedback to them if necessary.</p>\n"}, {"tags": ["ssl", "go", "tls1.2"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472050630, "post_id": 39126345, "comment_id": 65598933, "body": "You&#39;re probably not connecting to a TLS server. How is your server configured? Do you need to use StartTLS? Is TLS on a different port? Are you suing TLS at all?"}], "answers": [{"tags": [], "owner": {"reputation": 4366, "user_id": 176478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a10b460f85d3d8b9702782bf6dd72307?s=128&d=identicon&r=PG", "display_name": "dmportella", "link": "https://stackoverflow.com/users/176478/dmportella"}, "is_accepted": true, "score": 5, "last_activity_date": 1472051780, "last_edit_date": 1592644375, "creation_date": 1472051780, "answer_id": 39127194, "question_id": 39126345, "link": "https://stackoverflow.com/questions/39126345/why-am-i-receiving-an-oversized-record-tls-error/39127194#39127194", "title": "Why am I receiving an oversized record TLS error?", "body": "<p>Like the example of the go-xmpp package you are using it expects the port too for the tls.</p>\n<p>So with out it will try to connect to the HTTP end point and give you this error. You will see errors like this when the endpoint supports only HTTP or HTTPS with an unknown CA certificate.</p>\n<p>Note that the package you are using also supports No TLS double check DuckGo xmpp requirements and change your code to match them.</p>\n<p>Other posts like this</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/36073179/tls-oversized-record-received-with-length-xxxxx?rq=1\">tls: oversized record received with length XXXXX</a></li>\n</ul>\n<h3>Example</h3>\n<p><a href=\"https://github.com/mattn/go-xmpp/blob/master/_example/example.go\" rel=\"nofollow noreferrer\">https://github.com/mattn/go-xmpp/blob/master/_example/example.go</a></p>\n<pre><code>// Server has the port\nvar server = flag.String(&quot;server&quot;, &quot;talk.google.com:443&quot;, &quot;server&quot;)\nvar username = flag.String(&quot;username&quot;, &quot;&quot;, &quot;username&quot;)\nvar password = flag.String(&quot;password&quot;, &quot;&quot;, &quot;password&quot;)\nvar status = flag.String(&quot;status&quot;, &quot;xa&quot;, &quot;status&quot;)\nvar statusMessage = flag.String(&quot;status-msg&quot;, &quot;I for one welcome our new codebot overlords.&quot;, &quot;status message&quot;)\nvar notls = flag.Bool(&quot;notls&quot;, false, &quot;No TLS&quot;)\nvar debug = flag.Bool(&quot;debug&quot;, false, &quot;debug output&quot;)\nvar session = flag.Bool(&quot;session&quot;, false, &quot;use server session&quot;)\n\n// Omitted code\n\nvar talk *xmpp.Client\nvar err error\noptions := xmpp.Options{Host: *server,\n    User:          *username,\n    Password:      *password,\n    NoTLS:         *notls,\n    Debug:         *debug,\n    Session:       *session,\n    Status:        *status,\n    StatusMessage: *statusMessage,\n}\n\ntalk, err = options.NewClient()\n</code></pre>\n"}], "owner": {"reputation": 15832, "user_id": 1156707, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/99055b620fb3a9d30a8f6ac480c25227?s=128&d=identicon&r=PG", "display_name": "Louis Thibault", "link": "https://stackoverflow.com/users/1156707/louis-thibault"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7393, "favorite_count": 1, "accepted_answer_id": 39127194, "answer_count": 1, "score": 8, "last_activity_date": 1563181560, "creation_date": 1472049524, "last_edit_date": 1472051012, "question_id": 39126345, "link": "https://stackoverflow.com/questions/39126345/why-am-i-receiving-an-oversized-record-tls-error", "title": "Why am I receiving an oversized record TLS error?", "body": "<p>I'm trying to use <a href=\"https://github.com/mattn/go-xmpp\" rel=\"noreferrer\"><code>go-xmpp</code></a> to connect to <a href=\"https://duck.co/blog/post/2/using-pidgin-with-xmpp-jabber\" rel=\"noreferrer\">DuckDuckGo's XMPP services</a>.</p>\n\n<p>Below is my test-case:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"log\"\n\n    \"github.com/mattn/go-xmpp\"\n)\n\nconst (\n    svr = \"dukgo.com\"\n    usr = \"testtesttest\"\n    pwd = \"test123\"\n)\n\nfunc main() {\n    xmpp.DefaultConfig = tls.Config{\n        ServerName:         svr,\n        InsecureSkipVerify: false,\n    }\n\n    options := xmpp.Options{\n        Host:     svr,\n        User:     usr,\n        Password: pwd,\n    }\n\n    _, err := options.NewClient()\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>The <code>log.Fatal</code> block is being executed and returns the following error message:</p>\n\n<pre><code>2016/08/24 16:32:27 tls: oversized record received with length 28012\nexit status 1\n</code></pre>\n\n<p>Googling the error points me towards an identical error in Docker, so that's not exactly helpful.  What does this error mean?  What can I do to fix this?</p>\n"}, {"tags": ["go", "treeview", "gtk3"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1472059273, "post_id": 39126267, "comment_id": 65604327, "body": "Looks to me like <code>IterParent</code> does exist: <a href=\"https://github.com/mattn/go-gtk/blob/57d483abd6e13880b69a59a932167ac1c278a872/gtk/gtk.go#L4204\" rel=\"nofollow noreferrer\">github.com/mattn/go-gtk/blob/&hellip;</a> (upper-case, as it&#39;s part of the public API, <code>iterParent</code> won&#39;t work...)"}, {"owner": {"reputation": 31, "user_id": 6751964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4LUW0.gif?s=128&g=1", "display_name": "bul", "link": "https://stackoverflow.com/users/6751964/bul"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1472098931, "post_id": 39126267, "comment_id": 65618106, "body": "sorry for not having clarified: I used <b>github.com/gotk3</b> not seen IterParent (uppercase or lowercase) I tried <b>github.com/mattn/go-gtk</b>"}, {"owner": {"reputation": 31, "user_id": 6751964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4LUW0.gif?s=128&g=1", "display_name": "bul", "link": "https://stackoverflow.com/users/6751964/bul"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1472118352, "post_id": 39126267, "comment_id": 65628022, "body": "error github.com/mattn/go-gtk/gtk ; runtime.cgocall(0x5315e0, 0xc42004fdc0, 0x0) \t/mnt/ext/Exec/go/src/runtime/cgocall.go:131 +0x110 fp=0xc42004fd90 sp=0xc42004fd50... with linux manjaro"}, {"owner": {"reputation": 31, "user_id": 6751964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4LUW0.gif?s=128&g=1", "display_name": "bul", "link": "https://stackoverflow.com/users/6751964/bul"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1472125405, "post_id": 39126267, "comment_id": 65632647, "body": "eventually I&#39;ll manage with gtk.TreePath. thank you"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1472125479, "post_id": 39126267, "comment_id": 65632700, "body": "Oh, that error is one of the open issues, I&#39;ve just changed the <code>gtk.Init(&amp;os.Args)</code> to <code>gtk.Init(nil)</code>, that solves that problem. Obviously, it only works if you&#39;re not passing arguments when running the program, haven&#39;t looked at gotk3 though, go-gtk seems to have died, so you might be using the better package"}, {"owner": {"reputation": 31, "user_id": 6751964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4LUW0.gif?s=128&g=1", "display_name": "bul", "link": "https://stackoverflow.com/users/6751964/bul"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1472130611, "post_id": 39126267, "comment_id": 65636269, "body": "thank you for your intervention and your help. github.com/gotk3/gotk3/gtk should suit me"}], "owner": {"reputation": 31, "user_id": 6751964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4LUW0.gif?s=128&g=1", "display_name": "bul", "link": "https://stackoverflow.com/users/6751964/bul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 561, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472051315, "creation_date": 1472049331, "last_edit_date": 1472051315, "question_id": 39126267, "link": "https://stackoverflow.com/questions/39126267/treeview-with-golang-and-gtk3", "title": "treeview with golang and gtk3", "body": "<p>I use golang with gtk3</p>\n\n<p>it works pretty</p>\n\n<p><em>treeview</em> :</p>\n\n<pre><code>tv, _ := gtk.TreeViewNew()\n...\ntvmodel,_ := tv.GetModel()\nsel,_ := tv.GetSelection()\nmodel,iter,ok := sel.GetSelected()\n</code></pre>\n\n<p>gives the selected node</p>\n\n<p><em>to manage children</em> :</p>\n\n<pre><code>nenf:=tvmodel.IterNChildren(iter)\nvar child gtk.TreeIter\nfor ind:=0; ind&lt;nenf; ind++ {\n    tvmodel.IterNthChild(&amp;child,iter,ind)\n    ...\n</code></pre>\n\n<p>it works</p>\n\n<p>but <em>how to find the parent</em> ?</p>\n\n<p><code>iterParent</code> (or equivalent) seems not to exist</p>\n"}, {"tags": ["go", "x509"], "answers": [{"comments": [{"owner": {"reputation": 146, "user_id": 3880239, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7OFdA.jpg?s=128&g=1", "display_name": "Trane9991", "link": "https://stackoverflow.com/users/3880239/trane9991"}, "edited": false, "score": 0, "creation_date": 1527844453, "post_id": 39138112, "comment_id": 88289947, "body": "This code is not going to work, because <code>namespace.ToRDNSequence()</code> would not recreate the original RDNSequence of the certificate, it will add the objects only defined in the stdlib, so the ones NOT defined there will be missing. Se the working code example in my answer below."}], "tags": [], "owner": {"reputation": 111, "user_id": 6752987, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/114f201167cf042c69e1aa84bab263a5?s=128&d=identicon&r=PG&f=1", "display_name": "tgo", "link": "https://stackoverflow.com/users/6752987/tgo"}, "is_accepted": false, "score": 6, "last_activity_date": 1472106395, "creation_date": 1472106395, "answer_id": 39138112, "question_id": 39125873, "link": "https://stackoverflow.com/questions/39125873/golang-subject-dn-from-x509-cert/39138112#39138112", "title": "golang subject dn from x509 cert", "body": "<p>Solution (thanks to a colleague):</p>\n\n<pre><code>var oid = map[string]string{\n    \"2.5.4.3\":                    \"CN\",\n    \"2.5.4.4\":                    \"SN\",\n    \"2.5.4.5\":                    \"serialNumber\",\n    \"2.5.4.6\":                    \"C\",\n    \"2.5.4.7\":                    \"L\",\n    \"2.5.4.8\":                    \"ST\",\n    \"2.5.4.9\":                    \"streetAddress\",\n    \"2.5.4.10\":                   \"O\",\n    \"2.5.4.11\":                   \"OU\",\n    \"2.5.4.12\":                   \"title\",\n    \"2.5.4.17\":                   \"postalCode\",\n    \"2.5.4.42\":                   \"GN\",\n    \"2.5.4.43\":                   \"initials\",\n    \"2.5.4.44\":                   \"generationQualifier\",\n    \"2.5.4.46\":                   \"dnQualifier\",\n    \"2.5.4.65\":                   \"pseudonym\",\n    \"0.9.2342.19200300.100.1.25\": \"DC\",\n    \"1.2.840.113549.1.9.1\":       \"emailAddress\",\n    \"0.9.2342.19200300.100.1.1\":  \"userid\",\n}\n\nfunc getDNFromCert(namespace pkix.Name, sep string) (string, error) {\n    subject := []string{}\n    for _, s := range namespace.ToRDNSequence() {\n        for _, i := range s {\n            if v, ok := i.Value.(string); ok {\n                if name, ok := oid[i.Type.String()]; ok {\n                    // &lt;oid name&gt;=&lt;value&gt;\n                    subject = append(subject, fmt.Sprintf(\"%s=%s\", name, v))\n                } else {\n                    // &lt;oid&gt;=&lt;value&gt; if no &lt;oid name&gt; is found\n                    subject = append(subject, fmt.Sprintf(\"%s=%s\", i.Type.String(), v))\n                }\n            } else {\n                // &lt;oid&gt;=&lt;value in default format&gt; if value is not string\n                subject = append(subject, fmt.Sprintf(\"%s=%v\", i.Type.String, v))\n            }\n        }\n    }\n    return sep + strings.Join(subject, sep), nil\n}\n</code></pre>\n\n<p>calling the function:</p>\n\n<pre><code>subj, err := getDNFromCert(x509Cert.Subject, \"/\")\nif err != nil {\n   // do error handling\n}\nfmt.Println(subj)\n</code></pre>\n\n<p>output (example):</p>\n\n<pre><code>/C=US/O=some organization/OU=unit/CN=common name\n</code></pre>\n\n<p>this seems to be the only \"easy\" solution</p>\n"}, {"tags": [], "owner": {"reputation": 461, "user_id": 4816776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SgfL2.jpg?s=128&g=1", "display_name": "Nikolay Bystritskiy", "link": "https://stackoverflow.com/users/4816776/nikolay-bystritskiy"}, "is_accepted": false, "score": 1, "last_activity_date": 1523654406, "creation_date": 1523654406, "answer_id": 49825279, "question_id": 39125873, "link": "https://stackoverflow.com/questions/39125873/golang-subject-dn-from-x509-cert/49825279#49825279", "title": "golang subject dn from x509 cert", "body": "<p>I faced the same task today. You could get subject from certificate this way:</p>\n\n<pre><code>// d is []byte with your certificate\ncert, err := x509.ParseCertificate(d)\nfmt.Printf(\"%+v\\n\", cert.Subject.ToRDNSequence())\n\n// Output: CN=client1,OU=MyClients,O=MongoDB-Cluster,L=Austin,ST=TX,C=US\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 146, "user_id": 3880239, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7OFdA.jpg?s=128&g=1", "display_name": "Trane9991", "link": "https://stackoverflow.com/users/3880239/trane9991"}, "is_accepted": false, "score": 1, "last_activity_date": 1527858858, "last_edit_date": 1527858858, "creation_date": 1527844925, "answer_id": 50640119, "question_id": 39125873, "link": "https://stackoverflow.com/questions/39125873/golang-subject-dn-from-x509-cert/50640119#50640119", "title": "golang subject dn from x509 cert", "body": "<p>In order to get complete subject DN (or issuer DN) from an x509 certificate, you may use next code:</p>\n\n<pre><code>cert, err := x509.ParseCertificate(certData)\nif err != nil {\n    return err\n}\n\nvar subject pkix.RDNSequence\nif _, err := asn1.Unmarshal(cert.RawSubject, &amp;subject); err != nil {\n    return err\n}\n\nfmt.Plrintln(subject.String()\n</code></pre>\n\n<p>Similarly, if you need to get only some specific object value from the subject (or issuer) you may use next approach. Example below retrieves UID from subject (which is not defined in the stdlib <a href=\"https://github.com/golang/go/issues/25667\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/25667</a>) </p>\n\n<pre><code>// http://www.alvestrand.no/objectid/0.9.2342.19200300.100.1.1.html\nconst oidUserID = \"0.9.2342.19200300.100.1.1\"\nvar UID string\n\ncert, err := x509.ParseCertificate(certData)\nif err != nil {\n    return err\n}\n\n// manually parsing the Certificate subject to get the\n// UID field, which is being ignored by the stdlib\n// https://github.com/golang/go/issues/25667\nvar subject pkix.RDNSequence\nif _, err := asn1.Unmarshal(cert.RawSubject, &amp;subject); err != nil {\n    return err\n}\n\nfor _, s := range subject {\n    for _, i := range s {\n        if i.Type.String() == oidUserID {\n            if v, ok := i.Value.(string); ok {\n                UID = v\n            }\n        }\n    }\n}\n\nfmt.Println(UID)\n</code></pre>\n\n<p><strong>UPDATE</strong>:\nSimplified way to get the UID, thanks to <a href=\"https://github.com/FiloSottile\" rel=\"nofollow noreferrer\">@FiloSottile</a>:</p>\n\n<pre><code>// http://www.alvestrand.no/objectid/0.9.2342.19200300.100.1.1.html\nvar oidUserID = []int{0, 9, 2342, 19200300, 100, 1, 1}\nvar UID string\n\ncert, err := x509.ParseCertificate(certData)\nif err != nil {\n    return err\n}\n\n// reading the UID from list of unprased \n// objects from Subject\nfor _, n := range cert.Subject.Names {\n    if n.Type.Equal(oidUserID) {\n        if v, ok := n.Value.(string); ok {\n            UID = v\n        }\n    }\n}\n\nfmt.Println(UID)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2708, "user_id": 981981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77a37bba71a4ff3dde340efca6b1e447?s=128&d=identicon&r=PG", "display_name": "Guillaume Cisco", "link": "https://stackoverflow.com/users/981981/guillaume-cisco"}, "is_accepted": false, "score": 0, "last_activity_date": 1537260934, "creation_date": 1537260934, "answer_id": 52382682, "question_id": 39125873, "link": "https://stackoverflow.com/questions/39125873/golang-subject-dn-from-x509-cert/52382682#52382682", "title": "golang subject dn from x509 cert", "body": "<p>Using directly\n <code>\nfmt.Sprintf(\"%+v\", cert.Subject.ToRDNSequence())\n</code></p>\n\n<p>does the work in go 1.9.\nFor superior versions of go (>=1.10), it works with \".String()\" in pkix.Name</p>\n"}, {"tags": [], "owner": {"reputation": 231, "user_id": 6777826, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jpGOd.jpg?s=128&g=1", "display_name": "NameError", "link": "https://stackoverflow.com/users/6777826/nameerror"}, "is_accepted": false, "score": 0, "last_activity_date": 1538578703, "creation_date": 1538578703, "answer_id": 52629991, "question_id": 39125873, "link": "https://stackoverflow.com/questions/39125873/golang-subject-dn-from-x509-cert/52629991#52629991", "title": "golang subject dn from x509 cert", "body": "<p>For now you can just use:</p>\n\n<pre><code>cert, _ := x509.ParseCertificate(certDERBlock.Bytes)\nfmt.Println(cert.Subject.CommonName)\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/crypto/x509/#Certificate\" rel=\"nofollow noreferrer\">https://golang.org/pkg/crypto/x509/#Certificate</a><br>\n<a href=\"https://golang.org/pkg/crypto/x509/pkix/#Name\" rel=\"nofollow noreferrer\">https://golang.org/pkg/crypto/x509/pkix/#Name</a></p>\n"}, {"tags": [], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "is_accepted": false, "score": 0, "last_activity_date": 1570003576, "creation_date": 1570003576, "answer_id": 58197541, "question_id": 39125873, "link": "https://stackoverflow.com/questions/39125873/golang-subject-dn-from-x509-cert/58197541#58197541", "title": "golang subject dn from x509 cert", "body": "<p>Here is the function that I use. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var (\n    cnNameOid = asn1.ObjectIdentifier{2, 5, 4, 3}\n    emailOid  = asn1.ObjectIdentifier{1, 2, 840, 113549, 1, 9, 1}\n    userIDOid = asn1.ObjectIdentifier{0, 9, 2342, 19200300, 100, 1, 1}\n    dcNameOid = asn1.ObjectIdentifier{0, 9, 2342, 19200300, 100, 1, 25}\n)\n\n// RDNSToString returns the Relative Distinguish Name as a string.\nfunc RDNSToString(rdns *pkix.RDNSequence) string {\n    var buf strings.Builder\n    for _, rdn := range *rdns {\n        if len(rdn) == 0 {\n            continue\n        }\n        for _, atv := range rdn {\n            value, ok := atv.Value.(string)\n            if !ok {\n                continue\n            }\n            t := atv.Type\n            if len(t) == 4 &amp;&amp; t[0] == 2 &amp;&amp; t[1] == 5 &amp;&amp; t[2] == 4 {\n                switch t[3] {\n                case 3:\n                    buf.WriteString(\"/CN=\") // common name\n                    buf.WriteString(value)\n                case 4:\n                    buf.WriteString(\"/SN=\") // surname\n                    buf.WriteString(value)\n                case 5:\n                    buf.WriteString(\"/SERIALNUMBER=\")\n                    buf.WriteString(value)\n                case 6:\n                    buf.WriteString(\"/C=\") // country\n                    buf.WriteString(value)\n                case 7:\n                    buf.WriteString(\"/L=\") // locality\n                    buf.WriteString(value)\n                case 8:\n                    buf.WriteString(\"/ST=\") // state\n                    buf.WriteString(value)\n                case 9:\n                    buf.WriteString(\"/STREET=\")\n                    buf.WriteString(value)\n                case 10:\n                    buf.WriteString(\"/O=\") // organization\n                    buf.WriteString(value)\n                case 11:\n                    buf.WriteString(\"/OU=\") // organization unit\n                    buf.WriteString(value)\n                case 12:\n                    buf.WriteString(\"/T=\") // title\n                    buf.WriteString(value)\n                case 17:\n                    buf.WriteString(\"/PC=\") // postal code\n                    buf.WriteString(value)\n                case 42:\n                    buf.WriteString(\"/GN=\") // given name\n                    buf.WriteString(value)\n                case 43:\n                    buf.WriteString(\"/initials=\")\n                    buf.WriteString(value)\n                case 44:\n                    buf.WriteString(\"/generationQualifier=\")\n                    buf.WriteString(value)\n                case 46:\n                    buf.WriteString(\"/dnQualifier=\")\n                    buf.WriteString(value)\n                case 65:\n                    buf.WriteString(\"/pseudonym=\")\n                    buf.WriteString(value)\n                }\n            } else if t.Equal(dcNameOid) {\n                buf.WriteString(\"/DC=\") // domain component\n                buf.WriteString(value)\n            } else if t.Equal(emailOid) {\n                buf.WriteString(\"/MAIL=\")\n                buf.WriteString(value)\n            } else if t.Equal(userIDOid) {\n                buf.WriteString(\"/UID=\") // user ID\n                buf.WriteString(value)\n            }\n        }\n    }\n    return buf.String()\n}\n</code></pre>\n\n<p>This is the code to get the RDNSequence. The example gets the Subject name. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>...\ncert, err := x509.ParseCertificate(certData)\nif err != nil {\n    ...\n}\n\nvar rdns pkix.RDNSequence\nif _, err := asn1.Unmarshal(cert.RawSubject, &amp;rdns); err != nil {\n    ...\n}\n\nfmt.Println(\"Subject:\", RDNSToString(&amp;rdns))\n...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 379, "user_id": 4424548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4b7e210fee0a6c4c2174bb67daeeb2a?s=128&d=identicon&r=PG&f=1", "display_name": "Erkin Djindjiev", "link": "https://stackoverflow.com/users/4424548/erkin-djindjiev"}, "is_accepted": false, "score": 0, "last_activity_date": 1603381272, "creation_date": 1603381272, "answer_id": 64485773, "question_id": 39125873, "link": "https://stackoverflow.com/questions/39125873/golang-subject-dn-from-x509-cert/64485773#64485773", "title": "golang subject dn from x509 cert", "body": "<p>Here's a function I ended up using to parse the string directly, without utilizing any of the go internal libs.</p>\n<pre><code>func parseIssuerDn(issuer string) map[string]string {\n\n    trackerResultMap := map[string]string{&quot;C=&quot;: &quot;&quot;, &quot;O=&quot;: &quot;&quot;, &quot;CN=&quot;: &quot;&quot;, &quot;ST=&quot;: &quot;&quot;, &quot;L=&quot;: &quot;&quot;, &quot;OU=&quot;: &quot;&quot;}\n\n    for tracker, _ := range trackerResultMap {\n        index := strings.Index(issuer, tracker)\n\n        if index &lt; 0 {\n            continue\n        }\n\n        var res string\n\n        // track quotes for delimited fields so we know not to split on the comma\n        quoteCount := 0\n\n        for i := index + len(tracker); i &lt; len(issuer); i++ {\n\n            char := issuer[i]\n\n            // if &quot;, we need to count and delimit\n            if char == 34 {\n                quoteCount++\n                if quoteCount == 2 {\n                    break\n                } else {\n                    continue\n                }\n            }\n\n            // comma, lets stop here but only if we don't have quotes\n            if char == 44 &amp;&amp; quoteCount == 0 {\n                break\n            }\n\n            // add this individual char\n            res += string(rune(char))\n\n        }\n\n        trackerResultMap[strings.TrimSuffix(tracker, &quot;=&quot;)] = strings.TrimPrefix(res, &quot;=&quot;)\n    }\n\n    for k, v := range trackerResultMap {\n        if len(v) == 0 {\n            delete(trackerResultMap, k)\n        }\n    }\n\n    return trackerResultMap\n}\n</code></pre>\n"}], "owner": {"reputation": 111, "user_id": 6752987, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/114f201167cf042c69e1aa84bab263a5?s=128&d=identicon&r=PG&f=1", "display_name": "tgo", "link": "https://stackoverflow.com/users/6752987/tgo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4067, "favorite_count": 2, "answer_count": 7, "score": 5, "last_activity_date": 1603381272, "creation_date": 1472048267, "question_id": 39125873, "link": "https://stackoverflow.com/questions/39125873/golang-subject-dn-from-x509-cert", "title": "golang subject dn from x509 cert", "body": "<p>Is there any easy way to get the complete subject DN (or issuer DN) from an x509 certificate in go as a string?</p>\n\n<p>I was not able to find any methods like \".String()\" in pkix.Name</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472043209, "post_id": 39123741, "comment_id": 65593243, "body": "The interface{} doesn&#39;t <i>have</i> to be a pointer, though most apis enforce it by checking whether it&#39;s a pointer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1472044019, "post_id": 39123741, "comment_id": 65593881, "body": "When a method/function has an output pointer as an argument, it&#39;s because it needs some information about that argument, size, type, address, etc., so that it can populate the structure you&#39;re passing in correctly. How would <code>json.Unmarshal</code> work if you couldn&#39;t pass in a data structure to unmarshal into?"}, {"owner": {"reputation": 3730, "user_id": 464064, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5b106b3ab0dfec1dcc591dd7b8d309fb?s=128&d=identicon&r=PG", "display_name": "John F.", "link": "https://stackoverflow.com/users/464064/john-f"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472044570, "post_id": 39123741, "comment_id": 65594321, "body": "@JimB Your last sentence pretty much made me see the light. Thank you."}, {"owner": {"reputation": 4513, "user_id": 605022, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/CRrSr.jpg?s=128&g=1", "display_name": "mdwhatcott", "link": "https://stackoverflow.com/users/605022/mdwhatcott"}, "edited": false, "score": 1, "creation_date": 1472078903, "post_id": 39123741, "comment_id": 65613614, "body": "If generating too much garbage is a concern (like in a tight loop) then sometimes passing in a pointer that gets populated and then reused/reset is an effective optimization. In most situation I prefer returning the value directly instead."}], "owner": {"reputation": 3730, "user_id": 464064, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5b106b3ab0dfec1dcc591dd7b8d309fb?s=128&d=identicon&r=PG", "display_name": "John F.", "link": "https://stackoverflow.com/users/464064/john-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 172, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472042728, "creation_date": 1472042728, "question_id": 39123741, "link": "https://stackoverflow.com/questions/39123741/styles-of-populating-and-returning-objects-with-golang", "title": "Styles of populating and returning objects with Golang", "body": "<p>In my exploration with Golang, I have encountered different ways of returning values from a method. To make this easier, I'll play off an example. Assume that we have two methods that return a single <code>Corgi</code> struct and a slice of <code>Corgi</code>.</p>\n\n<p>Coming from Java/C# land, one way of achieving this is to include the value or pointer as part of the return with something like this:</p>\n\n<pre><code>func GetCorgi(id int) (Corgi, error) {\n    // Do stuff and return a Corgi struct or error\n}\n\nfunc GetAllCorgis() ([]Corgi, error) {\n    // Do stuff and return a slice of Corgi structs or error\n}\n</code></pre>\n\n<p>However, I've noticed other APIs like App Engine and MongoDB, use this approach for some of their methods where you pass a pointer which then gets populated. </p>\n\n<p>App Engine <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference#Get\" rel=\"nofollow\" title=\"Get\"><code>Get</code></a></p>\n\n<pre><code>func Get(c context.Context, key *Key, dst interface{}) error\n</code></pre>\n\n<p>Mongo <a href=\"https://godoc.org/gopkg.in/mgo.v2#Query.One\" rel=\"nofollow\"><code>One</code></a> and <a href=\"https://godoc.org/gopkg.in/mgo.v2#Query.All\" rel=\"nofollow\"><code>All</code></a>   </p>\n\n<pre><code>func (q *Query) One(result interface{}) (err error)\nfunc (q *Query) All(result interface{}) error\n</code></pre>\n\n<p>Which in my case may look like this</p>\n\n<pre><code>func GetCorgi(id int, corgi *Corgi) error {\n    // Populate corgi and return error\n}\n\nfunc GetAllCorgis(corgis *[]Corgi) error {\n    // Populate corgi and return error\n}\n</code></pre>\n\n<p>Is this a matter of preference/style? Or are there advantages with one approach?</p>\n"}, {"tags": ["go", "race-condition"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1529891"}, "is_accepted": false, "score": 1, "last_activity_date": 1472042960, "last_edit_date": 1472042960, "creation_date": 1472042382, "answer_id": 39123595, "question_id": 39123453, "link": "https://stackoverflow.com/questions/39123453/concurrently-how-to-manage-values-states-and-avoiding-a-race-condition/39123595#39123595", "title": "concurrently, how to manage values/states and avoiding a race condition", "body": "<h2>Use Mutexes</h2>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"time\"\n    \"fmt\"\n)\n\nvar myvar int\nvar mut sync.Mutex\n\nfunc main() {\n    for {\n        go other()\n        go printer()\n        time.Sleep(time.Duration(1) * time.Second)\n    }\n}\n\nfunc other() {\n    mut.Lock()\n    myvar = myvar +1\n    mut.Unlock()\n}\n\nfunc printer() {\n    mut.Lock()\n    fmt.Println(myvar)\n    mut.Unlock()\n}\n</code></pre>\n\n<h2>Run (with mutexes)</h2>\n\n<pre><code>$ go build -race t1.go \n$ ./t1 \n1\n2\n3\n4\n5\n6\n7\n7\n9\n10\n</code></pre>\n\n<h2>Run (without mutexes)</h2>\n\n<pre><code>$ go build t2.go \n$ go build -race t2.go \n$ ./t2 \n==================\nWARNING: DATA RACE\nRead at 0x000000580ce8 by goroutine 7:\n  runtime.convT2E()\n      /usr/local/go/src/runtime/iface.go:155 +0x0\n  main.printer()\n      /.../.../.../GOPATH/t2.go:23 +0x65\n\nPrevious write at 0x000000580ce8 by goroutine 6:\n  main.other()\n      /.../.../.../GOPATH/t2.go:19 +0x3d\n\nGoroutine 7 (running) created at:\n  main.main()\n      /.../.../.../GOPATH/t2.go:13 +0x5a\n\nGoroutine 6 (finished) created at:\n  main.main()\n      /.../.../.../GOPATH/t2.go:12 +0x42\n==================\n1\n2\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1472044234, "post_id": 39124035, "comment_id": 65594054, "body": "Many thanks for the example, wondering if I could use <code>atomic.Value</code> for saving an instance so that either I could check if is <code>nil</code> or not and based on that use the methods of it  for example."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1472044876, "post_id": 39124035, "comment_id": 65594544, "body": "@nbari Yes, You may use it for any  typed value. it internally uses interface{},"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1472045211, "post_id": 39124035, "comment_id": 65594788, "body": "Is there an alternative way  for doing this without using a lock / <code>atomic.Value</code>?"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1472045781, "post_id": 39124035, "comment_id": 65595225, "body": "Many thanks, I am trying to follow this approach <a href=\"https://talks.golang.org/2013/bestpractices.slide#29\" rel=\"nofollow noreferrer\">talks.golang.org/2013/bestpractices.slide#29</a> but struggling to get it done"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1472047945, "post_id": 39124035, "comment_id": 65596992, "body": "I still wondering/trying to find a way of  how to set/get the value using <a href=\"https://talks.golang.org/2013/bestpractices.slide#29\" rel=\"nofollow noreferrer\">talks.golang.org/2013/bestpractices.slide#29</a> without using locks, not that I have something agains the locks but is just that I thing this may refer to the so mention share memory by communicating ...."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1472048305, "post_id": 39124035, "comment_id": 65597248, "body": "@nbari  you may send data using channels in this approach, let me add one sample ASAP"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1472049471, "post_id": 39124035, "comment_id": 65598086, "body": "@Amd thanks for the nice examples, but at the end it seems that I am bound to the <code>sync</code> package, in this case what could be the <code>best practice</code> to follow, <code>sync&#47;atomic</code>, <code>sync&#47;Mutext</code> ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1472049725, "post_id": 39124035, "comment_id": 65598281, "body": "@nbari see sample code 7, I think you are looking for this., I hope this helps."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1472050394, "post_id": 39124035, "comment_id": 65598764, "body": "@Amd thanks a lot,  sample 7 use 4 channels and basically is using them like switches, but at the end if I am right this solution is a a full no-blocking versus the ones using the <code>sync</code> packages right? any limit, concern about having multiple channels ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1472051379, "post_id": 39124035, "comment_id": 65599550, "body": "@nbari Also you may use channels in many ways to support concurrency. it depends to use case. at least for this simple case you may think other solutions with channels too."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 6, "last_activity_date": 1473769123, "last_edit_date": 1473769123, "creation_date": 1472043581, "answer_id": 39124035, "question_id": 39123453, "link": "https://stackoverflow.com/questions/39123453/concurrently-how-to-manage-values-states-and-avoiding-a-race-condition/39124035#39124035", "title": "concurrently, how to manage values/states and avoiding a race condition", "body": "<p>You have some options:  </p>\n\n<ul>\n<li>Using <code>atomic.Value</code> : Sample (1)  </li>\n<li>Using <code>sync.RWMutex</code> : Sample (3)  </li>\n<li>Using <code>sync/atomic</code> : Sample (6)  </li>\n<li>Using only channels and goroutines : Sample (7)</li>\n</ul>\n\n<p>Also see:  <a href=\"https://github.com/golang/go/wiki/MutexOrChannel\" rel=\"nofollow\">Use a sync.Mutex or a channel?</a> </p>\n\n<hr>\n\n<p>1- You may use <code>atomic.Value</code>:</p>\n\n<blockquote>\n  <p>A Value provides an atomic load and store of a consistently typed\n  value. Values can be created as part of other data structures. The\n  zero value for a Value returns nil from Load. Once Store has been\n  called, a Value must not be copied.</p>\n  \n  <p>A Value must not be copied after first use.</p>\n</blockquote>\n\n<p>Like this working sample:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// to test the panic use go build -race\npackage main\n\nimport (\n    \"fmt\"\n    \"sync/atomic\"\n)\n\ntype test struct {\n    ch chan string\n    atomic.Value\n}\n\nfunc (t *test) run() {\n    for {\n        select {\n        case v := &lt;-t.ch:\n            fmt.Printf(\"%+v, foo=%+v\\n\", v, t.Load())\n            t.Store(false)\n        default:\n        }\n    }\n}\n\nfunc (self *test) Ping() {\n    self.ch &lt;- \"ping\"\n}\n\nfunc New() *test {\n    t := &amp;test{\n        ch: make(chan string),\n    }\n    t.Store(false)\n    go t.run()\n    return t\n}\n\nfunc main() {\n    t := New()\n    for i := 0; i &lt;= 10; i++ {\n        if x, _ := t.Load().(bool); x {\n            t.Ping()\n        }\n        //  time.Sleep(time.Second)\n        if i%3 == 0 {\n            t.Store(true)\n        }\n    }\n}\n</code></pre>\n\n<p>output with <code>go build -race</code>:</p>\n\n<pre><code>ping, foo=true\nping, foo=false\nping, foo=false\nping, foo=false\nping, foo=false\n</code></pre>\n\n<hr>\n\n<p>2- A little improvment to <code>func (t *test) run()</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (t *test) run() {\n    for v := range t.ch {\n        fmt.Printf(\"%+v, foo=%+v\\n\", v, t.Load())\n        t.Store(false)\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>3- You may use <code>sync.RWMutex</code> and  <code>sync.WaitGroup</code>, like this working sample:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// to test the panic use go build -race\npackage main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype test struct {\n    ch  chan string\n    foo bool\n    sync.RWMutex\n    sync.WaitGroup\n}\n\nfunc (t *test) run() {\n    for v := range t.ch {\n        t.Lock()\n        r := t.foo\n        t.foo = false\n        t.Unlock()\n        fmt.Printf(\"%+v, foo=%+v\\n\", v, r)\n\n    }\n    t.Done()\n}\n\nfunc (self *test) Ping() {\n    self.ch &lt;- \"ping\"\n}\n\nfunc New() *test {\n    t := &amp;test{ch: make(chan string)}\n    t.Add(1)\n    go t.run()\n    return t\n}\n\nfunc main() {\n    t := New()\n    for i := 0; i &lt;= 10; i++ {\n        t.RLock()\n        r := t.foo\n        t.RUnlock()\n        if r {\n            t.Ping()\n        }\n        //  time.Sleep(time.Second)\n        if i%3 == 0 {\n            t.Lock()\n            t.foo = true\n            t.Unlock()\n        }\n    }\n    close(t.ch)\n    t.Wait()\n}\n</code></pre>\n\n<p>output with <code>go build -race</code>:</p>\n\n<pre><code>ping, foo=true\nping, foo=true\nping, foo=false\nping, foo=true\nping, foo=false\nping, foo=true\n</code></pre>\n\n<hr>\n\n<p>4- So let's  follow this approach <a href=\"https://talks.golang.org/2013/bestpractices.slide#29\" rel=\"nofollow\">https://talks.golang.org/2013/bestpractices.slide#29</a>:<br>\nOriginal Code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype Server struct{ quit chan bool }\n\nfunc NewServer() *Server {\n    s := &amp;Server{make(chan bool)}\n    go s.run()\n    return s\n}\n\nfunc (s *Server) run() {\n    for {\n        select {\n        case &lt;-s.quit:\n            fmt.Println(\"finishing task\")\n            time.Sleep(time.Second)\n            fmt.Println(\"task done\")\n            s.quit &lt;- true\n            return\n        case &lt;-time.After(time.Second):\n            fmt.Println(\"running task\")\n        }\n    }\n}\nfunc (s *Server) Stop() {\n    fmt.Println(\"server stopping\")\n    s.quit &lt;- true\n    &lt;-s.quit\n    fmt.Println(\"server stopped\")\n}\n\nfunc main() {\n    s := NewServer()\n    time.Sleep(2 * time.Second)\n    s.Stop()\n}\n</code></pre>\n\n<hr>\n\n<p>5- Let's simplify it:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar quit = make(chan bool)\n\nfunc main() {\n    go run()\n    time.Sleep(2 * time.Second)\n    fmt.Println(\"server stopping\")\n\n    quit &lt;- true // signal to quit\n\n    &lt;-quit // wait for quit signal\n\n    fmt.Println(\"server stopped\")\n}\n\nfunc run() {\n    for {\n        select {\n        case &lt;-quit:\n            fmt.Println(\"finishing task\")\n            time.Sleep(time.Second)\n            fmt.Println(\"task done\")\n            quit &lt;- true\n            return\n        case &lt;-time.After(time.Second):\n            fmt.Println(\"running task\")\n        }\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>running task\nrunning task\nserver stopping\nfinishing task\ntask done\nserver stopped\n</code></pre>\n\n<hr>\n\n<p>6- Simplified version of your sample:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// to test the panic use go build -race\npackage main\n\nimport \"fmt\"\nimport \"sync/atomic\"\n\nvar ch = make(chan string)\nvar state int32\n\nfunc main() {\n    go run()\n    for i := 0; i &lt;= 10; i++ {\n        if atomic.LoadInt32(&amp;state) == 1 {\n            ch &lt;- \"ping\"\n        }\n        if i%3 == 0 {\n            atomic.StoreInt32(&amp;state, 1)\n        }\n    }\n}\n\nfunc run() {\n    for v := range ch {\n        fmt.Printf(\"%+v, state=%+v\\n\", v, atomic.LoadInt32(&amp;state))\n        atomic.StoreInt32(&amp;state, 0)\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>ping, state=1\nping, state=0\nping, state=1\nping, state=0\nping, state=1\nping, state=0\n</code></pre>\n\n<hr>\n\n<p>7- working sample with channels and without using <code>Lock()</code> (<a href=\"https://play.golang.org/p/QsyhWpL2Bo\" rel=\"nofollow\">The Go Playground</a>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// to test the panic use go build -race\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    go run()\n    for i := 0; i &lt;= 10; i++ {\n        signal &lt;- struct{}{}\n        if &lt;-read {\n            ping &lt;- \"ping\"\n        }\n        if i%3 == 0 {\n            write &lt;- true\n        }\n    }\n}\n\nfunc run() {\n    foo := false\n    for {\n        select {\n        case &lt;-signal:\n            fmt.Println(\"signal\", foo)\n            read &lt;- foo\n        case foo = &lt;-write:\n            fmt.Println(\"write\", foo)\n        case v := &lt;-ping:\n            fmt.Println(v, foo)\n            foo = false\n        }\n    }\n}\n\nvar (\n    ping   = make(chan string)\n    signal = make(chan struct{})\n    read   = make(chan bool)\n    write  = make(chan bool)\n)\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>signal false\nwrite true\nsignal true\nping true\nsignal false\nsignal false\nwrite true\nsignal true\nping true\nsignal false\nsignal false\nwrite true\nsignal true\nping true\nsignal false\nsignal false\nwrite true\nsignal true\nping true\n</code></pre>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 513, "favorite_count": 1, "accepted_answer_id": 39124035, "answer_count": 2, "score": 3, "last_activity_date": 1473769123, "creation_date": 1472041994, "last_edit_date": 1472050106, "question_id": 39123453, "link": "https://stackoverflow.com/questions/39123453/concurrently-how-to-manage-values-states-and-avoiding-a-race-condition", "title": "concurrently, how to manage values/states and avoiding a race condition", "body": "<p>How to properly set/modify a value based on events/conditions that happen after process has started, while dealing with <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow\">Goroutines</a> without creating a race condition. </p>\n\n<p>For example, the following \"works (is buggy)\" and output is:</p>\n\n<pre><code>ping, foo=true\nping, foo=false\nping, foo=true\nping, foo=true\nping, foo=true\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/Y3FafF-nBc\" rel=\"nofollow\">https://play.golang.org/p/Y3FafF-nBc</a></kbd></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\ntype test struct {\n    ch  chan string\n    foo bool\n}\n\nfunc (t *test) run() {\n    for {\n        select {\n        case v := &lt;-t.ch:\n            fmt.Printf(\"%+v, foo=%+v\\n\", v, t.foo)\n            t.foo = false\n        default:\n        }\n    }\n}\n\nfunc (t *test) Ping() {\n    t.ch &lt;- \"ping\"\n}\n\nfunc New() *test {\n    t := &amp;test{\n        ch: make(chan string),\n    }\n    go t.run()\n    return t\n}\n\nfunc main() {\n    t := New()\n    for i := 0; i &lt;= 10; i++ {\n        if t.foo {\n            t.Ping()\n        }\n        if i%3 == 0 {\n            t.foo = true\n        }\n    }\n}\n</code></pre>\n\n<p>But if compiled or run using the <a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow\">-race</a> option, I get this output:</p>\n\n<pre><code>$ go run -race main.go\nping, foo=true\n==================\nWARNING: DATA RACE\nWrite at 0x00c4200761b8 by goroutine 6:\n  main.(*test).run()\n      /main.go:16 +0x1fb\n\nPrevious read at 0x00c4200761b8 by main goroutine:\n  main.main()\n      /main.go:37 +0x5e\n\nGoroutine 6 (running) created at:\n  main.New()\n      /main.go:30 +0xd0\n  main.main()\n      /main.go:35 +0x33\n==================\nping, foo=false\nping, foo=true\nping, foo=true\nping, foo=true\nFound 1 data race(s)\nexit status 66\n</code></pre>\n\n<p>Therefore, I would like to know what <strong>concurrency pattern</strong> could I use for being available to change the value of <code>foo</code> outside the gorutine and also inside the gorutine without creating a race condition. </p>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 6755316, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GW5jzrX1yQ4/AAAAAAAAAAI/AAAAAAAABRA/Fwyix6amGsY/photo.jpg?sz=128", "display_name": "Ainur Rochman", "link": "https://stackoverflow.com/users/6755316/ainur-rochman"}, "is_accepted": true, "score": 1, "last_activity_date": 1472100070, "creation_date": 1472100070, "answer_id": 39136807, "question_id": 39123113, "link": "https://stackoverflow.com/questions/39123113/go-redirect-to-specific-url-with-payload/39136807#39136807", "title": "Go - redirect to specific url with payload", "body": "<p>Try to use this code..</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;html&gt;\r\n\t&lt;body&gt;\r\n\t&lt;form action=\"http://payment.api.net/merchant/init?corpid=CN000001\" method=\"post\" enctype='text/plain'&gt;\r\n\t\t&lt;input type=\"hidden\" name=\"order\" value='&lt;order&gt;&lt;corp&gt;NN01&lt;/corp&gt;&lt;amount&gt;20.0&lt;/amount&gt;&lt;currency&gt;USD&lt;/currency&gt;&lt;ordernumber&gt;10010111&lt;/ordernumber&gt;&lt;redirect&gt;http://mycallback.api.net/store/payment/callback&lt;/redirect&gt;&lt;randomstring&gt;NnwLRINzhOgvmvyunzZIrUtCgvmvy&lt;/randomstring&gt;&lt;hash&gt;4792e72f5e1860b220420ad3f22f005c9d2fce83f3a138336869780153145700&lt;/hash&gt;&lt;/order&gt;'&gt;\r\n\t\t&lt;button type=\"submit\"&gt;Submit&lt;/button&gt;\r\n\t&lt;/form&gt;\r\n\t&lt;/body&gt;\r\n&lt;/html&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>May it solve your problem..</p>\n"}], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 772, "favorite_count": 0, "accepted_answer_id": 39136807, "answer_count": 1, "score": 0, "last_activity_date": 1472101974, "creation_date": 1472041042, "last_edit_date": 1472101974, "question_id": 39123113, "link": "https://stackoverflow.com/questions/39123113/go-redirect-to-specific-url-with-payload", "title": "Go - redirect to specific url with payload", "body": "<p>I'm currently trying to implements payment method of my client onto my application. To show the payment page, I need to perform request to their url with body information about the payment. The response is html of the payment page. Then I print the html to the view.</p>\n\n<p>But whenever I clicked pay button on the generated view, error occured say that session is invalid, it's because even the payment page is showing up it's still on our host (cross domain problem). I need to click the pay button from their host, it's mean that my application need to be redirected to their host.</p>\n\n<p>Can we redirect to another url but attach body on the header of the request?</p>\n\n<p>I want to redirect to this url \"<a href=\"http://payment.api.net/merchant/init?corpid=CN000001\" rel=\"nofollow\">http://payment.api.net/merchant/init?corpid=CN000001</a>\", but including this body request.</p>\n\n<pre><code>&lt;order&gt;\n &lt;corp&gt;NN01&lt;/corp&gt;\n &lt;amount&gt;20.0&lt;/amount&gt;\n &lt;currency&gt;USD&lt;/currency&gt;\n &lt;ordernumber&gt;10010111&lt;/ordernumber&gt;\n &lt;redirect&gt;http://mycallback.api.net/store/payment/callback&lt;/redirect&gt;\n &lt;randomstring&gt;NnwLRINzhOgvmvyunzZIrUtCgvmvy&lt;/randomstring&gt;\n &lt;hash&gt;4792e72f5e1860b220420ad3f22f005c9d2fce83f3a138336869780153145700&lt;/hash&gt;\n&lt;/order&gt;\n</code></pre>\n\n<p>How to achieve this?</p>\n\n<h1>UPDATE</h1>\n\n<blockquote>\n  <p>It's impossible</p>\n</blockquote>\n\n<h1>SOLUTION</h1>\n\n<p>See ainur answer, I don't understand why, but it's working like a charm</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1472039897, "post_id": 39122458, "comment_id": 65590785, "body": "Please show your html template."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "reply_to_user": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1472040386, "post_id": 39122458, "comment_id": 65591190, "body": "I am sending data via postman"}], "answers": [{"comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "reply_to_user": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1472039835, "post_id": 39122551, "comment_id": 65590739, "body": "Are you posting the data, i.e. Method=&quot;POST&quot; from a form ?"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "reply_to_user": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1472039934, "post_id": 39122551, "comment_id": 65590821, "body": "Try adding a Methods(&quot;POST&quot;) to the handleFunc ?"}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1472040144, "post_id": 39122551, "comment_id": 65590994, "body": "err := r.ParseForm() prints &lt;nil&gt; v := r.Form prints map[] h := v.Get(&quot;hub_id&quot;) prints nothing"}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1472040195, "post_id": 39122551, "comment_id": 65591031, "body": "Also, when i print req.Method it prints POST. This means that it is a POST request"}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472040748, "post_id": 39122551, "comment_id": 65591463, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/121732/discussion-between-jagrati-and-sridhar\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "is_accepted": false, "score": 0, "last_activity_date": 1472040211, "last_edit_date": 1472040211, "creation_date": 1472039479, "answer_id": 39122551, "question_id": 39122458, "link": "https://stackoverflow.com/questions/39122458/get-post-data-using-golang-http-package/39122551#39122551", "title": "Get post data using golang http package", "body": "<p>Try </p>\n\n<pre><code>err := r.ParseForm()\nv := r.Form\nh := v.Get(\"hub_id\")\n</code></pre>\n\n<p>Edit: I see you've tried ParseForm</p>\n"}, {"comments": [{"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1472046953, "post_id": 39124092, "comment_id": 65596184, "body": "Will you please explain it more. Here the content type is <code>Content-Type:[multipart&#47;form-data; boundary=----WebKitFormBoundarydFOTVjOJMeqOHnS3]</code> which is send by POSTMAN."}, {"owner": {"reputation": 2028, "user_id": 711336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b48c9965a4ceb5193259840d3abdf38b?s=128&d=identicon&r=PG", "display_name": "s7anley", "link": "https://stackoverflow.com/users/711336/s7anley"}, "reply_to_user": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 1, "creation_date": 1472047681, "post_id": 39124092, "comment_id": 65596802, "body": "Take a look here for explanation - <a href=\"http://stackoverflow.com/questions/4007969/application-x-www-form-urlencoded-or-multipart-form-data#answer-4073451\" title=\"application x www form urlencoded or multipart form data%23answer 4073451\">stackoverflow.com/questions/4007969/&hellip;</a> In Postman, you can define different <code>Content-Type</code>. In body section, below URL address you can pick different types."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1472102534, "post_id": 39124092, "comment_id": 65619031, "body": "yes, I got the value by using <code>Content-Type:application&#47;x-www-form-urlencoded</code> but suppose in future i will have to send <code>binary (non-alphanumeric) data (or a significantly sized payload) </code> then <code>multipart&#47;form-data</code> should be used. How to obtain POST data when content-type is <code>multipart&#47;form-data</code> in go."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 1, "creation_date": 1473847756, "post_id": 39124092, "comment_id": 66293498, "body": "I found the solution. Since, content-type is <code>mulipart&#47;form-data</code> ,the correct way to parse form is to use <code>req.ParseMultipartForm</code> http method."}], "tags": [], "owner": {"reputation": 2028, "user_id": 711336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b48c9965a4ceb5193259840d3abdf38b?s=128&d=identicon&r=PG", "display_name": "s7anley", "link": "https://stackoverflow.com/users/711336/s7anley"}, "is_accepted": true, "score": 2, "last_activity_date": 1472043706, "creation_date": 1472043706, "answer_id": 39124092, "question_id": 39122458, "link": "https://stackoverflow.com/questions/39122458/get-post-data-using-golang-http-package/39124092#39124092", "title": "Get post data using golang http package", "body": "<p>You are using incorrect <code>Content-Type</code>. When using <code>Content-Type:application/x-www-form-urlencoded</code>, <code>r.ParseForm()</code> will parse data correctly. Check <code>r.Form</code> afterwards.</p>\n"}], "owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3520, "favorite_count": 0, "accepted_answer_id": 39124092, "answer_count": 2, "score": 2, "last_activity_date": 1472103804, "creation_date": 1472039187, "last_edit_date": 1472103804, "question_id": 39122458, "link": "https://stackoverflow.com/questions/39122458/get-post-data-using-golang-http-package", "title": "Get post data using golang http package", "body": "<p>I am new to golang, getting familiar with http package. I am having trouble in getting the post data I am sending using postman.</p>\n\n<p><code>http://localhost:8084/dbTest</code> is my URI. I am passing key: <code>hub_id</code> value: <code>1</code> using form-data. I tried following approaches, </p>\n\n<pre><code>req.ParseForm()\nfmt.Println(\"hub_id\", req.Form[\"hub_id\"])\nreq.Form.Get(\"hub_id\")\n</code></pre>\n\n<p>But none of the approach work. I am getting empty response.</p>\n\n<p>Following is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"log\"\n) \n\nfunc dbtest(w http.ResponseWriter, req *http.Request) {\n  req.ParseForm()\n  fmt.Println(\"hub_id\", req.Form[\"hub_id\"])\n  req.Form.Get(\"hub_id\")\n  fmt.Println(req.PostFormValue(\"hub_id\")) //response is empty\n}\n\nfunc main() {\n\n    http.HandleFunc(\"/dbTest\", dbtest)\n\n  log.Fatal(http.ListenAndServe(\":8084\", nil))\n}\n</code></pre>\n\n<p>When I print req i get the following:</p>\n\n<pre><code>&amp;{POST /dbTest HTTP/1.1 1 1 map[Origin:[chrome-extension://fhbjgbiflinjbdggehcddcbncdddomop] Connection:[keep-alive] Content-Type:[multipart/form-data; boundary=----WebKitFormBoundarydFOTVjOJMeqOHnS3] Content-Length:[138] Accept-Language:[en-US,en;q=0.8] Cache-Control:[no-cache] Accept-Encoding:[gzip, deflate] Accept:[*/*] User-Agent:[Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36] Postman-Token:[ac7ae3a9-60f6-2146-3f1c-209de7622774]] 0xc210012e70 138 [] false localhost:8084 map[] map[] &lt;nil&gt; map[] 127.0.0.1:34152 /dbTest &lt;nil&gt;}\n</code></pre>\n\n<p><strong>Solution:</strong> I found the solution. Since, content-type is <code>mulipart/form-data</code> I correct way to parse form is to use <code>req.ParseMultipartForm</code> http method.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2028, "user_id": 711336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b48c9965a4ceb5193259840d3abdf38b?s=128&d=identicon&r=PG", "display_name": "s7anley", "link": "https://stackoverflow.com/users/711336/s7anley"}, "edited": false, "score": 5, "creation_date": 1472044078, "post_id": 39121172, "comment_id": 65593930, "body": "I would avoid using accepted approach. Take a look on D\u03b1ve Cheney presentation about error handling <a href=\"https://www.youtube.com/watch?v=lsBF58Q-DnY\" rel=\"nofollow noreferrer\">youtube.com/watch?v=lsBF58Q-DnY</a>. I will definitely answer your question."}], "answers": [{"comments": [{"owner": {"reputation": 27885, "user_id": 187676, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61a0f26f59f608dcde6bf8bfdd3e421e?s=128&d=identicon&r=PG", "display_name": "Erik Aigner", "link": "https://stackoverflow.com/users/187676/erik-aigner"}, "edited": false, "score": 23, "creation_date": 1561112380, "post_id": 39121278, "comment_id": 99966568, "body": "This is terrible advice. What if the error text changes? You should compare it to an error <code>var</code>."}, {"owner": {"reputation": 3196, "user_id": 1541397, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/991c4e6d0872e18880e3e0ff51cdf5a2?s=128&d=identicon&r=PG", "display_name": "David Callanan", "link": "https://stackoverflow.com/users/1541397/david-callanan"}, "edited": false, "score": 1, "creation_date": 1587484142, "post_id": 39121278, "comment_id": 108527016, "body": "Error text is typically implementation-specific and isn&#39;t part a package&#39;s contract, therefore this is not advisable. Although this is safe if done internally (once you ensure the error strings don&#39;t change), I would stick with using custom error types for consistency and readability."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 1, "creation_date": 1610024418, "post_id": 39121278, "comment_id": 116005604, "body": "I don&#39;t know why my comment keeps getting deleted! This answer is not advice so can&#39;t be <code>terrible advice</code>. The question itself has a comparison of string literals.  I attempted to answer the question, not provide advice on best practice."}], "tags": [], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "is_accepted": true, "score": 31, "last_activity_date": 1472035874, "creation_date": 1472035874, "answer_id": 39121278, "question_id": 39121172, "link": "https://stackoverflow.com/questions/39121172/how-to-compare-go-errors/39121278#39121278", "title": "How to compare Go errors", "body": "<p>Try </p>\n\n<pre><code>err.Error() == \"Token is expired\"\n</code></pre>\n\n<p>Or create your own error by implementing the error interface. </p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 16, "last_activity_date": 1473769229, "last_edit_date": 1473769229, "creation_date": 1472037113, "answer_id": 39121749, "question_id": 39121172, "link": "https://stackoverflow.com/questions/39121172/how-to-compare-go-errors/39121749#39121749", "title": "How to compare Go errors", "body": "<p>The error type is an interface type. An error variable represents any value that can describe itself as a string. Here is the interface's declaration:</p>\n\n<pre><code>type error interface {\n    Error() string\n}\n</code></pre>\n\n<p>The most commonly-used error implementation is the errors package's unexported errorString type:</p>\n\n<pre><code>// errorString is a trivial implementation of error.\ntype errorString struct {\n    s string\n}\n\nfunc (e *errorString) Error() string {\n    return e.s\n}\n</code></pre>\n\n<p>See this working code output (<a href=\"https://play.golang.org/p/iT7tBztgVm\" rel=\"noreferrer\">The Go Playground</a>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"io\"\n)\n\nfunc main() {\n    err1 := fmt.Errorf(\"Error\")\n    err2 := errors.New(\"Error\")\n    err3 := io.EOF\n\n    fmt.Println(err1)         //Error\n    fmt.Printf(\"%#v\\n\", err1) // &amp;errors.errorString{s:\"Error\"}\n    fmt.Printf(\"%#v\\n\", err2) // &amp;errors.errorString{s:\"Error\"}\n    fmt.Printf(\"%#v\\n\", err3) // &amp;errors.errorString{s:\"EOF\"}\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>Error\n&amp;errors.errorString{s:\"Error\"}\n&amp;errors.errorString{s:\"Error\"}\n&amp;errors.errorString{s:\"EOF\"}\n</code></pre>\n\n<hr>\n\n<p>Also see: <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"noreferrer\">Comparison operators</a></p>\n\n<blockquote>\n  <p>Comparison operators compare two operands and yield an untyped boolean\n  value. In any comparison, the first operand must be assignable to the\n  type of the second operand, or vice versa.</p>\n  \n  <p>The equality operators <code>==</code> and <code>!=</code> apply to operands that are\n  comparable.</p>\n  \n  <p>Pointer values are comparable. Two pointer values are equal if they\n  point to the same variable or if both have value nil. Pointers to\n  distinct zero-size variables may or may not be equal.</p>\n  \n  <p>Interface values are comparable. Two interface values are equal if\n  they have identical dynamic types and equal dynamic values or if both\n  have value nil.</p>\n  \n  <p>A value x of non-interface type X and a value t of interface type T\n  are comparable when values of type X are comparable and X implements\n  T. They are equal if t's dynamic type is identical to X and t's\n  dynamic value is equal to x.</p>\n  \n  <p>Struct values are comparable if all their fields are comparable. Two\n  struct values are equal if their corresponding non-blank fields are\n  equal.</p>\n</blockquote>\n\n<hr>\n\n<p>So:</p>\n\n<p>1- You may use <code>Error()</code>, like this working code (<a href=\"https://play.golang.org/p/2vI2ae-Tue\" rel=\"noreferrer\">The Go Playground</a>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n)\n\nfunc main() {\n    err1 := errors.New(\"Token is expired\")\n    err2 := errors.New(\"Token is expired\")\n    if err1.Error() == err2.Error() {\n        fmt.Println(err1.Error() == err2.Error()) // true\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>true\n</code></pre>\n\n<hr>\n\n<p>2- Also you may compare it with <code>nil</code>, like this working code (<a href=\"https://play.golang.org/p/dYhqV-RqE8\" rel=\"noreferrer\">The Go Playground</a>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n)\n\nfunc main() {\n    err1 := errors.New(\"Token is expired\")\n    err2 := errors.New(\"Token is expired\")\n    if err1 != nil {\n        fmt.Println(err1 == err2) // false\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>false\n</code></pre>\n\n<hr>\n\n<p>3- Also you may compare it with exact same error, like this working code<br>\n(<a href=\"https://play.golang.org/p/f4jYQd9YF7\" rel=\"noreferrer\">The Go Playground</a>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n)\n\nfunc main() {\n    err1 := io.EOF\n    if err1 == io.EOF {\n        fmt.Println(\"err1 is : \", err1)\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>err1 is :  EOF\n</code></pre>\n\n<hr>\n\n<p>ref: <a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"noreferrer\">https://blog.golang.org/error-handling-and-go</a></p>\n"}, {"comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1495459470, "post_id": 39121870, "comment_id": 75247400, "body": "One downside to this is that another package could potentially overwrite the value of the exported <code>NoMorePumpkins</code> variable. Would be nice if there were a way to do that with a <code>const</code>"}, {"owner": {"reputation": 3381, "user_id": 3964654, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ITt1C.jpg?s=128&g=1", "display_name": "wingerse", "link": "https://stackoverflow.com/users/3964654/wingerse"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1496264393, "post_id": 39121870, "comment_id": 75595503, "body": "@captncraig well then you could use a getter function"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 3381, "user_id": 3964654, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ITt1C.jpg?s=128&g=1", "display_name": "wingerse", "link": "https://stackoverflow.com/users/3964654/wingerse"}, "edited": false, "score": 0, "creation_date": 1496264512, "post_id": 39121870, "comment_id": 75595560, "body": "@WingerSendon good point. That may be my favorite solution yet."}, {"owner": {"reputation": 3395, "user_id": 6164984, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/gtaJI.png?s=128&g=1", "display_name": "math2001", "link": "https://stackoverflow.com/users/6164984/math2001"}, "edited": false, "score": 0, "creation_date": 1538012899, "post_id": 39121870, "comment_id": 91996088, "body": "but why would you overwrite an other&#39;s package error?"}, {"owner": {"reputation": 11022, "user_id": 317916, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/21dda5ab7f19b2cf21502358eb0410e1?s=128&d=identicon&r=PG", "display_name": "cbednarski", "link": "https://stackoverflow.com/users/317916/cbednarski"}, "edited": false, "score": 3, "creation_date": 1555655577, "post_id": 39121870, "comment_id": 98190679, "body": "The practical problem is not someone may overwrite <code>fruits.NoMorePumpkins</code>, it&#39;s that they may <i>wrap</i> it, and the <code>==</code> will fail."}, {"owner": {"reputation": 225, "user_id": 1507342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5165ad3df4cd59728ea24317698f15bc?s=128&d=identicon&r=PG&f=1", "display_name": "d1str0", "link": "https://stackoverflow.com/users/1507342/d1str0"}, "reply_to_user": {"reputation": 11022, "user_id": 317916, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/21dda5ab7f19b2cf21502358eb0410e1?s=128&d=identicon&r=PG", "display_name": "cbednarski", "link": "https://stackoverflow.com/users/317916/cbednarski"}, "edited": false, "score": 1, "creation_date": 1580361249, "post_id": 39121870, "comment_id": 106073828, "body": "@cbednarski check out Go 1.13&#39;s new error built-ins. There is a new way to make hierarchical errors so you can check whether or not it was wrapped."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 46, "last_activity_date": 1570001207, "last_edit_date": 1570001207, "creation_date": 1472037470, "answer_id": 39121870, "question_id": 39121172, "link": "https://stackoverflow.com/questions/39121172/how-to-compare-go-errors/39121870#39121870", "title": "How to compare Go errors", "body": "<p><strong>This answer is for Go 1.12 and earlier releases.</strong></p>\n\n<p>Define an error value in a library</p>\n\n<pre><code>package fruits\n\nvar NoMorePumpkins = errors.New(\"No more pumpkins\")\n</code></pre>\n\n<p>Do not create errors with <code>errors.New</code> anywhere in the code but return the predefined value whenever error occurs and then you can do the following:</p>\n\n<pre><code>package shop\n\nif err == fruits.NoMorePumpkins {\n     ...\n}\n</code></pre>\n\n<p>See <a href=\"https://golang.org/pkg/io/#pkg-variables\" rel=\"noreferrer\"><code>io</code></a> package errors for reference.</p>\n\n<p>This can be improved by adding methods to hide the check implementation and make the client code more immune to changes in <code>fruits</code> package.</p>\n\n<pre><code>package fruits\n\nfunc IsNoMorePumpkins(err error) bool {\n    return err == NoMorePumpkins\n} \n</code></pre>\n\n<p>See <a href=\"https://golang.org/src/os/error.go\" rel=\"noreferrer\"><code>os</code></a> package errors for reference.</p>\n"}, {"comments": [{"owner": {"reputation": 2151, "user_id": 414544, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e3b393a43f087897332658031daefda1?s=128&d=identicon&r=PG&f=1", "display_name": "luben", "link": "https://stackoverflow.com/users/414544/luben"}, "edited": false, "score": 1, "creation_date": 1495574240, "post_id": 39122000, "comment_id": 75308003, "body": "A lot better than comparing strings."}, {"owner": {"reputation": 3196, "user_id": 1541397, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/991c4e6d0872e18880e3e0ff51cdf5a2?s=128&d=identicon&r=PG", "display_name": "David Callanan", "link": "https://stackoverflow.com/users/1541397/david-callanan"}, "edited": false, "score": 1, "creation_date": 1587496630, "post_id": 39122000, "comment_id": 108533851, "body": "You shouldn&#39;t really test for third-party errors as those errors are implementation-details. For example, if you had some database package and a local implementation used a map, there might be a key error if an item didn&#39;t exist (or in the case of Go, ok would be false). If it was instead using a SQL backend, you might instead get a row not found error. In my opinion, packages should never propagate errors directly. Either a) map them to more appropriate custom error type (such as item not found error for the previous example), or b) wrap it with custom &quot;implementation error&quot; type, or c) panic"}], "tags": [], "owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "is_accepted": false, "score": 18, "last_activity_date": 1547199661, "last_edit_date": 1547199661, "creation_date": 1472037837, "answer_id": 39122000, "question_id": 39121172, "link": "https://stackoverflow.com/questions/39121172/how-to-compare-go-errors/39122000#39122000", "title": "How to compare Go errors", "body": "<p>It's idiomatic for packages to export error variables that they use so others can compare against them. </p>\n\n<p>E.g. If an error would came from a package named <strong>myPkg</strong> and was defined as:</p>\n\n<pre><code>var ErrTokenExpired error = errors.New(\"Token is expired\")\n</code></pre>\n\n<p>You could compare the errors directly as:</p>\n\n<pre><code>if err == myPkg.ErrTokenExpired {\n    log.Printf(\"Unauthorised: %s\\n\", err)\n}\n</code></pre>\n\n<p>If the errors come from a third party package and that doesn't use exported error variables then what you can do is simply to compare against the string you get from err.Error() but be careful with this approach as changing an Error string might not be released in a major version and would break your business logic.</p>\n"}, {"comments": [{"owner": {"reputation": 527, "user_id": 1583519, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Wz2px.jpg?s=128&g=1", "display_name": "Yasser Sinjab", "link": "https://stackoverflow.com/users/1583519/yasser-sinjab"}, "edited": false, "score": 0, "creation_date": 1612004001, "post_id": 57613539, "comment_id": 116634307, "body": "You really deserve the 1 million reputation !"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 23, "last_activity_date": 1566490959, "creation_date": 1566490959, "answer_id": 57613539, "question_id": 39121172, "link": "https://stackoverflow.com/questions/39121172/how-to-compare-go-errors/57613539#57613539", "title": "How to compare Go errors", "body": "<p>Declaring an error, and comparing it with '<code>==</code>' (as in <code>err == myPkg.ErrTokenExpired</code>) is no longer the best practice with Go 1.13 (Q3 2019)</p>\n\n<p>The <a href=\"https://tip.golang.org/doc/go1.13#error_wrapping\" rel=\"noreferrer\">release notes</a> mentions:</p>\n\n<blockquote>\n  <p>Go 1.13 contains support for <strong>error wrapping</strong>, as first proposed in the <a href=\"https://go.googlesource.com/proposal/+/master/design/29934-error-values.md\" rel=\"noreferrer\">Error Values proposal</a> and discussed on the <a href=\"https://golang.org/issue/29934\" rel=\"noreferrer\">associated issue</a>.</p>\n  \n  <p>An error <code>e</code> can wrap another error <code>w</code> by providing an <code>Unwrap</code> method that returns <code>w</code>.<br>\n  Both <code>e</code> and <code>w</code> are available to programs, allowing <code>e</code> to provide additional context to <code>w</code> or to reinterpret it while still allowing programs to make decisions based on <code>w</code>.</p>\n  \n  <p>To support wrapping, <a href=\"https://tip.golang.org/doc/go1.13#fmt\" rel=\"noreferrer\"><code>fmt.Errorf</code></a> now has a <code>%w</code> verb for creating wrapped errors, and three new functions in the <a href=\"https://tip.golang.org/doc/go1.13#errors\" rel=\"noreferrer\"><code>errors</code></a> package ( <a href=\"https://tip.golang.org/pkg/errors#Unwrap\" rel=\"noreferrer\"><code>errors.Unwrap</code></a>, <a href=\"https://tip.golang.org/pkg/errors#Is\" rel=\"noreferrer\"><code>errors.Is</code></a> and <a href=\"https://tip.golang.org/pkg/errors#As\" rel=\"noreferrer\"><code>errors.As</code></a>) simplify unwrapping and inspecting wrapped errors.</p>\n</blockquote>\n\n<p>So the <a href=\"https://golang.org/wiki/ErrorValueFAQ\" rel=\"noreferrer\">Error Value FAQ</a> explains:</p>\n\n<blockquote>\n  <p><strong>You need to be prepared that errors you get may be wrapped.</strong></p>\n  \n  <p>If you currently compare errors using <code>==</code>, use <code>errors.Is</code> instead.<br>\n  Example:</p>\n\n<pre><code>if err == io.ErrUnexpectedEOF\n</code></pre>\n  \n  <p>becomes</p>\n\n<pre><code>if errors.Is(err, io.ErrUnexpectedEOF)\n</code></pre>\n  \n  <ul>\n  <li>Checks of the form if <code>err != nil</code> need not be changed.</li>\n  <li>Comparisons to <code>io.EOF</code> need not be changed, because <code>io.EOF</code> should never be wrapped.</li>\n  </ul>\n  \n  <p>If you check for an error type using a <strong>type assertion</strong> or <strong>type switch</strong>, use <code>errors.As</code> instead. Example:</p>\n\n<pre><code>if e, ok := err.(*os.PathError); ok\n</code></pre>\n  \n  <p>becomes</p>\n\n<pre><code>var e *os.PathError\nif errors.As(err, &amp;e)\n</code></pre>\n  \n  <p>Also use this pattern to check whether an error implements an interface. (This is one of those rare cases when a pointer to an interface is appropriate.)</p>\n  \n  <p>Rewrite a type switch as a sequence of <code>if-elses</code>.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 2750, "user_id": 661598, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BVAlk.png?s=128&g=1", "display_name": "wst", "link": "https://stackoverflow.com/users/661598/wst"}, "is_accepted": false, "score": 7, "last_activity_date": 1586339537, "last_edit_date": 1586339537, "creation_date": 1586338722, "answer_id": 61097650, "question_id": 39121172, "link": "https://stackoverflow.com/questions/39121172/how-to-compare-go-errors/61097650#61097650", "title": "How to compare Go errors", "body": "<p>It's being discouraged to compare errors by strings. Instead you should compare errors by value.</p>\n\n<pre><code>package main\n\nimport \"errors\"\n\nvar NotFound = errors.New(\"not found\")\n\nfunc main() {\n    if err := doSomething(); errors.Is(err, NotFound) {\n        println(err)\n    }\n}\n\nfunc doSomething() error {\n    return NotFound\n}\n</code></pre>\n\n<p>It is especially useful if you are library author and would like to export errors so users can act differently on different type of errors. Standard library does it as well.</p>\n\n<p>Problem with this approach is that exported values can be changed by anyone as Go doesn't support immutable values. Nothing prevents you, though, to use string as an error and make it <code>const</code>.</p>\n\n<pre><code>package main\n\ntype CustomError string\n\nfunc (ce CustomError) Error() string {\n    return string(ce)\n}\n\nconst NotFound CustomError = \"not found\"\n\nfunc main() {\n    if err := doSomething(); errors.Is(err, NotFound) {\n        println(err)\n    }\n}\n\nfunc doSomething() error {\n    return NotFound\n}\n</code></pre>\n\n<p>It is more verbose but safer approach.</p>\n"}], "owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36523, "favorite_count": 12, "accepted_answer_id": 39121278, "answer_count": 6, "score": 53, "last_activity_date": 1586339537, "creation_date": 1472035568, "last_edit_date": 1566491084, "question_id": 39121172, "link": "https://stackoverflow.com/questions/39121172/how-to-compare-go-errors", "title": "How to compare Go errors", "body": "<p>I have an error value which when printed on console gives me <code>Token is expired</code></p>\n\n<p>How can I compare it with a specific error value? I tried this but it did not work:</p>\n\n<pre><code>if err == errors.New(\"Token is expired\") {\n      log.Printf(\"Unauthorised: %s\\n\", err)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1472034028, "post_id": 39120506, "comment_id": 65586861, "body": "<code>rune</code> is a type, not a function."}, {"owner": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "edited": false, "score": 0, "creation_date": 1472034205, "post_id": 39120506, "comment_id": 65586977, "body": "That code is trying to do a <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a> from type string to type rune and []rune. A rune is a unicode code point. You cannot convert a string to a single rune, but you can convert it to a slice of runes as in the second example."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472034964, "post_id": 39120506, "comment_id": 65587499, "body": "Think char while you&#39;re getting familiar with rune"}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1594339700, "post_id": 39120506, "comment_id": 111099517, "body": "rune is Go terminology for a single Unicode code point. See <a href=\"https://golang.org/doc/effective_go.html#for\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#for</a>. <code>string(r)</code> to set a rune to a string. See <a href=\"https://stackoverflow.com/a/62739051/12817546\">stackoverflow.com/a/62739051/12817546</a>. <code>[]rune(&quot;abc&quot;) </code> to set a string to a rune. See <a href=\"https://stackoverflow.com/a/62739051/12817546\">stackoverflow.com/a/62739051/12817546</a>."}], "answers": [{"comments": [{"owner": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "edited": false, "score": 1, "creation_date": 1472084402, "post_id": 39121163, "comment_id": 65614979, "body": "can you please edit your post to include the link where you found that info?"}], "tags": [], "owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "is_accepted": true, "score": 8, "last_activity_date": 1533284528, "last_edit_date": 1533284528, "creation_date": 1472035542, "answer_id": 39121163, "question_id": 39120506, "link": "https://stackoverflow.com/questions/39120506/golang-how-does-the-rune-function-work/39121163#39121163", "title": "golang how does the rune() function work", "body": "<p><code>rune</code> is a type in Go. It's just an alias for <code>int32</code>, but it's usually used to represent Unicode points. <code>rune()</code> isn't a function, it's syntax for type conversion into <code>rune</code>. Conversions in Go always have the syntax <code>type()</code> which might make them look like functions. </p>\n\n<p>The first bit of code fails because conversion of strings to numeric types isn't defined in Go. However conversion of strings to slices of runes/int32s is defined like this in language specification:</p>\n\n<blockquote>\n  <p>Converting a value of a string type to a slice of runes type yields a\n  slice containing the individual Unicode code points of the string.\n  [<a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">golang.org</a>]</p>\n</blockquote>\n\n<p>So your example prints a slice of runes with values 102, 111 and 111</p>\n"}, {"comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1594114123, "post_id": 62739051, "comment_id": 111005491, "body": "A boolean, numeric, or string type can be set to another type. For<code>[]byte</code> see <a href=\"https://stackoverflow.com/a/62725637/12817546\">stackoverflow.com/a/62725637/12817546</a>, for <code>float64</code> see <a href=\"https://stackoverflow.com/a/62753031/12817546\">stackoverflow.com/a/62753031/12817546</a>, <code>int</code> see <a href=\"https://stackoverflow.com/a/62737936/12817546\">stackoverflow.com/a/62737936/12817546</a>, <code>string</code> see <a href=\"https://stackoverflow.com/a/62740786/12817546\">stackoverflow.com/a/62740786/12817546</a> and for <code>bool</code> see <a href=\"https://stackoverflow.com/a/62726854/12817546\">stackoverflow.com/a/62726854/12817546</a>."}], "tags": [], "owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "is_accepted": false, "score": 0, "last_activity_date": 1599458675, "last_edit_date": 1599458675, "creation_date": 1593941804, "answer_id": 62739051, "question_id": 39120506, "link": "https://stackoverflow.com/questions/39120506/golang-how-does-the-rune-function-work/62739051#62739051", "title": "golang how does the rune() function work", "body": "<p>As stated in @Michael's <a href=\"https://stackoverflow.com/questions/39120506/golang-how-does-the-rune-function-work/62739051#comment65586977_39120506\">first-rate comment</a> <code>fmt.Println([]rune(&quot;foo&quot;))</code> is a conversion of a string to a slice of runes []rune. When you convert from string to []rune, each utf-8 char in that string becomes a Rune. See <a href=\"https://stackoverflow.com/a/51611567/12817546\">https://stackoverflow.com/a/51611567/12817546</a>. Similarly, in the reverse conversion, when converted from []rune to string, each rune becomes a utf-8 char in the string. See <a href=\"https://stackoverflow.com/a/51611567/12817546\">https://stackoverflow.com/a/51611567/12817546</a>. A []rune can also be set to a byte, float64, int or a bool.</p>\n<pre><code>package main\n\nimport (\n    . &quot;fmt&quot;\n)\n\nfunc main() {\n    r := []rune(&quot;foo&quot;)\n    c := []interface{}{byte(r[0]), float64(r[0]), int(r[0]), r, string(r), r[0] != 0}\n    checkType(c)\n}\n\nfunc checkType(s []interface{}) {\n    for k, _ := range s {\n        Printf(&quot;%T %v\\n&quot;, s[k], s[k])\n    }\n}\n</code></pre>\n<p><code>byte(r[0])</code> is set to \u201cuint8 102\u201d, <code>float64(r[0])</code> is set to \u201cfloat64 102\u201d,<code>int(r[0])</code> is set to \u201cint 102\u201d, <code>r</code> is the rune\u201d []int32 [102 111 111]\u201d, <code>string(r)</code> prints \u201cstring foo\u201d, <code>r[0] != 0</code> and shows \u201cbool true\u201d.</p>\n<p>[]rune to string conversion is supported natively by the spec. See the comment in <a href=\"https://stackoverflow.com/a/46021588/12817546\">https://stackoverflow.com/a/46021588/12817546</a>. In Go then a string is a sequence of bytes. However, since multiple bytes can represent a rune code-point, a string value can also contain runes. So, it can be converted to a []rune , or vice versa. See <a href=\"https://stackoverflow.com/a/19325804/12817546\">https://stackoverflow.com/a/19325804/12817546</a>.</p>\n<p>Note, there are only two built-in type aliases in Go, byte (alias of uint8) and rune (alias of int32). See <a href=\"https://Go101.org/article/type-system-overview.html\" rel=\"nofollow noreferrer\">https://Go101.org/article/type-system-overview.html</a>. Rune literals are just 32-bit integer values. For example, the rune literal 'a' is actually the number &quot;97&quot;. See <a href=\"https://stackoverflow.com/a/19311218/12817546\">https://stackoverflow.com/a/19311218/12817546</a>. Quotes edited.</p>\n"}], "owner": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2836, "favorite_count": 0, "accepted_answer_id": 39121163, "answer_count": 2, "score": 4, "last_activity_date": 1599458675, "creation_date": 1472033815, "question_id": 39120506, "link": "https://stackoverflow.com/questions/39120506/golang-how-does-the-rune-function-work", "title": "golang how does the rune() function work", "body": "<p>I came across a function posted online that used the <code>rune()</code> function in golang, but I am having a hard time looking up what it is. I am going through the tutorial and inexperienced with the docs so it is hard to find what I am looking for. </p>\n\n<p>Specifically, I am trying to see why this fails...</p>\n\n<pre><code>fmt.Println(rune(\"foo\"))\n</code></pre>\n\n<p>and this does not</p>\n\n<pre><code>fmt.Println([]rune(\"foo\"))\n</code></pre>\n"}, {"tags": ["go", "error-handling"], "answers": [{"comments": [{"owner": {"reputation": 763, "user_id": 5986227, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-R58sngDauK0/AAAAAAAAAAI/AAAAAAAAB_0/pzxD2AYGNQA/photo.jpg?sz=128", "display_name": "Chris Hopkins", "link": "https://stackoverflow.com/users/5986227/chris-hopkins"}, "edited": false, "score": 0, "creation_date": 1472036070, "post_id": 39120595, "comment_id": 65588254, "body": "Ah, I think you have misunderstood, the panic is there for me to stop the code when there is an error my code can&#39;t handle. It provides me wit the debug to say I&#39;m not catching all the problems I should.  Thanks though"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "reply_to_user": {"reputation": 763, "user_id": 5986227, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-R58sngDauK0/AAAAAAAAAAI/AAAAAAAAB_0/pzxD2AYGNQA/photo.jpg?sz=128", "display_name": "Chris Hopkins", "link": "https://stackoverflow.com/users/5986227/chris-hopkins"}, "edited": false, "score": 0, "creation_date": 1472036710, "post_id": 39120595, "comment_id": 65588679, "body": "Perhaps you didn&#39;t understand what &quot;Implement the error interface&quot; means because that&#39;s what the answer you chose does."}], "tags": [], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "is_accepted": false, "score": 1, "last_activity_date": 1472035689, "last_edit_date": 1472035689, "creation_date": 1472034040, "answer_id": 39120595, "question_id": 39120284, "link": "https://stackoverflow.com/questions/39120284/interpreting-golang-error-codes/39120595#39120595", "title": "Interpreting Golang Error codes", "body": "<p>You can implement the error interface and create your own errors which you may find easier to deal with. </p>\n\n<p>For runtime errors a.k.a panic. You can recover by including recover() in a function that you think may panic. It get's called before a panicing function returns.</p>\n\n<pre><code>defer func() {\n    if r := recover(); r != nil {\n        if _, ok := r.(runtime.Error); ok {\n                err = r.(error) //panic(r)\n            }\n            err = r.(error)\n        }\n    }()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 763, "user_id": 5986227, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-R58sngDauK0/AAAAAAAAAAI/AAAAAAAAB_0/pzxD2AYGNQA/photo.jpg?sz=128", "display_name": "Chris Hopkins", "link": "https://stackoverflow.com/users/5986227/chris-hopkins"}, "edited": false, "score": 0, "creation_date": 1472035839, "post_id": 39120804, "comment_id": 65588105, "body": "Thanks for the exhaustive answer! I think the problem is that the error I am getting frm the standard html package does not provide these error defines I can match against. But you are correct that I could switch against the error type first and then on error detail later. For this application that will be enough, I now just need to figure out how to feed this request back into the standard html package. Thanks"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 5, "last_activity_date": 1472034589, "creation_date": 1472034589, "answer_id": 39120804, "question_id": 39120284, "link": "https://stackoverflow.com/questions/39120284/interpreting-golang-error-codes/39120804#39120804", "title": "Interpreting Golang Error codes", "body": "<p>The simplest way would be to have package level error values in your code:</p>\n\n<pre><code>var URLFetchError = errors.New(\"Cannot fetch URL\")\n\nurl := \"http://www.google.com\"\nres, err := http.Get(url)\nif err != nil {\n    return URLFetchError\n}\n</code></pre>\n\n<p>The <code>switch</code> then becomes:</p>\n\n<pre><code>switch err {\ncase http.ErrBodyReadAfterClose:\n    fmt.Println(\"Read after close error\")\ncase URLFetchError:\n    fmt.Println(\"Error fetching URL\")\n</code></pre>\n\n<p>If you want to pass more information with the error, you can create your own custom errors:</p>\n\n<pre><code>type MyError struct {\n    URL string\n}\n\nfunc (e MyError) Error() string {\n    return fmt.Sprintf(\"Error getting: %v\", e.URL)\n}\n</code></pre>\n\n<p>Then, you can create this error whenever required. For example:</p>\n\n<pre><code>url := \"http://www.google.com\"\nres, err := http.Get(url)\nif err != nil {\n    return MyError{url}\n}\n</code></pre>\n\n<p>Finally, in your error checking method, you can use type switches instead of simple switches to get the error:</p>\n\n<pre><code>switch err.(type) {\ncase MyError:\n    fmt.Println(\"Error:\", err)\ndefault:\n    fmt.Println(\"No Error\")\n}\n</code></pre>\n\n<p>In your case, since you have a mix of regular error, you can include this check in a nested <code>switch</code>:</p>\n\n<pre><code>switch err {\ncase http.ErrBodyReadAfterClose:\n    fmt.Println(\"Read after close error\")\ncase http.ErrMissingFile:\n    fmt.Println(\"Missing File\")\ncase io.EOF:\n    fmt.Println(\"EOF error found\")\ndefault: // check for custom errors\n    switch err.(type) {\n    case MyError:\n        fmt.Println(\"custom error:\", err)\n    default:\n        panic(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 763, "user_id": 5986227, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-R58sngDauK0/AAAAAAAAAAI/AAAAAAAAB_0/pzxD2AYGNQA/photo.jpg?sz=128", "display_name": "Chris Hopkins", "link": "https://stackoverflow.com/users/5986227/chris-hopkins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5987, "favorite_count": 0, "accepted_answer_id": 39120804, "answer_count": 2, "score": 2, "last_activity_date": 1472035689, "creation_date": 1472033171, "question_id": 39120284, "link": "https://stackoverflow.com/questions/39120284/interpreting-golang-error-codes", "title": "Interpreting Golang Error codes", "body": "<p>So most examples of go error handling I see just pass any errors back up the stack. At some point these need interpreting and this is what I am trying to do.\nHere's a snippet of my attempt:</p>\n\n<pre><code>    resp, err := http.Get(string(url))\n    defer out_count.Dec()\n\n    if err != nil {\n\n           switch err {\n            case http.ErrBodyReadAfterClose:\n                    fmt.Println(\"Read after close error\")\n            case http.ErrMissingFile:\n                    fmt.Println(\"Missing File\")\n            {some more cases here}\n            case io.EOF:\n                    fmt.Println(\"EOF error found\")\n            default:\n                    fmt.Printf(\"Error type is %T\\n\", err)\n                    panic(err)\n            }\n            return\n</code></pre>\n\n<p>This isn't working though for my current case(edited to remove url}:</p>\n\n<pre><code>ERROR: Failed to crawl \"http://{removed URL}\"\nError type is *url.Error\npanic: Get http://{removed url}: EOF\n\ngoroutine 658 [running]:\nruntime.panic(0x201868, 0x106352c0)\n        /usr/lib/go/src/pkg/runtime/panic.c:279 +0x1a0\ngithub.com/cbehopkins/grab/grab.crawl(0x10606210, 0x27, 0x105184b0, 0x105184e0, 0x10500460)\n</code></pre>\n\n<p>I can't figure out a way to get the switch statement to catch this error since the text of the error changes every time and has no explicit value I can catch against. (as the URL changes all the time). Now maybe I could do some sort of regex match in the case statement or sub-slice the error string, but that feels like a very bad way to solve this problem.</p>\n\n<p>Any suggestions? There must be an idiomatic way to catch errors such as this surely?</p>\n"}, {"tags": ["go", "jwt", "express-jwt"], "comments": [{"owner": {"reputation": 904, "user_id": 6080206, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e004f9854173d82f6fd3c70d38ba3a77?s=128&d=identicon&r=PG&f=1", "display_name": "John Zeng", "link": "https://stackoverflow.com/users/6080206/john-zeng"}, "edited": false, "score": 2, "creation_date": 1472032969, "post_id": 39119910, "comment_id": 65586158, "body": "Just ask, why don&#39;t you just use a golang jwt package...."}, {"owner": {"reputation": 1795, "user_id": 1431317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e565cf25d753bc7b715eac4a21edb4d6?s=128&d=identicon&r=PG", "display_name": "user1431317", "link": "https://stackoverflow.com/users/1431317/user1431317"}, "edited": false, "score": 0, "creation_date": 1472039826, "post_id": 39119910, "comment_id": 65590730, "body": "Your code doesn&#39;t compile. <code>expireOffset</code> must be an int (because of the return), but <code>remainder.Seconds()</code> is a float64, so you can&#39;t add an int to it. What is the value of expireOffset? Also check that timestamp is indeed float64 and not Number: <a href=\"https://golang.org/pkg/encoding/json/#Number\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Number</a>"}], "answers": [{"tags": [], "owner": {"reputation": 11104, "user_id": 7329832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96a4e398a7a3d75e8cffbc635860e01a?s=128&d=identicon&r=PG&f=1", "display_name": "jps", "link": "https://stackoverflow.com/users/7329832/jps"}, "is_accepted": false, "score": 0, "last_activity_date": 1563745065, "creation_date": 1563745065, "answer_id": 57137183, "question_id": 39119910, "link": "https://stackoverflow.com/questions/39119910/how-to-check-for-jwt-token-remaining-validity-time-golang/57137183#57137183", "title": "How to check for JWT token remaining validity time golang", "body": "<p>You always get 3600 (which seems to be the <code>expireOffset</code>) because the type assertion <code>timestamp.(float64)</code> fails, as the actual value of <code>timestamp</code> is <code>int64</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func getTokenRemainingValidity(timestamp interface{}) int {\n    var expireOffset = 3600\n    if validity, ok := timestamp.(int64); ok {\n        tm := time.Unix(int64(validity), 0)\n        remainder := tm.Sub(time.Now())\n\n        if remainder &gt; 0 {\n            return int(remainder.Seconds() + float64(expireOffset))\n        }\n    }\n    return expireOffset\n}\n</code></pre>\n\n<p>To make it work, I added the <code>expireOffset</code> and set it to 3600.\nIn the first return statement, <code>expireOffset</code> has to be convertet to <code>float64</code>, and then the result back to <code>int</code>.\nThis way it works, though I'm not sure for what you add or return the offset.</p>\n\n<p>A full working example can be seen and tested <a href=\"https://play.golang.org/p/RvfJAeRj5q3\" rel=\"nofollow noreferrer\">here on the Go Playground</a>  .</p>\n"}], "owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3623, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1588507350, "creation_date": 1472032253, "last_edit_date": 1588507350, "question_id": 39119910, "link": "https://stackoverflow.com/questions/39119910/how-to-check-for-jwt-token-remaining-validity-time-golang", "title": "How to check for JWT token remaining validity time golang", "body": "<p>I am setting the the expiration of JWT token claims using </p>\n\n<pre><code>claims[\"exp\"] = time.Now().Add(time.Hour * time.Duration(settings.Get().JWTExpiration)).Unix()\n</code></pre>\n\n<p>where settings.Get().JWTExpiration gives me the settings I have made in my application settings file.</p>\n\n<p>I have written a function which should ideally give me the remaining time the token is valid for.</p>\n\n<pre><code>func getTokenRemainingValidity(timestamp interface{}) int {\n    if validity, ok := timestamp.(float64); ok {\n        tm := time.Unix(int64(validity), 0)\n        remainder := tm.Sub(time.Now())\n        if remainder &gt; 0 {\n            return int(remainder.Seconds() + expireOffset)\n        }\n    }\n    return expireOffset\n}\n</code></pre>\n\n<p>and I invoke this function like:</p>\n\n<pre><code>x := getTokenRemainingValidity(claims[\"exp\"])\nfmt.Println(x)\n</code></pre>\n\n<p>where claims[\"exp\"] is the claims I have got after parsing a jwt token.\nBut this always gives me same output. i.e. <code>3600</code>. How can I check for the remaining validity of my token. I am using golang.</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 1, "creation_date": 1472032578, "post_id": 39119035, "comment_id": 65585927, "body": "start /affinity 1 gobinary.exe"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472044218, "post_id": 39119035, "comment_id": 65594045, "body": "Setting processor affinity is OS specific, and is best done outside of the process itself. A command line tool like <code>taskset</code> on Linux is usually what you use to do this."}], "answers": [{"tags": [], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "is_accepted": true, "score": 2, "last_activity_date": 1472033851, "creation_date": 1472033851, "answer_id": 39120517, "question_id": 39119035, "link": "https://stackoverflow.com/questions/39119035/run-on-the-specific-cpu-not-one-goroutine/39120517#39120517", "title": "Run on the specific CPU, not one goroutine?", "body": "<p>To launch you Go binary, say <code>example.exe</code> so that it runs only on CPU 0 on Windows, you can use <code>start</code> command with \"affinity\" parameter:</p>\n\n<pre><code>start /affinity 1 example.exe\n</code></pre>\n\n<p>I don't know what exactly are you trying to achieve but refer to <a href=\"https://docs.google.com/document/d/1At2Ls5_fhJQ59kDK2DFVhFu3g5mATSXqqV5QrxinasI/edit\" rel=\"nofollow\">this document describing GOMAXPROCS</a> - it might be the case that Go runtime will do the same thing more efficiently.</p>\n"}, {"comments": [{"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 1, "creation_date": 1472049224, "post_id": 39122113, "comment_id": 65597903, "body": "I don&#39;t think it answers OP&#39;s question at all. Also, OS thread != CPU core, which I believe is what OP asked for."}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 0, "last_activity_date": 1472038165, "creation_date": 1472038165, "answer_id": 39122113, "question_id": 39119035, "link": "https://stackoverflow.com/questions/39119035/run-on-the-specific-cpu-not-one-goroutine/39122113#39122113", "title": "Run on the specific CPU, not one goroutine?", "body": "<p>Under the <strong>gc</strong> compilers (<strong>6g</strong> or <strong>8g</strong>) you must set <strong>GOMAXPROCS</strong> to more than the default value 1 to allow the run-time support to utilize more than one OS thread, that is all goroutines share the same thread unless GOMAXPROCS is set to a value <strong>greater than 1</strong>. </p>\n\n<p>When <strong>GOMAXPROCS</strong> is greater than 1, they run on a thread pool with that many threads. With the <strong>gccgo</strong> compiler GOMAXPROCS is effectively equal to the number of running goroutines. Suppose <code>n</code> is the number of processors or cores on the machine. If you set the environment variable <code>GOMAXPROCS &gt;= n</code>, or call <code>runtime.GOMAXPROCS(n)</code>, then the goroutines are divided (distributed)\namong the n processors. </p>\n\n<p>More processors however don\u2019t mean necessarily a linear improvement in performance, mainly because more communication is needed: the message-passing overhead increases. An experiential rule of thumb seems to be that for n cores setting <strong>GOMAXPROCS to n-1</strong> yields the best performance, and the following should also be followed: </p>\n\n<p><code>number of goroutines &gt; 1 + GOMAXPROCS &gt; 1</code></p>\n\n<p>So if there is only one goroutine executing at a certain point in time, don\u2019t set GOMAXPROCS!</p>\n\n<p>If you wish to lock a goroutine to a particular OS thread you can do this with <a href=\"https://golang.org/pkg/runtime/#LockOSThread\" rel=\"nofollow\">runtime.LockOSThread</a>.</p>\n\n<blockquote>\n  <p>LockOSThread wires the calling goroutine to its current operating\n  system thread. Until the calling goroutine exits or calls\n  UnlockOSThread, it will always execute in that thread, and no other\n  goroutine can.</p>\n</blockquote>\n\n<p>More about on <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow\">https://golang.org/pkg/runtime/</a>.</p>\n"}], "owner": {"reputation": 147, "user_id": 6725539, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/cc969f070b3697d44522d6b9718b2f10?s=128&d=identicon&r=PG&f=1", "display_name": "zmy", "link": "https://stackoverflow.com/users/6725539/zmy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 0, "accepted_answer_id": 39120517, "answer_count": 2, "score": 2, "last_activity_date": 1472107819, "creation_date": 1472029801, "last_edit_date": 1472107819, "question_id": 39119035, "link": "https://stackoverflow.com/questions/39119035/run-on-the-specific-cpu-not-one-goroutine", "title": "Run on the specific CPU, not one goroutine?", "body": "<p><code>golang</code> just has a method <code>runtime.GOMAXPROCS(1)</code> to set the application run one <code>goroutine</code> at the same time,But i want to let the application just run on the specificone cpu?</p>\n"}, {"tags": ["arrays", "string", "go", "compiler-errors", "string-length"], "answers": [{"comments": [{"owner": {"reputation": 297, "user_id": 6676988, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/KwQCQ.png?s=128&g=1", "display_name": "jiji", "link": "https://stackoverflow.com/users/6676988/jiji"}, "edited": false, "score": 0, "creation_date": 1472032762, "post_id": 39119047, "comment_id": 65586046, "body": "Thanks for the aswer!"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 1, "last_activity_date": 1472029830, "creation_date": 1472029830, "answer_id": 39119047, "question_id": 39118941, "link": "https://stackoverflow.com/questions/39118941/go-panic-runtime-error-index-out-of-range-when-the-length-of-array-is-not-nu/39119047#39119047", "title": "Go \u201cpanic: runtime error: index out of range\u201d when the length of array is not null", "body": "<p>Index out of range error is appearing because you are not initializing the <code>result</code> array with sufficient length.</p>\n\n<p>In <code>myFunc</code>, you have:</p>\n\n<pre><code>result := make([]string, 0, 4)\n</code></pre>\n\n<p>This creates a slice of strings which has an underlying array of length 4, but since you have declared slice length to be 0, none of the elements from underlying array are accessible to the slice. So even <code>result[0]</code> is out of range of the available indices.</p>\n\n<p>To fix this, simply supply a sufficiently large length parameter to <code>make</code>:</p>\n\n<pre><code>result := make([]string, 4, 4)\n</code></pre>\n\n<p>You can read more about how slices operate <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 297, "user_id": 6676988, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/KwQCQ.png?s=128&g=1", "display_name": "jiji", "link": "https://stackoverflow.com/users/6676988/jiji"}, "edited": false, "score": 0, "creation_date": 1472033415, "post_id": 39119736, "comment_id": 65586438, "body": "Thanks for the aswer! Didn&#39;t know about <code>slices</code>"}, {"owner": {"reputation": 4545, "user_id": 3749523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a0bfc9027da0504f91736fa45f29b89?s=128&d=identicon&r=PG", "display_name": "Sjon", "link": "https://stackoverflow.com/users/3749523/sjon"}, "edited": false, "score": 1, "creation_date": 1580985084, "post_id": 39119736, "comment_id": 106281248, "body": "this is incorrect - the <code>len()</code> call cannot trigger the panic, it will simply return <code>0</code>"}, {"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "reply_to_user": {"reputation": 4545, "user_id": 3749523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a0bfc9027da0504f91736fa45f29b89?s=128&d=identicon&r=PG", "display_name": "Sjon", "link": "https://stackoverflow.com/users/3749523/sjon"}, "edited": false, "score": 0, "creation_date": 1581348525, "post_id": 39119736, "comment_id": 106392802, "body": "@Sjon you misunderstood the OP question and also the answer. Who was talking about that <code>len()</code> triggered the panic? If you check the provided example you will realize that nobody was talking about your false presumption."}, {"owner": {"reputation": 4545, "user_id": 3749523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a0bfc9027da0504f91736fa45f29b89?s=128&d=identicon&r=PG", "display_name": "Sjon", "link": "https://stackoverflow.com/users/3749523/sjon"}, "edited": false, "score": 0, "creation_date": 1581410632, "post_id": 39119736, "comment_id": 106413929, "body": "@EndreSimo you are literally writing that in your answer. I see no panic when <a href=\"https://play.golang.org/p/hVDhEp-XzKE\" rel=\"nofollow noreferrer\">running your snippet</a>"}, {"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "reply_to_user": {"reputation": 4545, "user_id": 3749523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a0bfc9027da0504f91736fa45f29b89?s=128&d=identicon&r=PG", "display_name": "Sjon", "link": "https://stackoverflow.com/users/3749523/sjon"}, "edited": false, "score": 0, "creation_date": 1581493821, "post_id": 39119736, "comment_id": 106448266, "body": "@Sjon I don&#39;t want to get involved into a polemical discussion but please revise again your comment. I nowhere mentioned that <code>len()</code> will trigger a panic."}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": true, "score": 0, "last_activity_date": 1472032101, "last_edit_date": 1472032101, "creation_date": 1472031764, "answer_id": 39119736, "question_id": 39118941, "link": "https://stackoverflow.com/questions/39118941/go-panic-runtime-error-index-out-of-range-when-the-length-of-array-is-not-nu/39119736#39119736", "title": "Go \u201cpanic: runtime error: index out of range\u201d when the length of array is not null", "body": "<p>The issue is that you are creating a slice with length <code>0</code>, but with a maximum capacity of <code>4</code>, but at the same time you are trying to allocate already a value to the zeroth index of the slice created, which is normally empty. This is why you are receiving the <code>index out of range error</code>.</p>\n\n<pre><code>result := make([]string, 0, 4)\nfmt.Println(len(result)) //panic: runtime error: index out of range\n</code></pre>\n\n<p>You can change this code with:</p>\n\n<pre><code>result := make([]string, 4)\n</code></pre>\n\n<p>which means the capacity will be the same length as the slice length.</p>\n\n<pre><code>fmt.Println(cap(result)) // 4\nfmt.Println(len(result)) // 4\n</code></pre>\n\n<p>You can read about <em>arrays</em>, <em>slices</em> and <em>maps</em> here: <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow\">https://blog.golang.org/go-slices-usage-and-internals</a></p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1472036470, "post_id": 39121360, "comment_id": 65588530, "body": "@jiji   I hope this helps."}, {"owner": {"reputation": 297, "user_id": 6676988, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/KwQCQ.png?s=128&g=1", "display_name": "jiji", "link": "https://stackoverflow.com/users/6676988/jiji"}, "edited": false, "score": 0, "creation_date": 1472131089, "post_id": 39121360, "comment_id": 65636608, "body": "Thank you for your answer and the clarification about <code>append</code>. I think it&#39;s more useful in my case to do it without the append as I want to do some ordering using the same array rather than just adding at the end of the array."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 9, "last_activity_date": 1473769281, "last_edit_date": 1473769281, "creation_date": 1472036105, "answer_id": 39121360, "question_id": 39118941, "link": "https://stackoverflow.com/questions/39118941/go-panic-runtime-error-index-out-of-range-when-the-length-of-array-is-not-nu/39121360#39121360", "title": "Go \u201cpanic: runtime error: index out of range\u201d when the length of array is not null", "body": "<p>First let's explain: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>result := make([]string, 0, 4)\n</code></pre>\n\n<p>The <a href=\"https://golang.org/pkg/builtin/#make\" rel=\"noreferrer\">make</a> built-in function allocates and initializes an object of type <code>[]string</code> call it <code>Slice</code> of <code>string</code>   </p>\n\n<p><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"noreferrer\">Slice internals</a>: </p>\n\n<blockquote>\n  <p>A slice is a descriptor of an array segment. It consists of a pointer\n  to the array, the length of the segment, and its capacity (the maximum\n  length of the segment).</p>\n</blockquote>\n\n<p>So <code>result := make([]string, 0, 4)</code> allocates and initializes an object of type <code>[]string</code> with <code>length = 0</code> and <code>capacity = 4</code>.<br>\nAnd <code>result := make([]string, 4, 4)</code> allocates and initializes an object of type <code>[]string</code> with <code>length = 4</code> and <code>capacity = 4</code>, which is equal to <code>result := make([]string, 4)</code>.</p>\n\n<p>Now what is the difference between <code>result := make([]string, 0, 4)</code> and <code>result := make([]string, 4)</code>:  </p>\n\n<p>With <code>result := make([]string, 0, 4)</code> the underlying array of this Slice is empty meaning using <code>result[0]</code> will panic: runtime error: index out of range.</p>\n\n<p>With <code>result := make([]string, 4)</code> the underlying array of this Slice has 4 <code>string</code> elements, meaning using <code>result[0]</code>, <code>result[1]</code>, <code>result[2]</code>, <code>result[3]</code> is OK:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    result := make([]string, 4)\n    fmt.Printf(\"%q, %q, %q, %q \\n\", result[0], result[1], result[2], result[3])\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>\"\", \"\", \"\", \"\" \n</code></pre>\n\n<p>And <code>result := make([]string, 4)</code> is equal to <code>result := []string{\"\", \"\", \"\", \"\"}</code> meaning this code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    result := []string{\"\", \"\", \"\", \"\"}\n    fmt.Printf(\"%q, %q, %q, %q \\n\", result[0], result[1], result[2], result[3])\n}\n</code></pre>\n\n<p>output is the same as above code:</p>\n\n<pre><code>\"\", \"\", \"\", \"\" \n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>The <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"noreferrer\">append</a> built-in function\n  appends elements to the end of a slice. If it has sufficient capacity,\n  the destination is resliced to accommodate the new elements. If it\n  does not, a new underlying array will be allocated. Append returns the\n  updated slice. It is therefore necessary to store the result of\n  append, often in the variable holding the slice itself:</p>\n\n<pre><code>slice = append(slice, elem1, elem2)\nslice = append(slice, anotherSlice...)\n</code></pre>\n  \n  <p>As a special case, it is legal to append a string to a byte slice,\n  like this:</p>\n\n<pre><code>slice = append([]byte(\"hello \"), \"world\"...)\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>Now in your code inside function <code>myFunc</code> after <code>result := make([]string, 0, 4)</code>, you may use <code>append</code>, like this working code (<a href=\"https://play.golang.org/p/kNb_X1hp5D\" rel=\"noreferrer\">The Go Playground</a>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    strs := strings.Fields(\"Political srt\")\n    fmt.Println(len(strs)) // It's not empty so why index out of range\n    fmt.Println(strs, strs[0], strs[1])\n    fmt.Println(strings.ContainsAny(strs[0], \"eaiuo\"))\n    fmt.Println(myFunc(\"Political srt\"))\n}\n\nfunc myFunc(input string) []string {\n    strs := strings.Fields(input)\n    result := make([]string, 0, 4)\n    for i := 0; i &lt; len(strs); i++ {\n        if strings.ContainsAny(strs[i], \"eaiu\") {\n            result = append(result, strs[i])\n        } else {\n            result = append(result, strs[i])\n        }\n    }\n    return result\n}\n</code></pre>\n\n<hr>\n\n<p>You may simplify that code, like this working code (<a href=\"https://play.golang.org/p/4ZadHTuVZF\" rel=\"noreferrer\">The Go Playground</a>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    fmt.Println(myFunc(\"Political srt\"))\n}\n\nfunc myFunc(input string) []string {\n    strs := strings.Fields(input)\n    result := make([]string, 0, 4)\n    for _, s := range strs {\n        if strings.ContainsAny(s, \"eaiu\") {\n            result = append(result, s)\n        }\n    }\n    return result\n}\n</code></pre>\n"}], "owner": {"reputation": 297, "user_id": 6676988, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/KwQCQ.png?s=128&g=1", "display_name": "jiji", "link": "https://stackoverflow.com/users/6676988/jiji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 27151, "favorite_count": 3, "accepted_answer_id": 39119736, "answer_count": 3, "score": 5, "last_activity_date": 1597983952, "creation_date": 1472029515, "last_edit_date": 1597983952, "question_id": 39118941, "link": "https://stackoverflow.com/questions/39118941/go-panic-runtime-error-index-out-of-range-when-the-length-of-array-is-not-nu", "title": "Go \u201cpanic: runtime error: index out of range\u201d when the length of array is not null", "body": "<p>I am having a hard time learning how to loop through a string in Go to do some stuff (specifically, to separate words than contain vowels).</p>\n<p>I wrote this code snippet: <a href=\"https://play.golang.org/p/zgDtOyq6qf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zgDtOyq6qf</a>.</p>\n<p>Here is the error I\u2019m getting when running it:</p>\n<pre><code>panic: runtime error: index out of range\n\ngoroutine 1 [running]:\npanic(0x1045a0, 0x1040a010)\n    /usr/local/go/src/runtime/panic.go:500 +0x720\nmain.myFunc(0x114130, 0x4, 0x0, 0x0, 0x0, 0x3ba3)\n    /tmp/sandbox960520145/main.go:19 +0x1a0\nmain.main()\n    /tmp/sandbox960520145/main.go:10 +0x40\n</code></pre>\n<p>I searched in this forum, and someone said that it\u2019s due to the length of the array, but it\u2019s not the case here. I cannot figure out how to solve this issue.\nCan someone please suggest something?</p>\n"}, {"tags": ["go", "ssh", "pty"], "comments": [{"owner": {"reputation": 1795, "user_id": 1431317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e565cf25d753bc7b715eac4a21edb4d6?s=128&d=identicon&r=PG", "display_name": "user1431317", "link": "https://stackoverflow.com/users/1431317/user1431317"}, "edited": false, "score": 1, "creation_date": 1472040969, "post_id": 39118716, "comment_id": 65591622, "body": "See this answer: <a href=\"http://stackoverflow.com/a/16839544/1431317\">stackoverflow.com/a/16839544/1431317</a>"}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 1795, "user_id": 1431317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e565cf25d753bc7b715eac4a21edb4d6?s=128&d=identicon&r=PG", "display_name": "user1431317", "link": "https://stackoverflow.com/users/1431317/user1431317"}, "edited": false, "score": 0, "creation_date": 1472041236, "post_id": 39118716, "comment_id": 65591817, "body": "@user1431317 thank you. No way then."}], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 931, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472028850, "creation_date": 1472028850, "question_id": 39118716, "link": "https://stackoverflow.com/questions/39118716/ssh-is-it-possible-to-get-stderr-from-the-session-with-pseudo-terminal", "title": "SSH: is it possible to get STDERR from the session with pseudo-terminal?", "body": "<p>This question is about <code>golang.org/x/crypto/ssh</code> package and maybe pseudo-terminal behaviour.</p>\n\n<p><strong>The code</strong></p>\n\n<p>Here is the demo code. You can run it on your local machine just change credentials to access SSH.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"golang.org/x/crypto/ssh\"\n    \"io\"\n)\n\nfunc main() {\n    var pipe io.Reader\n    whichPipe := \"error\" // error or out\n\n    address := \"192.168.1.62:22\"\n    username := \"username\"\n    password := \"password\"\n\n    sshConfig := &amp;ssh.ClientConfig{\n        User: username,\n        Auth: []ssh.AuthMethod{ssh.Password(password)},\n    }\n\n    connection, err := ssh.Dial(\"tcp\", address, sshConfig)\n    if err != nil {\n        panic(err)\n    }\n\n    session, err := connection.NewSession()\n    if err != nil {\n        panic(err)\n    }\n\n    modes := ssh.TerminalModes{\n        ssh.ECHO: 0,\n        ssh.ECHOCTL: 0,\n        ssh.TTY_OP_ISPEED: 14400,\n        ssh.TTY_OP_OSPEED: 14400,\n    }\n\n    if err := session.RequestPty(\"xterm\", 80, 0, modes); err != nil {\n        session.Close()\n        panic(err)\n    }\n\n    switch whichPipe {\n    case \"error\":\n        pipe, _ = session.StderrPipe()\n    case \"out\":\n        pipe, _ = session.StdoutPipe()\n    }\n\n    err = session.Run(\"whoami23\")\n\n    scanner := bufio.NewScanner(pipe)\n    for scanner.Scan() {\n        fmt.Println(scanner.Text())\n    }\n}\n</code></pre>\n\n<p><strong>Actual result</strong></p>\n\n<p>Empty line</p>\n\n<p><strong>Expected result</strong></p>\n\n<p><code>bash: whoami23: command not found</code></p>\n\n<p><strong>Current \"solution\"</strong></p>\n\n<p>To get expected result you have two options:</p>\n\n<ol>\n<li>Change <code>whichPipe</code> value to <code>out</code>. Yes, all errors going to stdout in case if you use <code>tty</code>.</li>\n<li>Remove <code>session.RequestPty</code>. But in my case, I need to run <code>sudo</code> commands which require <code>tty</code> (servers are out of my control so I can't disable this requirement).</li>\n</ol>\n\n<p>I use third way. I check <code>err</code> from <code>err = session.Run(\"whoami23\")</code> and if it's not <code>nil</code> I mark content of <code>session.StdoutPipe()</code> as STDERR one.</p>\n\n<p>But this method has limits. For example, if I run something like <code>sudo sh -c 'uname -r; whoami23;'</code> the whole result will be marked as error while <code>uname -r</code> returns output to STDOUT.</p>\n\n<p><strong>The question</strong></p>\n\n<p>While the behaviour looks logical to me (all that SSH client sees from pty is output without differentiations) I'm still not sure if I may miss something and there is a trick that allows to split these outputs.</p>\n"}, {"tags": ["mysql", "go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1472027330, "post_id": 39118065, "comment_id": 65582549, "body": "Thanks. Its working fine. I have a question though, where should i add close(ch) in my code. Also, that done is not getting printed. Will it print only when channel is closed ?"}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1472035274, "post_id": 39118065, "comment_id": 65587734, "body": "I am having a doubt, In <code>fun dbtest</code> if I don&#39;t use <code>getdataList</code> with go routines. Using apache benchmark I get better performance if i don&#39;t use the two <code>getdataList</code> functions with go routine. Can u explain me why?"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 1, "creation_date": 1472037561, "post_id": 39118065, "comment_id": 65589193, "body": "I cannot say with certainty but my guess would be that with goroutines, concurrent access is forcing sql&#39;s <code>db</code> to open two connections. Without goroutines, first call to <code>getdataList</code> creates one connection, which is then used by the second call to <code>getdataList</code>. My advice would be to update <code>getdataList</code> so it takes a list of ids and fetches most of the data with a single query. In that case, <code>getdataList([]int{2, 3})</code> with an similarly updated sql query would provide even better performance."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1472041082, "post_id": 39118065, "comment_id": 65591708, "body": "Hey, would you mind helping me with another problem. <a href=\"http://stackoverflow.com/questions/39122458/get-post-data-using-golang-http-package/39122551#39122551\" title=\"get post data using golang http package\">stackoverflow.com/questions/39122458/&hellip;</a>"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 1, "last_activity_date": 1472027333, "last_edit_date": 1472027333, "creation_date": 1472026956, "answer_id": 39118065, "question_id": 39117702, "link": "https://stackoverflow.com/questions/39117702/channel-of-type-interface-not-receiving-value-in-golang-with-mysql/39118065#39118065", "title": "channel of type interface not receiving value in golang with MySql", "body": "<p>The problem with your code is that it is blocking the execution flow before data can be read from the channel. When you call <code>RunQuery</code> from <code>getdataList</code>, <code>RunQuery</code> tries to send data over channel <code>ch</code>. However, nothing is reading from <code>ch</code> because the code to read from it is in <code>getdataList</code> and it's below the call to <code>RunQuery</code>.</p>\n\n<p>Therefore, <code>RunQuery</code> never returns and the goroutine to read from <code>ch</code> never fires. To fix, You can try running <code>RunQuery</code> as a goroutine as well:</p>\n\n<pre><code>func getdataList(id int) {\n        ch := make(chan interface{})\n        done := make (chan bool)\n        // run in a goroutine\n        go RunQuery(ch,\"select id,name, last_name,first_name from persons where id= ?\", id)\n        go func() {\n            for {\n            x, ok := &lt;-ch //I am not getting any data in channel here\n            if ok {\n                fmt.Println(x)\n            }else {\n                fmt.Println(\"done\")\n                done &lt;- true\n                return\n            }\n\n        }\n    }()\n}\n</code></pre>\n\n<p>There is another issue in your code. You are never closing <code>ch</code>. This may result in deadlock. The most ideal place to do this appears to be in <code>RunQuery</code>:</p>\n\n<pre><code>func RunQuery (ch chan interface{}, query string, param interface{}) {\n    // ...\n    ch &lt;- tableData\n    close(ch)\n}\n</code></pre>\n"}], "owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1171, "favorite_count": 0, "accepted_answer_id": 39118065, "answer_count": 1, "score": 0, "last_activity_date": 1472027333, "creation_date": 1472025865, "question_id": 39117702, "link": "https://stackoverflow.com/questions/39117702/channel-of-type-interface-not-receiving-value-in-golang-with-mysql", "title": "channel of type interface not receiving value in golang with MySql", "body": "<p>I am new to golang. I am trying to do concurrent queries to mysql db with golang. I know channels can be of the type interface. When I print <code>tableData (type map)</code> in <code>RunQuery</code> function I am getting the result. I am sending <code>tableData</code> to <code>ch</code> i.e. channel of type interface. In function <code>getdataList</code> I am not getting any value in <code>ch</code>. I don't understand what I am doing wrong.</p>\n\n<p>Following is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"net/http\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"log\"\n)\n\n\nvar db *sql.DB\n\nfunc getdataList(id int) {\n        ch := make(chan interface{})\n        done := make (chan bool)\n        RunQuery(ch,\"select id,name, last_name,first_name from persons where id= ?\", id)\n        go func() {\n            for {\n            x, ok := &lt;-ch //I am not getting any data in channel here\n            if ok {\n                fmt.Println(x)\n            }else {\n                fmt.Println(\"done\")\n                done &lt;- true\n                return\n            }\n\n        }\n        }()\n    }\n\nfunc RunQuery (ch chan interface{}, query string, param interface{}) {\n\n    stmt, err := db.Prepare(query)\n    if err != nil {\n                panic(err.Error())\n            }\n    defer stmt.Close()\n    rows, err := stmt.Query(param)\n    columns, err := rows.Columns()\n    if err != nil {\n        fmt.Println(\"Failed to get columns\", err)\n        return\n    }\n    count := len(columns)\n    tableData := make([]map[string]interface{}, 0)\n    values := make([]interface{}, count)\n    valuePtrs := make([]interface{}, count)\n    for rows.Next() {\n      for i := 0; i &lt; count; i++ {\n          valuePtrs[i] = &amp;values[i]\n      }\n      rows.Scan(valuePtrs...)\n      entry := make(map[string]interface{})\n      for i, col := range columns {\n          var v interface{}\n          val := values[i]\n          b, ok := val.([]byte)\n          if ok {\n              v = string(b)\n          } else {\n              v = val\n          }\n          entry[col] = v\n      }\n      tableData = append(tableData, entry)\n  }\n    fmt.Pritln(tableData) //here I am getting data in map\n    ch &lt;- tableData\n}\n\n\nfunc dbtest(w http.ResponseWriter, req *http.Request) {\n\n    go getdataList(2)\n    go getdataList(3)\n}\n\nfunc main() {\n    var err error\n    db, err = sql.Open(\"mysql\", \"root:@/dbName\")\n    if err != nil {\n        panic(err.Error())  \n    }\n    defer db.Close()\n\n    http.HandleFunc(\"/dbTest\", dbtest)\n\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1189, "user_id": 3931609, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/4n2cW.jpg?s=128&g=1", "display_name": "Kul", "link": "https://stackoverflow.com/users/3931609/kul"}, "edited": false, "score": 1, "creation_date": 1472012628, "post_id": 39114031, "comment_id": 65575594, "body": "dereference* (I tried editing this but it didn&#39;t allow me since the change was less than 6 characters)"}, {"owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "edited": false, "score": 0, "creation_date": 1472020753, "post_id": 39114031, "comment_id": 65578644, "body": "The reader needs to click on a link to understand this answer.  (unless you already know what dereference means, but even so, how do you do that in golang\u2014click on the link to find out :D"}], "tags": [], "owner": {"reputation": 93, "user_id": 4080377, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Yph2XH5YPG4/AAAAAAAAAAI/AAAAAAAAGdQ/iccviMciKaA/photo.jpg?sz=128", "display_name": "Tom Scanlan", "link": "https://stackoverflow.com/users/4080377/tom-scanlan"}, "is_accepted": true, "score": 6, "last_activity_date": 1472047455, "last_edit_date": 1472047455, "creation_date": 1472010002, "answer_id": 39114031, "question_id": 39113876, "link": "https://stackoverflow.com/questions/39113876/golang-non-struct-type-pointer-receiver/39114031#39114031", "title": "Golang Non-Struct Type Pointer Receiver", "body": "<p>You need to dereference the <code>u</code> before setting it's value. </p>\n\n<p>From your example, change </p>\n\n<pre><code>defaultIP := userIP(\"127.0.0.1\")\nu = &amp;defaultIP\n</code></pre>\n\n<p>to</p>\n\n<pre><code>*u = userIP(\"127.0.0.1\")\n</code></pre>\n\n<p>For your example updated and working: <a href=\"https://play.golang.org/p/ycCLT0ed9F\" rel=\"nofollow\">https://play.golang.org/p/ycCLT0ed9F</a></p>\n"}, {"tags": [], "owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "is_accepted": false, "score": 1, "last_activity_date": 1472014500, "last_edit_date": 1472014500, "creation_date": 1472013094, "answer_id": 39114467, "question_id": 39113876, "link": "https://stackoverflow.com/questions/39113876/golang-non-struct-type-pointer-receiver/39114467#39114467", "title": "Golang Non-Struct Type Pointer Receiver", "body": "<p>TL;DR: The pointer receiver needs to be dereferenced before it's value can be set. This applies to both struct and non-struct types. In the case of struct types, the dereferencing is automatically done by the selector expression.</p>\n\n<p>After digging around a bit further, I think this behaviour is caused by the fact that the pointer receiver is not the same pointer calling the method.</p>\n\n<p>Running this code snippet shows that the <code>u</code> pointer in the <code>main()</code> function is different from that in the <code>defaultIP()</code> method. Essentially, I end up <strong>only</strong> modifying the <code>u</code> pointer in the <code>defaultIP()</code> method. Executable example can be found <a href=\"https://play.golang.org/p/bjNWbNdTjg\" rel=\"nofollow\">here</a>.</p>\n\n<pre><code>func main() {\n  var u *userIP         \n  u.defaultIP()\n\n  fmt.Printf(\"main(): address of pointer is %v\\n\", &amp;u)\n  fmt.Printf(\"main(): user IP address is %v\\n\", u)\n}\n\ntype userIP net.IP\n\nfunc (u *userIP) defaultIP() {  \n  defaultIP := userIP(\"127.0.0.1\")\n  u = &amp;defaultIP\n\n  fmt.Printf(\"defaultIP(): address of pointer is %v\\n\", &amp;u)\n  fmt.Printf(\"defaultIP(): user IP address is %s\\n\", *u)\n}\n</code></pre>\n\n<p>The correct way to do this is as pointed in Tom's answer i.e. dereference <code>u</code> in the <code>defaultIP()</code> method.</p>\n\n<p>What puzzled me earlier was why would this example work if I wrapped the IP as a field in the struct? Running the code snippet shows that the two <code>u</code> pointers are indeed different, but the <code>ip</code> field is modified. Executable example can be found <a href=\"https://play.golang.org/p/bCDrb2FAH5\" rel=\"nofollow\">here</a>.</p>\n\n<pre><code>func main() {\n  u := &amp;userInfo{}\n  u.defaultIP()\n\n  fmt.Printf(\"main(): address of pointer is %v\\n\", &amp;u)\n  fmt.Printf(\"main(): user IP address is %s\\n\", u.ip)\n}\n\ntype userInfo struct{\n  ip net.IP\n}\n\nfunc (u *userInfo) defaultIP() {\n  u.ip = net.ParseIP(\"127.0.0.1\")\n  fmt.Printf(\"defaultIP(): address of pointer is %v\\n\", &amp;u)\n  fmt.Printf(\"defaultIP(): user IP address is %s\\n\", u.ip)\n}\n</code></pre>\n\n<p>Turns out that this is caused by the <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow\">selector expression</a> (<code>x.y</code>). To quote the doc,</p>\n\n<blockquote>\n  <p>Selectors automatically dereference pointers to structs. If x is a pointer to a struct,  x.y is shorthand for (<em>x).y; if the field y is also a pointer to a struct, x.y.z is shorthand for (</em>(*x).y).z, and so on. If x contains an anonymous field of type *A, where  A is also a struct type, x.f is a shortcut for (*x.A).f.</p>\n</blockquote>\n\n<p>So in my case, the <code>u.ip</code> expression dereferences <code>u</code> before modifying the <code>ip</code> field, which essentially translates to<code>(*u).ip</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "edited": false, "score": 0, "creation_date": 1472013600, "post_id": 39114503, "comment_id": 65575841, "body": "Using <code>u = &amp;defaultIP</code> is my problem. Without the dereferenced <code>*u</code>, <code>userIP{127, 0, 0, 1}</code> won&#39;t work."}, {"owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "edited": false, "score": 0, "creation_date": 1472014655, "post_id": 39114503, "comment_id": 65576158, "body": "<code>userIP(&quot;127.0.0.1&quot;)</code> is fine. Refer Tom&#39;s answer at <a href=\"https://play.golang.org/p/ycCLT0ed9F\" rel=\"nofollow noreferrer\">play.golang.org/p/ycCLT0ed9F</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "edited": false, "score": 0, "creation_date": 1472015604, "post_id": 39114503, "comment_id": 65576519, "body": "@isim You may use <code>net.ParseIP(&quot;127.0.0.1&quot;)</code>  or <code>userIP{127, 0, 0, 1}</code>"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 0, "last_activity_date": 1473769313, "last_edit_date": 1473769313, "creation_date": 1472013322, "answer_id": 39114503, "question_id": 39113876, "link": "https://stackoverflow.com/questions/39113876/golang-non-struct-type-pointer-receiver/39114503#39114503", "title": "Golang Non-Struct Type Pointer Receiver", "body": "<p>Two Options:</p>\n\n<p>1- With dereferencing: like this working code and using <code>net.ParseIP(\"127.0.0.1\")</code><br>\n(<a href=\"https://play.golang.org/p/qbVIFjCY7j\" rel=\"nofollow\">The Go Playground</a>):  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n)\n\ntype userIP net.IP\n\nfunc main() {\n    var u userIP\n    u.defaultIP()\n    fmt.Println(u)\n}\n\nfunc (u *userIP) defaultIP() {\n    *u = userIP(net.ParseIP(\"127.0.0.1\"))\n}\n</code></pre>\n\n<p>output:  </p>\n\n<pre><code>[0 0 0 0 0 0 0 0 0 0 255 255 127 0 0 1]\n</code></pre>\n\n<hr>\n\n<p>2- Without dereferencing (<a href=\"https://play.golang.org/p/QLTX0iR3Jr\" rel=\"nofollow\">The Go Playground</a>):  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n)\n\ntype userIP net.IP\n\nfunc main() {\n    u := make(userIP, 4)\n    u.defaultIP()\n    fmt.Printf(\"%v\\n\", u)\n}\n\nfunc (u userIP) defaultIP() {\n    u[0], u[1], u[2], u[3] = 127, 0, 0, 1\n}\n</code></pre>\n\n<hr>\n\n<p>And note that <code>net.IP</code> is <code>[]byte</code>, see <code>net.IP</code> Docs:</p>\n\n<blockquote>\n  <p>An IP is a single IP address, a slice of bytes. Functions in this\n  package accept either 4-byte (IPv4) or 16-byte (IPv6) slices as input.</p>\n</blockquote>\n"}], "owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1380, "favorite_count": 3, "accepted_answer_id": 39114031, "answer_count": 3, "score": 5, "last_activity_date": 1473769313, "creation_date": 1472008879, "question_id": 39113876, "link": "https://stackoverflow.com/questions/39113876/golang-non-struct-type-pointer-receiver", "title": "Golang Non-Struct Type Pointer Receiver", "body": "<p>I created a custom type based on the Golang <a href=\"https://golang.org/pkg/net/#IP\" rel=\"noreferrer\"><code>net.IP</code></a> type. What surprised me is that a method declared with a pointer receiver to my custom type can't modify the value to which the receiver points.</p>\n\n<p>The <code>u</code> variable in this code snippet remains <code>nil</code> after calling <code>u.defaultIP()</code>. The IP can be modified if I changed my custom type to a struct with an IP field and the method is defined with a pointer receiver to the struct. What am I missing? Executable example can be found <a href=\"https://play.golang.org/p/QZhx4XqOHt\" rel=\"noreferrer\">here</a>.</p>\n\n<pre><code>type userIP net.IP\n\nfunc main() {\n  var u *userIP\n  u.defaultIP()\n  fmt.Printf(\"%v\\n\", u) \n}\n\nfunc (u *userIP) defaultIP() {\n  defaultIP := userIP(\"127.0.0.1\")\n  u = &amp;defaultIP\n}\n</code></pre>\n"}, {"tags": ["variables", "go"], "answers": [{"comments": [{"owner": {"reputation": 470, "user_id": 1557245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/17bf8fd4c97bbef14f4be16a432e1528?s=128&d=identicon&r=PG&f=1", "display_name": "Allen Heavey", "link": "https://stackoverflow.com/users/1557245/allen-heavey"}, "edited": false, "score": 0, "creation_date": 1472007671, "post_id": 39113529, "comment_id": 65574489, "body": "Sorry for the example, i use interface just as a placeholder, the real one is a custom structure"}], "tags": [], "owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "is_accepted": false, "score": 4, "last_activity_date": 1472006645, "last_edit_date": 1592644375, "creation_date": 1472006089, "answer_id": 39113529, "question_id": 39113464, "link": "https://stackoverflow.com/questions/39113464/when-should-i-initialize-golang-variables/39113529#39113529", "title": "When should I initialize Golang variables", "body": "<p>Go is a very consistent language: <a href=\"https://golang.org/ref/spec#Variables\" rel=\"nofollow noreferrer\">it <em>always</em> automatically initializes variables:</a></p>\n<blockquote>\n<p>A variable's value is retrieved by referring to the variable in an expression; it is the most recent value assigned to the variable. If a variable has not yet been assigned a value, its value is the zero value for its type.</p>\n</blockquote>\n<p><a href=\"https://tour.golang.org/basics/12\" rel=\"nofollow noreferrer\">The zero value is:</a></p>\n<blockquote>\n<p><code>0</code> for numeric types,</p>\n<p><code>false</code> for the boolean type, and</p>\n<p><code>&quot;&quot;</code> (the empty string) for strings.</p>\n</blockquote>\n<p>In the case of maps, slices, pointers, and interfaces, the zero value is <code>nil</code>.</p>\n<p>For custom types, <a href=\"http://dave.cheney.net/2013/01/19/what-is-the-zero-value-and-why-is-it-useful\" rel=\"nofollow noreferrer\">it is idiomatic</a> (i.e. generally considered best practice) to make the zero value useful somehow, usually as a default value or important sentinel.</p>\n<hr />\n<p>Edit: your example <a href=\"https://play.golang.org/p/leSnANRiUO\" rel=\"nofollow noreferrer\">does not crash.</a> Maybe one of the things you removed from it was causing the crash instead?</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 12, "last_activity_date": 1617220956, "last_edit_date": 1617220956, "creation_date": 1472009729, "answer_id": 39113992, "question_id": 39113464, "link": "https://stackoverflow.com/questions/39113464/when-should-i-initialize-golang-variables/39113992#39113992", "title": "When should I initialize Golang variables", "body": "<p>Golang will init all variables (not <strike>sometimes</strike>, not <strike>some</strike>):</p>\n<p>In your code:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func bar(bts []byte) (a *User) {\n  err := json.Unmarshal(bts, a) // It will crash\n}\n</code></pre>\n<p>You passed a nil pointer but you need a value pointed to by <code>a</code> , not a nil pointer:<br />\nSo you may create a Value then store the address of this Value inside <code>a</code>:</p>\n<hr />\n<p>When you use <code>var a *User</code> or <code>func bar(bts []byte) (a *User)</code>:<br />\nThe <code>a</code> is a pointer to the <code>User</code> type, and it is initialized to it's zero value, which is <code>nil</code>,<br />\nsee (<a href=\"https://play.golang.org/p/TexE3uCzQI\" rel=\"nofollow noreferrer\">The Go Playground</a>):</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport &quot;fmt&quot;\n\nfunc main() {\n    var a *User\n    fmt.Printf(&quot;%#v\\n\\n&quot;, a)    \n}\n\ntype User struct {\n    Name string `json:&quot;Name&quot;`\n    Age  int    `json:&quot;Age&quot;`\n}\n</code></pre>\n<p>output:</p>\n<pre><code>(*main.User)(nil)\n</code></pre>\n<hr />\n<p>And You may use <code>a = &amp;User{}</code> to initialize it, like this working code (<a href=\"https://play.golang.org/p/ubUYufOjfq\" rel=\"nofollow noreferrer\">The Go Playground</a>):</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;encoding/json&quot;\n    &quot;fmt&quot;\n)\n\nfunc foo(bts []byte) (*User, error) {\n    var a User\n    err := json.Unmarshal(bts, &amp;a) // It's ok\n    return &amp;a, err\n}\n\nfunc bar(bts []byte) (a *User, err error) {\n    a = &amp;User{}\n    err = json.Unmarshal(bts, a) // It's ok\n    return\n}\nfunc main() {\n    str := `{ &quot;Name&quot;: &quot;Alex&quot;, &quot;Age&quot;: 3 }`\n    u, err := foo([]byte(str))\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(&quot;%#v\\n\\n&quot;, u) // &amp;main.User{Name:&quot;Alex&quot;, Age:3}\n\n    u, err = bar([]byte(str))\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(&quot;%#v\\n\\n&quot;, u) // &amp;main.User{Name:&quot;Alex&quot;, Age:3}\n\n}\n\ntype User struct {\n    Name string `json:&quot;Name&quot;`\n    Age  int    `json:&quot;Age&quot;`\n}\n</code></pre>\n<p>output:</p>\n<pre><code>&amp;main.User{Name:&quot;Alex&quot;, Age:3}\n\n&amp;main.User{Name:&quot;Alex&quot;, Age:3}\n</code></pre>\n<hr />\n<p><a href=\"https://golang.org/ref/spec#Variable_declarations\" rel=\"nofollow noreferrer\">Variable declarations</a>:</p>\n<blockquote>\n<p>A variable declaration creates one or more variables, binds\ncorresponding identifiers to them, <strong>and gives each a type and an\ninitial value.</strong></p>\n</blockquote>\n<p><a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">The initial value (zero value)</a>:</p>\n<blockquote>\n<p>When storage is allocated for a variable, either through a declaration\nor a call of <code>new</code>, or when a <code>new</code> value is created, either through a\ncomposite literal or a call of <code>make</code>, and no explicit initialization is\nprovided, the variable or value is given a default value. Each element\nof such a variable or value is set to the zero value for its type:\n<code>false</code> for booleans, <code>0</code> for integers, <code>0.0</code> for floats, <code>&quot;&quot;</code> for strings,\n<strong>and <code>nil</code> for pointers</strong>, functions, interfaces, slices, channels, and\nmaps. This initialization is done recursively, so for instance each\nelement of an array of structs will have its fields zeroed if no value\nis specified.</p>\n</blockquote>\n<p>And see <code>func Unmarshal(data []byte, v interface{}) error</code> Docs:</p>\n<blockquote>\n<p>Unmarshal parses the JSON-encoded data and stores the result in the\nvalue pointed to by v.</p>\n</blockquote>\n"}], "owner": {"reputation": 470, "user_id": 1557245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/17bf8fd4c97bbef14f4be16a432e1528?s=128&d=identicon&r=PG&f=1", "display_name": "Allen Heavey", "link": "https://stackoverflow.com/users/1557245/allen-heavey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15404, "favorite_count": 0, "accepted_answer_id": 39113992, "answer_count": 2, "score": 5, "last_activity_date": 1617220956, "creation_date": 1472005506, "last_edit_date": 1472012049, "question_id": 39113464, "link": "https://stackoverflow.com/questions/39113464/when-should-i-initialize-golang-variables", "title": "When should I initialize Golang variables", "body": "<p>There are some kind of variables in Golang:</p>\n\n<ol>\n<li>global variable: <code>var a int</code></li>\n<li>local variable: <code>func hello() { var a int }</code></li>\n<li>return variable: <code>func hello() (a int) {}</code></li>\n</ol>\n\n<p>Golang sometimes will auto-init some variables,<br>\nbut I don't know when and why? It confused me.</p>\n\n<p>Example:</p>\n\n<pre><code>type User struct {\n  Name string `json:\"name\"`\n  Age  int    `json:\"age\"`\n}\n\nfunc foo(bts []byte) {\n  var a User\n  err := json.Unmarshal(bts, &amp;a)  // It's ok\n}\n\nfunc bar(bts []byte) (a *User) {\n  err := json.Unmarshal(bts, a) // It will crash\n}\n</code></pre>\n\n<p>which one should I have to initialize before use?</p>\n"}, {"tags": ["json", "rest", "http", "go", "gzip"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472021882, "post_id": 39112912, "comment_id": 65579248, "body": "Maybe because the 3 lines are unnecessary? The gzipFast function is already doing the gzipping of the json encoded box."}], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 1, "last_activity_date": 1472039042, "creation_date": 1472039042, "answer_id": 39122416, "question_id": 39112912, "link": "https://stackoverflow.com/questions/39112912/gzip-compression-to-http-responsewriter/39122416#39122416", "title": "gzip compression to http responseWriter", "body": "<p>I think the problem is the use of <code>fmt.Fprint(w, gzipFast(&amp;b))</code>. </p>\n\n<p>If you look to the definition of gzipFast it returns a <code>[]byte</code>. You are putting this slice into the print function, which is \"printing\" everything into <code>w</code>. </p>\n\n<p>If you look at the definition of the io.Writer:</p>\n\n<pre><code>type Writer interface {\n        Write(p []byte) (n int, err error) }\n</code></pre>\n\n<p>You see that the writer can handle <code>[]byte</code> as input. </p>\n\n<p>Instead of <code>fmt.Fprint(w, gzipFast(&amp;b))</code> you should use <code>w.Write(gzipFast(&amp;b))</code>. Then you don't need to uncomment:</p>\n\n<pre><code>//gz := gzip.NewWriter(w)\n//defer gz.Close()\n//json.NewEncoder(gz).Encode(box)\n</code></pre>\n\n<p>Everything as a small example, which shows what is happening in your code:</p>\n\n<p><a href=\"https://play.golang.org/p/6rzqLWTGiI\" rel=\"nofollow\">https://play.golang.org/p/6rzqLWTGiI</a></p>\n"}, {"comments": [{"owner": {"reputation": 199, "user_id": 1167741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/bf35c1cb67665b1d9cde2cf851716a3e?s=128&d=identicon&r=PG&f=1", "display_name": "stihl", "link": "https://stackoverflow.com/users/1167741/stihl"}, "edited": false, "score": 0, "creation_date": 1472084463, "post_id": 39125011, "comment_id": 65614992, "body": "I agree, this was really just a test for me to learn some things. If this api were production app then your solution is best."}], "tags": [], "owner": {"reputation": 2028, "user_id": 711336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b48c9965a4ceb5193259840d3abdf38b?s=128&d=identicon&r=PG", "display_name": "s7anley", "link": "https://stackoverflow.com/users/711336/s7anley"}, "is_accepted": false, "score": 0, "last_activity_date": 1472046164, "creation_date": 1472046164, "answer_id": 39125011, "question_id": 39112912, "link": "https://stackoverflow.com/questions/39112912/gzip-compression-to-http-responsewriter/39125011#39125011", "title": "gzip compression to http responseWriter", "body": "<p>I would avoid gzip-ing <code>[]byte</code> manually. You can easily use already existing writers from standard library. Additionally, take a look on <code>compress/flate</code> which I think should be use instead of gzip.  </p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"encoding/json\"\n    \"compress/gzip\"\n    \"log\"\n)\n\ntype Box struct {\n    Width int `json:\"width\"`\n}\n\nfunc writeJsonResponseCompressed(w http.ResponseWriter, r *http.Request) {\n\n    box := &amp;Box{Width: 10}\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.Header().Set(\"Content-Encoding\", \"gzip\")\n\n    body, err := json.Marshal(box)\n    if err != nil {\n        // Your error handling\n        return\n    }\n\n    writer, err := gzip.NewWriterLevel(w, gzip.BestCompression)\n    if err != nil {\n        // Your error handling\n        return\n    }\n\n    defer writer.Close()\n\n    writer.Write(body)\n}\n\nfunc main() {\n    http.HandleFunc(\"/compressedget\", writeJsonResponseCompressed)\n    log.Fatal(http.ListenAndServe(\":8081\", nil))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 199, "user_id": 1167741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/bf35c1cb67665b1d9cde2cf851716a3e?s=128&d=identicon&r=PG&f=1", "display_name": "stihl", "link": "https://stackoverflow.com/users/1167741/stihl"}, "edited": false, "score": 0, "creation_date": 1472084418, "post_id": 39125378, "comment_id": 65614980, "body": "This fixed it. Thanks!"}], "tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": true, "score": 1, "last_activity_date": 1472047080, "creation_date": 1472047080, "answer_id": 39125378, "question_id": 39112912, "link": "https://stackoverflow.com/questions/39112912/gzip-compression-to-http-responsewriter/39125378#39125378", "title": "gzip compression to http responseWriter", "body": "<p>You need to flush or close your gzip writer before accessing the underlying bytes, e.g.</p>\n\n<pre><code>func gzipFast(a *[]byte) []byte {\n    var b bytes.Buffer\n    gz := gzip.NewWriter(&amp;b)\n    if _, err := gz.Write(*a); err != nil {\n        gz.Close()\n        panic(err)\n    }\n    gz.Close()\n    return b.Bytes()\n}\n</code></pre>\n\n<p>Otherwise what's been buffer in the gzip writer, but not yet written out to the final stream isn't getting collected up. </p>\n"}], "owner": {"reputation": 199, "user_id": 1167741, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/bf35c1cb67665b1d9cde2cf851716a3e?s=128&d=identicon&r=PG&f=1", "display_name": "stihl", "link": "https://stackoverflow.com/users/1167741/stihl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2529, "favorite_count": 1, "accepted_answer_id": 39125378, "answer_count": 3, "score": 0, "last_activity_date": 1472047080, "creation_date": 1472000819, "question_id": 39112912, "link": "https://stackoverflow.com/questions/39112912/gzip-compression-to-http-responsewriter", "title": "gzip compression to http responseWriter", "body": "<p>I'm new to Go. But am playing with a REST Api. I cant get the same behavior out of json.Marshal as json.Encoder in two functions i have</p>\n\n<p>I wanted to use this function to gzip my responses:</p>\n\n<pre><code>func gzipFast(a *[]byte) []byte {\n    var b bytes.Buffer\n    gz := gzip.NewWriter(&amp;b)\n    defer gz.Close()\n    if _, err := gz.Write(*a); err != nil {\n        panic(err)\n    }\n    return b.Bytes()\n}\n</code></pre>\n\n<p>But this function returns this:</p>\n\n<pre><code>curl http://localhost:8081/compressedget --compressed --verbose\n*   Trying 127.0.0.1...\n* Connected to localhost (127.0.0.1) port 8081 (#0)\n&gt; GET /compressedget HTTP/1.1\n&gt; Host: localhost:8081\n&gt; User-Agent: curl/7.47.0\n&gt; Accept: */*\n&gt; Accept-Encoding: deflate, gzip\n&gt; \n&lt; HTTP/1.1 200 OK\n&lt; Content-Encoding: gzip\n&lt; Content-Type: application/json\n&lt; Date: Wed, 24 Aug 2016 00:59:38 GMT\n&lt; Content-Length: 30\n&lt; \n* Connection #0 to host localhost left intact\n</code></pre>\n\n<p>Here is the go function:</p>\n\n<pre><code>func CompressedGet(w http.ResponseWriter, r *http.Request, ps  httprouter.Params) {\n\n    box := Box{Width: 10, Height: 20, Color: \"gree\", Open: false}\n    box.ars = make([]int, 100)\n    for i := range box.ars {\n        box.ars[i] = i\n    }\n    //fmt.Println(r.Header.Get(\"Content-Encoding\"))\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.Header().Set(\"Content-Encoding\", \"gzip\")\n    b, _ := json.Marshal(box)\n    //fmt.Println(len(b))\n    //fmt.Println(len(gzipFast(&amp;b)))\n\n    fmt.Fprint(w, gzipFast(&amp;b))\n    //fmt.Println(len(gzipSlow(b)))\n    //gz := gzip.NewWriter(w)\n    //defer gz.Close()\n    //json.NewEncoder(gz).Encode(box)\n    r.Body.Close()\n\n}\n</code></pre>\n\n<p>But when i uncomment:</p>\n\n<pre><code>//gz := gzip.NewWriter(w)\n//defer gz.Close()\n//json.NewEncoder(gz).Encode(box)\n</code></pre>\n\n<p>it works fine.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1471998349, "post_id": 39112605, "comment_id": 65572411, "body": "Check your <code>$GOROOT&#47;src&#47;vendor&#47;</code> folder if there is a <code>golang_org</code> folder."}, {"owner": {"reputation": 59, "user_id": 4535045, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-tQFqtUxMQXY/AAAAAAAAAAI/AAAAAAAAIfk/73iQ0oeV9kc/photo.jpg?sz=128", "display_name": "Heath", "link": "https://stackoverflow.com/users/4535045/heath"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1471998905, "post_id": 39112605, "comment_id": 65572543, "body": "Yes, that directory exists.    ls $GOROOT/src/vendor/golang_org/x/net/http2/hpack/ encode.go  encode_test.go  hpack.go  hpack_test.go  huffman.go  tables.go"}], "answers": [{"tags": [], "owner": {"reputation": 59, "user_id": 4535045, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-tQFqtUxMQXY/AAAAAAAAAAI/AAAAAAAAIfk/73iQ0oeV9kc/photo.jpg?sz=128", "display_name": "Heath", "link": "https://stackoverflow.com/users/4535045/heath"}, "is_accepted": true, "score": 0, "last_activity_date": 1489606646, "last_edit_date": 1489606646, "creation_date": 1472084157, "answer_id": 39134849, "question_id": 39112605, "link": "https://stackoverflow.com/questions/39112605/how-do-i-set-godebug-environment-variables-in-golang-so-i-can-use-godebug-with-n/39134849#39134849", "title": "How do I set GODEBUG environment variables in Golang so I can use godebug with net/http", "body": "<p>This is probably not the correct way to do things. But I copied the http2 package from my vendor directory under $GOROOT/src/vendor to the src directory under my $GOPATH/src.</p>\n\n<p>If anyone has any further input on the correct way to reference vendor directories please add your thoughts. Just putting my workaround here in case someone else comes across the same issue.</p>\n\n<p>Edit: Actually a 'nicer' way to do things was to do an ln -s ..src/vender/github_org to ../src/github_org</p>\n"}], "owner": {"reputation": 59, "user_id": 4535045, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-tQFqtUxMQXY/AAAAAAAAAAI/AAAAAAAAIfk/73iQ0oeV9kc/photo.jpg?sz=128", "display_name": "Heath", "link": "https://stackoverflow.com/users/4535045/heath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2026, "favorite_count": 0, "accepted_answer_id": 39134849, "answer_count": 1, "score": 0, "last_activity_date": 1489606646, "creation_date": 1471998023, "last_edit_date": 1471998790, "question_id": 39112605, "link": "https://stackoverflow.com/questions/39112605/how-do-i-set-godebug-environment-variables-in-golang-so-i-can-use-godebug-with-n", "title": "How do I set GODEBUG environment variables in Golang so I can use godebug with net/http", "body": "<p>I want to step through my program using <a href=\"https://github.com/mailgun/godebug%22godebug%22\" rel=\"nofollow\">Godebug</a>. However because I'm using net/http I get errors such as:</p>\n\n<pre><code>/home/heath/go/src/net/http/h2_bundle.go:45:2: could not import golang_org/x/net/http2/hpack (cannot find package \"golang_org/x/net/http2/hpack\" in any of:\n    /home/heath/go/src/golang_org/x/net/http2/hpack (from $GOROOT)\n</code></pre>\n\n<p>/x/net/http2/hpack does exist in my GOPATH but in ~heath/go/src/golang.org ... not golang_org (not sure what's happening there)</p>\n\n<p>I have read that this error occurs because godebug doesn't support http2 yet (can't find source).</p>\n\n<p>I have tried to disable http2server and http2client by setting the GODEBUG env both in init() and on the command line. I have also confirmed that these settings are being set by doing a fmt.Println(\"GODEBUG\", os.Getenv(\"GODEBUG\"). As per instructions located <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow\">here</a></p>\n\n<pre><code>GODEBUG=http2client=0  # disable HTTP/2 client support\nGODEBUG=http2server=0  # disable HTTP/2 server support\n</code></pre>\n\n<p>My simple code example to replicate the error is:</p>\n\n<pre><code>  package main\n\n  import \"fmt\"\n  import \"net/http\"\n  import \"os\"\n\n  func init() {\n\n      os.Setenv(\"GODEBUG\", \"http2server=0,http2client=0\")\n\n  }\n\n  func main() {\n\n      fmt.Println(\"GODEBUG\", os.Getenv(\"GODEBUG\"))\n\n      _ = \"breakpoint\"\n      fmt.Println(\"Hello, World!\")\n      http.ListenAndServe(\":8080\", nil)\n  }\n\ngodebug run example.go\n</code></pre>\n\n<p>I am running Go version:</p>\n\n<p>go version go1.7 linux/amd64</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1471998991, "post_id": 39112511, "comment_id": 65572568, "body": "What version of Go are you using? I see that *httptest.ResponseRecorder does have a Result() method on the official (1.7) godoc, but when I run my local godoc (I still have 1.6 installed currently) I can&#39;t find it. Edit: sure enough, <a href=\"https://golang.org/doc/go1.7#net_http_httptest\" rel=\"nofollow noreferrer\">it&#39;s a new feature of Go1.7</a>"}, {"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1471999213, "post_id": 39112511, "comment_id": 65572615, "body": "If you think you&#39;ve upgraded to 1.7 already, it&#39;s probably still worth trying to clean out the directory where you had Go installed, dropping in a &quot;fresh&quot; Go1.7 directory instead, and then deleting your <code>pkg</code> and <code>bin</code> directories before trying the test again."}, {"owner": {"reputation": 3079, "user_id": 689424, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/05ffd09ae496b61db8fce4e1aaaf50f5?s=128&d=identicon&r=PG", "display_name": "onetwopunch", "link": "https://stackoverflow.com/users/689424/onetwopunch"}, "reply_to_user": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1471999371, "post_id": 39112511, "comment_id": 65572654, "body": "Huh...nice! I looked for that but I must have missed it. Thanks!"}, {"owner": {"reputation": 3079, "user_id": 689424, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/05ffd09ae496b61db8fce4e1aaaf50f5?s=128&d=identicon&r=PG", "display_name": "onetwopunch", "link": "https://stackoverflow.com/users/689424/onetwopunch"}, "reply_to_user": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1472000180, "post_id": 39112511, "comment_id": 65572821, "body": "@JesseAmano If you want to type that up in an answer, I&#39;ll accept it for posterity&#39;s sake"}], "answers": [{"tags": [], "owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "is_accepted": true, "score": 2, "last_activity_date": 1472002575, "creation_date": 1472002575, "answer_id": 39113128, "question_id": 39112511, "link": "https://stackoverflow.com/questions/39112511/httptest-responserecorder-has-no-field-or-method-result/39113128#39113128", "title": "httptest.ResponseRecorder has no field or method Result", "body": "<p>I initially addressed this as a comment because I was unsure of relevance, but for posterity:</p>\n\n<p>The online <a href=\"https://golang.org/pkg/\" rel=\"nofollow\">godoc</a> always references the latest release. In this case, the <code>Result()</code> method was added in Go1.7 which only released last week. When in doubt, check your local godoc by running <code>godoc -server</code> or <code>godoc &lt;packagename&gt;</code>.</p>\n"}], "owner": {"reputation": 3079, "user_id": 689424, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/05ffd09ae496b61db8fce4e1aaaf50f5?s=128&d=identicon&r=PG", "display_name": "onetwopunch", "link": "https://stackoverflow.com/users/689424/onetwopunch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 565, "favorite_count": 0, "accepted_answer_id": 39113128, "answer_count": 1, "score": 3, "last_activity_date": 1472002575, "creation_date": 1471997360, "question_id": 39112511, "link": "https://stackoverflow.com/questions/39112511/httptest-responserecorder-has-no-field-or-method-result", "title": "httptest.ResponseRecorder has no field or method Result", "body": "<p>So this one is really weird, I'm trying to get a mock response that renders JSON. My test looks like this:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"net/http\"\n    \"net/http/httptest\"\n    \"reflect\"\n    \"strings\"\n    \"testing\"\n)\n...\n\nfunc TestMessageFromResponse(t *testing.T) {\n    mc := MyController{}\n    body := \"{ \\\"message\\\":\\\"kthxbai\\\" }\"\n    w := httptest.NewRecorder()\n    w.Write([]byte(body))\n    resp := w.Result()\n    msg := mc.messageFromResponse(resp)\n    if msg != \"kthxbai\" {\n        t.Errorf(\"Expected response body to be kthxbai but was %s\", msg)\n    }\n}\n</code></pre>\n\n<p>I'm testing the method <code>messageFromResponse</code> on <code>MyController</code>but its not even building. When I run <code>go test</code> in my project directory, I get the following error:</p>\n\n<pre><code>./my_controller_test.go:115: w.Result undefined (type *httptest.ResponseRecorder has no field or method Result)\n</code></pre>\n\n<p>I should also mention that I am successfully using <code>httptest.ResponseRecorder</code> as a writer stub elsewhere in this same file, but it's just failing when I try to access <code>Result()</code>.</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1471997346, "post_id": 39112338, "comment_id": 65572149, "body": "Go is &quot;pass by value.&quot; So the <code>reference</code> function takes a pointer to an integer which happens to be a reference value. You don&#39;t need to return anything in that function either."}], "answers": [{"comments": [{"owner": {"reputation": 129, "user_id": 428728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48b82c3ec2b05c3d1b35d360513f5baf?s=128&d=identicon&r=PG", "display_name": "Marc", "link": "https://stackoverflow.com/users/428728/marc"}, "edited": false, "score": 0, "creation_date": 1472010212, "post_id": 39113378, "comment_id": 65575036, "body": "Ah, I see.  I didn&#39;t think about passing in a specific type to json.Unmarshal() and using that to &quot;filter&quot; the return value.  In all the examples I have seen so far, everything has just used an interface{} to scoop up all the attributes in the JSON.  Whereas, if the method parsed the json and returned it, you wouldn&#39;t have the choice."}, {"owner": {"reputation": 1795, "user_id": 1431317, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e565cf25d753bc7b715eac4a21edb4d6?s=128&d=identicon&r=PG", "display_name": "user1431317", "link": "https://stackoverflow.com/users/1431317/user1431317"}, "edited": false, "score": 0, "creation_date": 1472042239, "post_id": 39113378, "comment_id": 65592491, "body": "&quot;Golang does pass by value by default, including for slices.&quot; - That&#39;s true, but it&#39;s a little bit more complicated, because the slice itself contains a pointer to the data, so it acts as a reference type, e.g. you can modify the elements even if passed by value: <a href=\"https://play.golang.org/p/XmmeiCkRYy\" rel=\"nofollow noreferrer\">play.golang.org/p/XmmeiCkRYy</a> But appending may or may not work, depending on the capacity (because append may modify the pointer to point to a new memory location): <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a> <a href=\"https://blog.golang.org/slices#TOC_4.\" rel=\"nofollow noreferrer\">https://blog.golang.org/slices#TOC_4.</a>"}], "tags": [], "owner": {"reputation": 95, "user_id": 3321437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2e4b6e9ca0b7b8a238d5d3e87aff943?s=128&d=identicon&r=PG&f=1", "display_name": "user3321437", "link": "https://stackoverflow.com/users/3321437/user3321437"}, "is_accepted": true, "score": 1, "last_activity_date": 1472004688, "creation_date": 1472004688, "answer_id": 39113378, "question_id": 39112338, "link": "https://stackoverflow.com/questions/39112338/whats-the-difference-between-variable-assignment-and-passing-by-reference/39113378#39113378", "title": "What&#39;s the difference between variable assignment and passing by reference?", "body": "<p>Passing by value requires copying of parameters, however in case of reference, you just send the pointer to the object. Golang does pass by value by default, including for slices.</p>\n\n<p>For the specific question about json.Unmarshal, I believe the reason is so that the Unmarshal code can verify whether the object passed in contains the same field names with compatible types as found in the json. For example, if json has a repeated field, there needs to be a corresponding slice in the object we are unmarshaling into.</p>\n\n<p>So, we need to pass in the struct that we want the json string to unmarshal into. It needs to be a pointer so that Unmarshal can populate the fields. If you just pass a generic interface, Unmarshal will return a map. If Unmarshal did not take a pointer to a struct/interface, it could have been implemented to always return a map, but I think it is more useful this way.</p>\n\n<p>This is a simple example, but might be useful - <a href=\"https://play.golang.org/p/-n8euepSS0\" rel=\"nofollow\">https://play.golang.org/p/-n8euepSS0</a></p>\n"}], "owner": {"reputation": 129, "user_id": 428728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48b82c3ec2b05c3d1b35d360513f5baf?s=128&d=identicon&r=PG", "display_name": "Marc", "link": "https://stackoverflow.com/users/428728/marc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 0, "accepted_answer_id": 39113378, "answer_count": 1, "score": 2, "last_activity_date": 1472004688, "creation_date": 1471995967, "question_id": 39112338, "link": "https://stackoverflow.com/questions/39112338/whats-the-difference-between-variable-assignment-and-passing-by-reference", "title": "What&#39;s the difference between variable assignment and passing by reference?", "body": "<p>I'm pretty new to golang, and compiled languages in general, so please excuse my ignorance.  In some code like this: </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc assign() int {\n  return 1\n}\n\nfunc reference(foo *int) int {\n  *foo = 2\n  return 0\n}\n\nfunc main() {\n  var a, b int\n\n  a = assign()\n  reference(&amp;b)\n\n  fmt.Println(a)\n  fmt.Println(b)\n}\n</code></pre>\n\n<p>...what is the practical difference between assigning the value to a vs. passing b by reference?</p>\n\n<p>In terms of real-world code, why does json.Unmarshal() require you to pass a pointer to your empty variable rather than just returning the Unmarshalled value so you can assign it to your variable?</p>\n"}, {"tags": ["go", "godeps"], "owner": {"reputation": 1197, "user_id": 2572703, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ea9bb5d1f7a8a598ebc867c3b88e7aaa?s=128&d=identicon&r=PG", "display_name": "Sakib", "link": "https://stackoverflow.com/users/2572703/sakib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 287, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1471995199, "creation_date": 1471995199, "question_id": 39112256, "link": "https://stackoverflow.com/questions/39112256/change-godep-to-a-previous-version", "title": "Change godep to a previous version", "body": "<p>I am trying to revert my godep to a previous version. I need v52 but go installed the latest v74 when I ran go get godep. </p>\n\n<p>I tried replacing the godep binary in $GOPATH/bin. And go is picking it up.</p>\n\n<p>But the problem is when I try to run godep like <code>godep restore</code> or anything I get errors like below. I'm not sure where to go from here.</p>\n\n<pre><code>godep: Dep (github.com/BurntSushi/toml) restored, but was unable to load it with error:\n    Package (bufio) not found\ngodep: Dep (github.com/DataDog/datadog-go/statsd) restored, but was unable to load it with error:\n    Package (bytes) not found\ngodep: Dep (github.com/armon/go-metrics) restored, but was unable to load it with error:\n    Package (bufio) not found\ngodep: Dep (github.com/aws/aws-sdk-go/aws) restored, but was unable to load it with error:\n    Package (io) not found\ngodep: Dep (github.com/aws/aws-sdk-go/private/endpoints) restored, but was unable to load it with error:\n    Package (fmt) not found\ngodep: Dep (github.com/aws/aws-sdk-go/private/protocol) restored, but was unable to load it with error:\n    Package (crypto/rand) not found\ngodep: Dep (github.com/aws/aws-sdk-go/private/signer/v4) restored, but was unable to load it with error:\n    Package (crypto/hmac) not found\ngodep: Dep (github.com/aws/aws-sdk-go/private/waiter) restored, but was unable to load it with error:\n    Package (fmt) not found\ngodep: Dep (github.com/aws/aws-sdk-go/service/elasticache) restored, but was unable to load it with error:\n    Package (time) not found\ngodep: Dep (github.com/bradfitz/gomemcache/memcache) restored, but was unable to load it with error:\n    Package (bufio) not found\ngodep: Dep (github.com/garyburd/redigo/internal) restored, but was unable to load it with error:\n    Package (strings) not found\ngodep: Dep (github.com/garyburd/redigo/redis) restored, but was unable to load it with error:\n    Package (bufio) not found\ngodep: Dep (github.com/go-ini/ini) restored, but was unable to load it with error:\n    Package (bufio) not found\ngodep: Dep (github.com/go-stack/stack) restored, but was unable to load it with error:\n    Package (bytes) not found\ngodep: Dep (github.com/inconshreveable/log15) restored, but was unable to load it with error:\n    Package (bytes) not found\ngodep: Dep (github.com/jmespath/go-jmespath) restored, but was unable to load it with error:\n    Package (bytes) not found\ngodep: Dep (github.com/julienschmidt/httprouter) restored, but was unable to load it with error:\n    Package (net/http) not found\ngodep: Dep (github.com/martini-contrib/cors) restored, but was unable to load it with error:\n    Package (net/http) not found\ngodep: Dep (github.com/mattn/go-colorable) restored, but was unable to load it with error:\n    Package (bytes) not found\ngodep: Dep (github.com/mattn/go-isatty) restored, but was unable to load it with error:\n    Package (syscall) not found\ngodep: Dep (github.com/nu7hatch/gouuid) restored, but was unable to load it with error:\n    Package (crypto/md5) not found\ngodep: Dep (golang.org/x/net/context) restored, but was unable to load it with error:\n    Package (errors) not found\ngodep: Dep (golang.org/x/sys/unix) restored, but was unable to load it with error:\n    Package (errors) not found\ngodep: Dep (golang.org/x/text/transform) restored, but was unable to load it with error:\n    Package (bytes) not found\ngodep: Dep (golang.org/x/text/unicode/norm) restored, but was unable to load it with error:\n    Package (fmt) not found\ngodep: Error checking some deps.\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 255, "user_id": 6214802, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xbIYr.png?s=128&g=1", "display_name": "innectic", "link": "https://stackoverflow.com/users/6214802/innectic"}, "edited": false, "score": 0, "creation_date": 1471996255, "post_id": 39112356, "comment_id": 65571900, "body": "What are the use cases, though?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 255, "user_id": 6214802, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xbIYr.png?s=128&g=1", "display_name": "innectic", "link": "https://stackoverflow.com/users/6214802/innectic"}, "edited": false, "score": 0, "creation_date": 1471996419, "post_id": 39112356, "comment_id": 65571944, "body": "@innectic you can call it with <code>a.b()</code>"}], "tags": [], "owner": {"reputation": 21, "user_id": 6062378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e2e497d1c125a61f845b62ee4be1902?s=128&d=identicon&r=PG&f=1", "display_name": "Carl Cui", "link": "https://stackoverflow.com/users/6062378/carl-cui"}, "is_accepted": false, "score": 1, "last_activity_date": 1471996119, "creation_date": 1471996119, "answer_id": 39112356, "question_id": 39112198, "link": "https://stackoverflow.com/questions/39112198/method-prefixes-in-go/39112356#39112356", "title": "Method prefixes in Go", "body": "<p>It means that the function is <em>attached</em> to the struct, in this case, so that you can do <code>a.b()</code> somewhere else. </p>\n"}, {"tags": [], "owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "is_accepted": true, "score": 4, "last_activity_date": 1471997203, "creation_date": 1471997203, "answer_id": 39112492, "question_id": 39112198, "link": "https://stackoverflow.com/questions/39112198/method-prefixes-in-go/39112492#39112492", "title": "Method prefixes in Go", "body": "<p>Programming is communication: you are communicating to the machine what it should do, and communicating to other programmers (including your future self). Many higher-level programming constructs serve the purpose of making code more expressive--that is, more clearly stating the programmer's intent.</p>\n\n<p>Go's function receivers are like the \"self\" object in more traditional object-oriented languages. It's a way of grouping a set of functions together and saying \"these methods exist primarily to operate on objects of this type\", rather than just being general utility methods that happen to take an argument of that type. In other words, they exist to describe the behavior of the abstract object whose state is described by the structure.</p>\n"}], "owner": {"reputation": 255, "user_id": 6214802, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xbIYr.png?s=128&g=1", "display_name": "innectic", "link": "https://stackoverflow.com/users/6214802/innectic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "accepted_answer_id": 39112492, "answer_count": 2, "score": 0, "last_activity_date": 1471997203, "creation_date": 1471994822, "last_edit_date": 1471996371, "question_id": 39112198, "link": "https://stackoverflow.com/questions/39112198/method-prefixes-in-go", "title": "Method prefixes in Go", "body": "<p>In go, there's a \"prefix\" that you can put on a function. How is this useful? What are the use cases for this?</p>\n\n<p>Example:</p>\n\n<pre><code>type a struct {\n    Thing string\n}\n\nfunc (something a) b() {\n    fmt.Println(something.Thing)\n}\n</code></pre>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 1, "creation_date": 1471994697, "post_id": 39112099, "comment_id": 65571546, "body": "Just a note about regex compile in case you get used to writing it like you did in the question. Regex compile is <i>expensive</i>. Do it once and store the result. Saw some code recently that did MustCompile in a loop. That was a very slow mistake."}, {"owner": {"reputation": 507123, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1471997432, "post_id": 39112099, "comment_id": 65572171, "body": "Yes, you are not supposed to put <code>\\z</code> in the character class. It would match a literal <code>z</code> in there."}, {"owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1471998458, "post_id": 39112099, "comment_id": 65572438, "body": "@ZanLynx Good pointer. Its just test code for me, but we wouldn&#39;t want people to emulate it."}, {"owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "reply_to_user": {"reputation": 507123, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1471998492, "post_id": 39112099, "comment_id": 65572449, "body": "@Bergi Yep, that is what my tests seem to indicate."}], "answers": [{"comments": [{"owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "edited": false, "score": 0, "creation_date": 1471998520, "post_id": 39112241, "comment_id": 65572455, "body": "Helpful reply, however there could be more in the string, otherwise I would have done that. I will update the question to clarify this."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 2, "last_activity_date": 1471995589, "last_edit_date": 1471995589, "creation_date": 1471995112, "answer_id": 39112241, "question_id": 39112099, "link": "https://stackoverflow.com/questions/39112099/how-do-you-match-character-or-end-of-string-in-a-golang-regexp/39112241#39112241", "title": "How do you match character OR end of string in a golang regexp?", "body": "<p>Put a <code>?</code> at the end of the pattern. That means the preceding item is optional.</p>\n\n<p>If you want to anchor the pattern to match at the end of the string, put a <code>$</code> (or <code>\\z</code>) at the very end (after the <code>?</code>).</p>\n\n<p>Also, you should use backquotes instead of double quotes around your RE. That way you don't have to escape the backslashes.</p>\n\n<p>And as @Zan Lynx mentioned, only compile the RE once.</p>\n"}, {"comments": [{"owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "edited": false, "score": 0, "creation_date": 1471998721, "post_id": 39112301, "comment_id": 65572503, "body": "Life-saver. This solves it perfectly. I&#39;ll ammend your post as well to  clarify that there could be more at the end of the url"}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": true, "score": 1, "last_activity_date": 1471998737, "last_edit_date": 1471998737, "creation_date": 1471995602, "answer_id": 39112301, "question_id": 39112099, "link": "https://stackoverflow.com/questions/39112099/how-do-you-match-character-or-end-of-string-in-a-golang-regexp/39112301#39112301", "title": "How do you match character OR end of string in a golang regexp?", "body": "<p>I was interested and played around with it just for fun. Maybe something like this: <a href=\"https://play.golang.org/p/GRVnHTwW0g\" rel=\"nofollow\">https://play.golang.org/p/GRVnHTwW0g</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n\n    // Want to match \"test-20160101\", \"/20160101/\" and \"test-20160101\"\n\n    re := regexp.MustCompile(`[-a-zA-Z/](20[012]\\d[01]\\d[0123]\\d)([-a-zA-Z/]|\\z)`)\n    urls := []string{\n        \"test-20160101\",\n        \"/20160101/page.html\",\n        \"test20160101\",\n        \"nomatch\",\n        \"test19990101\",\n    }\n\n    for _, url := range urls {\n        t := re.FindStringSubmatch(url)\n        if len(t) &gt; 2 {\n            fmt.Println(\"match\", url, \"=\", t[1])\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3498, "favorite_count": 1, "accepted_answer_id": 39112301, "answer_count": 2, "score": 0, "last_activity_date": 1471998737, "creation_date": 1471994090, "last_edit_date": 1471998544, "question_id": 39112099, "link": "https://stackoverflow.com/questions/39112099/how-do-you-match-character-or-end-of-string-in-a-golang-regexp", "title": "How do you match character OR end of string in a golang regexp?", "body": "<p>I am having trouble working out (in golang), within a regular expression, how to match a character, separator, or end of string.  The following does almost what I want:</p>\n\n<pre><code>url := \"test20160101\"\nif i, _ := regexp.MatchString(\"[-a-zA-Z/]20[012]\\\\d[01]\\\\d[0123]\\\\d[-a-zA-Z/]\", url); i == true {\n    t := regexp.MustCompile(\"[-a-zA-Z/](20[012]\\\\d[01]\\\\d[0123]\\\\d)[-a-zA-Z/]\").FindStringSubmatch(url)[1]\n    fmt.Println(\"match: \", t)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/eWZ_DiOVBl\" rel=\"nofollow\">https://play.golang.org/p/eWZ_DiOVBl</a></p>\n\n<p>But I want to also match the following:</p>\n\n<pre><code>url := \"test-20160101-\"\nurl := \"/20160101/page.html\"\n</code></pre>\n\n<p>I notice there is a \\z in <a href=\"https://golang.org/pkg/regexp/syntax/\" rel=\"nofollow\">the golang documentation</a> however that doesn't work, at least when I put it inside <code>[-a-zA-Z/]</code> i.e. <code>[-a-zA-Z\\\\z/]</code></p>\n"}, {"tags": ["go", "character-encoding"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1471995928, "post_id": 39111624, "comment_id": 65571832, "body": "Didn&#39;t you answer your own question? Go assumes UTF8 by default, and you&#39;re inputting CP850"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1471996330, "post_id": 39111624, "comment_id": 65571916, "body": "Go assumes UTF-8 for strings in its source-code but if run from the terminal (cmd.exe) shouldn&#39;t it read stdin correctly and convert from the terminals codepage to UTF-8? Even if Go expects UTF-8 from the console, this doesn&#39;t explain why I get a completely unrelated UTF-8 character and not just the error-rune. Even if I read bytes directly from stdin I receive these three bytes, which the console <b>definitely</b> doesn&#39;t send as my C function correctly receives the CP850 value for the <code>&#228;</code>."}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472001175, "post_id": 39111624, "comment_id": 65573078, "body": "<a href=\"https://github.com/golang/go/issues/16857\" rel=\"nofollow noreferrer\">I created an Issue</a> as Golang interprets the input as codepage 1252 instead of 850 even though the console uses 850."}], "answers": [{"tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": true, "score": 2, "last_activity_date": 1472086154, "last_edit_date": 1472086154, "creation_date": 1472085748, "answer_id": 39135015, "question_id": 39111624, "link": "https://stackoverflow.com/questions/39111624/golang-stdin-reads-german-umlauts-wrong/39135015#39135015", "title": "Golang stdin reads german umlauts wrong", "body": "<p>So it was a bug in Golang for some systems, to be specific for Windows systems where the overall used charset and the console charset were different (Where <code>GetACP()</code> and <code>GetConsoleCP()</code> from WinAPI returned different things). In Germany, for example, (and maybe other west-european countries), Windows uses the codepage 1252 as the overall-charset but it uses codepage 850 for the console <code>cmd.exe</code>. Not sure why, but thats how it is. Golang wrongly used <code>GetACP()</code> to decode the input to UTF-8 when it really should've used the codepage returned by <code>GetConsoleCP()</code>. We found the problem in the <a href=\"https://github.com/golang/go/issues/16857\" rel=\"nofollow\">Issue</a> I created and we'll hopefully see the fix merged for the next version of Golang.</p>\n\n<p>We also found a problem on Windows where Golang decoded characters to <em>decomposed UTF-8</em> characters (i.e. it would read a <code>\u00e4</code> to the character <code>a</code> followed by the COMBINING DIAERESIS <code>\u0308</code>) which could lead to other problems, for example printing those decomposed characters prints them separate instead of one combined character.</p>\n"}], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 732, "favorite_count": 0, "accepted_answer_id": 39135015, "answer_count": 1, "score": 0, "last_activity_date": 1472086154, "creation_date": 1471991053, "last_edit_date": 1471991475, "question_id": 39111624, "link": "https://stackoverflow.com/questions/39111624/golang-stdin-reads-german-umlauts-wrong", "title": "Golang stdin reads german umlauts wrong", "body": "<p>I'm from germany so I use umlauts like <code>\u00e4</code>, <code>\u00f6</code> and <code>\u00fc</code>. Golang however doesn't read them correctly from stdin.</p>\n\n<p>When I execute this simple program:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    for {\n        b, _, _ := bufio.NewReader(os.Stdin).ReadLine()\n        printBytes(b)\n    }\n\n}\n\nfunc printBytes(bytes []byte) {\n    for _, b := range bytes {\n        fmt.Printf(\"0x%X \", b)\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p>I get the output:</p>\n\n<pre><code>C:\\dev\\golang&gt;go run test.go\n\u00e4\n0xE2 0x80 0x9E\n</code></pre>\n\n<p><code>E2 80 9E</code> isn't the correct byte sequence for the <code>\u00e4</code> in UTF-8 (<a href=\"http://www.ltg.ed.ac.uk/~richard/utf-8.cgi?input=E2+80+9E&amp;mode=bytes\" rel=\"nofollow\">this tool</a> tells me it's an \"DOUBLE LOW-9 QUOTATION MARK\" -> <code>\u201e</code>) and when I just print out what I've read it prints <code>\"</code>. I've written a small \"hack\" which seems to read the characters correct:</p>\n\n<pre><code>package main\n\n/*\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nchar * getline(void) {\n    char * line = malloc(100), * linep = line;\n    size_t lenmax = 100, len = lenmax;\n    int c;\n\n    if(line == NULL)\n        return NULL;\n\n    for(;;) {\n        c = fgetc(stdin);\n        if(c == EOF)\n            break;\n\n        if(--len == 0) {\n            len = lenmax;\n            char * linen = realloc(linep, lenmax *= 2);\n\n            if(linen == NULL) {\n                free(linep);\n                return NULL;\n            }\n            line = linen + (line - linep);\n            linep = linen;\n        }\n\n        if((*line++ = c) == '\\n')\n            break;\n    }\n    *line = '\\0';\n    return linep;\n}\n\nvoid freeline(char* ptr) {\n    free(ptr);\n}\n*/\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"golang.org/x/text/encoding/charmap\"\n)\n\nfunc getLineFromCp850() string {\n    line := C.getline()\n    goline := C.GoString(line)\n    C.freeline(line)\n    b := []byte(goline)\n    ub, _ := charmap.CodePage850.NewDecoder().Bytes(b)\n    return string(ub)\n}\n\nfunc main() {\n    for {\n        line := getLineFromCp850()\n        printBytes([]byte(line))\n    }\n\n}\n\nfunc printBytes(bytes []byte) {\n    for _, b := range bytes {\n        fmt.Printf(\"0x%X \", b)\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p>And it prints out:</p>\n\n<pre><code>C:\\dev\\golang&gt;go run test.go\n\u00e4\n0xC3 0xA4 0xA\n</code></pre>\n\n<p><code>C3 A4</code> is the correct bytesequence for the <code>\u00e4</code> (0A is the linefeed which my hack doesn't strip) so it seems like, reading and converting from CP850 to UTF-8 does the job, as I expected, but why does Go give me gibberish when I read the line using Go's functionality instead of cgo? Whats wrong with Go that it gives me those values, doesn't it interpret the input bytes as CP850 but another charset? Is there a better Go-only way to handle this problem?</p>\n\n<p>This problem only arises when <strong>reading</strong> from stdin. When I print out a UTF-8 <code>\u00e4</code> to stdout it prints correctly in the console.</p>\n"}, {"tags": ["go", "stdin", "longtext"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1472012557, "post_id": 39111541, "comment_id": 65575565, "body": "what is you input text byte size? and are you enter all text at once or in a long time? and  on hackerrank provide link to that question. See: <a href=\"http://stackoverflow.com/questions/31333353/faster-input-scanning\" title=\"faster input scanning\">stackoverflow.com/questions/31333353/faster-input-scanning</a>"}], "answers": [{"tags": [], "owner": {"reputation": 120, "user_id": 6155997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1719fd7c6ca6ca560a672210a1329010?s=128&d=identicon&r=PG&f=1", "display_name": "vendelin", "link": "https://stackoverflow.com/users/6155997/vendelin"}, "is_accepted": true, "score": 1, "last_activity_date": 1474365176, "creation_date": 1474365176, "answer_id": 39590987, "question_id": 39111541, "link": "https://stackoverflow.com/questions/39111541/golang-reading-long-text-from-stdin/39590987#39590987", "title": "golang reading long text from stdin", "body": "<p>I was able to solve this thanks to Ian Lance Taylor:\n<a href=\"https://groups.google.com/forum/#!topic/golang-nuts/ndh-1wdsWYs\" rel=\"nofollow\">https://groups.google.com/forum/#!topic/golang-nuts/ndh-1wdsWYs</a></p>\n\n<p>So the 4096 characters is the limit of my system through N_TTY_BUF_SIZE kernel parameter. The same thing worked with cat and Python as well.</p>\n\n<p>Anyway, on hackerrank.com I was able to solve the same exercise in Python, so I guess they have a wrong configuration for Go, I already asked them to find it out.</p>\n"}], "owner": {"reputation": 120, "user_id": 6155997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1719fd7c6ca6ca560a672210a1329010?s=128&d=identicon&r=PG&f=1", "display_name": "vendelin", "link": "https://stackoverflow.com/users/6155997/vendelin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 538, "favorite_count": 0, "accepted_answer_id": 39590987, "answer_count": 1, "score": 4, "last_activity_date": 1474365176, "creation_date": 1471990643, "last_edit_date": 1495541963, "question_id": 39111541, "link": "https://stackoverflow.com/questions/39111541/golang-reading-long-text-from-stdin", "title": "golang reading long text from stdin", "body": "<p>I want to read a long text from os.Stdin, but I can't make it happen. Already read everything in the subject, tried codes that supposed to work. Every method cuts after 4096 characters, no matter what.</p>\n\n<p>Eg. <a href=\"https://stackoverflow.com/questions/27196195/golang-read-from-pipe-reads-tons-of-data\">here</a>'s a working example. After the first run of the loop, it reads the first 4096 characters, and then waits for more processing each enter, until I end it with an EOF (Ctrl+D). Same thing for fmt.Scan, bufio.NewScanner, bufio ReadLine, ioutil.ReadAll. If I save it to a file, and read it, it works as expected. From stdin it doesn't.</p>\n\n<p>I'm on Arch Linux, 32 bit, Go 1.7, tested in mate-terminal 1.14, tty 8.25, same thing in both of them. And the same thing happens on the hackerrank.com page, I don't know what technology they're using.</p>\n\n<p>Please help!</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>My input is just a little bit longer than 4096 characters. I checked out the link that <a href=\"https://stackoverflow.com/users/6169399/amd\">Amd</a> shared, and I got the following: my input is only one line containing space separated integers. When I changed the spaces to newlines, it worked. But since the excercise format on hackerrate uses long space-separated lines, the problem is still up, with a refinement.</p>\n"}, {"tags": ["go", "error-handling"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 7, "creation_date": 1471980143, "post_id": 39109003, "comment_id": 65565645, "body": "Well, typically this won&#39;t fail. There is nothing Employee itself which could go wrong. But one never knows, especially as structs tend to grow but no one will check the marshaling. Add a field <code>Boss *Employee</code>, combine with a bug where e.Boss == e and kaboom: Marshaling fails and you won&#39;t see the error. <b>Never</b> ignore any error."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1471992239, "post_id": 39109003, "comment_id": 65570897, "body": "I&#39;m with @Volker on this: instead of ignoring this error merely <code>panic</code> on it. It&#39;s only a single check for <code>nil</code> slower but won&#39;t subject you to a possibility of a hard-to-find bug. If you feel like this, create a helper function <code>MustMarshal()</code>."}, {"owner": {"reputation": 9369, "user_id": 71079, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3e302415f77b6c398abc0b16efc653f3?s=128&d=identicon&r=PG", "display_name": "Ralph Caraveo", "link": "https://stackoverflow.com/users/71079/ralph-caraveo"}, "edited": false, "score": 1, "creation_date": 1471992574, "post_id": 39109003, "comment_id": 65570986, "body": "Yes, I generally do always check for errors...but this question was more about understanding the possibility of an error occurring from a well-defined type.  I agree, that as code grows and gets more complicated relying on this fact could come back to bite me if I ignore it as a practice."}], "answers": [{"tags": [], "owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "is_accepted": false, "score": 0, "last_activity_date": 1471981749, "creation_date": 1471981749, "answer_id": 39109551, "question_id": 39109003, "link": "https://stackoverflow.com/questions/39109003/in-go-can-json-marshaling-of-a-well-defined-type-ever-fail/39109551#39109551", "title": "In Go, can JSON marshaling of a well-defined type ever fail?", "body": "<p>You can always write your own \"wrapper\" packages to compose behavior that might otherwise be boilerplate. For example, if you have a logging system set up, you might build a small package that looks like:</p>\n\n<pre><code>package json\nimport (\n  \"encoding/json\"\n  \"log\"\n)\nfunc TryMarshal(v interface{}) []byte {\n  b, err := json.Marshal(v)\n  if err != nil {\n    log.Println(err)\n    return nil\n  }\n  return b\n}\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 7, "last_activity_date": 1473769373, "last_edit_date": 1473769373, "creation_date": 1471982743, "answer_id": 39109820, "question_id": 39109003, "link": "https://stackoverflow.com/questions/39109003/in-go-can-json-marshaling-of-a-well-defined-type-ever-fail/39109820#39109820", "title": "In Go, can JSON marshaling of a well-defined type ever fail?", "body": "<p><a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"nofollow\">Error handling and Go</a>:</p>\n\n<blockquote>\n  <p>Proper error handling is an essential requirement of good software.</p>\n</blockquote>\n\n<hr>\n\n<p>Normally your code won't fail. but if user Adds this <code>MarshalJSON</code> method reciver to your type, it fails:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (t *Employee) MarshalJSON() ([]byte, error) {\n    if t.Id == 2 {\n        return nil, fmt.Errorf(\"Forbiden Id = %d\", t.Id)\n    }\n    data := []byte(fmt.Sprintf(`{\"Id\":%d}`, t.Id))\n    return data, nil\n}\n</code></pre>\n\n<hr>\n\n<p>This code Compiles, but fails on purpose just for <code>Id == 2</code> (<a href=\"https://play.golang.org/p/cR42CzrbH5\" rel=\"nofollow\">The Go Playground</a>):  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\ntype Employee struct {\n    Id int \"json:id\"\n}\n\nfunc main() {\n    b, err := json.Marshal(&amp;Employee{Id: 2})\n    if err != nil {\n        log.Fatal(\"Couldn't marshal the Employee\", err)\n    }\n\n    fmt.Println(string(b))\n}\n\nfunc (t *Employee) MarshalJSON() ([]byte, error) {\n    if t.Id == 2 {\n        return nil, fmt.Errorf(\"Forbiden Id = %d\", t.Id)\n    }\n    data := []byte(fmt.Sprintf(`{\"Id\":%d}`, t.Id))\n    return data, nil\n}\n</code></pre>\n\n<hr>\n\n<p>Also this code Compiles, but fails (<a href=\"https://play.golang.org/p/Lm6w1gIsnG\" rel=\"nofollow\">The Go Playground</a>):  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\ntype Employee struct {\n    Id int \"json:id\"\n}\n\nfunc main() {\n    b, err := json.Marshal(&amp;Employee{Id: 2})\n    if err != nil {\n        log.Fatal(\"Couldn't marshal the Employee\")\n    }\n\n    fmt.Println(string(b))\n}\n\nfunc (t Employee) MarshalJSON() ([]byte, error) {\n    data := []byte(fmt.Sprint(t))\n    return data, nil\n}\n</code></pre>\n\n<hr>\n"}], "owner": {"reputation": 9369, "user_id": 71079, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3e302415f77b6c398abc0b16efc653f3?s=128&d=identicon&r=PG", "display_name": "Ralph Caraveo", "link": "https://stackoverflow.com/users/71079/ralph-caraveo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 39109820, "answer_count": 2, "score": 12, "last_activity_date": 1473769373, "creation_date": 1471979510, "last_edit_date": 1471984495, "question_id": 39109003, "link": "https://stackoverflow.com/questions/39109003/in-go-can-json-marshaling-of-a-well-defined-type-ever-fail", "title": "In Go, can JSON marshaling of a well-defined type ever fail?", "body": "<p>Given the following code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\ntype Employee struct {\n    Id int \"json:id\"\n}\n\nfunc main() {\n    b, err := json.Marshal(&amp;Employee{Id: 2})\n    if err != nil {\n        log.Fatal(\"Couldn't marshal the Employee\")\n    }\n\n    fmt.Println(string(b))\n}\n</code></pre>\n\n<p>Can checking for the error be reliably ignored using the <code>_</code> placeholder since the <code>Employee</code> struct is well defined.  Theoretically it should never fail, so begs the question is it a good practice to ignore this type of error and save a little on this type of boilerplate error checking?</p>\n\n<p>Ignoring would look like so:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Employee struct {\n    Id int \"json:id\"\n}\n\nfunc main() {\n    b, _ := json.Marshal(&amp;Employee{Id: 2})\n    fmt.Println(string(b))\n}\n</code></pre>\n"}, {"tags": ["go", "dry"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 1, "creation_date": 1471977367, "post_id": 39108400, "comment_id": 65564184, "body": "You can try to find commonality for the <code>Account</code> and <code>Team</code> types through an interface."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1471978056, "post_id": 39108400, "comment_id": 65564556, "body": "Most lines aren&#39;t identical, as they operate on and return different types. If it makes sense to have different types for Team and Account, and no common interface between them, then there&#39;s nothing to combine."}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 1, "creation_date": 1471980112, "post_id": 39108400, "comment_id": 65565637, "body": "agreed, this is not repeating yourself. go is just verbose. if you want fewer characters in your source code use ruby"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1471980216, "post_id": 39108400, "comment_id": 65565691, "body": "There is no need to DRY things which aren&#39;t wet."}, {"owner": {"reputation": 894, "user_id": 6078917, "user_type": "registered", "accept_rate": 22, "profile_image": "https://i.stack.imgur.com/HRZj4.jpg?s=128&g=1", "display_name": "ryan", "link": "https://stackoverflow.com/users/6078917/ryan"}, "edited": false, "score": 1, "creation_date": 1471983193, "post_id": 39108400, "comment_id": 65567163, "body": "Cool thanks.  Coming from a Scala background, seems it&#39;s totally different in Go."}], "owner": {"reputation": 894, "user_id": 6078917, "user_type": "registered", "accept_rate": 22, "profile_image": "https://i.stack.imgur.com/HRZj4.jpg?s=128&g=1", "display_name": "ryan", "link": "https://stackoverflow.com/users/6078917/ryan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1471977202, "creation_date": 1471977202, "question_id": 39108400, "link": "https://stackoverflow.com/questions/39108400/how-to-follow-dry-principle-in-go-in-function", "title": "How to follow DRY principle in Go in function?", "body": "<p>I have this function to find the first Account that satisfies a predicate.</p>\n\n<pre><code>func findAccount(accounts []Account, f func(Account) bool) (*Account, error) {\n    for _, account := range accounts {\n        if f(account) {\n            return &amp;account, nil\n        }\n    }\n    return nil, ErrNoSuchAccount\n}\n</code></pre>\n\n<p>and another function to find the first Team that satisfies a predicate.</p>\n\n<pre><code>func findTeam(teams []Team, f func(Team) bool) (*Team, error) {\n    for _, team := range teams {\n        if f(team) {\n            return &amp;team, nil\n        }\n    }\n    return nil, ErrNoSuchTeam\n}\n</code></pre>\n\n<p>To DRY, I wonder if they can be combined as most lines of the routines are identical.</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 0, "creation_date": 1471976013, "post_id": 39108004, "comment_id": 65563425, "body": "&quot;How I should overcome this issue?&quot; You can&#39;t, since Go doesn&#39;t support method overloading. See <a href=\"https://golang.org/doc/faq#overloading\" rel=\"nofollow noreferrer\">golang.org/doc/faq#overloading</a>. I don&#39;t understand your second question well enough to try to answer. Maybe providing a code example would help."}, {"owner": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "reply_to_user": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 0, "creation_date": 1471976352, "post_id": 39108004, "comment_id": 65563608, "body": "thanks @smarx - I edited the question with more details for the second part"}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 0, "creation_date": 1471976792, "post_id": 39108004, "comment_id": 65563870, "body": "I don&#39;t think there&#39;s anything you can do about your second issue either."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1471980503, "post_id": 39108004, "comment_id": 65565832, "body": "For your second &quot;problem&quot;: Were <i>is</i> the problem?  If method Foo returns a Barer it returns a Barer and not a b_impl."}, {"owner": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1471983129, "post_id": 39108004, "comment_id": 65567132, "body": "@Volker Classic programming languages recognize two approaches for specifying protocols between software modules (interfaces vs generics). The interfaces are usually declared from the lower level and are enforced on the upper layers. Generics defined explicitly or implicitly expectations and everything that matches these expectations is good. The golang interfaces act more as generics than typical interfaces. These though is true only when my interface depends on standard (lower level) types where my consumer also depends on. As soon as I need to declare my own type this is no longer true."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1471985925, "post_id": 39108004, "comment_id": 65568543, "body": "@gsf, I&#39;ve read your last comment over and over, and I can&#39;t make out what you&#39;re trying to say. Interfaces are a type that only define a method set, but they are still just a type. If you declare <code>B</code> in one package, and reference <code>B</code> in another, then of course you need to import B&#39;s package. Why is this a problem? The <code>io</code> package is frequently imported only to make use of <code>io.Reader</code> and <code>io.Writer</code>."}, {"owner": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1471998196, "post_id": 39108004, "comment_id": 65572365, "body": "@JimB If I have a protocol that is complex enough to require more than one interface to be specified the whole go paradigm of &quot;late binding&quot; is impossible to use - forcing explicit dependency to my library. Workarounds of this are obviously possible, but ... how is this not a problem?"}], "answers": [{"comments": [{"owner": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "edited": false, "score": 0, "creation_date": 1471978946, "post_id": 39108479, "comment_id": 65565019, "body": "nope, not theoretical at all. These are two issues that I actually have.  I &quot;need&quot; to change is good suggestion, but since I am not the owner of all I depend on - &quot;I&quot; cannot change it.  For the second question the io.Writer example has nothing to do with my case. Almost every interface that is not obviously trivial as io.Writer requires several interfaces. Since I am not writing standard libraries where dependencies are obtained implicitly - the issue is very real."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "reply_to_user": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "edited": false, "score": 0, "creation_date": 1471984196, "post_id": 39108479, "comment_id": 65567703, "body": "Sorry if that sound a little bit to hard. This should be not the intention, English is not my first language. But when you have existing code it would help to know a little bit more about the existing structure and what parts you need to implement. And I know that your problem is not the io.Writer that was just an example. After reading all the additional comments I understand your problem. If your external package a uses the external Interface b.B there is no other way to solve this then importing package b."}, {"owner": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "edited": false, "score": 0, "creation_date": 1471998496, "post_id": 39108479, "comment_id": 65572451, "body": "I have a protocol that includes several interfaces - exactly as explained. A returns B. they both belong to the same package. Now because of that, it is impossible for me to create an implementation of these interfaces without a direct dependency on this package. This will be possible if I do not have that - that&#39;s the problem."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "reply_to_user": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "edited": false, "score": 1, "creation_date": 1472025523, "post_id": 39108479, "comment_id": 65581346, "body": "@gsf: I understand what you mean, but then it is not really a Go thing. If the package you have to use is not idiomatic Go code or really bad Go code, maybe it is not a good idea to use it or to search for alternative solutions. I know that this is not allways possible in that case maybe a kind of adapter could work. On this way you can write good Go code in your package and the bad code inside your adapter package. Your adapter would depend on package a and b but inside there you should define interfaces which you can implement inside your code."}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 2, "last_activity_date": 1471984913, "last_edit_date": 1471984913, "creation_date": 1471977511, "answer_id": 39108479, "question_id": 39108004, "link": "https://stackoverflow.com/questions/39108004/golang-interface-that-depends-on-interface/39108479#39108479", "title": "golang interface that depends on interface", "body": "<p>1st question:\nIn go you need to make different function names, when you want to do different tasks. Let's look into the standard library at the strconv package how things are solved there: <a href=\"https://golang.org/pkg/strconv/#pkg-index\" rel=\"nofollow\">https://golang.org/pkg/strconv/#pkg-index</a></p>\n\n<p>Look to the different declaration of the append function there. There are functions for every different type. </p>\n\n<p>So if you expect a FooInt funtion your interface should be also a FooInter, ...</p>\n\n<p>2nd question:As a small example. You don't need to import the whole io package, when you want to use the io.Writer interface. It is totaly ok to copy the Writer declaration into your own package. If you do that correct, every io.Writer implementation will automatically implement your own Writer interface.</p>\n\n<p>After reading the other comments maybe you have a different situation:</p>\n\n<p>Let's say there is a package a and b with the interface a.A and b.B. If there is the situation that:</p>\n\n<pre><code>type A interface{\n  Foo() b.B\n}\n</code></pre>\n\n<p>and you have to write an implementation for a.A, then you need to import package b. But that makes your binaries not bigger, because you will always need to import package a, which depends on b.</p>\n"}, {"tags": [], "owner": {"reputation": 2812, "user_id": 3738542, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002024985258/picture?type=large", "display_name": "oren", "link": "https://stackoverflow.com/users/3738542/oren"}, "is_accepted": false, "score": 0, "last_activity_date": 1592581345, "creation_date": 1592581345, "answer_id": 62473820, "question_id": 39108004, "link": "https://stackoverflow.com/questions/39108004/golang-interface-that-depends-on-interface/62473820#62473820", "title": "golang interface that depends on interface", "body": "<p>For implementing an interface, you need to have exactly the same method name and <strong>signature</strong>. Means the signature must be with the same <strong>types</strong>.</p>\n\n<p>As much as it seems weird, these two don't have the same signature:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>Foo() B\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>Foo() b_impl {}\n</code></pre>\n\n<p>It doesn't matter that <code>b_impl</code> implements <code>B</code>.</p>\n\n<p>To overcome the need to import the package <code>B</code> is declared in, you can use anonymous type. This way the compiler won't require a specific type for the method signature.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type A interface {\n    Foo() interface{Bar()}\n}\n</code></pre>\n\n<p>Which also can be written as embedding <code>B</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type A interface {\n    Foo() interface{B}\n}\n</code></pre>\n\n<p>Still, <code>a_impl</code> must have same signature, so it also needs to return an anonymous interface. You can also declare the same <code>B</code> interface in the package of <code>a_impl</code>, and embed it in an anonymous interface. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package impl\n\ntype B interface {\n    Bar()\n}\n\ntype b_impl struct{}\n\nfunc (b b_impl) Bar() {}\n\ntype a_impl struct{}\n\nfunc (a a_impl) Foo() interface{B} {\n    return b_impl{}\n}\n</code></pre>\n\n<p>I don't know if it's a bad practice or not, probably there are cases which redesign is required instead of doing this.</p>\n"}], "owner": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 815, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1592581345, "creation_date": 1471975696, "last_edit_date": 1471976312, "question_id": 39108004, "link": "https://stackoverflow.com/questions/39108004/golang-interface-that-depends-on-interface", "title": "golang interface that depends on interface", "body": "<p>I am not sure if these should be two separate questions or one, but it seems to me as one question of two parts - How go interfaces are supposed to be used? I have this two struggles:</p>\n\n<p>The methods of the interfaces are globally scoped: If I have interface A and interface B that both implement the same method Foo, but with different arguments or return types I am unable to implement both at the same time from the same type. For example, I have GetBytes() method in one interface having return type []byte and in another ([]byte, error) How I should overcome this issue?</p>\n\n<p>Another issue I have is when I try to define interface say interface A that has a method that returns interface B that is defined in the same layer. Now if I want to create an object that implements A, if I return struct that implements B go is not smart enough to deduce that this method implements the method in A and it forces me to create dependency on B. This seems to completely defeat the point of the way interfaces work in go at first place. How can I avoid this issue?</p>\n\n<p>for example, if I have:</p>\n\n<pre><code>type B interface {\n    Bar()\n}\n\ntype A interface {\n    Foo() B\n}\n</code></pre>\n\n<p>for the following structs :</p>\n\n<pre><code>type b_impl struct{}\n\nfunc (b b_impl) Bar() {}\n\ntype a_impl struct{}\n</code></pre>\n\n<p>A foo method</p>\n\n<pre><code>func (a a_impl) Foo() b_impl {}\n</code></pre>\n\n<p>does not satisfy the interface A and I need to make it:</p>\n\n<pre><code>func (a a_impl) Foo() B {}\n</code></pre>\n\n<p>which makes a dependency to the package where B is declared.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 3, "creation_date": 1471973760, "post_id": 39107173, "comment_id": 65562157, "body": "One use for single-case selects is idempotent channel closes: <a href=\"https://play.golang.org/p/_Ol42BvuuS\" rel=\"nofollow noreferrer\">play.golang.org/p/_Ol42BvuuS</a>"}], "tags": [], "owner": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "is_accepted": false, "score": 4, "last_activity_date": 1471982046, "last_edit_date": 1471982046, "creation_date": 1471972498, "answer_id": 39107173, "question_id": 39107003, "link": "https://stackoverflow.com/questions/39107003/select-with-single-case-blocks-adding-default-unblocks/39107173#39107173", "title": "select with single case blocks, adding default: unblocks", "body": "<p>In your case, it seems that a simple loop would suffice:</p>\n\n<pre><code>for _ = range ch {\n    fmt.Println(\"drain\")\n}\n</code></pre>\n\n<p>Select is required, if you have <em>multiple</em> goroutines to handle. The tour has an example of <a href=\"https://tour.golang.org/concurrency/4\" rel=\"nofollow\">range and close</a>.</p>\n\n<p>Another case for <code>select</code> would be idempotent channel closes: <a href=\"https://play.golang.org/p/_Ol42BvuuS\" rel=\"nofollow\">https://play.golang.org/p/_Ol42BvuuS</a>.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 13, "last_activity_date": 1473769461, "last_edit_date": 1592644375, "creation_date": 1471973953, "answer_id": 39107570, "question_id": 39107003, "link": "https://stackoverflow.com/questions/39107003/select-with-single-case-blocks-adding-default-unblocks/39107570#39107570", "title": "select with single case blocks, adding default: unblocks", "body": "<p>1- When you are dealing with one channel, it is OK to use <code>for</code>,<br />\nconsider this working code ( <a href=\"https://play.golang.org/p/Wf96VH3uDG\" rel=\"noreferrer\">The Go Playground</a> ):</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport &quot;fmt&quot;\n\nfunc main() {\n    ch := make(chan int, 2)\n    ch &lt;- 1\n    ch &lt;- 2\n    close(ch)\n    for range ch {\n    }\n    fmt.Println(&quot;Done.&quot;)\n}\n</code></pre>\n<p>This will empty the channel.<br />\nNote: you should <code>close</code> the channel or you should use <code>break</code> statement to finish that loop.</p>\n<hr />\n<p>2- When you are dealing with more channels you may use <code>select</code>, like this ( <a href=\"https://play.golang.org/p/BEpi-ZyWQF\" rel=\"noreferrer\">The Go Playground</a> ):</p>\n<pre class=\"lang-golang prettyprint-override\"><code>for {\n    select {\n    case &lt;-pause:\n        fmt.Println(&quot;pause&quot;)\n        select {\n        case &lt;-play:\n            fmt.Println(&quot;play&quot;)\n        case &lt;-quit:\n            wg.Done()\n            return\n        }\n    case &lt;-quit:\n        wg.Done()\n        return\n    default:\n        work()\n    }\n}\n</code></pre>\n<hr />\n<p>3- Using nil  and closed channel ( <a href=\"https://play.golang.org/p/PStmX-aXVm\" rel=\"noreferrer\">The Go Playground</a> ):</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport &quot;fmt&quot;\n\nfunc main() {\n    var quit chan struct{} // nil\n\n    select {\n    case &lt;-quit:\n        fmt.Println(&quot;1&quot;)\n    default:\n        fmt.Println(&quot;2&quot;) // This runs\n    }\n\n    quit = make(chan struct{}, 1)\n\n    select {\n    case &lt;-quit:\n        fmt.Println(&quot;10&quot;)\n    default:\n        fmt.Println(&quot;20&quot;) // This runs\n    }\n\n    quit &lt;- struct{}{} // send\n\n    select {\n    case &lt;-quit:\n        fmt.Println(&quot;100&quot;) // This runs\n    default:\n        fmt.Println(&quot;200&quot;)\n    }\n\n    close(quit)\n\n    select {\n    case &lt;-quit:\n        fmt.Println(&quot;1000&quot;) // This runs\n    default:\n        fmt.Println(&quot;2000&quot;)\n    }\n\n    select {\n    case &lt;-quit:\n        fmt.Println(&quot;10000&quot;) // This runs\n    default:\n        fmt.Println(&quot;20000&quot;)\n    }\n}\n</code></pre>\n<p>output:</p>\n<pre><code>2\n20\n100\n1000\n10000\n</code></pre>\n<hr />\n<p><a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"noreferrer\">Select statements</a></p>\n<blockquote>\n<p>A &quot;select&quot; statement chooses which of a set of possible send or\nreceive operations will proceed. It looks similar to a &quot;switch&quot;\nstatement but with the cases all referring to communication\noperations.</p>\n<p>A case with a RecvStmt may assign the result of a RecvExpr to one or\ntwo variables, which may be declared using a short variable\ndeclaration. The RecvExpr must be a (possibly parenthesized) receive\noperation. There can be at most one default case and it may appear\nanywhere in the list of cases.</p>\n</blockquote>\n<p>Execution of a &quot;select&quot; statement proceeds in several steps:</p>\n<blockquote>\n<p>For all the cases in the statement, the channel operands of receive\noperations and the channel and right-hand-side expressions of send\nstatements are evaluated exactly once, in source order, upon entering\nthe &quot;select&quot; statement. The result is a set of channels to receive\nfrom or send to, and the corresponding values to send. Any side\neffects in that evaluation will occur irrespective of which (if any)\ncommunication operation is selected to proceed. Expressions on the\nleft-hand side of a RecvStmt with a short variable declaration or\nassignment are not yet evaluated. If one or more of the communications\ncan proceed, a single one that can proceed is chosen via a uniform\npseudo-random selection. Otherwise, if there is a default case, that\ncase is chosen. If there is no default case, the &quot;select&quot; statement\nblocks until at least one of the communications can proceed. Unless\nthe selected case is the default case, the respective communication\noperation is executed. If the selected case is a RecvStmt with a short\nvariable declaration or an assignment, the left-hand side expressions\nare evaluated and the received value (or values) are assigned. The\nstatement list of the selected case is executed. Since communication\non nil channels can never proceed, a select with only nil channels and\nno default case blocks forever.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 1135, "user_id": 1860768, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eHx0y.jpg?s=128&g=1", "display_name": "Ann Kilzer", "link": "https://stackoverflow.com/users/1860768/ann-kilzer"}, "edited": false, "score": 0, "creation_date": 1579835040, "post_id": 59675091, "comment_id": 105908112, "body": "What if I want to check that the channel is closed? e.g., is it possible to do <code>value, ok := &lt;-ch</code> inside a for-range statement?"}, {"owner": {"reputation": 1135, "user_id": 1860768, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eHx0y.jpg?s=128&g=1", "display_name": "Ann Kilzer", "link": "https://stackoverflow.com/users/1860768/ann-kilzer"}, "edited": false, "score": 1, "creation_date": 1579835679, "post_id": 59675091, "comment_id": 105908239, "body": "Actually I found this to be really helpful, appears that the close will break the loop: <a href=\"https://gobyexample.com/range-over-channels\" rel=\"nofollow noreferrer\">gobyexample.com/range-over-channels</a>"}], "tags": [], "owner": {"reputation": 3281, "user_id": 4131775, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KDmA5SDbD84/AAAAAAAAAAI/AAAAAAAAAAA/WQxPLtYrNu4/photo.jpg?sz=128", "display_name": "Feiyu Zhou", "link": "https://stackoverflow.com/users/4131775/feiyu-zhou"}, "is_accepted": false, "score": 0, "last_activity_date": 1578626300, "creation_date": 1578626300, "answer_id": 59675091, "question_id": 39107003, "link": "https://stackoverflow.com/questions/39107003/select-with-single-case-blocks-adding-default-unblocks/59675091#59675091", "title": "select with single case blocks, adding default: unblocks", "body": "<p>If there's only one case in select then it's better to <code>use for range instead of for { select {} } (gosimple)</code> which is a <code>S1000</code> golint check.</p>\n\n<p><code>for range</code> code is like:</p>\n\n<pre><code>for range ch {\n    fmt.Println(\"here\")\n}\n\n</code></pre>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7733, "favorite_count": 5, "accepted_answer_id": 39107570, "answer_count": 3, "score": 11, "last_activity_date": 1578626300, "creation_date": 1471971906, "last_edit_date": 1471974782, "question_id": 39107003, "link": "https://stackoverflow.com/questions/39107003/select-with-single-case-blocks-adding-default-unblocks", "title": "select with single case blocks, adding default: unblocks", "body": "<p>While testing some code with something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// ch := make(chan error)\n\nfor {\n    select {\n      case &lt;- ch:\n           println(\"here\")\n    }\n}\n</code></pre>\n\n<p>I notice that if I don't add a <code>default</code> the code blocks:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>for {\n    select {\n       case &lt;- ch:\n            println(\"here\")\n       default:\n    }\n}\n</code></pre>\n\n<p>In case that the block is required, could't be better then just use <code>range</code>, something like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>for {\n    for _ = range &lt;- ch {\n        println(\"here\")\n    }\n}\n</code></pre>\n\n<p>Or is there any difference/advantage of using <code>select</code> over <code>range</code> for this case ?</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1471970173, "post_id": 39105654, "comment_id": 65560054, "body": "Is the path to go_appengine/appcfg.py in your GOPATH ? If you can run appcfg.py using its whole path w/o errors then it&#39;s probably not in GOPATH or GOROOT."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1471971707, "post_id": 39105654, "comment_id": 65561033, "body": "No, it&#39;s not. Should it be? Adding it doesn&#39;t seem to make a difference."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1471971741, "post_id": 39105654, "comment_id": 65561055, "body": "Also, I just spun up a Compute Engine instance and have the same exact problem there... even on a fresh install."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1471972614, "post_id": 39105654, "comment_id": 65561540, "body": "Added console output above."}, {"owner": {"reputation": 7229, "user_id": 178236, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9b46e503bdfc5dfe07ec0f5a7c542184?s=128&d=identicon&r=PG", "display_name": "Justin Beckwith", "link": "https://stackoverflow.com/users/178236/justin-beckwith"}, "edited": false, "score": 0, "creation_date": 1471972705, "post_id": 39105654, "comment_id": 65561599, "body": "I think you&#39;re supposed to use <code>goapp deploy</code> instead of appcfg.py for golang deployments.  Does that work?"}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 7229, "user_id": 178236, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9b46e503bdfc5dfe07ec0f5a7c542184?s=128&d=identicon&r=PG", "display_name": "Justin Beckwith", "link": "https://stackoverflow.com/users/178236/justin-beckwith"}, "edited": false, "score": 0, "creation_date": 1471972718, "post_id": 39105654, "comment_id": 65561605, "body": "@JustinBeckwith No, same thing. :("}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1471974236, "post_id": 39105654, "comment_id": 65562421, "body": "It&#39;s basically the exact same scenario as this, but I can&#39;t call <code>gcloud restore</code>: <a href=\"https://stackoverflow.com/questions/29685544/gcloud-components-update-cant-find-import\" title=\"gcloud components update cant find import\">stackoverflow.com/questions/29685544/&hellip;</a>"}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 7229, "user_id": 178236, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9b46e503bdfc5dfe07ec0f5a7c542184?s=128&d=identicon&r=PG", "display_name": "Justin Beckwith", "link": "https://stackoverflow.com/users/178236/justin-beckwith"}, "edited": false, "score": 0, "creation_date": 1472003947, "post_id": 39105654, "comment_id": 65573714, "body": "Solution posted below. Thanks @JustinBeckwith for the heads up!"}], "answers": [{"tags": [], "owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "is_accepted": true, "score": 0, "last_activity_date": 1472003858, "creation_date": 1472003858, "answer_id": 39113274, "question_id": 39105654, "link": "https://stackoverflow.com/questions/39105654/goapp-build-works-but-appcfg-py-update-just-cant-find-import/39113274#39113274", "title": "&quot;goapp build&quot; works, but &quot;appcfg.py update&quot; just &quot;can&#39;t find import&quot;...?", "body": "<p><a href=\"https://groups.google.com/forum/#!topic/google-appengine-go/rVHZXlSfC7E\" rel=\"nofollow\">https://groups.google.com/forum/#!topic/google-appengine-go/rVHZXlSfC7E</a> ... As noted here by another user, this is a temporary issue with Google App Engine.</p>\n\n<p>It can be solved by commenting out the <code>main()</code> method in the main package of your project. Normally, <code>init()</code> is used, so this does not currently cause any other issue except a minor inconvenience when deploying to other platforms simultaneously or building locally for non-App Engine execution.</p>\n"}, {"tags": [], "owner": {"reputation": 1536, "user_id": 5317173, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZglzG.png?s=128&g=1", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/5317173/nicholas"}, "is_accepted": false, "score": 1, "last_activity_date": 1472841550, "creation_date": 1472841550, "answer_id": 39298840, "question_id": 39105654, "link": "https://stackoverflow.com/questions/39105654/goapp-build-works-but-appcfg-py-update-just-cant-find-import/39298840#39298840", "title": "&quot;goapp build&quot; works, but &quot;appcfg.py update&quot; just &quot;can&#39;t find import&quot;...?", "body": "<p>This was a known issue with the App Engine SDK for Go caught during rollout and addressed.  It was tracker in public <a href=\"https://code.google.com/p/googleappengine/issues/detail?id=13230\" rel=\"nofollow\">Issue 13230</a>.  This should no longer be in effect.</p>\n\n<p>One important note that, as stated in the <a href=\"https://cloud.google.com/appengine/docs/go/quickstart#hello_world_code_review\" rel=\"nofollow\">documentation</a>, one should not implement a <code>main()</code> function in a Go GAE application as the behavior is <a href=\"https://code.google.com/p/googleappengine/issues/detail?id=13230#c6\" rel=\"nofollow\">unspecified</a>.</p>\n\n<p>Should anyone still be encountering this issue, please file a new defect report on the <a href=\"https://code.google.com/p/googleappengine/issues/list\" rel=\"nofollow\">App Engine public issue tracker</a> linking back to <a href=\"https://code.google.com/p/googleappengine/issues/detail?id=13230\" rel=\"nofollow\">Issue 13230</a> for context.</p>\n"}], "owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 39113274, "answer_count": 2, "score": 1, "last_activity_date": 1472841550, "creation_date": 1471967322, "last_edit_date": 1471975227, "question_id": 39105654, "link": "https://stackoverflow.com/questions/39105654/goapp-build-works-but-appcfg-py-update-just-cant-find-import", "title": "&quot;goapp build&quot; works, but &quot;appcfg.py update&quot; just &quot;can&#39;t find import&quot;...?", "body": "<p>After updating the Google App Engine SDK last night...\nBoth <code>go env</code> and <code>goapp env</code> have the correct GOPATH and GOROOT, <code>go build</code> and <code>goapp build</code> both work, but <code>appcfg.py update ...</code> returns that every third-party package is missing.</p>\n\n<p>Even if I run <code>goapp get ...</code> or <code>go get ...</code> again for each package, it makes no difference since they're already in the GOPATH anyway. That alone should be confirmed by the fact that <strong>both commands</strong> build the project.</p>\n\n<p>What could be wrong? :(</p>\n\n<hr>\n\n<p><strong>EDIT:</strong> It produces different errors each time I run <code>appcfg.py update .</code> ...</p>\n\n<blockquote>\n  <p>main.go:4: can't find import: \"github.com/gin-gonic/gin\"\n  github.com/gin-gonic/gin/binding/default_validator.go:7: can't find\n  import: \"gopkg.in/go-playground/validator.v8\"\n  github.com/gin-gonic/gin/context.go:17: can't find import:\n  \"github.com/gin-gonic/gin/binding\"</p>\n</blockquote>\n\n<p>... Ran <code>goapp get ...</code> on all of these, even though they're already there.</p>\n\n<blockquote>\n  <p>main.go:4: can't find import: \"github.com/gin-gonic/gin\"\n  github.com/gin-gonic/contrib/gzip/gzip.go:9: can't find import:\n  \"github.com/gin-gonic/gin\" github.com/gin-gonic/gin/render/yaml.go:10:\n  can't find import: \"gopkg.in/yaml.v2\"</p>\n</blockquote>\n\n<p>... Repeat, run <code>goapp get ...</code> on all of these again.</p>\n\n<blockquote>\n  <p>main.go:4: can't find import: \"github.com/gin-gonic/gin\"\n  github.com/gin-gonic/gin/render/yaml.go:10: can't find import:\n  \"gopkg.in/yaml.v2\"</p>\n</blockquote>\n\n<p>Makes no sense. The libraries are already there. I can do <code>goapp build</code> and it works, but <strong>I can't deploy.</strong></p>\n\n<p>All of this is inside the \"--- begin server output ---\" and \"--- end server output ---\" wrappings... is this a server-side issue?</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 3, "creation_date": 1471965948, "post_id": 39104879, "comment_id": 65557209, "body": "Its meaning is described in the godoc for the RunParallel method: <a href=\"https://golang.org/pkg/testing/#B.RunParallel\" rel=\"nofollow noreferrer\">golang.org/pkg/testing/#B.RunParallel</a> . Is there something specifically you don&#39;t understand about it?"}, {"owner": {"reputation": 1057, "user_id": 1750407, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/EobHJ.jpg?s=128&g=1", "display_name": "Wendy Adi", "link": "https://stackoverflow.com/users/1750407/wendy-adi"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1471966897, "post_id": 39104879, "comment_id": 65557874, "body": "Why its slower when we use RunParallel? Without it i got 0.3x ns/op but with RunParallel i got 1.1x ns/op. How this parallel benchmark works?"}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 1933695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e0bbe4a669b63ec3c3a7de6f395a42b?s=128&d=identicon&r=PG", "display_name": "PuppyKhan", "link": "https://stackoverflow.com/users/1933695/puppykhan"}, "is_accepted": false, "score": 5, "last_activity_date": 1495046096, "creation_date": 1495046096, "answer_id": 44032442, "question_id": 39104879, "link": "https://stackoverflow.com/questions/39104879/go-lang-testing-what-is-the-meaning-of-parallel-setting-on-benchmark/44032442#44032442", "title": "Go-lang Testing, What is the meaning of Parallel Setting on Benchmark?", "body": "<p>The for loop in the first benchmark has all tests run sequentially, one at a time, and the performance is the time divided by iterations.</p>\n\n<p>The RunParallel benchmark divides the iterations among available threads. The performance is calculated similarly, probably averaging each group. The point of this is that several (exact # based upon your GOMAXPROCS setting) test iterations are run concurrently. This is especially helpful in testing functions with shared resources and locking, which may run fine solo but introduce performance issues when run concurrently.</p>\n"}, {"tags": [], "owner": {"reputation": 370, "user_id": 2852352, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wV6Wg.jpg?s=128&g=1", "display_name": "Vinod Patel", "link": "https://stackoverflow.com/users/2852352/vinod-patel"}, "is_accepted": false, "score": 0, "last_activity_date": 1508478708, "creation_date": 1508478708, "answer_id": 46843051, "question_id": 39104879, "link": "https://stackoverflow.com/questions/39104879/go-lang-testing-what-is-the-meaning-of-parallel-setting-on-benchmark/46843051#46843051", "title": "Go-lang Testing, What is the meaning of Parallel Setting on Benchmark?", "body": "<p>It depends on whats there inside</p>\n\n<pre><code>SomeFunction()\n</code></pre>\n\n<p>If its just an empty function or a simple calculation, serial benchmark will be faster. But if it's a heavy computation or IO,</p>\n\n<pre><code>RunParallel()\n</code></pre>\n\n<p>benchmark will be faster.</p>\n"}], "owner": {"reputation": 1057, "user_id": 1750407, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/EobHJ.jpg?s=128&g=1", "display_name": "Wendy Adi", "link": "https://stackoverflow.com/users/1750407/wendy-adi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3476, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1508478708, "creation_date": 1471965092, "question_id": 39104879, "link": "https://stackoverflow.com/questions/39104879/go-lang-testing-what-is-the-meaning-of-parallel-setting-on-benchmark", "title": "Go-lang Testing, What is the meaning of Parallel Setting on Benchmark?", "body": "<p>In <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow\">https://golang.org/pkg/testing/</a> described that we can use <code>testing.B.RunParallel()</code> function to run benchmark in a <em>parallel setting</em>. I tried to write simple testing code:</p>\n\n<pre><code>func BenchmarkFunctionSome(b *testing.B) {\n\n    for i := 0; i &lt; b.N; i++ {\n        SomeFunction()\n    }\n}\n</code></pre>\n\n<p>and then i changed it to use <code>RunParallel()</code></p>\n\n<pre><code>func BenchmarkFunctionSome(b *testing.B) {\n\n    b.RunParallel(func(pb *testing.PB) {\n        for pb.Next() {\n            SomeFunction()\n        }\n    })\n}\n</code></pre>\n\n<p>And the one which used <code>RunParallel()</code> is slower than the first benchmark. </p>\n\n<p>Actually what is the meaning of <em>parallel setting</em> in benchmarking? Why it became slower if i used <code>RunParallel()</code> ?</p>\n"}, {"tags": ["swift", "go"], "comments": [{"owner": {"reputation": 230, "user_id": 6629875, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154099108888429/picture?type=large", "display_name": "marangisto", "link": "https://stackoverflow.com/users/6629875/marangisto"}, "edited": false, "score": 0, "creation_date": 1471966899, "post_id": 39104754, "comment_id": 65557878, "body": "Unless the library was designed ground-up with language interoperability in mind this is likely to be a huge if not impossible undertaking. The main challenges are going to be object life-time management (compatibility with your host language GC) and turning every argument into some plain C representation. Of course, it&#39;s possible that the library is huge but its API is small in which case you are in luck."}, {"owner": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "edited": false, "score": 1, "creation_date": 1488044413, "post_id": 39104754, "comment_id": 72061175, "body": "SWIG is extremely powerful and can wrap quite complex systems and is certainly capable of working with large libraries.  It won&#39;t automagically do it, you&#39;ll need to tweak and tune your SWIG *.i files, but SWIG is a solid way to address this kind of thing as it gives you ways to define how the original language is wrapped and exposed to the the new calling language."}, {"owner": {"reputation": 686, "user_id": 433041, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9a490daadb32be545d472824bdbfbe0f?s=128&d=identicon&r=PG", "display_name": "Oleg Kovalov", "link": "https://stackoverflow.com/users/433041/oleg-kovalov"}, "edited": false, "score": 0, "creation_date": 1497652966, "post_id": 39104754, "comment_id": 76186120, "body": "You might be interested in <a href=\"https://cgogen.com/\" rel=\"nofollow noreferrer\">cgogen</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1201, "user_id": 651028, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6d5887835c21dace586b98180544c74e?s=128&d=identicon&r=PG", "display_name": "Sergei G", "link": "https://stackoverflow.com/users/651028/sergei-g"}, "is_accepted": false, "score": 2, "last_activity_date": 1504287922, "last_edit_date": 1504287922, "creation_date": 1504287473, "answer_id": 46005421, "question_id": 39104754, "link": "https://stackoverflow.com/questions/39104754/auto-wrap-huge-c-libs-to-c-for-import-in-swift-go/46005421#46005421", "title": "Auto-Wrap huge C++ libs to C for import in Swift / Go", "body": "<p>Q1: Is it realistic? </p>\n\n<p>Not realistic, because any large complicated C++ interop is going to get too complicated.  Automatic tools are likely to fail and manual work is too hard.</p>\n\n<p>Q2: What's best?</p>\n\n<p>I don't know and given A1 it does not seem to matter.</p>\n\n<p>Q3: Alternative?\nQ4: Is C++ only the best alternative?</p>\n\n<p>If you want to take advantage of existing C++ code from another language regardless of the language involved the best option in complex scenarios is to use a hybrid approach.</p>\n\n<p>Most languages provide interop to C and not C++ due to non-standard C++ naming convention.  In other words, just about every language provides access to plain C-functions, but C++ is frequently not supported.</p>\n\n<p>Since your library is complex, the best solution would be based on \"Facade\" pattern.  Create a new C-library and implement application specific logic that utilizes C++ library.  Try to design this library to be as thin as possible.  The goal is not to write all business logic, but to provide C-functions that hold on C++ objects and call C++ functions.  The GO-level language code would then call this library to use C++ library underneath.  This approach differs from Q1 approach.  In Q1 you attempt to have one interop call on per C++ function or object's method.  In Facade you attempt to implement C++ usage scenarios that are unique to your application.</p>\n\n<p>With Facade you reduce the scope of interop work, because you target your application scenarios.  At the same time you mitigate away from C++ complexity at GO language level.</p>\n\n<p>For example, you need to read a temperature sensor using C++ library.  </p>\n\n<p>In C++ you'd have to do:</p>\n\n<ol>\n<li>open file</li>\n<li>read stream until you find SLIP terminator</li>\n<li>read one \"record\"</li>\n<li>close file</li>\n</ol>\n\n<p>With facade you create a single function called \"readTemperature(deviceFileName)\" and that C function executes 4 calls at once.</p>\n\n<p>That's a fake example, just to show the point.</p>\n\n<p>With facade you might want to hide original C++ objects and at this point it becomes a small layer.  The goal here is to stay focused and balance your application needs with generalization to support your application.</p>\n\n<p>Interestingly enough Facade approach is a way to improve interop performance.  Interop in just about every language is more expensive than normal operations due to need to marshal from langauage runtime environment and keep it protected.  Lots of interop calls slow down application (we are talking about millions here).  For example, having 10 interop calls combined into 1 improves performance, because amount of itnerop operations is reduced.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 13556213, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rEdNH.jpg?s=128&g=1", "display_name": "matty902", "link": "https://stackoverflow.com/users/13556213/matty902"}, "is_accepted": false, "score": 0, "last_activity_date": 1592707490, "creation_date": 1592707490, "answer_id": 62493874, "question_id": 39104754, "link": "https://stackoverflow.com/questions/39104754/auto-wrap-huge-c-libs-to-c-for-import-in-swift-go/62493874#62493874", "title": "Auto-Wrap huge C++ libs to C for import in Swift / Go", "body": "<p>I was successful wrapping a large (although perhaps not &quot;huge&quot;) C++ library (hundreds of header files) in Swift using a relatively simple process. You directly link your project to the library. The only thing you have to wrap are any new functions that you write (to be invoked in Swift) that actually use the library (in the C++ wrapper file). The verbose stuff can be left in the wrapper file, mostly without any modification. There is a simple little tutorial which helped me: <a href=\"https://www.swiftprogrammer.info/swift_call_cpp.html\" rel=\"nofollow noreferrer\">https://www.swiftprogrammer.info/swift_call_cpp.html</a></p>\n<p>(FYI, there is one step he omitted:  Set your library search paths in Build Settings =&gt; Search Paths =&gt; Library Search Paths (both Debug and Release) )</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1648409"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1129, "favorite_count": 3, "answer_count": 2, "score": 9, "last_activity_date": 1592707490, "creation_date": 1471964770, "question_id": 39104754, "link": "https://stackoverflow.com/questions/39104754/auto-wrap-huge-c-libs-to-c-for-import-in-swift-go", "title": "Auto-Wrap huge C++ libs to C for import in Swift / Go", "body": "<p>Let's say i have a huge lib in C++ (with tons of dependencies, it needs about 3h for a full build under GCC). I want to build upon that lib but don't want to do so in C++ but rather in a more productive language. How can i actually bridge or wrap that extern lib package so i can access it in another language and program on top of it?</p>\n\n<p>Languages considered:</p>\n\n<ul>\n<li>Swift </li>\n<li>Go</li>\n</ul>\n\n<p>What i found is, that both languages do provide auto bridging or wrapping for C libs and code (I don't actually know whats the difference between wrapping / bridging). So, if i have some c code, i can just throw it in the same Swift or Go project and can use it with a simple import in my project. </p>\n\n<p>This doesn't work in both languages for C++ code however. So i googled how to transform C++ libs to C code or generate autowrappers. I found the following:</p>\n\n<ol>\n<li>swig.org - auto wrapper for C++ libs</li>\n<li>Comeau C++ compiler - automatically transfers C++ to C code</li>\n<li>LLVM - should be able to take <em>any</em> input and transform it to <em>any</em> output that LLVM is capable of.</li>\n</ol>\n\n<p>Question:</p>\n\n<ol>\n<li>Is it even in the realms of usable / realistic / managable to build\non top of such a huge lib in other languages like Swift / Go, if\nusing auto wrapping or auto bridging?</li>\n<li>What of the 3 listed libs / programs / frameworks works best for the process of C++ -> C (because Swift and Go both provide C auto\nwrapping).</li>\n<li>Are there better alternatives than what i considered so far?</li>\n<li>Would it be better to just \"stick with C++\" as using any other tools to do the wrapping / bridging process would be far to much\nwork to equal out the benefit of using a more productive language\nlike Swift / Go?</li>\n</ol>\n\n<p>Thanks:)</p>\n\n<p>Disclaimer: There is also the possibility to manually wrap a C++ lib in C but that would take an unbearable amount of work for such a huge lib.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore", "app-engine-ndb"], "answers": [{"comments": [{"owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "edited": false, "score": 0, "creation_date": 1471964658, "post_id": 39104364, "comment_id": 65556312, "body": "Thanks for the answer. A bit lame on the datastore&#39;s behalf, product-wise, but I&#39;ll work around this."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "edited": false, "score": 0, "creation_date": 1471964752, "post_id": 39104364, "comment_id": 65556371, "body": "@orcaman Agree, this may cause headaches, but on the other hand this is to ensure that all queries run &quot;super fast&quot; regardless of how many entities you have. And that is done by allowing only queries which are backed by indices. And such queries to list entities with missing properties, there is no index for that."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1471964660, "last_edit_date": 1471964660, "creation_date": 1471963668, "answer_id": 39104364, "question_id": 39104283, "link": "https://stackoverflow.com/questions/39104283/gae-datastore-golang-filter-query-when-adding-new-db-field/39104364#39104364", "title": "GAE Datastore (Golang): Filter Query When Adding New DB Field", "body": "<p>The bad news is that you can't.</p>\n\n<p>Every query on GAE Datastore operates on an index. Since you just added the new property, existing entities without that property will not be in any indices (that includes that property). What you would need is to loop over entities <em>with no index records</em>, but that is not possible.</p>\n\n<p>Your best bet is to query <em>all</em> entities, and do the filtering / update manually in Go code, where the <code>NewField</code> field has the zero value. Once you re-save existing entities, the new property will get indexed, and you will be able to search / filter by that property in the future.</p>\n\n<p>If by any chance your entities store the creation time or last updated time (in a property), then you may use that: filter by last updated time to list only entities where the timestamp is less than the time when you added the new property to your Go model.</p>\n\n<p>Another option (for future changes) is to add a <code>\"version\"</code> property to your entities. Whenever you perform a model update, increment the version for new entities. And you can always query entities with old versions (or with a specific version).</p>\n"}], "owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "accepted_answer_id": 39104364, "answer_count": 1, "score": 1, "last_activity_date": 1474390375, "creation_date": 1471963430, "last_edit_date": 1474390375, "question_id": 39104283, "link": "https://stackoverflow.com/questions/39104283/gae-datastore-golang-filter-query-when-adding-new-db-field", "title": "GAE Datastore (Golang): Filter Query When Adding New DB Field", "body": "<p>I'm running a GAE Golang application that's working with <code>datastore</code>. I have a struct which translates to a DB model on <code>datastore</code>, and I have added a new field to the struct, call it <code>NewField</code> (type <code>string</code>)</p>\n\n<p>Existing instances (\"rows\" in the DB) for this struct have this <code>NewField</code> missing of course, which is expected. </p>\n\n<p>I'm looking to create a query that will return all instances with where this <code>NewField</code> is missing (the existing instances). </p>\n\n<p>This is what I tried:</p>\n\n<pre><code>q := datastore.NewQuery(\"MyModel\")\nq = q.Filter(\"NewField =\", \"\")\n</code></pre>\n\n<p>However this doesn't seem to work. </p>\n\n<p>Any ideas on how to achieve this?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1471959851, "post_id": 39102902, "comment_id": 65552462, "body": "Well, that was easy. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 17, "last_activity_date": 1591001999, "last_edit_date": 1591001999, "creation_date": 1471959909, "answer_id": 39102969, "question_id": 39102902, "link": "https://stackoverflow.com/questions/39102902/find-all-string-matches-with-regex-golang/39102969#39102969", "title": "Find all string matches with Regex golang", "body": "<p>First, you do not need the regex delimiters. Second, it is a good idea to use raw string literals to define a regex pattern where you need to use only 1 backslash to escape regex metacharacters. Third, the capturing group is only necessary if you need to get the values without <code>{</code> and <code>}</code>, thus, you may remove it to get <code>{city}</code>, <code>{state}</code> and <code>{zip}</code>.</p>\n\n<p>You may use <a href=\"https://golang.org/pkg/regexp/#Regexp.FindAllString\" rel=\"noreferrer\"><code>FindAllString</code></a> to get all matches:</p>\n\n<pre><code>r := regexp.MustCompile(`{[^{}]*}`)\nmatches := r.FindAllString(\"{city}, {state} {zip}\", -1)\n</code></pre>\n\n<p>See the <a href=\"https://play.golang.org/p/wkBP1t28deD\" rel=\"noreferrer\">Go demo</a>. </p>\n\n<p>To only get the parts between curly braces use <a href=\"https://golang.org/pkg/regexp/#Regexp.FindAllStringSubmatch\" rel=\"noreferrer\"><code>FindAllStringSubmatch</code></a> with a pattern that contains capturing parentheses, <code>{([^{}]*)}</code>:</p>\n\n<pre><code>r := regexp.MustCompile(`{([^{}]*)}`)\nmatches := r.FindAllStringSubmatch(\"{city}, {state} {zip}\", -1)\nfor _, v := range matches {\n    fmt.Println(v[1])\n}\n</code></pre>\n\n<p>See <a href=\"https://play.golang.org/p/yX920ZUXP81\" rel=\"noreferrer\">this Go demo</a>.  </p>\n\n<p><strong>Regex details</strong></p>\n\n<ul>\n<li><code>{</code> - a literal <code>{</code> char</li>\n<li><code>([^{}]*)</code>- a capturing group that matches any 0 or more (due to the <code>*</code> quantifier) characters other than <code>{</code> and <code>}</code> (<code>[^...]</code> is a negated character class matching any char but the one(s) specified between <code>[^</code> and <code>]</code>)</li>\n<li><code>}</code> - a literal <code>}</code> char</li>\n</ul>\n"}], "owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18684, "favorite_count": 5, "accepted_answer_id": 39102969, "answer_count": 1, "score": 9, "last_activity_date": 1591001999, "creation_date": 1471959711, "question_id": 39102902, "link": "https://stackoverflow.com/questions/39102902/find-all-string-matches-with-regex-golang", "title": "Find all string matches with Regex golang", "body": "<p>I am trying to return an array, or slice, with all the matches for a specific regex expression against a string. The string is:</p>\n\n<pre><code>{city}, {state} {zip}\n</code></pre>\n\n<p>I want to return an array with all the matches of strings between curly braces. I have tried using the <a href=\"https://golang.org/pkg/regexp\" rel=\"noreferrer\">regexp</a> package to accomplish this but cannot figure out how to return what I am looking for. This is my current code:</p>\n\n<pre><code>r := regexp.MustCompile(\"/({[^}]*})/\")\nmatches := r.FindAllString(\"{city}, {state} {zip}\", -1)\n</code></pre>\n\n<p>But, all it returns is an empty slice every time no matter what I try.</p>\n"}, {"tags": ["go", "aerospike"], "comments": [{"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "edited": false, "score": 0, "creation_date": 1471962045, "post_id": 39100766, "comment_id": 65554316, "body": "I don&#39;t know Aerospike, but a quick look into the documentation pointed out UDF (User Defined Function). <a href=\"http://www.aerospike.com/docs/client/go/usage/query/query_udf.html\" rel=\"nofollow noreferrer\">aerospike.com/docs/client/go/usage/query/query_udf.html</a>"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 5918922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/daV4z.jpg?s=128&g=1", "display_name": "Cory", "link": "https://stackoverflow.com/users/5918922/cory"}, "edited": false, "score": 1, "creation_date": 1472068478, "post_id": 39129060, "comment_id": 65609290, "body": "Thank you very much for the answer. I was quietly afraid I would have to result to UDF, but wanted to make sure there was no chance of a premade function first. I&#39;ve not gone that far with Aerospace yet and my lua experience is literally zero, so this will be an enormous help :)"}], "tags": [], "owner": {"reputation": 834, "user_id": 1573115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef104e52dbbf38b796179483816e20c9?s=128&d=identicon&r=PG", "display_name": "Jan Hecking", "link": "https://stackoverflow.com/users/1573115/jan-hecking"}, "is_accepted": true, "score": 4, "last_activity_date": 1472057748, "creation_date": 1472057748, "answer_id": 39129060, "question_id": 39100766, "link": "https://stackoverflow.com/questions/39100766/aerospike-query-return-highest-value/39129060#39129060", "title": "Aerospike Query Return Highest Value", "body": "<p>You can apply a Lua user-defined function (UDF) to the query to filter the results efficiently.</p>\n\n<p>E.g. here is a Stream UDF that would return the record with the max. version number:</p>\n\n<pre><code>function maxVersion(stream, bin)\n  -- The stream function cannot return record objects directly,\n  -- so we have to map to a Map data type first.\n  local function toArray(rec)\n    local result = map()\n    result['filename'] = rec['filename']\n    result['version'] = rec['version']\n    return result\n  end\n  local function findMax(a, b)\n    if a.version &gt; b.version then\n      return a\n    else\n      return b\n    end\n  end\n  return stream : map(toArray) : reduce(findMax)\nend\n</code></pre>\n\n<p>Using the Go client you would execute the function like this:</p>\n\n<pre><code>  stmt := NewStatement(ns, set)\n  recordset, _ := client.QueryAggregate(nil, stmt, \"udfFilter\", \"maxVersion\")\n\n  for rec := range recordset.Results() {\n    res := rec.Record.Bins[\"SUCCESS\"].(map[interface{}]interface{})\n    fmt.Printf(\"filename with max. version: %s (ver. %d)\\n\", res[\"filename\"], res[\"version\"])\n}\n</code></pre>\n\n<p>I've uploaded a fully working example as a Gist here: <a href=\"https://gist.github.com/jhecking/b98783bea7564d610ea291b5ac47808c\" rel=\"nofollow\">https://gist.github.com/jhecking/b98783bea7564d610ea291b5ac47808c</a></p>\n\n<p>You can find more information about how to work with Stream UDFs for query aggregation here: <a href=\"http://www.aerospike.com/docs/guide/aggregation.html\" rel=\"nofollow\">http://www.aerospike.com/docs/guide/aggregation.html</a></p>\n"}], "owner": {"reputation": 51, "user_id": 5918922, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/daV4z.jpg?s=128&g=1", "display_name": "Cory", "link": "https://stackoverflow.com/users/5918922/cory"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 39129060, "answer_count": 1, "score": 1, "last_activity_date": 1472057748, "creation_date": 1471954142, "question_id": 39100766, "link": "https://stackoverflow.com/questions/39100766/aerospike-query-return-highest-value", "title": "Aerospike Query Return Highest Value", "body": "<p>I'm trying to create a query for my Aerospike database, that would return the highest value in a specific bin; similar to the way that the MAX() function works in MySQL. For example, if I had a set like this:</p>\n\n<pre><code>+--------------+---------+\n| filename     | version |\n+--------------+---------+\n| alphabet.doc | 4       |\n| people.doc   | 2       |\n| alphabet.doc | 6       |\n| people.doc   | 3       |\n+--------------+---------+\n</code></pre>\n\n<p>What I need is to only return the filename with the highest version number. At the moment I can add a filter like this:</p>\n\n<pre><code>    stmt := db.NewStatement(DBns, DBset, \"filename\", \"version\")\n    stmt.Addfilter(db.NewEqualFilter(\"filename\", \"alphabet.doc\"))\n\n    // run database query\n    records := runQuery(stmt)\n</code></pre>\n\n<p>Anyone know how to do this?</p>\n"}, {"tags": ["excel", "go", "xlsx"], "comments": [{"owner": {"reputation": 869, "user_id": 2620356, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d70e7de8674154dc8b6a5dde5d5c75?s=128&d=identicon&r=PG", "display_name": "kingSlayer", "link": "https://stackoverflow.com/users/2620356/kingslayer"}, "edited": false, "score": 0, "creation_date": 1471954719, "post_id": 39100447, "comment_id": 65548465, "body": "What is the problem with my question? Why the downvote?"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1471955871, "post_id": 39100447, "comment_id": 65549308, "body": "I didn&#39;t downvote, but if you&#39;re able to format the cell or cell value, it&#39;s just a question of adding the condition yourself isn&#39;t it ?"}, {"owner": {"reputation": 869, "user_id": 2620356, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d70e7de8674154dc8b6a5dde5d5c75?s=128&d=identicon&r=PG", "display_name": "kingSlayer", "link": "https://stackoverflow.com/users/2620356/kingslayer"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 1, "creation_date": 1471956224, "post_id": 39100447, "comment_id": 65549611, "body": "No it isn&#39;t, if I write to a cell the way You mentioned, and save the file. Later on, if someone opens the file e.g. Excel 2013 or similar and let&#39;s say changes a value on which the condition was based, the condition will not be  called because the condition was hard-coded in my Go program."}], "owner": {"reputation": 869, "user_id": 2620356, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d70e7de8674154dc8b6a5dde5d5c75?s=128&d=identicon&r=PG", "display_name": "kingSlayer", "link": "https://stackoverflow.com/users/2620356/kingslayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 227, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1471956521, "creation_date": 1471953218, "last_edit_date": 1471956521, "question_id": 39100447, "link": "https://stackoverflow.com/questions/39100447/xlsx-conditional-formatting-in-go", "title": "XLSX conditional formatting in Go", "body": "<p>I'm using </p>\n\n<blockquote>\n  <p>github.com/tealeg/xlsx</p>\n</blockquote>\n\n<p>and it does not have conditional formatting options like this <a href=\"http://xlsxwriter.readthedocs.io/example_conditional_format.html\" rel=\"nofollow\">python writer</a> . Are there any packages in Go for conditional formatting? If not, what would be a good starting point to achieve this using the mentioned Go excel writer.\nThanks</p>\n\n<p><strong>Edit 1</strong>\nI need a way so that the xlsx file \"remembers\" the conditional formatting for a cell range. I don't want to hard-code the condition to my Go program.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1471946892, "post_id": 39098142, "comment_id": 65543167, "body": "Are you sure? On which input? Playground?"}, {"owner": {"reputation": 13677, "user_id": 5046896, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7GplC.jpg?s=128&g=1", "display_name": "GoingMyWay", "link": "https://stackoverflow.com/users/5046896/goingmyway"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1471947247, "post_id": 39098142, "comment_id": 65543388, "body": "@Volker, both on the playground and on my laptop, the playground return <code>process took too long</code>"}], "answers": [{"comments": [{"owner": {"reputation": 13677, "user_id": 5046896, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7GplC.jpg?s=128&g=1", "display_name": "GoingMyWay", "link": "https://stackoverflow.com/users/5046896/goingmyway"}, "edited": false, "score": 0, "creation_date": 1471947688, "post_id": 39098347, "comment_id": 65543687, "body": "thanks, the error is hard to detect for a newbie of Go."}, {"owner": {"reputation": 1564, "user_id": 2152200, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ba0b08f62368852ce8d8466d4a4e87b0?s=128&d=identicon&r=PG", "display_name": "Ayonix", "link": "https://stackoverflow.com/users/2152200/ayonix"}, "edited": false, "score": 1, "creation_date": 1471954180, "post_id": 39098347, "comment_id": 65548073, "body": "I don&#39;t see how this is related to Go, the problem is that you never update the value of <code>z</code>, which is an algorithmical error. If you pull out the <code>z=n</code> from the loop it works just fine (or duplicate, to keep the latest iteration)."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 4, "last_activity_date": 1471947244, "creation_date": 1471947244, "answer_id": 39098347, "question_id": 39098142, "link": "https://stackoverflow.com/questions/39098142/go-for-loop-and-break-infinite-loop/39098347#39098347", "title": "go, for loop and break, infinite loop", "body": "<p>The second loop will be infinite since the logic is flawed. In this code:</p>\n\n<pre><code>for {\n    n := z - (z*z - x) / (2*z)\n    if math.Abs(n - z) &lt; delta {\n        z = n // here ....\n        break // break here\n    }\n}\n</code></pre>\n\n<p>value of <code>z</code> never updates to the newly calculated value. This results in <code>n := z - (z*z - x) / (2*z)</code> always working on the same <code>z</code>, that is equal to <code>x</code>, since the condition <code>math.Abs(n - z) &lt; delta</code> never gets to be true.</p>\n\n<p>You need to assign to <code>z</code> again so it gets updated. You can check this by logging value of <code>z</code> in the loop. Example code: <a href=\"https://play.golang.org/p/9H7Uze4gip\" rel=\"nofollow\">https://play.golang.org/p/9H7Uze4gip</a></p>\n"}], "owner": {"reputation": 13677, "user_id": 5046896, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7GplC.jpg?s=128&g=1", "display_name": "GoingMyWay", "link": "https://stackoverflow.com/users/5046896/goingmyway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1060, "favorite_count": 0, "accepted_answer_id": 39098347, "answer_count": 1, "score": 0, "last_activity_date": 1471947244, "creation_date": 1471946692, "last_edit_date": 1471947021, "question_id": 39098142, "link": "https://stackoverflow.com/questions/39098142/go-for-loop-and-break-infinite-loop", "title": "go, for loop and break, infinite loop", "body": "<p>there is no error in the following code.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\ntype ErrNegativeSqrt float64\n\nfunc (e ErrNegativeSqrt) Error() string {\n    return fmt.Sprintf(\"cannot Sqrt negative number: %v\", float64(e))\n}\n\nfunc Sqrt(x float64) (float64, error) {\n    if x &lt; 0 {\n        err := ErrNegativeSqrt(x)\n        return x, err\n    }\n    z := x\n    var delta = 1e-10\n    for {\n        n := z - (z*z - x) / (2*z)\n        if math.Abs(n - z) &lt; delta {\n            break\n        }\n        z = n\n    }\n    return z, nil\n}\n\nfunc main() {\n    fmt.Println(Sqrt(2))\n    fmt.Println(Sqrt(-3))\n}\n</code></pre>\n\n<p>But when I change the for loop in <code>func Sqrt()</code>, it led to infinite loop?</p>\n\n<pre><code>func Sqrt(x float64) (float64, error) {\n    if x &lt; 0 {\n        err := ErrNegativeSqrt(x)\n        return x, err\n    }\n    z := x\n    var delta = 1e-10\n    for {\n        n := z - (z*z - x) / (2*z)\n        if math.Abs(n - z) &lt; delta {\n            z = n // here ....\n            break // break here\n        }\n    }\n    return z, nil\n}\n</code></pre>\n\n<p>Why there are different?</p>\n"}, {"tags": ["arrays", "json", "parsing", "dictionary", "go"], "comments": [{"owner": {"reputation": 1121, "user_id": 4381158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ABb2u.jpg?s=128&g=1", "display_name": "Maxim Samburskiy", "link": "https://stackoverflow.com/users/4381158/maxim-samburskiy"}, "edited": false, "score": 0, "creation_date": 1471952955, "post_id": 39097183, "comment_id": 65547223, "body": "Please notice what I want to <b>decode</b> existing json and I have <b>one key</b> and <b>two types</b> of the value"}, {"owner": {"reputation": 1121, "user_id": 4381158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ABb2u.jpg?s=128&g=1", "display_name": "Maxim Samburskiy", "link": "https://stackoverflow.com/users/4381158/maxim-samburskiy"}, "edited": false, "score": 0, "creation_date": 1471954905, "post_id": 39097183, "comment_id": 65548603, "body": "@Amd Read the question, please Array is always empty, it should be empty <code>map[string]Item{}</code> Object is always filled, so it should be filled <code>map[string]Item{...}</code>"}, {"owner": {"reputation": 1121, "user_id": 4381158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ABb2u.jpg?s=128&g=1", "display_name": "Maxim Samburskiy", "link": "https://stackoverflow.com/users/4381158/maxim-samburskiy"}, "edited": false, "score": 0, "creation_date": 1471956236, "post_id": 39097183, "comment_id": 65549621, "body": "@Amd it should decode <code>array</code> or <code>object</code> in <code>one</code> field of type <code>map[string]Item</code>"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 0, "last_activity_date": 1473769501, "last_edit_date": 1473769501, "creation_date": 1471944591, "answer_id": 39097432, "question_id": 39097183, "link": "https://stackoverflow.com/questions/39097183/decode-both-map-and-array-json/39097432#39097432", "title": "Decode both map and array json", "body": "<p>Try this working code (A):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Item int\n\ntype response struct {\n    Items map[string]Item `json:\"Items\"`\n    Array []Item          `json:\"Array\"`\n}\n\nfunc main() {\n    var d response\n    err := json.Unmarshal([]byte(`{\"Items\":{\"A\":1,\"B\":2,\"C\":3},\"Array\":[]}`), &amp;d)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(d)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{map[C:3 A:1 B:2] []}\n</code></pre>\n\n<hr>\n\n<p>Try this working code (B):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Item int\n\ntype response struct {\n    Items map[string]Item `json:\"Items\"`\n    //Array []Item          `json:\"Array\"`\n}\n\nfunc main() {\n    var d response\n    err := json.Unmarshal([]byte(`{\"Items\":{\"A\":1,\"B\":2,\"C\":3},\"Array\":[]}`), &amp;d)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(d)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{map[C:3 A:1 B:2]} \n</code></pre>\n\n<hr>\n\n<p>You may use <code>json.Marshal</code> and <code>json.Unmarshal</code>, like this working code (C):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Item int\n\ntype response struct {\n    Items map[string]Item `json:\"Items\"`\n    Array []Item          `json:\"Array\"`\n}\n\nfunc main() {\n    var test = response{\n        Items: map[string]Item{\"A\": 1, \"B\": 2, \"C\": 3},\n        Array: []Item{},\n    }\n    body, err := json.Marshal(test)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(body)) // {\"Items\":{\"A\":1,\"B\":2,\"C\":3},\"Array\":[]}\n\n    var d response\n    err = json.Unmarshal(body, &amp;d)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(d)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{\"Items\":{\"A\":1,\"B\":2,\"C\":3},\"Array\":[]}\n{map[A:1 B:2 C:3] []}\n</code></pre>\n\n<hr>\n\n<p>You may Unmarshal <code>{\"A\":1,\"B\":2,\"C\":3}</code> to <code>map[A:1 B:2 C:3]</code><br>\nand  <code>\"[1,2,3]\"</code> to <code>[1 2 3]</code>, like this working code (D):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Item int\n\ntype response1 map[string]Item\ntype response2 []Item\n\nfunc main() {\n    var d response1\n    err := json.Unmarshal([]byte(`{\"A\":1,\"B\":2,\"C\":3}`), &amp;d)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(d) // map[A:1 B:2 C:3]\n\n    var d2 response2\n    err2 := json.Unmarshal([]byte(`[1,2,3]`), &amp;d2)\n    if err2 != nil {\n        panic(err2)\n    }\n    fmt.Println(d2) // [1 2 3]\n}\n</code></pre>\n\n<p>output:  </p>\n\n<pre><code>map[A:1 B:2 C:3]\n[1 2 3]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 1, "last_activity_date": 1471963830, "creation_date": 1471963830, "answer_id": 39104428, "question_id": 39097183, "link": "https://stackoverflow.com/questions/39097183/decode-both-map-and-array-json/39104428#39104428", "title": "Decode both map and array json", "body": "<p>If you need to unmarshall to a variable type, the easiest way is to unmarshal into a <code>map[string]interface{}</code> and type-assert (or in this case, type-switch) your way out.</p>\n\n<pre><code>func Unmarshal(data []byte) (map[string]Item, error) {\n    var d struct {\n        Items interface{} `json:\"items\"`\n    }\n    if err := json.Unmarshal(data, &amp;d); err != nil {\n        return nil, err\n    }\n    switch dv := d.Items.(type) {\n    case []interface{}:\n        if len(dv) == 0 {\n            return nil, nil\n        }\n    case map[string]interface{}:\n        m := make(map[string]Item)\n        for k, v := range dv {\n            m[k] = Item(v)\n        }\n        return m, nil\n    }\n    // fallthrough return if different type, or non-empty array\n    // Could have put this in a default case, but this catches non-empty arrays too\n    return nil, fmt.Errorf(\"unexpected type in json\")\n}\n</code></pre>\n\n<p>Here's an example showing it works for both of your provided examples: <a href=\"https://play.golang.org/p/c0oZX2-xpN\" rel=\"nofollow\">https://play.golang.org/p/c0oZX2-xpN</a></p>\n"}], "owner": {"reputation": 1121, "user_id": 4381158, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ABb2u.jpg?s=128&g=1", "display_name": "Maxim Samburskiy", "link": "https://stackoverflow.com/users/4381158/maxim-samburskiy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 712, "favorite_count": 0, "accepted_answer_id": 39104428, "answer_count": 2, "score": 1, "last_activity_date": 1473769501, "creation_date": 1471943905, "last_edit_date": 1471945889, "question_id": 39097183, "link": "https://stackoverflow.com/questions/39097183/decode-both-map-and-array-json", "title": "Decode both map and array json", "body": "<p>External API returns empty array if no items:</p>\n\n<pre><code>{\"items\":[]}\n</code></pre>\n\n<p>...or map with items:</p>\n\n<pre><code>{\"items\":{\"1\": {...}, \"2\": {...}}}\n</code></pre>\n\n<p>How can I decode both of them? I tried using this struct:</p>\n\n<pre><code>var response struct {\n    Items map[string]Item\n    Array []Item `json:\"items\"`\n}\n</code></pre>\n\n<p>But it doesn't work. </p>\n\n<p><strong>UPDATE:</strong> Best if both (array and object) will produce a <code>map[string]Item</code> (empty and filled)</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1471942876, "post_id": 39096628, "comment_id": 65540283, "body": "How have you declared <code>documentsCountPerHost</code>? And why do you need <code>documentCount</code> above if it&#39;s not being used? Can you share your full code, complete with how you are working with <code>WaitGroup</code>?"}, {"owner": {"reputation": 1912, "user_id": 1345266, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/kZ0QR.jpg?s=128&g=1", "display_name": "KiwiJuicer", "link": "https://stackoverflow.com/users/1345266/kiwijuicer"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1471943140, "post_id": 39096628, "comment_id": 65540441, "body": "@abhink The counter is used for the comment and the host as key for the channels map. I&#39;ve added more of my original code to it."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1471945379, "post_id": 39096628, "comment_id": 65542088, "body": "@KiwiJuicer It is not clear what are you trying to do, please at least aim for One   Compiled Sample Code: <a href=\"http://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>"}, {"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 0, "creation_date": 1471952203, "post_id": 39096628, "comment_id": 65546674, "body": "for loop variable <code>host</code> should not be used inside <code>go func()</code>, because it might change when the goroutine runs."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 0, "creation_date": 1471974030, "post_id": 39096628, "comment_id": 65562303, "body": "@zzn has a very valid point here.  Host is a single variable updated each loop iteration.  You need to capture it inside the goroutine function&#39;s argument list in order to ensure you have <code>host</code>&#39;s value when the <code>go func</code> command is run, since there&#39;s no guarantee that the <code>for range</code> in the goroutine will run before the outer loop updated <code>host</code>."}], "owner": {"reputation": 1912, "user_id": 1345266, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/kZ0QR.jpg?s=128&g=1", "display_name": "KiwiJuicer", "link": "https://stackoverflow.com/users/1345266/kiwijuicer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 747, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1471943084, "creation_date": 1471942482, "last_edit_date": 1471943084, "question_id": 39096628, "link": "https://stackoverflow.com/questions/39096628/golang-range-over-chan-map-by-key", "title": "Golang - Range over chan map by key", "body": "<p>I'm trying to range over channels in a map via key. \nThis is the map:</p>\n\n<pre><code>documentChansPerHost := make(map[string](chan Document))\n</code></pre>\n\n<p>This is how I want to range over them:</p>\n\n<pre><code>wg := sync.WaitGroup{}\ndocumentsCountPerHost := make(map[string]int)\n\n// Count documents per host\nfor _,document := range documents {\n    documentsCountPerHost[document.Host]++\n}\n\n// Spawn routines for up to 5 times the number of different\nfor host,documentCount := range documentsCountPerHost {\n\n    println(\"Spawning \" + strconv.Itoa(HOST_CONCURRENCY_LIMIT) + \" Routines for Host \" + host + \" for \" + strconv.Itoa(documentCount) + \" url(s)\")\n\n    for i := 0; i &lt; HOST_CONCURRENCY_LIMIT; i++ {\n\n        go func() {\n\n            for document := range documentChansPerHost[host] {\n\n                fmt.Println(document.Url)\n                wg.Done()\n\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>And that's how I create, add and close (to) the channels</p>\n\n<pre><code>// Instantiate channels for documents per host\nfor host,_ := range documentsCountPerHost {\n    documentChansPerHost[host] = make(chan Document, 20)\n}\n\nfor _, document:= range documents {\n    wg.Add(1)\n    documentChansPerHost[document.Host] &lt;- document\n}\n\nfor _, documentChan := range documentChansPerHost {\n    close(documentChan)\n}\n\nwg.Wait()\n</code></pre>\n\n<p>But for some reason it does not output all document Urls I have passed into the channels and the program never ends. Am I using the channel maps in a wrong way or has that something to do with the concurrency and locks somewhere?</p>\n"}, {"tags": ["json", "go", "unmarshalling", "go-templates", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1471942639, "last_edit_date": 1471942639, "creation_date": 1471942235, "answer_id": 39096533, "question_id": 39096335, "link": "https://stackoverflow.com/questions/39096335/how-to-send-an-array-of-maps-and-iterate-over-it-using-gin-templating/39096533#39096533", "title": "How to send an array of maps and iterate over it using gin-templating", "body": "<h2>With a struct</h2>\n\n<p>What you have is a JSON array, unmarshal it into a Go slice. Recommended to create a <code>Student</code> struct to model your students to have a clean and conscious Go code.</p>\n\n<p>And in the template the <code>{{range}}</code> action sets the dot <code>.</code> to the current element, you can refer to it inside the <code>{{range}}</code> body simply as the dot <code>.</code>, so the student name will be <code>.Name</code>.</p>\n\n<p>Working code (try it on the <a href=\"https://play.golang.org/p/b_oP7d93BV\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>func main() {\n    t := template.Must(template.New(\"\").Parse(templ))\n    var students []Student\n    if err := json.Unmarshal([]byte(jsondata), &amp;students); err != nil {\n        panic(err)\n    }\n    params := map[string]interface{}{\"Students\": students}\n    if err := t.Execute(os.Stdout, params); err != nil {\n        panic(nil)\n    }\n}\n\nconst jsondata = `[\n  {\n    \"id\": 1,\n    \"name\": \"Mary\"\n  },\n  {\n    \"id\": 2,\n    \"name\": \"John\"\n  }\n]`\n\nconst templ = `&lt;TABLE class= \"myTable\" &gt;\n        &lt;tr class=\"headingTr\"&gt;\n            &lt;td&gt;Name&lt;/td&gt;\n        &lt;/tr&gt;\n        {{range .Students}}\n        &lt;td&gt;{{.Name}}&lt;/td&gt;                    \n        {{end}}\n &lt;/TABLE&gt;`\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&lt;TABLE class= \"myTable\" &gt;\n        &lt;tr class=\"headingTr\"&gt;\n            &lt;td&gt;Name&lt;/td&gt;\n        &lt;/tr&gt;\n\n        &lt;td&gt;Mary&lt;/td&gt;                    \n\n        &lt;td&gt;John&lt;/td&gt;                    \n\n &lt;/TABLE&gt;\n</code></pre>\n\n<h2>With a map</h2>\n\n<p>If you don't want to create and use a <code>Student</code> struct, you can still do it with a simple map whose type is <code>map[string]interface{}</code> which can represent any JSON object, but know that in this case you have to refer to students' names as <code>.name</code> as that is how it appears in the JSON text, and so lowercased <code>\"name\"</code> key will be used in the unmarshaled Go map:</p>\n\n<pre><code>func main() {\n    t := template.Must(template.New(\"\").Parse(templ))\n    var students []map[string]interface{}\n    if err := json.Unmarshal([]byte(jsondata), &amp;students); err != nil {\n        panic(err)\n    }\n    params := map[string]interface{}{\"Students\": students}\n    if err := t.Execute(os.Stdout, params); err != nil {\n        panic(nil)\n    }\n}\n\nconst templ = `&lt;TABLE class= \"myTable\" &gt;\n        &lt;tr class=\"headingTr\"&gt;\n            &lt;td&gt;Name&lt;/td&gt;\n        &lt;/tr&gt;\n        {{range .Students}}\n        &lt;td&gt;{{.name}}&lt;/td&gt;                    \n        {{end}}\n &lt;/TABLE&gt;`\n</code></pre>\n\n<p>Output is the same. Try this variant on the <a href=\"https://play.golang.org/p/Z5yChyWI3e\" rel=\"nofollow\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2004, "favorite_count": 0, "accepted_answer_id": 39096533, "answer_count": 1, "score": 2, "last_activity_date": 1471942639, "creation_date": 1471941648, "last_edit_date": 1471942467, "question_id": 39096335, "link": "https://stackoverflow.com/questions/39096335/how-to-send-an-array-of-maps-and-iterate-over-it-using-gin-templating", "title": "How to send an array of maps and iterate over it using gin-templating", "body": "<p>Following is the snippet of a working code. I am using gin templating engine.</p>\n\n<pre><code>c.HTML(200, \"index\", gin.H{\n            \"title\":    \"Welcome\",\n            \"students\": map[int]map[string]string{1: {\"PID\": \"1\", \"Name\": \"myName\"}},})\n</code></pre>\n\n<p>And in index template I have:</p>\n\n<pre><code> &lt;TABLE class= \"myTable\" &gt;\n        &lt;tr class=\"headingTr\"&gt;\n            &lt;td&gt;Name&lt;/td&gt;\n        &lt;/tr&gt;\n        {{range $student := .students}}\n        &lt;td&gt;{{$student.Name}}&lt;/td&gt;                    \n        {{end}}\n &lt;/TABLE&gt;\n</code></pre>\n\n<p>As you can see I have hard-coded the value of <code>students</code> on the headers (the map). I want to have this data from a rest API that I have built. the response of my rest API is an array:</p>\n\n<pre><code> [\n  {\n    \"id\": 1,\n    \"name\": \"Mary\"\n  },\n  {\n    \"id\": 2,\n    \"name\": \"John\"\n  }\n]\n</code></pre>\n\n<p>I can unmarshal this JSON response into <code>map[string]string</code> instead of <code>map[int]map[string]string</code>. How can pass this unmarhsaled body in parameter value for students and then iterate over this array the index template?</p>\n"}, {"tags": ["arrays", "json", "go"], "answers": [{"comments": [{"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "edited": false, "score": 3, "creation_date": 1471940135, "post_id": 39095806, "comment_id": 65538507, "body": "Because it is an unexported field (field starting with a lower case) and thus it can be marshalled."}, {"owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "reply_to_user": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "edited": false, "score": 0, "creation_date": 1471940190, "post_id": 39095806, "comment_id": 65538542, "body": "yes just figured this out.Changing <code>id</code> to <code>Id</code> worked. Thanks!"}], "tags": [], "owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "is_accepted": false, "score": 1, "last_activity_date": 1471940050, "creation_date": 1471940050, "answer_id": 39095806, "question_id": 39095502, "link": "https://stackoverflow.com/questions/39095502/how-to-set-an-array-in-json-response-golang-gin/39095806#39095806", "title": "How to set an array in json response goLang-gin", "body": "<p>ok c.JSON(http.StatusOK, myArray) worked. But I cannot see the Id field in the response. Any reason why? Is it because of 'int64' dataType?</p>\n"}], "owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2583, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1471940050, "creation_date": 1471939172, "question_id": 39095502, "link": "https://stackoverflow.com/questions/39095502/how-to-set-an-array-in-json-response-golang-gin", "title": "How to set an array in json response goLang-gin", "body": "<p>I have an array of stucts stored a variable my array.</p>\n\n<p>Struct is </p>\n\n<pre><code>  type myStruct struct {\n    id          int64   `db:\"id\" json:\"id\"`\n    Name        string  `form:\"name\" db:\"name\" json:\"name\" binding:\"required\"`\n    Status     string     `form:\"status\"  db:\"status\" json:\"status\" binding:\"required\"`\n</code></pre>\n\n<p>My array looks like this and is stored in a variable 'myArray'. This array is formed by iterating over a set of rows coming from database.</p>\n\n<pre><code>[{1 abc default} {2 xyz default}]\n</code></pre>\n\n<p>I am using gin as http server. How do I set this array into JSON reponse using c.JSON. Something like</p>\n\n<pre><code>[\n   {\n      id: 1,\n      name : 'abc' \n      status: 'default'\n   },\n   {\n      id: 2,\n      name : 'xyz' \n      status: 'default'\n   }\n]\n</code></pre>\n"}, {"tags": ["go", "interface", "generic-programming"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1471938822, "post_id": 39095299, "comment_id": 65537725, "body": "Make <code>adoptCat</code> accept a <code>Pet</code> instead of a <code>Cat</code>. In general: Forget about inheritance and classical OOP and redesign. IMHO pets, cats and dogs make bad examples."}], "answers": [{"comments": [{"owner": {"reputation": 1485, "user_id": 2407681, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/lyshf.jpg?s=128&g=1", "display_name": "lfree", "link": "https://stackoverflow.com/users/2407681/lfree"}, "edited": false, "score": 0, "creation_date": 1471939720, "post_id": 39095399, "comment_id": 65538260, "body": "Conversion from pet to Dog is an easy thing to do. If for example, the equivalent is unmarshalling of a bytes slice to a ProtoBuffer message, I also have to do it in every OnXxxMessage-like functions?"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 1485, "user_id": 2407681, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/lyshf.jpg?s=128&g=1", "display_name": "lfree", "link": "https://stackoverflow.com/users/2407681/lfree"}, "edited": false, "score": 0, "creation_date": 1471942564, "post_id": 39095399, "comment_id": 65540063, "body": "Unmarshaling is not exactly type conversion since protobuf message is simply a sequence of bytes. Unmarshal function reads this sequence and populates another data structure with it. Interfaces are used to define an expected behavior. If a type implements an interface, then it has the behavior of that interface. So that means if multiple concrete types can exhibit same behavior (though they may implement it differently), you should use interfaces to hold the types, calling their methods as required."}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 1485, "user_id": 2407681, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/lyshf.jpg?s=128&g=1", "display_name": "lfree", "link": "https://stackoverflow.com/users/2407681/lfree"}, "edited": false, "score": 0, "creation_date": 1471942568, "post_id": 39095399, "comment_id": 65540066, "body": "In your specific example, <code>OnXxxMessage</code> function would take the message and pass it on to each pet listening for messages. That means each <code>OnXxxMessage</code> can work directly with <code>Pet</code> interface as long as you supply the interface with something like a <code>ProcessMessage()</code> method."}, {"owner": {"reputation": 1485, "user_id": 2407681, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/lyshf.jpg?s=128&g=1", "display_name": "lfree", "link": "https://stackoverflow.com/users/2407681/lfree"}, "edited": false, "score": 0, "creation_date": 1471943349, "post_id": 39095399, "comment_id": 65540580, "body": "What if each <code>OnXxxMessage</code> needs its specific information?"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 1485, "user_id": 2407681, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/lyshf.jpg?s=128&g=1", "display_name": "lfree", "link": "https://stackoverflow.com/users/2407681/lfree"}, "edited": false, "score": 0, "creation_date": 1471944139, "post_id": 39095399, "comment_id": 65541144, "body": "Can you update your question to explain exactly what you require?"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 2, "last_activity_date": 1471938806, "creation_date": 1471938806, "answer_id": 39095399, "question_id": 39095299, "link": "https://stackoverflow.com/questions/39095299/is-there-a-way-to-generically-represent-a-group-of-similar-functions/39095399#39095399", "title": "Is there a way to generically represent a group of similar functions?", "body": "<p>To use the map as a function collection you'll have to change the signature of your functions to match. <code>func(Pet)</code> is not the same type as <code>func(Dog)</code>.</p>\n\n<p>You can re-write <code>AdoptXXX</code> functions to take in <code>Pet</code> and do a type select to ensure correct pet is being input:</p>\n\n<pre><code>func adoptDog(pet Pet) {\n    if _, ok := pet.(Dog); !ok {\n        // process incorrect pet type\n    }\n    fmt.Println(\"You live in my house from now on!\")\n}\n</code></pre>\n"}], "owner": {"reputation": 1485, "user_id": 2407681, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/lyshf.jpg?s=128&g=1", "display_name": "lfree", "link": "https://stackoverflow.com/users/2407681/lfree"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 27, "favorite_count": 0, "accepted_answer_id": 39095399, "answer_count": 1, "score": 0, "last_activity_date": 1471938806, "creation_date": 1471938477, "question_id": 39095299, "link": "https://stackoverflow.com/questions/39095299/is-there-a-way-to-generically-represent-a-group-of-similar-functions", "title": "Is there a way to generically represent a group of similar functions?", "body": "<pre><code>package main\n\nimport \"fmt\"\n\ntype Pet interface {\n    Bark()\n}\n\ntype Dog int\n\nfunc (d Dog) Bark() {\n    fmt.Println(\"W! W! W!\")\n}\n\ntype Cat int\n\nfunc (c Cat) Bark() {\n    fmt.Println(\"M! M! M!\")\n}\n\ntype AdoptFunc func(pet Pet)\n\nfunc adoptDog(dog Dog) {\n    fmt.Println(\"You live in my house from now on!\")\n}\nfunc adoptCat(cat Cat) {\n    fmt.Println(\"You live in my house from now on!\")\n}\n\nfunc main() {\n    var adoptFuncs map[string]AdoptFunc\n    adoptFuncs[\"dog\"] = adoptDog // cannot use adoptDog (type func(Dog)) as type AdoptFunc in assignment\n    adoptFuncs[\"cat\"] = adoptCat // the same as above\n}\n</code></pre>\n\n<p>As the code above, is there a way to use a map or array to collect a bunch of similar functions adoptXxx? If not, what is right pattern to use for this situation?</p>\n"}, {"tags": ["mongodb", "file", "go", "gridfs"], "comments": [{"owner": {"reputation": 1894, "user_id": 2269979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff22a1e835980e29baccf08a62e7ff71?s=128&d=identicon&r=PG", "display_name": "molivier", "link": "https://stackoverflow.com/users/2269979/molivier"}, "edited": false, "score": 0, "creation_date": 1471937778, "post_id": 39094709, "comment_id": 65537075, "body": "What did you try? Are you talking about Mongodb instead of mangoDB?"}, {"owner": {"reputation": 904, "user_id": 6080206, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e004f9854173d82f6fd3c70d38ba3a77?s=128&d=identicon&r=PG&f=1", "display_name": "John Zeng", "link": "https://stackoverflow.com/users/6080206/john-zeng"}, "edited": false, "score": 0, "creation_date": 1471946006, "post_id": 39094709, "comment_id": 65542540, "body": "I am not getting your question? Is it you can&#39;t read file from mongodb or you can&#39;t send the file to the front-end?"}, {"owner": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "edited": false, "score": 0, "creation_date": 1472009373, "post_id": 39094709, "comment_id": 65574828, "body": "sorry for the confusion.I can able to download the file from mangodb without the browser.I dont know how to send to the browser and download it from there if user clicks it, in golang.I m using Beegoapi as the framework for developing the golang and use json to pass values to the front end.Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1472259224, "creation_date": 1472259224, "answer_id": 39176468, "question_id": 39094709, "link": "https://stackoverflow.com/questions/39094709/download-file-from-mongodb-using-griddfs-in-golang/39176468#39176468", "title": "Download file from Mongodb using griddfs in golang", "body": "<p>I have found how to do it.\nAll we have do is read from the GridFS and write it in the response writer and set the content disposition to attachment or inline and set the content type and length.\nThanks for the effort of others...</p>\n"}], "owner": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 222, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1472259224, "creation_date": 1471936707, "last_edit_date": 1471944552, "question_id": 39094709, "link": "https://stackoverflow.com/questions/39094709/download-file-from-mongodb-using-griddfs-in-golang", "title": "Download file from Mongodb using griddfs in golang", "body": "<p>I have already uploaded my files using gridfs in go lang. But having problems in downloading it...I dont know how to read the file in the MongoDB and show it in browser and once the user clicks it i want to download it to the users computer Please help me..Thanks</p>\n"}, {"tags": ["go", "struct", "interface"], "comments": [{"owner": {"reputation": 106150, "user_id": 213464, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a7ba62044bc19143ea4a38cf490b67f2?s=128&d=identicon&r=PG", "display_name": "YOU", "link": "https://stackoverflow.com/users/213464/you"}, "edited": false, "score": 0, "creation_date": 1471931172, "post_id": 39092925, "comment_id": 65533582, "body": "how will you unmarshall unknown structure JSON? or how will fmt.Printf work if it is not there?"}, {"owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "reply_to_user": {"reputation": 106150, "user_id": 213464, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a7ba62044bc19143ea4a38cf490b67f2?s=128&d=identicon&r=PG", "display_name": "YOU", "link": "https://stackoverflow.com/users/213464/you"}, "edited": false, "score": 0, "creation_date": 1471932595, "post_id": 39092925, "comment_id": 65534165, "body": "well it shoudnt work if its not there i guess what do you mean how its gonna work ? it is exported from fmt"}, {"owner": {"reputation": 1894, "user_id": 2269979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff22a1e835980e29baccf08a62e7ff71?s=128&d=identicon&r=PG", "display_name": "molivier", "link": "https://stackoverflow.com/users/2269979/molivier"}, "edited": false, "score": 0, "creation_date": 1471937911, "post_id": 39092925, "comment_id": 65537155, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/23148812/go-whats-the-meaning-of-interface\">Go: What&#39;s the meaning of interface{}?</a>"}, {"owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "reply_to_user": {"reputation": 1894, "user_id": 2269979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff22a1e835980e29baccf08a62e7ff71?s=128&d=identicon&r=PG", "display_name": "molivier", "link": "https://stackoverflow.com/users/2269979/molivier"}, "edited": false, "score": 0, "creation_date": 1471938230, "post_id": 39092925, "comment_id": 65537371, "body": "@molivier this is not about what structs are this is about what they are used for they seems just entirely useless"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1471948831, "post_id": 39092925, "comment_id": 65544373, "body": "Look at all the instances of io.Reader and io.Writer in the standard library for a good example."}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 1, "creation_date": 1594374984, "post_id": 39092925, "comment_id": 111110211, "body": "Why are interfaces needed? Decouple code. See <a href=\"https://stackoverflow.com/a/62297796/12817546\">stackoverflow.com/a/62297796/12817546</a>. Call a method \u201cdynamically\u201d. See <a href=\"https://stackoverflow.com/a/62336440/12817546\">stackoverflow.com/a/62336440/12817546</a>. Access a Go package. See <a href=\"https://stackoverflow.com/a/62278078/12817546\">stackoverflow.com/a/62278078/12817546</a>. Assign any value to a variable. See <a href=\"https://stackoverflow.com/a/62337836/12817546\">stackoverflow.com/a/62337836/12817546</a>."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1471948982, "post_id": 39098935, "comment_id": 65544471, "body": "@nikoss I hope this helps."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 2, "last_activity_date": 1473693812, "last_edit_date": 1495540945, "creation_date": 1471948880, "answer_id": 39098935, "question_id": 39092925, "link": "https://stackoverflow.com/questions/39092925/why-are-interfaces-needed-in-golang/39098935#39098935", "title": "Why are interfaces needed in Golang?", "body": "<p>I will show here, two interesting use cases of interfaces in Go:  </p>\n\n<p>1- See these two simple interfaces:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Reader interface {\n    Read(p []byte) (n int, err error)\n}\n\ntype Writer interface {\n    Write(p []byte) (n int, err error)\n}\n</code></pre>\n\n<p>Using these two simple interfaces you may do this interesting magic:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"strings\"\n)\n\nfunc main() {\n    file, err := os.Create(\"log.txt\")\n    if err != nil {\n        panic(err)\n    }\n    defer file.Close()\n\n    w := io.MultiWriter(file, os.Stdout)\n    r := strings.NewReader(\"You'll see this string twice!!\\n\")\n    io.Copy(w, r)\n\n    slice := []byte{33, 34, 35, 36, 37, 38, 39, 10, 13}\n    io.Copy(w, bytes.NewReader(slice)) // !\"#$%&amp;'\n\n    buf := &amp;bytes.Buffer{}\n    io.Copy(buf, bytes.NewReader(slice))\n    fmt.Println(buf.Bytes()) // [33 34 35 36 37 38 39 10 13]\n\n    _, err = file.Seek(0, 0)\n    if err != nil {\n        panic(err)\n    }\n\n    r = strings.NewReader(\"Hello\\nWorld\\nThis\\nis\\nVery\\nnice\\nInterfacing.\\n\")\n    rdr := io.MultiReader(r, file)\n    scanner := bufio.NewScanner(rdr)\n    for scanner.Scan() {\n        fmt.Println(scanner.Text())\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>You'll see this string twice!!\n!\"#$%&amp;'\n\n[33 34 35 36 37 38 39 10 13]\nHello\nWorld\nThis\nis\nVery\nnice\nInterfacing.\nYou'll see this string twice!!\n!\"#$%&amp;'\n</code></pre>\n\n<p>I hope this code is clear enough:<br>\nreads from string using <code>strings.NewReader</code> and writes concurrently to both <code>file</code> and <code>os.Stdout</code> using <code>io.MultiWriter</code> with just <code>io.Copy(w, r)</code>. Then reads from slice using <code>bytes.NewReader(slice)</code> and writes concurrently to both <code>file</code> and <code>os.Stdout</code>. Then copy slice to the buffer <code>io.Copy(buf, bytes.NewReader(slice))</code> then goto the file origin using <code>file.Seek(0, 0)</code> then first read from string using <code>strings.NewReader</code> then continue reading that <code>file</code> using <code>io.MultiReader(r, file)</code> and <code>bufio.NewScanner</code> and Print all of then using <code>fmt.Println(scanner.Text())</code>.</p>\n\n<hr>\n\n<p>2- And this is another interesting use of interface:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    i := show()\n    fmt.Println(i) // 0\n\n    i = show(1, 2, \"AB\", 'c', 'd', []int{1, 2, 3}, [...]int{1, 2})\n    fmt.Println(i) // 7\n\n}\nfunc show(a ...interface{}) (count int) {\n    for _, b := range a {\n        if v, ok := b.(int); ok {\n            fmt.Println(\"int: \", v)\n        }\n    }\n    return len(a)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>0\nint:  1\nint:  2\n7\n</code></pre>\n\n<hr>\n\n<p>And nice example to see: <a href=\"https://stackoverflow.com/questions/38816843/explain-type-assertions-in-go/38818437#38818437\">Explain Type Assertions in Go</a></p>\n\n<p>Also see: <a href=\"https://stackoverflow.com/questions/23148812/go-whats-the-meaning-of-interface\">Go: What&#39;s the meaning of interface{}?</a></p>\n"}, {"comments": [{"owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "edited": false, "score": 1, "creation_date": 1471952290, "post_id": 39100038, "comment_id": 65546736, "body": "i still cant understand why not just to embed animal into horse or cat or dog still this makes no sense"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "edited": false, "score": 0, "creation_date": 1471952465, "post_id": 39100038, "comment_id": 65546879, "body": "@nikoss Not sure I understand what you mean, please show how would you add them into a slice and iterate over and call <code>Say()</code> on each, for example."}, {"owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "edited": false, "score": 0, "creation_date": 1471952826, "post_id": 39100038, "comment_id": 65547123, "body": "ah thats the point combining different type of structs now i got it though still its kinda complicated cant get it clear in my mind"}, {"owner": {"reputation": 3690, "user_id": 3960852, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/FhcvT.png?s=128&g=1", "display_name": "Kenny Worden", "link": "https://stackoverflow.com/users/3960852/kenny-worden"}, "edited": false, "score": 2, "creation_date": 1498599392, "post_id": 39100038, "comment_id": 76561498, "body": "Aha! Golang is very nuanced and your answer cleared this topic up for me."}, {"owner": {"reputation": 884, "user_id": 6651080, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-EY45JeKlPi8/AAAAAAAAAAI/AAAAAAAAG8I/5bwaHIx2IoQ/photo.jpg?sz=128", "display_name": "Dzintars", "link": "https://stackoverflow.com/users/6651080/dzintars"}, "edited": false, "score": 2, "creation_date": 1535105071, "post_id": 39100038, "comment_id": 90953219, "body": "Exactly the same there. Kinda understand what interfaces are but at the same time don&#39;t understand the usage in scope of real examples. Cat talks and dog woofs examples do not make sense. I am trying to reflect this on some real world - Customers, Sales Orders, Pickup Orders Other Orders context and have no idea do i need to use Interfaces there."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 884, "user_id": 6651080, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-EY45JeKlPi8/AAAAAAAAAAI/AAAAAAAAG8I/5bwaHIx2IoQ/photo.jpg?sz=128", "display_name": "Dzintars", "link": "https://stackoverflow.com/users/6651080/dzintars"}, "edited": false, "score": 10, "creation_date": 1535119941, "post_id": 39100038, "comment_id": 90962482, "body": "@Dzintars My advice is that if you don&#39;t see the benefit of using interfaces in your code, then don&#39;t create / use interface just yet. When you start repeating code to handle multiple concrete types, then you will see the benefit / gain of using interfaces, you can add them later too."}, {"owner": {"reputation": 167, "user_id": 11037531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b796a1145e2bbd2060b211510d4a97e?s=128&d=identicon&r=PG&f=1", "display_name": "yosimitsu kodanuri", "link": "https://stackoverflow.com/users/11037531/yosimitsu-kodanuri"}, "edited": false, "score": 0, "creation_date": 1590261062, "post_id": 39100038, "comment_id": 109617088, "body": "i think this is a great answer"}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1594376532, "post_id": 39100038, "comment_id": 111110970, "body": "@icza First-rate comment about when to use or not use an interface. I upvoted your answer and quoted your comment. See <a href=\"https://stackoverflow.com/a/62297796/12817546\">stackoverflow.com/a/62297796/12817546</a>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 106, "last_activity_date": 1572608579, "last_edit_date": 1572608579, "creation_date": 1471951997, "answer_id": 39100038, "question_id": 39092925, "link": "https://stackoverflow.com/questions/39092925/why-are-interfaces-needed-in-golang/39100038#39100038", "title": "Why are interfaces needed in Golang?", "body": "<p>Interfaces are too big of a topic to give an all-depth answer here, but some things to make their use clear.</p>\n\n<p>Interfaces are a <em>tool</em>. Whether you use them or not is up to you, but they can make code clearer, shorter, more readable, and they can provide a nice API between packages, or clients (users) and servers (providers).</p>\n\n<p>Yes, you can create your own <code>struct</code> type, and you can \"attach\" methods to it, for example:</p>\n\n<pre><code>type Cat struct{}\n\nfunc (c Cat) Say() string { return \"meow\" }\n\ntype Dog struct{}\n\nfunc (d Dog) Say() string { return \"woof\" }\n\nfunc main() {\n    c := Cat{}\n    fmt.Println(\"Cat says:\", c.Say())\n    d := Dog{}\n    fmt.Println(\"Dog says:\", d.Say())\n}\n</code></pre>\n\n<p>We can already see some repetition in the code above: when making both <code>Cat</code> and <code>Dog</code> say something. Can we handle both as the same kind of entity, as <em>animal</em>? Not really. Sure we could handle both as <code>interface{}</code>, but if we do so, we can't call their <code>Say()</code> method because a value of type <code>interface{}</code> does not define any methods.</p>\n\n<p>There is some <em>similarity</em> in both of the above types: both have a method <code>Say()</code> with the same signature (parameters and result types). We can <em>capture</em> this with an interface:</p>\n\n<pre><code>type Sayer interface {\n    Say() string\n}\n</code></pre>\n\n<p>The interface contains only the <em>signatures</em> of the methods, but not their <em>implementation</em>.</p>\n\n<p>Note that in Go a type <em>implicitly</em> implements an interface if its method set is a superset of the interface. There is no declaration of the intent. What does this mean? Our previous <code>Cat</code> and <code>Dog</code> types already implement this <code>Sayer</code> interface even though this interface definition didn't even exist when we wrote them earlier, and we didn't touch them to mark them or something. They just do.</p>\n\n<p><em>Interfaces specify behavior</em>. A type that implements an interface means that type has all the methods the interface \"prescribes\".</p>\n\n<p>Since both implement <code>Sayer</code>, we can handle both as a value of <code>Sayer</code>, they have this in common. See how we can handle both in unity:</p>\n\n<pre><code>animals := []Sayer{c, d}\nfor _, a := range animals {\n    fmt.Println(reflect.TypeOf(a).Name(), \"says:\", a.Say())\n}\n</code></pre>\n\n<p><sup>(That reflect part is only to get the type name, don't make much of it as of now.)</sup></p>\n\n<p>The important part is that we could handle both <code>Cat</code> and <code>Dog</code> as the same kind (an interface type), and work with them / use them. If you were  quickly on to create additional types with a <code>Say()</code> method, they could line up beside <code>Cat</code> and <code>Dog</code>:</p>\n\n<pre><code>type Horse struct{}\n\nfunc (h Horse) Say() string { return \"neigh\" }\n\nanimals = append(animals, Horse{})\nfor _, a := range animals {\n    fmt.Println(reflect.TypeOf(a).Name(), \"says:\", a.Say())\n}\n</code></pre>\n\n<p>Let's say you want to write other code that works with these types. A helper function:</p>\n\n<pre><code>func MakeCatTalk(c Cat) {\n    fmt.Println(\"Cat says:\", c.Say())\n}\n</code></pre>\n\n<p>Yes, the above function works with <code>Cat</code> and with nothing else. If you'd want something similar, you'd have to write it for each type. Needless to say how bad this is.</p>\n\n<p>Yes, you could write it to take an argument of <code>interface{}</code>, and use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"noreferrer\">type assertion</a> or <a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"noreferrer\">type switches</a>, which would reduce the number of helper functions, but still looks really ugly.</p>\n\n<p>The solution? Yes, interfaces. Simply declare the function to take a value of an interface type which defines the behavior you want to do with it, and that's all:</p>\n\n<pre><code>func MakeTalk(s Sayer) {\n    fmt.Println(reflect.TypeOf(s).Name(), \"says:\", s.Say())\n}\n</code></pre>\n\n<p>You can call this function with a value of <code>Cat</code>, <code>Dog</code>, <code>Horse</code> or any other type not known until now, that has a <code>Say()</code> method. Cool.</p>\n\n<p>Try these examples on the <a href=\"https://play.golang.org/p/LSdHSuqUqo\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 2862, "user_id": 47593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/509563686bf786a660836b8b89632a32?s=128&d=identicon&r=PG", "display_name": "Evan Moran", "link": "https://stackoverflow.com/users/47593/evan-moran"}, "edited": false, "score": 2, "creation_date": 1545105107, "post_id": 39100502, "comment_id": 94500968, "body": "Great example. In addition \u2013 and this is different from C++/Java \u2013 with Go interfaces you don&#39;t need to create a <code>func callRead(r Reader)</code> either. This is quite powerful!"}], "tags": [], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "is_accepted": false, "score": 12, "last_activity_date": 1471953348, "creation_date": 1471953348, "answer_id": 39100502, "question_id": 39092925, "link": "https://stackoverflow.com/questions/39092925/why-are-interfaces-needed-in-golang/39100502#39100502", "title": "Why are interfaces needed in Golang?", "body": "<p>interface provide some kinds of generics. Think about duck typing. </p>\n\n<pre><code>type Reader interface{\n     Read()\n}\n\nfunc callRead(r Reader){\n      r.Read()\n}\n\ntype A struct{\n}\nfunc(_ A)Read(){\n}\n\ntype B struct{\n}\nfunc(_ B)Read(){\n}\n</code></pre>\n\n<p>It's ok to pass struct <code>A</code>, and <code>B</code> to <code>callRead</code>, because both implement Reader interface.\nBut if without interface, we should write two function for <code>A</code> and <code>B</code>. </p>\n\n<pre><code>func callRead(a A){\n     a.Read()\n}\n\nfunc callRead2(b B){\n     b.Read()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 6056991, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BDDRXsAOpYY/AAAAAAAAAAI/AAAAAAAAAU8/E0k7yb1fX4c/photo.jpg?sz=128", "display_name": "go je jo", "link": "https://stackoverflow.com/users/6056991/go-je-jo"}, "is_accepted": false, "score": 1, "last_activity_date": 1556729338, "last_edit_date": 1556729338, "creation_date": 1556727751, "answer_id": 55939335, "question_id": 39092925, "link": "https://stackoverflow.com/questions/39092925/why-are-interfaces-needed-in-golang/55939335#55939335", "title": "Why are interfaces needed in Golang?", "body": "<ol>\n<li><p>if you need a method\\s to be implemented regardless of the struct.</p>\n\n<p>you might have a handler method to access your local structs and use the handler before knowing the struct.</p></li>\n<li><p>if you need a behavior unique to other or current struct.</p>\n\n<p>you might want your interface be viewed with few methods because users might never use them.\nyou might want your structs to be divided by its use cases.</p></li>\n<li><p>if you need a type that implements anything.</p>\n\n<p>you might know or not the type but at least you have the value.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 12307693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2fa39e44f30267f82fad7abe4963ca1?s=128&d=identicon&r=PG", "display_name": "Andy Joiner", "link": "https://stackoverflow.com/users/12307693/andy-joiner"}, "is_accepted": false, "score": 7, "last_activity_date": 1572605816, "creation_date": 1572605816, "answer_id": 58658034, "question_id": 39092925, "link": "https://stackoverflow.com/questions/39092925/why-are-interfaces-needed-in-golang/58658034#58658034", "title": "Why are interfaces needed in Golang?", "body": "<p>As has already been stated, interfaces are a tool.  Not all packages will benefit from them, but for certain programming tasks interfaces can be an extremely useful for abstraction and creating package APIs, and particularly for library code or code which may be implemented in more than one way.</p>\n\n<p>Take for example a package which is responsible for drawing some primitive graphics to a screen.  We can think of the absolute basic essential requirements of a screen as being able to draw a pixel, clear the screen, refresh the screen contents periodically, as well as get some basic geometric information about the screen such its current dimensions.  Hence a 'Screen' interface might look like this;</p>\n\n<pre><code>type Screen interface {\n    Dimensions() (w uint32, h uint32)\n    Origin() (x uint32, y uint32)\n    Clear()\n    Refresh()\n    Draw(color Color, point Point)\n}\n</code></pre>\n\n<p>Now our program might have several different \"graphics drivers\" which could be used by our graphics package to fulfill this basic requirement of a Screen.  You might be using some native operating system driver, maybe the SDL2 package and maybe something else.  And maybe in your program you need to support multiple options for drawing graphics because its dependent upon the OS environment and so on.</p>\n\n<p>So you might then define three structs, each containing the required resources to the underlying screen drawing routines in the operating system / libraries etc;</p>\n\n<pre><code>type SDLDriver struct {\n    window *sdl.Window\n    renderer *sdl.Renderer\n}\n\ntype NativeDriver struct {\n    someDataField *Whatever\n}\n\ntype AnotherDriver struct {\n    someDataField *Whatever\n}\n</code></pre>\n\n<p>And then you implement in your code the method interface for all three of these structs so that any of these three structs can satisfy the requirements of the Screen interface</p>\n\n<pre><code>func (s SDLDriver) Dimensions() (w uint32, h uint32) {\n    // implement Dimensions()\n}\n\nfunc (s SDLDriver) Origin() (x uint32, y uint32) {\n    // implement Origin()\n}\n\nfunc (s SDLDriver) Clear() {\n    // implement Clear()\n}\n\nfunc (s SDLDriver) Refresh() {\n    // implement Refresh()\n}\n\nfunc (s SDLDriver) Draw(color Color, point Point) {\n    // implement Draw()\n}\n\n...\n\nfunc (s NativeDriver) Dimensions() (w uint32, h uint32) {\n    // implement Dimensions()\n}\n\nfunc (s NativeDriver) Origin() (x uint32, y uint32) {\n    // implement Origin()\n}\n\nfunc (s NativeDriver) Clear() {\n    // implement Clear()\n}\n\nfunc (s NativeDriver) Refresh() {\n    // implement Refresh()\n}\n\nfunc (s NativeDriver) Draw(color Color, point Point) {\n    // implement Draw()\n}\n\n... and so on\n</code></pre>\n\n<p>Now, your outside program really shouldn't <em>care</em> WHICH of these drivers you might be using, just so long as it can clear, draw and refresh the screen through a standard interface.  This is abstraction.  You provide at the package level the absolute minimum that is required for the rest of your program to work.  Only code inside graphics needs to know all of the \"nitty gritty\" of HOW the operations work.</p>\n\n<p>So you might know which screen driver you need to create for the given environment, maybe this is decided at the start of execution based on checking what's available on the users system.  You decide that SDL2 is the best option and you create a new SDLGraphics instance;</p>\n\n<pre><code>sdlGraphics, err := graphics.CreateSDLGraphics(0, 0, 800, 600)\n</code></pre>\n\n<p>But you can now create a type variable of Screen from this;</p>\n\n<pre><code>var screen graphics.Screen = sdlGraphics\n</code></pre>\n\n<p>And now you have a generic 'Screen' type called 'screen' which implements (assuming you programmed them) the Clear(), Draw(), Refresh(), Origin() and Dimensions() methods.  From this point on in your code you can, in total confidence, issue statements such as</p>\n\n<pre><code>screen.Clear()\nscreen.Refresh()\n</code></pre>\n\n<p>And so on...  The beauty of this is that you have a standard type called 'Screen' which the rest of your program, which really doesn't care about the inner workings of a graphics library, can use without having to think about it.  You can pass around 'Screen' to any function etc in confidence that it will just work.</p>\n\n<p>Interfaces are super useful and they really help you think about the function of your code rather than the data in your structs.  And small interfaces are better!</p>\n\n<p>For example instead of having a whole bunch of rendering operations inside the Screen interface, maybe you'll design a second interface like this;</p>\n\n<pre><code>type Renderer interface {\n    Fill(rect Rect, color Color)\n    DrawLine(x float64, y float64, color Color)\n    ... and so on\n}\n</code></pre>\n\n<p>It definitely takes some getting used to, depending on your programming experience and which languages you've used before.  If you've been a strict python programmer up until now you'll find Go quite different, but if you've been using Java/C++ then you'll figure out Go pretty quickly.  Interfaces give you object-oriented-ness without the annoyance that exists in other languages (e.g. Java).</p>\n"}, {"comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 1, "creation_date": 1600589797, "post_id": 63552596, "comment_id": 113130850, "body": "Wow this is such a spot on answer +1. <a href=\"https://play.golang.org/p/o01JrMyPCh5\" rel=\"nofollow noreferrer\">play.golang.org/p/o01JrMyPCh5</a> with the <code>interface</code>."}], "tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 1, "last_activity_date": 1598221374, "creation_date": 1598221374, "answer_id": 63552596, "question_id": 39092925, "link": "https://stackoverflow.com/questions/39092925/why-are-interfaces-needed-in-golang/63552596#63552596", "title": "Why are interfaces needed in Golang?", "body": "<p>Where I could see <code>interface</code> being useful is with implementing private <code>struct</code>\nfields. For example if you have this code:</p>\n<pre><code>package main\ntype Halloween struct {\n   Day, Month string\n}\nfunc NewHalloween() Halloween {\n   return Halloween { Month: &quot;October&quot;, Day: &quot;31&quot; }\n}\nfunc (o Halloween) UK(Year string) string {\n   return o.Day + &quot; &quot; + o.Month + &quot; &quot; + Year\n}\nfunc (o Halloween) US(Year string) string {\n   return o.Month + &quot; &quot; + o.Day + &quot; &quot; + Year\n}\nfunc main() {\n   o := NewHalloween()\n   s_uk := o.UK(&quot;2020&quot;)\n   s_us := o.US(&quot;2020&quot;)\n   println(s_uk, s_us)\n}\n</code></pre>\n<p>Then <code>o</code> has access to all the <code>struct</code> fields. You may not want that. In that\ncase you can use something like this:</p>\n<pre><code>type Country interface {\n   UK(string) string\n   US(string) string\n}\nfunc NewHalloween() Country {\n   o := Halloween { Month: &quot;October&quot;, Day: &quot;31&quot; }\n   return Country(o)\n}\n</code></pre>\n<p>The only change we made was adding the <code>interface</code>, then returning the <code>struct</code>\nwrapped in the <code>interface</code>. In this case only the methods will have access to\nthe <code>struct</code> fields.</p>\n"}], "owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17339, "favorite_count": 24, "accepted_answer_id": 39100038, "answer_count": 6, "score": 45, "last_activity_date": 1598221374, "creation_date": 1471929624, "last_edit_date": 1471953819, "question_id": 39092925, "link": "https://stackoverflow.com/questions/39092925/why-are-interfaces-needed-in-golang", "title": "Why are interfaces needed in Golang?", "body": "<p>In Golang, we use structs with receiver methods. everything is perfect up to here.<br>\nI'm not sure what interfaces are, however. We define methods in structs and if we want to implement a method on a struct, we write it anyway again under another struct.<br>\nThis means that interfaces seem to be just method definitions, taking just extra unneeded space on our page.</p>\n\n<p>Is there any example explaining why I need an interface?</p>\n"}, {"tags": ["go", "hugo"], "answers": [{"tags": [], "owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "is_accepted": true, "score": 5, "last_activity_date": 1471929060, "creation_date": 1471929060, "answer_id": 39092834, "question_id": 39092625, "link": "https://stackoverflow.com/questions/39092625/how-to-combine-where-and-first-in-go-range/39092834#39092834", "title": "How to combine where and first in go range", "body": "<p>Here's an example from the <a href=\"https://www.gohugo.io/templates/functions/\" rel=\"noreferrer\">Hugo Template Functions documentation</a> that I think means you're just missing parentheses:</p>\n\n<pre><code>{{ range first 5 (where .Data.Pages \"Section\" \"post\") }}\n   {{ .Content }}\n{{ end }}\n</code></pre>\n"}], "owner": {"reputation": 498, "user_id": 3969934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7d1904880b54c69a1188076c4dd4de1?s=128&d=identicon&r=PG", "display_name": "Vijay", "link": "https://stackoverflow.com/users/3969934/vijay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 976, "favorite_count": 0, "accepted_answer_id": 39092834, "answer_count": 1, "score": 1, "last_activity_date": 1471929060, "creation_date": 1471928111, "question_id": 39092625, "link": "https://stackoverflow.com/questions/39092625/how-to-combine-where-and-first-in-go-range", "title": "How to combine where and first in go range", "body": "<p>I am new to Go and Hugo site generator and currently creating a simple theme. I am trying to combine a <code>where</code> filter along with <code>first</code> function and I am not able to make it work.</p>\n\n<p>What I want is to get first 10 items in the <code>post</code> section</p>\n\n<pre><code>{{ range where .Data.Pages \"Section\" \"post\" }}\n    &lt;li&gt;&lt;a href=\"{{.RelPermalink}}\"&gt;{{.Title}}&lt;/a&gt; &lt;em&gt;{{.Summary}}&lt;/em&gt;&lt;/li&gt;\n{{ end }}\n</code></pre>\n\n<p>The above works fine, but how do I make it return only the first 10 items (the below does not work):</p>\n\n<pre><code>{{ range first 10 where .Data.Pages \"Section\" \"post\" }}\n    &lt;li&gt;&lt;a href=\"{{.RelPermalink}}\"&gt;{{.Title}}&lt;/a&gt; &lt;em&gt;{{.Summary}}&lt;/em&gt;&lt;/li&gt;\n{{ end }}\n</code></pre>\n"}, {"tags": ["vim", "go"], "comments": [{"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 2, "creation_date": 1471923684, "post_id": 39091918, "comment_id": 65531430, "body": "Check <code>:verbose set list?</code> to check whether <code>list</code> option is set, and where. <code>:help list</code>, <code>:help listchars</code>."}], "answers": [{"comments": [{"owner": {"reputation": 156267, "user_id": 546861, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SIhsx.png?s=128&g=1", "display_name": "romainl", "link": "https://stackoverflow.com/users/546861/romainl"}, "edited": false, "score": 3, "creation_date": 1471932131, "post_id": 39092052, "comment_id": 65533975, "body": "Why did you put that there if you don&#39;t know what it does and don&#39;t want its effect?"}, {"owner": {"reputation": 1215, "user_id": 2824935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/dkDTX.jpg?s=128&g=1", "display_name": "garythegoat", "link": "https://stackoverflow.com/users/2824935/garythegoat"}, "reply_to_user": {"reputation": 156267, "user_id": 546861, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SIhsx.png?s=128&g=1", "display_name": "romainl", "link": "https://stackoverflow.com/users/546861/romainl"}, "edited": false, "score": 0, "creation_date": 1472005066, "post_id": 39092052, "comment_id": 65573949, "body": "I&#39;m using a custom Vim config that came on my machine"}], "tags": [], "owner": {"reputation": 1215, "user_id": 2824935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/dkDTX.jpg?s=128&g=1", "display_name": "garythegoat", "link": "https://stackoverflow.com/users/2824935/garythegoat"}, "is_accepted": true, "score": 1, "last_activity_date": 1471924251, "creation_date": 1471924251, "answer_id": 39092052, "question_id": 39091918, "link": "https://stackoverflow.com/questions/39091918/hiding-tab-characters-in-vim/39092052#39092052", "title": "Hiding tab characters in Vim", "body": "<p>Following Amadan's suggestion, I edited the file that <code>:verbose set list?</code> returned, which for me is <code>~/.vim/init/options.vim</code>. Removing <code>set list</code> solved the problem for me</p>\n"}, {"tags": [], "owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "is_accepted": false, "score": 0, "last_activity_date": 1471966222, "creation_date": 1471966222, "answer_id": 39105258, "question_id": 39091918, "link": "https://stackoverflow.com/questions/39091918/hiding-tab-characters-in-vim/39105258#39105258", "title": "Hiding tab characters in Vim", "body": "<p>Just remove this line in your configuration file:\n<code>:set listchars=tab:\\(whatever chracter)\\</code></p>\n\n<p><code>set list</code> may be useful later for character editing. I wouldn't recommend just deleting it without knowing what you are doing.</p>\n"}], "owner": {"reputation": 1215, "user_id": 2824935, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/dkDTX.jpg?s=128&g=1", "display_name": "garythegoat", "link": "https://stackoverflow.com/users/2824935/garythegoat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1299, "favorite_count": 0, "accepted_answer_id": 39092052, "answer_count": 2, "score": -1, "last_activity_date": 1471966222, "creation_date": 1471923352, "question_id": 39091918, "link": "https://stackoverflow.com/questions/39091918/hiding-tab-characters-in-vim", "title": "Hiding tab characters in Vim", "body": "<p>I've just begun learning Go, and upon running <code>go fmt</code>, I am finding tab <code>^I</code> characters appear in my code:</p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc main() {\n  ^Ifmt.Println(\"Hello world!\")\n}\n</code></pre>\n\n<p>Is there a way I can configure Vim to not display these characters, while still preserving the tabs in the file itself?</p>\n"}, {"tags": ["json", "macos", "serialization", "go", "time"], "comments": [{"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 0, "creation_date": 1471929597, "post_id": 39090669, "comment_id": 65532991, "body": "To simplify, the <code>json</code> part is actually irrelevant: the UnmarshalJSON method is just a wrapper around time.Parse using the RFC3339 format string: <code>time.Parse(time.RFC3339, &quot;2017-08-15T22:30:00+00:00&quot;)</code>"}, {"owner": {"reputation": 1, "user_id": 3083983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c7a7ae12831281520f851ee3454a72c?s=128&d=identicon&r=PG&f=1", "display_name": "nrjones8", "link": "https://stackoverflow.com/users/3083983/nrjones8"}, "reply_to_user": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 0, "creation_date": 1471931127, "post_id": 39090669, "comment_id": 65533569, "body": "Thanks @djd, updated description of question to simplify and just use <code>time.Parse</code>."}, {"owner": {"reputation": 1, "user_id": 3083983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c7a7ae12831281520f851ee3454a72c?s=128&d=identicon&r=PG&f=1", "display_name": "nrjones8", "link": "https://stackoverflow.com/users/3083983/nrjones8"}, "reply_to_user": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 0, "creation_date": 1471973555, "post_id": 39090669, "comment_id": 65562050, "body": "<a href=\"https://golang.org/src/time/format.go#L1015\" rel=\"nofollow noreferrer\">This code</a> in <code>time&#47;format.go</code> seems like it could be a likely culprit, but it doesn&#39;t necessarily explain why the behavior is different on my local mac os x machine vs. the CI server we use (Linux) or whatever Go Playground uses."}], "answers": [{"tags": [], "owner": {"reputation": 1594, "user_id": 759298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bae1d7a91cd9e390a4d8d92c2636aa7?s=128&d=identicon&r=PG", "display_name": "Supreet Sethi", "link": "https://stackoverflow.com/users/759298/supreet-sethi"}, "is_accepted": false, "score": 0, "last_activity_date": 1471929404, "creation_date": 1471929404, "answer_id": 39092894, "question_id": 39090669, "link": "https://stackoverflow.com/questions/39090669/golang-empty-location-on-mac-osx-when-parsing-time/39092894#39092894", "title": "Golang empty Location on Mac OSX when parsing time", "body": "<p>I find same behavior using my current setup on Mac and I suspect it will be same behavior on Linux (not sure through)</p>\n\n<pre><code>$ go version\ngo version devel +31ad583 Wed Aug 10 19:44:08 2016 +0000 darwin/amd64\n</code></pre>\n\n<p>To make it more deterministic, I suggest using a custom json Unmarshal like so:</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"fmt\"\n  \"strings\"\n  \"time\"\n)\n\ntype Time struct {\n   *time.Time\n}\n\nfunc (t *Time) UnmarshalJSON(b []byte) error {\n  const format = \"\\\"2006-01-02T15:04:05+00:00\\\"\"\n  t_, err := time.Parse(format, string(b))\n  if err != nil {\n      return err\n  }\n  *t = Time{&amp;t_}\n  return nil\n}\n\ntype Example struct {\n  TimeField *Time `json:\"time_field\"`\n}\n\nfunc main() {\n  inString := \"{\\\"time_field\\\": \\\"2017-08-15T22:30:00+00:00\\\"}\"\n  var ex Example\n  decoder := json.NewDecoder(strings.NewReader(inString))\n  decoder.Decode(&amp;ex)\n  fmt.Printf(\"TimeField.String(): %v\\n\", ex.TimeField.String())\n  fmt.Printf(\"TimeField.Location(): %v\\n\", ex.TimeField.Location())\n}\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 0, "last_activity_date": 1471942493, "last_edit_date": 1471942493, "creation_date": 1471942053, "answer_id": 39096476, "question_id": 39090669, "link": "https://stackoverflow.com/questions/39090669/golang-empty-location-on-mac-osx-when-parsing-time/39096476#39096476", "title": "Golang empty Location on Mac OSX when parsing time", "body": "<p>Yes, You are right. On The Go Playground the <code>Local</code> is set to <code>UTC</code> inside that sandbox:<br>\nTry this working sample code on <kbd><a href=\"https://play.golang.org/p/SkD5BgYCxE\" rel=\"nofollow\">The Go Playground</a></kbd>: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc main() {\n    fmt.Println(runtime.Version(), runtime.GOARCH, runtime.GOOS) //go1.7 amd64p32 nacl\n\n    parsed, err := time.Parse(time.RFC3339, \"2017-08-15T22:30:00+00:00\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"String(): %v\\n\", parsed.String())\n    fmt.Printf(\"Location(): %v\\n\", parsed.Location())\n}\n</code></pre>\n\n<p>output on The Go Playground:  </p>\n\n<pre><code>go1.7 amd64p32 nacl\nString(): 2017-08-15 22:30:00 +0000 UTC\nLocation(): UTC \n</code></pre>\n\n<p>And try it on your local system, output <code>Location()</code> is empty.</p>\n\n<hr>\n\n<p>You may use <code>utc := parsed.UTC()</code> with the location set to UTC, like this working sample code <kbd><a href=\"https://play.golang.org/p/6lvElTGx3M\" rel=\"nofollow\">The Go Playground</a></kbd>:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc main() {\n    fmt.Println(runtime.Version(), runtime.GOARCH, runtime.GOOS) //go1.7 amd64p32 nacl\n\n    parsed, err := time.Parse(time.RFC3339, \"2017-08-15T22:30:00+00:00\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"String(): %v\\n\", parsed.String())\n    fmt.Printf(\"Location(): %v\\n\", parsed.Location())\n    utc := parsed.UTC()\n    fmt.Printf(\"String(): %v\\n\", utc.String())\n    fmt.Printf(\"Location(): %v\\n\", utc.Location())\n}\n</code></pre>\n\n<hr>\n\n<p>Also You may use <code>time.ParseInLocation(time.RFC3339, \"2017-08-15T22:30:00+00:00\", time.UTC)</code>, like this working sample code:    </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc main() {\n    fmt.Println(runtime.Version(), runtime.GOARCH, runtime.GOOS) //go1.7 amd64p32 nacl\n\n    parsed, err := time.ParseInLocation(time.RFC3339, \"2017-08-15T22:30:00+00:00\", time.UTC)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"String(): %v\\n\", parsed.String())\n    fmt.Printf(\"Location(): %v\\n\", parsed.Location())\n}\n</code></pre>\n\n<p>So the <code>Location()</code>  will be <code>UTC</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "is_accepted": false, "score": 0, "last_activity_date": 1612529851, "last_edit_date": 1612529851, "creation_date": 1612529427, "answer_id": 66063609, "question_id": 39090669, "link": "https://stackoverflow.com/questions/39090669/golang-empty-location-on-mac-osx-when-parsing-time/66063609#66063609", "title": "Golang empty Location on Mac OSX when parsing time", "body": "<p>Thanks to @djd for pointing out that we can skip all the JSON/struct decoding business; the key issue is with <code>time.Parse</code>.</p>\n<p>The same issue comes up here where the <code>Location</code> is &quot;empty&quot; rather than UTC (I would've expected UTC based on the docs: <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#Parse</a></p>\n<blockquote>\n<p>In the absence of a time zone indicator, Parse returns a time in UTC.</p>\n</blockquote>\n<hr />\n<p><sub>This answer was taken from the question as of <a href=\"https://stackoverflow.com/revisions/39090669/6\">revision 6</a>.</sub></p>\n"}], "owner": {"reputation": 1, "user_id": 3083983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c7a7ae12831281520f851ee3454a72c?s=128&d=identicon&r=PG&f=1", "display_name": "nrjones8", "link": "https://stackoverflow.com/users/3083983/nrjones8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 823, "favorite_count": 3, "answer_count": 3, "score": 0, "last_activity_date": 1612529851, "creation_date": 1471912805, "last_edit_date": 1612529448, "question_id": 39090669, "link": "https://stackoverflow.com/questions/39090669/golang-empty-location-on-mac-osx-when-parsing-time", "title": "Golang empty Location on Mac OSX when parsing time", "body": "<p>When decoding a timestamp field from JSON into a <code>struct</code> on my local OS X machine, the <code>Location</code> of the <code>time.Time</code> field is &quot;empty&quot; rather than UTC. This is problematic for me running unit tests locally (vs. on a CI server where the <code>Location</code> is being set correctly to be UTC).</p>\n<p>Here's the example code: <a href=\"https://play.golang.org/p/pb3eMbjSmv\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pb3eMbjSmv</a></p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;time&quot;\n)\n\nfunc main() {\n    // Ignoring the err just for this example's sake!\n    parsed, _ := time.Parse(time.RFC3339, &quot;2017-08-15T22:30:00+00:00&quot;)\n    fmt.Printf(&quot;String(): %v\\n&quot;, parsed.String())\n    fmt.Printf(&quot;Location(): %v\\n&quot;, parsed.Location())\n}\n</code></pre>\n<p>which outputs</p>\n<pre class=\"lang-none prettyprint-override\"><code>String(): 2017-08-15 22:30:00 +0000 +0000\nLocation():\n</code></pre>\n<p>So while the offset of the <code>time.Time</code>'s <code>Location</code> appears to be correct, its timezone name is just an empty string. Running in on other machines (and The Go Playground) give the expected &quot;UTC&quot; location.</p>\n<p>When I run that on my machine, I see</p>\n<pre class=\"lang-none prettyprint-override\"><code>TimeField.String(): 2017-08-15 22:30:00 +0000 +0000\nTimeField.Location():\n</code></pre>\n<p>So while the offset of the <code>time.Time</code>'s <code>Location</code> appears to be correct, its timezone name is just an empty string. This is using Go 1.5:</p>\n<pre class=\"lang-none prettyprint-override\"><code>go version go1.5 darwin/amd64\n</code></pre>\n"}, {"tags": ["ruby-on-rails", "ruby", "go"], "answers": [{"tags": [], "owner": {"reputation": 1205, "user_id": 6742278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2UIeh.jpg?s=128&g=1", "display_name": "codyeatworld", "link": "https://stackoverflow.com/users/6742278/codyeatworld"}, "is_accepted": true, "score": 0, "last_activity_date": 1471906710, "creation_date": 1471906710, "answer_id": 39089953, "question_id": 39089871, "link": "https://stackoverflow.com/questions/39089871/golang-posts-to-a-rails-application/39089953#39089953", "title": "GOLang posts to a Rails Application", "body": "<p>You'll need to disable CSRF verification for the <code>ItemsController#create</code> action.</p>\n\n<p>In your <code>ItemsController</code>.</p>\n\n<pre><code>skip_before_action :verify_authenticity_token, only: [:create]\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 6412456, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153421657022624/picture?type=large", "display_name": "Gregor", "link": "https://stackoverflow.com/users/6412456/gregor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 39089953, "answer_count": 1, "score": 0, "last_activity_date": 1471906710, "creation_date": 1471906184, "last_edit_date": 1471906698, "question_id": 39089871, "link": "https://stackoverflow.com/questions/39089871/golang-posts-to-a-rails-application", "title": "GOLang posts to a Rails Application", "body": "<p>I have a golang program sending an item every second (as a post) to a server. A Golang listening program outputs the items as a hash: </p>\n\n<pre><code>{\"Address\":\"test@test.com\", \"EmailType\":\"test\", \"Event\":\"test\", \"Timestamp\":1234}.\n</code></pre>\n\n<p>Now I want to send this data to a rails server and save each event to a database. However when I point the program to my post route I get this error: </p>\n\n<pre><code>Started POST \"/items\" for ::1 at 2016-08-23 00:36:17 +0200\n\nProcessing by ItemsController#create as HTML\n\nCan't verify CSRF token authenticity\n\nCompleted 422 Unprocessable Entity in 1ms (ActiveRecord: 0.0ms)\n</code></pre>\n\n<p>The error is get on the golang program is:</p>\n\n<pre><code>Sending events to: http://localhost:4000/items\n2016/08/23 00:36:17 Expecting 200 returned, got %!f(int=422) \n</code></pre>\n\n<p>Can anybody help me out with whats going wrong?</p>\n"}, {"tags": ["memory", "go", "out-of-memory"], "comments": [{"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471904095, "post_id": 39089448, "comment_id": 65526841, "body": "This smells of passing too many things by value or too many pointers (remember that a pointer is 8x the size of a data element here, so careful how you&#39;re passing things around).  Suggest using a profiler to figure out where your bad passage is happening.  <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">blog.golang.org/profiling-go-programs</a>"}, {"owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "reply_to_user": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471904333, "post_id": 39089448, "comment_id": 65526911, "body": "I don&#39;t even use pointers other than taking command line arguments. Just lots of computations and slice operations. Thanks for advice!"}, {"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 1, "creation_date": 1471904829, "post_id": 39089448, "comment_id": 65527035, "body": "Oh, and if you&#39;re doing a ton of append() without preallocation, you&#39;re forcing the heap to do a ton of work (reallocating/recopying over and over). See if preallocating all your entries in advance helps (like &quot;make([]uint8, 10000000000)&quot; or something)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1471905248, "post_id": 39089448, "comment_id": 65527173, "body": "are you using go1.7?"}, {"owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1471905312, "post_id": 39089448, "comment_id": 65527189, "body": "@JimB dude machine has 1 TB of RAM already, who has more than that? Yes it&#39;s 1.7."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471905419, "post_id": 39089448, "comment_id": 65527224, "body": "@BJBlack, this is during compilation."}, {"owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "reply_to_user": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471905657, "post_id": 39089448, "comment_id": 65527295, "body": "@BJ Black I agree with JimB, I don&#39;t do any calculation or appending before getting the arguments from command line which I cannot take before compile as nature of my code."}, {"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1471906256, "post_id": 39089448, "comment_id": 65527490, "body": "It shouldn&#39;t be the <i>only</i> thing getting in your way since you still have nowhere near 1 TB worth of data, but have you tried declaring your constant as an array instead of as a slice, e.g. <code>myArray := [...]uint8 {</code> instead of <code>mySlice := []uint8 {</code>? This would tell the compiler that you want a backing array to hold <i>exactly</i> that much data, and there&#39;s no need to reserve any extra or optimize for the possibility that you&#39;ll be appending to it. Since anything that consumes your data will probably still expect a slice, you can convert from an array to a slice with <code>myArray[:]</code>."}, {"owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "reply_to_user": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1471906356, "post_id": 39089448, "comment_id": 65527515, "body": "@Jesse Amano I will try that and let you know asap. Thanks."}, {"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471908004, "post_id": 39089448, "comment_id": 65528044, "body": "Man, you&#39;re right.  It&#39;s compile-time; I missed that.  That&#39;s weird.  How are you pulling the data into the program?  Are you compiling the dataset into the binary or something?"}, {"owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "reply_to_user": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471908136, "post_id": 39089448, "comment_id": 65528085, "body": "@BJ Black It&#39;s just a slice in code, like <code>slice := []uint8{2,3,4,2,3,4,5...}</code> (millions of elements)."}, {"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471909368, "post_id": 39089448, "comment_id": 65528388, "body": "Ouch.  So that&#39;s why the compiler was freaking out.  It has to track a ton of data about each identifier (not just the parse tree, but a bunch of intra-object links) so I can totally imagine what&#39;s up.  And the runtime linker won&#39;t be super happy at runtime either.  Why not read this at program start from a binary file again?  Do you have some single-monolithic-file requirement?"}, {"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471909550, "post_id": 39089448, "comment_id": 65528432, "body": "The alternative I suppose would be to shard the data into multiple packages (I.e. &quot;package data1&quot; in data1.go, &quot;package data2&quot; in data2.go, etc, then pulling them all in your main at runtime), so the compiler need only carry part of the data at any one time.  Or try linking that as a C object and doing something really weird with objcopy.  Either way, yuck."}, {"owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "reply_to_user": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471909898, "post_id": 39089448, "comment_id": 65528518, "body": "@BJ Black Can you please provide an example about how to read this at program start from a binary file?"}, {"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471910257, "post_id": 39089448, "comment_id": 65528619, "body": "Unfortunately I&#39;m away from my PC for a couple of hours; will do as soon as I&#39;m back."}, {"owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "edited": false, "score": 0, "creation_date": 1471910291, "post_id": 39089448, "comment_id": 65528631, "body": "Ok, I&#39;m waiting for that. Thanks in advance!"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1471911254, "post_id": 39089448, "comment_id": 65528858, "body": "If you have the (binary) data in a file, you should be able to read it into your slice. Open the file with <code>os.Open</code> and then call <code>io.ReadFull</code> on that and your slice."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1471920887, "post_id": 39089448, "comment_id": 65530777, "body": "<code>String literals</code>  maybe help you reduce the source size(using character for printable, and \\x for others not printable). converting string to []byte at runtime."}, {"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 3, "creation_date": 1471922144, "post_id": 39089448, "comment_id": 65531068, "body": "Try:  <a href=\"http://pastebin.com/pVgRbris\" rel=\"nofollow noreferrer\">pastebin.com/pVgRbris</a> (updated to []uint8 instead of []byte)  This uses good ol&#39; ioutil.ReadFile to slurp in all the data at runtime.  Ran in about 200ms on my i5-based laptop with a 500 MiB binary of random bytes."}, {"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471922449, "post_id": 39089448, "comment_id": 65531138, "body": "Jiang:  Careful with that; strings are UTF-8 by default, so figuring out what&#39;s printable and what&#39;s not (and what&#39;s an invalid sequence) is tricky.  Better to slurp in as a []byte and convert to []uint8 as in my pastbin."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1471961599, "post_id": 39089448, "comment_id": 65553956, "body": "Other options are using something like <a href=\"https://github.com/jteeuwen/go-bindata\" rel=\"nofollow noreferrer\"><code>go-bindata</code></a> with the <code>-nomemcpy</code> flag to pack the data into the binary (nor sure how it will handle this data size though), or append your data to the binary and access it via a zip archive (examples here, but looks unmaintained <a href=\"https://github.com/cookieo9/resources-go/tree/v2.1\" rel=\"nofollow noreferrer\">github.com/cookieo9/resources-go/tree/v2.1</a>). It&#39;s really just easier to load the data from an external source."}, {"owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "reply_to_user": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1471975067, "post_id": 39089448, "comment_id": 65562880, "body": "@Jesse Amano it&#39;s not working unfortunately but thanks anyway."}, {"owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "reply_to_user": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471975185, "post_id": 39089448, "comment_id": 65562949, "body": "@BJ Black this doesn&#39;t read the bin file as a slice that similar to the slice that I was using, it has different format and the code is not working properly with it. Trying to handle this issue. Thanks."}, {"owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "reply_to_user": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1471979534, "post_id": 39089448, "comment_id": 65565299, "body": "@BJ Black it&#39;s working now, thank you so much."}], "answers": [{"comments": [{"owner": {"reputation": 389, "user_id": 3385070, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pU0nE.jpg?s=128&g=1", "display_name": "tez", "link": "https://stackoverflow.com/users/3385070/tez"}, "edited": false, "score": 0, "creation_date": 1472166158, "post_id": 39109042, "comment_id": 65655451, "body": "BTW, byte is completely equivalent to uint8 in any way according to docs - <a href=\"https://golang.org/pkg/builtin/#byte\" rel=\"nofollow noreferrer\">golang.org/pkg/builtin/#byte</a>"}, {"owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "reply_to_user": {"reputation": 389, "user_id": 3385070, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pU0nE.jpg?s=128&g=1", "display_name": "tez", "link": "https://stackoverflow.com/users/3385070/tez"}, "edited": false, "score": 0, "creation_date": 1472166901, "post_id": 39109042, "comment_id": 65655677, "body": "@tez Yes, I know but I just wanted to include the code that helped me without editing it. Thanks."}], "tags": [], "owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "is_accepted": true, "score": 0, "last_activity_date": 1471979634, "creation_date": 1471979634, "answer_id": 39109042, "question_id": 39089448, "link": "https://stackoverflow.com/questions/39089448/golang-fatal-error-out-of-memory-on-1-tb-ram-machine/39109042#39109042", "title": "Golang, fatal error: out of memory on 1 TB RAM machine", "body": "<p>I loaded the data from external binary file as bytes. The following code @BJ Black provided helped.</p>\n\n<pre><code>    buf, err := ioutil.ReadFile(\"somefile.bin\")\n    if err != nil { panic(err.Error()) }\n    // Coerce type\n    uintbuf := []uint8(buf)\n</code></pre>\n"}], "owner": {"reputation": 1183, "user_id": 3416136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/KpFq0.jpg?s=128&g=1", "display_name": "malisit", "link": "https://stackoverflow.com/users/3416136/malisit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2023, "favorite_count": 0, "accepted_answer_id": 39109042, "answer_count": 1, "score": -1, "last_activity_date": 1471979634, "creation_date": 1471903516, "last_edit_date": 1471904260, "question_id": 39089448, "link": "https://stackoverflow.com/questions/39089448/golang-fatal-error-out-of-memory-on-1-tb-ram-machine", "title": "Golang, fatal error: out of memory on 1 TB RAM machine", "body": "<p>I have a code with a huge <code>uint8</code> slice of nearly 590 million elements. I'm keeping this array in the code to make it run as fast as possible. The code's final size is 1.3 GB.</p>\n\n<p>When I try to compile it, it raises the <code>fatal error: out of memory</code>. with following</p>\n\n<pre><code># command-line-arguments\nfatal error: out of memory\n\nruntime stack:\nruntime.throw(0x8fb3f2, 0xd)\n    /usr/local/go/src/runtime/panic.go:566 +0x95\nruntime.(*mcache).refill(0x7f5c2afa3ba8, 0x1440000000a, 0x7f57dc46d5e0)\n    /usr/local/go/src/runtime/mcache.go:123 +0x160\nruntime.(*mcache).nextFree.func1()\n    /usr/local/go/src/runtime/malloc.go:505 +0x33\nruntime.systemstack(0xc420044000)\n    /usr/local/go/src/runtime/asm_amd64.s:298 +0x79\nruntime.mstart()\n    /usr/local/go/src/runtime/proc.go:1079\n\ngoroutine 1 [running]:\nruntime.systemstack_switch()\n    /usr/local/go/src/runtime/asm_amd64.s:252 fp=0x131f300c970 sp=0x131f300c968\nruntime.(*mcache).nextFree(0x7f5c2afa3ba8, 0xa, 0x0, 0x131f300ca80, 0x1)\n    /usr/local/go/src/runtime/malloc.go:506 +0xb2 fp=0x131f300c9c8 sp=0x131f300c970\nruntime.mallocgc(0x90, 0x8ed060, 0x1, 0x115f3f9c)\n    /usr/local/go/src/runtime/malloc.go:658 +0x809 fp=0x131f300ca68 sp=0x131f300c9c8\nruntime.newobject(0x8ed060, 0xe00b46a450)\n    /usr/local/go/src/runtime/malloc.go:785 +0x38 fp=0x131f300ca98 sp=0x131f300ca68\ncmd/compile/internal/gc.Nod(0xd6c186c643, 0xfca1028090, 0xd6c186c480, 0x1)\n    /usr/local/go/src/cmd/compile/internal/gc/subr.go:335 +0x31 fp=0x131f300cac0 sp=0x131f300ca98\ncmd/compile/internal/gc.arraylit(0x0, 0x1, 0xc420663290, 0xfca1028090, 0x131f300d6c0)\n    /usr/local/go/src/cmd/compile/internal/gc/sinit.go:698 +0x18f fp=0x131f300cb48 sp=0x131f300cac0\ncmd/compile/internal/gc.slicelit(0x0, 0xc420663290, 0xfca1018000, 0x131f300d6c0)\n    /usr/local/go/src/cmd/compile/internal/gc/sinit.go:765 +0xb36 fp=0x131f300cc58 sp=0x131f300cb48\ncmd/compile/internal/gc.anylit(0x0, 0xc420663290, 0xfca1018000, 0x131f300d6c0)\n    /usr/local/go/src/cmd/compile/internal/gc/sinit.go:1106 +0xac3 fp=0x131f300cd30 sp=0x131f300cc58\ncmd/compile/internal/gc.oaslit(0xfca1017ef0, 0x131f300d6c0, 0xfca1018000)\n    /usr/local/go/src/cmd/compile/internal/gc/sinit.go:1192 +0x104 fp=0x131f300cd60 sp=0x131f300cd30\ncmd/compile/internal/gc.walkexpr(0xfca1017ef0, 0x131f300d6c0, 0x0)\n    /usr/local/go/src/cmd/compile/internal/gc/walk.go:725 +0xe9c fp=0x131f300d5b8 sp=0x131f300cd60\ncmd/compile/internal/gc.walkstmt(0xfca1017ef0, 0xfca1018090)\n    /usr/local/go/src/cmd/compile/internal/gc/walk.go:192 +0xf45 fp=0x131f300d7f0 sp=0x131f300d5b8\ncmd/compile/internal/gc.walkstmtlist(0x131f3184000, 0x21, 0x40)\n    /usr/local/go/src/cmd/compile/internal/gc/walk.go:80 +0x4d fp=0x131f300d820 sp=0x131f300d7f0\ncmd/compile/internal/gc.walk(0xc42065ccf0)\n    /usr/local/go/src/cmd/compile/internal/gc/walk.go:65 +0x1e4 fp=0x131f300d8f0 sp=0x131f300d820\ncmd/compile/internal/gc.compile(0xc42065ccf0)\n    /usr/local/go/src/cmd/compile/internal/gc/pgen.go:391 +0x1d4 fp=0x131f300dba0 sp=0x131f300d8f0\ncmd/compile/internal/gc.funccompile(0xc42065ccf0)\n    /usr/local/go/src/cmd/compile/internal/gc/dcl.go:1287 +0x186 fp=0x131f300dc18 sp=0x131f300dba0\ncmd/compile/internal/gc.Main()\n    /usr/local/go/src/cmd/compile/internal/gc/main.go:467 +0x19f8 fp=0x131f300de60 sp=0x131f300dc18\ncmd/compile/internal/amd64.Main()\n    /usr/local/go/src/cmd/compile/internal/amd64/galign.go:93 +0x2fa fp=0x131f300de98 sp=0x131f300de60\nmain.main()\n    /usr/local/go/src/cmd/compile/main.go:33 +0x2a3 fp=0x131f300df28 sp=0x131f300de98\nruntime.main()\n    /usr/local/go/src/runtime/proc.go:183 +0x1f4 fp=0x131f300df80 sp=0x131f300df28\nruntime.goexit()\n    /usr/local/go/src/runtime/asm_amd64.s:2086 +0x1 fp=0x131f300df88 sp=0x131f300df80\n</code></pre>\n\n<p>I think the machine's RAM is enough for this kind of task but couldn't pass this issue. I tried the code with another slice of 21 million elements and it works fine with it. It's a really hard computation task, and since it needed to be running really fast, I cannot use an external file for data.</p>\n\n<p>Already optimized the variable types.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go", "signed"], "comments": [{"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 1, "creation_date": 1471901867, "post_id": 39088945, "comment_id": 65526026, "body": "A <code>uint</code> might be superior in case you want to address the 2147483648th element of a slice. But then, you&#39;d be in trouble if you wanted to address the 4294967296th element."}], "answers": [{"comments": [{"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 0, "creation_date": 1471902809, "post_id": 39089164, "comment_id": 65526376, "body": "Are the conversions required? A quick experiment indicates that you can compare <code>int</code> and <code>uint</code> values to integer literals without any problem (though trying to compare <code>int</code> and <code>uint</code> <i>variables</i> causes a &quot;mismatched types&quot; error)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 0, "creation_date": 1471903586, "post_id": 39089164, "comment_id": 65526653, "body": "@KeithThompson  for untyped numbers You are right ,  this is imaginary example, thanks."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 6, "last_activity_date": 1471906066, "last_edit_date": 1471906066, "creation_date": 1471902040, "answer_id": 39089164, "question_id": 39088945, "link": "https://stackoverflow.com/questions/39088945/why-does-len-returned-a-signed-value/39089164#39089164", "title": "Why does len() returned a signed value?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec#Length_and_capacity\" rel=\"noreferrer\">Length and capacity</a></p>\n  \n  <p>The built-in functions len and cap take arguments of various types and\n  return a result of type int. The implementation guarantees that the\n  result always fits into an int.</p>\n</blockquote>\n\n<p>Golang is strongly typed language, so if <code>len()</code> was <code>uint</code> then instead of:</p>\n\n<pre><code>i := 0 // int\nif len(a) == i {\n}  \n</code></pre>\n\n<p>you should write:</p>\n\n<pre><code>if len(a) == uint(i) {\n}\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>if int(len(a)) == i {\n}\n</code></pre>\n\n<p>Also See:  </p>\n\n<blockquote>\n  <p><code>uint</code>     either 32 or 64 bits<br>\n  <code>int</code>      same size as <code>uint</code><br>\n  <code>uintptr</code>  <a href=\"https://golang.org/src/builtin/builtin.go?s=2513:2533#L73\" rel=\"noreferrer\">an unsigned integer large enough to store the uninterpreted\n  bits of a pointer value</a></p>\n</blockquote>\n\n<p>Also for compatibility with C: <a href=\"https://golang.org/cmd/cgo/\" rel=\"noreferrer\">CGo</a> the <code>C.size_t</code> and size of array in C is of type <code>int</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1471903048, "post_id": 39089258, "comment_id": 65526470, "body": "(Speculative) There are a few good reasons I can think of for a language&#39;s author to desire that arrays be indexed by <i>signed</i> integers. Arrays are usually allocated as cohesive blocks of memory[citation needed] with pointer arithmetic used to address an element[citation needed]. You might store metadata, such as the array&#39;s length, in a negative offset[citation needed], and it may be circumstantially easier to represent certain array operations by adding an offset which may or may not be negative, as opposed to conditionally adding or subtracting offsets."}], "tags": [], "owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "is_accepted": false, "score": 1, "last_activity_date": 1471902588, "creation_date": 1471902588, "answer_id": 39089258, "question_id": 39088945, "link": "https://stackoverflow.com/questions/39088945/why-does-len-returned-a-signed-value/39089258#39089258", "title": "Why does len() returned a signed value?", "body": "<p>From <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"nofollow\">the spec:</a></p>\n\n<blockquote>\n  <p>The length is part of the array's type; it must evaluate to a non-negative constant representable by a value of type <code>int</code>. The length of array a can be discovered using the built-in function <code>len</code>. The elements can be addressed by integer indices <code>0</code> through <code>len(a)-1</code>. Array types are always one-dimensional but may be composed to form multi-dimensional types.</p>\n</blockquote>\n\n<p>I realize it's maybe a little circular to say the spec dictates <em>X</em> because the spec dictates <em>Y</em>, but since the length can't exceed the maximum value of an <code>int</code>, it's equally as impossible for <code>len</code> to return a <code>uint</code>-exclusive value as for it to return a negative value.</p>\n"}, {"comments": [{"owner": {"reputation": 4282, "user_id": 165063, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MJdL7.png?s=128&g=1", "display_name": "Roman Khimov", "link": "https://stackoverflow.com/users/165063/roman-khimov"}, "edited": false, "score": 1, "creation_date": 1471944033, "post_id": 39092314, "comment_id": 65541069, "body": "I thought that Go runtime does bounds checking for any kind of access to arrays or slices, thus underflows with both signed or unsigned integers are absolutely equal in its consequences (run-time panic) when we&#39;re talking about <i>indexes</i>. But unsigned math can still be problematic when one uses it to compute <i>length</i> or <i>capacity</i> of the array to allocate."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 4282, "user_id": 165063, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MJdL7.png?s=128&g=1", "display_name": "Roman Khimov", "link": "https://stackoverflow.com/users/165063/roman-khimov"}, "edited": false, "score": 0, "creation_date": 1471944325, "post_id": 39092314, "comment_id": 65541264, "body": "@RomanKhimov Yes, <b>if</b> an over-/underflow happens the consequences are the same. My argument is: There are less ...flows if signed ints are used and more ...flows if unsigned ints are used for index calculations because indices around 0 are much more common than indices around MaxUint32."}, {"owner": {"reputation": 96, "user_id": 1798218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08cde38ee8073a000a1434ab6c532125?s=128&d=identicon&r=PG", "display_name": "Thom Carter", "link": "https://stackoverflow.com/users/1798218/thom-carter"}, "edited": false, "score": 0, "creation_date": 1612904018, "post_id": 39092314, "comment_id": 116910803, "body": "Is there an error in the example here? I don&#39;t think 6 - 10 + 7 underflows, does it? Regardless, I&#39;m not sure I follow the argument. Is it that in an underflow scenario an obvious negative index error is preferable to the more subtle bugs that could be caused by a large unsigned integer index?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1612945361, "post_id": 39092314, "comment_id": 116921304, "body": "@Carter 1. I never claimed 6-10+7 would underflow. This is a constant expression evaluated at compiletime with arbitrary precission. I said a-b+7 could result in unexpected behaviour if a and b w&#228;re unsigned.) 2. Every over or underflow is a bug. The argument is: index calculations around 0 are much more common than araound MaxUint. This doing Index calculations with uints is more dangerous as there will be more errors."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 32, "last_activity_date": 1521642395, "last_edit_date": 1521642395, "creation_date": 1471926170, "answer_id": 39092314, "question_id": 39088945, "link": "https://stackoverflow.com/questions/39088945/why-does-len-returned-a-signed-value/39092314#39092314", "title": "Why does len() returned a signed value?", "body": "<p><code>len()</code> (and <code>cap()</code>) return <code>int</code> because that is what is used to index slices and arrays (not <code>uint</code>). So the question is more \"Why does Go use signed integers to index slices/arrays when there are no negative indices?\".</p>\n\n<p>The answer is simple: It is common to <strong>compute</strong> an index and such computations tend to underflow much too easy if done in unsigned integers. Some innocent code like <code>i := a-b+7</code> might yield <code>i == 4294967291</code> for innocent values for <code>a</code>and <code>b</code> of 6 and 10. Such an index will probably overflow your slice. Lots of index calculations happen around 0 and are tricky to get right using unsigned integers and these bugs hide behind mathematically totally sensible and sound formulas. This is neither safe nor convenient.</p>\n\n<p>This is a tradeoff based on experience: Underflow tends to happen often for index calculations done with unsigned ints while overflow is much less common if signed integers are used for index calculations.</p>\n\n<p>Additionally: There is basically zero benefit from using unsigned integers in these cases.</p>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1576902753, "post_id": 58308166, "comment_id": 105052493, "body": "<a href=\"https://github.com/golang/go/issues/31795\" rel=\"nofollow noreferrer\">proposal: Go 2: change len, cap to return untyped ints if result is constant</a> has been retracted and closed."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1576914288, "post_id": 58308166, "comment_id": 105053858, "body": "@peterSO Thank you. I have updated the answer accordingly."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 5, "last_activity_date": 1617755655, "last_edit_date": 1617755655, "creation_date": 1570637206, "answer_id": 58308166, "question_id": 39088945, "link": "https://stackoverflow.com/questions/39088945/why-does-len-returned-a-signed-value/58308166#58308166", "title": "Why does len() returned a signed value?", "body": "<p>There is a proposal in progress &quot;<a href=\"//github.com/golang/go/issues/31795\" rel=\"nofollow noreferrer\">issue 31795 <strong>Go 2: change <code>len</code>, <code>cap</code> to\nreturn untyped int if result is constant</strong></a>&quot;</p>\n<p>It <em>might</em> be included for Go 1.14 (Q1 2010)</p>\n<blockquote>\n<p>we should be able to do it for <code>len</code> and <code>cap</code> without problems - and indeed\nthere aren't any in the stdlib as a type-checking it via a modified type\nchecker shows</p>\n</blockquote>\n<p>See <a href=\"//go-review.googlesource.com/c/go/+/179184\" rel=\"nofollow noreferrer\">CL 179184</a> as a PoC: this is still experimental.</p>\n<hr />\n<p>As <a href=\"//stackoverflow.com/posts/comments/105052493\">noted below</a> by <a href=\"//stackoverflow.com/users/221700/peterso\">peterSO</a>, this has been closed.</p>\n<p><a href=\"//github.com/griesemer\" rel=\"nofollow noreferrer\">Robert Griesemer</a> explains:</p>\n<blockquote>\n<p>As you noted, the problem with making len always untyped is the size of the\nresult. For booleans (and also strings) the size is known, no matter what\nkind of boolean (or string).</p>\n</blockquote>\n<p><a href=\"//github.com/rsc\" rel=\"nofollow noreferrer\">Russ Cox</a> <a href=\"//github.com/golang/go/issues/31795#issuecomment-541158850\" rel=\"nofollow noreferrer\">added</a>:</p>\n<blockquote>\n<p>I am not sure the costs here are worth the benefit. Today there is a simple\nrule: <strong><code>len(x)</code> has type <code>int</code></strong>. Changing the type to depend on what <code>x</code> is\nwill interact in non-orthogonal ways with various code changes. For example,\nunder the proposed semantics, this code compiles:</p>\n<pre><code>const x string = &quot;hello&quot;\nfunc f(uintptr)\n...\nf(len(x))\n</code></pre>\n<p>but suppose then someone comes along and wants to be able to modify <code>x</code> for\ntesting or something like that, so they <code>s/const/var/</code>. That's usually fairly\nsafe, but now the <code>f(len(x))</code> call fails to type-check, and it will be\nmysterious why it ever worked.</p>\n<p>This change seems like it might add more rough edges than it removes.</p>\n</blockquote>\n"}], "owner": {"reputation": 2282, "user_id": 580947, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/db80e641a9a6d9aa054fcde901e2ba4e?s=128&d=identicon&r=PG", "display_name": "daxelrod", "link": "https://stackoverflow.com/users/580947/daxelrod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5724, "favorite_count": 3, "answer_count": 4, "score": 29, "last_activity_date": 1617755655, "creation_date": 1471900956, "last_edit_date": 1471904205, "question_id": 39088945, "link": "https://stackoverflow.com/questions/39088945/why-does-len-returned-a-signed-value", "title": "Why does len() returned a signed value?", "body": "<p>Go's builtin <a href=\"https://golang.org/pkg/builtin/#len\" rel=\"noreferrer\"><code>len()</code> function</a> returns a signed <code>int</code>. Why wasn't a <code>uint</code> used instead?</p>\n\n<p>Is it ever possible for <code>len()</code> to return something negative?<br>\nAs far as I can tell, the answer is no:</p>\n\n<ul>\n<li><a href=\"https://golang.org/ref/spec#Array_types\" rel=\"noreferrer\">Arrays</a>: \"The number of elements is called the length and is never negative.\"</li>\n<li><a href=\"https://golang.org/ref/spec#Length_and_capacity\" rel=\"noreferrer\">Slices</a>: \"At any time the following relationship holds: <code>0 &lt;= len(s) &lt;= cap(s)</code>\"</li>\n<li><a href=\"https://golang.org/ref/spec#Map_types\" rel=\"noreferrer\">Maps</a> \"The number of map elements is called its length\". (I couldn't find anything in the spec that explicitly restricts this to a nonnegative value, but it's difficult for me to understand how there could be fewer than 0 elements in a map)</li>\n<li><a href=\"https://golang.org/ref/spec#String_types\" rel=\"noreferrer\">Strings</a> \"A string value is a (possibly empty) sequence of bytes.... The length of a string s (its size in bytes) can be discovered using the built-in function <code>len()</code>\" (Again, hard to see how a sequence could have a negative number of bytes)</li>\n<li><a href=\"https://golang.org/ref/spec#Length_and_capacity\" rel=\"noreferrer\">Channels</a> \"number of elements queued in channel buffer (ditto)</li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11277, "user_id": 3657941, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/304d8d4cceca5f9ce2383ff97b53e36b?s=128&d=identicon&r=PG&f=1", "display_name": "David Cullen", "link": "https://stackoverflow.com/users/3657941/david-cullen"}, "edited": false, "score": 2, "creation_date": 1471895675, "post_id": 39087469, "comment_id": 65523107, "body": "Is the text stored in a variable or a file? What have you tried?"}, {"owner": {"reputation": 4541, "user_id": 1091558, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/69188df1273c3c8c1fdeed66202c982b?s=128&d=identicon&r=PG", "display_name": "Giri", "link": "https://stackoverflow.com/users/1091558/giri"}, "reply_to_user": {"reputation": 11277, "user_id": 3657941, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/304d8d4cceca5f9ce2383ff97b53e36b?s=128&d=identicon&r=PG&f=1", "display_name": "David Cullen", "link": "https://stackoverflow.com/users/3657941/david-cullen"}, "edited": false, "score": 0, "creation_date": 1471900381, "post_id": 39087469, "comment_id": 65525403, "body": "@DavidCullen Its stored in a variable. And answer helped. Thanks"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 2, "last_activity_date": 1471899720, "last_edit_date": 1471899720, "creation_date": 1471896391, "answer_id": 39087856, "question_id": 39087469, "link": "https://stackoverflow.com/questions/39087469/how-to-wrap-each-line-with-a-div-in-golang/39087856#39087856", "title": "How to wrap each line with a div in Golang?", "body": "<p>You may use <code>bytes.Buffer</code> and <code>bufio.NewScanner</code>, like this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"strings\"\nimport \"bufio\"\nimport \"bytes\"\n\nfunc main() {\n    r := strings.NewReader(`Lorem ipsum dolor sit amet,\nconsectetur adipiscing elit.\n\nNam eget lectus porta metus aliquam tincidunt sed vel enim.`)\n\n    buf := &amp;bytes.Buffer{}\n    scanner := bufio.NewScanner(r)\n    for scanner.Scan() {\n        s := scanner.Text()\n        if len(s) == 0 {\n            s = `&lt;br/&gt;`\n        }\n        buf.WriteString(`&lt;div&gt;` + s + `&lt;/div&gt;\n`)\n    }\n    fmt.Println(buf.String())\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>&lt;div&gt;Lorem ipsum dolor sit amet,&lt;/div&gt;\n&lt;div&gt;consectetur adipiscing elit.&lt;/div&gt;\n&lt;div&gt;&lt;br/&gt;&lt;/div&gt;\n&lt;div&gt;Nam eget lectus porta metus aliquam tincidunt sed vel enim.&lt;/div&gt;\n</code></pre>\n\n<hr>\n\n<p>You may use <code>bytes.Buffer</code> and <code>html/template</code>,<br>\nbut you have <code>&lt;div&gt;&lt;/div&gt;</code> instead of <code>&lt;div&gt;&lt;br/&gt;&lt;/div&gt;</code>, then you may use</p>\n\n<pre><code>s = strings.Replace(s, `&lt;div&gt;&lt;/div&gt;`, `&lt;div&gt;&lt;br/&gt;&lt;/div&gt;`, -1)\n</code></pre>\n\n<p>like this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"bytes\"\nimport \"html/template\"\nimport \"strings\"\n\nfunc main() {\n    r := []string{`Lorem ipsum dolor sit amet,`,\n        `consectetur adipiscing elit.`,\n        ``,\n        `Nam eget lectus porta metus aliquam tincidunt sed vel enim.`}\n    buf := &amp;bytes.Buffer{}\n    t := template.Must(template.New(\"template\").Parse(\"{{range .}}&lt;div&gt;{{.}}&lt;/div&gt;\\n{{end}}\"))\n    t.Execute(buf, r)\n    s := buf.String()\n    s = strings.Replace(s, `&lt;div&gt;&lt;/div&gt;`, `&lt;div&gt;&lt;br/&gt;&lt;/div&gt;`, -1)\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>&lt;div&gt;Lorem ipsum dolor sit amet,&lt;/div&gt;\n&lt;div&gt;consectetur adipiscing elit.&lt;/div&gt;\n&lt;div&gt;&lt;br/&gt;&lt;/div&gt;\n&lt;div&gt;Nam eget lectus porta metus aliquam tincidunt sed vel enim.&lt;/div&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "is_accepted": false, "score": 1, "last_activity_date": 1471898626, "creation_date": 1471898626, "answer_id": 39088417, "question_id": 39087469, "link": "https://stackoverflow.com/questions/39087469/how-to-wrap-each-line-with-a-div-in-golang/39088417#39088417", "title": "How to wrap each line with a div in Golang?", "body": "<p>For the part of generating the HTML snippet from a slice of lines, you should use the following code, which takes care of properly escaping the HTML.</p>\n\n<pre><code>package main\n\nimport (\n    \"html/template\"\n    \"os\"\n)\n\nfunc main() {\n    data := []string{\n        \"first\",\n        \"second\",\n        \"&lt;style&gt;body{background-color:lime;}&lt;/style&gt;\",\n        \"&lt;script&gt;alert('evil')&lt;/script&gt;\",\n    }\n    htmlTemplate := \"{{range .}}&lt;div&gt;{{.}}&lt;/div&gt;\\n{{end}}\"\n\n    tmpl := template.Must(template.New(\"\").Parse(htmlTemplate))\n    tmpl.Execute(os.Stdout, data)\n}\n</code></pre>\n"}], "owner": {"reputation": 4541, "user_id": 1091558, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/69188df1273c3c8c1fdeed66202c982b?s=128&d=identicon&r=PG", "display_name": "Giri", "link": "https://stackoverflow.com/users/1091558/giri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 39087856, "answer_count": 2, "score": 0, "last_activity_date": 1471899720, "creation_date": 1471894835, "last_edit_date": 1471898119, "question_id": 39087469, "link": "https://stackoverflow.com/questions/39087469/how-to-wrap-each-line-with-a-div-in-golang", "title": "How to wrap each line with a div in Golang?", "body": "<p>I have a text paragraph.</p>\n\n<p>I would like to wrap each line with a div.</p>\n\n<p>For example if the text string looks like this</p>\n\n<pre><code>Lorem ipsum dolor sit amet, \nconsectetur adipiscing elit. \n\nNam eget lectus porta metus aliquam tincidunt sed vel enim.\n</code></pre>\n\n<p>Then I would like to wrap it like this</p>\n\n<pre><code>&lt;div&gt;Lorem ipsum dolor sit amet,&lt;/div&gt; \n&lt;div&gt;consectetur adipiscing elit.&lt;/div&gt; \n&lt;div&gt;&lt;br/&gt;&lt;/div&gt;\n&lt;div&gt;Nam eget lectus porta metus aliquam tincidunt sed vel enim.&lt;/div&gt;\n</code></pre>\n\n<p>Can someone tell me what is the proper way?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["csv", "go"], "comments": [{"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1471893463, "post_id": 39086976, "comment_id": 65521956, "body": "yes imo, push only the name into a slice (<code>[]string</code>) then iterate. This avoids the overhead of a map, but you will have to iterate more. I wonder how a benchmark compares between a map and string solution..."}], "answers": [{"tags": [], "owner": {"reputation": 1189, "user_id": 3931609, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/4n2cW.jpg?s=128&g=1", "display_name": "Kul", "link": "https://stackoverflow.com/users/3931609/kul"}, "is_accepted": false, "score": 0, "last_activity_date": 1471893431, "creation_date": 1471893431, "answer_id": 39087151, "question_id": 39086976, "link": "https://stackoverflow.com/questions/39086976/golang-csv-remove-duplicate-if-matching-column-values/39087151#39087151", "title": "golang csv remove duplicate if matching column values", "body": "<p>To do the comparison, it'll be better to use the names as keys in a <code>map[string]bool</code>.</p>\n\n<p>This way you won't have to loop through all the previously added rows, for every new row you evaluate.</p>\n"}, {"tags": [], "owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "is_accepted": true, "score": 1, "last_activity_date": 1471897574, "last_edit_date": 1471897574, "creation_date": 1471893708, "answer_id": 39087212, "question_id": 39086976, "link": "https://stackoverflow.com/questions/39086976/golang-csv-remove-duplicate-if-matching-column-values/39087212#39087212", "title": "golang csv remove duplicate if matching column values", "body": "<p>to add to @Kul's answer:</p>\n\n<pre><code>// i'm pretty sure struct{} is smaller in memory than bool:\nknown := make(map[string]struct{})\nfor name, band, year, err := parseMyLine(); err == nil; {\n  _, ok := known[name]\n  if !ok {\n    known[name]=struct{}{}\n    handleFirstSeenName(name, band, year)\n  }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1057, "user_id": 1750407, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/EobHJ.jpg?s=128&g=1", "display_name": "Wendy Adi", "link": "https://stackoverflow.com/users/1750407/wendy-adi"}, "is_accepted": false, "score": 0, "last_activity_date": 1471966321, "creation_date": 1471966321, "answer_id": 39105287, "question_id": 39086976, "link": "https://stackoverflow.com/questions/39086976/golang-csv-remove-duplicate-if-matching-column-values/39105287#39105287", "title": "golang csv remove duplicate if matching column values", "body": "<p>As @Kul mentioned, You can use <code>map[string]bool</code> Your code should look like this</p>\n\n<pre><code>csvFile, err := os.Open(\"csvFile.csv\")\nif err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n}\n\ndefer csvFile.Close()\n\nreader := csv.NewReader(csvFile)\n\nvar name string\nvar band string\nvar year string\n\nnameExistMap := make(map[string]bool)\n\ncsvRawData, err := reader.ReadAll()\nif err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n}\n\n\nfor r, row := range csvRawData {\n    name = r[0]\n    band = r[1]\n    year = r[2]\n\n    if _, exist := nameExistmap[name]; exist {\n        continue\n    } else {\n        nameExistmap[name] = true\n        //Do Your Output Here\n    }\n}    \n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 6744940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afc039e02c722761d59136fdbebd63f6?s=128&d=identicon&r=PG&f=1", "display_name": "PeterGabriel", "link": "https://stackoverflow.com/users/6744940/petergabriel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1209, "favorite_count": 0, "accepted_answer_id": 39087212, "answer_count": 3, "score": 0, "last_activity_date": 1471966321, "creation_date": 1471892687, "question_id": 39086976, "link": "https://stackoverflow.com/questions/39086976/golang-csv-remove-duplicate-if-matching-column-values", "title": "golang csv remove duplicate if matching column values", "body": "<p>New to Golang and struggling to figure out how to remove duplicates in CSVs if a particular column value matches another rows.</p>\n\n<p>My table has 3 columns \nname | band | year </p>\n\n<p>If a persons name appears twices or more I just want them to output them the once.</p>\n\n<p>I have only been able to output all the details in a for loop so I am guessing I need to push to a new array and compare from that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1471886875, "post_id": 39085358, "comment_id": 65518641, "body": "Why don&#39;t you pass <code>a.id</code> or <code>a.value</code> directly instead of the struct?"}, {"owner": {"reputation": 894, "user_id": 6078917, "user_type": "registered", "accept_rate": 22, "profile_image": "https://i.stack.imgur.com/HRZj4.jpg?s=128&g=1", "display_name": "ryan", "link": "https://stackoverflow.com/users/6078917/ryan"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1471887039, "post_id": 39085358, "comment_id": 65518725, "body": "let me revise the problem."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1471888822, "post_id": 39085358, "comment_id": 65519642, "body": "Your example has multiple compile errors, so it hard to know exactly what you are trying to do."}], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1471889991, "post_id": 39085641, "comment_id": 65520234, "body": "Idiomatic Go recommends using an error return value rather than magic numbers to indicate a failure to find."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1471890132, "post_id": 39085641, "comment_id": 65520308, "body": "@kaedys no it is not magic: like standard library: <code>strings.Index()</code> it returns the index of the first instance of item  in slice, or -1 if item is not present in slice. see: <code>func Index(s, sep string) int </code>"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 1, "last_activity_date": 1471891079, "last_edit_date": 1471891079, "creation_date": 1471887816, "answer_id": 39085641, "question_id": 39085358, "link": "https://stackoverflow.com/questions/39085358/how-to-pass-fields-of-a-struct-to-a-function/39085641#39085641", "title": "How to pass fields of a struct to a function?", "body": "<p>If you are looking for <code>func findByA(a []A, item A) (*A, error)</code>:   </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func findByA(a []A, item A) (*A, error) {\n    for i := 0; i &lt; len(a); i++ {\n        if a[i].id == item.id &amp;&amp; a[i].value == item.value {\n            return &amp;a[i], nil\n        }\n    }\n    return nil, errors.New(\"no such item\")\n}\n</code></pre>\n\n<p>Try this working sample code :  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"errors\"\n\ntype A struct {\n    id    int\n    value int\n}\n\nfunc findById(a []A, id int) (*A, error) {\n    for i := 0; i &lt; len(a); i++ {\n        if a[i].id == id {\n            return &amp;a[i], nil\n        }\n    }\n    return nil, errors.New(\"no such item\")\n}\n\nfunc findByValue(a []A, value int) (*A, error) {\n    for i := 0; i &lt; len(a); i++ {\n        if a[i].value == value {\n            return &amp;a[i], nil\n        }\n    }\n    return nil, errors.New(\"no such item\")\n}\n\nfunc findByIdValue(a []A, id, value int) (*A, error) {\n    for i := 0; i &lt; len(a); i++ {\n        if a[i].id == id &amp;&amp; a[i].value == value {\n            return &amp;a[i], nil\n        }\n    }\n    return nil, errors.New(\"no such item\")\n}\n\nfunc findByA(a []A, item A) (*A, error) {\n    for i := 0; i &lt; len(a); i++ {\n        if a[i].id == item.id &amp;&amp; a[i].value == item.value {\n            return &amp;a[i], nil\n        }\n    }\n    return nil, errors.New(\"no such item\")\n}\n\nfunc main() {\n\n    t := []A{A{1, 2}, A{3, 4}, A{5, 6}}\n\n    a, err := findById(t, 3)\n    if err == nil {\n        fmt.Println(*a) // {3 4}\n    }\n\n    a, err = findByValue(t, 4)\n    if err == nil {\n        fmt.Println(*a) // {3 4}\n    }\n\n    a, err = findByIdValue(t, 3, 4)\n    if err == nil {\n        fmt.Println(*a) // {3 4}\n    }\n\n    a, err = findByA(t, A{3, 4})\n    if err == nil {\n        fmt.Println(*a) // {3 4}\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>If you need the index of item, you may use receiver method, like this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\ntype A struct {\n    id    int\n    value int\n}\ntype SA []A\n\n//it returns the index of the first instance of item  in slice, or -1 if item is not present in slice.\nfunc (t SA) find(a A) int {\n    for i := 0; i &lt; len(t); i++ {\n        if t[i].id == a.id &amp;&amp; t[i].value == a.value {\n            return i\n        }\n    }\n    return -1\n}\n\nfunc main() {\n    t := SA{A{1, 2}, A{3, 4}, A{5, 6}}\n    i := t.find(A{3, 4})\n    if i == -1 {\n        fmt.Println(\"no such item\")\n        return\n    }\n    fmt.Println(\"t[\", i, \"] =\", t[i]) // t[ 1 ] = {3 4}\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>t[ 1 ] = {3 4}\n</code></pre>\n\n<hr>\n\n<p>If you need the index of item, you may use function, like this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\ntype A struct {\n    id    int\n    value int\n}\n\n//it returns the index of the first instance of item  in slice, or -1 if item is not present in slice.\nfunc find(t []A, a A) int {\n    for i := 0; i &lt; len(t); i++ {\n        if t[i].id == a.id &amp;&amp; t[i].value == a.value {\n            return i\n        }\n    }\n    return -1\n}\n\nfunc main() {\n    t := []A{A{1, 2}, A{3, 4}, A{5, 6}}\n    i := find(t, A{3, 4})\n    if i == -1 {\n        fmt.Println(\"no such item\")\n        return\n    }\n    fmt.Println(\"t[\", i, \"] =\", t[i]) // t[ 1 ] = {3 4}\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>t[ 1 ] = {3 4}\n</code></pre>\n"}], "owner": {"reputation": 894, "user_id": 6078917, "user_type": "registered", "accept_rate": 22, "profile_image": "https://i.stack.imgur.com/HRZj4.jpg?s=128&g=1", "display_name": "ryan", "link": "https://stackoverflow.com/users/6078917/ryan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1471898247, "creation_date": 1471886672, "last_edit_date": 1471898247, "question_id": 39085358, "link": "https://stackoverflow.com/questions/39085358/how-to-pass-fields-of-a-struct-to-a-function", "title": "How to pass fields of a struct to a function?", "body": "<p>I wonder if <code>findById</code> and <code>findByValue</code> can be combined to one function?  That is to pass the field in the struct in addition to the existing params?</p>\n\n<pre><code>import (\n\"fmt\"\n\"errors\"\n)\n\ntype A struct {\n    id    int\n    value int\n}\n\nfunc findById(as []A, i int) (*A, error) {\n    for _, a := range as {\n        if a.id == i {\n            return &amp;account, nil\n        }\n    }\n    return nil, errors.New(\"no such item\")\n}\n\nfunc findByValue(as []A, i int) (A, error) {\n    for _, a := range as {\n        if a.value == i {\n            return &amp;account, nil\n        }\n    }\n    return nil, errors.New(\"no such item\")\n}\n</code></pre>\n"}, {"tags": ["html", "go", "render"], "comments": [{"owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 0, "creation_date": 1471884427, "post_id": 39084466, "comment_id": 65517395, "body": "Check out <a href=\"https://github.com/sourcegraph/webloop\" rel=\"nofollow noreferrer\">github.com/sourcegraph/webloop</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1471888685, "post_id": 39084466, "comment_id": 65519570, "body": "Call PhantomJS from Go. There is no headless browser in Go (jet.)"}], "owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3036, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1471883302, "creation_date": 1471883302, "question_id": 39084466, "link": "https://stackoverflow.com/questions/39084466/save-rendered-html-to-image-in-golang-with-templating", "title": "Save Rendered HTML to Image in Golang with Templating", "body": "<p>I need to be able to build an html page and then save the rendered html output to an image. Before I switched to Go, I was accomplishing this with NodeJS and PhantomJS by building a \"headless\" webpage and capturing the image with a screenshot into an image file. I need to be able to do the same thing in Go. I know how to build the HTML template using the <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow\">html/template</a> package. But, I am lost on how I get essentially capture a screenshot of the rendered HTML and save it to an image with a specified width and height. This was fairly easy in PhantomJS by just calling the 'Render' method and passing the location of the image to save to. But, I can't find anyway to do this in Go.</p>\n\n<p>Any help is greatly appreciated!</p>\n"}, {"tags": ["arrays", "string", "loops", "go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1471878236, "post_id": 39082892, "comment_id": 65513584, "body": "What about a RegEx?"}, {"owner": {"reputation": 297, "user_id": 6676988, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/KwQCQ.png?s=128&g=1", "display_name": "jiji", "link": "https://stackoverflow.com/users/6676988/jiji"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1471878521, "post_id": 39082892, "comment_id": 65513790, "body": "Thanks for the reply! kinda hard for me, I&#39;m a noobie in programmation.."}, {"owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 0, "creation_date": 1471879837, "post_id": 39082892, "comment_id": 65514716, "body": "<a href=\"https://play.golang.org/p/dRfMfZhH7-\" rel=\"nofollow noreferrer\">play.golang.org/p/dRfMfZhH7-</a>"}, {"owner": {"reputation": 297, "user_id": 6676988, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/KwQCQ.png?s=128&g=1", "display_name": "jiji", "link": "https://stackoverflow.com/users/6676988/jiji"}, "edited": false, "score": 0, "creation_date": 1471938738, "post_id": 39082892, "comment_id": 65537675, "body": "Nice too,thanks!! you should post it on a separate answer"}], "answers": [{"comments": [{"owner": {"reputation": 297, "user_id": 6676988, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/KwQCQ.png?s=128&g=1", "display_name": "jiji", "link": "https://stackoverflow.com/users/6676988/jiji"}, "edited": false, "score": 0, "creation_date": 1472032690, "post_id": 39083049, "comment_id": 65586011, "body": "I was wondering why did u choose 0 as length of the slices in result := make([]string, 0, len(strs)) ? Thanks"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 297, "user_id": 6676988, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/KwQCQ.png?s=128&g=1", "display_name": "jiji", "link": "https://stackoverflow.com/users/6676988/jiji"}, "edited": false, "score": 0, "creation_date": 1472036344, "post_id": 39083049, "comment_id": 65588443, "body": "@jiji see detailed answer here: <a href=\"http://stackoverflow.com/a/39121360/6169399\">stackoverflow.com/a/39121360/6169399</a>"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1471879660, "last_edit_date": 1471879660, "creation_date": 1471878570, "answer_id": 39083049, "question_id": 39082892, "link": "https://stackoverflow.com/questions/39082892/iterating-over-go-string-to-extract-specific-substrings/39083049#39083049", "title": "Iterating over Go string to extract specific substrings", "body": "<p>You may use <code>strings.FieldsFunc</code>, like this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\nfunc find(input string) []string {\n    return strings.FieldsFunc(input, split)\n}\n\nfunc main() {\n    strs := find(\"p -(40) *(GOT) +(FF)\")\n    str := strings.Replace(fmt.Sprint(strs), \" \", \", \", -1)\n    fmt.Println(str)\n}\n\nfunc split(r rune) bool {\n    return r == ' ' || r == '-' || r == '(' || r == ')' || r == '*' || r == '+'\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[p, 40, GOT, FF]\n</code></pre>\n\n<hr>\n\n<p>You may use <code>strings.Fields</code> then <code>strings.Trim</code>, like this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\nfunc main() {\n    fmt.Println(find(\"p -(40) *(GOT) +(FF)\"))\n}\n\nfunc find(input string) []string {\n    strs := strings.Fields(input)\n    result := make([]string, 0, len(strs))\n\n    for _, v := range strs {\n        s := strings.Trim(v, \"()+-*\")\n        if len(s) &gt; 0 {\n            result = append(result, s)\n        }\n    }\n    return result\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[p 40 GOT FF]\n</code></pre>\n\n<hr>\n\n<p>Also this works for your special case:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\nfunc main() {\n    fmt.Println(find(\"p -(40) *(GOT) +(FF)\"))\n}\n\nfunc find(input string) []string {\n    strs := strings.Fields(input)\n    for i := 0; i &lt; len(strs); i++ {\n        strs[i] = strings.Trim(strs[i], \"()+-*\")\n    }\n    return strs\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[p 40 GOT FF]\n</code></pre>\n\n<hr>\n\n<p>And if you need output like this string: <code>[p, 40, GOT, FF]</code>, try this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\nfunc main() {\n    strs := find(\"p -(40) *(GOT) +(FF)\")\n    str := strings.Replace(fmt.Sprint(strs), \" \", \", \", -1)\n    fmt.Println(str)\n}\n\nfunc find(input string) []string {\n    strs := strings.Fields(input)\n    for i := 0; i &lt; len(strs); i++ {\n        strs[i] = strings.Trim(strs[i], \"()+-*\")\n    }\n    return strs\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[p, 40, GOT, FF]\n</code></pre>\n\n<hr>\n"}], "owner": {"reputation": 297, "user_id": 6676988, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/KwQCQ.png?s=128&g=1", "display_name": "jiji", "link": "https://stackoverflow.com/users/6676988/jiji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 39083049, "answer_count": 1, "score": 0, "last_activity_date": 1471880254, "creation_date": 1471878130, "last_edit_date": 1471880254, "question_id": 39082892, "link": "https://stackoverflow.com/questions/39082892/iterating-over-go-string-to-extract-specific-substrings", "title": "Iterating over Go string to extract specific substrings", "body": "<p>I started learning Go and I want to implement some algorithm. \nI want to iterate over a string and then extract some substrings for example : <code>p -(40) *(GOT) +(FF)</code>\nshould return an array like this: <code>[p, 40, GOT, FF]</code></p>\n\n<p>I wrote something like this but it's vague:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"strings\"\n\n) \n\nfunc find(input string){\n    var result []string\n    a := strings.SplitN(input, \"-(\", 2);\n    result[0] = a[0]\n    b := strings.SplitN(a[1], \") *(\", 2)\n    result[1] = b[0]\n    c := strings.SplitN(a[1], \") +(\", 2)\n    result[2] = c[0]\n    d := strings.SplitN(a[1], \")\", 2)\n    result[3] = d[0]\n}\n</code></pre>\n\n<p>Can someone please correct me or suggest something easier? Thanks!</p>\n"}, {"tags": ["http", "go", "request", "packet", "payload"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1471877435, "post_id": 39082404, "comment_id": 65513001, "body": "Do you mean you want to check if a packet has the <i>start</i> of an HTTP request? A single request is likely to span multiple packets."}, {"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1471877650, "post_id": 39082404, "comment_id": 65513175, "body": "Yes, let&#39;s go for the simple case where the payload has only one HTTP request and without missing parts"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1471878502, "post_id": 39082404, "comment_id": 65513777, "body": "Yes, if the payload contains a the complete request you can feed it to <code>http.ReadRequst</code>. This simpler case isn&#39;t really useful, since you&#39;re operating on individual packets of a TCP stream. It fails immediately when you consider the possibility that a request can start in the middle of the packet payload, and it&#39;s still very likely that the request will span multiple packets. HTTP is at a higher level than TCP, and you need to reassemble the stream (flow) before you can parse the HTTP correctly."}], "answers": [{"tags": [], "owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "is_accepted": true, "score": 1, "last_activity_date": 1508401469, "last_edit_date": 1508401469, "creation_date": 1472139441, "answer_id": 39149407, "question_id": 39082404, "link": "https://stackoverflow.com/questions/39082404/golang-how-to-check-if-an-http-request-is-in-the-tcp-payload-bytes/39149407#39149407", "title": "Golang: how to check if an HTTP request is in the TCP payload bytes", "body": "<p>With help from this question: <a href=\"https://stackoverflow.com/questions/22561661/how-to-parse-http-headers-in-go\">How to parse http headers in Go</a> the following attempt with <code>http.ReadRequest()</code> works...</p>\n\n<pre><code>if tcpLayer := packet.Layer(layers.LayerTypeTCP); tcpLayer != nil {\n   tcp, _ := tcpLayer.(*layers.TCP)\n   if len(tcp.Payload) != 0 {\n      reader := bufio.NewReader(bytes.NewReader(tcp.Payload))\n      httpReq, err := http.ReadRequest(reader)\n      ...\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1982, "favorite_count": 1, "accepted_answer_id": 39149407, "answer_count": 1, "score": 1, "last_activity_date": 1508830195, "creation_date": 1471876818, "last_edit_date": 1508830195, "question_id": 39082404, "link": "https://stackoverflow.com/questions/39082404/golang-how-to-check-if-an-http-request-is-in-the-tcp-payload-bytes", "title": "Golang: how to check if an HTTP request is in the TCP payload bytes", "body": "<p>I am using the <a href=\"https://godoc.org/github.com/google/gopacket\" rel=\"nofollow\">gopacket</a> package and every time I have a TCP packet I want to check if the payload contains an HTTP request. Is there an easy way to do that instead of writing my own parser? There is also a function (see: <a href=\"https://golang.org/pkg/net/http/#ReadRequest\" rel=\"nofollow\">func ReadRequest(b *bufio.Reader)</a>) which returns a <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow\">Request</a> struct but I do not know what kind of input I should use. <code>tcp.Payload</code> is the byte[] array that seems to have the information I need to parse (see the following example):</p>\n\n<pre><code>// Get the TCP layer from this packet\nif tcpLayer := packet.Layer(layers.LayerTypeTCP); tcpLayer != nil {\n    fmt.Printf(\"TCP \")\n    // Get actual TCP data from this layer\n    tcp, _ := tcpLayer.(*layers.TCP)\n    srcPort = tcp.SrcPort\n    dstPort = tcp.DstPort\n    if tcp.SYN {\n        fmt.Print(\"[SYN] \")\n    }\n    if tcp.ACK {\n        fmt.Print(\"[ACK] \")\n    }\n    if tcp.FIN {\n        fmt.Print(\"[FIN] \")\n    }\n    fmt.Printf(\"%s:%d &gt; %s:%d \", srcIP, srcPort, dstIP, dstPort)\n\n    fmt.Println(string(tcp.Payload))\n}\n</code></pre>\n\n<p>After sending an HTTP request I get the following output:</p>\n\n<pre><code>PKT [001] TCP [SYN] 192.168.2.6:59095 &gt; 192.168.3.5:80\nPKT [002] TCP [SYN] [ACK] 192.168.3.5:80 &gt; 192.168.2.6:59095\nPKT [003] TCP [ACK] 192.168.2.6:59095 &gt; 192.168.3.5:80\nPKT [004] TCP [ACK] 192.168.2.6:59095 &gt; 192.168.3.5:80 GET /certificates/test.pdf HTTP/1.1\nUser-Agent: Wget/1.15 (linux-gnu)\nAccept: */*\nHost: 192.168.3.5\nConnection: Keep-Alive\n</code></pre>\n\n<p>Any suggestions are welcome...</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5926, "user_id": 174843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e90f42b582744131475090c31d95551?s=128&d=identicon&r=PG", "display_name": "Vince Bowdren", "link": "https://stackoverflow.com/users/174843/vince-bowdren"}, "edited": false, "score": 0, "creation_date": 1471954681, "post_id": 39080652, "comment_id": 65548432, "body": "I have restructured your question a little, to make it clearer what you are asking. If you feel you can improve it further, please <a href=\"https://stackoverflow.com/posts/39080652/edit\">edit</a> the question - users on this site are encouraged to re-edit their questions to improve them as much as possible."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1471872739, "last_edit_date": 1471872739, "creation_date": 1471872107, "answer_id": 39080734, "question_id": 39080652, "link": "https://stackoverflow.com/questions/39080652/how-to-check-if-a-string-has-a-more-than-n-repetitive-patterns-in-go/39080734#39080734", "title": "How to check if a string has a more than n repetitive patterns in GO?", "body": "<p>Use the \"repetitions\" modifier.</p>\n\n<pre><code>re := regexp.MustCompile(`(xy){3,}`)      // match \"xy\" 3 or more times\nfmt.Println(re.MatchString(\"abxyxyns\"))   // false\nfmt.Println(re.MatchString(\"abxyxyxyns\")) // true\n</code></pre>\n\n<p>The available options for the regpexp package's RE2 implementation are documented here:</p>\n\n<p><a href=\"https://github.com/google/re2/wiki/Syntax\" rel=\"nofollow\">https://github.com/google/re2/wiki/Syntax</a></p>\n"}], "owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 39080734, "answer_count": 1, "score": -1, "last_activity_date": 1471954681, "creation_date": 1471871862, "last_edit_date": 1471954681, "question_id": 39080652, "link": "https://stackoverflow.com/questions/39080652/how-to-check-if-a-string-has-a-more-than-n-repetitive-patterns-in-go", "title": "How to check if a string has a more than n repetitive patterns in GO?", "body": "<p>I want to check if a string contains repetitive patterns above a threshold .</p>\n\n<p>For example, these two strings both exceed a threshold of 2:</p>\n\n<pre><code>\"xyzxyzxyz\" // contains \"xyz\" 3 times in succession\n\"abxyxyxyns\" //  contains \"xy\" 3 times in succession\n</code></pre>\n\n<p>Does anyone know how this is possible?</p>\n"}, {"tags": ["json", "go", "struct", "dry"], "answers": [{"comments": [{"owner": {"reputation": 129, "user_id": 6743038, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8b1f7c217b2b5516a0c139448c1711bc?s=128&d=identicon&r=PG&f=1", "display_name": "user6743038", "link": "https://stackoverflow.com/users/6743038/user6743038"}, "edited": false, "score": 0, "creation_date": 1471862246, "post_id": 39077217, "comment_id": 65502163, "body": "Thanks. That seem to be working solution for me.  When I said about public and admin access, I meant roles of my app users, so depending on user role I either return Foo or FooPublic as json."}, {"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1471908891, "post_id": 39077217, "comment_id": 65528260, "body": "Yeah, you don&#39;t need that <code>Public()</code> method at all. If you have <code>type Foo struct { FooPublic; AdminOnly string; }</code> then you can get at the embedded <code>FooPublic</code> value of <code>var foo Foo</code> with <code>foo.FooPublic</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1471862153, "last_edit_date": 1471862153, "creation_date": 1471861850, "answer_id": 39077217, "question_id": 39077015, "link": "https://stackoverflow.com/questions/39077015/override-struct-tags-in-go/39077217#39077217", "title": "Override struct tags in go", "body": "<p>In general this repetition can be avoided by using <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow\">embedding</a>. Your <code>Foo</code> type should embed <code>FooPublic</code>:</p>\n\n<pre><code>type FooPublic struct {\n    Id        bson.ObjectId `json:\"id\" bson:\"_id\"`\n    DateAdded time.Time     `json:\"date_added\" bson:\"date_added\"`\n    Bar       string        `json:\"bar\" bson:\"bar\"`      \n}\n\ntype Foo struct {\n    FooPublic\n    AdminOnly string `json:\"admin_only\" bson:\"admin_only\"`\n}\n\nfunc (f *Foo) Public() FooPublic {\n    return f.FooPublic\n}\n</code></pre>\n\n<p>But if someone is able to call the <code>Foo.Public()</code>, that someone already has the <code>Foo</code> or <code>*Foo</code> value (and so can access the exported <code>AdminOnly</code> field), so what's the point?</p>\n\n<p>A better solution would be to use an interface, and not expose the <code>Foo</code> struct.</p>\n"}], "owner": {"reputation": 129, "user_id": 6743038, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8b1f7c217b2b5516a0c139448c1711bc?s=128&d=identicon&r=PG&f=1", "display_name": "user6743038", "link": "https://stackoverflow.com/users/6743038/user6743038"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1243, "favorite_count": 1, "accepted_answer_id": 39077217, "answer_count": 1, "score": 3, "last_activity_date": 1475436614, "creation_date": 1471861286, "last_edit_date": 1475436614, "question_id": 39077015, "link": "https://stackoverflow.com/questions/39077015/override-struct-tags-in-go", "title": "Override struct tags in go", "body": "<p>I have an entity in my project that is viewable by public and by admin. Not all fields should be accessible by public.</p>\n\n<p>For example</p>\n\n<pre><code>type Foo struct {\n    Id        bson.ObjectId `json:\"id\" bson:\"_id\"`\n    DateAdded time.Time     `json:\"date_added\" bson:\"date_added\"`\n    Bar       string `json:\"bar\" bson:\"bar\"`      \n    AdminOnly string        `json:\"admin_only\" bson:\"admin_only\"`\n}\n</code></pre>\n\n<p>AdminOnly field should be only visible to admins.\nFor now, when requests comes from public, I call separate method that copies every needed field to new struct</p>\n\n<pre><code>type FooPublic struct {\n    Id        bson.ObjectId `json:\"id\" bson:\"_id\"`\n    DateAdded time.Time     `json:\"date_added\" bson:\"date_added\"`\n    Bar       string `json:\"bar\" bson:\"bar\"`\n}\n\nfunc (f *Foo) Public() (res FooPublic) {\n    res = FooPublic{\n        Id: f.Id,\n        DateAdded: f.DateAdded,\n        Bar:f.Bar,\n    }\n    return\n}\n</code></pre>\n\n<p>But if I need to add new field to my entity, I need to add it in 3 places. In struct itself, in <code>PublicFoo</code> and in <code>Public</code> method.<br>\nThis seems to be agains DRY principle. What is correct, idiomatic solution here? Can I define <code>FooPublic</code> so it overrides tags of needed fields? Or probably there is at least good way to copy corresponding fields from one struct to another, so I don't need to do this manually in <code>Public</code> method?</p>\n"}, {"tags": ["go", "sap", "hana"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1471859034, "post_id": 39076067, "comment_id": 65500083, "body": "It looks you&#39;re passing arguments in the wrong order to <code>rows.Scan()</code>, maybe at index <code>5</code> (zero-based) should be <code>datum</code> and not <code>ukurs</code>?"}, {"owner": {"reputation": 3342, "user_id": 2396080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f87b2bad1b2bad183526fe4a4464d207?s=128&d=identicon&r=PG", "display_name": "rudy s", "link": "https://stackoverflow.com/users/2396080/rudy-s"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1471859223, "post_id": 39076067, "comment_id": 65500226, "body": "sorry, but from index 0 is mandt, kurst, fcurr, tcurr, gdatu, and then ukurs is index 5 (zero based)"}], "answers": [{"tags": [], "owner": {"reputation": 3342, "user_id": 2396080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f87b2bad1b2bad183526fe4a4464d207?s=128&d=identicon&r=PG", "display_name": "rudy s", "link": "https://stackoverflow.com/users/2396080/rudy-s"}, "is_accepted": true, "score": 0, "last_activity_date": 1473413479, "creation_date": 1473413479, "answer_id": 39408325, "question_id": 39076067, "link": "https://stackoverflow.com/questions/39076067/convert-decimal-to-string-retrieve-from-sap-hana-db-using-go-hdb-driver-in-golan/39408325#39408325", "title": "Convert decimal to string retrieve from SAP HANA db using go-hdb driver in golang", "body": "<p>After to look and understand the driver package a while, I found out there is a function that actually answered my question. The function is reside within <code>decimal.go</code> with function name <code>decodeDecimal()</code>. Due to it is used by internal only, I copy the source code and paste to my code.</p>\n\n<p>The code is something like this:</p>\n\n<pre><code>var mandt, kurst, fcurr, tcurr, gdatu, datum string\nvar ukurs, ffact, tfact []byte\nif err := rows.Scan(&amp;mandt, &amp;kurst, &amp;fcurr, &amp;tcurr, &amp;gdatu, &amp;ukurs, &amp;ffact, &amp;tfact, &amp;datum); err != nil {\n   WriteMsg(\"SCAN\")\n   log.Fatal(err)\n}\n\nvar bi big.Int\nvar z float64\nvar neg bool\nvar i int\n\nvar record []string\n\nrecord = append(record, mandt)\nrecord = append(record, kurst)\nrecord = append(record, fcurr)\nrecord = append(record, tcurr)\nrecord = append(record, gdatu)\n\n// ukurs\nneg, i = decodeDecimal(ukurs, &amp;bi)\nz = BigIntToFloat(neg, &amp;bi, i)\nrecord = append(record, fmt.Sprintf(\"%.4f\", z))\n\n// ffact\nneg, i = decodeDecimal(ffact, &amp;bi)\nz = BigIntToFloat(neg, &amp;bi, i)\nrecord = append(record, fmt.Sprintf(\"%.4f\", z))\n\n// tfact\nneg, i = decodeDecimal(tfact, &amp;bi)\nz = BigIntToFloat(neg, &amp;bi, i)\nrecord = append(record, fmt.Sprintf(\"%.4f\", z))\n\nrecord = append(record, datum)\n</code></pre>\n\n<p>Function of <code>decodeDecimal()</code></p>\n\n<pre><code>func decodeDecimal(b []byte, m *big.Int) (bool, int) {\n\n    //bigint word size (*--&gt; src/pkg/math/big/arith.go)\n        const (\n        dec128Bias = 6176\n        // Compute the size _S of a Word in bytes.\n        _m    = ^big.Word(0)\n        _logS = _m&gt;&gt;8&amp;1 + _m&gt;&gt;16&amp;1 + _m&gt;&gt;32&amp;1\n        _S    = 1 &lt;&lt; _logS\n    )\n\n    neg := (b[15] &amp; 0x80) != 0\n    exp := int((((uint16(b[15])&lt;&lt;8)|uint16(b[14]))&lt;&lt;1)&gt;&gt;2) - dec128Bias\n\n    b14 := b[14]  // save b[14]\n    b[14] &amp;= 0x01 // keep the mantissa bit (rest: sign and exp)\n\n    //most significand byte\n    msb := 14\n    for msb &gt; 0 {\n        if b[msb] != 0 {\n            break\n        }\n        msb--\n    }\n\n    //calc number of words\n    numWords := (msb / _S) + 1\n    w := make([]big.Word, numWords)\n\n    k := numWords - 1\n    d := big.Word(0)\n    for i := msb; i &gt;= 0; i-- {\n        d |= big.Word(b[i])\n        if k*_S == i {\n            w[k] = d\n            k--\n            d = 0\n        }\n        d &lt;&lt;= 8\n    }\n    b[14] = b14 // restore b[14]\n    m.SetBits(w)\n    return neg, exp\n}\n</code></pre>\n\n<p>Function <code>BigIntToFloat()</code></p>\n\n<pre><code>func BigIntToFloat(sign bool, m *big.Int, exp int) float64 {\n    var neg int64\n    if sign {\n        neg = -1\n    } else {\n        neg = 1\n    }\n\n    return float64(neg*m.Int64()) * math.Pow10(exp)\n}\n</code></pre>\n"}], "owner": {"reputation": 3342, "user_id": 2396080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f87b2bad1b2bad183526fe4a4464d207?s=128&d=identicon&r=PG", "display_name": "rudy s", "link": "https://stackoverflow.com/users/2396080/rudy-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 706, "favorite_count": 0, "accepted_answer_id": 39408325, "answer_count": 1, "score": 1, "last_activity_date": 1473413479, "creation_date": 1471858671, "last_edit_date": 1471873940, "question_id": 39076067, "link": "https://stackoverflow.com/questions/39076067/convert-decimal-to-string-retrieve-from-sap-hana-db-using-go-hdb-driver-in-golan", "title": "Convert decimal to string retrieve from SAP HANA db using go-hdb driver in golang", "body": "<p>I am new to Golang (but not on HANA), and I am trying to test out the go-hdb to pull out data from <strong>TCURR</strong> table (from HANA DB SPS6). From what I understand is in that table, <em>UKURS</em>, <em>FFACT</em>, and <em>TFACT</em> are all Decimals in HANA DB. \nHowever when retrieving from Go, which I tried fetch using row.Scan to Float64 like this:</p>\n\n<pre><code>var mandt, kurst, fcurr, tcurr, gdatu, datum string\nvar ukurs float64\nvar ffact, tfact float64\n\nif err := rows.Scan(&amp;mandt, &amp;kurst, &amp;fcurr, &amp;tcurr, &amp;gdatu, &amp;ukurs, &amp;ffact, &amp;tfact, &amp;datum); err != nil {\n   log.Fatal(err)\n}\n</code></pre>\n\n<p>But alas, getting error like this</p>\n\n<pre><code>2016/08/18 10:18:31 sql: Scan error on column index 5: converting driver.Value type []uint8 (\"@\\xe2\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x0060\") to a float64: invalid syntax\n</code></pre>\n\n<p>I try to read and understand the error it looks like needs uint8 data type (or byte), however, I am stuck with how to convert those uint8/byte into string.</p>\n\n<p>Is there anyone have this problem before and how to getting decimal data and displayed it properly (ie print them into console)?</p>\n"}, {"tags": ["variables", "pointers", "go", "slice"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1471855003, "post_id": 39074031, "comment_id": 65497367, "body": "Index <code>j</code> does not exist in slice <code>m</code>. I would add some print statements to see where it goes wrong.."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1471855595, "post_id": 39074031, "comment_id": 65497774, "body": "Also <code>for j := 0; j &lt; 8; j++ {</code> -&gt; <code>m[j]</code> is asking for trouble if you are not absolutly sure of <code>m</code> having 8 or more indices. Better is <code>for currval := range m {</code>"}, {"owner": {"reputation": 67, "user_id": 6643210, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa44986fcb2caa1a389735cf23744508?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/6643210/manu"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1471858398, "post_id": 39074031, "comment_id": 65499640, "body": "In the variable m there are definitely 8  values, including zeros for negative positions that is why i included the statement m[j]!=0. @RickyA"}], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 6643210, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa44986fcb2caa1a389735cf23744508?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/6643210/manu"}, "edited": false, "score": 0, "creation_date": 1471867918, "post_id": 39076326, "comment_id": 65505921, "body": "That is the reason I use currentvalue-1 for IsVisitedNode function. @RickyA"}, {"owner": {"reputation": 67, "user_id": 6643210, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa44986fcb2caa1a389735cf23744508?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/6643210/manu"}, "edited": false, "score": 0, "creation_date": 1471875961, "post_id": 39076326, "comment_id": 65511927, "body": "I did try that but the Program exits after Printing just the three values."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "reply_to_user": {"reputation": 67, "user_id": 6643210, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa44986fcb2caa1a389735cf23744508?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/6643210/manu"}, "edited": false, "score": 0, "creation_date": 1471877193, "post_id": 39076326, "comment_id": 65512826, "body": "of witch the last is 64, that is not a valid index in <code>visithistory</code> because the last index there is 63."}], "tags": [], "owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "is_accepted": false, "score": 1, "last_activity_date": 1471859404, "creation_date": 1471859404, "answer_id": 39076326, "question_id": 39074031, "link": "https://stackoverflow.com/questions/39074031/appending-a-pointer-to-a-slice-in-golang/39076326#39076326", "title": "Appending a pointer to a Slice in Golang", "body": "<p>You have a off by one error.\nIn main you set <code>Y.currentvalue = 1</code>.\nThen in <code>Tree</code> currentvalue walks to <code>64</code>.</p>\n\n<pre><code>X.currentvalue = m[j]\nfmt.Printf(\"cv: %v\\n\",X.currentvalue) //walks to 64\nif IsvisitedNode(m[j]) {\n</code></pre>\n\n<p>An in <code>IsvisitedNode</code> you test that index against <code>visithistory</code> that has 64 indexes, thus stops at index 63. -> index error</p>\n\n<pre><code>var visithistory [64]bool\n\nfunc IsvisitedNode(position int) bool {\n    if visithistory[position] == true {\n</code></pre>\n\n<p>Things work if you set <code>var visithistory [65]bool</code> but I think you need to rethink you logic here somewhat.</p>\n"}], "owner": {"reputation": 67, "user_id": 6643210, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/aa44986fcb2caa1a389735cf23744508?s=128&d=identicon&r=PG&f=1", "display_name": "Manu", "link": "https://stackoverflow.com/users/6643210/manu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 879, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1471959894, "creation_date": 1471852472, "last_edit_date": 1471959894, "question_id": 39074031, "link": "https://stackoverflow.com/questions/39074031/appending-a-pointer-to-a-slice-in-golang", "title": "Appending a pointer to a Slice in Golang", "body": "<p>I want to append a pointer to a slice.Is it possible..?In Partentnode.children is a slice I want to append it with X as pointer.</p>\n\n<p><a href=\"https://play.golang.org/p/ghWtxWGOAU\" rel=\"nofollow\">https://play.golang.org/p/ghWtxWGOAU</a></p>\n\n<pre><code>func Tree(Parentnode *Node) {\n    if IsvisitedNode(Parentnode.currentvalue - 1) {\n        m := MovesArray[Parentnode.currentvalue-1]\n        for j := 0; j &lt; 8; j++ {\n            if m[j] != 0 {\n                var X *Node\n                X.parentnode = Parentnode\n                X.currentvalue = m[j]\n                if IsvisitedNode(m[j]) {\n                    Parentnode.children = append(Parentnode.children, *X)\n                    Tree(X)\n                }\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["function", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1471856158, "last_edit_date": 1471856158, "creation_date": 1471851652, "answer_id": 39073811, "question_id": 39073756, "link": "https://stackoverflow.com/questions/39073756/go-functions-accessed-through-variables/39073811#39073811", "title": "Go functions accessed through variables", "body": "<p>1 - You can't call builtin methods \"attached\" to types or values, e.g.</p>\n\n<pre><code>m := map[int]string{1: \"one\"}\nm.delete(1)\n</code></pre>\n\n<p>is a compile time error which you can <a href=\"https://play.golang.org/p/8zZNSLmywJ\" rel=\"nofollow\">verify easily</a>.</p>\n\n<p>2 - <a href=\"https://golang.org/doc/faq#generics\" rel=\"nofollow\">Go doesn't have generics.</a> But to ease the \"pain\", it provides several <a href=\"https://golang.org/pkg/builtin/\" rel=\"nofollow\">builtin</a> functions which can accept values of different types. They are builtin because \u2013as mentioned\u2013 due to the lack of generics, they need the help of the compiler to be able to accept values of different types. Some also accept a type instead of an expression as the first argument (e.g. <code>make([]int, 1)</code>) which is also something you can't create. Builtin functions do not have standard Go types, they can only appear in <a href=\"https://golang.org/ref/spec#Calls\" rel=\"nofollow\">call expressions</a>.</p>\n\n<p>You can't create such functions that accept values of different types. Having said that, when you create your own type and you create a \"function\" for it, it is advisable to declare it as a <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow\">method</a> instead of a helper function; as if the \"function\" operates on your concrete type, you could not use it for other types anyway.</p>\n\n<p>So it makes sense to declare it as a method, and then you can call it more \"elegantly\" like</p>\n\n<pre><code>value.Method()\n</code></pre>\n\n<p>Being a method also \"counts\" toward the <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow\">method set</a> of the type, should you need to implement an interface, e.g. in case of your <code>MyCoolLinkedList</code> it would make sense to implement <a href=\"https://golang.org/pkg/sort/#Interface\" rel=\"nofollow\"><code>sort.Interface</code></a> to be able to sort the list, which requires a <code>Len() int</code> method for example.</p>\n\n<p>Choosing a method over a helper function also has the advantage that your method will be available via reflection. You can list and call methods of a type using the <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow\"><code>reflect</code></a> package, but you can't do the same with \"just\" functions.</p>\n"}], "owner": {"reputation": 3261, "user_id": 1818847, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/fPeO9.jpg?s=128&g=1", "display_name": "Mario Stoilov", "link": "https://stackoverflow.com/users/1818847/mario-stoilov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 39073811, "answer_count": 1, "score": 2, "last_activity_date": 1471856158, "creation_date": 1471851443, "last_edit_date": 1471851945, "question_id": 39073756, "link": "https://stackoverflow.com/questions/39073756/go-functions-accessed-through-variables", "title": "Go functions accessed through variables", "body": "<p>I am just starting to study Go and some things caught my attention.</p>\n\n<p>Functions like:</p>\n\n<pre><code>delete(map, \"Answer\") // for maps\nappend(slice, 0) // for slices\nlen(slice), cap(slice) // again for slices\n</code></pre>\n\n<p>and so on. As someone coming from C like languages, I am wondering:</p>\n\n<p>1) Can these functions be called through the variable itself (as in <code>map.delete(\"Answer\")</code>)?</p>\n\n<p>2) Is this a common practice (defining a generic function and let it figure out the type and what it should do), or is this just for the built in types. For example, if I would define my own type, like <code>MyCoolLinkedList</code>, should I define the <code>len</code> and append functions inside the type and have them called like </p>\n\n<pre><code>list := new(MyCoolLinkedList)\nlist.len()\n</code></pre>\n\n<p>or should I define a function that receives the list, like:</p>\n\n<pre><code>len(list)\n</code></pre>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1471847957, "post_id": 39072675, "comment_id": 65493559, "body": "You can simply pass <code>nil</code> for parent key: <code>datastore.NewKey(ctx, &quot;B&quot;, &quot;stringID&quot;, 0, nil)</code>"}, {"owner": {"reputation": 38473, "user_id": 821657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/qDRGg.png?s=128&g=1", "display_name": "Andrei Volgin", "link": "https://stackoverflow.com/users/821657/andrei-volgin"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 2, "creation_date": 1471848063, "post_id": 39072675, "comment_id": 65493618, "body": "@abhink: If you pass nil, this entity will not have a parent. An entity cannot change its parent."}], "answers": [{"comments": [{"owner": {"reputation": 6586, "user_id": 256405, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/420ecb69f4d50ee66160e01e4071be6e?s=128&d=identicon&r=PG", "display_name": "Morrowless", "link": "https://stackoverflow.com/users/256405/morrowless"}, "edited": false, "score": 0, "creation_date": 1471848469, "post_id": 39072773, "comment_id": 65493825, "body": "I was hoping to be able to do a partial key name search or something like that. By my design, stringID is unique, so thats how I test if B exists. I guess I will just make a key reference to B, although I will lose strong consistency."}], "tags": [], "owner": {"reputation": 38473, "user_id": 821657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/qDRGg.png?s=128&g=1", "display_name": "Andrei Volgin", "link": "https://stackoverflow.com/users/821657/andrei-volgin"}, "is_accepted": true, "score": 2, "last_activity_date": 1471848109, "creation_date": 1471848109, "answer_id": 39072773, "question_id": 39072675, "link": "https://stackoverflow.com/questions/39072675/how-to-query-for-entity-with-key-whose-ancestor-is-not-known/39072773#39072773", "title": "How to query for entity with key whose ancestor is not known?", "body": "<p>Ancestor entity may not exist, but its ID or Name must be known. Otherwise you will not be able to create a unique key for a child entity. Note that child of A and child of B may have the same ID or Name.</p>\n\n<p>Also note that you may delete one entity and create a new one, but you cannot change the parent of an entity once it's created.</p>\n"}, {"comments": [{"owner": {"reputation": 6586, "user_id": 256405, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/420ecb69f4d50ee66160e01e4071be6e?s=128&d=identicon&r=PG", "display_name": "Morrowless", "link": "https://stackoverflow.com/users/256405/morrowless"}, "edited": false, "score": 0, "creation_date": 1471850190, "post_id": 39073084, "comment_id": 65494696, "body": "I can indeed to a keys-only query. Thanks for the idea. Technically I can create key for a, but I would be ignoring an a-&gt;b group if it does exist."}, {"owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "reply_to_user": {"reputation": 6586, "user_id": 256405, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/420ecb69f4d50ee66160e01e4071be6e?s=128&d=identicon&r=PG", "display_name": "Morrowless", "link": "https://stackoverflow.com/users/256405/morrowless"}, "edited": false, "score": 0, "creation_date": 1471850399, "post_id": 39073084, "comment_id": 65494810, "body": "The key creation paragraph was only answering the &quot;&#39;A&#39; may not exist, so what do I do here?&quot; comment in the code which I interpreted as part of the question :)"}], "tags": [], "owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "is_accepted": false, "score": 1, "last_activity_date": 1471849222, "creation_date": 1471849222, "answer_id": 39073084, "question_id": 39072675, "link": "https://stackoverflow.com/questions/39072675/how-to-query-for-entity-with-key-whose-ancestor-is-not-known/39073084#39073084", "title": "How to query for entity with key whose ancestor is not known?", "body": "<p>You can <a href=\"https://cloud.google.com/appengine/docs/go/datastore/creating-entity-keys\" rel=\"nofollow\">create a key</a> for <code>a</code> without actually creating the <code>a</code> entity (the entity is only created when you call <code>datastore.Put()</code>). You can then use that key to create <code>b</code> (or just its key, if so you desire).</p>\n\n<p>As for the query aspect: you could do a <a href=\"https://cloud.google.com/appengine/docs/go/datastore/queries#keys-only_queries\" rel=\"nofollow\">keys-only query</a> for all entities of B type, then for each key check if the key's stringID matches your desired <code>stringID</code>. You can get multiple results - for entities with different ancestors - stringID is unique <strong>only for the same ancestor</strong> (or no ancestor at all).</p>\n"}], "owner": {"reputation": 6586, "user_id": 256405, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/420ecb69f4d50ee66160e01e4071be6e?s=128&d=identicon&r=PG", "display_name": "Morrowless", "link": "https://stackoverflow.com/users/256405/morrowless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 39072773, "answer_count": 2, "score": 0, "last_activity_date": 1471849222, "creation_date": 1471847647, "last_edit_date": 1471847966, "question_id": 39072675, "link": "https://stackoverflow.com/questions/39072675/how-to-query-for-entity-with-key-whose-ancestor-is-not-known", "title": "How to query for entity with key whose ancestor is not known?", "body": "<p><code>A</code> is ancestor of <code>B</code></p>\n\n<pre><code>type A struct {}\ntype B struct {}\n</code></pre>\n\n<p>How would I search for <code>B</code> whose string ID is <code>stringID</code>, regardless of ancestor? (B and ancestor A may not even exist)</p>\n\n<pre><code>ctx := appengine.NewContext(r)\na := ??? // 'A' may not exist, so what do I do here?\nk := datastore.NewKey(ctx, \"B\", \"stringID\", 0, a)\ne := new(B)\nif err := datastore.Get(ctx, k, e); err != nil {\n    http.Error(w, err.Error(), 500)\n    return\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "is_accepted": false, "score": 0, "last_activity_date": 1471840502, "creation_date": 1471840502, "answer_id": 39071490, "question_id": 39071416, "link": "https://stackoverflow.com/questions/39071416/how-to-create-python-like-dictionaries-with-go/39071490#39071490", "title": "How to create Python like dictionaries with Go?", "body": "<p>The maps you're creating are map[string]string.  You probably want map[string]interface{} instead to specify generic pointer types.</p>\n\n<p>Note that you'll need some casts and syntactic sugar to coerce the *chunk and strings in there.  Play with it a bit--you'll figure it out :-)</p>\n"}, {"tags": [], "owner": {"reputation": 2527, "user_id": 3476121, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/1c621706e2e37eed4f82f074af9f706a?s=128&d=identicon&r=PG", "display_name": "sadlil", "link": "https://stackoverflow.com/users/3476121/sadlil"}, "is_accepted": true, "score": 12, "last_activity_date": 1471840842, "creation_date": 1471840842, "answer_id": 39071538, "question_id": 39071416, "link": "https://stackoverflow.com/questions/39071416/how-to-create-python-like-dictionaries-with-go/39071538#39071538", "title": "How to create Python like dictionaries with Go?", "body": "<p>Go is a statically typed language. So you can not create dynamic maps. You defined your maps as <code>map[string]string</code> so your map key and values needs to be string.</p>\n\n<p>You can use <code>map[string]interface{}</code> to use a map dynamically. But whenever you use the value you need to cast it in your desired type.</p>\n\n<p>As example</p>\n\n<pre><code>chunk := map[string]interface{}{\n    \"code\": \"5000\",\n    \"error\": err,\n    \"a\": 5,\n    \"b\": 7,\n}\n\nintvalue := chunk[\"a\"].(int)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": false, "score": 2, "last_activity_date": 1518259092, "creation_date": 1518259092, "answer_id": 48719810, "question_id": 39071416, "link": "https://stackoverflow.com/questions/39071416/how-to-create-python-like-dictionaries-with-go/48719810#48719810", "title": "How to create Python like dictionaries with Go?", "body": "<p><a href=\"https://stackoverflow.com/a/39071538/1924666\">@sadlil</a> gave a correct answer. But I want to add one additional case.</p>\n\n<p>In python, a dictionary can be like this too</p>\n\n<pre><code>dict = {\"key1\":\"value\", 1: \"one\", \"key2\": 2, (1,2,3): False}\n</code></pre>\n\n<p>where not only value, but also key can be different type in a same dictionary.</p>\n\n<p>If you always need a string key, this <code>map[string]interface{}</code> give appropriate answer.</p>\n\n<p>But, to make more python-like-dictionary, you can also do this</p>\n\n<pre><code>map[interface{}]interface{}\n</code></pre>\n\n<p>Example</p>\n\n<pre><code>type AB struct {\n    data string\n}\nvar ab = AB{data: \"data\"}\nvar pyLikeDict = map[interface{}]interface{}{\n    \"key1\": \"value\",\n    1:      \"one\",\n    \"key2\": 2,\n    true:   \"true\",\n    ab:     false,\n}\n\nfor key, value := range pyLikeDict {\n    fmt.Printf(\"%v -&gt; %v\\n\", key, value)\n}\n\n// key1 -&gt; value\n// 1 -&gt; one\n// key2 -&gt; 2\n// true -&gt; true\n// {data} -&gt; false\n</code></pre>\n\n<p>See in <kbd><a href=\"https://play.golang.org/p/cZQtf0DZhjH\" rel=\"nofollow noreferrer\">playground</a></kbd></p>\n"}], "owner": {"reputation": 255, "user_id": 6214802, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/xbIYr.png?s=128&g=1", "display_name": "innectic", "link": "https://stackoverflow.com/users/6214802/innectic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 447, "favorite_count": 0, "accepted_answer_id": 39071538, "answer_count": 3, "score": 3, "last_activity_date": 1518259092, "creation_date": 1471840027, "last_edit_date": 1471840170, "question_id": 39071416, "link": "https://stackoverflow.com/questions/39071416/how-to-create-python-like-dictionaries-with-go", "title": "How to create Python like dictionaries with Go?", "body": "<p>I'm trying to make a python-like dictionary. I've tried:</p>\n\n<pre><code>var chunk = map[string]string{\n    \"code\": \"5000\",\n    \"error\": err,\n}\n\nvar payload = map[string]string{\n    \"type\": \"response\",\n    \"error\": chunk,\n}\n</code></pre>\n\n<p>I've also tried</p>\n\n<pre><code>    var payload = map[string]string{\n    \"type\": \"response\",\n    \"error\": {\n        \"code\": \"5000\",\n        \"error\": err,\n    },\n}\n</code></pre>\n"}, {"tags": ["generics", "go", "go-reflect"], "comments": [{"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 0, "creation_date": 1471838586, "post_id": 39071202, "comment_id": 65490734, "body": "map[interface{}]interface{} and map[int]interface{} is different type,  this is why you get error.  maybe you can change m2  to type map[interface{}]interface{}"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 6, "last_activity_date": 1471852298, "last_edit_date": 1495542810, "creation_date": 1471840801, "answer_id": 39071527, "question_id": 39071202, "link": "https://stackoverflow.com/questions/39071202/how-to-get-keys-of-map/39071527#39071527", "title": "How to get keys of map", "body": "<p>1- Golang is strongly typed language, So the <code>map[int]interface{}</code> is not compatible with <code>map[interface{}]interface{}</code>.<br>\n<code>int</code> is different type than <code>interface{}</code>, \nand see: <a href=\"https://stackoverflow.com/questions/23148812/go-whats-the-meaning-of-interface\">Go: What&#39;s the meaning of interface{}?</a></p>\n\n<p>2- No, Golang doesn't support generics, and this is very good, because it makes language simple and fast.</p>\n\n<hr>\n\n<p>You have some options:  </p>\n\n<p>If you don't want to change the type of map used:<br>\n1- You may edit the function to: <code>func Keys(m map[int]interface{}) []int</code>, like this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    m2 := map[int]interface{}{\n        2: \"string\",\n        3: \"int\",\n    }\n    fmt.Println(Keys(m2))\n}\n\nfunc Keys(m map[int]interface{}) []int {\n    keys := make([]int, len(m))\n    i := 0\n    for k := range m {\n        keys[i] = k\n        i++\n    }\n    return keys\n}\n</code></pre>\n\n<p>output ( may not be in order):</p>\n\n<pre><code>[2 3]\n</code></pre>\n\n<hr>\n\n<p>2- Or you may edit the function to: <code>func Keys(m map[int]interface{}) []interface{}</code>, like this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    m2 := map[int]interface{}{\n        2: \"string\",\n        3: \"int\",\n    }\n    fmt.Println(Keys(m2))\n}\n\nfunc Keys(m map[int]interface{}) []interface{} {\n    keys := make([]interface{}, len(m))\n    i := 0\n    for k := range m {\n        keys[i] = k\n        i++\n    }\n    return keys\n}\n</code></pre>\n\n<p>output ( may not be in order):</p>\n\n<pre><code>[2 3]\n</code></pre>\n\n<hr>\n\n<p>If you don't want to change the <code>Keys</code> function used:<br>\n3- You may edit the map to: <code>map[interface{}]interface{}</code>, like this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    m2 := map[interface{}]interface{}{\n        2: \"string\",\n        3: \"int\",\n    }\n    fmt.Println(Keys(m2))\n}\n\nfunc Keys(m map[interface{}]interface{}) []interface{} {\n    keys := make([]interface{}, len(m))\n    i := 0\n    for k := range m {\n        keys[i] = k\n        i++\n    }\n    return keys\n}\n</code></pre>\n\n<hr>\n\n<p>4- Also you may use <code>reflect</code> package for some use cases, but with the performance (speed) penalty.<br>\nAnd See: <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">The Laws of Reflection</a></p>\n"}, {"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 4, "last_activity_date": 1471845478, "creation_date": 1471845478, "answer_id": 39072207, "question_id": 39071202, "link": "https://stackoverflow.com/questions/39071202/how-to-get-keys-of-map/39072207#39072207", "title": "How to get keys of map", "body": "<p>Besides Amd's solution, you can also make use of the reflect library if you do not want to change the type of map used.</p>\n\n<pre><code>func main() {\n    m2 := map[int]interface{}{\n        2: \"string\",\n        3: \"int\",\n    }\n\n    k := Keys(m2)\n\n    fmt.Printf(\"Keys: %v\\n\", k)\n}\n\nfunc Keys(m interface{}) (keys []interface{}) {\n    v := reflect.ValueOf(m)\n    if v.Kind() != reflect.Map {\n        fmt.Errorf(\"input type not a map: %v\", v)\n    }\n\n    for _, k := range v.MapKeys() {\n        keys = append(keys, k.Interface())\n    }\n    return keys\n\n}\n</code></pre>\n\n<p>Note that if you use this solution, the returned keys from <code>Keys</code> will contain each key value wrapped in an interface itself. So to get the actual value you might have to do type assertions:</p>\n\n<pre><code>k := Keys(m2)\nk1 := k[0].(int) // k[0] is an interface value, k1 is an int\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/jEHBDotIG3\" rel=\"nofollow\">Working Code</a>.</p>\n"}], "owner": {"reputation": 13677, "user_id": 5046896, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7GplC.jpg?s=128&g=1", "display_name": "GoingMyWay", "link": "https://stackoverflow.com/users/5046896/goingmyway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8070, "favorite_count": 0, "accepted_answer_id": 39071527, "answer_count": 2, "score": 3, "last_activity_date": 1545040494, "creation_date": 1471838232, "last_edit_date": 1545040494, "question_id": 39071202, "link": "https://stackoverflow.com/questions/39071202/how-to-get-keys-of-map", "title": "How to get keys of map", "body": "<p>I have a function named <code>Keys()</code> to get all the keys of a map, here is the code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    m2 := map[int]interface{}{\n        2:\"string\",\n        3:\"int\",\n    }\n    fmt.Println(Keys(m2))\n}\nfunc Keys(m map[interface{}]interface{}) (keys []interface{}) {\n    for k := range m {\n        keys = append(keys, k)\n    }\n    return keys\n}\n</code></pre>\n\n<p>But I got </p>\n\n<pre><code>cannot use m2 (type map[int]interface {}) as type map[interface {}]interface {} in argument to Keys\n</code></pre>\n\n<p>Does Go support generics and how should I fix my code?</p>\n"}, {"tags": ["json", "go", "http-get"], "answers": [{"tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": true, "score": 0, "last_activity_date": 1471825099, "creation_date": 1471825099, "answer_id": 39069965, "question_id": 39069863, "link": "https://stackoverflow.com/questions/39069863/cant-get-json-parsed-from-http-response/39069965#39069965", "title": "Can&#39;t Get JSON Parsed from HTTP Response", "body": "<p>The JSON is an array, so you need to pass an array to the Decode method. Also remember to check the returned error.</p>\n\n<pre><code>package main\n\nimport(\n  \"encoding/json\"\n  \"net/http\"\n  \"log\"\n)\n\ntype CoinMarketCapData struct {\n  Id               string\n  Name             string\n  Symbol           string\n  Rank             int\n  PriceUSD         float64\n  PriceBTC         float64\n  Volume24hUSD     float64\n  MarketCapUSD     float64\n  AvailableSupply   float64\n  TotalSupply       float64\n  PercentChange1h   float32\n  PercentChange24h float32\n  PercentChange7d   float32\n}\n\nfunc getJson(url string, target interface{}) error {\n  client := &amp;http.Client{}\n  req, _ := http.NewRequest(\"GET\", url, nil)\n  req.Header.Set(\"Content-Type\", \"application/json\")\n  r, err := client.Do(req)\n  if err != nil {\n      return err\n  }\n  defer r.Body.Close()\n  return json.NewDecoder(r.Body).Decode(target)\n}\n\nfunc main() {\n  //Test with CoinMarketCap JSON\n  url2 := \"https://api.coinmarketcap.com/v1/ticker/ethereum\"\n  priceData := make([]CoinMarketCapData, 0)\n  err := getJson(url2, &amp;priceData)\n  if err != nil {\n     log.Printf(\"Failed to decode json: %v\", err)\n  } else {\n    //Should print \"Ethereum Id: ethereum\"\n    log.Printf(\"Ethereum Id: %v\", priceData[0].Id)\n  }\n}\n</code></pre>\n\n<p>running this prints</p>\n\n<pre><code>2016/08/21 17:15:27 Ethereum Id: ethereum\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "is_accepted": false, "score": 0, "last_activity_date": 1471826023, "last_edit_date": 1471826023, "creation_date": 1471825142, "answer_id": 39069967, "question_id": 39069863, "link": "https://stackoverflow.com/questions/39069863/cant-get-json-parsed-from-http-response/39069967#39069967", "title": "Can&#39;t Get JSON Parsed from HTTP Response", "body": "<p>You're right, the top level API response type is a list and that has to be reflected in the unmarshalling process. One way to fix this would be to define your <em>MarketCap</em> response as slice, like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n)\n\n// curl -sLf \"https://api.coinmarketcap.com/v1/ticker/ethereum\" | JSONGen\n// command line helper: `go get github.com/bemasher/JSONGen`\ntype MarketCapResponse []struct {\n    AvailableSupply  float64 `json:\"available_supply\"`\n    HVolumeUsd       float64 `json:\"24h_volume_usd\"`\n    Id               string  `json:\"id\"`\n    MarketCapUsd     float64 `json:\"market_cap_usd\"`\n    Name             string  `json:\"name\"`\n    PercentChange1h  float64 `json:\"percent_change_1h\"`\n    PercentChange24h float64 `json:\"percent_change_24h\"`\n    PercentChange7d  float64 `json:\"percent_change_7d\"`\n    PriceBtc         float64 `json:\"price_btc\"`\n    PriceUsd         float64 `json:\"price_usd\"`\n    Rank             int64   `json:\"rank\"`\n    Symbol           string  `json:\"symbol\"`\n    TotalSupply      float64 `json:\"total_supply\"`\n}\n</code></pre>\n\n<p>Then the unmarshaling would work just fine. One thing to note is that pointer to a slice is different from the slice. Especially, the pointer does not support indexing, which is why need to dereference it first to access the first item in the list.</p>\n\n<pre><code>func getAndUnmarshal(url string, target interface{}) error {\n    var client = &amp;http.Client{}\n    req, _ := http.NewRequest(\"GET\", url, nil)\n    req.Header.Set(\"Content-Type\", \"application/json\")\n    r, _ := client.Do(req)\n    defer r.Body.Close()\n    return json.NewDecoder(r.Body).Decode(target)\n}\n\nfunc main() {\n    link := \"https://api.coinmarketcap.com/v1/ticker/ethereum\"\n    resp := new(MarketCapResponse)\n    getAndUnmarshal(link, resp)\n    log.Printf(\"Ethereum Id: %s\", (*resp)[0].Id)\n    // prints:\n    // 2016/08/22 02:13:23 Ethereum Id: ethereum\n}\n</code></pre>\n\n<hr>\n\n<p>Another way would be to define a type for a single <em>MarketCap</em> and then create a slice as a target when needed:</p>\n\n<pre><code>package main\n\n// curl -sLf \"https://api.coinmarketcap.com/v1/ticker/ethereum\" | jq .[0] | JSONGen\ntype MarketCap struct {\n    AvailableSupply  float64 `json:\"available_supply\"`\n    HVolumeUsd       float64 `json:\"24h_volume_usd\"`\n    Id               string  `json:\"id\"`\n    MarketCapUsd     float64 `json:\"market_cap_usd\"`\n    Name             string  `json:\"name\"`\n    PercentChange1h  float64 `json:\"percent_change_1h\"`\n    PercentChange24h float64 `json:\"percent_change_24h\"`\n    PercentChange7d  float64 `json:\"percent_change_7d\"`\n    PriceBtc         float64 `json:\"price_btc\"`\n    PriceUsd         float64 `json:\"price_usd\"`\n    Rank             int64   `json:\"rank\"`\n    Symbol           string  `json:\"symbol\"`\n    TotalSupply      float64 `json:\"total_supply\"`\n}\n\nfunc getAndUnmarshal(url string, target interface{}) error {\n     ...\n}\n\nfunc main() {\n    link := \"https://api.coinmarketcap.com/v1/ticker/ethereum\"\n    resp := make([]MarketCap, 0)\n    getAndUnmarshal(link, &amp;resp)\n    log.Printf(\"Ethereum Id: %s\", resp[0].Id)\n    // 2016/08/22 02:13:23 Ethereum Id: ethereum\n}\n</code></pre>\n\n<p>What is more suitable for you will depend on your use case. If you want the struct to reflect the API response, then the first approach seems more suitable. Is <em>MarketCap</em> a thing and the API is just one way to access it, than the second fits better, I believe.</p>\n"}], "owner": {"reputation": 3, "user_id": 4244762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/012fd9eee38948cd04f8bee2c2b40491?s=128&d=identicon&r=PG&f=1", "display_name": "Mad Paradigm", "link": "https://stackoverflow.com/users/4244762/mad-paradigm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 0, "accepted_answer_id": 39069965, "answer_count": 2, "score": 0, "last_activity_date": 1471826023, "creation_date": 1471823870, "question_id": 39069863, "link": "https://stackoverflow.com/questions/39069863/cant-get-json-parsed-from-http-response", "title": "Can&#39;t Get JSON Parsed from HTTP Response", "body": "<p>So, I'm trying to figure out how to get the following code to properly parse the JSON data from <a href=\"https://api.coinmarketcap.com/v1/ticker/ethereum\" rel=\"nofollow\">https://api.coinmarketcap.com/v1/ticker/ethereum</a>. It seems to have no problem decoding the JSON data in the response from <a href=\"http://echo.jsontest.com/key1/value1/key2/value2\" rel=\"nofollow\">http://echo.jsontest.com/key1/value1/key2/value2</a>, but only gets empty/zero values when pointed at the CoinMarketCap API.</p>\n\n<pre><code>package main\n\nimport(\n  \"encoding/json\"\n  \"net/http\"\n  \"log\"\n)\n\ntype JsonTest struct {\n  Key1  string\n  Key2  string\n}\n\ntype CoinMarketCapData struct {\n  Id               string\n  Name             string\n  Symbol           string\n  Rank             int\n  PriceUSD         float64\n  PriceBTC         float64\n  Volume24hUSD     float64\n  MarketCapUSD     float64\n  AvailableSupply   float64\n  TotalSupply       float64\n  PercentChange1h   float32\n  PercentChange24h float32\n  PercentChange7d   float32\n}\n\nfunc getJson(url string, target interface{}) error {\n  client := &amp;http.Client{}\n  req, _ := http.NewRequest(\"GET\", url, nil)\n  req.Header.Set(\"Content-Type\", \"application/json\")\n  r, err := client.Do(req)\n  if err != nil {\n      return err\n  }\n  defer r.Body.Close()\n  return json.NewDecoder(r.Body).Decode(target)\n}\n\nfunc main() {\n  //Test with dummy JSON\n  url1 := \"http://echo.jsontest.com/key1/value1/key2/value2\"\n  jsonTest := new(JsonTest)\n  getJson(url1, jsonTest)\n  log.Printf(\"jsonTest Key1: %s\", jsonTest.Key1)\n\n  //Test with CoinMarketCap JSON\n  url2 := \"https://api.coinmarketcap.com/v1/ticker/ethereum\"\n  priceData := new(CoinMarketCapData)\n  getJson(url2, priceData)\n  //Should print \"Ethereum Id: ethereum\"\n  log.Printf(\"Ethereum Id: %s\", priceData.Id)\n}\n</code></pre>\n\n<p>I suspect it's related to the fact that the JSON at CoinMarketCap is inside a top level JSON array, but I've tried various iterations of things like:</p>\n\n<pre><code>priceData := make([]CoinMarketCapData, 1)\n</code></pre>\n\n<p>to no avail. Any advice is much appreciated, thanks.</p>\n"}, {"tags": ["go", "concurrency", "mapreduce", "channel"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1471835876, "post_id": 39069854, "comment_id": 65490180, "body": "even if there is no <code>Reducers</code>, the <code>outputMapChan</code> is not closed, which causes forever waiting. I think a <code>mapreduce</code> should contain two separate  phases, a <code>map</code> and a <code>reduce</code>, not looping them together."}, {"owner": {"reputation": 243, "user_id": 6741576, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HfPGktZAZ84/AAAAAAAAAAI/AAAAAAAARGQ/EQZeI9OWGzk/photo.jpg?sz=128", "display_name": "Jack Reilly", "link": "https://stackoverflow.com/users/6741576/jack-reilly"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1471876147, "post_id": 39069854, "comment_id": 65512061, "body": "The difficulty comes from the recursive nature of the <code>reduce</code> phase. Since a reduce computation may need further <code>fold</code>ing, and this can happen an arbitrary number of times, I need some mechanism for allowing outputs of the <code>reduce</code> output to flow into the <code>reduce</code> input for further reduction."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1471919426, "post_id": 39069854, "comment_id": 65530456, "body": "<code>reduce</code> phase not have a nature recursive. the mapped intermediate result should be split to sets, every set can be processed by reducer separately. that why <code>mapreduce</code> work in distribution system."}, {"owner": {"reputation": 243, "user_id": 6741576, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HfPGktZAZ84/AAAAAAAAAAI/AAAAAAAARGQ/EQZeI9OWGzk/photo.jpg?sz=128", "display_name": "Jack Reilly", "link": "https://stackoverflow.com/users/6741576/jack-reilly"}, "edited": false, "score": 0, "creation_date": 1472218126, "post_id": 39069854, "comment_id": 65677243, "body": "You may be describing the traditional marpeduce architecture, but I was specifically curious how one handles cyclical channel dependencies in go. The accepted answer from @Amd demonstrates this well. Thank you for your advice though, as your mapreduce comments are in general quite true :)"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1471959973, "post_id": 39102963, "comment_id": 65552559, "body": "@jack-reilly I hope this helps"}, {"owner": {"reputation": 243, "user_id": 6741576, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HfPGktZAZ84/AAAAAAAAAAI/AAAAAAAARGQ/EQZeI9OWGzk/photo.jpg?sz=128", "display_name": "Jack Reilly", "link": "https://stackoverflow.com/users/6741576/jack-reilly"}, "edited": false, "score": 1, "creation_date": 1472218011, "post_id": 39102963, "comment_id": 65677156, "body": "Very nicely done! Thank you for showing me how to use wait groups and atomic counters to synchronize these blocks."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 0, "last_activity_date": 1472061024, "last_edit_date": 1472061024, "creation_date": 1471959901, "answer_id": 39102963, "question_id": 39069854, "link": "https://stackoverflow.com/questions/39069854/closing-channels-with-cyclical-dependencies/39102963#39102963", "title": "Closing channels with cyclical dependencies", "body": "<p>Try this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"sync\"\nimport \"sync/atomic\"\nimport \"runtime\"\nimport \"math/rand\"\nimport \"time\"\n\ntype MapFn func(input int) *kvPair\ntype ReduceFn func(a int, b int) int\n\ntype kvPair struct {\n    k int\n    v int\n}\n\ntype reducePair struct {\n    k  int\n    v1 int\n    v2 int\n}\n\nfunc MapReduce(mapFn MapFn, reduceFn ReduceFn, input []int, nMappers int, nReducers int) (map[int]int, error) {\n    inputMapChan := make(chan int, len(input))\n    outputMapChan := make(chan *kvPair, len(input))\n    reduceInputChan := make(chan *reducePair)\n    outputMapMap := make(map[int]int)\n\n    wg := sync.WaitGroup{}\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        for _, v := range input {\n            inputMapChan &lt;- v\n        }\n        close(inputMapChan)\n    }()\n\n    for i := 0; i &lt; nMappers; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            for v := range inputMapChan {\n                outputMapChan &lt;- mapFn(v)\n            }\n        }()\n    }\n\n    finished := false\n    go func() {\n        wg.Wait()\n        finished = true\n    }()\n\n    var count int64\n    for i := 0; i &lt; nReducers; i++ {\n        go func() {\n            for v := range reduceInputChan {\n                reduceValue := reduceFn(v.v1, v.v2)\n                outputMapChan &lt;- &amp;kvPair{v.k, reduceValue}\n                atomic.AddInt64(&amp;count, -1)\n            }\n        }()\n    }\n\n    wg2 := sync.WaitGroup{}\n    wg2.Add(1)\n    go func() {\n        defer wg2.Done()\n        for {\n            select {\n            default:\n                if finished &amp;&amp; atomic.LoadInt64(&amp;count) == 0 &amp;&amp; len(outputMapChan) == 0 {\n                    return\n                }\n                //runtime.Gosched()\n            case v := &lt;-outputMapChan:\n                key := v.k\n                value := v.v\n                if other, ok := outputMapMap[key]; ok {\n                    delete(outputMapMap, key)\n                    atomic.AddInt64(&amp;count, 1)\n                    reduceInputChan &lt;- &amp;reducePair{key, value, other}\n                } else {\n                    outputMapMap[key] = value\n                }\n            }\n        }\n    }()\n\n    wg2.Wait()\n    return outputMapMap, nil\n}\n\nfunc main() {\n    fmt.Println(\"NumCPU =\", runtime.NumCPU())\n    t := time.Now()\n    a := rand.Perm(1000000)\n    //a = []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 1, 12, 13, 1, 16, 2}\n    m, err := MapReduce(mp, rdc, a, 2, 2)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(time.Since(t)) //883ms\n    fmt.Println(m)\n    fmt.Println(\"done.\")\n}\n\nfunc mp(input int) *kvPair {\n    return &amp;kvPair{input &amp; 7, input &gt;&gt; 3}\n}\nfunc rdc(a int, b int) int {\n    b &lt;&lt;= 3\n    if a != 0 {\n        b |= a\n    }\n    return b\n}\n</code></pre>\n"}], "owner": {"reputation": 243, "user_id": 6741576, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HfPGktZAZ84/AAAAAAAAAAI/AAAAAAAARGQ/EQZeI9OWGzk/photo.jpg?sz=128", "display_name": "Jack Reilly", "link": "https://stackoverflow.com/users/6741576/jack-reilly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 1, "accepted_answer_id": 39102963, "answer_count": 1, "score": 0, "last_activity_date": 1576067567, "creation_date": 1471823754, "last_edit_date": 1576067567, "question_id": 39069854, "link": "https://stackoverflow.com/questions/39069854/closing-channels-with-cyclical-dependencies", "title": "Closing channels with cyclical dependencies", "body": "<p>I'm trying to implement a mapreduce-like method in Golang. My design is as follows:</p>\n\n<ul>\n<li><p>Map workers pull items off a mapper input channel and output to a mapper output channel</p></li>\n<li><p>The mapper output channel is then read by a single goroutine. This routine maintains a map of previously-seen key-value pairs. If the next item from the mapper output has a matching key, it sends both the new and old values with matching keys to a reduce-input channel.</p></li>\n<li>The reduce-input pipeline reduces two values to one key-value pair, and submits the result to the same map-output channel.</li>\n</ul>\n\n<p>This leads to a circular dependency between the mapper output and the reduce input, and I now do not know how to signal that the mapper output is complete (and close the channel).</p>\n\n<p>What is the best way of breaking this cyclic dependency or knowing when to close channels with such cyclical behavior?</p>\n\n<p>The code below has a deadlock with the map output channel and the reduce input channel waiting on each other.</p>\n\n<pre><code>type MapFn func(input int) (int, int)\ntype ReduceFn func(a int, b int) int\n\ntype kvPair struct {\n    k int\n    v int\n}\n\ntype reducePair struct {\n    k  int\n    v1 int\n    v2 int\n}\n\nfunc MapReduce(mapFn MapFn, reduceFn ReduceFn, input []int, nMappers int, nReducers int) (map[int]int, error) {\n    inputMapChan := make(chan int, len(input))\n    outputMapChan := make(chan *kvPair, len(input))\n    reduceInputChan := make(chan *reducePair)\n    outputMapMap := make(map[int]int)\n    go func() {\n        for v := range input {\n            inputMapChan &lt;- v\n        }\n        close(inputMapChan)\n    }()\n    for i := 0; i &lt; nMappers; i++ {\n        go func() {\n            for v := range inputMapChan {\n                k, v := mapFn(v)\n                outputMapChan &lt;- &amp;kvPair{k, v}\n            }\n        }()\n    }\n    for i := 0; i &lt; nReducers; i++ {\n        go func() {\n            for v := range reduceInputChan {\n                reduceValue := reduceFn(v.v1, v.v2)\n                outputMapChan &lt;- &amp;kvPair{v.k, reduceValue}\n            }\n        }()\n    }\n    for v := range outputMapChan {\n        key := v.k\n        value := v.v\n        other, ok := outputMapMap[key]\n        if ok {\n            delete(outputMapMap, key)\n            reduceInputChan &lt;- &amp;reducePair{key, value, other}\n        } else {\n            outputMapMap[key] = value\n        }\n    }\n    return outputMapMap, nil\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5539, "user_id": 871134, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/BKxlV.jpg?s=128&g=1", "display_name": "Deleplace", "link": "https://stackoverflow.com/users/871134/deleplace"}, "edited": false, "score": 2, "creation_date": 1516009665, "post_id": 39069538, "comment_id": 83503446, "body": "Not anymore! They were nice and useful and concise, while they lasted"}], "tags": [], "owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "is_accepted": true, "score": 16, "last_activity_date": 1516010282, "last_edit_date": 1516010282, "creation_date": 1471819995, "answer_id": 39069538, "question_id": 39069515, "link": "https://stackoverflow.com/questions/39069515/what-are-the-5-secret-keywords-in-go/39069538#39069538", "title": "What are the 5 secret keywords in Go?", "body": "<p>The following 5 keywords are ignored:</p>\n\n<pre><code>notwithstanding\nthetruthofthematter\ndespiteallobjections\nwhereas\ninsofaras\n</code></pre>\n\n<p><a href=\"https://github.com/golang/go/blob/b4e9f70412671c7ac06b4852c38a0ab82d94ddf5/src/cmd/compile/internal/gc/lex.go#L605-L609\" rel=\"noreferrer\">Yes, really</a>.</p>\n\n<hr>\n\n<p>Update: As Deleplace notes in the comments, the easter egg keywords have been removed. It looks like <a href=\"https://github.com/golang/go/commit/57df2f802f0417f08100ff8002f3b062e695e148#diff-76741800172ea45f1e1b32be16e1097b\" rel=\"noreferrer\">this commit</a> took them out during a major parser update. If you try to run <a href=\"https://play.golang.org/p/EAVnxSY9o41\" rel=\"noreferrer\">a program containing one of these tokens</a>, you'll find they're treated as ordinary identifiers now.</p>\n"}, {"tags": [], "owner": {"reputation": 1049, "user_id": 5304415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8N5s.png?s=128&g=1", "display_name": "Ryan B.", "link": "https://stackoverflow.com/users/5304415/ryan-b"}, "is_accepted": false, "score": 8, "last_activity_date": 1471821056, "last_edit_date": 1495540011, "creation_date": 1471820149, "answer_id": 39069548, "question_id": 39069515, "link": "https://stackoverflow.com/questions/39069515/what-are-the-5-secret-keywords-in-go/39069548#39069548", "title": "What are the 5 secret keywords in Go?", "body": "<p>There are some easter egg keywords in the lexer (<a href=\"https://github.com/golang/go/blob/08e25fc1ba397e02ec776561ed73b7f9a8b94392/src/cmd/compile/internal/gc/lex.go#L2152-L2156\" rel=\"nofollow noreferrer\">lex.go</a>) that are not in the official documentation, and hence are ignored by the compiler.</p>\n\n<p>Here they are:</p>\n\n<pre><code>notwithstanding\nthetruthofthematter\ndespiteallobjections\nwhereas\ninsofaras\n</code></pre>\n\n<p>You can report to <a href=\"https://stackoverflow.com/questions/2489803/google-go-notwithstanding-keyword\">this</a> conversation for more details.</p>\n"}, {"comments": [{"owner": {"reputation": 6990, "user_id": 329289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1536aecadab8356ff5e2d59da6c591?s=128&d=identicon&r=PG", "display_name": "Owen S.", "link": "https://stackoverflow.com/users/329289/owen-s"}, "edited": false, "score": 1, "creation_date": 1526422024, "post_id": 48193534, "comment_id": 87736241, "body": "They actually date to well before that. You&#39;ll see them in the original C compiler sources committed to the repo: <a href=\"https://github.com/golang/go/blob/0cafb9ea3d3d34627e8f492ccafa6ba9b633a213/src/cmd/gc/lex.c#L863-L867\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/&hellip;</a> . Rob only knows where they came from before that..."}, {"owner": {"reputation": 2671, "user_id": 33991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9770614c66b56331b6947c79b622a7af?s=128&d=identicon&r=PG", "display_name": "FGM", "link": "https://stackoverflow.com/users/33991/fgm"}, "edited": false, "score": 0, "creation_date": 1563804840, "post_id": 48193534, "comment_id": 100811177, "body": "FWIW, this commit is actually included in the history of 1.8-beta1, well before 1.10."}], "tags": [], "owner": {"reputation": 767, "user_id": 927514, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb896eb76968f2cd5df57260ddb6193?s=128&d=identicon&r=PG", "display_name": "enocom", "link": "https://stackoverflow.com/users/927514/enocom"}, "is_accepted": false, "score": 3, "last_activity_date": 1515607338, "creation_date": 1515607338, "answer_id": 48193534, "question_id": 39069515, "link": "https://stackoverflow.com/questions/39069515/what-are-the-5-secret-keywords-in-go/48193534#48193534", "title": "What are the 5 secret keywords in Go?", "body": "<p>It looks like the secret keywords will be removed in v1.10. See <a href=\"https://github.com/golang/go/commit/57df2f802f0417f08100ff8002f3b062e695e148#r19581522\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>For anyone curious, <a href=\"https://github.com/golang/go/blob/8c195bdf120ea86ddda42df89df7bfba80afdf10/src/cmd/internal/gc/lex.go#L2445-L2469\" rel=\"nofollow noreferrer\">here</a> is the commit which introduced the keywords.</p>\n"}], "owner": {"reputation": 97669, "user_id": 707381, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/439db9ac83f4ea14a904390900ec6634?s=128&d=identicon&r=PG", "display_name": "Randomblue", "link": "https://stackoverflow.com/users/707381/randomblue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1822, "favorite_count": 2, "accepted_answer_id": 39069538, "answer_count": 3, "score": 14, "last_activity_date": 1516010282, "creation_date": 1471819730, "question_id": 39069515, "link": "https://stackoverflow.com/questions/39069515/what-are-the-5-secret-keywords-in-go", "title": "What are the 5 secret keywords in Go?", "body": "<p>In <a href=\"https://youtu.be/ynoY2xz-F8s?t=9m\" rel=\"noreferrer\">this talk</a>, Francesc Campoy has a slide with Go's 25 keywords, and apparently 5 'secret' keywords.</p>\n\n<p>What are the 5 secret keywords in Go?</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 136, "user_id": 1428224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phT3Y.jpg?s=128&g=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1428224/andrey"}, "edited": false, "score": 0, "creation_date": 1471809041, "post_id": 39068284, "comment_id": 65484654, "body": "But <code>&quot;1&quot;</code> is a <code>serialized</code> JSON String"}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "reply_to_user": {"reputation": 136, "user_id": 1428224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phT3Y.jpg?s=128&g=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1428224/andrey"}, "edited": false, "score": 0, "creation_date": 1471809084, "post_id": 39068284, "comment_id": 65484671, "body": "Correct. I&#39;m not sure what you want here. <code>&quot;1&quot;</code> is a string, so it&#39;s unmarshalled as a string. If you want a float, you&#39;ll need to unmarshal a number (e.g. <code>1</code>)."}, {"owner": {"reputation": 136, "user_id": 1428224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phT3Y.jpg?s=128&g=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1428224/andrey"}, "edited": false, "score": 0, "creation_date": 1471809237, "post_id": 39068284, "comment_id": 65484699, "body": "For example: a:=1; Marshal &gt; <code>&quot;1&quot;</code> - this is a <code>marshalled</code> integer. I want to pass a <code>&quot;1&quot;</code> for unmarshalling - and I expect <code>float</code>."}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "reply_to_user": {"reputation": 136, "user_id": 1428224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phT3Y.jpg?s=128&g=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1428224/andrey"}, "edited": false, "score": 1, "creation_date": 1471809482, "post_id": 39068284, "comment_id": 65484783, "body": "If you marshal <code>1</code>, you&#39;ll get a string with the value <code>1</code>. If you then unmarshal it, you&#39;ll get a float with the value <code>1</code>."}, {"owner": {"reputation": 136, "user_id": 1428224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phT3Y.jpg?s=128&g=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1428224/andrey"}, "edited": false, "score": 0, "creation_date": 1471809574, "post_id": 39068284, "comment_id": 65484809, "body": "But a <code>marshalled</code> variable is a byte array which looks like <code>&quot;1&quot;</code>. Unmarshal returns <code>string</code> :D"}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "reply_to_user": {"reputation": 136, "user_id": 1428224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phT3Y.jpg?s=128&g=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1428224/andrey"}, "edited": false, "score": 0, "creation_date": 1471809724, "post_id": 39068284, "comment_id": 65484854, "body": "This is wrong. Why do you believe this? (Can you provide an example program that incorrectly marshals <code>1</code> to <code>&quot;1&quot;</code>?)"}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "reply_to_user": {"reputation": 136, "user_id": 1428224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phT3Y.jpg?s=128&g=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1428224/andrey"}, "edited": false, "score": 0, "creation_date": 1471809794, "post_id": 39068284, "comment_id": 65484865, "body": "Hopefully this example convinces you: <a href=\"https://play.golang.org/p/AshMpW1byH\" rel=\"nofollow noreferrer\">play.golang.org/p/AshMpW1byH</a>."}, {"owner": {"reputation": 136, "user_id": 1428224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phT3Y.jpg?s=128&g=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1428224/andrey"}, "edited": false, "score": 0, "creation_date": 1471810116, "post_id": 39068284, "comment_id": 65484945, "body": "The example is: Python code makes a serialization to variable as a string. <a href=\"https://s14.postimg.org/vea8dpdht/Screen_Shot_2016_08_21_at_23_05_00.png)](https://postimg.org/image/wtbt2fekt/\" rel=\"nofollow noreferrer\">s14.postimg.org/vea8dpdht/&hellip;</a>. So I receive a multipart from python"}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "reply_to_user": {"reputation": 136, "user_id": 1428224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phT3Y.jpg?s=128&g=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1428224/andrey"}, "edited": false, "score": 0, "creation_date": 1471810432, "post_id": 39068284, "comment_id": 65485021, "body": "JSON is always a string. The string contains <code>1</code> (not <code>&quot;1&quot;</code>)."}, {"owner": {"reputation": 136, "user_id": 1428224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phT3Y.jpg?s=128&g=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1428224/andrey"}, "edited": false, "score": 0, "creation_date": 1471810740, "post_id": 39068284, "comment_id": 65485113, "body": "Looks like I was mistaken. <a href=\"http://requestb.in/174wtf01?inspect\" rel=\"nofollow noreferrer\">requestb.in/174wtf01?inspect</a>. Just sent a value with serialized and got response. Next time I&#39;ll send to requestb.in before asking :D Thanks for your time :D"}], "tags": [], "owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "is_accepted": true, "score": 2, "last_activity_date": 1471809010, "creation_date": 1471809010, "answer_id": 39068284, "question_id": 39068253, "link": "https://stackoverflow.com/questions/39068253/golang-json-unmarshal-serialized-number/39068284#39068284", "title": "Golang JSON Unmarshal serialized number", "body": "<p>In JSON, <code>\"1\"</code> is a string. If you use <code>1</code> in your example instead, it's properly unmarshalled as a float.</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/60symMsRSW\" rel=\"nofollow\">https://play.golang.org/p/60symMsRSW</a></p>\n"}], "owner": {"reputation": 136, "user_id": 1428224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phT3Y.jpg?s=128&g=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1428224/andrey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 39068284, "answer_count": 1, "score": 1, "last_activity_date": 1471809010, "creation_date": 1471808800, "question_id": 39068253, "link": "https://stackoverflow.com/questions/39068253/golang-json-unmarshal-serialized-number", "title": "Golang JSON Unmarshal serialized number", "body": "<p>I have a question about json.Unmarshal.\nPlayground example <a href=\"https://play.golang.org/p/3d0nUv7PSJ\" rel=\"nofollow\">https://play.golang.org/p/3d0nUv7PSJ</a></p>\n\n<p>The problem is: JSON does not unmarshal \"1\" to float. I mean \"1\" is a serialized JSON which should be a number. Am I doing something wrong ?:D</p>\n"}, {"tags": ["pointers", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1471808249, "creation_date": 1471808249, "answer_id": 39068170, "question_id": 39068105, "link": "https://stackoverflow.com/questions/39068105/golang-value-not-updated-for-returned-package-variable/39068170#39068170", "title": "GoLang value not updated for returned Package variable", "body": "<p>GetPreson returns a copy of the value. Changes to the copy are not reflected in the original.</p>\n\n<p>Return a pointer to the value and update through the pointer.</p>\n\n<pre><code>package main \n\nimport \"fmt\"\n\ntype Person struct{\n  FirstName, LastName string\n  Age int\n}\n\nvar p Person = Person{\"Bob\",\"Rolf\",15}\n\nfunc GetPerson() *Person{  // note *\n  return &amp;p                // note &amp;\n}\n\nfunc main(){\n  fmt.Println(GetPerson())\n  rP := GetPerson()\n  rP.Age = 40\n  fmt.Println(GetPerson())\n}    \n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/OTVvM13OEU\" rel=\"nofollow\">playground example</a></p>\n"}], "owner": {"reputation": 621, "user_id": 2294667, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/9a834b6b0c63e84c6e4f473161eec983?s=128&d=identicon&r=PG", "display_name": "Westy10101", "link": "https://stackoverflow.com/users/2294667/westy10101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 39068170, "answer_count": 1, "score": 0, "last_activity_date": 1471808249, "creation_date": 1471807859, "question_id": 39068105, "link": "https://stackoverflow.com/questions/39068105/golang-value-not-updated-for-returned-package-variable", "title": "GoLang value not updated for returned Package variable", "body": "<p>Hi I am new to go and am trying to get my head around why the Package value that is returned by the method GetPerson() is not updated when I updated the returned value. I know how i could change the method to make it work, Im more after an explanation of what is going on? </p>\n\n<pre><code>package main \n\nimport \"fmt\"\n\ntype Person struct{\n    FirstName, LastName string\n    Age int\n}\n\nvar p Person = Person{\"Bob\",\"Rolf\",15}\n\nfunc GetPerson() Person{\n    return p\n}\n\nfunc main(){\n    fmt.Println(GetPerson())\n    rP := GetPerson()\n    rP.Age = 40\n    fmt.Println(GetPerson())\n}    \n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 497, "user_id": 2692215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d0b6dabfa2ba63adece2081af25989e?s=128&d=identicon&r=PG&f=1", "display_name": "1lann", "link": "https://stackoverflow.com/users/2692215/1lann"}, "is_accepted": false, "score": 2, "last_activity_date": 1471789510, "creation_date": 1471789510, "answer_id": 39065275, "question_id": 39064914, "link": "https://stackoverflow.com/questions/39064914/why-go-takes-so-much-cpu-to-build-a-package/39065275#39065275", "title": "Why Go takes so much CPU to build a package?", "body": "<p>Go is using a lot of CPU because it's trying to build as fast as possible, like any other compiler. It may also be because you're using a package that is using cgo, which can drastically increase compiling times as compiling medium to large C libraries is often quite intensive.</p>\n\n<p>You can control the number of processes Go is using by setting the <code>GOMAXPROCS</code> environment variable. Such as <code>GOMAXPROCS=1 go get ...</code> to limit Go to only use 1 process (and thus only 1 CPU core). This however does not affect the number of processes used by external compilers that cgo may invoke.</p>\n\n<p>If you need further CPU control, on Unix based systems you can use the <code>nice</code> command to change the priority of processes such that other programs have higher CPU priority, making your computer less sluggish.</p>\n"}], "owner": {"reputation": 3121, "user_id": 1889327, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/lFDYA.jpg?s=128&g=1", "display_name": "andy", "link": "https://stackoverflow.com/users/1889327/andy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "closed_date": 1471825181, "answer_count": 1, "score": -6, "last_activity_date": 1471804997, "creation_date": 1471787308, "last_edit_date": 1471804997, "question_id": 39064914, "link": "https://stackoverflow.com/questions/39064914/why-go-takes-so-much-cpu-to-build-a-package", "closed_reason": "Not suitable for this site", "title": "Why Go takes so much CPU to build a package?", "body": "<p>I have download a golang package from github. it is in middle size. when compiling it from source, my computor gets slow down for i have more than one golang compile process and it takes much of the cpu.</p>\n\n<p>how does golang make it to do concurrent compile?\nany params to turn the number of cpu it use when compile?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 497, "user_id": 2692215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d0b6dabfa2ba63adece2081af25989e?s=128&d=identicon&r=PG&f=1", "display_name": "1lann", "link": "https://stackoverflow.com/users/2692215/1lann"}, "edited": false, "score": 3, "creation_date": 1471787106, "post_id": 39064558, "comment_id": 65478273, "body": "A <code>Set</code> on a <code>Header</code> after a <code>Write</code> has no effect, and will not be sent in the response. @user462794 I believe Go automatically adds a <code>Content-Length</code> to HTTP responses too, so it&#39;s unnecessary to calculate it yourself."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 6, "last_activity_date": 1471788585, "last_edit_date": 1471788585, "creation_date": 1471785026, "answer_id": 39064558, "question_id": 39064343, "link": "https://stackoverflow.com/questions/39064343/how-to-get-the-size-of-an-io-reader-object/39064558#39064558", "title": "How to get the size of an io.reader object", "body": "<p>Since <code>io.Reader</code> interface doesn't know anything about size or length of underlying data,<br>\nthere are 2 options:<br>\n1- Use buffer and read or copy all data:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>buf := &amp;bytes.Buffer{}\nnRead, err := io.Copy(buf, dec) \nif err != nil {\n    fmt.Println(err)\n}\nw.Header().Set(\"Content-Length\", strconv.FormatInt(nRead, 10)) //len(dec)\n</code></pre>\n\n<p>Like this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    base64 \"encoding/base64\"\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"strconv\"\n    \"time\"\n)\n\nfunc pix(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi there, I love %s!\", r.URL.Path[1:])\n    cookie, _ := r.Cookie(\"csrftoken\")\n    fmt.Printf(cookie.Value)\n}\n\nfunc img(w http.ResponseWriter, r *http.Request) {\n    expiration := time.Now().Add(365 * 24 * time.Hour)\n    cookie := http.Cookie{Name: \"csrftoken\", Value: \"abcd\", Expires: expiration, HttpOnly: false}\n    http.SetCookie(w, &amp;cookie)\n    img := bytes.NewBufferString(\"iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAADMUlEQVRYw+2YTUgUYRjHZzOJIoNA+rrUyYNIRQgRHaLo4qFDBEGeunSxS9TFU0QEnhIh6IvokrUzO2uamRmbG6XmR/mVaKZpZVbYvvO143zszsxOz+yahNm+785sITEP72F3Z+adH8/zf5+PpagwtxKXj+Vj+Vg+lo/lY+W+WI4KpddKwWIQFUSF97nNLcLGZt75SiOHchEXfskDVmYjlowpiEoei3UT2ljcFJOpOd169C1Z2SuvgsdpB7cgzB16EV/byGM2xDIVPxQujKmBDF/2m2l0vFvmEin7N2v8kiiPiOeGlGHRvP1RdxA9eYtGR7pk2Pf6lI7RCoP2RaWkZWe3fsFc18hvesAHPGEFUc24ltnx3kyiCJwfRMs6dTXLdSIjO9Osal18qzKfE5V9coDxhlU7qS3uOyiaB55JDtkS2TKoLCLaOLPS4b02pQdCHiUfRKf653/d2kjZN6f10jYxI2EnrGk5H+2WsVi6ZZ8fVSmGQKaYyyFuR6ugmUtVrJo2C7HokeGq8447sYpOPBbo3XFzKC95626sZlz905sUM9XLGbXvtKtTOhZrQDApkhNNkiAOPo/viojh2YSZsj1aF2eQ5n2stuomNQjiiGQanrFufdCXP8gu8tbhjridJ6saVPKExXJrwlwfb3pnAg2Ut0tEBZFI8gza81Tik15DCDIoINQ7aQdBo90RMfrdwNaWLFY9opJGkBQrhCA/HXspQ8W1XHkN6vfWFiGH9ouwhdpJUFuy2JX3eg6uyqENpNHZYcUd02jcLMI2WO67UwZVv1G1HLMq3L83KuEbLPdY7IL2L42p0MMQiuzkq/ncwucOi6qPbWkWoPfCUsENpweUnP1EmE4XGhgagT72RyXolkSCHBbTU3By3fgJj8VyJW3CmSHl8oTWMJuYUUizVvtcsuyJ6J4J663CMLevXar/lJgnKNSgbphzKjriTn5i0F8eX9ODXnEzf6JHvjGtv+aNGdWCOEKnJRmpr5oFVQV8WTWglIKHMlPhv5uqQ1xGYfB5fRMPo+n2VmFbi7ChiS9oWBhZvXrI01TNLg7yPxt51v9rxMfysXwsH8vH+g+wfgDUr+5LcyNV4AAAAABJRU5ErkJggg==\")\n    dec := base64.NewDecoder(base64.StdEncoding, img)\n    w.Header().Set(\"Content-Type\", \"image/jpeg\")\n\n    buf := &amp;bytes.Buffer{}\n    nRead, err := io.Copy(buf, dec) \n    if err != nil {\n        fmt.Println(err)\n    }\n    w.Header().Set(\"Content-Length\", strconv.FormatInt(nRead, 10)) //len(dec)\n\n    io.Copy(w, buf)\n}\n\nfunc main() {\n    http.HandleFunc(\"/pix/\", pix)\n    http.HandleFunc(\"/img/\", img)\n    http.HandleFunc(\"/red/\", img)\n    http.HandleFunc(\"/\", img)\n    http.ListenAndServe(\":8080\", nil)\n\n}\n</code></pre>\n\n<hr>\n\n<p>2- Don't set the header size, like this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    base64 \"encoding/base64\"\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc pix(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi there, I love %s!\", r.URL.Path[1:])\n    cookie, _ := r.Cookie(\"csrftoken\")\n    fmt.Printf(cookie.Value)\n}\n\nfunc img(w http.ResponseWriter, r *http.Request) {\n    expiration := time.Now().Add(365 * 24 * time.Hour)\n    cookie := http.Cookie{Name: \"csrftoken\", Value: \"abcd\", Expires: expiration, HttpOnly: false}\n    http.SetCookie(w, &amp;cookie)\n    img := bytes.NewBufferString(\"iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAADMUlEQVRYw+2YTUgUYRjHZzOJIoNA+rrUyYNIRQgRHaLo4qFDBEGeunSxS9TFU0QEnhIh6IvokrUzO2uamRmbG6XmR/mVaKZpZVbYvvO143zszsxOz+yahNm+785sITEP72F3Z+adH8/zf5+PpagwtxKXj+Vj+Vg+lo/lY+W+WI4KpddKwWIQFUSF97nNLcLGZt75SiOHchEXfskDVmYjlowpiEoei3UT2ljcFJOpOd169C1Z2SuvgsdpB7cgzB16EV/byGM2xDIVPxQujKmBDF/2m2l0vFvmEin7N2v8kiiPiOeGlGHRvP1RdxA9eYtGR7pk2Pf6lI7RCoP2RaWkZWe3fsFc18hvesAHPGEFUc24ltnx3kyiCJwfRMs6dTXLdSIjO9Osal18qzKfE5V9coDxhlU7qS3uOyiaB55JDtkS2TKoLCLaOLPS4b02pQdCHiUfRKf653/d2kjZN6f10jYxI2EnrGk5H+2WsVi6ZZ8fVSmGQKaYyyFuR6ugmUtVrJo2C7HokeGq8447sYpOPBbo3XFzKC95626sZlz905sUM9XLGbXvtKtTOhZrQDApkhNNkiAOPo/viojh2YSZsj1aF2eQ5n2stuomNQjiiGQanrFufdCXP8gu8tbhjridJ6saVPKExXJrwlwfb3pnAg2Ut0tEBZFI8gza81Tik15DCDIoINQ7aQdBo90RMfrdwNaWLFY9opJGkBQrhCA/HXspQ8W1XHkN6vfWFiGH9ouwhdpJUFuy2JX3eg6uyqENpNHZYcUd02jcLMI2WO67UwZVv1G1HLMq3L83KuEbLPdY7IL2L42p0MMQiuzkq/ncwucOi6qPbWkWoPfCUsENpweUnP1EmE4XGhgagT72RyXolkSCHBbTU3By3fgJj8VyJW3CmSHl8oTWMJuYUUizVvtcsuyJ6J4J663CMLevXar/lJgnKNSgbphzKjriTn5i0F8eX9ODXnEzf6JHvjGtv+aNGdWCOEKnJRmpr5oFVQV8WTWglIKHMlPhv5uqQ1xGYfB5fRMPo+n2VmFbi7ChiS9oWBhZvXrI01TNLg7yPxt51v9rxMfysXwsH8vH+g+wfgDUr+5LcyNV4AAAAABJRU5ErkJggg==\")\n    dec := base64.NewDecoder(base64.StdEncoding, img)\n    w.Header().Set(\"Content-Type\", \"image/jpeg\")\n\n    io.Copy(w, dec)\n}\n\nfunc main() {\n    http.HandleFunc(\"/pix/\", pix)\n    http.HandleFunc(\"/img/\", img)\n    http.HandleFunc(\"/red/\", img)\n    http.HandleFunc(\"/\", img)\n    http.ListenAndServe(\":8080\", nil)\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8461, "user_id": 193982, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/961667038883e6f6832949ba3c98d13e?s=128&d=identicon&r=PG", "display_name": "Mike Gleason jr Couturier", "link": "https://stackoverflow.com/users/193982/mike-gleason-jr-couturier"}, "edited": false, "score": 0, "creation_date": 1521993707, "post_id": 39064998, "comment_id": 85958176, "body": "I believe chunked encoding has nothing to do with it. If you send a response without a length, the client will assume the body is done when the connection is closed or when the chunk, like said here, is done. Maybe you are familiar when downloading a large file and the remaining time was unknown. That&#39;s because a length was not specified. Specifying a length is an extra security feature letting the client know it has the correct body size."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 8461, "user_id": 193982, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/961667038883e6f6832949ba3c98d13e?s=128&d=identicon&r=PG", "display_name": "Mike Gleason jr Couturier", "link": "https://stackoverflow.com/users/193982/mike-gleason-jr-couturier"}, "edited": false, "score": 0, "creation_date": 1522065655, "post_id": 39064998, "comment_id": 85984923, "body": "@MikeGleasonjrCouturier You are describing what a client does when the content length is not specified. I described what the net/http server does when the content length is not specified by the application."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1522162201, "last_edit_date": 1522162201, "creation_date": 1471787807, "answer_id": 39064998, "question_id": 39064343, "link": "https://stackoverflow.com/questions/39064343/how-to-get-the-size-of-an-io-reader-object/39064998#39064998", "title": "How to get the size of an io.reader object", "body": "<p>The application does not need to set the content length. If the application does not specify the content length, then net/http server uses <a href=\"https://en.wikipedia.org/wiki/Chunked_transfer_encoding\" rel=\"nofollow noreferrer\">chunked encoding</a>  for HTTP/1.1 clients. For HTTP/1.0 clients, the net/http server closes the connection after writing the response. There are some edge cases that are not important for this discussion.  What is important is that the net/http server can write the response without knowing the content length.</p>\n\n<p>Use the following code to write the response:</p>\n\n<pre><code>func img(w http.ResponseWriter, r *http.Request) {\n  expiration := time.Now().Add(365 * 24 * time.Hour)\n  cookie := http.Cookie{Name: \"csrftoken\",Value:\"abcd\",Expires:expiration,HttpOnly: false}\n  http.SetCookie(w, &amp;cookie)\n\n  img := bytes.NewBufferString(\"iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAADMUlEQVRYw+2YTUgUYRjHZzOJIoNA+rrUyYNIRQgRHaLo4qFDBEGeunSxS9TFU0QEnhIh6IvokrUzO2uamRmbG6XmR/mVaKZpZVbYvvO143zszsxOz+yahNm+785sITEP72F3Z+adH8/zf5+PpagwtxKXj+Vj+Vg+lo/lY+W+WI4KpddKwWIQFUSF97nNLcLGZt75SiOHchEXfskDVmYjlowpiEoei3UT2ljcFJOpOd169C1Z2SuvgsdpB7cgzB16EV/byGM2xDIVPxQujKmBDF/2m2l0vFvmEin7N2v8kiiPiOeGlGHRvP1RdxA9eYtGR7pk2Pf6lI7RCoP2RaWkZWe3fsFc18hvesAHPGEFUc24ltnx3kyiCJwfRMs6dTXLdSIjO9Osal18qzKfE5V9coDxhlU7qS3uOyiaB55JDtkS2TKoLCLaOLPS4b02pQdCHiUfRKf653/d2kjZN6f10jYxI2EnrGk5H+2WsVi6ZZ8fVSmGQKaYyyFuR6ugmUtVrJo2C7HokeGq8447sYpOPBbo3XFzKC95626sZlz905sUM9XLGbXvtKtTOhZrQDApkhNNkiAOPo/viojh2YSZsj1aF2eQ5n2stuomNQjiiGQanrFufdCXP8gu8tbhjridJ6saVPKExXJrwlwfb3pnAg2Ut0tEBZFI8gza81Tik15DCDIoINQ7aQdBo90RMfrdwNaWLFY9opJGkBQrhCA/HXspQ8W1XHkN6vfWFiGH9ouwhdpJUFuy2JX3eg6uyqENpNHZYcUd02jcLMI2WO67UwZVv1G1HLMq3L83KuEbLPdY7IL2L42p0MMQiuzkq/ncwucOi6qPbWkWoPfCUsENpweUnP1EmE4XGhgagT72RyXolkSCHBbTU3By3fgJj8VyJW3CmSHl8oTWMJuYUUizVvtcsuyJ6J4J663CMLevXar/lJgnKNSgbphzKjriTn5i0F8eX9ODXnEzf6JHvjGtv+aNGdWCOEKnJRmpr5oFVQV8WTWglIKHMlPhv5uqQ1xGYfB5fRMPo+n2VmFbi7ChiS9oWBhZvXrI01TNLg7yPxt51v9rxMfysXwsH8vH+g+wfgDUr+5LcyNV4AAAAABJRU5ErkJggg==\")\n  dec := base64.NewDecoder(base64.StdEncoding, img)\n  w.Header().Set(\"Content-Type\", \"image/jpeg\")\n  io.Copy(w, dec)\n}\n</code></pre>\n\n<p>You can reduce memory allocations by using <a href=\"https://godoc.org/strings#NewReader\" rel=\"nofollow noreferrer\">strings.NewReader</a> instead of bytes.NewBufferString:</p>\n\n<pre><code>img := strings.NewReader(\"iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAADMUlEQVRYw+2YTUgUYRjHZzOJIoNA+rrUyYNIRQgRHaLo4qFDBEGeunSxS9TFU0QEnhIh6IvokrUzO2uamRmbG6XmR/mVaKZpZVbYvvO143zszsxOz+yahNm+785sITEP72F3Z+adH8/zf5+PpagwtxKXj+Vj+Vg+lo/lY+W+WI4KpddKwWIQFUSF97nNLcLGZt75SiOHchEXfskDVmYjlowpiEoei3UT2ljcFJOpOd169C1Z2SuvgsdpB7cgzB16EV/byGM2xDIVPxQujKmBDF/2m2l0vFvmEin7N2v8kiiPiOeGlGHRvP1RdxA9eYtGR7pk2Pf6lI7RCoP2RaWkZWe3fsFc18hvesAHPGEFUc24ltnx3kyiCJwfRMs6dTXLdSIjO9Osal18qzKfE5V9coDxhlU7qS3uOyiaB55JDtkS2TKoLCLaOLPS4b02pQdCHiUfRKf653/d2kjZN6f10jYxI2EnrGk5H+2WsVi6ZZ8fVSmGQKaYyyFuR6ugmUtVrJo2C7HokeGq8447sYpOPBbo3XFzKC95626sZlz905sUM9XLGbXvtKtTOhZrQDApkhNNkiAOPo/viojh2YSZsj1aF2eQ5n2stuomNQjiiGQanrFufdCXP8gu8tbhjridJ6saVPKExXJrwlwfb3pnAg2Ut0tEBZFI8gza81Tik15DCDIoINQ7aQdBo90RMfrdwNaWLFY9opJGkBQrhCA/HXspQ8W1XHkN6vfWFiGH9ouwhdpJUFuy2JX3eg6uyqENpNHZYcUd02jcLMI2WO67UwZVv1G1HLMq3L83KuEbLPdY7IL2L42p0MMQiuzkq/ncwucOi6qPbWkWoPfCUsENpweUnP1EmE4XGhgagT72RyXolkSCHBbTU3By3fgJj8VyJW3CmSHl8oTWMJuYUUizVvtcsuyJ6J4J663CMLevXar/lJgnKNSgbphzKjriTn5i0F8eX9ODXnEzf6JHvjGtv+aNGdWCOEKnJRmpr5oFVQV8WTWglIKHMlPhv5uqQ1xGYfB5fRMPo+n2VmFbi7ChiS9oWBhZvXrI01TNLg7yPxt51v9rxMfysXwsH8vH+g+wfgDUr+5LcyNV4AAAAABJRU5ErkJggg==\")\n</code></pre>\n\n<p>If the application must avoid chunked responses, then the application must set the Content-Length header.  Decode the image to a buffer, get the length of that buffer and set the header before writing the body:</p>\n\n<pre><code>func img(w http.ResponseWriter, r *http.Request) {\n  expiration := time.Now().Add(365 * 24 * time.Hour)\n  cookie := http.Cookie{Name: \"csrftoken\",Value:\"abcd\",Expires:expiration,HttpOnly: false}\n  http.SetCookie(w, &amp;cookie)\n\n  p, err := base64.StdEncoding.DecodeString(\"iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAADMUlEQVRYw+2YTUgUYRjHZzOJIoNA+rrUyYNIRQgRHaLo4qFDBEGeunSxS9TFU0QEnhIh6IvokrUzO2uamRmbG6XmR/mVaKZpZVbYvvO143zszsxOz+yahNm+785sITEP72F3Z+adH8/zf5+PpagwtxKXj+Vj+Vg+lo/lY+W+WI4KpddKwWIQFUSF97nNLcLGZt75SiOHchEXfskDVmYjlowpiEoei3UT2ljcFJOpOd169C1Z2SuvgsdpB7cgzB16EV/byGM2xDIVPxQujKmBDF/2m2l0vFvmEin7N2v8kiiPiOeGlGHRvP1RdxA9eYtGR7pk2Pf6lI7RCoP2RaWkZWe3fsFc18hvesAHPGEFUc24ltnx3kyiCJwfRMs6dTXLdSIjO9Osal18qzKfE5V9coDxhlU7qS3uOyiaB55JDtkS2TKoLCLaOLPS4b02pQdCHiUfRKf653/d2kjZN6f10jYxI2EnrGk5H+2WsVi6ZZ8fVSmGQKaYyyFuR6ugmUtVrJo2C7HokeGq8447sYpOPBbo3XFzKC95626sZlz905sUM9XLGbXvtKtTOhZrQDApkhNNkiAOPo/viojh2YSZsj1aF2eQ5n2stuomNQjiiGQanrFufdCXP8gu8tbhjridJ6saVPKExXJrwlwfb3pnAg2Ut0tEBZFI8gza81Tik15DCDIoINQ7aQdBo90RMfrdwNaWLFY9opJGkBQrhCA/HXspQ8W1XHkN6vfWFiGH9ouwhdpJUFuy2JX3eg6uyqENpNHZYcUd02jcLMI2WO67UwZVv1G1HLMq3L83KuEbLPdY7IL2L42p0MMQiuzkq/ncwucOi6qPbWkWoPfCUsENpweUnP1EmE4XGhgagT72RyXolkSCHBbTU3By3fgJj8VyJW3CmSHl8oTWMJuYUUizVvtcsuyJ6J4J663CMLevXar/lJgnKNSgbphzKjriTn5i0F8eX9ODXnEzf6JHvjGtv+aNGdWCOEKnJRmpr5oFVQV8WTWglIKHMlPhv5uqQ1xGYfB5fRMPo+n2VmFbi7ChiS9oWBhZvXrI01TNLg7yPxt51v9rxMfysXwsH8vH+g+wfgDUr+5LcyNV4AAAAABJRU5ErkJggg==\")\n  if err != nil {\n    http.Error(w, \"internal error\", 500)\n    return\n  }\n  w.Header().Set(\"Content-Type\", \"image/jpeg\")\n  w.Header().Set(\"Content-Length\", strconv.Itoa(len(p)))\n  w.Write(p)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "is_accepted": false, "score": 6, "last_activity_date": 1484061807, "creation_date": 1484061807, "answer_id": 41572280, "question_id": 39064343, "link": "https://stackoverflow.com/questions/39064343/how-to-get-the-size-of-an-io-reader-object/41572280#41572280", "title": "How to get the size of an io.reader object", "body": "<pre><code>func getSize(stream io.Reader) int {\n    buf := new(bytes.Buffer)\n    buf.ReadFrom(stream)\n    return buf.Len()\n}\n</code></pre>\n"}], "owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10449, "favorite_count": 1, "accepted_answer_id": 39064998, "answer_count": 3, "score": 4, "last_activity_date": 1522162201, "creation_date": 1471783470, "last_edit_date": 1471785697, "question_id": 39064343, "link": "https://stackoverflow.com/questions/39064343/how-to-get-the-size-of-an-io-reader-object", "title": "How to get the size of an io.reader object", "body": "<p>I would like to get the size of an io.reader to return the length of a picture for a bse64 concerns.</p>\n\n<p>The main problem is to get the size of dec to return a content-length header</p>\n\n<p>Here is my code  :</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n    \"strconv\"\n    \"io\"\n        base64 \"encoding/base64\"\n    \"bytes\"\n\n)\n\nfunc pix(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi there, I love %s!\", r.URL.Path[1:])\n    cookie, _ := r.Cookie(\"csrftoken\")\n    fmt.Printf(cookie.Value)\n}\n\n\n\nfunc img(w http.ResponseWriter, r *http.Request) {\n    expiration := time.Now().Add(365 * 24 * time.Hour)\n    cookie    :=    http.Cookie{Name: \"csrftoken\",Value:\"abcd\",Expires:expiration,HttpOnly: false}\n    http.SetCookie(w, &amp;cookie)\n    img := bytes.NewBufferString(\"iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAADMUlEQVRYw+2YTUgUYRjHZzOJIoNA+rrUyYNIRQgRHaLo4qFDBEGeunSxS9TFU0QEnhIh6IvokrUzO2uamRmbG6XmR/mVaKZpZVbYvvO143zszsxOz+yahNm+785sITEP72F3Z+adH8/zf5+PpagwtxKXj+Vj+Vg+lo/lY+W+WI4KpddKwWIQFUSF97nNLcLGZt75SiOHchEXfskDVmYjlowpiEoei3UT2ljcFJOpOd169C1Z2SuvgsdpB7cgzB16EV/byGM2xDIVPxQujKmBDF/2m2l0vFvmEin7N2v8kiiPiOeGlGHRvP1RdxA9eYtGR7pk2Pf6lI7RCoP2RaWkZWe3fsFc18hvesAHPGEFUc24ltnx3kyiCJwfRMs6dTXLdSIjO9Osal18qzKfE5V9coDxhlU7qS3uOyiaB55JDtkS2TKoLCLaOLPS4b02pQdCHiUfRKf653/d2kjZN6f10jYxI2EnrGk5H+2WsVi6ZZ8fVSmGQKaYyyFuR6ugmUtVrJo2C7HokeGq8447sYpOPBbo3XFzKC95626sZlz905sUM9XLGbXvtKtTOhZrQDApkhNNkiAOPo/viojh2YSZsj1aF2eQ5n2stuomNQjiiGQanrFufdCXP8gu8tbhjridJ6saVPKExXJrwlwfb3pnAg2Ut0tEBZFI8gza81Tik15DCDIoINQ7aQdBo90RMfrdwNaWLFY9opJGkBQrhCA/HXspQ8W1XHkN6vfWFiGH9ouwhdpJUFuy2JX3eg6uyqENpNHZYcUd02jcLMI2WO67UwZVv1G1HLMq3L83KuEbLPdY7IL2L42p0MMQiuzkq/ncwucOi6qPbWkWoPfCUsENpweUnP1EmE4XGhgagT72RyXolkSCHBbTU3By3fgJj8VyJW3CmSHl8oTWMJuYUUizVvtcsuyJ6J4J663CMLevXar/lJgnKNSgbphzKjriTn5i0F8eX9ODXnEzf6JHvjGtv+aNGdWCOEKnJRmpr5oFVQV8WTWglIKHMlPhv5uqQ1xGYfB5fRMPo+n2VmFbi7ChiS9oWBhZvXrI01TNLg7yPxt51v9rxMfysXwsH8vH+g+wfgDUr+5LcyNV4AAAAABJRU5ErkJggg==\")\n    dec := base64.NewDecoder(base64.StdEncoding, img)\n    w.Header().Set(\"Content-Type\", \"image/jpeg\")\n\n// the problem is here i would like to get the size to return the length of the picture  (lend(dec))\n\n    w.Header().Set(\"Content-Length\", strconv.Itoa(len(dec)))\n\n    io.Copy(w, dec)\n\n}\n\n\nfunc main() {\n    http.HandleFunc(\"/pix/\", pix)\n    http.HandleFunc(\"/img/\", img)\n    http.HandleFunc(\"/red/\", img)\n    http.HandleFunc(\"/\", img)\n    http.ListenAndServe(\":8080\", nil)\n\n}\n</code></pre>\n\n<p>regards and thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 1, "creation_date": 1471786256, "post_id": 39064285, "comment_id": 65478017, "body": "see: <a href=\"https://github.com/jmoiron/sqlx/issues/203\" rel=\"nofollow noreferrer\">github.com/jmoiron/sqlx/issues/203</a>   remove all the extracted files and extract the Go 1.7  again. If you are still seeing the issue, you may try restarting your Terminal as well."}, {"owner": {"reputation": 1887, "user_id": 6514989, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7cc849ff19574490024b6e12ef33c82b?s=128&d=identicon&r=PG&f=1", "display_name": "nail fei", "link": "https://stackoverflow.com/users/6514989/nail-fei"}, "edited": false, "score": 0, "creation_date": 1539337109, "post_id": 39064285, "comment_id": 92474976, "body": "it worked! but I am curious about that why it worked. I dont know what happend when remove and install it again."}], "answers": [{"comments": [{"owner": {"reputation": 648, "user_id": 1027058, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/bb5fb2a8f17aa3c57f48c7e8709c072f?s=128&d=identicon&r=PG", "display_name": "Agniva De Sarker", "link": "https://stackoverflow.com/users/1027058/agniva-de-sarker"}, "edited": false, "score": 3, "creation_date": 1472722620, "post_id": 39083113, "comment_id": 65870447, "body": "I think I know why this happened. I ran the <code>tar</code> command without sudo. And then did <code>ctrl-c</code> after seeing the file copy errors. That created some inconsistencies. I should have removed the folder again and freshly ran the tar command"}], "tags": [], "owner": {"reputation": 13677, "user_id": 5046896, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7GplC.jpg?s=128&g=1", "display_name": "GoingMyWay", "link": "https://stackoverflow.com/users/5046896/goingmyway"}, "is_accepted": true, "score": 37, "last_activity_date": 1486819584, "last_edit_date": 1486819584, "creation_date": 1471878751, "answer_id": 39083113, "question_id": 39064285, "link": "https://stackoverflow.com/questions/39064285/go-project-build-failed-lfstackpack-redeclared-in-this-block/39083113#39083113", "title": "go project build failed: lfstackPack redeclared in this block", "body": "<p>Remove all the extracted files and extract the 1.6 tar again. If you are still seeing the issue, you may try restarting your Terminal as well.</p>\n\n<pre><code>sudo rm -rf /usr/local/go\ntar -C /usr/local -xzf go$VERSION.$OS-$ARCH.tar.gz\n</code></pre>\n\n<p>For more detail, <a href=\"https://github.com/jmoiron/sqlx/issues/203\" rel=\"noreferrer\">see this</a></p>\n"}], "owner": {"reputation": 13677, "user_id": 5046896, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7GplC.jpg?s=128&g=1", "display_name": "GoingMyWay", "link": "https://stackoverflow.com/users/5046896/goingmyway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8366, "favorite_count": 3, "accepted_answer_id": 39083113, "answer_count": 1, "score": 10, "last_activity_date": 1486819584, "creation_date": 1471783118, "question_id": 39064285, "link": "https://stackoverflow.com/questions/39064285/go-project-build-failed-lfstackpack-redeclared-in-this-block", "title": "go project build failed: lfstackPack redeclared in this block", "body": "<p>I am new to Go, when I built my project, it returned the following the error:</p>\n\n<pre><code>/usr/local/go/bin/go run /home/qiuwei/GoWorkSpace/src/LearnGo/SoHi/Hello.go\n# runtime\n/usr/local/go/src/runtime/lfstack_amd64.go:16: lfstackPack redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/lfstack_64bit.go:37\n/usr/local/go/src/runtime/lfstack_amd64.go:20: lfstackUnpack redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/lfstack_64bit.go:41\n/usr/local/go/src/runtime/os_linux_generic.go:13: _SS_DISABLE redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/os2_linux_generic.go:12\n/usr/local/go/src/runtime/os_linux_generic.go:14: _NSIG redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/os2_linux_generic.go:13\n/usr/local/go/src/runtime/os_linux_generic.go:15: _SI_USER redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/os2_linux_generic.go:14\n/usr/local/go/src/runtime/os_linux_generic.go:16: _SIG_BLOCK redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/os2_linux_generic.go:15\n/usr/local/go/src/runtime/os_linux_generic.go:17: _SIG_UNBLOCK redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/os2_linux_generic.go:16\n/usr/local/go/src/runtime/os_linux_generic.go:18: _SIG_SETMASK redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/os2_linux_generic.go:17\n/usr/local/go/src/runtime/os_linux_generic.go:19: _RLIMIT_AS redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/os2_linux_generic.go:18\n/usr/local/go/src/runtime/os_linux_generic.go:25: sigset redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/os2_linux_generic.go:24\n/usr/local/go/src/runtime/os_linux_generic.go:25: too many errors\n</code></pre>\n\n<p>Show my go env:</p>\n\n<pre><code>export PATH=$PATH:/usr/local/go/bin\nexport GOPATH=$HOME/GoWorkSpace\n</code></pre>\n\n<p>Go version: <code>go1.6.3</code>. OS: <code>Ubuntu 14.04</code></p>\n\n<p>How to fix it?</p>\n"}, {"tags": ["dictionary", "go", "instantiation"], "answers": [{"comments": [{"owner": {"reputation": 1794, "user_id": 227955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9748142c77c6fcc340faacba9140d8e?s=128&d=identicon&r=PG", "display_name": "Aidamina", "link": "https://stackoverflow.com/users/227955/aidamina"}, "edited": false, "score": 0, "creation_date": 1471783156, "post_id": 39064279, "comment_id": 65477144, "body": "Makes total sense, i can&#39;t believe I didnt realize this myself. Thanks for the answer and the extra pair of eyes."}], "tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": true, "score": 3, "last_activity_date": 1471783494, "last_edit_date": 1471783494, "creation_date": 1471783085, "answer_id": 39064279, "question_id": 39064239, "link": "https://stackoverflow.com/questions/39064239/assignment-to-entry-in-nil-map/39064279#39064279", "title": "assignment to entry in nil map", "body": "<p>The function takes <code>Test</code> as value, so it gets its own copy of it. All changes to <code>test Test</code> will be gone when the function returns. Take <code>Test</code> by pointer instead:</p>\n\n<pre><code>func (test *Test) init(){\n    test.collection = make(map[uint64] Object)\n}\n</code></pre>\n\n<p>Note though, the struct <code>Test</code> is exported, the method <code>init</code> is not, therefore a user of your library could potentially create a <code>Test</code> but not init it properly. It seems like the go community has established the convention of a freestanding <code>NewType</code> method:</p>\n\n<pre><code>type test struct{\n    collection map[uint64] Object\n}\n\nfunction NewTest() *test {\n    return &amp;test{\n        collection: make(map[uint64] Object),\n    }\n}\n</code></pre>\n\n<p>This ensures a user can only obtain a <code>test</code> by calling <code>NewTest</code> and it will be initialized as intended.</p>\n"}, {"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 1, "last_activity_date": 1471783126, "creation_date": 1471783126, "answer_id": 39064287, "question_id": 39064239, "link": "https://stackoverflow.com/questions/39064239/assignment-to-entry-in-nil-map/39064287#39064287", "title": "assignment to entry in nil map", "body": "<p>You should use a pointer receiver for the <code>init</code> method:</p>\n\n<pre><code>func (test *Test) init() {  // use a pointer to test\n    test.collection = make(map[uint64] Object)\n}\n</code></pre>\n\n<p>Without a pointer, you are initializing a map for a copy of the <code>test</code> object. The actual <code>test</code> object never gets an initialized map.</p>\n\n<p><a href=\"https://play.golang.org/p/hqtz2mCyqR\" rel=\"nofollow\">Working Code</a></p>\n"}], "owner": {"reputation": 1794, "user_id": 227955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9748142c77c6fcc340faacba9140d8e?s=128&d=identicon&r=PG", "display_name": "Aidamina", "link": "https://stackoverflow.com/users/227955/aidamina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1225, "favorite_count": 0, "accepted_answer_id": 39064279, "answer_count": 2, "score": 0, "last_activity_date": 1471783494, "creation_date": 1471782849, "question_id": 39064239, "link": "https://stackoverflow.com/questions/39064239/assignment-to-entry-in-nil-map", "title": "assignment to entry in nil map", "body": "<p>I am trying to assign values to a map that is initialized in the init func.</p>\n\n<p>But panic occurs:\nassignment to entry in nil map</p>\n\n<pre><code>package main\n\ntype Object interface { \n}\n\ntype ObjectImpl struct {\n}\n\ntype Test struct{\n    collection map[uint64] Object\n}\n\nfunc (test Test) init(){\n    test.collection = make(map[uint64] Object)\n}\n\nfunc main() {\n    test := &amp;Test{}\n    test.init()\n    test.collection[1]=&amp;ObjectImpl{}\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/yOwXzDkWIo\" rel=\"nofollow\">https://play.golang.org/p/yOwXzDkWIo</a></p>\n"}, {"tags": ["go", "struct", "padding", "memory-alignment"], "comments": [{"owner": {"reputation": 598, "user_id": 311928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/014bbf1271c7650452a0149399e9344f?s=128&d=identicon&r=PG", "display_name": "jpgerek", "link": "https://stackoverflow.com/users/311928/jpgerek"}, "edited": false, "score": 2, "creation_date": 1478960356, "post_id": 39063530, "comment_id": 68364420, "body": "I made an example that may provide some insights <a href=\"https://play.golang.org/p/dNWspo2Dxv\" rel=\"nofollow noreferrer\">play.golang.org/p/dNWspo2Dxv</a>"}], "answers": [{"comments": [{"owner": {"reputation": 168, "user_id": 3426066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e45c02f2ae5f812a55c4975124da6b2?s=128&d=identicon&r=PG", "display_name": "Chewxy", "link": "https://stackoverflow.com/users/3426066/chewxy"}, "edited": false, "score": 3, "creation_date": 1474874516, "post_id": 39064146, "comment_id": 66692319, "body": "I&#39;d also like to add that you can visualize your struct by using tools like <a href=\"https://github.com/dominikh/go-structlayout\" rel=\"nofollow noreferrer\">structlayout</a> and <a href=\"https://github.com/opennota/check\" rel=\"nofollow noreferrer\">aligncheck</a> to help you optimize your layout of structs."}], "tags": [], "owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "is_accepted": true, "score": 19, "last_activity_date": 1473541515, "last_edit_date": 1473541515, "creation_date": 1471782191, "answer_id": 39064146, "question_id": 39063530, "link": "https://stackoverflow.com/questions/39063530/optimising-datastructure-word-alignment-padding-in-golang/39064146#39064146", "title": "Optimising datastructure/word alignment padding in golang", "body": "<p>Currently there's no compile-time optimisation; the values are padded to 8 bytes on x64.</p>\n\n<p>You can manually arrange structs to optimally utilise space; typically by going from larger types to smaller; 8 consecutive byte fields for example, will only use 8 bytes, but a single byte would be padded to an 8 byte alignment, consider this: <a href=\"https://play.golang.org/p/0qsgpuAHHp\" rel=\"noreferrer\">https://play.golang.org/p/0qsgpuAHHp</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype Compact struct {\n    a, b                   uint64\n    c, d, e, f, g, h, i, j byte\n}\n\n// Larger memory footprint than \"Compact\" - but less fields!\ntype Inefficient struct {\n    a uint64\n    b byte\n    c uint64\n    d byte\n}\n\nfunc main() {\n    newCompact := new(Compact)\n    fmt.Println(unsafe.Sizeof(*newCompact))\n    newInefficient := new(Inefficient)\n    fmt.Println(unsafe.Sizeof(*newInefficient))\n}\n</code></pre>\n\n<p>If you take this into consideration; you can optimise the memory footprint of your structs.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 13, "last_activity_date": 1471782330, "creation_date": 1471782330, "answer_id": 39064162, "question_id": 39063530, "link": "https://stackoverflow.com/questions/39063530/optimising-datastructure-word-alignment-padding-in-golang/39064162#39064162", "title": "Optimising datastructure/word alignment padding in golang", "body": "<blockquote>\n  <p>Or shouldn't I be worried about this at all?</p>\n</blockquote>\n\n<p>Yes you should.<br>\nThis is also called <a href=\"https://dzone.com/articles/mechanical-sympathy\"><strong>mechanical sympathy</strong></a> (see this <a href=\"https://changelog.com/gotime-6/\">Go Time podcast episode</a>), so it also depends on the hardware architecture you are compiling for.</p>\n\n<p>See as illustration:</p>\n\n<ul>\n<li>\"<a href=\"http://kernel-panic.runkite.com/2015/01/28/reflect-unsafe-and-other-unsavoury-go-hacks/\">The day byte alignment came back to bite me</a>\" (January 2014)</li>\n<li>\"<a href=\"http://blog.chewxy.com/2016/07/25/on-the-memory-alignment-of-go-slice-values/\">On the memory alignment of Go slice values</a>\" (July 2016)</li>\n</ul>\n\n<blockquote>\n  <p>The values in Go slices are 16-byte aligned. They are not 32 byte aligned.<br>\n  Go pointers are byte-aligned.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 13740250, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-i9sykZR9J_o/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucmQvDpbd30wsc6hp32X3T_9Pvsy4g/photo.jpg?sz=128", "display_name": "John Brown", "link": "https://stackoverflow.com/users/13740250/john-brown"}, "is_accepted": false, "score": 2, "last_activity_date": 1592060188, "creation_date": 1592060188, "answer_id": 62361484, "question_id": 39063530, "link": "https://stackoverflow.com/questions/39063530/optimising-datastructure-word-alignment-padding-in-golang/62361484#62361484", "title": "Optimising datastructure/word alignment padding in golang", "body": "<p>It depends on type of application that you are developing and on usage of those structures. If application needs to meet some memory/performance criteria you definitely should care about memory alignment and paddings, but not only - there is nice article <a href=\"https://www.usenix.org/legacy/publications/library/proceedings/als00/2000papers/papers/full_papers/sears/sears_html/index.html\" rel=\"nofollow noreferrer\">https://www.usenix.org/legacy/publications/library/proceedings/als00/2000papers/papers/full_papers/sears/sears_html/index.html</a> that highlights theme of optimal CPU caches usage and correlation between struct layouts and performance. It highlights cache line alignment, false sharing, etc. </p>\n\n<p>Also there is a nice golang tool <a href=\"https://github.com/1pkg/gopium\" rel=\"nofollow noreferrer\">https://github.com/1pkg/gopium</a> that helps to automate those optimizations, check it out!</p>\n"}], "owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4568, "favorite_count": 8, "accepted_answer_id": 39064146, "answer_count": 3, "score": 19, "last_activity_date": 1592060188, "creation_date": 1471777851, "question_id": 39063530, "link": "https://stackoverflow.com/questions/39063530/optimising-datastructure-word-alignment-padding-in-golang", "title": "Optimising datastructure/word alignment padding in golang", "body": "<p>Similar to what I've learned in C++, I believe it's the padding that causes a difference in the size of instances of both structs. </p>\n\n<pre><code>type Foo struct {\n    w byte //1 byte\n    x byte //1 byte\n    y uint64 //8 bytes\n}\ntype Bar struct {\n    x byte //1 byte\n    y uint64 //8 bytes\n    w byte// 1 byte\n}\nfunc main() {\n    fmt.Println(runtime.GOARCH)\n    newFoo := new(Foo)\n    fmt.Println(unsafe.Sizeof(*newFoo))\n    newBar := new(Bar)\n    fmt.Println(unsafe.Sizeof(*newBar))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>amd64\n16\n24\n</code></pre>\n\n<ul>\n<li>Is there a rule of thumb to follow when defining struct members? (like ascending/descending order of size of types)</li>\n<li>Is there a compile time optimisation which we can pass, that can automatically take care of this?</li>\n<li>Or shouldn't I be worried about this at all?</li>\n</ul>\n"}, {"tags": ["python", "google-app-engine", "go", "google-api-go-client"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1471779471, "post_id": 39063494, "comment_id": 65476233, "body": "Don&#39;t pass dot <code>.</code>, simply start with <code>goapp serve</code>. Does this fix it?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1471786947, "post_id": 39063494, "comment_id": 65478239, "body": "Use the command <code>goapp.bat serve &lt;path to directory containing app.yaml&gt;</code> or cd to that directory and run <code>goapp.bat serve</code>.  If that does not fix the problem, then take a look at  <a href=\"http://stackoverflow.com/questions/38711615/appengine-appengine-package-always-fails-with-syscall-or-unsafe-import-fai/38713152#38713152\" title=\"appengine appengine package always fails with syscall or unsafe import fai\">stackoverflow.com/questions/38711615/&hellip;</a>.  You might have GOPATH pointing into the app directory."}, {"owner": {"reputation": 417, "user_id": 3603632, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100000118135942/picture?type=large", "display_name": "user3603632", "link": "https://stackoverflow.com/users/3603632/user3603632"}, "edited": false, "score": 0, "creation_date": 1471802907, "post_id": 39063494, "comment_id": 65482913, "body": "<code>goapp serve</code> didn&#39;t fix it. Yes my GOPATH points to appdirectiory. I edited my post with my current directory structure."}], "answers": [{"tags": [], "owner": {"reputation": 417, "user_id": 3603632, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100000118135942/picture?type=large", "display_name": "user3603632", "link": "https://stackoverflow.com/users/3603632/user3603632"}, "is_accepted": true, "score": 0, "last_activity_date": 1472070706, "creation_date": 1472070706, "answer_id": 39132556, "question_id": 39063494, "link": "https://stackoverflow.com/questions/39063494/golang-appengine-filename-too-long/39132556#39132556", "title": "golang appengine - filename too long", "body": "<p>I solved the problem by setting my GOPATH.</p>\n\n<p>It's set now like this:</p>\n\n<pre><code>GOPATH=C:\\Users\\me\\development\\appengine\\gopath;C:\\Users\\me\\project\n</code></pre>\n\n<p>Now everything works find and the uploaded file is much smaller now. 2MB vs. 11MB.</p>\n\n<p>Thanks for the tip.</p>\n"}], "owner": {"reputation": 417, "user_id": 3603632, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100000118135942/picture?type=large", "display_name": "user3603632", "link": "https://stackoverflow.com/users/3603632/user3603632"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 1, "accepted_answer_id": 39132556, "answer_count": 1, "score": 2, "last_activity_date": 1575361859, "creation_date": 1471777542, "last_edit_date": 1575361859, "question_id": 39063494, "link": "https://stackoverflow.com/questions/39063494/golang-appengine-filename-too-long", "title": "golang appengine - filename too long", "body": "<p>I developed an appengine application in GO and now I tried to use the androidpublisher api. For this I need many dependencies like:</p>\n\n<ul>\n<li>github.com/google/google-api-go-client</li>\n<li>github.com/golang/oauth2</li>\n<li>google.golang.org/appengine</li>\n<li>google.golang.org/appengine/urlfetch</li>\n</ul>\n\n<p>I tried to setup oauth2 authentication for google-api-go-client according to the example in <a href=\"https://github.com/golang/oauth2\" rel=\"nofollow\">https://github.com/golang/oauth2</a></p>\n\n<p>Everything looks fine but I can't run the app-server anymore on my windows development machine. It complains about too long filenames:</p>\n\n<pre><code>INFO     2016-08-20 22:48:03,786 devappserver2.py:769] Skipping SDK update check. \nINFO     2016-08-20 22:48:03,960 api_server.py:205] Starting API server at: http://localhost:64053 \nINFO     2016-08-20 22:48:03,969 dispatcher.py:197] Starting module \"default\" running at: http://localhost:8080 \nINFO     2016-08-20 22:48:03,974 admin_server.py:116] Starting admin server at:http://localhost:8000\n\nException in thread Instance Adjustment: Traceback (most recent call last):   \n    File \"C:\\Python27\\lib\\threading.py\", line 801, in __bootstrap_inner \n      self.run()   \n    File \"C:\\Python27\\lib\\threading.py\", line 754, in run \n      self.__target(*self.__args, **self.__kwargs)   \n    File \"C:\\work\\go_appengine\\google\\appengine\\tools\\devappserver2\\module.py\",line 1485, in _loop_adjusting_instances \n      self._adjust_instances()  \n    File \"C:\\work\\go_appengine\\google\\appengine\\tools\\devappserver2\\module.py\",line 1460, in _adjust_instances \n      self._add_instance(permit_warmup=True)\n    File \"C:\\work\\go_appengine\\google\\appengine\\tools\\devappserver2\\module.py\",line 1338, in _add_instance \n      expect_ready_request=perform_warmup)  \n    File \"C:\\work\\go_appengine\\google\\appengine\\tools\\devappserver2\\go_runtime.py\",line 174, in new_instance \n      if self._go_application.maybe_build(self._modified_since_last_build):  \n    File \"C:\\work\\go_appengine\\google\\appengine\\tools\\devappserver2\\go_application.py\",line 304, in maybe_build \n      self._extras_hash, old_extras_hash = (self._get_extras_hash(),   \n    File \"C:\\work\\go_appengine\\google\\appengine\\tools\\devappserver2\\go_application.py\",line 247, in _get_extras_hash gab_stdout, \n      _ = self._run_gab(gab_args, env={})   \n    File \"C:\\work\\go_appengine\\google\\appengine\\tools\\devappserver2\\go_application.py\",line 175, in _run_gab\n      gab_extra_args, env)   \n    File \"C:\\work\\go_appengine\\google\\appengine\\tools\\devappserver2\\go_application.py\",line 111, in _run_gab \n      env=env)   \n    File \"C:\\work\\go_appengine\\google\\appengine\\tools\\devappserver2\\safe_subprocess.py\",line 74, in start_process \n      stdin=subprocess.PIPE, startupinfo=startupinfo)   \n    File \"C:\\Python27\\lib\\subprocess.py\", line710, in __init__  \n      errread, errwrite)   \n    File \"C:\\Python27\\lib\\subprocess.py\", line 958, in _execute_child \n      startupinfo) \n    WindowsError: [Error 206] The filename or extension is too long\n</code></pre>\n\n<p>I think my <code>GOPATH</code> is set up wrong so he gives all gofiles as argument to <code>go-app-builder.exe</code>.</p>\n\n<p>My project is under <code>C:\\Users\\me\\project\\</code> that's where the gopath points to and were I'm standing when I type: </p>\n\n<pre><code>goapp.bat serve .\n</code></pre>\n\n<p>Can someone help to fix this problem? Thank you.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>My project structure is like this:\nHow should i set my GOPATH? </p>\n\n<pre><code>GOPATH\n  $GOPATH\n       app.yaml\n       cron.yaml\n       pkg\n       src\n            testapp\n                 app.go\n        golang.org\n            x\n                  oauth2\n</code></pre>\n\n<p><strong>Edit 2</strong></p>\n\n<p>I tried to move my GOPATH to project-root-dir/gopath but now i get this error message:</p>\n\n<pre><code>Exception in thread Instance Adjustment: Traceback (most recent call last):   File \"C:\\Python27\\lib\\threading.py\", line 810, in\n__bootstrap_inner\n    self.run()   File \"C:\\Python27\\lib\\threading.py\", line 763, in run\n    self.__target(*self.__args, **self.__kwargs)   File \"C:\\Users\\Indra\\development\\tools\\go_appengine\\google\\appengine\\tools\\devappserver2\\module.py\", line 1486, in _loop_adjusting_instances\n    self._adjust_instances()   File \"C:\\Users\\Indra\\development\\tools\\go_appengine\\google\\appengine\\tools\\devappserver2\\module.py\", line 1461, in _adjust_instances\n    self._add_instance(permit_warmup=True)   File \"C:\\Users\\Indra\\development\\tools\\go_appengine\\google\\appengine\\tools\\devappserver2\\module.py\", line 1339, in _add_instance\n    expect_ready_request=perform_warmup)   File \"C:\\Users\\Indra\\development\\tools\\go_appengine\\google\\appengine\\tools\\devappserver2\\go_runtime.py\", line 176, in new_instance\n    if self._go_application.maybe_build(self._modified_since_last_build):   File \"C:\\Users\\Indra\\development\\tools\\go_appengine\\google\\appengine\\tools\\devappserver2\\go_application.py\", line 304, in maybe_build\n    self._extras_hash, old_extras_hash = (self._get_extras_hash(),   File \"C:\\Users\\Indra\\development\\tools\\go_appengine\\google\\appengine\\tools\\devappserver2\\go_application.py\", line 247, in _get_extras_hash\n    gab_stdout, _ = self._run_gab(gab_args, env={})   File \"C:\\Users\\Indra\\development\\tools\\go_appengine\\google\\appengine\\tools\\devappserver2\\go_application.py\", line 175, in _run_gab\n    gab_extra_args, env)   File \"C:\\Users\\Indra\\development\\tools\\go_appengine\\google\\appengine\\tools\\devappserver2\\go_application.py\", line 111, in _run_gab\n    env=env)   File \"C:\\Users\\Indra\\development\\tools\\go_appengine\\google\\appengine\\tools\\devappserver2\\safe_subprocess.py\", line 74, in start_process\n    stdin=subprocess.PIPE, startupinfo=startupinfo)   File \"C:\\Python27\\lib\\subprocess.py\", line 710, in __init__\n    errread, errwrite)   File \"C:\\Python27\\lib\\subprocess.py\", line 958, in _execute_child\n    startupinfo) WindowsError: [Error 87] Falscher Parameter\n</code></pre>\n\n<p>for all non german users it complains about a wrong parameter</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1471771650, "post_id": 39061645, "comment_id": 65474288, "body": "Also related: <a href=\"http://stackoverflow.com/questions/38811253/go-embedding-a-primitive-type\">Go: Embedding a primitive type?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 157, "user_id": 3088280, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/814c5f8886e75babd54d53848e54e25a?s=128&d=identicon&r=PG&f=1", "display_name": "cleung2010", "link": "https://stackoverflow.com/users/3088280/cleung2010"}, "is_accepted": true, "score": 1, "last_activity_date": 1471764088, "last_edit_date": 1495542772, "creation_date": 1471764088, "answer_id": 39061816, "question_id": 39061645, "link": "https://stackoverflow.com/questions/39061645/accessing-values-from-embedded-slice-in-struct/39061816#39061816", "title": "Accessing values from embedded slice in struct", "body": "<p>I think I found the answer in this post: <a href=\"https://stackoverflow.com/questions/26447066/golang-anonymous-field-of-type-map\">golang anonymous field of type map</a></p>\n\n<blockquote>\n  <p>Only fields and methods may be \"promoted\" when you embed. For\n  everything else they act as just another field.</p>\n</blockquote>\n\n<p>In this case the struct would be the equivalent of:</p>\n\n<pre><code>type A struct {\n    aSlice aSlice\n}\n</code></pre>\n\n<p>Which makes sense why its values are only accessible via <code>A.aSlice</code> indexing.</p>\n"}, {"tags": [], "owner": {"reputation": 2514, "user_id": 854276, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d92c4f63bcfd11096e6b0e25267dcc37?s=128&d=identicon&r=PG", "display_name": "Saikiran Yerram", "link": "https://stackoverflow.com/users/854276/saikiran-yerram"}, "is_accepted": false, "score": 1, "last_activity_date": 1472015613, "creation_date": 1472015613, "answer_id": 39114893, "question_id": 39061645, "link": "https://stackoverflow.com/questions/39061645/accessing-values-from-embedded-slice-in-struct/39114893#39114893", "title": "Accessing values from embedded slice in struct", "body": "<p>If you declare the slice as a exported type, then you can access the embedded slice. But you still can't do indexing.</p>\n\n<pre><code>package a\ntype Slice []string\ntype A struct {\n   Slice\n}\n\npackage main\nimport \"a\"\nfunc main() {\n  _a := a.AB{[]string{\"hello\", \"world\"}}\n  fmt.Println(_a.Slice[0])\n}\n</code></pre>\n"}], "owner": {"reputation": 157, "user_id": 3088280, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/814c5f8886e75babd54d53848e54e25a?s=128&d=identicon&r=PG&f=1", "display_name": "cleung2010", "link": "https://stackoverflow.com/users/3088280/cleung2010"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1766, "favorite_count": 0, "accepted_answer_id": 39061816, "answer_count": 2, "score": 1, "last_activity_date": 1472015613, "creation_date": 1471762767, "question_id": 39061645, "link": "https://stackoverflow.com/questions/39061645/accessing-values-from-embedded-slice-in-struct", "title": "Accessing values from embedded slice in struct", "body": "<p>I am trying to access values from an embedded slice in a struct. How can I do so via indexing, and without calling the private embedded object explicitly (which is not even an option when accessing from outside the package), if that's possible at all? </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype A struct {\n    aSlice\n}\n\ntype aSlice []string\n\nfunc main() {\n    a := A{[]string{\"hello\", \"world\"}}\n    fmt.Println(a.aSlice[0]) // works, but can't be accessed outside package\n    fmt.Println(a[0]) // doesn't work, but looking for this something like this\n}\n</code></pre>\n"}, {"tags": ["go", "concurrency", "integral"], "answers": [{"tags": [], "owner": {"reputation": 1189, "user_id": 3931609, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/4n2cW.jpg?s=128&g=1", "display_name": "Kul", "link": "https://stackoverflow.com/users/3931609/kul"}, "is_accepted": false, "score": 3, "last_activity_date": 1471759303, "creation_date": 1471759303, "answer_id": 39061293, "question_id": 39060899, "link": "https://stackoverflow.com/questions/39060899/concurrent-integral-calculation-in-golang/39061293#39061293", "title": "Concurrent integral calculation in Golang", "body": "<p>Unless the time taken by the activity in the goroutine takes a lot more time than needed to switch contexts, carry out the task and use a mutex to update a value, it would be faster to do it serially.</p>\n\n<p>Take a look at a slightly modified version. All I've done is add a delay of 1 microsecond in the <code>f()</code> function.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"sync\"\n    \"time\"\n)\n\ntype Result struct {\n    result float64\n    lock   sync.RWMutex\n}\n\nvar wg sync.WaitGroup\nvar result Result\n\nfunc main() {\n    fmt.Println(\"concurrent\")\n    concurrent()\n    result.result = 0\n    fmt.Println(\"serial\")\n    serial()\n}\n\nfunc concurrent() {\n    now := time.Now()\n    a := 0.0\n    b := 1.0\n    n := 100000.0\n    deltax := (b - a) / n\n    wg.Add(int(n))\n    for i := 0.0; i &lt; n; i++ {\n        go f(a, deltax, i, true)\n    }\n    wg.Wait()\n    fmt.Println(deltax * result.result)\n    fmt.Println(time.Now().Sub(now))\n}\n\nfunc serial() {\n    now := time.Now()\n    a := 0.0\n    b := 1.0\n    n := 100000.0\n    deltax := (b - a) / n\n    for i := 0.0; i &lt; n; i++ {\n        f(a, deltax, i, false)\n    }\n    fmt.Println(deltax * result.result)\n    fmt.Println(time.Now().Sub(now))\n}\n\nfunc f(a, deltax, i float64, concurrent bool) {\n    time.Sleep(1 * time.Microsecond)\n    fx := math.Sqrt(a + deltax*(i+0.5))\n    if concurrent {\n        result.lock.Lock()\n        result.result += fx\n        result.lock.Unlock()\n        wg.Done()\n    } else {\n        result.result += fx\n    }\n}\n</code></pre>\n\n<p>With the delay, the result was as follows (the concurrent version is much faster):</p>\n\n<pre><code>concurrent\n0.6666666685900424\n624.914165ms\n\nserial\n0.6666666685900422\n5.609195767s\n</code></pre>\n\n<p>Without the delay:</p>\n\n<pre><code>concurrent\n0.6666666685900428\n50.771275ms\n\nserial\n0.6666666685900422\n749.166\u00b5s\n</code></pre>\n\n<p>As you can see, the longer it takes to complete a task, the more sense it makes to do it concurrently, if possible.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1471797796, "post_id": 39061770, "comment_id": 65481480, "body": "@husain-al-marzooq  I hope this helps."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 3, "last_activity_date": 1471800459, "last_edit_date": 1471800459, "creation_date": 1471763688, "answer_id": 39061770, "question_id": 39060899, "link": "https://stackoverflow.com/questions/39060899/concurrent-integral-calculation-in-golang/39061770#39061770", "title": "Concurrent integral calculation in Golang", "body": "<p>3- <strong>For performance gain,  you may divide tasks per CPU cores without using <code>lock sync.RWMutex</code></strong>:   </p>\n\n<p><code>+30x</code> Optimizations using channels and <code>runtime.NumCPU()</code>, this takes <code>2ms</code> on 2 Cores and <code>993\u00b5s</code> on 8 Cores, while Your sample code takes <code>61ms</code> on 2 Cores and <code>40ms</code> on 8 Cores:</p>\n\n<p>See this working sample code and outputs:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc main() {\n    nCPU := runtime.NumCPU()\n    fmt.Println(\"nCPU =\", nCPU)\n    ch := make(chan float64, nCPU)\n    startTime := time.Now()\n    a := 0.0\n    b := 1.0\n    n := 100000.0 \n    deltax := (b - a) / n\n\n    stepPerCPU := n / float64(nCPU)\n    for start := 0.0; start &lt; n; {\n        stop := start + stepPerCPU\n        go f(start, stop, a, deltax, ch)\n        start = stop\n    }\n\n    integral := 0.0\n    for i := 0; i &lt; nCPU; i++ {\n        integral += &lt;-ch\n    }\n\n    fmt.Println(time.Now().Sub(startTime))\n    fmt.Println(deltax * integral)\n}\n\nfunc f(start, stop, a, deltax float64, ch chan float64) {\n    result := 0.0\n    for i := start; i &lt; stop; i++ {\n        result += math.Sqrt(a + deltax*(i+0.5))\n    }\n    ch &lt;- result\n}\n</code></pre>\n\n<p>Output on 2 Cores:</p>\n\n<pre><code>nCPU = 2\n2.0001ms\n0.6666666685900485\n</code></pre>\n\n<p>Output on 8 Cores:</p>\n\n<pre><code>nCPU = 8\n993\u00b5s\n0.6666666685900456\n</code></pre>\n\n<p>Your sample code, Output on 2 Cores:</p>\n\n<pre><code>0.6666666685900424\n61.0035ms\n</code></pre>\n\n<p>Your sample code, Output on 8 Cores:</p>\n\n<pre><code>0.6666666685900415\n40.9964ms\n</code></pre>\n\n<hr>\n\n<p>2- <strong>For good benchmark statistics, use large number of samples (big n):</strong>  </p>\n\n<p>As you See here using 2 Cores this takes <code>110ms</code> on 2 Cores, but on this same CPU \nusing 1 Core this takes <code>215ms</code> with <code>n := 10000000.0</code>:  </p>\n\n<p>With <code>n := 10000000.0</code> and single goroutine, see this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"time\"\n)\n\nfunc main() {\n    now := time.Now()\n    a := 0.0\n    b := 1.0\n    n := 10000000.0\n    deltax := (b - a) / n\n    result := 0.0\n    for i := 0.0; i &lt; n; i++ {\n        result += math.Sqrt(a + deltax*(i+0.5))\n    }\n    fmt.Println(time.Now().Sub(now))\n    fmt.Println(deltax * result)\n}\n</code></pre>\n\n<p>Output:  </p>\n\n<pre><code>215.0123ms\n0.6666666666685884\n</code></pre>\n\n<hr>\n\n<p>With <code>n := 10000000.0</code> and 2 goroutines, see this working sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc main() {\n    nCPU := runtime.NumCPU()\n    fmt.Println(\"nCPU =\", nCPU)\n    ch := make(chan float64, nCPU)\n    startTime := time.Now()\n    a := 0.0\n    b := 1.0\n    n := 10000000.0\n    deltax := (b - a) / n\n\n    stepPerCPU := n / float64(nCPU)\n    for start := 0.0; start &lt; n; {\n        stop := start + stepPerCPU\n        go f(start, stop, a, deltax, ch)\n        start = stop\n    }\n\n    integral := 0.0\n    for i := 0; i &lt; nCPU; i++ {\n        integral += &lt;-ch\n    }\n\n    fmt.Println(time.Now().Sub(startTime))\n    fmt.Println(deltax * integral)\n}\n\nfunc f(start, stop, a, deltax float64, ch chan float64) {\n    result := 0.0\n    for i := start; i &lt; stop; i++ {\n        result += math.Sqrt(a + deltax*(i+0.5))\n    }\n    ch &lt;- result\n}\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>nCPU = 2\n110.0063ms\n0.6666666666686073\n</code></pre>\n\n<hr>\n\n<p>1- <strong>There is an optimum point for number of Goroutines, And from this point forward increasing number of Goroutines doesn't reduce program execution time:</strong></p>\n\n<p>On 2 Cores CPU, with the following code, The result is: </p>\n\n<pre><code>nCPU: 1,          2,          4,         8,           16\nTime: 2.1601236s, 1.1220642s, 1.1060633s, 1.1140637s, 1.1380651s\n</code></pre>\n\n<p>As you see from <code>nCPU=1</code>  to <code>nCPU=2</code> time decrease is big enough but after this point it is not much, so <code>nCPU=2</code> on 2 Cores CPU is Optimum point for this Sample code, so using  <code>nCPU := runtime.NumCPU()</code> is enough here. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"time\"\n)\n\nfunc main() {\n    nCPU := 2 //2.1601236s@1 1.1220642s@2 1.1060633s@4 1.1140637s@8 1.1380651s@16\n    fmt.Println(\"nCPU =\", nCPU)\n    ch := make(chan float64, nCPU)\n    startTime := time.Now()\n    a := 0.0\n    b := 1.0\n    n := 100000000.0\n    deltax := (b - a) / n\n\n    stepPerCPU := n / float64(nCPU)\n    for start := 0.0; start &lt; n; {\n        stop := start + stepPerCPU\n        go f(start, stop, a, deltax, ch)\n        start = stop\n    }\n\n    integral := 0.0\n    for i := 0; i &lt; nCPU; i++ {\n        integral += &lt;-ch\n    }\n\n    fmt.Println(time.Now().Sub(startTime))\n    fmt.Println(deltax * integral)\n}\n\nfunc f(start, stop, a, deltax float64, ch chan float64) {\n    result := 0.0\n    for i := start; i &lt; stop; i++ {\n        result += math.Sqrt(a + deltax*(i+0.5))\n    }\n    ch &lt;- result\n}\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 4644054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/179742b0940ef2cd3b6f7b4e21bfb338?s=128&d=identicon&r=PG&f=1", "display_name": "idk", "link": "https://stackoverflow.com/users/4644054/idk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 649, "favorite_count": 0, "accepted_answer_id": 39061770, "answer_count": 2, "score": 2, "last_activity_date": 1471800459, "creation_date": 1471754493, "last_edit_date": 1471763852, "question_id": 39060899, "link": "https://stackoverflow.com/questions/39060899/concurrent-integral-calculation-in-golang", "title": "Concurrent integral calculation in Golang", "body": "<p>I tried to compute the integral concurrently, but my program ended up being slower than computing the integral with a normal for loop. What am I doing wrong?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"sync\"\n    \"time\"\n)\n\ntype Result struct {\n    result float64\n    lock sync.RWMutex\n}\n\nvar wg sync.WaitGroup\nvar result Result\n\nfunc main() {\n    now := time.Now()\n    a := 0.0\n    b := 1.0\n    n := 100000.0\n    deltax := (b - a) / n\n    wg.Add(int(n))\n    for i := 0.0; i &lt; n; i++ {\n        go f(a, deltax, i)\n    }\n    wg.Wait()\n    fmt.Println(deltax * result.result)\n    fmt.Println(time.Now().Sub(now))\n}\n\nfunc f(a float64, deltax float64, i float64) {\n    fx := math.Sqrt(a + deltax * (i + 0.5))\n    result.lock.Lock()\n    result.result += fx\n    result.lock.Unlock()\n    wg.Done()\n}\n</code></pre>\n"}, {"tags": ["image-processing", "go", "scaling", "downsampling", "lanczos"], "answers": [{"tags": [], "owner": {"reputation": 2449, "user_id": 6346483, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154223277015798/picture?type=large", "display_name": "Anish Goyal", "link": "https://stackoverflow.com/users/6346483/anish-goyal"}, "is_accepted": true, "score": 1, "last_activity_date": 1471759657, "creation_date": 1471759657, "answer_id": 39061328, "question_id": 39059902, "link": "https://stackoverflow.com/questions/39059902/rough-edges-with-lanczos-resampling-in-golang/39061328#39061328", "title": "Rough Edges With Lanczos Resampling in Golang", "body": "<p>Alright, I think I've found one way to solve the aliasing problem. Instead of using lanczos3, I used bilinear interpolation to resample the source image at a size slightly higher than what I was going for (edgeSize = 1080), gaussian blurred the image, then scaled the image down to the target size (edgeSize = 600), this time with bicubic interpolation. This gave me results just about the same as the ones RMagick was giving me.</p>\n"}], "owner": {"reputation": 2449, "user_id": 6346483, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154223277015798/picture?type=large", "display_name": "Anish Goyal", "link": "https://stackoverflow.com/users/6346483/anish-goyal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 432, "favorite_count": 1, "accepted_answer_id": 39061328, "answer_count": 1, "score": 1, "last_activity_date": 1471759657, "creation_date": 1471739927, "question_id": 39059902, "link": "https://stackoverflow.com/questions/39059902/rough-edges-with-lanczos-resampling-in-golang", "title": "Rough Edges With Lanczos Resampling in Golang", "body": "<p>I've been writing some basic methods to resize images in Golang. I've seen several posts about resizing images, but for the life of me I can't figure out what I'm missing...</p>\n\n<p>Essentially, my issue is that when resizing an image in Golang, my results seem to have a lot of aliasing.</p>\n\n<p>I've tried iteratively downsampling the image, but that didn't yield much of an improvement.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>func resize(original image.Image,\n    edgeSize int, filterSize int) image.Image {\n\n    oldBounds := original.Bounds()\n    if oldBounds.Dx() &lt; edgeSize &amp;&amp; oldBounds.Dy() &lt; edgeSize {\n        // No resize necessary\n        return original\n    }\n\n    threshold := edgeSize * 4 / 3\n    if oldBounds.Dx() &gt; threshold || oldBounds.Dy() &gt; threshold {\n        fmt.Println(\"Upstream\")\n        original = customResizeImageToFitBounds(original, threshold, filterSize)\n        oldBounds = original.Bounds()\n    }\n\n    newBounds := getNewBounds(oldBounds, edgeSize)\n\n    resized := image.NewRGBA(newBounds)\n\n    var ratioX = float64(oldBounds.Dx()) / float64(newBounds.Dx())\n    var ratioY = float64(oldBounds.Dy()) / float64(newBounds.Dy())\n\n    for x := 0; x &lt; newBounds.Dx(); x++ {\n        for y := 0; y &lt; newBounds.Dy(); y++ {\n            sourceX := ratioX * float64(x)\n            minX := int(math.Floor(sourceX))\n\n            sourceY := ratioY * float64(y)\n            minY := int(math.Floor(sourceY))\n\n            sampleSize := filterSize&lt;&lt;1 + 1\n            var xCoeffs = make([]float64, sampleSize)\n            var yCoeffs = make([]float64, sampleSize)\n\n            var sumX = 0.0\n            var sumY = 0.0\n            for i := 0; i &lt; sampleSize; i++ {\n                xCoeffs[i] = lanczos(filterSize, sourceX-float64(minX+i-filterSize))\n                yCoeffs[i] = lanczos(filterSize, sourceY-float64(minY+i-filterSize))\n\n                sumX += xCoeffs[i]\n                sumY += yCoeffs[i]\n            }\n\n            for i := 0; i &lt; sampleSize; i++ {\n                xCoeffs[i] /= sumX\n                yCoeffs[i] /= sumY\n            }\n\n            rgba := make([]float64, 4)\n\n            for i := 0; i &lt; sampleSize; i++ {\n                if yCoeffs[i] == 0.0 {\n                    continue\n                }\n                currY := minY + i - filterSize\n\n                rgbaRow := make([]float64, 4)\n                for j := 0; j &lt; sampleSize; j++ {\n                    if xCoeffs[j] == 0.0 {\n                        continue\n                    }\n                    currX := minX + i - filterSize\n\n                    rij, gij, bij, aij := original.At(\n                        clamp(currX, currY, oldBounds)).RGBA()\n\n                    rgbaRow[0] += float64(rij) * xCoeffs[j]\n                    rgbaRow[1] += float64(gij) * xCoeffs[j]\n                    rgbaRow[2] += float64(bij) * xCoeffs[j]\n                    rgbaRow[3] += float64(aij) * xCoeffs[j]\n                }\n                rgba[0] += float64(rgbaRow[0]) * yCoeffs[i]\n                rgba[1] += float64(rgbaRow[1]) * yCoeffs[i]\n                rgba[2] += float64(rgbaRow[2]) * yCoeffs[i]\n                rgba[3] += float64(rgbaRow[3]) * yCoeffs[i]\n            }\n\n            rgba[0] = clampRangeFloat(0, rgba[0], 0xFFFF)\n            rgba[1] = clampRangeFloat(0, rgba[1], 0xFFFF)\n            rgba[2] = clampRangeFloat(0, rgba[2], 0xFFFF)\n            rgba[3] = clampRangeFloat(0, rgba[3], 0xFFFF)\n\n            var rgbaF [4]uint64\n            rgbaF[0] = (uint64(math.Floor(rgba[0]+0.5)) * 0xFF) / 0xFFFF\n            rgbaF[1] = (uint64(math.Floor(rgba[1]+0.5)) * 0xFF) / 0xFFFF\n            rgbaF[2] = (uint64(math.Floor(rgba[2]+0.5)) * 0xFF) / 0xFFFF\n            rgbaF[3] = (uint64(math.Floor(rgba[3]+0.5)) * 0xFF) / 0xFFFF\n\n            rf := uint8(clampRangeUint(0, uint32(rgbaF[0]), 255))\n            gf := uint8(clampRangeUint(0, uint32(rgbaF[1]), 255))\n            bf := uint8(clampRangeUint(0, uint32(rgbaF[2]), 255))\n            af := uint8(clampRangeUint(0, uint32(rgbaF[3]), 255))\n\n            resized.Set(x, y, color.RGBA{R: rf, G: gf, B: bf, A: af})\n        }\n    }\n    return resized\n}\n\n\n// Machine epsilon\nvar epsilon = math.Nextafter(1.0, 2.0) - 1\n\nfunc lanczos(filterSize int, x float64) float64 {\n    x = math.Abs(x)\n    fs := float64(filterSize)\n    if x &lt; epsilon {\n        return 1.0\n    }\n\n    if x &gt; fs {\n        return 0\n    }\n\n    piX := math.Pi * x\n    piXOverFS := piX / fs\n    return (math.Sin(piX) / piX) * (math.Sin(piXOverFS) / (piXOverFS))\n}\n</code></pre>\n\n<p>It isn't particularly performant, because I want to get a good quality result before I look at optimization.</p>\n\n<p>Does anyone who has experience with image resampling see anything potentially problematic?</p>\n\n<p>For reference, here is my source image:\n<a href=\"https://i.stack.imgur.com/ytQXr.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ytQXr.jpg\" alt=\"Source Image\"></a></p>\n\n<p>Here is my result:\n<a href=\"https://i.stack.imgur.com/wwEAB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wwEAB.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here is my result if I remove the recursive call:\n<a href=\"https://i.stack.imgur.com/uDZzT.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uDZzT.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here is the result using RMagick/ImageMagick through Ruby (what I'm shooting for):\n<a href=\"https://i.stack.imgur.com/ljfKN.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ljfKN.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>Does anyone have advice for how I can get a smoother downscale result?\nThis particular example is a pretty drastic downscale, but Rmagick was able to downscale it very quickly with great quality, so it must be possible.</p>\n\n<p>I'm told that Lanczos3 Resampling yields good results, and that's what I'm trying to use here - I'm not sure if my implementation is correct though.</p>\n\n<p>Also, as a side note: the 0xFF / 0xFFFF conversion is because golang's \"At\" function returns rgba values in the range [0, 0xFFFF] ([0, 65535]) but \"Set\" takes a color which is initialized with the range [0, 0xFF] ([0, 255])</p>\n\n<p>For now, I'm more concerned with quality than performance.</p>\n"}, {"tags": ["go", "docker", "go-imagick"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6724371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JfO3A.jpg?s=128&g=1", "display_name": "Anarch", "link": "https://stackoverflow.com/users/6724371/anarch"}, "edited": false, "score": 0, "creation_date": 1471901140, "post_id": 39063483, "comment_id": 65525713, "body": "I actually figured this out earlier today (albeit with a bit of trial and error), but thanks for the response.  This does do the trick for anyone looking for help."}], "tags": [], "owner": {"reputation": 2484, "user_id": 688865, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1d521cecdab9122c5fe6975d0a97b6b6?s=128&d=identicon&r=PG", "display_name": "konradstrack", "link": "https://stackoverflow.com/users/688865/konradstrack"}, "is_accepted": true, "score": 2, "last_activity_date": 1471777458, "creation_date": 1471777458, "answer_id": 39063483, "question_id": 39058933, "link": "https://stackoverflow.com/questions/39058933/how-to-import-an-unpopular-package-to-docker-using-the-golang-official-image/39063483#39063483", "title": "How to import an unpopular package to Docker using the GOLang official image?", "body": "<p>Most base images have package lists removed to avoid to reduce image size. Thus, in order to install something with <code>apt-get</code>, you first need to update the package lists and then install whatever package you wish. Then, after installing the package, remove all side-effects of running apt to avoid polluting the image with unneeded files (all that necessarily as a single <code>RUN</code> command).</p>\n\n<p>The following Dockerfile should do the trick:</p>\n\n<pre><code>FROM golang:latest\n\nRUN apt-get update \\ # update package lists\n &amp;&amp; apt-get install -y libmagickwand-dev \\ # install the package\n &amp;&amp; apt-get clean \\ # clean package cache\n &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* # remove everything else\n\nRUN go get gopkg.in/gographics/imagick.v2/imagick\n</code></pre>\n\n<p>Remember to add <code>-y</code> to <code>apt-get install</code>, because <code>docker build</code> is non-interactive.</p>\n"}], "owner": {"reputation": 11, "user_id": 6724371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JfO3A.jpg?s=128&g=1", "display_name": "Anarch", "link": "https://stackoverflow.com/users/6724371/anarch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 851, "favorite_count": 0, "accepted_answer_id": 39063483, "answer_count": 1, "score": 0, "last_activity_date": 1471777458, "creation_date": 1471729220, "last_edit_date": 1471775562, "question_id": 39058933, "link": "https://stackoverflow.com/questions/39058933/how-to-import-an-unpopular-package-to-docker-using-the-golang-official-image", "title": "How to import an unpopular package to Docker using the GOLang official image?", "body": "<p>I've posted this question already as an issue on the imagick git repository, but it has a very small user-base, so I'm hoping to get some help from here.  I've been trying for a few days now to import <a href=\"https://github.com/gographics/imagick\" rel=\"nofollow\">https://github.com/gographics/imagick</a> to Docker using the official goLang dockerfile for a project I'm working on, but have been unsuccessful. Since this package isn't popular, running apt-get won't work.  I've (hesitantly) tried to just add the files to the container, but that didn't work.  Here's the DockerFile I've built and the error it produces:\n===DOCKERFILE===</p>\n\n<pre><code># 1) Use the official go docker image built on debian.\nFROM golang:latest\n\n# 2) ENV VARS\nENV GOPATH $HOME/&lt;PROJECT&gt;\nENV PATH $HOME/&lt;PROJECT&gt;/bin:$PATH\n\n# 3) Grab the source code and add it to the workspace.\nADD . /&lt;GO&gt;/src/&lt;PROJECT&gt;\nADD . /&lt;GO&gt;/gopkg.in\n# Trying to add the files manually... Doesn't help.\nADD . /opt/local/share/doc/ImageMagick-6\n\n\n# 4) Install revel and the revel CLI.\n#(The commented out code is from previous attempts)\n#RUN pkg-config --cflags --libs MagickWand\n#RUN go get gopkg.in/gographics/imagick.v2/imagick\nRUN go get github.com/revel/revel\nRUN go get github.com/revel/cmd/revel\n\n# 5) Does not work... Can't find the package.\n#RUN apt-get install libmagickwand-dev\n\n# 6) Get godeps from main repo\nRUN go get github.com/tools/godep\n\n# 7) Restore godep dependencies\nWORKDIR /&lt;GO&gt;/src/&lt;PROJECT&gt;\nRUN godep restore\n\n# 8) Install Imagick\n#RUN go build -tags no_pkgconfig gopkg.in/gographics/imagick.v2/imagick\n\n# 9) Use the revel CLI to start up our application.\nENTRYPOINT revel run &lt;PROJECT&gt; dev 9000\n\n# 10) Open up the port where the app is running.\nEXPOSE 9000\n</code></pre>\n\n<p>===END DOCKERFILE===</p>\n\n<p>This allows me to build the docker container, but when I try to run it, I get the following error in the logs of kinematic:</p>\n\n<p>===DOCKER ERROR===</p>\n\n<pre><code>ERROR 2016/08/20 21:15:10 build.go:108: # pkg-config --cflags MagickWand MagickCore MagickWand MagickCore\npkg-config: exec: \"pkg-config\": executable file not found in $PATH\n2016-08-20T21:15:10.081426584Z \nERROR 2016/08/20 21:15:10 build.go:308: Failed to parse build errors:\n #pkg-config --cflags MagickWand MagickCore MagickWand MagickCore\npkg-config: exec: \"pkg-config\": executable file not found in $PATH\n2016-08-20T21:15:10.082140143Z \n</code></pre>\n\n<p>===END DOCKER ERROR===</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 4515, "user_id": 1710704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a3b646c4f3b358bc74cfe636ca9655f7?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Shire", "link": "https://stackoverflow.com/users/1710704/logan-shire"}, "edited": false, "score": 0, "creation_date": 1471774312, "post_id": 39059706, "comment_id": 65474979, "body": "thanks! I ended up having to use reflect.ValueOf(i),Elem().Interface() to get it to work though."}], "tags": [], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "is_accepted": true, "score": 1, "last_activity_date": 1471737318, "creation_date": 1471737318, "answer_id": 39059706, "question_id": 39058902, "link": "https://stackoverflow.com/questions/39058902/json-decode-into-struct-as-interface-yields-mapstringinterface-not-struct/39059706#39059706", "title": "JSON decode into struct as interface{} yields map[string]interface{}, not struct", "body": "<p>This seems to work:</p>\n\n<p><a href=\"https://play.golang.org/p/u-g-uoRYAc\" rel=\"nofollow\">Playground</a></p>\n\n<pre><code>func requestParser(i interface{}) parser {\n    return func(r io.Reader) (interface{}, error) {\n        json.NewDecoder(r).Decode(i)\n        return reflect.ValueOf(i).Elem(), nil\n    }\n}\n\nfunc main() {\n    var foo Foo\n    s := \"{\\\"Name\\\":\\\"Logan\\\"}\"\n    p := requestParser(&amp;foo)\n}\n</code></pre>\n"}], "owner": {"reputation": 4515, "user_id": 1710704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a3b646c4f3b358bc74cfe636ca9655f7?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Shire", "link": "https://stackoverflow.com/users/1710704/logan-shire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 386, "favorite_count": 0, "accepted_answer_id": 39059706, "answer_count": 1, "score": 2, "last_activity_date": 1471737318, "creation_date": 1471728776, "question_id": 39058902, "link": "https://stackoverflow.com/questions/39058902/json-decode-into-struct-as-interface-yields-mapstringinterface-not-struct", "title": "JSON decode into struct as interface{} yields map[string]interface{}, not struct", "body": "<p>Here is a go playground replicating the issue:\n<a href=\"https://play.golang.org/p/GgHsLffp1G\" rel=\"nofollow\">https://play.golang.org/p/GgHsLffp1G</a></p>\n\n<p>Basically, I'm trying to write a function that takes a struct and returns a function that can decode http requests as that type. Unfortunately some type information is being lost and the type being returned is a map[string]interface{} and not the correct struct type. How can I communicate the correct type to the JSON decoder? Would JSON unmarshal work better?</p>\n"}, {"tags": ["go", "visual-studio-code", "delve"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1471774149, "post_id": 39062734, "comment_id": 65474941, "body": "@chris-g \tI hope this helps."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 2, "creation_date": 1471954655, "post_id": 39062734, "comment_id": 65548418, "body": "If you have some truble with VS Code, For fresh debug session, try: <code>File&#47;Close Folder</code>, <code>File&#47;Open Folder</code>, <code>From Explorer on left panel click </code>hello.go` and open it<code>, </code>Press F9 for break point<code>, </code>Press F5 select Go <code>, </code>Close json file<code>, </code>Click debugger<code>, </code>Press F5`"}, {"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 1, "creation_date": 1471964947, "post_id": 39062734, "comment_id": 65556518, "body": "Thank you! Though I still can not get the debugger to work. I get: can&#39;t load package: package .: no buildable Go source files in /Users/xx/godeep exit status 1"}, {"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 0, "creation_date": 1471965038, "post_id": 39062734, "comment_id": 65556590, "body": "I tried to start VS code from the terminal to adopt $GOPATH and just from the Application folder."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 1, "creation_date": 1471977185, "post_id": 39062734, "comment_id": 65564086, "body": "see: Make sure you are using that command in the Go project source folder: <a href=\"http://stackoverflow.com/questions/24095004/cant-load-package-package-no-buildable-go-source-files\" title=\"cant load package package no buildable go source files\">stackoverflow.com/questions/24095004/&hellip;</a>"}, {"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 0, "creation_date": 1472025229, "post_id": 39062734, "comment_id": 65581142, "body": "Thanks; That is for building/installing the right package - this works alright in the terminal incl. dlv. Should I set this somewhere in launch or settings?"}, {"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 0, "creation_date": 1472030125, "post_id": 39062734, "comment_id": 65584274, "body": "you ware right all along, for some reason I missed your 9. step - starting &quot;vs code&quot; in the package folder. Thanks again!"}, {"owner": {"reputation": 2664, "user_id": 787842, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/58ce85efba210120fb040e34cc445103?s=128&d=identicon&r=PG", "display_name": "cjauvin", "link": "https://stackoverflow.com/users/787842/cjauvin"}, "edited": false, "score": 0, "creation_date": 1481500158, "post_id": 39062734, "comment_id": 69389791, "body": "Thanks! This is way more useful than anything else I could find using Google (at least as of now)."}, {"owner": {"reputation": 249, "user_id": 965961, "user_type": "registered", "profile_image": "https://graph.facebook.com/507173786/picture?type=large", "display_name": "Chandrashekar Vijayarenu", "link": "https://stackoverflow.com/users/965961/chandrashekar-vijayarenu"}, "edited": false, "score": 0, "creation_date": 1486512127, "post_id": 39062734, "comment_id": 71374738, "body": "I get an error for the launch config. Error: unknown flag: --wd Process exiting with code: 0"}, {"owner": {"reputation": 3343, "user_id": 442396, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2c7ec89489bfcad5a94119f7bd9a1abf?s=128&d=identicon&r=PG", "display_name": "Sentinel", "link": "https://stackoverflow.com/users/442396/sentinel"}, "edited": false, "score": 0, "creation_date": 1530194791, "post_id": 39062734, "comment_id": 89158303, "body": "2018 June : Delve , Go and VSCode just don&#39;t work reliably. Don&#39;t even bother trying, and save some pain. Debugger is unreliable, watches hardly ever work, stepping is erratic etc etc."}, {"owner": {"reputation": 9915, "user_id": 5431638, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ded43b2bce923a926c7e24233b977d47?s=128&d=identicon&r=PG&f=1", "display_name": "Venkataramana Madugula", "link": "https://stackoverflow.com/users/5431638/venkataramana-madugula"}, "edited": false, "score": 0, "creation_date": 1543070269, "post_id": 39062734, "comment_id": 93790071, "body": "where do i find launch.json file?"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 69, "last_activity_date": 1506535569, "last_edit_date": 1506535569, "creation_date": 1471771470, "answer_id": 39062734, "question_id": 39058823, "link": "https://stackoverflow.com/questions/39058823/how-to-use-delve-debugger-in-visual-studio-code/39062734#39062734", "title": "How to use Delve debugger in Visual Studio Code", "body": "<p>For using Delve debugger in Visual Studio Code with Golang, do the following steps:  </p>\n\n<pre><code>( Note: for Windows OS replace all $GOPATH with %GOPATH% )\n</code></pre>\n\n<ul>\n<li>Install Latest <a href=\"https://golang.org/dl\" rel=\"noreferrer\">Golang</a> and set <code>GOROOT</code> and <code>GOPATH</code></li>\n<li>Add <code>$GOPATH/bin</code> to your OS <code>PATH</code> environment variable.  </li>\n<li>set environment variable: <code>GO15VENDOREXPERIMENT = 1</code>  </li>\n<li>run: <code>go get github.com/derekparker/delve/cmd/dlv</code>  and make sure <code>dlv</code> binary generated in your <code>$GOPATH/bin</code>  </li>\n<li>Install <a href=\"https://code.visualstudio.com/\" rel=\"noreferrer\">Visual Studio Code</a>  </li>\n<li>Launch VS Code Quick Open (<kbd>Ctrl</kbd>+<kbd>P</kbd>), paste this command: <code>ext install Go</code> , and press enter.  </li>\n<li>click install <code>Rich Go language support for Visual Studio Code</code>  </li>\n<li>click <code>Enable</code> and restart Visual Studio Code  </li>\n<li>Inside <code>Visual Studio Code</code> Open Folder <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>E</kbd> , e.g.: <code>$GOPATH\\src\\hello\\</code></li>\n<li>Then Open <code>hello.go</code> from that folder (or make new file <kbd>Ctrl</kbd>+<kbd>N</kbd> and save it on this folder):  </li>\n</ul>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello World!\")\n    i := 101\n    fmt.Println(i)\n}\n</code></pre>\n\n<ul>\n<li>Then Open Debugger <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>D</kbd></li>\n<li>on this line: <code>i := 101</code> press <kbd>F9</kbd> to set or toggle beakpoint.  </li>\n<li>Press <kbd>F5</kbd> to start debugging or to Run the application, if asked to select environment: select <code>Go</code>.  </li>\n<li>Press <kbd>F10</kbd> to  Step Over.  </li>\n<li>Press <kbd>F11</kbd> to Step Into.  </li>\n<li>Press <kbd>Shift</kbd>+<kbd>F11</kbd> to Step Out.  </li>\n<li>Press <kbd>Shift</kbd>+<kbd>F5</kbd> to Stop Debugging.  </li>\n<li>Press <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>F5</kbd> to Restart Debugging.  </li>\n</ul>\n\n<p>My <code>launch.json</code> untouched:</p>\n\n<pre><code>{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"Launch\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"debug\",\n            \"remotePath\": \"\",\n            \"port\": 2345,\n            \"host\": \"127.0.0.1\",\n            \"program\": \"${workspaceRoot}\",\n            \"env\": {},\n            \"args\": [],\n            \"showLog\": true\n        }\n    ]\n}\n</code></pre>\n\n<p>Result: </p>\n\n<p><a href=\"https://i.stack.imgur.com/sxUZ0.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/sxUZ0.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": [], "owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "is_accepted": false, "score": 0, "last_activity_date": 1507570133, "creation_date": 1507570133, "answer_id": 46651933, "question_id": 39058823, "link": "https://stackoverflow.com/questions/39058823/how-to-use-delve-debugger-in-visual-studio-code/46651933#46651933", "title": "How to use Delve debugger in Visual Studio Code", "body": "<p>FTA (in case it is hard to find), if when using <code>delve</code> and you get <code>cannot find package</code> error even though your <code>GOPATH</code> is set correctly, check out <a href=\"https://github.com/Microsoft/vscode-go/issues/1203#issuecomment-335045260\" rel=\"nofollow noreferrer\">this bug of vscode-go</a>, it is affecting both MAC OS and Linux, as of October, 2017.</p>\n\n<p>The solution is posted there as well: </p>\n\n<blockquote>\n  <p>... adding the GOPATH as an env var in the env property in the launch.json file solved the problem</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 1863, "user_id": 2730283, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jqcif.jpg?s=128&g=1", "display_name": "Stefan Crain", "link": "https://stackoverflow.com/users/2730283/stefan-crain"}, "edited": false, "score": 0, "creation_date": 1523633629, "post_id": 49820223, "comment_id": 86656104, "body": "While this code snippet may solve the question, <a href=\"https://meta.stackexchange.com/questions/114762/explaining-entirely-code-based-answers\">including an explanation</a> helps to improve the quality of your response. Remember that you are answering the question for readers in the future, and those people might not know the reasons for your code suggestion."}], "tags": [], "owner": {"reputation": 1, "user_id": 9642315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09d128545c93394fad4e1578d06c23cf?s=128&d=identicon&r=PG&f=1", "display_name": "big-town", "link": "https://stackoverflow.com/users/9642315/big-town"}, "is_accepted": false, "score": 0, "last_activity_date": 1523632469, "creation_date": 1523632469, "answer_id": 49820223, "question_id": 39058823, "link": "https://stackoverflow.com/questions/39058823/how-to-use-delve-debugger-in-visual-studio-code/49820223#49820223", "title": "How to use Delve debugger in Visual Studio Code", "body": "<p>Content launch.json for gdb and delve</p>\n\n<pre><code>{\n// \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 IntelliSense, \u0447\u0442\u043e\u0431\u044b \u0443\u0437\u043d\u0430\u0442\u044c \u043e \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0445 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u0430\u0445.\n// \u041d\u0430\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u043c\u044b\u0448\u0438, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u0430\u0442\u0440\u0438\u0431\u0443\u0442\u043e\u0432.\n// \u0414\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435: https://go.microsoft.com/fwlink/?linkid=830387\n\"version\": \"0.2.0\",\n\"configurations\": [\n    {\n        \"name\": \"Delve\",\n        \"type\": \"go\",\n        \"request\": \"launch\",\n        \"mode\": \"debug\",\n        \"remotePath\": \"\",\n        \"port\": 2345,\n        \"host\": \"127.0.0.1\",\n        \"program\": \"${workspaceRoot}/src/hello/hello.go\",\n        \"env\": {},\n        \"args\": [],\n        \"showLog\": true\n    }\n   ,\n    {\n        \"type\": \"gdb\",\n        \"request\": \"launch\",\n        \"name\": \"GDB\",\n\n        \"target\": \"${workspaceRoot}/src/hello/hello\",\n        \"cwd\": \"${workspaceRoot}\",\n        \"linux\": {\n            \"MIMode\": \"gdb\",\n            \"setupCommands\": [\n                {\n                    \"description\": \"Enable pretty-printing for gdb\",\n                    \"text\": \"-enable-pretty-printing\",\n                    \"ignoreFailures\": true\n                }\n            ]\n        },\n    }\n]\n</code></pre>\n\n<p>}</p>\n"}, {"tags": [], "owner": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "is_accepted": false, "score": 2, "last_activity_date": 1567382834, "last_edit_date": 1567382834, "creation_date": 1567349383, "answer_id": 57746989, "question_id": 39058823, "link": "https://stackoverflow.com/questions/39058823/how-to-use-delve-debugger-in-visual-studio-code/57746989#57746989", "title": "How to use Delve debugger in Visual Studio Code", "body": "<p>This <code>launch.json</code> worked for me to run the Golang debugger in VSCode:</p>\n\n<pre><code>{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"name\": \"Launch file\",\n      \"type\": \"go\",\n      \"request\": \"launch\",\n      \"mode\": \"auto\",\n      \"program\": \"${file}\",\n      \"env\": {\n        \"PATH\": \"/usr/local/go/bin:${fileDirname}\"\n      },\n      \"args\": []\n    }\n  ]\n}\n</code></pre>\n\n<p><a href=\"https://code.visualstudio.com/docs/editor/variables-reference.\" rel=\"nofollow noreferrer\">VSCode Variables Reference</a>:\nIf file <code>/home/your-username/your-project/folder/main.go</code> is open in VSCode and</p>\n\n<p>directory <code>/home/your-username/your-project</code> is your root workspace, then</p>\n\n<p>${file} = <code>/home/your-username/your-project/folder/main.go</code></p>\n\n<p>${fileDirname} = <code>/home/your-username/your-project/folder</code></p>\n\n<hr>\n\n<p>My specific values:</p>\n\n<p>$GOROOT: <code>/usr/local/go</code></p>\n\n<p>$GOPATH: <code>/Users/myname/code</code></p>\n\n<p>${file}: <code>/Users/myname/code/src/github.com/githubName/appName/main.go</code></p>\n\n<p>${fileDirname}: <code>/Users/myname/code/src/github.com/githubName/appName</code></p>\n"}], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40220, "favorite_count": 11, "accepted_answer_id": 39062734, "answer_count": 4, "score": 24, "last_activity_date": 1567382834, "creation_date": 1471728160, "last_edit_date": 1471777373, "question_id": 39058823, "link": "https://stackoverflow.com/questions/39058823/how-to-use-delve-debugger-in-visual-studio-code", "title": "How to use Delve debugger in Visual Studio Code", "body": "<p>I have installed the Go extension for VS Code, but unable to make it work.</p>\n\n<p>\"dlv debug\" works alright from the terminal.  </p>\n\n<pre><code>dlv debug src/github.com/user/hello\n</code></pre>\n\n<p>The <code>launch.json</code>:</p>\n\n<pre><code>{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"Launch\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"debug\",\n            \"program\": \"${workspaceRoot}\",\n            \"env\": {},\n            \"args\": []\n        }\n    ]\n}\n</code></pre>\n\n<p>Do you know how to set it up?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": false, "score": 2, "last_activity_date": 1471724248, "creation_date": 1471724248, "answer_id": 39058361, "question_id": 39058288, "link": "https://stackoverflow.com/questions/39058288/golang-package-that-must-also-be-useable-standalone-from-cli/39058361#39058361", "title": "Golang package that must also be useable standalone from cli", "body": "<p>A common pattern is to have a <code>cmd</code> pkg in your project that has executables.</p>\n\n<p>Something like this</p>\n\n<pre><code>cmd/\n   foo/main.go\npkg/\n   foo/foo.go\n</code></pre>\n\n<p><code>cmd/foo</code> imports <code>pkg/foo</code> and handles the command line flags. <code>pkg/foo</code> is the package with all of the library code. This pattern lets others import <code>pkg/foo</code> and <code>cmd/foo</code> gives you an executable called <code>foo</code> as well.</p>\n"}], "owner": {"reputation": 1885, "user_id": 639133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4781a491e1923d56755de71fbec9d5d4?s=128&d=identicon&r=PG", "display_name": "mozey", "link": "https://stackoverflow.com/users/639133/mozey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1471724774, "creation_date": 1471723809, "question_id": 39058288, "link": "https://stackoverflow.com/questions/39058288/golang-package-that-must-also-be-useable-standalone-from-cli", "title": "Golang package that must also be useable standalone from cli", "body": "<p>I would like to create a package that has a main function and uses the flag package to specify arguments.</p>\n\n<p>Additionally, I want to be able to include this package in other packages, and call it's methods with a similar syntax to passing args on the cli. Possibly something like</p>\n\n<pre><code>err := myPackage.setFlags(args ...string)\nout, err := myPackage.exec() \n</code></pre>\n\n<p>Some of the reasons I want the included package to have a main function is: </p>\n\n<ul>\n<li><p>It enables me to distribute the package as a standalone executable. My users might not need the complete system</p></li>\n<li><p>It could make manual troubleshooting easier</p></li>\n</ul>\n\n<p>Should I keep everything separate and use os\\exec?</p>\n\n<p>Should I create standalone wrappers (maybe these can be generated?) for each package and call exported functions directly from the complete system without doing the setFlags thing?</p>\n\n<p>Is there a good design pattern I could follow to do this? </p>\n\n<p>Or am I conjuring up an anti-pattern?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9243, "user_id": 1318181, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/1ZfAE.png?s=128&g=1", "display_name": "kylieCatt", "link": "https://stackoverflow.com/users/1318181/kyliecatt"}, "edited": false, "score": 2, "creation_date": 1471722453, "post_id": 39058054, "comment_id": 65465631, "body": "Why do you think you need to do this?"}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 1, "last_activity_date": 1471722393, "creation_date": 1471722393, "answer_id": 39058088, "question_id": 39058054, "link": "https://stackoverflow.com/questions/39058054/how-to-write-the-types-explicitly-on-the-left-when-the-function-returns-multiple/39058088#39058088", "title": "How to write the types explicitly on the left when the function returns multiple values?", "body": "<p>The only way to accomplish this is having the variables declared before calling the function:</p>\n\n<pre><code>var n ini\nvar err error\nn, err = r.Read(b)\n</code></pre>\n"}], "owner": {"reputation": 1797, "user_id": 1065175, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/068517711735b7ed7bd5287d287a7767?s=128&d=identicon&r=PG", "display_name": "ericj", "link": "https://stackoverflow.com/users/1065175/ericj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 21, "favorite_count": 0, "accepted_answer_id": 39058088, "answer_count": 1, "score": 0, "last_activity_date": 1471722393, "creation_date": 1471722142, "question_id": 39058054, "link": "https://stackoverflow.com/questions/39058054/how-to-write-the-types-explicitly-on-the-left-when-the-function-returns-multiple", "title": "How to write the types explicitly on the left when the function returns multiple values?", "body": "<p>I can do</p>\n\n<pre><code>n,err:=r.Read(b)\n</code></pre>\n\n<p>Also I can write</p>\n\n<pre><code>var n,err=r.Read(b)\n</code></pre>\n\n<p>But on the left I want the types explicitly, like (because this does not work),</p>\n\n<pre><code>var n,err int,error=r.Read(b)\n</code></pre>\n\n<p>How do I do that?</p>\n"}, {"tags": ["go", "mutex"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1471717776, "post_id": 39057184, "comment_id": 65464240, "body": "You should use neither, because this is serial code and the goroutine is completely unnecessary."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1471723990, "post_id": 39057184, "comment_id": 65466055, "body": "@JimB Agree, bad example, but the answer of AJPennster give me a good hint"}], "answers": [{"tags": [], "owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "is_accepted": true, "score": 0, "last_activity_date": 1471716831, "creation_date": 1471716831, "answer_id": 39057309, "question_id": 39057184, "link": "https://stackoverflow.com/questions/39057184/should-i-use-a-channel-or-a-sync-mutex-lock/39057309#39057309", "title": "should I use a channel or a sync.Mutex lock()?", "body": "<p>I would suggest you use a channel, but let me point out something about your code. </p>\n\n<p>I noticed you used a buffered channel, and then sent data on that channel first, before calling the goroutine that consumes the channel. In my opinion, it would be better to:</p>\n\n<p>1) use an unbuffered channel for signalling, especially in this case. </p>\n\n<p>2) Have the goroutine be responsible for starting the process and calling wait, while signaling to the main that it has started. </p>\n\n<p>Like this:</p>\n\n<pre><code>package main\n\nimport \"os/exec\"\n\nfunc main() {\n\n    cmd := exec.Command(\"sleep\", \"10\")\n    started := make(chan struct{})\n\n    go func(cmd *exec.Cmd, signal chan struct{}) {\n        if err := cmd.Start(); err != nil {\n            panic(err)\n        }\n\n        started &lt;- struct{}{}\n        cmd.Wait()\n    }(cmd, started)\n\n    &lt;-started\n    cmd.Process.Kill()\n}\n</code></pre>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 466, "favorite_count": 0, "accepted_answer_id": 39057309, "answer_count": 1, "score": 0, "last_activity_date": 1471724397, "creation_date": 1471715981, "last_edit_date": 1471724397, "question_id": 39057184, "link": "https://stackoverflow.com/questions/39057184/should-i-use-a-channel-or-a-sync-mutex-lock", "title": "should I use a channel or a sync.Mutex lock()?", "body": "<p>While doing a <code>go test -race</code>, I found that a call to <a href=\"https://golang.org/pkg/os/#Process.Kill\" rel=\"nofollow\">os.Process.Kill</a>, was made before the  command started <a href=\"https://golang.org/pkg/os/exec/#Cmd.Start\" rel=\"nofollow\">cmd.Start()</a>, I came with to posible solutions, one to use a <a href=\"https://play.golang.org/p/0RR0oovzhh\" rel=\"nofollow\">channel</a>:</p>\n\n<pre><code>package main\n\nimport \"os/exec\"\n\nfunc main() {\n    cmd := exec.Command(\"sleep\", \"10\")\n    started := make(chan struct{}, 1)\n\n    go func() {\n        &lt;-started\n        cmd.Process.Kill()\n    }()\n\n    if err := cmd.Start(); err != nil {\n        panic(err)\n    }\n    started &lt;- struct{}{}\n\n    cmd.Wait()\n}\n</code></pre>\n\n<p>or to use a <a href=\"https://play.golang.org/p/jErxPruOEq\" rel=\"nofollow\">lock</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"os/exec\"\n    \"sync\"\n)\n\nfunc main() {\n    var lock sync.Mutex\n    cmd := exec.Command(\"sleep\", \"10\")\n\n    lock.Lock()\n    if err := cmd.Start(); err != nil {\n        panic(err)\n    }\n    lock.Unlock()\n    go func() {\n        cmd.Process.Kill()\n    }()\n\n    cmd.Wait()\n}\n</code></pre>\n\n<p>Both options work but wondering what could be the most idiomatic or better approach, while the main goal is just to prevent killing a process that hasn't been started.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1797, "user_id": 1065175, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/068517711735b7ed7bd5287d287a7767?s=128&d=identicon&r=PG", "display_name": "ericj", "link": "https://stackoverflow.com/users/1065175/ericj"}, "edited": false, "score": 0, "creation_date": 1471854057, "post_id": 39055865, "comment_id": 65496816, "body": "Thanks. So the answer is no?"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1471707321, "creation_date": 1471707321, "answer_id": 39055865, "question_id": 39055355, "link": "https://stackoverflow.com/questions/39055355/can-i-define-a-receiving-method-in-main/39055865#39055865", "title": "Can I define a receiving method in main?", "body": "<p>No, not like that,<br>\nbut like this working sample code you may still use <code>f</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    j := I(2)\n    fmt.Println(j.Double())\n\n    f := j.Double\n\n    fmt.Println(f())\n}\n\ntype I int\n\nfunc (i I) Double() int {\n    return int(i) * 2\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>4\n4\n</code></pre>\n"}], "owner": {"reputation": 1797, "user_id": 1065175, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/068517711735b7ed7bd5287d287a7767?s=128&d=identicon&r=PG", "display_name": "ericj", "link": "https://stackoverflow.com/users/1065175/ericj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 39055865, "answer_count": 1, "score": 0, "last_activity_date": 1471707470, "creation_date": 1471704189, "last_edit_date": 1471707470, "question_id": 39055355, "link": "https://stackoverflow.com/questions/39055355/can-i-define-a-receiving-method-in-main", "title": "Can I define a receiving method in main?", "body": "<p>I can define a function globally,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func f()int{\n    return 0\n}\n</code></pre>\n\n<p>But I can also do in main,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main(){\n    var f=func()int{\n        return 0\n    }\n}\n</code></pre>\n\n<p>Can I do the same with receiving methods? I can do globally,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type I int\nfunc(i I)f()int{\n    return int(i)\n}\n</code></pre>\n\n<p>But can I do this in main too, so like (because this does not work)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main(){\n    type I int\n    var f=func(i I)()int{\n        return 0\n    }\n}\n</code></pre>\n"}, {"tags": ["mysql", "networking", "go", "tcp", "proxy"], "comments": [{"owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 1, "creation_date": 1471712501, "post_id": 39055035, "comment_id": 65462467, "body": "I am not sure about Go code but I think this has to do with session ids on mysql and not with Go. I wrote this couple of months back experiencing prepared statements/ temporary tables not working with mysql proxy <a href=\"https://pregmatch.org/read/mysql-proxy-prepared%20statements-not-working\" rel=\"nofollow noreferrer\">pregmatch.org/read/&hellip;</a>. This is not solution just observation from my side."}, {"owner": {"reputation": 25, "user_id": 3963583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/979c216478ca50e549aa978ab6bd0c38?s=128&d=identicon&r=PG&f=1", "display_name": "Orderbynull", "link": "https://stackoverflow.com/users/3963583/orderbynull"}, "reply_to_user": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 0, "creation_date": 1471713180, "post_id": 39055035, "comment_id": 65462732, "body": "Well, I can definitely map any request\\response to it&#39;s session. But how to map response to it&#39;s request wihin that session? I&#39;ll take a look at your post, thanks a lot."}, {"owner": {"reputation": 25, "user_id": 3963583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/979c216478ca50e549aa978ab6bd0c38?s=128&d=identicon&r=PG&f=1", "display_name": "Orderbynull", "link": "https://stackoverflow.com/users/3963583/orderbynull"}, "reply_to_user": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 0, "creation_date": 1471929278, "post_id": 39055035, "comment_id": 65532869, "body": "Any other ideas guys?"}], "owner": {"reputation": 25, "user_id": 3963583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/979c216478ca50e549aa978ab6bd0c38?s=128&d=identicon&r=PG&f=1", "display_name": "Orderbynull", "link": "https://stackoverflow.com/users/3963583/orderbynull"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1471713230, "creation_date": 1471702119, "last_edit_date": 1471713230, "question_id": 39055035, "link": "https://stackoverflow.com/questions/39055035/how-to-match-request-to-response-while-proxying-packets", "title": "How to match request to response while proxying packets?", "body": "<p>I'm working on MySQL proxy with browser based GUI.\nCore of an app looks like:</p>\n\n<pre><code>//Trying to connect to server\nrightConn, err := net.Dial(\"tcp\", l.rightAddr)\nif err != nil {\n    return\n}\ndefer rightConn.Close()\n\nwg.Add(2)\n//Start passing packets from client to server\ngo func() {\n    defer wg.Done()\n    l.Pipe(leftConn, rightConn)\n}()\n\n//Start passing packets from server to client\ngo func() {\n    defer wg.Done()\n    l.Pipe(rightConn, leftConn)\n}()\nwg.Wait()\n</code></pre>\n\n<p>And here's definition of Pipe:</p>\n\n<pre><code>func (l *Lottip) Pipe(right, left net.Conn) {\nfor {\n    pkt, err := mysql.ReadPacket(right)\n    if err != nil {\n        break\n    }\n\n    if _, err = mysql.WritePacket(pkt, left); err != nil {\n        break\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>The reason i'm using my custom proxy function instead of</p>\n\n<pre><code>go io.Copy(left, right)\ngo io.Copy(right, left)\n</code></pre>\n\n<p>is i have to parse each MySQL's Request/Response packet and prepare it for further processing.</p>\n\n<p>As we all know MySQL client can send a lot of queries and get responses in random order.</p>\n\n<p><strong>The problem is i cannot get how to match request to it's response</strong>. While i'm piping using 2 goroutines(1 per direction) i can easily read server response but i don't know to what request it responding.</p>\n\n<p>I've examined request/response between MySQL client and server via Wireshark and found no mention for packet_id or query_id or similar</p>\n"}, {"tags": ["memory-management", "go", "memory-leaks", "garbage-collection", "memory-profiling"], "answers": [{"comments": [{"owner": {"reputation": 1164, "user_id": 168755, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9e619994cf01ea5fc0718f3875d525b6?s=128&d=identicon&r=PG", "display_name": "synepis", "link": "https://stackoverflow.com/users/168755/synepis"}, "edited": false, "score": 0, "creation_date": 1471703775, "post_id": 39054372, "comment_id": 65459513, "body": "I&#39;ve added a comment above explaining what I believe happens. I&#39;m not sure what you mean by &quot;removed element is still referenced by e.next&quot;, isn&#39;t e the removed element?"}], "tags": [], "owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "is_accepted": false, "score": 0, "last_activity_date": 1471697503, "creation_date": 1471697503, "answer_id": 39054372, "question_id": 39052967, "link": "https://stackoverflow.com/questions/39052967/setting-pointers-to-nil-to-prevent-memory-leak-in-golang/39054372#39054372", "title": "Setting pointers to nil to prevent memory leak in Golang", "body": "<p>Golang garbage collector is based on the tri-color mark-and-sweep algorithm.\nIn short, every memory you're program use is associated to a color. The color determine if the memory shall be garbaged or not.</p>\n\n<p>This algorithm will flag a memory to be freed if this memory is not referenced somewhere (directly and indirectly). But if we take a look at the code:</p>\n\n<pre><code>e.prev.next = e.next\ne.next.prev = e.prev\n</code></pre>\n\n<p>This copy the pointer in e.next into e.prev.next. Now, let's say you want to update e.prev.next by a new fully created element.</p>\n\n<p>The previously removed element won't be garbaged because it is still referenced by e.next.</p>\n\n<p>This is why those lines exist:</p>\n\n<pre><code>e.next = nil // avoid memory leaks\ne.prev = nil // avoid memory leaks\n</code></pre>\n\n<p>This prevent from leaving old references, and thus prevent from memory leaks.</p>\n"}, {"comments": [{"owner": {"reputation": 1164, "user_id": 168755, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9e619994cf01ea5fc0718f3875d525b6?s=128&d=identicon&r=PG", "display_name": "synepis", "link": "https://stackoverflow.com/users/168755/synepis"}, "edited": false, "score": 1, "creation_date": 1471723835, "post_id": 39056918, "comment_id": 65466015, "body": "I ammended the question with the picture of what you are describing, please correct me if I am wrong. I actually tried this out with a modified (with the memory leak bug) version of list and I can see it not releasing the memory."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 13, "last_activity_date": 1471781917, "last_edit_date": 1471781917, "creation_date": 1471714083, "answer_id": 39056918, "question_id": 39052967, "link": "https://stackoverflow.com/questions/39052967/setting-pointers-to-nil-to-prevent-memory-leak-in-golang/39056918#39056918", "title": "Setting pointers to nil to prevent memory leak in Golang", "body": "<p>Your assumptions are correct. If there is a group of pointers pointing to each other, but there is no reference / pointer to any member of this group, the group will be detected as unreachable by the garbage collector and will be freed properly.</p>\n\n<p>But the explanation to memory leak is simple. We can get the <a href=\"https://golang.org/pkg/container/list/#Element\" rel=\"noreferrer\"><code>list.Element</code></a> wrappers from the list which contain the unexported <code>Element.next</code> and <code>Element.prev</code> pointers to the next and previous elements in the list.</p>\n\n<p>When removing an element from the list if these pointers would not be set to <code>nil</code>, they would held references to the next and previous element wrappers, including the values associated with those elements.</p>\n\n<p>See this example:</p>\n\n<pre><code>var e2 *list.Element\n\nfunc main() {\n    listTest()\n    fmt.Println(e2.Value)\n    // At this point we expect everything from the list to be\n    // garbage collected at any time, we only have reference to e2.\n    // If e2.prev and e2.next would not be set to nil,\n    // e1 and e3 could not be freed!\n}\n\nfunc listTest() {\n    l := list.New()\n    e1 := l.PushBack(1)\n    e2 = l.PushBack(2)\n    e3 := l.PushBack(3)\n    // List is now [1, 2, 3]\n    fmt.Println(e1.Value, e2.Value, e3.Value)\n    l.Remove(e2)\n    // Now list is [1, 3], it does not contain e2\n}\n</code></pre>\n\n<p>In <code>listTest()</code> we build a list with 3 elements, and we store the 2nd element in a global variable <code>e2</code>. Then we remove this element. Now we would expect that except <code>e2</code> (and the value wrapped in it) everything else gets garbage collected when <code>listTest()</code> returns, because the list is not accessible outside the <code>listTest()</code> function. Yes, we have a pointer in <code>e2</code> to an element, but <code>e2</code> has (<em>should have</em>) nothing to do with the list anymore as we removed it.</p>\n\n<p>If the <code>prev</code> and <code>next</code> pointers in <code>e2</code> would not be set to <code>nil</code>, values wrapped in elements pointed by them could never be freed, recursively. But since <a href=\"https://golang.org/pkg/container/list/#List.Remove\" rel=\"noreferrer\"><code>List.Remove()</code></a> properly sets those to <code>nil</code>, in the above example <code>e1</code> and <code>e3</code> \u2013along with the values wrapped in them\u2013 will be freed (on next garbage collection run).</p>\n"}], "owner": {"reputation": 1164, "user_id": 168755, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9e619994cf01ea5fc0718f3875d525b6?s=128&d=identicon&r=PG", "display_name": "synepis", "link": "https://stackoverflow.com/users/168755/synepis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3380, "favorite_count": 7, "accepted_answer_id": 39056918, "answer_count": 2, "score": 17, "last_activity_date": 1472070870, "creation_date": 1471688210, "last_edit_date": 1472070870, "question_id": 39052967, "link": "https://stackoverflow.com/questions/39052967/setting-pointers-to-nil-to-prevent-memory-leak-in-golang", "title": "Setting pointers to nil to prevent memory leak in Golang", "body": "<p>I'm learning Go, and as an exercise I wanted to implement a linked list. For reference I looked at the official Go code (<a href=\"https://golang.org/src/container/list/list.go\" rel=\"noreferrer\">https://golang.org/src/container/list/list.go</a>) . One thing that stuck with me are these lines:</p>\n\n<pre><code>   108  // remove removes e from its list, decrements l.len, and returns e.\n   109  func (l *List) remove(e *Element) *Element {\n   110      e.prev.next = e.next\n   111      e.next.prev = e.prev\n   112      e.next = nil // avoid memory leaks\n   113      e.prev = nil // avoid memory leaks\n   114      e.list = nil\n   115      l.len--\n   116      return e\n   117  } \n</code></pre>\n\n<p>I am curious as to how does setting pointers to nil in this case prevent memory leaks? If possible I would like to construct a program which has this flaw and see it while profiling with pprof (I would use a modified verion of the list.go without this nil pointer setting).</p>\n\n<hr>\n\n<p><strong>For clarity of answer</strong>: If one of the nodes has an external pointer to it, then all of the adjacent removed nodes will have an active reference through that pointer and won't be removed.\n<a href=\"https://i.stack.imgur.com/0zyqJ.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/0zyqJ.jpg\" alt=\"enter image description here\"></a></p>\n\n<ol>\n<li>We create an external pointer pointing to Node2 </li>\n<li>We remove nodes 2-4 from the list</li>\n<li>You would expect at this point only for the Node 1,2 &amp;\n5 to be alive and the rest to be GC-ed. However, due to Node2 still\npointing to Node3 &amp; etc., the entire chain remains uncollected.</li>\n</ol>\n"}, {"tags": ["go", "encoding", "gob", "redigo"], "answers": [{"comments": [{"owner": {"reputation": 3022, "user_id": 1731807, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/1efd71cc58890cbae2248d4bfc63e726?s=128&d=identicon&r=PG&f=1", "display_name": "Mr Bonjour", "link": "https://stackoverflow.com/users/1731807/mr-bonjour"}, "edited": false, "score": 0, "creation_date": 1471707468, "post_id": 39054621, "comment_id": 65460687, "body": "Thank you, that was exactly what I was expecting."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1471700849, "last_edit_date": 1471700849, "creation_date": 1471699307, "answer_id": 39054621, "question_id": 39052200, "link": "https://stackoverflow.com/questions/39052200/redigo-and-gob-how-to-retrieve-slices-of-gob-data/39054621#39054621", "title": "redigo and gob how to retrieve slices of gob data", "body": "<p>The <a href=\"http://redis.io/commands/LRANGE\" rel=\"nofollow\">LRANGE</a> command returns a list. Use <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#ByteSlices\" rel=\"nofollow\">redis.ByteSlices</a> to get that list as a [][]byte.  Decode each gob in the list:</p>\n\n<pre><code>items, err := redis.ByteSlices(d.Conn.Do(\"LRANGE\", \"objects\", \"0\", \"-1\"))\nif err != nil {\n   // handle error\n}\nvar values []*Object\nfor _, item := range items {\n    var v Object\n    if err := gob.NewDecoder(bytes.NewReader(item)).Decode(&amp;v); err != nil {\n        // handle error\n    }\n    values = append(values, &amp;v)\n}\n</code></pre>\n\n<p>This assumes that a new gob.Encoder was created for each value pushed into the list.</p>\n\n<p>If the application does not access the list items independently in Redis, then gob encode the entire list and store it as a bulk string:</p>\n\n<pre><code> var values []*Object\n var buf bytes.Buffer\n if err := gob.NewEncoder(&amp;buf).Encode(values); err != nil {\n     // handle error\n }\n if _, err := d.Conn.Do(\"SET\", \"objects\", buf.Bytes()); err != nil {\n     // handler error\n }\n</code></pre>\n\n<p>Here's how to decode it:</p>\n\n<pre><code>items, err := redis.Bytes(d.Conn.Do(\"GET\", \"objects\"))\nif err != nil {\n    // handle error\n}\nvar values []*Objects\nif err := gob.NewDecoder(items).Decode(&amp;values); err != nil {\n    // handle error\n}\n</code></pre>\n\n<p>Here's an aside on this line of code from the question:</p>\n\n<pre><code> redis.String(d.Conn.Do(\"RPUSH\", \"objects\", network.String()))\n</code></pre>\n\n<p>Use network.Bytes() to avoid the string allocation. Use redis.Int to decode the integer return value from RPUSH. Write the code as:</p>\n\n<pre><code> n, err := redis.Int(d.Conn.Do(\"RPUSH\", \"objects\", network.Bytes()))\n</code></pre>\n\n<p>or if you don't care about the count of elements returned from the list, write it as:</p>\n\n<pre><code> _, err := d.Conn.Do(\"RPUSH\", \"objects\", network.Bytes())\n</code></pre>\n"}], "owner": {"reputation": 3022, "user_id": 1731807, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/1efd71cc58890cbae2248d4bfc63e726?s=128&d=identicon&r=PG&f=1", "display_name": "Mr Bonjour", "link": "https://stackoverflow.com/users/1731807/mr-bonjour"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1370, "favorite_count": 1, "accepted_answer_id": 39054621, "answer_count": 1, "score": 1, "last_activity_date": 1471700849, "creation_date": 1471682375, "question_id": 39052200, "link": "https://stackoverflow.com/questions/39052200/redigo-and-gob-how-to-retrieve-slices-of-gob-data", "title": "redigo and gob how to retrieve slices of gob data", "body": "<p>I'm pushing in my redis base my objects with the \"RPUSH\" command.</p>\n\n<pre><code>// object is of type interface\n\nvar network bytes.Buffer\ngob.NewEncoder(&amp;network)\nenc.Encode(object /* interface{} */)\n\nredis.String(d.Conn.Do(\"RPUSH\", \"objects\", network.String()))\n</code></pre>\n\n<p>Redigo do what i'm expecting, it is pushing all the data structure gob-encoded.</p>\n\n<p>Now I'm trying to retreive them:</p>\n\n<pre><code>sall, _ := redis.Strings(d.Conn.Do(\"LRANGE\", \"todos\", \"0\", \"-1\"))\nfmt.Printf(\"%T\", sall) // type []string as expected\n\n// At this point, I have no idea if I should store the data in a buffer, or convert it directly as bytes. actually, here I'm lost\nvar network bytes.Buffer\nvar object []interface{}\n\n\ndec := gob.NewDecoder(network)\nerr := dec.Decode(inout)\nfmt.Printf(\"%v\", err) // decode error:EOF\n</code></pre>\n\n<p>What is the best way to gob-decod them? I'd want to get them back as a slice of interface{}. But even if my object are encoded as gob data. They are pushed in the redis way, so can it be considered as a slice from the point view of gob?</p>\n\n<p>I could iterate other the list and decode them one by one. But I'm not confident about the efficiency. I'm assuming gob want a slice structure encoded in its way. So my question is: Is there a trick in order to decode my slice of gob data efficiently as a collection of data structure? Or should I store my data structure in another way (I'm assuming storing my data with RPUSH can prevent non-attomic manipulation)</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1471682702, "post_id": 39052143, "comment_id": 65453725, "body": "What&#39;s the json decode errror? A type switch may help or the reflect package has lots of tools for runtime type idenfication."}, {"owner": {"reputation": 4515, "user_id": 1710704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a3b646c4f3b358bc74cfe636ca9655f7?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Shire", "link": "https://stackoverflow.com/users/1710704/logan-shire"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1471683464, "post_id": 39052143, "comment_id": 65453905, "body": "@Sridhar If I call DecodeRequest(CountRequest{}) I get   &quot;http: panic serving [::1]:55992: interface conversion: interface is map[string]interface {}, not user.CountRequest&quot;   and if i change the function to use ...Decode(req) and call DecodeRequest(&amp;CountRequest{}) I get   &quot;http: panic serving [::1]:56375: interface conversion: interface is *user.CountRequest, not user.CountRequest&quot;"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1471684748, "post_id": 39052143, "comment_id": 65454210, "body": "What&#39;s CountRequest ? A map[string]interface{} ? You really should abide by <a href=\"http://www.stackoverflow.com/help/mcve\">this</a> . Maybe try Decode(Req) and call DecodeRequest(CountRequest{}) ?"}, {"owner": {"reputation": 4515, "user_id": 1710704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a3b646c4f3b358bc74cfe636ca9655f7?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Shire", "link": "https://stackoverflow.com/users/1710704/logan-shire"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1471685664, "post_id": 39052143, "comment_id": 65454483, "body": "@Sridhar it&#39;s just a struct: type CountRequest struct { \tS string <code>json:&quot;s&quot;</code> } I am not sure where the map[string]interface{} is coming from. When I try Decode(req) and call DecodeRequest(CountRequest{}) I get: interface conversion: interface is *user.CountRequest, not user.CountRequest"}], "answers": [{"comments": [{"owner": {"reputation": 4515, "user_id": 1710704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a3b646c4f3b358bc74cfe636ca9655f7?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Shire", "link": "https://stackoverflow.com/users/1710704/logan-shire"}, "edited": false, "score": 0, "creation_date": 1471724256, "post_id": 39054888, "comment_id": 65466123, "body": "Unfortunately, this doesn&#39;t work for me. When I try it, the error I get is: http: panic serving [::1]:58709: interface conversion: interface is *user.UppercaseRequest, not user.UppercaseRequest"}, {"owner": {"reputation": 4515, "user_id": 1710704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a3b646c4f3b358bc74cfe636ca9655f7?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Shire", "link": "https://stackoverflow.com/users/1710704/logan-shire"}, "edited": false, "score": 0, "creation_date": 1471724451, "post_id": 39054888, "comment_id": 65466182, "body": "Oh! I think i have an idea - maybe the issue isn&#39;t with the json decoder, but rather that i&#39;m returning a pointer instead of the actual struct. I think I need to return *req, nil. But then how can I cast an interface to a pointer to an interface?"}, {"owner": {"reputation": 4515, "user_id": 1710704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a3b646c4f3b358bc74cfe636ca9655f7?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Shire", "link": "https://stackoverflow.com/users/1710704/logan-shire"}, "edited": false, "score": 0, "creation_date": 1471730833, "post_id": 39054888, "comment_id": 65467681, "body": "Unfortunately neither worked - check the go playground I added which replicates the issue."}, {"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "reply_to_user": {"reputation": 4515, "user_id": 1710704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a3b646c4f3b358bc74cfe636ca9655f7?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Shire", "link": "https://stackoverflow.com/users/1710704/logan-shire"}, "edited": false, "score": 0, "creation_date": 1471818026, "post_id": 39054888, "comment_id": 65487154, "body": "I updated your playground with a working solution (still based on what I am saying in my answer). I added the type assertion so you can see how to use it. <a href=\"https://play.golang.org/p/xjbfaoqwLg\" rel=\"nofollow noreferrer\">play.golang.org/p/xjbfaoqwLg</a>"}], "tags": [], "owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "is_accepted": true, "score": 3, "last_activity_date": 1471701211, "creation_date": 1471701211, "answer_id": 39054888, "question_id": 39052143, "link": "https://stackoverflow.com/questions/39052143/golang-json-decoding-fails-to-decode-interface/39054888#39054888", "title": "Golang json decoding fails to decode interface{}", "body": "<p>According to the piece of code you are showing us, I think you are facing a type assertion issue. I created a <a href=\"https://play.golang.org/p/3RLtF9ak0J\" rel=\"nofollow\">playground to show you what I explain below</a>.</p>\n\n<p>You're passing a UpperCaseRequest to DecodeRequest func. In this func, the argument is of type interface{}, and it passes a pointer of this argument to the json Decoder. So, The decoder sees a pointer to interface, and not a pointer to UpperCaseRequest.</p>\n\n<p>This is why it's not correctly decoded. And then, trying a type assertion on it fails because asserting two different type is not possible.</p>\n\n<p>So, in your code, I'd suggest:</p>\n\n<pre><code>func DecodeRequest(req interface{}) httptransport.DecodeRequestFunc {\n    return func(_ context.Context, r *http.Request) (interface{}, error) {\n        // Note the '&amp;' is removed here\n        if err := json.NewDecoder(r.Body).Decode(req); err != nil {\n            return nil, err\n        }\n        return req, nil\n    }\n}\n</code></pre>\n\n<p>And call this function like this:</p>\n\n<pre><code>// Note the &amp; is placed here.\nDecodeRequest(&amp;UppercaseRequest{}}\n</code></pre>\n"}], "owner": {"reputation": 4515, "user_id": 1710704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a3b646c4f3b358bc74cfe636ca9655f7?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Shire", "link": "https://stackoverflow.com/users/1710704/logan-shire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2392, "favorite_count": 0, "accepted_answer_id": 39054888, "answer_count": 1, "score": 1, "last_activity_date": 1471728215, "creation_date": 1471681930, "last_edit_date": 1471728215, "question_id": 39052143, "link": "https://stackoverflow.com/questions/39052143/golang-json-decoding-fails-to-decode-interface", "title": "Golang json decoding fails to decode interface{}", "body": "<p>I'm using a library (go-kit) which requires I specify functions to encode / decode my request and response types to/from JSON. For encoding, it is simple:</p>\n\n<pre><code>func EncodeResponse(_ context.Context, w http.ResponseWriter, response interface{}) error {\n    return json.NewEncoder(w).Encode(response)\n}\n</code></pre>\n\n<p>I pass this function to create the HTTP server and it works fine. However, their proposed approach for requests is to make a separate function of the form:</p>\n\n<pre><code>func decodeUppercaseRequest(_ context.Context, r *http.Request) (interface{}, error) {\n    var req UppercaseRequest\n    if err := json.NewDecoder(r.Body).Decode(&amp;req); err != nil {\n        return nil, err\n    }\n    return req, nil\n}\n</code></pre>\n\n<p>For every single RPC in my application. I would really like to keep my code DRY and avoid having hundreds of almost identical methods. As such, I attempted to write a function to generate closures that decode the given request type:</p>\n\n<pre><code>func DecodeRequest(req interface{}) httptransport.DecodeRequestFunc {\n    return func(_ context.Context, r *http.Request) (interface{}, error) {\n        if err := json.NewDecoder(r.Body).Decode(&amp;req); err != nil {\n            return nil, err\n        }\n        return req, nil\n    }\n}\n</code></pre>\n\n<p>This function can be called like so:</p>\n\n<pre><code>DecodeRequest(UppercaseRequest{}}\n</code></pre>\n\n<p>Unfortunately, when I do so, the JSON decoding fails, even though the type of req is in fact mypackage.UppercaseRequest. I'm not sure where to go from here. Is there a way I can avoid having to write a method per request type? Is there some way I can help the Decode function understand what this type is at runtime? Thanks in advance!</p>\n\n<p>Here is a go playground demonstrating the issue:\n<a href=\"https://play.golang.org/p/GgHsLffp1G\" rel=\"nofollow\">https://play.golang.org/p/GgHsLffp1G</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 0, "creation_date": 1582232662, "post_id": 39051290, "comment_id": 106716794, "body": "Currently, <a href=\"https://golang.org/src/os/file.go?s=6935:6979#L220\" rel=\"nofollow noreferrer\">os.Mkdir() calls syscall.Mkdir()</a>"}], "answers": [{"tags": [], "owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "is_accepted": true, "score": 4, "last_activity_date": 1471676085, "creation_date": 1471676085, "answer_id": 39051386, "question_id": 39051290, "link": "https://stackoverflow.com/questions/39051290/os-mkdir-versus-syscall-mkdir-what-is-the-difference-in-golang/39051386#39051386", "title": "os.Mkdir versus syscall.Mkdir, what is the difference in Golang?", "body": "<p>The first one is the direct system call, platform dependent, probably faster/you can use all platform dependent bits (like sticky bit on Unix/Linux for instance)</p>\n\n<p>The latter is the portable API which is supposed to work the same on every platform, note that second argument is no longer an anonymous integer but a constrained type.</p>\n"}], "owner": {"reputation": 222, "user_id": 861571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea3a3f9cdac0518997479b5208e43530?s=128&d=identicon&r=PG", "display_name": "arastu", "link": "https://stackoverflow.com/users/861571/arastu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 365, "favorite_count": 1, "accepted_answer_id": 39051386, "answer_count": 1, "score": 5, "last_activity_date": 1471676109, "creation_date": 1471675334, "last_edit_date": 1471676109, "question_id": 39051290, "link": "https://stackoverflow.com/questions/39051290/os-mkdir-versus-syscall-mkdir-what-is-the-difference-in-golang", "title": "os.Mkdir versus syscall.Mkdir, what is the difference in Golang?", "body": "<p><code>os.Mkdir</code> and <code>syscall.Mkdir</code> both have same API in Golang</p>\n\n<p><code>syscall.Mkdir</code>:</p>\n\n<pre><code>func Mkdir(path string, mode uint32) (err error)\n</code></pre>\n\n<p><code>os.Mkdir</code>:</p>\n\n<pre><code>func Mkdir(name string, perm FileMode) error\n</code></pre>\n\n<p>What is the difference between them?</p>\n"}, {"tags": ["go", "io", "writer", "reader"], "answers": [{"comments": [{"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1471669757, "post_id": 39050677, "comment_id": 65450748, "body": "Uhh, that does the opposite I think. The goal here is to read <b>up to</b> a predetermined maximum. It&#39;s OK if it&#39;s less, but not OK if it&#39;s over. It should abort and return an error in that case."}, {"owner": {"reputation": 497, "user_id": 2692215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d0b6dabfa2ba63adece2081af25989e?s=128&d=identicon&r=PG&f=1", "display_name": "1lann", "link": "https://stackoverflow.com/users/2692215/1lann"}, "reply_to_user": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1471669865, "post_id": 39050677, "comment_id": 65450767, "body": "Yes, it only reads up to N bytes. The function will return when it copies exactly N bytes. If there are less than N bytes available, it will copy as much as it can and return an error."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1471670043, "post_id": 39050677, "comment_id": 65450795, "body": "OK, I fixed the question title because clearly people aren&#39;t reading it. Do you see the fact that I&#39;m asking how to avoid reading <b>over</b> a certain number of bytes, not under?"}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1471679714, "post_id": 39050677, "comment_id": 65452948, "body": "Thanks for your solution. It&#39;s a bummer to have to load the entire desired length + 1 into memory just for this, but at least it&#39;s temporary."}], "tags": [], "owner": {"reputation": 497, "user_id": 2692215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d0b6dabfa2ba63adece2081af25989e?s=128&d=identicon&r=PG&f=1", "display_name": "1lann", "link": "https://stackoverflow.com/users/2692215/1lann"}, "is_accepted": false, "score": 1, "last_activity_date": 1471671041, "last_edit_date": 1471671041, "creation_date": 1471669603, "answer_id": 39050677, "question_id": 39050562, "link": "https://stackoverflow.com/questions/39050562/read-copy-up-to-a-certain-number-of-bytes-from-io-reader-to-io-writer-in-gol/39050677#39050677", "title": "Read/copy up to a certain number of bytes from `io.Reader` to `io.Writer` in Golang, or return error if OVER a certain bytes limit?", "body": "<p>You can use <code>io.CopyN</code>: <a href=\"https://golang.org/pkg/io/#CopyN\" rel=\"nofollow\">https://golang.org/pkg/io/#CopyN</a> which will return a nil error if it successfully copies exactly N bytes, or else an <code>io.EOF</code> (or possibly another error) if less than N bytes.</p>\n\n<p>For example:</p>\n\n<pre><code>func copyMax(dst io.Writer, src io.Reader, n int64) error\n    _, err := io.CopyN(dst, src, n)\n    if err != nil {\n        // Don't care if there's less available\n        return nil\n    }\n\n    nextByte := make([]byte, 1)\n    nRead, _ := io.ReadFull(src, nextByte)\n    if nRead &gt; 0 {\n        // There's too much data\n        return errors.New(\"Too much data\")\n    }\n\n    return nil\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1471673871, "post_id": 39050784, "comment_id": 65451446, "body": "So to use this with an integer byte length, you&#39;d do <code>r := strings.NewReader(make([] byte, 10240));</code> ...?"}, {"owner": {"reputation": 497, "user_id": 2692215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d0b6dabfa2ba63adece2081af25989e?s=128&d=identicon&r=PG&f=1", "display_name": "1lann", "link": "https://stackoverflow.com/users/2692215/1lann"}, "edited": false, "score": 1, "creation_date": 1471674390, "post_id": 39050784, "comment_id": 65451575, "body": "<code>m, e := r.Read(buf)</code> is not guaranteed to fill the buffer. There could be more data available that still fits within the maximum limit. Using <code>io.ReadFull</code> would be more suitable to fill the buffer as much as possible."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1471679084, "post_id": 39050784, "comment_id": 65452794, "body": "@Amd Honestly, it&#39;d be nice if you named your variables. :) ... The code&#39;s hard to understand with just letters <code>m</code> and <code>n</code> for example. I had to trace them all back to see what they do."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 497, "user_id": 2692215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d0b6dabfa2ba63adece2081af25989e?s=128&d=identicon&r=PG&f=1", "display_name": "1lann", "link": "https://stackoverflow.com/users/2692215/1lann"}, "edited": false, "score": 0, "creation_date": 1471679696, "post_id": 39050784, "comment_id": 65452944, "body": "Your examples are great, but considering it&#39;s basically the same code as @1lann in the end, I have to choose his solution given the named variables. Thanks for your help/efforts though!"}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1471679825, "post_id": 39050784, "comment_id": 65452975, "body": "Actually, yeah you&#39;re right. Now that I look at it the other does two separate operations. I&#39;ll choose this solution."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 2, "last_activity_date": 1471681202, "last_edit_date": 1471681202, "creation_date": 1471670925, "answer_id": 39050784, "question_id": 39050562, "link": "https://stackoverflow.com/questions/39050562/read-copy-up-to-a-certain-number-of-bytes-from-io-reader-to-io-writer-in-gol/39050784#39050784", "title": "Read/copy up to a certain number of bytes from `io.Reader` to `io.Writer` in Golang, or return error if OVER a certain bytes limit?", "body": "<p>Since <code>io.Reader</code> interface not knows anything about size or length of underlying data, there is only one solution for this problem:  </p>\n\n<p>You may use one buffer with maximum size <code>nMax</code> (predetermined maximum)<code>+1</code> and in every call to Your <code>CopyLessThanOrEqualToThisManyBytesOrReturnError</code> function, inside this function read input and buffer it, and check for this buffer length, if it is less than or equal to <code>nMax</code> then do <code>io.Write</code>, otherwise return error:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>const nMax = 5 // your predetermined maximum\n\nfunc CopyLessThanOrEqualToThisManyBytesOrReturnError(r io.Reader, w io.Writer) error {\n    var buf = make([]byte, nMax+1)\n    nRead, e := io.ReadFull(r, buf)\n    if nRead &gt; 0 &amp;&amp; nRead &lt;= nMax {\n        w.Write(buf[:nRead])\n        return nil\n    }\n    if nRead &gt; nMax {\n        return fmt.Errorf(\"there is more data\")\n    }\n    return e\n}\n</code></pre>\n\n<hr>\n\n<p>Like this working sample code unsing <code>string</code>:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"strings\"\n)\n\nconst nMax = 5 // your predetermined maximum\n\nfunc CopyLessThanOrEqualToThisManyBytesOrReturnError(r io.Reader, w io.Writer) error {\n    var buf = make([]byte, nMax+1)\n    nRead, e := io.ReadFull(r, buf)\n    if nRead &gt; 0 &amp;&amp; nRead &lt;= nMax {\n        w.Write(buf[:nRead])\n        return nil\n    }\n    if nRead &gt; nMax {\n        return fmt.Errorf(\"there is more data\")\n    }\n    return e\n}\n\nfunc main() {\n    r := strings.NewReader(\"123456789\")\n    err := CopyLessThanOrEqualToThisManyBytesOrReturnError(r, os.Stdout)\n    if err != nil {\n        fmt.Println(err) // there is more data\n    }\n\n    r = strings.NewReader(\"123\\n\")\n    err = CopyLessThanOrEqualToThisManyBytesOrReturnError(r, os.Stdout) // 123\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    r = strings.NewReader(\"\")\n    err = CopyLessThanOrEqualToThisManyBytesOrReturnError(r, os.Stdout)\n    if err != nil {\n        fmt.Println(err) // EOF\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>there is more data\n123\nEOF\n</code></pre>\n\n<hr>\n\n<p>Working sample code, using files:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\nconst nMax = 5 // your predetermined maximum\n\nfunc CopyLessThanOrEqualToThisManyBytesOrReturnError(r io.Reader, w io.Writer) error {\n    var buf = make([]byte, nMax+1)\n    nRead, e := io.ReadFull(r, buf)\n    if nRead &gt; 0 &amp;&amp; nRead &lt;= nMax {\n        w.Write(buf[:nRead])\n        return nil\n    }\n    if nRead &gt; nMax {\n        return fmt.Errorf(\"there is more data\")\n    }\n    return e\n}\n\nfunc main() {\n    r, err := os.Open(\"input.bin\")\n    if err != nil {\n        panic(err)\n    }\n    defer r.Close()\n\n    w, err := os.Create(\"output.bin\")\n    if err != nil {\n        panic(err)\n    }\n    defer w.Close()\n\n    err = CopyLessThanOrEqualToThisManyBytesOrReturnError(r, w)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(\"Done.\")\n}\n</code></pre>\n\n<hr>\n\n<p>Working sample code, using <code>[]byte</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n)\n\nconst nMax = 5 // your predetermined maximum\n\nfunc CopyLessThanOrEqualToThisManyBytesOrReturnError(r io.Reader, w io.Writer) error {\n    var buf = make([]byte, nMax+1)\n    nRead, e := io.ReadFull(r, buf)\n    if nRead &gt; 0 &amp;&amp; nRead &lt;= nMax {\n        w.Write(buf[:nRead])\n        return nil\n    }\n    if nRead &gt; nMax {\n        return fmt.Errorf(\"there is more data\")\n    }\n    return e\n}\n\nfunc main() {\n    bs := []byte{1, 2, 3, 4, 5}\n    r := bytes.NewReader(bs)\n\n    w := &amp;bytes.Buffer{}\n\n    err := CopyLessThanOrEqualToThisManyBytesOrReturnError(r, w)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(\"Done.\")\n    fmt.Println(w.Bytes())\n}\n</code></pre>\n\n<p>output:  </p>\n\n<pre><code>Done.\n[1 2 3 4 5]\n</code></pre>\n"}], "owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3855, "favorite_count": 3, "accepted_answer_id": 39050784, "answer_count": 2, "score": 2, "last_activity_date": 1472439279, "creation_date": 1471668296, "last_edit_date": 1471676681, "question_id": 39050562, "link": "https://stackoverflow.com/questions/39050562/read-copy-up-to-a-certain-number-of-bytes-from-io-reader-to-io-writer-in-gol", "title": "Read/copy up to a certain number of bytes from `io.Reader` to `io.Writer` in Golang, or return error if OVER a certain bytes limit?", "body": "<p>I have an <code>io.Reader</code> in Golang and I want to double-check that the size of its data is below a predetermined maximum before or while running <code>io.Copy()</code> to save it to disk using <code>io.Writer</code>.</p>\n\n<p>Since the file data in <code>io.Reader</code> could theoretically be quite large, I want to minimize memory usage and processing here if avoidable.<br>\nI don't think there's a function that's like <code>io.CopyLessThanOrEqualToThisManyBytesOrReturnError()</code>, but I did notice that <code>io.ReadFull()</code> can do the opposite to return an error if not enough bytes are there to fill the provided buffer.</p>\n\n<p>Does anyone have a solution to this?</p>\n\n<hr>\n\n<p><strong>EDIT:</strong><br>\nTo clarify, copying a fraction of the data is not OK. It either needs to fail if it's over the threshold, or work if it's under.</p>\n"}, {"tags": ["mongodb", "go", "aggregation-framework", "mgo", "mongodb-aggregation"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 1, "last_activity_date": 1471668992, "creation_date": 1471668992, "answer_id": 39050624, "question_id": 39050499, "link": "https://stackoverflow.com/questions/39050499/how-do-i-write-the-following-mongo-aggregation-query-using-mgo-with-golang/39050624#39050624", "title": "How do I write the following Mongo Aggregation Query using mgo with Golang", "body": "<pre><code>\"$setIsSubset\": []interface{}{\n    []string{userID},\n    []string{\"$$item.denied_users\"},\n},\n</code></pre>\n\n<p>is equal to</p>\n\n<pre><code>\"$setIsSubset\" : [\n    [userID], [\"$$item.denied_users\"]\n]\n</code></pre>\n\n<p>so I think you need to define it like</p>\n\n<pre><code>\"$setIsSubset\": []interface{}{\n    []string{userID},\n    \"$$item.denied_users\",\n},\n</code></pre>\n"}], "owner": {"reputation": 7606, "user_id": 180253, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/df46030788b7cc95cadb9778a2b9e7dd?s=128&d=identicon&r=PG", "display_name": "TheJediCowboy", "link": "https://stackoverflow.com/users/180253/thejedicowboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 839, "favorite_count": 0, "accepted_answer_id": 39050624, "answer_count": 1, "score": 1, "last_activity_date": 1471678336, "creation_date": 1471667536, "last_edit_date": 1471678336, "question_id": 39050499, "link": "https://stackoverflow.com/questions/39050499/how-do-i-write-the-following-mongo-aggregation-query-using-mgo-with-golang", "title": "How do I write the following Mongo Aggregation Query using mgo with Golang", "body": "<p>I have the following query which I have tested and works, but the <code>mgo</code> </p>\n\n<pre><code>var userId = \"57a944390b1acf0d069388c1\";\ndb.users.aggregate([\n        { \"$match\": { \"_id\": userID } },\n        { \"$unwind\": \"$groups\" },\n        {\n            \"$lookup\": {\n                \"from\": \"groups\",\n                \"localField\": \"groups.id\",\n                \"foreignField\": \"_id\",\n                \"as\": \"group\"\n            }\n        },\n        { \"$unwind\": \"$group\" },\n        {\n            \"$project\": {\n                \"group.requests\": {\n                    \"$filter\": {\n                        \"input\" : \"$group.requests\",\n                        \"as\" : \"item\",\n                        \"cond\": { \"$and\" : [\n                                { \"$ne\" : [\"$$item.user_id\", userID] },\n                                { \"$not\" : {\n                                        \"$setIsSubset\" : [\n                                            [userID], \"$$item.denied_users\"\n                                        ]\n                                    }\n                                }\n                            ]               \n                        }\n                    }\n                }\n            }\n        },\n        { \"$unwind\" : \"$group.requests\" }\n      ])\n</code></pre>\n\n<p>The <code>mgo</code> query looks like the following:</p>\n\n<pre><code>c := session.DB(info.Db()).C(\"users\")\n\n    o1 := bson.M{\"$match\": bson.M{\"_id\": userID}}\n    o2 := bson.M{\"$unwind\": \"$groups\"}\n    o3 := bson.M{\"$lookup\": bson.M{\n        \"from\":         \"groups\",\n        \"localField\":   \"groups.id\",\n        \"foreignField\": \"_id\",\n        \"as\":           \"group\",\n    }}\n    o4 := bson.M{\"$unwind\": \"$group\"}\n    o5 := bson.M{\n        \"$project\": bson.M{\n            \"group.requests\": bson.M{\n                \"$filter\": bson.M{\n                    \"input\": \"$group.requests\",\n                    \"as\":    \"item\",\n                    \"cond\": bson.M{\n                        \"$and\": []bson.M{\n                            bson.M{\"$ne\": []string{\"$$item.user_id\", userID}},\n                            bson.M{\"$not\": bson.M{\n                                \"$setIsSubset\": []interface{}{\n                                    []string{userID},\n                                    []string{\"$$item.denied_users\"},\n                                },\n                            }},\n                        },\n                    },\n                },\n            },\n        },\n    }\n    o6 := bson.M{\"$unwind\": \"$group.requests\"}\n    pipeline := []bson.M{o1, o2, o3, o4, o5, o6}\n</code></pre>\n\n<p>My guess is that the <code>$filter</code> is not working. Specifically, the way I am specifying the <code>$setIsSubset</code> and arguments to that are not matching the actual mongo query above it. If I remove that section (everything within the <code>$not</code>, then it works (aside from not being the correct filter).</p>\n\n<p>I basically need the top query translated into mgo.</p>\n"}, {"tags": ["go", "unmarshalling", "hyperledger"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 6733281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3be3658fbe3d191104a4b705041a894d?s=128&d=identicon&r=PG&f=1", "display_name": "Logumay", "link": "https://stackoverflow.com/users/6733281/logumay"}, "edited": false, "score": 0, "creation_date": 1472101621, "post_id": 39051969, "comment_id": 65618726, "body": "Thanks a lot Sergey!, its working fine. Here is the actual code   <code>{   &quot;jsonrpc&quot;: &quot;2.0&quot;,   &quot;method&quot;: &quot;deploy&quot;,   &quot;params&quot;: {     &quot;type&quot;: 1,     &quot;chaincodeID&quot;:{         &quot;path&quot;:&quot;github.com&#47;hyperledger&#47;fabric&#47;examples&#47;chaincode&#47;go&#47;&zwnj;&#8203;chaincode_example02&quot;     },     &quot;ctorMsg&quot;: {    &quot;args&quot;:[&quot;aW5pdA==&quot;, &quot;YQ==&quot;, &quot;MTAwMA==&quot;, &quot;Yg==&quot;, &quot;MjAwMA==&quot;]     }          },   &quot;id&quot;: 1   }</code>"}, {"owner": {"reputation": 1423, "user_id": 1998518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb41bf7e983e75709ffd3d94c4585943?s=128&d=identicon&r=PG", "display_name": "Milan", "link": "https://stackoverflow.com/users/1998518/milan"}, "edited": false, "score": 1, "creation_date": 1473784921, "post_id": 39051969, "comment_id": 66269358, "body": "Sergey, I see that both formats are supported: <code>{&quot;function&quot;:&quot;init&quot;,&quot;args&quot;:[&quot;a&quot;, &quot;1000&quot;, &quot;b&quot;, &quot;2000&quot;]}}</code> as well as <code>{&quot;args&quot;:[&quot;init&quot;,&quot;a&quot;, &quot;1000&quot;, &quot;b&quot;, &quot;2000&quot;]}}</code>"}, {"owner": {"reputation": 2061, "user_id": 539877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2078f8c58536286626ce779e7bfdb10c?s=128&d=identicon&r=PG&f=1", "display_name": "Sergey Balashevich", "link": "https://stackoverflow.com/users/539877/sergey-balashevich"}, "reply_to_user": {"reputation": 1423, "user_id": 1998518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb41bf7e983e75709ffd3d94c4585943?s=128&d=identicon&r=PG", "display_name": "Milan", "link": "https://stackoverflow.com/users/1998518/milan"}, "edited": false, "score": 0, "creation_date": 1473856343, "post_id": 39051969, "comment_id": 66298580, "body": "@Mil4n Hmm, that is right. It looks like both formats are supported now. Just tested with \u201cfunction, args\u201d and just \u201cargs\u201d and both requests were accepted. Thank you for info."}], "tags": [], "owner": {"reputation": 2061, "user_id": 539877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2078f8c58536286626ce779e7bfdb10c?s=128&d=identicon&r=PG&f=1", "display_name": "Sergey Balashevich", "link": "https://stackoverflow.com/users/539877/sergey-balashevich"}, "is_accepted": true, "score": 2, "last_activity_date": 1472673477, "last_edit_date": 1472673477, "creation_date": 1471680676, "answer_id": 39051969, "question_id": 39050494, "link": "https://stackoverflow.com/questions/39050494/hyperledger-fabric-chaincode-deployment-base64-error/39051969#39051969", "title": "HyperLedger-Fabric ChainCode Deployment - Base64 error", "body": "<p>In latest fabric's version the request's format was changed. Function name should be in Args and all parameters should be base64 encoded.<br>\nInstead of: </p>\n\n<p><code>{\"function\":\"init\",\"args\":[\"a\", \"1000\", \"b\", \"2000\"]}}</code> </p>\n\n<p>The arguments for deploy command will look like:</p>\n\n<p><code>{\"args\":['aW5pdA==', 'YQ==', 'MTAwMA==', 'Yg==', 'MjAwMA==']}</code></p>\n\n<p><strong>Update</strong>: Format was changed again. Base64 encoding is not necessary any longer. correct payload in latest Fabric is:</p>\n\n<p><code>{\u201cargs\u201d:['init', 'a', '100', 'b', '100']}</code></p>\n"}], "owner": {"reputation": 13, "user_id": 6733281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3be3658fbe3d191104a4b705041a894d?s=128&d=identicon&r=PG&f=1", "display_name": "Logumay", "link": "https://stackoverflow.com/users/6733281/logumay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 784, "favorite_count": 0, "accepted_answer_id": 39051969, "answer_count": 1, "score": 1, "last_activity_date": 1472673477, "creation_date": 1471667460, "last_edit_date": 1495542771, "question_id": 39050494, "link": "https://stackoverflow.com/questions/39050494/hyperledger-fabric-chaincode-deployment-base64-error", "title": "HyperLedger-Fabric ChainCode Deployment - Base64 error", "body": "<p>I was trying to setup the Hyperledger blocchain on my laptop by following the Windows setup , was able to bring the docker images up and running, but when I try to deploy the examples provided, it always throws back the error in the JSON input as shown below.</p>\n\n<pre><code>peer chaincode deploy -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 -c '{\"Function\":\"init\", \"Args\": [\"a\",\"100\", \"b\", \"200\"]}'\n</code></pre>\n\n<p>response:</p>\n\n<pre><code>sug@sri-ub:~/go/$ docker exec -it aa413f4c4289 bash\nroot@aa413f4c4289:/opt/gopath/src/github.com/hyperledger/fabric# peer chaincode deploy -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 -c '{\"Function\":\"init\", \"Args\": [\"a\",\"100\", \"b\", \"200\"]}'\n\n04:30:55.822 [logging] LoggingInit -&gt; DEBU 001 Setting default logging level to DEBUG for command 'chaincode' Error: Non-empty JSON chaincode parameters must contain exactly 1 key: 'Args'\n</code></pre>\n\n<p>I tried in POSTMAN from the HOST machine:</p>\n\n<pre><code>{\"jsonrpc\":\"2.0\",\"method\":\"deploy\",\"params\":{\"type\":1,\"chaincodeID\":{\"path\":\"github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02\"},\"ctorMsg\":{\"function\":\"init\",\"args\":[\"a\", \"1000\", \"b\", \"2000\"]}},\"id\":1}\n</code></pre>\n\n<p>got the response as</p>\n\n<pre><code>{\"jsonrpc\":\"2.0\",\"error\":{\"code\":-32700,\"message\":\"Parse error\",\"data\":\"Error unmarshalling chaincode request payload: illegal base64 data at input byte 0\"},\"\n</code></pre>\n\n<p>This is similar to the error message and I couldn't resolve this still, creating a new post as advised, please help me fix this issue.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/38918739/hyperledger-fabric-chaincode-deployment-giving-parse-error\">Similar issue reported  but that also doesn't answer</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "edited": false, "score": 0, "creation_date": 1471668469, "post_id": 39050110, "comment_id": 65450560, "body": "then why does it fail when I enter <code>uint8(256)</code>..it says it overflows uint8"}, {"owner": {"reputation": 116, "user_id": 6733163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e1c2f430809a755d76d3d19638dad4?s=128&d=identicon&r=PG&f=1", "display_name": "zc05", "link": "https://stackoverflow.com/users/6733163/zc05"}, "reply_to_user": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "edited": false, "score": 0, "creation_date": 1471735830, "post_id": 39050110, "comment_id": 65468622, "body": "It is because constant conversion is subject to different static checking rule. Reference can be found at <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Conversions</a>. Specifically T(x) is good when x is constant AND &#39;x is representable by a value of type T.&#39; int8(256) fails because 256 is beyond what one byte can represent."}], "tags": [], "owner": {"reputation": 116, "user_id": 6733163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e1c2f430809a755d76d3d19638dad4?s=128&d=identicon&r=PG&f=1", "display_name": "zc05", "link": "https://stackoverflow.com/users/6733163/zc05"}, "is_accepted": false, "score": 1, "last_activity_date": 1471662970, "creation_date": 1471662970, "answer_id": 39050110, "question_id": 39049887, "link": "https://stackoverflow.com/questions/39049887/golang-exercise-slices-how-does-it-deal-with-big-values/39050110#39050110", "title": "Golang exercise slices how does it deal with big values", "body": "<p><code>uint8(anotherIntValue)</code> conversion will take the last byte of <code>anotherIntValue</code>. That is why your code can produce many blue (0). For example, following code would print 'val = 0'.</p>\n\n<pre><code>dx, dy := 128, 2\nfmt.Println(\"val =\", uint8(dx*dy))\n</code></pre>\n\n<p>Constant conversion will be checked by compiler for out of range errors. </p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 1, "creation_date": 1471669245, "post_id": 39050487, "comment_id": 65450680, "body": "@deltaskelta why does it fail when you enter <code>uint8(256)</code>? yes <code>uint8(256)</code> gives <code>constant 256 overflows uint8</code> but <code>var i int = 256 \tfmt.Println(uint8(i))</code>  gives <code>0</code>, see: <a href=\"https://github.com/golang/go/issues/16153\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/16153</a>"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1471668167, "last_edit_date": 1471668167, "creation_date": 1471667369, "answer_id": 39050487, "question_id": 39049887, "link": "https://stackoverflow.com/questions/39049887/golang-exercise-slices-how-does-it-deal-with-big-values/39050487#39050487", "title": "Golang exercise slices how does it deal with big values", "body": "<p>Imagine <code>i</code> is of type <code>int</code>, <code>uint8(i)</code> returns <a href=\"https://en.wikipedia.org/wiki/Least_significant_bit\" rel=\"nofollow noreferrer\">Least Significant Byte (LSB)</a>  of <code>i</code>:  </p>\n\n<p>When <code>x</code> is in range <code>[0, 255]</code> , meaning: <code>0 &lt;= x &lt;= 255</code><br>\nand <code>y</code> is in range [0, 255],<br>\nthen <code>x*y</code> is in range <code>[0, 255*255] = [0, 65025]</code><br>\nso <code>x*y/20</code> is in range <code>[0, 255*255/20] = [0, 65025/20] = [0, 3251]</code><br>\nand value of <code>uint8(x*y/20)</code> is equal to <code>(x*y/20)%256</code> meaning exactly LSB byte:<br>\n<code>uint8(3251) = uint8(0XCB3) = 0XB3 = 179</code><br>\n<code>3251 = 12*256 + 179</code></p>\n\n<p>So every time the <code>x*y/20</code> is bigger than 255 it counts from 0 again: <code>(x*y/20) % 256</code> this is why your image is repeated circles.</p>\n\n<p>Try this working sample code:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    for y := 0; y &lt;= 255; y++ {\n        for x := 0; x &lt;= 255; x++ {\n            v := x * y / 20\n            if int(uint8(v)) != v%256 {\n                fmt.Println(v, v%256)\n            }\n        }\n    }\n    fmt.Println(\"Done.\")\n}\n</code></pre>\n\n<p>output:  </p>\n\n<pre><code>Done.\n</code></pre>\n\n<p>Let's simplify you example, see this working sample code:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"image\"\n    \"image/png\"\n    \"os\"\n)\n\nfunc main() {\n    const dx = 256\n    const dy = 256\n    m := image.NewNRGBA(image.Rect(0, 0, dx, dy))\n    for y := 0; y &lt; dy; y++ {\n        for x := 0; x &lt; dx; x++ {\n            v := uint8(x * y / 20)\n            i := y*m.Stride + x*4\n            m.Pix[i] = v     //R\n            m.Pix[i+1] = v   //G\n            m.Pix[i+2] = 255 //B\n            m.Pix[i+3] = 255 //A\n        }\n    }\n    var buf bytes.Buffer\n    err := png.Encode(&amp;buf, m)\n    if err != nil {\n        panic(err)\n    }\n    os.Stdout.Write(buf.Bytes())\n}\n</code></pre>\n\n<p>And redirect the output to a file like <code>main &gt; b.png</code> or, <code>go run main.go &gt; b.png</code><br>\nsee output file <code>b.png</code>:<br>\n<a href=\"https://i.stack.imgur.com/k5i3q.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/k5i3q.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 39050487, "answer_count": 2, "score": 0, "last_activity_date": 1471685817, "creation_date": 1471660033, "last_edit_date": 1471685817, "question_id": 39049887, "link": "https://stackoverflow.com/questions/39049887/golang-exercise-slices-how-does-it-deal-with-big-values", "title": "Golang exercise slices how does it deal with big values", "body": "<p>I'm going through the Golang tutorial and I'm a little bit confused as to what it is doing with some of the values in the slices exercise. <a href=\"https://tour.golang.org/moretypes/18\" rel=\"nofollow\">https://tour.golang.org/moretypes/18</a></p>\n\n<p>Here is the code that I am confused with:</p>\n\n<p>A value of 0 is a perfectly blue pixel and a value of 255 is a perfectly white pixel. So what is happening here when the value displayed is some form of <code>x*y</code> (I did <code>/20</code> to make the image a little bit bigger and easier to see).</p>\n\n<p>If you follow the image horizontally, you will see that at some point in the process, the ever increasing x and y values seem to revert to blue (0 value) If I type a static value like <code>256</code> in the return I get a compile error. So it obviously does not allow the numbers to <code>go off the scale</code> and revert to 0 or anything. So how does it get the blue curves in the picture? </p>\n\n<p>imported source here: <a href=\"https://github.com/golang/tour/blob/master/pic/pic.go#L15\" rel=\"nofollow\">https://github.com/golang/tour/blob/master/pic/pic.go#L15</a></p>\n\n<pre><code>package main\n\nimport \"golang.org/x/tour/pic\"\n\nfunc Pic(dx, dy int) [][]uint8 {\n    //First, the array has to be made so we can put some values in it later\n    //This only makes the second dimension of the array ([[uint8 dy]])?\n    image := make([][]uint8, dy)\n\n    //The inputs into the function are Int's, so it is ok to have a non uint8\n    //loop initializer\n    for x := 0; x &lt; dy; x++ {\n        //once we are in the loop we have to make the first dimension of the array\n        //based on the dx values\n        image[x] = make([]uint8, dx)\n        for y := 0; y &lt; dx; y++ {\n            //This is a function +to assign the pixel values to the array\n            image[x][y] = uint8((x * y) /20)\n        }\n    }\n    return image\n}\n\nfunc main() {\n    pic.Show(Pic)\n}\n</code></pre>\n"}, {"tags": ["postgresql", "go", "docker", "docker-compose"], "comments": [{"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1471637468, "post_id": 39045889, "comment_id": 65443864, "body": "try <code>sql.Open(&quot;postgres&quot;, &quot;postgres:&#47;&#47;postgres&#47;yourdbname&quot;)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 2023, "user_id": 2402929, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wd4f2.jpg?s=128&g=1", "display_name": "xtrinch", "link": "https://stackoverflow.com/users/2402929/xtrinch"}, "is_accepted": true, "score": 1, "last_activity_date": 1471637984, "creation_date": 1471637984, "answer_id": 39047085, "question_id": 39045889, "link": "https://stackoverflow.com/questions/39045889/connecting-go-and-postgres-with-docker-compose/39047085#39047085", "title": "Connecting go and postgres with docker-compose", "body": "<p>Turns out as I am not actually linking the containers, os.Getenv(\"DB_ENV_POSTGRES_PASSWORD\") was producing an empty string. Added an environment variable with password to the server container in docker-compose.yml and now I can connect to my database.</p>\n"}, {"comments": [{"owner": {"reputation": 2023, "user_id": 2402929, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wd4f2.jpg?s=128&g=1", "display_name": "xtrinch", "link": "https://stackoverflow.com/users/2402929/xtrinch"}, "edited": false, "score": 1, "creation_date": 1471718745, "post_id": 39053288, "comment_id": 65464546, "body": "Thanks, that was helpful :)"}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 2023, "user_id": 2402929, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wd4f2.jpg?s=128&g=1", "display_name": "xtrinch", "link": "https://stackoverflow.com/users/2402929/xtrinch"}, "edited": false, "score": 0, "creation_date": 1471764842, "post_id": 39053288, "comment_id": 65472872, "body": "@Nirri Would you mind accepting this as the correct answer?"}], "tags": [], "owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "is_accepted": false, "score": 6, "last_activity_date": 1472076276, "last_edit_date": 1472076276, "creation_date": 1471690301, "answer_id": 39053288, "question_id": 39045889, "link": "https://stackoverflow.com/questions/39045889/connecting-go-and-postgres-with-docker-compose/39053288#39053288", "title": "Connecting go and postgres with docker-compose", "body": "<p>That a docker networking question.You can read more about it <a href=\"https://docs.docker.com/compose/networking/\" rel=\"nofollow\">here.</a>\nDocker dns does all the hard work, so you can reach each container by the  name you gave it on the compose file.</p>\n\n<p>Posgres url usually works like </p>\n\n<pre><code>postgresql://user:password@ip:port/database\n</code></pre>\n\n<p>So for you, it would be something like. </p>\n\n<pre><code>db, err := sql.Open(\"postgres\", \"postgresql://user:password@postgres/mydatabase)\n</code></pre>\n\n<p>Note that you do not need the port if postgres is on the standard port (5432). </p>\n"}], "owner": {"reputation": 2023, "user_id": 2402929, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/wd4f2.jpg?s=128&g=1", "display_name": "xtrinch", "link": "https://stackoverflow.com/users/2402929/xtrinch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2119, "favorite_count": 0, "accepted_answer_id": 39047085, "answer_count": 2, "score": 5, "last_activity_date": 1472076276, "creation_date": 1471632382, "question_id": 39045889, "link": "https://stackoverflow.com/questions/39045889/connecting-go-and-postgres-with-docker-compose", "title": "Connecting go and postgres with docker-compose", "body": "<p>I'm trying to connect a go and a postgres container with docker-compose.</p>\n\n<p>Here's my docker-compose.yml:</p>\n\n<pre><code>version: '2'\nservices:\n    postgres:\n        image: postgres\n        ports:\n            - \"5432\"\n        environment:\n            - POSTGRES_PASSWORD=postgres\n    server:\n        build: ./server\n        command: gin\n        volumes:\n            - ./server:/go/src/app\n        ports:\n            - \"8080:3000\"\n</code></pre>\n\n<p>At first I was trying with the links command in the docker-compose.yml, but that didn't create any env variables in the server container, so that got me pretty confused. (It's supposed to create SOMETHINGSOMETHING_PORT_5432_TCP_ADDR and SOMETHINGSOMETHING_5432_TCP_PORT, isn't it?)</p>\n\n<p>Then I read somewhere I could just use <a href=\"http://postgres\" rel=\"noreferrer\">http://postgres</a> as the host, so I tried that. So now this is how my main.go looks like (NOTE: I'm using Gorp for \"ORM\"):</p>\n\n<pre><code>func main() {\n\n    dbinfo := fmt.Sprintf(\"user=%s password=%s host=%s dbname=%s sslmode=disable\",\n        \"postgres\",\n        os.Getenv(\"DB_ENV_POSTGRES_PASSWORD\"),\n        \"http://postgres\",\n        DB_NAME,\n    )\n\n    db, err := sql.Open(\"postgres\", dbinfo)\n\n    checkErr(err, \"sql.Open failed\")\n\n\n    // construct a gorp DbMap\n    dbmap := &amp;gorp.DbMap{Db: db, Dialect: gorp.PostgresDialect{}}\n\n    // add a table, setting the table name to 'posts' and\n    // specifying that the Id property is an auto incrementing PK\n    dbmap.AddTableWithName(Todo{}, \"todos\").SetKeys(true, \"Id\")\n\n    // create the table. in a production system you'd generally\n    // use a migration tool, or create the tables via scripts\n    err = dbmap.CreateTablesIfNotExists()\n    checkErr(err, \"Create tables failed\")\n\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":3001\", nil)\n}\n</code></pre>\n\n<p>Here's a detailed log of docker-compose up (I get connection refused on port 5432):</p>\n\n<pre><code>\u2190[36mserver_1    |\u2190[0m [gin] listening on port 3000\n\u2190[33mpostgres_1  |\u2190[0m The files belonging to this database system will be owned by user \"postgres\".\n\u2190[33mpostgres_1  |\u2190[0m This user must also own the server process.\n\u2190[33mpostgres_1  |\u2190[0m\n\u2190[33mpostgres_1  |\u2190[0m The database cluster will be initialized with locale \"en_US.utf8\".\n\u2190[33mpostgres_1  |\u2190[0m The default database encoding has accordingly been set to \"UTF8\".\n\u2190[33mpostgres_1  |\u2190[0m The default text search configuration will be set to \"english\".\n\u2190[33mpostgres_1  |\u2190[0m\n\u2190[33mpostgres_1  |\u2190[0m Data page checksums are disabled.\n\u2190[33mpostgres_1  |\u2190[0m\n\u2190[33mpostgres_1  |\u2190[0m fixing permissions on existing directory /var/lib/postgresql/data ... ok\n\u2190[33mpostgres_1  |\u2190[0m creating subdirectories ... ok\n\u2190[33mpostgres_1  |\u2190[0m selecting default max_connections ... 100\n\u2190[33mpostgres_1  |\u2190[0m selecting default shared_buffers ... 128MB\n\u2190[33mpostgres_1  |\u2190[0m selecting dynamic shared memory implementation ... posix\n\u2190[33mpostgres_1  |\u2190[0m creating configuration files ... ok\n\u2190[33mpostgres_1  |\u2190[0m creating template1 database in /var/lib/postgresql/data/base/1 ... ok\n\u2190[33mpostgres_1  |\u2190[0m initializing pg_authid ... ok\n\u2190[33mpostgres_1  |\u2190[0m initializing dependencies ... ok\n\u2190[33mpostgres_1  |\u2190[0m creating system views ... ok\n\u2190[33mpostgres_1  |\u2190[0m loading system objects' descriptions ... ok\n\u2190[33mpostgres_1  |\u2190[0m creating collations ... ok\n\u2190[33mpostgres_1  |\u2190[0m creating conversions ... ok\n\u2190[33mpostgres_1  |\u2190[0m creating dictionaries ... ok\n\u2190[33mpostgres_1  |\u2190[0m setting privileges on built-in objects ... ok\n\u2190[33mpostgres_1  |\u2190[0m creating information schema ... ok\n\u2190[33mpostgres_1  |\u2190[0m loading PL/pgSQL server-side language ... ok\n\u2190[33mpostgres_1  |\u2190[0m vacuuming database template1 ... ok\n\u2190[33mpostgres_1  |\u2190[0m copying template1 to template0 ... ok\n\u2190[33mpostgres_1  |\u2190[0m copying template1 to postgres ... ok\n\u2190[33mpostgres_1  |\u2190[0m syncing data to disk ... ok\n\u2190[33mpostgres_1  |\u2190[0m\n\u2190[33mpostgres_1  |\u2190[0m WARNING: enabling \"trust\" authentication for local connections\n\u2190[33mpostgres_1  |\u2190[0m You can change this by editing pg_hba.conf or using the option -A, or\n\u2190[33mpostgres_1  |\u2190[0m --auth-local and --auth-host, the next time you run initdb.\n\u2190[33mpostgres_1  |\u2190[0m\n\u2190[33mpostgres_1  |\u2190[0m Success. You can now start the database server using:\n\u2190[33mpostgres_1  |\u2190[0m\n\u2190[33mpostgres_1  |\u2190[0m     pg_ctl -D /var/lib/postgresql/data -l logfile start\n\u2190[33mpostgres_1  |\u2190[0m\n\u2190[33mpostgres_1  |\u2190[0m waiting for server to start....LOG:  database system was shut down at 2016-08-19 18:31:55 UTC\n\u2190[33mpostgres_1  |\u2190[0m LOG:  MultiXact member wraparound protections are now enabled\n\u2190[33mpostgres_1  |\u2190[0m LOG:  database system is ready to accept connections\n\u2190[33mpostgres_1  |\u2190[0m LOG:  autovacuum launcher started\n\u2190[33mpostgres_1  |\u2190[0m  done\n\u2190[33mpostgres_1  |\u2190[0m server started\n\u2190[33mpostgres_1  |\u2190[0m ALTER ROLE\n\u2190[33mpostgres_1  |\u2190[0m\n\u2190[33mpostgres_1  |\u2190[0m\n\u2190[33mpostgres_1  |\u2190[0m /docker-entrypoint.sh: ignoring /docker-entrypoint-initdb.d/*\n\u2190[33mpostgres_1  |\u2190[0m\n\u2190[33mpostgres_1  |\u2190[0m LOG:  received fast shutdown request\n\u2190[33mpostgres_1  |\u2190[0m LOG:  aborting any active transactions\n\u2190[33mpostgres_1  |\u2190[0m LOG:  autovacuum launcher shutting down\n\u2190[33mpostgres_1  |\u2190[0m LOG:  shutting down\n\u2190[33mpostgres_1  |\u2190[0m waiting for server to shut down....LOG:  database system is shut down\n\u2190[33mpostgres_1  |\u2190[0m  done\n\u2190[33mpostgres_1  |\u2190[0m server stopped\n\u2190[33mpostgres_1  |\u2190[0m\n\u2190[33mpostgres_1  |\u2190[0m PostgreSQL init process complete; ready for start up.\n\u2190[33mpostgres_1  |\u2190[0m\n\u2190[33mpostgres_1  |\u2190[0m LOG:  database system was shut down at 2016-08-19 18:31:57 UTC\n\u2190[33mpostgres_1  |\u2190[0m LOG:  MultiXact member wraparound protections are now enabled\n\u2190[33mpostgres_1  |\u2190[0m LOG:  database system is ready to accept connections\n\u2190[33mpostgres_1  |\u2190[0m LOG:  autovacuum launcher started\n\u2190[36mserver_1    |\u2190[0m 2016/08/19 18:32:05 Create tables failed dial tcp [::1]:5432: getsockopt: connection refused\n\u2190[36mserver_1    |\u2190[0m 2016/08/19 18:32:05 http: proxy error: dial tcp [::1]:3001: getsockopt: connection refused\n\u2190[36mserver_1    |\u2190[0m 2016/08/19 18:32:05 Create tables failed dial tcp [::1]:5432: getsockopt: connection refused\n\u2190[36mserver_1    |\u2190[0m 2016/08/19 18:32:05 http: proxy error: dial tcp [::1]:3001: getsockopt: connection refused\n</code></pre>\n\n<p>So my question is how do I get these to be able to talk to each other and what exactly am I doing wrong here?</p>\n"}]