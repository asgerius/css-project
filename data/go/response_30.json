[{"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438820386, "post_id": 31844680, "comment_id": 51611134, "body": "Your title just says &quot;GORM&quot; but isn&#39;t this entirely dependant on the database driver being used? E.g. for PostgreSQL you&#39;d either have to configure the default database connect settings, execute a <a href=\"http://www.postgresql.org/docs/9.5/static/sql-set-transaction.html\" rel=\"nofollow noreferrer\"><code>SET TRANSACTION</code></a> command, or see if the specific Go PostgreSQL driver you are using (there is more than one) exposes this directly."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1438820898, "post_id": 31844680, "comment_id": 51611245, "body": "Sure enough, <a href=\"https://golang.org/pkg/database/sql/#DB.Begin\" rel=\"nofollow noreferrer\"><code>DB.Begin</code></a> (which is what GORM uses) says &quot;The isolation level is dependent on the driver.&quot; Searching <code>github.com&#47;lib&#47;pq</code> (you didn&#39;t say which driver you were using) gives some advice in <a href=\"https://github.com/lib/pq/issues/261\" rel=\"nofollow noreferrer\">issue 261</a>."}, {"owner": {"reputation": 1997, "user_id": 140477, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/IjFb7.png?s=128&g=1", "display_name": "Kennedy", "link": "https://stackoverflow.com/users/140477/kennedy"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438821746, "post_id": 31844680, "comment_id": 51611437, "body": "Yes, I am using the <code>github.com&#47;lib&#47;pq</code> driver. Thank you! The issue answers my question, I will give it a try."}], "answers": [{"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 6, "last_activity_date": 1438821827, "creation_date": 1438821827, "answer_id": 31845051, "question_id": 31844680, "link": "https://stackoverflow.com/questions/31844680/how-to-set-isolation-level/31845051#31845051", "title": "How to set isolation level", "body": "<p>I had exactly the same problem <a href=\"https://github.com/AlexAtNet/vega/blob/master/src/vega/content/model.go#L104\" rel=\"noreferrer\">here</a>:</p>\n\n<pre><code>func GetPageAfterUpdate(dp model.DbProvider, id int, update int, page *Page) (err error) {\n  tx := dp.DB().Begin()\n\n  err = tx.Exec(`set transaction isolation level repeatable read`).Error\n  if err != nil {\n    tx.Rollback()\n    return\n  }\n</code></pre>\n\n<p>And it is exactly gorm with pg.</p>\n"}], "owner": {"reputation": 1997, "user_id": 140477, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/IjFb7.png?s=128&g=1", "display_name": "Kennedy", "link": "https://stackoverflow.com/users/140477/kennedy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2959, "favorite_count": 2, "accepted_answer_id": 31845051, "answer_count": 1, "score": 4, "last_activity_date": 1438821827, "creation_date": 1438818920, "last_edit_date": 1438820649, "question_id": 31844680, "link": "https://stackoverflow.com/questions/31844680/how-to-set-isolation-level", "title": "How to set isolation level", "body": "<p>I want to set isolation level to <code>repeatable read</code>. How do I achieve this using gorm orm for postgres.</p>\n\n<p>Example code:</p>\n\n<pre><code>func CreateAnimals(db *gorm.DB) err {\n  tx := db.Begin()\n  // Note the use of tx as the database handle once you are within a transaction\n\n  if err := tx.Create(&amp;Animal{Name: \"Giraffe\"}).Error; err != nil {\n     tx.Rollback()\n     return err\n  }\n\n  if err := tx.Create(&amp;Animal{Name: \"Lion\"}).Error; err != nil {\n     tx.Rollback()\n     return err\n  }\n\n  tx.Commit()\n  return nil\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1438837608, "post_id": 31842870, "comment_id": 51615347, "body": "Advise: Do not read input interactive from terminal. There are a lot of subtleties which will distract from the actual code. Use the command line together with package flag."}], "answers": [{"comments": [{"owner": {"reputation": 189, "user_id": 3822666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3182d23392d6948e5c89310db84dcf3?s=128&d=identicon&r=PG", "display_name": "terryp", "link": "https://stackoverflow.com/users/3822666/terryp"}, "edited": false, "score": 0, "creation_date": 1438811656, "post_id": 31842946, "comment_id": 51608469, "body": "Thanks Rob. Always the simple things that I overlook!"}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": false, "score": 7, "last_activity_date": 1438809265, "creation_date": 1438809265, "answer_id": 31842946, "question_id": 31842870, "link": "https://stackoverflow.com/questions/31842870/golang-reading-a-file-basics/31842946#31842946", "title": "GoLang: Reading a File Basics", "body": "<pre><code>f, err := reader.ReadString('\\n')\n</code></pre>\n\n<p>This reads up-to-and-including the <code>\\n</code>. So your filename is <code>/foo.txt\\n</code> which doesn't exist.</p>\n\n<p>You can use <code>strings.Trim()</code> to pull off the newline if you like.</p>\n"}], "owner": {"reputation": 189, "user_id": 3822666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3182d23392d6948e5c89310db84dcf3?s=128&d=identicon&r=PG", "display_name": "terryp", "link": "https://stackoverflow.com/users/3822666/terryp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1438809269, "creation_date": 1438808963, "last_edit_date": 1438809269, "question_id": 31842870, "link": "https://stackoverflow.com/questions/31842870/golang-reading-a-file-basics", "title": "GoLang: Reading a File Basics", "body": "<p>I'm just trying to read a simple file that's in the same directory as the actual program. I keep getting this odd error and my Go is \"emerging\" (as they say). </p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"path/filepath\"\n)\n\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n\nfunc main() {\n    // Here's opening a flat file via the program.\n    // fn := \" ... /foo.txt\"\n    here, err := filepath.Abs(\".\")\n    check(err)\n\n    fmt.Println(\"------- DEBUG ------- \")\n    fmt.Println(here)\n    fmt.Println(\"------- DEBUG ------- \")\n\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Please Enter a File Name: \")\n\n    f, err := reader.ReadString('\\n')\n    f = filepath.Join(here, f)\n    fmt.Println(f)\n    check(err)\n\n    dat, err := ioutil.ReadFile(f)\n    check(err)\n    fmt.Print(string(dat))\n}\n</code></pre>\n\n<p>So here's the weird error, I keep getting. </p>\n\n<pre><code>panic: open ... /foo.txt\n: no such file or directory\n\ngoroutine 1 [running]:\nmain.check(0x22081c49a0, 0x2081ec240)\n... /read.go:13 +0x50\nmain.main()\n... /read.go:36 +0x6b0\nexit status 2\n</code></pre>\n\n<p>When I just use the static name and not standard in, it works fine. There must be something odd with the way standard in pulls in that string and then tries to turn it into a file path.</p>\n"}, {"tags": ["regex", "go", "regex-negation"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4227915"}, "edited": false, "score": 2, "creation_date": 1438823630, "post_id": 31842904, "comment_id": 51611858, "body": "Dude! You are awsome !!"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1438850266, "post_id": 31842904, "comment_id": 51621768, "body": "When no overlapping matches are necessary and there is no look-around support there is always a way to get the required substring with the capturing regex feature."}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 4, "last_activity_date": 1438809115, "creation_date": 1438809115, "answer_id": 31842904, "question_id": 31842666, "link": "https://stackoverflow.com/questions/31842666/write-regex-without-negations/31842904#31842904", "title": "Write regex without negations", "body": "<p>It is a pity that Go regex does not support lookarounds. \nHowever, you can obtain the last link with a sort of a trick: match all possible links and other characters greedily and capture the last link with a capturing group:</p>\n\n<pre><code>^(?:https?://|.)*(https?://\\S+?)(?:\\?=|$)\n</code></pre>\n\n<p>Together with <code>\\S*?</code> lazy whitespace matching, this also lets capture the link up to the <code>?=</code>.</p>\n\n<p>See <a href=\"https://regex101.com/r/eA7xX8/1\" rel=\"nofollow\">regex demo</a> and <a href=\"http://play.golang.org/p/z-sTJHV61T\" rel=\"nofollow\">Go demo</a></p>\n\n<pre><code>var r = regexp.MustCompile(`^(?:https?://|.)*(https?://\\S+?)(?:\\?=|$)`)\nfmt.Printf(\"%q\\n\", r.FindAllStringSubmatch(\"sometextsometexhttp://websites.com/path/subpath/#query1sometexthttp://websites.com/path/subpath/:query2\", -1)[0][1])\nfmt.Printf(\"%q\\n\", r.FindAllStringSubmatch(\"sometextsometexhttp://websites.com/path/subpath/#query1sometexthttp://websites.com/path/subpath/cc:query2/text/?=param\", -1)[0][1])\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>\"http://websites.com/path/subpath/:query2\"\n\"http://websites.com/path/subpath/cc:query2/text/\"\n</code></pre>\n\n<p>In case there can be spaces in the last link, use just <code>.+?</code>:</p>\n\n<pre><code>^(?:https?://|.)*(https?://.+?)(?:\\?=|$)\n</code></pre>\n"}], "owner": {"reputation": 1698, "user_id": 3778742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad62c6ebfd4440c951edde151cb76714?s=128&d=identicon&r=PG&f=1", "display_name": "alexsmn", "link": "https://stackoverflow.com/users/3778742/alexsmn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 31842904, "answer_count": 1, "score": 2, "last_activity_date": 1438843887, "creation_date": 1438808160, "last_edit_date": 1495542591, "question_id": 31842666, "link": "https://stackoverflow.com/questions/31842666/write-regex-without-negations", "title": "Write regex without negations", "body": "<p>In a previous <a href=\"https://stackoverflow.com/questions/31832852/rewrite-regex-without-negation\">post</a> I've asked for some help on rewriting a regex without negation</p>\n\n<p>Starting regex:</p>\n\n<pre><code>https?:\\/\\/(?:.(?!https?:\\/\\/))+$\n</code></pre>\n\n<p>Ended up with:</p>\n\n<pre><code>https?:[^:]*$\n</code></pre>\n\n<p>This works fine but i've noticed that in case I will have <code>:</code> in my URL besides the <code>:</code> from http\\s it will not select.</p>\n\n<p>Here is a string which is not working:</p>\n\n<pre><code>sometextsometexhttp://websites.com/path/subpath/#query1sometexthttp://websites.com/path/subpath/:query2\n</code></pre>\n\n<p>You can notice the <code>:query2</code></p>\n\n<p>How can I modify the second regex listed here so it will select urls which contain <code>:</code>.</p>\n\n<p>Expected output:</p>\n\n<pre><code>http://websites.com/path/subpath/cc:query2\n</code></pre>\n\n<p>Also I would like to select everything till the first occurance of <code>?=param</code></p>\n\n<p>Input:\n   <code>sometextsometexhttp://websites.com/path/subpath/#query1sometexthttp://websites.com/path/subpath/cc:query2/text/?=param</code></p>\n\n<p>Output:</p>\n\n<p><code>http://websites.com/path/subpath/cc:query2/text/</code></p>\n"}, {"tags": ["go", "cryptography", "hmac"], "comments": [{"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1438793406, "post_id": 31838189, "comment_id": 51598379, "body": "You haven&#39;t shown us what this code must correspond to. How was the MAC created that you compare the result to?"}, {"owner": {"reputation": 105, "user_id": 4351140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/495033571f7143f953f6a3935ba86756?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian J", "link": "https://stackoverflow.com/users/4351140/sebastian-j"}, "reply_to_user": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1438793969, "post_id": 31838189, "comment_id": 51598727, "body": "I&#39;ve just been comparing it manually to using this in ruby:  <code>hash  = OpenSSL::HMAC.hexdigest(&quot;sha256&quot;, key, message)</code>"}, {"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1438794273, "post_id": 31838189, "comment_id": 51598914, "body": "OK, this is a simple hmac-sha256. Why do you additionally run MD5 on the &quot;key&quot; in your go code? Don&#39;t do that if you want hmac-sha256."}, {"owner": {"reputation": 105, "user_id": 4351140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/495033571f7143f953f6a3935ba86756?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian J", "link": "https://stackoverflow.com/users/4351140/sebastian-j"}, "reply_to_user": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1438794703, "post_id": 31838189, "comment_id": 51599158, "body": "I want to hash the secret before using it as the key. So I throw it through MD5 first."}, {"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1438794867, "post_id": 31838189, "comment_id": 51599235, "body": "OK, but then it can&#39;t match with the result of the code that you posted in the comments. Why do you expect the same results if you use different methods?"}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 4351140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/495033571f7143f953f6a3935ba86756?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian J", "link": "https://stackoverflow.com/users/4351140/sebastian-j"}, "edited": false, "score": 0, "creation_date": 1438794831, "post_id": 31838723, "comment_id": 51599228, "body": "But in the <a href=\"https://golang.org/pkg/crypto/hmac/#New\" rel=\"nofollow noreferrer\">godocs</a> it says that hmac.New takes a []byte key? What should I pass it?"}, {"owner": {"reputation": 105, "user_id": 4351140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/495033571f7143f953f6a3935ba86756?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian J", "link": "https://stackoverflow.com/users/4351140/sebastian-j"}, "edited": false, "score": 0, "creation_date": 1438795026, "post_id": 31838723, "comment_id": 51599331, "body": "So it should be: <code>key := hex.EncodeToString(secretHash.Sum(nil))</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 105, "user_id": 4351140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/495033571f7143f953f6a3935ba86756?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian J", "link": "https://stackoverflow.com/users/4351140/sebastian-j"}, "edited": false, "score": 1, "creation_date": 1438795443, "post_id": 31838723, "comment_id": 51599555, "body": "@SebastianJ: yes, if you want to match whatever the ruby code you&#39;re using does, that&#39;s one way to do it. Note that you&#39;re not gaining any entropy by hex-encoding the digest (you just make it longer with a smaller value range)"}, {"owner": {"reputation": 327, "user_id": 499845, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pIHEX.jpg?s=128&g=1", "display_name": "Sami Fouad", "link": "https://stackoverflow.com/users/499845/sami-fouad"}, "edited": false, "score": 0, "creation_date": 1617766701, "post_id": 31838723, "comment_id": 118394816, "body": "this is old, but import to note for Googlers.. in Go, []byte (or a slice of type byte) is how strings are represented. So they&#39;re interchangeable using the functions <code>string(slice-of-bytes-here)</code> or <code>[]byte(string-goes-here)</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 327, "user_id": 499845, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pIHEX.jpg?s=128&g=1", "display_name": "Sami Fouad", "link": "https://stackoverflow.com/users/499845/sami-fouad"}, "edited": false, "score": 0, "creation_date": 1617809110, "post_id": 31838723, "comment_id": 118411998, "body": "@SamiFoua: the types are not interchangeable, and strings are not represented by a byte slice, but they can be converted which is explained in the docs here <a href=\"https://golang.org/ref/spec#Conversions_to_and_from_a_string_type\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Conversions_to_and_from_a_string_type</a>"}, {"owner": {"reputation": 327, "user_id": 499845, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pIHEX.jpg?s=128&g=1", "display_name": "Sami Fouad", "link": "https://stackoverflow.com/users/499845/sami-fouad"}, "edited": false, "score": 0, "creation_date": 1617901687, "post_id": 31838723, "comment_id": 118445892, "body": "I&#39;m talking practical use. the process of converting them is what I mean by interchangeable. of course technically speaking, under the hood how Go implements them is another story. Better example of what I mean: <a href=\"https://play.golang.org/p/Jti97enncSf\" rel=\"nofollow noreferrer\">play.golang.org/p/Jti97enncSf</a>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 8, "last_activity_date": 1438795666, "last_edit_date": 1438795666, "creation_date": 1438794425, "answer_id": 31838723, "question_id": 31838189, "link": "https://stackoverflow.com/questions/31838189/create-hmac-256-from-a-string-in-golang/31838723#31838723", "title": "Create HMAC_256 from a string in Golang", "body": "<p>You're printing out the hex encoded version of your \"key\", but you're using the raw, unencoded bytes for that key.</p>\n\n<p>Your key in the example is printed as:</p>\n\n<pre><code>5ebe2294ecd0e0f08eab7690d2a6ee69\n</code></pre>\n\n<p>but you're giving this to the hmac:</p>\n\n<pre><code>[]byte{0x5e, 0xbe, 0x22, 0x94, 0xec, 0xd0, 0xe0, 0xf0, 0x8e, 0xab, 0x76, 0x90, 0xd2, 0xa6, 0xee, 0x69}\n</code></pre>\n\n<p>which as a string, looks like:</p>\n\n<pre><code>\"^\\xbe\"\\x94\\xec\\xd0\\xe0\\xf0\\x8e\\xabv\\x90\\xd2\\xa6\\xeei\"\n</code></pre>\n\n<p>Using the strings directly should show the difference: <a href=\"http://play.golang.org/p/wteqLNcnTV\" rel=\"noreferrer\">http://play.golang.org/p/wteqLNcnTV</a></p>\n\n<p>Which prints</p>\n\n<pre><code>3f0ee534c3d86cb16f4413fe1a76a12f94449f751f7d632cd87f24b94e76c710\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 4351140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/495033571f7143f953f6a3935ba86756?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian J", "link": "https://stackoverflow.com/users/4351140/sebastian-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11053, "favorite_count": 1, "accepted_answer_id": 31838723, "answer_count": 1, "score": 3, "last_activity_date": 1438795666, "creation_date": 1438792629, "question_id": 31838189, "link": "https://stackoverflow.com/questions/31838189/create-hmac-256-from-a-string-in-golang", "title": "Create HMAC_256 from a string in Golang", "body": "<p>I am trying to generate a HMAC 256 hash from a message and secret. However when I return it, it is not correct.</p>\n\n<pre><code>func makeSig(s Signature) string {\n    secretHash := md5.New()\n    secretHash.Write([]byte(\"secret\"))\n    key := secretHash.Sum(nil)\n    fmt.Println(\"The secret key is \", hex.EncodeToString(key))\n\n    message := strings.Join([]string{\"one\", \"two\", \"three\"}, \"\")\n    fmt.Println(\"The message is \", message)\n\n    sig := hmac.New(sha256.New, key)\n    sig.Write([]byte(message))\n    return hex.EncodeToString(sig.Sum(nil))\n}\n</code></pre>\n\n<p>I'm not sure what's wrong, please advise.</p>\n"}, {"tags": ["dictionary", "go"], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 7, "creation_date": 1438789769, "post_id": 31837148, "comment_id": 51595995, "body": "In Go they are <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">Slices</a>, not the same as <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"nofollow noreferrer\">Arrays</a>."}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": true, "score": 7, "last_activity_date": 1438790768, "last_edit_date": 1438790768, "creation_date": 1438789666, "answer_id": 31837148, "question_id": 31837011, "link": "https://stackoverflow.com/questions/31837011/what-is-the-difference-between-mapstringstring-and-mapstringstring/31837148#31837148", "title": "What is the difference between map[string][]string and map[string]string?", "body": "<p>They are different. One is a map of strings to a slice of strings, vs a map of strings to a single string</p>\n\n<p>The <code>[]</code> in <code>[]string</code> denotes a slice</p>\n\n<p><a href=\"http://play.golang.org/p/nv7wSWW0F7\" rel=\"noreferrer\">http://play.golang.org/p/nv7wSWW0F7</a></p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 1, "last_activity_date": 1438791222, "creation_date": 1438791222, "answer_id": 31837713, "question_id": 31837011, "link": "https://stackoverflow.com/questions/31837011/what-is-the-difference-between-mapstringstring-and-mapstringstring/31837713#31837713", "title": "What is the difference between map[string][]string and map[string]string?", "body": "<p>One is a map of string slices while the other is a map of strings. One structure has a single dimension, the <code>map[string][]string</code> has two. At every key <code>k</code> you'll have items <code>0-n</code> in the slice. So access requires another level of direction like <code>fmt.Println(myInts[k][0])</code> as apposed to <code>fmt.Println(myInts[k])</code>. Put data in it and the difference will be more apparent.</p>\n"}], "owner": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2091, "favorite_count": 0, "accepted_answer_id": 31837148, "answer_count": 2, "score": 0, "last_activity_date": 1438791222, "creation_date": 1438789292, "question_id": 31837011, "link": "https://stackoverflow.com/questions/31837011/what-is-the-difference-between-mapstringstring-and-mapstringstring", "title": "What is the difference between map[string][]string and map[string]string?", "body": "<p>I noticed in the <strong><a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow\">Go docs</a></strong> this definition was included:</p>\n\n<pre><code>type Values map[string][]string\n</code></pre>\n\n<p>I thought it was a mistake, but then I tried this code and it compiles (<kbd><a href=\"http://play.golang.org/\" rel=\"nofollow\">Playground</a></kbd>):</p>\n\n<p>package main</p>\n\n<pre><code>import \"fmt\"\n\nfunc main() {\n    type MyType map[string][]string\n\n    foobar := make(MyType)\n\n    fmt.Println(foobar)\n}\n</code></pre>\n\n<p>Is it functionally equivalent to <code>map[string]string</code>, or is there some difference?</p>\n"}, {"tags": ["dictionary", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 1519, "user_id": 506016, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b2ef6443a54b6be94a1c522b67b661a?s=128&d=identicon&r=PG&f=1", "display_name": "MondayPaper", "link": "https://stackoverflow.com/users/506016/mondaypaper"}, "edited": false, "score": 0, "creation_date": 1438788079, "post_id": 31836467, "comment_id": 51594905, "body": "This sounds like the right approach to me. I&#39;ll look into creating an iterator, then mark this right if I can get the functionality that I want."}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "reply_to_user": {"reputation": 1519, "user_id": 506016, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b2ef6443a54b6be94a1c522b67b661a?s=128&d=identicon&r=PG&f=1", "display_name": "MondayPaper", "link": "https://stackoverflow.com/users/506016/mondaypaper"}, "edited": false, "score": 2, "creation_date": 1438788196, "post_id": 31836467, "comment_id": 51594981, "body": "You may be interested in that blog post, that shows a nice exploration of various approaches to implement iterators in Go : <a href=\"http://ewencp.org/blog/golang-iterators/\" rel=\"nofollow noreferrer\">ewencp.org/blog/golang-iterators</a>"}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "reply_to_user": {"reputation": 1519, "user_id": 506016, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b2ef6443a54b6be94a1c522b67b661a?s=128&d=identicon&r=PG&f=1", "display_name": "MondayPaper", "link": "https://stackoverflow.com/users/506016/mondaypaper"}, "edited": false, "score": 0, "creation_date": 1438788603, "post_id": 31836467, "comment_id": 51595250, "body": "(given that you&#39;re working on a map, and keeping performance considerations in mind, you may want to stick to &quot;pattern 1&quot; with callbacks)"}, {"owner": {"reputation": 1519, "user_id": 506016, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b2ef6443a54b6be94a1c522b67b661a?s=128&d=identicon&r=PG&f=1", "display_name": "MondayPaper", "link": "https://stackoverflow.com/users/506016/mondaypaper"}, "edited": false, "score": 0, "creation_date": 1438806881, "post_id": 31836467, "comment_id": 51606077, "body": "Thanks, great article. Exactly what I needed to know."}], "tags": [], "owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "is_accepted": true, "score": 1, "last_activity_date": 1438787830, "creation_date": 1438787830, "answer_id": 31836467, "question_id": 31836382, "link": "https://stackoverflow.com/questions/31836382/what-is-the-best-practice-for-using-private-maps-slices-in-golang/31836467#31836467", "title": "What is the best practice for using private Maps, Slices in golang?", "body": "<p>Then you could have private data and a public iterator that returns a copy of the next key/value pair upon each call, no ?</p>\n\n<p>Iterators are less present in Go than in languages that don't have built-in constructs married to particular data-structures. Nevertheless they're as easy to make as anywhere else, and pretty much as easy to use, save for the fact that there's no language syntax to range an iterator. For example, <code>bufio.Scanner</code> is just an iterator with a bit of convenience cruft grafted on...</p>\n"}, {"tags": [], "owner": {"reputation": 15557, "user_id": 390807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f64fce01ffa86130c3fae06b1fcadef?s=128&d=identicon&r=PG", "display_name": "chill", "link": "https://stackoverflow.com/users/390807/chill"}, "is_accepted": false, "score": 1, "last_activity_date": 1438788364, "creation_date": 1438788364, "answer_id": 31836653, "question_id": 31836382, "link": "https://stackoverflow.com/questions/31836382/what-is-the-best-practice-for-using-private-maps-slices-in-golang/31836653#31836653", "title": "What is the best practice for using private Maps, Slices in golang?", "body": "<p>You could easily expose iteration over private data with closures.\nIf you want to disable modification, just don't pass the map parameter, but only keys and values, or only keys or only values, whatever are your needs.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype M map[string]int\n\ntype S struct {\n    m M\n}\n\nfunc (s *S) Foreach(fn func(M, string, int)) {\n    for k, v := range s.m {\n        fn(s.m, k, v)\n    }\n}\n\nfunc main() {\n    s := S{m: make(M)}\n    s.m[\"xxx\"] = 12\n    s.m[\"yyy\"] = 254\n    s.m[\"zzz\"] = 138\n\n    s.Foreach(func(m M, k string, v int) {\n        fmt.Println(k, v)\n        m[k] = v + 1\n    })\n\n    s.Foreach(func(m M, k string, v int) {\n        fmt.Println(k, v)\n        m[k] = v + 1\n    })\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 0, "creation_date": 1438795580, "post_id": 31836996, "comment_id": 51599626, "body": "Supposing the map is small enough, and the function does not get called often... The advantage of your approach though is atomicity. The caller does not need to worry about the map changing while he&#39;s iterating it indeed."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1474416833, "last_edit_date": 1474416833, "creation_date": 1438789259, "answer_id": 31836996, "question_id": 31836382, "link": "https://stackoverflow.com/questions/31836382/what-is-the-best-practice-for-using-private-maps-slices-in-golang/31836996#31836996", "title": "What is the best practice for using private Maps, Slices in golang?", "body": "<p>It may just be better to return a clone of the map (not the map value but everything). Same goes for slices.</p>\n\n<p>Note that maps and slices are descriptors. If you return a map value, it will refer to the same underlying data structures. See blog post <a href=\"http://blog.golang.org/go-maps-in-action\" rel=\"nofollow\">Go maps in action</a> for details.</p>\n\n<p>Create a new map, copy the elements and return the new map. Then you don't have to worry about who modifies it.</p>\n\n<p>For making a clone of the map:</p>\n\n<pre><code>func Clone(m map[string]Money) map[string]Money {\n    m2 := make(map[string]Money, len(m))\n\n    for k, v := range m {\n        m2[k] = v\n    }\n    return m2\n}\n</code></pre>\n\n<p>Testing the <code>Clone()</code> function (try it on the <a href=\"http://play.golang.org/p/a05sApe9sS\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>m := map[string]Money{\"one\": 1, \"two\": 2}\nm2 := Clone(m)\nm2[\"one\"] = 11\nm2[\"three\"] = 3\nfmt.Println(m) // Prints \"map[one:1 two:2]\", not effected by changes to m2\n</code></pre>\n\n<p>And so your <code>GetMailbox()</code> method:</p>\n\n<pre><code>func (a Account) GetMailbox() map[string]Money{\n    return Clone(a.mailbox)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1438838509, "creation_date": 1438838509, "answer_id": 31847403, "question_id": 31836382, "link": "https://stackoverflow.com/questions/31836382/what-is-the-best-practice-for-using-private-maps-slices-in-golang/31847403#31847403", "title": "What is the best practice for using private Maps, Slices in golang?", "body": "<p>One of the \"recommended\" ways would be to <em>document</em> that users of Mailbox must not modify the map (possibly even exporting it).</p>\n\n<p>Other languages promote coding like \"If I just make most things private and const than users of my code won't be able to miss-use my code and all is fine\". I always understood the Go philosophy to be more like \"If a user of my code doesn't read my documentation or is willingly not sticking to it his code will break anyway, even if I encapsulate everything.\"</p>\n\n<p>E.g. in Go (as in C, Java, etc.) there is no way to indicate that some code is (or is not) safe for concurrent use: Such stuff is documentation only. There is nothing which technically prevents a user from concurrently calling unsafe-for-concurrent-use methods or functions <em>except</em> the documentation.</p>\n\n<p>You will find several instances of this type of \"Users must not copy/modify/whatever this field at all/after x/etc.\" ind the std library.</p>\n"}], "owner": {"reputation": 1519, "user_id": 506016, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b2ef6443a54b6be94a1c522b67b661a?s=128&d=identicon&r=PG&f=1", "display_name": "MondayPaper", "link": "https://stackoverflow.com/users/506016/mondaypaper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1105, "favorite_count": 1, "accepted_answer_id": 31836467, "answer_count": 4, "score": 4, "last_activity_date": 1536935248, "creation_date": 1438787576, "last_edit_date": 1536935248, "question_id": 31836382, "link": "https://stackoverflow.com/questions/31836382/what-is-the-best-practice-for-using-private-maps-slices-in-golang", "title": "What is the best practice for using private Maps, Slices in golang?", "body": "<p>I would like to be notified when a map is updated so that I can recalculate the Total. My first thought was to keep the map private, and expose an add method. This works, but then I needed to be able to allow the map to be read and iterated over (Basically, read only or a copy of the map). What I found was that a copy of the map is sent, but the underlying array, or data is the same and actually gets updated by anyone who uses the \"getter\".</p>\n\n<pre><code>type Account struct{\n        Name string\n        total Money\n        mailbox map[string]Money // I want to make this private but it seems impossible to give read only access - and a public Add method\n}\nfunc (a *Account) GetMailbox() map[string]Money{ //people should be able to view this map, but I need to be notified when they edit it.\n        return a.mailbox\n}\nfunc (a *Account) UpdateEnvelope(s string, m Money){\n        a.mailbox[s] = m\n        a.updateTotal()\n}...\n</code></pre>\n\n<p>Is there a recommended way of doing this in Go?</p>\n"}, {"tags": ["go", "bosun"], "answers": [{"comments": [{"owner": {"reputation": 1661, "user_id": 823386, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/aefdc75fa22c3c7bd1e6d7d93f843801?s=128&d=identicon&r=PG", "display_name": "sbose", "link": "https://stackoverflow.com/users/823386/sbose"}, "edited": false, "score": 0, "creation_date": 1438797702, "post_id": 31835354, "comment_id": 51600804, "body": "Thanks Kyle. How do we specify that a directory is an external collecters&#39; directory ? I&#39;m running a docker container."}, {"owner": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "reply_to_user": {"reputation": 1661, "user_id": 823386, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/aefdc75fa22c3c7bd1e6d7d93f843801?s=128&d=identicon&r=PG", "display_name": "sbose", "link": "https://stackoverflow.com/users/823386/sbose"}, "edited": false, "score": 0, "creation_date": 1438798621, "post_id": 31835354, "comment_id": 51601353, "body": "@sbose ColDir the the .toml configuration file, it is in the documentation I linked. I don&#39;t ever use the docker image, so not sure how to get that in there."}, {"owner": {"reputation": 1661, "user_id": 823386, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/aefdc75fa22c3c7bd1e6d7d93f843801?s=128&d=identicon&r=PG", "display_name": "sbose", "link": "https://stackoverflow.com/users/823386/sbose"}, "edited": false, "score": 0, "creation_date": 1438838652, "post_id": 31835354, "comment_id": 51615675, "body": "OK, added a basic external collector which prints timestamps and random numbers. <a href=\"https://gist.github.com/sbose78/4be0a77fd7e950dec3a6\" rel=\"nofollow noreferrer\">gist.github.com/sbose78/4be0a77fd7e950dec3a6</a>  However I do not see the metric in the ITEMS page. :("}, {"owner": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "reply_to_user": {"reputation": 1661, "user_id": 823386, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/aefdc75fa22c3c7bd1e6d7d93f843801?s=128&d=identicon&r=PG", "display_name": "sbose", "link": "https://stackoverflow.com/users/823386/sbose"}, "edited": false, "score": 0, "creation_date": 1438839129, "post_id": 31835354, "comment_id": 51615814, "body": "OpenTSDB spec requires at least one tag value pair as per it&#39;s specification"}, {"owner": {"reputation": 1661, "user_id": 823386, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/aefdc75fa22c3c7bd1e6d7d93f843801?s=128&d=identicon&r=PG", "display_name": "sbose", "link": "https://stackoverflow.com/users/823386/sbose"}, "edited": false, "score": 0, "creation_date": 1438839433, "post_id": 31835354, "comment_id": 51615932, "body": "Thanks, here it said they were optional ( <a href=\"http://godoc.org/bosun.org/cmd/scollector#hdr-External_Collectors\" rel=\"nofollow noreferrer\">godoc.org/bosun.org/cmd/scollector#hdr-External_Collectors</a> ). Anyway I added a random tag <a href=\"https://gist.github.com/sbose78/4be0a77fd7e950dec3a6\" rel=\"nofollow noreferrer\">gist.github.com/sbose78/4be0a77fd7e950dec3a6</a> :) but Still the metric doesn&#39;t turn up in the &quot;ITEMS&quot;. Also, /var/logsyslog doesnt say anything."}, {"owner": {"reputation": 1661, "user_id": 823386, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/aefdc75fa22c3c7bd1e6d7d93f843801?s=128&d=identicon&r=PG", "display_name": "sbose", "link": "https://stackoverflow.com/users/823386/sbose"}, "edited": false, "score": 0, "creation_date": 1438841566, "post_id": 31835354, "comment_id": 51616848, "body": "Worked - the trick was to run a new scollector instance with the relevant parameters."}], "tags": [], "owner": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "is_accepted": false, "score": 7, "last_activity_date": 1438784844, "creation_date": 1438784844, "answer_id": 31835354, "question_id": 31834586, "link": "https://stackoverflow.com/questions/31834586/bosun-adding-external-collectors/31835354#31835354", "title": "Bosun adding external collectors", "body": "<p>The documentation around this is not quite up to date. You can do it as described in <a href=\"http://godoc.org/bosun.org/cmd/scollector#hdr-External_Collectors\" rel=\"noreferrer\">http://godoc.org/bosun.org/cmd/scollector#hdr-External_Collectors</a> , but we also support JSON output which is better. </p>\n\n<p>Either way, you write something and put it in the external collectors directory, followed by a frequency directory, and then an <em>executable</em> script or binary. Something like:</p>\n\n<p><code>&lt;external_collectors_dir&gt;/&lt;freq_sec&gt;/foo.sh</code>.</p>\n\n<p>If the directory frequency is zero <code>0</code>, then the the script is expected to be continuously running, and you put a sleep inside the code (This is my preferred method for external collectors). The scripts outputs the telnet format, or the undocumented JSON format to stdout. Scollector picks it up, and queues that information for sending.</p>\n\n<p>I created an issue to get this documented not long ago <a href=\"https://github.com/bosun-monitor/bosun/issues/1225\" rel=\"noreferrer\">https://github.com/bosun-monitor/bosun/issues/1225</a>. Until one of us gets around to that, here is the PR that added JSON <a href=\"https://github.com/bosun-monitor/bosun/commit/fced1642fd260bf6afa8cba169d84c60f2e23e92\" rel=\"noreferrer\">https://github.com/bosun-monitor/bosun/commit/fced1642fd260bf6afa8cba169d84c60f2e23e92</a> </p>\n"}, {"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 2, "last_activity_date": 1438792482, "last_edit_date": 1438792482, "creation_date": 1438789400, "answer_id": 31837055, "question_id": 31834586, "link": "https://stackoverflow.com/questions/31834586/bosun-adding-external-collectors/31837055#31837055", "title": "Bosun adding external collectors", "body": "<p>Adding to what Kyle said, you can take a look at some existing external collectors to see what they output. <a href=\"https://github.com/PeterGrace/bosun-jmx/blob/master/src/me/vsix/JMXGet.java#L85\" rel=\"nofollow\">here</a> is one written in java that one of our colleagues wrote to monitor jvm stuff. It uses the text format, which is simply:</p>\n\n<pre><code>metricname timestamp value tag1=foo tag2=bar\n</code></pre>\n\n<p>If you want to use the JSON format, here is an example from one of our collectors:</p>\n\n<p><code>{\"metric\":\"exceptional.exceptions.count\",\"timestamp\":1438788720,\"value\":0,\"tags\":{\"application\":\"AdServer\",\"machine\":\"ny-web03\",\"source\":\"NY_Status\"}}</code></p>\n\n<p>And you can also send metadata:</p>\n\n<pre><code>{\"Metric\":\"exceptional.exceptions.count\",\"Name\":\"rate\",\"Value\":\"counter\"}\n{\"Metric\":\"exceptional.exceptions.count\",\"Name\":\"unit\",\"Value\":\"errors\"}\n{\"Metric\":\"exceptional.exceptions.count\",\"Name\":\"desc\",\"Value\":\"The number of exceptions thrown per second by applications and machines. Data is queried from multiple sources. See status instances for details on exceptions.\"}`\n</code></pre>\n\n<p>Or send error messages to stderror:</p>\n\n<pre><code>2015/08/05 15:32:00 lookup OR-SQL03: no such host\n</code></pre>\n"}], "owner": {"reputation": 348, "user_id": 2297947, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/befc767c1f47c0daa2fcb0ea4ff0d3b1?s=128&d=identicon&r=PG", "display_name": "Sandesh", "link": "https://stackoverflow.com/users/2297947/sandesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1438792482, "creation_date": 1438782931, "question_id": 31834586, "link": "https://stackoverflow.com/questions/31834586/bosun-adding-external-collectors", "title": "Bosun adding external collectors", "body": "<p>What is the procedure to define new external collectors in bosun using scollector.<br>\nCan we write python or shell scripts to collect data?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "is_accepted": true, "score": 7, "last_activity_date": 1439207706, "last_edit_date": 1439207706, "creation_date": 1438783429, "answer_id": 31834792, "question_id": 31834437, "link": "https://stackoverflow.com/questions/31834437/go-select-statement/31834792#31834792", "title": "Go select statement", "body": "<p>In second case you are getting the value form the channel two times. Every time you do something like &lt;-channel you pop one value out of channel.</p>\n\n<p>Hence program is waiting indefinitely on line</p>\n\n<pre><code>fmt.Println(&lt;-quit)\n</code></pre>\n\n<p>but fortunately go is intelligent enough to detect this situation and panic with error \"<strong>all goroutines are asleep - deadlock!</strong>\"</p>\n"}, {"tags": [], "owner": {"reputation": 13181, "user_id": 712997, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c5ad6f27f1e7160f6fdb9618e333caa9?s=128&d=identicon&r=PG", "display_name": "lollercoaster", "link": "https://stackoverflow.com/users/712997/lollercoaster"}, "is_accepted": false, "score": 3, "last_activity_date": 1438783463, "creation_date": 1438783463, "answer_id": 31834814, "question_id": 31834437, "link": "https://stackoverflow.com/questions/31834437/go-select-statement/31834814#31834814", "title": "Go select statement", "body": "<p>The line</p>\n\n<pre><code>fmt.Println(&lt;-quit)\n</code></pre>\n\n<p>is waiting for another value on the channel, which will never come, according to the code you have. </p>\n\n<p>You have to keep in mind the line before in the select:</p>\n\n<pre><code>case s := &lt;-quit\n</code></pre>\n\n<p>has already removed the quit value from the channel. </p>\n\n<p>Thus it will never complete. </p>\n"}], "owner": {"reputation": 977, "user_id": 1419809, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0Plto.jpg?s=128&g=1", "display_name": "Pauli", "link": "https://stackoverflow.com/users/1419809/pauli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 31834792, "answer_count": 2, "score": 2, "last_activity_date": 1439207706, "creation_date": 1438782489, "last_edit_date": 1438783558, "question_id": 31834437, "link": "https://stackoverflow.com/questions/31834437/go-select-statement", "title": "Go select statement", "body": "<p>A short program about <code>select</code> statement for channels.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc fibonacci(c, quit chan int) {\n    x, y := 0, 1\n    for {\n        select {\n        case c &lt;- x:\n            x, y = y, x+y\n        case s := &lt;-quit:\n            fmt.Println(\"quit =\",s)\n            return\n        }\n    }\n}\n\nfunc main() {\n    c := make(chan int)\n    quit := make(chan int)\n    go func() {\n        for i := 0; i &lt; 10; i++ {\n            fmt.Println(&lt;-c)\n        }\n        quit &lt;- 9\n    }()\n    fibonacci(c, quit)\n}\n</code></pre>\n\n<p>The result of the code above:</p>\n\n<pre><code>0\n1\n1\n2\n3\n5\n8\n13\n21\n34\nquit = 9\n</code></pre>\n\n<p>It worked fine. But after I changed (in <code>func fibonacci</code>)</p>\n\n<pre><code>case s := &lt;-quit:\n    fmt.Println(\"quit =\",s)\n</code></pre>\n\n<p>to</p>\n\n<pre><code>case &lt;-quit:\n    fmt.Println(&lt;-quit)\n</code></pre>\n\n<p>an fatal error occurred:</p>\n\n<pre><code>0\n1\n1\n2\n3\n5\n8\n13\n21\n34\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan receive]:\nmain.fibonacci(0x18348040, 0x18348080)\n    /tmp/compile42.go:12 +0xf9\nmain.main()\n    /tmp/compile42.go:27 +0x11c\n</code></pre>\n\n<p>Where does the error come from?</p>\n"}, {"tags": ["regex", "go", "regex-negation"], "answers": [{"comments": [{"owner": {"reputation": 1698, "user_id": 3778742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad62c6ebfd4440c951edde151cb76714?s=128&d=identicon&r=PG&f=1", "display_name": "alexsmn", "link": "https://stackoverflow.com/users/3778742/alexsmn"}, "edited": false, "score": 0, "creation_date": 1438788188, "post_id": 31832899, "comment_id": 51594975, "body": "Thx for that, do you have any idea on how can I modify that regex so I can get the same selection, but until it finds &amp;type=, or until the end if &amp;type= not exists?"}, {"owner": {"reputation": 1698, "user_id": 3778742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad62c6ebfd4440c951edde151cb76714?s=128&d=identicon&r=PG&f=1", "display_name": "alexsmn", "link": "https://stackoverflow.com/users/3778742/alexsmn"}, "edited": false, "score": 0, "creation_date": 1438789473, "post_id": 31832899, "comment_id": 51595816, "body": "The regex will not work if the URL has <code>:</code> <code>http:&#47;&#47;websites.com&#47;path&#47;subpath&#47;?q=tsid:51</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4227915"}, "reply_to_user": {"reputation": 1698, "user_id": 3778742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad62c6ebfd4440c951edde151cb76714?s=128&d=identicon&r=PG&f=1", "display_name": "alexsmn", "link": "https://stackoverflow.com/users/3778742/alexsmn"}, "edited": false, "score": 0, "creation_date": 1438793226, "post_id": 31832899, "comment_id": 51598258, "body": "@alexsmn. Sorry, without using negation, this is the far I can get. Maybe some high-level user could help with those points."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user4227915"}, "is_accepted": true, "score": 3, "last_activity_date": 1438779281, "last_edit_date": 1438779281, "creation_date": 1438778596, "answer_id": 31832899, "question_id": 31832852, "link": "https://stackoverflow.com/questions/31832852/rewrite-regex-without-negation/31832899#31832899", "title": "Rewrite regex without negation", "body": "<p>Try this regex:</p>\n\n<pre><code>https?:[^:]*$\n</code></pre>\n\n<p><a href=\"https://regex101.com/r/dZ8wU9/2\" rel=\"nofollow\">Regex live here.</a></p>\n"}, {"tags": [], "owner": {"reputation": 33085, "user_id": 2423164, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Nxbnp.jpg?s=128&g=1", "display_name": "ndnenkov", "link": "https://stackoverflow.com/users/2423164/ndnenkov"}, "is_accepted": false, "score": 2, "last_activity_date": 1438781235, "last_edit_date": 1438781235, "creation_date": 1438780171, "answer_id": 31833520, "question_id": 31832852, "link": "https://stackoverflow.com/questions/31832852/rewrite-regex-without-negation/31833520#31833520", "title": "Rewrite regex without negation", "body": "<p>The lookaheads exist for a reason.</p>\n\n<p>However, if you insist on a supposedly equivalent alternative, a general strategy you can use is:</p>\n\n<pre><code>(?!xyz)\n</code></pre>\n\n<p>is somewhat equivalent to:</p>\n\n<pre><code>$|[^x]|x(?:[^y]|$)|xy(?:[^z]|$)\n</code></pre>\n\n<p>With that said, hopefully I didn't make any mistakes:</p>\n\n<pre><code>https?:\\/\\/(?:$|(?:[^h]|$)|(?:h(?:[^t]|$))|(?:ht(?:[^t]|$))|(?:htt(?:[^p]|$))|(?:http(?:[^s:]|$))|(?:https?(?:[^:]|$))|(?:https?:(?:[^\\/]|$))|(?:https?:\\/(?:[^\\/]|$)))*$\n</code></pre>\n"}], "owner": {"reputation": 1698, "user_id": 3778742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad62c6ebfd4440c951edde151cb76714?s=128&d=identicon&r=PG&f=1", "display_name": "alexsmn", "link": "https://stackoverflow.com/users/3778742/alexsmn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 1, "accepted_answer_id": 31832899, "answer_count": 2, "score": 2, "last_activity_date": 1438781235, "creation_date": 1438778458, "last_edit_date": 1438781099, "question_id": 31832852, "link": "https://stackoverflow.com/questions/31832852/rewrite-regex-without-negation", "title": "Rewrite regex without negation", "body": "<p>I have wrote this regex to help me extract some links from some text files:</p>\n\n<p><code>https?:\\/\\/(?:.(?!https?:\\/\\/))+$</code></p>\n\n<p>Because I am using golang/regexp lib, I'm not able to use it, due to my negation <code>(?!..</code></p>\n\n<p>What I would like to do with it, is to select all the text from the last occurance of http/https till the end.</p>\n\n<pre><code>sometextsometexhttp://websites.com/path/subpath/#query1sometexthttp://websites.com/path/subpath/#query2\n</code></pre>\n\n<p>=> Output: <a href=\"http://websites.com/path/subpath/#query2\" rel=\"nofollow\">http://websites.com/path/subpath/#query2</a></p>\n\n<p>Can anyone help me with a solution, I've spent several hours trying different ways of reproducing the same result with no success.</p>\n"}, {"tags": ["go", "error-handling", "io"], "comments": [{"owner": {"reputation": 27292, "user_id": 100208, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e2fda105627061de42901c671680638b?s=128&d=identicon&r=PG&f=1", "display_name": "atp", "link": "https://stackoverflow.com/users/100208/atp"}, "edited": false, "score": 0, "creation_date": 1438777746, "post_id": 31832335, "comment_id": 51586966, "body": "Can you add examples of a response Body that triggers this, and the error message you get?"}, {"owner": {"reputation": 7023, "user_id": 790075, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fdb8ce54c398b1aa794833a601507361?s=128&d=identicon&r=PG", "display_name": "turtlemonvh", "link": "https://stackoverflow.com/users/790075/turtlemonvh"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1438778693, "post_id": 31832335, "comment_id": 51587687, "body": "@BravadaZadada I don&#39;t think so, but I could be missing something. <code>err</code> is reused again in code that follows, but by that time the data is already on disk (copy has finished) and the files are missing characters. Also, in both cases <code>io.Copy</code> works without returning an error."}, {"owner": {"reputation": 7023, "user_id": 790075, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fdb8ce54c398b1aa794833a601507361?s=128&d=identicon&r=PG", "display_name": "turtlemonvh", "link": "https://stackoverflow.com/users/790075/turtlemonvh"}, "reply_to_user": {"reputation": 27292, "user_id": 100208, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e2fda105627061de42901c671680638b?s=128&d=identicon&r=PG&f=1", "display_name": "atp", "link": "https://stackoverflow.com/users/100208/atp"}, "edited": false, "score": 0, "creation_date": 1438778732, "post_id": 31832335, "comment_id": 51587718, "body": "@ash I added more details - pls let me know if anything else would be helpful!"}, {"owner": {"reputation": 618, "user_id": 2240627, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/834d4b4d06d7e64e8c2343aa91a0e8b2?s=128&d=identicon&r=PG", "display_name": "Ian Rose", "link": "https://stackoverflow.com/users/2240627/ian-rose"}, "edited": false, "score": 0, "creation_date": 1438781841, "post_id": 31832335, "comment_id": 51590160, "body": "Yeah that doesn&#39;t make much sense.  I think you&#39;ll have to provide the entire server handler."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1438783836, "post_id": 31832335, "comment_id": 51591712, "body": "Most likely your problem has nothing to do with &quot;combined if vs if on extra line&quot;. Maybe it is a race condition which is triggered by the subtle timing difference between the two code snippets? Make sure everything else in your code is okay, especially non-racy: Racy programs have no defined behavior."}, {"owner": {"reputation": 7023, "user_id": 790075, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fdb8ce54c398b1aa794833a601507361?s=128&d=identicon&r=PG", "display_name": "turtlemonvh", "link": "https://stackoverflow.com/users/790075/turtlemonvh"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1438787535, "post_id": 31832335, "comment_id": 51594479, "body": "Thanks everyone.  It does look like a race condition now. The small timing difference that @Volker mentioned was enough to trigger the problem reliably before, but now that I changed some other stuff I&#39;m seeing both good and bad responses with both versions of the code.  I&#39;ll add an answer with a more thorough response once I&#39;m able to track down the bug."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1438805519, "post_id": 31832335, "comment_id": 51605362, "body": "To help you identify the source of your race you can use <a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">Go&#39;s race detector</a> by adding <code>-race</code> to your go test/build/install command line. To help the race detector you should amke sure to run with <a href=\"https://golang.org/pkg/runtime/#GOMAXPROCS\" rel=\"nofollow noreferrer\"><code>GOMAXPROCS</code></a> &gt; 1 and if using <code>go test</code> you should have some concurrent tests."}, {"owner": {"reputation": 7023, "user_id": 790075, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fdb8ce54c398b1aa794833a601507361?s=128&d=identicon&r=PG", "display_name": "turtlemonvh", "link": "https://stackoverflow.com/users/790075/turtlemonvh"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438808566, "post_id": 31832335, "comment_id": 51607057, "body": "Thanks @DaveC - I gave the race detector a try but nothing was detected in either version of the code."}], "answers": [{"comments": [{"owner": {"reputation": 7023, "user_id": 790075, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fdb8ce54c398b1aa794833a601507361?s=128&d=identicon&r=PG", "display_name": "turtlemonvh", "link": "https://stackoverflow.com/users/790075/turtlemonvh"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1438968779, "post_id": 31842735, "comment_id": 51684532, "body": "@BravadaZadada If I had an idea of where the problem in the code may be coming from, I would.  But I didn&#39;t want to just paste a few hundred lines of messy go code."}], "tags": [], "owner": {"reputation": 7023, "user_id": 790075, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fdb8ce54c398b1aa794833a601507361?s=128&d=identicon&r=PG", "display_name": "turtlemonvh", "link": "https://stackoverflow.com/users/790075/turtlemonvh"}, "is_accepted": true, "score": 0, "last_activity_date": 1438808447, "creation_date": 1438808447, "answer_id": 31842735, "question_id": 31832335, "link": "https://stackoverflow.com/questions/31832335/consistent-off-by-one-errors-in-go-io-copy-function-for-large-content/31842735#31842735", "title": "Consistent off by one errors in go io.copy function for large content", "body": "<p>It turned out the issue was at least partially the result of a race condition.</p>\n\n<p>I was not calling <code>.Close()</code> on the file <code>out</code> before exiting the function.  After adding that I have not been any more issues.</p>\n\n<p>Why exactly this was causing <strong>just the last byte</strong> of the file to get dropped sometimes is a mystery to me.</p>\n"}], "owner": {"reputation": 7023, "user_id": 790075, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fdb8ce54c398b1aa794833a601507361?s=128&d=identicon&r=PG", "display_name": "turtlemonvh", "link": "https://stackoverflow.com/users/790075/turtlemonvh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 31842735, "answer_count": 1, "score": -1, "last_activity_date": 1438808447, "creation_date": 1438777135, "last_edit_date": 1438778370, "question_id": 31832335, "link": "https://stackoverflow.com/questions/31832335/consistent-off-by-one-errors-in-go-io-copy-function-for-large-content", "title": "Consistent off by one errors in go io.copy function for large content", "body": "<p>This one works consistently.</p>\n\n<pre><code>    _, err = io.Copy(out, resp.Body)\n    if err != nil {\n        ErrLog.Fatal(err)\n    }\n</code></pre>\n\n<p>This one gives pretty consistent off by one errors (the last byte of the downloaded content is left off, in my case a closing <code>]</code> in a json response) for large-ish responses (MBs).</p>\n\n<pre><code>    if _, err := io.Copy(out, resp.Body); err != nil {\n        ErrLog.Fatal(err)\n    }\n</code></pre>\n\n<p>From <a href=\"http://blog.golang.org/error-handling-and-go\" rel=\"nofollow\">the examples on the official golang blog</a>, it looks like this <em>should</em> be valid syntax.</p>\n\n<h2>Edit: Some more details and context</h2>\n\n<p>This is the error I get with the 2nd version of the code (more compact error handling)</p>\n\n<pre><code>ERROR: 2015/08/05 08:09:31 pull.go:257: unexpected end of JSON input\n</code></pre>\n\n<p>From this code in another function</p>\n\n<pre><code>err = json.Unmarshal(dat, &amp;all_data)\nif err != nil {\n    return err\n}\n</code></pre>\n\n<p>I found the off by one issue by looking at the first 10 and last 10 characters of the file in each case.  Here are the before and afters:</p>\n\n<pre><code># Before (with error)\nSTART:  [{\"tags\":[              END:    ersion\":1}\nSTART:  [{\"_create              END:    \"tags\":[]}\n\n# After\nSTART:  [{\"tags\":[              END:    rsion\":1}]\nSTART:  [{\"_create              END:    tags\":[]}]\n</code></pre>\n\n<p>The files are 15-20 Mb json strings.</p>\n"}, {"tags": ["hadoop", "go"], "answers": [{"comments": [{"owner": {"reputation": 146, "user_id": 2618558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80ed3bdd48945e8a8e74617573a54488?s=128&d=identicon&r=PG", "display_name": "frigo americain", "link": "https://stackoverflow.com/users/2618558/frigo-americain"}, "edited": false, "score": 0, "creation_date": 1450174661, "post_id": 34152799, "comment_id": 56314393, "body": "Where is the link with Hadoop?"}], "tags": [], "owner": {"reputation": 441, "user_id": 5252482, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/6la8h.jpg?s=128&g=1", "display_name": "Murali Manohar", "link": "https://stackoverflow.com/users/5252482/murali-manohar"}, "is_accepted": false, "score": 0, "last_activity_date": 1449568455, "creation_date": 1449568455, "answer_id": 34152799, "question_id": 31832266, "link": "https://stackoverflow.com/questions/31832266/how-to-write-map-reduce-tasks-in-golang/34152799#34152799", "title": "How to write Map/Reduce tasks in Golang?", "body": "<p>here's a simple implementation of Map/Reduce written in Golang (available at github):</p>\n\n<p><a href=\"https://github.com/dbravender/go_mapreduce\" rel=\"nofollow\">https://github.com/dbravender/go_mapreduce</a></p>\n"}, {"comments": [{"owner": {"reputation": 146, "user_id": 2618558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80ed3bdd48945e8a8e74617573a54488?s=128&d=identicon&r=PG", "display_name": "frigo americain", "link": "https://stackoverflow.com/users/2618558/frigo-americain"}, "edited": false, "score": 1, "creation_date": 1494309281, "post_id": 43787682, "comment_id": 74759437, "body": "Thanks Eric for your contribution! But your code is using the Hadoop Streaming API and I stated that i was not interested with it."}], "tags": [], "owner": {"reputation": 39, "user_id": 2429749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1bee1ace1d6100292f3d94a646e402a?s=128&d=identicon&r=PG", "display_name": "Simon Kesteloot", "link": "https://stackoverflow.com/users/2429749/simon-kesteloot"}, "is_accepted": false, "score": 2, "last_activity_date": 1493948340, "last_edit_date": 1493948340, "creation_date": 1493913336, "answer_id": 43787682, "question_id": 31832266, "link": "https://stackoverflow.com/questions/31832266/how-to-write-map-reduce-tasks-in-golang/43787682#43787682", "title": "How to write Map/Reduce tasks in Golang?", "body": "<p>This github: <a href=\"https://github.com/vistarmedia/gossamr\" rel=\"nofollow noreferrer\">https://github.com/vistarmedia/gossamr</a> is a good example for starting to use a golang job on Hadoop:</p>\n\n<p>Jist:</p>\n\n<pre><code>package main\n\nimport (\n  \"log\"\n  \"strings\"\n\n  \"github.com/vistarmedia/gossamr\"\n)\n\ntype WordCount struct{}\n\nfunc (wc *WordCount) Map(p int64, line string, c gossamr.Collector) error {\n  for _, word := range strings.Fields(line) {\n    c.Collect(strings.ToLower(word), int64(1))\n  }\n  return nil\n}\n\nfunc (wc *WordCount) Reduce(word string, counts chan int64, c gossamr.Collector) error {\n  var sum int64\n  for v := range counts {\n    sum += v\n  }\n  c.Collect(sum, word)\n  return nil\n}\n\nfunc main() {\n  wordcount := gossamr.NewTask(&amp;WordCount{})\n\n  err := gossamr.Run(wordcount)\n  if err != nil {\n    log.Fatal(err)\n  }\n}\n</code></pre>\n\n<p>Kicking off the script: </p>\n\n<pre><code>./bin/hadoop jar ./contrib/streaming/hadoop-streaming-1.2.1.jar \\\n  -input /mytext.txt \\\n  -output /output.15 \\\n  -mapper \"gossamr -task 0 -phase map\" \\\n  -reducer \"gossamr -task 0 -phase reduce\" \\\n  -io typedbytes \\\n  -file ./wordcount\n  -numReduceTasks 6\n</code></pre>\n"}], "owner": {"reputation": 146, "user_id": 2618558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80ed3bdd48945e8a8e74617573a54488?s=128&d=identicon&r=PG", "display_name": "frigo americain", "link": "https://stackoverflow.com/users/2618558/frigo-americain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9024, "favorite_count": 3, "answer_count": 2, "score": 10, "last_activity_date": 1493948340, "creation_date": 1438776957, "question_id": 31832266, "link": "https://stackoverflow.com/questions/31832266/how-to-write-map-reduce-tasks-in-golang", "title": "How to write Map/Reduce tasks in Golang?", "body": "<p>I would like to write Hadoop Map/Reduce jobs in Go (and not the Streaming API!) .</p>\n\n<p>I tried to get a grasp of <a href=\"https://github.com/hortonworks/gohadoop\">hortonworks/gohadoop</a> and <a href=\"https://github.com/colinmarc/hdfs\">colinmarc/hdfs</a> but I still don't see how to write jobs for real. I have searched on github codes importing these modules but there is nothing relevant apparently.</p>\n\n<p>Is there any <code>WordCount.go</code> somewhere?</p>\n"}, {"tags": ["go", "server"], "answers": [{"comments": [{"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 1, "creation_date": 1438807904, "post_id": 31831973, "comment_id": 51606702, "body": "you can also open a websocket connection and wait for it to die. you will get an immediate timeout.  Which, you could also (effectively) do by setting the above timer to trigger every 500ms or something.  (timer approach is easier in that you don&#39;t require 3rd party libs)"}], "tags": [], "owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "is_accepted": false, "score": 2, "last_activity_date": 1459858620, "last_edit_date": 1459858620, "creation_date": 1438776186, "answer_id": 31831973, "question_id": 31831703, "link": "https://stackoverflow.com/questions/31831703/stop-go-server-when-browser-is-closed/31831973#31831973", "title": "Stop Go server when browser is closed", "body": "<p>You could let your browser emit a message before dying, or use a web socket, but a simple, reliable and usual way to do that kind of stuff is to set up a Javascript timer to have the browser send a heart-beat message to the server every now and then (depending on how quickly you want the server to stop after the browser's closing ; every second, every 15s, every minute... ?). When the server figures that a due message has not arrived, it can exit.</p>\n"}], "owner": {"reputation": 863, "user_id": 2218023, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JmNYB.jpg?s=128&g=1", "display_name": "Alessandro Resta", "link": "https://stackoverflow.com/users/2218023/alessandro-resta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1459858620, "creation_date": 1438775432, "question_id": 31831703, "link": "https://stackoverflow.com/questions/31831703/stop-go-server-when-browser-is-closed", "title": "Stop Go server when browser is closed", "body": "<p>I'm running a simple Go server on a OSX machine. When I run the command to run the Go program it starts the server and open a browser window.</p>\n\n<p>I would like to know if there's a way to when I close that browser window (by the window, not the program) also close the server and quit the terminal.</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["multithreading", "go", "io", "scheduling"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1438774039, "post_id": 31830814, "comment_id": 51584450, "body": "This <a href=\"https://morsmachine.dk/go-scheduler\" rel=\"nofollow noreferrer\">article</a> might be slightly outdated but gives a good idea of how the scheduler works."}, {"owner": {"reputation": 63, "user_id": 306760, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gIKon.jpg?s=128&g=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/306760/fredrik"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1438779918, "post_id": 31830814, "comment_id": 51588659, "body": "Perfect!, lead me through to <a href=\"https://morsmachine.dk/netpoller\" rel=\"nofollow noreferrer\">morsmachine.dk/netpoller</a> which gave me the answer."}], "answers": [{"tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": true, "score": 4, "last_activity_date": 1438779062, "creation_date": 1438779062, "answer_id": 31833069, "question_id": 31830814, "link": "https://stackoverflow.com/questions/31830814/goroutine-i-o-scheduling/31833069#31833069", "title": "Goroutine I/O scheduling", "body": "<p>You can have a look in file <a href=\"https://github.com/golang/go/blob/master/src/net/fd_unix.go\" rel=\"nofollow\">https://github.com/golang/go/blob/master/src/net/fd_unix.go</a> (Write function).</p>\n\n<p>Basically, it depends whether the socket buffer has enough space or not.</p>\n\n<p>If there is enough space in the socket buffer to accommodate the size of your write operation, the data will be immediately written to the socket buffer. I guess this corresponds to your second answer. Additionally, the kernel may actually send the packet (or add it to the NIC queues), but it is independent from the Go runtime.</p>\n\n<p>If there is not enough space in the socket buffer to accommodate the whole write operation, only part of the data will be immediately written to the socket buffer. Then, the call will block (via the runtime polling engine) until the kernel has made some space in the socket buffer (by sending some packets). As soon as some space is available, and all the data have been copied, the call will unblock.</p>\n\n<p>You should consider the timestamp is taken when the net package has written the whole buffer in the socket buffer via a system call.</p>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 306760, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gIKon.jpg?s=128&g=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/306760/fredrik"}, "is_accepted": false, "score": 2, "last_activity_date": 1438780518, "last_edit_date": 1592644375, "creation_date": 1438780518, "answer_id": 31833651, "question_id": 31830814, "link": "https://stackoverflow.com/questions/31830814/goroutine-i-o-scheduling/31833651#31833651", "title": "Goroutine I/O scheduling", "body": "<p>The <a href=\"https://morsmachine.dk/netpoller\" rel=\"nofollow noreferrer\">following article</a> describes how the netpoller works:</p>\n<blockquote>\n<p>Whenever a goroutine tries to read or write to a connection, the networking code will do the operation until it receives such an error, then call into the netpoller, telling it to notify the goroutine when it is ready to perform I/O again. The goroutine is then scheduled out of the thread it's running on and another goroutine is run in its place.</p>\n<p>When the netpoller receives notification from the OS that it can perform I/O on a file descriptor, it will look through its internal data structure, see if there are any goroutines that are blocked on that file and notify them if there are any. The goroutine can then retry the I/O operation that caused it to block and succeed in doing so.&quot;</p>\n</blockquote>\n<p>Thus we conclude that the goroutine can be rescheduled whenever the underlying system call completes writing for the entire buffer. In the case of Linux, it seems to bee when the message has been copied to the kernel space send buffer: <a href=\"https://stackoverflow.com/questions/5407182/blocking-sockets-when-exactly-does-send-return\">Blocking sockets: when, exactly, does &quot;send()&quot; return?</a>. Which in turn is my second original option &quot;When the buffer has been copied to the runtime and to the OS's kernel space&quot;; also consistent with <a href=\"https://stackoverflow.com/users/1114486/didier-spezia\">Didier Spezia's</a> answer.</p>\n"}], "owner": {"reputation": 63, "user_id": 306760, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gIKon.jpg?s=128&g=1", "display_name": "Fredrik", "link": "https://stackoverflow.com/users/306760/fredrik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 605, "favorite_count": 0, "accepted_answer_id": 31833069, "answer_count": 2, "score": 4, "last_activity_date": 1438780518, "creation_date": 1438772959, "question_id": 31830814, "link": "https://stackoverflow.com/questions/31830814/goroutine-i-o-scheduling", "title": "Goroutine I/O scheduling", "body": "<p>Golangs goroutines present an interface of blocking I/O to the goroutine (-programmer). Behind the scenes the runtime naturally uses some kind of non-blocking I/O to prevent the OS from suspending the OS-thread, so that the runtime can run another goroutine on top of the OS thread while the I/O is performed.</p>\n\n<p>When does the runtime consider the I/O performed so that it can reschedule the goroutine?</p>\n\n<p>To make it clear, assuming I have a <code>net.TCPConn</code> that I call <code>Write</code> on, when can I expect the goroutine to be rescheduled?</p>\n\n<pre><code>conn, err := net.Dial(\"tcp\", serverAddr)\nconn.Write(buffer)\ntimestamp = time.Now()\n</code></pre>\n\n<p>That is when can I expect the timestamp to be taken?</p>\n\n<ul>\n<li>When the buffer has been copied to the golang runtime?</li>\n<li>When the buffer has been copied to the runtime and to the OS's kernel space?</li>\n<li>When the buffer has been copied to the runtime, kernel space and additionally to the NIC's send buffer?</li>\n<li>When the buffer has been sent over the network/from the NIC?</li>\n<li>When the buffer has been acknowledged by the recieve ends TCP stack?</li>\n</ul>\n"}, {"tags": ["github", "go"], "comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 2, "creation_date": 1438774474, "post_id": 31830461, "comment_id": 51584735, "body": "Do I understand you correct, you interest in cross-compile? <a href=\"http://dave.cheney.net/2012/09/08/an-introduction-to-cross-compilation-with-go\" rel=\"nofollow noreferrer\">dave.cheney.net/2012/09/08/&hellip;</a>"}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1438774817, "post_id": 31830461, "comment_id": 51584954, "body": "The idea is to make cross-compiled binaries for all platforms and make the release on github"}, {"owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "reply_to_user": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1438818744, "post_id": 31830461, "comment_id": 51610726, "body": "Yes, sounds likes cross-compilation."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1438823371, "post_id": 31830461, "comment_id": 51611799, "body": "FWIW Travis CI can also do Mac OS X builds: <a href=\"http://docs.travis-ci.com/user/osx-ci-environment/\" rel=\"nofollow noreferrer\">docs.travis-ci.com/user/osx-ci-environment</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4076, "user_id": 1806763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GXLjI.png?s=128&g=1", "display_name": "JD D", "link": "https://stackoverflow.com/users/1806763/jd-d"}, "is_accepted": false, "score": 4, "last_activity_date": 1438785306, "last_edit_date": 1438785306, "creation_date": 1438780363, "answer_id": 31833591, "question_id": 31830461, "link": "https://stackoverflow.com/questions/31830461/build-golang-release-binaries-for-github/31833591#31833591", "title": "build Golang release binaries for Github", "body": "<p>You are most likely right about the Travis CI only building in Linux as go cross-compilation requires you to build from source and build other go executables.  Like RoninDev suggested, I would suggest that you setup your own cross-compilation build environment by following the blog post: </p>\n\n<p><a href=\"http://dave.cheney.net/2012/09/08/an-introduction-to-cross-compilation-with-go\" rel=\"nofollow\">http://dave.cheney.net/2012/09/08/an-introduction-to-cross-compilation-with-go</a></p>\n\n<p>It is quite easy, and only takes about 10 minutes.  After you have that, a build tool such as Jenkins will give you the controls to kick off a build for the desired platforms (Mac, Windows, Linux, etc) and then push out git releases for each one.</p>\n"}, {"tags": [], "owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "is_accepted": true, "score": 4, "last_activity_date": 1438914083, "last_edit_date": 1438914083, "creation_date": 1438839768, "answer_id": 31847655, "question_id": 31830461, "link": "https://stackoverflow.com/questions/31830461/build-golang-release-binaries-for-github/31847655#31847655", "title": "build Golang release binaries for Github", "body": "<p>Thanks for all the suggestions and answers that were given. <strong>Cross-compilation</strong> was what I was looking for, and <a href=\"http://dave.cheney.net/2013/07/09/an-introduction-to-cross-compilation-with-go-1-1\" rel=\"nofollow\">Dave Cheney's blog post</a> was a good start.</p>\n\n<p>However I found a better solution - <a href=\"https://github.com/laher/goxc\" rel=\"nofollow\">laher/goxc</a> - \"a build tool for Go, with a focus on cross-compiling, packaging and deployment\". It was inspired by Dave Cheney's work, and also includes deploy tools for Github - just what I was looking for. (For example, I used it to release <a href=\"https://github.com/soniah/awsenv\" rel=\"nofollow\">soniah/awsenv</a>)</p>\n"}, {"tags": [], "owner": {"reputation": 18043, "user_id": 405013, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ef3cd04888c6d17f34d43e29ec3d46f?s=128&d=identicon&r=PG", "display_name": "caarlos0", "link": "https://stackoverflow.com/users/405013/caarlos0"}, "is_accepted": false, "score": 2, "last_activity_date": 1502328207, "creation_date": 1502328207, "answer_id": 45602998, "question_id": 31830461, "link": "https://stackoverflow.com/questions/31830461/build-golang-release-binaries-for-github/45602998#45602998", "title": "build Golang release binaries for Github", "body": "<p>I created <a href=\"https://github.com/goreleaser/goreleaser\" rel=\"nofollow noreferrer\">goreleaser</a> to do just that.</p>\n\n<p>You can try it out if you want :)</p>\n"}], "owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1754, "favorite_count": 0, "accepted_answer_id": 31847655, "answer_count": 3, "score": 7, "last_activity_date": 1502328207, "creation_date": 1438771984, "question_id": 31830461, "link": "https://stackoverflow.com/questions/31830461/build-golang-release-binaries-for-github", "title": "build Golang release binaries for Github", "body": "<p>I'm looking for ideas on how to easily build binaries for common platforms for a Golang project, for release on Github.</p>\n\n<p>I already know how to manually do releases, using Github's instructions at <a href=\"https://help.github.com/articles/creating-releases/\" rel=\"noreferrer\">Creating Releases</a>. And I'm currently doing releases using <a href=\"https://github.com/aktau/github-release\" rel=\"noreferrer\">aktau/github-release</a>, but this requires manually logging into different machines (OSX, Linux, Windows) and doing the release.</p>\n\n<p>Benedikt Lang has <a href=\"http://www.blang.io/2014/07/28/travis-release-golang.html\" rel=\"noreferrer\">blogged</a> about using <a href=\"https://travis-ci.org/\" rel=\"noreferrer\">Travis-CI</a> (which I'm yet to experiment with). But I presume the public Travis will only build binaries for Linux.</p>\n\n<p>Any suggestions?</p>\n"}, {"tags": ["go", "redis", "connection-pooling", "redigo"], "answers": [{"tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": false, "score": 5, "last_activity_date": 1438764213, "creation_date": 1438764213, "answer_id": 31827550, "question_id": 31826666, "link": "https://stackoverflow.com/questions/31826666/redigo-invalid-memory-address-or-nil-pointer-dereference-while-attempting-to-co/31827550#31827550", "title": "Redigo: Invalid memory address or nil pointer dereference while attempting to connect to pool", "body": "<p>You are making the mistake of checking for an error <strong>after</strong> using the returned value:</p>\n\n<pre><code>con, err := redis.Dial(\"tcp\", *redisAddress)\ncon.Do(\"SELECT\", 1) // Here you are using con which most likely is nil\nif err != nil {\n    return nil, err\n}\n</code></pre>\n\n<p>Rearrange the code to:</p>\n\n<pre><code>con, err := redis.Dial(\"tcp\", *redisAddress)\nif err != nil {\n    return nil, err\n}\ncon.Do(\"SELECT\", 1) // con should be used after checking for errors\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 135, "user_id": 3841436, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/100000631286631/picture?type=large", "display_name": "Vinay Sawant", "link": "https://stackoverflow.com/users/3841436/vinay-sawant"}, "is_accepted": true, "score": 0, "last_activity_date": 1438854437, "creation_date": 1438854437, "answer_id": 31852404, "question_id": 31826666, "link": "https://stackoverflow.com/questions/31826666/redigo-invalid-memory-address-or-nil-pointer-dereference-while-attempting-to-co/31852404#31852404", "title": "Redigo: Invalid memory address or nil pointer dereference while attempting to connect to pool", "body": "<pre><code>con, err := redis.Dial(\"tcp\", *redisAddress)\nif err != nil {\n    return nil, err\n}\ncon.Do(\"SELECT\", 0) //Select 0 for Nutcracker\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 5177417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e0043792d5f1639b9e294ca4bcf8ed7?s=128&d=identicon&r=PG&f=1", "display_name": "Vinay Sawant", "link": "https://stackoverflow.com/users/5177417/vinay-sawant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1399, "favorite_count": 0, "accepted_answer_id": 31852404, "answer_count": 2, "score": 0, "last_activity_date": 1438854437, "creation_date": 1438761622, "last_edit_date": 1438764411, "question_id": 31826666, "link": "https://stackoverflow.com/questions/31826666/redigo-invalid-memory-address-or-nil-pointer-dereference-while-attempting-to-co", "title": "Redigo: Invalid memory address or nil pointer dereference while attempting to connect to pool", "body": "<blockquote>\n  <p>Redis Connecting.....! panic: runtime error: invalid memory address or<br>\n  nil pointer dereference [signal 0xb code=0x1 addr=0x28 pc=0x40154b]<br>\n  goroutine 1 [running]: runtime.panic(0x52c6e0, 0x6b6348)<br>\n  /usr/lib/go/src/pkg/runtime/panic.c:266 +0xb6<br>\n  main.func\u00b7001(0xc21005102c, 0x0, 0x4bcd4c, 0x1)<br>\n  /home/vinay10949/redischeck/redischeck.go:21 +0x10b<br>\n  github.com/garyburd/redigo/redis.(*Pool).get(0xc210051000, 0x0,<br>\n  0xc2100378f0, 0x42dbdf, 0x7fbe9c177070)\n  /usr/lib/go/src/pkg/github.com/garyburd/redigo/redis/pool.go:250<br>\n  +0x3a2 github.com/garyburd/redigo/redis.(*Pool).Get(0xc210051000, 0x1, 0x1)   > /usr/lib/go/src/pkg/github.com/garyburd/redigo/redis/pool.go:150<br>\n  +0x27 main.main() /home/  </p>\n  \n  <p>vinay10949/redischeck/redischeck.go:29 +0x13e</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"github.com/garyburd/redigo/redis\"\n    //\"reflect\"\n)\n\nvar (\n    redisAddress   = flag.String(\"10.12.2.121\", \"10.12.2.121:6379\", \"Address to the Redis server\")\n    maxConnections = flag.Int(\"max-connections\", 10, \"Max connections to Redis\")\n)\n\nfunc main() {\n\n    //Redis Connection\n    redisPool := redis.NewPool(func() (redis.Conn, error) {\n\n        con, err := redis.Dial(\"tcp\", *redisAddress)\n        con.Do(\"SELECT\", 1)\n        if err != nil {\n            return nil, err\n        }\n        return con, err\n    }, *maxConnections)\n\n    fmt.Println(\"Redis Connecting...!\")\n    con := redisPool.Get()\n    status, errStatus := con.Do(\"SET\", \"Name\", \"BookMyShow\")\n    if errStatus != nil {\n        fmt.Println(errStatus)\n    } else {\n        fmt.Println(\"Redis Connected\")\n    }\n    statusInsertion, _ := redis.String(status, errStatus)\n    fmt.Println(\"Status of Insertion :\" + statusInsertion)\n    value, _ := redis.String(con.Do(\"GET\", \"Name\"))\n    fmt.Println(\"Value Retrieved : \" + value)\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1438756633, "post_id": 31823580, "comment_id": 51573688, "body": "Please provide your struct, which you are trying to marshal"}, {"owner": {"reputation": 25, "user_id": 1812786, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d810c6ce0cbf672dc5e4c4add6d114cb?s=128&d=identicon&r=PG&f=1", "display_name": "Nikita Harlov", "link": "https://stackoverflow.com/users/1812786/nikita-harlov"}, "reply_to_user": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1438757156, "post_id": 31823580, "comment_id": 51573969, "body": "Sorry, my mistake. Updated topic"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1438758028, "post_id": 31823580, "comment_id": 51574394, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/24229205/marshalling-json-rawmessage-returns-base64-encoded-string\">Marshalling json.RawMessage returns base64 encoded string</a>"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 1812786, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d810c6ce0cbf672dc5e4c4add6d114cb?s=128&d=identicon&r=PG&f=1", "display_name": "Nikita Harlov", "link": "https://stackoverflow.com/users/1812786/nikita-harlov"}, "edited": false, "score": 0, "creation_date": 1438755434, "post_id": 31823978, "comment_id": 51573083, "body": "I&#39;m sorry, but you don&#39;t understand me )  I&#39;m updated start of topic, please check."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 0, "last_activity_date": 1438751942, "creation_date": 1438751942, "answer_id": 31823978, "question_id": 31823580, "link": "https://stackoverflow.com/questions/31823580/go-encoding-json-marshal-json-field/31823978#31823978", "title": "go &quot;encoding/json&quot; : marshal json field", "body": "<p>You'd have to unmarshal it, here's an example:</p>\n\n<pre><code>var data []*struct {\n    ID int\n    DisplayInfo string\n}\nif err := json.Unmarshal([]byte(j), &amp;data); err != nil {\n    log.Fatal(err)\n}\nfor _, d := range data {\n    var displayInfo struct{ Path string }\n    if err := json.Unmarshal([]byte(d.DisplayInfo), &amp;displayInfo); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(d.ID, displayInfo.Path)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/T7wEfcU9sw\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}, {"tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": true, "score": 1, "last_activity_date": 1438757970, "last_edit_date": 1438757970, "creation_date": 1438757285, "answer_id": 31825250, "question_id": 31823580, "link": "https://stackoverflow.com/questions/31823580/go-encoding-json-marshal-json-field/31825250#31825250", "title": "go &quot;encoding/json&quot; : marshal json field", "body": "<p>Assuming you have access to change <code>models.Model</code>, you can create your own type with a custom Unmarshaler that just returns the raw string:</p>\n\n<pre><code>type JSONString string\n\nfunc (s JSONString) MarshalJSON() ([]byte, error) {\n    return []byte(s), nil\n}\n</code></pre>\n\n<p><strong>Working example:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype JSONString string\n\nfunc (s JSONString) MarshalJSON() ([]byte, error) {\n    return []byte(s), nil\n}\n\ntype Model struct {\n    ID          int\n    Name        string\n    DisplayInfo JSONString\n}\n\nfunc main() {\n    data := []byte(`{   \n  \"ID\":9,\n  \"Name\":\"120 \u21161\",\n  \"DisplayInfo\":\"{\\\"path\\\": \\\"http://path/to/img.png\\\"}\"\n}`)\n\n    var obj Model\n    err := json.Unmarshal(data, &amp;obj)\n    if err != nil {\n        panic(err)\n    }\n\n    // Here comes your code\n    js, err := json.Marshal(obj)\n\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(string(js))\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<blockquote>\n  <p>{\"ID\":9,\"Name\":\"120 \u21161\",\"DisplayInfo\":{\"path\":\"<a href=\"http://path/to/img.png\" rel=\"nofollow\">http://path/to/img.png</a>\"}}</p>\n</blockquote>\n\n<p><strong>Playground:</strong> <a href=\"http://play.golang.org/p/6bcnuGjlU8\" rel=\"nofollow\">http://play.golang.org/p/6bcnuGjlU8</a></p>\n"}, {"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 2, "last_activity_date": 1438757968, "creation_date": 1438757968, "answer_id": 31825485, "question_id": 31823580, "link": "https://stackoverflow.com/questions/31823580/go-encoding-json-marshal-json-field/31825485#31825485", "title": "go &quot;encoding/json&quot; : marshal json field", "body": "<p>Use a pointer to <code>json.RawMessage</code>:</p>\n\n<pre><code>type Data struct {\n    Obj *json.RawMessage\n}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/Qq9IUBDLzJ\" rel=\"nofollow\">http://play.golang.org/p/Qq9IUBDLzJ</a>.</p>\n"}], "owner": {"reputation": 25, "user_id": 1812786, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d810c6ce0cbf672dc5e4c4add6d114cb?s=128&d=identicon&r=PG&f=1", "display_name": "Nikita Harlov", "link": "https://stackoverflow.com/users/1812786/nikita-harlov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 0, "accepted_answer_id": 31825250, "answer_count": 3, "score": 0, "last_activity_date": 1439643996, "creation_date": 1438749670, "last_edit_date": 1439643996, "question_id": 31823580, "link": "https://stackoverflow.com/questions/31823580/go-encoding-json-marshal-json-field", "title": "go &quot;encoding/json&quot; : marshal json field", "body": "<p>I have a PostgreSQL schema with json field's (DisplayInfo, and FormatInfo). Structure of this field's is dynamic.</p>\n\n<p>I'can read and render it only as string (string type in render struct) :</p>\n\n<pre><code>[\n {  \n  \"ID\":9,\n  \"Name\":\"120 \u21161\",\n  \"DisplayInfo\":\"{\\\"path\\\": \\\"http://path/to/img.png\\\"}\",\n  \"Format\":{  \n     \"Code\":\"frame-120\",\n     \"Width\":120,\n     \"Height\":60,\n     \"FormatInfo\":\"[{\\\"name\\\": \\\"\\\\u0413\\\\u043b\\\\u0430\\\\u0432\\\\u043d\\\\u043e\\\\u0435 \\\\u0438\\\\u0437\\\\u043e\\\\u0431\\\\u0440\\\\u0430\\\\u0436\\\\u0435\\\\u043d\\\\u0438\\\\u0435\\\", \\\"field_type\\\": \\\"img\\\", \\\"key\\\": \\\"path\\\"}]\"\n  },\n  \"Weight\":0.075,\n  \"Application\":8,\n  \"Url\":\"//path/to/game\",\n  \"Referrer\":\"\"\n }\n]\n</code></pre>\n\n<p>but i want output field DisplayInfo as JSON object. How ? </p>\n\n<p>My render code: </p>\n\n<pre><code>func renderJSON(w http.ResponseWriter, obj models.Model) {\n    js, err := json.Marshal(obj)\n\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    w.Header().Set(\"Content-Type\", \"application/json; charset=utf-8\")\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    w.Write(js)\n}\n</code></pre>\n\n<p>UPD 1 : Structure of this field's is dynamic. DisplayInfo may have 'path' field, or may not. They may have additional fields.</p>\n\n<p>UPD 2. I wana output DisplayInfo and FormatInfo as json-object(not string), <strong>as part of whole object</strong>, like this: </p>\n\n<pre><code>[\n {  \n  \"ID\":9,\n  \"Name\":\"120 \u21161\",\n  \"DisplayInfo\":{\"path\": \"http://path/to/img.png\"},\n  \"Format\":{  \n     \"Code\":\"frame-120\",\n     \"Width\":120,\n     \"Height\":60,\n     \"FormatInfo\":[{\"name\": \"\\\\u0413\\\\u043b\\\\u0430\\\\u0432\\\\u043d\\\\u043e\\\\u0435 \\\\u0438\\\\u0437\\\\u043e\\\\u0431\\\\u0440\\\\u0430\\\\u0436\\\\u0435\\\\u043d\\\\u0438\\\\u0435\", \"field_type\": \"img\", \"key\": \"path\"}]\n  },\n  \"Weight\":0.075,\n  \"Application\":8,\n  \"Url\":\"//path/to/game\",\n  \"Referrer\":\"\"\n }\n]\n</code></pre>\n\n<p>UPD 3: Structures</p>\n\n<p>Actual structure is : </p>\n\n<pre><code>type BannerSerializer struct {\n    ID          int\n    Name        string\n    DisplayInfo string\n    Format      formatSerializer\n    Weight      float32\n    Application int\n    Url         string\n    Referrer    string\n}  \n</code></pre>\n\n<p>Then i trying this structure: </p>\n\n<pre><code>type BannerSerializer struct {\n    ID          int\n    Name        string\n    DisplayInfo json.RawMessage\n    Format      formatSerializer\n    Weight      float32\n    Application int\n    Url         string\n    Referrer    string\n}   \n</code></pre>\n\n<ul>\n<li>DisplayInfo serialize as base64 string (or like base64, don't know)</li>\n</ul>\n"}, {"tags": ["android", "mobile", "go"], "comments": [{"owner": {"reputation": 4439, "user_id": 4211264, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/AU8oX.jpg?s=128&g=1", "display_name": "Bhargav Thanki", "link": "https://stackoverflow.com/users/4211264/bhargav-thanki"}, "edited": false, "score": 0, "creation_date": 1438751185, "post_id": 31823236, "comment_id": 51571599, "body": "Read android developer guide about service here <a href=\"http://developer.android.com/guide/components/services.html\" rel=\"nofollow noreferrer\">developer.android.com/guide/components/services.html</a>"}, {"owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "reply_to_user": {"reputation": 4439, "user_id": 4211264, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/AU8oX.jpg?s=128&g=1", "display_name": "Bhargav Thanki", "link": "https://stackoverflow.com/users/4211264/bhargav-thanki"}, "edited": false, "score": 0, "creation_date": 1438751484, "post_id": 31823236, "comment_id": 51571684, "body": "I&#39;m not sure how that applies to gomobile. Is there any way we can call the Android API (Java) from Go?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438753532, "post_id": 31823236, "comment_id": 51572364, "body": "My knowledge of this is pretty sketchy, but I think you can call Go from Java. You can construct the shell of an app in Java, and have it call the logic you wrote in Go. (I think that&#39;s how the Ivy Android app is done--but, again, my background there is mostly limited to skimming some conference slides.)"}], "owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 210, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1438748504, "creation_date": 1438747298, "question_id": 31823236, "link": "https://stackoverflow.com/questions/31823236/how-can-i-run-an-application-in-background-gomobile", "title": "How can I run an application in background? - gomobile", "body": "<p>There seems to be a java API but I'm not sure how this is supposed to work with <a href=\"https://godoc.org/golang.org/x/mobile/app\" rel=\"nofollow\">mobileapp</a>. Is there any go binding or anything like that?</p>\n"}, {"tags": ["struct", "go"], "comments": [{"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1438746565, "post_id": 31823087, "comment_id": 51570473, "body": "Just make functions to initialize things, ie NewUser, NewInstance, NewConfig."}], "answers": [{"tags": [], "owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "is_accepted": false, "score": 0, "last_activity_date": 1438747236, "creation_date": 1438747236, "answer_id": 31823224, "question_id": 31823087, "link": "https://stackoverflow.com/questions/31823087/cleanly-implementing-a-multi-level-struct-of-structs-in-go/31823224#31823224", "title": "Cleanly implementing a multi-level struct of structs in Go", "body": "<p>Just write functions.</p>\n\n<pre><code>func NewInstance(n string, confs ...config) instance {\n    var i instance\n    i.name = n\n    i.configs = confs\n    return i\n}\n\nfunc NewConfig(name string, reps ...string) config {\n    var c config\n    c.configName = name\n    c.replicas = reps\n    return c\n}\n\nfunc NewUser(ins ...instance) user {\n    var u user\n    u.instances = ins\n    return u\n}\n</code></pre>\n\n<p>Then this has the same effect as your code:</p>\n\n<pre><code>var users map[string][]user\nfunc main() {\n    users = make(map[string][]user)\n    u1_i1 := NewInstance(\"instance-1\", \n    NewConfig(\"conf1\", \"xx\", \"yy\", \"zz\"))\n\n    users[\"user-1\"] = []user{NewUser(u1_i1)}\n\n    u2_i1 := NewInstance(\"instance-2\",\n    NewConfig(\"conf2\", \"xx\", \"yy\", \"zz\", \"aa\"))\n\n    users[\"user-2\"] = []user{NewUser(u2_i1)}\n\n    for user, _ := range users {\n        fmt.Println(users[user][0].instances[0].name)\n    }\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/okmBapuDWj\" rel=\"nofollow\">http://play.golang.org/p/okmBapuDWj</a></p>\n\n<p>If accessing things gets complicated.. more functions:</p>\n\n<pre><code>func (u user) InstanceName(i int) string {\n    return u.instances[i].name\n}\n</code></pre>\n\n<p>or consider reworking your data structures.</p>\n"}], "owner": {"reputation": 789, "user_id": 1440714, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/0917fad19642bf07359207859bffcadc?s=128&d=identicon&r=PG", "display_name": "pheven", "link": "https://stackoverflow.com/users/1440714/pheven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 371, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1438747236, "creation_date": 1438746069, "question_id": 31823087, "link": "https://stackoverflow.com/questions/31823087/cleanly-implementing-a-multi-level-struct-of-structs-in-go", "title": "Cleanly implementing a multi-level struct of structs in Go", "body": "<p>I'm new to Golang, and I'm trying to initialize a struct of structs with a list of strings at the bottom. I'd like to be able to access the values inside in a clean and readable way, but it isn't clicking. </p>\n\n<p>for example, the struct setup is as follows:</p>\n\n<pre><code>type config struct {\n  // a config can have many replicas\n  configName string\n  replicas  []string\n}\n\ntype instance struct {\n  // an instance can have many configs\n  name string\n  configs   []config\n}\n\ntype user struct {\n  // a user can have up to two instances\n  instances []instance\n}\n</code></pre>\n\n<p>And I'm initializing it like so:</p>\n\n<pre><code>var users = map[string][]user{\n  \"user-1\": []user {\n    { \n      []instance {\n        {\n          \"instance-1\",\n          []config {\n            {\n              \"some-config-1\",\n              []string{\"xx\", \"yy\", \"zz\",},\n            },\n          },\n        },\n      }, \n    },\n  },\n  \"user-2\": {\n    { \n      []instance {\n        {\n          \"instance-2\",\n          []config {\n            {\n              \"some-config-2\",\n              []string{\"xx\", \"yy\", \"zz\",},\n            },\n          },\n        },\n      }, \n    },\n  },\n}\n</code></pre>\n\n<p>Then, to access any of the fields, I have to do gross stuff like:</p>\n\n<pre><code>func main() {\n  for user, _ := range users {\n    fmt.Println(users[user][0].instances[0].name)\n  }\n}\n</code></pre>\n\n<p>There must be a better way? Running (but gross) code example here: <a href=\"http://play.golang.org/p/9M8pyBnMPB\" rel=\"nofollow\">http://play.golang.org/p/9M8pyBnMPB</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "edited": false, "score": 0, "creation_date": 1438744396, "post_id": 31822640, "comment_id": 51569941, "body": "If you data is dynamic, use a map"}], "answers": [{"comments": [{"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "reply_to_user": {"reputation": 37770, "user_id": 1665, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/fb3a3dcfb9e30579cd34020ef35bc979?s=128&d=identicon&r=PG", "display_name": "Rob Wilkerson", "link": "https://stackoverflow.com/users/1665/rob-wilkerson"}, "edited": false, "score": 2, "creation_date": 1438744111, "post_id": 31822688, "comment_id": 51569883, "body": "Oh, well first off you would get your data out if instead of <code>Data    map[string]interface{} `&quot;json:data&quot;`</code> you did <code>Data []map[string]interface{} `&quot;json:data&quot;`</code>, you actually have a slice of maps there, not just a map"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438798409, "post_id": 31822688, "comment_id": 51601224, "body": "One way of using <code>[]map[string]string</code> (are all the object values strings?) like @user3591723 suggests would be: <a href=\"https://play.golang.org/p/V8JVfDtynC\" rel=\"nofollow noreferrer\">play.golang.org/p/V8JVfDtynC</a>"}], "tags": [], "owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "is_accepted": true, "score": 0, "last_activity_date": 1438744530, "last_edit_date": 1438744530, "creation_date": 1438743537, "answer_id": 31822688, "question_id": 31822640, "link": "https://stackoverflow.com/questions/31822640/processing-a-json-api-response/31822688#31822688", "title": "Processing a JSON API Response", "body": "<p>I would use two structs for this:</p>\n\n<pre><code>type ColData struct {\n    Id      string `json:\"id\"`\n    Avatar  string `json:\"avatar\"`\n    Name    string `json:\"name\"`\n    Email   string `json:\"email\"`\n    Phone   string `json:\"phone\"`\n    Address string `json:\"address\"`\n}\n\ntype View struct {\n    Columns []string  `json:\"columns\"`\n    Data    []ColData `json:\"data\"`\n}\n</code></pre>\n\n<p>In response to your update:</p>\n\n<pre><code>type View struct {\n    Columns []string               `\"json:columns\"`\n    Data    map[string]interface{} `\"json:data\"`\n}\n</code></pre>\n\n<p>just needs to become</p>\n\n<pre><code>type View struct {\n    Columns []string               `\"json:columns\"`\n    Data    []map[string]interface{} `\"json:data\"`\n}\n</code></pre>\n\n<p>to get your data into the struct. Might also be nice to just work with them as <code>string</code> or <code>json.RawMessage</code> instead of an <code>interface{}</code> as well, but I don't really know what you're doing with it/what you could possibly get out.</p>\n"}], "owner": {"reputation": 37770, "user_id": 1665, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/fb3a3dcfb9e30579cd34020ef35bc979?s=128&d=identicon&r=PG", "display_name": "Rob Wilkerson", "link": "https://stackoverflow.com/users/1665/rob-wilkerson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 31822688, "answer_count": 1, "score": 1, "last_activity_date": 1438744530, "creation_date": 1438743151, "last_edit_date": 1438743701, "question_id": 31822640, "link": "https://stackoverflow.com/questions/31822640/processing-a-json-api-response", "title": "Processing a JSON API Response", "body": "<p>Working on my first Go project and I'm having some trouble wrapping my mind around some of the complex data structures. At the moment, I'm <a href=\"http://go-proto.robwilkerson.org/demo.json\" rel=\"nofollow\">mocking up the response</a> from an API that will return a JSON object containing 2 properties:</p>\n\n<ul>\n<li><code>columns</code> contains an array of fields in the order they should be handled</li>\n<li><code>data</code> contains an array of objects containing the properties listed in <code>columns</code></li>\n</ul>\n\n<p>I need to iterate over the <code>data</code> array/slice and, within that, iterate over the <code>columns</code> array/slice and extract the current property from the current data object. I'm not handling the data structure properly. A lot of trial and error has left me with the following code and enough frustration to decide I simply needed to ask the question.</p>\n\n<pre><code>res, err := http.Get(\"http://roadmap-proto.robwilkerson.org/demo.json\")\nfailOnError(err, \"Uh oh\")\ndefer res.Body.Close()\n\n// Decode and process the JSON response\n// var v map[string]interface{}\ntype View struct {\n    Columns []string               `\"json:columns\"`\n    Data    map[string]interface{} `\"json:data\"`\n}\nv := View{}\njson.NewDecoder(res.Body).Decode(&amp;v)\nlog.Printf(\"[====&gt;] Data: %s\", v)\n</code></pre>\n\n<p>The output from <code>log.Printf()</code> is this:</p>\n\n<pre><code>Data: {[id avatar name email phone address] map[]}\n</code></pre>\n\n<p>The <code>columns</code> seems to read okay, but not the data. Ultimately I need to loop over that and write each field to an Excel cell, but so far I can't even get the data to \"load\" properly.</p>\n\n<p>Any push in the right direction would be much appreciated.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I inadvertently omitted some key info: On any given call to the API, the number and names of the columns may be different. Within a given call, all objects in the <code>data</code> array will be the same, but each call could be very, very different. I can't define a static <code>struct</code> and have that work.</p>\n"}, {"tags": ["go", "fedora", "fedora-21"], "answers": [{"comments": [{"owner": {"reputation": 2753, "user_id": 2009612, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/VGBK2.jpg?s=128&g=1", "display_name": "FilBot3", "link": "https://stackoverflow.com/users/2009612/filbot3"}, "edited": false, "score": 0, "creation_date": 1438827865, "post_id": 31822683, "comment_id": 51612855, "body": "Changing the package name worked. I couldn&#39;t use a custom name, but <code>package main</code> worked. For some reason, I get an error when I don&#39;t include the main go file in the go install command. I&#39;ll post the error in the OP."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 2753, "user_id": 2009612, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/VGBK2.jpg?s=128&g=1", "display_name": "FilBot3", "link": "https://stackoverflow.com/users/2009612/filbot3"}, "edited": false, "score": 0, "creation_date": 1438849146, "post_id": 31822683, "comment_id": 51621067, "body": "Custom package names are used for libraries only (i.e. packages that are used by other libraries or commands). Applications (that are compiled to binaries) should always use <code>package main</code>"}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 2, "last_activity_date": 1438743522, "creation_date": 1438743522, "answer_id": 31822683, "question_id": 31822170, "link": "https://stackoverflow.com/questions/31822170/gopath-and-gobin-set-and-exported-in-fedora-but-still-not-installing-program/31822683#31822683", "title": "GOPATH and GOBIN set and exported in Fedora but still not installing program", "body": "<p><a href=\"http://golang.org/cmd/go/#hdr-Compile_and_install_packages_and_dependencies\" rel=\"nofollow\">go install</a> expects a package as argument (see <a href=\"http://golang.org/cmd/go/#hdr-Description_of_package_lists\" rel=\"nofollow\">Description of package lists</a> for more detailed explanation). In your case it probably should be </p>\n\n<pre><code>go install github.com/pred3/go_helloworld/helloworld\n</code></pre>\n\n<p>assuming that <code>$GOPATH/src/github.com/pred3/go_helloworld/helloworld</code> directory exists and <code>$GOPATH/src/github.com/pred3/go_helloworld/helloworld/helloworld.go</code> starts with <code>package main</code></p>\n\n<p>The following commands will do the same:</p>\n\n<pre><code>cd $GOPATH/src/github.com/pred3/go_helloworld/helloworld\ngo intsall\n</code></pre>\n"}], "owner": {"reputation": 2753, "user_id": 2009612, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/VGBK2.jpg?s=128&g=1", "display_name": "FilBot3", "link": "https://stackoverflow.com/users/2009612/filbot3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 684, "favorite_count": 0, "accepted_answer_id": 31822683, "answer_count": 1, "score": 0, "last_activity_date": 1438828036, "creation_date": 1438739575, "last_edit_date": 1438828036, "question_id": 31822170, "link": "https://stackoverflow.com/questions/31822170/gopath-and-gobin-set-and-exported-in-fedora-but-still-not-installing-program", "title": "GOPATH and GOBIN set and exported in Fedora but still not installing program", "body": "<p>I have GO installed on a Fedora 21 laptop and I setup GOPATH and GOBIN, but it for some reason is not letting me install my go Programs.</p>\n\n<pre><code>pred@computer01 [20:03:02] ~  \n$ echo $GOPATH\n/home/pred/Documents/GO\npred@computer01 [20:03:11] ~  \n$ echo $GOBIN\n/home/pred/Documents/GO/bin\npred@computer01 [20:03:15] ~  \n$ cd $GOPATH\npred@computer01 [20:03:21] ~/Documents/GO  \n$ go install src/github.com/pred3/go_helloworld/helloworld/helloworld.go \ngo install: no install location for .go files listed on command line (GOBIN not set)\npred@computer01 [20:03:32] ~/Documents/GO  \n$ go env\nGOARCH=\"amd64\"\nGOBIN=\"/home/pred/Documents/GO/bin\"\nGOCHAR=\"6\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/pred/Documents/GO\"\nGORACE=\"\"\nGOROOT=\"/usr/lib/golang\"\nGOTOOLDIR=\"/usr/lib/golang/pkg/tool/linux_amd64\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n\n<p>What else should I be doing to get this to work? </p>\n\n<p>--EDIT--</p>\n\n<p>Issuing the following command as stated below also gave errors.</p>\n\n<pre><code>pred@computer1 [21:22:51] ~/Documents/GO  \n$ go install src/github.com/pred3/go_helloworld/helloworld\ncan't load package: package src/github.com/predatorian3/go_helloworld/helloworld: cannot find package \"src/github.com/pred3/go_helloworld/helloworld\" in any of:\n    /usr/lib/golang/src/src/github.com/pred3/go_helloworld/helloworld (from $GOROOT)\n    /home/pred/Documents/GO/src/src/github.com/pred3/go_helloworld/helloworld (from $GOPATH)\n</code></pre>\n\n<p>However, I did not have <code>package main</code> at the beginning of the go file I was trying to install. Once I changed it to <code>package main</code> it worked. I'm not sure why I couldn't use a different package name though. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1438710970, "post_id": 31815969, "comment_id": 51557722, "body": "You can&#39;t range over an <code>interface{}</code> like the error says, you need to assert that to a type which can be used for range.  What is the underlying type of &quot;record&quot;"}, {"owner": {"reputation": 37770, "user_id": 1665, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/fb3a3dcfb9e30579cd34020ef35bc979?s=128&d=identicon&r=PG", "display_name": "Rob Wilkerson", "link": "https://stackoverflow.com/users/1665/rob-wilkerson"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438711237, "post_id": 31815969, "comment_id": 51557837, "body": "@JimB So that can change. Ultimately it will be query results, but on any given request, the query will be different. Different fields and even a different number of fields. For this purpose, I suppose I could treat each field as a string value since I&#39;m just dropping them in a spreadsheet. Does that help any?"}, {"owner": {"reputation": 37770, "user_id": 1665, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/fb3a3dcfb9e30579cd34020ef35bc979?s=128&d=identicon&r=PG", "display_name": "Rob Wilkerson", "link": "https://stackoverflow.com/users/1665/rob-wilkerson"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438711340, "post_id": 31815969, "comment_id": 51557879, "body": "@JimB: Sorry, I should&#39;ve read more carefully. AFAICT, each record is a <code>map</code>. I&#39;ve updated the post with the decoded JSON from the response."}], "answers": [{"comments": [{"owner": {"reputation": 909, "user_id": 1363774, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/fbdf37ccc1f323b8ee9f75fc75934358?s=128&d=identicon&r=PG", "display_name": "auro", "link": "https://stackoverflow.com/users/1363774/auro"}, "edited": false, "score": 2, "creation_date": 1447955350, "post_id": 31816267, "comment_id": 55387217, "body": "In my opinion, this is the best explanation for understanding parsing JSON with Go."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 40, "last_activity_date": 1438712244, "last_edit_date": 1438712244, "creation_date": 1438711637, "answer_id": 31816267, "question_id": 31815969, "link": "https://stackoverflow.com/questions/31815969/go-cannot-range-over-my-var-type-interface/31816267#31816267", "title": "Go cannot range over &lt;my var&gt; (type interface {})", "body": "<p>The defaults that the json package will decode into when the type isn't declared are:</p>\n\n<pre><code>bool, for JSON booleans\nfloat64, for JSON numbers\nstring, for JSON strings\n[]interface{}, for JSON arrays\nmap[string]interface{}, for JSON objects\nnil for JSON null\n</code></pre>\n\n<p>Since each <code>record</code> is (in your example) a json object, you can assert each one as a <code>map[string]interface{}</code> like so:</p>\n\n<pre><code>for _, record := range view {\n    log.Printf(\" [===&gt;] Record: %s\", record)\n\n    if rec, ok := record.(map[string]interface{}); ok {\n        for key, val := range rec {\n            log.Printf(\" [========&gt;] %s = %s\", key, val)\n        }\n    } else {\n        fmt.Printf(\"record not a map[string]interface{}: %v\\n\", record)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1608444739, "creation_date": 1608444739, "answer_id": 65377387, "question_id": 31815969, "link": "https://stackoverflow.com/questions/31815969/go-cannot-range-over-my-var-type-interface/65377387#65377387", "title": "Go cannot range over &lt;my var&gt; (type interface {})", "body": "<p>I prefer to declare my own Slice and Map, then I can add methods onto them to\naid in the type assertions. I only included two methods below, but you can add\nmore as needed:</p>\n<pre><code>package main\ntype Map map[string]interface{}\ntype Slice []interface{}\n\nfunc (a Slice) M(n int) Map {\n   return a[n].(map[string]interface{})\n}\n\nfunc (m Map) N(s string) float64 {\n   return m[s].(float64)\n}\n</code></pre>\n<p>Result:</p>\n<pre><code>package main\n\nimport (\n   &quot;encoding/json&quot;\n   &quot;fmt&quot;\n   &quot;strings&quot;\n)\n\nfunc main() {\n   response := strings.NewReader(`[\n      {&quot;month&quot;: 12, &quot;day&quot;: 31},\n      {&quot;month&quot;: 11, &quot;day&quot;: 30}\n   ]`)\n\n   view := Slice{}\n   json.NewDecoder(response).Decode(&amp;view)\n\n   for index := range view {\n      record := view.M(index)\n      for key := range record {\n         val := record.N(key)\n         fmt.Println(key, val)\n      }\n   }\n}\n</code></pre>\n<p><a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Type_declarations</a></p>\n"}], "owner": {"reputation": 37770, "user_id": 1665, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/fb3a3dcfb9e30579cd34020ef35bc979?s=128&d=identicon&r=PG", "display_name": "Rob Wilkerson", "link": "https://stackoverflow.com/users/1665/rob-wilkerson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20705, "favorite_count": 9, "accepted_answer_id": 31816267, "answer_count": 2, "score": 20, "last_activity_date": 1608444739, "creation_date": 1438710608, "last_edit_date": 1438711412, "question_id": 31815969, "link": "https://stackoverflow.com/questions/31815969/go-cannot-range-over-my-var-type-interface", "title": "Go cannot range over &lt;my var&gt; (type interface {})", "body": "<p>I'm in the infant stages of trying to wrap my mind around Go. At the moment, I'm simulating an API request that returns a JSON-formatted string containing an array of objects. I'm trying to figure out the most appropriate way to iterate over each record and access each field. Ultimately, each field will be written to an Excel spreadsheet, but for now I just want to print each field's key &amp; value.</p>\n\n<p>Here's what I have (I'd provide it in the Go Playground, but HTTP requests aren't supported): </p>\n\n<pre><code>    response, err := http.Get(\"http://go-proto.robwilkerson.org/demo.json\")\n    failOnError(err, \"Uh oh\")\n    defer response.Body.Close()\n\n    var view []interface{}\n    json.NewDecoder(response.Body).Decode(&amp;view)\n    log.Printf(\" [x] Pulled JSON: %s\", view)\n    for _, record := range view {\n        log.Printf(\" [===&gt;] Record: %s\", record)\n\n        for key, val := range record {\n            log.Printf(\" [========&gt;] %s = %s\", key, val)\n        }\n    }\n</code></pre>\n\n<p>Everything works fine until the nested loop that attempts to iterate over the <code>map</code> that holds the properties of each record:</p>\n\n<pre><code>cannot range over record (type interface {})\n</code></pre>\n\n<p>I have two questions, I guess:</p>\n\n<ol>\n<li>Is the nested loop the most effective/efficient means of accessing each property of each record?</li>\n<li>What do I need to do to work around that error?</li>\n</ol>\n\n<p><strong>UPDATE</strong></p>\n\n<p>When I dump the data that is decoded into the <code>view</code> variable, this is the logged result:</p>\n\n<pre><code>[\n    map[id:ef14912f-8031-42b3-8c50-7aa612287534 avatar:http://placehold.it/32x32 name:Vilma Hobbs email:vilmahobbs@exiand.com phone:+1 (886) 549-3522 address:471 Dahill Road, Jacksonwald, Alabama, 6026] \n    map[id:1b7bf182-2482-4b8b-8210-9dc9ee51069e avatar:http://placehold.it/32x32 name:Anne Dalton email:annedalton@exiand.com phone:+1 (994) 583-2947 address:660 Macdougal Street, Ticonderoga, Alaska, 7942] \n    map[id:f8027852-f52e-4bbb-bc9d-fb5e34929b40 avatar:http://placehold.it/32x32 name:Amie Ray email:amieray@exiand.com phone:+1 (853) 508-3649 address:878 Kane Street, Derwood, Minnesota, 3826] \n    map[id:b9842ab7-5053-48b4-a991-f5c63af8fb7e avatar:http://placehold.it/32x32 name:Hope Benton email:hopebenton@exiand.com phone:+1 (938) 542-2232 address:396 Osborn Street, Rowe, Massachusetts, 702] \n    map[id:8f9f6d8d-d14e-4ddc-acb2-eb96d3c3d7a8 avatar:http://placehold.it/32x32 name:Janine Kidd email:janinekidd@exiand.com phone:+1 (877) 474-2633 address:173 Manhattan Court, Hall, Virginia, 7376] \n    map[avatar:http://placehold.it/32x32 name:Kristen Yang email:kristenyang@exiand.com phone:+1 (862) 469-3446 address:203 Doughty Street, Westmoreland, Rhode Island, 849 id:210a6ae6-8227-4f26-a47c-448c400f26e9] \n    map[name:Murray Sosa email:murraysosa@exiand.com phone:+1 (814) 549-2536 address:811 Kingsland Avenue, Shepardsville, Hawaii, 9117 id:05f4f6af-19af-4b76-9aa8-9352281cf7d9 avatar:http://placehold.it/32x32] \n    map[phone:+1 (918) 476-2264 address:176 Underhill Avenue, Ebro, Washington, 8099 id:9d21268d-067c-4b16-a6cd-42d184c4c059 avatar:http://placehold.it/32x32 name:Paige Stanton email:paigestanton@exiand.com] \n    map[id:9946c19f-c226-4ff3-b578-57a249f8d0c7 avatar:http://placehold.it/32x32 name:Melisa Oconnor email:melisaoconnor@exiand.com phone:+1 (908) 429-3915 address:768 Wallabout Street, Cotopaxi, Florida, 3388] \n    map[id:ee0b82cb-4990-428b-ba36-088287a404ba avatar:http://placehold.it/32x32 name:Monique Poole email:moniquepoole@exiand.com phone:+1 (925) 564-2690 address:232 Hubbard Place, Islandia, Michigan, 3722]\n]\n</code></pre>\n"}, {"tags": ["c", "go", "iconv", "libiconv"], "comments": [{"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 0, "creation_date": 1438696270, "post_id": 31810729, "comment_id": 51547585, "body": "&quot;//TRANSLIT&quot; is a GNU extension. Maybe the Go bindings are using another non-gnu library?"}], "answers": [{"comments": [{"owner": {"reputation": 813, "user_id": 1776383, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/432288f6717b0bfb4c33d05df34e674c?s=128&d=identicon&r=PG", "display_name": "Aleksandar Jankovi\u0107", "link": "https://stackoverflow.com/users/1776383/aleksandar-jankovi%c4%87"}, "edited": false, "score": 0, "creation_date": 1438696181, "post_id": 31810838, "comment_id": 51547525, "body": "Thank you I understand how transliteration works. &quot;//TRANSLIT&quot; is the parameter that will trigger transliteration. Without it first unknown character will end conversion. Because of that I assume that some transliteration is triggered with library use but with different mapping than with binary."}, {"owner": {"reputation": 59603, "user_id": 60281, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/29ebf39f3857b4fc4f51e93e7b9c4af4?s=128&d=identicon&r=PG", "display_name": "DevSolar", "link": "https://stackoverflow.com/users/60281/devsolar"}, "reply_to_user": {"reputation": 813, "user_id": 1776383, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/432288f6717b0bfb4c33d05df34e674c?s=128&d=identicon&r=PG", "display_name": "Aleksandar Jankovi\u0107", "link": "https://stackoverflow.com/users/1776383/aleksandar-jankovi%c4%87"}, "edited": false, "score": 0, "creation_date": 1438696499, "post_id": 31810838, "comment_id": 51547740, "body": "@AleksandarJankovi\u0107: Those characters in your input string are not representable in Latin-1. The first run did transliterate them into &quot;plain&quot; characters, the second didn&#39;t. So you invoked different functionality. What exactly the difference was is hard to tell, because you didn&#39;t show the actual invocations in your question. (Hint, hint.)"}], "tags": [], "owner": {"reputation": 59603, "user_id": 60281, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/29ebf39f3857b4fc4f51e93e7b9c4af4?s=128&d=identicon&r=PG", "display_name": "DevSolar", "link": "https://stackoverflow.com/users/60281/devsolar"}, "is_accepted": false, "score": 2, "last_activity_date": 1438695401, "creation_date": 1438695401, "answer_id": 31810838, "question_id": 31810729, "link": "https://stackoverflow.com/questions/31810729/why-do-i-get-different-results-when-using-libiconv-over-iconv-binary/31810838#31810838", "title": "Why do I get different results when using libiconv over iconv binary?", "body": "<p>The first output includes transliteration, i.e. certain characters (e.g. <code>\u017e</code>) are transliterated into their not-quite-right \"plain\" counterpart (<code>z</code>) in order to be representable in an encoding that does not support the original character (here, <code>\u017e</code> in Latin-1).</p>\n\n<p>The second output did not transliterate anything, it dropped any characters not representable in the target encoding (<code>\u017e</code>, <code>\u0107</code>, ... in Latin-1).</p>\n\n<p>Thus, I suspect you can the binary with different options than the library. Not familiar with <code>libiconv</code>, it seems that the <code>//TRANSLIT</code> part was omitted or is not supported by the function you used...?</p>\n"}, {"tags": [], "owner": {"reputation": 782, "user_id": 4634344, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e50eb89ee938625107a73e1ede71f639?s=128&d=identicon&r=PG&f=1", "display_name": "Diego", "link": "https://stackoverflow.com/users/4634344/diego"}, "is_accepted": false, "score": 1, "last_activity_date": 1477079597, "last_edit_date": 1477079597, "creation_date": 1442697517, "answer_id": 32673342, "question_id": 31810729, "link": "https://stackoverflow.com/questions/31810729/why-do-i-get-different-results-when-using-libiconv-over-iconv-binary/32673342#32673342", "title": "Why do I get different results when using libiconv over iconv binary?", "body": "<p>Transliteration is locale dependent. May be your libiconv is lacking/has wrong locale. Or the locale you are using there has no transliteration configured.</p>\n\n<p>Please check <a href=\"http://sourceware.org/bugzilla/show_bug.cgi?id=2872\" rel=\"nofollow\">this bug report</a> as it has a few examples and a discussion on this topic.</p>\n"}], "owner": {"reputation": 813, "user_id": 1776383, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/432288f6717b0bfb4c33d05df34e674c?s=128&d=identicon&r=PG", "display_name": "Aleksandar Jankovi\u0107", "link": "https://stackoverflow.com/users/1776383/aleksandar-jankovi%c4%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 538, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1477079597, "creation_date": 1438695133, "last_edit_date": 1438698977, "question_id": 31810729, "link": "https://stackoverflow.com/questions/31810729/why-do-i-get-different-results-when-using-libiconv-over-iconv-binary", "title": "Why do I get different results when using libiconv over iconv binary?", "body": "<p>Here is the sample string that I am using encoded in UCS-2:</p>\n\n<pre><code>abvgd\u0111e\u017ezijklmnjoprst\u0107uvhc\u010dd\u017e\u01611234567890*+;'\n</code></pre>\n\n<p>When converting UCS-2 to iso ISO-8859-1//TRANSLIT with iconv binary from file to file I get:</p>\n\n<pre><code>abvgd?ezzijklmnjoprstcuvhccdzs1234567890*+;'\n</code></pre>\n\n<p>Now I want to use libiconv in go project. I am using this library github.com/qiniu/iconv as bindings for libiconv. But when using bindings I get:</p>\n\n<pre><code>abvgd?e?zijklmnjoprst?uvhc?d??1234567890*+;'\n</code></pre>\n\n<p>It's like different transliteration rules apply when using library inside go.</p>\n\n<p>I examined go bindings library and everything seems in order; only bytes are passed around so no \"loss of information\" could happen there.</p>\n\n<p>Is there anything else that I should be aware of when using libiconv? Is there some environment context that could trigger different transliteration behaviour?</p>\n\n<hr>\n\n<p>EDIT (additional explanation about invocation):</p>\n\n<p>I have two files \"ucs-2.txt\" and \"latin1.txt\". ucs-2.txt file contains UCS-2 encoded string and latin1.txt contains string got by running:</p>\n\n<pre><code>iconv -f UCS2 -t ISO-8859-1//TRANSLIT --verbose data/encoding/ucs-2.txt &gt; data/encoding/latin1.txt\n</code></pre>\n\n<p>In go I use these lines to pull content from these files:</p>\n\n<pre><code>var err error\nucs2, err = ioutil.ReadFile(\"data/encoding/ucs-2.txt\")\nif err != nil {\n    log.Fatal(err)\n}\nlatin1, err = ioutil.ReadFile(\"data/encoding/latin1.txt\")\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>This function is doing conversion:</p>\n\n<pre><code>func convertEnc(content []byte) ([]byte, error) {\n    cd, err := iconv.Open(\"ISO-8859-1//TRANSLIT\", \"UCS2\")\n    if err != nil {\n        return nil, err\n    }\n    defer cd.Close()\n    var outbuf [255]byte\n    res, _, err := cd.Conv(content, outbuf[:])\n    log.Printf(\"result: %+q\", res)\n    return res, err\n}\n</code></pre>\n\n<p>And I am using DeepEqual for testing:</p>\n\n<pre><code>reflect.DeepEqual(res, latin1)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1438672379, "post_id": 31802351, "comment_id": 51532191, "body": "Perhaps the answer to <a href=\"http://stackoverflow.com/questions/17948827/reusing-http-connections-in-golang?rq=1\" title=\"reusing http connections in golang\">stackoverflow.com/questions/17948827/&hellip;</a> may be of help."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1438679860, "post_id": 31802351, "comment_id": 51536451, "body": "Hm, I don&#39;t know, it doesn&#39;t even seem like there was a conclusion in that question other than to be sure you read the whole thing, and I am actually using the method that answer specifies <code>io.Copy(ioutil.Discard, r.Body)</code> before calling <code>Close()</code> just to be certain it is all read"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438684535, "post_id": 31802351, "comment_id": 51539652, "body": "Is your program actually blocked somewhere? This just looks like the keep alive connections."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1438685728, "post_id": 31802351, "comment_id": 51540365, "body": "I was just noticing that now... Looks like the problem might actually be with a <code>sync.WaitGroup</code> ;)"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438696203, "post_id": 31807982, "comment_id": 51547543, "body": "I assume when you say that you have <code>KeepAlive: 0</code>, you&#39;re  referring to the setting in the network Dialer, since there&#39;s no setting like that in http. That is for tcp keepalive, which is something entirely different from http keepalive, which are just connections that can be reused."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438735032, "post_id": 31807982, "comment_id": 51567891, "body": "Oh, thanks for that, didn&#39;t know that, I did mean the Dialer."}], "tags": [], "owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "is_accepted": true, "score": 0, "last_activity_date": 1438687360, "creation_date": 1438687360, "answer_id": 31807982, "question_id": 31802351, "link": "https://stackoverflow.com/questions/31802351/http-clients-hanging/31807982#31807982", "title": "HTTP Clients Hanging", "body": "<p>Turns out these weren't the problem, they appear to be just keep alive messages (although strangely I had <code>KeepAlive: 0</code> set?). Misplaced <code>Done()</code> on a <code>sync.WaitGroup</code> was the real culprit. I guess I started to look at every <code>Wait()</code> as being called by the <code>http.Client</code> instead of the <code>sync.WaitGroup</code>.</p>\n"}], "owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1892, "favorite_count": 1, "accepted_answer_id": 31807982, "answer_count": 1, "score": 3, "last_activity_date": 1438687360, "creation_date": 1438670414, "question_id": 31802351, "link": "https://stackoverflow.com/questions/31802351/http-clients-hanging", "title": "HTTP Clients Hanging", "body": "<p>I have some code that makes tons of simple HTTP GET requests</p>\n\n<p>The client that I am using is set up like this:</p>\n\n<pre><code>type client struct {\n    *http.Client\n    // other stuff in here\n}\n\nfunc NewClient() client {\n    var c client\n    c.Client = &amp;http.Client{\n        CheckRedirect: func(req *http.Request, via []*http.Request) error {\n            req.Header.Set(\"User-Agent\", c.userAgent)\n            return nil\n        },\n        Transport: &amp;http.Transport{\n            Dial: func(network, addr string) (net.Conn, error) {\n                return net.DialTimeout(network, addr, 2*time.Second)\n            },\n            TLSHandshakeTimeout: 2 * time.Second,\n            TLSClientConfig: &amp;tls.Config{\n                InsecureSkipVerify: true,\n            },\n        },\n        Timeout: 2 * time.Second,\n    }\n    return c\n}\n</code></pre>\n\n<p>As you can see I am really trying to make sure I get timeouts on bad connections. I make the requests like this:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", url, nil)\n</code></pre>\n\n<p>Nothing out of the ordinary there. But after some time I get these goroutines building up and just blocking, an example after a panic to get the trace:</p>\n\n<pre><code>goroutine 325 [select, 4 minutes]:\nnet/http.(*persistConn).writeLoop(0xc208075130)\n    /usr/local/go/src/net/http/transport.go:945 +0x41d\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:661 +0xcbc\n</code></pre>\n\n<p>and</p>\n\n<pre><code>goroutine 418 [IO wait, 4 minutes]:\nnet.(*pollDesc).Wait(0xc2083c7870, 0x72, 0x0, 0x0)\n    /usr/local/go/src/net/fd_poll_runtime.go:84 +0x47\nnet.(*pollDesc).WaitRead(0xc2083c7870, 0x0, 0x0)\n    /usr/local/go/src/net/fd_poll_runtime.go:89 +0x43\nnet.(*netFD).Read(0xc2083c7810, 0xc20857e000, 0x1000, 0x1000, 0x0, 0x7fbb634c3bb0, 0xc2084d87a0)\n    /usr/local/go/src/net/fd_unix.go:242 +0x40f\nnet.(*conn).Read(0xc208116020, 0xc20857e000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/net.go:121 +0xdc\nnet/http.noteEOFReader.Read(0x7fbb634c7288, 0xc208116020, 0xc208075b28, 0xc20857e000, 0x1000, 0x1000, 0x678100, 0x0, 0x0)\n    /usr/local/go/src/net/http/transport.go:1270 +0x6e\nnet/http.(*noteEOFReader).Read(0xc2083d84c0, 0xc20857e000, 0x1000, 0x1000, 0xc208017600, 0x0, 0x0)\n    &lt;autogenerated&gt;:125 +0xd4\nbufio.(*Reader).fill(0xc20858c0c0)\n    /usr/local/go/src/bufio/bufio.go:97 +0x1ce\nbufio.(*Reader).Peek(0xc20858c0c0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/bufio/bufio.go:132 +0xf0\nnet/http.(*persistConn).readLoop(0xc208075ad0)\n    /usr/local/go/src/net/http/transport.go:842 +0xa4\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:660 +0xc9f\n</code></pre>\n\n<p>I've been trying to watch <code>netstat</code> and <code>tcpdump</code> to see what they're actually getting stuck on, but it isn't proving very useful right now. Before jumping into the source or getting more diligent with my monitoring I figured I'd toss this question out there. What is going on here?..</p>\n\n<p>Also why are my timeouts not working? Is there another timeout that I need to set? (As you can see I just keep setting every one I can find, there is also the Response Header timeout which maybe I should set too? I thought the Timeout in the http.Client struct was pretty solid though and would timeout anything)</p>\n\n<p>Lastly, is there a way to set the client port that I am missing so I can better monitor which connections are having an issue?</p>\n\n<p>EDIT: For the record I am also pretty certain I am reading/closing the response body for every request. Unless there are some that are somehow hanging from the timeout or something I don't know of, but if that is the only solution someone sees I will look again.</p>\n"}, {"tags": ["validation", "go", "go-gin"], "comments": [{"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 2, "creation_date": 1438671072, "post_id": 31800843, "comment_id": 51531483, "body": "You should gofmt your code and actually include what you have, this can&#39;t be your real code: <code>file, _ , err := c.Request.FormFile(&quot;file&quot;); panic(err)</code>  Anyway, the error is pretty clear, <code>2015&#47;08&#47;04 13:19:10 Panic recovery -&gt; runtime error: invalid memory address or nil pointer dereference</code> you&#39;re most likely trying to dereference a <code>nil</code>."}, {"owner": {"reputation": 1912, "user_id": 331160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/19bb055a5d678985c2757b9c20dd56bf?s=128&d=identicon&r=PG", "display_name": "Kunal Jha", "link": "https://stackoverflow.com/users/331160/kunal-jha"}, "reply_to_user": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1438671806, "post_id": 31800843, "comment_id": 51531892, "body": "@user3591723 If you see the error <code>D:&#47;code&#47;src&#47;exmp&#47;serverexmaple.go:45 (0x40168f) displayTable: _, err = io.Copy(out, file)</code> which matches with the code is the problem area. The problem is when the file value is nil it doesn&#39;t redirect to the error page instead it executes the rest of the code and hence getting the panic when trying to read a nil value. Is this common behaviour for gin framework ?"}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 1, "creation_date": 1438678772, "post_id": 31800843, "comment_id": 51535795, "body": "I&#39;m not sure what is common behavior for gin, why not just return from your function?  Also, why are you redefining <code>panic</code>?.. That is a builtin function and it is kinda important for readability to not have that redefined."}], "answers": [{"comments": [{"owner": {"reputation": 1912, "user_id": 331160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/19bb055a5d678985c2757b9c20dd56bf?s=128&d=identicon&r=PG", "display_name": "Kunal Jha", "link": "https://stackoverflow.com/users/331160/kunal-jha"}, "edited": false, "score": 0, "creation_date": 1438682049, "post_id": 31805425, "comment_id": 51537969, "body": "Thanks for the point #1 and #2 will keep in mind in future. But if I add the <code>return</code> statement after ` c.HTML(http.StatusInternalServerError, &quot;index.tmpl&quot;, gin.H{&quot;title&quot;: &quot;Select the input file&quot;,&quot;error&quot; : &quot;Please select the input file.&quot;,}) ` the panic is not shown and the redirection seems to work."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "reply_to_user": {"reputation": 1912, "user_id": 331160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/19bb055a5d678985c2757b9c20dd56bf?s=128&d=identicon&r=PG", "display_name": "Kunal Jha", "link": "https://stackoverflow.com/users/331160/kunal-jha"}, "edited": false, "score": 0, "creation_date": 1438686905, "post_id": 31805425, "comment_id": 51541072, "body": "Ha, obviously! In the original code you check that the file is nil and call <code>_, err = io.Copy(out, file)</code> even though it is nil. Of course you the return should be added."}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": false, "score": 3, "last_activity_date": 1438680201, "last_edit_date": 1495542735, "creation_date": 1438680201, "answer_id": 31805425, "question_id": 31800843, "link": "https://stackoverflow.com/questions/31800843/multipart-file-upload-validation-in-gin-gonic/31805425#31805425", "title": "Multipart File Upload Validation in gin-gonic", "body": "<ol>\n<li>Please do not redefine <code>panic</code>. It will confuse everyone who knows how <code>panic</code> works.</li>\n<li>Comparison with nil is a bit tricky in Go. It may work not as you expect: <a href=\"https://stackoverflow.com/questions/13476349/check-for-nil-and-nil-interface-in-go\">Check for nil and nil interface in Go</a>. <code>FormFile</code> returns interface so you have to cast it to underlying structure if you want to check it with nil OR use the second parameter, type of which is available.</li>\n<li>This is not specific to GIN, it is part of the Go's HTTP implementation: <a href=\"http://golang.org/pkg/net/http/#Request.FormFile\" rel=\"nofollow noreferrer\">http://golang.org/pkg/net/http/#Request.FormFile</a></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1912, "user_id": 331160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/19bb055a5d678985c2757b9c20dd56bf?s=128&d=identicon&r=PG", "display_name": "Kunal Jha", "link": "https://stackoverflow.com/users/331160/kunal-jha"}, "is_accepted": true, "score": 0, "last_activity_date": 1438744964, "creation_date": 1438744964, "answer_id": 31822890, "question_id": 31800843, "link": "https://stackoverflow.com/questions/31800843/multipart-file-upload-validation-in-gin-gonic/31822890#31822890", "title": "Multipart File Upload Validation in gin-gonic", "body": "<p>I understand that I have made mistake with the <code>panic</code> handling. The validation is working if I add the return statement after the c.HTML.\nThis will stop the function from executing the rest of the code.\nThanks to @AlexAtNet for his advice and I will keep in mind in future.</p>\n\n<pre><code>if file == nil {\n    log.Println(\"File is nil.\")\n    log.Println(err)\n    log.Println(\"*****\")\n    c.HTML(http.StatusInternalServerError, \"index.tmpl\", gin.H{\n        \"title\": \"Select the input file\",\"error\" : \"Please select the input file.\",\n    })   \n    return \n} \n</code></pre>\n"}], "owner": {"reputation": 1912, "user_id": 331160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/19bb055a5d678985c2757b9c20dd56bf?s=128&d=identicon&r=PG", "display_name": "Kunal Jha", "link": "https://stackoverflow.com/users/331160/kunal-jha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3702, "favorite_count": 0, "accepted_answer_id": 31822890, "answer_count": 2, "score": 0, "last_activity_date": 1490918536, "creation_date": 1438663358, "last_edit_date": 1490918536, "question_id": 31800843, "link": "https://stackoverflow.com/questions/31800843/multipart-file-upload-validation-in-gin-gonic", "title": "Multipart File Upload Validation in gin-gonic", "body": "<p>I am trying to add validation for the go based web application based on  GIN framework. On the web page I am selecting a file and submitting and the server is processing it.\nOn the server side I am try to add validation to check if the file has been given or not. If not then redirect back to original page.</p>\n\n<pre><code>    func panic(err error)  {\n        if err != nil {\n            log.Println(err)\n        }\n    }\n\n    func displayTable (c *gin.Context) {    \n    file, _ , err := c.Request.FormFile(\"file\")\n    panic(err)\n    if file == nil {\n        log.Println(\"File is nil.\")\n        log.Println(err)\n        log.Println(\"*****\")\n        c.HTML(http.StatusInternalServerError, \"index.tmpl\", gin.H{\n            \"title\": \"Select the input file\",\"error\" : \"Please select the input file.\",\n        })      \n    } else {\n        defer file.Close()\n    }\n    filename := strconv.FormatInt(time.Now().Unix(),10) \n    out, err := os.Create(\"./tmp/\"+filename+\".xml\")\n    panic(err)\n    defer out.Close()\n    _, err = io.Copy(out, file)\n    panic(err)\n    xmlFile, err := os.Open(\"./tmp/\"+filename+\".xml\")\n    panic(err)\n    defer xmlFile.Close()\n\n    // Other Implementation Details \n}\n</code></pre>\n\n<p>Even after providing the handling I am getting a panic in the go code. Please let me know what in the implementation am I missing.</p>\n\n<p>Thanks.</p>\n\n<pre><code>    http: no such file\n    File is nil.\n    http: no such file\n    *****\n    2015/08/04 13:19:10 Panic recovery -&gt; runtime error: invalid memory address or nil pointer dereference\n    c:/go/src/runtime/panic.go:387 (0x414d36)\n    c:/go/src/runtime/panic.go:42 (0x4142a5)\n    c:/go/src/runtime/os_windows.go:42 (0x414066)\n    c:/go/src/io/io.go:362 (0x45268f)\n    D:/code/src/exmp/serverexmaple.go:45 (0x40168f)\n            displayTable: _, err = io.Copy(out, file)\n    D:/code/src/github.com/gin-gonic/gin/context.go:95 (0x49f8ea)\n            (*Context).Next: c.handlers[c.index](c)\n    D:/code/src/github.com/gin-gonic/gin/logger.go:56 (0x4ac490)\n            func.007: c.Next()\n    D:/code/src/github.com/gin-gonic/gin/context.go:95 (0x49f8ea)\n            (*Context).Next: c.handlers[c.index](c)\n    D:/code/src/github.com/gin-gonic/gin/recovery.go:43 (0x4acc80)\n            func.009: c.Next()\n    D:/code/src/github.com/gin-gonic/gin/context.go:95 (0x49f8ea)\n            (*Context).Next: c.handlers[c.index](c)\n    D:/code/src/github.com/gin-gonic/gin/gin.go:292 (0x4a46d5)\n            (*Engine).handleHTTPRequest: context.Next()\n    D:/code/src/github.com/gin-gonic/gin/gin.go:273 (0x4a4459)\n            (*Engine).ServeHTTP: engine.handleHTTPRequest(c)\n    c:/go/src/net/http/server.go:1703 (0x468415)\n    c:/go/src/net/http/server.go:1204 (0x466408)\n    c:/go/src/runtime/asm_386.s:2287 (0x438ea1)\n</code></pre>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 4870, "user_id": 419032, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b56395d5710fb694ac618fb38cf99a53?s=128&d=identicon&r=PG", "display_name": "Brownbay", "link": "https://stackoverflow.com/users/419032/brownbay"}, "is_accepted": true, "score": 1, "last_activity_date": 1438666503, "creation_date": 1438666503, "answer_id": 31801384, "question_id": 31800838, "link": "https://stackoverflow.com/questions/31800838/go-template-passing-data-from-one-to-another/31801384#31801384", "title": "Go template Passing data from one to another", "body": "<p>Unfortunately, this is not possible with current version of Go's text/template or html/template package.</p>\n\n<p>You would need to append \"Name\" and \"UserName\" to <code>ctx.Data</code> on the Go side for them to be accessible with those exact names in template B.</p>\n\n<p>You may want to look into pongo2, a Django-like template for Go (<a href=\"https://github.com/flosch/pongo2\" rel=\"nofollow\">https://github.com/flosch/pongo2</a>)</p>\n\n<p>Your specific use case in pongo2 is documented here: <a href=\"https://github.com/flosch/pongo2/blob/master/template_tests/includes.tpl\" rel=\"nofollow\">https://github.com/flosch/pongo2/blob/master/template_tests/includes.tpl</a></p>\n"}], "owner": {"reputation": 2527, "user_id": 3476121, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/1c621706e2e37eed4f82f074af9f706a?s=128&d=identicon&r=PG", "display_name": "sadlil", "link": "https://stackoverflow.com/users/3476121/sadlil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 2, "accepted_answer_id": 31801384, "answer_count": 1, "score": 3, "last_activity_date": 1438666503, "creation_date": 1438663342, "question_id": 31800838, "link": "https://stackoverflow.com/questions/31800838/go-template-passing-data-from-one-to-another", "title": "Go template Passing data from one to another", "body": "<p>I have to Go Template file. I need to pass some value from one template to another. IE</p>\n\n<p>Template A have two variable with .Name and .Type. The values are passing from go code with ctx.Data. Template A references Template B with</p>\n\n<pre><code>{{ template \"B\" . }}\n</code></pre>\n\n<p>But in Template B. .Name and .Type are not having the same name. I can not change Template B s variable references because Tempalte B is used directly with those variable.\nTemplate B looks like this.</p>\n\n<pre><code>Username : {{ .UserName }}\nType : {{ .UserType }}\n</code></pre>\n\n<p>Now my question is how can i change the .Name in template A to .UserName?</p>\n\n<pre><code>{{ tempalte \"B\" .Name as .UserName }}\n</code></pre>\n\n<p>is there something like this????</p>\n"}, {"tags": ["sockets", "go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438663034, "post_id": 31800692, "comment_id": 51528344, "body": "Oh, good question. I can&#39;t explain that <i>exact</i> behavior, but something very much like this can happen because of TCP TIME_WAIT. (Ports remain reserved briefly after use, and if you run out of ports, you&#39;re hosed.) Will try and find a resource about it."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438664688, "post_id": 31800692, "comment_id": 51528825, "body": "Hmf, I&#39;m less sure the more I look. First, here&#39;s background on TCP TIME_WAIT, which can&#39;t hurt you regardless: <a href=\"http://stackoverflow.com/questions/337115/setting-time-wait-tcp\">stackoverflow.com/questions/337115/setting-time-wait-tcp</a>"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438665039, "post_id": 31800692, "comment_id": 51528927, "body": "In theory, I&#39;d think Go&#39;s support for keepalives would keep the number of connections small. If the server only allowed, say, 10 requests on a connection (or something on the Go side imposed that limit), you could end up making 12k connections/worker, and you couldn&#39;t reuse their ports for a bit because of the left-over &quot;ghosts&quot; of connections in TIME_WAIT state. But that doesn&#39;t line up with a higher rate making the run succeed sometimes; a longer delay would <i>help</i> you then, since it would allow time for TIME_WAIT to expire on old connections."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438665363, "post_id": 31800692, "comment_id": 51529036, "body": "If shortening the delay somehow caused Go to be able to reuse its connections more often, that could explain how it apparently helped to lower it. But also note: since TIME_WAIT state lasts for a while (possibly 120 seconds, seemingly the default <a href=\"http://stackoverflow.com/questions/1216267/ab-program-freezes-after-lots-of-requests-why\">MSL</a> on Mac OS X), when you run two tests the leftovers from test 1 could affect test 2, which could be adding noise to your experiments."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438665671, "post_id": 31800692, "comment_id": 51529146, "body": "Finally, as an extra data point (from the <a href=\"http://stackoverflow.com/questions/1216267/ab-program-freezes-after-lots-of-requests-why\">Q linked above</a>), you have a total of 16384 ports for connections. If they&#39;re all in use or in TIME_WAIT state, you&#39;re stuck. You could see if lowering your MSL magically cures the problem (which at least gives you a diagnosis), and/or either dig into how keepalive works on the server (or in the Go stdlib), or try to observe when connections are actually being made (would be strace on Linux, not sure what you do on OS X)."}, {"owner": {"reputation": 6354, "user_id": 4258430, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7a2d5075177b2ff473c38f6d8fb64894?s=128&d=identicon&r=PG", "display_name": "Allen Luce", "link": "https://stackoverflow.com/users/4258430/allen-luce"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438672037, "post_id": 31800692, "comment_id": 51532008, "body": "Why wouldn&#39;t this program make only 10 TCP connections during the entire run time? I&#39;d expect connections to be used continuously <a href=\"https://github.com/golang/go/blob/release-branch.go1.4/src/net/http/transport.go#L891\" rel=\"nofollow noreferrer\">except in certain cases</a> that I don&#39;t expect to hit with this program. It should never get to the point where the number of active sockets is a worry. I&#39;m not going to worry about system resource limitations until I have a handle on why there are more than 10 connections being made."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1438674839, "post_id": 31800692, "comment_id": 51533541, "body": "Hrm, eyeballing that source file, one possibility is <code>MaxIdleConnsPerHost</code>. That limit is per-<code>Client</code>, and you&#39;re sharing one among the ten workers. It would also be consistent with a very fast ticker sometimes completing the test: you&#39;ll less often have 3+ conns sitting idle if you put your connections back to work 1000x more quickly. Straightforward test is whether either an artificially increased max or a client per worker changes the connection behavior."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438675488, "post_id": 31800692, "comment_id": 51533888, "body": "(<code>MaxIdleConns</code> is enforced in <code>putIdleConn</code> which is called on L913 as part of the expression sent to <code>waitForBodyRead</code>, which then goes into <code>alive</code> on L929. Hopeful about the <code>MaxIdleConns</code> idea, but if it doesn&#39;t pan out, the best I&#39;ve got is to, ugh, hack a copy of <code>net&#47;http</code> to start logging the various bools that go into the close decision until you find which one is to blame.)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438694230, "post_id": 31800692, "comment_id": 51546074, "body": "Currently, osx puts released loopback ports into a (as far as I can find) an unmarked TIME_WAIT queue for 15 seconds. You won&#39;t see them with netstat, but you won&#39;t be able to make more than 16384 connections in 15 seconds without port allocation errors."}], "answers": [{"comments": [{"owner": {"reputation": 6354, "user_id": 4258430, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7a2d5075177b2ff473c38f6d8fb64894?s=128&d=identicon&r=PG", "display_name": "Allen Luce", "link": "https://stackoverflow.com/users/4258430/allen-luce"}, "edited": false, "score": 0, "creation_date": 1438709776, "post_id": 31810116, "comment_id": 51557077, "body": "That&#39;s totally it!  Setting <code>MaxIdleConnsPerHost</code> to 10 in the transport makes it so only 10 connections are ever made during the lifetime of that program. Thanks!"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1438698544, "last_edit_date": 1438698544, "creation_date": 1438693353, "answer_id": 31810116, "question_id": 31800692, "link": "https://stackoverflow.com/questions/31800692/multiple-http-requests-gives-cant-assign-requested-address-unless-sped-up/31810116#31810116", "title": "multiple http.Requests gives &quot;can&#39;t assign requested address,&quot; unless sped up", "body": "<p>The error <code>can't assign requested address</code> during a Dial is caused by running out of local ephemeral ports to use for the client connection. The reason you're running out of ports, is simply because you're making too many connections, too fast. What happens when you speed up the connection rate, is that you start to catch the idle connections going back into the pool before they are closed. There's a code path that catches these newly idle connections during a Dial to return a connection more quickly, but there's no way to deterministically catch these connections every time.</p>\n\n<p>What you need to do since you're connecting to only one host (as discussed in the comments), is to set the <code>Transport.MaxIdleConnsPerHost</code> a lot higher. You'll need to see where it balances out, between too many open connections, and when you start recycling them too quickly.</p>\n\n<p>It may even be advantageous to have a semephore on client to prevent too many simultaneous connections, which would start causing the connections to again recycle too quickly. </p>\n"}], "owner": {"reputation": 6354, "user_id": 4258430, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7a2d5075177b2ff473c38f6d8fb64894?s=128&d=identicon&r=PG", "display_name": "Allen Luce", "link": "https://stackoverflow.com/users/4258430/allen-luce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2787, "favorite_count": 0, "accepted_answer_id": 31810116, "answer_count": 1, "score": 2, "last_activity_date": 1438705810, "creation_date": 1438662370, "last_edit_date": 1438705810, "question_id": 31800692, "link": "https://stackoverflow.com/questions/31800692/multiple-http-requests-gives-cant-assign-requested-address-unless-sped-up", "title": "multiple http.Requests gives &quot;can&#39;t assign requested address,&quot; unless sped up", "body": "<p>With the client code below (and a listening web server on port 8088 on this box), I am rarely able to get more than 23000 hits before this error pops up from the <code>client.Get()</code>:</p>\n\n<pre><code>panic: Get http://localhost:8088/: dial tcp 127.0.0.1:8088: can't assign requested address\n</code></pre>\n\n<p>Oddly, if I increase the timer delay (i.e. from a millisecond to a microsecond) it takes far more hits to get the error, 170,000 or even more.</p>\n\n<p>Looking at the network traffic, each client connection is used only a handful of times before it disconnects (i.e. the client side sends a FIN). So clearly it's making many TCP connections and overflowing the socket table. Given that the Golang HTTP docs say that keepalives are enabled by default, I would't expect this.  A kernel trace shows no errors being emitted by the underlying socket before the close (other than EAGAIN, which is expected and doesn't always precede a socket close).</p>\n\n<p>This is with Go 1.4.2 on OSX (14.4.0). Why are the client connections not being reused the whole time?</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"net/http\"\n    \"runtime\"\n    \"sync\"\n    \"time\"\n)\n\nvar reqnum = 0\n\nfunc hit(client *http.Client) {\n    resp, err := client.Get(\"http://localhost:8088/\")\n    if err != nil {\n        println(reqnum)\n        panic(err)\n    }\n    defer resp.Body.Close()\n    _, err = ioutil.ReadAll(resp.Body)\n    if err != nil {\n        panic(err)\n    }\n    reqnum++ // not thread safe, but shouldn't cause errors.\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    runtime.GOMAXPROCS(runtime.NumCPU())\n    client := &amp;http.Client{}\n    for i := 0; i &lt; 10; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            ticker := time.NewTicker(time.Microsecond * 1000)\n            for j := 0; j &lt; 120000; j++ {\n                &lt;-ticker.C\n                hit(client)\n            }\n            ticker.Stop()\n        }()\n    }\n    wg.Wait()\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 21495, "user_id": 62288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01239dcaa443502ce71059f5308bca74?s=128&d=identicon&r=PG", "display_name": "Dave W. Smith", "link": "https://stackoverflow.com/users/62288/dave-w-smith"}, "edited": false, "score": 1, "creation_date": 1438649831, "post_id": 31799021, "comment_id": 51525383, "body": "Post the bits of code that you&#39;re using to (attempt to) write entities to the datastore. Also, what are you seeing (or not seeing) that leads you to believe that nothing is getting saved?"}, {"owner": {"reputation": 21495, "user_id": 62288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01239dcaa443502ce71059f5308bca74?s=128&d=identicon&r=PG", "display_name": "Dave W. Smith", "link": "https://stackoverflow.com/users/62288/dave-w-smith"}, "edited": false, "score": 0, "creation_date": 1438656537, "post_id": 31799021, "comment_id": 51526850, "body": "Any logging on a non-nil <code>err</code>?"}, {"owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "reply_to_user": {"reputation": 21495, "user_id": 62288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01239dcaa443502ce71059f5308bca74?s=128&d=identicon&r=PG", "display_name": "Dave W. Smith", "link": "https://stackoverflow.com/users/62288/dave-w-smith"}, "edited": false, "score": 0, "creation_date": 1438656668, "post_id": 31799021, "comment_id": 51526879, "body": "I&#39;m still new to GAE, and not really sure where to see output from log.Printf (or is there an equivalent from the appengine package?"}, {"owner": {"reputation": 115, "user_id": 1204580, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/04de35a6b83c8a570575aaf0764b8c00?s=128&d=identicon&r=PG", "display_name": "Austin Dizzy", "link": "https://stackoverflow.com/users/1204580/austin-dizzy"}, "edited": false, "score": 1, "creation_date": 1438660344, "post_id": 31799021, "comment_id": 51527664, "body": "For your logging, you&#39;ll need to use the logging functions - Debugf, Infof, Errorf, Warningf, Criticalf - from a valid request context (docs found in <a href=\"https://cloud.google.com/appengine/docs/go/reference#Context\" rel=\"nofollow noreferrer\">appengine.Context</a>) to log in App Engine. In your dev server, you&#39;ll see these logs in your terminal output. In production App Engine, these logs are stored in your Google Cloud Console for your project under Monitoring &gt; Logs."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 1, "creation_date": 1438691354, "post_id": 31799021, "comment_id": 51544050, "body": "Post getTweetKey or just set the parent to nil and re-try."}, {"owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1438717519, "post_id": 31799021, "comment_id": 51561118, "body": "@sridhar updated code is posted."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 1, "creation_date": 1438725245, "post_id": 31799021, "comment_id": 51564987, "body": "Since Google App Engine doesn&#39;t make the standard http.Transport available, it&#39;s necessary to tell Anaconda to use a different client context. I assume you&#39;re doing this or else it probably won&#39;t work on the dev server either."}, {"owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1438736148, "post_id": 31799021, "comment_id": 51568126, "body": "@Sridhar, the code to download tweets is in other code, but I am using alternate transport."}, {"owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "edited": false, "score": 0, "creation_date": 1438791073, "post_id": 31799021, "comment_id": 51596884, "body": "Did some more work on this last night and it appears that the error was elsewhere in my code and I wasn&#39;t getting to the datastore code because I misunderstood how GAE handles Go routines.  I&#39;m upvoting all comments in thanks for the help, but can&#39;t rightfully accept any of the answers.  Thank you all for your help."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1438989781, "post_id": 31799021, "comment_id": 51693523, "body": "Great! Glad to hear."}], "answers": [{"comments": [{"owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "edited": false, "score": 0, "creation_date": 1438650717, "post_id": 31799111, "comment_id": 51525545, "body": "So, add transactions or wait for it and it will be there eventually?"}, {"owner": {"reputation": 1620, "user_id": 4316235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b46c2d21f13517cd4460f4513815fd46?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff Deskins", "link": "https://stackoverflow.com/users/4316235/jeff-deskins"}, "reply_to_user": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "edited": false, "score": 1, "creation_date": 1438654872, "post_id": 31799111, "comment_id": 51526484, "body": "@MrWizard54 - How long are you waiting to see the data?  Even with eventual consistency, the data is usually visible by queries within one second."}, {"owner": {"reputation": 21495, "user_id": 62288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01239dcaa443502ce71059f5308bca74?s=128&d=identicon&r=PG", "display_name": "Dave W. Smith", "link": "https://stackoverflow.com/users/62288/dave-w-smith"}, "edited": false, "score": 0, "creation_date": 1438655822, "post_id": 31799111, "comment_id": 51526701, "body": "Usually, but the latency tail can sometimes get long."}, {"owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "edited": false, "score": 0, "creation_date": 1438655937, "post_id": 31799111, "comment_id": 51526723, "body": "At this point I&#39;m exceeding two hours since I ran a Put(), but still do not see any data."}, {"owner": {"reputation": 21495, "user_id": 62288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01239dcaa443502ce71059f5308bca74?s=128&d=identicon&r=PG", "display_name": "Dave W. Smith", "link": "https://stackoverflow.com/users/62288/dave-w-smith"}, "edited": false, "score": 0, "creation_date": 1438666521, "post_id": 31799111, "comment_id": 51529481, "body": "Do you see anything using the admin console Datastore Viewer?"}], "tags": [], "owner": {"reputation": 21495, "user_id": 62288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01239dcaa443502ce71059f5308bca74?s=128&d=identicon&r=PG", "display_name": "Dave W. Smith", "link": "https://stackoverflow.com/users/62288/dave-w-smith"}, "is_accepted": true, "score": 2, "last_activity_date": 1438650352, "creation_date": 1438650352, "answer_id": 31799111, "question_id": 31799021, "link": "https://stackoverflow.com/questions/31799021/google-app-engine-difference-between-local-dev-server-and-deployed-server/31799111#31799111", "title": "Google App Engine - Difference between local Dev server and deployed server", "body": "<p>You're seeing the (often initially confusing) effect of \"eventual consistency\". Entities that are written outside of a transaction take a while to be visible to queries.</p>\n\n<p><a href=\"https://cloud.google.com/datastore/docs/articles/balancing-strong-and-eventual-consistency-with-google-cloud-datastore/\" rel=\"nofollow\">https://cloud.google.com/datastore/docs/articles/balancing-strong-and-eventual-consistency-with-google-cloud-datastore/</a> explains the problem. <a href=\"https://cloud.google.com/appengine/docs/go/datastore/transactions\" rel=\"nofollow\">https://cloud.google.com/appengine/docs/go/datastore/transactions</a> is specific to go.</p>\n"}, {"comments": [{"owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "edited": false, "score": 0, "creation_date": 1438660997, "post_id": 31800393, "comment_id": 51527818, "body": "The Dev Server is creating the index.yaml  - kind: LinkTweet   ancestor: yes   properties:   - name: CreatedTime"}], "tags": [], "owner": {"reputation": 115, "user_id": 1204580, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/04de35a6b83c8a570575aaf0764b8c00?s=128&d=identicon&r=PG", "display_name": "Austin Dizzy", "link": "https://stackoverflow.com/users/1204580/austin-dizzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1438660401, "creation_date": 1438660401, "answer_id": 31800393, "question_id": 31799021, "link": "https://stackoverflow.com/questions/31799021/google-app-engine-difference-between-local-dev-server-and-deployed-server/31800393#31800393", "title": "Google App Engine - Difference between local Dev server and deployed server", "body": "<p>Are you using <code>datastore:,noindex</code> on any fields in the <code>StoreTweet</code> struct? In order to run any query against any fields, the datastore must first index the fields you'll be querying. So not indexing those fields will cause the query to return nil without any errors. Does your dev server automatically create an index.yaml file in your project after running your queries for the first time? The production datastore uses this file to decide which fields should be indexed, all fields not indexed won't be able to be queried. From the information you've provided, this is all I can think of that would be causing your queries to return empty.</p>\n\n<p>In order to debug this further, I would browse your production datastore and make sure your data is structured properly and the values are set to what you are expecting them to be.</p>\n"}], "owner": {"reputation": 485, "user_id": 193827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5XtvU.jpg?s=128&g=1", "display_name": "MrWizard54", "link": "https://stackoverflow.com/users/193827/mrwizard54"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 1, "accepted_answer_id": 31799111, "answer_count": 2, "score": 1, "last_activity_date": 1475211719, "creation_date": 1438649478, "last_edit_date": 1475211719, "question_id": 31799021, "link": "https://stackoverflow.com/questions/31799021/google-app-engine-difference-between-local-dev-server-and-deployed-server", "title": "Google App Engine - Difference between local Dev server and deployed server", "body": "<p>I'm writing an app on the Google App Engine, and I have been able to write code that runs locally and puts data into the local datastore.  However, when I deploy the code to the google server, no data is put into the datastore.  My primary indicators that nothing is getting put into the datastore are, one, when I go to the Developer Console, I'm told there are no entries, and two, when I run the page that gets data, nothing is returned.</p>\n\n<p>Do I need to define new Kinds in the app.yaml or developer console before they will work on the production datastore?</p>\n\n<p>Here is my put and get methods from the data store.  Again, works in the testing environment and does not work in production, everything compiles just fine.</p>\n\n<pre><code>package tweetdata\n\nimport (\n    \"net/url\"\n    \"time\"\n\n    \"golang.org/x/net/context\"\n    \"google.golang.org/appengine/datastore\"\n    \"google.golang.org/appengine/log\"\n\n    \"github.com/ChimeraCoder/anaconda\"\n)\n\nconst linkTweetKind string = \"LinkTweet\"\nconst tweetKey string = \"Tweets\"\nconst tweetKeyID string = \"default_tweetstore\"\n\n//LinkTweet contains the address extracted from a tweet and the original tweet\ntype LinkTweet struct {\n    Address *url.URL\n    Tweet   anaconda.Tweet\n}\n\n//StoreTweet is a struct used for storing a tweet in the datastore\ntype StoreTweet struct {\n    Address     string\n    Text        string\n    TweetID     int64\n    CreatedTime time.Time\n    Retweets    int\n    Favorites   int\n}\n\n//TweetScore is a struct that shows the relative score of an address based on\n// it's populatrity\ntype TweetScore struct {\n    Address    *url.URL\n    score      int\n    lastActive time.Time\n}\n\n//WriteLinkTweet writes a given Tweet to the datastore\nfunc WriteLinkTweet(tweet LinkTweet, c context.Context) error {\n    log.Infof(c, \"Putting Tweet into datastore: %v\", tweet.Tweet.Id)\n    key := datastore.NewIncompleteKey(c, linkTweetKind, getTweetKey(c))\n    created, _ := tweet.Tweet.CreatedAtTime()\n    store := &amp;StoreTweet{Address: tweet.Address.String(),\n        Text:        tweet.Tweet.Text,\n        TweetID:     tweet.Tweet.Id,\n        CreatedTime: created,\n        Retweets:    tweet.Tweet.RetweetCount,\n        Favorites:   tweet.Tweet.FavoriteCount,\n    }\n\n    err := datastore.RunInTransaction(c, func(c context.Context) error {\n        _, err := datastore.Put(c, key, store)\n        log.Errorf(c, \"Failed to write LinkTweet to datastore. %v\", err.Error())\n        return err\n    }, nil)\n    return err\n}\n\n//GetAllNewTweets queries the datastore and gets all tweets created since the last\n// time given\nfunc GetAllNewTweets(since time.Time, c context.Context) []StoreTweet {\n    q := datastore.NewQuery(linkTweetKind).Ancestor(getTweetKey(c)).Filter(\"CreatedTime &gt;=\", since)\n    out := make([]StoreTweet, 0, 15)\n    q.GetAll(c, &amp;out)\n    return out\n}\n\n// guestbookKey returns the key used for all guestbook entries.\nfunc getTweetKey(c context.Context) *datastore.Key {\n    // The string \"default_guestbook\" here could be varied to have multiple guestbooks.\n    return datastore.NewKey(c, tweetKey, tweetKeyID, 0, nil)\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438643706, "post_id": 31797892, "comment_id": 51523972, "body": "I still recommend making the actual structs. Just as in any other language you get over the arrays of different types with polymorphism. The required structs in Go are the same as the structures I would use in any other language. Other models may work fine in some situations but overall are just a short cut, they aren&#39;t actually better at anything other than saving the developer a few minutes up front."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438643784, "post_id": 31797892, "comment_id": 51523991, "body": "Not answering because someone is likely to have a better solution, but you can always just work with nested <code>map[string]interface{}</code> and <code>[]interface{}</code>s."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438643810, "post_id": 31797892, "comment_id": 51523998, "body": "Also, if you want to use something like the maps structure in Ruby (again, I think that&#39;s just bad practice and would only ever use it in tools that I write for my own use) then you&#39;re looking for <code>map[string]interface{}</code> but all the silly casts/type asserts required to make use of your data will quickly overrun the lines saved by not defining the structs."}], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 1, "last_activity_date": 1567418154, "last_edit_date": 1567418154, "creation_date": 1438649275, "answer_id": 31799000, "question_id": 31797892, "link": "https://stackoverflow.com/questions/31797892/what-is-the-best-way-to-work-with-nested-json-structures-in-golang/31799000#31799000", "title": "What is the best way to work with nested JSON structures in Golang?", "body": "<p>For native golang, use <code>map[string]interface{}</code> or define a struct.\nFor an other way to access json object easily, may be <a href=\"https://github.com/yasuyuky/jsonpath\" rel=\"nofollow noreferrer\">JsonPath</a> or <a href=\"https://github.com/antonholmquist/jason\" rel=\"nofollow noreferrer\">Jason</a></p>\n"}, {"tags": [], "owner": {"reputation": 4870, "user_id": 419032, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b56395d5710fb694ac618fb38cf99a53?s=128&d=identicon&r=PG", "display_name": "Brownbay", "link": "https://stackoverflow.com/users/419032/brownbay"}, "is_accepted": false, "score": 4, "last_activity_date": 1438669346, "creation_date": 1438669346, "answer_id": 31802058, "question_id": 31797892, "link": "https://stackoverflow.com/questions/31797892/what-is-the-best-way-to-work-with-nested-json-structures-in-golang/31802058#31802058", "title": "What is the best way to work with nested JSON structures in Golang?", "body": "<p>If you choose to go the struct route, consider this example:</p>\n\n<pre><code>{\"data\": {\"children\": [\n  {\"data\": {\n    \"title\": \"The Go homepage\",\n    \"url\": \"http://golang.org/\"\n  }},\n  ...\n]}}\n\n// -----------\n\ntype Item struct {\n    Title string\n    URL   string\n}\n\ntype Response struct {\n    Data struct {\n        Children []struct {\n            Data Item\n        }\n    }\n}\n</code></pre>\n\n<p>Source: <a href=\"http://talks.golang.org/2012/10things.slide#4\" rel=\"nofollow\">http://talks.golang.org/2012/10things.slide#4</a></p>\n"}, {"tags": [], "owner": {"reputation": 3977, "user_id": 1047843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/awn6L.png?s=128&g=1", "display_name": "Mik", "link": "https://stackoverflow.com/users/1047843/mik"}, "is_accepted": false, "score": 4, "last_activity_date": 1478194764, "creation_date": 1478194764, "answer_id": 40407975, "question_id": 31797892, "link": "https://stackoverflow.com/questions/31797892/what-is-the-best-way-to-work-with-nested-json-structures-in-golang/40407975#40407975", "title": "What is the best way to work with nested JSON structures in Golang?", "body": "<p>One of the options is to use gabs library: <a href=\"https://github.com/Jeffail/gabs\" rel=\"nofollow noreferrer\">https://github.com/Jeffail/gabs</a></p>\n\n<p>It's useful for parsing and generating of the complex json structures.</p>\n\n<p>This is the example of the nested json generation from the README:</p>\n\n<pre><code>jsonObj := gabs.New()\n// or gabs.Consume(jsonObject) to work on an existing map[string]interface{}\n\njsonObj.Set(10, \"outter\", \"inner\", \"value\")\njsonObj.SetP(20, \"outter.inner.value2\")\njsonObj.Set(30, \"outter\", \"inner2\", \"value3\")\n</code></pre>\n\n<p>Will print:</p>\n\n<pre><code>{\"outter\":{\"inner\":{\"value\":10,\"value2\":20},\"inner2\":{\"value3\":30}}}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1977, "user_id": 4306662, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UCdvI.jpg?s=128&g=1", "display_name": "Yu Huang", "link": "https://stackoverflow.com/users/4306662/yu-huang"}, "is_accepted": false, "score": 0, "last_activity_date": 1545018568, "creation_date": 1545018568, "answer_id": 53808724, "question_id": 31797892, "link": "https://stackoverflow.com/questions/31797892/what-is-the-best-way-to-work-with-nested-json-structures-in-golang/53808724#53808724", "title": "What is the best way to work with nested JSON structures in Golang?", "body": "<p>Based on this article, <a href=\"https://medium.com/@xcoulon/nested-structs-in-golang-2c750403a007\" rel=\"nofollow noreferrer\">https://medium.com/@xcoulon/nested-structs-in-golang-2c750403a007</a>, you should define json tags for each field, then you are able to use nested struct<br>\nThe example is below, you can paste it to go playground and test it.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\ntype Config struct {\n    Server struct {\n        Host string `json:\"host\"`\n        Port string `json:\"port\"`\n        } `json:\"server\"`\n    Postgres struct {\n        Host     string `json:\"host\"`\n        User     string `json:\"user\"`\n        Password string `json:\"password\"`\n        DB       string `json:\"db\"`\n    } `json:\"database\"`\n}\n\nfunc main() {\n    jsonConfig := []byte(`{\n        \"server\":{\n            \"host\":\"localhost\",\n            \"port\":\"8080\"},\n        \"database\":{\n            \"host\":\"localhost\",\n            \"user\":\"db_user\",\n            \"password\":\"supersecret\",\n            \"db\":\"my_db\"}}`)\n    var config Config\n    err := json.Unmarshal(jsonConfig, &amp;config)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"Config: %+v\\n\", config)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1618961915, "creation_date": 1618961915, "answer_id": 67187553, "question_id": 31797892, "link": "https://stackoverflow.com/questions/31797892/what-is-the-best-way-to-work-with-nested-json-structures-in-golang/67187553#67187553", "title": "What is the best way to work with nested JSON structures in Golang?", "body": "<p>Using a <code>struct</code> is the best option, if you are willing to do it. One item that\ncan help, is if you are only using a struct once, you can just define it at the\nsame time you are declaring it, rather than with a <code>type</code> keyword. Another item,\nis you only need to define fields that you actually use, others you can omit.\nFinally, as long as you can case insensitively match the source field names, then\nyou dont need to worry about <code>struct</code> tags:</p>\n<pre><code>package main\nimport &quot;encoding/json&quot;\n\nconst s = `\n{\n   &quot;query&quot;: {\n      &quot;filtered&quot;: {\n         &quot;query&quot;: {&quot;match_all&quot;: {}},\n         &quot;filter&quot;: {\n            &quot;and&quot;: [\n               {&quot;range&quot; : {&quot;b&quot; : {&quot;from&quot;: 4, &quot;to&quot;: &quot;8&quot;}}},\n               {&quot;term&quot;: {&quot;a&quot;: &quot;john&quot;}}\n            ]\n         }\n      }\n   }\n}\n`\n\nfunc main() {\n   var m struct {\n      Query struct {\n         Filtered struct {\n            Filter struct { And []struct { Term struct { A string } } }\n         }\n      }\n   }\n   json.Unmarshal([]byte(s), &amp;m)\n   println(m.Query.Filtered.Filter.And[1].Term.A == &quot;john&quot;)\n}\n</code></pre>\n"}], "owner": {"reputation": 762, "user_id": 4949386, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/a4f78608dae9e9cf14a732e366ea016a?s=128&d=identicon&r=PG&f=1", "display_name": "zino", "link": "https://stackoverflow.com/users/4949386/zino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11874, "favorite_count": 3, "answer_count": 5, "score": 8, "last_activity_date": 1618961915, "creation_date": 1438641563, "question_id": 31797892, "link": "https://stackoverflow.com/questions/31797892/what-is-the-best-way-to-work-with-nested-json-structures-in-golang", "title": "What is the best way to work with nested JSON structures in Golang?", "body": "<p>Id like to work with JSON in Golang, in particular the elastic search JSON protocol.</p>\n\n<p>The JSON is deeply nested (this is a simple query):</p>\n\n<pre><code>{\n    \"query\": {\n        \"filtered\": {\n            \"query\": {\n                \"match_all\": {}\n            },\n            \"filter\": {\n                \"and\": [\n                    {\n                        \"range\" : {\n                            \"b\" : { \n                                \"from\" : 4, \n                                \"to\" : \"8\"\n                            }\n                        },\n                    },\n                    {\n                        \"term\": {\n                            \"a\": \"john\"\n                        }\n                    }\n                ]\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>This structure maps easily to a native data structure in Ruby.</p>\n\n<p>But with Golang, it seems you have to define the exact structure with structs (perhaps generate them programmatically from the JSON source).</p>\n\n<p>Even so, things like arrays of different \"types\" of objects in JS requires work arounds and custom code. For example the \"and\" key in the example JSON. (<a href=\"http://mattyjwilliams.blogspot.co.uk/2013/01/using-go-to-unmarshal-json-lists-with.html\" rel=\"noreferrer\">http://mattyjwilliams.blogspot.co.uk/2013/01/using-go-to-unmarshal-json-lists-with.html</a>).</p>\n\n<p>Is there a better way to work with JSON in Golang?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438635002, "post_id": 31796251, "comment_id": 51520778, "body": "You should probably ask this at <a href=\"http://programmers.stackexchange.com/\">programmers.stackexchange.com</a> because your question is entirely subjective. Besides that it&#39;s not really that wonderfully worded, why not just modify <code>randString</code>?"}, {"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1438635131, "post_id": 31796251, "comment_id": 51520839, "body": "@evanmcdonnal: &quot;Subjectivity&quot; is not a specific criteria for topicality at programmers, except insofar as too much of it makes questions off-topic, just like it does here."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1438635510, "post_id": 31796251, "comment_id": 51521037, "body": "@RobertHarvey I thought programmers was for questions regarding design/best practices/coding style/ect?"}, {"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1438635825, "post_id": 31796251, "comment_id": 51521158, "body": "@evanmcdonnal: That&#39;s not what you said.  You said that the question should be asked at Programmers because it&#39;s entirely subjective."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1438636306, "post_id": 31796251, "comment_id": 51521359, "body": "@RobertHarvey haha pardon my language, I just consider all of those topics to be inherently subjective. Of course there is popular opinion but I see it as nothing more than that."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438661873, "post_id": 31796251, "comment_id": 51528053, "body": "It can be tempting to sweat &quot;efficiency&quot; when it&#39;s not really an issue. There can&#39;t be more than microseconds&#39; difference between the options you&#39;re discussing; there may be <i>no</i> difference."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1439015944, "post_id": 31796251, "comment_id": 51697985, "body": "As a side note: this question is exactly about the function you&#39;re trying to create: <a href=\"http://stackoverflow.com/questions/22892120/how-to-generate-a-random-string-of-a-fixed-length-in-golang\">How to generate a random string of a fixed length in golang?</a> I&#39;ve presented mutiple very efficient solutions."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1438638354, "post_id": 31796824, "comment_id": 51522260, "body": "To your first section you could add improved readability for other Gophers (i.e. Go programmers know what <code>fmt.Sprintf(&quot;#%06x&quot;, rand.Intn(256*256*256))</code> does and how it works but I&#39;d have to guess at what <code>&quot;#&#39; + randString(hexRunes, 6)</code> does and read the code to find out how)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1439016034, "last_edit_date": 1592644375, "creation_date": 1438636207, "answer_id": 31796824, "question_id": 31796251, "link": "https://stackoverflow.com/questions/31796251/when-to-reuse-functions/31796824#31796824", "title": "When to reuse functions?", "body": "<h3>1) If there is an exact solution in the standard library, you should like always choose to use that.</h3>\n<p>Because:</p>\n<ul>\n<li>The standard library is tested. So it does what it says (or what we expect it to do). Even if there is a bug in it, it will be discovered (by you or by others) and will get fixed without your work/effort.</li>\n<li>The standard library is written as idiomatic Go. Chances are it's faster even if it does a little more than what you need compared to the solution you could write.</li>\n<li>The standard library is (or may) improve by time. Your program may get faster just because an implementation was improved in a new Go release without any effort from your part.</li>\n<li>The solution is presented (which means it's ready and requires no time from you).</li>\n<li>The standard library is well and widely known, so your code will be easier to understand by others and by you later on.</li>\n<li>If you're already imported the package (or will in the near future), this means zero or minimal overhead as libraries are statically linked, so the function you need is already linked to your program (to the compiled executable binary).</li>\n</ul>\n<h3>2) If there is a solution provided by the standard library but it is a  general solution to similar problems and/or offers more than what you need:</h3>\n<ul>\n<li>That means it's more likely not the optimal solution for you, as it may use more memory and/or work more slowly as your solution could be.</li>\n<li>You need to decide if you're willing to sacrifice that little performance loss for the gains listed above. This also depends how and how many times you need to use it (e.g. if it's a one-time, it shouldn't matter, if it's in an endless loop called very frequently, it should be examined carefully).</li>\n</ul>\n<h3>3) And at the other end: you should avoid using a solution provided by the standard library if it wasn't designed to solve your problem...</h3>\n<ul>\n<li>If it just happens that its &quot;side-effect&quot; solves your problem: Even if the current implementation would be acceptable, if it was designed for something else, future improvements to it could render your usage of it completely useless or could even break it.</li>\n<li>Not to mention it would confuse other developers trying to read, improve or use your code (you included, after a certain amount of time).</li>\n</ul>\n<hr />\n<p>As a side note: this question is exactly about the function you're trying to create: <a href=\"https://stackoverflow.com/questions/22892120/how-to-generate-a-random-string-of-a-fixed-length-in-golang\">How to generate a random string of a fixed length in golang?</a> I've presented mutiple very efficient solutions.</p>\n"}, {"tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 1, "last_activity_date": 1438661342, "creation_date": 1438661342, "answer_id": 31800544, "question_id": 31796251, "link": "https://stackoverflow.com/questions/31796251/when-to-reuse-functions/31800544#31800544", "title": "When to reuse functions?", "body": "<p>This is fairly subjective and not go-specific but I think you shouldn't reuse code just for the sake of reuse. The more code you reuse the more dependencies you create between different parts of your app and as result it becomes more difficult to maintain and modify. Easy to understand and modify code is much more important especially if you work in a team.</p>\n\n<p>For your particular example I would do the following.</p>\n\n<p>If a random color is generated only once in your package/application then using <code>fmt.Sprintf(\"#%06x\", rand.Intn(256*256*256))</code> is perfectly fine (as suggested by Dave C).</p>\n\n<p>If random colors are generated in multiple places I would create function <code>func randColor() string</code> and call it. Note that now you can optimize <code>randColor</code> implementation however you like without changing the rest of the code. For example you could have implemented <code>randColor</code> using <code>randString</code> initially and then switched to a more efficient implementation later.</p>\n"}], "owner": {"reputation": 69, "user_id": 5141761, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/85a27906920ee18441dde2016b3c5062?s=128&d=identicon&r=PG&f=1", "display_name": "borring", "link": "https://stackoverflow.com/users/5141761/borring"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1439016034, "creation_date": 1438633912, "question_id": 31796251, "link": "https://stackoverflow.com/questions/31796251/when-to-reuse-functions", "title": "When to reuse functions?", "body": "<p>I have a function in my program that generates random strings.</p>\n\n<pre><code>func randString(s []rune, l int) string\n</code></pre>\n\n<p><code>s</code> is a slice of runes containing the possible characters in the string. I pass\nin a rune slice of both capital and lowercase alphabetic characters. <code>l</code>\ndetermines the length of the string. This works great. But I also need to\ngenerate random hex strings for html color codes.</p>\n\n<p>It seems all sources say that it's good programming practice to reuse code. So I\nmade another <code>[]rune</code> that held <code>[1-9a-f]</code> and feed that into <code>randString</code>. That\nwas before I realized that the stdlib already inclues formatting verbs for int\ntypes that suit me perfectly.</p>\n\n<p>In practice, is it better to reuse my <code>randString</code> function or code a separate\n(more efficient) function? I would generate a single random int and Sprintf it\nrather than having to loop and generate 6 random ints which <code>randString</code> does.</p>\n"}, {"tags": ["ajax", "http", "go", "goroutine"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1438628983, "post_id": 31794707, "comment_id": 51517705, "body": "The pipeline pattern"}, {"owner": {"reputation": 14835, "user_id": 200619, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0e2ad527708210b67f14a4c64e022352?s=128&d=identicon&r=PG", "display_name": "Carson", "link": "https://stackoverflow.com/users/200619/carson"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1438630622, "post_id": 31794707, "comment_id": 51518517, "body": "@Sridhar updated to reflect that these operations do not need to be performed sequentially"}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 1, "last_activity_date": 1438629144, "last_edit_date": 1438629144, "creation_date": 1438628757, "answer_id": 31794893, "question_id": 31794707, "link": "https://stackoverflow.com/questions/31794707/how-can-i-coalesce-the-results-of-two-gorountines-before-returning/31794893#31794893", "title": "How can I coalesce the results of two gorountines before returning?", "body": "<p>For simple things I would use a set of local variables and some goroutines that set those variables, along with a waitgroup to know when everything is finished: </p>\n\n<pre><code>    var a string\n    var b string\n    wg := sync.WaitGroup{}\n    wg.Add(2)\n    go func(){\n        time.Sleep(5 * time.Second) // make a request\n        a = \"foo\"\n        wg.Done()\n    }()\n    go func(){\n        time.Sleep(3 * time.Second) // make a request\n        b = \"bar\"\n        wg.Done()\n    }()\n    wg.Wait()\n    fmt.Println(a,b) //combine results\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/GzZWVcP08S\" rel=\"nofollow\">playground link</a></p>\n\n<p>If you want more complicated behaviour like timeouts or partial results, then you probably want your subrequests to communicate results back on a channel you can select on: </p>\n\n<pre><code>// make sure to buffer to max number of senders so garbage collection can clean up\n// if we time out\nch := make(chan string, 2)\ngo func() {\n    time.Sleep(5 * time.Second) // make a request\n    ch &lt;- \"foo\"\n}()\ngo func() {\n    time.Sleep(2 * time.Second) // make a request\n    ch &lt;- \"bar\"\n}()\nresults := []string{}\ntimeout := time.After(4 * time.Second)\nLoop:\nfor {\n    select {\n    case r := &lt;-ch:\n        results = append(results, r)\n        if len(results) == 2 {\n            break Loop\n        }\n    case &lt;-timeout:\n        break Loop\n    }\n}\nfmt.Println(results)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/8Y6y0wtCgD\" rel=\"nofollow\">playground Link</a></p>\n\n<p>That doesn't fully preserve order, but you could make another channel if that is important. Thats the general idea anyway.</p>\n"}, {"tags": [], "owner": {"reputation": 929, "user_id": 8109026, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jomoj.jpg?s=128&g=1", "display_name": "Raed Shomali", "link": "https://stackoverflow.com/users/8109026/raed-shomali"}, "is_accepted": false, "score": 0, "last_activity_date": 1498539232, "last_edit_date": 1498539232, "creation_date": 1498365471, "answer_id": 44743230, "question_id": 31794707, "link": "https://stackoverflow.com/questions/31794707/how-can-i-coalesce-the-results-of-two-gorountines-before-returning/44743230#44743230", "title": "How can I coalesce the results of two gorountines before returning?", "body": "<p>I wrote this library that can help simplify running the go routines in parallel without having to worry about the low-level details <a href=\"https://github.com/shomali11/parallelizer\" rel=\"nofollow noreferrer\">https://github.com/shomali11/parallelizer</a></p>\n\n<p>So in your case, you could do this:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/shomali11/parallelizer\"\n    \"fmt\"\n)\n\nfunc main() {\n    group := parallelizer.DefaultGroup()\n\n    result1 := &amp;SomeResultStructure{}\n    group.Add(func(result *SomeResultStructure) {\n        return func () {\n            ...\n            result.SomeValue = \"1\"\n        }\n    }(result1))\n\n    result2 := &amp;SomeResultStructure{}\n    group.Add(func(result *SomeResultStructure) {\n        return func () {\n            ...\n            result.SomeValue = \"2\"\n        }\n    }(result2))\n\n    err := group.Run()\n\n    fmt.Println(\"Done\")\n    fmt.Println(fmt.Sprintf(\"Results 1: %v\", result1.SomeValue))\n    fmt.Println(fmt.Sprintf(\"Results 2: %v\", result2.SomeValue))\n    fmt.Printf(\"Error: %v\", err)\n}\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>Done\nResults 1: 1\nResults 2: 2\nError: &lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 14835, "user_id": 200619, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0e2ad527708210b67f14a4c64e022352?s=128&d=identicon&r=PG", "display_name": "Carson", "link": "https://stackoverflow.com/users/200619/carson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1498539232, "creation_date": 1438628048, "last_edit_date": 1438630591, "question_id": 31794707, "link": "https://stackoverflow.com/questions/31794707/how-can-i-coalesce-the-results-of-two-gorountines-before-returning", "title": "How can I coalesce the results of two gorountines before returning?", "body": "<p>I have a web request handler in a Go app that needs to make 2+ requests to other URLs. I'd like to collect the results from each URL, coalesce each result into a single JSON object, and return via my request handler. The requests are not dependent upon each other and do not need to be sequenced.</p>\n\n<p>What's the best pattern for doing this in Go? Should I use a channel and a <code>WaitGroup</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 771, "user_id": 4515252, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--02zX_AQuqM/AAAAAAAAAAI/AAAAAAAAK64/PpH7Pn2gzSg/photo.jpg?sz=128", "display_name": "Adam Vincze", "link": "https://stackoverflow.com/users/4515252/adam-vincze"}, "edited": false, "score": 2, "creation_date": 1438627141, "post_id": 31794355, "comment_id": 51516787, "body": "the std lib does not provide anything like this yet, but i&#39;ts coming soon: see <a href=\"https://go-review.googlesource.com/#/c/9073/\" rel=\"nofollow noreferrer\">go-review.googlesource.com/#/c/9073</a>, you could take a look at the implementation to get an idea how to parse your special json yourself"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 771, "user_id": 4515252, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--02zX_AQuqM/AAAAAAAAAAI/AAAAAAAAK64/PpH7Pn2gzSg/photo.jpg?sz=128", "display_name": "Adam Vincze", "link": "https://stackoverflow.com/users/4515252/adam-vincze"}, "edited": false, "score": 0, "creation_date": 1438637550, "post_id": 31794355, "comment_id": 51521917, "body": "@AdamVincze: coming soon, as in go1.5 which is due any time now ;) (for the current development docs, you can always use &quot;tip.golang.org&quot;  <a href=\"http://tip.golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">tip.golang.org/pkg/encoding/json</a>)"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 1, "creation_date": 1438679754, "post_id": 31794355, "comment_id": 51536392, "body": "That was quick - <a href=\"https://github.com/golang/go/issues/12001\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/12001</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "is_accepted": false, "score": 4, "last_activity_date": 1480651231, "creation_date": 1480651231, "answer_id": 40924563, "question_id": 31794355, "link": "https://stackoverflow.com/questions/31794355/decode-large-stream-json/40924563#40924563", "title": "Decode large stream JSON", "body": "<p>So, as commenters suggested, you could use the streaming API of \"encoding/json\" for reading one string at a time:</p>\n\n<pre><code>r := ... // get some io.Reader (e.g. open the big array file)\nd := json.NewDecoder(r)\n// read \"[\"\nd.Token()\n// read strings one by one\nfor d.More() {\n    s, _ := d.Token()\n    // do something with s which is the newly read string\n    fmt.Printf(\"read %q\\n\", s)\n}\n// (optionally) read \"]\"\nd.Token()\n</code></pre>\n\n<p>Note that for simplicity I've left error handling out which needs to be implemented.</p>\n"}, {"tags": [], "owner": {"reputation": 2229, "user_id": 484529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/rp6uy.png?s=128&g=1", "display_name": "ijt", "link": "https://stackoverflow.com/users/484529/ijt"}, "is_accepted": true, "score": 30, "last_activity_date": 1488742796, "last_edit_date": 1488742796, "creation_date": 1488742481, "answer_id": 42612995, "question_id": 31794355, "link": "https://stackoverflow.com/questions/31794355/decode-large-stream-json/42612995#42612995", "title": "Decode large stream JSON", "body": "<p>There is an example of this sort of thing here: <a href=\"https://golang.org/pkg/encoding/json/#example_Decoder_Decode_stream\" rel=\"noreferrer\">https://golang.org/pkg/encoding/json/#example_Decoder_Decode_stream</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n    const jsonStream = `\n                [\n                    {\"Name\": \"Ed\", \"Text\": \"Knock knock.\"},\n                    {\"Name\": \"Sam\", \"Text\": \"Who's there?\"},\n                    {\"Name\": \"Ed\", \"Text\": \"Go fmt.\"},\n                    {\"Name\": \"Sam\", \"Text\": \"Go fmt who?\"},\n                    {\"Name\": \"Ed\", \"Text\": \"Go fmt yourself!\"}\n                ]\n            `\n    type Message struct {\n        Name, Text string\n    }\n    dec := json.NewDecoder(strings.NewReader(jsonStream))\n\n    // read open bracket\n    t, err := dec.Token()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"%T: %v\\n\", t, t)\n\n    // while the array contains values\n    for dec.More() {\n        var m Message\n        // decode an array value (Message)\n        err := dec.Decode(&amp;m)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        fmt.Printf(\"%v: %v\\n\", m.Name, m.Text)\n    }\n\n    // read closing bracket\n    t, err = dec.Token()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"%T: %v\\n\", t, t)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 8641, "user_id": 732539, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d33cc4a619410535e0176138c6971ba3?s=128&d=identicon&r=PG", "display_name": "K2xL", "link": "https://stackoverflow.com/users/732539/k2xl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16157, "favorite_count": 3, "accepted_answer_id": 42612995, "answer_count": 2, "score": 28, "last_activity_date": 1588973688, "creation_date": 1438626761, "last_edit_date": 1588973688, "question_id": 31794355, "link": "https://stackoverflow.com/questions/31794355/decode-large-stream-json", "title": "Decode large stream JSON", "body": "<p>I have a massive JSON array stored in a file (\"file.json\")\nI need to iterate through the array and do some operation on each element.</p>\n\n<pre><code>err = json.Unmarshal(dat, &amp;all_data)\n</code></pre>\n\n<p>Causes an out of memory - I'm guessing because it loads everything into memory first.</p>\n\n<p>Is there a way to stream the JSON element by element?</p>\n"}, {"tags": ["sql", "sql-server", "git", "go", "connect"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1438635924, "post_id": 31796112, "comment_id": 51521215, "body": "If something went wrong on a previous attempt to get the package perhaps try <code>go get -u github.com&#47;denisenkom&#47;go-mssqldb</code> to update; or delete the package directory (and sub-directories) and retry the original <code>go get</code>."}, {"owner": {"reputation": 89, "user_id": 5134170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8de754dd8279d58e1ce15d8a1c726b47?s=128&d=identicon&r=PG&f=1", "display_name": "rahele", "link": "https://stackoverflow.com/users/5134170/rahele"}, "edited": false, "score": 0, "creation_date": 1438749322, "post_id": 31796112, "comment_id": 51571087, "body": "yeah , thanks, I didn&#39;t download the file because i thought that by this command &quot;go get github.com/...&quot; the computer itself goes to the address and downloads the file, anyway my problem is solved by your help, thanks :)"}, {"owner": {"reputation": 566, "user_id": 5091163, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/100000663691395/picture?type=large", "display_name": "Barry McNamara", "link": "https://stackoverflow.com/users/5091163/barry-mcnamara"}, "edited": false, "score": 0, "creation_date": 1438792077, "post_id": 31796112, "comment_id": 51597502, "body": "It <i>should</i> download the files, but in your case it sounds like that wasn&#39;t working. I know for me, I use Go at work, and I need to download zips because go get doesn&#39;t work behind the firewall."}], "tags": [], "owner": {"reputation": 566, "user_id": 5091163, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/100000663691395/picture?type=large", "display_name": "Barry McNamara", "link": "https://stackoverflow.com/users/5091163/barry-mcnamara"}, "is_accepted": true, "score": 0, "last_activity_date": 1438633442, "creation_date": 1438633442, "answer_id": 31796112, "question_id": 31794172, "link": "https://stackoverflow.com/questions/31794172/how-to-install-a-package-in-golang/31796112#31796112", "title": "how to install a package in golang", "body": "<p>According to the golang website:</p>\n\n<blockquote>\n  <p>Get downloads and installs the packages named by the import paths, along with their dependencies.</p>\n</blockquote>\n\n<p>It sounds like the download isn't working, which is causing the folder to be empty. One alternative is to download the driver as a zip file and run go install on the folder.</p>\n"}], "owner": {"reputation": 89, "user_id": 5134170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8de754dd8279d58e1ce15d8a1c726b47?s=128&d=identicon&r=PG&f=1", "display_name": "rahele", "link": "https://stackoverflow.com/users/5134170/rahele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 692, "favorite_count": 1, "accepted_answer_id": 31796112, "answer_count": 1, "score": 1, "last_activity_date": 1438749027, "creation_date": 1438626207, "last_edit_date": 1438749027, "question_id": 31794172, "link": "https://stackoverflow.com/questions/31794172/how-to-install-a-package-in-golang", "title": "how to install a package in golang", "body": "<p>I try to connect to SQL server in golang, I searched in internet and through this address: <a href=\"https://github.com/denisenkom/go-mssqldb\" rel=\"nofollow\">https://github.com/denisenkom/go-mssqldb</a> I understood that first I need to install a package for the purpose, but when I want to install this package through git terminal by entering this command:</p>\n\n<p>$ go get github.com/denisenkom/go-mssqldb</p>\n\n<p>I receive this error :</p>\n\n<p>can't load package: package github.com/denisenkom/go-mssqldb: no buildable go source files in C:\\Go\\src\\github.com\\dnisenkom\\go-mssqldb</p>\n\n<p>my $GOPATH is already set.I don't know how to fix this problem ...</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 979, "user_id": 639919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/510178f3a5be8f3f5d1eba298ec80c9d?s=128&d=identicon&r=PG", "display_name": "mmindenhall", "link": "https://stackoverflow.com/users/639919/mmindenhall"}, "edited": false, "score": 5, "creation_date": 1438627202, "post_id": 31794241, "comment_id": 51516821, "body": "Darn...I was hoping to avoid having a test package in the main codebase (i.e., shows up in godoc)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 979, "user_id": 639919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/510178f3a5be8f3f5d1eba298ec80c9d?s=128&d=identicon&r=PG", "display_name": "mmindenhall", "link": "https://stackoverflow.com/users/639919/mmindenhall"}, "edited": false, "score": 5, "creation_date": 1438635506, "post_id": 31794241, "comment_id": 51521034, "body": "@mmindenhall; you could make it an <a href=\"https://golang.org/doc/go1.4#internalpackages\" rel=\"nofollow noreferrer\">internal package</a>, it will currently <a href=\"https://golang.org/pkg/net/http/internal/\" rel=\"nofollow noreferrer\">still show up godoc</a> but at least it&#39;s more obvious it&#39;s internal only and perhaps godoc could gain a feature to filter out internal packages in the future."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1438644617, "post_id": 31794241, "comment_id": 51524205, "body": "Godoc.org filters out internal packages from search results, but shows them in the directory listings."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 16, "last_activity_date": 1438626392, "creation_date": 1438626392, "answer_id": 31794241, "question_id": 31794141, "link": "https://stackoverflow.com/questions/31794141/can-i-create-shared-test-utilities/31794241#31794241", "title": "Can I create shared test utilities?", "body": "<p>Create a package containing the testing utilities in non _test.go files. A couple of examples of this approach are <a href=\"http://godoc.org/net/http/httptest\" rel=\"noreferrer\">httptest</a> and <a href=\"http://godoc.org/testing/iotest\" rel=\"noreferrer\">iotest</a>.</p>\n"}], "owner": {"reputation": 979, "user_id": 639919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/510178f3a5be8f3f5d1eba298ec80c9d?s=128&d=identicon&r=PG", "display_name": "mmindenhall", "link": "https://stackoverflow.com/users/639919/mmindenhall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10637, "favorite_count": 3, "accepted_answer_id": 31794241, "answer_count": 1, "score": 21, "last_activity_date": 1571901200, "creation_date": 1438626078, "last_edit_date": 1571901200, "question_id": 31794141, "link": "https://stackoverflow.com/questions/31794141/can-i-create-shared-test-utilities", "title": "Can I create shared test utilities?", "body": "<p>I'm wondering whether it's possible to share test utility code across packages in go.  Specifically, I'm writing a TCP server that will be used by multiple handlers for different message types, and want to reuse a set of common test utils.</p>\n\n<p>The main TCP server code is in <code>mypkg/tcpserver</code>:</p>\n\n<pre><code>mypkg/tcpserver/tcp_server.go\nmypkg/tcpserver/tcp_server_test.go\nmypkg/tcpserver/testutils_test.go\n</code></pre>\n\n<p>The <code>testutils_test.go</code> code is intended to be a shared library that can be used by <code>mypkg/tcpserver</code> and other packages to set up a test server and client for their tests.  For example in the <code>handler</code> subpackage I have:</p>\n\n<pre><code>mypkg/tcpserver/handler/handler.go\nmypkg/tcpserver/handler/csv_handler.go\nmypkg/tcpserver/handler/csv_handler_test.go\nmypkg/tcpserver/handler/delim_handler.go\nmypkg/tcpserver/handler/delim_handler_test.go\n</code></pre>\n\n<p>The <code>handler/*_test.go</code> files all import <code>mypkg/tcpserver</code>, but they are unable to access the test utilities defined in <code>mypkg/tcpserver/testutils_test.go</code>:</p>\n\n<pre><code>$ wgo test mypkg/tcpserver/handler\n# mypkg/tcpserver/handler\nsrc/mypkg/tcpserver/handler/csv_handler_test.go:37: undefined: tcpserver.CreateTestServer\nsrc/mypkg/tcpserver/handler/csv_handler_test.go:40: undefined: tcpserver.TestSender\nFAIL    mypkg/tcpserver/handler [build failed]\n</code></pre>\n\n<p>It appears that tests can import other packages, but not test code defined within those packages?  Is this the intent?  If so, is there an idiomatic way to share test utilities across packages in go?</p>\n"}, {"tags": ["go", "race-condition"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1438623846, "post_id": 31792810, "comment_id": 51515079, "body": "How would you fix this data race ? You can&#39;t pass a channel to func. Would a WaitGroup work here ?"}, {"owner": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 1, "creation_date": 1438624028, "post_id": 31792810, "comment_id": 51515184, "body": "@Sridhar You can use a mutex or sync/atomic to atomically increment the value."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "reply_to_user": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "edited": false, "score": 0, "creation_date": 1438625054, "post_id": 31792810, "comment_id": 51515754, "body": "@Joshua useful warning at the top of the sync/atomic package docs."}, {"owner": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1438625148, "post_id": 31792810, "comment_id": 51515810, "body": "@Sridhar yes, dragons beware..."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1438639548, "post_id": 31792810, "comment_id": 51522735, "body": "Lots of races: <code>636977 636977 636978 636979 636980 636981 636981 636982 636983 636984 636984 636985 636985 636986 </code> \u2014 hitting each of <code>&#47;a</code> and <code>&#47;b</code> with <code>wrk -c 200 -t 4</code> and <code>GOMAXPROCS=4</code>. Just need to ramp up the concurrency!"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1438655010, "post_id": 31792810, "comment_id": 51526516, "body": "Oh, ++ for actually running the stress test, @elithrar."}], "answers": [{"tags": [], "owner": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "is_accepted": false, "score": 3, "last_activity_date": 1438622039, "creation_date": 1438622039, "answer_id": 31793055, "question_id": 31792810, "link": "https://stackoverflow.com/questions/31792810/simple-race-condition-in-go-http-handler-is-this-really-a-race-condition/31793055#31793055", "title": "Simple Race Condition in Go HTTP Handler - Is this really a race condition?", "body": "<p><code>count++</code> is a data race. It does not happen atomically. It is the same as:</p>\n\n<pre><code>count = count + 1\n</code></pre>\n\n<p>If the race detector doesn't see it, you probably are not hitting the server hard enough.</p>\n"}, {"comments": [{"owner": {"reputation": 4870, "user_id": 419032, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b56395d5710fb694ac618fb38cf99a53?s=128&d=identicon&r=PG", "display_name": "Brownbay", "link": "https://stackoverflow.com/users/419032/brownbay"}, "edited": false, "score": 0, "creation_date": 1438625431, "post_id": 31793058, "comment_id": 51515957, "body": "GOMAXPROCS&gt;1 is very apt! For new Gophers like myself, to understand why, read: <a href=\"http://www.goinggo.net/2014/01/concurrency-goroutines-and-gomaxprocs.html\" rel=\"nofollow noreferrer\">goinggo.net/2014/01/concurrency-goroutines-and-gomaxprocs.ht&zwnj;&#8203;ml</a>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1438622060, "creation_date": 1438622060, "answer_id": 31793058, "question_id": 31792810, "link": "https://stackoverflow.com/questions/31792810/simple-race-condition-in-go-http-handler-is-this-really-a-race-condition/31793058#31793058", "title": "Simple Race Condition in Go HTTP Handler - Is this really a race condition?", "body": "<p>This is a data race, the race detector however does not report races that don't happen. You need to make sure that there are concurrent calls in your test, and ensuring <code>GOMAXPROCS&gt;1</code> can help flush them out as well.</p>\n"}, {"tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": false, "score": 4, "last_activity_date": 1438654922, "last_edit_date": 1438654922, "creation_date": 1438622279, "answer_id": 31793108, "question_id": 31792810, "link": "https://stackoverflow.com/questions/31792810/simple-race-condition-in-go-http-handler-is-this-really-a-race-condition/31793108#31793108", "title": "Simple Race Condition in Go HTTP Handler - Is this really a race condition?", "body": "<p>That's a race condition. <a href=\"https://talks.golang.org/2015/dynamic-tools.slide#12\" rel=\"nofollow\">False negatives can happen with the race checker.</a> </p>\n\n<p>The race checker is dynamic: rather than checking the source for problems, it only can only see if read and a write <em>actually occur</em> with no sync operation in between. There's no synchronizing operation in your code, but if one occurs in <code>net/http</code> between the increments, it'll be fooled.  <a href=\"https://talks.golang.org/2015/dynamic-tools.slide#12\" rel=\"nofollow\">Its author suggests</a>, essentially, running concurrent stress tests to shake out problems:</p>\n\n<blockquote>\n  <ul>\n  <li>write good <strong>concurrent</strong> tests</li>\n  <li>have continuous build with race detector</li>\n  <li>run integration tests</li>\n  <li>run race-enabled canaries in production</li>\n  </ul>\n</blockquote>\n\n<p>In Go 1.4 and below, you should also make sure your program runs on more than one core with, e.g., <a href=\"http://golang.org/pkg/runtime/\" rel=\"nofollow\"><code>runtime.GOMAXPROCS(runtime.NumCPU())</code></a>. In Go 1.5, to be released around the end of 2015, GOMAXPROCS will run your code on all available cores by default.</p>\n"}], "owner": {"reputation": 4870, "user_id": 419032, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b56395d5710fb694ac618fb38cf99a53?s=128&d=identicon&r=PG", "display_name": "Brownbay", "link": "https://stackoverflow.com/users/419032/brownbay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1086, "favorite_count": 0, "accepted_answer_id": 31793058, "answer_count": 3, "score": 4, "last_activity_date": 1438654922, "creation_date": 1438620983, "question_id": 31792810, "link": "https://stackoverflow.com/questions/31792810/simple-race-condition-in-go-http-handler-is-this-really-a-race-condition", "title": "Simple Race Condition in Go HTTP Handler - Is this really a race condition?", "body": "<p>Given the code below, I'm trying to understand WHY the Go race detector (<code>go run -race example.go</code>) does not complain about a race condition.</p>\n\n<pre><code>var count int\n\nfunc main() {\n    http.HandleFunc(\"/a/\", func(w http.ResponseWriter, r *http.Request) {\n        count++ \n        fmt.Println(count)\n    })\n\n    http.HandleFunc(\"/b/\", func(w http.ResponseWriter, r *http.Request) {\n        count++\n        fmt.Println(count)\n    })\n\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>It's my understanding that the Go HTTP Server responds to all requests in a separate goroutine. With that in mind, would not the increments made to the global count variable by the handler functions happen in a goroutine that is separate from the main goroutine and thus, constitute a data race? </p>\n\n<p>If this is not a data race, I'd very much like to know why. </p>\n"}, {"tags": ["file-upload", "go"], "comments": [{"owner": {"reputation": 1912, "user_id": 331160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/19bb055a5d678985c2757b9c20dd56bf?s=128&d=identicon&r=PG", "display_name": "Kunal Jha", "link": "https://stackoverflow.com/users/331160/kunal-jha"}, "edited": false, "score": 0, "creation_date": 1438663550, "post_id": 31792640, "comment_id": 51528508, "body": "I wanted to clarify in the above curl you want to assign the png to a variable or post body content ?"}, {"owner": {"reputation": 261, "user_id": 2636324, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/639550655/picture?type=large", "display_name": "Aaron Kenny", "link": "https://stackoverflow.com/users/2636324/aaron-kenny"}, "reply_to_user": {"reputation": 1912, "user_id": 331160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/19bb055a5d678985c2757b9c20dd56bf?s=128&d=identicon&r=PG", "display_name": "Kunal Jha", "link": "https://stackoverflow.com/users/331160/kunal-jha"}, "edited": false, "score": 0, "creation_date": 1438675757, "post_id": 31792640, "comment_id": 51534023, "body": "@KunalJha I want to retrieve an image (and manipulate it) which has been POSTed to my API. The above curl is just my stab at POSTing an image."}], "answers": [{"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": false, "score": 0, "last_activity_date": 1438621998, "creation_date": 1438621998, "answer_id": 31793046, "question_id": 31792640, "link": "https://stackoverflow.com/questions/31792640/retrieving-posted-files-using-golang-gin/31793046#31793046", "title": "retrieving posted files using Golang Gin", "body": "<p>Try to get the HTTP request from the gin.Context and read from its Body property:</p>\n\n<pre><code>func(c *gin.Context) {\n    decoder := json.NewDecoder(c.Request.Body)\n    var t struct {\n      Name string `json:\"json_name\"`\n      Title string `json:\"title\"`\n      Url string `json:\"url\"`\n    }\n    err := decoder.Decode(&amp;t)\n    if err != nil {\n        panic()\n    }\n    log.Println(t)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 261, "user_id": 2636324, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/639550655/picture?type=large", "display_name": "Aaron Kenny", "link": "https://stackoverflow.com/users/2636324/aaron-kenny"}, "edited": false, "score": 0, "creation_date": 1438679644, "post_id": 31804285, "comment_id": 51536332, "body": "Many thanks Kunal, I just needed to change my header type to  -H &quot;Content-Type: multipart/form-data&quot;"}, {"owner": {"reputation": 367, "user_id": 1284942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/377c65c9214a109feb52e62948e8e7f6?s=128&d=identicon&r=PG", "display_name": "JorgeGarza", "link": "https://stackoverflow.com/users/1284942/jorgegarza"}, "edited": false, "score": 0, "creation_date": 1486501029, "post_id": 31804285, "comment_id": 71369866, "body": "Do you have any snippet for multiple files ?"}], "tags": [], "owner": {"reputation": 1912, "user_id": 331160, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/19bb055a5d678985c2757b9c20dd56bf?s=128&d=identicon&r=PG", "display_name": "Kunal Jha", "link": "https://stackoverflow.com/users/331160/kunal-jha"}, "is_accepted": true, "score": 14, "last_activity_date": 1438676799, "creation_date": 1438676799, "answer_id": 31804285, "question_id": 31792640, "link": "https://stackoverflow.com/questions/31792640/retrieving-posted-files-using-golang-gin/31804285#31804285", "title": "retrieving posted files using Golang Gin", "body": "<p>I will try to just answer the retrieving the filename and assigning it to the variable, because handling the json part is already taken care by @AlexAtNet.\nLet me know if this works for you</p>\n\n<pre><code>    func (c *gin.Context) {\n\n        file, header , err := c.Request.FormFile(\"upload\")\n        filename := header.Filename\n        fmt.Println(header.Filename)\n        out, err := os.Create(\"./tmp/\"+filename+\".png\")\n        if err != nil {\n            log.Fatal(err)\n        }\n        defer out.Close()\n        _, err = io.Copy(out, file)\n        if err != nil {\n            log.Fatal(err)\n        }   \n    }\n</code></pre>\n"}], "owner": {"reputation": 261, "user_id": 2636324, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/639550655/picture?type=large", "display_name": "Aaron Kenny", "link": "https://stackoverflow.com/users/2636324/aaron-kenny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7341, "favorite_count": 5, "accepted_answer_id": 31804285, "answer_count": 2, "score": 7, "last_activity_date": 1438676799, "creation_date": 1438620435, "question_id": 31792640, "link": "https://stackoverflow.com/questions/31792640/retrieving-posted-files-using-golang-gin", "title": "retrieving posted files using Golang Gin", "body": "<p>I'm using the Golang framework Gin for a while now with no issues but I now need to process images posted to my API. </p>\n\n<p>I can probably figure out how to deal with validating, resizing and storing the image but for now I'm just struggling to figure out how to grab the posted file and assign it to a variable. </p>\n\n<p>I've looked at the Gin API docs but nothing is jumping out at me.</p>\n\n<p>I'm curling my API as follows (this might be wrong?)...</p>\n\n<pre><code>$ time curl -X POST --form upload=@ss.png -H \"Content-Type: application/json\"  --cookie 'session=23423v243v25c08efb5805a09b5f288329003' \"http://127.0.0.1:8080/v1.0/icon\" --form data='{\"json_name\":\"test json name\",\"title\":\"Test\",\"url\":\"http://sometest.com\"}'\n</code></pre>\n"}, {"tags": ["go", "compiler-errors"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1438619713, "post_id": 31792281, "comment_id": 51512881, "body": "No, but there are some third party options. This one is popular with a lot of folks I know (personally I don&#39;t like these tools) <a href=\"https://packagecontrol.io/packages/GoImports\" rel=\"nofollow noreferrer\">packagecontrol.io/packages/GoImports</a> - only works with Sublime3 though."}, {"owner": {"reputation": 3605, "user_id": 1454048, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GlhDH.jpg?s=128&g=1", "display_name": "admdrew", "link": "https://stackoverflow.com/users/1454048/admdrew"}, "edited": false, "score": 0, "creation_date": 1438634862, "post_id": 31792281, "comment_id": 51520717, "body": "I removed your edit about the duplicate. Your suggestion is good and could probably be posted to meta.stackoverflow.com, but does not directly relate to this posted question."}], "answers": [{"comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 1, "creation_date": 1438620425, "post_id": 31792323, "comment_id": 51513275, "body": "I&#39;m beginning to understand why this language is described as &#39;opinionated&#39;. Nothing that I mind so far though."}, {"owner": {"reputation": 707, "user_id": 2905274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/c9e3b6b5fbc86a188e28c92a3718eff9?s=128&d=identicon&r=PG&f=1", "display_name": "VinGarcia", "link": "https://stackoverflow.com/users/2905274/vingarcia"}, "edited": false, "score": 1, "creation_date": 1503242219, "post_id": 31792323, "comment_id": 78524738, "body": "Really, it was necessary to create a separate tool <code>goimports</code> to fix this problem? Also, <code>_ &quot;time&quot;</code> is effectively the same as <code>&#47;&#47; &quot;time&quot;</code> and is annoying either way. I do like most of the decisions they made on Golang, but this one smells."}, {"owner": {"reputation": 707, "user_id": 2905274, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/c9e3b6b5fbc86a188e28c92a3718eff9?s=128&d=identicon&r=PG&f=1", "display_name": "VinGarcia", "link": "https://stackoverflow.com/users/2905274/vingarcia"}, "edited": false, "score": 0, "creation_date": 1503242876, "post_id": 31792323, "comment_id": 78524965, "body": "Also if this was such a concern they should still make it a warning during tests, and only an error during production compilation."}, {"owner": {"reputation": 1744, "user_id": 4372452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OlDV3.png?s=128&g=1", "display_name": "mtraceur", "link": "https://stackoverflow.com/users/4372452/mtraceur"}, "edited": false, "score": 0, "creation_date": 1574201308, "post_id": 31792323, "comment_id": 104145676, "body": "+1 to the answer, but I&#39;d -1 the quoted rationale if I could for its asinine omission of several actually relevant considerations. For example, the inability to ignore unused imports makes iterative development way more of a pain in the ass than it needs to be - for example I routinely include everything I intend to use in the <code>import</code> block when starting a new file, but then want to iteratively compile and test each piece of functionality that I implement in the file - Go forces me to keep adding/removing <code>_</code> or <code>&#47;&#47;</code> to imports manually, or to keep around and run a tool that does it."}, {"owner": {"reputation": 1744, "user_id": 4372452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OlDV3.png?s=128&g=1", "display_name": "mtraceur", "link": "https://stackoverflow.com/users/4372452/mtraceur"}, "edited": false, "score": 0, "creation_date": 1574201733, "post_id": 31792323, "comment_id": 104145826, "body": "I mean I get it - if you give people something just because it is useful in development, inevitably someone will rely on it in production. But still. Really increases the obviously unnecessary tedious overhead that didn&#39;t have to exist between me and what I&#39;m trying to accomplish."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1744, "user_id": 4372452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OlDV3.png?s=128&g=1", "display_name": "mtraceur", "link": "https://stackoverflow.com/users/4372452/mtraceur"}, "edited": false, "score": 0, "creation_date": 1574202798, "post_id": 31792323, "comment_id": 104146223, "body": "@mtraceur Go set up its goals that includes writing simple, readable software that scales. Forbidding unused imports aligns with that. We&#39;re not talking about a software that is made of 4 source files and totals 1000 lines of code. If you&#39;re considering thousands of files and millions of lines, having unused imports in all of them does make a difference. Saying it&#39;s a hassle having to use a tool to ease this is just an excuse. I hardly ever have to touch imports because my IDE takes care of it automatically. It&#39;s no hassle at all for me, no more hassle than in other languages."}, {"owner": {"reputation": 1744, "user_id": 4372452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OlDV3.png?s=128&g=1", "display_name": "mtraceur", "link": "https://stackoverflow.com/users/4372452/mtraceur"}, "edited": false, "score": 0, "creation_date": 1574275124, "post_id": 31792323, "comment_id": 104177665, "body": "@icza I also don&#39;t understand why you would want to make that comment defending Go&#39;s decisions like that unless you somehow took my original comment personally even though the only thing aimed at you in it was the &quot;+1 to the answer&quot;."}, {"owner": {"reputation": 1744, "user_id": 4372452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OlDV3.png?s=128&g=1", "display_name": "mtraceur", "link": "https://stackoverflow.com/users/4372452/mtraceur"}, "edited": false, "score": 0, "creation_date": 1574275584, "post_id": 31792323, "comment_id": 104177877, "body": "@icza I do agree that allowing unused imports doesn&#39;t scale - which should be obvious because as I said in my second comment that &quot;if you give people something [...], inevitably someone will rely on it in production&quot;. Which is why my second comment started with an &quot;I get it&quot; - they couldn&#39;t include it, because of the bigger picture of how human usage of programming languages scales. The problem I was pointing out is that they failed to express that in their stated rationale, which I think matters a lot more for justifying limitation than what they did say."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 11, "last_activity_date": 1438668190, "last_edit_date": 1438668190, "creation_date": 1438619315, "answer_id": 31792323, "question_id": 31792281, "link": "https://stackoverflow.com/questions/31792281/is-there-a-way-to-flag-compiler-to-ignore-unused-imports/31792323#31792323", "title": "Is there a way to flag compiler to ignore unused imports?", "body": "<p>No. For reasoning see the following FAQ:</p>\n\n<p><a href=\"https://golang.org/doc/faq#unused_variables_and_imports\" rel=\"nofollow\">FAQ: Can I stop these complaints about my unused variable/import?</a></p>\n\n<blockquote>\n  <p>The presence of an unused variable may indicate a bug, while unused imports just slow down compilation, an effect that can become substantial as a program accumulates code and programmers over time. For these reasons, Go refuses to compile programs with unused variables or imports, trading short-term convenience for long-term build speed and program clarity.</p>\n  \n  <p>Still, when developing code, it's common to create these situations temporarily and it can be annoying to have to edit them out before the program will compile.</p>\n  \n  <p>Some have asked for a compiler option to turn those checks off or at least reduce them to warnings. Such an option has not been added, though, because compiler options should not affect the semantics of the language and because the Go compiler does not report warnings, only errors that prevent compilation.</p>\n  \n  <p>There are two reasons for having no warnings. First, if it's worth complaining about, it's worth fixing in the code. (And if it's not worth fixing, it's not worth mentioning.) Second, having the compiler generate warnings encourages the implementation to warn about weak cases that can make compilation noisy, masking real errors that <em>should</em> be fixed.</p>\n  \n  <p>It's easy to address the situation, though. Use the blank identifier to let unused things persist while you're developing.</p>\n</blockquote>\n\n<p>What you may do is use the blank identifier when temporarily want to exclude something, e.g.</p>\n\n<pre><code>import (\n    \"fmt\"\n    _ \"time\"  // This will make the compiler stop complaining\n)\n</code></pre>\n\n<blockquote>\n  <p>Nowadays, most Go programmers use a tool, <a href=\"http://godoc.org/golang.org/x/tools/cmd/goimports\" rel=\"nofollow\">goimports</a>, which automatically rewrites a Go source file to have the correct imports, eliminating the unused imports issue in practice. This program is easily connected to most editors to run automatically when a Go source file is written.</p>\n</blockquote>\n"}], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2119, "favorite_count": 0, "closed_date": 1438670431, "accepted_answer_id": 31792323, "answer_count": 1, "score": 4, "last_activity_date": 1438668190, "creation_date": 1438619165, "last_edit_date": 1438634820, "question_id": 31792281, "link": "https://stackoverflow.com/questions/31792281/is-there-a-way-to-flag-compiler-to-ignore-unused-imports", "closed_reason": "Duplicate", "title": "Is there a way to flag compiler to ignore unused imports?", "body": "<p>If the compiler can recognize that an import is unused, then is it possible to set it to continue with compilation without that import ?</p>\n\n<p>Even if it's not possible, what are the pros/cons of such an option ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438615829, "post_id": 31791045, "comment_id": 51510443, "body": "I certainly recommend copying all the fields into a new struct because that one won&#39;t have those pesky annotations. It will do your application well."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438615865, "post_id": 31791045, "comment_id": 51510466, "body": "I&#39;m being sarcastic of course. What&#39;s more important; the performance of your application or whether or not you have to read some text the compiler uses?"}, {"owner": {"reputation": 55, "user_id": 2160933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e20dde6b7651172e64a3457a42cf40c6?s=128&d=identicon&r=PG", "display_name": "bingehacking", "link": "https://stackoverflow.com/users/2160933/bingehacking"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438616128, "post_id": 31791045, "comment_id": 51510632, "body": "Without being sarcastic: Performance, yes. But also readability of my code and independence to (future) backend services. I prefer to touch as little code as possible whenever a backend service changes. And as I said, this only works of course for results which can be serialized with tags. If I use some esoteric backend which does not support tags (or json or XML or ...), I&#39;d have to copy those fields into the struct anyway, right?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438616972, "post_id": 31791045, "comment_id": 51511167, "body": "As a compromise I would recommend using an interface in your application layer and having different types implement it on the two ends of the data divide (client and db sides). That being said, if the model is the same on both sides <i>why in the hell wouldn&#39;t you use the same object!?</i> If your model changes to XML on the backend you just find and replace bson with xml, having different structs isn&#39;t gonna make that change any different. Also, adding superfluous types isn&#39;t going to make your program more readable, it&#39;s going to make future devs scorn you."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 2160933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e20dde6b7651172e64a3457a42cf40c6?s=128&d=identicon&r=PG", "display_name": "bingehacking", "link": "https://stackoverflow.com/users/2160933/bingehacking"}, "edited": false, "score": 0, "creation_date": 1438692951, "post_id": 31791447, "comment_id": 51545142, "body": "Yes, I guess that&#39;s the best of both worlds, I&#39;&#39; try that approach. Cheers!"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 2, "last_activity_date": 1438616500, "creation_date": 1438616500, "answer_id": 31791447, "question_id": 31791045, "link": "https://stackoverflow.com/questions/31791045/conversion-of-go-struct-fields-with-tags/31791447#31791447", "title": "Conversion of Go struct fields with tags", "body": "<p>What I'd do is create a separate type for every \"serialisation format\" if you will. This approach has several advantages:</p>\n\n<ul>\n<li><p>Your concerns are separated.</p></li>\n<li><p>JSON un/marshalling doesn't interfere with BSON/XML, so you can add any kind of additional struct fields (like <code>xml.Name</code> for example).</p></li>\n<li><p>You can actually create several such types for different APIs that need different parameters.</p></li>\n</ul>\n\n<p>The only disadvantage I see is that it's more code and even more code to move data between those. Ultimately it's up to you and your application design. If you're sure that your JSON/BSON will stay the same, you can use one type. Otherwise, I'd recommend specialisation.</p>\n"}, {"tags": [], "owner": {"reputation": 659, "user_id": 1155514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mjZMX.jpg?s=128&g=1", "display_name": "Muhammad Tariq", "link": "https://stackoverflow.com/users/1155514/muhammad-tariq"}, "is_accepted": false, "score": 0, "last_activity_date": 1606063898, "last_edit_date": 1606063898, "creation_date": 1606054652, "answer_id": 64955217, "question_id": 31791045, "link": "https://stackoverflow.com/questions/31791045/conversion-of-go-struct-fields-with-tags/64955217#64955217", "title": "Conversion of Go struct fields with tags", "body": "<p>To those who want to add bson tags in golang struct, here is a tool which can be helpful. I have spent a whole day searching for this and I want others to save their valuable time.</p>\n<p>You can convert the following struct</p>\n<pre><code>type Result struct {\n    Name string `json:&quot;name&quot;`\n    Age int `json:&quot;age&quot;`\n}\n</code></pre>\n<p>into</p>\n<pre><code>type Result struct {\n    Name string `json:&quot;name&quot; bson:&quot;fullName&quot;`\n    Age int `json:&quot;age bson:&quot;age&quot;`\n}\n</code></pre>\n<p>With this tool, you can not only add bson tags but also</p>\n<ul>\n<li>XML tags,</li>\n<li>Define validation and scope</li>\n<li>Format tag values</li>\n<li>Apply transformation</li>\n<li>skip unexported fields.</li>\n</ul>\n<p><strong>Go Modify Tags:</strong> <a href=\"https://github.com/fatih/gomodifytags\" rel=\"nofollow noreferrer\">https://github.com/fatih/gomodifytags</a></p>\n<p>Cheers,</p>\n"}], "owner": {"reputation": 55, "user_id": 2160933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e20dde6b7651172e64a3457a42cf40c6?s=128&d=identicon&r=PG", "display_name": "bingehacking", "link": "https://stackoverflow.com/users/2160933/bingehacking"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 676, "favorite_count": 0, "accepted_answer_id": 31791447, "answer_count": 2, "score": 1, "last_activity_date": 1606063898, "creation_date": 1438615322, "question_id": 31791045, "link": "https://stackoverflow.com/questions/31791045/conversion-of-go-struct-fields-with-tags", "title": "Conversion of Go struct fields with tags", "body": "<p>I am really stuck here with a seemingly trivial problem in Go:\nI have a Golang microservice, which outputs data in json format. Let's say I have a simple struct with json tags for this result:</p>\n\n<pre><code>type Result struct {\n    Name string `json:\"name\"`\n    Age int `json:\"age\"`\n}\n</code></pre>\n\n<p>In the code part where the data is actually pulled out of the database, I have a quite similar struct, like this:</p>\n\n<pre><code>type ResultBackend struct {\n    Name string `bson:\"fullName\"`\n    Age int `bson:\"age\"`\n}\n</code></pre>\n\n<p>The struct fields are similar, except the different tags. I would like to keep things simple, and return just one struct from the backend service (ResultBackend), which can then be send as a JSON response, like this:</p>\n\n<pre><code>func process() Result {\n    var result ResultBackend\n    ... do a MongoDB query here and store results in result variable ...\n    return result\n}\n</code></pre>\n\n<p>This certainly would not work, because we have two different structs here. \nOf course one solution would be to embed both tags in one struct like so:</p>\n\n<pre><code>type Result struct {\n    Name string `json:\"name\" bson:\"fullName\"`\n    Age int `json:\"age bson:\"age\"`\n}\n</code></pre>\n\n<p>and then use this struct in the main code and the \"process\" function. \nThis works, but this seems like \"poisoning\" the Result struct of the main code with the bson tags. What, for instance, if the backend result is a XML file? I'd have to add xml tags to the struct as well. Or maybe someday tags some very obsure database adapter. \nThis doesn't seem to be the cleanest approach in my eyes. I'd rather have a clean Result struct in the main code, and simply to a conversion from one struct to another. </p>\n\n<p>Is there any easy way doing that, or do I really have to copy all the fields of a ResultBackend struct to a new Result struct and return that? Or I am trying to over-simplify my code here? :)</p>\n\n<p>Cheers! </p>\n"}, {"tags": ["go", "built-in"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1438613482, "post_id": 31790311, "comment_id": 51508920, "body": "If you want to see the builtin API see <a href=\"http://golang.org/src/builtin/builtin.go\" rel=\"nofollow noreferrer\">golang.org/src/builtin/builtin.go</a>"}, {"owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 1, "creation_date": 1438614479, "post_id": 31790311, "comment_id": 51509577, "body": "@sridhar i did. There is no implementation there."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1438614924, "post_id": 31790311, "comment_id": 51509871, "body": "Yes it&#39;s the API. The source will probably be written in a combination of C/C++/assembly which may also be open source but you&#39;ll have to look a little harder."}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 0, "creation_date": 1438618552, "post_id": 31790311, "comment_id": 51512182, "body": "The source is pretty much all in Go, though part of it is in a hardcore-reading form as that part resides in the code generation package. Details in my answer below."}, {"owner": {"reputation": 461, "user_id": 2619657, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9c2f7569cfae6b5d8f115a9e137af216?s=128&d=identicon&r=PG", "display_name": "Rain Lee", "link": "https://stackoverflow.com/users/2619657/rain-lee"}, "edited": false, "score": 0, "creation_date": 1438642513, "post_id": 31790311, "comment_id": 51523663, "body": "You can check out the Append() example in the following link <a href=\"http://blog.golang.org/slices\" rel=\"nofollow noreferrer\">blog.golang.org/slices</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "is_accepted": true, "score": 11, "last_activity_date": 1496302224, "last_edit_date": 1496302224, "creation_date": 1438614645, "answer_id": 31790816, "question_id": 31790311, "link": "https://stackoverflow.com/questions/31790311/where-is-append-implementation/31790816#31790816", "title": "Where is append() implementation?", "body": "<p>You may be interested by :</p>\n\n<ul>\n<li>the code generating bit <code>append</code> is in here <a href=\"https://github.com/golang/go/blob/master/src/cmd/compile/internal/gc/ssa.go\" rel=\"noreferrer\">https://github.com/golang/go/blob/master/src/cmd/compile/internal/gc/ssa.go</a></li>\n<li>and <code>growslice</code>, used by the former, and that lives in here : <a href=\"https://github.com/golang/go/blob/master/src/runtime/slice.go\" rel=\"noreferrer\">https://github.com/golang/go/blob/master/src/runtime/slice.go</a></li>\n</ul>\n"}], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5054, "favorite_count": 6, "accepted_answer_id": 31790816, "answer_count": 1, "score": 13, "last_activity_date": 1496302224, "creation_date": 1438613162, "question_id": 31790311, "link": "https://stackoverflow.com/questions/31790311/where-is-append-implementation", "title": "Where is append() implementation?", "body": "<p>I cannot find implementation code of append() or any other builtin functions  anywhere? I tried finding the code through godoc and using jump-to-definition feature of IDE's. May be i am looking at wrong places. Could anyone show me the way to see actual implementation?</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1438616230, "post_id": 31790113, "comment_id": 51510688, "body": "Linking to the Go Playground is <i>nice to have</i>, but your question/answer should also contain <i>the code</i> and <i>its output</i>. If the code or output is too long, then it may be better to just include the relevant/important parts, and have the complete (preferably runnable) code linked form the Go Playground. But it&#39;s always best if your post is readable as is without having to click around, links should be used to obtain more details."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1438615672, "last_edit_date": 1438615672, "creation_date": 1438614307, "answer_id": 31790710, "question_id": 31790113, "link": "https://stackoverflow.com/questions/31790113/address-of-composite-literal-used-as-interface/31790710#31790710", "title": "Address of composite literal used as interface", "body": "<p><a href=\"http://golang.org/ref/spec#Method_sets\" rel=\"nofollow\">Spec: Method sets:</a></p>\n\n<blockquote>\n  <p>A type may have a <em>method set</em> associated with it. The method set of an <a href=\"http://golang.org/ref/spec#Interface_types\" rel=\"nofollow\">interface type</a> is its interface. The method set of any other type <code>T</code> consists of all <a href=\"http://golang.org/ref/spec#Method_declarations\" rel=\"nofollow\">methods</a> declared with receiver type <code>T</code>. The method set of the corresponding <a href=\"http://golang.org/ref/spec#Pointer_types\" rel=\"nofollow\">pointer type</a> <code>*T</code> is the set of all methods declared with receiver <code>*T</code> or <code>T</code> (that is, it also contains the method set of <code>T</code>).</p>\n</blockquote>\n\n<p>So the method set of <code>*cncrt</code> includes the methods set of <code>cncrt</code>. Since <code>rx()</code> is an element of <code>cncrt</code>'s method set, it will also be in <code>*cncrt</code>'s method set. Which means both <code>cncrt</code> and <code>*cncrt</code> types implement the <code>ntfc</code> interface.</p>\n\n<p>If you have a pointer value (<code>*cncrt</code>) and you call <code>rx()</code> on it, the pointer will automatically be dereferenced which will be the receiver of the <code>rx()</code> method.</p>\n\n<p>In your <code>rtnsNtfca()</code> and <code>rtnsNtfc()</code> functions an interface value of <code>ntfc</code> will automatically be created and returned. Interface values in Go are represented as (type;value) pairs (for more details: <a href=\"http://blog.golang.org/laws-of-reflection#TOC_3.\" rel=\"nofollow\">The Laws of Reflection #The representation of an interface</a>). So both <code>rtnsNtfca()</code> and <code>rtnsNtfc()</code> return an interface value, but the first one holds a dynamic value of type <code>*cncrt</code> and the latter one holds a dynamic value of type <code>cncrt</code>.</p>\n\n<p>And your 3rd method <code>rtrnsCncrt()</code> returns a concrete type (<code>*cncrt</code>), there is no interface wrapping involved there.</p>\n\n<p><strong>Note: \"The other way around\"</strong></p>\n\n<p><a href=\"http://golang.org/ref/spec#Calls\" rel=\"nofollow\">Spec: Calls:</a></p>\n\n<blockquote>\n  <p>If <code>x</code> is <a href=\"http://golang.org/ref/spec#Address_operators\" rel=\"nofollow\">addressable</a> and <code>&amp;x</code>'s method set contains <code>m</code>, <code>x.m()</code> is shorthand for <code>(&amp;x).m()</code>.</p>\n</blockquote>\n\n<p>This means if you would have declared <code>rx()</code> to have a pointer receiver, and you have a variable of type <code>cncrt</code> (note: not pointer), you could still call the <code>rx()</code> method on it if it is addressable, and the address would be taken automatically and used as the receiver.</p>\n"}], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 31790710, "answer_count": 1, "score": 1, "last_activity_date": 1438615709, "creation_date": 1438612583, "last_edit_date": 1438615709, "question_id": 31790113, "link": "https://stackoverflow.com/questions/31790113/address-of-composite-literal-used-as-interface", "title": "Address of composite literal used as interface", "body": "<p>The address of a composite literal is evaluated as the literal itself when used as an interface. Can somebody please point to the part of the <a href=\"http://golang.org/ref/spec\" rel=\"nofollow\">ref spec</a> which deals with this ?</p>\n\n<pre><code>package main\nimport \"fmt\"\n\ntype ntfc interface {\n    rx() int\n}\n\ntype cncrt struct {\n    x int\n}\n\nfunc (c cncrt) rx() int{\n    return c.x\n}\n\nfunc rtrnsNtfca() ntfc {\n    return &amp;cncrt{3}\n}\n\nfunc rtrnsNtfc() ntfc {\n    return cncrt{3}\n}\n\nfunc rtrnsCncrt() *cncrt {\n    return &amp;cncrt{3}\n}\n\nfunc main() {\n    fmt.Println(rtrnsNtfca().rx())\n    fmt.Println(rtrnsNtfc().rx())\n    fmt.Println(rtrnsCncrt().rx())\n}\n</code></pre>\n\n<p>Also <a href=\"http://play.golang.org/p/y_V5O9YPb4\" rel=\"nofollow\">here</a>. For future ref., is it acceptable to just link to the playground without including the code here?</p>\n"}, {"tags": ["go", "constants", "godoc"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1438623255, "creation_date": 1438623255, "answer_id": 31793350, "question_id": 31789348, "link": "https://stackoverflow.com/questions/31789348/godoc-will-not-generate-const-field-if-custom-type-is-declared-and-used-in-con/31793350#31793350", "title": "Godoc will not generate &quot;const&quot; field if custom type is declared and used in const definition?", "body": "<p>GoDoc groups by type.  It is not possible to move the documentation for typed constants to the package level.  The same applies to \"factory\" functions, methods, etc.</p>\n"}, {"comments": [{"owner": {"reputation": 8567, "user_id": 276952, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4e7ed0bd67a2393841597534acbbf7fe?s=128&d=identicon&r=PG", "display_name": "Philip Potter", "link": "https://stackoverflow.com/users/276952/philip-potter"}, "edited": false, "score": 1, "creation_date": 1581173256, "post_id": 46255096, "comment_id": 106345752, "body": "Thanks! I was having the opposite problem (my constants were appearing at package level and not beside the type) and I couldn&#39;t work out why until I read this answer."}], "tags": [], "owner": {"reputation": 646, "user_id": 712014, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/4InEp.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/712014/michael"}, "is_accepted": false, "score": 1, "last_activity_date": 1505573097, "creation_date": 1505573097, "answer_id": 46255096, "question_id": 31789348, "link": "https://stackoverflow.com/questions/31789348/godoc-will-not-generate-const-field-if-custom-type-is-declared-and-used-in-con/46255096#46255096", "title": "Godoc will not generate &quot;const&quot; field if custom type is declared and used in const definition?", "body": "<p>Writing it the following way will make the const block show up at package level. I\u2019m not sure if this is intended behavior or just an inconsistency.</p>\n\n<pre><code>type Level int\nconst (\n    Info = Level(iota)\n)\n</code></pre>\n"}], "owner": {"reputation": 163, "user_id": 3850194, "user_type": "registered", "profile_image": "https://graph.facebook.com/1065596029/picture?type=large", "display_name": "Yang Hu", "link": "https://stackoverflow.com/users/3850194/yang-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 31793350, "answer_count": 2, "score": 1, "last_activity_date": 1505573097, "creation_date": 1438610506, "last_edit_date": 1438635041, "question_id": 31789348, "link": "https://stackoverflow.com/questions/31789348/godoc-will-not-generate-const-field-if-custom-type-is-declared-and-used-in-con", "title": "Godoc will not generate &quot;const&quot; field if custom type is declared and used in const definition?", "body": "<p>I find Godoc a great tool to automatically generate docs. But I found that, if I define a custom type and use it in my constant definition, in the godoc HTML, the constants will be displayed under that type, but not in the package level. </p>\n\n<p>Here's a simple example:</p>\n\n<pre><code>const (\n    Info = iota\n    Warning\n    Error\n)\n</code></pre>\n\n<p>This will generate a \"Constants\" heading at the top of the godoc. But if I do the following, there will be no Constants heading for the package</p>\n\n<pre><code>type Level int\nconst (\n    Info Level = iota\n    Warning\n    Error\n)\n</code></pre>\n\n<p>In the godoc output, the constants will be displayed under <code>type Level</code>, somewhere in the middle of the document, but not at the top and not in the package level.</p>\n\n<p>Is there any way to use custom types, but still put the const definitions in the package level in godoc?</p>\n"}, {"tags": ["memory", "go", "goroutine"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1438610763, "post_id": 31788888, "comment_id": 51507055, "body": "most probably - you are not setting timeouts on your http client, so it just hangs there. Why would go &quot;free&quot; a perfectly running goroutine?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438619059, "post_id": 31788888, "comment_id": 51512479, "body": "Go routines are like memory in C++ or something. They&#39;re not garbage collected or cleaned up automatically or anything. If the method that was invoked by <code>go SomeMethod()</code> has not returned by hitting that very explicit <code>return</code> keyword then it is going to continue running."}, {"owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438678440, "post_id": 31788888, "comment_id": 51535592, "body": "@Not_a_Golfer I set a timeout for http.Get() requests and still have the smae problem"}], "answers": [{"tags": [], "owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "is_accepted": false, "score": 0, "last_activity_date": 1438937685, "creation_date": 1438937685, "answer_id": 31873556, "question_id": 31788888, "link": "https://stackoverflow.com/questions/31788888/memory-consumption-with-many-goroutines/31873556#31873556", "title": "Memory consumption with many goroutines", "body": "<p>I updated my Go version from 1.4 to 1.5 and it soloves the problem.</p>\n\n<p>I did some reserch before to find where the problem comes from I noticed that a lot of peopel have the same problem and no one know why.I think thtat the problem was in the <code>http/net</code> library because as I said in my question the function who  took the most of goroutints is <strong>singleflight</strong> and this function is called by <code>http.Get(url)</code></p>\n"}], "owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 726, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1565691874, "creation_date": 1438609181, "last_edit_date": 1565691874, "question_id": 31788888, "link": "https://stackoverflow.com/questions/31788888/memory-consumption-with-many-goroutines", "title": "Memory consumption with many goroutines", "body": "<p>I've put up an http server written in Go and it's getting over a thousands visitors a day. I have an accumulating Goroutine problem(never freed). Over the course of a day I seem to get a little over a thousand of thousand of new Goroutines from the http server.I used <code>pprof</code> to check where the problem comes from and I got that:</p>\n\n<p><a href=\"http://creative2.spoti.io/static/pprof.svg\" rel=\"nofollow noreferrer\">Link: memory consumption: SVG pprof</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/gcE8V.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/gcE8V.png\" alt=\"enter image description here\"></a></p>\n\n<p>Heap:</p>\n\n<p><a href=\"https://i.stack.imgur.com/jT8is.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jT8is.png\" alt=\"enter image description here\"></a></p>\n\n<p>Below are tow of my goroutines </p>\n\n<pre><code>500 @ 0x410255 0x5a9255 0x5a9e25 0x5aa615 0x5990cf 0x5ada95 0x59d23f 0x4367b1\n#   0x5a9255    net._C2func_getaddrinfo+0x55    /usr/local/go/src/net/:26\n#   0x5a9e25    net.cgoLookupIPCNAME+0x1c5  /usr/local/go/src/net/cgo_unix.go:96\n#   0x5aa615    net.cgoLookupIP+0x65        /usr/local/go/src/net/cgo_unix.go:148\n#   0x5990cf    net.lookupIP+0x5f       /usr/local/go/src/net/lookup_unix.go:64\n#   0x5ada95    net.func\u00b7026+0x55       /usr/local/go/src/net/lookup.go:79\n#   0x59d23f    net.(*singleflight).doCall+0x2f /usr/local/go/src/net/singleflight.go:91\n\n157871 @ 0x423985 0x4239f8 0x411464 0x410c93 0x5a9d68 0x5aa615 0x5990cf 0x5ada95 0x59d23f 0x4367b1\n#   0x5a9d68    net.cgoLookupIPCNAME+0x108  /usr/local/go/src/net/cgo_unix.go:85\n#   0x5aa615    net.cgoLookupIP+0x65        /usr/local/go/src/net/cgo_unix.go:148\n#   0x5990cf    net.lookupIP+0x5f       /usr/local/go/src/net/lookup_unix.go:64\n#   0x5ada95    net.func\u00b7026+0x55       /usr/local/go/src/net/lookup.go:79\n#   0x59d23f    net.(*singleflight).doCall+0x2f /usr/local/go/src/net/singleflight.go:91\n</code></pre>\n\n<p>Here we can see that <strong>singleflight.go</strong> took the most of goroutints, it's a native library of Go.</p>\n\n<p>my code bolocked in this function </p>\n\n<pre><code>func getXmlVast(url string) (string, error) {\n    resp, err := http.Get(url)\n    if err != nil {\n        return \"\", errors.New(\"request error A(\" + err.Error() + \")\")\n    }\n    defer resp.Body.Close()\n    // read xml http response\n    xmlData, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        return \"\", errors.New(\"request error B(\" + err.Error() + \")\")\n    }\n    return string(xmlData), nil\n}\n</code></pre>\n\n<p>Why Go never freed the goroutines and what <strong>singleflight.go</strong> do.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1438610174, "post_id": 31788886, "comment_id": 51506605, "body": "How are you going to use <code>buffer</code> later in your app?"}, {"owner": {"reputation": 2917, "user_id": 940939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04fbc97c3735bb1e24b90e1aa336aae?s=128&d=identicon&r=PG", "display_name": "Massimo Zerbini", "link": "https://stackoverflow.com/users/940939/massimo-zerbini"}, "edited": false, "score": 0, "creation_date": 1438611145, "post_id": 31788886, "comment_id": 51507319, "body": "You can change buffer to a slice of byte and use the builtin func append(...), but if you&#39;re trying to append GB of data you can get out of memory anyway."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438611848, "post_id": 31788886, "comment_id": 51507828, "body": "Consider to read <a href=\"http://stackoverflow.com/questions/24863164/how-to-analyse-golang-memory\" title=\"how to analyse golang memory\">stackoverflow.com/questions/24863164/&hellip;</a>"}, {"owner": {"reputation": 1948, "user_id": 1924657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gumlg.jpg?s=128&g=1", "display_name": "Bryce", "link": "https://stackoverflow.com/users/1924657/bryce"}, "edited": false, "score": 0, "creation_date": 1470305435, "post_id": 31788886, "comment_id": 64900466, "body": "<code>string</code> is constant in Golang. It&#39;s better to use <code>bytes.Buffer</code> instead and also other language which <code>string</code> is constant."}], "answers": [{"comments": [{"owner": {"reputation": 8641, "user_id": 732539, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d33cc4a619410535e0176138c6971ba3?s=128&d=identicon&r=PG", "display_name": "K2xL", "link": "https://stackoverflow.com/users/732539/k2xl"}, "edited": false, "score": 0, "creation_date": 1438619284, "post_id": 31791886, "comment_id": 51512616, "body": "Heh, I was just about to post this as I just changed my code to use bytes.Buffer. Thanks!"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 4, "last_activity_date": 1438617888, "creation_date": 1438617888, "answer_id": 31791886, "question_id": 31788886, "link": "https://stackoverflow.com/questions/31788886/golang-json-marshaling/31791886#31791886", "title": "Golang JSON Marshaling", "body": "<p>Assuming your data isn't inherently too big for the computer it's running on, the problem is likely the inefficient building of that string. Instead you should be using a <code>bytes.buffer</code> and then callings it's <code>String()</code> method. Here's an example;</p>\n\n<pre><code>var buffer bytes.Buffer\n\nfor _, record := range all_data {\n    body, _ := json.Marshal(record)\n    buffer.Write(body)\n    buffer.WriteString(\"\\n\")\n}\n\nfmt.Println(buffer.String())\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24922, "user_id": 4001, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3b2c4583cd2eee64afe2ff888d590cf9?s=128&d=identicon&r=PG", "display_name": "abbot", "link": "https://stackoverflow.com/users/4001/abbot"}, "is_accepted": false, "score": 0, "last_activity_date": 1541110924, "creation_date": 1541110924, "answer_id": 53110196, "question_id": 31788886, "link": "https://stackoverflow.com/questions/31788886/golang-json-marshaling/53110196#53110196", "title": "Golang JSON Marshaling", "body": "<p>To add to evanmcdonnal's answer: you don't even need an intermediate buffer created by json.Marshal:</p>\n\n<pre><code>var buf bytes.Buffer\nenc := json.NewEncoder(&amp;buf)\nfor _, record := range allData {\n  if err := enc.Encode(record); enc != nil {\n    // handle error\n  }\n  buf.WriteString(\"\\n\") // optional\n}\nfmt.Println(buf.String())\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/5K9Oj0Xbjaa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5K9Oj0Xbjaa</a></p>\n"}], "owner": {"reputation": 8641, "user_id": 732539, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d33cc4a619410535e0176138c6971ba3?s=128&d=identicon&r=PG", "display_name": "K2xL", "link": "https://stackoverflow.com/users/732539/k2xl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2955, "favorite_count": 0, "accepted_answer_id": 31791886, "answer_count": 2, "score": 1, "last_activity_date": 1541110924, "creation_date": 1438609174, "last_edit_date": 1541109478, "question_id": 31788886, "link": "https://stackoverflow.com/questions/31788886/golang-json-marshaling", "title": "Golang JSON Marshaling", "body": "<p>I'm trying to marshal an array into a string, separating all elements with newlines. I'm running out of memory and think about a more efficient way to do this.</p>\n\n<pre><code>buffer := \"\"\nfor _, record := range all_data {\n\n    body, _ := json.Marshal(record)\n    buffer += string(body) + \"\\n\" // i run out of memory here\n</code></pre>\n\n<p><strong>Question:</strong></p>\n\n<p>Is there a way to append a newline character to a byte array? Right now I'm casting via <code>string(body)</code>, but I think that this operation allocates a lot of memory (but maybe I'm wrong).</p>\n"}, {"tags": ["html", "json", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user745235"}, "edited": false, "score": 1, "creation_date": 1438607419, "post_id": 31788134, "comment_id": 51504643, "body": "It sounds like you are looking for an HTML parser."}], "answers": [{"tags": [], "owner": {"reputation": 26843, "user_id": 208997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/250e219125d8bff1f03e6faea950f218?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/208997/simon"}, "is_accepted": false, "score": 2, "last_activity_date": 1438614798, "creation_date": 1438614798, "answer_id": 31790867, "question_id": 31788134, "link": "https://stackoverflow.com/questions/31788134/html-validation-with-golang/31790867#31790867", "title": "HTML Validation with Golang", "body": "<p>You check that the HTML blob provided parses correctly using <a href=\"https://godoc.org/golang.org/x/net/html#Parse\" rel=\"nofollow\"><code>html.Parse</code></a> from <a href=\"https://golang.org/x/net/html\" rel=\"nofollow\">this package</a>. For validation only, all you have to do is check for errors.</p>\n"}, {"tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 1, "last_activity_date": 1537374997, "creation_date": 1537374997, "answer_id": 52410528, "question_id": 31788134, "link": "https://stackoverflow.com/questions/31788134/html-validation-with-golang/52410528#52410528", "title": "HTML Validation with Golang", "body": "<p>A bit late to the game, but here are a couple of parsers in Go that will work if you just want to validate the structure of the HTML (eg. you don't care if a div is inside a span, which is not allowed but is a schema level problem):</p>\n\n<h3>x/net/html</h3>\n\n<p>The <a href=\"https://godoc.org/golang.org/x/net/html\" rel=\"nofollow noreferrer\"><code>golang.org/x/net/html</code></a> package contains a <em>very</em> loose parser. Almost anything will result in valid HTML, similar to what a lot of web browsers try to do (eg. it will ignore problems with unescaped values in many cases).\nFor example, something like <code>&lt;span&gt;&gt;&lt;/span&gt;</code> will likely validate (I didn't check this particular one, I just made it up) as a span with the '>' character in it.</p>\n\n<p>It can be used something like this:</p>\n\n<pre><code>r := strings.NewReader(`&lt;span&gt;&gt;&lt;/span&gt;`)\nz := html.NewTokenizer(r)\nfor {\n    tt := z.Next()\n    if tt == html.ErrorToken {\n        err := z.Err()\n        if err == io.EOF {\n            // Not an error, we're done and it's valid!\n            return nil\n        }\n        return err\n    }\n}\n</code></pre>\n\n<h2>encoding/xml</h2>\n\n<p>If you need something a tiny bit more strict, but which is still okay for HTML you can configure an <a href=\"https://godoc.org/encoding/xml#Decoder\" rel=\"nofollow noreferrer\"><code>xml.Decoder</code></a> to work with HTML (this is what I do, it lets me be a bit more flexible about how strict I want to be in any given situation):</p>\n\n<pre><code>r := strings.NewReader(`&lt;html&gt;&lt;/html&gt;`)\nd := xml.NewDecoder(r)\n\n// Configure the decoder for HTML; leave off strict and autoclose for XHTML\nd.Strict = false\nd.AutoClose = xml.HTMLAutoClose\nd.Entity = xml.HTMLEntity\nfor {\n    tt, err := d.Token()\n    switch err {\n    case io.EOF:\n        return nil // We're done, it's valid!\n    case nil:\n    default:\n        return err // Oops, something wasn't right\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2282, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1537374997, "creation_date": 1438607121, "question_id": 31788134, "link": "https://stackoverflow.com/questions/31788134/html-validation-with-golang", "title": "HTML Validation with Golang", "body": "<p>Within my API I have a POST end point. One of the expected parameters being posted to that end point is a block of (loosely) valid HTML.</p>\n\n<p>The POST will be in the format of JSON.</p>\n\n<p>Within golang how can I ensure that the HTML which is posted is valid? I have been looking for something for a few days now and still haven't managed to find anything?</p>\n\n<p>The term \"valid\" is kind of loose. I trying to ensure that tags are opened and closed, speech marks are in the right places etc.</p>\n"}, {"tags": ["memory-management", "go", "heap-memory"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1438604087, "post_id": 31786937, "comment_id": 51502447, "body": "Related: <a href=\"http://stackoverflow.com/questions/10866195/stack-vs-heap-allocation-of-structs-in-go-and-how-they-relate-to-garbage-collec\">Stack vs heap allocation of structs in Go, and how they relate to garbage collection</a>"}, {"owner": {"reputation": 346, "user_id": 890404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4121e34ff1703053615367bd653bf006?s=128&d=identicon&r=PG", "display_name": "olippuner", "link": "https://stackoverflow.com/users/890404/olippuner"}, "edited": false, "score": 0, "creation_date": 1600988465, "post_id": 31786937, "comment_id": 113271510, "body": "In Pascal, C et. al. the scope of a variable and it\u2019s lifetime are tighly coupled. All local variables function are allocated on stack and invalidated after termination of the scope. In Golang this does nomore hold. E.g. localness can be broken up by pointer references. Thus a local variable can be return as a pointer reference, and it survives termination of the local scope.  This idea may be suspicious to many programmers of PASCAL or C-style languages. Thus thinking about this question can greatly help to understand Golang specifics."}], "answers": [{"tags": [], "owner": {"reputation": 332764, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "is_accepted": true, "score": 22, "last_activity_date": 1438604200, "last_edit_date": 1438604200, "creation_date": 1438604014, "answer_id": 31786988, "question_id": 31786937, "link": "https://stackoverflow.com/questions/31786937/are-all-the-variables-in-go-allocated-on-heap/31786988#31786988", "title": "Are all the variables in Go allocated on heap?", "body": "<p><a href=\"https://golang.org/doc/faq#stack_or_heap\">There's a very clear answer to that question in the FAQ</a>:</p>\n\n<blockquote>\n  <p><strong>How do I know whether a variable is allocated on the heap or the\n  stack?</strong></p>\n  \n  <p>From a correctness standpoint, you don't need to know. Each variable\n  in Go exists as long as there are references to it. The storage\n  location chosen by the implementation is irrelevant to the semantics\n  of the language.</p>\n  \n  <p>The storage location does have an effect on writing efficient\n  programs. When possible, the Go compilers will allocate variables that\n  are local to a function in that function's stack frame. However, if\n  the compiler cannot prove that the variable is not referenced after\n  the function returns, then the compiler must allocate the variable on\n  the garbage-collected heap to avoid dangling pointer errors. Also, if\n  a local variable is very large, it might make more sense to store it\n  on the heap rather than the stack.</p>\n  \n  <p>In the current compilers, if a variable has its address taken, that\n  variable is a candidate for allocation on the heap. However, a basic\n  escape analysis recognizes some cases when such variables will not\n  live past the return from the function and can reside on the stack.</p>\n</blockquote>\n\n<p>TLDR: You shouldn't care. Go takes care of allocation for you.</p>\n"}], "owner": {"reputation": 518, "user_id": 3649275, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e5d2fcaf83b9ce4d492711694e4f26ff?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/3649275/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2111, "favorite_count": 3, "accepted_answer_id": 31786988, "answer_count": 1, "score": 10, "last_activity_date": 1438607030, "creation_date": 1438603854, "last_edit_date": 1438607030, "question_id": 31786937, "link": "https://stackoverflow.com/questions/31786937/are-all-the-variables-in-go-allocated-on-heap", "title": "Are all the variables in Go allocated on heap?", "body": "<p>I am new to Go, and found it is OK to return the address of a local variable defined in a function. That is obviously not possible in C since local variable is in stack.</p>\n\n<p>So I am just wondering why it is OK to do it in Go? In Go, the local variable is in heap? Will it affect performance since allocating heap memory is quite expensive than stack? Is it possible allocate local variable in stack in Go? Or actually is there stack memory in Go?</p>\n"}, {"tags": ["go", "command-line-interface", "command-line-arguments"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 41, "last_activity_date": 1438602247, "creation_date": 1438602247, "answer_id": 31786364, "question_id": 31786215, "link": "https://stackoverflow.com/questions/31786215/can-command-line-flags-in-go-be-set-to-mandatory/31786364#31786364", "title": "Can command line flags in Go be set to mandatory?", "body": "<p>The <a href=\"https://golang.org/pkg/flag/\" rel=\"noreferrer\"><code>flag</code></a> package does not support mandatory or required flags (meaning the flag must be specified explicitly).</p>\n\n<p>What you can do is use sensible default values for (all) flags. And if a flag is something like there is no sensible default, check the value at the start of your application and halt with an error message. You should do flag value validation anyway (not just for required flags), so this shouldn't mean any (big) overhead, and this is a good practice in general.</p>\n"}, {"tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": false, "score": 7, "last_activity_date": 1597040725, "last_edit_date": 1597040725, "creation_date": 1438602592, "answer_id": 31786480, "question_id": 31786215, "link": "https://stackoverflow.com/questions/31786215/can-command-line-flags-in-go-be-set-to-mandatory/31786480#31786480", "title": "Can command line flags in Go be set to mandatory?", "body": "<p>I like <a href=\"https://github.com/jessevdk/go-flags\" rel=\"nofollow noreferrer\"><code>github.com/jessevdk/go-flags</code></a> package to use in CLI. It provides a <code>required</code> attribute, to set a mandatory flag:</p>\n<pre><code>var opts struct {\n...\n    // Example of a required flag\n    Name string `short:&quot;n&quot; long:&quot;name&quot; description:&quot;A name&quot; required:&quot;true&quot;`\n...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 12, "last_activity_date": 1438632665, "last_edit_date": 1495541883, "creation_date": 1438632665, "answer_id": 31795922, "question_id": 31786215, "link": "https://stackoverflow.com/questions/31786215/can-command-line-flags-in-go-be-set-to-mandatory/31795922#31795922", "title": "Can command line flags in Go be set to mandatory?", "body": "<p>As <a href=\"https://stackoverflow.com/a/31786364/55504\">already mentioned</a>, the <code>flag</code> package does not provide this feature directly and usually you can (and should) be able to provide a sensible default. For cases where you only need a small number of explicit arguments (e.g.\u00a0an input and output filename) you could use positional arguments (e.g.\u00a0after <code>flag.Parse()</code> check that <code>flag.NArg()==2</code> and then <code>input, output := flag.Arg(0), flag.Arg(1)</code>).</p>\n\n<p>If however, you have a case where this isn't sensible; say a few integer flags you want to accept in any order, where any integer value is reasonable, but no default is. Then you can use the <a href=\"https://golang.org/pkg/flag/#Visit\" rel=\"noreferrer\"><code>flag.Visit</code></a> function to check if the flags you care about were explicitly set or not. I think this is the only way to tell if a flag was explicitly set to it's default value (not counting a custom <code>flag.Value</code> type with a <code>Set</code> implementation that kept state).</p>\n\n<p>For example, perhaps something like:</p>\n\n<pre><code>    required := []string{\"b\", \"s\"}\n    flag.Parse()\n\n    seen := make(map[string]bool)\n    flag.Visit(func(f *flag.Flag) { seen[f.Name] = true })\n    for _, req := range required {\n        if !seen[req] {\n            // or possibly use `log.Fatalf` instead of:\n            fmt.Fprintf(os.Stderr, \"missing required -%s argument/flag\\n\", req)\n            os.Exit(2) // the same exit code flag.Parse uses\n        }\n    }\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/FqKzq_1ICs\" rel=\"noreferrer\"><kbd>Playground</kbd></a></p>\n\n<p>This would produce an error if either the \"-b\" or \"-s\" flag was not explicitly set.</p>\n"}, {"tags": [], "owner": {"reputation": 455, "user_id": 1788530, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3f9fb3cbecc68ef2a30720e88e6854b?s=128&d=identicon&r=PG", "display_name": "iKanor", "link": "https://stackoverflow.com/users/1788530/ikanor"}, "is_accepted": false, "score": 9, "last_activity_date": 1480250346, "creation_date": 1480250346, "answer_id": 40829034, "question_id": 31786215, "link": "https://stackoverflow.com/questions/31786215/can-command-line-flags-in-go-be-set-to-mandatory/40829034#40829034", "title": "Can command line flags in Go be set to mandatory?", "body": "<p><a href=\"https://github.com/jessevdk/go-flags\" rel=\"noreferrer\"><code>go-flags</code></a> lets you declare both required flags and required positional arguments:</p>\n\n<pre><code>var opts struct {\n    Flag string `short:\"f\" required:\"true\" name:\"a flag\"`\n    Args struct {\n        First   string `positional-arg-name:\"first arg\"`\n        Sencond string `positional-arg-name:\"second arg\"`\n    } `positional-args:\"true\" required:\"2\"`\n}\nargs, err := flags.Parse(&amp;opts)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "edited": false, "score": 0, "creation_date": 1597040958, "post_id": 42539510, "comment_id": 111993689, "body": "Instead of <code>usage()</code>, <code>flag.Usage()</code> could be used."}], "tags": [], "owner": {"reputation": 665, "user_id": 371756, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5050526a7aa25dbaa31bd63e4565af48?s=128&d=identicon&r=PG", "display_name": "ivan73", "link": "https://stackoverflow.com/users/371756/ivan73"}, "is_accepted": false, "score": 6, "last_activity_date": 1509930001, "last_edit_date": 1509930001, "creation_date": 1488393755, "answer_id": 42539510, "question_id": 31786215, "link": "https://stackoverflow.com/questions/31786215/can-command-line-flags-in-go-be-set-to-mandatory/42539510#42539510", "title": "Can command line flags in Go be set to mandatory?", "body": "<p>If you have flag path, simply check if *path contains some value</p>\n\n<pre><code>var path = flag.String(\"f\", \"\", \"/path/to/access.log\")\nflag.Parse()\nif *path == \"\" {\n    usage()\n    os.Exit(1)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565098936, "post_id": 57366702, "comment_id": 101239370, "body": "<code>seen</code> no longer means &quot;seen&quot; in your code but instead &quot;empty string&quot;, at which point you&#39;d be much better off just checking that <code>flag.Lookup(req).Value.String() != &quot;&quot;</code> and ditching the map entirely. You also may be better off by getting values from the environment in a different way rather than changing flag defaults (e.g. perhaps something like <a href=\"https://godoc.org/bitbucket.org/dchapes/envflag\" rel=\"nofollow noreferrer\"><code>envflag</code></a>)."}, {"owner": {"reputation": 31, "user_id": 11075587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53d23042e2970a551f74465e94eb64c9?s=128&d=identicon&r=PG", "display_name": "canhizares", "link": "https://stackoverflow.com/users/11075587/canhizares"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565216936, "post_id": 57366702, "comment_id": 101287519, "body": "I agree with the name but I wanted to keep the same as the previous solution because it was just an example of an adaptation to a solution that is not mine. On using another way, I still prefer to use <a href=\"https://golang.org/pkg/flag/\" rel=\"nofollow noreferrer\">flag</a> because it allows me to pass parameters by command line in a development environment and leave the environment variables for production."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1618578533, "post_id": 57366702, "comment_id": 118650897, "body": "Just for completeness (I don&#39;t expect anyone uses it), the above linked <code>envflag</code> package moved to <a href=\"https://pkg.go.dev/hg.sr.ht/~dchapes/envflag.hg\" rel=\"nofollow noreferrer\"><code>envflag</code></a> since bitbucket deleted all non-git repositories :(."}], "tags": [], "owner": {"reputation": 31, "user_id": 11075587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53d23042e2970a551f74465e94eb64c9?s=128&d=identicon&r=PG", "display_name": "canhizares", "link": "https://stackoverflow.com/users/11075587/canhizares"}, "is_accepted": false, "score": 2, "last_activity_date": 1565043513, "creation_date": 1565043513, "answer_id": 57366702, "question_id": 31786215, "link": "https://stackoverflow.com/questions/31786215/can-command-line-flags-in-go-be-set-to-mandatory/57366702#57366702", "title": "Can command line flags in Go be set to mandatory?", "body": "<p>I agree with <a href=\"https://stackoverflow.com/a/31795922/11075587\">this solution</a> but, in my case default values are usually environment values. For example,</p>\n\n<pre><code>dsn := flag.String(\"dsn\", os.Getenv(\"MYSQL_DSN\"), \"data source name\")\n</code></pre>\n\n<p>And in this case, I want to check if the values are set from invocation (usually local development) or environment var (prod environment). </p>\n\n<p>So with some minor modifications, it worked for my case.</p>\n\n<p>Using <a href=\"https://golang.org/pkg/flag/#VisitAll\" rel=\"nofollow noreferrer\">flag.VisitAll</a> to check the value of all flags.</p>\n\n<pre><code>required := []string{\"b\", \"s\"}\nflag.Parse()\n\nseen := make(map[string]bool)\nflag.VisitAll(func(f *flag.Flag) {\n    if f.Value.String() != \"\" {\n        seen[f.Name] = true\n    }\n})\nfor _, req := range required {\n    if !seen[req] {\n        // or possibly use `log.Fatalf` instead of:\n        fmt.Fprintf(os.Stderr, \"missing required -%s argument/flag\\n\", req)\n        os.Exit(2) // the same exit code flag.Parse uses\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0ybaFl_b9OX\" rel=\"nofollow noreferrer\"><kbd>Test example in plauground</kbd></a></p>\n"}, {"tags": [], "owner": {"reputation": 76, "user_id": 3499843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cac96e9bdc1b1f1691a2e3ccd0c76a0?s=128&d=identicon&r=PG&f=1", "display_name": "Gerben", "link": "https://stackoverflow.com/users/3499843/gerben"}, "is_accepted": false, "score": 0, "last_activity_date": 1593512123, "last_edit_date": 1593512123, "creation_date": 1593511755, "answer_id": 62655043, "question_id": 31786215, "link": "https://stackoverflow.com/questions/31786215/can-command-line-flags-in-go-be-set-to-mandatory/62655043#62655043", "title": "Can command line flags in Go be set to mandatory?", "body": "<p>Or you could docopt, where you only have to write the &quot;usage&quot; text. Docopt interprets the usage text and creates an argument map. This opens up a whole lot of possibilities, all following the POSIX usage text standard. This library is available for about 20 languages already.</p>\n<p><a href=\"https://github.com/docopt/docopt.go\" rel=\"nofollow noreferrer\">https://github.com/docopt/docopt.go</a></p>\n<pre><code>package main\n\nimport (\n        &quot;fmt&quot;\n        &quot;github.com/docopt/docopt-go&quot;\n)\n\nconst (\n        Usage = `Naval Fate.\n\nUsage:\n  naval_fate ship new &lt;name&gt;...\n  naval_fate ship &lt;name&gt; move &lt;x&gt; &lt;y&gt; [--speed=&lt;kn&gt;]\n  naval_fate ship shoot &lt;x&gt; &lt;y&gt;\n  naval_fate mine (set|remove) &lt;x&gt; &lt;y&gt; [--moored|--drifting]\n  naval_fate -h | --help\n  naval_fate --version\n\nOptions:\n  -h --help     Show this screen.\n  --version     Show version.\n  --speed=&lt;kn&gt;  Speed in knots [default: 10].\n  --moored      Moored (anchored) mine.\n  --drifting    Drifting mine.`\n)\n\nfunc main() {\n        args, _ := docopt.ParseDoc(Usage)\n        fmt.Println(args)\n}\n</code></pre>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33282, "favorite_count": 5, "accepted_answer_id": 31786364, "answer_count": 7, "score": 49, "last_activity_date": 1597040725, "creation_date": 1438601776, "question_id": 31786215, "link": "https://stackoverflow.com/questions/31786215/can-command-line-flags-in-go-be-set-to-mandatory", "title": "Can command line flags in Go be set to mandatory?", "body": "<p>Is there a way how to set that certain flags are mandatory, or do I have to check for their presence on my own?</p>\n"}, {"tags": ["mysql", "sql", "go", "rows"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 5170123, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d2f5e55fce224cf6f6a6ec7b00c28687?s=128&d=identicon&r=PG&f=1", "display_name": "Gopher", "link": "https://stackoverflow.com/users/5170123/gopher"}, "edited": false, "score": 0, "creation_date": 1438592275, "post_id": 31783108, "comment_id": 51495645, "body": "Thank you very match! It works! Simple! One moe question please! Why it converts to <code>&amp;lt;p&amp;gt;&amp;lt;strong&amp;gt;HELLO!&amp;lt;&#47;strong&amp;gt;&amp;lt;&#47;p&amp;gt;</code>"}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "reply_to_user": {"reputation": 11, "user_id": 5170123, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d2f5e55fce224cf6f6a6ec7b00c28687?s=128&d=identicon&r=PG&f=1", "display_name": "Gopher", "link": "https://stackoverflow.com/users/5170123/gopher"}, "edited": false, "score": 0, "creation_date": 1438592441, "post_id": 31783108, "comment_id": 51495734, "body": "The result of convertion is HTML. <code>&quot;* OneTwoThree&quot;</code> will convert to <code>&lt;ul&gt; \t&lt;li&gt;OneTwoThree&lt;&#47;li&gt; \t&lt;&#47;ul&gt;</code>"}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "reply_to_user": {"reputation": 11, "user_id": 5170123, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d2f5e55fce224cf6f6a6ec7b00c28687?s=128&d=identicon&r=PG&f=1", "display_name": "Gopher", "link": "https://stackoverflow.com/users/5170123/gopher"}, "edited": false, "score": 0, "creation_date": 1438592619, "post_id": 31783108, "comment_id": 51495826, "body": "Do you asking why <code>&amp;lt;</code> instead <code>&lt;</code>? Where did you get it? Do you get it on the webpage, and you use <code>html&#47;template</code>? Please provide more information."}, {"owner": {"reputation": 11, "user_id": 5170123, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d2f5e55fce224cf6f6a6ec7b00c28687?s=128&d=identicon&r=PG&f=1", "display_name": "Gopher", "link": "https://stackoverflow.com/users/5170123/gopher"}, "edited": false, "score": 0, "creation_date": 1438592742, "post_id": 31783108, "comment_id": 51495897, "body": "but when it ExecuteTemplate this converts to <code>&amp;lt;p&amp;gt;&amp;lt;strong&amp;gt;HELLO!&amp;lt;&#47;strong&amp;gt;&amp;lt;&#47;p&amp;gt;</code>"}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "reply_to_user": {"reputation": 11, "user_id": 5170123, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d2f5e55fce224cf6f6a6ec7b00c28687?s=128&d=identicon&r=PG&f=1", "display_name": "Gopher", "link": "https://stackoverflow.com/users/5170123/gopher"}, "edited": false, "score": 0, "creation_date": 1438593057, "post_id": 31783108, "comment_id": 51496076, "body": "I think this post is related: <a href=\"http://stackoverflow.com/questions/27776525/escaping-to-39-in-golang-html-template\" title=\"escaping to 39 in golang html template\">stackoverflow.com/questions/27776525/&hellip;</a>"}, {"owner": {"reputation": 11, "user_id": 5170123, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d2f5e55fce224cf6f6a6ec7b00c28687?s=128&d=identicon&r=PG&f=1", "display_name": "Gopher", "link": "https://stackoverflow.com/users/5170123/gopher"}, "edited": false, "score": 0, "creation_date": 1438593448, "post_id": 31783108, "comment_id": 51496298, "body": "No! This is another problem here :) Look how it looks <a href=\"http://imgur.com/kw8b5mX\" rel=\"nofollow noreferrer\">imgur.com/kw8b5mX</a> Please help!"}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "reply_to_user": {"reputation": 11, "user_id": 5170123, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d2f5e55fce224cf6f6a6ec7b00c28687?s=128&d=identicon&r=PG&f=1", "display_name": "Gopher", "link": "https://stackoverflow.com/users/5170123/gopher"}, "edited": false, "score": 0, "creation_date": 1438593597, "post_id": 31783108, "comment_id": 51496390, "body": "That&#39;s why you use <code>html&#47;template</code>. That package will escape all your data. If you need to add html tags, you need to use something else. You can use <code>text&#47;template</code> for this."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1438603437, "post_id": 31783108, "comment_id": 51502039, "body": "<i>Don&#39;t</i> use text/template. If you need to render one struct field as unescaped HTML, set the struct field&#39;s type to to <code>template.HTML</code> instead of <code>string</code>. Using text/template makes everything else insecure."}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1438604098, "post_id": 31783108, "comment_id": 51502460, "body": "Thank you very much! I missed that in <code>html&#47;template</code> package. Thanks!"}], "tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": false, "score": -1, "last_activity_date": 1438604044, "last_edit_date": 1438604044, "creation_date": 1438591788, "answer_id": 31783108, "question_id": 31782933, "link": "https://stackoverflow.com/questions/31782933/convert-to-markdown-in-mysql-foreach-and-add-to-array/31783108#31783108", "title": "Convert to Markdown in mysql foreach and add to array", "body": "<p>I think the problem in your code is in the using <code>&amp;p.Body</code> (pointer) instead of <code>p.Body</code>.\nTry it:</p>\n\n<pre><code>p.Body = string(blackfriday.MarkdownCommon([]byte(p.Body)))  \n</code></pre>\n\n<p>Also I think you want to save result of convertion into <code>p.BodyHtml</code> instead of <code>p.Body</code>.</p>\n\n<p>You have to make conversation <em>before</em> you add result to array (slice), because <code>append</code> will add a <strong>copy</strong> of your structure into array (slice). Or you can use a pointer in your array (slice).</p>\n\n<p>So, finally: </p>\n\n<pre><code>type post struct {\n    Id          int\n    Title       string\n    Body        string\n    Tags        string\n    Time        string\n    BodyHtml    string\n}\n\nfor rows.Next() {\n        p := post{}\n        rows.Scan(&amp;p.Id, &amp;p.Title, &amp;p.Body, &amp;p.Tags, &amp;p.Time)\n        p.BodyHtml = string(blackfriday.MarkdownCommon([]byte(p.Body))) \n        posts = append(posts, p)\n}\n</code></pre>\n\n<p>As <strong>elithrar</strong> noticed, to prevent escaping HTML-specific data, use <code>template.HTML</code> type instead of <code>string</code> on that data.</p>\n"}], "owner": {"reputation": 11, "user_id": 5170123, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d2f5e55fce224cf6f6a6ec7b00c28687?s=128&d=identicon&r=PG&f=1", "display_name": "Gopher", "link": "https://stackoverflow.com/users/5170123/gopher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 140, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1438604044, "creation_date": 1438591296, "last_edit_date": 1438592910, "question_id": 31782933, "link": "https://stackoverflow.com/questions/31782933/convert-to-markdown-in-mysql-foreach-and-add-to-array", "title": "Convert to Markdown in mysql foreach and add to array", "body": "<p>I have a question!</p>\n\n<p>How convert to markdown \"Body\" row in sql foreach and add to array?</p>\n\n<pre><code>type post struct {\n    Id          int\n    Title       string\n    Body        string\n    Tags        string\n    Time        string\n    BodyHtml    string\n}\n\nfunc indexHandler(w http.ResponseWriter, r *http.Request) {\n    // Query\n    rows, _ := db.Query(\"SELECT * FROM liamka_me_posts LIMIT 2\")\n    defer rows.Close()\n    posts := []post{}\n    for rows.Next() {\n        p := post{}\n        rows.Scan(&amp;p.Id, &amp;p.Title, &amp;p.Body, &amp;p.Tags, &amp;p.Time)\n        p.Body = html.UnescapeString(ConvertMarkdownToHtml(p.Body))\n        fmt.Println(p.Body)\n        posts = append(posts, p)\n    }\n    t.ExecuteTemplate(w, \"index\", posts)\n}\n</code></pre>\n\n<p>PS: Added UnescapeString in line. In console it shows like <code>&lt;p&gt;HELLO&lt;/p&gt;</code>, but when render page it show <code>&amp;lt;p&amp;gt;&amp;lt;strong&amp;gt;HELLO!&amp;lt;/strong&amp;gt;&amp;lt;/p&amp;gt;</code></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1438584794, "post_id": 31781001, "comment_id": 51491542, "body": "<i>aaaaaand</i> either provide a new type with a new <code>Find</code> that returns a new kind of collection, and <code>Each</code> on that new kind of collection to call its callback with a <code>customSelection</code>, or else just make a constructor to wrap a <code>Selection</code> in a <code>customSelection</code>, which is easier if you&#39;re not writing a whole framework."}, {"owner": {"reputation": 5895, "user_id": 1279005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c64c420648367c4731d652862fb53d0d?s=128&d=identicon&r=PG", "display_name": "Dmytro Sadovnychyi", "link": "https://stackoverflow.com/users/1279005/dmytro-sadovnychyi"}, "edited": false, "score": 0, "creation_date": 1438585033, "post_id": 31781001, "comment_id": 51491670, "body": "So basically I should modify each existing method that I want to return a new type?"}], "tags": [], "owner": {"reputation": 5639, "user_id": 1277048, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/tGJVH.jpg?s=128&g=1", "display_name": "FuzzyAmi", "link": "https://stackoverflow.com/users/1277048/fuzzyami"}, "is_accepted": true, "score": 3, "last_activity_date": 1438584510, "creation_date": 1438584510, "answer_id": 31781001, "question_id": 31780876, "link": "https://stackoverflow.com/questions/31780876/adding-a-method-for-existing-type-in-golang-how-to-rewrite-return-values-type/31781001#31781001", "title": "Adding a method for existing type in Golang: how to rewrite return value&#39;s type", "body": "<p>Since inheritance is not supported, the best practice is to embed the non-local type into your own local type, and extend it.</p>\n\n<p>In the Design Patterns lingo its better known as composition:\n<a href=\"https://en.wikipedia.org/wiki/Composition_over_inheritance\" rel=\"nofollow\">https://en.wikipedia.org/wiki/Composition_over_inheritance</a></p>\n"}, {"comments": [{"owner": {"reputation": 5895, "user_id": 1279005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c64c420648367c4731d652862fb53d0d?s=128&d=identicon&r=PG", "display_name": "Dmytro Sadovnychyi", "link": "https://stackoverflow.com/users/1279005/dmytro-sadovnychyi"}, "edited": false, "score": 0, "creation_date": 1438584943, "post_id": 31781111, "comment_id": 51491639, "body": "Yeah, I have mentioned in the question that I can easily use function, but I&#39;m looking for a way to make it more nice and use method."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 5895, "user_id": 1279005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c64c420648367c4731d652862fb53d0d?s=128&d=identicon&r=PG", "display_name": "Dmytro Sadovnychyi", "link": "https://stackoverflow.com/users/1279005/dmytro-sadovnychyi"}, "edited": false, "score": 1, "creation_date": 1438585043, "post_id": 31781111, "comment_id": 51491677, "body": "Why a method is nicer than a function?"}, {"owner": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "edited": false, "score": 0, "creation_date": 1448396763, "post_id": 31781111, "comment_id": 55568891, "body": "A method allows you to add interface conformance to a struct."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "edited": false, "score": 0, "creation_date": 1448417541, "post_id": 31781111, "comment_id": 55577364, "body": "@theory, however it doesn&#39;t make a method &quot;nicer&quot; and interface conformance was not part of the question. If methods are always &quot;nicer&quot; than functions then there is no reason to have functions ;)"}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 1, "last_activity_date": 1438584899, "creation_date": 1438584899, "answer_id": 31781111, "question_id": 31780876, "link": "https://stackoverflow.com/questions/31780876/adding-a-method-for-existing-type-in-golang-how-to-rewrite-return-values-type/31781111#31781111", "title": "Adding a method for existing type in Golang: how to rewrite return value&#39;s type", "body": "<p>You can use function instead of method:</p>\n\n<pre><code>func customFunc(s *goquery.Selection) int {\n    return 1\n}\n\n...\n\nfmt.Println(customFunc(s)) \n</code></pre>\n"}], "owner": {"reputation": 5895, "user_id": 1279005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c64c420648367c4731d652862fb53d0d?s=128&d=identicon&r=PG", "display_name": "Dmytro Sadovnychyi", "link": "https://stackoverflow.com/users/1279005/dmytro-sadovnychyi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 727, "favorite_count": 0, "accepted_answer_id": 31781001, "answer_count": 2, "score": 0, "last_activity_date": 1438586425, "creation_date": 1438584062, "question_id": 31780876, "link": "https://stackoverflow.com/questions/31780876/adding-a-method-for-existing-type-in-golang-how-to-rewrite-return-values-type", "title": "Adding a method for existing type in Golang: how to rewrite return value&#39;s type", "body": "<p>I want to extend existing <a href=\"http://godoc.org/github.com/PuerkitoBio/goquery#Selection\" rel=\"nofollow\">goquery.Selection</a> type with my own method and be able to use it from package's selectors. I know that I cannot \"patch\" existing method -- I need to create a new one. But how do I can force the existing package functions to use my new type? Something I'm missing in general or there's no \"nice\" way to do it and it's better to use a function?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/PuerkitoBio/goquery\"\n)\n\ntype customSelection goquery.Selection\n\nfunc (s *customSelection) CustomMethod() int {\n    return 1\n}\n\ndoc.Find(\"*\").Each(func(i int, s *goquery.Selection) {\n  fmt.Println(s.CustomMethod())  // does not works since its still \"goquery.Selection\"\n  // how do I can get a result with customSelection type here? \n})\n</code></pre>\n"}, {"tags": ["go", "rounding", "currency"], "comments": [{"owner": {"reputation": 2721, "user_id": 1710444, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/23fb7b17ea705c9454dfc41d75f578a4?s=128&d=identicon&r=PG", "display_name": "Catalyst", "link": "https://stackoverflow.com/users/1710444/catalyst"}, "reply_to_user": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 0, "creation_date": 1438564501, "post_id": 31778173, "comment_id": 51486536, "body": "@user2864740 I want to know what type to use, isn&#39;t that on-topic?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1440000780, "post_id": 31778173, "comment_id": 52095702, "body": "If you&#39;re splitting <code>X</code> amount of money (e.g. indivisible integer cents) between three places with <code>X&#47;3</code> then you&#39;re doing it wrong. With money you&#39;d need to do something like <code>a, b := X&#47;3, X&#47;3; c := X-a-b</code> instead."}], "answers": [{"comments": [{"owner": {"reputation": 2721, "user_id": 1710444, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/23fb7b17ea705c9454dfc41d75f578a4?s=128&d=identicon&r=PG", "display_name": "Catalyst", "link": "https://stackoverflow.com/users/1710444/catalyst"}, "edited": false, "score": 0, "creation_date": 1438565665, "post_id": 31778224, "comment_id": 51486697, "body": "I was reading about doing that, just found this google groups comment though <a href=\"https://groups.google.com/d/msg/golang-nuts/q-vQS9cb9uI/sojYMFeXoI0J\" rel=\"nofollow noreferrer\">groups.google.com/d/msg/golang-nuts/q-vQS9cb9uI/sojYMFeXoI0J</a>  Thoughts? I think I&#39;ll probably go with big.Rat for now. Optimize later :) The package mentioned there <a href=\"http://godoc.org/speter.net/go/exp/math/dec/inf\" rel=\"nofollow noreferrer\">godoc.org/speter.net/go/exp/math/dec/inf</a> is currently experimental"}, {"owner": {"reputation": 26843, "user_id": 208997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/250e219125d8bff1f03e6faea950f218?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/208997/simon"}, "reply_to_user": {"reputation": 2721, "user_id": 1710444, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/23fb7b17ea705c9454dfc41d75f578a4?s=128&d=identicon&r=PG", "display_name": "Catalyst", "link": "https://stackoverflow.com/users/1710444/catalyst"}, "edited": false, "score": 3, "creation_date": 1438566154, "post_id": 31778224, "comment_id": 51486779, "body": "True, but your are free to manually limit the precision, depending on your specific needs. To me the biggest drawback is that you have to use methods instead of operators which makes the code more verbose and thus a little bit harder to read."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1439056319, "post_id": 31778224, "comment_id": 51709072, "body": "User-defined arithmetic operators would be more than just nice in this situation."}], "tags": [], "owner": {"reputation": 26843, "user_id": 208997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/250e219125d8bff1f03e6faea950f218?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/208997/simon"}, "is_accepted": true, "score": 3, "last_activity_date": 1438564938, "creation_date": 1438564938, "answer_id": 31778224, "question_id": 31778173, "link": "https://stackoverflow.com/questions/31778173/what-type-to-use-to-correctly-handle-division-of-odd-numbers-of-cents-or-small/31778224#31778224", "title": "What type to use to correctly handle division of odd numbers of cents? (or smallest units of any currency)", "body": "<p>You can use <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow\"><code>big.Rat</code></a> for rational numbers of arbitrary size. Then you can split quantities to your heart's content without losing any precision.</p>\n"}, {"comments": [{"owner": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 1, "creation_date": 1438673657, "post_id": 31778370, "comment_id": 51532927, "body": "It looks as though <code>bigFloat</code> is <i>binary</i> floating-point arithmetic, though, so it wouldn&#39;t be as well-suited to monetary calculations as a decimal floating-point (or fixed-point) type."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 0, "creation_date": 1438674134, "post_id": 31778370, "comment_id": 51533201, "body": "@MarkDickinson, you are right. I will remove it from my answer."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1439056471, "post_id": 31778370, "comment_id": 51709114, "body": "Fixed point arithmetic via a user-defined type based on int64 and a quotient might be a good way to achieve clearly understandable code, with the necessary precision and good performance. It sounds too much like rolling your own BigDecimal, though."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 3, "last_activity_date": 1438674357, "last_edit_date": 1438674357, "creation_date": 1438566548, "answer_id": 31778370, "question_id": 31778173, "link": "https://stackoverflow.com/questions/31778173/what-type-to-use-to-correctly-handle-division-of-odd-numbers-of-cents-or-small/31778370#31778370", "title": "What type to use to correctly handle division of odd numbers of cents? (or smallest units of any currency)", "body": "<p><code>int64</code> (or <code>uint64</code>) still can be used to represent monetary amounts with cent fractions. E.g. if the minimum amount that you want to operate with is <code>0.01</code> cents then you can represent <code>1</code> cent as <code>100</code>, then half a cent will be <code>50</code> and <code>1/100</code> of a cent will be <code>1</code>. This representation is very efficient (from performance and memory usage point of view) but not very flexible. Things to be aware of are: </p>\n\n<ul>\n<li>there is maximum value (<code>~2^64/100</code> cents) that you can represent using this method</li>\n<li>changes will be required to the app and its stored data if the maximum precision changes</li>\n<li>all arithmetic operations needs to be carefully implemented taking rounding into account</li>\n</ul>\n"}], "owner": {"reputation": 2721, "user_id": 1710444, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/23fb7b17ea705c9454dfc41d75f578a4?s=128&d=identicon&r=PG", "display_name": "Catalyst", "link": "https://stackoverflow.com/users/1710444/catalyst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 31778224, "answer_count": 2, "score": 2, "last_activity_date": 1439975953, "creation_date": 1438564322, "last_edit_date": 1438564577, "question_id": 31778173, "link": "https://stackoverflow.com/questions/31778173/what-type-to-use-to-correctly-handle-division-of-odd-numbers-of-cents-or-small", "title": "What type to use to correctly handle division of odd numbers of cents? (or smallest units of any currency)", "body": "<p>Most of the time I see recommendations to represent money as its most fundamental unit; and to use 64 bit unsigned integer to provide maximal capacity.</p>\n\n<p>On the surface this seems fine, but what about the case where I want to split 1 cent?</p>\n\n<p>In Java/Scala the BigDecimal type, which I also see recommended for handling money, will track fractions of a cent, 0.01/2 = 0.005</p>\n\n<p>But dividing a 64 bit unsigned int, 1/2 = 0</p>\n\n<p>I'm trying to write some Go that handles money, and want to know which type to use (just use uint64 or find something else?).</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["ssl", "go", "imap"], "answers": [{"comments": [{"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1438595770, "post_id": 31779116, "comment_id": 51497720, "body": "Thanks you @AustinDizzy. I will change to Github version and try again. Now the server is serving a lot of clients and I&#39;m pretty sure the port 993 is working properly. My previous server had 143 open, so I used  <code>imap.Dial</code>, and it fetched mails correctly. Now the only change is replacing <code>imap.Dial</code> with <code>imap.DialTLS</code>. It compiles, and runtime has no error. But no mail is fetched. I always get an empty array of mails from the code. I will try more and come back here to update what I find."}], "tags": [], "owner": {"reputation": 115, "user_id": 1204580, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/04de35a6b83c8a570575aaf0764b8c00?s=128&d=identicon&r=PG", "display_name": "Austin Dizzy", "link": "https://stackoverflow.com/users/1204580/austin-dizzy"}, "is_accepted": false, "score": 5, "last_activity_date": 1438573422, "creation_date": 1438573422, "answer_id": 31779116, "question_id": 31777395, "link": "https://stackoverflow.com/questions/31777395/golang-imap-dialtls-config-example/31779116#31779116", "title": "Golang imap.DialTLS Config example", "body": "<p>First off, you should be using the <a href=\"https://github.com/mxk/go-imap\" rel=\"noreferrer\">project's GitHub repo</a> as the Google Code project stated development was moving to GitHub due to Google Code shutting down. It's a few commits ahead of the Google Code repo too, so you won't be getting any updates if you don't migrate to the GitHub repo.</p>\n\n<p>Secondly, looking at the <a href=\"https://github.com/mxk/go-imap/blob/master/imap-demo/demo1.go#L107\" rel=\"noreferrer\">package's demo</a>, passing <code>nil</code> to <code>DialTLS</code> as the TLS client seems to be the proper way to connect with a default TLS client.</p>\n\n<p>From the information you've given, it seems like it may be an issue with your server accepting connections over that port. I would look into if the port is open to the client you're trying to connect from or if your IMAP server is even accepting TLS connections.</p>\n\n<p>If you're absolutely sure it's not a server issue after further debugging, I would file an issue on the <a href=\"https://github.com/mxk/go-imap/issues\" rel=\"noreferrer\">project's GitHub issue tracker</a> to get help from people who are more familiar with the package, seeing that it's a third party package.</p>\n"}], "owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2348, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1438573422, "creation_date": 1438555785, "last_edit_date": 1438557873, "question_id": 31777395, "link": "https://stackoverflow.com/questions/31777395/golang-imap-dialtls-config-example", "title": "Golang imap.DialTLS Config example", "body": "<p>I used to be able to connect to port <code>143</code> of a mail server like this:</p>\n\n<pre><code>c, err := imap.Dial(mailServer)\n</code></pre>\n\n<p>The code above connects to port 143 of the <code>mailServer</code>. Now I have a new mail server only accepts port <code>993</code>. Looking at the Golang <code>imap</code> source code, the function <code>DialTLS</code> will connect to port <code>993</code>. The signature of <code>DialTLS</code> looks like this:</p>\n\n<pre><code>func DialTLS(addr string, config *tls.Config) (c *Client, err error)\n</code></pre>\n\n<p>Now I don't know how to construct the <code>*tls.Config</code>. I Googled around, but didn't not find anything really useful. Can someone show me some example how to construct the <code>*tls.Config</code>?</p>\n\n<p>I tried to pass in <code>nil</code> as the second parameter, it compiles, and I didn't get any runtime error. But it seems no new mails were fetched, even I believe there should be.</p>\n\n<p>My fetch mail code looks like this:</p>\n\n<pre><code>// testimap\npackage main\n\nimport (\n    \"bytes\"\n    \"code.google.com/p/go-imap/go1/imap\"\n    \"fmt\"\n    \"net/mail\"\n    \"time\"\n)\n\ntype Mail struct {\n    Subject string\n    Body    string\n    From    string\n    Uid     uint32\n}\n\nfunc FetchMail(lastUid uint32) []*Mail {\n    defer func() {\n        if err := recover(); err != nil {\n            fmt.Println(err)\n        }\n    }()\n    //\n    // Note: most of error handling code is omitted for brevity\n    //\n    var (\n        c   *imap.Client\n        cmd *imap.Command\n        rsp *imap.Response\n    )\n\n    // Connect to the server\n    c, err := imap.DialTLS(mailServer, nil)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    // Remember to log out and close the connection when finished\n    defer c.Logout(30 * time.Second)\n\n    // Print server greeting (first response in the unilateral server data queue)\n    //fmt.Println(\"Server says hello:\", c.Data[0].Info)\n    c.Data = nil\n\n    // Enable encryption, if supported by the server\n    if c.Caps[\"STARTTLS\"] {\n        c.StartTLS(nil)\n    }\n\n    // Authenticate\n    if c.State() == imap.Login {\n        c.Login(mailSupportUser, mailSupportPw)\n    }\n\n    //// List all top-level mailboxes, wait for the command to finish\n    cmd, err = imap.Wait(c.List(\"\", \"%\"))\n    if err != nil {\n        fmt.Println(err)\n    }\n    // Print mailbox information\n    //fmt.Println(\"\\nTop-level mailboxes:\")\n    //for _, rsp = range cmd.Data {\n    //  fmt.Println(\"|--\", rsp.MailboxInfo())\n    //}\n\n    // Check for new unilateral server data responses\n    //for _, rsp = range c.Data {\n    //  fmt.Println(\"Server data:\", rsp)\n    //}\n    c.Data = nil\n\n    // Open a mailbox (synchronous command - no need for imap.Wait)\n    c.Select(\"INBOX\", true)\n    //fmt.Print(\"\\nMailbox status:\\n\", c.Mailbox)\n\n    // Fetch the headers of the 10 most recent messages\n    set, err := imap.NewSeqSet(fmt.Sprint(lastUid, \":*\"))\n    if err != nil {\n        fmt.Println(err)\n    }\n    //if c.Mailbox.Messages &gt;= 10 {\n    //  set.AddRange(c.Mailbox.Messages-9, c.Mailbox.Messages)\n    //} else {\n    //  set.Add(\"1:*\")\n    //}\n    cmd, err = c.UIDFetch(set, \"RFC822.HEADER\", \"RFC822.TEXT\")\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    // Process responses while the command is running\n    //fmt.Println(\"\\nMost recent messages:\")\n    mails := make([]*Mail, 0, 10)\n    for cmd.InProgress() {\n        // Wait for the next response (no timeout)\n        c.Recv(-1)\n\n        // Process command data\n        for _, rsp = range cmd.Data {\n            if err != nil {\n                fmt.Println(err)\n            }\n            header := imap.AsBytes(rsp.MessageInfo().Attrs[\"RFC822.HEADER\"])\n            uid := imap.AsNumber((rsp.MessageInfo().Attrs[\"UID\"]))\n            body := imap.AsBytes(rsp.MessageInfo().Attrs[\"RFC822.TEXT\"])\n            if msg, err := mail.ReadMessage(bytes.NewReader(header)); msg != nil {\n                if err != nil {\n                    fmt.Println(err)\n                }\n                mail := &amp;Mail{\n                    Subject: msg.Header.Get(\"Subject\"),\n                    From:    msg.Header.Get(\"FROM\"),\n                    Body:    string(body),\n                    Uid:     uid,\n                }\n                if mail.Uid &lt; lastUid {\n                    continue\n                }\n                mails = append(mails, mail)\n            }\n        }\n        cmd.Data = nil\n        c.Data = nil\n    }\n\n    // Check command completion status\n    if rsp, err := cmd.Result(imap.OK); err != nil {\n        if err == imap.ErrAborted {\n            fmt.Println(\"Fetch command aborted\")\n        } else {\n            fmt.Println(\"Fetch error:\", rsp.Info)\n        }\n    }\n    fmt.Println(mails)\n    return mails\n}\n</code></pre>\n"}, {"tags": ["sorting", "go", "casting"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 4, "creation_date": 1438549797, "post_id": 31776584, "comment_id": 51483223, "body": "Nothing here is special to strings. (I think those parts of the spec are about conversions involving <code>[]rune</code> and <code>[]byte</code>.) It&#39;s pulling <code>len</code> each time <code>Less</code> is called. That&#39;s fast because <a href=\"http://research.swtch.com/godata\" rel=\"nofollow noreferrer\">strings are (pointer, length) pairs</a>--there would likely be no gain if you tried to cache the lengths separately."}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438549877, "post_id": 31776584, "comment_id": 51483245, "body": "So if I follow well, the casting from plain []string to a []string in disguise dressed up with a sort.Interface does not actually change anything about the memory representation, is that right ?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1438551089, "post_id": 31776584, "comment_id": 51483559, "body": "Exactly. If you&#39;re curious, the <a href=\"http://research.swtch.com/interfaces\" rel=\"nofollow noreferrer\">interface value</a> is generally a pointer to type information and a second pointer to the underlying object. Wouldn&#39;t sweat the speed of this too much--sorting several thousand strings by length is probably milliseconds of CPU time."}, {"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1438551260, "post_id": 31776584, "comment_id": 51483627, "body": "Indeed, no sweat on this one. But since I&#39;m just teaching my self, that was an occasion to raise the topic. Thanks a lot 222 !"}], "answers": [{"comments": [{"owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "edited": false, "score": 0, "creation_date": 1438583239, "post_id": 31778315, "comment_id": 51490844, "body": "That makes sense, and helps me build a model. Thanks !"}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": true, "score": 3, "last_activity_date": 1438565893, "creation_date": 1438565893, "answer_id": 31778315, "question_id": 31776584, "link": "https://stackoverflow.com/questions/31776584/converting-types-for-sorting-any-runtime-cost/31778315#31778315", "title": "Converting types for sorting : any runtime cost?", "body": "<p>The types you are converting is neither a numeric type or a string: <code>[]string</code> and <code>stringsLongestFirst</code> are slice types.</p>\n\n<p>So the conversion should incur no more overhead than copying the slice header (which is 12 or 24 bytes, depending on the word size), which would happen anyway when packing it as an <code>interface{}</code> variable in order to call <code>Sort</code>.  The backing array is not copied, which is why <code>severalThousandStrings</code> appears to be sorted after the call.</p>\n"}], "owner": {"reputation": 3006, "user_id": 920130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/eF81F.jpg?s=128&g=1", "display_name": "Mathias Dolidon", "link": "https://stackoverflow.com/users/920130/mathias-dolidon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 31778315, "answer_count": 1, "score": 2, "last_activity_date": 1438610417, "creation_date": 1438549547, "last_edit_date": 1438610417, "question_id": 31776584, "link": "https://stackoverflow.com/questions/31776584/converting-types-for-sorting-any-runtime-cost", "title": "Converting types for sorting : any runtime cost?", "body": "<p>I'm just getting to grips with Go (started two days ago and wrote less than 1000 lines), and I'm still wondering about some idioms.</p>\n\n<p>I needed to sort a slice of strings by descending length. I did like so :</p>\n\n<pre><code>func ... {\n    ... do business ...\n\n    sort.Sort(stringsLongestFirst(severalThousandStrings))\n\n    ... carry on and be happy, because it works ...\n}\n\ntype stringsLongestFirst []string\n\nfunc (b stringsLongestFirst) Len() int           { return len(b) }\nfunc (b stringsLongestFirst) Less(i, j int) bool { return len(b[i]) &gt; len(b[j]) }\nfunc (b stringsLongestFirst) Swap(i, j int)      { b[j], b[i] = b[i], b[j] }\n</code></pre>\n\n<p>First of all I wonder if this is the most idiomatic way to do it.</p>\n\n<p>And then, most of all, I wonder about what happens under the hood when I write <code>stringsLongestFirst(severalThousandStrings)</code>. Does the string slice somehow get smartly reinterpreted as a <code>stringsLongestFirst</code> type, or do I have to count with some copying overhead ? </p>\n\n<p><em>(edited : removed the excerpt from the specification, that was ill-suited to the case at hand)</em></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "edited": false, "score": 0, "creation_date": 1438540690, "post_id": 31775251, "comment_id": 51480732, "body": "Brilliant! That did it! Thank you so much!"}], "tags": [], "owner": {"reputation": 31570, "user_id": 56837, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/t20K1.jpg?s=128&g=1", "display_name": "Stefan Arentz", "link": "https://stackoverflow.com/users/56837/stefan-arentz"}, "is_accepted": true, "score": 1, "last_activity_date": 1438540414, "creation_date": 1438540414, "answer_id": 31775251, "question_id": 31775184, "link": "https://stackoverflow.com/questions/31775184/resetting-cursor-in-reader/31775251#31775251", "title": "Resetting cursor in Reader", "body": "<p>If the <code>io.Reader</code> you are passing to <code>csv.NewReader</code> is a <code>io.File</code> then you can call <code>Seek(0, 0)</code> on it to reset it back to the start.</p>\n\n<p>Not sure how this will work with CSV though since the parser may already know that it has read the first line. I guess you could skip over that by reading it.</p>\n"}], "owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 31775251, "answer_count": 1, "score": 0, "last_activity_date": 1438540414, "creation_date": 1438540045, "last_edit_date": 1438540090, "question_id": 31775184, "link": "https://stackoverflow.com/questions/31775184/resetting-cursor-in-reader", "title": "Resetting cursor in Reader", "body": "<p>I am working on a program to read from a csv file. I am encountering a strange EOF error and was wondering if there was a way to reset the line cursor of <code>*csv.Reader</code> to the beginning of the file without creating a new one?</p>\n"}, {"tags": ["go", "tiedot"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "edited": false, "score": 0, "creation_date": 1438582592, "post_id": 31775926, "comment_id": 51490556, "body": "Elegant :-). Luckily my code is structured to handle this change. I will implement it tonight! Thanks :)"}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 1, "last_activity_date": 1438544864, "creation_date": 1438544864, "answer_id": 31775926, "question_id": 31774131, "link": "https://stackoverflow.com/questions/31774131/add-method-to-struct-property-of-pointer-type/31775926#31775926", "title": "Add method to Struct Property of pointer type", "body": "<p>I do not think that such extension is possible in Go. However, I sure that the problem can be solved in some other way. For example, you can create structure that holds the collection and its name:</p>\n\n<pre><code>type Collection struct {\n  Col *tiedot.Col\n  Name string\n}\n</code></pre>\n\n<p>and initialise it</p>\n\n<pre><code>App.Properties = Collection{App.DB.Use(\"Properties\"), \"Properties\"}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 31775926, "answer_count": 1, "score": 2, "last_activity_date": 1438625275, "creation_date": 1438533728, "last_edit_date": 1438625275, "question_id": 31774131, "link": "https://stackoverflow.com/questions/31774131/add-method-to-struct-property-of-pointer-type", "title": "Add method to Struct Property of pointer type", "body": "<p>I have this struct:</p>\n\n<pre><code>type AppContext struct {\n    DB                *db.DB\n    Properties        *db.Col\n}\n</code></pre>\n\n<p><code>Properties</code> of the Type <code>*db.Col</code> is a <a href=\"https://github.com/HouzuoGuo/tiedot\" rel=\"nofollow\">Tiedot</a> Collection.</p>\n\n<p>The problem I have is that for my buffering system I want to be able to fetch name of the collection. Weirdly enough the default deployment of the library can't do it.</p>\n\n<p>When I instantiate the <code>AppContext</code> like so:</p>\n\n<pre><code>App = AppContext{}\n</code></pre>\n\n<p>..and then do:</p>\n\n<pre><code>App.DB.Create(\"Properties\")\nApp.Properties = App.DB.Use(\"Properties\")\n</code></pre>\n\n<p>I want to add an instance method, but it doesn't allow me to:</p>\n\n<pre><code>func (dbCol App.Properties) ColName() string {\n    return \"Properties\"\n}\n</code></pre>\n\n<p>Any idea how I could accomplish this or maybe extend Tiedot in a smarter way?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 3386, "user_id": 1668204, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0bc95f5cf4f7a5da0f8c3d9bd745ab45?s=128&d=identicon&r=PG", "display_name": "tx802", "link": "https://stackoverflow.com/users/1668204/tx802"}, "edited": false, "score": 0, "creation_date": 1438584282, "post_id": 31773874, "comment_id": 51491303, "body": "You&#39;ll need a custom index for that query - have you defined one?"}, {"owner": {"reputation": 85, "user_id": 1660498, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/66ecf0fbabf2df6ba85d68aa1246a867?s=128&d=identicon&r=PG", "display_name": "Tim Haggard", "link": "https://stackoverflow.com/users/1660498/tim-haggard"}, "reply_to_user": {"reputation": 3386, "user_id": 1668204, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0bc95f5cf4f7a5da0f8c3d9bd745ab45?s=128&d=identicon&r=PG", "display_name": "tx802", "link": "https://stackoverflow.com/users/1668204/tx802"}, "edited": false, "score": 0, "creation_date": 1438653299, "post_id": 31773874, "comment_id": 51526119, "body": "@tx802 Hmmm. Not explicitly. my index.yaml looks like this: <code>indexes:  # AUTOGENERATED  - kind: storeVal   properties:   - name: firstN   - name: lastN   - name: Date     direction: desc</code>"}], "owner": {"reputation": 85, "user_id": 1660498, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/66ecf0fbabf2df6ba85d68aa1246a867?s=128&d=identicon&r=PG", "display_name": "Tim Haggard", "link": "https://stackoverflow.com/users/1660498/tim-haggard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "closed_date": 1438535233, "answer_count": 0, "score": 0, "last_activity_date": 1471628251, "creation_date": 1438532174, "last_edit_date": 1495540846, "question_id": 31773874, "link": "https://stackoverflow.com/questions/31773874/google-appengine-datastore-read-write-golang", "closed_reason": "Duplicate", "title": "Google AppEngine DataStore Read &amp; Write (Golang)", "body": "<p>I'm using the http package to create a simple Golang server to pass in some query string parameters in the /add directory. The app would then \n1.) parse the query string parameters, \n2.) put them into a struct and \n3.) write them to the datastore. </p>\n\n<p>This appears to work fine...</p>\n\n<p>However, when I then try to make a query to search for \"Bob\" \"Smith\" when I enter that in the struct, it returns no members, as evidenced by running:\nlen(storeVals)\nand getting 0 as a result.</p>\n\n<p>I was hoping somebody would be familiar enough with Google's AppEngine DataStore to help me out.</p>\n\n<p>Many thanks!</p>\n\n<p>edit: I have looked at the similar question: <a href=\"https://stackoverflow.com/questions/28590519/google-app-engine-datastore-testing-queries-fails\">Google App Engine Datastore - Testing Queries fails</a> and have revised my code below. Even when first performing the write, and then later (10s) performing the read, I still get no returning members!</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n    \"net/url\"\n\n    \"appengine\"\n    \"appengine/datastore\"\n)\n\ntype storeVal struct {\n    firsN   string\n    lastN   string\n    Date    time.Time\n}\n\nfunc write(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    m, _ := url.ParseQuery(r.URL.RawQuery)\n\n    e1 := storeVal{\n        firstN:     m[\"firstN\"][0],\n        lastN:      m[\"lastN\"][0],\n        Date:       time.Now(),\n    }\n\n    key := datastore.NewIncompleteKey(c, \"storeVal\", nil)\n    _, err := datastore.Put(c, key, &amp;e1)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n}\n\nfunc read(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    m, _ := url.ParseQuery(r.URL.RawQuery)\n\n    q := datastore.NewQuery(\"storeVal\").\n        Filter(\"firstN =\", m[\"firstN\"][0]).\n        Filter(\"lastN =\", m[\"lastN\"][0]).\n        Order(\"-Date\")\n    var storeVals []storeVal\n    _, err := q.GetAll(c, &amp;storeVals)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    fmt.Fprintf(w, \"--%d--\", len(storeVals))  //Always returns --0--!!\n}\n\nfunc init() {\n    http.HandleFunc(\"/\", read)\n    http.HandleFunc(\"/add\", write)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n"}, {"tags": ["memory-management", "go"], "comments": [{"owner": {"reputation": 149903, "user_id": 14637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1904e7096278a10f1dfb3fdc0ceb53cc?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/14637/thomas"}, "edited": false, "score": 0, "creation_date": 1438514319, "post_id": 31771170, "comment_id": 51473416, "body": "Is there a maximum on the number of names? Could there be 50M names of 1 character each?"}, {"owner": {"reputation": 1718, "user_id": 102484, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4287b4d3f492373628c3972c6aec3180?s=128&d=identicon&r=PG", "display_name": "noonex", "link": "https://stackoverflow.com/users/102484/noonex"}, "reply_to_user": {"reputation": 149903, "user_id": 14637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1904e7096278a10f1dfb3fdc0ceb53cc?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/14637/thomas"}, "edited": false, "score": 0, "creation_date": 1438518590, "post_id": 31771170, "comment_id": 51474453, "body": "@Tomas, let&#39;s assume there is no limit - but I am more interested in general concepts - so any suggestions would help"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1438526421, "post_id": 31771170, "comment_id": 51476502, "body": "I strongly suggest attempting a naive implementation, profiling it, and then posting code/results if it doesn&#39;t have the performance you need."}, {"owner": {"reputation": 1718, "user_id": 102484, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4287b4d3f492373628c3972c6aec3180?s=128&d=identicon&r=PG", "display_name": "noonex", "link": "https://stackoverflow.com/users/102484/noonex"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1438528748, "post_id": 31771170, "comment_id": 51477154, "body": "@elithrar seem this is the way to go, I just wanted to ask if there is anything I should know before starting it."}], "answers": [{"comments": [{"owner": {"reputation": 1718, "user_id": 102484, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4287b4d3f492373628c3972c6aec3180?s=128&d=identicon&r=PG", "display_name": "noonex", "link": "https://stackoverflow.com/users/102484/noonex"}, "edited": false, "score": 0, "creation_date": 1438522111, "post_id": 31772093, "comment_id": 51475335, "body": "Do you think that indices will not take much memory, especially in Go? And regarding 2. so how exactly the code will look like? dest.PushBack(src.Remove(elem))  ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1718, "user_id": 102484, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4287b4d3f492373628c3972c6aec3180?s=128&d=identicon&r=PG", "display_name": "noonex", "link": "https://stackoverflow.com/users/102484/noonex"}, "edited": false, "score": 1, "creation_date": 1438523123, "post_id": 31772093, "comment_id": 51475604, "body": "@noonex, the go memory layout is very straightforward, you can see how everything is allocated. Otherwise the algorithms and data structures are the same as in any other language."}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 1, "last_activity_date": 1438520155, "creation_date": 1438520155, "answer_id": 31772093, "question_id": 31771170, "link": "https://stackoverflow.com/questions/31771170/dealing-with-big-memory-chunks-in-go/31772093#31772093", "title": "Dealing with big memory chunks in GO", "body": "<ol>\n<li>I assume that you cannot modify the string so the string and the string is immutable (not []byte), because removing any of such limitations makes the task trivial. If so, then you can create additional structure with string indices and sort in it (n*log(n)) time. Just implement <code>Less</code> in a way it compares the substrings in original string.</li>\n<li>The second one is trivial - just use linked list.</li>\n</ol>\n"}], "owner": {"reputation": 1718, "user_id": 102484, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4287b4d3f492373628c3972c6aec3180?s=128&d=identicon&r=PG", "display_name": "noonex", "link": "https://stackoverflow.com/users/102484/noonex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 31772093, "answer_count": 1, "score": -1, "last_activity_date": 1438520155, "creation_date": 1438513140, "question_id": 31771170, "link": "https://stackoverflow.com/questions/31771170/dealing-with-big-memory-chunks-in-go", "title": "Dealing with big memory chunks in GO", "body": "<p>Are there any guidelines which describe how Go may effectively address following use cases :</p>\n\n<ol>\n<li>Application receives 100M string consisting of delimited names, each name up to 1M long. E.g.: \"Ben;Aaron;Rich;Donna...\".  Need to print out the same names in alphabet order without significant memory usage increase (let's say up to 150M RAM used in total)</li>\n<li>Given two collections with huge memory chunks (let's say up to 1M each) and need to effectively move few chunks from one collection to the other (without significant additional memory allocation)</li>\n</ol>\n"}, {"tags": ["go", "routes"], "answers": [{"comments": [{"owner": {"reputation": 1542, "user_id": 3425760, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b9413dc067582def6579ec3e7bb2b1a3?s=128&d=identicon&r=PG&f=1", "display_name": "Mohsen Shakiba", "link": "https://stackoverflow.com/users/3425760/mohsen-shakiba"}, "edited": false, "score": 0, "creation_date": 1438513290, "post_id": 31771162, "comment_id": 51473179, "body": "thanks, but isn&#39;t there any other way? like a global function that would run on all the http handlers?"}, {"owner": {"reputation": 149903, "user_id": 14637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1904e7096278a10f1dfb3fdc0ceb53cc?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/14637/thomas"}, "reply_to_user": {"reputation": 1542, "user_id": 3425760, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b9413dc067582def6579ec3e7bb2b1a3?s=128&d=identicon&r=PG&f=1", "display_name": "Mohsen Shakiba", "link": "https://stackoverflow.com/users/3425760/mohsen-shakiba"}, "edited": false, "score": 0, "creation_date": 1438513309, "post_id": 31771162, "comment_id": 51473183, "body": "Not supported by <code>mux</code>, as far as I can see. Edit: also no trace of such functionality in the source code."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438513504, "post_id": 31771162, "comment_id": 51473220, "body": "Of course you can do it, just create your own mux that does whatever before passing the work to the real mux."}], "tags": [], "owner": {"reputation": 149903, "user_id": 14637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1904e7096278a10f1dfb3fdc0ceb53cc?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/14637/thomas"}, "is_accepted": false, "score": 2, "last_activity_date": 1438513106, "creation_date": 1438513106, "answer_id": 31771162, "question_id": 31770872, "link": "https://stackoverflow.com/questions/31770872/router-in-go-run-a-function-before-each-http-request/31771162#31771162", "title": "router in Go - run a function before each http request", "body": "<p>You could just write a wrapper function:</p>\n\n<pre><code>func wrapHandlerFunc(handler http.HandlerFunc) http.HandlerFunc {\n  return func(w http.ResponseWriter, req *http.Request) {\n    // ...\n    // do something\n    // ...\n    handler(w, req)\n  }\n}\n</code></pre>\n\n<p>And use it like this:</p>\n\n<pre><code>mux.HandleFunc(\"/authAPI/admin\", wrapHandlerFunc(auth))\n</code></pre>\n\n<p>Running it automatically for everything under a given URL tree (subrouter, in <code>mux</code> parlance) is, as far as I know, not supported.</p>\n"}, {"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 4, "last_activity_date": 1438513883, "creation_date": 1438513883, "answer_id": 31771278, "question_id": 31770872, "link": "https://stackoverflow.com/questions/31770872/router-in-go-run-a-function-before-each-http-request/31771278#31771278", "title": "router in Go - run a function before each http request", "body": "<p>On top of what @Thomas has proposed, you can wrap the whole mux in your own mux that is called before any handler is invoked, and can just invoke handlers of its own. That's how alternative http routers are implemented in go. Example:</p>\n\n<pre><code>func handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Handled %s\", r.RequestURI)\n}\n\n\nfunc main(){\n    // this will do the actual routing, but it's not mandatory, \n    // we can write a custom router if we want\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/foo\", handler)\n    mux.HandleFunc(\"/bar\", handler)\n\n    // we pass a custom http handler that does preprocessing and calls mux to call the actual handler\n    http.ListenAndServe(\":8081\", http.HandlerFunc(func (w http.ResponseWriter, r *http.Request){\n        fmt.Fprintln(w, \"Preprocessing yo\")\n        mux.ServeHTTP(w,r)\n    }))\n}\n</code></pre>\n"}], "owner": {"reputation": 1542, "user_id": 3425760, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b9413dc067582def6579ec3e7bb2b1a3?s=128&d=identicon&r=PG&f=1", "display_name": "Mohsen Shakiba", "link": "https://stackoverflow.com/users/3425760/mohsen-shakiba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1181, "favorite_count": 0, "accepted_answer_id": 31771278, "answer_count": 2, "score": 3, "last_activity_date": 1438513883, "creation_date": 1438510860, "last_edit_date": 1438512370, "question_id": 31770872, "link": "https://stackoverflow.com/questions/31770872/router-in-go-run-a-function-before-each-http-request", "title": "router in Go - run a function before each http request", "body": "<p>I'm using Go with http with Go like this:  </p>\n\n<pre><code>mux := http.NewServeMux()\nmux.HandleFunc(\"/API/user\", test)\nmux.HandleFunc(\"/authAPI/admin\", auth)\n</code></pre>\n\n<p>and I would like to run  a function before every http request\nand better yet, run a function on every request that has the /authAPI/ in them.<br>\nhow can I achieve this in Go?</p>\n"}, {"tags": ["multithreading", "go", "goroutine"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1438503435, "post_id": 31769860, "comment_id": 51470952, "body": "goroutines are cheap, aren&#39;t they?"}, {"owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1438503643, "post_id": 31769860, "comment_id": 51471018, "body": "Yes, the answer can be &quot;goroutines are good for this case&quot;. Well explained"}], "answers": [{"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "edited": false, "score": 0, "creation_date": 1438504140, "post_id": 31769938, "comment_id": 51471149, "body": "@plutov.by that would help indeed (<a href=\"http://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">blog.golang.org/profiling-go-programs</a>): if the memory remains stable, you don&#39;t need to limit the goroutines."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 4, "last_activity_date": 1438503771, "last_edit_date": 1592644375, "creation_date": 1438503771, "answer_id": 31769938, "question_id": 31769860, "link": "https://stackoverflow.com/questions/31769860/how-to-replace-goroutines-loop-by-channels-in-go/31769938#31769938", "title": "How to replace goroutines loop by channels in Go", "body": "<p>You will find a similar approach (one goroutine per file) in the blog post <a href=\"http://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">pipelines</a>.</p>\n<blockquote>\n<p>The MD5All implementation in <a href=\"http://blog.golang.org/pipelines/parallel.go\" rel=\"nofollow noreferrer\"><code>parallel.go</code></a> starts a new goroutine for each file. <strong>In a directory with many large files, this may allocate more memory than is available on the machine.</strong></p>\n<p>We can limit these allocations by bounding the number of files read in parallel. In <a href=\"http://blog.golang.org/pipelines/bounded.go\" rel=\"nofollow noreferrer\"><code>bounded.go</code></a>, we do this by creating a fixed number of goroutines for reading files.<br />\nOur pipeline now has three stages: walk the tree, read and digest the files, and collect the digests.</p>\n</blockquote>\n<p>You could organize your own code to use a limited number of goroutines, if you find yourself limited by memory allocated by a too large number of goroutines. (the goroutine itself is cheap, but the memory allocated for the &quot;magic&quot; part can be big)</p>\n"}], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 1, "accepted_answer_id": 31769938, "answer_count": 1, "score": 2, "last_activity_date": 1438503771, "creation_date": 1438503093, "question_id": 31769860, "link": "https://stackoverflow.com/questions/31769860/how-to-replace-goroutines-loop-by-channels-in-go", "title": "How to replace goroutines loop by channels in Go", "body": "<p>I have a loop, for each iteration I have a new channel source, that I should handle. Ok, it's better to show my code. I have list of files, each file I want to tail (like tail -f). I am using <code>github.com/ActiveState/tail</code> package.</p>\n\n<pre><code>for _, tailFile := range files {\n    t, _ := tail.TailFile(tailFile, c)\n\n    // Goroutine per tailing file\n    go func() {\n        for line := range t.Lines { // t.Lines is a channel\n            // Do some magic here\n        }\n    }()\n}\n</code></pre>\n\n<p>I can have thousands of files and I want to run my tail in parallel. As you see my program will have thousands of goroutines. Can this loop be changed to channels, with only 1 goroutine? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438499987, "post_id": 31769433, "comment_id": 51470270, "body": "Are you sure the response you&#39;re sending includes <code>\\r</code>?"}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438500021, "post_id": 31769433, "comment_id": 51470280, "body": "Hmm, I think it is, but that would be a real &quot;Doh!&quot; moment, wouldn&#39;t it? :-) Checking now..."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438500166, "post_id": 31769433, "comment_id": 51470313, "body": "Well, I wasn&#39;t... but it isn&#39;t making much of a difference. I tried CR, LF, CRLF, LFCR, no combination makes any difference. Either way, that would mess up the go client reader, but not the curl, which just shows data."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1438500352, "post_id": 31769433, "comment_id": 51470348, "body": "you&#39;re not showing how <code>sender</code> and <code>response</code> work, but one suspicious thing is that you&#39;re not writing to the channel and reading from it concurrently. can you try removing that whole part and just send some static lines to the writer and flush? it should work..."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438500411, "post_id": 31769433, "comment_id": 51470362, "body": "Yeah, I know it is weird. I am isolating the issue from a more complex app. Either way, it just didn&#39;t work. But I will retry now."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438500655, "post_id": 31769433, "comment_id": 51470416, "body": "Nah, same thing. Nothing being read on the client - whether go or curl - correct chunked headers, though. Tearing my hair out."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438500682, "post_id": 31769433, "comment_id": 51470420, "body": "Let me write an example that does work and you can compare"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438501045, "post_id": 31769433, "comment_id": 51470475, "body": "here&#39;s a server that works perfectly in curl. the actual writing code is yours, just the way we produce messages is different. <a href=\"http://play.golang.org/p/mRfU7tXPE6\" rel=\"nofollow noreferrer\">play.golang.org/p/mRfU7tXPE6</a>"}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438501364, "post_id": 31769433, "comment_id": 51470535, "body": "Thanks, trying that now. If it works on my laptop, then the problem is my code; else it is something on the laptop"}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438501832, "post_id": 31769433, "comment_id": 51470621, "body": "Yours works, mind doesn&#39;t, still trying to understand why, though"}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438508874, "post_id": 31769433, "comment_id": 51472232, "body": "It has to do with the <code>bufio.Scanner</code> combined with the \\r\\n. Still not sure what..."}], "owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1438597916, "creation_date": 1438499413, "last_edit_date": 1438597916, "question_id": 31769433, "link": "https://stackoverflow.com/questions/31769433/why-is-go-http-streaming-server-not-sending-lines-successfully", "title": "Why is go http streaming server not sending lines successfully?", "body": "<p>I have a very basic http server and http client. The server is not sending out the data when chunked despite flushing it. I have validated both with a go http client and curl.</p>\n\n<p>Here is the server:</p>\n\n<pre><code>func main() { \n    r := mux.NewRouter()\n    baseURL := \"\"\n    r.HandleFunc(baseURL+\"/\",handler).Methods(\"GET\")\n    listener, _ := net.Listen(\"tcp\", \"127.0.0.1:0\")\n    http.Handle(\"/\",r)\n    go http.Serve(listener,nil)\n    url = \"http://\" + listener.Addr().String() + \"/\"\n    fmt.Println(url)\n    TestSend()\n}\n\nfunc writeHeaders(w http.ResponseWriter, code int) {\n    w.Header().Set(\"Content-Type\", \"text/plain\")\n    w.WriteHeader(code)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"handler\")\n    writeHeaders(w, 200)\n    rsc := bufio.NewScanner(strings.NewReader(response))\n    for rsc.Scan() {\n        sender &lt;- rsc.Text()\n    }\n    for d := range sender {\n        w.Write([]byte(d))\n        w.(http.Flusher).Flush()\n        fmt.Println(\"wrote and flushed \"+d)\n    }\n}\n</code></pre>\n\n<p>And the client:</p>\n\n<pre><code>res, _ := http.Get(url)\nreader := bufio.NewReader(res.Body)\nfor {\n    fmt.Println(\"ReadBytes\")\n    data, err := reader.ReadBytes('\\r')\n    fmt.Println(\"read\")\n    if err != nil {\n        fmt.Println(\"error!\")\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(\"read line \"+string(data))\n}\n</code></pre>\n\n<p>I get the server saying it is sending and flushing, and I get the \"ReadBytes\" saying it is waiting to read, but it never reads any lines:</p>\n\n<pre><code>$ go run httptest.go\nhttp://127.0.0.1:55967/\nhandler\nwrote and flushed abc\nwrote and flushed def\nwrote and flushed ghi\nwrote and flushed jkl\nwrote and flushed mno\nReadBytes\n(here it just waits)\n</code></pre>\n\n<p>If, while it is running, I curl, I get the right headers, but no data:</p>\n\n<pre><code>$ curl -i http://127.0.0.1:55957/\nHTTP/1.1 200 OK\nContent-Type: text/plain\nDate: Sun, 02 Aug 2015 07:01:21 GMT\nTransfer-Encoding: chunked\n\n\n(no data here at all)\n</code></pre>\n\n<p>Clearly the data is not leaving the server, but why? I am <code>Flush</code>ing it.</p>\n"}, {"tags": ["go", "documentation", "godoc"], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1438498443, "post_id": 31769147, "comment_id": 51470013, "body": "In addition: you could convert godoc to static HTML and then re-write/remove any extraneous content at-will: <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/Wt-5hYOQFTw\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/Wt-5hYOQFTw</a>"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1438498734, "post_id": 31769147, "comment_id": 51470070, "body": "@elithrar yeah, but I think for the long run - patching godoc would be the way to go. It&#39;s an amazing tool, but like <code>go get</code>, once you use it and realize how awesome it is, you also realize how much it can be improved."}, {"owner": {"reputation": 2581, "user_id": 1682262, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0fe729661b718d6f6ba16ec8cf6b0e90?s=128&d=identicon&r=PG", "display_name": "Jason Xu", "link": "https://stackoverflow.com/users/1682262/jason-xu"}, "edited": false, "score": 0, "creation_date": 1438500364, "post_id": 31769147, "comment_id": 51470356, "body": "I was trying patching godoc, but can&#39;t get it done in half an hour. then using nginx now. this serves 2 benefits that share to internal and external with one godoc instance, and I still got auto update from godoc if code base on server change."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 2, "last_activity_date": 1438497605, "last_edit_date": 1438497605, "creation_date": 1438496479, "answer_id": 31769147, "question_id": 31768975, "link": "https://stackoverflow.com/questions/31768975/godoc-without-showing-source-code/31769147#31769147", "title": "godoc without showing source code", "body": "<p>The <code>src</code> file only refers to command line mode, not to server mode, so it won't help you. The way I see it there are a few options:</p>\n\n<ol>\n<li><p>Rewrite godoc for your needs and use your own fork. </p></li>\n<li><p>Don't use the server mode, render the docs in command line mode and just create a server out of that.</p></li>\n<li><p>Better yet (I'm not entirely sure 2 will work) - rewrite the templates a bit so the source code won't be linked. But you'll still need to make sure people who enter the path manually won't see the code so it will require fudging the source templates as well. or...</p></li>\n<li><p>Maybe the simplest thing - run it behind nginx or a similar reverse proxy, and make sure the <code>/src</code> path in the server is closed to outside visitors, or password protected or whatever. That way your internal team can still use it. </p></li>\n</ol>\n\n<p>Personally I'd go with 4, it's a couple minutes of work and will be the most robust and flexible solution.</p>\n"}], "owner": {"reputation": 2581, "user_id": 1682262, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0fe729661b718d6f6ba16ec8cf6b0e90?s=128&d=identicon&r=PG", "display_name": "Jason Xu", "link": "https://stackoverflow.com/users/1682262/jason-xu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 0, "accepted_answer_id": 31769147, "answer_count": 1, "score": 2, "last_activity_date": 1438497605, "creation_date": 1438494562, "last_edit_date": 1438495038, "question_id": 31768975, "link": "https://stackoverflow.com/questions/31768975/godoc-without-showing-source-code", "title": "godoc without showing source code", "body": "<p>I got several Go projects which is documented compatibly with godoc. We use godoc to share doc and code internally as a doc server without significant problem. However we need more control on opening code when we want to share doc with 3rd party. Is there a way to run godoc in a special mode that showing types and docs but never link to or showing source code? </p>\n\n<p>I've tried </p>\n\n<pre><code>godoc -http=0.0.0.0:8090 -links=false -src=false\n</code></pre>\n\n<p>but not working, still can link to type definition code. Just wondering if missed sth. Go version, 1.3.</p>\n"}, {"tags": ["go", "error-handling", "runtime-error"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438525584, "post_id": 31768689, "comment_id": 51476290, "body": "Poking around in the string representation of <code>error</code> is fragile at best and not a good idea. I wrote <a href=\"http://stackoverflow.com/a/30178766/55504\">an answer</a> to another question that goes over the ways a package author can make errors that are testable by consumers. If you need to test for or handle errors that don&#39;t use one of those easy methods then you&#39;ve found a flaw in that package and should report it as an issue. I&#39;d go so far as fixing it in a fork before I&#39;d muck around with the error string."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438629146, "post_id": 31768689, "comment_id": 51517790, "body": "Your new &quot;stringly-typed&quot; SO tag makes no sense to me; I&#39;d recommend removing it."}], "answers": [{"comments": [{"owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 1, "creation_date": 1438502982, "post_id": 31769289, "comment_id": 51470865, "body": "You&#39;ve summed up pretty much where I&#39;m currently at."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1438540434, "post_id": 31769289, "comment_id": 51480650, "body": "Your example is net errors; wonder if it&#39;s worth asking golang-nuts about adding a <code>(*net.OpError).Type()</code> where <code>Type</code> is one of a set of known error values (imagine,<code>net.ErrConnReset</code>, <code>net.ErrAddrInUse</code>, etc.)--or to standardize <code>opError.Error()</code>, or to document if some things are in fact reliable but not documented."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1438540471, "post_id": 31769289, "comment_id": 51480661, "body": "(If not <code>Type()</code>, maybe a <code>Code()</code> or <code>Errno()</code> using POSIX error codes.)"}], "tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": false, "score": 1, "last_activity_date": 1438498057, "creation_date": 1438498057, "answer_id": 31769289, "question_id": 31768689, "link": "https://stackoverflow.com/questions/31768689/idiomatically-filtering-errors-in-go/31769289#31769289", "title": "Idiomatically filtering errors in Go", "body": "<p>I'm not sure I'm saying anything you don't know, but I've seen a few ways to handle it: compare to known instances when they are exported and appear in the godoc, like <code>io.EOF</code> or <code>os.ErrNotExist</code>; using type assertions or switches when the docs promise an error of a certain type, like <code>*os.PathError</code> or <code>*os.LinkError</code>; or giving up and looking at messages. The first should be clear enough and you've done the third in your question; checking for type could look like:</p>\n\n<pre><code>if pathErr, ok := err.(*os.PathError); ok {\n    log.Fatal(\"Bad path \" + pathErr.Path + \", giving up\")\n} else if err != nil {\n    return err\n}\n</code></pre>\n\n<p>I think this would be rare, but if you had several potential types involved, you could conceivably use a <a href=\"http://golang.org/ref/spec#Type_switches\" rel=\"nofollow\">type switch</a>:</p>\n\n<pre><code>switch err.(type) {\ncase *os.PathError, *os.LinkError:\n    log.Fatal(\"oof\")\ncase nil:\n    // nothing; prevents default\ndefault:\n    log.Fatal(\"huh\")\n}\n</code></pre>\n\n<p>(The choice of error and behavior here is a bit silly--I'm just trying to put up a template with the syntax.)</p>\n\n<p>The hard part you allude to in your question: it may not be clear what guarantees you have about what errors will be returned. I know that, for example, the <a href=\"https://tip.golang.org/doc/go1.5\" rel=\"nofollow\">1.5 release notes</a> say that they're standardizing more on <a href=\"http://tip.golang.org/pkg/net/#OpError\" rel=\"nofollow\">net.OpError</a> for net errors than before, but that's all I know. Spelunking in the source of the package you're calling, or asking people questions, may be in order if there are important cases you think are unclear.</p>\n"}], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1438589156, "creation_date": 1438491254, "last_edit_date": 1438589156, "question_id": 31768689, "link": "https://stackoverflow.com/questions/31768689/idiomatically-filtering-errors-in-go", "title": "Idiomatically filtering errors in Go", "body": "<p>The <code>error</code> type in Go is quite broad, and the actual type contained can vary by platform as well as between versions. Is it idiomatic to filter errors that we expect by the error's string value, <code>error.Error()</code>?</p>\n\n<p>For example:</p>\n\n<pre><code>_, err := conn.Write(b)\nif err != nil {\n    if !strings.Contains(err.Error(), \"peer reset\") {\n        log.Print(err)\n    }\n    return\n}\n</code></pre>\n\n<p>Is there a better way to do this?</p>\n"}, {"tags": ["types", "go", "interface", "dynamically-generated", "receiver"], "answers": [{"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": false, "score": 0, "last_activity_date": 1438473053, "creation_date": 1438473053, "answer_id": 31767315, "question_id": 31766400, "link": "https://stackoverflow.com/questions/31766400/golang-create-dynamically-receiver-inside-switch/31767315#31767315", "title": "golang create dynamically receiver inside switch", "body": "<p>In the interface the method <code>write</code> is lowercase so it is private. And the structs Ctd and Btl do not implement this interface as they have <code>Write</code> method uppercased.</p>\n\n<p>So:</p>\n\n<pre><code>type Process interface {\n    Read()\n    Write() string\n}\n\n....\n\nfunc main() {\n  bitMask := 2\n  // or bitMask := 2\n  var nc Process\n  switch bitMask {\n  case 1:\n    nc = &amp;Ctd{}\n  case 2:\n    nc = &amp;Btl{}\n  }\n  nc.Read()\n  fmt.Println(nc.Write())\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/IORCIY4z6B\" rel=\"nofollow\">http://play.golang.org/p/IORCIY4z6B</a></p>\n"}], "owner": {"reputation": 9, "user_id": 5181506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tERfq.png?s=128&g=1", "display_name": "Jacques Grelet", "link": "https://stackoverflow.com/users/5181506/jacques-grelet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 521, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1438473053, "creation_date": 1438464528, "question_id": 31766400, "link": "https://stackoverflow.com/questions/31766400/golang-create-dynamically-receiver-inside-switch", "title": "golang create dynamically receiver inside switch", "body": "<p>I would like read, extract and save data from different sources with Read and Write methods implemented in Process interface\nThe code works rigth in the first <a href=\"http://play.golang.org/p/AVEub8Bxcb\" rel=\"nofollow\">example</a>:</p>\n\n<pre><code>type Process interface {\n    Read()\n    write() string\n}\n\ntype Nc struct {\n    data string\n}\n\ntype Ctd Nc\ntype Btl Nc\n\nfunc (nc *Ctd) Read() {\n    nc.data = \"CTD\"\n}\nfunc (nc *Ctd) Write() string {\n    return nc.data\n}\nfunc (nc *Btl) Read() {\n    nc.data = \"BTL\"\n}\nfunc (nc *Btl) Write() string {\n    return nc.data\n}\n\nfunc main() {\n    var ctd = new(Ctd)\n    var btl= new(Btl)\n    ctd.Read()\n    btl.Read()\n    fmt.Println(ctd.Write())\n    fmt.Println(btl.Write())\n}\n</code></pre>\n\n<p>Now, I would like dynamically read data from files, methods get_config should return a constant type that I would like process in <a href=\"http://play.golang.org/p/zKCQhCUC-N\" rel=\"nofollow\">switch</a> block as :</p>\n\n<pre><code>func main() {\n    // bitMask = get_config()\n    bitMask := 1\n    // or bitmask := 2\n    var nc = new(Nc)\n    switch bitMask {\n    case 1:\n        nc = Ctd(nc)\n    case 2:\n        nc = Btl(nc)\n    }\n    nc.Read()\n    fmt.Println(nc.Write())\n}\n</code></pre>\n\n<p>I don't know how to declare nc with rigth type outside switch block</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["logging", "go"], "comments": [{"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438474596, "post_id": 31766387, "comment_id": 51466633, "body": "Why not to have both? Where to add the log is very subjective and depends basically is to assure that the program is working and have hints on where to start debugging when it does not. So free to do what is the best in this particular case and then constantly improve it."}], "answers": [{"tags": [], "owner": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "is_accepted": false, "score": 1, "last_activity_date": 1438489658, "creation_date": 1438489658, "answer_id": 31768554, "question_id": 31766387, "link": "https://stackoverflow.com/questions/31766387/where-should-i-add-logging-in-my-go-web-scraper/31768554#31768554", "title": "Where should I add logging in my Go web scraper?", "body": "<p>You can use a named logger such as github.com/golang/glog to log both, but only output what you want when you need it.</p>\n"}], "owner": {"reputation": 14835, "user_id": 200619, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0e2ad527708210b67f14a4c64e022352?s=128&d=identicon&r=PG", "display_name": "Carson", "link": "https://stackoverflow.com/users/200619/carson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1438489658, "creation_date": 1438464440, "question_id": 31766387, "link": "https://stackoverflow.com/questions/31766387/where-should-i-add-logging-in-my-go-web-scraper", "title": "Where should I add logging in my Go web scraper?", "body": "<p>I'm writing a suite of website scraper functions. Each function reads an HTML document and returns a single value. To tie this all together, I've got a function - let's call it <code>ScrapeUrl</code> that accepts and reads a URL, then builds a struct instance out of the results from each of the scraper functions in the suite.</p>\n\n<p>I want to add logging to this so that I can see when non-critical values from the scraper functions are missing. But I don't know where the logger would slide in - should I log from:</p>\n\n<ol>\n<li>Inside each scraper function?</li>\n<li>Inside the <code>ScrapeUrl</code> function, based on the return value?</li>\n</ol>\n\n<p>I have a feeling it's #2 but I'm not familiar w/ global loggers like what Go offers. Instead, I'm used to named loggers.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 10170, "user_id": 1916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/487430ca3c1389e98a3c39c3910de8ef?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/1916/greg"}, "edited": false, "score": 2, "creation_date": 1438438963, "post_id": 31762567, "comment_id": 51458089, "body": "The path looks wrong - try remove the leading /."}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 2, "last_activity_date": 1438452339, "creation_date": 1438452339, "answer_id": 31764666, "question_id": 31762567, "link": "https://stackoverflow.com/questions/31762567/os-open-on-appengine-with-go/31764666#31764666", "title": "os.Open on AppEngine with Go", "body": "<p>It should work without the slash. File paths are relative to your project root (where your <code>app.yaml</code> is).</p>\n\n<p>I just tried this with 3 files:</p>\n\n<pre><code>main.go\napp.yaml\npizza.txt\n</code></pre>\n\n<p><code>main.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/pizza.txt\", func(res http.ResponseWriter, req *http.Request) {\n        f, err := os.Open(\"pizza.txt\")\n        if err != nil {\n            http.Error(res, err.Error(), 500)\n            return\n        }\n        defer f.Close()\n\n        io.Copy(res, f)\n    })\n}\n</code></pre>\n\n<p><code>pizza.txt</code>:</p>\n\n<pre><code>Totally Works!\n</code></pre>\n\n<p><code>app.yaml</code>:</p>\n\n<pre><code>application: astute-curve-100822\nversion: 1\nruntime: go\napi_version: go1\n\nhandlers:\n- url: /.*\n  script: _go_app\n</code></pre>\n\n<p>It ran locally and on app engine.</p>\n"}], "owner": {"reputation": 1206, "user_id": 5180802, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-C9Feof_ezik/AAAAAAAAAAI/AAAAAAAATQo/-PlxZxs79hY/photo.jpg?sz=128", "display_name": "redsalt", "link": "https://stackoverflow.com/users/5180802/redsalt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 31764666, "answer_count": 1, "score": 0, "last_activity_date": 1438452339, "creation_date": 1438436978, "question_id": 31762567, "link": "https://stackoverflow.com/questions/31762567/os-open-on-appengine-with-go", "title": "os.Open on AppEngine with Go", "body": "<p>I've recently started playing a bit with AppEngine but I'm having problems opening a file. Here's the code I'm using:</p>\n\n<pre><code>if _, err := os.Open(\"/pizza.webp\"); err != nil {\n    printError(err.Error())\n}\n</code></pre>\n\n<p>This gives me the error: <code>open /pizza.webp: operation not permitted</code></p>\n\n<p>I've tried using a .png instead and go the same result. I've also tried without the slash and with a dot before the slash, both resulted in the error <code>no such file or directory</code> so I'm guessing I have the path right but for some reason I don't have the permission to access it, maybe there's something I need to write in app.yaml? Right now app.yaml looks like this:</p>\n\n<pre><code>application: pizzarobot-telegram\nversion: 1\nruntime: go\napi_version: go1\n\nhandlers:\n- url: /.*\n  script: _go_app\n</code></pre>\n\n<p>Which is the default app.yaml with my application id. I've tried setting a static directory through app.yaml but that didn't work neither, I've read that AppEngine stores your static files apart from the code in that situation.</p>\n\n<p>I'm also very new to Go so I might be doing this wrong way and might not be an AppEngine problem but I've used os.Open in the past without AppEngine and that worked so I don't know what I'm missing here.</p>\n"}, {"tags": ["go", "arguments", "system-calls"], "answers": [{"comments": [{"owner": {"reputation": 47597, "user_id": 2753241, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/2on70.jpg?s=128&g=1", "display_name": "udondan", "link": "https://stackoverflow.com/users/2753241/udondan"}, "edited": false, "score": 0, "creation_date": 1438458890, "post_id": 31764328, "comment_id": 51463247, "body": "I see. It&#39;s a bit non-intuitive since the program name was already passed as first argument and this first argument was clearly used since the error message was from git. But looking at the <a href=\"https://gobyexample.com/execing-processes\" rel=\"nofollow noreferrer\">example</a> from where I was learning, I should have noticed that. I just would have never expected to pass the program name again as argument so I didn&#39;t pay attention to the values in the example. My bad. Thanks for clearing up."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 2, "last_activity_date": 1438450279, "creation_date": 1438450279, "answer_id": 31764328, "question_id": 31762246, "link": "https://stackoverflow.com/questions/31762246/how-to-pass-arguments-correctly-to-syscall-git/31764328#31764328", "title": "How to pass arguments correctly to syscall (git)?", "body": "<p>The first argument of <code>argv</code> is usually a program's name, so just add it there:</p>\n\n<pre><code>args := []string{git, \"clone\", \"http://github.com/some/repo.git\"}\nvar env = os.Environ()\nif err := syscall.Exec(git, args, env); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>See also: <a href=\"http://golang.org/pkg/os/#pkg-variables\" rel=\"nofollow\"><code>os.Args</code></a> variable.</p>\n"}], "owner": {"reputation": 47597, "user_id": 2753241, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/2on70.jpg?s=128&g=1", "display_name": "udondan", "link": "https://stackoverflow.com/users/2753241/udondan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 31764328, "answer_count": 1, "score": 2, "last_activity_date": 1438458532, "creation_date": 1438434872, "last_edit_date": 1438458532, "question_id": 31762246, "link": "https://stackoverflow.com/questions/31762246/how-to-pass-arguments-correctly-to-syscall-git", "title": "How to pass arguments correctly to syscall (git)?", "body": "<p>I am trying to clone a git repository by calling git via <code>syscall</code>. (I know there is <a href=\"https://github.com/libgit2/git2go\" rel=\"nofollow\">git2go</a> but that's not what I want. I definitely want to do a <code>syscall</code>)</p>\n\n<pre><code>git, lookErr := exec.LookPath(\"git\")\n\nif lookErr != nil {\n    fmt.Fprintf(os.Stderr, \"%s\\n\", lookErr)\n    os.Exit(126)\n}\n\nargs := []string{\"clone\", \"http://github.com/some/repo.git\"}\n\nvar env = os.Environ()\n\nexecErr := syscall.Exec(git, args, env)\n\nif execErr != nil {\n  panic(execErr)\n}\n</code></pre>\n\n<p>So what I want to execute is <code>git clone http://github.com/some/repo.git</code> and executing this manually works just fine. But when I run it in go like in the code snippet above, git fails with this:</p>\n\n<blockquote>\n  <p>git: '<a href=\"http://github.com/some/repo.git\" rel=\"nofollow\">http://github.com/some/repo.git</a>' is not a git command. See 'git --help'.</p>\n</blockquote>\n\n<p>Why would git interpret the 2nd argument as another command? It is supposed to be the remote <code>&lt;repo&gt;</code> URL, <code>git clone [options] [--] &lt;repo&gt; [&lt;dir&gt;]</code>.</p>\n\n<p>How do I pass the arguments correctly so git has the expected behavior?</p>\n"}, {"tags": ["go", "unmarshalling"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1438434637, "post_id": 31761539, "comment_id": 51456867, "body": "Related: <a href=\"http://stackoverflow.com/questions/31723274/how-to-unmarshel-two-json-with-same-internal-structure-into-one-single-golang-st\">How to unmarshel two json with same internal structure into one single golang struct?</a>"}, {"owner": {"reputation": 208, "user_id": 3056562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc137a5994f4c680470b62df6a4a4ed9?s=128&d=identicon&r=PG", "display_name": "mission.liao", "link": "https://stackoverflow.com/users/3056562/mission-liao"}, "edited": false, "score": 1, "creation_date": 1438448382, "post_id": 31761539, "comment_id": 51460188, "body": "just thinking, would it be better if golang can support &#39;or&#39; in field tags for json?"}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 1, "last_activity_date": 1438453131, "creation_date": 1438453131, "answer_id": 31764790, "question_id": 31761539, "link": "https://stackoverflow.com/questions/31761539/how-to-unmarshal-two-json-values-into-same-variable/31764790#31764790", "title": "How to unmarshal two json values into same variable?", "body": "<p>Using struct tags for decoding json is intended for the most common use cases. For custom behavior implement the <code>Unmarshaler</code> interface (<a href=\"https://play.golang.org/p/rCpCDvWXGP\" rel=\"nofollow\">https://play.golang.org/p/rCpCDvWXGP</a>):</p>\n\n<pre><code>type InnerStruct struct {\n    B, C string\n}\ntype OuterStruct struct {\n    E string\n    A []InnerStruct\n}\n\nfunc (o *OuterStruct) UnmarshalJSON(bs []byte) error {\n    var intermediate map[string]json.RawMessage\n    err := json.Unmarshal(bs, &amp;intermediate)\n    if err != nil {\n        return err\n    }\n    // e is just e\n    e, ok := intermediate[\"e\"]\n    if !ok {\n        return fmt.Errorf(\"invalid json, expected `e`\")\n    }\n    err = json.Unmarshal(e, &amp;o.E)\n    if err != nil {\n        return err\n    }\n    // a is a or d\n    a, ok := intermediate[\"a\"]\n    if !ok {\n        a, ok = intermediate[\"d\"]\n    }\n    if !ok {\n        return fmt.Errorf(\"invalid json, expected `a` or `d`\")\n    }\n    err = json.Unmarshal(a, &amp;o.A)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>In this case I used an intermediate map and delayed the processing of the inner values to match <code>a</code> or <code>d</code>. I'm sure this wasn't the actual data you had to work with, but hopefully it's enough to get you started.</p>\n"}], "owner": {"reputation": 107, "user_id": 5141019, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/fc929e8e8da518d6cf4ce1a946fdf043?s=128&d=identicon&r=PG&f=1", "display_name": "Priyaranjan", "link": "https://stackoverflow.com/users/5141019/priyaranjan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 504, "favorite_count": 0, "accepted_answer_id": 31764790, "answer_count": 1, "score": 1, "last_activity_date": 1438454398, "creation_date": 1438430057, "last_edit_date": 1438454398, "question_id": 31761539, "link": "https://stackoverflow.com/questions/31761539/how-to-unmarshal-two-json-values-into-same-variable", "title": "How to unmarshal two json values into same variable?", "body": "<p>I frequently come across json that have same structure but different name. How is it possible to assign all of them in same struct. for example</p>\n\n<pre><code>{\n    \"e\":\"g\"\n    \"a\":[\n        {\n            \"b\":\"b1\",\n            \"c\":\"c1\"\n        }\n        ]\n}\n</code></pre>\n\n<p>and </p>\n\n<pre><code>{\n    \"e\":\"f\"\n    \"d\":[\n        {\n            \"b\":\"b1\",\n            \"c\":\"c1\"\n        }\n        ]\n}\n</code></pre>\n\n<p>have same internal structure but could not be unmarsheled into same golang struct.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438452602, "post_id": 31761391, "comment_id": 51461448, "body": "Read up on <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">map composite literals</a>. E.g. <code>cc := dockerclient.ContainerConfig{Volumes: map[string]struct{}{ &quot;key1&quot;: struct{}{}, &quot;key2&quot;: struct{}{} } }</code>. E.g.: <a href=\"https://play.golang.org/p/-ldjIDxVzN\" rel=\"nofollow noreferrer\">play.golang.org/p/-ldjIDxVzN</a>. You could also use <code>empty := struct{}{}</code> to make it more readable."}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 12, "last_activity_date": 1438453383, "creation_date": 1438453383, "answer_id": 31764823, "question_id": 31761391, "link": "https://stackoverflow.com/questions/31761391/create-mapstringstruct-and-assign-a-value/31764823#31764823", "title": "create map[string]struct{} and assign a value", "body": "<pre><code>cc := &amp;dockerclient.ContainerConfig{\n    // ...\n    Volumes: map[string]struct{}{\n        \"foo\": struct{}{},\n        \"bar\": struct{}{},\n        // ...\n    },\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 191, "user_id": 2738974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de9f09d38dca2c47065d5276236aa2a7?s=128&d=identicon&r=PG&f=1", "display_name": "Tamil", "link": "https://stackoverflow.com/users/2738974/tamil"}, "is_accepted": false, "score": 2, "last_activity_date": 1500923720, "creation_date": 1500923720, "answer_id": 45288373, "question_id": 31761391, "link": "https://stackoverflow.com/questions/31761391/create-mapstringstruct-and-assign-a-value/45288373#45288373", "title": "create map[string]struct{} and assign a value", "body": "<p><code>Volumes: map[string]struct{}{\n\"dir1\": struct{}{},\n\"dir2\": struct{}{},\n},</code></p>\n\n<p>Maps only the folder from localhost to docker container. No contents will be mapped.</p>\n"}], "owner": {"reputation": 297, "user_id": 2715675, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/da04f9c72b6f534ef57cd086ca053760?s=128&d=identicon&r=PG&f=1", "display_name": "jonadev95", "link": "https://stackoverflow.com/users/2715675/jonadev95"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12564, "favorite_count": 0, "accepted_answer_id": 31764823, "answer_count": 2, "score": 7, "last_activity_date": 1619116379, "creation_date": 1438429091, "last_edit_date": 1619116379, "question_id": 31761391, "link": "https://stackoverflow.com/questions/31761391/create-mapstringstruct-and-assign-a-value", "title": "create map[string]struct{} and assign a value", "body": "<p>I'm using the github.com/samalba/dockerclient and want to create a Container.\nSo, the method is CreateContainer, which needs a ContainerConfig.</p>\n<p>The ContainerConfig is a struct. And there's a field Volumes, the type of which is type map[string] struct{}.</p>\n<p>I know that I could create such a map with <code>make(map[string]struct{})</code></p>\n<p>But how do I assign values to the map?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1438476790, "post_id": 31761219, "comment_id": 51466938, "body": "You can get the entire map via <code>r.Form</code>. I still recommend using gorilla/schema or goji/param to do the work though: they are well tested libraries."}], "answers": [{"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 3, "last_activity_date": 1438474340, "creation_date": 1438474340, "answer_id": 31767424, "question_id": 31761219, "link": "https://stackoverflow.com/questions/31761219/parsing-form-arrays-in-go/31767424#31767424", "title": "Parsing form arrays In Go", "body": "<p>This syntax is actually is not standard de jure. It is used sometimes when the site backend is powered by PHP, but not very frequently.</p>\n\n<p>I think that there is no reason for the standard Go library to support it.</p>\n\n<p>Native solution exists in a sense that you have all the tools to implement it: string manipulations, etc. However, nowadays there is no point to implement it as you always can send task-specific JSON.</p>\n\n<p>And even you insist on creating it, it will be not as simple as it is in PHP because Go is typed language and PHP is not. And accessing such structure will be not easy as you will have to implement it as <code>map[string]interface{}</code>, which is not the proper Go way (the Go way, BTW, is to typed data structures).</p>\n"}], "owner": {"reputation": 1751, "user_id": 3973406, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2d94768947ebd5fd0f38ee5b3f472c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dac0d3r", "link": "https://stackoverflow.com/users/3973406/dac0d3r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 31767424, "answer_count": 1, "score": 0, "last_activity_date": 1438474340, "creation_date": 1438427898, "question_id": 31761219, "link": "https://stackoverflow.com/questions/31761219/parsing-form-arrays-in-go", "title": "Parsing form arrays In Go", "body": "<p>I need to be able to to something like this in my HTML forms:</p>\n\n<pre><code>&lt;form method=\"POST\"&gt;\n    &lt;input type=\"text\" name=\"cart[items][1][qty]\" value=\"3\"/&gt;\n    &lt;input type=\"text\" name=\"cart[items][2][qty]\" value=\"7\"/&gt;\n    &lt;input type=\"submit\" value=\"Update cart\"/&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>Problem is, if I print out <code>r.Form</code> (after r.ParseForm() of course!), it is revealed that Go parses it as separate strings - not the nested hierarchy I'm after.</p>\n\n<p>I was able to find an alternative in <a href=\"http://www.gorillatoolkit.org/pkg/schema\" rel=\"nofollow\">http://www.gorillatoolkit.org/pkg/schema</a> , however I'd be very interested in finding out if there's a native/vanilla solution, since I usually tend to try an limit external packages, if I don't need them.</p>\n\n<p>To be more specific, in the above example I'd expect to get the entire nested slice/map, when I do <code>r.Form[\"cart\"]</code>, but that's obviously not how it works. The value I get is [].</p>\n\n<p>Is using schema the best solution for this, or is it possible to achieve exactly what I'm after? If then, how would you do it? :-)</p>\n"}, {"tags": ["php", "go", "gzip"], "answers": [{"comments": [{"owner": {"reputation": 86, "user_id": 2163393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Oefgh.jpg?s=128&g=1", "display_name": "ysqi", "link": "https://stackoverflow.com/users/2163393/ysqi"}, "edited": false, "score": 0, "creation_date": 1438423069, "post_id": 31759812, "comment_id": 51453779, "body": "thank you a lot !   First I don&#39;t study php ,the code is not nice. Now I know I can use <code>gzdecode( $data)</code> . Second I need close writer . last this code just for test ,I want clear code,so ignore all error"}], "tags": [], "owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "is_accepted": true, "score": 5, "last_activity_date": 1438449796, "last_edit_date": 1438449796, "creation_date": 1438417163, "answer_id": 31759812, "question_id": 31759354, "link": "https://stackoverflow.com/questions/31759354/php-cant-decompress-gzip-data-by-golang/31759812#31759812", "title": "PHP can&#39;t decompress gzip data by Golang", "body": "<p>It works with the following changes:</p>\n\n<ul>\n<li>In your PHP code you want to use <code>gzdecode</code> instead of <code>gzinflate</code>.  And you don't need this <code>substr($data, 10)</code> stuff if you use that.  I didn't read up on how deflate relates to gzip but the simplicity is that <code>gzencode</code>/<code>gzdecode</code> match what the golang <code>gzip</code> package does and what the <code>gz*</code> family of GNU command line tools do.</li>\n<li>In your Go code move your gzip.Writer.Close() call to be done before you read from <code>buffer</code>. As you can see here: <a href=\"http://golang.org/src/compress/gzip/gzip.go?s=6230:6260#L240\" rel=\"nofollow\">http://golang.org/src/compress/gzip/gzip.go?s=6230:6260#L240</a> there is some additional stuff that is written to the underlying stream upon close, so in your example above what you are writing is incomplete. (The <code>defer</code> statement causes <code>Close()</code> to be run after the containing function exits.)  Most likely the Go gzip decoding is managing to decode anyway whereas the PHP implementation is not - in any case you should properly close the stream to your in memory buffer to ensure it is complete before writing it out to a file.</li>\n</ul>\n\n<p>OBLIGATORY NOTE: You are ignoring all of your errors in your Go code.  This code looks like just a test so I won't belabor the point but you definitely want to be doing proper error handling (either reporting the problem to the user or to the caller of your function).</p>\n"}], "owner": {"reputation": 86, "user_id": 2163393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Oefgh.jpg?s=128&g=1", "display_name": "ysqi", "link": "https://stackoverflow.com/users/2163393/ysqi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 915, "favorite_count": 0, "accepted_answer_id": 31759812, "answer_count": 1, "score": 1, "last_activity_date": 1438450336, "creation_date": 1438413605, "last_edit_date": 1438450336, "question_id": 31759354, "link": "https://stackoverflow.com/questions/31759354/php-cant-decompress-gzip-data-by-golang", "title": "PHP can&#39;t decompress gzip data by Golang", "body": "<p>Why can't decompress gzip data by Go in my PHP demo, but PHP gzip data to Go is successful? I need post gzip JSON data from Go to PHP API service.</p>\n\n<p><strong>Test result</strong></p>\n\n<pre><code> -&gt; |  php   |  go \n---------------------\nphp |  ok    |  ok\ngo  |  fail  |  ok\n</code></pre>\n\n<p><strong>PHP code</strong></p>\n\n<pre><code>class GzipDemo\n{\n    public function gzen($data, $file){\n       $json_data = json_encode($data);\n       $gz_data = gzencode($json_data,9);\n       file_put_contents($file,$gz_data);\n    }\n\n    public function gzdn($file){\n       $data = file_get_contents($file);\n        $unpacked = gzdecode($data);\n        if ($unpacked === FALSE)\n        {\n            print(\"failed:\".$file.\"\\n\");\n        }else{\n             print($file. \" result Data :\".$unpacked .\"\\n\");\n        }\n    }\n}\n\n$demo = new GzipDemo();\n$file=\"phpgzip.txt\";\n$demo-&gt;gzen(\"data\",$file);\n$demo-&gt;gzdn($file);\n$demo-&gt;gzdn(\"gogzip.txt\");\n</code></pre>\n\n<p>This result:\nPHP to PHP okay.\nGo to PHP fail.</p>\n\n<p><strong>Go code</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"compress/gzip\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\nfunc main() {\n    gzen(\"data\", \"gogzip.txt\")\n    gden(\"gogzip.txt\")\n    gden(\"phpgzip.txt\")\n}\nfunc gzen(data string, file string) {\n    b, _ := json.Marshal(data)\n    buffer := new(bytes.Buffer)\n    w, _ := gzip.NewWriterLevel(buffer, gzip.BestCompression)\n    defer w.Close()\n    w.Write(b)\n    w.Flush()\n    ioutil.WriteFile(file, buffer.Bytes(), os.ModePerm)\n}\nfunc gden(file string) {\n    b, _ := ioutil.ReadFile(file)\n    buffer := new(bytes.Buffer)\n    buffer.Write(b)\n    r, _ := gzip.NewReader(buffer)\n    defer r.close()\n    data, _ := ioutil.ReadAll(r)\n    fmt.Println(file, \" result Data:\", string(data))\n}\n</code></pre>\n\n<p>This result: \nGo to Go okay.\nPHP to Go okay.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1438416688, "post_id": 31759184, "comment_id": 51452276, "body": "Related: <a href=\"http://stackoverflow.com/questions/29554369/finding-functions-that-return-a-specific-type\">Finding functions that return a specific type</a>."}], "answers": [{"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": false, "score": 4, "last_activity_date": 1438413238, "creation_date": 1438413238, "answer_id": 31759323, "question_id": 31759184, "link": "https://stackoverflow.com/questions/31759184/documentation-on-all-known-implementation-of-interfaces/31759323#31759323", "title": "Documentation On &quot;All Known Implementation&quot; of Interfaces", "body": "<p><a href=\"https://github.com/dominikh/implements\" rel=\"nofollow\">https://github.com/dominikh/implements</a> can do this:</p>\n\n<blockquote>\n  <p>implements is a command line tool that will tell you which types implement which interfaces, or which interfaces are implemented by which types.</p>\n</blockquote>\n\n<p>e.g.</p>\n\n<pre><code>~ implements -types=crypto/cipher\ncrypto/cipher.StreamReader implements...\n        io.Reader\n*crypto/cipher.StreamReader implements...\n        io.Reader\ncrypto/cipher.StreamWriter implements...\n        io.Closer\n        io.WriteCloser\n        io.Writer\n*crypto/cipher.StreamWriter implements...\n        io.Closer\n        io.WriteCloser\n        io.Writer\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 206, "user_id": 4824870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/713f8db8763a5352eca7d85e67859e6f?s=128&d=identicon&r=PG&f=1", "display_name": "alex mullins", "link": "https://stackoverflow.com/users/4824870/alex-mullins"}, "is_accepted": true, "score": 10, "last_activity_date": 1438413292, "creation_date": 1438413292, "answer_id": 31759333, "question_id": 31759184, "link": "https://stackoverflow.com/questions/31759184/documentation-on-all-known-implementation-of-interfaces/31759333#31759333", "title": "Documentation On &quot;All Known Implementation&quot; of Interfaces", "body": "<p>You can find the info you want and more using the godoc command's static analysis tools. Run the following at the command line: <code>godoc -http=\":8080\" -analysis=\"type\"</code>. Using the documentation you can find out what types implement an interface and the method set for a type. </p>\n\n<p>There is also a pointer analysis that allows you to find callers and callees of various types. The channel send&lt;--->receive analysis is pretty neat. </p>\n\n<p>You can also read more about the static analysis done by the godoc tool at <a href=\"http://golang.org/lib/godoc/analysis/help.html\">http://golang.org/lib/godoc/analysis/help.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "is_accepted": false, "score": 2, "last_activity_date": 1438835540, "creation_date": 1438835540, "answer_id": 31846895, "question_id": 31759184, "link": "https://stackoverflow.com/questions/31759184/documentation-on-all-known-implementation-of-interfaces/31846895#31846895", "title": "Documentation On &quot;All Known Implementation&quot; of Interfaces", "body": "<p>For all you vim junkies out there, <a href=\"https://github.com/fatih/vim-go\" rel=\"nofollow\">vim-go</a> supports advance code analysis using the <code>:GoImplements</code>, <code>:GoCallees</code>, <code>:GoChannelPeers</code>, <code>:GoReferrers</code> etc. oracle commands.</p>\n\n<p>For example, if I have a <code>Calculator</code> interface and implementation that looks like:</p>\n\n<pre><code>type Arithmetic interface{\n  add(float64, float64) float64 \n}\n\ntype Calculator struct{}\n\nfunc (c *calculator) add(o1, o2 float64) float64 {\n  // ... stuff\n}\n</code></pre>\n\n<p>Then running <code>:GoImplements</code> in vim with my cursor on the <code>type Arithmetic interface</code> will yield something like:</p>\n\n<pre><code>calculator.go|8 col 6| interface type Arithmetic\ncalculator.go|3 col 6| is implemented by pointer type *calculator\n</code></pre>\n\n<p>Now if I moved my cursor to the <code>type Calculator struct{}</code> line and run <code>:GoImplements</code>, I will get something like:</p>\n\n<pre><code>calculator.go|3 col 6| pointer type *calculator\ncalculator.go|8 col 6| implements Arithmetic\n</code></pre>\n\n<p>Note: If you got an \"unknown command\" error, try execute <code>:GoInstallBinaries</code> first before re-trying.</p>\n"}], "owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1174, "favorite_count": 5, "accepted_answer_id": 31759333, "answer_count": 3, "score": 12, "last_activity_date": 1547375550, "creation_date": 1438412012, "last_edit_date": 1547375550, "question_id": 31759184, "link": "https://stackoverflow.com/questions/31759184/documentation-on-all-known-implementation-of-interfaces", "title": "Documentation On &quot;All Known Implementation&quot; of Interfaces", "body": "<p>Few months into learning Go, I just discover that <a href=\"https://golang.org/pkg/os/#File\"><code>os.File</code></a> implements the <a href=\"http://golang.org/pkg/io/#Reader\"><code>io.Reader</code></a> interface by implementing the <a href=\"https://golang.org/pkg/os/#File.Read\"><code>Read(b []byte) (n int, err error)</code></a> function. This allows me to use a buffered reader to read a file by do something like:</p>\n\n<pre><code>f, err := os.Open(\"myfile.txt\")\nbufReader := bufio.NewReader(f)\n</code></pre>\n\n<p>Unless I miss it, it looks like there isn't an \"All Known Implementing Classes\" in Go documents on interfaces, like those found in Java interfaces documentation.</p>\n\n<p>Are there any ways to identify the types that implement an interface in Go?</p>\n"}, {"tags": ["go", "routing", "gorilla"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1438413325, "post_id": 31759073, "comment_id": 51451593, "body": "By &quot;it doesn&#39;t work&quot; - what happens? Does nothing get output to the browser? Do you get a HTTP status code? Is your Angular front end intercepting the request and not passing it to Go?"}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1438414251, "post_id": 31759073, "comment_id": 51451783, "body": "can you post your commonHandlers.ThenFunc(verifyUser)  method as well  the HTTP status"}, {"owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1438448525, "post_id": 31759073, "comment_id": 51460232, "body": "@elithrar I don&#39;t get a status code without the AngularJS code because for some reason /verify never gets handled in Go. I have tried it with and without AngularJS and nothing works. I&#39;m expecting an output of &quot;This works!&quot; on the console to show that the route matches, but that never happens."}, {"owner": {"reputation": 208, "user_id": 3056562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc137a5994f4c680470b62df6a4a4ed9?s=128&d=identicon&r=PG", "display_name": "mission.liao", "link": "https://stackoverflow.com/users/3056562/mission-liao"}, "edited": false, "score": 0, "creation_date": 1438448809, "post_id": 31759073, "comment_id": 51460330, "body": "my suggestion is try to debug your application with debugger, it would be easier to know what actually happened."}, {"owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "reply_to_user": {"reputation": 208, "user_id": 3056562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc137a5994f4c680470b62df6a4a4ed9?s=128&d=identicon&r=PG", "display_name": "mission.liao", "link": "https://stackoverflow.com/users/3056562/mission-liao"}, "edited": false, "score": 0, "creation_date": 1438451526, "post_id": 31759073, "comment_id": 51461135, "body": "@mission.liao What type of debugger should I use? I have been using Firebug to check my status code."}, {"owner": {"reputation": 208, "user_id": 3056562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc137a5994f4c680470b62df6a4a4ed9?s=128&d=identicon&r=PG", "display_name": "mission.liao", "link": "https://stackoverflow.com/users/3056562/mission-liao"}, "edited": false, "score": 0, "creation_date": 1438473767, "post_id": 31759073, "comment_id": 51466497, "body": "You could try <a href=\"https://github.com/mailgun/godebug\" rel=\"nofollow noreferrer\">github.com/mailgun/godebug</a> to debug your golang application."}, {"owner": {"reputation": 856, "user_id": 1127793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f511fb7651bd73b2d005443265bf151?s=128&d=identicon&r=PG", "display_name": "nkhumphreys", "link": "https://stackoverflow.com/users/1127793/nkhumphreys"}, "edited": false, "score": 0, "creation_date": 1438779113, "post_id": 31759073, "comment_id": 51588017, "body": "Could you post the rest of your nginx configuration (particularly the server block) and the code that is calling this.  I had a similar issue and it was because I was calling with a www subdomain and not re-writing non-www requests to www requests in nginx"}, {"owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "reply_to_user": {"reputation": 856, "user_id": 1127793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f511fb7651bd73b2d005443265bf151?s=128&d=identicon&r=PG", "display_name": "nkhumphreys", "link": "https://stackoverflow.com/users/1127793/nkhumphreys"}, "edited": false, "score": 0, "creation_date": 1438910809, "post_id": 31759073, "comment_id": 51655553, "body": "@nkhumphreys The rest of the configuration has been posted."}, {"owner": {"reputation": 856, "user_id": 1127793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f511fb7651bd73b2d005443265bf151?s=128&d=identicon&r=PG", "display_name": "nkhumphreys", "link": "https://stackoverflow.com/users/1127793/nkhumphreys"}, "edited": false, "score": 0, "creation_date": 1442506774, "post_id": 31759073, "comment_id": 53119156, "body": "@dtrinh100 do you have a file called verify.html at your root (/home/usr/go/src/project/dist/) or a verify/index.html in the same place?  Or, have your tried running this and calling localhost:9000/verify rather than going through nginx, this will show whether it is a problem in your Go code or a problem in your nginx config."}], "owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 259, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1438910775, "creation_date": 1438411084, "last_edit_date": 1438910775, "question_id": 31759073, "link": "https://stackoverflow.com/questions/31759073/gorilla-mux-router-not-working-for-particular-route", "title": "Gorilla mux router not working for particular route", "body": "<p>I'm having an issue using Gorilla for routing. For some routes it works fine, but for other it does not. </p>\n\n<p>I have the following code:</p>\n\n<pre><code>import (\n   \"github.com/gorilla/mux\"\n   \"github.com/justinas/alice\"\n)\n\n    mx.Handle(\"/register\", commonHandlers.ThenFunc(registerUser)).Methods(\"POST\").Name(\"register\") // This works\n    mx.Handle(\"/verify\", commonHandlers.ThenFunc(verifyUser)).Methods(\"GET\").Name(\"verify\") // Does not work \n</code></pre>\n\n<p>The verifyUser calls the Verify function handler is just suppose to output something to the console, for example:</p>\n\n<pre><code>log.Println(\"This works!\")\n</code></pre>\n\n<p>But for some reason, when I visit <a href=\"http://example.com/verify\" rel=\"nofollow\">example.com/verify</a>, the function Verify never actually gets called. Oddly enough, my AngularJS code actually outputs something when /verify is visited, but my Go code does not.</p>\n\n<p>I have the following configuration in my nginx file, not sure if it may conflict with Gorilla routing.</p>\n\n<pre><code>server {\n    listen   80; ## listen for ipv4; this line is default and implied\n\n   root /home/usr/go/src/project/dist/;\n\n\n\n\n    server_name localhost;\n    index index.html index.htm;\n\n\n    location @proxy {\n\n       proxy_set_header X-Real-IP $remote_addr;\n       proxy_set_header X-Forwarded-For $remote_addr;\n       proxy_set_header Host $host;\n       #proxy_pass http://127.0.0.1:3000;\n       proxy_pass http://127.0.0.1:9000;\n\n    }\n\n    location / {\n\n       try_files $uri.html $uri/ @proxy;\n       autoindex on;\n    }\n}\n</code></pre>\n\n<p>Is there something wrong with my routing? </p>\n"}, {"tags": ["dictionary", "go"], "answers": [{"comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 5, "creation_date": 1438406992, "post_id": 31758434, "comment_id": 51450285, "body": "I think this is the struct def. with count in tip: <a href=\"https://github.com/golang/go/blob/c5dff7282e27c640c192edb34b92c5c6459aa804/src/runtime/hashmap.go#L102\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/&hellip;</a>"}, {"owner": {"reputation": 2258, "user_id": 3352025, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/RpFHA.jpg?s=128&g=1", "display_name": "Lye Fish", "link": "https://stackoverflow.com/users/3352025/lye-fish"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438445311, "post_id": 31758434, "comment_id": 51459254, "body": "Thanks. I was a little suspicious that with the fixed numbers, a manual count may be optimized away (possible if not likely) but @twotwotwo&#39;s link helps confirm your result. Much appreciated."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 15, "last_activity_date": 1471848941, "last_edit_date": 1471848941, "creation_date": 1438405454, "answer_id": 31758434, "question_id": 31758325, "link": "https://stackoverflow.com/questions/31758325/do-go-implementations-store-the-length-of-a-map/31758434#31758434", "title": "Do Go implementations store the length of a map?", "body": "<p>I haven't checked the sources, but I wrote a quick benchmark.</p>\n\n<p>It tests 4 maps, 2 where keys are <code>int</code>, 2 where keys are <code>string</code>.</p>\n\n<pre><code>var m1 = make(map[int]int)    // key is of type int, len(m1) = 10\nvar m2 = make(map[int]int)    // key is of type int, len(m2) = 1000000\nvar s1 = make(map[string]int) // key is of type string, len(s1) = 10\nvar s2 = make(map[string]int) // key is of type string, len(s2) = 1000000\n</code></pre>\n\n<p>\"Small\" maps have 10 elements, \"large\" maps have a million elements. Maps are populated like this:</p>\n\n<pre><code>func init() {\n    for i := 0; i &lt; 10; i++ {\n        m1[i] = i\n        s1[strconv.Itoa(i)] = i\n    }\n    for i := 0; i &lt; 1000000; i++ {\n        m2[i] = i\n        s2[strconv.Itoa(i)] = i\n    }\n}\n</code></pre>\n\n<p>A benchmark function looks like this:</p>\n\n<pre><code>func BenchmarkSmallIntMap(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        for j := 0; j &lt; 1000; j++ {\n            _ = len(m1) + len(m1) + len(m1) + len(m1) + len(m1) + len(m1)\n        }\n    }\n}\n</code></pre>\n\n<p>All the others are similar, but using <code>m2</code>, <code>s1</code> and <code>s2</code> obviously. Here are the results:</p>\n\n<pre><code>BenchmarkSmallIntMap     1000000              2085 ns/op\nBenchmarkLargeIntMap     1000000              2087 ns/op\nBenchmarkSmallStringMap  1000000              2087 ns/op\nBenchmarkLargeStringMap  1000000              2086 ns/op\n</code></pre>\n\n<p>All are the same which pretty much tells that execution time of <code>len(m)</code> does not depend on the map size (number of key-value pairs), which suggests that <strong>map length is stored</strong> and not \"counted\" when called.</p>\n\n<p>If interested, here is the complete test source: <a href=\"http://play.golang.org/p/SBvcDeACxJ\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>And twotwotwo checked the <a href=\"https://github.com/golang/go/blob/c5dff7282e27c640c192edb34b92c5c6459aa804/src/runtime/hashmap.go#L102\" rel=\"noreferrer\">sources</a>, <strong>the length is stored</strong>.</p>\n"}], "owner": {"reputation": 2258, "user_id": 3352025, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/RpFHA.jpg?s=128&g=1", "display_name": "Lye Fish", "link": "https://stackoverflow.com/users/3352025/lye-fish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3138, "favorite_count": 2, "accepted_answer_id": 31758434, "answer_count": 1, "score": 8, "last_activity_date": 1471848941, "creation_date": 1438404235, "last_edit_date": 1438405651, "question_id": 31758325, "link": "https://stackoverflow.com/questions/31758325/do-go-implementations-store-the-length-of-a-map", "title": "Do Go implementations store the length of a map?", "body": "<p>Does a <code>map</code> have its length stored somewhere or is it calculated each time we call <code>len(my_map)</code>?</p>\n\n<p>The language spec shows this for maps, which doesn't really help:</p>\n\n<blockquote>\n  <p>The number of <code>map</code> elements is called its length. For a map <code>m</code>, it can be discovered using the built-in function <code>len</code> and may change during execution. Elements may be added during execution using assignments and retrieved with index expressions; they may be removed with the delete built-in function. </p>\n</blockquote>\n\n<p>Under the \"Length and capacity\" section we see this:</p>\n\n<blockquote>\n  <p>The expression <code>len(s)</code> is constant if <code>s</code> is a <code>string</code> constant. The expressions <code>len(s)</code> and <code>cap(s)</code> are constants if the type of <code>s</code> is an <code>array</code> or <code>pointer</code> to an <code>array</code> and the expression <code>s</code> does not contain channel receives or (non-constant) function calls; in this case <code>s</code> is not evaluated. Otherwise, invocations of <code>len</code> and <code>cap</code> are not constant and <code>s</code> is evaluated. </p>\n</blockquote>\n\n<p>So it tells us that <code>s</code> isn't constant and is evaluated but it doesn't state if it's looked up as a stored value like they do with the <code>slice</code> type.</p>\n"}, {"tags": ["go", "server"], "comments": [{"owner": {"reputation": 1014, "user_id": 1136384, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f2f8b975a1875cb11fc1b21f93554a24?s=128&d=identicon&r=PG", "display_name": "Qsiris", "link": "https://stackoverflow.com/users/1136384/qsiris"}, "edited": false, "score": 0, "creation_date": 1540562197, "post_id": 31756303, "comment_id": 92924086, "body": "<code>http.PostForm</code> does not give you a <code>http.Request</code> it gives you a <code>http.Response</code>"}], "answers": [{"comments": [{"owner": {"reputation": 735, "user_id": 2536700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/2ac04fd32567ed44ddeaca257bcd6806?s=128&d=identicon&r=PG", "display_name": "Chris W", "link": "https://stackoverflow.com/users/2536700/chris-w"}, "edited": false, "score": 0, "creation_date": 1438384531, "post_id": 31756407, "comment_id": 51446622, "body": "Thanks for the reply. server.ListenAndServe() is undefined though. <a href=\"http://golang.org/pkg/net/http/httptest/\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/httptest</a>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 735, "user_id": 2536700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/2ac04fd32567ed44ddeaca257bcd6806?s=128&d=identicon&r=PG", "display_name": "Chris W", "link": "https://stackoverflow.com/users/2536700/chris-w"}, "edited": false, "score": 1, "creation_date": 1438385652, "post_id": 31756407, "comment_id": 51446898, "body": "@ChrisW oh yeah I&#39;m a fool, was thinking you&#39;re using the http package. I&#39;ll edit with a sensible answer."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 735, "user_id": 2536700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/2ac04fd32567ed44ddeaca257bcd6806?s=128&d=identicon&r=PG", "display_name": "Chris W", "link": "https://stackoverflow.com/users/2536700/chris-w"}, "edited": false, "score": 1, "creation_date": 1438386138, "post_id": 31756407, "comment_id": 51447001, "body": "@ChrisW yeah that URL property isn&#39;t actually reflective of where your server is listening. Did a little testing, it just continues listening on localhost:2 no matter what. If you send somewhere else you&#39;ll get connection refused."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438449880, "post_id": 31756407, "comment_id": 51460624, "body": "Or more simply stated, <code>httptest.Server</code>&#39;s <code>URL</code> field is an output, not an input."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 4, "last_activity_date": 1438386544, "last_edit_date": 1438386544, "creation_date": 1438383609, "answer_id": 31756407, "question_id": 31756303, "link": "https://stackoverflow.com/questions/31756303/golang-how-to-simulate-a-post-with-a-form-request/31756407#31756407", "title": "Golang: How to simulate a POST with a form request?", "body": "<p>tl;dr the <code>Listener</code> in <code>httptest.Server</code> doesn't use the <code>httptest.Server.URL</code> as the url to listen on. It doesn't care what that value is. It listens on local hosts lowest open port number.</p>\n\n<p>The URL property on <code>httptest.Server</code> is not really doing anything. Change it all you want, just don't send your requests there. Check out this example program <a href=\"https://play.golang.org/p/BsH38WLkrJ\" rel=\"nofollow\">https://play.golang.org/p/BsH38WLkrJ</a></p>\n\n<p>Basically, if I change the servers URL then send the request to the value I set it to it doesn't work, but if I send it to the default value it does.</p>\n\n<p>Also check out the source <a href=\"http://golang.org/src/net/http/httptest/server.go?s=415:1018#L65\" rel=\"nofollow\">http://golang.org/src/net/http/httptest/server.go?s=415:1018#L65</a>, as well as the certs at the bottom of the file; clearly hard coded for the lowest open port on local host. If you want to make request to another URL the <code>Listener</code>.</p>\n"}], "owner": {"reputation": 735, "user_id": 2536700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/2ac04fd32567ed44ddeaca257bcd6806?s=128&d=identicon&r=PG", "display_name": "Chris W", "link": "https://stackoverflow.com/users/2536700/chris-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2340, "favorite_count": 0, "accepted_answer_id": 31756407, "answer_count": 1, "score": 0, "last_activity_date": 1438386544, "creation_date": 1438382887, "question_id": 31756303, "link": "https://stackoverflow.com/questions/31756303/golang-how-to-simulate-a-post-with-a-form-request", "title": "Golang: How to simulate a POST with a form request?", "body": "<p>I've been scouring the internet and can't find much at all about posting forms in golang tests. This is my attempt at it. I get the error \"dial tcp: too many colons in address ::1\" though. If I change the address to \"<a href=\"http://localhost:8080/\" rel=\"nofollow\">http://localhost:8080/</a>\" I get \"dial tcp 127.0.0.1:8080: connection refused\". </p>\n\n<p>I've read that if you put the (IPv6) address in brackets, the brackets will fix the problem, but then I get the error unrecognized protocol. </p>\n\n<pre><code>var addr = \"http://::1/\"\nh := handlers.GetHandler()\nserver := httptest.NewServer(h)\nserver.URL = addr\nreq, err := http.PostForm(addr+\"login\",\n        url.Values{\"username\": {\"lemonparty\"}, \"password\": {\"bluewaffle\"}})\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}, {"tags": ["csv", "go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438381318, "post_id": 31755926, "comment_id": 51445712, "body": "You&#39;re expected to hit EOF eventually. At least with plain byte reads you often get data in the same <code>Read</code> call as the EOF, too. Does behavior look any better if you process any data you receive with the EOF?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438381406, "post_id": 31755926, "comment_id": 51445730, "body": "(You can replace the <code>Concat</code> in <code>MoveFile</code> with regular string concats (<code>+</code>), right?)"}, {"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438381751, "post_id": 31755926, "comment_id": 51445837, "body": "@twotwotwo I actually do handle the EOF in the full version of the code. I exit on the EOF. What I am seeing is that it is exiting with an EOF on the very first reader.Read() where I get the headers. Oh, and yes I could use regular string concats. This function is actually just a helper I use in different places. Really didn&#39;t need it for this sample."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438388395, "post_id": 31755926, "comment_id": 51447458, "body": "What is the operating system? I&#39;ve tested it on mac os and it seems to work well with different CSV files, in parallel, etc. BTW, how does the EOF error look like in this case? On which line it happens and can you actually monitor the filesystem (like filemon on windows)?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438391299, "post_id": 31755926, "comment_id": 51447941, "body": "Super weird. Don&#39;t have much in the way of ideas. A line-ending issue (file has Mac <code>\\r</code> and Go wants <code>\\n</code>) could make a file appear to have one line, but not zero. If in the real code something else read <code>csvfile</code> before you read the headers that could mess things up, but these are shots in the dark. (Does it happen running only the sample code?)"}, {"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438394002, "post_id": 31755926, "comment_id": 51448301, "body": "@AlexAtNet Well, I may have found the issue. I am on a mac as well. For some reason as I went to save the file in sublime text it saved it with Mac OS 9 line endings. When I switched it to windows or unix line endings it works fine. Need to do a bit more testing but, that seems like, at least a strong correlation."}, {"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438397049, "post_id": 31755926, "comment_id": 51448689, "body": "@twotwotwo You are correct. I just got the error again even with the unix line endings. I did think about something else reading the file and ruled that out. Plus, it doesn&#39;t heppen every time. I would think it would in that case. I find it strange that re-saving the file caused it to start working pretty consistently. (I ran it in a loop 100 times and it didn&#39;t give me the EOF again until the 93 try.)"}, {"owner": {"reputation": 606, "user_id": 4257143, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q195EKev0qQ/AAAAAAAAAAI/AAAAAAAAAxM/R2bEEt98Yrc/photo.jpg?sz=128", "display_name": "Doug Henderson", "link": "https://stackoverflow.com/users/4257143/doug-henderson"}, "edited": false, "score": 0, "creation_date": 1438477997, "post_id": 31755926, "comment_id": 51467116, "body": "First, where are you encountering the EOF errors. Your error messages and exit codes do not distinguish the several places where you exit on error.  Second, I am suspicious of the defer&#39;d function. You are using the Name() method after calling the Close() method. Even knowing what the code in the csv package did, I would hesitate to call any function on a file after closing it."}, {"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "reply_to_user": {"reputation": 606, "user_id": 4257143, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q195EKev0qQ/AAAAAAAAAAI/AAAAAAAAAxM/R2bEEt98Yrc/photo.jpg?sz=128", "display_name": "Doug Henderson", "link": "https://stackoverflow.com/users/4257143/doug-henderson"}, "edited": false, "score": 0, "creation_date": 1438536947, "post_id": 31755926, "comment_id": 51479559, "body": "Thanks @DougHenderson I had actually thought of that as well and removed the MoveFile call from the defer. However, that did not change the result. I too was/am suspicious if the defer function. So, I added a log statement inside the defer function (just fmt.PrintLn(&quot;In defer...&quot;)) and it doesn&#39;t trigger. I will edit the post to better indicate where the EOF is thrown."}, {"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "reply_to_user": {"reputation": 606, "user_id": 4257143, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q195EKev0qQ/AAAAAAAAAAI/AAAAAAAAAxM/R2bEEt98Yrc/photo.jpg?sz=128", "display_name": "Doug Henderson", "link": "https://stackoverflow.com/users/4257143/doug-henderson"}, "edited": false, "score": 0, "creation_date": 1438537463, "post_id": 31755926, "comment_id": 51479723, "body": "@DougHenderson I modified the sample code to better reflect the source code and added an inline comment where the actual EOF is encountered."}, {"owner": {"reputation": 606, "user_id": 4257143, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q195EKev0qQ/AAAAAAAAAAI/AAAAAAAAAxM/R2bEEt98Yrc/photo.jpg?sz=128", "display_name": "Doug Henderson", "link": "https://stackoverflow.com/users/4257143/doug-henderson"}, "edited": false, "score": 0, "creation_date": 1438690514, "post_id": 31755926, "comment_id": 51543529, "body": "I created a test using the files you show above, with a hand crafted <code>conf.json</code> using the current directory (.) for the MonitorDir. I modified the error messages to be unique, and added error messages when os.MakeAll or os.Rename failed. I could not reproduce your problem.  I am using <code>go version go1.4.2 windows&#47;amd64</code>."}, {"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "reply_to_user": {"reputation": 606, "user_id": 4257143, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q195EKev0qQ/AAAAAAAAAAI/AAAAAAAAAxM/R2bEEt98Yrc/photo.jpg?sz=128", "display_name": "Doug Henderson", "link": "https://stackoverflow.com/users/4257143/doug-henderson"}, "edited": false, "score": 0, "creation_date": 1438825753, "post_id": 31755926, "comment_id": 51612329, "body": "@DougHenderson I think I found the issue. That MonitorDir in the conf.json is truly a directory that is monitored. I am using fsnotify to watch the folder for new files then pass the new file onto this functionality. What appears to be happening is that the file occasionally gets to the read before the file in finished copying. I know, sounds unlikely. However, by adding a 1 second delay between receiving the event and passing it on, I have yet to see the EOF error again."}], "owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 158, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1438537391, "creation_date": 1438380572, "last_edit_date": 1438537391, "question_id": 31755926, "link": "https://stackoverflow.com/questions/31755926/getting-eof-from-known-good-csv-file", "title": "Getting EOF from known good csv file", "body": "<p>I have been writing a program to parse a csv file using the encoding/csv package. For some reason I have begul getting sporadic EOF errors. It is very strange since I am using the same file to test with over and over. Sometimes it parses fine. Other times it exits with an EOF.</p>\n\n<p>This is a simplified version of the code:</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/csv\"\n    \"fmt\"\n    \"os\"\n    \"path/filepath\"\n    \"unicode/utf8\"\n)\n\nfunc main() {\n    LoadConfig()\n    csvfile, err := os.Open(config.MonitorDir + \"/test.csv\")\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(2)\n    }\n\n    reader := csv.NewReader(csvfile)\n    defer func() {\n        csvfile.Close()\n        MoveFile(csvfile)\n    }()\n    reader.Comma, _ = utf8.DecodeRuneInString(config.Delimiter)\n    reader.LazyQuotes = true\n    writeHeaders(reader)\n}\n\nfunc writeHeaders(reader *csv.Reader) {\n  Headers, err := reader.Read() // This is where I see the EOF \n                                // (Headers = [] err = EOF)\n  if err != nil {\n      fmt.Printf(\"Error is: %s\\n\", err.Error())\n      os.Exit(2)\n  }\n  fmt.Println(Headers)\n}\n\nfunc MoveFile(file *os.File) {\n    err := os.MkdirAll(Concat(config.MonitorDir, \"/completed/\"), os.ModeDir)\n    if err != nil {\n        fmt.Printf(\"Error is: %s\\n\", err.Error())\n        os.Exit(2)\n    }\n    err = os.Rename(file.Name(), Concat(config.MonitorDir, \"/completed/\", filepath.Base(file.Name())))\n\n    if err != nil {\n        return\n    }\n}\n\nfunc Concat(str ...string) string {\n    var buffer bytes.Buffer\n\n    for i := 0; i &lt; len(str); i++ {\n        buffer.WriteString(str[i])\n    }\n    return buffer.String()\n}\n</code></pre>\n\n<p><strong>conf.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\ntype Configuration struct {\n    MonitorDir string\n    LogPath    string\n    Delimiter  string\n}\n\nvar config Configuration\n\nfunc LoadConfig() {\n    file, _ := os.Open(\"conf.json\")\n    decoder := json.NewDecoder(file)\n    config = Configuration{}\n    err := decoder.Decode(&amp;config)\n    if err != nil {\n        fmt.Printf(\"Error is: %s\\n\", err.Error())\n        os.Exit(2)\n    }\n}\n</code></pre>\n\n<p><strong>test.csv</strong></p>\n\n<pre><code>Id,LastModified\n\"108420\",\"2015-04-25T11:34:35.437332096-06:00\"\n\"132774\",\"2015-04-25T11:34:35.437332096-06:00\"\n\"254790\",\"2015-04-25T11:34:35.437332096-06:00\"\n\"359972\",\"2015-04-25T11:34:35.437332096-06:00\"\n\"363060\",\"2015-04-25T11:34:35.437332096-06:00\"\n</code></pre>\n\n<p>This has become a blocking issue as it might throw 8, 10 or even more EOF before finally processing the file. I presume I am doing something strange to cause it. But, I cannot for the life of me see it.</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 14145, "user_id": 1255956, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a6a3498ebb173fb2373fded6f46d65fd?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1255956/chris"}, "edited": false, "score": 0, "creation_date": 1438384450, "post_id": 31756159, "comment_id": 51446602, "body": "Thank you for the explanation and correction on context, I should have written upload and image!"}], "tags": [], "owner": {"reputation": 757655, "user_id": 95810, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e8d5fe90f1fe2148bf130cccd4dc311c?s=128&d=identicon&r=PG", "display_name": "Alex Martelli", "link": "https://stackoverflow.com/users/95810/alex-martelli"}, "is_accepted": true, "score": 2, "last_activity_date": 1438381982, "creation_date": 1438381982, "answer_id": 31756159, "question_id": 31754622, "link": "https://stackoverflow.com/questions/31754622/golang-gae-save-image-url-to-blobstore/31756159#31756159", "title": "Golang GAE Save Image Url to Blobstore", "body": "<p>I think, from context, that you mean \"upload an image to blobstore\" where you say \"download an image on blobstore\".</p>\n\n<p>Once upon a time you would have created a <code>blobstore</code> <code>Writer</code> with <a href=\"https://cloud.google.com/appengine/docs/go/blobstore/reference#Create\" rel=\"nofollow\">https://cloud.google.com/appengine/docs/go/blobstore/reference#Create</a> , then written on it, and closed it. But as the docs mention this is now deprecated; nowadays, you use instead the package <code>cloud/storage</code> as in the example at <code>https://godoc.org/google.golang.org/cloud/storage#example-NewWriter</code>:</p>\n\n<pre><code>wc := storage.NewWriter(ctx, \"bucketname\", \"filename1\")\nwc.ContentType = \"image/jpg\"\nwc.ACL = []storage.ACLRule{{storage.AllUsers, storage.RoleReader}}\nif _, err := wc.Write(response.Body); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>etc, etc -- compared to the example, I've only changed the content type and exactly what bytes you write.</p>\n\n<p>Essentially, blobstore has been replaced by cloud storage, and you should use the latter.</p>\n"}], "owner": {"reputation": 14145, "user_id": 1255956, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a6a3498ebb173fb2373fded6f46d65fd?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1255956/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 432, "favorite_count": 0, "accepted_answer_id": 31756159, "answer_count": 1, "score": 1, "last_activity_date": 1438381982, "creation_date": 1438374316, "last_edit_date": 1495541769, "question_id": 31754622, "link": "https://stackoverflow.com/questions/31754622/golang-gae-save-image-url-to-blobstore", "title": "Golang GAE Save Image Url to Blobstore", "body": "<p>I am looking to save an image in Go, something like <a href=\"https://stackoverflow.com/questions/22417283/save-an-image-from-url-to-file-go\">this</a>:</p>\n\n<pre><code>url := \"http://i.imgur.com/m1UIjW1.jpg\"\n\nresponse, e := http.Get(url)\nif e != nil {\n    log.Fatal(e)\n}\n\ndefer response.Body.Close()\n\nfile, err := os.Create(\"/tmp/asdf.jpg\")\nif err != nil {\n    log.Fatal(err)\n}\n\n_, err = io.Copy(file, response.Body)\nif err != nil {\n    log.Fatal(err)\n}\n\nfile.Close()\n</code></pre>\n\n<p>However - I am using <a href=\"https://cloud.google.com/appengine/docs/go/blobstore/reference\" rel=\"nofollow noreferrer\">Blobstore</a> on GAE and all of the examples I find seem to be based on some multi-part form upload based on a <a href=\"https://cloud.google.com/appengine/docs/go/blobstore/\" rel=\"nofollow noreferrer\">users browser</a>...</p>\n\n<p>How do I download an image on GAE/Blobstore with a simple GET request:</p>\n\n<pre><code>func handler(w http.ResponseWriter, r *http.Request) {\n    urlImage := \"http://i.imgur.com/m1UIjW1.jpg\"\n    //when a user calls this root handle, download urlImage to Blobstore\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1438370017, "post_id": 31753467, "comment_id": 51440719, "body": "If you haven&#39;t logged/printed the value of <code>Query</code> I recommend doing it. Get is pretty straightforwad and your use of it is correct. <a href=\"https://play.golang.org/p/i4kKCUFoiq\" rel=\"nofollow noreferrer\">play.golang.org/p/i4kKCUFoiq</a>"}, {"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1438370826, "post_id": 31753467, "comment_id": 51441122, "body": "Is r by any chance an http.Request? If so you should probably be calling r.ParseForm() and then using r.Form.Get(&quot;key&quot;)."}, {"owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "reply_to_user": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1438371183, "post_id": 31753467, "comment_id": 51441309, "body": "@DmitriGoldring  Yes, r is a request and I tried ParseForm() and it still didn&#39;t work."}, {"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1438371304, "post_id": 31753467, "comment_id": 51441367, "body": "Did you check the error returned by ParseForm? Also if this is a POST/PUT/PATCH that contains &#39;key&#39; as a body parameter you could be overriding your query parameter."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438372106, "post_id": 31753467, "comment_id": 51441746, "body": "Please post the code that is necessary to reproduce the issue. Without it it is very hard to say what works incorrectly."}, {"owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "reply_to_user": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1438372888, "post_id": 31753467, "comment_id": 51442122, "body": "@DmitriGoldring r.ParseForm() does not seem to return any errors."}, {"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1438373094, "post_id": 31753467, "comment_id": 51442227, "body": "Does Angular add the <code>key</code> query parameter?"}, {"owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "reply_to_user": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1438373172, "post_id": 31753467, "comment_id": 51442259, "body": "@DmitriGoldring No, it just gets the /verify URL and gets the JSON response from it."}, {"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1438373398, "post_id": 31753467, "comment_id": 51442394, "body": "So then how does the <code>key</code> parameter end up in the URL that your application receives? It looks like <code>$http</code> can take a <code>params</code> map that can be used to add GET query parameters."}, {"owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "reply_to_user": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1438373463, "post_id": 31753467, "comment_id": 51442416, "body": "@DmitriGoldring An e-mail is sent to the user which contains the link with the <code>key</code> parameter. The code is used to verify a user&#39;s e-mail address."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438388875, "post_id": 31753467, "comment_id": 51447552, "body": "@dtrinh100 Could you please post how the email looks like and what is the browser address bar after you clicking on the link in email. Does it contains  <code>?key=ijio</code>?"}, {"owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438392631, "post_id": 31753467, "comment_id": 51448149, "body": "@AlexAtNet It simply says to click on the link to verify. The URL in the browser looks like what was posted except the <code>key</code> changes based on a generated hash."}], "answers": [{"tags": [], "owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "is_accepted": true, "score": 0, "last_activity_date": 1438484917, "last_edit_date": 1438484917, "creation_date": 1438483280, "answer_id": 31768089, "question_id": 31753467, "link": "https://stackoverflow.com/questions/31753467/getting-the-url-parameter-in-go-issue/31768089#31768089", "title": "Getting the URL parameter in Go issue", "body": "<p>The solution to my question involves inspecting the request URL link by </p>\n\n<pre><code>log.Print(r.URL) // This returns \"/verify\"\n</code></pre>\n\n<p>However, that's not exactly what you want. Instead, you want the full URL. You can do the following to get the full URL and extract the parameter from it: </p>\n\n<pre><code>urlStr := r.Referer()             // gets the full URL as a string\nurlFull, err := url.Parse(urlStr) // returns a *URL object\nif err != nil {\n    log.Fatal(err)\n    return\n}\nkey := urlFull.Query().Get(\"key\") // now we get the key parameter from the URL\nlog.Println(\"Key: \" + key) // now you'll get a non empty string\n</code></pre>\n"}], "owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 31768089, "answer_count": 1, "score": 0, "last_activity_date": 1438484917, "creation_date": 1438369742, "last_edit_date": 1438372716, "question_id": 31753467, "link": "https://stackoverflow.com/questions/31753467/getting-the-url-parameter-in-go-issue", "title": "Getting the URL parameter in Go issue", "body": "<p>I have a URL that looks something like this: <a href=\"http://localhost/templates/verify?key=ijio\" rel=\"nofollow\">http://localhost/templates/verify?key=ijio</a></p>\n\n<p>My router looks like this: </p>\n\n<pre><code>import (\n\"github.com/gorilla/mux\"\n\"github.com/justinas/alice\"\n)\n\nctx := &amp;model.AppContext{db, cfg} // passes in database and config\nverifyUser := controller.Verify(ctx)\nmx.Handle(\"/verify\", commonHandlers.ThenFunc(verifyUser)).Methods(\"GET\").Name(\"verify\")\n</code></pre>\n\n<p>I want to get the key parameter out of the URL, so I use the following code: </p>\n\n<pre><code>func Verify(c *model.AppContext) http.HandlerFunc {\n    fn := func(w http.ResponseWriter, r *http.Request) {\n\n    key := r.URL.Query().Get(\"key\") // gets the hash value that was placed in the URL\n    log.Println(key) // empty key\n    log.Println(r.URL.Query()) // returns map[]\n    // code that does something with key and sends back JSON response\n   }\n}\n</code></pre>\n\n<p>I used AngularJS to get the JSON data:</p>\n\n<pre><code>app.controller(\"verifyControl\", ['$scope', '$http', function($scope, $http) {\n    $scope.message = \"\";\n    $http({\n      method: 'GET',\n      url: \"/verify\"\n    }).success(function(data) {\n         $scope.message = data.msg; // JSON response \n   });\n\n  }]);\n</code></pre>\n\n<p>However, I end up with an empty key variable when I try to print it out. I recently used nginx to take out my .html extension if that's a possible cause of this problem. How do I fix this? </p>\n"}, {"tags": ["inheritance", "go", "interface", "standards"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1438784553, "post_id": 31753282, "comment_id": 51592268, "body": "<a href=\"https://golang.org/doc/effective_go.html#blank_implements\" rel=\"nofollow noreferrer\">Effective Go: Interface checks</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4966, "user_id": 3605497, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mV6Nc.jpg?s=128&g=1", "display_name": "Tripp Kinetics", "link": "https://stackoverflow.com/users/3605497/tripp-kinetics"}, "edited": false, "score": 1, "creation_date": 1438369263, "post_id": 31753324, "comment_id": 51440302, "body": "Indeed.  This was a deliberate decision on the part of the language designers."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 3, "creation_date": 1438380910, "post_id": 31753324, "comment_id": 51445602, "body": "<a href=\"http://golang.org/doc/faq#guarantee_satisfies_interface\" rel=\"nofollow noreferrer\">They mention the <code>var _</code> trick in the FAQ</a>, so while they did decide not to include &#39;implements&#39;, they don&#39;t seem to be too against people hacking in checks."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438381617, "post_id": 31753324, "comment_id": 51445800, "body": "@twotwotwo yeah there is value in it. The behavior developers are looking for is still there, whether or not your org/project uses it is up to you. In general, Go is progressive with what is part of the language and what isn&#39;t. I think most of their decisions have been quite good, this one included."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 1, "last_activity_date": 1584068845, "last_edit_date": 1584068845, "creation_date": 1438369203, "answer_id": 31753324, "question_id": 31753282, "link": "https://stackoverflow.com/questions/31753282/go-how-to-explicitly-state-that-a-structure-is-implementing-an-interface/31753324#31753324", "title": "Go - how to explicitly state that a structure is implementing an interface?", "body": "<p>You cannot. In Go all interface implementations are implicit. You can check if a type implements an interface (and that is the most explicit it gets). If I recall correctly in a project I worked on, we just did some type asserts at the top of the package against the interfaces which the type implemented, and that is as close to explicit as it gets. </p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438450314, "post_id": 31753338, "comment_id": 51460740, "body": "If you consider this a test (I do) you&#39;d put the <code>var _ \u2026</code> line into one of your <code>*_test.go</code> files. If the type isn&#39;t a pointer (e.g. if it&#39;s <code>Bar</code> that implements the interface rather than <code>*Bar</code>) you could use <code>var _ Foo = Bar{}</code>"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438475812, "post_id": 31753338, "comment_id": 51466787, "body": "I personally prefer to add it right above my types to make sure I don&#39;t accidentally break it, but ymmv."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 9, "last_activity_date": 1438378286, "last_edit_date": 1438378286, "creation_date": 1438369270, "answer_id": 31753338, "question_id": 31753282, "link": "https://stackoverflow.com/questions/31753282/go-how-to-explicitly-state-that-a-structure-is-implementing-an-interface/31753338#31753338", "title": "Go - how to explicitly state that a structure is implementing an interface?", "body": "<p>Method 2 is the correct one, method 1 you're just embedding a type and overriding its function. If you forget to override it, you will end up with a nil pointer dereference.</p>\n"}, {"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 5, "last_activity_date": 1438396723, "creation_date": 1438396723, "answer_id": 31757646, "question_id": 31753282, "link": "https://stackoverflow.com/questions/31753282/go-how-to-explicitly-state-that-a-structure-is-implementing-an-interface/31757646#31757646", "title": "Go - how to explicitly state that a structure is implementing an interface?", "body": "<p>I have rarely needed to declare this, because there is almost always somewhere in my package where I am using the struct as the interface. I tend to follow the pattern of keeping my structs unexposed where possible, and providing them only through \"constructor\" functions.</p>\n\n<pre><code>type Foo interface{\n  Foo()\n}\n\ntype bar struct {}\nfunc (b *bar)Foo() {}\n\nfunc NewBar() Foo{\n  return &amp;bar{}\n}\n</code></pre>\n\n<p>If <code>bar</code> does not satisfy <code>Foo</code>, this will not compile. Rather than add constructs to declare that the type implements the interface, I just make sure that <em>my</em> code uses it as the interface at some point.</p>\n"}], "owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1766, "favorite_count": 2, "accepted_answer_id": 31753338, "answer_count": 3, "score": 7, "last_activity_date": 1584068845, "creation_date": 1438369064, "question_id": 31753282, "link": "https://stackoverflow.com/questions/31753282/go-how-to-explicitly-state-that-a-structure-is-implementing-an-interface", "title": "Go - how to explicitly state that a structure is implementing an interface?", "body": "<p>Since Go puts a heavy emphasis on interfaces, I'm wondering how can I explicitly state that a structure is implementing an interface for clarity and errors checking in case some method is missing? I have seen two approaches so far, and I'm wondering which is correct and in accordance to Go specification.</p>\n\n<p>Method 1 - anonymous field</p>\n\n<pre><code>type Foo interface{\n    Foo()\n}\n\ntype Bar struct {\n    Foo\n}\nfunc (b *Bar)Foo() {\n}\n</code></pre>\n\n<p>Method 2 - Explicit conversion</p>\n\n<pre><code>type Foo interface{\n    Foo()\n}\n\ntype Bar struct {\n}\nfunc (b *Bar)Foo() {\n}\nvar _ Foo = (*Bar)(nil)\n</code></pre>\n\n<p>Are those methods correct, or is there some other way to do something like this?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 2, "creation_date": 1438372367, "post_id": 31751784, "comment_id": 51441878, "body": "What exact error message do you have and is there a code to reproduce the problem?"}, {"owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438374223, "post_id": 31751784, "comment_id": 51442794, "body": "The exact error message is <code>pq: invalid input syntax for type double precision: &quot;$1&quot;</code> and to reproduce the problem, try inserting a float64 value into a postgres database column that expects a double float."}, {"owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438374269, "post_id": 31751784, "comment_id": 51442816, "body": "Or any value that isn&#39;t whatever pg expects when a column is double precision."}, {"owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438374927, "post_id": 31751784, "comment_id": 51443122, "body": "Why did I get a down vote? I&#39;m sure others will get this error, and I can&#39;t find anything else on the internet to help solve the problem. If you&#39;re going to down vote, at least give constructive feedback."}, {"owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "edited": false, "score": 0, "creation_date": 1438377767, "post_id": 31751784, "comment_id": 51444351, "body": "<code>float with no precision specified is taken to mean double precision.</code> If you define column type as float in db, should be fine. I haven&#39;t tried with more precision before so if you really need precision, I guess you need to use something from <code>math&#47;big</code> and implement <code>Scan</code> and <code>Value</code> for your named type. Otherwise, you will lose precision in go part."}], "answers": [{"comments": [{"owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "edited": false, "score": 2, "creation_date": 1438615423, "post_id": 31756810, "comment_id": 51510170, "body": "You&#39;re right, I noticed after going for a walk that I was passing variables as &#39;$1&#39; instead of $1. I should have included a code example."}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 1, "last_activity_date": 1438386649, "creation_date": 1438386649, "answer_id": 31756810, "question_id": 31751784, "link": "https://stackoverflow.com/questions/31751784/pq-invalid-input-syntax-for-type-double-precision-1-with-golang/31756810#31756810", "title": "pq: invalid input syntax for type double precision: &quot;$1&quot; with Golang", "body": "<p>The PostgreSQL driver handles insertion of float64 into double precision columns quite well:</p>\n\n<pre><code>tmp=# \\d test\n          Table \"public.test\"\n Column |       Type       | Modifiers \n--------+------------------+-----------\n v      | double precision | \n</code></pre>\n\n<p>And code:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    _ \"github.com/lib/pq\"\n    \"log\"\n)\n\nfunc main() {\n    db, err := sql.Open(\"postgres\", \"user=alex dbname=tmp sslmode=disable\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    result, err := db.Exec(\"insert into test values ($1)\", float64(0.5))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(result)\n}\n</code></pre>\n\n<p>And then:</p>\n\n<pre><code>tmp=# select * from test ;\n  v  \n-----\n 0.5\n 0.5\n 0.5\n(3 rows)\n</code></pre>\n\n<p>The question was downvoted because obviously the problem description you provided is <em>not enough</em> to reproduce the issue. I've tried to follow but as you see it is working.</p>\n"}], "owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2312, "favorite_count": 0, "accepted_answer_id": 31756810, "answer_count": 1, "score": -1, "last_activity_date": 1438386649, "creation_date": 1438363274, "question_id": 31751784, "link": "https://stackoverflow.com/questions/31751784/pq-invalid-input-syntax-for-type-double-precision-1-with-golang", "title": "pq: invalid input syntax for type double precision: &quot;$1&quot; with Golang", "body": "<p>I'm trying to do a simple <code>INSERT</code> into a <code>postgresql</code> database in my <code>GO</code> program. I have the number <code>0</code> that is a <code>float64</code>, I have a column in my database that expects <code>double precision</code>. I have no idea what I need to convert the number to in order for the database to accept the value. </p>\n"}, {"tags": ["ssl", "go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438364985, "post_id": 31751764, "comment_id": 51438042, "body": "Wouldn&#39;t close--it was messily phrased but &quot;how do I check details of a TLS client certificate&quot; is a perfectly legitimate question."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 5, "creation_date": 1438365913, "post_id": 31751764, "comment_id": 51438530, "body": "I&#39;m not super familiar with <code>crypto&#47;tls</code>, but looks like <code>conn.ConnectionState().PeerCertificates[0]</code> gets you an <a href=\"https://golang.org/pkg/crypto/x509/#Certificate\" rel=\"nofollow noreferrer\"><code>x509.Certificate</code></a>. <code>conn.VerifyHostname(name)</code> will just check hostname."}, {"owner": {"reputation": 541, "user_id": 1204368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4c4833d3a1ec1685839f37aea0caa28?s=128&d=identicon&r=PG", "display_name": "Rekby", "link": "https://stackoverflow.com/users/1204368/rekby"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1438410919, "post_id": 31751764, "comment_id": 51451036, "body": "Yes,thanks. Rewrite it as answer please."}], "answers": [{"tags": [], "owner": {"reputation": 1652, "user_id": 918176, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2bdb37b11c35de00bb68359342a82f38?s=128&d=identicon&r=PG", "display_name": "user918176", "link": "https://stackoverflow.com/users/918176/user918176"}, "is_accepted": false, "score": 4, "last_activity_date": 1448055021, "creation_date": 1448055021, "answer_id": 33836387, "question_id": 31751764, "link": "https://stackoverflow.com/questions/31751764/get-remote-ssl-certificate-in-golang/33836387#33836387", "title": "Get remote ssl certificate in golang", "body": "<p>When working with  <a href=\"https://golang.org/pkg/crypto/tls/\" rel=\"nofollow\">crypto/tls</a> you can query any Conn object for ConnectionState:</p>\n\n<pre><code>func (c *Conn) ConnectionState() ConnectionState\n</code></pre>\n\n<p>The ConnectionState struct contains information about the client certificate:</p>\n\n<pre><code>type ConnectionState struct {\n        PeerCertificates            []*x509.Certificate   // certificate chain presented by remote peer\n}\n</code></pre>\n\n<p>The <a href=\"https://golang.org/pkg/crypto/x509/#Certificate\" rel=\"nofollow\">x509.Certificate</a> should be pretty straightforward to work with. </p>\n\n<p>Before the server requests for client authentication, you have to configure the connection with the server certificate, client CA (otherwise you will have to verify the trust chain manually, you really don't want that), and tls.RequireAndVerifyClientCert. For example:</p>\n\n<pre><code>// Load my SSL key and certificate\ncert, err := tls.LoadX509KeyPair(settings.MyCertificateFile, settings.MyKeyFile)\ncheckError(err, \"LoadX509KeyPair\")\n\n// Load the CA certificate for client certificate validation\ncapool := x509.NewCertPool()\ncacert, err := ioutil.ReadFile(settings.CAKeyFile)\ncheckError(err, \"loadCACert\")\ncapool.AppendCertsFromPEM(cacert)\n\n// Prepare server configuration\nconfig := tls.Config{Certificates: []tls.Certificate{cert}, ClientCAs: capool, ClientAuth: tls.RequireAndVerifyClientCert}\nconfig.NextProtos = []string{\"http/1.1\"}\nconfig.Rand = rand.Reader\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 541, "user_id": 1204368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4c4833d3a1ec1685839f37aea0caa28?s=128&d=identicon&r=PG", "display_name": "Rekby", "link": "https://stackoverflow.com/users/1204368/rekby"}, "is_accepted": true, "score": 12, "last_activity_date": 1448071164, "creation_date": 1448071164, "answer_id": 33838886, "question_id": 31751764, "link": "https://stackoverflow.com/questions/31751764/get-remote-ssl-certificate-in-golang/33838886#33838886", "title": "Get remote ssl certificate in golang", "body": "<p>Have to call <a href=\"https://golang.org/pkg/crypto/tls/#Conn.Handshake\" rel=\"noreferrer\">crypto/tls/Conn.Handshake</a>.\nThen you can read peer certificate:\ntlsconn.ConnectionState().PeerCertificates[0].Subject.CommonName</p>\n"}, {"comments": [{"owner": {"reputation": 541, "user_id": 1204368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4c4833d3a1ec1685839f37aea0caa28?s=128&d=identicon&r=PG", "display_name": "Rekby", "link": "https://stackoverflow.com/users/1204368/rekby"}, "edited": false, "score": 0, "creation_date": 1517495644, "post_id": 48542518, "comment_id": 84126280, "body": "your method you can use only in http gandler. My question was about tcp connection."}], "tags": [], "owner": {"reputation": 21, "user_id": 9294520, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/4b67c0314c4ed7b3c8324d4a1568b6aa?s=128&d=identicon&r=PG", "display_name": "Arturo", "link": "https://stackoverflow.com/users/9294520/arturo"}, "is_accepted": false, "score": 2, "last_activity_date": 1517402593, "creation_date": 1517402593, "answer_id": 48542518, "question_id": 31751764, "link": "https://stackoverflow.com/questions/31751764/get-remote-ssl-certificate-in-golang/48542518#48542518", "title": "Get remote ssl certificate in golang", "body": "<p>There is an easier way to do that:</p>\n\n<pre><code>func renewCert(w http.ResponseWriter, r *http.Request) {\n\n  if r.TLS != nil &amp;&amp; len(r.TLS.PeerCertificates) &gt; 0 {\n    cn := strings.ToLower(r.TLS.PeerCertificates[0].Subject.CommonName)\n    fmt.Println(\"CN: %s\", cn)\n  }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 8394229, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-infGNzpGbcY/AAAAAAAAAAI/AAAAAAAABug/fU1Ui6s_RP0/photo.jpg?sz=128", "display_name": "Prince Kumar", "link": "https://stackoverflow.com/users/8394229/prince-kumar"}, "is_accepted": false, "score": 1, "last_activity_date": 1602939524, "last_edit_date": 1602939524, "creation_date": 1602939177, "answer_id": 64402683, "question_id": 31751764, "link": "https://stackoverflow.com/questions/31751764/get-remote-ssl-certificate-in-golang/64402683#64402683", "title": "Get remote ssl certificate in golang", "body": "<p>Following code may help you get your answer</p>\n<pre><code>package main\n\nimport (\n    &quot;crypto/tls&quot;\n    &quot;fmt&quot;\n    &quot;log&quot;\n)\n\nfunc main() {\n    conf := &amp;tls.Config{\n        InsecureSkipVerify: true,\n    }\n\n    conn, err := tls.Dial(&quot;tcp&quot;, &quot;www.google.com:443&quot;, conf)\n    if err != nil {\n        log.Println(&quot;Error in Dial&quot;, err)\n        return\n    }\n    defer conn.Close()\n    certs := conn.ConnectionState().PeerCertificates\n    for _, cert := range certs {\n        fmt.Printf(&quot;Issuer Name: %s\\n&quot;, cert.Issuer)\n        fmt.Printf(&quot;Expiry: %s \\n&quot;, cert.NotAfter.Format(&quot;2006-January-02&quot;))\n        fmt.Printf(&quot;Common Name: %s \\n&quot;, cert.Issuer.CommonName)\n\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 541, "user_id": 1204368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4c4833d3a1ec1685839f37aea0caa28?s=128&d=identicon&r=PG", "display_name": "Rekby", "link": "https://stackoverflow.com/users/1204368/rekby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9828, "favorite_count": 2, "accepted_answer_id": 33838886, "answer_count": 4, "score": 14, "last_activity_date": 1602939524, "creation_date": 1438363199, "last_edit_date": 1438364941, "question_id": 31751764, "link": "https://stackoverflow.com/questions/31751764/get-remote-ssl-certificate-in-golang", "title": "Get remote ssl certificate in golang", "body": "<p>I want to receive a TCP connection over TLS. I want to validate client certificate and use it to authenticate the client to my application.\nGo has the standard <a href=\"https://golang.org/pkg/crypto/tls/\" rel=\"noreferrer\"><code>crypto/tls</code></a> package. It can validate client/server certificates. But I can't find way to get details of the remote (client) certificate, like the common name.</p>\n"}, {"tags": ["postgresql", "go", "parameters", "martini"], "comments": [{"owner": {"reputation": 173, "user_id": 5090740, "user_type": "registered", "accept_rate": 20, "profile_image": "https://lh3.googleusercontent.com/-x9RuDz6qe3o/AAAAAAAAAAI/AAAAAAAAHGk/27x4L0Optas/photo.jpg?sz=128", "display_name": "Sam", "link": "https://stackoverflow.com/users/5090740/sam"}, "edited": false, "score": 0, "creation_date": 1438369245, "post_id": 31751111, "comment_id": 51440287, "body": "So thanks to AlexAtNet i&#39;ve been able to work around the initial question... Does anyone have any advice on consolidating the statements? Or eliminating superfluous code?"}], "answers": [{"comments": [{"owner": {"reputation": 173, "user_id": 5090740, "user_type": "registered", "accept_rate": 20, "profile_image": "https://lh3.googleusercontent.com/-x9RuDz6qe3o/AAAAAAAAAAI/AAAAAAAAHGk/27x4L0Optas/photo.jpg?sz=128", "display_name": "Sam", "link": "https://stackoverflow.com/users/5090740/sam"}, "edited": false, "score": 0, "creation_date": 1438366183, "post_id": 31751799, "comment_id": 51438674, "body": "Thanks so much! I&#39;m fiddling with it now... I&#39;m still a little confused on how to make it work...      id, err := db.Query(&quot;INSERT INTO users (first, last, email, password, karma, value) VALUES ($1, $2, $3, $4, $5, $6) RETURNING id&quot;,                         triggers                                                    sql: converting Exec argument #0&#39;s type: unsupported type sql.Rows, a struct"}, {"owner": {"reputation": 173, "user_id": 5090740, "user_type": "registered", "accept_rate": 20, "profile_image": "https://lh3.googleusercontent.com/-x9RuDz6qe3o/AAAAAAAAAAI/AAAAAAAAHGk/27x4L0Optas/photo.jpg?sz=128", "display_name": "Sam", "link": "https://stackoverflow.com/users/5090740/sam"}, "edited": false, "score": 0, "creation_date": 1438368700, "post_id": 31751799, "comment_id": 51439985, "body": "To reiterate, I am struggeling with how to access the returned id... Where is the value from &#39;RETURNING id&#39; placed?"}, {"owner": {"reputation": 173, "user_id": 5090740, "user_type": "registered", "accept_rate": 20, "profile_image": "https://lh3.googleusercontent.com/-x9RuDz6qe3o/AAAAAAAAAAI/AAAAAAAAHGk/27x4L0Optas/photo.jpg?sz=128", "display_name": "Sam", "link": "https://stackoverflow.com/users/5090740/sam"}, "edited": false, "score": 0, "creation_date": 1438369120, "post_id": 31751799, "comment_id": 51440215, "body": "I got it working by switching the top query to a queryrow and adding a .Scan(&amp;id) to the end. I&#39;d love to see a solution that involved a query instead of a query row."}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": false, "score": 0, "last_activity_date": 1438387358, "last_edit_date": 1438387358, "creation_date": 1438363330, "answer_id": 31751799, "question_id": 31751111, "link": "https://stackoverflow.com/questions/31751111/postgresql-golang-martini-inserting-key/31751799#31751799", "title": "Postgresql Golang Martini Inserting key", "body": "<p>I did it by returning the inserted user id from the first query and use it in the second one, but I did not use upsert.</p>\n\n<p>So you can try use <a href=\"http://www.postgresql.org/docs/9.4/static/sql-insert.html\" rel=\"nofollow\">RETURNING</a> to return the id of newly added user or query it separately by the email (as it looks like the email is unique per user in this case).</p>\n\n<p>Then use it for second query:</p>\n\n<pre><code>_, err = db.Query(`INSERT INTO userinfo (usr, dob, phonenum, bio, mates, bought, sold)\n                   VALUES ($1, $2, $3, $4, $5, $6, $7)`,\n    id, // there\n    r.FormValue(\"dob\"),\n    r.FormValue(\"phonenum\"),\n    ...\n</code></pre>\n\n<p>I suppose that <code>usr</code> is the user id (foreign key to <code>users.id</code>)</p>\n\n<p>Sample source code:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    _ \"github.com/lib/pq\"\n    \"log\"\n)\n\nfunc main() {\n    db, err := sql.Open(\"postgres\", \"user=alex dbname=tmp sslmode=disable\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    rows, err := db.Query(`\n        INSERT INTO users (first, last, email, password, karma, value)\n        SELECT  CAST ($3 AS VARCHAR), $1, $2, $4, $5, $6\n        WHERE NOT EXISTS (SELECT * FROM users WHERE email = $3)\n        RETURNING id`,\n        \"first\", \"last\", \"email\", \"password\", 0, 0)\n    defer rows.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if rows.Next() {\n        id := 0\n        rows.Scan(&amp;id)\n        _, err = db.Exec(`INSERT INTO userinfo (user_id, info) VALUES ($1, $2)`, id, \"info\")\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        fmt.Println(\"Inserted:\", id)\n    }\n\n}\n</code></pre>\n\n<p>I personally prefer QueryRow instead of query as it a bit more obvious that one row is returned, but it will work with Query as well.</p>\n\n<p>Also I recommend to use unique index for email, instead of subquery.</p>\n"}], "owner": {"reputation": 173, "user_id": 5090740, "user_type": "registered", "accept_rate": 20, "profile_image": "https://lh3.googleusercontent.com/-x9RuDz6qe3o/AAAAAAAAAAI/AAAAAAAAHGk/27x4L0Optas/photo.jpg?sz=128", "display_name": "Sam", "link": "https://stackoverflow.com/users/5090740/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 840, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1438387358, "creation_date": 1438360695, "last_edit_date": 1438362069, "question_id": 31751111, "link": "https://stackoverflow.com/questions/31751111/postgresql-golang-martini-inserting-key", "title": "Postgresql Golang Martini Inserting key", "body": "<p>I am working on building a social network type server as an exercise using martini, golang, and postgresql to help develop my skills in all three. The few key things that are eluding me are how to insert the primary key from the user table into the correct row of the user info table (to connect the user info with the specific user). I'm sure there is also a way to consolidate both the queries into a much more concise postgres script... </p>\n\n<pre><code>func CreateUser(ren render.Render, r *http.Request, db *sql.DB) {\n\n  _, err := db.Query(\"INSERT INTO users (first, last, email, password, karma, value) SELECT  CAST ($3 AS VARCHAR), $1, $2, $4, $5, $6 WHERE NOT EXISTS (SELECT * FROM users WHERE email = $3)\",\n    r.FormValue(\"first\"),\n    r.FormValue(\"last\"),\n    r.FormValue(\"email\"),\n    r.FormValue(\"password\"),\n    0,\n    0)\n\n  PanicIf(err)\n\n  _, err = db.Query(\"INSERT INTO userinfo (usr, dob, phonenum, bio, mates, bought, sold) VALUES ($1, $2, $3, $4, $5, $6, $7)\",\n        0,\n        r.FormValue(\"dob\"),\n        r.FormValue(\"phonenum\"),\n        r.FormValue(\"bio\"),\n        0,\n        0,\n        0)\n\n  PanicIf(err)\n\n  ren.Redirect(\"/\")\n}\n</code></pre>\n\n<p>Here is the script for creating the user table:</p>\n\n<pre><code>DROP TABLE IF EXISTS \"public\".\"users\";\nCREATE TABLE \"public\".\"users\" (\n    \"id\" serial NOT NULL,\n    \"first\" varchar(40) NOT NULL COLLATE \"default\",\n    \"last\" varchar(40) NOT NULL COLLATE \"default\",\n    \"email\" varchar(40) NOT NULL COLLATE \"default\",\n    \"password\" varchar(40) NOT NULL COLLATE \"default\",\n    \"karma\" int NOT NULL,\n    \"value\" int NOT NULL\n)\nWITH (OIDS=FALSE);\n</code></pre>\n\n<p>I realize that in production level code I would not want to store the password like this. I have also sort of been stumped by how to pull non-global parameters into the database as its is created by m.get &amp; m.post commands. </p>\n\n<pre><code> m.Post(\"/newuser\", CreateUser)\n m.Get(\"/user\", NewUser)\n</code></pre>\n\n<p>Any advice on consolidating and adding the key from users to the appropriate entry in userinfo would be greatly appreciated... I realize that these are probably incredibly stupid questions but please pardon my naivety. </p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1438358312, "post_id": 31750100, "comment_id": 51434473, "body": "what is <code>createAndMonitorEvents</code>?"}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1438358431, "post_id": 31750100, "comment_id": 51434528, "body": "Just a routine called by my <code>main()</code> to create the dockerclient and monitor the events. I will update the q."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1438358564, "post_id": 31750100, "comment_id": 51434596, "body": "So it is just a listener for events that calls the handler. No big deal. My question is how to get the test to wait to make sure the event is handled properly."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438360648, "post_id": 31750100, "comment_id": 51435777, "body": "Substantially changed my answer -- I think you can use <code>MonitorEvents</code>, and the <code>nil</code>s you&#39;re seeing are just the symptom of a closed channel (which you can handle a couple ways)."}], "answers": [{"comments": [{"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1438451446, "post_id": 31750715, "comment_id": 51461111, "body": "Aha! Now I understand the <code>nil</code>s I have been seeing. I missed that part of the spec, thank you for pointing it out. I still don&#39;t get how this answers the q, though. How do I tell my test, &quot;wait for the callback handler to respond&quot;? Either way, +1 for catching that on the channel."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1438462229, "post_id": 31750715, "comment_id": 51464150, "body": "You can make a callback write to (or close) a channel, then wait on the channel. In other words, you could build something a bit like <code>MonitorEvents</code> on top of the callback interface. (Though that&#39;s not how I was thinking of it at the time--I hadn&#39;t yet looked at <code>MonitorEvents</code> when I suggested that.)"}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1438463801, "post_id": 31750715, "comment_id": 51464499, "body": "&quot;something a bit like <code>MonitorEvents</code> on the callback interface.&quot; Meaning that I could have my tests monitor the original callback code to check it gets called?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1438465314, "post_id": 31750715, "comment_id": 51464875, "body": "You could write the callback so it closes a channel, and test code can receive from the channel to wait on it. I&#39;m not sure whether the callback you&#39;re taking about is part of your test code or part of the application being tested. If the callback lives in the app, you may need to tweak your app so it accepts a channel that, if non-nil, the caller can use to wait for the callback to run. (Not that different from many other sorts of changes people make to apps to make them testability.)"}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1438487153, "post_id": 31750715, "comment_id": 51468281, "body": "It is part of the app... that is what the other answer said. I already do something sort of like that to know when a different section of code (in my test) has executed so I can send information."}], "tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": true, "score": 1, "last_activity_date": 1438360578, "last_edit_date": 1438360578, "creation_date": 1438359413, "answer_id": 31750715, "question_id": 31750100, "link": "https://stackoverflow.com/questions/31750100/how-do-i-tell-my-test-to-wait-for-a-callback-in-a-goroutine/31750715#31750715", "title": "How do I tell my test to wait for a callback in a goroutine?", "body": "<p>I think when you get <code>nil</code>s with <code>MonitorEvents</code>, you're just seeing that the event channel is closed (the <a href=\"https://github.com/samalba/dockerclient/blob/master/dockerclient.go#L315\" rel=\"nofollow\">source of <code>MonitorEvents</code></a> includes a <code>close(eventOrErrorChan)</code>, supporting this). <code>evt, ok := &lt;-c</code> lets you directly check if that (<code>ok</code> will be false when it's closed), and <code>for evt := range c</code> will stop after it's closed. In general, receiving from a closed channel is <a href=\"http://golang.org/ref/spec#Receive_operator\" rel=\"nofollow\">specified</a> to \"[yield] the element type's zero value after any previously sent values have been received\"</p>\n\n<p>On the question about waiting on a callback: the callback can close a channel. (Or send to it.) Then your test can wait up to a specified length of time with a <code>select</code>:</p>\n\n<pre><code>select {\ncase &lt;-c:\n        /* ...success... */\ncase &lt;-time.After(5 * time.Second):\n        /* timed out */\n}\n</code></pre>\n\n<p>If you know some error conditions cause the handler not to finish, or not to run, it could signal those situations on a different channel, or by sending a different value to <code>c</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1438451532, "post_id": 31750819, "comment_id": 51461141, "body": "So you are saying, basically, the only ways are to play with a timer, or have a function that explicitly says, &quot;I am done.&quot; Is that it? Fortunately, I control the source code for the function (I am testing my own stuff), so that helps."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1438360095, "last_edit_date": 1438360095, "creation_date": 1438359753, "answer_id": 31750819, "question_id": 31750100, "link": "https://stackoverflow.com/questions/31750100/how-do-i-tell-my-test-to-wait-for-a-callback-in-a-goroutine/31750819#31750819", "title": "How do I tell my test to wait for a callback in a goroutine?", "body": "<p>\"How do I tell my test, \"wait for the other routine to do its work before running the test\", other than putting in some arbitrary sleep?\"</p>\n\n<p>You either send on a channel or close one. Where the caller is receiving execution blocks until a signal occurs. I don't really see how to work your code into something that makes sense though... You can't allocate the stop channel in the function, you have to pass it to the function so the caller can listen on it. Like how does this even compile?</p>\n\n<pre><code>func TestReceiveEvent(t *testing.T) {\n   createAndMonitorEvents(server.URL)\n   &lt;- eventReady // undeclared variable, and discarding the event you recieved?\n   eventWriter.Write([]byte(someEvent)) //and another variable that is not declared\n   // test for something here\n}\n</code></pre>\n\n<p>Maybe and idea that will help get you started...</p>\n\n<pre><code>func createAndMonitorEvents(url string, done chan bool) {\n      //the codes\n      close(done)\n}\n\n\nfunc TestReceiveEvent(t *testing.T) {\n  eventReady := make(chan bool)\n    createAndMonitorEvents(server.URL, eventReady)\n    &lt;- eventReady\n    eventWriter.Write([]byte(someEvent)) // dis still don't exist though\n    // test for something here\n</code></pre>\n\n<p>}</p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438628951, "post_id": 31780730, "comment_id": 51517689, "body": "A channel is a better fit here than a wait group."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1438632436, "post_id": 31780730, "comment_id": 51519465, "body": "The WaitGroup is a pretty cool idea in general, but I have no way of getting to it. It would require knowing which routine in the code."}], "tags": [], "owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "is_accepted": false, "score": 1, "last_activity_date": 1438583467, "creation_date": 1438583467, "answer_id": 31780730, "question_id": 31750100, "link": "https://stackoverflow.com/questions/31750100/how-do-i-tell-my-test-to-wait-for-a-callback-in-a-goroutine/31780730#31780730", "title": "How do I tell my test to wait for a callback in a goroutine?", "body": "<p>I think this can help </p>\n\n<blockquote>\n  <p>A WaitGroup waits for a collection of goroutines to finish. The main goroutine calls Add to set the number of goroutines to wait for. Then each of the goroutines runs and calls Done when finished. At the same time, Wait can be used to block until all goroutines have finished. </p>\n</blockquote>\n\n<p><a href=\"http://golang.org/pkg/sync/#example_WaitGroup\" rel=\"nofollow\">http://golang.org/pkg/sync/#example_WaitGroup</a></p>\n"}], "owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2846, "favorite_count": 1, "accepted_answer_id": 31750715, "answer_count": 3, "score": 0, "last_activity_date": 1438583467, "creation_date": 1438357171, "last_edit_date": 1438358527, "question_id": 31750100, "link": "https://stackoverflow.com/questions/31750100/how-do-i-tell-my-test-to-wait-for-a-callback-in-a-goroutine", "title": "How do I tell my test to wait for a callback in a goroutine?", "body": "<p>I am using the dockerclient <a href=\"https://github.com/samalba/dockerclient\" rel=\"nofollow\">https://github.com/samalba/dockerclient</a> which has a channel-based API to listen for events <code>client.MonitorEvents()</code> and a convenient callback method <code>client.StartMonitorEvents(callbackHandler)</code>.</p>\n\n<p>I want to test that the handler gets called. Of course, the dockerclient handles the events in a goroutine.</p>\n\n<p>For now, my handler just spits out a log. If I wait in my test, everything is handled. If I do not, it exits before it handles anything:</p>\n\n<pre><code>func eventCallback(event *dockerclient.Event, ec chan error, args ...interface{}) {\n  log.Printf(\"Received event: %#v\\n\", *event)\n}\n</code></pre>\n\n<p>My test seems straightforward:</p>\n\n<pre><code>func TestReceiveEvent(t *testing.T) {\n   createAndMonitorEvents(server.URL)\n   &lt;- eventReady\n   eventWriter.Write([]byte(someEvent))\n   // test for something here\n}\n</code></pre>\n\n<p>Of course, it doesn't work unless I put in a <code>time.Sleep()</code> because of the goroutine. </p>\n\n<p>How do I tell my test, \"wait for the other routine to do its work before running the test\", other than putting in some arbitrary sleep? I am looking to test that the event is processed correctly by my handler.</p>\n\n<p>The alternate interface, <code>client.MonitorEvents()</code> returns a channel, which gives me greater control, but the receive off the channel spits out infinite <code>nil</code> events.</p>\n\n<p>UPDATE:</p>\n\n<p>As requested, createAndMonitorEvents is:</p>\n\n<pre><code>func createAndMonitorEvents(url string) {\n  // Init the client\n  docker, _ := dockerclient.NewDockerClient(url, nil)\n\n  // Listen to events\n  stopchan := make(chan struct{})\n\n  go func() {\n    eventErrChan, err := docker.MonitorEvents(nil, stopchan)\n    if err != nil {\n        return\n    }\n\n    for e := range eventErrChan {\n        if e.Error != nil {\n            return\n        }\n        eventCallback(&amp;e.Event, nil)\n    }\n    fmt.Println(\"monitor in place\")\n  }()\n}\n</code></pre>\n"}, {"tags": ["http", "memory-leaks", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438355159, "post_id": 31748433, "comment_id": 51432599, "body": "What version of Go are you using?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1438355233, "post_id": 31748433, "comment_id": 51432660, "body": "(probably not related, but <code>lCh</code> isn&#39;t buffered, so queueLen will always be 0)"}, {"owner": {"reputation": 101, "user_id": 424486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2df95ea99a826ed53f9485fe1d1aa36f?s=128&d=identicon&r=PG", "display_name": "Denton", "link": "https://stackoverflow.com/users/424486/denton"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438356623, "post_id": 31748433, "comment_id": 51433520, "body": "Modified lCh initialization, now queueLen calculating properly, but memory growth still here."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438359053, "post_id": 31748433, "comment_id": 51434896, "body": "Shot in a dark, but if you save a substring/subslice of the body in a global, that would keep the entire string/slice &quot;alive&quot; from the GC&#39;s perspective."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438364102, "post_id": 31748433, "comment_id": 51437600, "body": "Get a stack trace from when the process has accumulated a lot of memory."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1438380876, "post_id": 31754889, "comment_id": 51445591, "body": "You&#39;re missing some of the other defaults from <code>http.DefaultTransport</code> that may be useful to you, like the Dialer with a timeout. Also, if you are often making requests to the same hosts too, you may want to have keepalives, and periodically use Transport.CloseIdleConnections instead."}, {"owner": {"reputation": 101, "user_id": 424486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2df95ea99a826ed53f9485fe1d1aa36f?s=128&d=identicon&r=PG", "display_name": "Denton", "link": "https://stackoverflow.com/users/424486/denton"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1438427161, "post_id": 31754889, "comment_id": 51454856, "body": "Sure, in actual code I am also using <code>Dialer</code> with timeout, but it irrelevant to solution, so I decided to skip this part. As all my requests going to different hosts, using <code>Transport.CloseIdleConnections</code> makes no sense right now, but may be useful sometime. Thank you!"}], "tags": [], "owner": {"reputation": 101, "user_id": 424486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2df95ea99a826ed53f9485fe1d1aa36f?s=128&d=identicon&r=PG", "display_name": "Denton", "link": "https://stackoverflow.com/users/424486/denton"}, "is_accepted": true, "score": 4, "last_activity_date": 1438375480, "creation_date": 1438375480, "answer_id": 31754889, "question_id": 31748433, "link": "https://stackoverflow.com/questions/31748433/go-doesnt-release-memory-after-http-get/31754889#31754889", "title": "Go doesn&#39;t release memory after http.Get", "body": "<p>Found the answer in <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/I2c7wO0SR3I\" rel=\"nofollow\">this thread</a> on golang-nuts. <code>http.Transport</code> saves connections for future reusing in case of request to same host, causing memory bloating in my case (hundreds thousands of different hosts). But disabling KeepAlives totally solves that problem.</p>\n\n<p>Working code:</p>\n\n<pre><code>func worker(linkChan chan string, wg *sync.WaitGroup) {\n    defer wg.Done()\n\n    var transport http.RoundTripper = &amp;http.Transport{\n        DisableKeepAlives: true,\n    }\n\n    c := &amp;http.Client{Transport: transport}\n\n    for url := range linkChan {\n        // Getting body text\n        resp, err := c.Get(url)\n        if err != nil {\n            fmt.Printf(\"Fail url: %s\\n\", url)\n            continue\n        }\n        body, err := ioutil.ReadAll(resp.Body)\n        resp.Body.Close()\n        if err != nil {\n            fmt.Printf(\"Fail url: %s\\n\", url)\n            continue\n        }\n        // Test page body\n        has_rem_code := strings.Contains(string(body), \"googleadservices.com/pagead/conversion.js\")\n        fmt.Printf(\"Done url: %s\\t%t\\n\", url, has_rem_code)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 424486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2df95ea99a826ed53f9485fe1d1aa36f?s=128&d=identicon&r=PG", "display_name": "Denton", "link": "https://stackoverflow.com/users/424486/denton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1605, "favorite_count": 0, "accepted_answer_id": 31754889, "answer_count": 1, "score": 6, "last_activity_date": 1492424219, "creation_date": 1438352404, "last_edit_date": 1492424219, "question_id": 31748433, "link": "https://stackoverflow.com/questions/31748433/go-doesnt-release-memory-after-http-get", "title": "Go doesn&#39;t release memory after http.Get", "body": "<p>I am loading web pages using simple thread pool, while dynamically loading urls from file. But this small program slowly allocate as much memory as my server has, until omm killer stops it. It looks like resp.Body.Close() doesn't free memory for body text (memory size ~ downloaded pages * avg page size). How can I force golang to free memory allocated for body html text?</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"os\"\n    \"strings\"\n    \"sync\"\n)\n\nfunc worker(linkChan chan string, wg *sync.WaitGroup) {\n    defer wg.Done()\n\n    for url := range linkChan {\n        // Getting body text\n        resp, err := http.Get(url)\n        if err != nil {\n            fmt.Printf(\"Fail url: %s\\n\", url)\n            continue\n        }\n        body, err := ioutil.ReadAll(resp.Body)\n        resp.Body.Close()\n        if err != nil {\n            fmt.Printf(\"Fail url: %s\\n\", url)\n            continue\n        }\n        // Test page body\n        has_rem_code := strings.Contains(string(body), \"googleadservices.com/pagead/conversion.js\")\n        fmt.Printf(\"Done url: %s\\t%t\\n\", url, has_rem_code)\n    }\n}\n\nfunc main() {\n    // Creating worker pool\n    lCh := make(chan string, 30)\n    wg := new(sync.WaitGroup)\n\n    for i := 0; i &lt; 30; i++ {\n        wg.Add(1)\n        go worker(lCh, wg)\n    }\n\n    // Opening file with urls\n    file, err := os.Open(\"./tmp/new.csv\")\n    defer file.Close()\n    if err != nil {\n        panic(err)\n    }\n    reader := bufio.NewReader(file)\n\n    // Processing urls\n    for href, _, err := reader.ReadLine(); err == nil; href, _, err = reader.ReadLine() {\n        lCh &lt;- string(href)\n    }\n\n    close(lCh)\n    wg.Wait()\n}\n</code></pre>\n\n<p>Here is some output from pprof tool:</p>\n\n<pre><code>      flat  flat%   sum%        cum   cum%\n   34.63MB 29.39% 29.39%    34.63MB 29.39%  bufio.NewReaderSize\n      30MB 25.46% 54.84%       30MB 25.46%  net/http.(*Transport).getIdleConnCh\n   23.09MB 19.59% 74.44%    23.09MB 19.59%  bufio.NewWriter\n   11.63MB  9.87% 84.30%    11.63MB  9.87%  net/http.(*Transport).putIdleConn\n    6.50MB  5.52% 89.82%     6.50MB  5.52%  main.main\n</code></pre>\n\n<p>Looks like <a href=\"https://github.com/golang/go/issues/5794\" rel=\"nofollow noreferrer\">this issue</a>, but it's fixed 2 years ago.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "edited": false, "score": 1, "creation_date": 1438347942, "post_id": 31745797, "comment_id": 51427340, "body": "&quot;Duplicates&quot;. Duplicate what? What are you expecting to be only one of a kind?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1438347951, "post_id": 31745797, "comment_id": 51427343, "body": "What exactly is it you want to achieve? You may be better able to organize the code, but there&#39;s not much here to de-duplicate."}, {"owner": {"reputation": 39, "user_id": 2923089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f52ad12b035dce3a9f3907d485ccb779?s=128&d=identicon&r=PG&f=1", "display_name": "user2923089", "link": "https://stackoverflow.com/users/2923089/user2923089"}, "edited": false, "score": 0, "creation_date": 1438348243, "post_id": 31745797, "comment_id": 51427536, "body": "I want to get function like ListAnything, i mean get rid of listfirsts and listseconds. Or get composition of code where i won&#39;t need remove duplication."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1438352272, "post_id": 31745797, "comment_id": 51430422, "body": "We can&#39;t tell from your example how you would use this, or how to remove duplications. You could do something like <a href=\"http://play.golang.org/p/rixBkEJO8v\" rel=\"nofollow noreferrer\">play.golang.org/p/rixBkEJO8v</a>, but then you&#39;re just moving the code to somewhere else when you finally need to assert the types in the slice."}, {"owner": {"reputation": 39, "user_id": 2923089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f52ad12b035dce3a9f3907d485ccb779?s=128&d=identicon&r=PG&f=1", "display_name": "user2923089", "link": "https://stackoverflow.com/users/2923089/user2923089"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438353159, "post_id": 31745797, "comment_id": 51431155, "body": "@JimB it&#39;s not a solution which i was looking for, but you gave me a good idea. Thx! You made my day!"}], "owner": {"reputation": 39, "user_id": 2923089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f52ad12b035dce3a9f3907d485ccb779?s=128&d=identicon&r=PG&f=1", "display_name": "user2923089", "link": "https://stackoverflow.com/users/2923089/user2923089"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 605, "favorite_count": 2, "answer_count": 0, "score": 1, "last_activity_date": 1438344373, "creation_date": 1438344373, "question_id": 31745797, "link": "https://stackoverflow.com/questions/31745797/duplicates-in-golang-code", "title": "Duplicates in Golang code", "body": "<p>How to get rid off duplicates from this code? </p>\n\n<p>I thought about code generation with <em>go generate</em>, but I think will get the same result. On other side I thought 'bout use interface, but don't know how to apply(I know how to use them, but not in that particular case).</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype First struct {\n    X int\n    Y float64\n}\n\ntype Second struct {\n    I float64\n    J int\n}\n\nfunc ListFirsts(db map[string]map[int]interface{}) []First {\n    ans := []First{}\n    for _, v := range db[\"Firsts\"] {\n        ans = append(ans, v.(First))\n    }\n    return ans\n}\n\nfunc ListSeconds(db map[string]map[int]interface{}) []Second {\n    ans := []Second{}\n    for _, v := range db[\"Seconds\"] {\n        ans = append(ans, v.(Second))\n    }\n    return ans\n}\n\nfunc main() {\n    db := map[string]map[int]interface{}{\n        \"Firsts\": {\n            1: First{1, 2},\n            2: First{2, 3},\n        },\n        \"Seconds\": {\n            1: Second{11.2, 2},\n            2: Second{2, 3},\n        },\n    }\n\n    fmt.Println(ListFirsts(db))\n    fmt.Println(ListSeconds(db))\n}\n</code></pre>\n"}, {"tags": ["macos", "gcc", "go", "gnu"], "comments": [{"owner": {"reputation": 19889, "user_id": 906839, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5bce6d276ec5c9b7b97804d0add55084?s=128&d=identicon&r=PG", "display_name": "Brett Hale", "link": "https://stackoverflow.com/users/906839/brett-hale"}, "edited": false, "score": 0, "creation_date": 1438343536, "post_id": 31745510, "comment_id": 51424340, "body": "MacPorts has the port <code>gcc5</code> which is gcc-5.2.0."}, {"owner": {"reputation": 126, "user_id": 1434020, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a71adec3ba22a7924de5aae428001ea2?s=128&d=identicon&r=PG", "display_name": "tomihasa", "link": "https://stackoverflow.com/users/1434020/tomihasa"}, "reply_to_user": {"reputation": 19889, "user_id": 906839, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5bce6d276ec5c9b7b97804d0add55084?s=128&d=identicon&r=PG", "display_name": "Brett Hale", "link": "https://stackoverflow.com/users/906839/brett-hale"}, "edited": false, "score": 0, "creation_date": 1438447147, "post_id": 31745510, "comment_id": 51459777, "body": "MacPorts gcc5 might be my option. Do I get any benefits if I try to compile GCC myself?"}], "owner": {"reputation": 126, "user_id": 1434020, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a71adec3ba22a7924de5aae428001ea2?s=128&d=identicon&r=PG", "display_name": "tomihasa", "link": "https://stackoverflow.com/users/1434020/tomihasa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 665, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1438343462, "creation_date": 1438343462, "question_id": 31745510, "link": "https://stackoverflow.com/questions/31745510/gcc-5-2-installation-update-os-x-10-10", "title": "GCC 5.2 Installation/Update (OS X 10.10)", "body": "<p>If I want to make C++, Go, Python, PHP, etc. programs and I want to use the newest version of GCC on OS X 10.10, how should I install it or update it? Golang has its own compiler. There is Xcode, but can you somehow use it to update GCC? There is also MacPorts, which only seems to have Apple's version of GCC 4.2, which I already seem to have.</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 6794, "user_id": 3290397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/43e4f19880863474b48dcd8b8a4c48ea?s=128&d=identicon&r=PG&f=1", "display_name": "golopot", "link": "https://stackoverflow.com/users/3290397/golopot"}, "edited": false, "score": 1, "creation_date": 1597228959, "post_id": 31744970, "comment_id": 112062890, "body": "The question has lots of tangential content."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 8, "creation_date": 1438360265, "post_id": 31745264, "comment_id": 51435561, "body": "I think <a href=\"https://play.golang.org/p/WSGtjRPGac\" rel=\"nofollow noreferrer\"><code>time.Unix(0, millis * int64(time.Mllisecond))</code></a> is a little more readable. <a href=\"https://golang.org/pkg/time/#Unix\" rel=\"nofollow noreferrer\"><code>time.Unix</code></a> is explicitly documented as handling such inputs correctly without requiring callers to split nanosecond values in seconds first."}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438362098, "post_id": 31745264, "comment_id": 51436516, "body": "Yes, you are right. I&#39;ve edited my answer. Thank you very much!"}, {"owner": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "edited": false, "score": 2, "creation_date": 1569872669, "post_id": 31745264, "comment_id": 102729388, "body": "N.B. this has an implicit validity restriction to the years 1678 to 2261 CE. That&#39;s fine for most cases but should at least be noted, as the less readable solution does not have such a restriction."}, {"owner": {"reputation": 154, "user_id": 8913763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICicn.jpg?s=128&g=1", "display_name": "VadimFilin", "link": "https://stackoverflow.com/users/8913763/vadimfilin"}, "edited": false, "score": 0, "creation_date": 1618841188, "post_id": 31745264, "comment_id": 118717611, "body": "I&#39;ve got 3000 year and got bug."}], "tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": true, "score": 34, "last_activity_date": 1438362091, "last_edit_date": 1438362091, "creation_date": 1438342717, "answer_id": 31745264, "question_id": 31744970, "link": "https://stackoverflow.com/questions/31744970/convert-to-time-in-golang-from-milliseconds/31745264#31745264", "title": "Convert to time in Golang from milliseconds", "body": "<p>In golang <code>time.Time</code> marshals to JSON using <a href=\"https://www.ietf.org/rfc/rfc3339.txt\" rel=\"noreferrer\">RFC3339</a>, string representation. So you need to unmarshal your json using <code>int64</code> instead of <code>time.Time</code> and convert after it by yourself:</p>\n\n<pre><code>type Model struct {\n    Name   string `json:\"name\"`\n    Millis int64  `json:\"lastModified\"`\n}\n\nfunc (m Model) Lastmodified() time.Time {\n    return time.Unix(0, m.Millis * int64(time.Millisecond))\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/Kxireu3Np8\" rel=\"noreferrer\">Go playground</a></kbd></p>\n\n<p>Also you can use special wrapper above <code>time.Time</code> and override UnmarshalJSON there:</p>\n\n<pre><code>type Model struct {\n    Name         string   `json:\"name\"`\n    Lastmodified javaTime `json:\"lastModified\"`\n}\n\ntype javaTime time.Time\n\nfunc (j *javaTime) UnmarshalJSON(data []byte) error {\n    millis, err := strconv.ParseInt(string(data), 10, 64)\n    if err != nil {\n        return err\n    }\n    *j = javaTime(time.Unix(0, millis * int64(time.Millisecond)))\n    return nil\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/-xARWUapGV\" rel=\"noreferrer\">Go playground</a></kbd></p>\n"}, {"tags": [], "owner": {"reputation": 154, "user_id": 8913763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICicn.jpg?s=128&g=1", "display_name": "VadimFilin", "link": "https://stackoverflow.com/users/8913763/vadimfilin"}, "is_accepted": false, "score": 0, "last_activity_date": 1618841397, "creation_date": 1618841397, "answer_id": 67163608, "question_id": 31744970, "link": "https://stackoverflow.com/questions/31744970/convert-to-time-in-golang-from-milliseconds/67163608#67163608", "title": "Convert to time in Golang from milliseconds", "body": "<p>Try this:</p>\n<pre><code>func ParseMilliTimestamp(tm int64) time.Time {\n    sec := tm / 1000\n    msec := tm % 1000\n    return time.Unix(sec, msec*int64(time.Millisecond))\n}\n</code></pre>\n"}], "owner": {"reputation": 2527, "user_id": 3476121, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/1c621706e2e37eed4f82f074af9f706a?s=128&d=identicon&r=PG", "display_name": "sadlil", "link": "https://stackoverflow.com/users/3476121/sadlil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 23541, "favorite_count": 7, "accepted_answer_id": 31745264, "answer_count": 2, "score": 18, "last_activity_date": 1618841397, "creation_date": 1438341728, "last_edit_date": 1438406444, "question_id": 31744970, "link": "https://stackoverflow.com/questions/31744970/convert-to-time-in-golang-from-milliseconds", "title": "Convert to time in Golang from milliseconds", "body": "<p>I have a some json data where there is a field called <strong>lastModifed</strong> contains time in millis. I wanted to convert this data into a struct type with json.UnMarshaller. I have mapped the field with json filed. But the conversion seems not working.</p>\n\n<p>IE :</p>\n\n<p>My Json looks like this:</p>\n\n<pre><code>{\n   \"name\" : \"hello\",\n   \"lastModified\" : 1438167001716\n}\n</code></pre>\n\n<p>and struct Looks like</p>\n\n<pre><code>type Model struct {\n    Name         string    `json:\"name\"`\n    Lastmodified time.Time `json:\"lastModified\"`\n}\n</code></pre>\n\n<p>looks not converting the time properly. how can i get the time from those millis??</p>\n\n<p>NB: The millis of lastModifiedTime are getting from java <code>System.currentTimeMillis();</code></p>\n"}, {"tags": ["memory", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1438344418, "post_id": 31744832, "comment_id": 51424943, "body": "You&#39;ve cut off the top of the stack trace that actually says what the error was."}, {"owner": {"reputation": 19, "user_id": 4614962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c0869cd77f2565a20b666b54a465a63?s=128&d=identicon&r=PG&f=1", "display_name": "\u0418\u0433\u043e\u0440\u044c \u0427\u0435\u0440\u0435\u0434\u043d\u0438\u0447\u0435\u043d\u043a\u043e", "link": "https://stackoverflow.com/users/4614962/%d0%98%d0%b3%d0%be%d1%80%d1%8c-%d0%a7%d0%b5%d1%80%d0%b5%d0%b4%d0%bd%d0%b8%d1%87%d0%b5%d0%bd%d0%ba%d0%be"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438423408, "post_id": 31744832, "comment_id": 51453866, "body": "<code>panic: runtime error: invalid memory address or nil pointer dereference [signal 0xb code=0x1 addr=0x0 pc=0x52371]  goroutine 1 [running]:</code> something like this?"}], "owner": {"reputation": 19, "user_id": 4614962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c0869cd77f2565a20b666b54a465a63?s=128&d=identicon&r=PG&f=1", "display_name": "\u0418\u0433\u043e\u0440\u044c \u0427\u0435\u0440\u0435\u0434\u043d\u0438\u0447\u0435\u043d\u043a\u043e", "link": "https://stackoverflow.com/users/4614962/%d0%98%d0%b3%d0%be%d1%80%d1%8c-%d0%a7%d0%b5%d1%80%d0%b5%d0%b4%d0%bd%d0%b8%d1%87%d0%b5%d0%bd%d0%ba%d0%be"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 919, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1438341269, "creation_date": 1438341269, "question_id": 31744832, "link": "https://stackoverflow.com/questions/31744832/golang-proxy-list-script-crashed-goroutine-io-wait", "title": "Golang proxy list script crashed. goroutine IO wait", "body": "<p>This code gets the page data through a proxy.\nIt start from id of page = 1 and continue till 100000</p>\n\n<pre><code>package main\n\nimport (\n    \"code.google.com/p/gcfg\"\n    \"database/sql\"\n    \"flag\"\n    \"fmt\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"github.com/parnurzeal/gorequest\"\n    \"log\"\n    \"strconv\"\n    \"time\"\n)\n\nfunc main() {\n    t := time.Now()\n    initConfig()\n    initRoundRobin()\n\n    for i := vStart; i &lt;= vStop; i++ {\n        cache(\"https://site.ru/url/\"+strconv.Itoa(i), \"url\", i)\n    }\n\n    fmt.Println(\"Time: \", time.Since(t))\n}\n\nvar (\n    db                  *sql.DB\n    config              ConfigStruct\n    configFile          = \"config.gcfg\"\n    roundRobin          map[int]string\n    roundRobinNextId    int\n    roundRobinMaxId     int\n    vStart              int\n    vStop               int\n    vPart               int\n    vScriptCount        int\n    roundRobinShift     int\n    failedRequestCount  int\n    successRequestCount int\n)\n\ntype ConfigStruct struct {\n    Database struct {\n        ConnectionString string\n        TableNameCache   string\n    }\n    Part struct {\n        CurrentPart             int\n        CurrentProxyCheckerPart int\n    }\n}\n\ntype ProxyAddress struct {\n    Id int\n    Ip string\n}\n\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n        log.Fatal(e)\n    }\n}\n</code></pre>\n\n<p>Init connection to the database where stored proxy list and store all pages data.</p>\n\n<pre><code>func initConfig() {\n    if err := gcfg.ReadFileInto(&amp;config, configFile); err != nil {\n        check(err)\n    }\n\n    connect, err := sql.Open(\"mysql\", config.Database.ConnectionString)\n    check(err)\n    db = connect\n    vScriptCount = 100000\n    flag.IntVar(&amp;roundRobinShift, \"shift\", 0, \"\")\n    flag.IntVar(&amp;vPart, \"part\", 0, \"select part\")\n    flag.IntVar(&amp;vStart, \"start\", (vPart*vScriptCount)+1, \"select start id\")\n    flag.IntVar(&amp;vStop, \"stop\", (vPart+1)*vScriptCount, \"select stop id\")\n\n    flag.Parse()\n    vStart = vStart + (vPart * vScriptCount)\n    vStop = vStop + (vPart * vScriptCount)\n    successRequestCount = 0\n}\n</code></pre>\n\n<p>Init list of proxies</p>\n\n<pre><code>func initRoundRobin() {\n    roundRobin = make(map[int]string)\n    rows, err := db.Query(\"SELECT id, ip FROM proxies WHERE status = 1 order by id asc\")\n    check(err)\n    defer rows.Close()\n    for rows.Next() {\n        pa := new(ProxyAddress)\n        if err := rows.Scan(&amp;pa.Id, &amp;pa.Ip); err != nil {\n            check(err)\n        }\n        roundRobin[pa.Id] = pa.Ip\n        roundRobinMaxId = pa.Id\n    }\n    roundRobinNextId = roundRobinShift + successRequestCount\n    if roundRobinNextId &gt; roundRobinMaxId {\n        roundRobinNextId = 0\n    }\n    failedRequestCount = 0\n\n}\n</code></pre>\n\n<p>Function check data from database and if it is not in it - script will do a request </p>\n\n<pre><code>func cache(url string, tag string, url_id int) ([]byte, error) {\n    var data string\n    err := db.QueryRow(\"SELECT data FROM cache WHERE url_id=? AND tag=?\", url_id, tag).Scan(&amp;data)\n    if err == sql.ErrNoRows {\n        data, err := proxyRequest(url)\n        check(err)\n        insert, err := db.Prepare(\"INSERT cache SET url_id=?, url=?, tag=?, data=?, datetime=?\")\n        datetime, err := strconv.ParseInt(time.Now().Format(\"20060102150405\"), 10, 64)\n        check(err)\n        insert.Exec(url_id, url, tag, data, datetime)\n        return []byte(data), nil\n    }\n    return []byte(data), nil\n}\n</code></pre>\n\n<p>Function make request through proxy to get page data. Each request get through new proxy server. Timeout per server = 10 sec. If server don't send a response - server will be deleted from roundrobin.</p>\n\n<pre><code>func proxyRequest(url string) ([]byte, error) {\n    for {\n        roundRobinCurrentId := getNextRoundRobinId()\n        proxy := roundRobin[roundRobinCurrentId]\n        request := gorequest.New().Timeout(10000 * time.Millisecond).Proxy(\"http://\" + proxy)\n        _, body, err := request.Get(url).End()\n        if err != nil {\n            deleteRoundRobinId(roundRobinCurrentId, err[0].Error())\n            continue\n        } else {\n            successRequestCount++\n        }\n        return []byte(body), nil\n        break\n    }\n    return []byte(\"\"), nil\n}\n</code></pre>\n\n<p>Get next proxy server from list. If list is ended - script will wait for 30 seconds.</p>\n\n<pre><code>func getNextRoundRobinId() int {\n    for {\n        if len(roundRobin) == 0 {\n            initRoundRobin()\n            if len(roundRobin) == 0 {\n                fmt.Println(\"proxy is ended\")\n                time.Sleep(30 * time.Second)\n                initRoundRobin()\n            }\n        }\n        if roundRobinNextId == roundRobinMaxId {\n            roundRobinNextId = 0\n        }\n        roundRobinNextId++\n        _, ok := roundRobin[roundRobinNextId]\n        if ok {\n            break\n        }\n    }\n    return roundRobinNextId\n}\n</code></pre>\n\n<p>If response from proxy was bad - server will be deleted by this function.\nIf count of servers get 5 - list of proxy will be reinit.</p>\n\n<pre><code>func deleteRoundRobinId(roundRobinId int, result string) {\n    db.Exec(\"update proxies set status = 0, response =? where id=?\", result, roundRobinId)\n    delete(roundRobin, roundRobinId)\n    failedRequestCount++\n    if failedRequestCount == 5 {\n        initRoundRobin()\n    }\n}\n</code></pre>\n\n<p>I run this script on 10 terminals. Some time later most of them crashed with this error:</p>\n\n<pre><code>database/sql.(*Stmt).Exec(0x0, 0xc20842be38, 0x5, 0x5, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/database/sql/sql.go:1302 +0x3e1\nmain.cache(0xc2082f0690, 0x23, 0x355910, 0x9, 0x12775b, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /var/go/src/parser/index.go:148 +0x702\nmain.main()\n    /var/go/src/parser/index.go:31 +0x26c\n\ngoroutine 5 [chan receive, 213 minutes]:\ndatabase/sql.(*DB).connectionOpener(0xc2080446e0)\n    /usr/local/go/src/database/sql/sql.go:589 +0x4c\ncreated by database/sql.Open\n    /usr/local/go/src/database/sql/sql.go:452 +0x31c\n\ngoroutine 17 [syscall, 213 minutes, locked to thread]:\nruntime.goexit()\n    /usr/local/go/src/runtime/asm_amd64.s:2232 +0x1\n\ngoroutine 10854 [IO wait]:\nnet.(*pollDesc).Wait(0xc2081f2990, 0x72, 0x0, 0x0)\n    /usr/local/go/src/net/fd_poll_runtime.go:84 +0x47\nnet.(*pollDesc).WaitRead(0xc2081f2990, 0x0, 0x0)\n    /usr/local/go/src/net/fd_poll_runtime.go:89 +0x43\nnet.(*netFD).Read(0xc2081f2930, 0xc20844e800, 0x400, 0x400, 0x0, 0x584b70, 0xc2081f7ae8)\n    /usr/local/go/src/net/fd_unix.go:242 +0x40f\nnet.(*conn).Read(0xc208038390, 0xc20844e800, 0x400, 0x400, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/net.go:121 +0xdc\ncrypto/tls.(*block).readFromUntil(0xc20857dfb0, 0x5860a8, 0xc208038390, 0x5, 0x0, 0x0)\n    /usr/local/go/src/crypto/tls/conn.go:454 +0xe6\ncrypto/tls.(*Conn).readRecord(0xc208484b00, 0x17, 0x0, 0x0)\n    /usr/local/go/src/crypto/tls/conn.go:539 +0x2da\ncrypto/tls.(*Conn).Read(0xc208484b00, 0xc20834e000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /usr/local/go/src/crypto/tls/conn.go:904 +0x166\nnet/http.noteEOFReader.Read(0x58c488, 0xc208484b00, 0xc208263398, 0xc20834e000, 0x1000, 0x1000, 0x2a0300, 0x0, 0x0)\n    /usr/local/go/src/net/http/transport.go:1270 +0x6e\nnet/http.(*noteEOFReader).Read(0xc2082a4460, 0xc20834e000, 0x1000, 0x1000, 0xc208012000, 0x0, 0x0)\n    &lt;autogenerated&gt;:125 +0xd4\nbufio.(*Reader).fill(0xc2080fc060)\n    /usr/local/go/src/bufio/bufio.go:97 +0x1ce\nbufio.(*Reader).Peek(0xc2080fc060, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/bufio/bufio.go:132 +0xf0\nnet/http.(*persistConn).readLoop(0xc208263340)\n    /usr/local/go/src/net/http/transport.go:842 +0xa4\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:660 +0xc9f\n\ngoroutine 10863 [select]:\nnet/http.(*persistConn).writeLoop(0xc208263ad0)\n    /usr/local/go/src/net/http/transport.go:945 +0x41d\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:661 +0xcbc\n\ngoroutine 10855 [select]:\nnet/http.(*persistConn).writeLoop(0xc208263340)\n    /usr/local/go/src/net/http/transport.go:945 +0x41d\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:661 +0xcbc\n\ngoroutine 10862 [IO wait]:\nnet.(*pollDesc).Wait(0xc208010b50, 0x72, 0x0, 0x0)\n    /usr/local/go/src/net/fd_poll_runtime.go:84 +0x47\nnet.(*pollDesc).WaitRead(0xc208010b50, 0x0, 0x0)\n    /usr/local/go/src/net/fd_poll_runtime.go:89 +0x43\nnet.(*netFD).Read(0xc208010af0, 0xc20852c800, 0x400, 0x400, 0x0, 0x584b70, 0xc2081af168)\n    /usr/local/go/src/net/fd_unix.go:242 +0x40f\nnet.(*conn).Read(0xc208038488, 0xc20852c800, 0x400, 0x400, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/net.go:121 +0xdc\ncrypto/tls.(*block).readFromUntil(0xc2085597a0, 0x5860a8, 0xc208038488, 0x5, 0x0, 0x0)\n    /usr/local/go/src/crypto/tls/conn.go:454 +0xe6\ncrypto/tls.(*Conn).readRecord(0xc2084858c0, 0x17, 0x0, 0x0)\n    /usr/local/go/src/crypto/tls/conn.go:539 +0x2da\ncrypto/tls.(*Conn).Read(0xc2084858c0, 0xc208415000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /usr/local/go/src/crypto/tls/conn.go:904 +0x166\nnet/http.noteEOFReader.Read(0x58c488, 0xc2084858c0, 0xc208263b28, 0xc208415000, 0x1000, 0x1000, 0x2a0300, 0x0, 0x0)\n    /usr/local/go/src/net/http/transport.go:1270 +0x6e\nnet/http.(*noteEOFReader).Read(0xc20825bce0, 0xc208415000, 0x1000, 0x1000, 0xc208012000, 0x0, 0x0)\n    &lt;autogenerated&gt;:125 +0xd4\nbufio.(*Reader).fill(0xc2080fd740)\n    /usr/local/go/src/bufio/bufio.go:97 +0x1ce\nbufio.(*Reader).Peek(0xc2080fd740, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/bufio/bufio.go:132 +0xf0\nnet/http.(*persistConn).readLoop(0xc208263ad0)\n    /usr/local/go/src/net/http/transport.go:842 +0xa4\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:660 +0xc9f\n\ngoroutine 10867 [select]:\nnet/http.(*persistConn).writeLoop(0xc208263ef0)\n    /usr/local/go/src/net/http/transport.go:945 +0x41d\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:661 +0xcbc\n\ngoroutine 10866 [IO wait]:\nnet.(*pollDesc).Wait(0xc2084be1b0, 0x72, 0x0, 0x0)\n    /usr/local/go/src/net/fd_poll_runtime.go:84 +0x47\nnet.(*pollDesc).WaitRead(0xc2084be1b0, 0x0, 0x0)\n    /usr/local/go/src/net/fd_poll_runtime.go:89 +0x43\nnet.(*netFD).Read(0xc2084be150, 0xc208465000, 0x1000, 0x1000, 0x0, 0x584b70, 0xc2081602f0)\n    /usr/local/go/src/net/fd_unix.go:242 +0x40f\nnet.(*conn).Read(0xc208038540, 0xc208465000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/net.go:121 +0xdc\ncrypto/tls.(*block).readFromUntil(0xc2080cc180, 0x5860a8, 0xc208038540, 0x5, 0x0, 0x0)\n    /usr/local/go/src/crypto/tls/conn.go:454 +0xe6\ncrypto/tls.(*Conn).readRecord(0xc2082cc000, 0x17, 0x0, 0x0)\n    /usr/local/go/src/crypto/tls/conn.go:539 +0x2da\ncrypto/tls.(*Conn).Read(0xc2082cc000, 0xc2082cf000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /usr/local/go/src/crypto/tls/conn.go:904 +0x166\nnet/http.noteEOFReader.Read(0x58c488, 0xc2082cc000, 0xc208263f48, 0xc2082cf000, 0x1000, 0x1000, 0x2a0300, 0x0, 0x0)\n    /usr/local/go/src/net/http/transport.go:1270 +0x6e\nnet/http.(*noteEOFReader).Read(0xc20820ed60, 0xc2082cf000, 0x1000, 0x1000, 0xc208012000, 0x0, 0x0)\n    &lt;autogenerated&gt;:125 +0xd4\nbufio.(*Reader).fill(0xc208326240)\n    /usr/local/go/src/bufio/bufio.go:97 +0x1ce\nbufio.(*Reader).Peek(0xc208326240, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/bufio/bufio.go:132 +0xf0\nnet/http.(*persistConn).readLoop(0xc208263ef0)\n    /usr/local/go/src/net/http/transport.go:842 +0xa4\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:660 +0xc9f\n\ngoroutine 10859 [select]:\nnet/http.(*persistConn).writeLoop(0xc208263760)\n    /usr/local/go/src/net/http/transport.go:945 +0x41d\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:661 +0xcbc\n\ngoroutine 10858 [IO wait]:\nnet.(*pollDesc).Wait(0xc2081f3790, 0x72, 0x0, 0x0)\n    /usr/local/go/src/net/fd_poll_runtime.go:84 +0x47\nnet.(*pollDesc).WaitRead(0xc2081f3790, 0x0, 0x0)\n    /usr/local/go/src/net/fd_poll_runtime.go:89 +0x43\nnet.(*netFD).Read(0xc2081f3730, 0xc208418000, 0x1000, 0x1000, 0x0, 0x584b70, 0xc2081c53e8)\n    /usr/local/go/src/net/fd_unix.go:242 +0x40f\nnet.(*conn).Read(0xc208038400, 0xc208418000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/net.go:121 +0xdc\ncrypto/tls.(*block).readFromUntil(0xc208458510, 0x5860a8, 0xc208038400, 0x5, 0x0, 0x0)\n    /usr/local/go/src/crypto/tls/conn.go:454 +0xe6\ncrypto/tls.(*Conn).readRecord(0xc208485340, 0x17, 0x0, 0x0)\n    /usr/local/go/src/crypto/tls/conn.go:539 +0x2da\ncrypto/tls.(*Conn).Read(0xc208485340, 0xc2082f6000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /usr/local/go/src/crypto/tls/conn.go:904 +0x166\nnet/http.noteEOFReader.Read(0x58c488, 0xc208485340, 0xc2082637b8, 0xc2082f6000, 0x1000, 0x1000, 0x2a0300, 0x0, 0x0)\n    /usr/local/go/src/net/http/transport.go:1270 +0x6e\nnet/http.(*noteEOFReader).Read(0xc20827a1a0, 0xc2082f6000, 0x1000, 0x1000, 0xc208012000, 0x0, 0x0)\n    &lt;autogenerated&gt;:125 +0xd4\nbufio.(*Reader).fill(0xc2080fcc00)\n    /usr/local/go/src/bufio/bufio.go:97 +0x1ce\nbufio.(*Reader).Peek(0xc2080fcc00, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/bufio/bufio.go:132 +0xf0\nnet/http.(*persistConn).readLoop(0xc208263760)\n    /usr/local/go/src/net/http/transport.go:842 +0xa4\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:660 +0xc9f\nexit status 2\n</code></pre>\n\n<p>What it can be and how I can fix it?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["time", "go"], "comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1438330888, "post_id": 31741172, "comment_id": 51416785, "body": "I have no such behaviour on windows machine. Maybe it&#39;s a bug on unix machines, cause for example using of time comparsion in time.Sleep function"}], "answers": [{"comments": [{"owner": {"reputation": 9443, "user_id": 1099240, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/dd46278adf767d035fe304addad99151?s=128&d=identicon&r=PG", "display_name": "Dmitry Frank", "link": "https://stackoverflow.com/users/1099240/dmitry-frank"}, "edited": false, "score": 0, "creation_date": 1472122554, "post_id": 31741655, "comment_id": 65630821, "body": "But this isn&#39;t true, or do I miss something? Here are docs for <code>time.Sleep</code>: ( <a href=\"https://golang.org/pkg/time/#Sleep\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Sleep</a> ) <i>Sleep pauses the current goroutine for at least the duration d. A negative or zero duration causes Sleep to return immediately</i>"}, {"owner": {"reputation": 9443, "user_id": 1099240, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/dd46278adf767d035fe304addad99151?s=128&d=identicon&r=PG", "display_name": "Dmitry Frank", "link": "https://stackoverflow.com/users/1099240/dmitry-frank"}, "edited": false, "score": 0, "creation_date": 1472123303, "post_id": 31741655, "comment_id": 65631280, "body": "I verified and <code>time.Sleep(1 * time.Second)</code> indeed puts my goroutine to sleep for 1 second."}, {"owner": {"reputation": 15557, "user_id": 390807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f64fce01ffa86130c3fae06b1fcadef?s=128&d=identicon&r=PG", "display_name": "chill", "link": "https://stackoverflow.com/users/390807/chill"}, "edited": false, "score": 0, "creation_date": 1472130436, "post_id": 31741655, "comment_id": 65636139, "body": "This the <code>time.Sleep</code> interface; I said <b>internally</b> the interface is implemented with absolute timeout, see <a href=\"https://golang.org/src/runtime/time.go#L54\" rel=\"nofollow noreferrer\">golang.org/src/runtime/time.go#L54</a>"}], "tags": [], "owner": {"reputation": 15557, "user_id": 390807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f64fce01ffa86130c3fae06b1fcadef?s=128&d=identicon&r=PG", "display_name": "chill", "link": "https://stackoverflow.com/users/390807/chill"}, "is_accepted": true, "score": 12, "last_activity_date": 1472132501, "last_edit_date": 1472132501, "creation_date": 1438331718, "answer_id": 31741655, "question_id": 31741172, "link": "https://stackoverflow.com/questions/31741172/golang-time-sleep-bug/31741655#31741655", "title": "golang time.Sleep bug?", "body": "<p>Internally sleep is done with absolute time: if you call <code>Sleep(n)</code> at time <code>T</code> the program is scheduled not to wake up <strong>after</strong> <code>n</code> time, but <strong>at</strong> time <code>T + n</code>. </p>\n\n<p>This is generally preferable because:</p>\n\n<ul>\n<li><p>time usually does not flow backwards</p></li>\n<li><p>due to OS scheduling delays a program which repeatedly sleeps may lag behind schedule indefinitely; using absolute time make it compensate for delays by sleeping for shorter intervals.</p></li>\n</ul>\n\n<p>In your case, you just have to wait for a day for the program to start printing again. :D</p>\n\n<p>Or set a time just a little in the past (say 15 sec), and see the program resuming after 15+2 sec.</p>\n\n<p>PS. To clarify what happens with an example:</p>\n\n<p>At 2016-08-25 16:27:12 the program calls <code>time.Sleep(2 * time.Second)</code>\nThe Go runtime schedules the goroutine to be woken up on 2016-08-25 at 16:27:14 and puts the goroutine to sleep</p>\n\n<p>meanwhile ...</p>\n\n<p>the user sets the system time to 2016-08-<strong>24</strong> 16:27:13</p>\n\n<p>now the timeout is scheduled to expire one day and one second later.</p>\n\n<p>This should not happen on systems, on which Go uses POSIX CLOCK_MONOTONIC or equivalent thereof.</p>\n"}], "owner": {"reputation": 83, "user_id": 2139281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf51b9304c2491797d704b7022c5f30a?s=128&d=identicon&r=PG", "display_name": "user2139281", "link": "https://stackoverflow.com/users/2139281/user2139281"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18229, "favorite_count": 3, "accepted_answer_id": 31741655, "answer_count": 1, "score": 8, "last_activity_date": 1472132501, "creation_date": 1438330014, "question_id": 31741172, "link": "https://stackoverflow.com/questions/31741172/golang-time-sleep-bug", "title": "golang time.Sleep bug?", "body": "<p>I make test code below(gotest.go)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"sync\"\n)        \n\nfunc main() {\n    var wg sync.WaitGroup\n    wg.Add(1)\n    go testa()    \n\n    wg.Wait()\n}\n\nfunc testa() {\n    for {\n        fmt.Println(\"test goroutine\")\n        time.Sleep(2 * time.Second)\n    }\n}\n</code></pre>\n\n<p>console</p>\n\n<pre><code>go run gotest.go\n</code></pre>\n\n<p>and, change my computer's date \n(ex : 2015-07-30 -> 2015-07-29)</p>\n\n<p>and then, \nprintln not printed!!</p>\n\n<p>is it bug??</p>\n\n<p>(It is working to set next day)</p>\n\n<p>I use MacOs latest ver.\nThank you. </p>\n"}, {"tags": ["http", "go", "server"], "comments": [{"owner": {"reputation": 1229, "user_id": 1316499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b4c6fd1a383d486b48c254b6d5a480c?s=128&d=identicon&r=PG", "display_name": "Astockwell", "link": "https://stackoverflow.com/users/1316499/astockwell"}, "edited": false, "score": 0, "creation_date": 1438319295, "post_id": 31738356, "comment_id": 51411469, "body": "ListenAndServe spawns goroutines, what platform/os are you testing on?"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 1, "creation_date": 1438324932, "post_id": 31738356, "comment_id": 51413499, "body": "how long you wait before start another Listen at same port? OS need time to use the port again."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 3, "creation_date": 1438336883, "post_id": 31738356, "comment_id": 51420337, "body": "There&#39;s also <code>httptest.NewServer</code> for creating a test server: <a href=\"http://golang.org/pkg/net/http/httptest/#Server\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/httptest/#Server</a>"}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1438344063, "post_id": 31738356, "comment_id": 51424710, "body": "The port is probably in the linger state"}, {"owner": {"reputation": 735, "user_id": 2536700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/2ac04fd32567ed44ddeaca257bcd6806?s=128&d=identicon&r=PG", "display_name": "Chris W", "link": "https://stackoverflow.com/users/2536700/chris-w"}, "reply_to_user": {"reputation": 1229, "user_id": 1316499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b4c6fd1a383d486b48c254b6d5a480c?s=128&d=identicon&r=PG", "display_name": "Astockwell", "link": "https://stackoverflow.com/users/1316499/astockwell"}, "edited": false, "score": 0, "creation_date": 1438362021, "post_id": 31738356, "comment_id": 51436479, "body": "@Astockwell I&#39;m testing on osx yosemite."}, {"owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "edited": false, "score": 0, "creation_date": 1476697065, "post_id": 31738356, "comment_id": 67438568, "body": "i have the exact same problem, sometimes the ipv6 listener still running when using <code>go run</code>"}], "answers": [{"tags": [], "owner": {"reputation": 410, "user_id": 3338740, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wHA9F.jpg?s=128&g=1", "display_name": "ellimist", "link": "https://stackoverflow.com/users/3338740/ellimist"}, "is_accepted": false, "score": 0, "last_activity_date": 1527252455, "creation_date": 1527252455, "answer_id": 50529620, "question_id": 31738356, "link": "https://stackoverflow.com/questions/31738356/port-doesnt-close-when-i-run-listenandserve-in-a-test-function-how-do-i-fix/50529620#50529620", "title": "Port doesn&#39;t close when I run ListenAndServe() in a test function, how do I fix this?", "body": "<p>You can use <a href=\"https://golang.org/pkg/net/http/httptest/#NewUnstartedServer\" rel=\"nofollow noreferrer\">NewUnstartedServer</a> to create a instance, start it manually then defer closing it at the end of the test. Something along the lines:</p>\n\n<pre><code>...\nts := httptest.NewUnstartedServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {  \n    fmt.Fprintln(w, \"Hello world\")\n}))\n\nl, _ := net.Listen(\"tcp\", URL)\nts.Listener = l\nts.Start()\ndefer ts.Close()\n\nres, err := http.Get(URL)  \nif err != nil {\n  log.Fatal(err)\n} \n...\n</code></pre>\n"}], "owner": {"reputation": 735, "user_id": 2536700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/2ac04fd32567ed44ddeaca257bcd6806?s=128&d=identicon&r=PG", "display_name": "Chris W", "link": "https://stackoverflow.com/users/2536700/chris-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 909, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1527252455, "creation_date": 1438318665, "last_edit_date": 1491976398, "question_id": 31738356, "link": "https://stackoverflow.com/questions/31738356/port-doesnt-close-when-i-run-listenandserve-in-a-test-function-how-do-i-fix", "title": "Port doesn&#39;t close when I run ListenAndServe() in a test function, how do I fix this?", "body": "<p>When I call http.ListenAndServe() in a test function the port does NOT close even after the tests have finished and the process has terminated. So the next time I run the tests I get the error \"ListenAndServe: listen tcp :8080: bind: address already in use\".</p>\n\n<p>This does not happen when I run my program normally through main(). </p>\n\n<pre><code>func TestIndex(t *testing.T) {\n  handle := handlers.ServeAndHandle(\"8080\")\n  req, _ := http.NewRequest(\"GET\", \"\", nil)\n  w := httptest.NewRecorder()\n  handle.ServeHTTP(w, req)\n  if w.Code != http.StatusOK {\n      t.Errorf(\"Home page didn't return %v\", http.StatusOK)\n  }\n}\n// this is just a wrapper function of ListenAndServe. m is of type handler\nfunc ServeAndHandle(port string) http.Handler {\n  m := &amp;mux{}\n  err := http.ListenAndServe(\":\"+port, m) // set listen port\n  if err != nil {\n      log.Fatal(\"ListenAndServe: \", err)\n  }\n  return m\n}\n</code></pre>\n"}, {"tags": ["javascript", "json", "angularjs", "go"], "comments": [{"owner": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "edited": false, "score": 0, "creation_date": 1438313241, "post_id": 31737275, "comment_id": 51409974, "body": "What does the <code>.Name()</code> function do? Is this part of Gorilla mux? Could not find documentation on it"}, {"owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "reply_to_user": {"reputation": 10232, "user_id": 2104976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1a5168ce005df0148523b929ea9983c0?s=128&d=identicon&r=PG", "display_name": "callmekatootie", "link": "https://stackoverflow.com/users/2104976/callmekatootie"}, "edited": false, "score": 0, "creation_date": 1438313474, "post_id": 31737275, "comment_id": 51410030, "body": "Yes, it&#39;s part of Gorilla mux. It can be found <a href=\"http://www.gorillatoolkit.org/pkg/mux#Route.Name\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 208, "user_id": 3056562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc137a5994f4c680470b62df6a4a4ed9?s=128&d=identicon&r=PG", "display_name": "mission.liao", "link": "https://stackoverflow.com/users/3056562/mission-liao"}, "edited": false, "score": 0, "creation_date": 1438315534, "post_id": 31737275, "comment_id": 51410508, "body": "If my understanding is clear, you need 2 path for that (or different http-method), one for returning your template, another for raw-json."}, {"owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "reply_to_user": {"reputation": 208, "user_id": 3056562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc137a5994f4c680470b62df6a4a4ed9?s=128&d=identicon&r=PG", "display_name": "mission.liao", "link": "https://stackoverflow.com/users/3056562/mission-liao"}, "edited": false, "score": 0, "creation_date": 1438316001, "post_id": 31737275, "comment_id": 51410640, "body": "@mission.liao How should I go about doing that? Which path should I point to for my JSON response?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1438317683, "post_id": 31737275, "comment_id": 51411046, "body": "Your routes are matched top-down, so the JSON handler never gets called because <code>&#47;verify</code> is already matched. You can either change the route to something else - like <code>&#47;verify.json</code> or have a single route and look at the client&#39;s <code>Accept-Encoding</code> header. If they send a header strictly with <code>application&#47;json</code> serve JSON."}], "owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1438310605, "creation_date": 1438310605, "question_id": 31737275, "link": "https://stackoverflow.com/questions/31737275/issue-with-json-response", "title": "Issue with JSON response", "body": "<p>I'm fairly new with working with Golang and I came across an issue when trying to send back a JSON response. </p>\n\n<p>My main.go code looks something like this:</p>\n\n<pre><code>import (\n\"github.com/gorilla/mux\"\n\"github.com/justinas/alice\"\n) \n\nmx.Handle(\"/verify\", commonHandlers.ThenFunc(controller.VerifyHandler)).Methods(\"GET\").Name(\"verify\") // Used to display verify.html\nmx.Handle(\"/verify\", commonHandlers.ThenFunc(verifyUser)).Methods(\"GET\") // I'm actually not certain if I can call 2 different function handlers on the same URL\n</code></pre>\n\n<p>My verifyHandler calls RenderTemplates, which looks something like this:</p>\n\n<pre><code>func RenderTemplates(w http.ResponseWriter, r *http.Request, name string) {\n    f, err := os.Open(\"./templates/\" + name)\n    check(err)\n    defer f.Close()\n    buf, err := ioutil.ReadAll(f)\n    check(err)\n    fmt.Fprintf(w, string(buf))\n}\n</code></pre>\n\n<p>RenderTemplates is used to display my verify.html page</p>\n\n<p>Then I have the verifyUser function handler which sends back a JSON formatted response, which looks something like this: </p>\n\n<pre><code>response := generateResponse(\"Message goes here\", false)\n            res, err := json.Marshal(response)\n            if err != nil {\n                http.Error(w, err.Error(), http.StatusInternalServerError)\n                return\n            }\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            w.Write(res)\n</code></pre>\n\n<p>Then I have my AngularJS controller to make the request:</p>\n\n<pre><code>app.controller(\"verifyControl\", ['$scope', '$http', function($scope, $http) {\n    $scope.message = \"\";\n    $http({\n      method: 'GET',\n      url: \"/verify\"\n      }).success(function(data) {\n       $scope.message = data.msg;\n       console.log(data);\n\n    });\n\n  }]);\n</code></pre>\n\n<p>The issue is the response that I get back from my AngularJS call is not JSON, instead it's the verify.html HTML page, which I assume came from verifyHandler. Is there a solution where I can get the JSON response? </p>\n"}, {"tags": ["command-line", "go", "terminal", "gulp"], "answers": [{"tags": [], "owner": {"reputation": 8503, "user_id": 1946861, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/2ObQs.jpg?s=128&g=1", "display_name": "jlhonora", "link": "https://stackoverflow.com/users/1946861/jlhonora"}, "is_accepted": false, "score": 6, "last_activity_date": 1438309270, "last_edit_date": 1438309270, "creation_date": 1438308817, "answer_id": 31737067, "question_id": 31737047, "link": "https://stackoverflow.com/questions/31737047/run-a-command-line-using-golang/31737067#31737067", "title": "Run a command line using golang?", "body": "<p>Take a look at <a href=\"https://golang.org/pkg/os/exec/#example_Cmd_Output\" rel=\"noreferrer\">exec</a>. For your use case:</p>\n\n<pre><code>package main\nimport (\n    \"net/http\"\n    \"github.com/julienschmidt/httprouter\"\n    \"fmt\"\n    \"os/exec\"\n    \"log\"\n)\n\nfunc main() {\n    out, err := exec.Command(\"gulp\", \"serv.dev\").Output()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"The date is %s\\n\", out)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "is_accepted": true, "score": 17, "last_activity_date": 1438308909, "creation_date": 1438308909, "answer_id": 31737077, "question_id": 31737047, "link": "https://stackoverflow.com/questions/31737047/run-a-command-line-using-golang/31737077#31737077", "title": "Run a command line using golang?", "body": "<p>What you're looking for is <a href=\"https://golang.org/pkg/os/exec/#Command\" rel=\"noreferrer\">exec.Command</a></p>\n\n<p>You'll pretty much want to spawn off a process that will run your <code>gulp</code> task.</p>\n\n<p>This can be done like so:</p>\n\n<pre><code>package main\n\nimport (\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"gulp\", \"serv.dev\")\n    if err := cmd.Run(); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 1, "creation_date": 1438309396, "post_id": 31737083, "comment_id": 51409093, "body": "@SalvadorDali just to note, I didn&#39;t down vote your answer, however it was wrong and would&#39;ve failed, before the edit, if you passed in &quot;gulp serv.dev&quot; as a whole string. The <code>Command</code> function expects a slice of arguments."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 0, "creation_date": 1438309573, "post_id": 31737083, "comment_id": 51409148, "body": "@LeoCorrea I know that it was not you (I already checked your profile and you have too small amount of downvotes). Thanks to Tim, who fixed it before I even have realized that I forgot to pass a parameter."}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 1, "last_activity_date": 1438309275, "last_edit_date": 1438309275, "creation_date": 1438308973, "answer_id": 31737083, "question_id": 31737047, "link": "https://stackoverflow.com/questions/31737047/run-a-command-line-using-golang/31737083#31737083", "title": "Run a command line using golang?", "body": "<p>Most probably you need <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow\">exec package</a></p>\n\n<pre><code>cmd := exec.Command(\"gulp\", \"serv.dev\")\nerr := cmd.Run()\n</code></pre>\n\n<p>Take a look at example at <a href=\"https://golang.org/pkg/os/exec/#Command\" rel=\"nofollow\">exec.Command</a>. They explained how to pass parameters and read the output.</p>\n"}], "owner": {"reputation": 15015, "user_id": 1191635, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/I8bEt.jpg?s=128&g=1", "display_name": "Armeen Harwood", "link": "https://stackoverflow.com/users/1191635/armeen-harwood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12387, "favorite_count": 1, "accepted_answer_id": 31737077, "answer_count": 3, "score": 7, "last_activity_date": 1438309275, "creation_date": 1438308668, "question_id": 31737047, "link": "https://stackoverflow.com/questions/31737047/run-a-command-line-using-golang", "title": "Run a command line using golang?", "body": "<p>I'm just playing around with golang.  I'm curious How could I run a gulpfile task from go?</p>\n\n<p>Gulp task that is run from terminal typical:</p>\n\n<pre><code>gulp serv.dev\n</code></pre>\n\n<p>How could I run this simple line of code from golang:</p>\n\n<pre><code>package main\nimport (\n    \"net/http\"\n    \"github.com/julienschmidt/httprouter\"\n    \"fmt\"\n)\n\nfunc main() {\n    //what do I put here to open terminal in background and run `gulp serv.dev`\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 2, "creation_date": 1438305981, "post_id": 31736681, "comment_id": 51408285, "body": "It looks like you have a proxy configured in your git config."}, {"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 2, "creation_date": 1438306005, "post_id": 31736681, "comment_id": 51408292, "body": "Somehow you&#39;ve managed to resolve gopkg.in to localhost (127.0.0.1)."}, {"owner": {"reputation": 1, "user_id": 5175958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf5266db2b70c20c1fb44f8336d7f1b9?s=128&d=identicon&r=PG&f=1", "display_name": "Keyur P", "link": "https://stackoverflow.com/users/5175958/keyur-p"}, "edited": false, "score": 0, "creation_date": 1438306265, "post_id": 31736681, "comment_id": 51408349, "body": "I unset the proxy config via this command: git config --global --unset core.gitproxy but it seems that the issue persists."}, {"owner": {"reputation": 1900, "user_id": 3211778, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/827e4946bfbf81ecea3e12ef788fcdfb?s=128&d=identicon&r=PG", "display_name": "yanana", "link": "https://stackoverflow.com/users/3211778/yanana"}, "edited": false, "score": 0, "creation_date": 1438307984, "post_id": 31736681, "comment_id": 51408737, "body": "Error log not changing?"}, {"owner": {"reputation": 1, "user_id": 5175958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf5266db2b70c20c1fb44f8336d7f1b9?s=128&d=identicon&r=PG&f=1", "display_name": "Keyur P", "link": "https://stackoverflow.com/users/5175958/keyur-p"}, "edited": false, "score": 0, "creation_date": 1438346724, "post_id": 31736681, "comment_id": 51426506, "body": "There is no http_proxy environment variable after I ran the git config command mentioned above. And the error log remains the same. Thanks"}], "owner": {"reputation": 1, "user_id": 5175958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf5266db2b70c20c1fb44f8336d7f1b9?s=128&d=identicon&r=PG&f=1", "display_name": "Keyur P", "link": "https://stackoverflow.com/users/5175958/keyur-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 469, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1438306838, "creation_date": 1438305849, "last_edit_date": 1438306838, "question_id": 31736681, "link": "https://stackoverflow.com/questions/31736681/golang-not-able-to-install-the-package", "title": "golang: not able to install the package", "body": "<p>I am new to Golang and trying to write a small utility. When I tried to install Go-redis package, it returns me the following error:</p>\n\n<pre><code>go get -d gopkg.in/redis.v3\n# cd .; git clone https://gopkg.in/redis.v3 C:\\Dev\\Projects\\GOWorkspace\\test\\src\\gopkg.in\\redis.v3 Cloning into\n'C:\\Dev\\Projects\\GOWorkspace\\test\\src\\gopkg.in\\redis.v3'... fatal:\nunable to access 'https://gopkg.in/redis.v3/': Failed to connect to\n127.0.0.1 port 1080: Connection refused package gopkg.in/redis.v3: exit status 128\n</code></pre>\n\n<p>Could anyone please help?</p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 3, "creation_date": 1438301684, "post_id": 31736088, "comment_id": 51407324, "body": "Yeah, they aren&#39;t the same; they&#39;re typed. You can explicitly make a <code>[]interface{}</code> but I honestly don&#39;t see that many places (though it&#39;s in some important spots like the signature of <code>fmt.Println</code> and similar functions I guess). You probably want to check out <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">tour.golang.org</a> to get started with Go."}, {"owner": {"reputation": 173, "user_id": 4522316, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b0b89651a0d169ca90f03886183ff399?s=128&d=identicon&r=PG&f=1", "display_name": "codedownforwhat", "link": "https://stackoverflow.com/users/4522316/codedownforwhat"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438302621, "post_id": 31736088, "comment_id": 51407559, "body": "What do you mean by typed? You mean they type (40) int (&quot;name&quot;) string right? I did but i am pretty new to programming so it&#39;s definitely confusing."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1438303006, "post_id": 31736088, "comment_id": 51407649, "body": "Yeah, that kind of type. Do <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">the tour</a> or find Go or introductory programming materials, though--StackOverflow isn&#39;t structured to be a good way to learn programming."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1438305453, "post_id": 31736088, "comment_id": 51408160, "body": "They&#39;re similar enough that <code>a = [20, &quot;tim]</code> is a syntax error in all three languages."}], "answers": [{"comments": [{"owner": {"reputation": 173, "user_id": 4522316, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b0b89651a0d169ca90f03886183ff399?s=128&d=identicon&r=PG&f=1", "display_name": "codedownforwhat", "link": "https://stackoverflow.com/users/4522316/codedownforwhat"}, "edited": false, "score": 0, "creation_date": 1438306229, "post_id": 31736640, "comment_id": 51408340, "body": "Thanks. Will checkout interfaces. I see learning Go makes me look much deeper into programming concepts than with Python and it&#39;s definitely more difficult at first."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438306673, "post_id": 31736640, "comment_id": 51408454, "body": "Might also suggest the tour, or some general introduction to static vs. dynamic typing (but I don&#39;t know where a good one is)."}, {"owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "edited": false, "score": 0, "creation_date": 1438348308, "post_id": 31736640, "comment_id": 51427566, "body": "Click on the Go tag, then click on the &quot;info&quot; tab for a great list of Golang resources."}], "tags": [], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "is_accepted": false, "score": 1, "last_activity_date": 1439396509, "last_edit_date": 1439396509, "creation_date": 1438305484, "answer_id": 31736640, "question_id": 31736088, "link": "https://stackoverflow.com/questions/31736088/do-arrays-function-the-same-way-in-go-as-they-do-in-ruby-or-python/31736640#31736640", "title": "Do Arrays function the same way in Go as they do in Ruby or Python?", "body": "<p>Because Go is a typed language, to create a slice of multiple types in Go, you need to specify a type that multiple types can satisfy. To do this in Go, create a slice of the empty interface (<code>interface{}</code>) such as the following:</p>\n\n<pre><code>a := []interface{}{20, \"tim\"}\nfmt.Println(a)\n</code></pre>\n\n<p>This works because the empty interface is an interface with no methods so all types will match it.</p>\n\n<p>Creating a slice or array of mixed types isn't generally done in Go but this is the way to do it if you need it.</p>\n\n<p>You can read more about interfaces here:</p>\n\n<ul>\n<li><a href=\"http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go\" rel=\"nofollow\">Jordan Orelli's How to use interfaces in Go</a></li>\n<li><a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"nofollow\">Go Language Spec</a></li>\n<li><a href=\"https://golang.org/doc/effective_go.html#interfaces_and_types\" rel=\"nofollow\">Effective Go</a></li>\n</ul>\n"}], "owner": {"reputation": 173, "user_id": 4522316, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b0b89651a0d169ca90f03886183ff399?s=128&d=identicon&r=PG&f=1", "display_name": "codedownforwhat", "link": "https://stackoverflow.com/users/4522316/codedownforwhat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1439396509, "creation_date": 1438301336, "last_edit_date": 1438305928, "question_id": 31736088, "link": "https://stackoverflow.com/questions/31736088/do-arrays-function-the-same-way-in-go-as-they-do-in-ruby-or-python", "title": "Do Arrays function the same way in Go as they do in Ruby or Python?", "body": "<p>In Ruby an array can hold a string or an integer, the same seems true in Javascript and python. But in Go, putting integers and strings together seems difficult, or at least i couldn't figure it out. Is an array able to take both integers and strings within Go in the same way that Python and Ruby can?</p>\n\n<p>Ruby:</p>\n\n<pre><code>a = [20, \"tim\"]\nputs a\n</code></pre>\n\n<p>Python:</p>\n\n<pre><code>a = [20, \"tim\"]\nprint(a)\n</code></pre>\n\n<p>Go:</p>\n\n<pre><code>?\n</code></pre>\n"}, {"tags": ["c", "go", "cgo", "gccgo"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1438304317, "post_id": 31735862, "comment_id": 51407933, "body": "never used gccgo. just go, or gcc + go for inter-operation."}, {"owner": {"reputation": 146, "user_id": 4830567, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TZeL0.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/4830567/jonathan"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1438364266, "post_id": 31735862, "comment_id": 51437685, "body": "Is there a better/different way to compile the go module for linking into a C project? From what I understand, using the go command tends to only compile the runnable binary where go is the entry point to the program and runs C code rather than the other way around. I&#39;ve read other (old) posts mentioning go requiring the go runtime, but obviously this must get packaged into the binary when using go build since it can be run on machines of the same architecture that don&#39;t have go installed, so in at least this use case the necessary runtime components must be contained in the binary."}], "owner": {"reputation": 146, "user_id": 4830567, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TZeL0.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/4830567/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1438646128, "creation_date": 1438299762, "last_edit_date": 1495535209, "question_id": 31735862, "link": "https://stackoverflow.com/questions/31735862/gccgo-error-passing-and-modifying-c-struct-in-go", "title": "Gccgo error passing and modifying C struct in go", "body": "<p>I'm attempting to convert a go library to be called by C and I'm starting with a simple test (based on <a href=\"https://stackoverflow.com/a/15760986/4830567\">an example answering another question</a> I found that worked) file but I'm getting errors when I try to build. I have a struct in C that I'm trying to pass to a go function which uses data from that struct and returns a value (in this case an integer, but eventually it would be another struct).</p>\n\n<p>Go version: 1.4.2</p>\n\n<p>gccgo version: 5.0.1</p>\n\n<p>gcc version: 4.9.2</p>\n\n<p>type.h</p>\n\n<pre><code>typedef struct num {\n    int n;\n} num;\n</code></pre>\n\n<p>foo.go</p>\n\n<pre><code>package main\n\n// #include \"type.h\"\nimport \"C\"\n\nfunc New(x int) C.struct_num {\n    num := C.struct_num{}\n    num.n = C.int(x)\n    return num\n}\n\nfunc Add(num C.struct_num, x int) int {\n    return int(num.n) + x\n}\n</code></pre>\n\n<p>bar.c</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include \"type.h\"\n\nextern num go_new(int) __asm__ (\"example.main.New\");\nextern int go_add(num, int) __asm__ (\"example.main.Add\");\n\nint main() {\n    num n = go_new(2);\n    int x = go_add(n, 3);\n    printf(\"Result: %d\\n\", x);\n}\n</code></pre>\n\n<p>Makefile</p>\n\n<pre><code>all: main\n\nmain: foo.o bar.c\n    gcc foo.o bar.c -o main\n\nfoo.o: foo.go\n    go build -compiler gccgo -gccgoflags '-c -o foo.o -fgo-prefix=example' foo.go\n\nclean:\n    rm -f main *.o\n</code></pre>\n\n<p>When I run make I get the error:</p>\n\n<pre><code>gcc foo.o bar.c -o main\nfoo.o:(.rodata.__go_td_pN23_example.main._Ctype_int[__go_td_pN23_example.main._Ctype_int]+0x18): undefined reference to `__go_type_hash_identity'\nfoo.o:(.rodata.__go_td_pN23_example.main._Ctype_int[__go_td_pN23_example.main._Ctype_int]+0x20): undefined reference to `__go_type_equal_identity'\nfoo.o:(.rodata.__go_tdn_example.main..example_main._Ctype_int+0x18): undefined reference to `__go_type_hash_identity'\nfoo.o:(.rodata.__go_tdn_example.main..example_main._Ctype_int+0x20): undefined reference to `__go_type_equal_identity'\nfoo.o:(.rodata.__go_td_pN30_example.main._Ctype_struct_num[__go_td_pN30_example.main._Ctype_struct_num]+0x18): undefined reference to `__go_type_hash_identity'\nfoo.o:(.rodata.__go_td_pN30_example.main._Ctype_struct_num[__go_td_pN30_example.main._Ctype_struct_num]+0x20): undefined reference to `__go_type_equal_identity'\nfoo.o:(.rodata.__go_tdn_example.main..example_main._Ctype_struct_num+0x18): undefined reference to `__go_type_hash_identity'\nfoo.o:(.rodata.__go_tdn_example.main..example_main._Ctype_struct_num+0x20): undefined reference to `__go_type_equal_identity'\nfoo.o:(.rodata.__go_td_pN24_example.main._Ctype_void[__go_td_pN24_example.main._Ctype_void]+0x18): undefined reference to `__go_type_hash_identity'\nfoo.o:(.rodata.__go_td_pN24_example.main._Ctype_void[__go_td_pN24_example.main._Ctype_void]+0x20): undefined reference to `__go_type_equal_identity'\nfoo.o:(.rodata.__go_tdn_example.main..example_main._Ctype_void+0x18): undefined reference to `__go_type_hash_identity'\nfoo.o:(.rodata.__go_tdn_example.main..example_main._Ctype_void+0x20): undefined reference to `__go_type_equal_identity'\ncollect2: error: ld returned 1 exit status\nMakefile:4: recipe for target 'main' failed\nmake: *** [main] Error 1\n</code></pre>\n\n<p>From what I understand from other searches, these errors relate to the calls made to the C go library, indicating this may not be getting compiled into the object file. I've tried running gccgo directly in the make file as well with the same results. Any insight and/or assistance is appreciated. Thanks.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>I figured this out thanks to <a href=\"https://stackoverflow.com/a/29162383/4830567\">this post</a>. Apparently I needed to call gccgo for main in the Makefile since gcc doesn't know how to properly link the go runtime.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 4, "creation_date": 1438300989, "post_id": 31735589, "comment_id": 51407158, "body": "An <code>io.Reader</code>&#39;s <code>Read</code> method is allowed to return as few bytes as it likes: <code>Read(p []byte) (n int, err error)</code> can return any <code>n</code> such that<code>0 &lt;= n &lt;= len(p)</code>; it&#39;s allowed to use <a href=\"https://www.freebsd.org/cgi/man.cgi?query=pom&amp;sektion=6\" rel=\"nofollow noreferrer\">the phase of the moon</a> to decide how many bytes to return on any given call if it wanted to. You need to check how many bytes get returned (e.g. do <code>line = line[:n]</code> before using it) or if you require a specific amount use something like <a href=\"https://golang.org/pkg/io/#ReadFull\" rel=\"nofollow noreferrer\"><code>io.ReadFull</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 1, "last_activity_date": 1438304535, "creation_date": 1438304535, "answer_id": 31736527, "question_id": 31735589, "link": "https://stackoverflow.com/questions/31735589/when-reading-file-why-readbytes-affect-the-following-read/31736527#31736527", "title": "When reading file, Why ReadBytes affect the following Read?", "body": "<p>Because it designed like this. On read may read any byte count. thinking <code>reader</code> is a interface, and the <code>reader.Read()</code> need satisfy all implement.</p>\n"}], "owner": {"reputation": 1943, "user_id": 579024, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mccLr.jpg?s=128&g=1", "display_name": "Dani-Br", "link": "https://stackoverflow.com/users/579024/dani-br"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1438304535, "creation_date": 1438297894, "last_edit_date": 1438298316, "question_id": 31735589, "link": "https://stackoverflow.com/questions/31735589/when-reading-file-why-readbytes-affect-the-following-read", "title": "When reading file, Why ReadBytes affect the following Read?", "body": "<p>When reading file by chunks, using <code>reader.Read</code>, it reads 32KB for each calling.<br>\nBut if I use <code>reader.ReadBytes</code>, it reduces the number of bytes reads by next <code>reader.Read</code> to 3KB.  </p>\n\n<p>Another question: Why <strong>can't</strong> I read more than 32KB using <code>reader.Read</code> and <code>bufio.NewReaderSize</code> ?  </p>\n\n<p>My Code:  </p>\n\n<pre><code>func SomeFunc () {\n    gzfile , err := os.Open(SomeFile)\n    ErrorPanic (err)\n    input_file , err := gzip.NewReader(gzfile)\n    ErrorPanic (err)\n    // reader := bufio.NewReaderSize(input_file, 120 * 1024 * 1024) //120MB\n    reader := bufio.NewReader(input_file)\n\n    .....\n\n    eof := false\n    for !eof {\n        var n int\n        // line := make ([]byte,100 * 1024 * 1024) //100MB\n        line := make ([]byte,32 * 1024) //32KB\n        n , err = reader.Read (line)\n        eof = is_eof (err)\n        _ , err = buffer.Write (line)\n    /***/ fmt.Println(\"len (line)= \" , len (line) , \" ; n= \",n)\n        line = []byte{}\n        ErrorNotice (err)\n\n        eos := false\n        for !eof &amp;&amp; !eos {\n            line , err = reader.ReadBytes('\\n')\n            eof = is_eof (err)\n\n            if SomeCond {\n                .....\n\n                buffer.Reset()\n                eos = true\n            }\n            _ , err = buffer.Write (line)\n            ErrorNotice (err)\n        }\n    }\n}\n\nfunc ErrorPanic(err error) .....\nfunc ErrorNotice (err error) .....\nfunc is_eof (err error) bool .....\n</code></pre>\n\n<p>The output when calling <code>ReadBytes('\\n')</code>:  </p>\n\n<pre><code>len (line)=  32768  ; n=  32768\nlen (line)=  32768  ; n=  3782\nlen (line)=  32768  ; n=  2966\nlen (line)=  32768  ; n=  2835\nlen (line)=  32768  ; n=  2756\nlen (line)=  32768  ; n=  3513\nlen (line)=  32768  ; n=  2583\nlen (line)=  32768  ; n=  3247\n</code></pre>\n\n<p>The output when <strong>not</strong> calling <code>ReadBytes('\\n')</code>:  </p>\n\n<pre><code>len (line)=  32768  ; n=  32768\nlen (line)=  32768  ; n=  32768\nlen (line)=  32768  ; n=  32768\n</code></pre>\n"}, {"tags": ["multithreading", "go"], "answers": [{"comments": [{"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 0, "creation_date": 1438293957, "post_id": 31734460, "comment_id": 51405087, "body": "So, to be crystal clear, using the log package means threads can never interrupt each other?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 1, "creation_date": 1438294107, "post_id": 31734460, "comment_id": 51405149, "body": "@CoreyOgburn: yes, as long as you are only writing with a single Logger, and not from anywhere else (e.g. any fmt.Printfs might overlap with log lines)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1438292104, "creation_date": 1438292104, "answer_id": 31734460, "question_id": 31734215, "link": "https://stackoverflow.com/questions/31734215/multithreaded-console-output/31734460#31734460", "title": "Multithreaded console output?", "body": "<p>Yes, it's possible, though you won't see any with GOMAXPROCS=1. They will show up when running with more goroutines, larger lines, and more threads. Even more so when writing to stderr, which is unbuffered, since the stdout buffer accepts the short writes fast enough to help prevent interleaving.</p>\n\n<p>This is why the Logger in the \"log\" package has an internal mutex and buffer, to properly serialize the calls.</p>\n"}], "owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 31734460, "answer_count": 1, "score": 3, "last_activity_date": 1438292104, "creation_date": 1438291062, "question_id": 31734215, "link": "https://stackoverflow.com/questions/31734215/multithreaded-console-output", "title": "Multithreaded console output?", "body": "<p>If I have multiple go-routines going and 2 or more of them decide they need to print something out, is it possible for them to interrupt each other?</p>\n\n<p>For example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    go print()\n    print()\n}\n\nfunc print() {\n    for true {\n        fmt.Print(\"ABCDEF\")\n    }\n}\n</code></pre>\n\n<p>Is it possible for one go-routine to start printing (<code>AB</code>) and another go-routine interrupting (<code>ABABCDEF</code>) and the original finishing (<code>ABABCDEFCDEF</code>)?</p>\n\n<p>I've tried running it myself and checking the output and it <em>looks</em> good, but how can I be sure?</p>\n"}, {"tags": ["postgresql", "go", "parameters", "martini"], "comments": [{"owner": {"reputation": 4624, "user_id": 863924, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/J9N3K.jpg?s=128&g=1", "display_name": "km6zla", "link": "https://stackoverflow.com/users/863924/km6zla"}, "edited": false, "score": 0, "creation_date": 1438289795, "post_id": 31733790, "comment_id": 51403193, "body": "Are you willing to rewrite this with a fifth parameter instead of reusing <code>$1</code>?"}, {"owner": {"reputation": 173, "user_id": 5090740, "user_type": "registered", "accept_rate": 20, "profile_image": "https://lh3.googleusercontent.com/-x9RuDz6qe3o/AAAAAAAAAAI/AAAAAAAAHGk/27x4L0Optas/photo.jpg?sz=128", "display_name": "Sam", "link": "https://stackoverflow.com/users/5090740/sam"}, "reply_to_user": {"reputation": 4624, "user_id": 863924, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/J9N3K.jpg?s=128&g=1", "display_name": "km6zla", "link": "https://stackoverflow.com/users/863924/km6zla"}, "edited": false, "score": 0, "creation_date": 1438294887, "post_id": 31733790, "comment_id": 51405410, "body": "Sure but the goal is to try to verify that the html input doesn&#39;t represent a duplicate entry (hence the title)."}], "answers": [{"comments": [{"owner": {"reputation": 2177, "user_id": 4081409, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/nSICy.jpg?s=128&g=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/4081409/jason"}, "edited": false, "score": 11, "creation_date": 1473220081, "post_id": 31734605, "comment_id": 66051144, "body": "FYI: CAST() is also pronounced &quot;::&quot; in PostgreSQL, as in SELECT $1::VARCHAR, $2, ..."}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 23, "last_activity_date": 1438292616, "creation_date": 1438292616, "answer_id": 31734605, "question_id": 31733790, "link": "https://stackoverflow.com/questions/31733790/postgresql-parameter-issue-1/31734605#31734605", "title": "Postgresql Parameter Issue $1", "body": "<p>It is hard to tell exactly what is going on as the database structure is not known. But trying this query in the sqlfiddle shows the following:</p>\n\n<pre><code>create table books (\n  id serial,\n  title varchar\n);\n\nPREPARE booksplan AS\n  INSERT INTO books (title)\n  SELECT $1 WHERE NOT EXISTS (SELECT * FROM books WHERE title = $1);\n\n&gt;&gt; ERROR:  inconsistent types deduced for parameter $1\n&gt;&gt; Detail: text versus character varying Position: 59\n</code></pre>\n\n<p>So I suspect that when the $1 is used for the first time, the text is deduced but the varchar is deduced for the second $1 (as it compared with title, which is varchar).</p>\n\n<p>As workaround you can probably try</p>\n\n<pre><code>_, err := db.Query(`INSERT INTO books (title, first, last, class)\n    SELECT CAST($1 AS VARCHAR), $2, $3, $4\n    WHERE NOT EXISTS (SELECT 1 FROM books WHERE title = $1)`,\n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 5090740, "user_type": "registered", "accept_rate": 20, "profile_image": "https://lh3.googleusercontent.com/-x9RuDz6qe3o/AAAAAAAAAAI/AAAAAAAAHGk/27x4L0Optas/photo.jpg?sz=128", "display_name": "Sam", "link": "https://stackoverflow.com/users/5090740/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6457, "favorite_count": 4, "accepted_answer_id": 31734605, "answer_count": 1, "score": 11, "last_activity_date": 1438292616, "creation_date": 1438289458, "last_edit_date": 1438291316, "question_id": 31733790, "link": "https://stackoverflow.com/questions/31733790/postgresql-parameter-issue-1", "title": "Postgresql Parameter Issue $1", "body": "<p>I am working on setting up a database, building a custom Upsert as Postgresql apparently doesn't have that yet. Anyway my parameters aren't playing nicely. </p>\n\n<p>I am using Martini. </p>\n\n<p>This code:</p>\n\n<pre><code>func CreateBook(ren render.Render, r *http.Request, db *sql.DB) {\n    _, err := db.Query(\"INSERT INTO books (title, first, last, class) SELECT $1, $2, $3, $4 WHERE NOT EXISTS (SELECT * FROM books WHERE title = $1)\",\n    r.FormValue(\"title\"),\n    r.FormValue(\"first\"),\n    r.FormValue(\"last\"),\n    r.FormValue(\"class\"))\n\n    PanicIf(err)\n</code></pre>\n\n<p>Throws this error:</p>\n\n<pre><code>pq: inconsistent types deduced for parameter $1\n</code></pre>\n\n<p>I am fairly certain it's some kind of typecasting issue with the second $1 but none of the rational solutions seem to make sense. </p>\n\n<p>Its a stupid question with hopefully an easy answer but I haven't been able to find any answers anywhere else.</p>\n"}, {"tags": ["go", "bytearray", "sizeof"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1438287794, "post_id": 31733145, "comment_id": 51402097, "body": "Do you want the length, the capacity, or the size in memory? They may all be different."}, {"owner": {"reputation": 349, "user_id": 4651753, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--ox9WCbtwLg/AAAAAAAAAAI/AAAAAAAAB-s/Z0GzoOhBwuI/photo.jpg?sz=128", "display_name": "sr_149", "link": "https://stackoverflow.com/users/4651753/sr-149"}, "edited": false, "score": 0, "creation_date": 1438287953, "post_id": 31733145, "comment_id": 51402195, "body": "No, len gives you the number of objects in an array not the size in terms of bytes of the whole array. I guess  @evanmcdonnal got it right.."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1438288092, "post_id": 31733145, "comment_id": 51402266, "body": "@sr_149: you don&#39;t get the size of the array with <code>binary.Size</code>, you get the <code>length * data_type_size</code>. This may be what you want, but remember the size of the array (capacity) is often different."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438288849, "post_id": 31733145, "comment_id": 51402697, "body": "@JimB that&#39;s false. You&#39;re conflating slice and array, there is no capacity with array and if you were to do a black box comparison of that against the same in C with <code>sizeof</code> it would return to the <code>length * data_type_size</code>. Meaning they are functionally equivalent. see; <a href=\"https://tour.golang.org/moretypes/6\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/6</a> - slice is the next slide."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438289171, "post_id": 31733145, "comment_id": 51402863, "body": "@evanmcdonnal: no I&#39;m not. I chose my words carefully, and the question was about a <i>slice</i> (<code>[]byte</code>), where the capacity is the size of the underlying <i>array</i>; <b>the <i>array</i> pointed to by the field <code>array</code> in the slice struct</b>. The closest equivalent of C&#39;s <code>sizeof</code> would return the entire array&#39;s allocated size, not the portion you were using."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438289465, "post_id": 31733145, "comment_id": 51403032, "body": "@JimB I didn&#39;t read the question as specifying between the two however I guess the syntax used is technically a slice. In most case capacity is probably not the desired value though. If you do want that you should just make your own method that does <code>cap(bytes) * unsafe.Sizeof(bytes[0])</code>"}, {"owner": {"reputation": 349, "user_id": 4651753, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--ox9WCbtwLg/AAAAAAAAAAI/AAAAAAAAB-s/Z0GzoOhBwuI/photo.jpg?sz=128", "display_name": "sr_149", "link": "https://stackoverflow.com/users/4651753/sr-149"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438393459, "post_id": 31733145, "comment_id": 51448243, "body": "JimB and @evanmcdonnal Thank you for the clarification, although the question reads &quot;size of byte array&quot;, the array is the return result of io.ReadFile() api. And I ended up using the binary.Size() api to get the number of bytes read. Would this give me the right values?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439324071, "post_id": 31733145, "comment_id": 51811569, "body": "@sr_149: there&#39;s no reason to do that. Just use <code>len</code> on the returned slice from <code>ioutil.ReadFile</code>, or the <code>n</code> value of <code>io.ReadFull</code> (not sure which you meant, since there is no <code>io.ReadFile</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1438287949, "post_id": 31733209, "comment_id": 51402189, "body": "It&#39;s not just easy to get the size of the slice descriptor with Sizeof,  you <i>only</i> get the size of the descriptor which is always 3 words."}, {"owner": {"reputation": 349, "user_id": 4651753, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--ox9WCbtwLg/AAAAAAAAAAI/AAAAAAAAB-s/Z0GzoOhBwuI/photo.jpg?sz=128", "display_name": "sr_149", "link": "https://stackoverflow.com/users/4651753/sr-149"}, "edited": false, "score": 0, "creation_date": 1438287974, "post_id": 31733209, "comment_id": 51402206, "body": "Thank you! :D shall use the encoding/binary pkg"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438288487, "post_id": 31733209, "comment_id": 51402488, "body": "@JimB yes but the OP might be dealing with a byte array in which case it works; <a href=\"https://play.golang.org/p/UQUcQYC9F3\" rel=\"nofollow noreferrer\">play.golang.org/p/UQUcQYC9F3</a> personally I think the binary package works better because it won&#39;t give you the slice descriptors size but the OP did as for the equivalent of sizeof which is unsafe.Sizeof."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 10, "last_activity_date": 1438289651, "last_edit_date": 1438289651, "creation_date": 1438287371, "answer_id": 31733209, "question_id": 31733145, "link": "https://stackoverflow.com/questions/31733145/size-of-a-byte-array-golang/31733209#31733209", "title": "Size of a byte array golang", "body": "<p>I think your best bet would be;</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"encoding/binary\"\n\nfunc main() {\n    thousandBytes := make([]byte, 1000)\n    tenBytes := make([]byte, 10)\n    fmt.Println(binary.Size(tenBytes))\n    fmt.Println(binary.Size(thousandBytes))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/HhJif66VwY\" rel=\"noreferrer\">https://play.golang.org/p/HhJif66VwY</a></p>\n\n<p>Though there are many options, like just importing unsafe and using sizeof;</p>\n\n<pre><code>import unsafe \"unsafe\"\n\nsize := unsafe.Sizeof(bytes)\n</code></pre>\n\n<p>Note that for some types, like slices, <code>Sizeof</code> is going to give you the size of the slice descriptor which is likely not what you want. Also, bear in mind the length and capacity of the slice are different and the value returned by binary.Size reflects the length.</p>\n"}, {"comments": [{"owner": {"reputation": 349, "user_id": 4651753, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--ox9WCbtwLg/AAAAAAAAAAI/AAAAAAAAB-s/Z0GzoOhBwuI/photo.jpg?sz=128", "display_name": "sr_149", "link": "https://stackoverflow.com/users/4651753/sr-149"}, "edited": false, "score": 0, "creation_date": 1438393499, "post_id": 31736829, "comment_id": 51448251, "body": "Thanks @Caleb, the godoc definitely helped clear things up further!"}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 19, "last_activity_date": 1438306952, "creation_date": 1438306952, "answer_id": 31736829, "question_id": 31733145, "link": "https://stackoverflow.com/questions/31733145/size-of-a-byte-array-golang/31736829#31736829", "title": "Size of a byte array golang", "body": "<p>To return the number of bytes in a byte slice use the <code>len</code> function:</p>\n\n<pre><code>bs := make([]byte, 1000)\nsz := len(bs)\n// sz == 1000\n</code></pre>\n\n<p>If you mean the number of bytes in the underlying array use <code>cap</code> instead:</p>\n\n<pre><code>bs := make([]byte, 1000, 2000)\nsz := cap(bs)\n// sz == 2000\n</code></pre>\n\n<p>A byte is guaranteed to be one byte: <a href=\"https://golang.org/ref/spec#Size_and_alignment_guarantees\" rel=\"noreferrer\">https://golang.org/ref/spec#Size_and_alignment_guarantees</a>.</p>\n"}], "owner": {"reputation": 349, "user_id": 4651753, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--ox9WCbtwLg/AAAAAAAAAAI/AAAAAAAAB-s/Z0GzoOhBwuI/photo.jpg?sz=128", "display_name": "sr_149", "link": "https://stackoverflow.com/users/4651753/sr-149"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47777, "favorite_count": 2, "answer_count": 2, "score": 18, "last_activity_date": 1438306952, "creation_date": 1438287114, "question_id": 31733145, "link": "https://stackoverflow.com/questions/31733145/size-of-a-byte-array-golang", "title": "Size of a byte array golang", "body": "<p>I have a []byte object and I want to get the size of it in bytes. Is there an equivalent to C's sizeof() in golang? If not, Can you suggest other ways to get the same?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 937, "user_id": 2940876, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/3YOFa.jpg?s=128&g=1", "display_name": "alizx", "link": "https://stackoverflow.com/users/2940876/alizx"}, "edited": false, "score": 0, "creation_date": 1438279489, "post_id": 31730762, "comment_id": 51397512, "body": "Can I consider it thread safe by using locks just for modifications the map itself ,not the user structs?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 937, "user_id": 2940876, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/3YOFa.jpg?s=128&g=1", "display_name": "alizx", "link": "https://stackoverflow.com/users/2940876/alizx"}, "edited": false, "score": 0, "creation_date": 1438279828, "post_id": 31730762, "comment_id": 51397687, "body": "Yes, as long as there is no <i>concurrent</i> modification of the User struct."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1438279223, "last_edit_date": 1438279223, "creation_date": 1438278765, "answer_id": 31730762, "question_id": 31730684, "link": "https://stackoverflow.com/questions/31730684/what-does-not-being-thread-safe-means-about-maps-in-go/31730762#31730762", "title": "what does not being thread safe means about maps in Go?", "body": "<p>Concurrently modifying the <code>*User</code> could cause corruption <em>regardless</em> of the <code>map</code>. Reading the pointer from the map concurrently is safe, as long as there are no modifications to the map. Modifying the data <code>*User</code> points to makes no changes to the map itself.</p>\n\n<p>Concurrently modifying the <code>map[int]*User</code> itself also risks data corruption. </p>\n\n<p>There are no benign data races, always test your code with the race detector. </p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1438278794, "creation_date": 1438278794, "answer_id": 31730772, "question_id": 31730684, "link": "https://stackoverflow.com/questions/31730684/what-does-not-being-thread-safe-means-about-maps-in-go/31730772#31730772", "title": "what does not being thread safe means about maps in Go?", "body": "<p>Simplest example;</p>\n\n<pre><code>go WorkerMethodOne(myMapReference)\ngo WorkerMethodTwo(myMapReference)\n</code></pre>\n\n<p>in worker method one I have some code like this (example)</p>\n\n<pre><code>for i := 0; i &lt; len(MyMapReference); i++ {\n    if i % 2 == 0 {\n       delete(MyMapReference, i)\n    }\n}\n</code></pre>\n\n<p>Then when WorkerMethodTwo is iterating that same map and tries to access the item that just got deleted, what happens? While a <code>k, err := map[index]</code> may still be safe, unlike in many languages where you'd throw, it doesn't make sense and is unpredictable. Ultimately worse examples could happen like attempts to concurrently write to the value of some <code>*User</code>. It could cause concurrent modification to the actual value (what's at the pointer), or you could have the pointer pulled our from under you and randomly be working with a value different than what you expected ect. It's really no different than if you made two closures run as goroutines and started modifying a non-atomic <code>int</code> without locking/using a mutex. You don't what's going to happen since there is contention for that memory between two fully decoupled executions.</p>\n"}], "owner": {"reputation": 937, "user_id": 2940876, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/3YOFa.jpg?s=128&g=1", "display_name": "alizx", "link": "https://stackoverflow.com/users/2940876/alizx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 905, "favorite_count": 0, "accepted_answer_id": 31730762, "answer_count": 2, "score": 0, "last_activity_date": 1438279223, "creation_date": 1438278472, "question_id": 31730684, "link": "https://stackoverflow.com/questions/31730684/what-does-not-being-thread-safe-means-about-maps-in-go", "title": "what does not being thread safe means about maps in Go?", "body": "<p>I want to know exactly what could happen when go maps accessed by multiple goroutins lets assume we have a <code>map[int]*User</code>. can modifying fields of User structure  by multiple goroutins cause data corruption ? or just operations like <code>len()</code> are not thread safe what would be different if map was thread safe in Go ?</p>\n"}, {"tags": ["select", "go", "goroutine"], "comments": [{"owner": {"reputation": 208, "user_id": 3056562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc137a5994f4c680470b62df6a4a4ed9?s=128&d=identicon&r=PG", "display_name": "mission.liao", "link": "https://stackoverflow.com/users/3056562/mission-liao"}, "edited": false, "score": 0, "creation_date": 1438278017, "post_id": 31730244, "comment_id": 51396699, "body": "weird, tried to comment/uncomment that line, and both get 2 &#39;State changed!&#39;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1438278024, "post_id": 31730244, "comment_id": 51396703, "body": "Your code works as expected. What version of Go are you using, and what are you setting GOMAXPROC to? If you&#39;re going to have what is essentially a busy loop, you need at least GOMAXPROCS=2 to be able to schedule it reliably."}, {"owner": {"reputation": 1662, "user_id": 4258834, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/LK9Tq.jpg?s=128&g=1", "display_name": "oopcode", "link": "https://stackoverflow.com/users/4258834/oopcode"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438278135, "post_id": 31730244, "comment_id": 51396753, "body": "@JimB Thanks, I will try to change this value at home."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1438278281, "post_id": 31730244, "comment_id": 51396849, "body": "I&#39;m guessing you&#39;re also using an old version of go, since the selects should have provided more preemption points. You could make what you&#39;re currently running more reliable by replacing the 1 nanosecond sleep with a <code>runtime.Gosched()</code>"}, {"owner": {"reputation": 1662, "user_id": 4258834, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/LK9Tq.jpg?s=128&g=1", "display_name": "oopcode", "link": "https://stackoverflow.com/users/4258834/oopcode"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438336121, "post_id": 31730244, "comment_id": 51419859, "body": "@JimB <code>runtime.Gosched()</code> worked perfectly. Thank you again!"}], "owner": {"reputation": 1662, "user_id": 4258834, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/LK9Tq.jpg?s=128&g=1", "display_name": "oopcode", "link": "https://stackoverflow.com/users/4258834/oopcode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 192, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1438276849, "creation_date": 1438276849, "question_id": 31730244, "link": "https://stackoverflow.com/questions/31730244/go-pausing-a-goroutine", "title": "Go: pausing a goroutine", "body": "<p>I have the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    ws := make(chan int)\n    go looper(ws)\n    time.Sleep(3 * time.Second)\n    ws &lt;- 0\n    time.Sleep(3 * time.Second)\n    ws &lt;- 1\n    time.Sleep(3 * time.Second)\n}\n\nfunc looper(ws chan int) {\n    i := 0\n    state := 1\n    for {\n        time.Sleep(1)  // COMMENT OUT?\n        select {\n        case state = &lt;- ws:\n            fmt.Println(\"State changed!\")\n        default:\n            if state == 1 {\n                fmt.Println(\"Current: \", i)\n                i++\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>What I tried to implement: <code>looper()</code> prints and increments <code>i</code> for 3 seconds, then waits 3 seconds, then prints again for 3 seconds. And in fact, this is just what my code does:</p>\n\n<pre><code>Current: 0\n...\nCurrent: X\nState changed!\nState changed!\nCurrent: X + 1\n...\nCurrent: Y\n</code></pre>\n\n<p>My question is: why, if I comment out the <code>time.Sleep(1)</code> inside <code>for</code> loop, the program prints this:</p>\n\n<pre><code>Current: 0\n...\nCurrent: X\nState changed!\n</code></pre>\n\n<p>and then just never quits being stuck in a loop, not even getting to <code>ws &lt;- 1</code>? I don't understand.</p>\n"}, {"tags": ["go", "directory"], "answers": [{"tags": [], "owner": {"reputation": 1641, "user_id": 3828156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/scFYI.jpg?s=128&g=1", "display_name": "chendesheng", "link": "https://stackoverflow.com/users/3828156/chendesheng"}, "is_accepted": false, "score": 1, "last_activity_date": 1438274576, "creation_date": 1438274576, "answer_id": 31729536, "question_id": 31729262, "link": "https://stackoverflow.com/questions/31729262/go-iterate-through-directores-files-in-current-directory/31729536#31729536", "title": "Go - Iterate through directores/files in current directory", "body": "<blockquote>\n  <p>Walk walks the file tree rooted at root, calling walkFn for each file\n  or directory in the tree, <strong>including root.</strong> All errors that arise\n  visiting files and directories are filtered by walkFn. The files are\n  walked in lexical order, which makes the output deterministic but\n  means that for very large directories Walk can be inefficient. Walk\n  does not follow symbolic links.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 689, "user_id": 3403431, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f58796ad71127d05d2087d690409ddb?s=128&d=identicon&r=PG&f=1", "display_name": "chapman", "link": "https://stackoverflow.com/users/3403431/chapman"}, "edited": false, "score": 0, "creation_date": 1438275081, "post_id": 31729558, "comment_id": 51394937, "body": "Hmm, okay thanks. And how would I iterate over the directories? I&#39;m a little new to Go."}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 2, "last_activity_date": 1438276039, "last_edit_date": 1438276039, "creation_date": 1438274656, "answer_id": 31729558, "question_id": 31729262, "link": "https://stackoverflow.com/questions/31729262/go-iterate-through-directores-files-in-current-directory/31729558#31729558", "title": "Go - Iterate through directores/files in current directory", "body": "<p>First, it looks like what you want do to contradicts with the code you have. You wrote:</p>\n\n<blockquote>\n  <p>So I want to say \"search through the directory project\", then it will search through all the files, and only the first level of directories and their files, so if there was another directory with a file inside of docs/, it would ignore it.</p>\n</blockquote>\n\n<p>Does it mean that you want to iterate only two levels of directories (current and one below) and ignore the rest?</p>\n\n<p>If so then you do not need a recursion, just a simple loop that executes search function over the files within the current directory and for every its subdirectory.</p>\n\n<p>The code that you have walks over the filesystem directory subtree.</p>\n\n<p>Basically, <code>filepath.Walk</code> that you use should do it for you. So you either implement recursive walking or use Walk, but not both.</p>\n\n<p>Second, the recursion is implemented incorrectly in your code. It missing iterating over the directories.</p>\n\n<p>So the code that prints the file names in the current directory and its subdirectories (but not further) is:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    items, _ := ioutil.ReadDir(\".\")\n    for _, item := range items {\n        if item.IsDir() {\n            subitems, _ := ioutil.ReadDir(item.Name())\n            for _, subitem := range subitems {\n                if !subitem.IsDir() {\n                    // handle file there\n                    fmt.Println(item.Name() + \"/\" + subitem.Name())\n                }\n            }\n        } else {\n            // handle file there\n            fmt.Println(item.Name())\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 689, "user_id": 3403431, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f58796ad71127d05d2087d690409ddb?s=128&d=identicon&r=PG&f=1", "display_name": "chapman", "link": "https://stackoverflow.com/users/3403431/chapman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4284, "favorite_count": 0, "accepted_answer_id": 31729558, "answer_count": 2, "score": 0, "last_activity_date": 1438276039, "creation_date": 1438273717, "question_id": 31729262, "link": "https://stackoverflow.com/questions/31729262/go-iterate-through-directores-files-in-current-directory", "title": "Go - Iterate through directores/files in current directory", "body": "<p>I have the following structure:</p>\n\n<pre><code>project/\n    docs/\n        index.html\n    root.html\n</code></pre>\n\n<p>I'm trying to iterate through this project structure so that I can read the contents of each file to process them. So I want to say \"search through the directory project\", then it will search through all the files, and only the <strong>first level of directories</strong> and their files, so if there was another directory with a file inside of <code>docs/</code>, it would ignore it. </p>\n\n<p>Currently, I've tried to accomplish this with the \"path/filepath\" library:</p>\n\n<pre><code>func traverse(path string, file os.FileInfo, err error) error {\n    if file, err := os.Open(file.Name()); err == nil {\n        defer file.Close()\n        if fileStat, err := file.Stat(); err == nil {\n            switch mode := fileStat.Mode(); {\n            case mode.IsDir():\n                fmt.Println(\"it be a directory! lets traverse\", file.Name())\n                filepath.Walk(file.Name(), traverse)\n            case mode.IsRegular():\n                fmt.Println(\"the thingy \", file.Name(), \" is a file\")\n            }\n        } else {\n            return errors.New(\"failed to check status\")\n        }\n    }\n    return errors.New(\"failed 2 open file/dir?\")\n}\n</code></pre>\n\n<p>Then I call it from here:</p>\n\n<pre><code>if err := filepath.Walk(\"project/\", traverse); err != nil {\n    setupErr(\"%s\", err)\n}\n</code></pre>\n\n<p>Note that I run this executable relative to my test directory, so it's finding the directory okay. My problem is actually when I run it, I get the following:</p>\n\n<pre><code>it be a directory! lets traverse project\nit be a directory! lets traverse project\n# ^ printed about 20 more times ^\nfailed 2 open file/dir?\n</code></pre>\n\n<p>I think my recursion is a little off, and it's not changing into the directory perhaps? Any ideas, if you need any more information just ask and I'll update.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1438272028, "post_id": 31728656, "comment_id": 51393126, "body": "<a href=\"http://golang.org/doc/faq#nil_error\" rel=\"nofollow noreferrer\">golang.org/doc/faq#nil_error</a>"}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 4957438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f05cbb8a908ef71d0516bba78ba6b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron Alpar", "link": "https://stackoverflow.com/users/4957438/aaron-alpar"}, "edited": false, "score": 0, "creation_date": 1438289258, "post_id": 31728730, "comment_id": 51402915, "body": "Is there a generic non-interface pointer type that both objects can be cast to for the purpose of comparison?"}], "tags": [], "owner": {"reputation": 15557, "user_id": 390807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f64fce01ffa86130c3fae06b1fcadef?s=128&d=identicon&r=PG", "display_name": "chill", "link": "https://stackoverflow.com/users/390807/chill"}, "is_accepted": false, "score": 2, "last_activity_date": 1438273504, "last_edit_date": 1438273504, "creation_date": 1438272109, "answer_id": 31728730, "question_id": 31728656, "link": "https://stackoverflow.com/questions/31728656/why-is-err-nil/31728730#31728730", "title": "Why is &quot;err != nil&quot;?", "body": "<p>For an interface value (like an <code>error</code> value) to compare equal to <code>nil</code>, both the actual contained value and the actual contained type have to be <code>nil</code>. In your case you have an interface value, which holds a <code>nil</code> pointer, but a <code>*TestError</code> (i.e. non-<code>nil</code>) type.</p>\n\n<p>PS. Just in case it's not clear what are these \"interface values\", you can check this <a href=\"http://research.swtch.com/interfaces\" rel=\"nofollow\">http://research.swtch.com/interfaces</a></p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1438272177, "creation_date": 1438272177, "answer_id": 31728755, "question_id": 31728656, "link": "https://stackoverflow.com/questions/31728656/why-is-err-nil/31728755#31728755", "title": "Why is &quot;err != nil&quot;?", "body": "<p>In the second case you're printing the interface instances information which is the type and the value, type being <code>(*main.TestError)</code> value being <code>(nil)</code>. In the first case what you're actually comparing isn't <code>nil</code> because it's also the interface.</p>\n"}], "owner": {"reputation": 87, "user_id": 4957438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f05cbb8a908ef71d0516bba78ba6b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron Alpar", "link": "https://stackoverflow.com/users/4957438/aaron-alpar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 722, "favorite_count": 1, "closed_date": 1438289470, "answer_count": 2, "score": -1, "last_activity_date": 1438273504, "creation_date": 1438271874, "question_id": 31728656, "link": "https://stackoverflow.com/questions/31728656/why-is-err-nil", "closed_reason": "Duplicate", "title": "Why is &quot;err != nil&quot;?", "body": "<p>I have a situation where the value of a variable \"err error\" value can only be \"nil\" but asserts \"( err == nil ) == false\" once it has been reassigned.</p>\n\n<p>Example code below:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n)\n\ntype TestError struct {\n    Message string\n}\n\nfunc (e *TestError) Error() string {\n    return e.Message\n}\n\nfunc NewTestError(err error) *TestError {\n    if err == nil {\n            return nil\n    }\n    log.Printf(\"NewTestError( ... ): creating new NewTestError err = %s\", err)\n    return &amp;TestError{Message: err.Error()}\n}\n\nfunc main() {\n    var err error\n    _, err = fmt.Printf(\"excuse.\\n\")\n    err = NewTestError(err)\n    log.Printf(\"main( ... ): err == nil. %v\", (err == nil))\n    log.Printf(\"main( ... ): err = %#v\", err)\n}\n</code></pre>\n\n<p>I get the following output from the above code:</p>\n\n<pre><code>excuse.\n2015/07/30 08:28:28 main( ... ): err == nil. false\n2015/07/30 08:28:28 main( ... ): err = (*main.TestError)(nil)\n</code></pre>\n\n<p>How can those last two lines be output?</p>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 13318, "user_id": 1221684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54f83137a1e0ee44a266b26d2ff01bc4?s=128&d=identicon&r=PG", "display_name": "JamieD77", "link": "https://stackoverflow.com/users/1221684/jamied77"}, "edited": false, "score": 0, "creation_date": 1438270885, "post_id": 31728010, "comment_id": 51392333, "body": "you cant just check the result count? rows.count() or something?"}, {"owner": {"reputation": 13318, "user_id": 1221684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54f83137a1e0ee44a266b26d2ff01bc4?s=128&d=identicon&r=PG", "display_name": "JamieD77", "link": "https://stackoverflow.com/users/1221684/jamied77"}, "edited": false, "score": 3, "creation_date": 1438271354, "post_id": 31728010, "comment_id": 51392652, "body": "i didnt find a way to check count but did find this.. <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/iHrXJj5MX_A\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/iHrXJj5MX_A</a>  mentions setting the length of slice to 0 and it will grow once you append to it"}, {"owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "reply_to_user": {"reputation": 13318, "user_id": 1221684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54f83137a1e0ee44a266b26d2ff01bc4?s=128&d=identicon&r=PG", "display_name": "JamieD77", "link": "https://stackoverflow.com/users/1221684/jamied77"}, "edited": false, "score": 0, "creation_date": 1438278972, "post_id": 31728010, "comment_id": 51397248, "body": "As far as I can tell, that is the right answer. If you add an answer @JamieD77 I&#39;ll accept it."}], "answers": [{"comments": [{"owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "edited": false, "score": 0, "creation_date": 1438270787, "post_id": 31728191, "comment_id": 51392266, "body": "that just returns the count."}], "tags": [], "owner": {"reputation": 175, "user_id": 3159976, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bwZxt.png?s=128&g=1", "display_name": "Naimish Mungara", "link": "https://stackoverflow.com/users/3159976/naimish-mungara"}, "is_accepted": false, "score": -1, "last_activity_date": 1438270683, "creation_date": 1438270683, "answer_id": 31728191, "question_id": 31728010, "link": "https://stackoverflow.com/questions/31728010/get-count-and-result-from-sql-query-in-go/31728191#31728191", "title": "Get count and result from SQL query in Go", "body": "<p>You would used count(*)</p>\n\n<pre><code>SELECT count(distinct last)\nFROM (XYZTable)\nWHERE date(FROM_UNIXTIME(time)) &gt;= '2013-10-28' AND\nid = 90 ;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "edited": false, "score": 0, "creation_date": 1438875114, "post_id": 31728224, "comment_id": 51639330, "body": "Thanks, I didn&#39;t know you could do sub queries. I ended up doing <code>SELECT (select count(*) FROM observations WHERE profile_id=$1 AND year=$2 AND month=$3) as count,  year, month, profile_id, FROM observations WHERE profile_id=$1 AND year=$2 AND month=$3</code>, id, date.Year(), int(date.Month()))`"}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 3, "last_activity_date": 1438271790, "last_edit_date": 1438271790, "creation_date": 1438270770, "answer_id": 31728224, "question_id": 31728010, "link": "https://stackoverflow.com/questions/31728010/get-count-and-result-from-sql-query-in-go/31728224#31728224", "title": "Get count and result from SQL query in Go", "body": "<p>Conceptually, the problem is that the database cursor may not be enumerated to the end so the database does not really know how many records you will get before you actually read all of them. The only way to count (in general case) is to go through all the records in the resultset.</p>\n\n<p>But practically, you can enforce it to do so by using subqueries like</p>\n\n<pre><code>select *, (select count(*) from table) from table\n</code></pre>\n\n<p>and just ignore the second column for records other than first. But it is very rude and I do not recommend doing so.</p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438282408, "post_id": 31728552, "comment_id": 51399223, "body": "Did you miss the part of the question where the OP says they are using PostgreSQL?"}, {"owner": {"reputation": 3539, "user_id": 1054020, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Rn9f9.jpg?s=128&g=1", "display_name": "SoftwareCarpenter", "link": "https://stackoverflow.com/users/1054020/softwarecarpenter"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1438282760, "post_id": 31728552, "comment_id": 51399435, "body": "Actually yes I did since it was tagged as SQL . Ie I am running a query use the database/SQL  in the question. Should I remove my answer?"}], "tags": [], "owner": {"reputation": 3539, "user_id": 1054020, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Rn9f9.jpg?s=128&g=1", "display_name": "SoftwareCarpenter", "link": "https://stackoverflow.com/users/1054020/softwarecarpenter"}, "is_accepted": false, "score": 0, "last_activity_date": 1438271970, "last_edit_date": 1438271970, "creation_date": 1438271583, "answer_id": 31728552, "question_id": 31728010, "link": "https://stackoverflow.com/questions/31728010/get-count-and-result-from-sql-query-in-go/31728552#31728552", "title": "Get count and result from SQL query in Go", "body": "<p>Not sure if this is what you are asking for but you can call the @@Rowcount function to return the count of the previous select statement that has been executed.</p>\n\n<pre><code>SELECT mytable.mycol FROM mytable WHERE mytable.foo = 'bar'\n\nSELECT @@Rowcount\n</code></pre>\n\n<p>If you want the row count included in your result set you can use the the OVER clause (<a href=\"http://msdn.microsoft.com/en-us/library/ms189461.aspx\" rel=\"nofollow\">MSDN</a>)</p>\n\n<pre><code>SELECT mytable.mycol, count(*) OVER(PARTITION BY mytable.foo) AS 'Count' FROM mytable WHERE mytable.foo = 'bar'\n</code></pre>\n\n<p>You could also perhaps just separate two SQL statements with the a ; . This would return a result set of both statements executed.</p>\n"}], "owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4750, "favorite_count": 1, "accepted_answer_id": 31728224, "answer_count": 3, "score": 5, "last_activity_date": 1438330508, "creation_date": 1438270194, "question_id": 31728010, "link": "https://stackoverflow.com/questions/31728010/get-count-and-result-from-sql-query-in-go", "title": "Get count and result from SQL query in Go", "body": "<p>I'm running a pretty straightforward query using the <code>database/sql</code> and <code>lib/pq</code> (postgres) packages and I want to toss the results of some of the fields into a slice, but I need to know how big to make the slice. </p>\n\n<p>The only solution I can find is to do another query that is just <code>SELECT COUNT(*) FROM tableName;</code>. </p>\n\n<p>Is there a way to both get the result of the query AND the count of returned rows in one query? </p>\n"}]