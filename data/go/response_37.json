[{"tags": ["redirect", "curl", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1467248184, "last_edit_date": 1495541305, "creation_date": 1443071837, "answer_id": 32753865, "question_id": 32751065, "link": "https://stackoverflow.com/questions/32751065/go-http-request-with-basic-auth-returning-a-401-instead-of-a-301-redirect/32753865#32753865", "title": "Go HTTP Request with Basic Auth returning a 401 instead of a 301 redirect", "body": "<p>A request to <code>http://aerolith.org/files</code> redirects to <code>https://aerolith.org/files</code> (note change from http to https).  A request to <code>https://aerolith.org/files</code> redirects to <code>https://aerolith.org/files/</code> (note addition of trailing /).</p>\n\n<p>Curl does not follow redirects. Curl prints the 301 status for the redirect from <code>http://aerolith.org/files</code> to <code>https://aerolith.org/files/</code>.</p>\n\n<p>The Go client follows the two redirects to <code>https://aerolith.org/files/</code>. The request to <code>https://aerolith.org/files/</code> returns with status 401 because the Go client does not propagate the authorization header through the redirects.</p>\n\n<p>Requests to <code>https://aerolith.org/files/</code> from the Go client and Curl return status 200. </p>\n\n<p>If you want to follow the redirects and auth successfully, set auth header in a <a href=\"http://godoc.org/net/http#Client.CheckRedirect\" rel=\"nofollow noreferrer\">CheckRedirect</a> function:</p>\n\n<pre><code>cli := &amp;http.Client{\n    CheckRedirect: func(req *http.Request, via []*http.Request) error {\n        if len(via) &gt;= 10 {\n            return errors.New(\"stopped after 10 redirects\")\n        }\n        req.SetBasicAuth(username, password)\n        return nil\n    }}\nresp, err := cli.Do(req)\n</code></pre>\n\n<p>If you want to match what Curl does, use a <a href=\"https://godoc.org/net/http#Transport\" rel=\"nofollow noreferrer\">transport</a> directly. The transport does not follow redirects.</p>\n\n<pre><code>resp, err := http.DefaultTransport.RoundTrip(req)\n</code></pre>\n\n<p>The application can also use the client <a href=\"https://godoc.org/net/http#Client.CheckRedirect\" rel=\"nofollow noreferrer\">CheckRedirect</a> function and a distinguished error to prevent redirects as shown in an answer to <a href=\"https://stackoverflow.com/questions/23297520/how-can-i-make-the-go-http-client-not-follow-redirects-automatically/31296090#31296090\">How Can I Make the Go HTTP Client NOT Follow Redirects Automatically?</a>. This technique seems to be somewhat popular, but is more complicated than using the transport directly.</p>\n\n<pre><code>redirectAttemptedError := errors.New(\"redirect\")\ncli := &amp;http.Client{\n    CheckRedirect: func(req *http.Request, via []*http.Request) error {\n        return redirectAttemptedError\n    }}\nresp, err := cli.Do(req)\nif urlError, ok := err.(*url.Error); ok &amp;&amp; urlError.Err == redirectAttemptedError {\n    // ignore error from check redirect\n    err = nil   \n}\nif err != nil {\n    log.Println(\"Do error\", err)\n}\n</code></pre>\n"}], "owner": {"reputation": 448, "user_id": 1737333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/508a4e2d4b18d033bd0733cbd1b65d7d?s=128&d=identicon&r=PG", "display_name": "Cesar", "link": "https://stackoverflow.com/users/1737333/cesar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2436, "favorite_count": 0, "accepted_answer_id": 32753865, "answer_count": 1, "score": 3, "last_activity_date": 1467248184, "creation_date": 1443050795, "question_id": 32751065, "link": "https://stackoverflow.com/questions/32751065/go-http-request-with-basic-auth-returning-a-401-instead-of-a-301-redirect", "title": "Go HTTP Request with Basic Auth returning a 401 instead of a 301 redirect", "body": "<p>Using Go 1.5.1.</p>\n\n<p>When I try to make a request to a site that automatically redirects to HTTPS using Basic Auth I would expect to get a 301 Redirect response, instead I get a 401.</p>\n\n<pre><code>package main\n\nimport \"net/http\"\nimport \"log\"\n\nfunc main() {\n    url := \"http://aerolith.org/files\"\n    username := \"cesar\"\n    password := \"password\"\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        log.Println(\"error\", err)\n    }\n    if username != \"\" || password != \"\" {\n        req.SetBasicAuth(username, password)\n        log.Println(\"[DEBUG] Set basic auth to\", username, password)\n    }\n    cli := &amp;http.Client{\n\n    }\n    resp, err := cli.Do(req)\n    if err != nil {\n        log.Println(\"Do error\", err)\n    }\n    log.Println(\"[DEBUG] resp.Header\", resp.Header)\n    log.Println(\"[DEBUG] req.Header\", req.Header)\n    log.Println(\"[DEBUG] code\", resp.StatusCode)\n\n}\n</code></pre>\n\n<p>Note that curl returns a 301:</p>\n\n<pre><code>curl -vvv http://aerolith.org/files --user cesar:password\n</code></pre>\n\n<p>Any idea what could be going wrong? </p>\n"}, {"tags": ["syntax", "go"], "answers": [{"tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": false, "score": 1, "last_activity_date": 1443044381, "creation_date": 1443044381, "answer_id": 32749971, "question_id": 32749949, "link": "https://stackoverflow.com/questions/32749949/what-does-empty-function-name-in-go-lang-mean/32749971#32749971", "title": "what does empty function name in go lang mean?", "body": "<p>This isn't an empty function name. This is a type-assertion. It is testing that <code>resp</code> is a <code>NilResponse</code>. If it is, then <code>nilResponse</code> will be true, otherwise it will be false. This code throws away the resulting type-asserted value by using <code>_</code>.</p>\n\n<p>See <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">Type Assertions</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1443044414, "creation_date": 1443044414, "answer_id": 32749976, "question_id": 32749949, "link": "https://stackoverflow.com/questions/32749949/what-does-empty-function-name-in-go-lang-mean/32749976#32749976", "title": "what does empty function name in go lang mean?", "body": "<p>If line two is <code>_, nilresponse := resp.(NilResponse)</code> then it's not a function call at all. It's a type assertion. The code is saying \"the interface value represented by <code>resp</code> is of type <code>NilResponse</code>.</p>\n\n<p>EDIT; your assignment is kind of odd though because the first return value would be the <code>NilResponse</code> object and the second (if specified) is a flag to indicate whether or not it worked (or maybe an error, can't remember if it's a bool or error). So typically it would be something like; <code>nilResponse, ok :=</code> or <code>nilResponse, err :=</code></p>\n"}], "owner": {"reputation": 1201, "user_id": 651028, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6d5887835c21dace586b98180544c74e?s=128&d=identicon&r=PG", "display_name": "Sergei G", "link": "https://stackoverflow.com/users/651028/sergei-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "closed_date": 1443053535, "answer_count": 2, "score": -2, "last_activity_date": 1443044414, "creation_date": 1443044250, "question_id": 32749949, "link": "https://stackoverflow.com/questions/32749949/what-does-empty-function-name-in-go-lang-mean", "closed_reason": "Duplicate", "title": "what does empty function name in go lang mean?", "body": "<p>I am reading this code and I don't quite understand what line #2 does:</p>\n\n<pre><code>resp := route.Handler(req)\n_, nilresponse := resp.(NilResponse)\nif !nilresponse {\n\ntype NilResponse struct {\n}\n</code></pre>\n\n<p>Thank you</p>\n"}, {"tags": ["go", "imap"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1443220089, "post_id": 32748602, "comment_id": 53421902, "body": "Side note, your <code>uid</code> variable is of type <code>uint32</code>, it makes no sense to do <code>string(uid)</code> unless you expect that number to be the value of a single valid Unicode code point (see <a href=\"https://golang.org/ref/spec#Conversions_to_and_from_a_string_type\" rel=\"nofollow noreferrer\">the spec</a>). You probably want <a href=\"https://golang.org/pkg/strconv/#FormatUint\" rel=\"nofollow noreferrer\"><code>strconv.FormatUint</code></a> or <code>fmt.Sprintf</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3355, "user_id": 1143639, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ad387b358af367c236a391275c11af3?s=128&d=identicon&r=PG&f=1", "display_name": "KDEx", "link": "https://stackoverflow.com/users/1143639/kdex"}, "edited": false, "score": 0, "creation_date": 1443039341, "post_id": 32748647, "comment_id": 53338043, "body": "sorry I should have been more clear in my question about what i&#39;ve tested against. I&#39;ve edited the question to include this information."}, {"owner": {"reputation": 4649, "user_id": 681679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ba1bdfa6ba08225903a74383be42b06?s=128&d=identicon&r=PG", "display_name": "photoionized", "link": "https://stackoverflow.com/users/681679/photoionized"}, "edited": false, "score": 0, "creation_date": 1443559800, "post_id": 32748647, "comment_id": 53540624, "body": "Actually, no flags being set should return an empty array according to go-imap documentation, the flags attribute is case sensitive, and should be <code>&quot;FLAGS&quot;</code>, not <code>&quot;Flags&quot;</code>"}, {"owner": {"reputation": 6958, "user_id": 857727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3772f7ef99bd17c1e77d77edbf76c13d?s=128&d=identicon&r=PG&f=1", "display_name": "arnt", "link": "https://stackoverflow.com/users/857727/arnt"}, "edited": false, "score": 0, "creation_date": 1443604951, "post_id": 32748647, "comment_id": 53557492, "body": "The flags attribute is case INsensitive, cf. RFC3501 page 81."}, {"owner": {"reputation": 4649, "user_id": 681679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ba1bdfa6ba08225903a74383be42b06?s=128&d=identicon&r=PG", "display_name": "photoionized", "link": "https://stackoverflow.com/users/681679/photoionized"}, "reply_to_user": {"reputation": 6958, "user_id": 857727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3772f7ef99bd17c1e77d77edbf76c13d?s=128&d=identicon&r=PG&f=1", "display_name": "arnt", "link": "https://stackoverflow.com/users/857727/arnt"}, "edited": false, "score": 0, "creation_date": 1443636730, "post_id": 32748647, "comment_id": 53577521, "body": "@arnt - I don&#39;t care if the RFC says that the response is case insensitive, the library that @Morgoroth is using normalizes all responses by uppercasing--so, as I posted, and as directly read from the source of the library, the proper key for the <code>Attrs</code> map is <code>&quot;FLAGS&quot;</code>, not <code>&quot;flags&quot;</code> or <code>&quot;Flags&quot;</code> or any other combination"}], "tags": [], "owner": {"reputation": 28276, "user_id": 87117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f9e45dad82da556b0acabdbf3be8452?s=128&d=identicon&r=PG", "display_name": "jstedfast", "link": "https://stackoverflow.com/users/87117/jstedfast"}, "is_accepted": false, "score": 1, "last_activity_date": 1443039155, "creation_date": 1443039155, "answer_id": 32748647, "question_id": 32748602, "link": "https://stackoverflow.com/questions/32748602/how-to-get-seen-unseen-status-of-imap-message/32748647#32748647", "title": "How to get seen/unseen status of IMAP message", "body": "<pre><code>fmt.Println(rsp.MessageInfo().Attrs[\"Flags\"])\n</code></pre>\n\n<p>That prints <code>&lt;nil&gt;</code> for you because no flags are set, which means the message is \"unseen\".</p>\n"}, {"tags": [], "owner": {"reputation": 6958, "user_id": 857727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3772f7ef99bd17c1e77d77edbf76c13d?s=128&d=identicon&r=PG&f=1", "display_name": "arnt", "link": "https://stackoverflow.com/users/857727/arnt"}, "is_accepted": false, "score": 1, "last_activity_date": 1443426955, "creation_date": 1443426955, "answer_id": 32818158, "question_id": 32748602, "link": "https://stackoverflow.com/questions/32748602/how-to-get-seen-unseen-status-of-imap-message/32818158#32818158", "title": "How to get seen/unseen status of IMAP message", "body": "<p>Each message has a list of flags in IMAP, one of which is called \\seen (case insensitive, as are most things in IMAP). If the flags list does not contain that flag, the message is unseen.</p>\n\n<p>The answer from @jstedfast explains how to get the flags list. The rest is a matter of splitting at whitespace and checking whether any word in the list equals \\seen.</p>\n"}, {"comments": [{"owner": {"reputation": 3355, "user_id": 1143639, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ad387b358af367c236a391275c11af3?s=128&d=identicon&r=PG&f=1", "display_name": "KDEx", "link": "https://stackoverflow.com/users/1143639/kdex"}, "edited": false, "score": 0, "creation_date": 1443564020, "post_id": 32853441, "comment_id": 53542683, "body": "Good catch with the case sensitivity. Thanks very much! So do you think this is a typo in the documentation then? I got &#39;Flags&#39; from this section specifically <a href=\"http://code.google.com/p/go-imap/source/browse/go1/imap/response.go#256\" rel=\"nofollow noreferrer\">code.google.com/p/go-imap/source/browse/go1/imap/&hellip;</a>"}, {"owner": {"reputation": 4649, "user_id": 681679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ba1bdfa6ba08225903a74383be42b06?s=128&d=identicon&r=PG", "display_name": "photoionized", "link": "https://stackoverflow.com/users/681679/photoionized"}, "reply_to_user": {"reputation": 3355, "user_id": 1143639, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ad387b358af367c236a391275c11af3?s=128&d=identicon&r=PG&f=1", "display_name": "KDEx", "link": "https://stackoverflow.com/users/1143639/kdex"}, "edited": false, "score": 0, "creation_date": 1443565542, "post_id": 32853441, "comment_id": 53543200, "body": "@Morgoroth: Actually, I hadn&#39;t read the MessageInfo structure documentation very carefully, if you notice, <code>Flags</code> is actually an attribute of the MessageInfo struct, not a key in Attrs. The library seems to internally set the Flags attribute by grabbing <code>Attrs[&quot;FLAGS&quot;]</code>, check out <a href=\"https://code.google.com/p/go-imap/source/browse/go1/imap/response.go#274\" rel=\"nofollow noreferrer\">code.google.com/p/go-imap/source/browse/go1/imap/&hellip;</a>. So basically you can either do the <code>imap.AsList(rsp.MessageInfo().Attrs[&quot;FLAGS&quot;])</code> call or just do a range over <code>rsp.MessageInfo().Flags</code>. Either works, but <code>rsp.MessageInfo().Attrs[&quot;Flags&quot;]</code> will not."}], "tags": [], "owner": {"reputation": 4649, "user_id": 681679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ba1bdfa6ba08225903a74383be42b06?s=128&d=identicon&r=PG", "display_name": "photoionized", "link": "https://stackoverflow.com/users/681679/photoionized"}, "is_accepted": true, "score": 2, "last_activity_date": 1443559468, "creation_date": 1443559468, "answer_id": 32853441, "question_id": 32748602, "link": "https://stackoverflow.com/questions/32748602/how-to-get-seen-unseen-status-of-imap-message/32853441#32853441", "title": "How to get seen/unseen status of IMAP message", "body": "<p>A Couple things to note, make sure you're actually requesting the flags field in your imap request. If you're issuing a fetch, then you'll have to pass in <code>\"FLAGS\"</code> as an argument to <code>Fetch</code>, additionally, the flags attribute in <code>Attrs</code> is case sensitive, so you'll need <code>rsp.MessageInfo().Attrs[\"FLAGS\"]</code>. Below is a working example of using imap in Gmail with the go-imap library, run it with <code>GMAIL_EMAIL=email.address GMAIL_PASSWD=mypassword go run go_file.go</code></p>\n\n<pre><code>package main\n\nimport (\n    \"code.google.com/p/go-imap/go1/imap\"\n    \"crypto/rand\"\n    \"crypto/tls\"\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n    label := \"INBOX\"\n    email := os.Getenv(\"GMAIL_EMAIL\")\n    passwd := os.Getenv(\"GMAIL_PASSWD\")\n\n    conf := &amp;tls.Config{\n        Rand: rand.Reader,\n    }\n\n    c, err := imap.DialTLS(\"imap.gmail.com:993\", conf)\n    if err != nil {\n        panic(\"Failed to connect\")\n    }\n\n    defer c.Logout(30 * time.Second)\n\n    c.Data = nil\n\n    if c.Caps[\"STARTTLS\"] {\n        c.StartTLS(nil)\n    }\n\n    // Authenticate\n    if c.State() == imap.Login {\n        c.Login(email, passwd)\n    }\n\n    if c.State() != imap.Auth {\n        panic(\"Authentication error\")\n    }\n\n    c.Select(label, true)\n\n    set, _ := imap.NewSeqSet(\"*\")\n\n    cmd, err := c.Fetch(set, \"FLAGS\", \"UID\")\n    if err != nil {\n        panic(\"Bad fetch command\")\n    }\n    _, err = cmd.Result(imap.OK)\n    if err != nil {\n        panic(\"Bad fetch response\")\n    }\n    for _, rsp := range cmd.Data {\n        seen := false\n        for _, flag := range imap.AsList(rsp.MessageInfo().Attrs[\"FLAGS\"]) {\n            if flag == \"\\\\Seen\" {\n                seen = true\n            }\n        }\n\n        if seen {\n            fmt.Printf(\"Message %d has been read!\\n\", imap.AsNumber(rsp.MessageInfo().Attrs[\"UID\"]))\n        } else {\n            fmt.Printf(\"Message %d has been not been read!\\n\", imap.AsNumber(rsp.MessageInfo().Attrs[\"UID\"]))\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3355, "user_id": 1143639, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ad387b358af367c236a391275c11af3?s=128&d=identicon&r=PG&f=1", "display_name": "KDEx", "link": "https://stackoverflow.com/users/1143639/kdex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2000, "favorite_count": 1, "accepted_answer_id": 32853441, "answer_count": 3, "score": 2, "last_activity_date": 1443559468, "creation_date": 1443038973, "last_edit_date": 1443039308, "question_id": 32748602, "link": "https://stackoverflow.com/questions/32748602/how-to-get-seen-unseen-status-of-imap-message", "title": "How to get seen/unseen status of IMAP message", "body": "<p>I've read over the go <a href=\"https://godoc.org/code.google.com/p/go-imap/go1/imap\" rel=\"nofollow\">documentation</a> as well as the general imap <a href=\"https://tools.ietf.org/html/rfc3501\" rel=\"nofollow\">documentation</a> but can't seem to find the correct way to get the status of a particular message - to know if it is marked as read or unread. </p>\n\n<p>Here's what I've got so far:</p>\n\n<pre><code>// \n//Code that set up 'c' and 'cmd' ...\n//\nfor cmd.InProgress() {\n    // Wait for the next response (no timeout)\n    c.Recv(-1)\n\n    // Process command data\n    for _, rsp = range cmd.Data {\n        if err != nil {\n            fmt.Println(err)\n        }\n        header := imap.AsBytes(rsp.MessageInfo().Attrs[\"RFC822.HEADER\"])  // Contains subject, from data\n        uid := imap.AsNumber(rsp.MessageInfo().Attrs[\"UID\"])  // Message unique id\n        body := imap.AsBytes(rsp.MessageInfo().Attrs[\"RFC822.TEXT\"])  // Message body\n        //seenState := imap.AsBytes(rsp.MessageInfo().Attrs[\"Flags\"])\n        if msg, err := mail.ReadMessage(bytes.NewReader(header)); msg != nil {\n            if err != nil {\n                fmt.Println(err)\n            }\n            //START CUSTOM\n            if strings.Contains(msg.Header.Get(\"Subject\"), genUUID()){\n                fmt.Println(rsp.Label)\n                fmt.Println(rsp.MessageInfo().Attrs[\"Flags\"])\n                fmt.Println(c.Status(\"INBOX\", string(uid)))\n            }\n            //END CUSTOM\n</code></pre>\n\n<p>For output I get:</p>\n\n<pre><code>FETCH\n&lt;nil&gt;\nLAOYU10 STATUS \"INBOX\" (\u00de) &lt;nil&gt;\n</code></pre>\n\n<p>The documentation that I've cited has led me to believe that at least one of my methods should be printing if the message is marked as unseen. What am I missing?</p>\n\n<p>EDIT:\nI am testing against an inbox (gmail) with four messages. The first two are read and second two are unread. Here is the output for all four messages.</p>\n\n<pre><code>FETCH\n&lt;nil&gt;\nSIHLB7 STATUS \"INBOX\" (\u00db) &lt;nil&gt;\nFETCH\n&lt;nil&gt;\nSIHLB8 STATUS \"INBOX\" (\u00dc) &lt;nil&gt;\nFETCH\n&lt;nil&gt;\nSIHLB9 STATUS \"INBOX\" (\u00dd) &lt;nil&gt;\nFETCH\n&lt;nil&gt;\nSIHLB10 STATUS \"INBOX\" (\u00de) &lt;nil&gt;\n</code></pre>\n"}, {"tags": ["python", "numpy", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1443035392, "post_id": 32747443, "comment_id": 53335878, "body": "I don&#39;t think there is anything in the standard lib but you could combine two things to achieve this. Write the matrix as binary, compress the file. Alternatively I would suggest using Google protobuff because it probably will suit your needs and is becoming pretty common in my experience (in many languages, not just Go)."}, {"owner": {"reputation": 9745, "user_id": 1443118, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/d758a80b64e30e08da95ae0430e420a5?s=128&d=identicon&r=PG", "display_name": "reptilicus", "link": "https://stackoverflow.com/users/1443118/reptilicus"}, "edited": false, "score": 0, "creation_date": 1443036946, "post_id": 32747443, "comment_id": 53336748, "body": "could also look into hdf5 formats, I know golang has a package to read/write them."}, {"owner": {"reputation": 5543, "user_id": 2526657, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2e87466d1323981236bb9ce4735ea9f1?s=128&d=identicon&r=PG&f=1", "display_name": "uday", "link": "https://stackoverflow.com/users/2526657/uday"}, "edited": false, "score": 0, "creation_date": 1443063442, "post_id": 32747443, "comment_id": 53345608, "body": "hdf5 is way too slow compared to npz and I mostly work with numpy (with some scipy)."}], "answers": [{"comments": [{"owner": {"reputation": 504, "user_id": 1941745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9fbfbcd311fc349cfe27c231fa3654?s=128&d=identicon&r=PG", "display_name": "Kerby Shedden", "link": "https://stackoverflow.com/users/1941745/kerby-shedden"}, "edited": false, "score": 0, "creation_date": 1460978280, "post_id": 32748241, "comment_id": 60973092, "body": "There is now a Go library for reading numpy .npy files:  <a href=\"https://github.com/kshedden/gonpy\" rel=\"nofollow noreferrer\">github.com/kshedden/gonpy</a>"}], "tags": [], "owner": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "is_accepted": false, "score": 2, "last_activity_date": 1443037564, "creation_date": 1443037564, "answer_id": 32748241, "question_id": 32747443, "link": "https://stackoverflow.com/questions/32747443/storing-matrices-in-golang-in-compressed-binary-format/32748241#32748241", "title": "storing matrices in golang in compressed binary format", "body": "<p>1) .npz is a numpy specific format. It is unlikely that Go itself would ever support this format in the standard library. I also don't know of any third party library that exists today, and (10 second) search didn't pop one up. If you need npz specifically, go with python + numpy.</p>\n\n<p>If you just want something similar from Go, you can use any format. Binary formats include <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow\">golang binary</a> and <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow\">gob</a>. Depending on what you're trying to do, you could even use a non-binary format like <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow\">json</a> and just compress it on your own.</p>\n\n<p>2) Go doesn't have built-in matrices. That library you found is third party and it only handles <code>float64</code>s.</p>\n\n<p>However, if you just need to store strings in matrix (n-dimensional) format, you would use a n-dimensional slice. For 2-dimensional it looks like this: <code>var myStringMatrix [][]string</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "edited": false, "score": 0, "creation_date": 1443041776, "post_id": 32748774, "comment_id": 53339299, "body": "fwiw, Go wasn&#39;t built as an alternative to Python directly, and not just for web applications. The project is to create a general systems language. Usually I&#39;m replacing what I might have otherwise built with Java or C++. And perhaps python too."}, {"owner": {"reputation": 173469, "user_id": 901925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bbd70aaeb3a97d0087daf93c2be8804?s=128&d=identicon&r=PG", "display_name": "hpaulj", "link": "https://stackoverflow.com/users/901925/hpaulj"}, "reply_to_user": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "edited": false, "score": 1, "creation_date": 1443044094, "post_id": 32748774, "comment_id": 53340416, "body": "I first read about it as an alternative language for the Google App Engine - some 4 years ago.  But I&#39;m not surprised that Google would aiming for broader applications."}, {"owner": {"reputation": 5543, "user_id": 2526657, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2e87466d1323981236bb9ce4735ea9f1?s=128&d=identicon&r=PG&f=1", "display_name": "uday", "link": "https://stackoverflow.com/users/2526657/uday"}, "edited": false, "score": 0, "creation_date": 1443063096, "post_id": 32748774, "comment_id": 53345537, "body": "@hpaulj, I&#39;m just exploring Go as it is in between C++ and Python and I&#39;m facing speed issues with Python. I have designed and written binary file formats (some in Cython) that can be written/read from Python, including ones compressed by Python zip, I but haven&#39;t been able to come close to the speed of <code>.npz</code> or <code>.npy</code> files (even my own version of a faster min-Pandas written partially in Cython). Hence, my interest about Go. So far, trying to avoid migrating C++, but I&#39;m generally coming to the conclusion that the only language with everything I need, and faster than Python is C++."}, {"owner": {"reputation": 8426, "user_id": 1791279, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/abcaa7d84748400f1557b2f91add969a?s=128&d=identicon&r=PG", "display_name": "rth", "link": "https://stackoverflow.com/users/1791279/rth"}, "reply_to_user": {"reputation": 5543, "user_id": 2526657, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2e87466d1323981236bb9ce4735ea9f1?s=128&d=identicon&r=PG&f=1", "display_name": "uday", "link": "https://stackoverflow.com/users/2526657/uday"}, "edited": false, "score": 1, "creation_date": 1443094841, "post_id": 32748774, "comment_id": 53359847, "body": "@uday While Go sounds fun, I am a bit skeptical about switching from Python to Go in order to improve write performance of a binary format. You can always make a C (or Cython) extension, as you have done,  called from Python. The speed will be mostly dependent on your implementation (use of compression, cache etc), and IO bound, not the language itself (i.e. Cython/C/C++/Fortran/Go, etc).    Also have you looked at the <a href=\"https://github.com/numpy/numpy/blob/5d6a9f0030e8d1a63e43783c2b5b54cde93bc5d0/numpy/lib/npyio.py#L603\" rel=\"nofollow noreferrer\"><code>np.savez</code></a> implementation: it is pure Python and has good write speeds."}, {"owner": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "reply_to_user": {"reputation": 8426, "user_id": 1791279, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/abcaa7d84748400f1557b2f91add969a?s=128&d=identicon&r=PG", "display_name": "rth", "link": "https://stackoverflow.com/users/1791279/rth"}, "edited": false, "score": 1, "creation_date": 1443129273, "post_id": 32748774, "comment_id": 53381015, "body": "I&#39;m a big fan of Go, but @rth is spot on. I recommend doing some measurements to see where your bottleneck is before spending a good amount of time trying to fix a problem that might not be. That being said if you just want to play with Go, do it :p"}], "tags": [], "owner": {"reputation": 173469, "user_id": 901925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bbd70aaeb3a97d0087daf93c2be8804?s=128&d=identicon&r=PG", "display_name": "hpaulj", "link": "https://stackoverflow.com/users/901925/hpaulj"}, "is_accepted": false, "score": 1, "last_activity_date": 1443039707, "creation_date": 1443039707, "answer_id": 32748774, "question_id": 32747443, "link": "https://stackoverflow.com/questions/32747443/storing-matrices-in-golang-in-compressed-binary-format/32748774#32748774", "title": "storing matrices in golang in compressed binary format", "body": "<p><code>npz</code> files are <code>zip</code> archives.  Archiving and compression (optional) are handled by the Python <code>zip</code> module.  The <code>npz</code> contains one <code>npy</code> file for each variable that you save. Any OS based archiving tool can decompress and extract the component <code>.npy</code> files.</p>\n\n<p>So the remaining question is - can you simulate the <code>npy</code> format?  It isn't trivial, but also not difficult either.  It consists of a header block that contains shape, strides, dtype, and order information, followed by a data block, which is, effectively, a byte image of the data buffer of the array.</p>\n\n<p>So the buffer information, and data are closely linked to the <code>numpy</code> array content.  And if the variable isn't a normal array, <code>save</code> uses the Python pickle mechanism.</p>\n\n<p>For a start I'd suggest using the <code>csv</code> format.  It's not binary, and not fast, but everyone and his brother can generate and read it.  We constantly get SO questions about reading such files using <code>np.loadtxt</code> or <code>np.genfromtxt</code>.  Look at the code for <code>np.savetxt</code> to see how <code>numpy</code> produces such files.  It's pretty simple.</p>\n\n<p>Another general purpose choice would be JSON using the <code>tolist</code> format of an array.  That comes to mind because <code>GO</code> is Google's home grown alternative to Python for web applications.  JSON is a cross language format based on simplified Javascript syntax.  </p>\n"}], "owner": {"reputation": 5543, "user_id": 2526657, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2e87466d1323981236bb9ce4735ea9f1?s=128&d=identicon&r=PG&f=1", "display_name": "uday", "link": "https://stackoverflow.com/users/2526657/uday"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 593, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1443039707, "creation_date": 1443034758, "question_id": 32747443, "link": "https://stackoverflow.com/questions/32747443/storing-matrices-in-golang-in-compressed-binary-format", "title": "storing matrices in golang in compressed binary format", "body": "<p>I am exploring a comparison between <code>Go</code> and <code>Python</code>, particularly for mathematical computation. I noticed that <code>Go</code> has a matrix package <a href=\"https://godoc.org/github.com/gonum/matrix/mat64\" rel=\"nofollow\">mat64</a>. </p>\n\n<p>1) I wanted to ask someone who uses both <code>Go</code> and <code>Python</code> if there are functions / tools comparable that are equivalent of <code>Numpy</code>'s <a href=\"http://docs.scipy.org/doc/numpy/reference/generated/numpy.savez_compressed.html#numpy.savez_compressed\" rel=\"nofollow\"><code>savez_compressed</code></a> which stores data in a <code>npz</code> format (i.e. \"compressed\" binary, multiple matrices per file) for <code>Go</code>'s matrics?</p>\n\n<p>2) Also, can Go's matrices handle string types like <code>Numpy</code> does?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1443038612, "post_id": 32746858, "comment_id": 53337676, "body": "You might be on your own there sir. Not my area of expertise but I read the <code>interval</code> type is a 16 byte so I don&#39;t know how it would map to any type in Go without conversion. Might be worth checking out this package; <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow noreferrer\">golang.org/pkg/math/big</a> or just writing a method to convert the 16 byte binary value to a <code>time.Time</code>... Alternately, I would recommend against using that type in Postgres unless it&#39;s completely necessary. It rarely should be since standard sized types cover most of the daterange we care about."}, {"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1443039813, "post_id": 32746858, "comment_id": 53338302, "body": "You will probably want to make sure that the database is using the iso_8601 format (which looks like <code>P3DT4H5M6S</code>), receive it as a string and then use something like <a href=\"https://github.com/ChannelMeter/iso8601duration\" rel=\"nofollow noreferrer\">github.com/ChannelMeter/iso8601duration</a> to parse it. You may then convert it to a <code>time.Duration</code> if you wish."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1443041238, "post_id": 32746858, "comment_id": 53339033, "body": "Note that a <code>time.Duration</code> stores durations up to ~&#177;290 years (with nanosecond precision) whereas a PostgreSQL interval stores up to ~&#177;178000000 years (with microsecond precision)."}, {"owner": {"reputation": 159, "user_id": 4576602, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/d9d8788530f91e20d1b56602f947c172?s=128&d=identicon&r=PG&f=1", "display_name": "Unsacrificed", "link": "https://stackoverflow.com/users/4576602/unsacrificed"}, "edited": false, "score": 0, "creation_date": 1486148808, "post_id": 32746858, "comment_id": 71237108, "body": "See <a href=\"https://github.com/apaxa-go/pgtypes/blob/master/interval.go\" rel=\"nofollow noreferrer\">here</a>. <code>precision</code> field may be omitted - it does not required by PostgreSQL interval type itself (it is just an implementation details)."}], "answers": [{"comments": [{"owner": {"reputation": 2546, "user_id": 2105910, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/49d27fa05d4c28818d893ff859de0dbd?s=128&d=identicon&r=PG&f=1", "display_name": "yonasstephen", "link": "https://stackoverflow.com/users/2105910/yonasstephen"}, "edited": false, "score": 0, "creation_date": 1603423499, "post_id": 33678050, "comment_id": 114039329, "body": "note that if you are using this query <code>EXTRACT(EPOCH FROM &lt;datetime2 - datetime&gt;) AS duration_in_seconds</code> you get seconds. <code>Duration(v)</code> by default accepts nanoseconds. So you&#39;d have to do <code>Duration(time.Duration(v) * time.Second)</code> to get the right value."}], "tags": [], "owner": {"reputation": 1043, "user_id": 2246784, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c421d12fefea6cfc6b002520efc3b5fa?s=128&d=identicon&r=PG", "display_name": "AManOfScience", "link": "https://stackoverflow.com/users/2246784/amanofscience"}, "is_accepted": false, "score": 2, "last_activity_date": 1447350715, "creation_date": 1447350715, "answer_id": 33678050, "question_id": 32746858, "link": "https://stackoverflow.com/questions/32746858/how-to-represent-postgresql-interval-in-go/33678050#33678050", "title": "How to represent PostgreSQL interval in Go", "body": "<p>The best answer I've <a href=\"https://github.com/golang/go/issues/4954\" rel=\"nofollow\">come across</a> is to use <code>bigint</code> in your schema, and implement <code>Value</code> &amp; <code>Scan</code> on a wrapper type for <code>time.Duration</code>.</p>\n\n<pre><code>// Duration lets us convert between a bigint in Postgres and time.Duration\n// in Go\ntype Duration time.Duration\n\n// Value converts Duration to a primitive value ready to written to a database.\nfunc (d Duration) Value() (driver.Value, error) {\n    return driver.Value(int64(d)), nil\n}\n\n// Scan reads a Duration value from database driver type.\nfunc (d *Duration) Scan(raw interface{}) error {\n    switch v := raw.(type) {\n    case int64:\n        *d = Duration(v)\n    case nil:\n        *d = Duration(0)\n    default:\n        return fmt.Errorf(\"cannot sql.Scan() strfmt.Duration from: %#v\", v)\n    }\n    return nil\n}\n</code></pre>\n\n<p>Unfortunately, you'll sacrifice the ability to do interval arithmetic inside queries - unless some clever fellow wants to post the type conversion for <code>bigint</code> => <code>interval</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 3245, "user_id": 492647, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/0f954970ccbb138551d0aad4f3f7a4b5?s=128&d=identicon&r=PG", "display_name": "Janek Olszak", "link": "https://stackoverflow.com/users/492647/janek-olszak"}, "is_accepted": true, "score": 2, "last_activity_date": 1479559265, "creation_date": 1479559265, "answer_id": 40693009, "question_id": 32746858, "link": "https://stackoverflow.com/questions/32746858/how-to-represent-postgresql-interval-in-go/40693009#40693009", "title": "How to represent PostgreSQL interval in Go", "body": "<p>If you're OK with conforming to the <code>time.Duration</code> limits and you need only seconds accuracy you could:</p>\n\n<ul>\n<li>Create the table with a SECOND precision\n<code>\n...\nsomeInterval INTERVAL SECOND(0),\n...\n</code></li>\n<li><p>Convert INTERVAL into seconds:\n<code>\nSELECT EXTRACT(EPOCH FROM someInterval) FROM someTable;\n</code> </p></li>\n<li><p>Use <a href=\"https://golang.org/pkg/time/#Duration.Seconds\" rel=\"nofollow noreferrer\">time.Duration::Seconds</a> to insert data to prepared statements</p></li>\n</ul>\n"}], "owner": {"reputation": 2648, "user_id": 1029654, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/11d1ed3a2d884420ff403355cd257814?s=128&d=identicon&r=PG", "display_name": "fonini", "link": "https://stackoverflow.com/users/1029654/fonini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3860, "favorite_count": 0, "accepted_answer_id": 40693009, "answer_count": 2, "score": 5, "last_activity_date": 1479559265, "creation_date": 1443032808, "last_edit_date": 1443033444, "question_id": 32746858, "link": "https://stackoverflow.com/questions/32746858/how-to-represent-postgresql-interval-in-go", "title": "How to represent PostgreSQL interval in Go", "body": "<p>How to represent PostgreSQL interval in Go?</p>\n\n<p>My struct looks like this:</p>\n\n<pre><code>type Product struct {\n    Id              int\n    Name            string\n    Type            int\n    Price           float64\n    Execution_time  ????\n}\n</code></pre>\n\n<p>The execution_time field on my database is <code>interval</code>.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "edited": false, "score": 0, "creation_date": 1443033306, "post_id": 32746818, "comment_id": 53334723, "body": "Runc uses the same library (actually it has been taken over by OpenContainers AFAIK) and it was easier to follow than docker. I thought the code will be too long as it is tightly integrated into the app I am working on. Are there specific details I need to include perhaps?"}, {"owner": {"reputation": 114, "user_id": 1080568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76a8f4849829643862f7c5dd89cb11e?s=128&d=identicon&r=PG", "display_name": "LK4D4", "link": "https://stackoverflow.com/users/1080568/lk4d4"}, "reply_to_user": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "edited": false, "score": 1, "creation_date": 1443033812, "post_id": 32746818, "comment_id": 53334960, "body": "Minimal runnable example with two processes will be enough. I can try to write example with pure libcontainer if you want."}, {"owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "edited": false, "score": 0, "creation_date": 1443035815, "post_id": 32746818, "comment_id": 53336111, "body": "+1 for the suggestion: I&#39;ve been trying to isolate the code for the past 20 minutes, but it&#39;s getting too long because it&#39;s different packages working together, and the container itself needs a config file which is like an A4 page long. Is there anything you can spot from the code I provided? They are the only code blocks interacting with the container. The approach maybe?"}, {"owner": {"reputation": 114, "user_id": 1080568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76a8f4849829643862f7c5dd89cb11e?s=128&d=identicon&r=PG", "display_name": "LK4D4", "link": "https://stackoverflow.com/users/1080568/lk4d4"}, "reply_to_user": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "edited": false, "score": 1, "creation_date": 1443046153, "post_id": 32746818, "comment_id": 53341210, "body": "I added example to answer. Most probably you forgot import nsenter package which is required for entering to containers."}, {"owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "edited": false, "score": 0, "creation_date": 1443459638, "post_id": 32746818, "comment_id": 53491995, "body": "Worked like a charm! I had to abandon the OpenContainer specification for now though. The project is still very young and under active development. On an unrelated subject, I don&#39;t suppose you could update the network section on your example to use a <code>veth</code> instead to access internet? I couldn&#39;t get it working. Thank you"}, {"owner": {"reputation": 114, "user_id": 1080568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76a8f4849829643862f7c5dd89cb11e?s=128&d=identicon&r=PG", "display_name": "LK4D4", "link": "https://stackoverflow.com/users/1080568/lk4d4"}, "reply_to_user": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "edited": false, "score": 0, "creation_date": 1443462160, "post_id": 32746818, "comment_id": 53493348, "body": "You can remove NEWNET from namespaces section and your container will use host network. It shouldn&#39;t be too hard to use &quot;veth&quot;, you just need to add network to config.Networks. Note that it still requires iptables rules for accessing internet."}], "tags": [], "owner": {"reputation": 114, "user_id": 1080568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76a8f4849829643862f7c5dd89cb11e?s=128&d=identicon&r=PG", "display_name": "LK4D4", "link": "https://stackoverflow.com/users/1080568/lk4d4"}, "is_accepted": true, "score": 2, "last_activity_date": 1443046116, "last_edit_date": 1443046116, "creation_date": 1443032640, "answer_id": 32746818, "question_id": 32746026, "link": "https://stackoverflow.com/questions/32746026/libcontainer-running-multiple-processes-in-the-container/32746818#32746818", "title": "Libcontainer - Running multiple processes in the container", "body": "<p>It's probably better to use docker as reference for your case, because it uses same <code>libcontainer.Container</code> objects for starting and exec new process in container. You can find code interacting with libcontainer here:\n<a href=\"https://github.com/docker/docker/tree/master/daemon/execdriver/native\" rel=\"nofollow\">https://github.com/docker/docker/tree/master/daemon/execdriver/native</a></p>\n\n<p>Also it's better to post whole code, so people could try and debug it to help you.</p>\n\n<p>EDIT:\nHere is example code for running multiple containers: <a href=\"https://gist.github.com/anonymous/407eb530c0cb6c87ec9f\" rel=\"nofollow\">https://gist.github.com/anonymous/407eb530c0cb6c87ec9f</a></p>\n\n<p>I runned it like</p>\n\n<pre><code>go run procs.go path-to-busybox\n</code></pre>\n\n<p>You can see with <code>ps</code> that there are indeed multiple processes in container.\nFeel free to ask if you have any questions.</p>\n"}], "owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "accepted_answer_id": 32746818, "answer_count": 1, "score": 0, "last_activity_date": 1443046116, "creation_date": 1443029908, "question_id": 32746026, "link": "https://stackoverflow.com/questions/32746026/libcontainer-running-multiple-processes-in-the-container", "title": "Libcontainer - Running multiple processes in the container", "body": "<p>I am trying to implement something to the effect of <code>docker run</code> and <code>docker exec</code> using <code>libcontainer</code>.</p>\n\n<p>I have been able to create a container and run a process inside it with the following code:</p>\n\n<pre><code>func Run(id string, s *specs.LinuxSpec, f *Factory) (int, error) {\n    ...\n    container, err := f.CreateContainer(id, config)\n    if err != nil {\n        return -1, err\n    }\n\n    process := newProcess(s.Process)\n    tty, err := newTty(s.Process.Terminal, process, rootuid)\n    defer tty.Close()\n    if err != nil {\n        return -1, err\n    }\n\n    defer func() {\n        if derr := Destroy(container); derr != nil {\n            err = derr\n        }\n    }()\n\n    handler := NewSignalHandler(tty)\n    defer handler.Close()\n    if err := container.Start(process); err != nil {\n        return -1, err\n    }\n\n    return handler.forward(process)\n}\n</code></pre>\n\n<p>This works great (I believe), but the problem comes when I have to run another process(es) inside the same container. For example, a container is already running (the main process is running in foreground mode): How can I achieve what Docker allows you to do with <code>docker exec</code>?</p>\n\n<p>I have the following code:</p>\n\n<pre><code>func Exec(container libcontainer.Container, process *libcontainer.Process, onData func(data []byte), onErr func(err error)) (int, error) {\n    reader, writer := io.Pipe()\n    process.Stdin = os.Stdin\n\n    rootuid, err := container.Config().HostUID()\n    if err != nil {\n        return -1, err\n    }\n\n    tty, err := newTty(true, process, rootuid)\n    defer tty.Close()\n    if err != nil {\n        return -1, err\n    }\n\n    handler := NewSignalHandler(tty)\n    defer handler.Close()\n\n    // Redirect process output\n    process.Stdout = writer\n    process.Stderr = writer\n\n    // Todo: Fix this, it waits for the main process to exit before it starts\n    if err := container.Start(process); err != nil {\n        return -1, err\n    }\n\n    go func(reader io.Reader) {\n        scanner := bufio.NewScanner(reader)\n        for scanner.Scan() {\n            onData(scanner.Bytes())\n        }\n        if err := scanner.Err(); err != nil {\n            onErr(err)\n        }\n    }(reader)\n\n    return handler.forward(process)\n}\n</code></pre>\n\n<p>This also works, but the problem is: It waits for the main process to exit before it runs. Sometimes it runs, but my memory goes to <code>100%</code> after calling that function 5 - 7 times running a simple <code>whoami</code> command.</p>\n\n<p>I'm pretty sure I am doing something(s) wrong, I just don't know what. Or is my understanding of containers failing me?</p>\n\n<p>I used this project as a reference:\n<a href=\"https://github.com/opencontainers/runc\" rel=\"nofollow\">https://github.com/opencontainers/runc</a></p>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 13627, "user_id": 1658268, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9f4ee1a60c0f32015790aa2fb68017?s=128&d=identicon&r=PG", "display_name": "SudoPlz", "link": "https://stackoverflow.com/users/1658268/sudoplz"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1443041628, "post_id": 32745716, "comment_id": 53339227, "body": "Can you please provide a link with an example? I can&#39;t seem to find one that works with ping/pong etc.."}, {"owner": {"reputation": 13627, "user_id": 1658268, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9f4ee1a60c0f32015790aa2fb68017?s=128&d=identicon&r=PG", "display_name": "SudoPlz", "link": "https://stackoverflow.com/users/1658268/sudoplz"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1443041690, "post_id": 32745716, "comment_id": 53339261, "body": "I tried gorilla websocket, but theres NO documentation at all. At the moment I&#39;m trying to implement the gorilla websocket client."}, {"owner": {"reputation": 68, "user_id": 5366097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8355a77957e290d4649b614db6c2c6?s=128&d=identicon&r=PG", "display_name": "recoba", "link": "https://stackoverflow.com/users/5366097/recoba"}, "edited": false, "score": 1, "creation_date": 1443050056, "post_id": 32745716, "comment_id": 53342476, "body": "There be <a href=\"https://github.com/gorilla/websocket/blob/master/examples/echo/client.go\" rel=\"nofollow noreferrer\">example client</a> in the GOrilla."}, {"owner": {"reputation": 13627, "user_id": 1658268, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9f4ee1a60c0f32015790aa2fb68017?s=128&d=identicon&r=PG", "display_name": "SudoPlz", "link": "https://stackoverflow.com/users/1658268/sudoplz"}, "reply_to_user": {"reputation": 68, "user_id": 5366097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8355a77957e290d4649b614db6c2c6?s=128&d=identicon&r=PG", "display_name": "recoba", "link": "https://stackoverflow.com/users/5366097/recoba"}, "edited": false, "score": 1, "creation_date": 1443539802, "post_id": 32745716, "comment_id": 53529326, "body": "This example was added just a few days ago, so I wasn&#39;t aware of it. Thank you."}, {"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 1, "creation_date": 1507113556, "post_id": 32745716, "comment_id": 80079017, "body": "I really liked the <code>Google-Fu</code> term used here... :-)"}], "answers": [{"tags": [], "owner": {"reputation": 13627, "user_id": 1658268, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9f4ee1a60c0f32015790aa2fb68017?s=128&d=identicon&r=PG", "display_name": "SudoPlz", "link": "https://stackoverflow.com/users/1658268/sudoplz"}, "is_accepted": true, "score": 17, "last_activity_date": 1443539902, "last_edit_date": 1443539902, "creation_date": 1443031876, "answer_id": 32746616, "question_id": 32745716, "link": "https://stackoverflow.com/questions/32745716/i-need-to-connect-to-an-existing-websocket-server-using-go-lang/32746616#32746616", "title": "I need to connect to an existing websocket server using go lang", "body": "<p>Nevermind I found some helping code online. Now my code looks like this in case someone else needs this:</p>\n\n<pre><code>package main\n\nimport (\n        \"net/http\"\n        \"text/template\"\n        \"code.google.com/p/go.net/websocket\"\n        \"fmt\"\n        \"os\"\n        \"time\"\n)\n\n\nconst address string = \"localhost:9999\"\n\nfunc main() {\n\n    initWebsocketClient()\n}\n\n\nfunc initWebsocketClient() {\n    fmt.Println(\"Starting Client\")\n    ws, err := websocket.Dial(fmt.Sprintf(\"ws://%s/ws\", address), \"\", fmt.Sprintf(\"http://%s/\", address))\n    if err != nil {\n        fmt.Printf(\"Dial failed: %s\\n\", err.Error())\n        os.Exit(1)\n    }\n    incomingMessages := make(chan string)\n    go readClientMessages(ws, incomingMessages)\n    i := 0\n    for {\n        select {\n        case &lt;-time.After(time.Duration(2e9)):\n            i++\n            response := new(Message)\n            response.RequestID = i\n            response.Command = \"Eject the hot dog.\"\n            err = websocket.JSON.Send(ws, response)\n            if err != nil {\n                fmt.Printf(\"Send failed: %s\\n\", err.Error())\n                os.Exit(1)\n            }\n        case message := &lt;-incomingMessages:\n            fmt.Println(`Message Received:`,message)\n\n\n        }\n    }\n}\n\nfunc readClientMessages(ws *websocket.Conn, incomingMessages chan string) {\n    for {\n        var message string\n        // err := websocket.JSON.Receive(ws, &amp;message)\n        err := websocket.Message.Receive(ws, &amp;message)\n        if err != nil {\n            fmt.Printf(\"Error::: %s\\n\", err.Error())\n            return\n        }\n        incomingMessages &lt;- message\n    }\n}\n</code></pre>\n\n<p>Also as recoba suggested in the comment, there has been a new <a href=\"https://github.com/gorilla/websocket/blob/master/examples/echo/client.go\" rel=\"noreferrer\">gorilla example here</a> for the ones looking for a better solution.</p>\n"}, {"tags": [], "owner": {"reputation": 154, "user_id": 1633871, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vRsQw.jpg?s=128&g=1", "display_name": "Ricardo Gamba", "link": "https://stackoverflow.com/users/1633871/ricardo-gamba"}, "is_accepted": false, "score": 6, "last_activity_date": 1461908138, "creation_date": 1461908138, "answer_id": 36930318, "question_id": 32745716, "link": "https://stackoverflow.com/questions/32745716/i-need-to-connect-to-an-existing-websocket-server-using-go-lang/36930318#36930318", "title": "I need to connect to an existing websocket server using go lang", "body": "<p>Check out this event-based client, super easy: <a href=\"https://github.com/rgamba/evtwebsocket\" rel=\"noreferrer\">https://github.com/rgamba/evtwebsocket</a></p>\n\n<p>Example: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/rgamba/evtwebsocket\"\n\n    \"golang.org/x/net/websocket\"\n)\n\nfunc main() {\n  c := evtwebsocket.Conn{\n    OnConnected: func(w *websocket.Conn) {\n        fmt.Println(\"Connected\")\n    },\n    OnMessage: func(msg []byte) {\n        fmt.Printf(\"Received message: %s\\n\", msg)\n    },\n    OnError: func(err error) {\n        fmt.Printf(\"** ERROR **\\n%s\\n\", err.Error())\n    },\n  }\n  // Connect\n  c.Dial(\"ws://echo.websocket.org\")\n  c.Send([]byte(\"TEST\"), nil)\n}\n</code></pre>\n"}], "owner": {"reputation": 13627, "user_id": 1658268, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/bb9f4ee1a60c0f32015790aa2fb68017?s=128&d=identicon&r=PG", "display_name": "SudoPlz", "link": "https://stackoverflow.com/users/1658268/sudoplz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12678, "favorite_count": 2, "accepted_answer_id": 32746616, "answer_count": 2, "score": 8, "last_activity_date": 1461908138, "creation_date": 1443028884, "question_id": 32745716, "link": "https://stackoverflow.com/questions/32745716/i-need-to-connect-to-an-existing-websocket-server-using-go-lang", "title": "I need to connect to an existing websocket server using go lang", "body": "<p>Theres a websocket running in my localhost on <code>ws://localhost:8080/ws</code></p>\n\n<p>I need go lang code that can create a websocket client and connect to this server.</p>\n\n<p>My Google-Fu skills failed to teach me a simple way to do this.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["encoding", "go", "gob"], "comments": [{"owner": {"reputation": 6027, "user_id": 1187471, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/AtK2G.jpg?s=128&g=1", "display_name": "Fernando &#193;.", "link": "https://stackoverflow.com/users/1187471/fernando-%c3%81"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1443025080, "post_id": 32744506, "comment_id": 53330081, "body": "It could be, adding the fields as public made it working. I need to try it in my real world example before marking as resolved."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1443025209, "post_id": 32744506, "comment_id": 53330156, "body": "It&#39;s not about pointers. Your fields are lowercase and thus unexported."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1443025423, "post_id": 32744506, "comment_id": 53330271, "body": "Side note, it is very rare to want to use pointers to an interface as <a href=\"http://research.swtch.com/interfaces\" rel=\"nofollow noreferrer\">they&#39;re effectively already pointers</a>. This is similar to usually not using pointers to maps or slices. (e.g. I&#39;d use <code>Field []C</code> rather than <code>[]*C</code> in your struct)."}, {"owner": {"reputation": 6027, "user_id": 1187471, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/AtK2G.jpg?s=128&g=1", "display_name": "Fernando &#193;.", "link": "https://stackoverflow.com/users/1187471/fernando-%c3%81"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1443025725, "post_id": 32744506, "comment_id": 53330457, "body": "@DaveC thx for the pointer, updated sample code and playground link"}, {"owner": {"reputation": 6027, "user_id": 1187471, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/AtK2G.jpg?s=128&g=1", "display_name": "Fernando &#193;.", "link": "https://stackoverflow.com/users/1187471/fernando-%c3%81"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1443025728, "post_id": 32744506, "comment_id": 53330460, "body": "@Ainar-G definitely I can&#39;t set certain struct fields to public just to satisfy this in my real world case"}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 2, "last_activity_date": 1443025794, "creation_date": 1443025794, "answer_id": 32744844, "question_id": 32744506, "link": "https://stackoverflow.com/questions/32744506/how-to-persist-or-encode-a-linked-data-structure-in-go/32744844#32744844", "title": "How to persist or encode a linked data structure in Go?", "body": "<blockquote>\n  <p>Is there a way to do this without making the fields public? Is there any existing solution so I don't need to reinvent the wheel?</p>\n</blockquote>\n\n<p>Unless you're willing to do this through copying all of your data into types with exported fields when encoding and from them when decoding, no.</p>\n\n<p>If the data is unexported other packages just <em>can't see it.</em> That's why they're called unexported. Packages like <code>encoding/json</code>, <code>encoding/xml</code>, and <code>encoding/gob</code> only operate on exported data for this exact reason.</p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1443038923, "creation_date": 1443038923, "answer_id": 32748590, "question_id": 32744506, "link": "https://stackoverflow.com/questions/32744506/how-to-persist-or-encode-a-linked-data-structure-in-go/32748590#32748590", "title": "How to persist or encode a linked data structure in Go?", "body": "<p>The fields have to be exported. Packages that do encoding/serialization ect have no way of seeing the fields otherwise. As long as your fields are exported any of the <code>encoding/</code> packages will do what you want by default.</p>\n"}], "owner": {"reputation": 6027, "user_id": 1187471, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/AtK2G.jpg?s=128&g=1", "display_name": "Fernando &#193;.", "link": "https://stackoverflow.com/users/1187471/fernando-%c3%81"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "closed_date": 1443125278, "answer_count": 2, "score": 0, "last_activity_date": 1443038923, "creation_date": 1443024588, "last_edit_date": 1443025458, "question_id": 32744506, "link": "https://stackoverflow.com/questions/32744506/how-to-persist-or-encode-a-linked-data-structure-in-go", "closed_reason": "Duplicate", "title": "How to persist or encode a linked data structure in Go?", "body": "<p>My goal is to have a linked data structure, this is, a struct with a reference to another struct, and so on, so I can encode it into my file system, and whenever I need it, decode it, so I restore the whole linked structure, with the same content.</p>\n\n<p>Example:</p>\n\n<p>I have these linked structures:</p>\n\n<pre><code>type A struct {\n    b *B\n}\n\ntype B struct {\n    c []C\n}\n\ntype C interface{}\n</code></pre>\n\n<p>I initialize them this way:</p>\n\n<pre><code>var c0 C = \"foo\"\nvar c1 C = \"bar\"\n\nvar b *B = &amp;B{}\nb.c = make([]C, 2)\nb.c[0] = c0\nb.c[1] = c1\n\nvar a A = A{}\na.b = b\n\nfmt.Println(a)\n// {$b_address}\n\nfmt.Println(a.b)\n// {[c0_address,c1_address]}\n\nfmt.Println(a.b.c[0])\n// foo\n\nfmt.Println(a.b.c[1])\n// bar\n</code></pre>\n\n<p>I would like to know how to encode A, having it persisted into a file, so I can decode it getting the same result. Addresses are not important, but the content is. I've tried it with <code>encoding/gob</code>, with no success:</p>\n\n<pre><code>// encode\nf, err := os.Create(\"data.gob\")\n\nif err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n}\n\nenc := gob.NewEncoder(f)\nenc.Encode(a)\n\nf.Close()\n\n// decode\n\nvar a1 A\nf, err = os.Open(\"data.gob\")\n\nif err != nil {\n    fmt.Println(1, err)\n    os.Exit(1)\n}\n\ndec := gob.NewDecoder(f)\ndec.Decode(&amp;a1)\nif err != nil {\n    fmt.Println(2, err)\n    os.Exit(1)\n}\nf.Close()\n\nfmt.Println(a1)\n// {&lt;nil&gt;}\n// expected {$b_address}\n</code></pre>\n\n<p>Full example: <a href=\"http://play.golang.org/p/2vxHR9BzNy\" rel=\"nofollow\">http://play.golang.org/p/2vxHR9BzNy</a></p>\n\n<p>Is there a way to do this <strong>without making the fields public</strong>? Is there any existing solution so I don't need to reinvent the wheel?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1443010392, "post_id": 32739151, "comment_id": 53319066, "body": "It&#39;s called <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">Type assertion</a>."}, {"owner": {"reputation": 1512, "user_id": 1977415, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46adac2def849b4afd2a11e44de948bf?s=128&d=identicon&r=PG", "display_name": "Pierre-Jean", "link": "https://stackoverflow.com/users/1977415/pierre-jean"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1443010586, "post_id": 32739151, "comment_id": 53319220, "body": "Thank you for the answer and duplication redirection."}], "owner": {"reputation": 1512, "user_id": 1977415, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46adac2def849b4afd2a11e44de948bf?s=128&d=identicon&r=PG", "display_name": "Pierre-Jean", "link": "https://stackoverflow.com/users/1977415/pierre-jean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 189, "favorite_count": 0, "closed_date": 1443010060, "answer_count": 0, "score": 0, "last_activity_date": 1443009981, "creation_date": 1443009981, "question_id": 32739151, "link": "https://stackoverflow.com/questions/32739151/go-val-string-interpretation", "closed_reason": "Duplicate", "title": "Go: val.(string) interpretation", "body": "<p>I'm just starting to learn <em>Go</em>, and before writing terrible code, I try to read other go project code to get the spirit of the language and learn good practices.</p>\n\n<p>In <a href=\"http://elithrar.github.io/article/map-string-interface/\" rel=\"nofollow\">this article</a>, I noticed this strange expression: <code>token, ok := val.(string)</code></p>\n\n<p>I cannot understand the meaning of this <code>variable.(type)</code> instruction. I don't think having crossed it in the <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow\">Tour of Go</a> neither on <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow\">Effective Go</a> documentation of the official website.</p>\n\n<p>Can anyone explain me how this is valuated or direct me to some documentation references that I may have overlooked?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["http", "go", "server"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1443009285, "post_id": 32738188, "comment_id": 53318357, "body": "In Go it is not very complicated to make the &quot;blocking&quot; <code>http.ListenAndServe</code> &quot;nonblocking&quot;: <code>go http.ListenAndServe(...)</code>, maybe with some error handling.  So what exactly is the problem?"}, {"owner": {"reputation": 67712, "user_id": 155077, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/MaCKR.jpg?s=128&g=1", "display_name": "Stefan Steiger", "link": "https://stackoverflow.com/users/155077/stefan-steiger"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1443012765, "post_id": 32738188, "comment_id": 53320836, "body": "@Volker: The problem is, this are my first steps in go, so I&#39;m not very fluent in it, yet, otherwise I&#39;d just create a new thread and sleep for a few milliseconds before opening the browser; and at the moment I have other things to do ;) Also, if ListenAndServer was non-blocking, it would exit the moment the main program exits (AFAIK), which would be immediately."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 13, "last_activity_date": 1443010200, "last_edit_date": 1443010200, "creation_date": 1443009443, "answer_id": 32738973, "question_id": 32738188, "link": "https://stackoverflow.com/questions/32738188/how-can-i-start-the-browser-after-the-server-started-listening/32738973#32738973", "title": "How can I start the browser AFTER the server started listening?", "body": "<p>If there is no error, <a href=\"https://golang.org/pkg/net/http/#ListenAndServe\" rel=\"noreferrer\"><code>http.ListenAndServe()</code></a> will never return. So you shouldn't add code after that except code that handles failure.</p>\n\n<p>You have to start a new goroutine, so <code>ListenAndServe()</code> is called in one goroutine, and code checking if it is up should run on the other goroutine.</p>\n\n<p>And you can check if your server is up by making a simple HTTP <code>GET</code> call to it, for example using <a href=\"https://golang.org/pkg/net/http/#Get\" rel=\"noreferrer\"><code>http.Get()</code></a>.</p>\n\n<p>The following example delays startup for 7 seconds on purpose. The new goroutine starts an endless <code>for</code> loop that checks if server is up, sleeping 1 second between attempts.</p>\n\n<p>Example:</p>\n\n<pre><code>http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hi!\"))\n})\n\ngo func() {\n    for {\n        time.Sleep(time.Second)\n\n        log.Println(\"Checking if started...\")\n        resp, err := http.Get(\"http://localhost:8081\")\n        if err != nil {\n            log.Println(\"Failed:\", err)\n            continue\n        }\n        resp.Body.Close()\n        if resp.StatusCode != http.StatusOK {\n            log.Println(\"Not OK:\", resp.StatusCode)\n            continue\n        }\n\n        // Reached this point: server is up and running!\n        break\n    }\n    log.Println(\"SERVER UP AND RUNNING!\")\n}()\n\nlog.Println(\"Starting server...\")\ntime.Sleep(time.Second * 7)\nlog.Fatal(http.ListenAndServe(\":8081\", nil))\n</code></pre>\n\n<p>Example output:</p>\n\n<pre><code>2015/09/23 13:53:03 Starting server...\n2015/09/23 13:53:04 Checking if started...\n2015/09/23 13:53:06 Failed: Get http://localhost:8081: dial tcp [::1]:8081: connectex: No connection could be made because the target machine actively refused it.\n2015/09/23 13:53:07 Checking if started...\n2015/09/23 13:53:09 Failed: Get http://localhost:8081: dial tcp [::1]:8081: connectex: No connection could be made because the target machine actively refused it.\n2015/09/23 13:53:10 Checking if started...\n2015/09/23 13:53:10 SERVER UP AND RUNNING!\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 67712, "user_id": 155077, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/MaCKR.jpg?s=128&g=1", "display_name": "Stefan Steiger", "link": "https://stackoverflow.com/users/155077/stefan-steiger"}, "edited": false, "score": 0, "creation_date": 1443077382, "post_id": 32742904, "comment_id": 53349829, "body": "Interesting, I like it ! Threading is not even required. Very nice."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 2, "creation_date": 1450865188, "post_id": 32742904, "comment_id": 56607014, "body": "This is the correct answer really. Listening socket has an internal fixed-size backlog queue which can accept connections even if there is no <code>Accept</code> being actively waiting at given time. That&#39;s why it works."}, {"owner": {"reputation": 10697, "user_id": 2456263, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a3cf0df72502fdc81fad7301b2b887d8?s=128&d=identicon&r=PG", "display_name": "0xcaff", "link": "https://stackoverflow.com/users/2456263/0xcaff"}, "edited": false, "score": 3, "creation_date": 1497054653, "post_id": 32742904, "comment_id": 75933242, "body": "<a href=\"https://golang.org/src/net/http/server.go#L2576\" rel=\"nofollow noreferrer\"><code>server.ListenAndServe</code></a> also seems to use a <code>tcpKeepAliveListener</code>. It seems to set the TCP keepalive of sockets to 3 minutes. You should probably do this too."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 30, "last_activity_date": 1443041684, "last_edit_date": 1443041684, "creation_date": 1443020065, "answer_id": 32742904, "question_id": 32738188, "link": "https://stackoverflow.com/questions/32738188/how-can-i-start-the-browser-after-the-server-started-listening/32742904#32742904", "title": "How can I start the browser AFTER the server started listening?", "body": "<p>Open the listener, start the browser and then enter the server loop:</p>\n\n<pre><code>l, err := net.Listen(\"tcp\", \"localhost:3000\")\nif err != nil {\n    log.Fatal(err)\n}\n\n// The browser can connect now because the listening socket is open.\n\nerr := open.Start(\"http://localhost:3000/test\")\nif err != nil {\n     log.Println(err)\n}\n\n// Start the blocking server loop.\n\nlog.Fatal(http.Serve(l, r)) \n</code></pre>\n\n<p>There's no need to poll as shown in another answer. The browser will connect if the listening socket is open before the browser is started.</p>\n\n<p>ListenAndServe is a convenience function that opens a socket and calls Serve. The code in this answer splits out these steps so the browser can be opened after listening starts but before the blocking call to Serve.</p>\n"}, {"comments": [{"owner": {"reputation": 369, "user_id": 5530652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44f2a3b25fb8c1f1f09200dceae37ded?s=128&d=identicon&r=PG&f=1", "display_name": "Yosi Karl", "link": "https://stackoverflow.com/users/5530652/yosi-karl"}, "edited": false, "score": 0, "creation_date": 1608191975, "post_id": 60893436, "comment_id": 115508938, "body": "How can I shutdown the server?"}], "tags": [], "owner": {"reputation": 41, "user_id": 13080654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5uWNl.jpg?s=128&g=1", "display_name": "KC Johnson", "link": "https://stackoverflow.com/users/13080654/kc-johnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1585339715, "creation_date": 1585339715, "answer_id": 60893436, "question_id": 32738188, "link": "https://stackoverflow.com/questions/32738188/how-can-i-start-the-browser-after-the-server-started-listening/60893436#60893436", "title": "How can I start the browser AFTER the server started listening?", "body": "<p>The API is not absolutely terrible, but let's just say \"It takes some getting used to\". Here is how you use custom attributes on the Server struct:</p>\n\n<pre><code>s := &amp;http.Server{\n    Addr:           cnf.API_SERVER_ADDRESS,\n    Handler:        h,\n    ReadTimeout:    0, // 1 * time.Minute,\n    WriteTimeout:   30 * time.Minute,\n    MaxHeaderBytes: 1 &lt;&lt; 20,\n}\n\ngo func() {\n\n    l, err := net.Listen(\"tcp\", cnf.API_SERVER_ADDRESS)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(`{\"server_state\":\"listening\"}`)\n    log.Fatal(s.Serve(l));\n}()\n</code></pre>\n\n<p>because if you instead use:</p>\n\n<pre><code>http.Serve(l, handler)\n</code></pre>\n\n<p>then you can't define custom properties on the server</p>\n"}], "owner": {"reputation": 67712, "user_id": 155077, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/MaCKR.jpg?s=128&g=1", "display_name": "Stefan Steiger", "link": "https://stackoverflow.com/users/155077/stefan-steiger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5062, "favorite_count": 5, "accepted_answer_id": 32742904, "answer_count": 3, "score": 17, "last_activity_date": 1609233812, "creation_date": 1443007215, "last_edit_date": 1609233812, "question_id": 32738188, "link": "https://stackoverflow.com/questions/32738188/how-can-i-start-the-browser-after-the-server-started-listening", "title": "How can I start the browser AFTER the server started listening?", "body": "<p>In Go, how can I start the browser AFTER the server started listening?</p>\n<p>Preferably the simplest way possible.</p>\n<p>My code so far, super dumbed down to the point:</p>\n<pre><code>package main\n\nimport (  \n    // Standard library packages\n    &quot;fmt&quot;\n    &quot;net/http&quot;\n    &quot;github.com/skratchdot/open-golang/open&quot;\n    // Third party packages\n    &quot;github.com/julienschmidt/httprouter&quot;\n)\n\n\n// go get github.com/toqueteos/webbrowser\n\nfunc main() {  \n    // Instantiate a new router\n    r := httprouter.New()\n\n    // Add a handler on /test\n    r.GET(&quot;/test&quot;, func(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n        // Simply write some test data for now\n        fmt.Fprint(w, &quot;Welcome!\\n&quot;)\n    })\n    \n    //open.Run(&quot;https://google.com/&quot;)\n     \n    // open.Start(&quot;https://google.com&quot;)\n\n    // http://127.0.0.1:3000/test\n    // Fire up the server\n    http.ListenAndServe(&quot;localhost:3000&quot;, r)\n    fmt.Println(&quot;ListenAndServe is blocking&quot;)  \n    open.RunWith(&quot;http://localhost:3000/test&quot;, &quot;firefox&quot;)  \n    fmt.Println(&quot;Done&quot;)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7873, "user_id": 2225104, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/195de66794c596e35bc145c80e9f5515?s=128&d=identicon&r=PG", "display_name": "BitTickler", "link": "https://stackoverflow.com/users/2225104/bittickler"}, "edited": false, "score": 0, "creation_date": 1442990858, "post_id": 32732666, "comment_id": 53306793, "body": "Split wants a string and you give it a string array according to the return type given for <code>func gettext()</code>."}], "answers": [{"tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": true, "score": 3, "last_activity_date": 1442991258, "last_edit_date": 1442991258, "creation_date": 1442990854, "answer_id": 32732793, "question_id": 32732666, "link": "https://stackoverflow.com/questions/32732666/splitting-values-in-string-in-go/32732793#32732793", "title": "splitting values in []string in go", "body": "<p>You don't need to separate values by <code>\" \"</code><br>\nThe values already separated and your function <code>gettext</code> returns a <strong>slice</strong> of parameters.<br>\nTry this example:  </p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n)\n\nfunc main() {\n    text := gettext()\n    fmt.Println(text)\n\n    for i := range text {\n        fmt.Println(text[i])\n    }\n}\n\nfunc gettext() []string {\n    flag.Parse()\n    text := flag.Args()\n\n    if len(text) &lt; 1 {\n        fmt.Println(\"Please enter radius\")\n    }\n\n    return text\n}\n</code></pre>\n\n<p>From the <a href=\"https://golang.org/pkg/flag/#Args\" rel=\"nofollow\">documentation</a>:  </p>\n\n<blockquote>\n  <p><code>func Args() []string</code><br>\n  <code>Args</code> returns the non-flag command-line arguments.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 200, "user_id": 2520654, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8d427c521de710be9699674208b28ddc?s=128&d=identicon&r=PG", "display_name": "Shalin LK", "link": "https://stackoverflow.com/users/2520654/shalin-lk"}, "is_accepted": false, "score": 0, "last_activity_date": 1443023950, "creation_date": 1443023950, "answer_id": 32744282, "question_id": 32732666, "link": "https://stackoverflow.com/questions/32732666/splitting-values-in-string-in-go/32744282#32744282", "title": "splitting values in []string in go", "body": "<p>strings.Split() is for spliting a <strong>string</strong> value, not a string <strong>array</strong>. Your gettext() is returing a string array, not a string. So you dont need string.Split(). Simply use</p>\n\n<pre><code>for _, str := range text {\n    fmt.Println(str)\n}\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 5357200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/281343c28c4be8a226c3afcf15386a7a?s=128&d=identicon&r=PG&f=1", "display_name": "anonymus", "link": "https://stackoverflow.com/users/5357200/anonymus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 831, "favorite_count": 0, "accepted_answer_id": 32732793, "answer_count": 2, "score": 0, "last_activity_date": 1443023950, "creation_date": 1442990345, "last_edit_date": 1443021164, "question_id": 32732666, "link": "https://stackoverflow.com/questions/32732666/splitting-values-in-string-in-go", "title": "splitting values in []string in go", "body": "<p>I am a novice in Go programming language.\nI am writing a code to input from cli for client and pass the values to server for processing. both client and server are residing locally.  </p>\n\n<p>code :</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n\n    text := gettext()\n    fmt.Println(text)\n\n    result := strings.Split(text, \" \")\n\n    for i := range result {\n\n        fmt.Println(result[i])\n    }\n\n}\n\nfunc gettext() []string {\n\n    flag.Parse()\n    text := flag.Args()\n\n    if len(text) &lt; 1 {\n\n        fmt.Println(\"Please enter radius\")\n\n    }\n\n    return text\n}\n</code></pre>\n\n<p>when i run from command line its is giving me following error :cannot use text (type []string) as type string in argument to strings.Split</p>\n\n<p>Basically i want to separately print values from []string .</p>\n\n<p>Can you please let me know how to do it.\nI tried using strings.split.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 1, "creation_date": 1442987824, "post_id": 32731671, "comment_id": 53305326, "body": "And what is the question? <a href=\"https://play.golang.org/p/-B3jNUqQHF\" rel=\"nofollow noreferrer\">play.golang.org/p/-B3jNUqQHF</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": false, "score": 0, "last_activity_date": 1442988029, "creation_date": 1442988029, "answer_id": 32732063, "question_id": 32731671, "link": "https://stackoverflow.com/questions/32731671/parse-nested-json-object-golang/32732063#32732063", "title": "parse nested json object golang", "body": "<p>Your code is corrent, except this line:</p>\n\n<pre><code>fmt.Printf(\"%+v\", contentHtml.FooStruct[0].Bar)\n</code></pre>\n\n<p>There is no fields <code>FooStruct</code> in <code>ResponseStruct</code> type. I think you need to use <code>Foo</code> instead.<br>\nWorking example on the <kbd><a href=\"https://play.golang.org/p/oNQlktxYN6\" rel=\"nofollow\">Go playground</a></kbd></p>\n"}], "owner": {"reputation": 3, "user_id": 2501396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82c86c4802309193631415476d918540?s=128&d=identicon&r=PG", "display_name": "DakzBack", "link": "https://stackoverflow.com/users/2501396/dakzback"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 212, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1442988029, "creation_date": 1442986332, "last_edit_date": 1442987242, "question_id": 32731671, "link": "https://stackoverflow.com/questions/32731671/parse-nested-json-object-golang", "title": "parse nested json object golang", "body": "<p>I want to parse mentioned <strong>json</strong>.</p>\n\n<blockquote>\n  <p>{\"foo\":\n        [{ \"bar\": 1, \"baz\": 2 },{ \"bar\": 4, \"baz\": 25 }], \"more\":\n  \"text\"}</p>\n</blockquote>\n\n<p>using below struct to unmarshal </p>\n\n<pre><code>type FooStruct struct {\n   Bar int `json:\"bar\"`\n   Baz int `json:\"baz\"`\n}\n\ntype  ResponseStruct struct {\n    More string `json:\"more\"`\n    Foo []FooStruct `json:\"foo\"`\n}\nvar contentHtml ResponseStruct\nerr = json.Unmarshal(&lt;byte_array&gt;, &amp;contentHtml)\nfmt.Printf(\"%+v\", contentHtml.FooStruct[0].Bar)\n</code></pre>\n"}, {"tags": ["go", "gob"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1442986311, "post_id": 32730794, "comment_id": 53304802, "body": "Why don&#39;t you take a look at the source code, especially at the tests? I&#39;ll bet you will find each case covered with a test which shows the described behaviour."}], "answers": [{"tags": [], "owner": {"reputation": 68, "user_id": 5366097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8355a77957e290d4649b614db6c2c6?s=128&d=identicon&r=PG", "display_name": "recoba", "link": "https://stackoverflow.com/users/5366097/recoba"}, "is_accepted": true, "score": 5, "last_activity_date": 1443021608, "last_edit_date": 1443021608, "creation_date": 1442983474, "answer_id": 32731118, "question_id": 32730794, "link": "https://stackoverflow.com/questions/32730794/trying-to-understand-how-the-go-gob-encoder-works/32731118#32731118", "title": "trying to understand how the Go gob encoder works", "body": "<p>Since entering this answer, I learned that OP is trolling us. Stop feeding the troll.</p>\n\n<p>You can write multiple values to a stream. You can read multiple values from a stream.</p>\n\n<p>This code writes two values to output stream w, an io.Writer:</p>\n\n<pre><code>e := gob.NewEncoder(w)\nerr := e.Encode(v1)\nif err != nil {\n   // handle error\n}\nerr := e.Encode(v2)\nif err != nil {\n  // handle error\n}\n</code></pre>\n\n<p>This code reads the values from stream r, an io.Reader. Each call to Decode reads a value that was written by a call to Decode.</p>\n\n<pre><code>d := gob.NewDecoder(r)\nvar v1 V\nerr := e.Decode(&amp;v1)\nif err != nil {\n   // handle error\n}\nvar v2 V\nerr := e.Decode(&amp;v2)\nif err != nil {\n  // handle error\n}\n</code></pre>\n\n<p>Writing multiple values to a stream gains efficiency because information about each encoded type is written once to the stream.  </p>\n"}], "owner": {"reputation": 441, "user_id": 4910125, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh5.googleusercontent.com/-QdookrlbU_g/AAAAAAAAAAI/AAAAAAAAABM/lOy93Mm4Vrc/photo.jpg?sz=128", "display_name": "WALID BELRHALMIA", "link": "https://stackoverflow.com/users/4910125/walid-belrhalmia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 1, "accepted_answer_id": 32731118, "answer_count": 1, "score": -5, "last_activity_date": 1443021608, "creation_date": 1442981272, "last_edit_date": 1442987907, "question_id": 32730794, "link": "https://stackoverflow.com/questions/32730794/trying-to-understand-how-the-go-gob-encoder-works", "title": "trying to understand how the Go gob encoder works", "body": "<p>in my ambitions to understand how gob work . i have severals question . </p>\n\n<p>i know that gob serialize a go type like struct map or interface(we must register it's real type) but : </p>\n\n<pre><code>func (dec *Decoder) Decode(e interface{}) error\nDecode reads the next value from the input stream and stores it in the data represented by the       \nempty interface value.\nIf e is nil, the value will be discarded. \nOtherwise, the value underlying e must be a pointer to the correct type for the next data item received.\nIf the input is at EOF, Decode returns io.EOF and does not modify e.\n</code></pre>\n\n<p>i didn't understand nothing in this documentation . what they mean by ( reads the next value from the input stream ) they are one data that we could send it's a struct or a map but not many .what they mean by If e is nil, the value will be discarded.  please expert explain to me i'am disasperate all day and ididn't find nothing</p>\n"}, {"tags": ["postgresql", "go"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1443020790, "post_id": 32730867, "comment_id": 53327140, "body": "The question is poorly worded in this respect, but I&#39;m pretty sure they&#39;re talking about creating an application user (e.g. <a href=\"https://github.com/mjwong/chitchat/blob/95c4b27328afdceaf0d0b40af8a02b4fa8cc163f/data/user.go#L115\" rel=\"nofollow noreferrer\">a plain insert into a <code>users</code> table</a>) and they are not trying to create a new PostgreSQL user/role. Just as with uid 0/<code>root</code> in Unix, having an application connect using a user/role with completely and total access to the database is a bad idea."}], "tags": [], "owner": {"reputation": 2779, "user_id": 2664649, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1a58e05d1b2d68e8bab05dcd51317f48?s=128&d=identicon&r=PG", "display_name": "Amey Jadiye", "link": "https://stackoverflow.com/users/2664649/amey-jadiye"}, "is_accepted": false, "score": 0, "last_activity_date": 1442981817, "creation_date": 1442981817, "answer_id": 32730867, "question_id": 32730703, "link": "https://stackoverflow.com/questions/32730703/golang-cannot-create-user-when-using-user-password-to-connect-to-postgresql/32730867#32730867", "title": "golang -- Cannot create user when using user &amp; password to connect to postgresql", "body": "<p>Only superuser can crete users in your postgress database. so make it so ..</p>\n\n<p><code>ALTER USER tom WITH SUPERUSER;</code></p>\n"}], "owner": {"reputation": 359, "user_id": 706495, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/873ec31f6bf9b96a77768f01fe3b9cb3?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/706495/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 564, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1442981817, "creation_date": 1442980676, "question_id": 32730703, "link": "https://stackoverflow.com/questions/32730703/golang-cannot-create-user-when-using-user-password-to-connect-to-postgresql", "title": "golang -- Cannot create user when using user &amp; password to connect to postgresql", "body": "<p>I'm trying out the Chitchat go app from the book Go Web Programming. The original version works. When I use a user &amp; password to access postgresql, it can connect to db but fails to create a new User, as shown below:</p>\n\n<pre><code>func db() (database *sql.DB) {\n    database, err := sql.Open(\"postgres\", \"dbname=chitchat user=tom password=tomahawk sslmode=disable\")\n    if err != nil {\n        log.Fatal(err)\n        fmt.Println(\"Db connection failed\")\n    }\n    return\n}\n</code></pre>\n\n<p>Here's the full code on <a href=\"https://github.com/mjwong/chitchat\" rel=\"nofollow\">Github</a>.</p>\n\n<p>However, I've found a temporary solution but it requires granting access to all the sequences in the chitchat database. Even after I've applied a </p>\n\n<pre><code>GRANT ALL PRIVILEGES ON DATABASE chitchat to tom;\n</code></pre>\n\n<p>it still requires manual grants to each of the table sequences. Here're the steps taken:</p>\n\n<p>1) Grant access to database</p>\n\n<pre><code>GRANT all privileges on database chitchat to tom;\n</code></pre>\n\n<p>2) List all sequences in chitchat database</p>\n\n<pre><code>SELECT c.relname FROM pg_class c WHERE c.relkind = 'S';\n</code></pre>\n\n<p>3) Grant access to each of them</p>\n\n<pre><code>GRANT all privileges on sequence users_id_seq to tom;\nGRANT all privileges on sequence threads_id_seq to tom;\nGRANT all privileges on sequence posts_id_seq to tom;\nGRANT all privileges on sequence sessions_id_seq to tom;\n</code></pre>\n\n<p>Is there a better way? Thanks in advance.</p>\n"}, {"tags": ["go", "protocol-buffers"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1442984509, "post_id": 32730307, "comment_id": 53304211, "body": "as i know, it not supported."}], "answers": [{"tags": [], "owner": {"reputation": 21654, "user_id": 107331, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cf6d0868b2b4c69bac3e6f265a32b6a7?s=128&d=identicon&r=PG", "display_name": "Daniel Martin", "link": "https://stackoverflow.com/users/107331/daniel-martin"}, "is_accepted": true, "score": 0, "last_activity_date": 1450375706, "creation_date": 1450375706, "answer_id": 34341404, "question_id": 32730307, "link": "https://stackoverflow.com/questions/32730307/does-gos-protobuf-implementation-support-dynamicmessage/34341404#34341404", "title": "Does go&#39;s protobuf implementation support DynamicMessage?", "body": "<p>The authors say that this isn't supported:</p>\n\n<p><a href=\"https://github.com/golang/protobuf/issues/106\" rel=\"nofollow\">https://github.com/golang/protobuf/issues/106</a></p>\n"}], "owner": {"reputation": 4000, "user_id": 608382, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9a7069d055ca5b4522c4b0180fb8e001?s=128&d=identicon&r=PG", "display_name": "vsekhar", "link": "https://stackoverflow.com/users/608382/vsekhar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 34341404, "answer_count": 1, "score": 0, "last_activity_date": 1450375706, "creation_date": 1442977580, "question_id": 32730307, "link": "https://stackoverflow.com/questions/32730307/does-gos-protobuf-implementation-support-dynamicmessage", "title": "Does go&#39;s protobuf implementation support DynamicMessage?", "body": "<p>Specifically, I'd like to serialize a Go struct without a corresponding .proto file, and then deserialize it (also without a .proto file) and programmatically query and extract its fields.</p>\n\n<p>A <a href=\"https://github.com/golang/protobuf/search?q=dynamicmessage\" rel=\"nofollow\">search</a> of the golang implementation turns up no equivalent functionality.</p>\n\n<p>Is this supported?</p>\n\n<p>(while encoding/gob supports this, I need multi-language compatibility)</p>\n"}, {"tags": ["string", "go", "casting", "bytearray"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 3, "creation_date": 1442967298, "post_id": 32729036, "comment_id": 53300224, "body": "Wastes memory on copies so it makes GC happen sooner, but provided you don&#39;t actually exhaust system RAM by copying something the size of all your free RAM or similar, yes, result is byte-identical."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 6, "creation_date": 1442967629, "post_id": 32729036, "comment_id": 53300291, "body": "<a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">This blog post</a> may be helpful and in particular notes that strings can contain things other than UTF-8 text."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1442969384, "last_edit_date": 1442969384, "creation_date": 1442967675, "answer_id": 32729115, "question_id": 32729036, "link": "https://stackoverflow.com/questions/32729036/is-it-safe-to-cast-binary-data-from-a-byte-array-to-a-string-and-back-in-golang/32729115#32729115", "title": "Is it safe to cast binary data from a byte array to a string and back in golang?", "body": "<p>The expression []byte(string(byte_slice)) evaluates to a slice with the same length and contents as byte_slice. The capacity of the two slices may be different.</p>\n\n<p>Although some language features assume that strings contain valid UTF-8 encoded text, a string can contain arbitrary bytes.</p>\n"}], "owner": {"reputation": 102535, "user_id": 20128, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/4b62eef3ad218a5d3cbdd1077660ca8b?s=128&d=identicon&r=PG", "display_name": "serg", "link": "https://stackoverflow.com/users/20128/serg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 379, "favorite_count": 0, "accepted_answer_id": 32729115, "answer_count": 1, "score": 3, "last_activity_date": 1442969384, "creation_date": 1442967154, "question_id": 32729036, "link": "https://stackoverflow.com/questions/32729036/is-it-safe-to-cast-binary-data-from-a-byte-array-to-a-string-and-back-in-golang", "title": "Is it safe to cast binary data from a byte array to a string and back in golang?", "body": "<p>Maybe a stupid question, but if I have some arbitrary binary data, can I cast it to string and back to byte array without corrupting it?</p>\n\n<p>Is <code>[]byte(string(byte_array))</code> always the same as <code>byte_array</code>?</p>\n"}, {"tags": ["heroku", "go", "websocket"], "comments": [{"owner": {"reputation": 163, "user_id": 1127840, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vCt4r.jpg?s=128&g=1", "display_name": "jwako", "link": "https://stackoverflow.com/users/1127840/jwako"}, "edited": false, "score": 0, "creation_date": 1449808223, "post_id": 32728030, "comment_id": 56176751, "body": "It might be helpful in your case. <a href=\"http://stackoverflow.com/questions/13063683/h15-on-heroku-sse-request\" title=\"h15 on heroku sse request\">stackoverflow.com/questions/13063683/h15-on-heroku-sse-reque&zwnj;&#8203;st</a>"}], "answers": [{"comments": [{"owner": {"reputation": 896, "user_id": 1819588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/128d7d3f74556aecba1dea2e12d92254?s=128&d=identicon&r=PG", "display_name": "Davo", "link": "https://stackoverflow.com/users/1819588/davo"}, "edited": false, "score": 0, "creation_date": 1580176988, "post_id": 48046840, "comment_id": 106003504, "body": "Hi! Just a quick note on that. That <code>setInterval</code> in the example is used only to demonstrate that the server can constantly send information to the client. That is not meant to keep the WebSocket connection alive. Check my answer below in order to know why Heroku was reporting those errors. Hope this helps people."}], "tags": [], "owner": {"reputation": 4645, "user_id": 1977315, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/38d780854f2c29642e42dc14611f7edf?s=128&d=identicon&r=PG", "display_name": "nagy.zsolt.hun", "link": "https://stackoverflow.com/users/1977315/nagy-zsolt-hun"}, "is_accepted": false, "score": 3, "last_activity_date": 1514773856, "creation_date": 1514773856, "answer_id": 48046840, "question_id": 32728030, "link": "https://stackoverflow.com/questions/32728030/heroku-h15-error-on-web-socket-close/48046840#48046840", "title": "Heroku H15 Error on web socket close", "body": "<p>I solved the problem by sending pings from the server every second, as in the heroku nodejs example: <a href=\"https://github.com/heroku-examples/node-websockets/blob/master/server.js\" rel=\"nofollow noreferrer\">https://github.com/heroku-examples/node-websockets/blob/master/server.js</a></p>\n"}, {"tags": [], "owner": {"reputation": 497, "user_id": 9614476, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Nagendra Singh", "link": "https://stackoverflow.com/users/9614476/nagendra-singh"}, "is_accepted": false, "score": 0, "last_activity_date": 1578242381, "creation_date": 1578242381, "answer_id": 59601970, "question_id": 32728030, "link": "https://stackoverflow.com/questions/32728030/heroku-h15-error-on-web-socket-close/59601970#59601970", "title": "Heroku H15 Error on web socket close", "body": "<p>If anyone comes here looking for a solution from <code>Java</code> perspective:</p>\n\n<pre><code>@Component\npublic class SocketHandler extends TextWebSocketHandler {\n\n    public static Map&lt;String, WebSocketSession&gt; sessions = new ConcurrentHashMap&lt;&gt;();\n\n    @Override\n    public void afterConnectionEstablished(WebSocketSession session) throws Exception {\n        String userName = (String) session.getAttributes().get(\"userName\");\n        sessions.put(userName, session);\n        super.afterConnectionEstablished(session);\n    }\n\n    @Override\n    public void afterConnectionClosed(WebSocketSession session, CloseStatus status) throws Exception {\n        String userName = (String) session.getAttributes().get(\"userName\");\n        sessions.remove(userName);\n        super.afterConnectionClosed(session, status);\n    }\n}\n\n\n@Configuration\n@EnableWebSocket\npublic class WebSocketConfig implements WebSocketConfigurer {\n\n    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {\n        registry.addHandler(new SocketHandler(), \"/webSocket/AppName/*\").addInterceptors(auctionInterceptor());;\n    }\n\n    @Bean\n    public HandshakeInterceptor auctionInterceptor() {\n        return new HandshakeInterceptor() {\n            public boolean beforeHandshake(ServerHttpRequest request, ServerHttpResponse response,\n                                           WebSocketHandler wsHandler, Map&lt;String, Object&gt; attributes) throws Exception {\n\n                // Get the URI segment corresponding to the auction id during handshake\n                String path = request.getURI().getPath();\n                String userName = path.substring(path.lastIndexOf('/') + 1);\n\n                // This will be added to the websocket session\n                attributes.put(\"userName\", userName);\n                return true;\n            }\n\n            public void afterHandshake(ServerHttpRequest request, ServerHttpResponse response,\n                                       WebSocketHandler wsHandler, Exception exception) {\n                // Nothing to do after handshake\n            }\n        };\n    }\n}\n</code></pre>\n\n<p>Above is my WebSocket configuration in Spring boot, as I only want the connection to be  created and keep it in a <code>map</code> with userName and session details. </p>\n\n<p>After that in Springboot main method just added a ping every 30 seconds like this :</p>\n\n<pre><code>public static void main(String[] args) {\n    SpringApplication.run(MayAppName.class, args);\n    ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(1);\n    Runnable r = () -&gt; {\n        if(SocketHandler.sessions != null &amp;&amp; !SocketHandler.sessions.isEmpty()) {\n            for (Map.Entry&lt;String, WebSocketSession&gt; stringWebSocketSessionEntry : SocketHandler.sessions.entrySet()) {\n                try {\n                    // Dummy ping to keep connection alive.\n                    stringWebSocketSessionEntry.getValue().sendMessage(new TextMessage(\"Dummy Ping\"));\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n\n        }\n    };\n\n    scheduler.scheduleAtFixedRate(r, 0, 30, TimeUnit.SECONDS);\n}\n</code></pre>\n\n<p>What this does is, it keeps pinging the subscriber every 30 seconds so that the default <code>55</code> seconds does not affect websocket connection, as suggested in Heroku docs.</p>\n\n<p><code>Timeouts\nThe normal Heroku HTTP routing timeout rules apply to WebSocket connections. Either client or server can prevent the connection from idling by sending an occasional ping packet over the connection.</code></p>\n"}, {"comments": [{"owner": {"reputation": 111, "user_id": 9353090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/876bb416f2f996a4a4e8db62fa55ea98?s=128&d=identicon&r=PG", "display_name": "CanuckT", "link": "https://stackoverflow.com/users/9353090/canuckt"}, "edited": false, "score": 1, "creation_date": 1617424305, "post_id": 59941248, "comment_id": 118304740, "body": "So based on this, should we just be ignoring these log service timeouts in our logs?"}, {"owner": {"reputation": 896, "user_id": 1819588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/128d7d3f74556aecba1dea2e12d92254?s=128&d=identicon&r=PG", "display_name": "Davo", "link": "https://stackoverflow.com/users/1819588/davo"}, "reply_to_user": {"reputation": 111, "user_id": 9353090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/876bb416f2f996a4a4e8db62fa55ea98?s=128&d=identicon&r=PG", "display_name": "CanuckT", "link": "https://stackoverflow.com/users/9353090/canuckt"}, "edited": false, "score": 0, "creation_date": 1617451983, "post_id": 59941248, "comment_id": 118309999, "body": "Hi @CanuckT, yes, at least based on my experience \ud83d\udc4d\ud83c\udffbyou are not actually missing any requests."}], "tags": [], "owner": {"reputation": 896, "user_id": 1819588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/128d7d3f74556aecba1dea2e12d92254?s=128&d=identicon&r=PG", "display_name": "Davo", "link": "https://stackoverflow.com/users/1819588/davo"}, "is_accepted": false, "score": 5, "last_activity_date": 1580176761, "creation_date": 1580176761, "answer_id": 59941248, "question_id": 32728030, "link": "https://stackoverflow.com/questions/32728030/heroku-h15-error-on-web-socket-close/59941248#59941248", "title": "Heroku H15 Error on web socket close", "body": "<p>yes! I have experienced that situation and after some deep debugging, I came to the conclusion that this is just a \"false positive\" in the Heroku Router engine. My debugging went like this:</p>\n\n<ol>\n<li>Create a WebSocket connection between the client and the WebSocket server running on Heroku.</li>\n<li>If you're using socket.io or a similar library it will <strong>most likely establish an HTTP polling connection before switching protocols to WebSocket</strong>. (You can see these GET/POST requests in the Heroku Router logs).</li>\n<li>Once the connection is established using the WebSocket protocol, the client will <strong>keep it alive by sending a heartbeat</strong> (actually the server can do this too). <strong>Initially, you won't see this request in the Heroku Router logs</strong> because it's still pending (it's open and sending packages of data every few seconds, the heartbeat). You can monitor this by using the Chrome DevTools Network tab.</li>\n<li>The heartbeat prevents Heroku Router from terminating the request, since every time a few bytes are transferred between the client and the server the <a href=\"https://devcenter.heroku.com/articles/http-routing#timeouts\" rel=\"noreferrer\">Heroku Router timeout timer (55secs) is reset</a>.</li>\n<li>However, <strong>whenever your client closes the connection</strong> (ie: closes the browser tab, refreshes the page, disconnects from the internet, etc); the Heroku Router detects the request being terminated and (here comes is my guess based on debugging) <strong>because the request was \"pending\" it reacts as if it was idle</strong> for X amount of milliseconds, where X is the time from when the request was received until it was closed, that's when you see logs like this: <code>service=79859ms status=101</code></li>\n</ol>\n\n<p>As a conclusion: <strong>Heroku Router will log an Error 15 line whenever your client app terminates a WebSocket connection</strong> which was working perfectly fine for X amount of milliseconds. So, in many cases, it can be just users leaving your app.</p>\n\n<p>I hope this helps people and that you guys can go to sleep with one less thing to worry about :)</p>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 12180192, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b44483d5e2ac95c88bb4f3cbf6fbb77?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick W", "link": "https://stackoverflow.com/users/12180192/patrick-w"}, "is_accepted": false, "score": 0, "last_activity_date": 1614849691, "last_edit_date": 1614849691, "creation_date": 1614788221, "answer_id": 66460906, "question_id": 32728030, "link": "https://stackoverflow.com/questions/32728030/heroku-h15-error-on-web-socket-close/66460906#66460906", "title": "Heroku H15 Error on web socket close", "body": "<p>Check for <code>yourSocket.READYSTATE === WebSocket.OPEN</code> before attempting to send.</p>\n<p>If not open then make sure it is open by implementing something like <a href=\"https://dev.to/ndrbrt/wait-for-the-websocket-connection-to-be-open-before-sending-a-message-1h12\" rel=\"nofollow noreferrer\">this</a></p>\n<p>Just implementing a ping-pong solution wasn't enough to keep my connections open.</p>\n"}], "owner": {"reputation": 837, "user_id": 640483, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ecd5cc001ab91998b02f1ace8a35a9da?s=128&d=identicon&r=PG", "display_name": "Ryan Her", "link": "https://stackoverflow.com/users/640483/ryan-her"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2350, "favorite_count": 1, "answer_count": 4, "score": 2, "last_activity_date": 1614849691, "creation_date": 1442960912, "question_id": 32728030, "link": "https://stackoverflow.com/questions/32728030/heroku-h15-error-on-web-socket-close", "title": "Heroku H15 Error on web socket close", "body": "<p>I have a Go service serving as a web socket server on Heroku.  The client pings the server every 20 seconds and it seems to keep the connection open.  The problem is that when the socket connection is closed, Heroku router throws H15 error thinking that the request took too much time.  For example, if web socket connection has been open for 300 seconds, Heroku log would show:</p>\n\n<p>\u2026.H15\u2026.  dyno=web.1 connect=1ms service=300000ms status=503 bytes=147\u2026.</p>\n\n<p>Anyone has experienced this?</p>\n"}, {"tags": ["amazon-web-services", "go", "apple-push-notifications"], "answers": [{"comments": [{"owner": {"reputation": 5126, "user_id": 2565551, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hfWW3.jpg?s=128&g=1", "display_name": "Mike V", "link": "https://stackoverflow.com/users/2565551/mike-v"}, "edited": false, "score": 0, "creation_date": 1443026015, "post_id": 32735029, "comment_id": 53330631, "body": "This is exactly what I ended up doing. Before storing the apns token into the DB, I make a <code>CreatePlatformEndpoint</code> request and then store the resulting <code>EndpointArn</code> in the DB as well. When I publish, I publish to the <code>EndpointArn</code>. Seems like a bit of unnecessary overhead, but it works."}], "tags": [], "owner": {"reputation": 4715, "user_id": 594074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af842de33409283fd153d32a8fb4feb7?s=128&d=identicon&r=PG", "display_name": "Baris Akar", "link": "https://stackoverflow.com/users/594074/baris-akar"}, "is_accepted": true, "score": 2, "last_activity_date": 1442998382, "last_edit_date": 1495541201, "creation_date": 1442998382, "answer_id": 32735029, "question_id": 32728006, "link": "https://stackoverflow.com/questions/32728006/send-a-push-notification-to-a-specific-apns-token-using-aws-sns/32735029#32735029", "title": "Send a push notification to a specific APNS token using AWS SNS", "body": "<blockquote>\n  <p>To use the Publish action for sending a message to a mobile endpoint,\n  such as an app on a Kindle device or mobile phone, you must specify\n  the <code>EndpointArn</code>. The <code>EndpointArn</code> is returned when making a call with\n  the <code>CreatePlatformEndpoint</code> action.</p>\n</blockquote>\n\n<p>The easiest way of getting the <code>EndpointArn</code> would be to store it along with or instead of the APNS token in your DB, assuming you are using <code>CreatePlatformEndpoint</code>. Otherwise have a look at this question: <a href=\"https://stackoverflow.com/questions/22501373/amazon-sns-how-to-get-endpointarn-by-tokenregistrationid-using-amazon-net-sd\">Amazon SNS: How to get EndpointArn by token(registrationId) using amazon .net sdk?</a></p>\n"}], "owner": {"reputation": 5126, "user_id": 2565551, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/hfWW3.jpg?s=128&g=1", "display_name": "Mike V", "link": "https://stackoverflow.com/users/2565551/mike-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 539, "favorite_count": 0, "accepted_answer_id": 32735029, "answer_count": 1, "score": 1, "last_activity_date": 1442998382, "creation_date": 1442960779, "question_id": 32728006, "link": "https://stackoverflow.com/questions/32728006/send-a-push-notification-to-a-specific-apns-token-using-aws-sns", "title": "Send a push notification to a specific APNS token using AWS SNS", "body": "<p>I'm trying to send a basic APNS push notification to a specific APNS token using AWS SNS. All the examples I'm finding are how to store the token in SNS, subscribe to channels, and publish to channels. </p>\n\n<p>I don't need that kind of usage with the application I'm building. The golang application decides which users a push needs to be sent to for which actions. Then it looks up the tokens for those users in the DB. All I need is a basic request to send a push notification to that token (preferably asynchronously).</p>\n\n<p>Here is one of the examples I've looked at:\n<a href=\"http://docs.aws.amazon.com/sdk-for-go/api/service/sns/SNS.html#Publish-instance_method\" rel=\"nofollow\">http://docs.aws.amazon.com/sdk-for-go/api/service/sns/SNS.html#Publish-instance_method</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14588, "user_id": 3166303, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/877b076ec96e4ab48f7f4567c1ea2741?s=128&d=identicon&r=PG", "display_name": "leeor", "link": "https://stackoverflow.com/users/3166303/leeor"}, "edited": false, "score": 2, "creation_date": 1442957149, "post_id": 32727135, "comment_id": 53296755, "body": "<code>DailyData.Data</code> is an array, what exactly are you trying to do?"}, {"owner": {"reputation": 333, "user_id": 2022284, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/4be028eba9cf29f4d2714cb3cf9863ad?s=128&d=identicon&r=PG", "display_name": "user2022284", "link": "https://stackoverflow.com/users/2022284/user2022284"}, "reply_to_user": {"reputation": 14588, "user_id": 3166303, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/877b076ec96e4ab48f7f4567c1ea2741?s=128&d=identicon&r=PG", "display_name": "leeor", "link": "https://stackoverflow.com/users/3166303/leeor"}, "edited": false, "score": 0, "creation_date": 1442958509, "post_id": 32727135, "comment_id": 53297369, "body": "hi - this mirrors the way the json feed is structured when you pull from forecast.io ( weather forecast). the goal is to eventually access any of the available variables in a fronted visualization. I can&#39;t print out any of the values in AllData at this point  e.g when using fmt.Printf"}, {"owner": {"reputation": 6632, "user_id": 210547, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/70ebc83b42f07ad8e3363085e722500e?s=128&d=identicon&r=PG", "display_name": "MDrollette", "link": "https://stackoverflow.com/users/210547/mdrollette"}, "edited": false, "score": 0, "creation_date": 1442959671, "post_id": 32727135, "comment_id": 53297857, "body": "Can you include the JSON sample and how you are trying to use it with these data structures? That will help us provide more specific guidance."}], "answers": [{"comments": [{"owner": {"reputation": 333, "user_id": 2022284, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/4be028eba9cf29f4d2714cb3cf9863ad?s=128&d=identicon&r=PG", "display_name": "user2022284", "link": "https://stackoverflow.com/users/2022284/user2022284"}, "edited": false, "score": 0, "creation_date": 1442962518, "post_id": 32727792, "comment_id": 53298812, "body": "Carl - this is great. the first option is closer to what I am looking to do - i.e access the variables in AllData individually ( vs. spitting it all out in a range like in the second option). However, this implies I have to setup variables like this for EACH item in AllData - and there are quite a few - I abbreviated it here for clarity."}, {"owner": {"reputation": 18231, "user_id": 475052, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/dcf2e8035affcf18eef28b9e0d3f1569?s=128&d=identicon&r=PG", "display_name": "Carl Veazey", "link": "https://stackoverflow.com/users/475052/carl-veazey"}, "reply_to_user": {"reputation": 333, "user_id": 2022284, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/4be028eba9cf29f4d2714cb3cf9863ad?s=128&d=identicon&r=PG", "display_name": "user2022284", "link": "https://stackoverflow.com/users/2022284/user2022284"}, "edited": false, "score": 0, "creation_date": 1442982123, "post_id": 32727792, "comment_id": 53303546, "body": "I&#39;m sorry then I don&#39;t really understand what you&#39;re trying to do, could you edit your question to specify what you mean beyond accessing the struct members?"}], "tags": [], "owner": {"reputation": 18231, "user_id": 475052, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/dcf2e8035affcf18eef28b9e0d3f1569?s=128&d=identicon&r=PG", "display_name": "Carl Veazey", "link": "https://stackoverflow.com/users/475052/carl-veazey"}, "is_accepted": false, "score": 2, "last_activity_date": 1442960430, "last_edit_date": 1442960430, "creation_date": 1442959843, "answer_id": 32727792, "question_id": 32727135, "link": "https://stackoverflow.com/questions/32727135/accessing-fields-in-nested-structs/32727792#32727792", "title": "Accessing fields in nested structs", "body": "<p>You can access an <code>AllData</code> field from a <code>Forecast</code> struct by providing an index into the <code>Data</code> slice in <code>DailyData</code>. Consider this stripped-down example of your question:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype AllData struct {\n    Summary string\n}\n\ntype DailyData struct {\n    Data []AllData\n}\n\ntype Forecast struct {\n    Daily DailyData\n}\n\nfunc main() {\n    a := AllData{\"summary\"}\n    s := []AllData{a}\n    d := DailyData{s}\n    f := Forecast{d}\n\n    val := f.Daily.Data[0].Summary\n\n    fmt.Println(val)\n}\n</code></pre>\n\n<p>In <code>main</code>, we read the <code>Summary</code> field from the <code>AllData</code> struct at index 0 of the <code>DailyData</code>'s <code>Data</code> slice. This prints <code>summary</code> to the console.</p>\n\n<p>Optionally, we could access multiple <code>AllData</code> structs by ranging over the slice in <code>DailyData</code>:</p>\n\n<pre><code>func main() {\n    a1 := AllData{\"summary1\"}\n    a2 := AllData{\"summary2\"}\n    a3 := AllData{\"hello\"}\n    s := []AllData{a1, a2, a3}\n    d := DailyData{s}\n    f := Forecast{d}\n\n    for _, val := range f.Daily.Data {\n        fmt.Println(val.Summary)\n    }\n}\n</code></pre>\n\n<p>The above prints: </p>\n\n<pre><code>summary1\nsummary2\nhello\n</code></pre>\n"}], "owner": {"reputation": 333, "user_id": 2022284, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/4be028eba9cf29f4d2714cb3cf9863ad?s=128&d=identicon&r=PG", "display_name": "user2022284", "link": "https://stackoverflow.com/users/2022284/user2022284"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3458, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1442960430, "creation_date": 1442956748, "last_edit_date": 1442959562, "question_id": 32727135, "link": "https://stackoverflow.com/questions/32727135/accessing-fields-in-nested-structs", "title": "Accessing fields in nested structs", "body": "<p>How do I reference a field in the \"AllData\" struct below from the main \"Forecast\" struct?  e.g if I wanted to reference \"TemperatureMax from Forecast -> Daily?</p>\n\n<pre><code>type AllData struct {\n    Time                       float64 `json:\"time\"`\n    Summary                    string  `json:\"summary\"`\n    Icon                       string  `json:\"icon\"`\n    TemperatureMin             float64 `json:\"temperatureMin\"`\n    TemperatureMinTime         float64 `json:\"temperatureMinTime\"`\n    TemperatureMax             float64 `json:\"temperatureMax\"`\n}\n\ntype HourlyData struct {\n    Summary string        `json:\"summary\"`\n    Icon    string        `json:\"icon\"`\n    Data    []CurrentData `json:\"data\"`\n}\n\ntype DailyData struct {\n    Summary string    `json:\"summary\"`\n    Icon    string    `json:\"icon\"`\n    Data    []AllData `json:\"data\"`\n}\n\ntype Forecast struct {\n    Latitude  float64     `json:\"latitude\"`\n    Longitude float64     `json:\"longitude\"`\n    Timezone  string      `json:\"timezone\"`\n    Offset    int         `json:\"offset\"`\n    Currently CurrentData `json:\"currently\"`\n    Hourly    HourlyData  `json:\"hourly\"`\n    Daily     DailyData   `json:\"daily\"`\n    Flags     Flags       `json:\"flags\"`\n}\n</code></pre>\n"}, {"tags": ["linux", "file", "go", "io", "server"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1442980810, "post_id": 32726892, "comment_id": 53303289, "body": "First you are ignoring errors returned, e.g. from <code>os.Mkdir</code> or <code>os.Chdir</code>. Second: while creating the you check for <code>IsNotExist</code> <i>only</i> and do not handle e.g. <code>IsPermission</code>. Probably your directories have the wrong permissions: You <code>Chmod</code> only if you create the directory; if it exists already you never Chmod so it might deny writes."}, {"owner": {"reputation": 1521, "user_id": 1013731, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/41427402ce0ec49a8e6ebcb0e7008dfe?s=128&d=identicon&r=PG", "display_name": "Michael Sazonov", "link": "https://stackoverflow.com/users/1013731/michael-sazonov"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1442999519, "post_id": 32726892, "comment_id": 53311653, "body": "@Volker The dirs have the right permissions, I don&#39;t use <code>Chdir</code> and <code>Mkdir</code> returns no error."}, {"owner": {"reputation": 754, "user_id": 2317101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/a1ea60b344309f25069867fa629aaf1d?s=128&d=identicon&r=PG", "display_name": "thepanuto", "link": "https://stackoverflow.com/users/2317101/thepanuto"}, "edited": false, "score": 0, "creation_date": 1443008609, "post_id": 32726892, "comment_id": 53317904, "body": "Does <code>io.Copy()</code> returns any meaningful error?"}], "owner": {"reputation": 1521, "user_id": 1013731, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/41427402ce0ec49a8e6ebcb0e7008dfe?s=128&d=identicon&r=PG", "display_name": "Michael Sazonov", "link": "https://stackoverflow.com/users/1013731/michael-sazonov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 400, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1443121848, "creation_date": 1442955857, "last_edit_date": 1443121848, "question_id": 32726892, "link": "https://stackoverflow.com/questions/32726892/golang-io-copy-does-not-copy-the-file-in-centos", "title": "Golang io.Copy() does not copy the file in CentOS", "body": "<p>I'm new to Go.\nThe following code works perfectly in windows, but not on CentOS.\nI receive a multipart file from the client. The file has the correct size and there are no errors in reading it.</p>\n\n<p>I need to create specific directories for the uploading user and save the files in there.\nDirectories are created just fine, but the file is not written.\nThis whole code runs with no errors on any stage.\nI'm using Go v1.5.1 and BeeGo framework.</p>\n\n<p>Here's the code: </p>\n\n<pre><code>    file , header , err := this.GetFile( \"logo\" );\n\n    defer func(){\n        err := file.Close()\n        if err != nil {\n            fmt.Println( err.Error() )\n        }\n    }()\n\n\n    size , seekErr := file.Seek( 0 , 2 )\n    maxSize , _ := beego.AppConfig.Int64( \"MaxSize\" )\n\n    if err != nil {\n\n        response.Data = err.Error()\n        response.Success = false\n\n    } else if seekErr != nil {\n\n        response.Data = seekErr.Error()\n        response.Success = false\n\n    } else if size &gt; maxSize {\n\n        response.Data = \"File too large: \" + string(size)\n        response.Success = false\n\n    } else {\n\n        if _ , errDE := os.Stat( \"static/media/business\" ) ; os.IsNotExist( errDE ){\n            os.Mkdir( \"static/media/business\" , os.ModeDir )\n            os.Chmod( \"static/media/business\" , 0755 )\n        }\n\n        offset , err := file.Seek( 0 , 0 )\n\n        if err != nil {\n            fmt.Println( \"Error seeking: \" + err.Error() )\n        }\n\n        path := \"static/media/business/\" + u.( models.User ).Business.BusinessPage\n\n        if _ , errDE := os.Stat( path ) ; os.IsNotExist( errDE ){\n            os.Mkdir( path , os.ModeDir )\n            os.Chmod( path , 0755 )\n        }\n\n        name := files.GenerateFileName( header.Filename , 24 )\n\n        out , err := os.Create( path + \"/\" + name )\n\n        if err != nil {\n\n            response.Data = err.Error()\n            response.Success = false\n\n        } else {\n\n            defer func(){\n                err := out.Close()\n                if err != nil {\n                    fmt.Println( err.Error() )\n                }\n            }()\n\n            _ , err = io.Copy( out , file )\n            os.Chmod( path + \"/\" + name , 0755 )\n            ...\n</code></pre>\n\n<p>Is there something I'm missing?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>It appears that I can <code>io.Copy</code> to any *.txt file in the mentioned path, but not to an image file. Is that a clue?</p>\n"}, {"tags": ["hadoop", "go", "mapreduce", "protocol-buffers"], "comments": [{"owner": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "edited": false, "score": 0, "creation_date": 1442955075, "post_id": 32726420, "comment_id": 53295697, "body": "These can be a good start <a href=\"http://hortonworks.com/blog/go-hadoop-err-hadoop-and-go/\" rel=\"nofollow noreferrer\">hortonworks.com/blog/go-hadoop-err-hadoop-and-go</a> <a href=\"https://github.com/colinmarc/hdfs\" rel=\"nofollow noreferrer\">github.com/colinmarc/hdfs</a>"}], "owner": {"reputation": 2011, "user_id": 2321866, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d489a0664421bdb84a1e0f559360d841?s=128&d=identicon&r=PG", "display_name": "Kasinath Kottukkal", "link": "https://stackoverflow.com/users/2321866/kasinath-kottukkal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "closed_date": 1442962001, "answer_count": 0, "score": 2, "last_activity_date": 1442954253, "creation_date": 1442954253, "question_id": 32726420, "link": "https://stackoverflow.com/questions/32726420/is-there-a-go-framework-that-only-uses-protocol-buffers-to-communicate-with-hado", "closed_reason": "Not suitable for this site", "title": "Is there a go framework that only uses Protocol buffers to communicate with Hadoop?", "body": "<p>I was exploring options to write hadoop map/reduce programs in golang. I want to make use native hadoop apis using Hadoop RPC and not alternative solutions like streaming etc.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 0, "creation_date": 1442952306, "post_id": 32725694, "comment_id": 53294198, "body": "this is because you are not using an internal variable,right?"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1442952333, "creation_date": 1442952333, "answer_id": 32725871, "question_id": 32725694, "link": "https://stackoverflow.com/questions/32725694/why-is-variable-declaration-not-allowed-here/32725871#32725871", "title": "Why is variable declaration not allowed here?", "body": "<p>In this example:</p>\n\n<pre><code>var resp *int\nif resp, err := generateInt(); err != nil {\n</code></pre>\n\n<p>The <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow\">short variable declaration</a> is redeclaring the <code>resp</code> variable. Because an if's statement is scoped to the inside the if block, it only shadows the first <code>resp</code> variable within that block, leaving the first unused. </p>\n"}], "owner": {"reputation": 17619, "user_id": 68172, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/Tt3am.jpg?s=128&g=1", "display_name": "soldier.moth", "link": "https://stackoverflow.com/users/68172/soldier-moth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 386, "favorite_count": 0, "accepted_answer_id": 32725871, "answer_count": 1, "score": 1, "last_activity_date": 1442952333, "creation_date": 1442951687, "question_id": 32725694, "link": "https://stackoverflow.com/questions/32725694/why-is-variable-declaration-not-allowed-here", "title": "Why is variable declaration not allowed here?", "body": "<p>Why does <code>testC()</code> fail to compile in the following go code? I would expect that the behavior would match that of <code>testB()</code> with the exception that <code>err</code>'s scope would be limited to the if block.</p>\n\n<p>The error message provided by the compiler is <code>resp declared and not used</code></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    testA()\n    testB()\n    testC()\n    testD()\n}\n\n// valid\nfunc testA() {\n    resp, err := generateInt()\n    fmt.Println(fmt.Sprintf(\"Resp=%v Error=%v\", resp, err))\n}\n\n// valid\nfunc testB() {\n    var resp *int\n    resp, err := generateInt()\n    fmt.Println(fmt.Sprintf(\"Resp=%v Error=%v\", resp, err))\n}\n\n// does not compile\nfunc testC() {\n    var resp *int\n    if resp, err := generateInt(); err != nil {\n        fmt.Println(\"error=%v\", err)\n        return\n    }\n    fmt.Println(\"Resp=%d\", *resp)\n}\n\n// valid\nfunc testD() {\n    var resp *int\n    var err error\n    if resp, err = generateInt(); err != nil {\n        fmt.Println(\"error=%v\", err)\n        return\n    }\n    fmt.Println(\"Resp=%d\", *resp)\n}\n\nfunc generateInt() (*int, error) {\n    result := 5\n    return &amp;result, nil\n}\n</code></pre>\n"}, {"tags": ["ajax", "go", "same-origin-policy"], "comments": [{"owner": {"reputation": 10997, "user_id": 3358027, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/p6dc8.jpg?s=128&g=1", "display_name": "Buzinas", "link": "https://stackoverflow.com/users/3358027/buzinas"}, "edited": false, "score": 0, "creation_date": 1442940742, "post_id": 32722409, "comment_id": 53287561, "body": "In your <i>jQuery</i> example, you&#39;re calling <code>localhost:81000</code> and in your <i>fetch</i> one, you&#39;re calling <code>localhost:8100</code>. Is that a typo in the question, or can it be the error you&#39;re trying to find?"}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "reply_to_user": {"reputation": 10997, "user_id": 3358027, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/p6dc8.jpg?s=128&g=1", "display_name": "Buzinas", "link": "https://stackoverflow.com/users/3358027/buzinas"}, "edited": false, "score": 0, "creation_date": 1442940841, "post_id": 32722409, "comment_id": 53287623, "body": "That&#39;s a typo - sorry about that - changing"}, {"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 2, "creation_date": 1442941121, "post_id": 32722409, "comment_id": 53287800, "body": "I don&#39;t know what language your server is, but are you calling <code>w.WriteHeader</code> <i>before</i> setting `Access-Control-Allow-Origin?"}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1442941350, "post_id": 32722409, "comment_id": 53287938, "body": "The language is golang, err - I am  w.WriteHeader(http.StatusOK)"}, {"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 1, "creation_date": 1442942654, "post_id": 32722409, "comment_id": 53288742, "body": "If you rearrange them to set the header before <code>WriteHeader</code>, it will likely work. As it is, you are setting the header on the object after writing to the socket, so the header won&#39;t be sent."}, {"owner": {"reputation": 507123, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1442943735, "post_id": 32722409, "comment_id": 53289344, "body": "Just inspect whether the header really arrives at the client (using devtools, fiddler, etc). If it doesn&#39;t, fix your serverside code."}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1442943944, "post_id": 32722409, "comment_id": 53289449, "body": "^That doesn&#39;t really help me at all - I&#39;m trying to fix my server side code - that&#39;s why the handler is posted there."}], "answers": [{"comments": [{"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1442942259, "post_id": 32722943, "comment_id": 53288514, "body": "That changed the error, I now have a  net::ERR_SSL_PROTOCOL_ERROR - why is that happening?"}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1442942350, "post_id": 32722943, "comment_id": 53288572, "body": "OK, I tried the new version and I get the previous error now."}, {"owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "reply_to_user": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1442942437, "post_id": 32722943, "comment_id": 53288622, "body": "Can you try it without https? The SSL error is unrelated to the CORS issue."}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1442942492, "post_id": 32722943, "comment_id": 53288650, "body": "I did. But I&#39;m back to the &quot;Fetch API cannot load <a href=\"http://localhost:8100/districts/\" rel=\"nofollow noreferrer\">localhost:8100/districts</a>. No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. Origin &#39;<a href=\"http://localhost:8200\" rel=\"nofollow noreferrer\">localhost:8200</a>&#39; is therefore not allowed access.&quot; error after doing r.Header.Get(&#39;origin&#39;)"}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1442942521, "post_id": 32722943, "comment_id": 53288663, "body": "Do I need to add the header before? If that header doesn&#39;t exist."}, {"owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "reply_to_user": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1442942793, "post_id": 32722943, "comment_id": 53288825, "body": "The origin header MUST exist otherwise the browser is non-compliant with HTTP1.1. Firefox, IE, Chrome, Safari and Opera at least all send the Origin header. Can you check in your browser&#39;s Network tab to see if the correct header is indeed sent back?"}, {"owner": {"reputation": 14671, "user_id": 2317490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypoen.png?s=128&g=1", "display_name": "dandavis", "link": "https://stackoverflow.com/users/2317490/dandavis"}, "edited": false, "score": 0, "creation_date": 1442942802, "post_id": 32722943, "comment_id": 53288829, "body": "what web browsers reject &quot;*&quot;, and can you provide a link to an example? (it&#39;s always worked fine for me in FF+CH)"}, {"owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "reply_to_user": {"reputation": 14671, "user_id": 2317490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypoen.png?s=128&g=1", "display_name": "dandavis", "link": "https://stackoverflow.com/users/2317490/dandavis"}, "edited": false, "score": 0, "creation_date": 1442942859, "post_id": 32722943, "comment_id": 53288857, "body": "@dandavis: Chrome and firefox at least. Firefox allows you to accept &quot;*&quot; if you start it with some command line argument"}, {"owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "reply_to_user": {"reputation": 14671, "user_id": 2317490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypoen.png?s=128&g=1", "display_name": "dandavis", "link": "https://stackoverflow.com/users/2317490/dandavis"}, "edited": false, "score": 0, "creation_date": 1442942926, "post_id": 32722943, "comment_id": 53288901, "body": "@dandavis: Note that most middlewares understand &quot;*&quot; as a special flag to re-send the Origin header in Access-control-allow-origin"}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1442943017, "post_id": 32722943, "comment_id": 53288961, "body": "Weird. There is a  districts/ request, which has no Access Control header and the response tab tells me that it has failed to load."}, {"owner": {"reputation": 14671, "user_id": 2317490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypoen.png?s=128&g=1", "display_name": "dandavis", "link": "https://stackoverflow.com/users/2317490/dandavis"}, "edited": false, "score": 0, "creation_date": 1442943061, "post_id": 32722943, "comment_id": 53288981, "body": "@slebetman: no, FF accepts * just fine.ex: <code>fetch(&quot;http:&#47;&#47;maxcdn.bootstrapcdn.com&#47;bootstrap&#47;3.3.5&#47;css&#47;bo&zwnj;&#8203;otstrap.min.css&quot;).th&zwnj;&#8203;en(alert)</code> for example. major CDNs use &quot;*&quot;, so it would be a bit surprising that it didn&#39;t work for anything halfway major..."}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1442943160, "post_id": 32722943, "comment_id": 53289028, "body": "^So I put back the &quot;*&quot; - same problem. I&#39;m now writing statusOk after setting though"}, {"owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "reply_to_user": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1442943315, "post_id": 32722943, "comment_id": 53289113, "body": "@praks5432: Hmm.. then it&#39;s most probably a problem with the fetch function on js"}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1442943662, "post_id": 32722943, "comment_id": 53289315, "body": "what? That can&#39;t be right because isomorphic-fetch is a pretty well used library, it&#39;s more likely I&#39;m screwing up."}], "tags": [], "owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "is_accepted": true, "score": 1, "last_activity_date": 1442942264, "last_edit_date": 1442942264, "creation_date": 1442942063, "answer_id": 32722943, "question_id": 32722409, "link": "https://stackoverflow.com/questions/32722409/access-control-allow-origin-header-not-present-with-fetch-api-call/32722943#32722943", "title": "Access Control Allow Origin header not present with fetch api call", "body": "<p>Almost all web browsers reject the origin <code>\"*\"</code>. Therefore sending <code>\"*\"</code> as the <code>Access-Control-Allow-Origin</code> header results in a same-origin-policy violation.</p>\n\n<p>Fortunately there is a work-around. If you look at the <a href=\"https://github.com/itsjamie/gin-cors/blob/master/cors.go#L155\" rel=\"nofollow\">gin-cors</a> code that handles this, what it does instead is to re-send the <code>\"origin\"</code> header sent by the browser. So to make <code>*</code> work, you'd have to do this:</p>\n\n<pre><code>w.Header().Set(\"Access-Control-Allow-Origin\", r.Header.Get(`origin`))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "is_accepted": false, "score": 0, "last_activity_date": 1442953330, "creation_date": 1442953330, "answer_id": 32726150, "question_id": 32722409, "link": "https://stackoverflow.com/questions/32722409/access-control-allow-origin-header-not-present-with-fetch-api-call/32726150#32726150", "title": "Access Control Allow Origin header not present with fetch api call", "body": "<p>I ended up using this middleware <a href=\"https://github.com/rs/cors\" rel=\"nofollow\">https://github.com/rs/cors</a>, and that got everything working correctly. </p>\n"}], "owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6237, "favorite_count": 0, "accepted_answer_id": 32722943, "answer_count": 2, "score": 2, "last_activity_date": 1442953330, "creation_date": 1442940355, "last_edit_date": 1442943743, "question_id": 32722409, "link": "https://stackoverflow.com/questions/32722409/access-control-allow-origin-header-not-present-with-fetch-api-call", "title": "Access Control Allow Origin header not present with fetch api call", "body": "<p>So I'm trying to use isomorphic-fetch <a href=\"https://www.npmjs.com/package/isomorphic-fetch\" rel=\"nofollow\">https://www.npmjs.com/package/isomorphic-fetch</a></p>\n\n<p>I have a server written in go that is giving back JSON data. This is how I'm making the call -</p>\n\n<pre><code>export function fetchDistricts(geoState) {\n\n    return function (dispatch) {\n        dispatch(requestDistricts(geoState));\n\n\n        return fetch(`http://localhost:8100/districts/`)\n            .then(response =&gt; {console.log(response);})\n            .then(json =&gt; {\n                console.log(\"json\");\n            });\n}\n</code></pre>\n\n<p>I get this error in the chrome console </p>\n\n<pre><code>Fetch API cannot load http://localhost:8100/districts/. No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:8200' is therefore not allowed access.\n</code></pre>\n\n<p>This is weird, because in my handler I am doing this</p>\n\n<pre><code>func getDistricts(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/jsonp;charset=UTF-8\")\n    w.WriteHeader(http.StatusOK)\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    rows, err := db.Query(\"SELECT * from districts\")\n    //other code here\n</code></pre>\n\n<p>Further, this was working </p>\n\n<pre><code>var activitiesDfD =  $.ajax({\n    url: \"http://localhost:8100/district/1/activities\",\n    type: \"GET\",\n    dataType: \"json\"\n});\n\n$.when(activitiesDfD).then(function(data, textStatus, jqXhr) {\n</code></pre>\n\n<p>Why would this fail when using the fetch API and how do I get around this? </p>\n\n<p>Edit-</p>\n\n<p>I've now tried this</p>\n\n<pre><code>func getDistricts(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/jsonp;charset=UTF-8\")\n    w.Header().Set(\"Access-Control-Allow-Origin\", r.Header.Get(`origin`))\n    w.WriteHeader(http.StatusOK)    \n</code></pre>\n\n<p>Incorporating the two suggestions below - but the error is the same. </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7127, "user_id": 247002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1f494e0363428b11d080c35ec3d199ff?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/247002/mark"}, "edited": false, "score": 0, "creation_date": 1442936328, "post_id": 32721097, "comment_id": 53284670, "body": "This works fine. I have tried all kind of weird castings... never thought it could be that easy! Thank you very much!"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 17, "last_activity_date": 1442939494, "last_edit_date": 1442939494, "creation_date": 1442936162, "answer_id": 32721097, "question_id": 32721066, "link": "https://stackoverflow.com/questions/32721066/pass-string-to-a-function-that-expects-a-variadic-parameter/32721097#32721097", "title": "Pass []string to a function that expects a variadic parameter", "body": "<p>You expand the <code>[]string</code> with another <code>...</code></p>\n\n<pre><code>cmd := exec.Command(name, arg...)\n</code></pre>\n\n<p>From the <a href=\"https://golang.org/ref/spec\" rel=\"noreferrer\">language spec</a> on <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"noreferrer\">Passing arguments to ... parameters</a></p>\n\n<blockquote>\n  <p>If the final argument is assignable to a slice type <code>[]T</code>, it may be\n  passed unchanged as the value for a <code>...T</code> parameter if the argument is\n  followed by <code>...</code>. In this case no new slice is created.</p>\n  \n  <p>Given the slice s and call</p>\n\n<pre><code>s := []string{\"James\", \"Jasmine\"}\nGreeting(\"goodbye:\", s...)\n</code></pre>\n  \n  <p>within Greeting, <code>who</code> will have the same value as <code>s</code> with the same underlying array.</p>\n</blockquote>\n"}], "owner": {"reputation": 7127, "user_id": 247002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1f494e0363428b11d080c35ec3d199ff?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/247002/mark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3123, "favorite_count": 1, "accepted_answer_id": 32721097, "answer_count": 1, "score": 3, "last_activity_date": 1442939494, "creation_date": 1442936070, "question_id": 32721066, "link": "https://stackoverflow.com/questions/32721066/pass-string-to-a-function-that-expects-a-variadic-parameter", "title": "Pass []string to a function that expects a variadic parameter", "body": "<p>In order to don't repeat my self over and over I wanted to create a function that handles running some commands. </p>\n\n<pre><code>func runCommand(name string, arg ...string) error {\n    cmd := exec.Command(name, arg)\n    if err := cmd.Run(); err != nil {\n        return err\n    } else {\n        return nil\n    }\n}\n</code></pre>\n\n<p>Once I try to run this I get the following error: </p>\n\n<pre><code>cannot use arg (type []string) as type string in argument to exec.Command\n</code></pre>\n\n<p>I had a look into the implementation of the <a href=\"https://golang.org/src/os/exec/exec.go?s=3999:4044#L112\" rel=\"nofollow\"><code>os.Command</code></a> and it looks that the function signature is exact what I supply. </p>\n\n<p>Internally a <code>[]string</code> should be the same as variadic parameter but for the compiler it seems not. </p>\n\n<p>Is there a way to pass the variadic parameter into the <code>Command</code>?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 0, "creation_date": 1442934281, "post_id": 32720363, "comment_id": 53283110, "body": "But <code>rand.Int63()</code> returns an <code>int64</code> which by definition is 8 bytes, right? How could it possibly need 10?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 3, "creation_date": 1442934443, "post_id": 32720363, "comment_id": 53283233, "body": "@CoreyOgburn: Varint is a variable length encoding. You want <code>ByteOrder.PutUint64</code>, or just <code>binary.Write</code>."}, {"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 0, "creation_date": 1442934807, "post_id": 32720363, "comment_id": 53283517, "body": "I&#39;m questioning my sanity. How can an int64, a 64 bit = 8 byte value result in 10 bytes? &quot;Variable length encoding&quot; sounds like it should be able to store up to 8 bytes, less if it&#39;s a small value."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 0, "creation_date": 1442934891, "post_id": 32720363, "comment_id": 53283583, "body": "@CoreyOgburn See edited answer for an easy variable-length encoding and reasoning for 10 bytes output."}, {"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 0, "creation_date": 1442935950, "post_id": 32720363, "comment_id": 53284419, "body": "I figured the conversion had to be adding something but I was expecting it to behave like <code>ByteOrder.PutUint64</code>. I assumed &quot;Variable Length&quot; meant UP TO 8 bytes. I apparently didn&#39;t read far enough."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1442935241, "last_edit_date": 1442935241, "creation_date": 1442934180, "answer_id": 32720363, "question_id": 32720218, "link": "https://stackoverflow.com/questions/32720218/index-out-of-range-when-using-binary-putvarint/32720363#32720363", "title": "Index Out of Range when using binary.PutVarint(...)", "body": "<p>Quoting the doc of <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"noreferrer\"><code>encoding/binary</code></a>:</p>\n\n<blockquote>\n  <p>The varint functions encode and decode single integer values using a <strong>variable-length encoding</strong>; smaller values require fewer bytes. For a specification, see <a href=\"https://developers.google.com/protocol-buffers/docs/encoding\" rel=\"noreferrer\">https://developers.google.com/protocol-buffers/docs/encoding</a>.</p>\n</blockquote>\n\n<p>So the <a href=\"https://golang.org/pkg/encoding/binary/#PutVarint\" rel=\"noreferrer\"><code>binary.PutVarint()</code></a> is not a fixed, but a variable-length encoding. When passing an <code>int64</code>, it will need more than 8 bytes for large numbers, and less than 8 bytes for small numbers. Since the number you're encoding is a random number, it will have random bits even in its highest byte.</p>\n\n<p>See this simple example:</p>\n\n<pre><code>buffer := make([]byte, 100)\nfor num := int64(1); num &lt; 1&lt;&lt;60; num &lt;&lt;= 4 {\n    count := binary.PutVarint(buffer, num)\n    fmt.Printf(\"Num=%d, bytes=%d\\n\", num, count)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Num=1, bytes=1\nNum=16, bytes=1\nNum=256, bytes=2\nNum=4096, bytes=2\nNum=65536, bytes=3\nNum=1048576, bytes=4\nNum=16777216, bytes=4\nNum=268435456, bytes=5\nNum=4294967296, bytes=5\nNum=68719476736, bytes=6\nNum=1099511627776, bytes=6\nNum=17592186044416, bytes=7\nNum=281474976710656, bytes=8\nNum=4503599627370496, bytes=8\nNum=72057594037927936, bytes=9\n</code></pre>\n\n<p>The essence of variable-length encoding is that small numbers use less bytes, but this can only be achieved if in turn big numbers may use more than 8 bytes (that would be size of <code>int64</code>).</p>\n\n<p>Details of the specific encoding is on the <a href=\"https://developers.google.com/protocol-buffers/docs/encoding\" rel=\"noreferrer\">linked page</a>.</p>\n\n<p>A very easy example would be: A byte is 8 bits. Use 7 bits of the output byte as the \"useful\" bits to encode the data/number. If the highest bit is 1, that means more bytes are required. If highest bit is 0, we're done. You can see that small numbers can be encoded using 1 output byte (e.g. <code>n=10</code>), while we're using 1 extra bit for every 7-bit useful data, so if the input number uses all the 64 bits, we will end up with more than 8 bytes: 10 groups are required to cover 64 bits, so we will need 10 bytes (9 groups is only 9*7=63 bits).</p>\n"}], "owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1362, "favorite_count": 1, "accepted_answer_id": 32720363, "answer_count": 1, "score": 2, "last_activity_date": 1442935241, "creation_date": 1442933748, "question_id": 32720218, "link": "https://stackoverflow.com/questions/32720218/index-out-of-range-when-using-binary-putvarint", "title": "Index Out of Range when using binary.PutVarint(...)", "body": "<p><a href=\"http://play.golang.org/p/RqScJVvpS7\" rel=\"nofollow\">http://play.golang.org/p/RqScJVvpS7</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"encoding/binary\"\n)\n\nfunc main() {\n    buffer := []byte{0, 0, 0, 0, 0, 0, 0, 0}\n    num := rand.Int63()\n    count := binary.PutVarint(buffer, num)\n\n    fmt.Println(count)\n}\n</code></pre>\n\n<p>I had this working awhile ago when <code>num</code> was just an incrementing <code>uint64</code> and I was using <code>binary.PutUvarint</code> but now that it's a random int64 and <code>binary.PutVarint</code> I get an error:</p>\n\n<pre><code>panic: runtime error: index out of range\n\ngoroutine 1 [running]:\nencoding/binary.PutUvarint(0x1042bf58, 0x8, 0x8, 0x6ccb, 0xff9faa4, 0x9acb0442, 0x7fcfd52, 0x4d658221)\n    /usr/local/go/src/encoding/binary/varint.go:44 +0xc0\nencoding/binary.PutVarint(0x1042bf58, 0x8, 0x8, 0x6ccb, 0x7fcfd52, 0x4d658221, 0x14f9e0, 0x104000e0)\n    /usr/local/go/src/encoding/binary/varint.go:83 +0x60\nmain.main()\n    /tmp/sandbox010341234/main.go:12 +0x100\n</code></pre>\n\n<p>What am I missing? I would have thought this to be a trivial change...</p>\n\n<p>EDIT: I just tried extending my buffer array. For some odd reason it works and I get a <code>count</code> of <code>10</code>. How can that be? <code>int64</code> is 64 bits = 8 bytes, right?</p>\n"}, {"tags": ["mongodb", "go", "aggregation-framework", "mgo"], "comments": [{"owner": {"reputation": 901, "user_id": 4175099, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/fM964.jpg?s=128&g=1", "display_name": "faisal_kk", "link": "https://stackoverflow.com/users/4175099/faisal-kk"}, "edited": false, "score": 0, "creation_date": 1442985465, "post_id": 32716402, "comment_id": 53304521, "body": "While bson trying to decode your data it can&#39;t identify &quot;kind&quot; of data. Error is coming from  (d *decoder) readElemTo function  in <a href=\"http://bazaar.launchpad.net/+branch/mgo/v1/view/head:/bson/decode.go.Your\" rel=\"nofollow noreferrer\">bazaar.launchpad.net/+branch/mgo/v1/view/head:/bson/&hellip;</a> data seems not compatible with any bson types ."}], "answers": [{"tags": [], "owner": {"reputation": 18455, "user_id": 2657550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88d553accfca32636d96a8d5075e85d1?s=128&d=identicon&r=PG", "display_name": "Gustavo Niemeyer", "link": "https://stackoverflow.com/users/2657550/gustavo-niemeyer"}, "is_accepted": false, "score": 1, "last_activity_date": 1444835452, "creation_date": 1444835452, "answer_id": 33129119, "question_id": 32716402, "link": "https://stackoverflow.com/questions/32716402/mgo-unwind-aggregation-result-to-unknown-element-kind-0x2e/33129119#33129119", "title": "mgo $unwind aggregation result to Unknown element kind (0x2E)", "body": "<p>The error returned is pointing out that the data being handed to the driver has an unknown element kind. Looking at the BSON specification, there's indeed no <code>0x2E</code> element kind in there:</p>\n\n<p><a href=\"http://bsonspec.org/spec.html\" rel=\"nofollow\">http://bsonspec.org/spec.html</a></p>\n\n<p>If you think this is an issue in the driver, can you please provide a dump of the offending data that can be loaded into the driver, and open an issue with it?</p>\n\n<p>Thank you.</p>\n"}], "owner": {"reputation": 1763, "user_id": 1175415, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9d2e16819b10749cd775f0dfc5db1635?s=128&d=identicon&r=PG", "display_name": "Hokutosei", "link": "https://stackoverflow.com/users/1175415/hokutosei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1049, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1444835452, "creation_date": 1442923355, "question_id": 32716402, "link": "https://stackoverflow.com/questions/32716402/mgo-unwind-aggregation-result-to-unknown-element-kind-0x2e", "title": "mgo $unwind aggregation result to Unknown element kind (0x2E)", "body": "<p>I have an aggregate query like this</p>\n\n<p><code>$ db.histories.aggregate([{$match:{\"issue_id\":{$in:ids},\"history_comment\":{$exists:true,$not:{$size:0}}}},{$unwind:\"$history_comment\"}])</code></p>\n\n<p>translating this to <code>go</code> using <code>mgo</code></p>\n\n<pre><code>    var h []History\nquery := []bson.M{\n    {\"$match\": bson.M{\n        \"issue_id\":        bson.M{\"$in\": IDs},\n        \"history_comment\": bson.M{\"$exists\": true, \"$not\": bson.M{\"$size\": 0}}}},\n    {\"$unwind\": \"$history_comment\"},\n\n}\n\nerr := c.Pipe(query).All(&amp;h)\n</code></pre>\n\n<p>but I received an <code>err</code></p>\n\n<p><code>Unknown element kind (0x2E)</code>\nhow is this possible? is my query wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1442920356, "post_id": 32715166, "comment_id": 53272892, "body": "Have you tried printing your <code>buf</code>? Are you sure that <code>}{</code> is there?"}, {"owner": {"reputation": 1366, "user_id": 4931643, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/702807200eaef92e4d1c6896893d7888?s=128&d=identicon&r=PG&f=1", "display_name": "Mbded", "link": "https://stackoverflow.com/users/4931643/mbded"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1442920499, "post_id": 32715166, "comment_id": 53272986, "body": "Yes ofcorse for example to try I use <code>fmt.Printf(string(buf))</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1366, "user_id": 4931643, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/702807200eaef92e4d1c6896893d7888?s=128&d=identicon&r=PG&f=1", "display_name": "Mbded", "link": "https://stackoverflow.com/users/4931643/mbded"}, "edited": false, "score": 0, "creation_date": 1442923636, "post_id": 32716043, "comment_id": 53275154, "body": "Yes this is problem... because Your example working, if attachment in program is directly to some variable as I said before. If <code>datas</code> ware received from server this example not works. I also try compare received data  to <code>v := []byte(&#39;\\x7B\\x7D&#39;)</code> but also not works."}], "tags": [], "owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "is_accepted": false, "score": 2, "last_activity_date": 1442924469, "last_edit_date": 1442924469, "creation_date": 1442922460, "answer_id": 32716043, "question_id": 32715166, "link": "https://stackoverflow.com/questions/32715166/golang-and-not-working-function-bytes-contains/32716043#32716043", "title": "Golang and not working function bytes.Contains()", "body": "<p>There is a problem with you code missing some brackets etc. This seems to work : </p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n)\n\nconst data = `{\"abc\":[{\"b\":5,\"bca\":14,\"xyz\":0}]}{\"abc\":[{\"b\":7,\"hjk\":14,\"qwe\":0}]}`\n\nfunc main() {\n\n    buf := []byte(data)\n    fmt.Printf(\"buf = %s\\n\", string(buf))\n\n    if bytes.Contains(buf, []byte(\"}{\")) {\n        fmt.Printf(\"I got you\\n\")\n    }\n\n}\n</code></pre>\n\n<p>There may be an encoding problem receiving the data in your connected application, thats a tricky one to show and I have resorted to printing the hex vals of received data on occasion to really see what came across the wire.</p>\n\n<p>EDIT : </p>\n\n<p>Try to print out the received data like this : </p>\n\n<pre><code>for _, b := range buf {\n    fmt.Printf(\"%X \", b)\n}\n</code></pre>\n\n<p>And then compare with the test data to see if there are differences, this is as you say the only place it could go wrong ?</p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 9, "last_activity_date": 1442926416, "last_edit_date": 1442926416, "creation_date": 1442925732, "answer_id": 32717193, "question_id": 32715166, "link": "https://stackoverflow.com/questions/32715166/golang-and-not-working-function-bytes-contains/32717193#32717193", "title": "Golang and not working function bytes.Contains()", "body": "<p>Do you actually check <code>err</code> and <code>Len</code> after <code>c.conn.Read(buf)</code> finishes?</p>\n\n<p>The chief flaw in your program (as presented) is that you're using <code>buf</code> to search for data while the read operation on your socket is free to return successfuuly after receiving any number of bytes between 1 and 1024, and return with an error after receiving any number of bytes between 0 and 1024.</p>\n\n<p>So, you <em>must</em> do two things:</p>\n\n<ul>\n<li><a href=\"http://golang.org/pkg/io#Reader\">Check for error</a>;</li>\n<li>To access the <em>actual</em> data available at the beginning of the buffer after the read operation ends you have to use the actual length of data, <code>Len</code>.</li>\n</ul>\n\n<p>To do the latter, you usually construct a new slice:</p>\n\n<pre><code>data := buf[:Len]\n</code></pre>\n\n<p>And then use the <code>data</code> variable:</p>\n\n<pre><code>if bytes.Contains(data, []byte(\"}{\")) {\n   ...\n}\n</code></pre>\n\n<p>If you don't do this, you might easily access stale data in your buffer &mdash; that is, the data left there from the previous call to <code>c.conn.Read(buf)</code>.</p>\n\n<p>If you'll think of the situation a bit more, you'll see that nothing guarantees that the next call to <code>Read()</code> on your socket will bring the <code>}{</code> sequence into the buffer, and you have to be prepared for <em>accumulating</em> your data: that is,</p>\n\n<ol>\n<li><p>Each call to <code>Read()</code> should add its <code>Len</code> bytes to the number of bytes in the buffer to consider by your code.</p>\n\n<p>This means that if the Nth read operation failed to provide the data you're looking for, the (N+1)th operation must put its bytes right after the last byte of the previous read operation; in Go, this typically means constructing another slice for that next read operation.</p></li>\n<li><p>You should use the total current number of accumulated bytes to search for \"}{\".</p></li>\n</ol>\n\n<p>Please consider starting with <a href=\"https://jan.newmarch.name/go/\">this book</a> to grasp the basics of networking programming (with Go specifics).</p>\n\n<hr>\n\n<p>As you can see, properly dealing with this task looks complicated.\nSo why not let Go do buffering itself?</p>\n\n<p>You could restate your algorythm like this:</p>\n\n<ol>\n<li><p>Read the input data until a <code>}</code> character is found.  Accumulate this data.</p></li>\n<li><p>Once <code>}</code> is found, read the next character and if it's a <code>{</code>, we've found the spot we're interested in.</p>\n\n<p>Otherwise return to step (1).</p></li>\n</ol>\n\n<p>This is doable using <code>bytes.Buffer</code> and its methods:</p>\n\n<ul>\n<li><code>ReadBytes(delim byte)</code> &mdash; for reading up to a <code>}</code> byte.</li>\n<li><code>ReadByte()</code> &mdash; for reading a single byte to check if a <code>{</code> follows.</li>\n<li><code>UnreadByte(c byte)</code> &mdash; for putting the byte back into the buffer if it's not a <code>{</code> following <code>}</code>.</li>\n</ul>\n\n<hr>\n\n<p>Now let's look at your problem from a more general perspective.\nThe data you've presented in your example looks like a series of JSON objects to me.  So why are you trying to apply some low-tech approach for finding boundaries between those objects instead of just using <a href=\"http://golang.org/pkg/encoding/json\">JSON decoder</a> to decode your data right away or at least <em>properly</em> skip over objects in the stream?</p>\n"}], "owner": {"reputation": 1366, "user_id": 4931643, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/702807200eaef92e4d1c6896893d7888?s=128&d=identicon&r=PG&f=1", "display_name": "Mbded", "link": "https://stackoverflow.com/users/4931643/mbded"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4001, "favorite_count": 0, "accepted_answer_id": 32717193, "answer_count": 2, "score": -1, "last_activity_date": 1555730747, "creation_date": 1442919738, "last_edit_date": 1442931184, "question_id": 32715166, "link": "https://stackoverflow.com/questions/32715166/golang-and-not-working-function-bytes-contains", "title": "Golang and not working function bytes.Contains()", "body": "<p>I have strange problem with function <code>bytes.Contains(b, subslice []byte) bool</code>. It doesn't find characters in byte array which was received in function <code>(c *IPConn) Read(b []byte) (int, error)</code>. Application is a simple server. \nSo I have byte array, which was received via server to variable <code>buf</code></p>\n\n<pre><code>buf := make([]byte, 1024)\nLen, err := c.conn.Read(buf)\n// below received content in buf\n//{\"abc\":[{\"b\":5,\"bca\":14,\"xyz\":0}]}{\"abc\":[{\"b\":7,\"hjk\":14,\"qwe\":0}]}\n</code></pre>\n\n<p>Now I wanted use below function to find <strong>}{</strong> characters in array  <strong>buf</strong></p>\n\n<pre><code>if bytes.Contains(buf, []byte(`}{`) != false {\n    fmt.Printf(\"I got you\")\n}\n</code></pre>\n\n<p>But function always return false. Why ?</p>\n\n<p>I did some experiment in my program as below:</p>\n\n<pre><code>worker := []byte('{\"abc\":[{\"b\":5,\"bca\":14,\"xyz\":0}]}{\"abc\":[{\"b\":7,\"hjk\":14,\"qwe\":0}]}')\n\n// try find }{\n\nif bytes.Contains(worker, []byte(`}{`) != false {\n    fmt.Printf(\"I got you\")\n}\n</code></pre>\n\n<p><strong>is CORRECT !!!</strong> I do not understand this... because it fallows that contents must be different between data which was received via server, and data form usually attachment in program.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 2, "creation_date": 1442916429, "post_id": 32710847, "comment_id": 53270429, "body": "Clearly EOF, <code>Content-Length</code> is a header that the client can or cannot set."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1442934413, "post_id": 32710847, "comment_id": 53283209, "body": "Don&#39;t muck with the string value of errors. If you&#39;re looking for <code>io.EOF</code> then do <code>if err == io.EOF</code>. Looking at the string representation is at best incredibly fragile."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 36, "last_activity_date": 1442929738, "last_edit_date": 1442929738, "creation_date": 1442928193, "answer_id": 32718077, "question_id": 32710847, "link": "https://stackoverflow.com/questions/32710847/what-is-the-best-way-to-check-for-empty-request-body/32718077#32718077", "title": "What is the best way to check for empty request Body?", "body": "<p>You always need to read the body to know what the contents are. The client could send the body in chunked encoding with no <code>Content-Length</code>, or it could even have an error and send a <code>Content-Length</code> and no body. The client is never obligated to send what it says it's going to send.</p>\n\n<p>The <code>EOF</code> check can work if you're only checking for the empty body, but I would still also check for other error cases besides the <code>EOF</code> string.</p>\n\n<pre><code>err := json.NewDecoder(r.Body).Decode(input)\nswitch {\ncase err == io.EOF:\n    // empty body\ncase err != nil:\n    // other error\n}\n</code></pre>\n\n<p>You can also read the entire body before unmarshalling:</p>\n\n<pre><code>body, err := ioutil.ReadAll(r.Body)\n</code></pre>\n\n<p>or if you're worried about too much data</p>\n\n<pre><code>body, err := ioutil.ReadAll(io.LimitReader(r.Body, readLimit))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3659, "user_id": 2080324, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/137499a9336eeb82972414ee5b3efa62?s=128&d=identicon&r=PG", "display_name": "Rudi Strydom", "link": "https://stackoverflow.com/users/2080324/rudi-strydom"}, "edited": false, "score": 0, "creation_date": 1610801537, "post_id": 57278223, "comment_id": 116249383, "body": "Worked like a charm thanks!"}], "tags": [], "owner": {"reputation": 109, "user_id": 6821206, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9z7Ztb7DEtk/AAAAAAAAAAI/AAAAAAAAAI4/c09eHV1_kN4/photo.jpg?sz=128", "display_name": "Muhammad Salem", "link": "https://stackoverflow.com/users/6821206/muhammad-salem"}, "is_accepted": false, "score": 10, "last_activity_date": 1564512295, "creation_date": 1564512295, "answer_id": 57278223, "question_id": 32710847, "link": "https://stackoverflow.com/questions/32710847/what-is-the-best-way-to-check-for-empty-request-body/57278223#57278223", "title": "What is the best way to check for empty request Body?", "body": "<pre><code>if http.Request().Body == http.NoBody {\n  // TODO.\n}\n</code></pre>\n"}], "owner": {"reputation": 1260, "user_id": 840419, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/94d4a370033a41eea3288ed269784339?s=128&d=identicon&r=PG", "display_name": "Sanath Ballal", "link": "https://stackoverflow.com/users/840419/sanath-ballal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18668, "favorite_count": 6, "accepted_answer_id": 32718077, "answer_count": 2, "score": 23, "last_activity_date": 1564512295, "creation_date": 1442906896, "last_edit_date": 1444076012, "question_id": 32710847, "link": "https://stackoverflow.com/questions/32710847/what-is-the-best-way-to-check-for-empty-request-body", "title": "What is the best way to check for empty request Body?", "body": "<p>From the <a href=\"https://golang.org/src/net/http/request.go\" rel=\"noreferrer\">documentation</a> it states that </p>\n\n<blockquote>\n  <p>For server requests the Request Body is always non-nil but will return EOF immediately when no body is present.</p>\n</blockquote>\n\n<p>For ContentLength, the documentation states</p>\n\n<blockquote>\n  <p>For client requests, a value of 0 means <strong>unknown</strong> if Body is not nil.</p>\n</blockquote>\n\n<p>So is it better to check for ContentLength </p>\n\n<pre><code>r *http.Request\nif r.ContentLength == 0 {\n  //empty body\n}\n</code></pre>\n\n<p>or to check EOF</p>\n\n<pre><code>type Input struct {\n    Name *string `json:\"name\"`\n}\n\ninput := new(Input)\n\nif err := json.NewDecoder(r.Body).Decode(input); err.Error() == \"EOF\" {\n //empty body\n}\n</code></pre>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 2, "creation_date": 1442904091, "post_id": 32709804, "comment_id": 53262808, "body": "What error message are you seeing in err?"}, {"owner": {"reputation": 359, "user_id": 706495, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/873ec31f6bf9b96a77768f01fe3b9cb3?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/706495/mike"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1442919641, "post_id": 32709804, "comment_id": 53272453, "body": "Found that the sql.Open is fine but I couldn&#39;t create user.  Here&#39;s the full code at <a href=\"https://github.com/mjwong/chitchat\" rel=\"nofollow noreferrer\">github</a>"}, {"owner": {"reputation": 359, "user_id": 706495, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/873ec31f6bf9b96a77768f01fe3b9cb3?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/706495/mike"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1442923582, "post_id": 32709804, "comment_id": 53275121, "body": "Problem solved but I think there is a better way. Here it is: 1) Grant access to database     GRANT all privileges on database chitchat to tom;  2) List all sequences in chitchat database     SELECT c.relname FROM pg_class c WHERE c.relkind = &#39;S&#39;;  3) Grant access to each of them      GRANT all privileges on sequence users_id_seq to tom;     GRANT all privileges on sequence threads_id_seq to tom;     GRANT all privileges on sequence posts_id_seq to tom;     GRANT all privileges on sequence sessions_id_seq to tom;"}], "answers": [{"comments": [{"owner": {"reputation": 359, "user_id": 706495, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/873ec31f6bf9b96a77768f01fe3b9cb3?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/706495/mike"}, "edited": false, "score": 0, "creation_date": 1442917056, "post_id": 32710012, "comment_id": 53270813, "body": "Thanks man! Retried several times and it finally worked. I removed the exclamation mark &#39;!&#39; in the password though."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 359, "user_id": 706495, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/873ec31f6bf9b96a77768f01fe3b9cb3?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/706495/mike"}, "edited": false, "score": 0, "creation_date": 1442918419, "post_id": 32710012, "comment_id": 53271689, "body": "@Mike yes, it was just an example (which included a &#39;!&#39;)"}, {"owner": {"reputation": 359, "user_id": 706495, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/873ec31f6bf9b96a77768f01fe3b9cb3?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/706495/mike"}, "edited": false, "score": 0, "creation_date": 1442919999, "post_id": 32710012, "comment_id": 53272682, "body": "Pls see the code link. I managed to get it to work using the <a href=\"https://github.com/go-gorp/gorp\" rel=\"nofollow noreferrer\">go-gorp</a> test but still facing problems with the chitchat code above."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 359, "user_id": 706495, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/873ec31f6bf9b96a77768f01fe3b9cb3?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/706495/mike"}, "edited": false, "score": 0, "creation_date": 1442923123, "post_id": 32710012, "comment_id": 53274791, "body": "@Mike Let&#39;s close this question first: you can open a new one with the exact error you see with your code."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 11, "last_activity_date": 1584452141, "last_edit_date": 1584452141, "creation_date": 1442903866, "answer_id": 32710012, "question_id": 32709804, "link": "https://stackoverflow.com/questions/32709804/how-to-open-db-connection-with-user-and-password/32710012#32710012", "title": "How to open db connection with user and password", "body": "<p>You can see examples in <a href=\"https://github.com/lib/pq/blob/93e9980741c9e593411b94e07d5bad8cfb4809db/doc.go\" rel=\"nofollow noreferrer\">lib/pq/doc.go</a> or <a href=\"https://github.com/murz/dat\" rel=\"nofollow noreferrer\">murz/dat</a> (which uses lib/pq):</p>\n\n<pre><code>db, err := sql.Open(\"postgres\", \"user=pqgotest dbname=pqgotest sslmode=verify-full\")\ndb, err := sql.Open(\"postgres\", \"dbname=dat_test user=dat password=!test host=localhost sslmode=disable\")\n</code></pre>\n\n<blockquote>\n  <p>You can also connect to a database using a URL. For example:</p>\n</blockquote>\n\n<pre><code>db, err := sql.Open(\"postgres\", \"postgres://pqgotest:password@localhost/pqgotest?sslmode=verify-full\")\n</code></pre>\n\n<hr>\n\n<p>The OP proposes:</p>\n\n<blockquote>\n  <ol>\n  <li>Grant access to database<br>\n  <code>GRANT all privileges on database chitchat to tom;</code> </li>\n  <li>List all sequences in <code>chitchat</code> database:<br>\n  <code>SELECT c.relname FROM pg_class c WHERE c.relkind = 'S';</code> </li>\n  <li>Grant access to each of them<br>\n  <code>GRANT all privileges on sequence users_id_seq to tom;</code><br>\n  <code>GRANT all privileges on sequence threads_id_seq to tom;</code><br>\n  <code>GRANT all privileges on sequence posts_id_seq to tom;</code><br>\n  <code>GRANT all privileges on sequence sessions_id_seq to tom;</code></li>\n  </ol>\n</blockquote>\n"}], "owner": {"reputation": 359, "user_id": 706495, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/873ec31f6bf9b96a77768f01fe3b9cb3?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/706495/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6236, "favorite_count": 3, "answer_count": 1, "score": 3, "last_activity_date": 1594142210, "creation_date": 1442903170, "last_edit_date": 1594142210, "question_id": 32709804, "link": "https://stackoverflow.com/questions/32709804/how-to-open-db-connection-with-user-and-password", "title": "How to open db connection with user and password", "body": "<p>How do I include postgresql username and password in the sql.Open command in golang? The below doesn't seem to work. Thanks!</p>\n\n<pre><code>func db() (database *sql.DB) {\n    database, err := sql.Open(\"postgres\", \"dbname=chitchat user=tom password=tomtom sslmode=disable\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    return\n}\n</code></pre>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1442898394, "post_id": 32708717, "comment_id": 53260577, "body": "You want to make an example that works, or at least compiles, <a href=\"http://play.golang.org/p/ywOPSds8zQ\" rel=\"nofollow noreferrer\">like this</a>. <code>Unmarshal</code> will return an error when the input is not valid JSON (like, change <code>false</code> to <code>hello</code>, or remove the close brace)."}, {"owner": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "edited": false, "score": 0, "creation_date": 1442903655, "post_id": 32708717, "comment_id": 53262599, "body": "It&#39;s all open source, you can always check Unmarshal&#39;s implementation too: <a href=\"https://golang.org/src/encoding/json/decode.go?s=2621:2669#L64\" rel=\"nofollow noreferrer\">golang.org/src/encoding/json/decode.go?s=2621:2669#L64</a> (and checkValid: <a href=\"https://golang.org/src/encoding/json/scanner.go?s=732:781#L16\" rel=\"nofollow noreferrer\">golang.org/src/encoding/json/scanner.go?s=732:781#L16</a>)"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 27, "last_activity_date": 1603993598, "last_edit_date": 1603993598, "creation_date": 1442900230, "answer_id": 32709117, "question_id": 32708717, "link": "https://stackoverflow.com/questions/32708717/go-when-will-json-unmarshal-to-struct-return-error/32709117#32709117", "title": "Go : When will json.Unmarshal to struct return error?", "body": "<p>The JSON decoder does not report an error if values in the source do not correspond to values in the target. For example, it's not an error if the source contains the field &quot;status&quot;, but the target does not.</p>\n<p>The Unmarshal function does return errors in other situations.</p>\n<p>Syntax error</p>\n<pre><code>type A struct {\n    Name string `json:&quot;name&quot;`\n}\ndata = []byte(`{&quot;name&quot;:what?}`)\nerr = json.Unmarshal(data, &amp;a)\nfmt.Println(err)  // prints character 'w' looking for beginning of value\n</code></pre>\n<p>JSON value not representable by target type:</p>\n<pre><code>data := []byte(`{&quot;name&quot;:false}`)\ntype B struct {\n  Name string `json:&quot;name&quot;`\n}\nvar b B\nerr = json.Unmarshal(data, &amp;b)\nfmt.Println(err) // prints cannot unmarshal bool into Go value of type string\n</code></pre>\n<p>(This is one example of where the value cannot be represented by target type.  There are more.)</p>\n<p><a href=\"http://play.golang.org/p/Z37o-Y9BVI\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 9, "last_activity_date": 1557481630, "last_edit_date": 1557481630, "creation_date": 1442902880, "answer_id": 32709715, "question_id": 32708717, "link": "https://stackoverflow.com/questions/32708717/go-when-will-json-unmarshal-to-struct-return-error/32709715#32709715", "title": "Go : When will json.Unmarshal to struct return error?", "body": "<p>And more examples when <code>json.Unmarshal()</code> returns an error (besides specifying an invalid JSON):</p>\n\n<p>Specifying a <code>nil</code> or <code>empty</code> slice:</p>\n\n<pre><code>i := 0\nerr := json.Unmarshal(nil, &amp;i)\nfmt.Println(err) // unexpected end of JSON input\n</code></pre>\n\n<p>Specifying a non-pointer to unmarshal into:</p>\n\n<pre><code>err = json.Unmarshal([]byte(`{\"name\":\"a\"}`), i)\nfmt.Println(err) // json: Unmarshal(non-pointer int)\n</code></pre>\n\n<p>Specifying <code>nil</code> as the target pointer:</p>\n\n<pre><code>err = json.Unmarshal([]byte(`{\"name\":\"a\"}`), nil)\nfmt.Println(err) // json: Unmarshal(nil)\n</code></pre>\n\n<p>Specifying JSON numbers that would overflow the target type. Quoting the doc of <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\"><code>json.Unmarshal()</code></a>:</p>\n\n<blockquote>\n  <p>If a JSON value is not appropriate for a given target type, or if a JSON number overflows the target type, Unmarshal skips that field and completes the unmarshalling as best it can. If no more serious errors are encountered, Unmarshal returns an UnmarshalTypeError describing the earliest such error.</p>\n</blockquote>\n\n<p>To demonstrate this:</p>\n\n<pre><code>var j int8\nerr = json.Unmarshal([]byte(`1112`), &amp;j)\nfmt.Println(err) // json: cannot unmarshal number 1112 into Go value of type int8\n</code></pre>\n\n<p>Or when trying to parse something as a <code>time.Time</code> which is not an RFC3339 timestamp:</p>\n\n<pre><code>var t time.Time\nerr = json.Unmarshal([]byte(`\"xx\"`), &amp;t)\nfmt.Println(err) // parsing time \"\"xx\"\" as \"\"2006-01-02T15:04:05Z07:00\"\": cannot parse \"xx\"\" as \"2006\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 143, "user_id": 4364418, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QQZ9w.png?s=128&g=1", "display_name": "Czeslaw", "link": "https://stackoverflow.com/users/4364418/czeslaw"}, "is_accepted": false, "score": 2, "last_activity_date": 1516080886, "last_edit_date": 1516080886, "creation_date": 1516067172, "answer_id": 48273008, "question_id": 32708717, "link": "https://stackoverflow.com/questions/32708717/go-when-will-json-unmarshal-to-struct-return-error/48273008#48273008", "title": "Go : When will json.Unmarshal to struct return error?", "body": "<p>To add to icza's answer, you can also get an error if you try to Unmarshal into a typed nil pointer. This can happen if, for example, you make a slice of pointers to a particular type, then try and unmarshal into a particular one of those pointers.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype Example struct {Name string}\n\n\nfunc main() {\n        exs := make([]*Example, 5)\n        err := json.Unmarshal([]byte(`{\"name\":\"jane\"}`), exs[0])\n        fmt.Println(err)\n}\n// json: Unmarshal(nil *main.Example)\n</code></pre>\n"}], "owner": {"reputation": 1057, "user_id": 1750407, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/EobHJ.jpg?s=128&g=1", "display_name": "Wendy Adi", "link": "https://stackoverflow.com/users/1750407/wendy-adi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 24140, "favorite_count": 4, "accepted_answer_id": 32709117, "answer_count": 3, "score": 19, "last_activity_date": 1603993598, "creation_date": 1442898117, "last_edit_date": 1535994244, "question_id": 32708717, "link": "https://stackoverflow.com/questions/32708717/go-when-will-json-unmarshal-to-struct-return-error", "title": "Go : When will json.Unmarshal to struct return error?", "body": "<p>Assume i have a struct like</p>\n\n<pre><code>type A struct{\n  name string`json:\"name\"`\n}\n</code></pre>\n\n<p>Then in main i have code</p>\n\n<pre><code>var jsonString string = `{\"status\":false}`\nvar a A\nerror := json.Unmarshal([]byte(jsonString),&amp;a)\n</code></pre>\n\n<p>apparently the code above produce a nil error, regardless the json format is different. When will json.Unmarshal() return error in Go?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1406, "user_id": 1854658, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/3b07d0a414b016337c53121936ca9afb?s=128&d=identicon&r=PG", "display_name": "jimjampez", "link": "https://stackoverflow.com/users/1854658/jimjampez"}, "edited": false, "score": 0, "creation_date": 1442878235, "post_id": 32706023, "comment_id": 53255691, "body": "I edited my question as I forgot to mention that it&#39;s of arbitrary depth; for example, towns could be broken down into something arbitrary like zip/post code, road, etc; so it is not fixed."}, {"owner": {"reputation": 1406, "user_id": 1854658, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/3b07d0a414b016337c53121936ca9afb?s=128&d=identicon&r=PG", "display_name": "jimjampez", "link": "https://stackoverflow.com/users/1854658/jimjampez"}, "edited": false, "score": 0, "creation_date": 1442878273, "post_id": 32706023, "comment_id": 53255699, "body": "I think I&#39;m nearly got my solution using <code>map[string]interface{}</code>; just discovered <code>interface{}</code>"}, {"owner": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "reply_to_user": {"reputation": 1406, "user_id": 1854658, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/3b07d0a414b016337c53121936ca9afb?s=128&d=identicon&r=PG", "display_name": "jimjampez", "link": "https://stackoverflow.com/users/1854658/jimjampez"}, "edited": false, "score": 1, "creation_date": 1442878691, "post_id": 32706023, "comment_id": 53255808, "body": "@jimjampez if you&#39;re new to Go, make sure you fully understand what you&#39;re doing when you use <code>interface{}</code>. Avoid it if possible."}, {"owner": {"reputation": 1406, "user_id": 1854658, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/3b07d0a414b016337c53121936ca9afb?s=128&d=identicon&r=PG", "display_name": "jimjampez", "link": "https://stackoverflow.com/users/1854658/jimjampez"}, "edited": false, "score": 0, "creation_date": 1442879030, "post_id": 32706023, "comment_id": 53255887, "body": "It is Go&#39;s equivalent to <code>void*</code> in C?"}, {"owner": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "edited": false, "score": 1, "creation_date": 1442879385, "post_id": 32706023, "comment_id": 53255971, "body": "Kind of. <a href=\"http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go\" rel=\"nofollow noreferrer\">This document</a> discusses it. But if you know the types and structure of what you&#39;re going to have you should let the type system work for you and not check things at runtime with type assertions. I missed that you said that it&#39;s of arbitrary depth but it&#39;s something to be aware of."}], "tags": [], "owner": {"reputation": 11133, "user_id": 4275347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CdbsN.jpg?s=128&g=1", "display_name": "Michael Laszlo", "link": "https://stackoverflow.com/users/4275347/michael-laszlo"}, "is_accepted": false, "score": 2, "last_activity_date": 1442879514, "last_edit_date": 1442879514, "creation_date": 1442877655, "answer_id": 32706023, "question_id": 32705948, "link": "https://stackoverflow.com/questions/32705948/n-ary-tree-in-go/32706023#32706023", "title": "N-ary tree in Go", "body": "<p>Let's review the hierarchy.</p>\n\n<ul>\n<li><p>At the top level, you map country names to country objects.</p></li>\n<li><p>Each country object maps area names to area objects.</p></li>\n<li><p>Each area object maps town names to town objects.</p></li>\n</ul>\n\n<p>In Go, you can implement each level of the hierarchy as a <code>map[string]*Something</code>, with the last level consisting of <code>Town</code> objects that contain various information about towns:</p>\n\n<pre><code>type Country map[string]*Area\n\ntype Area map[string]*Town\n\ntype Town struct {\n    Name                string\n    Population          int\n    Latitude, Longitude float64\n}\n</code></pre>\n\n<p>The sample hierarchy that you've given in your question would then look like this:</p>\n\n<pre><code>countries := map[string]*Country{\n    \"country1\": &amp;Country{\n        \"area1\": &amp;Area{\n            \"town1\": &amp;Town{},\n            \"town2\": &amp;Town{},\n        },\n        \"area2\": &amp;Area{\n            \"town3\": &amp;Town{},\n        },\n    },\n}\n</code></pre>\n\n<p>If you don't want to map to concrete types, you can use <code>map[string]interface{}</code>, but then you'll need type assertions to work with the values. Here is a code sample taken from Zack Bloom's article on <a href=\"https://eager.io/blog/go-and-json/\" rel=\"nofollow\">Go and JSON</a>:</p>\n\n<pre><code>var parsed map[string]interface{}\ndata := []byte(`\n    {\n        \"id\": \"k34rAT4\",\n        \"age\": 24\n    }\n`)\nerr := json.Unmarshal(data, &amp;parsed)\nidString := parsed[\"id\"].(string)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1406, "user_id": 1854658, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/3b07d0a414b016337c53121936ca9afb?s=128&d=identicon&r=PG", "display_name": "jimjampez", "link": "https://stackoverflow.com/users/1854658/jimjampez"}, "edited": false, "score": 0, "creation_date": 1442880719, "post_id": 32706212, "comment_id": 53256285, "body": "How do you marshal it to JSON? I tried this but doesn&#39;t work! <a href=\"https://play.golang.org/p/ActW53nDLP\" rel=\"nofollow noreferrer\">play.golang.org/p/ActW53nDLP</a>"}, {"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "reply_to_user": {"reputation": 1406, "user_id": 1854658, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/3b07d0a414b016337c53121936ca9afb?s=128&d=identicon&r=PG", "display_name": "jimjampez", "link": "https://stackoverflow.com/users/1854658/jimjampez"}, "edited": false, "score": 2, "creation_date": 1442881480, "post_id": 32706212, "comment_id": 53256463, "body": "JSON won&#39;t marshal unexported fields.  Be sure to capitalize everything you want in the JSON output:  <a href=\"https://play.golang.org/p/s_Z56r620F\" rel=\"nofollow noreferrer\">play.golang.org/p/s_Z56r620F</a>"}], "tags": [], "owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "is_accepted": true, "score": 3, "last_activity_date": 1442879127, "creation_date": 1442879127, "answer_id": 32706212, "question_id": 32705948, "link": "https://stackoverflow.com/questions/32705948/n-ary-tree-in-go/32706212#32706212", "title": "N-ary tree in Go", "body": "<p>If you're going to have arbitrary depth, then it might be worth it to create a default struct that can be nested:</p>\n\n<pre><code>type area struct {\n    Name string\n    //Any other area info\n    Sections []*area\n}\n</code></pre>\n\n<p>Slices of pointers aren't initialized when creating a new struct object, so it's a valid construct.  Declare <code>a.Sections = new([]*area)</code> and append <code>area</code> pointers to it.  You will have <code>len(a.Sections)</code> or a <code>for range</code> loop for use in the tree traversal.  </p>\n\n<p>Parsing and traversal would be coded recursively, so you would need a type identifier if you treat different areas in different ways.</p>\n"}], "owner": {"reputation": 1406, "user_id": 1854658, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/3b07d0a414b016337c53121936ca9afb?s=128&d=identicon&r=PG", "display_name": "jimjampez", "link": "https://stackoverflow.com/users/1854658/jimjampez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1035, "favorite_count": 0, "accepted_answer_id": 32706212, "answer_count": 2, "score": 1, "last_activity_date": 1442879678, "creation_date": 1442877092, "last_edit_date": 1442879678, "question_id": 32705948, "link": "https://stackoverflow.com/questions/32705948/n-ary-tree-in-go", "title": "N-ary tree in Go", "body": "<p>I am evaluating Go to replace Node.js infrastructure and I am not sure how to create a structure to represent a N-ary tree.</p>\n\n<p>In JavaScript, I parse a file to build up a hierarchy of geographic locations of arbitrary depth. Here is an example:</p>\n\n<pre><code>{\n  'country1': {\n    'area1': {\n      'town1': {}, \n      'town2': {}\n    },\n    'area2': {\n      'town3': {}\n    }\n  }\n}\n</code></pre>\n\n<p>Towns could expand into specific roads and so on. The hierarchy doesn't have a fixed depth.</p>\n\n<p>How can I create an equivalent structure in Go?</p>\n"}, {"tags": ["go", "timer"], "comments": [{"owner": {"reputation": 19225, "user_id": 53926, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4df1cfae6e8c7fbdb013818785318aa7?s=128&d=identicon&r=PG", "display_name": "Xavi", "link": "https://stackoverflow.com/users/53926/xavi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442879061, "post_id": 32705582, "comment_id": 53255898, "body": "Whoops, thanks for the heads up."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1442880742, "post_id": 32705582, "comment_id": 53256293, "body": "Set ticker and other durations to smaller values in tests."}, {"owner": {"reputation": 19225, "user_id": 53926, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4df1cfae6e8c7fbdb013818785318aa7?s=128&d=identicon&r=PG", "display_name": "Xavi", "link": "https://stackoverflow.com/users/53926/xavi"}, "edited": false, "score": 0, "creation_date": 1442906872, "post_id": 32705582, "comment_id": 53264331, "body": "These &quot;jobs&quot; are actually running on a remote service.  Though it is possible to have this program run a server locally and modify the remote service to accept subscriptions, that solution is much too heavy handed imo."}, {"owner": {"reputation": 19225, "user_id": 53926, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4df1cfae6e8c7fbdb013818785318aa7?s=128&d=identicon&r=PG", "display_name": "Xavi", "link": "https://stackoverflow.com/users/53926/xavi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442906988, "post_id": 32705582, "comment_id": 53264412, "body": "@JimB sorry for my ignorance, but what&#39;s the race condition you&#39;re referring to around <code>job.State</code>?  Is the assumption that <code>job</code> is a shared object?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442919307, "post_id": 32705582, "comment_id": 53272208, "body": "Sorry, I was on mobile, and misread the code thinking that <code>job</code> came from outside the for loop."}, {"owner": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "edited": false, "score": 2, "creation_date": 1442935144, "post_id": 32705582, "comment_id": 53283794, "body": "@Xavi : wrap your code in a function, use variables for the ticker delay and the timeout value, set those variables to smaller values when testing."}], "answers": [{"comments": [{"owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "edited": false, "score": 0, "creation_date": 1442899540, "post_id": 32707343, "comment_id": 53260948, "body": "Couldn&#39;t you just send to the ticker channel immediately ?"}, {"owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "reply_to_user": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "edited": false, "score": 2, "creation_date": 1442920992, "post_id": 32707343, "comment_id": 53273302, "body": "It&#39;s a receive only channel: <code>type Ticker struct {     C &lt;-chan Time &#47;&#47; The channel on which the ticks are delivered.     &#47;&#47; contains filtered or unexported fields }</code>"}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 3, "last_activity_date": 1442887982, "creation_date": 1442887982, "answer_id": 32707343, "question_id": 32705582, "link": "https://stackoverflow.com/questions/32705582/how-to-get-time-tick-to-tick-immediately/32707343#32707343", "title": "How to get time.Tick to tick immediately", "body": "<p>The actual implementation of <code>Ticker</code> internally is pretty complicated. But you can wrap it with a goroutine:</p>\n\n<pre><code>func NewTicker(delay, repeat time.Duration) *time.Ticker {\n    ticker := time.NewTicker(repeat)\n    oc := ticker.C\n    nc := make(chan time.Time, 1)\n    go func() {\n        nc &lt;- time.Now()\n        for tm := range oc {\n            nc &lt;- tm\n        }\n    }()\n    ticker.C = nc\n    return ticker\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5458, "user_id": 1567452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/80070f9fadf8d4254903ca4ad1b10ceb?s=128&d=identicon&r=PG", "display_name": "jwilner", "link": "https://stackoverflow.com/users/1567452/jwilner"}, "edited": false, "score": 0, "creation_date": 1542998801, "post_id": 32717308, "comment_id": 93775779, "body": "This is the right solution imo -- also present in the stdlib, see <a href=\"https://github.com/golang/go/blob/master/src/net/http/server.go#L2648\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/net/http/server.go#L264&zwnj;&#8203;8</a>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 5, "last_activity_date": 1583208854, "last_edit_date": 1583208854, "creation_date": 1442926065, "answer_id": 32717308, "question_id": 32705582, "link": "https://stackoverflow.com/questions/32705582/how-to-get-time-tick-to-tick-immediately/32717308#32717308", "title": "How to get time.Tick to tick immediately", "body": "<p>If you want to check the job right away, don't use the ticker as the condition in the for loop. For example:</p>\n\n<pre><code>ticker := time.NewTicker(2 * time.Second)\ndefer ticker.Stop()\n\nstarted := time.Now()\nfor {\n    job, err := client.Job(jobID)\n    if err == InternalError {\n        return err\n    }\n\n    if job.State == \"running\" {\n        break\n    }\n\n    now := &lt;-ticker.C\n    if now.Sub(started) &gt; 2*time.Minute {\n        return fmt.Errorf(\"timed out waiting for job\")\n    }\n}\n</code></pre>\n\n<p>If you do still need to check for <code>DoesNotExistError</code>, you want to make sure you do it after the ticker so you don't have a busy-wait.</p>\n"}, {"comments": [{"owner": {"reputation": 369, "user_id": 1374061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16b8dad53250bf22c1337b062e67f03a?s=128&d=identicon&r=PG", "display_name": "Devon Peticolas", "link": "https://stackoverflow.com/users/1374061/devon-peticolas"}, "edited": false, "score": 4, "creation_date": 1559174362, "post_id": 47448177, "comment_id": 99342406, "body": "Just to add to this. If you don&#39;t want to lose the value you get from the chan you can do <code>for t := time.Now(); true; t = &lt;-ticker.C {</code>"}], "tags": [], "owner": {"reputation": 929, "user_id": 1431884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b80883531688ef464a11568e1f4826c?s=128&d=identicon&r=PG", "display_name": "w1100n", "link": "https://stackoverflow.com/users/1431884/w1100n"}, "is_accepted": false, "score": 16, "last_activity_date": 1511414888, "creation_date": 1511414888, "answer_id": 47448177, "question_id": 32705582, "link": "https://stackoverflow.com/questions/32705582/how-to-get-time-tick-to-tick-immediately/47448177#47448177", "title": "How to get time.Tick to tick immediately", "body": "<pre><code>ticker := time.NewTicker(period)\nfor ; true; &lt;-ticker.C {\n    ...\n}\n</code></pre>\n\n<p><a href=\"https://github.com/golang/go/issues/17601\" rel=\"noreferrer\">https://github.com/golang/go/issues/17601</a></p>\n"}, {"comments": [{"owner": {"reputation": 1397, "user_id": 1016460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c82e30ce757f6e7e320665454544b574?s=128&d=identicon&r=PG&f=1", "display_name": "youfu", "link": "https://stackoverflow.com/users/1016460/youfu"}, "edited": false, "score": 1, "creation_date": 1602842546, "post_id": 54752803, "comment_id": 113854147, "body": "Does <code>&lt;- time.Tick(period)</code> create a Ticker on each iteration? According to document, the Ticker created by Tick cannot be garbage-collected. This terrifies me."}, {"owner": {"reputation": 2317, "user_id": 4466589, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/uPR5Y.jpg?s=128&g=1", "display_name": "Bora M. Alper", "link": "https://stackoverflow.com/users/4466589/bora-m-alper"}, "reply_to_user": {"reputation": 1397, "user_id": 1016460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c82e30ce757f6e7e320665454544b574?s=128&d=identicon&r=PG&f=1", "display_name": "youfu", "link": "https://stackoverflow.com/users/1016460/youfu"}, "edited": false, "score": 1, "creation_date": 1603123953, "post_id": 54752803, "comment_id": 113930556, "body": "@youfu You are absolutely right! I have just edited my answer."}], "tags": [], "owner": {"reputation": 2317, "user_id": 4466589, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/uPR5Y.jpg?s=128&g=1", "display_name": "Bora M. Alper", "link": "https://stackoverflow.com/users/4466589/bora-m-alper"}, "is_accepted": true, "score": 23, "last_activity_date": 1603123936, "last_edit_date": 1603123936, "creation_date": 1550512219, "answer_id": 54752803, "question_id": 32705582, "link": "https://stackoverflow.com/questions/32705582/how-to-get-time-tick-to-tick-immediately/54752803#54752803", "title": "How to get time.Tick to tick immediately", "body": "<p>Unfortunately, it <a href=\"https://github.com/golang/go/issues/17601\" rel=\"noreferrer\">seems</a> that Go developers will not add such functionality in any foreseeable future, so we have to cope...</p>\n<p>There are two common ways to use tickers:</p>\n<h2><code>for</code> loop</h2>\n<p>Given something like this:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>ticker := time.NewTicker(period)\ndefer ticker.Stop()\nfor &lt;- ticker.C {\n    ...\n}\n</code></pre>\n<p>Use:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>ticker := time.NewTicker(period)\ndefer ticker.Stop()\nfor ; true; &lt;- ticker.C {\n    ...\n}\n</code></pre>\n<h2><code>for</code>-<code>select</code> loop</h2>\n<p>Given something like this:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>interrupt := make(chan os.Signal, 1)\nsignal.Notify(interrupt, os.Interrupt)\n\nticker := time.NewTicker(period)\ndefer ticker.Stop()\n\nloop:\nfor {\n    select {\n        case &lt;- ticker.C: \n            f()\n        case &lt;- interrupt:\n            break loop\n    }\n}\n</code></pre>\n<p>Use:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>interrupt := make(chan os.Signal, 1)\nsignal.Notify(interrupt, os.Interrupt)\n\nticker := time.NewTicker(period)\ndefer ticker.Stop()\n\nloop:\nfor {\n    f()\n\n    select {\n        case &lt;- ticker.C: \n            continue\n        case &lt;- interrupt:\n            break loop\n    }\n}\n</code></pre>\n<h2>Why not just use <code>time.Tick()</code>?</h2>\n<blockquote>\n<p>While Tick is useful for clients that have no need to shut down the Ticker, be aware that without a way to shut it down the underlying Ticker cannot be recovered by the garbage collector; it &quot;leaks&quot;.</p>\n</blockquote>\n<p><a href=\"https://golang.org/pkg/time/#Tick\" rel=\"noreferrer\">https://golang.org/pkg/time/#Tick</a></p>\n"}, {"tags": [], "owner": {"reputation": 377, "user_id": 3284965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92f9c9a1902f72e0e858107351d95ea8?s=128&d=identicon&r=PG&f=1", "display_name": "manpatha", "link": "https://stackoverflow.com/users/3284965/manpatha"}, "is_accepted": false, "score": 1, "last_activity_date": 1591644402, "creation_date": 1591644402, "answer_id": 62269789, "question_id": 32705582, "link": "https://stackoverflow.com/questions/32705582/how-to-get-time-tick-to-tick-immediately/62269789#62269789", "title": "How to get time.Tick to tick immediately", "body": "<p>I cooked up something like this</p>\n\n<pre><code>func main() {\n    t := time.Now()\n    callme := func() {\n        // do somethign more\n        fmt.Println(\"callme\", time.Since(t))\n    }\n    ticker := time.NewTicker(10 * time.Second)\n    first := make(chan bool, 1)\n    first &lt;- true\n    for {\n        select {\n        case &lt;-ticker.C:\n            callme()\n        case &lt;-first:\n            callme()\n        }\n        t = time.Now()\n    }\n    close(first)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 121, "user_id": 5684083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a027f1e057ffb89b58343da0df1a291?s=128&d=identicon&r=PG&f=1", "display_name": "rarguelloF", "link": "https://stackoverflow.com/users/5684083/rarguellof"}, "is_accepted": false, "score": 1, "last_activity_date": 1608012163, "creation_date": 1608012163, "answer_id": 65300777, "question_id": 32705582, "link": "https://stackoverflow.com/questions/32705582/how-to-get-time-tick-to-tick-immediately/65300777#65300777", "title": "How to get time.Tick to tick immediately", "body": "<p>I think this might be an interesting alternative for the <code>for-select</code> loop, specially if the contents of the <code>case</code> are not a simple function:</p>\n<p>Having:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>interrupt := make(chan os.Signal, 1)\nsignal.Notify(interrupt, os.Interrupt)\n\nticker := time.NewTicker(period)\ndefer ticker.Stop()\n\nloop:\nfor {\n    select {\n        case &lt;- ticker.C: \n            f()\n        case &lt;- interrupt:\n            break loop\n    }\n}\n</code></pre>\n<p>Use:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>interrupt := make(chan os.Signal, 1)\nsignal.Notify(interrupt, os.Interrupt)\n\nticker := time.NewTicker(period)\ndefer ticker.Stop()\nfirstTick := false\n\n// create a wrapper of the ticker that ticks the first time immediately\ntickerChan := func() &lt;-chan time.Time {\n  if !firstTick {\n    firstTick = true\n    c := make(chan time.Time, 1)\n    c &lt;- time.Now()\n    return c\n  }\n\n  return ticker.C\n}\n\nloop:\nfor {\n    select {\n        case &lt;- tickerChan(): \n            f()\n        case &lt;- interrupt:\n            break loop\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 19225, "user_id": 53926, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4df1cfae6e8c7fbdb013818785318aa7?s=128&d=identicon&r=PG", "display_name": "Xavi", "link": "https://stackoverflow.com/users/53926/xavi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9322, "favorite_count": 6, "accepted_answer_id": 54752803, "answer_count": 6, "score": 19, "last_activity_date": 1608012163, "creation_date": 1442874932, "last_edit_date": 1442906468, "question_id": 32705582, "link": "https://stackoverflow.com/questions/32705582/how-to-get-time-tick-to-tick-immediately", "title": "How to get time.Tick to tick immediately", "body": "<p>I have a loop that iterates until a job is up and running:</p>\n\n<pre><code>ticker := time.NewTicker(time.Second * 2)\ndefer ticker.Stop()\n\nstarted := time.Now()\nfor now := range ticker.C {\n    job, err := client.Job(jobID)\n    switch err.(type) {\n    case DoesNotExistError:\n        continue\n    case InternalError:\n        return err\n    }\n\n    if job.State == \"running\" {\n        break\n    }\n\n    if now.Sub(started) &gt; time.Minute*2 {\n        return fmt.Errorf(\"timed out waiting for job\")\n    }\n}\n</code></pre>\n\n<p>Works great in production.  The only problem is that it makes my tests slow.  They all wait at least 2 seconds before completing.  Is there anyway to get <code>time.Tick</code> to tick immediately?</p>\n"}, {"tags": ["go", "xml-parsing"], "comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 1, "creation_date": 1442902600, "post_id": 32705546, "comment_id": 53262099, "body": "It&#39;s look like xml namespaces does not work properly for now <a href=\"https://github.com/golang/go/issues/9519\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/9519</a> <a href=\"https://github.com/golang/go/issues/11841\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/11841</a>"}, {"owner": {"reputation": 2229, "user_id": 484529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/rp6uy.png?s=128&g=1", "display_name": "ijt", "link": "https://stackoverflow.com/users/484529/ijt"}, "edited": false, "score": 2, "creation_date": 1488696551, "post_id": 32705546, "comment_id": 72340719, "body": "If so then that&#39;s an answer and is probably best made into an answer so it can be accepted."}], "answers": [{"comments": [{"owner": {"reputation": 4976, "user_id": 99189, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e85341a6b300fd04dc33b1baa28b7fd8?s=128&d=identicon&r=PG", "display_name": "Jeremy Huiskamp", "link": "https://stackoverflow.com/users/99189/jeremy-huiskamp"}, "edited": false, "score": 0, "creation_date": 1519672093, "post_id": 48995384, "comment_id": 84996222, "body": "Though I&#39;m not sure it&#39;s handling the <code>title</code> element correctly.  When the namespace is declared with <code>xmlns:test</code> and the <code>title</code> element name doesn&#39;t have a prefix, I don&#39;t believe it&#39;s supposed to be in the namespace.  However, in the processed version, with the raw <code>xmlns</code> declaration, all children are automatically in the namespace...  As @RoninDev mentioned, the stdlib xml libraries are not so great with namespaces."}], "tags": [], "owner": {"reputation": 4976, "user_id": 99189, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e85341a6b300fd04dc33b1baa28b7fd8?s=128&d=identicon&r=PG", "display_name": "Jeremy Huiskamp", "link": "https://stackoverflow.com/users/99189/jeremy-huiskamp"}, "is_accepted": false, "score": 1, "last_activity_date": 1519671942, "creation_date": 1519671942, "answer_id": 48995384, "question_id": 32705546, "link": "https://stackoverflow.com/questions/32705546/xml-unmarshal-does-not-respect-the-root-element-namespace-prefix-definition/48995384#48995384", "title": "XML unmarshal does not respect the root element namespace prefix definition", "body": "<p>It doesn't look like it changed the logical structure.  In your original input, the <code>root</code> element declares a prefix <code>test</code> for the namespace <code>http://test.com/testns</code> but it doesn't actually declare itself to be in that namespace.</p>\n\n<p>Here's an alternate version that does what it looks like you want: <a href=\"https://play.golang.org/p/NqNyIyMB4IP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NqNyIyMB4IP</a></p>\n\n<p>I bumped the namespace up to the <code>Root</code> struct and added the <code>test:</code> prefix to the <code>root</code> xml element in the input.</p>\n"}], "owner": {"reputation": 91, "user_id": 4055540, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-U-xpguGAMhI/AAAAAAAAAAI/AAAAAAAAANc/ZXXSkHyEMbA/photo.jpg?sz=128", "display_name": "Wilson Wang", "link": "https://stackoverflow.com/users/4055540/wilson-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1296, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1519671942, "creation_date": 1442874773, "last_edit_date": 1498471347, "question_id": 32705546, "link": "https://stackoverflow.com/questions/32705546/xml-unmarshal-does-not-respect-the-root-element-namespace-prefix-definition", "title": "XML unmarshal does not respect the root element namespace prefix definition", "body": "<p>Here is the XML structure: </p>\n\n<pre><code>&lt;root xmlns:test=\"http://test.com/testns\"&gt;\n            &lt;test:sub&gt;\n                &lt;title&gt;this is title&lt;/title&gt;\n            &lt;/test:sub&gt;\n&lt;/root&gt;\n</code></pre>\n\n<p>It gets unmarshalled with the structs defined below:</p>\n\n<pre><code>type Root struct {\n    XMLName xml.Name `xml:\"root\"`\n    Sub *Sub\n}\n\ntype Sub struct {\n    XMLName       xml.Name `xml:\"http://test.com/testns sub\"`\n    Title         string   `xml:\"title\"` \n}\n</code></pre>\n\n<p>This is what gets marshalled back:</p>\n\n<pre><code>&lt;root&gt;\n    &lt;sub xmlns=\"http://test.com/testns\"&gt;\n        &lt;title&gt;this is title&lt;/title&gt;\n    &lt;/sub&gt;\n&lt;/root&gt;\n</code></pre>\n\n<p>The root namespace prefix definition gets removed after the marshal and the sub element is using url namespace instead of the prefix. Here is the <a href=\"http://play.golang.org/p/13NT6YcYOd\" rel=\"nofollow noreferrer\">code</a> </p>\n\n<p>Is there any way that marshal/unmarshal won't change the xml structure? thanks!</p>\n"}, {"tags": ["mongodb", "go", "bson", "mgo", "database"], "comments": [{"owner": {"reputation": 4681, "user_id": 153028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d52fe807c14b17e465a9e849b8cb2b21?s=128&d=identicon&r=PG", "display_name": "Martin", "link": "https://stackoverflow.com/users/153028/martin"}, "edited": false, "score": 0, "creation_date": 1442873754, "post_id": 32705317, "comment_id": 53254241, "body": "You will need to look into how to pass a regular expression into your query. Path is stored as a string and <code>&#47;,Programming,&#47;</code> is regular expression."}, {"owner": {"reputation": 661, "user_id": 1680568, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/RkIg1.png?s=128&g=1", "display_name": "William Yang", "link": "https://stackoverflow.com/users/1680568/william-yang"}, "reply_to_user": {"reputation": 4681, "user_id": 153028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d52fe807c14b17e465a9e849b8cb2b21?s=128&d=identicon&r=PG", "display_name": "Martin", "link": "https://stackoverflow.com/users/153028/martin"}, "edited": false, "score": 0, "creation_date": 1442874112, "post_id": 32705317, "comment_id": 53254374, "body": "@Martin Hmm.. Okay! I am looking into it right now."}], "answers": [{"tags": [], "owner": {"reputation": 66, "user_id": 1107622, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc2eb970399e8666f807354478d50dd?s=128&d=identicon&r=PG", "display_name": "Vlastimil \u0160enfeld", "link": "https://stackoverflow.com/users/1107622/vlastimil-%c5%a0enfeld"}, "is_accepted": false, "score": 1, "last_activity_date": 1442928432, "creation_date": 1442928432, "answer_id": 32718173, "question_id": 32705317, "link": "https://stackoverflow.com/questions/32705317/mgo-mongo-for-go-support-for-materialized-paths/32718173#32718173", "title": "Mgo (mongo for go) support for materialized paths?", "body": "<p>Checkout this part in <strong>mgo/bson</strong> documentation: <a href=\"http://godoc.org/labix.org/v2/mgo/bson#RegEx\" rel=\"nofollow\">http://godoc.org/labix.org/v2/mgo/bson#RegEx</a></p>\n\n<p>It should probably look like this    </p>\n\n<pre><code>database.C(\"categories\").Find(bson.M{\"path\": &amp;bson.RegEx{Pattern: \",Programming,\", Options: \"i\"}}).All(&amp;result)\n</code></pre>\n"}], "owner": {"reputation": 661, "user_id": 1680568, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/RkIg1.png?s=128&g=1", "display_name": "William Yang", "link": "https://stackoverflow.com/users/1680568/william-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1501405780, "creation_date": 1442873481, "last_edit_date": 1506103077, "question_id": 32705317, "link": "https://stackoverflow.com/questions/32705317/mgo-mongo-for-go-support-for-materialized-paths", "title": "Mgo (mongo for go) support for materialized paths?", "body": "<p>With BSON and Mgo(rich mongodb driver for go), how would one approach implementing materialized paths?</p>\n\n<p>Materialized paths are documented <a href=\"http://docs.mongodb.org/master/tutorial/model-tree-structures-with-materialized-paths/\" rel=\"nofollow\">here</a> on the mongo docs. Materialized paths are designed to provide a tree-like structure for multiple levels of nested data. </p>\n\n<p>With plain javascript, the command are as follows (from the <a href=\"http://docs.mongodb.org/master/tutorial/model-tree-structures-with-materialized-paths/\" rel=\"nofollow\">documentation</a>):</p>\n\n<pre><code>db.categories.insert( { _id: \"Books\", path: null } )\ndb.categories.insert( { _id: \"Programming\", path: \",Books,\" } )\ndb.categories.insert( { _id: \"Databases\", path: \",Books,Programming,\" } )\ndb.categories.insert( { _id: \"Languages\", path: \",Books,Programming,\" } )\n</code></pre>\n\n<p>Created collection 'categories' with the following entries </p>\n\n<pre><code>Books &gt; Programming &gt; Databases\nBooks &gt; Programming &gt; Languages\n</code></pre>\n\n<p>And can be queried using: </p>\n\n<pre><code>db.categories.find( { path: /,Programming,/ } )\n</code></pre>\n\n<p>Will find the two entries which are both decendants of programming. </p>\n\n<p>How do I implement this using <strong>Mgo</strong> and <strong>BSON</strong>?</p>\n\n<p>There is no such documentation in the Mgo docs. I have tried attempts such as </p>\n\n<pre><code>result := []bson.M{}\ndatabase.C(\"categories\").Find(bson.M{\"path\": \"/,Programming,/\"}).All(&amp;result)\nfmt.Println(result)\n</code></pre>\n\n<p>Only to return an empty array <code>[]</code></p>\n\n<p>Any gophers and mongo lovers to enlighten me here?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1442862868, "post_id": 32702338, "comment_id": 53249013, "body": "<i>always</i> format your code (<code>go fmt</code> or <code>goimports</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 363, "user_id": 469352, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/hWTwF.jpg?s=128&g=1", "display_name": "Ben Slade", "link": "https://stackoverflow.com/users/469352/ben-slade"}, "edited": false, "score": 0, "creation_date": 1442954247, "post_id": 32702354, "comment_id": 53295261, "body": "Ok, thanks for the info.   I think I had actually tried that before, but some other error was occurring at that time.  I understand the convenience of Go inserting semi-colons, but I almost wish explicit semi-colons were required, if for no other reason than it makes compiler errors much easier to understand."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 6, "last_activity_date": 1442861222, "last_edit_date": 1442861222, "creation_date": 1442860702, "answer_id": 32702354, "question_id": 32702338, "link": "https://stackoverflow.com/questions/32702338/why-doesnt-this-check-for-nil-in-go-work/32702354#32702354", "title": "Why doesn&#39;t this check for nil in go work?", "body": "<p>The open curly brace needs to be on the same line as the <code>if</code>:</p>\n\n<pre><code>if pr != nil { \n</code></pre>\n\n<p>From the <a href=\"https://golang.org/ref/spec#Semicolons\">Go spec on semicolons</a>:</p>\n\n<blockquote>\n  <p>The formal grammar uses semicolons \";\" as terminators in a number of productions. Go programs may omit most of these semicolons using the following two rules:</p>\n  \n  <ol>\n  <li><p>When the input is broken into tokens, a semicolon is automatically inserted into the token stream immediately after a line's final token if that token is</p>\n  \n  <ul>\n  <li>an identifier</li>\n  <li>an integer, floating-point, imaginary, rune, or string literal</li>\n  <li>one of the keywords <code>break</code>, <code>continue</code>, <code>fallthrough</code>, or <code>return</code></li>\n  <li>one of the operators and delimiters <code>++</code>, <code>--</code>, <code>)</code>, <code>]</code>, or <code>}</code></li>\n  </ul></li>\n  <li><p>To allow complex statements to occupy a single line, a semicolon may be omitted before a closing \"<code>)</code>\" or \"<code>}</code>\".</p></li>\n  </ol>\n</blockquote>\n\n<p>This means that your code was equivalent to:</p>\n\n<pre><code>if pr != nil;\n{\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 363, "user_id": 469352, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/hWTwF.jpg?s=128&g=1", "display_name": "Ben Slade", "link": "https://stackoverflow.com/users/469352/ben-slade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 32702354, "answer_count": 1, "score": 0, "last_activity_date": 1442861222, "creation_date": 1442860648, "question_id": 32702338, "link": "https://stackoverflow.com/questions/32702338/why-doesnt-this-check-for-nil-in-go-work", "title": "Why doesn&#39;t this check for nil in go work?", "body": "<p>In the first code example, I get errors for the \"if pr != nil\" line:</p>\n\n<pre><code>for sup, _ := range supervisorToColor {\n        pr := emailToPerson[sup]\n        // The line below causes the compilation error:\n        // ./myprog.go:1046: missing condition in if statement\n        // ./myprog.go:1046: pr != nil evaluated but not used\n        if pr != nil \n        {   \n          local := peopleOnFloor[pr.Email]\n          sp := &amp;Super{pr, local}\n          names = append(names, sp) \n        }   \n}   \n</code></pre>\n\n<p>If I comment out the nil check if statement, it compiles fine:</p>\n\n<pre><code>for sup, _ := range supervisorToColor {\n        pr := emailToPerson[sup]\n        // if pr != nil \n        // {\n          local := peopleOnFloor[pr.Email]\n          sp := &amp;Super{pr, local}\n          names = append(names, sp) \n        // }\n}   \n</code></pre>\n\n<p>At first I was inclined to think it was some syntax error earlier in the code, but the fact that it works when I comment out the lines makes me think it's something else.</p>\n\n<p>emailToPerson is of type map[string]*Person where Person is a struct</p>\n\n<p>Thanks in advance.  Apologies if this turns out to be something incredibly simple.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1442857373, "post_id": 32701281, "comment_id": 53245862, "body": "Check the error return from json.Unmarshal. It might give a hint about the problem."}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 2780144, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a93bcfbf0518005fe617e99b27731a1c?s=128&d=identicon&r=PG&f=1", "display_name": "Craig", "link": "https://stackoverflow.com/users/2780144/craig"}, "edited": false, "score": 0, "creation_date": 1442857934, "post_id": 32701475, "comment_id": 53246181, "body": "Simon,  Thank you, that was the answer."}], "tags": [], "owner": {"reputation": 26843, "user_id": 208997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/250e219125d8bff1f03e6faea950f218?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/208997/simon"}, "is_accepted": true, "score": 2, "last_activity_date": 1442857443, "creation_date": 1442857443, "answer_id": 32701475, "question_id": 32701281, "link": "https://stackoverflow.com/questions/32701281/go-string-handling-and-json/32701475#32701475", "title": "go string handling and JSON", "body": "<p>Your type should be:</p>\n\n<pre><code>type ESMVersionStruct struct {\n    Return struct {\n        APIMajorVersion     int8 `json:\"apiMajorVersion\"`\n        APIMinorVersion     int8 `json:\"apiMinorVersion\"`\n        ESMMajorVersion     int8 `json:\"esmMajorVersion\"`\n        ESMMinorVersion     int8 `json:\"esmMinorVersion\"`\n        ESMPatch            string `json:\"esmPatch\"`\n        ESMRevision         int8 `json:\"esmRevision\"`\n        ESMVersionString    string `json:\"esmVersionString\"`\n    } `json:\"return\"`\n}\n</code></pre>\n\n<p>That is, your struct embedded  in another <code>Return</code> struct.</p>\n"}], "owner": {"reputation": 91, "user_id": 2780144, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a93bcfbf0518005fe617e99b27731a1c?s=128&d=identicon&r=PG&f=1", "display_name": "Craig", "link": "https://stackoverflow.com/users/2780144/craig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 32701475, "answer_count": 1, "score": 1, "last_activity_date": 1442857608, "creation_date": 1442856768, "last_edit_date": 1442857608, "question_id": 32701281, "link": "https://stackoverflow.com/questions/32701281/go-string-handling-and-json", "title": "go string handling and JSON", "body": "<p>New Gopher here!\nI am working with a rest API in go, and I am now working on parsing out my first return JSON and seem to be having a bit of trouble.</p>\n\n<p>First the raw return from the API call nets me this:</p>\n\n<pre><code>spew.Dump(body)\n\n(string) (len=205) \"{\\\"return\\\": {\\n    \\\"apiMajorVersion\\\": 3,\\n    \\\"apiMinorVersion\\\": 0,\\n    \\\"esmMajorVersion\\\": 9,\\n    \\\"esmMinorVersion\\\": 5,\\n    \\\"esmPatch\\\": \\\"MR7\\\",\\n    \\\"esmRevision\\\": 0,\\n    \\\"esmVersionString\\\": \\\"9.5.0 20150908\\\"\\n}}\"\n</code></pre>\n\n<p>With all the backslashes and newlines embedded in the string.  If I print it</p>\n\n<pre><code>fmt.Println(body)\n\n{\"return\": {\n    \"apiMajorVersion\": 3,\n    \"apiMinorVersion\": 0,\n    \"esmMajorVersion\": 9,\n    \"esmMinorVersion\": 5,\n    \"esmPatch\": \"XX7\",\n    \"esmRevision\": 0,\n    \"esmVersionString\": \"9.5.0 20150908\"\n}}\n</code></pre>\n\n<p>Then I get valid json.</p>\n\n<p>If I try and unmarshal it to the struct I don't get the values in the struct properly.</p>\n\n<pre><code>type ESMVersionStruct struct {\n    APIMajorVersion     int8 `json:\"return&gt;apiMajorVersion\"`\n    APIMinorVersion     int8 `json:\"apiMinorVersion\"`\n    ESMMajorVersion     int8 `json:\"esmMajorVersion\"`\n    ESMMinorVersion     int8 `json:\"esmMinorVersion\"`\n    ESMPatch            string `json:\"esmPatch\"`\n    ESMRevision         int8 `json:\"esmRevision\"`\n    ESMVersionString    string `json:\"esmVersionString\"`\n}\n</code></pre>\n\n<p>I have tried both specifying the object in the return and not.</p>\n\n<pre><code>jsonData := []byte(body)\nvar ESMVersion ESMVersionStruct\njson.Unmarshal(jsonData, &amp;ESMVersion)\n\nfmt.Println(ESMVersion.APIMajorVersion)\nfmt.Print(ESMVersion.APIMinorVersion)\n</code></pre>\n\n<p>Both of the last two return the null value.</p>\n\n<p>Thanks in advance for any help with this one!</p>\n"}, {"tags": ["pointers", "go", "pointer-arithmetic"], "answers": [{"comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1442864683, "post_id": 32701024, "comment_id": 53250011, "body": "if you do this, use <code>&#47;&#47;go:nosplit</code>, else you risk corrupting the gc&#39;s state."}, {"owner": {"reputation": 251, "user_id": 2774002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ntpn9.gif?s=128&g=1", "display_name": "Ian Lance Taylor", "link": "https://stackoverflow.com/users/2774002/ian-lance-taylor"}, "edited": false, "score": 7, "creation_date": 1445382428, "post_id": 32701024, "comment_id": 54298916, "body": "I don&#39;t see why //go:nosplit is going to make a difference here one way or another.  The //go:nosplit comment tells the compiler to not check for stack overflow when entering the function.  That has the side effect that the garbage collector will not run when entering the function.  But these pointers are being manipulated inside the function, and go:nosplit isn&#39;t going to affect that.  The issue for documenting when it is safe to convert between unsafe.Pointer and uintptr is <a href=\"https://golang.org/issue/8994\" rel=\"nofollow noreferrer\">golang.org/issue/8994</a>."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 46, "last_activity_date": 1442856292, "last_edit_date": 1592644375, "creation_date": 1442855718, "answer_id": 32701024, "question_id": 32700999, "link": "https://stackoverflow.com/questions/32700999/pointer-arithmetic-in-go/32701024#32701024", "title": "Pointer arithmetic in Go", "body": "<p>No. From the <a href=\"https://golang.org/doc/faq#no_pointer_arithmetic\" rel=\"noreferrer\">Go FAQ</a>:</p>\n<blockquote>\n<h3>Why is there no pointer arithmetic?</h3>\n<p>Safety. Without pointer arithmetic it's possible to create a language that can never derive an illegal address that succeeds incorrectly. Compiler and hardware technology have advanced to the point where a loop using array indices can be as efficient as a loop using pointer arithmetic. Also, the lack of pointer arithmetic can simplify the implementation of the garbage collector.</p>\n</blockquote>\n<p>That being said, you can  get around this by using the <a href=\"https://godoc.org/unsafe\" rel=\"noreferrer\"><code>unsafe</code></a> package, but <strong>just don't</strong>:</p>\n<pre><code>package main\n\nimport &quot;fmt&quot;\nimport &quot;unsafe&quot;\n\nfunc main() {\n    vals := []int{10, 20, 30, 40}\n    start := unsafe.Pointer(&amp;vals[0])\n    size := unsafe.Sizeof(int(0))\n    for i := 0; i &lt; len(vals); i++ {\n        item := *(*int)(unsafe.Pointer(uintptr(start) + size*uintptr(i)))\n        fmt.Println(item)\n    }\n}\n</code></pre>\n<p><a href=\"https://play.golang.org/p/QCHEQqy6Lg\" rel=\"noreferrer\">https://play.golang.org/p/QCHEQqy6Lg</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5360268"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12598, "favorite_count": 7, "accepted_answer_id": 32701024, "answer_count": 1, "score": 27, "last_activity_date": 1531315591, "creation_date": 1442855627, "last_edit_date": 1531315591, "question_id": 32700999, "link": "https://stackoverflow.com/questions/32700999/pointer-arithmetic-in-go", "title": "Pointer arithmetic in Go", "body": "<p>Considering you can (can't think of a great way to put it, but) manipulate pointers in Go, is it possible to perform pointer arithmetic like you would in C, say for iterating over an array? I know loops are just fine for that kind of things these days but I'm just curious if it's possible.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442855361, "post_id": 32700835, "comment_id": 53244773, "body": "if you need access to <code>server.go</code>, put it in <code>server.go</code> (or anywhere in that package). <code>projectd</code> is another package, so it&#39;s built separately."}], "owner": {"reputation": 81, "user_id": 5359814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/970d0def263c4f535eb9092502ba5810?s=128&d=identicon&r=PG&f=1", "display_name": "jukka.aalto", "link": "https://stackoverflow.com/users/5359814/jukka-aalto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 715, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1442859843, "creation_date": 1442855094, "last_edit_date": 1442859843, "question_id": 32700835, "link": "https://stackoverflow.com/questions/32700835/go-generate-and-go-bindata", "title": "Go generate and go-bindata", "body": "<p>I have a directory structure as follows:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 client\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 index.html\n\u251c\u2500\u2500 cmd\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 projectd\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 projectd\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 main.go\n\u251c\u2500\u2500 models.go\n\u2514\u2500\u2500 server.go\n</code></pre>\n\n<p><code>cmd/gideond.go</code> produces the actual binary.</p>\n\n<p>I want to run <code>go-bindata client/</code> so that I can embed the files in the client directory.</p>\n\n<p><strong>Questions:</strong></p>\n\n<ol>\n<li>Where should I put the go generate comment, keeping in mind that I need access to the assets in <code>server.go</code>. If I put it in <code>server.go</code> I have to run <code>go generate</code> in the root directory and not in <code>cmd/projectd</code></li>\n<li>Should I structure my code in another way?</li>\n<li>How do I serve a HTML document and a javascript bundle using <code>go-bindata</code>?</li>\n<li>Is it possible to source an embedded javascript file in a golang templates/html template?</li>\n</ol>\n"}, {"tags": ["go", "println"], "comments": [{"owner": {"reputation": 14588, "user_id": 3166303, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/877b076ec96e4ab48f7f4567c1ea2741?s=128&d=identicon&r=PG", "display_name": "leeor", "link": "https://stackoverflow.com/users/3166303/leeor"}, "edited": false, "score": 5, "creation_date": 1442854004, "post_id": 32700427, "comment_id": 53243963, "body": "works for me <a href=\"http://play.golang.org/p/ycIzg1h6eq\" rel=\"nofollow noreferrer\">play.golang.org/p/ycIzg1h6eq</a> except for one off-by-1 error"}, {"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "edited": false, "score": 3, "creation_date": 1442854820, "post_id": 32700427, "comment_id": 53244416, "body": "Be sure you&#39;re using <code>go run filename.go</code> or <code>go build filename.go</code> and <code>.&#47;filename</code> to run the program.  If you used <code>go install</code> on the original &quot;Hello World!&quot; implementation, that binary could be in the $GOPATH/bin/ and shadowing your local binary."}, {"owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "edited": false, "score": 0, "creation_date": 1532212198, "post_id": 32700427, "comment_id": 89890483, "body": "You&#39;ll also probably want to move your seed outside of the scope of the shuffle function and to the top of the main function so that you will always set a unique seed, ensuring randomness for your shuffling. <a href=\"https://stackoverflow.com/questions/12321133/golang-random-number-generator-how-to-seed-properly\">This</a> is a great article about how to properly seed."}], "owner": {"reputation": 9, "user_id": 5360153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a88c99d3912892c80f20a13595b61770?s=128&d=identicon&r=PG&f=1", "display_name": "S Osa", "link": "https://stackoverflow.com/users/5360153/s-osa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1093, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1442853729, "creation_date": 1442853729, "question_id": 32700427, "link": "https://stackoverflow.com/questions/32700427/fmt-println-in-golang", "title": "fmt.Println in Golang", "body": "<p>I am pretty new to programming and wanted to try my hand at writing a simple program in go with the eventual aim to write a short program that evaluates hands drawn from a deck of cards. </p>\n\n<p>I want to check that my implementation of the Fisher-Yates shuffle is working as intended, so I would like to print the output of the slice abc; however when I compile and run this code the only output I get is \"Hello World!\" and I am not sure why as from reading other examples and the Tour of Go, it seems like at the very least the first Println statement should work. </p>\n\n<p>I feel like I am missing something fairly fundamental here. </p>\n\n<pre><code>// Test project main.go\npackage main\n\nimport (\n    \"math/rand\"\n    \"fmt\"\n    \"time\"\n)\nfunc shuffle(deck []string, totalCards int) []string {\n    rand.Seed(time.Now().UnixNano())\n    for i := len(deck) -1; i &gt;= 1; i-- {\n        j := rand.Intn(i+1)\n        deck[i], deck[j] = deck[j], deck[i]\n        }\n    return deck[0:totalCards-1]\n}\n\nfunc main() {\n    abc := []string{\"a\", \"b\", \"c\"}\n    fmt.Println(abc)\n    abc = shuffle(abc, 3)\n    fmt.Println(abc)\n    fmt.Println(\"Hello World!\")\n}\n</code></pre>\n"}, {"tags": ["android", "go", "gomobile"], "comments": [{"owner": {"reputation": 1210, "user_id": 2172816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbced86c37020bf376028b8ef8abc7c9?s=128&d=identicon&r=PG", "display_name": "user2172816", "link": "https://stackoverflow.com/users/2172816/user2172816"}, "edited": false, "score": 0, "creation_date": 1442999419, "post_id": 32698797, "comment_id": 53311595, "body": "Have you tried to create a <code>res</code> folder and put your drawable folders in there?"}, {"owner": {"reputation": 745, "user_id": 1823636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56dc271a930773cc7ce95dfceedcd83e?s=128&d=identicon&r=PG", "display_name": "sisoft", "link": "https://stackoverflow.com/users/1823636/sisoft"}, "reply_to_user": {"reputation": 1210, "user_id": 2172816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbced86c37020bf376028b8ef8abc7c9?s=128&d=identicon&r=PG", "display_name": "user2172816", "link": "https://stackoverflow.com/users/2172816/user2172816"}, "edited": false, "score": 0, "creation_date": 1443006340, "post_id": 32698797, "comment_id": 53316316, "body": "Yes, but gomibile ignores it and not add to apk. Also tried path <code>assets&#47;res&#47;drawable-*&#47;</code>."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1470087161, "post_id": 32698797, "comment_id": 64794480, "body": "Is there an answer to this question? @sisoft Have you tried putting them in the <code>mipmap</code> folder?"}, {"owner": {"reputation": 745, "user_id": 1823636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56dc271a930773cc7ce95dfceedcd83e?s=128&d=identicon&r=PG", "display_name": "sisoft", "link": "https://stackoverflow.com/users/1823636/sisoft"}, "reply_to_user": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 2, "creation_date": 1479568507, "post_id": 32698797, "comment_id": 68618248, "body": "@Topo: it don&#39;t work too.  As I found, icon support added in <a href=\"https://golang.org/cl/30019\" rel=\"nofollow noreferrer\">golang.org/cl/30019</a>, but this patchset is not in main git tree yet."}], "owner": {"reputation": 745, "user_id": 1823636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56dc271a930773cc7ce95dfceedcd83e?s=128&d=identicon&r=PG", "display_name": "sisoft", "link": "https://stackoverflow.com/users/1823636/sisoft"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 180, "favorite_count": 2, "answer_count": 0, "score": 3, "last_activity_date": 1496253212, "creation_date": 1442848633, "last_edit_date": 1496253212, "question_id": 32698797, "link": "https://stackoverflow.com/questions/32698797/launcher-icon-of-android-app-built-with-gomobile-not-shown", "title": "Launcher icon of android app built with gomobile not shown", "body": "<p>I have a networking app, written in Go. Since Go 1.5 I can build it also for android devices with almost no changes using gomobile working fine.</p>\n\n<p>But I can't change default android icon of app.</p>\n\n<p>I'm building app with custom manifest file:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;manifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"name.app\" android:installLocation=\"auto\"\n android:versionCode=\"1\" android:versionName=\"1.0-alpha\"&gt;\n    &lt;uses-sdk android:minSdkVersion=\"9\" /&gt;\n    &lt;uses-permission android:name=\"android.permission.INTERNET\" /&gt;\n    &lt;uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\" android:maxSdkVersion=\"18\" /&gt;\n\n    &lt;application android:label=\"name.app\" android:debuggable=\"true\" android:icon=\"@assets/ic_launcher\" android:persistent=\"true\"&gt;\n        &lt;activity android:name=\"org.golang.app.GoNativeActivity\" android:configChanges=\"orientation|keyboardHidden\"\n         android:alwaysRetainTaskState=\"true\" android:launchMode=\"singleTask\"&gt;\n            &lt;intent-filter&gt;\n                &lt;action android:name=\"android.intent.action.MAIN\" /&gt;\n                &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt;\n            &lt;/intent-filter&gt;\n            &lt;meta-data android:name=\"android.app.lib_name\" android:value=\"name.app\" /&gt;\n        &lt;/activity&gt;\n    &lt;/application&gt;\n&lt;/manifest&gt;\n</code></pre>\n\n<p>and trying to place icon png file(s) in assets subdirectory:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 *.go\n\u251c\u2500\u2500 AndroidManifest.xml\n\u2514\u2500\u2500 assets\n \u00a0\u00a0 \u251c\u2500\u2500 drawable-hdpi\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ic_launcher.png\n \u00a0\u00a0 \u251c\u2500\u2500 drawable-mdpi\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ic_launcher.png\n \u00a0\u00a0 \u251c\u2500\u2500 drawable-xhdpi\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ic_launcher.png\n \u00a0\u00a0 \u251c\u2500\u2500 drawable-xxhdpi\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ic_launcher.png\n \u00a0\u00a0 \u251c\u2500\u2500 drawable-xxxhdpi\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 ic_launcher.png\n \u00a0\u00a0 \u2514\u2500\u2500 ic_launcher.png\n</code></pre>\n\n<p>Instead of <code>android:icon=\"@assets/ic_launcher\"</code> I've also tried <code>android:icon=\"@drawable/ic_launcher\"</code> and <code>android:icon=\"@assets/drawable/ic_launcher\"</code>  without any results.</p>\n\n<p>Any solution?</p>\n\n<p><em>note: gomobile have only assets directory as a place for custom files.</em></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1442834746, "post_id": 32693931, "comment_id": 53231003, "body": "It tries to send and if that doesn&#39;t work out it does something else (close and delete)."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1442836606, "post_id": 32694138, "comment_id": 53232143, "body": "It&#39;s not just useful for unbuffered channels. Select also works for buffered, closed, and nil channels."}, {"owner": {"reputation": 745, "user_id": 1823636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56dc271a930773cc7ce95dfceedcd83e?s=128&d=identicon&r=PG", "display_name": "sisoft", "link": "https://stackoverflow.com/users/1823636/sisoft"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1442836945, "post_id": 32694138, "comment_id": 53232377, "body": "It doesn&#39;t work for closed channels and send operation. Trying to send to closed channel will panic() in any case. But for nil and fully filled buffered channels it&#39;s true."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1442841556, "post_id": 32694138, "comment_id": 53235653, "body": "I know, but this same pattern works for receives too, where you often have a closed channel."}], "tags": [], "owner": {"reputation": 745, "user_id": 1823636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56dc271a930773cc7ce95dfceedcd83e?s=128&d=identicon&r=PG", "display_name": "sisoft", "link": "https://stackoverflow.com/users/1823636/sisoft"}, "is_accepted": true, "score": 6, "last_activity_date": 1442837162, "last_edit_date": 1442837162, "creation_date": 1442835101, "answer_id": 32694138, "question_id": 32693931, "link": "https://stackoverflow.com/questions/32693931/what-is-the-benefit-of-sending-to-a-channel-by-using-select-in-go/32694138#32694138", "title": "What is the benefit of sending to a channel by using select in Go?", "body": "<p>It's method of guaranted nonblocking send to channel.\nIn case of c.send chan can't accept new messages now, a default branch will be executed.\nWithout select{} block sending to unbuffered or fully filled buffered channel can be blocked.</p>\n"}, {"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": false, "score": 1, "last_activity_date": 1442840672, "creation_date": 1442840672, "answer_id": 32695999, "question_id": 32693931, "link": "https://stackoverflow.com/questions/32693931/what-is-the-benefit-of-sending-to-a-channel-by-using-select-in-go/32695999#32695999", "title": "What is the benefit of sending to a channel by using select in Go?", "body": "<p><a href=\"https://gobyexample.com/non-blocking-channel-operations\" rel=\"nofollow\">https://gobyexample.com/non-blocking-channel-operations</a></p>\n\n<pre><code>// Basic sends and receives on channels are blocking.\n// However, we can use `select` with a `default` clause to\n// implement _non-blocking_ sends, receives, and even\n// non-blocking multi-way `select`s.\n\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    messages := make(chan string)\n    //[...]\n\n    // Here's a non-blocking receive. If a value is\n    // available on `messages` then `select` will take\n    // the `&lt;-messages` `case` with that value. If not\n    // it will immediately take the `default` case.\n    select {\n    case msg := &lt;-messages:\n        fmt.Println(\"received message\", msg)\n    default:\n        fmt.Println(\"no message received\")\n    }\n\n    // A non-blocking send works similarly.\n    msg := \"hi\"\n    select {\n    case messages &lt;- msg:\n        fmt.Println(\"sent message\", msg)\n    default:\n        fmt.Println(\"no message sent\")\n    }\n    //[...]\n}\n</code></pre>\n\n<p>And to be more clear: for a non-blocking \"send\", the first <code>case</code> will happen if there is a receiver already waiting for a message. Else it falls back to <code>default</code></p>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1057, "favorite_count": 2, "accepted_answer_id": 32694138, "answer_count": 2, "score": 3, "last_activity_date": 1442840672, "creation_date": 1442834442, "question_id": 32693931, "link": "https://stackoverflow.com/questions/32693931/what-is-the-benefit-of-sending-to-a-channel-by-using-select-in-go", "title": "What is the benefit of sending to a channel by using select in Go?", "body": "<p>In the example directory of Gorilla websocket there is a file called hub.go.</p>\n\n<p><a href=\"https://github.com/gorilla/websocket/blob/master/examples/chat/hub.go\" rel=\"nofollow\">https://github.com/gorilla/websocket/blob/master/examples/chat/hub.go</a></p>\n\n<p>Here you can find a method on the type hub that does this.</p>\n\n<pre><code>func (h *hub) run() {\n    for {\n        select {\n        case c := &lt;-h.register:\n            h.connections[c] = true\n        case c := &lt;-h.unregister:\n            if _, ok := h.connections[c]; ok {\n                delete(h.connections, c)\n                close(c.send)\n            }\n        case m := &lt;-h.broadcast:\n            for c := range h.connections {\n                select {\n                case c.send &lt;- m:\n                default:\n                    close(c.send)\n                    delete(h.connections, c)\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Why does it not just send to the c.send channel straight up in the last case like this?</p>\n\n<pre><code>case m := &lt;-h.broadcast:\n    for c := range h.connections {\n        c.send &lt;- m\n    }\n</code></pre>\n"}, {"tags": ["memory", "go", "allocation"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1442834632, "post_id": 32693799, "comment_id": 53230928, "body": "Measuring &quot;how much memory is used&quot; was a simple task 25 years ago. It is no longer simple as there is a fast amount of different types of &quot;memory&quot;. And &quot;used&quot; is a much to vague term for memory. Use the toolage provided by <code>go test -benchmem</code> to see how &quot;allocation heavy&quot; your code is. That metric is more reliable and more important."}], "answers": [{"comments": [{"owner": {"reputation": 434, "user_id": 3961221, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y8Wtj.jpg?s=128&g=1", "display_name": "plamer", "link": "https://stackoverflow.com/users/3961221/plamer"}, "edited": false, "score": 0, "creation_date": 1442835268, "post_id": 32693964, "comment_id": 53231302, "body": "Thanks, I&#39;m just playing around and wanted to see what happens. This: <i>&quot;There&#39;s nothing whatsoever in your code that requires memory. The compiler is perfectly within its rights to optimize the whole allocation away, and even if the compiler doesn&#39;t do it&quot;</i> helped :) - I added <code>for e, _ := range buffer { \t\tbuffer[e] = &quot;string&quot; \t}</code> and now when I run it on the linux box the mem used gets up with 1.6 gigs."}], "tags": [], "owner": {"reputation": 57221, "user_id": 3032289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c171ec0f2c8040d24436a40a3bf075b?s=128&d=identicon&r=PG", "display_name": "Luaan", "link": "https://stackoverflow.com/users/3032289/luaan"}, "is_accepted": true, "score": 4, "last_activity_date": 1442834571, "creation_date": 1442834571, "answer_id": 32693964, "question_id": 32693799, "link": "https://stackoverflow.com/questions/32693799/golang-memory-allocation-test/32693964#32693964", "title": "Golang memory allocation test", "body": "<p>There's nothing whatsoever in your code that <em>requires</em> memory. The compiler is perfectly within its rights to optimize the whole allocation away, and even if the compiler doesn't do it, the OS will not <em>commit</em> the memory - you're never assigning anything, so it's likely just mirroring a zero-page.</p>\n\n<p>I don't know anything about the subtle differences between whatever Linux you're using and whatever MacOS you're using, so there's little that can be said with certainty. It might very well be that your way of checking memory on your linux machine gives you only committed memory, while you're seeing all virtual memory on your MacOS, or there might be other subtle differences. In any case, since compilers became smart and since we had virtual memory on PCs, it's been getting harder and harder to get any meaningful benchmarks - the tools we work with are usually smart enough to avoid unnecessary waste; and most benchmarks you'll try are pretty much completely unnecessary waste.</p>\n\n<p>Benchmarking is hard.</p>\n"}], "owner": {"reputation": 434, "user_id": 3961221, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y8Wtj.jpg?s=128&g=1", "display_name": "plamer", "link": "https://stackoverflow.com/users/3961221/plamer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2420, "favorite_count": 0, "accepted_answer_id": 32693964, "answer_count": 1, "score": 1, "last_activity_date": 1442834571, "creation_date": 1442834085, "question_id": 32693799, "link": "https://stackoverflow.com/questions/32693799/golang-memory-allocation-test", "title": "Golang memory allocation test", "body": "<p>I'm trying to allocate memory with my \"program\" - just to allocate it and stay there - for testing purposes. When I run it on my MacOS the Activity Monitor shows it allocates 1.6 gb, when I compile it for linux and run it there it does nothing - it prints the message but the ram isn't being used on the machine. Am I doing it wrong? Is there a better way? Here is my code:</p>\n\n<pre><code>package main\n\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n    \"time\"\n)\n\n\nfunc main() {\n    var buffer [100 * 1024 * 1024]string\n    fmt.Printf(\"The size of the buffer is: %d bytes\\n\", unsafe.Sizeof(buffer))\n    time.Sleep(300 * time.Second)\n}\n</code></pre>\n\n<p>First I used byte for my array type, but it did not worked event on my mac? </p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "edited": false, "score": 0, "creation_date": 1442826143, "post_id": 32690165, "comment_id": 53225812, "body": "trying to get this to work... no luck so far. if packagea is empty, would the import in packageb for packageab still be packagea/packageb?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "edited": false, "score": 0, "creation_date": 1442828436, "post_id": 32690165, "comment_id": 53227238, "body": "@davidkomer Yes, the import still must be <code>packagea&#47;packageab</code> if the file is under the folder <code>packagea&#47;packageab</code> inside the project."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1442822976, "last_edit_date": 1442822976, "creation_date": 1442822554, "answer_id": 32690165, "question_id": 32690040, "link": "https://stackoverflow.com/questions/32690040/subfolders-and-packages-when-using-appengine-and-go/32690165#32690165", "title": "Subfolders and packages when using Appengine and Go", "body": "<p>There is no magic here. Just make sure each of your go files is placed in a folder and not in the root of your appengine project.</p>\n\n<p>For example:</p>\n\n<pre><code>-[Project root]\n    app.yaml\n    -[packagea]\n        packagea.go\n        -[packageab]\n            packageab.go\n    -[packageb]\n            packageb.go\n</code></pre>\n\n<p>In the example above, package declarations should be as follows:</p>\n\n<ul>\n<li><p>packagea.go:</p>\n\n<pre><code>package packagea\n</code></pre></li>\n<li><p>packageab.go</p>\n\n<pre><code>package packageab\n</code></pre></li>\n<li><p>packageb.go</p>\n\n<pre><code>package packageb\n</code></pre></li>\n</ul>\n\n<p>And for example if <code>packageb</code> uses both <code>packagea</code> and <code>packageab</code>, import them as:</p>\n\n<ul>\n<li><p>packageb.go:</p>\n\n<pre><code>import (\n    \"packagea\"\n    \"packagea/packageab\"\n)\n</code></pre></li>\n</ul>\n\n<p><strong>Note:</strong></p>\n\n<p>Note that you cannot create an import cycle (e.g. <code>packagea</code> imports <code>packageb</code>, and <code>packageb</code> imports <code>packagea</code>):</p>\n\n<p><a href=\"https://golang.org/ref/spec#Import_declarations\" rel=\"nofollow\">Spec: Import declarations</a></p>\n\n<blockquote>\n  <p>An import declaration declares a dependency relation between the importing and imported package. It is illegal for a package to import itself, directly or indirectly.</p>\n</blockquote>\n\n<p>You have to structure your code and packages to avoid import cycles or your code will not compile.</p>\n"}], "owner": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 423, "favorite_count": 1, "accepted_answer_id": 32690165, "answer_count": 1, "score": 2, "last_activity_date": 1442822976, "creation_date": 1442822104, "question_id": 32690040, "link": "https://stackoverflow.com/questions/32690040/subfolders-and-packages-when-using-appengine-and-go", "title": "Subfolders and packages when using Appengine and Go", "body": "<p>When deploying and/or testing a Go project for appengine, the appcfg.py and dev_appserver.py tools are used to compile the project</p>\n\n<p>That works fine when all the *.go files are in one folder, but how can a project be be compiled when code is divided into subfolders- yet also need to access functions and constants from eachother?</p>\n\n<p>In Go- subfolders are by definition package boundaries, and I can't see a way to allow the appengine tools to compile multiple packages before testing or deploying, from one project.</p>\n\n<p>Advice on how to tackle this- other than keeping it all in one folder, is appreciated. Even if the solution is to approach it one package (folder) at a time, advice on how to structure that for quick iteration on one project that uses all those packages is appreciated. Thanks!</p>\n"}, {"tags": ["go", "refactoring"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 2, "creation_date": 1442823128, "post_id": 32689816, "comment_id": 53224185, "body": "that will not be a good idea I think. IP layer is too low for a client library of a network service, thinking a distributed system like replication and sharding."}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1442823436, "post_id": 32689816, "comment_id": 53224333, "body": "Maybe something like this? <a href=\"https://play.golang.org/p/QeFH1gj6NA\" rel=\"nofollow noreferrer\">play.golang.org/p/QeFH1gj6NA</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1442825224, "post_id": 32689816, "comment_id": 53225258, "body": "Please no! Each loop is clear, it does one thing, it is very short and you do some error handling which is okay. Don&#39;t combine different stuff here. Assume the following: In 6 month your <code>ConnectToNSQD</code> gets a new error code <code>FailedButPleaseRetryIn15ms</code>. Now you may want to retry the same IP after some sleep, but only in <b>one</b> of these functions. IMHO &quot;DRY&quot; as main principle to follow brainless is dead ugly. I like the negated form much better &quot;Do not write un-DRY code&quot;. Your two loops are DRY like a good martini."}, {"owner": {"reputation": 2776, "user_id": 870776, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9eaefc0b42d4bee7c5bf93613a81444a?s=128&d=identicon&r=PG", "display_name": "eversor", "link": "https://stackoverflow.com/users/870776/eversor"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1442827142, "post_id": 32689816, "comment_id": 53226465, "body": "@Volker interesting point, although I do not agree with your justification based on a non-existing requirement. However, we can discuss the necessity of creating a function, because it is true that each loop do one thing and it is clear what they do."}, {"owner": {"reputation": 2776, "user_id": 870776, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9eaefc0b42d4bee7c5bf93613a81444a?s=128&d=identicon&r=PG", "display_name": "eversor", "link": "https://stackoverflow.com/users/870776/eversor"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1442827386, "post_id": 32689816, "comment_id": 53226609, "body": "@Volker I think the advantages of extracting that loop to a function are twofold: 1) Increases readability and 2) makes testing easier"}], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1442839755, "post_id": 32691039, "comment_id": 53234352, "body": "&quot;The scope of an identifier denoting a constant, type, variable, or function (but not method) declared at top level (outside any function) is the package block.&quot;  The <code>publisher</code> package level variable is not a good idea."}, {"owner": {"reputation": 3805, "user_id": 2075801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f845c96122bd745f0614185a840d850b?s=128&d=identicon&r=PG", "display_name": "Yury Lebedev", "link": "https://stackoverflow.com/users/2075801/yury-lebedev"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1442839911, "post_id": 32691039, "comment_id": 53234459, "body": "Sorry, but it was just a gist, since i have no idea, from which function the top part should be called"}], "tags": [], "owner": {"reputation": 3805, "user_id": 2075801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f845c96122bd745f0614185a840d850b?s=128&d=identicon&r=PG", "display_name": "Yury Lebedev", "link": "https://stackoverflow.com/users/2075801/yury-lebedev"}, "is_accepted": false, "score": 1, "last_activity_date": 1442825762, "creation_date": 1442825762, "answer_id": 32691039, "question_id": 32689816, "link": "https://stackoverflow.com/questions/32689816/almost-repeating-myself/32691039#32691039", "title": "Almost Repeating Myself", "body": "<p>Maybe something like this?</p>\n\n<pre><code>var publisher *nsq.Producer\n\nconnectToWorkingIP(ips, func(ip string) error {\n    var err error\n    publisher, err = nsq.NewProducer(ip, nsq.NewConfig())\n    return err\n})\n\nconnectToWorkingIP(ips, func(ip string) error {\n    return consumer.ConnectToNSQD(ip)\n})\n\n\nfunc connectToWorkingIP(ips []string, f func(string) error) {\n    for i, success := 0, false; i &lt; len(ips) &amp;&amp; !success; i++ {\n        err := f(ips[i])\n        if err == nil {\n            success = true\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1442844937, "last_edit_date": 1442844937, "creation_date": 1442839423, "answer_id": 32695566, "question_id": 32689816, "link": "https://stackoverflow.com/questions/32689816/almost-repeating-myself/32695566#32695566", "title": "Almost Repeating Myself", "body": "<p>You have it backwards. Your solution should follow the shape of the problem, not the shape of a particular solution. There's nothing in the solution that's worth refactoring. It's just going to add pointless complexity.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport \"github.com/nsqio/go-nsq\"\n\n// NewProducer is nsq.NewProducer with retries of an address list.\nfunc NewProducer(addrs []string, config *nsq.Config) (producer *nsq.Producer, err error) {\n    if len(addrs) == 0 {\n        addrs = append(addrs, \"\")\n    }\n    for _, addr := range addrs {\n        producer, err = nsq.NewProducer(addr, config)\n        if err == nil {\n            break\n        }\n    }\n    return producer, err\n}\n\n// ConnectToNSQD is nsq.ConnectToNSQD with retries of an address list.\nfunc ConnectToNSQD(c *nsq.Consumer, addrs []string) (err error) {\n    if len(addrs) == 0 {\n        addrs = append(addrs, \"\")\n    }\n    for _, addr := range addrs {\n        err = c.ConnectToNSQD(addr)\n        if err == nil {\n            break\n        }\n    }\n    return err\n}\n\nfunc main() {}\n</code></pre>\n"}], "owner": {"reputation": 2776, "user_id": 870776, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9eaefc0b42d4bee7c5bf93613a81444a?s=128&d=identicon&r=PG", "display_name": "eversor", "link": "https://stackoverflow.com/users/870776/eversor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 1, "accepted_answer_id": 32695566, "answer_count": 2, "score": 2, "last_activity_date": 1442844937, "creation_date": 1442821319, "question_id": 32689816, "link": "https://stackoverflow.com/questions/32689816/almost-repeating-myself", "title": "Almost Repeating Myself", "body": "<blockquote>\n  <p><strong>Combinitorial Explosion</strong> You have lots of code that does almost the same thing.. but with tiny variations in data or behavior. This can be difficult to refactor-- perhaps using generics or an interpreter? - Jeff Atwood via <a href=\"http://blog.codinghorror.com/code-smells/\" rel=\"nofollow\">Coding Horror</a></p>\n</blockquote>\n\n<p>In this case it is not lots of code, but it is still bugging me. I have a shared problem, that is when trying to connect to an IP, if it fails, I should retry with the next IP.</p>\n\n<p>I have one function which generates a producer for NSQ:</p>\n\n<pre><code>//Since we are in a critical system, we try with each IP until we get a producer\nvar err error\nfor i, success := 0, false; i &lt; len(ips) &amp;&amp; !success; i++ {\n    publisher, err = nsq.NewProducer(ips[i], nsq.NewConfig())\n    if err == nil {\n        success = true\n    }\n}\n</code></pre>\n\n<p>The other function that almost shares the same code is one which takes a NSQ consumer and connects it:</p>\n\n<pre><code>var err error\nfor i, success := 0, false; i &lt; len(ips) &amp;&amp; !success; i++ {\n    err = consumer.ConnectToNSQD(ips[i])\n    if err == nil {\n        success = true\n    }\n}\n</code></pre>\n\n<p>I would like to get rid of this almost repeated code without sacrificing legibility. Ideas?</p>\n"}, {"tags": ["file", "go", "decode"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1442814671, "post_id": 32687985, "comment_id": 53220447, "body": "<a href=\"http://stackoverflow.com/questions/1821811/how-to-read-write-from-to-file\">How to read/write from/to file?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "is_accepted": true, "score": 14, "last_activity_date": 1539103554, "last_edit_date": 1539103554, "creation_date": 1442813760, "answer_id": 32688007, "question_id": 32687985, "link": "https://stackoverflow.com/questions/32687985/convert-back-byte-array-into-file-using-golang/32688007#32688007", "title": "Convert back byte array into file using golang", "body": "<p>Sounds like you just want the <code>ioutil.WriteFile</code> function from the standard library.</p>\n\n<p><a href=\"https://golang.org/pkg/io/ioutil/#WriteFile\" rel=\"noreferrer\">https://golang.org/pkg/io/ioutil/#WriteFile</a></p>\n\n<p>It would look something like this:</p>\n\n<pre><code>permissions := 0644 // or whatever you need\nbyteArray := []byte(\"to be written to a file\\n\")\nerr := ioutil.WriteFile(\"file.txt\", byteArray, permissions)\nif err != nil { \n    // handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 187, "user_id": 4305917, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100001241510496/picture?type=large", "display_name": "Shailesh", "link": "https://stackoverflow.com/users/4305917/shailesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8558, "favorite_count": 1, "accepted_answer_id": 32688007, "answer_count": 1, "score": 3, "last_activity_date": 1539103554, "creation_date": 1442813624, "last_edit_date": 1442813905, "question_id": 32687985, "link": "https://stackoverflow.com/questions/32687985/convert-back-byte-array-into-file-using-golang", "title": "Convert back byte array into file using golang", "body": "<p>Is there a way to write a byte array to a file? I have the file name and file extension(like temp.xml).</p>\n"}, {"tags": ["go", "docker-compose"], "comments": [{"owner": {"reputation": 7931, "user_id": 441099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d18ac367611aeb431cef6e156525d5a?s=128&d=identicon&r=PG", "display_name": "Guy Sirton", "link": "https://stackoverflow.com/users/441099/guy-sirton"}, "edited": false, "score": 1, "creation_date": 1442812564, "post_id": 32686931, "comment_id": 53219843, "body": "What&#39;s in <code>&#47;go&#47;src</code>?  There seems to be some confusion between <code>&#47;goSvc</code> and <code>&#47;go</code> in your question.  Typically there would be one location where Go is installed (lets say /usr/local/go) and then your Go workspace <a href=\"http://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a> which the GOPATH environment variable should point at.  It&#39;s not clear what&#39;s what in your question.  Maybe start without Docker first?"}, {"owner": {"reputation": 4421, "user_id": 788077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6a17de90749f7777d0dbaeeaef51f076?s=128&d=identicon&r=PG", "display_name": "Fuxi", "link": "https://stackoverflow.com/users/788077/fuxi"}, "edited": false, "score": 2, "creation_date": 1442820924, "post_id": 32686931, "comment_id": 53223058, "body": "For me it looked like there was a problem while building docker image. Can you include it as well (Dockerfile)? And try build the image with docker command too"}, {"owner": {"reputation": 1803, "user_id": 167408, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/slHOv.png?s=128&g=1", "display_name": "Highstead", "link": "https://stackoverflow.com/users/167408/highstead"}, "reply_to_user": {"reputation": 7931, "user_id": 441099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d18ac367611aeb431cef6e156525d5a?s=128&d=identicon&r=PG", "display_name": "Guy Sirton", "link": "https://stackoverflow.com/users/441099/guy-sirton"}, "edited": false, "score": 0, "creation_date": 1442845258, "post_id": 32686931, "comment_id": 53238316, "body": "@GuySirton goSvc is just the folder i keep the local golang source in before it gets propagated out to the docker container.  root(pwd) = /home/highstead/projects/goSvc"}, {"owner": {"reputation": 1803, "user_id": 167408, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/slHOv.png?s=128&g=1", "display_name": "Highstead", "link": "https://stackoverflow.com/users/167408/highstead"}, "reply_to_user": {"reputation": 4421, "user_id": 788077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6a17de90749f7777d0dbaeeaef51f076?s=128&d=identicon&r=PG", "display_name": "Fuxi", "link": "https://stackoverflow.com/users/788077/fuxi"}, "edited": false, "score": 0, "creation_date": 1442845268, "post_id": 32686931, "comment_id": 53238325, "body": "@fuxi Attached, thanks."}], "answers": [{"tags": [], "owner": {"reputation": 4421, "user_id": 788077, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6a17de90749f7777d0dbaeeaef51f076?s=128&d=identicon&r=PG", "display_name": "Fuxi", "link": "https://stackoverflow.com/users/788077/fuxi"}, "is_accepted": true, "score": 3, "last_activity_date": 1442911866, "creation_date": 1442911866, "answer_id": 32712511, "question_id": 32686931, "link": "https://stackoverflow.com/questions/32686931/docker-compose-golang-no-buildable-source/32712511#32712511", "title": "Docker-Compose golang - No buildable Source", "body": "<p>Image you used is used to automatically build Go app when building initial image.</p>\n\n<p>Have a look at it's <a href=\"https://github.com/docker-library/golang/blob/3427e88341de17a4d8921b859180a2649e1ab96e/1.4/onbuild/Dockerfile\" rel=\"nofollow\">Dockerfile</a>. There is <code>ONBUILD COPY . /go/src/app</code> statement.</p>\n\n<p>So you can either locate Dockerfile where <code>main.go</code> is located or use image without <code>ONBUILD</code> trigger and then run <code>go run</code> manually/with <code>docker-compose</code>.</p>\n"}], "owner": {"reputation": 1803, "user_id": 167408, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/slHOv.png?s=128&g=1", "display_name": "Highstead", "link": "https://stackoverflow.com/users/167408/highstead"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2356, "favorite_count": 1, "accepted_answer_id": 32712511, "answer_count": 1, "score": 3, "last_activity_date": 1442911866, "creation_date": 1442806351, "last_edit_date": 1442845200, "question_id": 32686931, "link": "https://stackoverflow.com/questions/32686931/docker-compose-golang-no-buildable-source", "title": "Docker-Compose golang - No buildable Source", "body": "<p>I've followed a couple of tutorials and am having trouble figuring out what i've done wrong.  I suspect its a very basic principal but that said as i'm new to both GoLang and docker-compose i'm not 100% sure which is my problem.</p>\n\n<p>I'm running the golang:build docker image which just retrieves a couple github repositories.</p>\n\n<p>Any help would be much appreciated.</p>\n\n<p>The error is as follows:</p>\n\n<pre><code>+ exec go get -v -d\ncan't load package: package app: no buildable Go source files in /go/src/app\nService 'ddd' failed to build: The command '/bin/sh -c go-wrapper download' returned a non-zero code: 1\n</code></pre>\n\n<p>The Docker-Compose file looks like this</p>\n\n<pre><code>ddd:\n  build: ./goSvc\n  working_dir: /go/src/\n  command: go run main.go\n  volumes:\n    - ./goSvc/src/main.go:/go/src/main.go\n    - ./goSvc/src/ddd:/go/src/ddd\n  ports:\n    - 8080:8080\n  environment:\n    - DB_NAME=rnse\n    - DEBUG=true\n</code></pre>\n\n<p>Go project structure</p>\n\n<pre><code>root\n  goSvc\n    pkg\n    src\n      ddd\n        internal\n          logic\n        ...myGoFiles\n      github.com\n      main.go\n    Dockerfile\n</code></pre>\n\n<p>Edit:\nIncluding docker file for golang:</p>\n\n<pre><code>FROM golang:onbuild\nRUN go get github.com/gorilla/mux\nRUN go get github.com/lib/pq\nEXPOSE 8080\n</code></pre>\n"}, {"tags": ["ios", "objective-c", "encryption", "go", "cryptography"], "comments": [{"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 2, "creation_date": 1442807820, "post_id": 32686871, "comment_id": 53218584, "body": "Note: as soon as I saw that the data was being Base64 encoded prior to encryption red flags went off, that makes no sense and indicate someone without a good grounding in cryptographic usage hads created the code. In order to obtain security, not just cryptography, one needs a domain expert. Your security needs may vary."}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1442807971, "post_id": 32686871, "comment_id": 53218608, "body": "1. A CCCryptorStatus of 0 means little, certainly not that the decryption was successful or not. 2. Base64 encoding prior to encryption makes no sense in general, AES encryption is 8-bit data based. 3. it is unclear if any padding is being done on the Go side, it looks like it is xor&#39;ing a stream, the iOS side is operating in CBC block mode without padding which is incorrect unless all data is a multiple of the block size. 4. Not knowing Go test data is going to be required: data in, iv, data out all in hex dumps as close to the encryption calls as possible."}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1442807999, "post_id": 32686871, "comment_id": 53218619, "body": "5. It looks like Go is creating a random iv and that iv must get to the decryption code somehow, many times it is prepended to the data. 6. Go is using CFB mode which is not supported my CCCrypt. In CCrypt the key size must be explicitly specified, it looks like GO is determining a key size based on the supplied key"}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1442808049, "post_id": 32686871, "comment_id": 53218626, "body": "The best bet is to use AES with a specified key size and keys that are exactly that size, CBC mode with a random iv that is prepended to the encrypted tex and PKCS#7 padding. Further, it the key is a password it should be converted to a proper key with PBKDF2 prior to use. This is a common and rather secure method. The nice thing about CCCrypt is that all parameters are explicitly specified and are all 8-byte data, it is completely clear what is happening. Wit Go it is going to take some documentation digging to understand what is being done &quot;under the hood&quot;."}, {"owner": {"reputation": 30899, "user_id": 19851, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/nEJ48.jpg?s=128&g=1", "display_name": "Abhi Beckert", "link": "https://stackoverflow.com/users/19851/abhi-beckert"}, "edited": false, "score": 0, "creation_date": 1442810173, "post_id": 32686871, "comment_id": 53219117, "body": "Are you sure the block size is 128? Also... if you don&#39;t get a good answer here, try asking on the CCCryptor GitHub Issue Tracker."}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "reply_to_user": {"reputation": 30899, "user_id": 19851, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/nEJ48.jpg?s=128&g=1", "display_name": "Abhi Beckert", "link": "https://stackoverflow.com/users/19851/abhi-beckert"}, "edited": false, "score": 1, "creation_date": 1442811069, "post_id": 32686871, "comment_id": 53219369, "body": "@AbhiBeckert AES has only one block size of 128-bits, there is no mention of Rijndael. There is a mismatch between Go CFB mode and CCCrypt default mode of CBC. The main issue is what Go is really doing, how the iv is being passed and how they are handling padding, probably none with CFB mode. Do you have a link to the &quot;CCCryptor GitHub Issue Tracker&quot;, I don&#39;t see any issues?"}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "reply_to_user": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1442818338, "post_id": 32686871, "comment_id": 53221876, "body": "@zaph CFB is a streaming mode of operation, it does&#39;t need padding."}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1442818349, "post_id": 32686871, "comment_id": 53221883, "body": "@CGuess the IV is not saved in the Go code. The Go part and encryption scheme must be re-thought completely. There seems to be no integrity or authenticity for it either."}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "reply_to_user": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1442825524, "post_id": 32686871, "comment_id": 53225426, "body": "@MaartenBodewes Yes I am aware CFB is a streaming mode and does not need padding and yet the OP is trying to use CBC mode which does on the iOS side. I am hedging my words because I am not willing to spend the time to dive into the Go documentation without even knowing if the OP is going to pursue the question. The usual outcome is that the OP will not be able to or will be unwilling to change the server side and will not believe that their scheme needs to be changed. I agree with your assessment in your comment to the OP."}, {"owner": {"reputation": 345, "user_id": 604031, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/716725aebaee97a244ce88b27c296de9?s=128&d=identicon&r=PG", "display_name": "CGuess", "link": "https://stackoverflow.com/users/604031/cguess"}, "reply_to_user": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1442836754, "post_id": 32686871, "comment_id": 53232244, "body": "@zaph, I&#39;m definitely pursuing this and your method above seems like a great first step. I didn&#39;t realize CCCryptor doesn&#39;t support CFB mode. Is there a particular AES mode that is recommended over others? You mentioned CBC, that&#39;s the best way to go?"}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1442848736, "post_id": 32686871, "comment_id": 53240754, "body": "@CGuess Great! My recommendation is to use RNCryptor, see my answer."}], "answers": [{"tags": [], "owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "is_accepted": true, "score": 1, "last_activity_date": 1442849061, "last_edit_date": 1442849061, "creation_date": 1442848653, "answer_id": 32698803, "question_id": 32686871, "link": "https://stackoverflow.com/questions/32686871/decrypting-data-with-cccryptor-in-objective-c-that-was-encrypted-with-cfb-in-go/32698803#32698803", "title": "Decrypting data with CCCryptor in Objective-C that was encrypted with CFB in Go", "body": "<p>My recommendation is to use <a href=\"https://github.com/RNCryptor/RNCryptor\" rel=\"nofollow\">RNCryptor</a>, there is an <a href=\"https://github.com/RNCryptor/RNCryptor\" rel=\"nofollow\">iOS</a> and a <a href=\"https://github.com/RNCryptor/RNCryptor-go\" rel=\"nofollow\">Go</a> implementation available.</p>\n\n<p>RNCryptor combines all the necessary cryptographic primitives for your needs including:</p>\n\n<ul>\n<li>AES-256 encryption (Advanced Encryption Standard)</li>\n<li>CBC mode (Cipher Block Chaining)</li>\n<li>Password stretching with PBKDF2 (Password Based Key Derivation Function 2)</li>\n<li>Password salting</li>\n<li>Random IV (Initialization Vector)</li>\n<li>Encrypt-then-hash HMAC (Authentication)</li>\n</ul>\n\n<p>It has been extensively deployed and vetted.</p>\n\n<p>It is all to easy to get cryptography wrong and using RNCryptor will avoid the potential pitfalls.</p>\n\n<p>If I had the cryptographic needs you have I would use it.</p>\n"}], "owner": {"reputation": 345, "user_id": 604031, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/716725aebaee97a244ce88b27c296de9?s=128&d=identicon&r=PG", "display_name": "CGuess", "link": "https://stackoverflow.com/users/604031/cguess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 785, "favorite_count": 1, "accepted_answer_id": 32698803, "answer_count": 1, "score": 0, "last_activity_date": 1442849061, "creation_date": 1442805931, "question_id": 32686871, "link": "https://stackoverflow.com/questions/32686871/decrypting-data-with-cccryptor-in-objective-c-that-was-encrypted-with-cfb-in-go", "title": "Decrypting data with CCCryptor in Objective-C that was encrypted with CFB in Go", "body": "<p>I've been working on this for a long time, but am stuck.</p>\n\n<p>I'm writing an iOS app that takes AES encrypted data form a Go server-side application and decrypts it. I'm using CCCryptor for the decryption on the iOS side. However, I cannot, for the life of me, get plaintext out. There is a working Java/Android implementation, and it decrypts fine on the Go side, so I'm pretty sure it's to do with my CCCryptor settings.</p>\n\n<p>I'm actually getting a 0 success status on decryption, but taking the output and doing a NSString initWithBytes gives me a null string.</p>\n\n<p>Note: I'm only writing the iOS side.</p>\n\n<p><strong>Go code that encrypts:</strong></p>\n\n<pre><code>func encrypt(key, text []byte) []byte {\n\n  block, err := aes.NewCipher(key)\n  if err != nil {\n    panic(err)\n  }\n\n  b := encodeBase64(text)\n  ciphertext := make([]byte, aes.BlockSize+len(b))\n  iv := ciphertext[:aes.BlockSize]\n  if _, err := io.ReadFull(rand.Reader, iv); err != nil {\n    panic(err)\n  }\n\n  cfb := cipher.NewCFBEncrypter(block, iv)\n\n  cfb.XORKeyStream(ciphertext[aes.BlockSize:], []byte(b))\n\n  return ciphertext\n}\n</code></pre>\n\n<p><strong>Objective-C code that decrypts</strong></p>\n\n<pre><code>+ (NSData *)decrypt:(NSData*)data withPassword:(NSString*)password{\n\n\nNSData * key = [password dataUsingEncoding:NSUTF8StringEncoding];\n\nsize_t dataLength   = [data length] - kCCBlockSizeAES128;\nNSData *iv          = [data subdataWithRange:NSMakeRange(0, kCCBlockSizeAES128)];\nNSData *encrypted   = [data subdataWithRange:NSMakeRange(kCCBlockSizeAES128, dataLength)];\n\n//See the doc: For block ciphers, the output size will always be less than or\n//equal to the input size plus the size of one block.\n//That's why we need to add the size of one block here\n//    size_t bufferSize = dataLength + kCCBlockSizeAES128;\n//    void *buffer = malloc(dataLength);\nNSMutableData *ret = [NSMutableData dataWithLength:dataLength + kCCBlockSizeAES128];\n\nsize_t numBytesDecrypted = 0;\nCCCryptorStatus status = CCCrypt(kCCDecrypt, kCCAlgorithmAES,\n                                 0x0000, // change to 0 solve the problem\n                                 [key bytes],\n                                 kCCKeySizeAES256,\n                                 [iv bytes],\n                                 [encrypted bytes], dataLength, /* input */\n                                 [ret mutableBytes], [ret length], /* output */\n                                 &amp;numBytesDecrypted\n                                 );\n\nNSLog(@\"err: %d\", status);\nNSLog(@\"dataLength: %d, num: %d\", (int)dataLength, (int)numBytesDecrypted);\nif (status == kCCSuccess) {\n    //the returned NSData takes ownership of the buffer and will free it on deallocation\n    return ret;\n}\n\n//    free(buffer); //free the buffer;\nreturn nil;\n}\n</code></pre>\n"}, {"tags": ["string", "go", "binary"], "answers": [{"tags": [], "owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "is_accepted": false, "score": 6, "last_activity_date": 1474537380, "last_edit_date": 1474537380, "creation_date": 1442795451, "answer_id": 32685739, "question_id": 32685687, "link": "https://stackoverflow.com/questions/32685687/convert-string-to-binary-in-go/32685739#32685739", "title": "Convert string to binary in Go", "body": "<p>Cast the 1-character string to a byte in order to get its numerical representation.  </p>\n\n<pre><code>s := \"A\"\nst := fmt.Sprintf(\"%08b\", byte(s[0]))\nfmt.Println(st)\n\nOutput:  \"01000001\"\n</code></pre>\n\n<p>(Bear in mind code \"%b\" (without number in between) causes leading zeros in output to be dropped.)</p>\n"}, {"tags": [], "owner": {"reputation": 11133, "user_id": 4275347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CdbsN.jpg?s=128&g=1", "display_name": "Michael Laszlo", "link": "https://stackoverflow.com/users/4275347/michael-laszlo"}, "is_accepted": false, "score": 5, "last_activity_date": 1442829776, "last_edit_date": 1442829776, "creation_date": 1442795495, "answer_id": 32685743, "question_id": 32685687, "link": "https://stackoverflow.com/questions/32685687/convert-string-to-binary-in-go/32685743#32685743", "title": "Convert string to binary in Go", "body": "<p>You have to iterate over the runes of the string:</p>\n\n<pre><code>func toBinaryRunes(s string) string {\n    var buffer bytes.Buffer\n    for _, runeValue := range s {\n        fmt.Fprintf(&amp;buffer, \"%b\", runeValue)\n    }\n    return fmt.Sprintf(\"%s\", buffer.Bytes())\n}\n</code></pre>\n\n<p>Or over the bytes:</p>\n\n<pre><code>func toBinaryBytes(s string) string {\n    var buffer bytes.Buffer\n    for i := 0; i &lt; len(s); i++ {\n        fmt.Fprintf(&amp;buffer, \"%b\", s[i])\n    }\n    return fmt.Sprintf(\"%s\", buffer.Bytes())\n}\n</code></pre>\n\n<p>Live playground:</p>\n\n<p><a href=\"http://play.golang.org/p/MXZ1Y17xWa\" rel=\"nofollow\">http://play.golang.org/p/MXZ1Y17xWa</a></p>\n"}], "owner": {"reputation": 17817, "user_id": 21473, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f154e43cfa59b8c9a5f4d35024c12b58?s=128&d=identicon&r=PG", "display_name": "deepwell", "link": "https://stackoverflow.com/users/21473/deepwell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3216, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1474537380, "creation_date": 1442794821, "last_edit_date": 1592644375, "question_id": 32685687, "link": "https://stackoverflow.com/questions/32685687/convert-string-to-binary-in-go", "title": "Convert string to binary in Go", "body": "<p>How do you convert a string to its binary representation in Go?</p>\n<p>Example:</p>\n<blockquote>\n<p>Input: &quot;A&quot;</p>\n<p>Output: &quot;01000001&quot;</p>\n</blockquote>\n<p>In my testing, <code>fmt.Sprintf(&quot;%b&quot;, 75)</code> only works on integers.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "edited": false, "score": 0, "creation_date": 1442793436, "post_id": 32685442, "comment_id": 53215751, "body": "From what are you reading in variable <code>r</code> (Internet, Disk, Cluster) ?"}, {"owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "edited": false, "score": 0, "creation_date": 1442793715, "post_id": 32685442, "comment_id": 53215808, "body": "Why do you think <code>ReadLine</code> may never return? Where are you reading from that there is no timeout procedure?"}, {"owner": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1442794689, "post_id": 32685442, "comment_id": 53215974, "body": "I&#39;m reading <code>r</code> from exec.Command.StdoutPipe()"}, {"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "edited": false, "score": 0, "creation_date": 1442796036, "post_id": 32685442, "comment_id": 53216210, "body": "Are you expecting hung execution or empty output on your exec calls?  Using exec.Command.Output() in that goroutine would collect the output and throw an error if the exec.Command didn&#39;t execute without blocking the rest of the program."}, {"owner": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1442798356, "post_id": 32685442, "comment_id": 53216619, "body": "<code>.Output()</code> runs a program and waits for it to exit, but I don&#39;t want to wait for the program to exit. The master program is starting another process. This process is expected to print a line to stdout when it is ready."}, {"owner": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1442798574, "post_id": 32685442, "comment_id": 53216658, "body": "Bravada, yes I want the process to continue running after the readline or timeout."}], "answers": [{"comments": [{"owner": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1442799884, "post_id": 32686130, "comment_id": 53216912, "body": "That fixed my problem.  I was trying all kinds of ways to close the reader, kill the process, etc. I didn&#39;t realize the goroutine was blocking when it tried to write to <code>errCh</code>"}, {"owner": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1442859055, "post_id": 32686130, "comment_id": 53246807, "body": "Ps. Can i add <code>cmd.Release()</code> instead of <code>Wait()</code>?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1442866442, "post_id": 32686130, "comment_id": 53250954, "body": "@Gattster What is cmd.Release()?"}, {"owner": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1442948791, "post_id": 32686130, "comment_id": 53292352, "body": "sorry, I meant <code>cmd.Process.Release()</code>. <a href=\"https://golang.org/pkg/os/#Process.Release\" rel=\"nofollow noreferrer\">golang.org/pkg/os/#Process.Release</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1442949394, "post_id": 32686130, "comment_id": 53292661, "body": "Process.Release does not cleanup the resources use by Command."}, {"owner": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1443057959, "post_id": 32686130, "comment_id": 53344365, "body": "I don&#39;t want to kill the process, but I do want the program that created the process to release all info about it and let the GC throw it away. Isn&#39;t that what release does?  &quot;Release releases any resources associated with the Process p, rendering it unusable in the future. Release only needs to be called if Wait is not.&quot;"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1443070149, "post_id": 32686130, "comment_id": 53347213, "body": "Command.StdoutPipe opens an os.Pipe.  The read end of the pipe is closed in Command.Wait.  The application leaks fd if Wait is not called."}, {"owner": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1443377732, "post_id": 32686130, "comment_id": 53459010, "body": "So Command.Release() is what I need to call if no .Wait(), right?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1443378013, "post_id": 32686130, "comment_id": 53459091, "body": "There is no Command.Release. To release the file descriptors allocated by Command, you must call Command.Wait."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1442799650, "last_edit_date": 1442799650, "creation_date": 1442799188, "answer_id": 32686130, "question_id": 32685442, "link": "https://stackoverflow.com/questions/32685442/leaking-goroutine-when-a-non-blocking-readline-hangs/32686130#32686130", "title": "Leaking goroutine when a non-blocking readline hangs", "body": "<p>ReadLine will not return until either the process exits or the method reads a line. There's no deadline or timeout mechanism for pipes.</p>\n\n<p>The goroutine will block if the call to ReadLine returns after the timeout. This can be fixed by using buffered channels:</p>\n\n<pre><code>ch := make(chan string, 1)\nerrCh := make(chan error, 1)\n</code></pre>\n\n<p>The application should call <a href=\"http://godoc.org/os/exec#Cmd.Wait\" rel=\"nofollow\">Wait</a> to cleanup resources associated with the command. The goroutine is a good place to call it:</p>\n\n<pre><code>go func() {\n  line, _, err := bufio.NewReader(r).ReadLine()\n  if err != nil {\n    errCh &lt;- err\n  } else {\n    ch &lt;- string(line)\n  }\n  cmd.Wait() // &lt;-- add this line\n}()\n</code></pre>\n\n<p>This will cause the goroutine to block, the very thing you are trying to avoid. The alternative is that the application leaks resources for each command.</p>\n"}], "owner": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 751, "favorite_count": 1, "accepted_answer_id": 32686130, "answer_count": 1, "score": 0, "last_activity_date": 1442799650, "creation_date": 1442792527, "question_id": 32685442, "link": "https://stackoverflow.com/questions/32685442/leaking-goroutine-when-a-non-blocking-readline-hangs", "title": "Leaking goroutine when a non-blocking readline hangs", "body": "<p>Assuming you have a structure like this:</p>\n\n<pre><code>ch := make(chan string)\nerrCh := make(chan error)\ngo func() {\n    line, _, err := bufio.NewReader(r).ReadLine()\n    if err != nil {\n        errCh &lt;- err\n    } else {\n        ch &lt;- string(line)\n    }\n}()\nselect {\ncase err := &lt;-errCh:\n    return \"\", err\ncase line := &lt;-ch:\n    return line, nil\ncase &lt;-time.After(5 * time.Second):\n    return \"\", TimeoutError\n}\n</code></pre>\n\n<p>In the case of the 5 second timeout, the goroutine hangs until ReadLine returns, which may never happen. My project is a long-running server, so I don't want a buildup of stuck goroutines. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1442776663, "post_id": 32683252, "comment_id": 53211194, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/29554369/finding-functions-that-return-a-specific-type\">Finding functions that return a specific type</a>"}, {"owner": {"reputation": 2703, "user_id": 571904, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c572e5fe7bb7ce143d194148eb0dcd44?s=128&d=identicon&r=PG", "display_name": "ostler.c", "link": "https://stackoverflow.com/users/571904/ostler-c"}, "edited": false, "score": 2, "creation_date": 1442782987, "post_id": 32683252, "comment_id": 53213255, "body": "Do you mean programmatically generate a list of functions that return an io.Reader? Or do you want to know how to discern if a type implements the io.Reader?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1442784881, "post_id": 32683252, "comment_id": 53213819, "body": "You read the documentation."}], "answers": [{"tags": [], "owner": {"reputation": 86, "user_id": 6227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qPmCH.jpg?s=128&g=1", "display_name": "Winter", "link": "https://stackoverflow.com/users/6227/winter"}, "is_accepted": false, "score": 0, "last_activity_date": 1442797419, "last_edit_date": 1442797419, "creation_date": 1442790613, "answer_id": 32685259, "question_id": 32683252, "link": "https://stackoverflow.com/questions/32683252/finding-types-in-the-standard-library/32685259#32685259", "title": "Finding types in the standard library", "body": "<p>Short of searching the GoDocs for io.Reader (<a href=\"https://golang.org/search?q=io.Reader\" rel=\"nofollow\">https://golang.org/search?q=io.Reader</a>) or using Google to do something similar you'd have to write a program to parse the Go Standard Library.</p>\n\n<p>Perhaps a more useful avenue of inquiry would be, telling us what you're trying to accomplish.</p>\n"}], "owner": {"reputation": 1689, "user_id": 3791027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a240d8bb3d536a1ecc16adf28f7b1feb?s=128&d=identicon&r=PG&f=1", "display_name": "RockNinja", "link": "https://stackoverflow.com/users/3791027/rockninja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1442797419, "creation_date": 1442776608, "question_id": 32683252, "link": "https://stackoverflow.com/questions/32683252/finding-types-in-the-standard-library", "title": "Finding types in the standard library", "body": "<p>Using this function (constructor):</p>\n\n<pre><code>func NewDecoder(r io.Reader) *json.Decoder\n</code></pre>\n\n<p>How can you identify who is a <code>io.Reader</code> in the standard library?\nI know that a <code>os.Stdin</code> is one, but how do you find other readers in the standard lib?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1442775560, "post_id": 32682929, "comment_id": 53210822, "body": "Thank you! That was very helpful!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1442774811, "last_edit_date": 1442774811, "creation_date": 1442774477, "answer_id": 32682929, "question_id": 32682787, "link": "https://stackoverflow.com/questions/32682787/getting-error-all-goroutines-are-asleep-deadlock/32682929#32682929", "title": "Getting error: all goroutines are asleep - deadlock", "body": "<p>Channel c1 is an <a href=\"https://golang.org/ref/spec#Channel_types\">unbuffered</a> channel. Communication succeeds on an unbuffered channel only when both a sender and receiver are ready.</p>\n\n<p>The line <code>c1 &lt;- \"foo</code> blocks forever because no receiver is ready.</p>\n\n<p>The program with the goroutine works because the sending and receiving goroutines run to the point where the sender and receiver are both ready.</p>\n\n<p>This program will also work:</p>\n\n<pre><code>c2 := make(chan string, 1) // &lt;-- note channel size of one\nc2 &lt;- \"foo\"\nfmt.Println(&lt;-c2)\n</code></pre>\n\n<p>Channel c2 is buffered in this program. The send <code>c2 &lt;- \"foo\"</code> proceeds because the buffer is not full.</p>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 32682929, "answer_count": 1, "score": 1, "last_activity_date": 1442774811, "creation_date": 1442773428, "question_id": 32682787, "link": "https://stackoverflow.com/questions/32682787/getting-error-all-goroutines-are-asleep-deadlock", "title": "Getting error: all goroutines are asleep - deadlock", "body": "<p>How come something simple like this does not work?</p>\n\n<pre><code>c1 := make(chan string)\nc1 &lt;- \"foo\"\nfmt.Println(&lt;-c1)\n</code></pre>\n\n<p>But if I put it in a go routine it works?</p>\n\n<pre><code>c1 := make(chan string)\ngo func() {\n    c1 &lt;- \"foo\"\n}()\nfmt.Println(&lt;-c1)\n</code></pre>\n\n<p>The question might seem simple and stupid, but I'm trying to understand why I can't do this and I don't know of anything better to ask in this case.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 379, "user_id": 2215475, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/75d915043e61487876b94a069315b06c?s=128&d=identicon&r=PG", "display_name": "Peterdeka", "link": "https://stackoverflow.com/users/2215475/peterdeka"}, "is_accepted": false, "score": -1, "last_activity_date": 1442780621, "creation_date": 1442780621, "answer_id": 32683926, "question_id": 32682745, "link": "https://stackoverflow.com/questions/32682745/closed-explicitly-mgo-mongodb-in-go/32683926#32683926", "title": "&quot;Closed Explicitly&quot; mgo MongoDB in Go", "body": "<p>First of all try enabling debug mode in mgo in order to get some more info about what's happening.</p>\n\n<p>I suppose the server is dropping the connection after some inactivity time.\nIn any case, usually the approach is to do a mgo <code>Dial</code> and then <code>Copy</code> the connection at the beginning of every request handling(using a middleware).</p>\n\n<p>Pietro</p>\n"}, {"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 0, "last_activity_date": 1442800185, "creation_date": 1442800185, "answer_id": 32686233, "question_id": 32682745, "link": "https://stackoverflow.com/questions/32682745/closed-explicitly-mgo-mongodb-in-go/32686233#32686233", "title": "&quot;Closed Explicitly&quot; mgo MongoDB in Go", "body": "<p>that is ok. but to use <code>Session.Copy</code> to create a new connection instance, instead of using the returned session directly. there are connection pool inside golang mongodb driver package.</p>\n"}, {"tags": [], "owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "is_accepted": false, "score": 0, "last_activity_date": 1501583051, "creation_date": 1501583051, "answer_id": 45435267, "question_id": 32682745, "link": "https://stackoverflow.com/questions/32682745/closed-explicitly-mgo-mongodb-in-go/45435267#45435267", "title": "&quot;Closed Explicitly&quot; mgo MongoDB in Go", "body": "<p>When <code>sess.SetPoolLimit(50)</code> not used many errors are occurring when <code>mgo</code> is under stress like 10.000 concurrent connections.</p>\n\n<p>When I limit the pool errors went away.</p>\n\n<p>I've created a test-case source-code for this problem below, so you can test it in your own machine easily.</p>\n\n<p>Do you have any suggestions about this behaviour, I would like to hear.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    // you can also use original go-mgo/mgo here as well\n    mgo \"github.com/globalsign/mgo\"\n    \"github.com/globalsign/mgo/bson\"\n)\n\n// TODO: put some records into db first:\n//\n// use testapi\n// db.competitions.insert([\n//   {game_id: 1, game_name: \"foo\"},\n//   {game_id: 2, game_name: \"bar\"},\n//   {game_id: 3, game_name: \"jazz\"}\n// ])\n\n// NOTE: you might want to increase this depending on your machine power\n//       mine is:\n//         MacBook (Retina, 12-inch, Early 2015)\n//         1,2 GHz Intel Core M\n//         8 GB 1600 MHz DDR3\nconst ops = 10000\n\ntype m bson.M\n\nfunc main() {\n    sess, err := mgo.DialWithTimeout(\"localhost\", time.Second)\n    if err != nil {\n        panic(err)\n    }\n    defer sess.Close()\n\n    // NOTE: without this setting there are many errors\n    //       see the end of the file\n    // setting pool limit prevents most of the timeouts\n    // sess.SetPoolLimit(50)\n\n    // sess.SetSocketTimeout(60 * time.Second)\n    sess.SetMode(mgo.Monotonic, true)\n\n    time.Sleep(time.Second)\n\n    done := make(chan bool, ops)\n\n    for i := 0; i &lt; ops; i++ {\n        go func() {\n            defer func() { done &lt;- true }()\n\n            result, err := fetchSomething(sess)\n            if err != nil {\n                fmt.Printf(\"ERR: %s\\n\", err)\n            }\n            fmt.Printf(\"RESULT: %+v\\n\", result)\n        }()\n    }\n\n    for i := 0; i &lt; ops; i++ {\n        &lt;-done\n    }\n}\n\nfunc fetchSomething(sess *mgo.Session) ([]m, error) {\n    s := sess.Copy()\n    defer s.Close()\n\n    result := []m{}\n\n    group := m{\n        \"$group\": m{\n            \"_id\": m{\n                \"id\":   \"$game_id\",\n                \"name\": \"$game_name\",\n            },\n        },\n    }\n\n    project := m{\n        \"$project\": m{\n            \"_id\":  \"$_id.id\",\n            \"name\": \"$_id.name\",\n        },\n    }\n\n    sort := m{\n        \"$sort\": m{\n            \"_id\": 1,\n        },\n    }\n\n    err := col(s, \"competitions\").Pipe([]m{group, project, sort}).All(&amp;result)\n    if err != nil {\n        return nil, err\n    }\n    return result, nil\n}\n\n// col is a helper for selecting a column\nfunc col(sess *mgo.Session, name string) *mgo.Collection {\n    return sess.DB(\"testapi\").C(name)\n}\n\n/*\n\n\nERRORS WITHOUT sess.SetPoolLimit(50)\n\n\n$ go run socket_error.go\nRESULT: [map[name:foo _id:1] map[_id:2 name:bar] map[_id:3 name:jazz]]\nERR: read tcp 127.0.0.1:52918-&gt;127.0.0.1:27017: read: connection reset by peer\nERR: write tcp 127.0.0.1:52084-&gt;127.0.0.1:27017: write: broken pipe\nRESULT: []\nRESULT: []\nERR: write tcp 127.0.0.1:53627-&gt;127.0.0.1:27017: write: broken pipe\nERR: write tcp 127.0.0.1:53627-&gt;127.0.0.1:27017: write: broken pipe\nRESULT: []\nERR: write tcp 127.0.0.1:53627-&gt;127.0.0.1:27017: write: broken pipe\nRESULT: []\nERR: write tcp 127.0.0.1:53627-&gt;127.0.0.1:27017: write: broken pipe\nRESULT: []\nERR: write tcp 127.0.0.1:53627-&gt;127.0.0.1:27017: write: broken pipe\nRESULT: []\nERR: write tcp 127.0.0.1:53627-&gt;127.0.0.1:27017: write: broken pipe\nRESULT: []\nRESULT: []\nERR: read tcp 127.0.0.1:53627-&gt;127.0.0.1:27017: read: connection reset by peer\nRESULT: []\nERR: resetNonce: write tcp 127.0.0.1:53625-&gt;127.0.0.1:27017: write: broken pipe\nRESULT: []\nRESULT: [map[name:foo _id:1] map[_id:2 name:bar] map[_id:3 name:jazz]]\nERR: resetNonce: write tcp 127.0.0.1:54591-&gt;127.0.0.1:27017: write: broken pipe\nRESULT: []\n...\n...\n*/\n</code></pre>\n"}], "owner": {"reputation": 9783, "user_id": 1331978, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/a6b55a6f47890ca038433953fc2b7ff3?s=128&d=identicon&r=PG&f=1", "display_name": "if __name__ is None", "link": "https://stackoverflow.com/users/1331978/if-name-is-none"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 5184, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1501583051, "creation_date": 1442773172, "last_edit_date": 1498177892, "question_id": 32682745, "link": "https://stackoverflow.com/questions/32682745/closed-explicitly-mgo-mongodb-in-go", "title": "&quot;Closed Explicitly&quot; mgo MongoDB in Go", "body": "<p>I have a Docker cluster running 10 web services (of the same kind). They are all using MongoDB, among other things for data persistence.</p>\n\n<p>This is the code that gets called from <code>main()</code>, when the service is booting up:</p>\n\n<pre><code>// Init establishes a connection with MongoDB instance.\nfunc Init(mongoURL string) *mgo.Session {\n    mongo, err := mgo.Dial(mongoURL)\n    misc.PanicIf(err)\n\n    // make sure we are strongly consistent\n    mongo.SetMode(mgo.Strong, true)\n\n    // update global state\n    db = mongo\n    Entries = db.DB(\"\").C(\"entries\")\n    Channels = db.DB(\"\").C(\"channels\")\n    Settings = db.DB(\"\").C(\"settings\")\n    Metadata = db.DB(\"\").C(\"metadata\")\n\n    // only use this on first load, to confirm the settings are there\n    // every refresh should be done via UpdateGlobalSettings (thread-safe)\n    GlobalSettings = &amp;GlobalSettingsStruct{}\n    GlobalSettings.Init()\n\n    return mongo\n}\n</code></pre>\n\n<p>So basically the API and the workers just use global variables such as <code>Entries</code>, <code>Settings</code>, etc.</p>\n\n<p>After running for a while, the service stopped working properly. Every mongo action, such as <code>Entries.find(...)</code> returns an err of: <code>Closed Explicitly</code>.</p>\n\n<p>What does that mean? Should I be refreshing the mongoDB connection periodically or should I make it close and re-establish connection with each request?</p>\n\n<p>The app is performance oriented, so despite mongo connection being down, everything is still up and running as everything operates on in-memory or cluster cache. I don't want to do something stupid that delays processing.</p>\n"}, {"tags": ["command-line", "go", "windows-7", "system"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1442773609, "post_id": 32682632, "comment_id": 53210166, "body": "Maybe it&#39;s just my windows inexperience but what is the extra <code>&quot;cmd&quot;, &quot;&#47;c&quot;</code>  for in the beginning?"}, {"owner": {"reputation": 11, "user_id": 1051431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fe26710e12848a0ea0c51d6b0f137ba?s=128&d=identicon&r=PG", "display_name": "ben", "link": "https://stackoverflow.com/users/1051431/ben"}, "reply_to_user": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1442778559, "post_id": 32682632, "comment_id": 53211850, "body": "I found several examples with those arguments (I guess it&#39;s allowing to load the dos environment in a proper command). I tried whithout them anyway, still the same issue."}, {"owner": {"reputation": 11, "user_id": 1051431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fe26710e12848a0ea0c51d6b0f137ba?s=128&d=identicon&r=PG", "display_name": "ben", "link": "https://stackoverflow.com/users/1051431/ben"}, "reply_to_user": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1442779670, "post_id": 32682632, "comment_id": 53212214, "body": "BTW my script works on Unix, but this information seems irrelevant as the command line is different."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1442779914, "post_id": 32682632, "comment_id": 53212290, "body": "By the way, it&#39;s &quot;Go&quot; and &quot;Go program&quot;, not &quot;Golang script&quot;. Scripting and compiled languages are usually very different. Since you correctly used the &quot;go&quot; tag on the question there is no need to <a href=\"http://meta.stackexchange.com/a/130208/150469\">force a tag into the title</a> as well (e.g. don&#39;t do &quot;Go: the real title&quot;)."}, {"owner": {"reputation": 11, "user_id": 1051431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fe26710e12848a0ea0c51d6b0f137ba?s=128&d=identicon&r=PG", "display_name": "ben", "link": "https://stackoverflow.com/users/1051431/ben"}, "edited": false, "score": 1, "creation_date": 1442780461, "post_id": 32682632, "comment_id": 53212492, "body": "Ok thanks, I changed it."}, {"owner": {"reputation": 2221, "user_id": 4349179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb20aa6229c7424824111816d134623c?s=128&d=identicon&r=PG&f=1", "display_name": "Syberdoor", "link": "https://stackoverflow.com/users/4349179/syberdoor"}, "edited": false, "score": 1, "creation_date": 1442824876, "post_id": 32682632, "comment_id": 53225045, "body": "I don&#39;t know go but assuming the exec takes one command and then the arguments then the first argument is /c and the second would probably be &quot;rundll32.exe shimgvw.dll ImageView_PrintTo /pt C:\\Users\\XXXXX\\IMAGE.jpg &quot;PRINTERNAME&quot;&quot; please note the additional quotation marks. cmd /c takes the whole command to execute in quotation marks as parameter after /c. It might also be that quoatation marks are a special character and have to be escaped in the go language if you want to include them in the final call"}, {"owner": {"reputation": 11, "user_id": 1051431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fe26710e12848a0ea0c51d6b0f137ba?s=128&d=identicon&r=PG", "display_name": "ben", "link": "https://stackoverflow.com/users/1051431/ben"}, "edited": false, "score": 0, "creation_date": 1442827399, "post_id": 32682632, "comment_id": 53226617, "body": "Thanks for your help. I couldn&#39;t make it work. I tried so many versions... I&#39;m certain the issue comes from the way to pass or encode the arguments. As an alternative, I wrote a Node.js script to do the exact same task, it works fine."}, {"owner": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "edited": false, "score": 0, "creation_date": 1442868504, "post_id": 32682632, "comment_id": 53251992, "body": "Are you sure <code>PRINTERNAME</code> should be in its own quotes?"}, {"owner": {"reputation": 11, "user_id": 1051431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fe26710e12848a0ea0c51d6b0f137ba?s=128&d=identicon&r=PG", "display_name": "ben", "link": "https://stackoverflow.com/users/1051431/ben"}, "edited": false, "score": 0, "creation_date": 1443025773, "post_id": 32682632, "comment_id": 53330491, "body": "Yes, without them the commandline doesn&#39;t work even when executing manually."}], "owner": {"reputation": 11, "user_id": 1051431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fe26710e12848a0ea0c51d6b0f137ba?s=128&d=identicon&r=PG", "display_name": "ben", "link": "https://stackoverflow.com/users/1051431/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1442854957, "creation_date": 1442772484, "last_edit_date": 1442854957, "question_id": 32682632, "link": "https://stackoverflow.com/questions/32682632/exec-command-is-executed-but-has-no-effect-on-windows-7", "title": "Exec.Command is executed, but has no effect on Windows 7", "body": "<p>I'm trying to print an local image from my Go program using <a href=\"http://golang.org/pkg/os/exec/\" rel=\"nofollow\">the Exec Package</a> on Windows 7.</p>\n\n<p>The following command line works fine when ran manually:</p>\n\n<pre><code>rundll32.exe shimgvw.dll ImageView_PrintTo /pt C:\\Users\\XXXXX\\IMAGE.jpg \"PRINTERNAME\"\n</code></pre>\n\n<p>I tried:</p>\n\n<pre><code>res, err := exec.Command(\n\"cmd\", \n\"/c\", \n\"rundll32.exe\", \n\"shimgvw.dll\", \n\"ImageView_PrintTo\", \n\"/pt\", \n\"C:\\\\Users\\\\XXXXX\\\\IMAGE.jpg\", \n\"\\\"PRINTERNAME\\\"\",\n).Output();\n</code></pre>\n\n<p>or</p>\n\n<pre><code>res, err := exec.Command(\n\"cmd\", \n\"/c\", \n\"rundll32.exe shimgvw.dll ImageView_PrintTo /pt C:\\\\Users\\\\XXXXX\\\\IMAGE.jpg \\\"PRINTERNAME\\\"\",\n).Output();\n</code></pre>\n\n<p>But in both cases, it just sends back an empty string as a result and no error.\nAnd no effect on the printer tasks list.</p>\n\n<p>I'm sure I'm missing something obvious (something to do with the system environnement when executing the script?). Ideas are welcome!</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 2, "creation_date": 1442761933, "post_id": 32680834, "comment_id": 53206263, "body": "maybe this help you: <a href=\"http://codereview.stackexchange.com/questions/12700/comparing-two-images\" title=\"comparing two images\">codereview.stackexchange.com/questions/12700/&hellip;</a>"}, {"owner": {"reputation": 275, "user_id": 2561494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7dc475b5861db61272093746b29862e9?s=128&d=identicon&r=PG", "display_name": "degendra", "link": "https://stackoverflow.com/users/2561494/degendra"}, "edited": false, "score": 0, "creation_date": 1442764099, "post_id": 32680834, "comment_id": 53207031, "body": "I tried this approach using Resemble.js and was slow. Is there any way to find out percentage differences between images?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1442764198, "post_id": 32680834, "comment_id": 53207055, "body": "The standard library does not contain such code, you&#39;ll have to do some programming."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1442771957, "post_id": 32680834, "comment_id": 53209648, "body": "&quot;[P]ercentage differences between images&quot; is quite vague: Differen number of pixels? Different colors, different hue? Different contrast? Different brightness? Different image subjects? Your question is not well defined. For two defined metrics on images see e.g. github.com/vdobler/ht/fingerprint (my own, probably not what you are looking for)."}, {"owner": {"reputation": 275, "user_id": 2561494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7dc475b5861db61272093746b29862e9?s=128&d=identicon&r=PG", "display_name": "degendra", "link": "https://stackoverflow.com/users/2561494/degendra"}, "edited": false, "score": 0, "creation_date": 1442809690, "post_id": 32680834, "comment_id": 53219009, "body": "I am looking for something that detect if those images are completely different or only few part of image is replaced with completely different image ignoring brightness and contrast."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1442816952, "post_id": 32680834, "comment_id": 53221330, "body": "Good luck then! This is not trivial."}, {"owner": {"reputation": 275, "user_id": 2561494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7dc475b5861db61272093746b29862e9?s=128&d=identicon&r=PG", "display_name": "degendra", "link": "https://stackoverflow.com/users/2561494/degendra"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1443189280, "post_id": 32680834, "comment_id": 53406288, "body": "@Volker Thank you for the link."}, {"owner": {"reputation": 1, "user_id": 10281177, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wMWB1_3vePo/AAAAAAAAAAI/AAAAAAAAAWU/qL2TfGHm9uI/photo.jpg?sz=128", "display_name": "Nguy\u1ec5n Ng\u1ecdc Th\u1ecbnh", "link": "https://stackoverflow.com/users/10281177/nguy%e1%bb%85n-ng%e1%bb%8dc-th%e1%bb%8bnh"}, "edited": false, "score": 0, "creation_date": 1535393578, "post_id": 32680834, "comment_id": 91040577, "body": "This answer will be helpful <a href=\"https://stackoverflow.com/questions/38466804/comparing-base64-image-strings-in-golang/52044674#52044674\" title=\"comparing base64 image strings in golang\">stackoverflow.com/questions/38466804/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 29724, "user_id": 93995, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/35752f1794d9a5f8ab8fe8edf272f0cc?s=128&d=identicon&r=PG", "display_name": "George Armhold", "link": "https://stackoverflow.com/users/93995/george-armhold"}, "is_accepted": false, "score": 10, "last_activity_date": 1459950836, "last_edit_date": 1459950836, "creation_date": 1459906182, "answer_id": 36439876, "question_id": 32680834, "link": "https://stackoverflow.com/questions/32680834/how-to-compare-images-with-go/36439876#36439876", "title": "How to compare images with go?", "body": "<p>If you are trying to compare two images and just need to boil it down to a single number, the following will work. This is useful in (for example) genetic algorithms, where you want to compare a set of candidates and choose the one that differs the least from a reference image:</p>\n\n<ol>\n<li>Visit every pixel, break it down into its parts: R, G, B, &amp; A (in go: <code>image.At(x,y).RGBA()</code>)</li>\n<li>Subtract the RGBA vals from their corresponding pixel vals in the reference image.</li>\n<li>Square the differences, add them up.</li>\n<li>Take the square root of the total sum.</li>\n</ol>\n\n<p>This number will give you a rough idea of how much the images differ.</p>\n\n<p>If you know that the two images are both instances of <code>image.RGBA</code> (or you can convert them), then you can do something even faster: just grab the bytes directly from <code>RGBA.Pix</code>. That's what I do here, and it's roughly 10x faster than doing <code>img.At(x,y).RGBA()</code> for every pixel pair:</p>\n\n<pre><code>func FastCompare(img1, img2 *image.RGBA) (int64, error) {\n    if img1.Bounds() != img2.Bounds() {\n        return 0, fmt.Errorf(\"image bounds not equal: %+v, %+v\", img1.Bounds(), img2.Bounds())\n    }\n\n    accumError := int64(0)\n\n    for i := 0; i &lt; len(img1.Pix); i++ {\n        accumError += int64(sqDiffUInt8(img1.Pix[i], img2.Pix[i]))\n    }\n\n    return int64(math.Sqrt(float64(accumError))), nil\n}\n\nfunc sqDiffUInt8(x, y uint8) uint64 {   \n    d := uint64(x) - uint64(y)\n    return d * d\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 207, "user_id": 9307283, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TOpnY.gif?s=128&g=1", "display_name": "Similar.Pictures", "link": "https://stackoverflow.com/users/9307283/similar-pictures"}, "is_accepted": false, "score": 4, "last_activity_date": 1570056893, "creation_date": 1570056893, "answer_id": 58210315, "question_id": 32680834, "link": "https://stackoverflow.com/questions/32680834/how-to-compare-images-with-go/58210315#58210315", "title": "How to compare images with go?", "body": "<p>Try <a href=\"https://github.com/vitali-fedulov/images\" rel=\"nofollow noreferrer\">https://github.com/vitali-fedulov/images</a>. I wrote\nthis package to be able to find near duplicates. There is a live web-demo with the same algorithm, so you can get an idea how well the package suites your needs.</p>\n"}, {"tags": [], "owner": {"reputation": 1189, "user_id": 275968, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/98bd1e4101364b481c2b980b5c56ebb5?s=128&d=identicon&r=PG", "display_name": "SkyN", "link": "https://stackoverflow.com/users/275968/skyn"}, "is_accepted": false, "score": 1, "last_activity_date": 1583911647, "creation_date": 1583911647, "answer_id": 60631079, "question_id": 32680834, "link": "https://stackoverflow.com/questions/32680834/how-to-compare-images-with-go/60631079#60631079", "title": "How to compare images with go?", "body": "<p>Inspired by George's answer.\nThe function below is not so fast, but it allows you to visually assess the difference in images.</p>\n\n<pre><code>func ImgCompare(img1, img2 image.Image) (int64, image.Image, error) {\n    bounds1 := img1.Bounds()\n    bounds2 := img2.Bounds()\n    if bounds1 != bounds2 {\n        return math.MaxInt64, nil, fmt.Errorf(\"image bounds not equal: %+v, %+v\", img1.Bounds(), img2.Bounds())\n    }\n\n    accumError := int64(0)\n    resultImg := image.NewRGBA(image.Rect(\n        bounds1.Min.X,\n        bounds1.Min.Y,\n        bounds1.Max.X,\n        bounds1.Max.Y,\n    ))\n    draw.Draw(resultImg, resultImg.Bounds(), img1, image.Point{0, 0}, draw.Src)\n\n    for x := bounds1.Min.X; x &lt; bounds1.Max.X; x++ {\n        for y := bounds1.Min.Y; y &lt; bounds1.Max.Y; y++ {\n            r1, g1, b1, a1 := img1.At(x, y).RGBA()\n            r2, g2, b2, a2 := img2.At(x, y).RGBA()\n\n            diff := int64(sqDiffUInt32(r1, r2))\n            diff += int64(sqDiffUInt32(g1, g2))\n            diff += int64(sqDiffUInt32(b1, b2))\n            diff += int64(sqDiffUInt32(a1, a2))\n\n            if diff &gt; 0 {\n                accumError += diff\n                resultImg.Set(\n                    bounds1.Min.X+x,\n                    bounds1.Min.Y+y,\n                    color.RGBA{R: 255, A: 255})\n            }\n        }\n    }\n\n    return int64(math.Sqrt(float64(accumError))), resultImg, nil\n}\n\nfunc sqDiffUInt32(x, y uint32) uint64 {\n    d := uint64(x) - uint64(y)\n    return d * d\n}\n</code></pre>\n"}], "owner": {"reputation": 275, "user_id": 2561494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7dc475b5861db61272093746b29862e9?s=128&d=identicon&r=PG", "display_name": "degendra", "link": "https://stackoverflow.com/users/2561494/degendra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4860, "favorite_count": 7, "answer_count": 3, "score": 10, "last_activity_date": 1583911647, "creation_date": 1442761608, "question_id": 32680834, "link": "https://stackoverflow.com/questions/32680834/how-to-compare-images-with-go", "title": "How to compare images with go?", "body": "<p>In go <a href=\"https://golang.org/pkg/image/\" rel=\"noreferrer\">image</a> package, i don't see any methods which can be used to compare two images? Is it possible to do image comparison in go similar to ImageMagick? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 798, "user_id": 3850993, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NTFC2.png?s=128&g=1", "display_name": "Yorick de Wid", "link": "https://stackoverflow.com/users/3850993/yorick-de-wid"}, "edited": false, "score": 0, "creation_date": 1442761615, "post_id": 32680813, "comment_id": 53206138, "body": "The multireturn is really meant for errors, I suggest you pass a pointer to a struct of some sorts"}, {"owner": {"reputation": 15349, "user_id": 2282538, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0a4fff09f1f0e3360daeabb30c2c06bb?s=128&d=identicon&r=PG", "display_name": "Tyler", "link": "https://stackoverflow.com/users/2282538/tyler"}, "reply_to_user": {"reputation": 798, "user_id": 3850993, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NTFC2.png?s=128&g=1", "display_name": "Yorick de Wid", "link": "https://stackoverflow.com/users/3850993/yorick-de-wid"}, "edited": false, "score": 2, "creation_date": 1442763482, "post_id": 32680813, "comment_id": 53206787, "body": "While its nice to be able to return a value and error from a function, I think there are lots of other legitimate uses for multi return, other than just errors."}], "owner": {"reputation": 15349, "user_id": 2282538, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0a4fff09f1f0e3360daeabb30c2c06bb?s=128&d=identicon&r=PG", "display_name": "Tyler", "link": "https://stackoverflow.com/users/2282538/tyler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "closed_date": 1442763260, "answer_count": 0, "score": 0, "last_activity_date": 1442761693, "creation_date": 1442761452, "question_id": 32680813, "link": "https://stackoverflow.com/questions/32680813/multiple-return-values-from-function-with-map", "closed_reason": "Duplicate", "title": "Multiple return values from function with map", "body": "<p>I am wondering if there is a shorthand version for the following:</p>\n\n<pre><code>func MyFuncWithAMap() (string, bool) {\n\n    // More code here ...\n\n    // Can I combine these lines?\n    val, ok := myMap[key]\n    return val, ok\n}\n</code></pre>\n\n<p>I tried:</p>\n\n<pre><code>return myMap[key]\n</code></pre>\n\n<p>But the compiler complains that I will only be returning one value here, instead of the optional boolean value as well.</p>\n"}, {"tags": ["go", "gob"], "answers": [{"tags": [], "owner": {"reputation": 1847, "user_id": 391464, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1XdRz.png?s=128&g=1", "display_name": "yee", "link": "https://stackoverflow.com/users/391464/yee"}, "is_accepted": false, "score": 0, "last_activity_date": 1442816679, "last_edit_date": 1442816679, "creation_date": 1442739374, "answer_id": 32677564, "question_id": 32676898, "link": "https://stackoverflow.com/questions/32676898/whats-the-purpose-of-gob-register-method/32677564#32677564", "title": "What&#39;s the purpose of gob.Register method?", "body": "<p>As <a href=\"http://golang.org/pkg/encoding/gob/#Register\" rel=\"nofollow\">http://golang.org/pkg/encoding/gob/#Register</a> said:</p>\n\n<blockquote>\n  <p>Only types that will be transferred as implementations of interface\n  values need to be registered.</p>\n</blockquote>\n\n<p>So it doesn't needed by your demo.</p>\n"}, {"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 11, "last_activity_date": 1442739634, "creation_date": 1442739634, "answer_id": 32677598, "question_id": 32676898, "link": "https://stackoverflow.com/questions/32676898/whats-the-purpose-of-gob-register-method/32677598#32677598", "title": "What&#39;s the purpose of gob.Register method?", "body": "<p>If you're dealing with concrete types (structs) only, you don't really need it. Once you're dealing with interfaces you must register your concrete type first. </p>\n\n<p>For example, let's assume we have these struct and interface (the struct implements the interface):</p>\n\n<pre><code>type Getter interface {\n    Get() string\n}\n\n\ntype Foo struct {\n    Bar string\n}\n\nfunc (f Foo)Get() string {\n    return f.Bar\n}\n</code></pre>\n\n<p>To send a <code>Foo</code> over gob as a <code>Getter</code> and decode it back, we must first call</p>\n\n<pre><code>gob.Register(Foo{})\n</code></pre>\n\n<p>So the flow would be:</p>\n\n<pre><code>// init and register\nbuf := bytes.NewBuffer(nil)\ngob.Register(Foo{})    \n\n\n// create a getter of Foo\ng := Getter(Foo{\"wazzup\"})\n\n// encode\nenc := gob.NewEncoder(buf)\nenc.Encode(&amp;g)\n\n// decode\ndec := gob.NewDecoder(buf)\nvar gg Getter\nif err := dec.Decode(&amp;gg); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Now try removing the <code>Register</code> and this won't work because gob wouldn't know how to map things back to their appropriate type.</p>\n"}, {"tags": [], "owner": {"reputation": 64, "user_id": 1328982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a5a5b7b6d41d4118cae2bf289099384?s=128&d=identicon&r=PG", "display_name": "mamaz", "link": "https://stackoverflow.com/users/1328982/mamaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1589782014, "creation_date": 1589782014, "answer_id": 61863359, "question_id": 32676898, "link": "https://stackoverflow.com/questions/32676898/whats-the-purpose-of-gob-register-method/61863359#61863359", "title": "What&#39;s the purpose of gob.Register method?", "body": "<p>If you want to encode / decode a map[string]interface{}, since the field of the map is enclosed as interface type, then we need to register the specific type before.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\npackage main\n\nimport (\n    \"bytes\"\n    \"encoding/gob\"\n    \"fmt\"\n    \"log\"\n)\n\ntype SomeStruct struct {\n    Text string\n}\n\nfunc main() {\n    var bytes bytes.Buffer\n\n    // Remove one of these, then the decoding will produce error\n    gob.Register(SomeStruct{})\n    gob.Register([]interface{}{})\n    gob.Register([]SomeStruct{})\n    gob.Register(map[string]SomeStruct{})\n\n    writer := gob.NewEncoder(&amp;bytes)\n\n    err := writer.Encode(map[string]interface{}{\n        \"SomeStruct\": SomeStruct{\"Halo\"},\n        \"SomeSlice\":  []interface{}{},\n        \"SomeSliceStruct\": []SomeStruct{\n            {\n                Text: \"SomeText\",\n            },\n        },\n        \"SomeMapStruct\": map[string]SomeStruct{\n            \"S\": {\"Test\"},\n        },\n    })\n    if err != nil {\n        log.Fatalf(\"Error on encode process: %v\\n\", err)\n        return\n    }\n\n    reader := gob.NewDecoder(&amp;bytes)\n    var aMap map[string]interface{}\n    err = reader.Decode(&amp;aMap)\n    if err != nil {\n        log.Fatalf(\"Error on decode process: %v\\n\", err)\n        return\n    }\n\n    fmt.Printf(\"Decode is successful: %+v\\n\", aMap)\n}\n\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5280774"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4065, "favorite_count": 2, "answer_count": 3, "score": 8, "last_activity_date": 1595188975, "creation_date": 1442734016, "last_edit_date": 1595188975, "question_id": 32676898, "link": "https://stackoverflow.com/questions/32676898/whats-the-purpose-of-gob-register-method", "title": "What&#39;s the purpose of gob.Register method?", "body": "<p>I have read the documentation of ( gob) and I have some problems :</p>\n<p>Now I know how to encode structure and decode like that:</p>\n<pre><code>func main() {\n    s1 := &amp;S{\n        Field1: &quot;Hello Gob&quot;,\n        Field2: 999,\n    }\n    log.Println(&quot;Original value:&quot;, s1)\n    buf := new(bytes.Buffer)\n    err := gob.NewEncoder(buf).Encode(s1)\n    if err != nil {\n        log.Println(&quot;Encode:&quot;, err)\n        return\n    }\n\n    s2 := &amp;S{}\n    err = gob.NewDecoder(buf).Decode(s2)\n    if err != nil {\n        log.Println(&quot;Decode:&quot;, err)\n        return\n    }\n    log.Println(&quot;Decoded value:&quot;, s2)\n}\n</code></pre>\n<p>But I don't know the purpose of this method <code>gob.Register()</code> can someone explain to me when to use it and why?</p>\n"}, {"tags": ["mysql", "json", "debugging", "go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1442728384, "post_id": 32676227, "comment_id": 53197644, "body": "The second error seems to be because a menu item from the database does not have a sixth <code>|</code>-separated element, so <code>itemParts[5]</code> fails. You could check the length of <code>itemParts</code> before accessing it using a hard-coded index. Don&#39;t know about the hang."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1442728527, "post_id": 32676227, "comment_id": 53197671, "body": "The hang in <code>rows.Close()</code> looks a bit like <a href=\"https://github.com/go-sql-driver/mysql/issues/285\" rel=\"nofollow noreferrer\">this MySQL driver bug</a>, but I&#39;m not sure."}], "answers": [{"tags": [], "owner": {"reputation": 31539, "user_id": 367985, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/761edb9c3cf7a0a643e73ef40666a1f7?s=128&d=identicon&r=PG", "display_name": "CuriousMind", "link": "https://stackoverflow.com/users/367985/curiousmind"}, "is_accepted": true, "score": 0, "last_activity_date": 1443035060, "creation_date": 1443035060, "answer_id": 32747539, "question_id": 32676227, "link": "https://stackoverflow.com/questions/32676227/debugging-stuck-go-programs/32747539#32747539", "title": "Debugging stuck go programs", "body": "<p>This was a issue with the driver. Fixed it by removing the defer call &amp; checking the array bounds. </p>\n"}], "owner": {"reputation": 31539, "user_id": 367985, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/761edb9c3cf7a0a643e73ef40666a1f7?s=128&d=identicon&r=PG", "display_name": "CuriousMind", "link": "https://stackoverflow.com/users/367985/curiousmind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 665, "favorite_count": 0, "accepted_answer_id": 32747539, "answer_count": 1, "score": 1, "last_activity_date": 1443035060, "creation_date": 1442727859, "last_edit_date": 1442728177, "question_id": 32676227, "link": "https://stackoverflow.com/questions/32676227/debugging-stuck-go-programs", "title": "Debugging stuck go programs", "body": "<p>I wrote the following ETL tool which gets data from Mysql, convert into JSON &amp; print it on the screen  </p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"database/sql\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"strconv\"\n    \"strings\"\n    \"time\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nconst dbformat = \"2006-01-02 15:04:05\"\n\ntype MysqlReceipt struct {\n    Id               int\n    Amount           sql.NullFloat64\n    Cc_last4         sql.NullString\n    Employee_id      sql.NullString\n    Employee_name    sql.NullString\n    Is_test          byte\n    Menu_items       sql.NullString\n    Payable          sql.NullFloat64\n    Pos_type         sql.NullString\n    Pos_version      sql.NullString\n    Punchh_key       string\n    Receipt_datetime sql.NullString\n    Subtotal_amount  sql.NullFloat64\n    Transaction_no   sql.NullString\n    Business_id      int\n    Location_id      int\n    Created_at       string\n    Updated_at       sql.NullString\n    Revenue_code     sql.NullString\n    Revenue_id       sql.NullString\n    Status           sql.NullString\n    Ipv4_addr        sql.NullString\n}\n\ntype Menu_item struct {\n    id, name, family, major_group, item_type string\n    qty                                      int\n    amount                                   float64\n}\n\ntype BigReceipt struct {\n    Id                       int\n    Amount                   float64\n    Cc_last4                 string\n    Employee_id              string `json:\",omitempty\"`\n    Employee_name            string `json:\",omitempty\"`\n    Is_test                  byte\n    Menu_item_name           string\n    Menu_item_id             string\n    Menu_item_amount         float64\n    Menu_item_family         string\n    Menu_item_major_group    string\n    Menu_item_type           string\n    Menu_item_qty            int\n    Payable                  float64\n    Pos_type                 string `json:\",omitempty\"`\n    Pos_version              string `json:\",omitempty\"`\n    Punchh_key               string\n    Receipt_datetime         string\n    Subtotal_amount          float64\n    Transaction_no           string `json:\",omitempty\"`\n    Business_id, Location_id int\n    Created_at               time.Time\n    Updated_at               time.Time `json:\",omitempty\"`\n    Revenue_code             string    `json:\",omitempty\"`\n    Revenue_id               string    `json:\",omitempty\"`\n    Status                   string    `json:\",omitempty\"`\n    Ipv4_addr                string    `json:\",omitempty\"`\n    Stored_at                int64\n}\n\nfunc (m Menu_item) ValidItem() bool {\n    if m.item_type == \"M\" || m.item_type == \"D\" {\n        return true\n    } else {\n        return false\n    }\n}\n\nfunc main() {\n    db, err := sql.Open(\"mysql\", \"root:password@tcp(xxxxxxx.us-east-1.rds.amazonaws.com:3306)/db_name_goes_here\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = db.Ping()\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n    rows, err := db.Query(`select id,amount,cc_last4,employee_id,employee_name,is_test,menu_items,payable,pos_type,\n    pos_version,punchh_key,receipt_datetime,subtotal_amount,transaction_no,business_id,location_id,created_at,\n    updated_at,revenue_code,revenue_id,status,ipv4_addr from receipts`)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer rows.Close()\n    for rows.Next() {\n        var mr MysqlReceipt\n        err = rows.Scan(&amp;mr.Id, &amp;mr.Amount, &amp;mr.Cc_last4, &amp;mr.Employee_id, &amp;mr.Employee_name, &amp;mr.Is_test, &amp;mr.Menu_items,\n            &amp;mr.Payable, &amp;mr.Pos_type, &amp;mr.Pos_version, &amp;mr.Punchh_key, &amp;mr.Receipt_datetime, &amp;mr.Subtotal_amount, &amp;mr.Transaction_no,\n            &amp;mr.Business_id, &amp;mr.Location_id, &amp;mr.Created_at, &amp;mr.Updated_at, &amp;mr.Revenue_code, &amp;mr.Revenue_id, &amp;mr.Status, &amp;mr.Ipv4_addr)\n        if err != nil {\n            log.Fatal(err)\n        }\n        if !mr.Menu_items.Valid {\n            continue\n        }\n        r := BigReceipt{Id: mr.Id,\n            Amount:           mr.Amount.Float64,\n            Cc_last4:         mr.Cc_last4.String,\n            Employee_id:      mr.Employee_id.String,\n            Employee_name:    mr.Employee_name.String,\n            Is_test:          mr.Is_test,\n            Payable:          mr.Payable.Float64,\n            Pos_type:         mr.Pos_type.String,\n            Pos_version:      mr.Pos_version.String,\n            Punchh_key:       mr.Punchh_key,\n            Receipt_datetime: mr.Receipt_datetime.String,\n            Subtotal_amount:  mr.Subtotal_amount.Float64,\n            Transaction_no:   mr.Transaction_no.String,\n            Business_id:      mr.Business_id,\n            Location_id:      mr.Location_id,\n            Revenue_code:     mr.Revenue_code.String,\n            Revenue_id:       mr.Revenue_id.String,\n            Status:           mr.Status.String,\n            Ipv4_addr:        mr.Ipv4_addr.String,\n            Stored_at:        time.Now().Unix(),\n        }\n        r.Created_at = datetimeParse(mr.Created_at)\n        if mr.Updated_at.Valid {\n            r.Updated_at = datetimeParse(mr.Updated_at.String)\n        }\n        menuItems := strings.Split(mr.Menu_items.String, \"^\")\n        items := parseMenuItems(menuItems)\n        for _, v := range items {\n            r.Menu_item_name = v.name\n            r.Menu_item_id = v.id\n            r.Menu_item_amount = v.amount\n            r.Menu_item_family = v.family\n            r.Menu_item_major_group = v.major_group\n            r.Menu_item_type = v.item_type\n            r.Menu_item_qty = v.qty\n            b, err := json.Marshal(r)\n            if err != nil {\n                log.Fatal(err)\n            }\n            fmt.Println(r.Id)\n            var out bytes.Buffer\n            json.Compact(&amp;out, b)\n            fmt.Println(string(b))\n        }\n    }\n    err = rows.Err()\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc datetimeParse(dateStr string) time.Time {\n    datetime, err := time.Parse(dbformat, dateStr)\n    if err != nil {\n        log.Fatal(err)\n    }\n    return datetime\n}\n\nfunc parseMenuItems(menuItems []string) []Menu_item {\n    var items []Menu_item\n    var item Menu_item\n    for _, v := range menuItems {\n        itemParts := strings.Split(v, \"|\")\n\n        item.name = itemParts[0]\n        item.qty, _ = strconv.Atoi(itemParts[1])\n        item.amount, _ = strconv.ParseFloat(itemParts[2], 64)\n        item.item_type = strings.ToUpper(itemParts[3])\n        item.id = itemParts[4]\n        item.family = itemParts[5]\n        item.major_group = itemParts[6]\n        if item.ValidItem() {\n            items = append(items, item)\n        } else {\n            continue\n        }\n    }\n    return items\n}\n</code></pre>\n\n<p>Now, This works fine for test database but in production database where there are millions of rows, it gets stuck after fetching 1,000 rows &amp; stops printing on screen. I left it running for the night. </p>\n\n<p>In morning, \nI sent it <code>QUIT</code> signal &amp; got the following stack trace</p>\n\n<pre><code>SIGQUIT: quit\nPC=0x5fecb m=0\n\ngoroutine 0 [idle]:\nruntime.mach_semaphore_wait(0xe03, 0x0, 0x0, 0x0, 0x0, 0x407520, 0x52db9, 0xffffffffffffffff, 0x0, 0x7fff5fbff0fc, ...)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/sys_darwin_amd64.s:407 +0xb\nruntime.semasleep1(0xffffffffffffffff, 0x0)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/os1_darwin.go:385 +0xe5\nruntime.semasleep.func1()\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/os1_darwin.go:401 +0x29\nruntime.systemstack(0x7fff5fbff100)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/asm_amd64.s:278 +0xab\nruntime.semasleep(0xffffffffffffffff, 0x0)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/os1_darwin.go:402 +0x36\nruntime.notesleep(0x407970)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/lock_sema.go:169 +0x100\nruntime.stopm()\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/proc1.go:1128 +0x112\nruntime.findrunnable(0xc82001d500, 0x0)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/proc1.go:1530 +0x69e\nruntime.schedule()\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/proc1.go:1639 +0x267\nruntime.park_m(0xc820000180)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/proc1.go:1698 +0x18b\nruntime.mcall(0x7fff5fbff280)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/asm_amd64.s:204 +0x5b\n\ngoroutine 1 [IO wait]:\nnet.runtime_pollWait(0x7a1000, 0x72, 0xc82000a2d0)\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/netpoll.go:157 +0x60\nnet.(*pollDesc).Wait(0xc8200a4060, 0x72, 0x0, 0x0)\n    /usr/local/Cellar/go/1.5/libexec/src/net/fd_poll_runtime.go:73 +0x3a\nnet.(*pollDesc).WaitRead(0xc8200a4060, 0x0, 0x0)\n    /usr/local/Cellar/go/1.5/libexec/src/net/fd_poll_runtime.go:78 +0x36\nnet.(*netFD).Read(0xc8200a4000, 0xc820372077, 0x3f89, 0x3f89, 0x0, 0x760050, 0xc82000a2d0)\n    /usr/local/Cellar/go/1.5/libexec/src/net/fd_unix.go:232 +0x23a\nnet.(*conn).Read(0xc8200a6000, 0xc820372077, 0x3f89, 0x3f89, 0x0, 0x0, 0x0)\n    /usr/local/Cellar/go/1.5/libexec/src/net/net.go:172 +0xe4\ngithub.com/go-sql-driver/mysql.(*buffer).fill(0xc820080080, 0x102, 0x0, 0x0)\n    /Users/gaurish/golang/src/github.com/go-sql-driver/mysql/buffer.go:57 +0x2b5\ngithub.com/go-sql-driver/mysql.(*buffer).readNext(0xc820080080, 0x102, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /Users/gaurish/golang/src/github.com/go-sql-driver/mysql/buffer.go:86 +0x55\ngithub.com/go-sql-driver/mysql.(*mysqlConn).readPacket(0xc820080080, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /Users/gaurish/golang/src/github.com/go-sql-driver/mysql/packets.go:57 +0x47a\ngithub.com/go-sql-driver/mysql.(*mysqlConn).readUntilEOF(0xc820080080, 0x0, 0x0)\n    /Users/gaurish/golang/src/github.com/go-sql-driver/mysql/packets.go:698 +0x2d\ngithub.com/go-sql-driver/mysql.(*mysqlRows).Close(0xc8200a0120, 0x0, 0x0)\n    /Users/gaurish/golang/src/github.com/go-sql-driver/mysql/rows.go:67 +0x73\ndatabase/sql.(*Rows).Close(0xc8200aa060, 0x0, 0x0)\n    /usr/local/Cellar/go/1.5/libexec/src/database/sql/sql.go:1710 +0x92\nmain.parseMenuItems(0xc82036e480, 0x44, 0x44, 0x0, 0x0, 0x0)\n    /Users/gaurish/code/practice/mysql2json/mysql2json.go:186 +0x468\nmain.main()\n    /Users/gaurish/code/practice/mysql2json/mysql2json.go:142 +0xf2e\n\ngoroutine 17 [syscall, locked to thread]:\nruntime.goexit()\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/asm_amd64.s:1696 +0x1\n\ngoroutine 5 [chan receive]:\ndatabase/sql.(*DB).connectionOpener(0xc820088960)\n    /usr/local/Cellar/go/1.5/libexec/src/database/sql/sql.go:634 +0x45\ncreated by database/sql.Open\n    /usr/local/Cellar/go/1.5/libexec/src/database/sql/sql.go:481 +0x336\n\nrax    0xe\nrbx    0xe03\nrcx    0x7fff5fbff088\nrdx    0x7fff5fbff100\nrdi    0xe03\nrsi    0x407520\nrbp    0x407860\nrsp    0x7fff5fbff088\nr8     0x407860\nr9     0x0\nr10    0x0\nr11    0x286\nr12    0x2c\nr13    0x4fc3ed4b8b0\nr14    0x14059837c8b46200\nr15    0x38\nrip    0x5fecb\nrflags 0x286\ncs     0x7\nfs     0x0\ngs     0x0\nexit status 2\n</code></pre>\n\n<p>Further, I tried debugging it further by commenting out the <code>defer rows.Close()</code> call. now after 1,000 rows or so, instead of stalling, it immediately returns the following error:</p>\n\n<pre><code>panic: runtime error: index out of range\n\ngoroutine 1 [running]:\nmain.parseMenuItems(0xc820366900, 0x44, 0x44, 0x0, 0x0, 0x0)\n    /Users/gaurish/code/practice/mysql2json/mysql2json.go:186 +0x468\nmain.main()\n    /Users/gaurish/code/practice/mysql2json/mysql2json.go:142 +0xf03\n\ngoroutine 17 [syscall, locked to thread]:\nruntime.goexit()\n    /usr/local/Cellar/go/1.5/libexec/src/runtime/asm_amd64.s:1696 +0x1\n\ngoroutine 5 [runnable]:\ndatabase/sql.(*DB).connectionOpener(0xc820088780)\n    /usr/local/Cellar/go/1.5/libexec/src/database/sql/sql.go:634 +0x45\ncreated by database/sql.Open\n    /usr/local/Cellar/go/1.5/libexec/src/database/sql/sql.go:481 +0x336\nexit status 2\n</code></pre>\n\n<p><strong>Questions:</strong></p>\n\n<ol>\n<li>Why does it get stuck immediately after fetching 1,000(appox) rows?</li>\n<li>How does commenting out <code>defer rows.Close()</code> stops from getting stuck &amp; panics immediately? </li>\n<li>Is there is a better way to write this program?</li>\n</ol>\n\n<p>Lastly, I am sorry if any of the above these are stupid questions or question is too long. I am new to Go &amp; trying to learn.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "edited": false, "score": 0, "creation_date": 1442730416, "post_id": 32676034, "comment_id": 53198032, "body": "If you&#39;re reading text, remember that utf8 doesn&#39;t always consist of single byte characters. You might end up chopping an otherwise valid character if you always delimit on a single byte."}, {"owner": {"reputation": 77, "user_id": 3715832, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06a916c22108f0a8668e91440dc9515f?s=128&d=identicon&r=PG&f=1", "display_name": "T.L", "link": "https://stackoverflow.com/users/3715832/t-l"}, "reply_to_user": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "edited": false, "score": 0, "creation_date": 1442736798, "post_id": 32676034, "comment_id": 53199361, "body": "@JeffreyMartinez, sadly, most Golang APIs use byte instead of rune as delims."}, {"owner": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "edited": false, "score": 0, "creation_date": 1442739382, "post_id": 32676034, "comment_id": 53199949, "body": "@TL That&#39;s ok, learn from past mistakes and use rune for yours to make it better ;)"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1442760291, "post_id": 32676338, "comment_id": 53205672, "body": "Be <i>very</i> careful adding &quot;temporary&quot; buffering like this. In general, a <code>bufio.Reader</code> may read ahead on <code>r</code> and if you then ignore/discard the buffer and go back to reading from <code>r</code> you will skip those bytes (the <a href=\"https://golang.org/pkg/bufio/#Reader.Buffered\" rel=\"nofollow noreferrer\"><code>Buffered</code></a> method will tell you how many such bytes there are)."}], "tags": [], "owner": {"reputation": 10229, "user_id": 195130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e8ae4e7eded8cd37805b4b31cc1f1c53?s=128&d=identicon&r=PG", "display_name": "Chandra Sekar", "link": "https://stackoverflow.com/users/195130/chandra-sekar"}, "is_accepted": true, "score": 2, "last_activity_date": 1442729143, "creation_date": 1442729143, "answer_id": 32676338, "question_id": 32676034, "link": "https://stackoverflow.com/questions/32676034/is-there-a-api-to-read-a-line-from-a-reader-but-to-limit-the-length-of-returned/32676338#32676338", "title": "Is there a API to read a line from a reader, but to limit the length of returned line?", "body": "<p>I don't think there is a direct function, but implementing one using <code>io.LimitReader</code> is straightforward.</p>\n\n<pre><code>func ReadLimitedLine(r io.Reader, delim byte, max int64) ([]byte, error) {\n    l, err := bufio.NewReader(io.LimitReader(r, max)).ReadBytes(delim)\n    if err != nil &amp;&amp; err != io.EOF {\n        return nil, err\n    }\n\n    // ReadBytes includes the delimiter in return value\n    return bytes.TrimSuffix(l, []byte{delim}), nil\n}\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 3715832, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06a916c22108f0a8668e91440dc9515f?s=128&d=identicon&r=PG&f=1", "display_name": "T.L", "link": "https://stackoverflow.com/users/3715832/t-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 1, "accepted_answer_id": 32676338, "answer_count": 1, "score": 0, "last_activity_date": 1442729143, "creation_date": 1442725917, "question_id": 32676034, "link": "https://stackoverflow.com/questions/32676034/is-there-a-api-to-read-a-line-from-a-reader-but-to-limit-the-length-of-returned", "title": "Is there a API to read a line from a reader, but to limit the length of returned line?", "body": "<p>The prototype would be:</p>\n\n<pre><code> (reader *Reader) ReadLineWithMaxLength (delim byte, max int) (line []byte, err error)\n</code></pre>\n\n<p>It returns a line when either the <em>delim</em> is found or <em>max</em> length is reached.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1442725396, "post_id": 32675924, "comment_id": 53197103, "body": "Are you using Go 1.5? Also how many cores?"}, {"owner": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "edited": false, "score": 0, "creation_date": 1442799716, "post_id": 32675924, "comment_id": 53216887, "body": "@Shawn Putting the sleep at the end of the function like that will not have the effect you are looking for. Furthermore, the main function doesn&#39;t wait for the sleep to finish executing before terminating, so the sleep is essentially doing nothing."}], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 4192807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be60ce182f061d51c668f20367c0084f?s=128&d=identicon&r=PG&f=1", "display_name": "Shawn", "link": "https://stackoverflow.com/users/4192807/shawn"}, "edited": false, "score": 0, "creation_date": 1442772999, "post_id": 32676686, "comment_id": 53209985, "body": "I make the thread to sleep, but same thing happens. I am still confusing."}, {"owner": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "reply_to_user": {"reputation": 27, "user_id": 4192807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be60ce182f061d51c668f20367c0084f?s=128&d=identicon&r=PG&f=1", "display_name": "Shawn", "link": "https://stackoverflow.com/users/4192807/shawn"}, "edited": false, "score": 0, "creation_date": 1442790872, "post_id": 32676686, "comment_id": 53215273, "body": "@Shawn you put the sleep after the value is placed on the channel, this will not have the effect you&#39;re looking for."}, {"owner": {"reputation": 27, "user_id": 4192807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be60ce182f061d51c668f20367c0084f?s=128&d=identicon&r=PG&f=1", "display_name": "Shawn", "link": "https://stackoverflow.com/users/4192807/shawn"}, "edited": false, "score": 0, "creation_date": 1442800587, "post_id": 32676686, "comment_id": 53217063, "body": "Thank you. Even I put the sleep before send number to channel same thing happens again...."}, {"owner": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "reply_to_user": {"reputation": 27, "user_id": 4192807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be60ce182f061d51c668f20367c0084f?s=128&d=identicon&r=PG&f=1", "display_name": "Shawn", "link": "https://stackoverflow.com/users/4192807/shawn"}, "edited": false, "score": 0, "creation_date": 1442813057, "post_id": 32676686, "comment_id": 53219964, "body": "@Shawn Now you just have a different problem. You need to seed the pseudo-random number generator. Otherwise you are seeing the <i>same</i> &quot;random&quot; numbers every time. Add <code>rand.Seed(time.Now().UnixNano())</code> to the top of your <code>main</code> function and it will work."}], "tags": [], "owner": {"reputation": 4011, "user_id": 29703, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/32e50f8f8e17d63c49bf03d54a48282a?s=128&d=identicon&r=PG", "display_name": "Jeffrey Martinez", "link": "https://stackoverflow.com/users/29703/jeffrey-martinez"}, "is_accepted": true, "score": 2, "last_activity_date": 1442732037, "creation_date": 1442732037, "answer_id": 32676686, "question_id": 32675924, "link": "https://stackoverflow.com/questions/32675924/goroutine-out-put-to-channel-order-fixed/32676686#32676686", "title": "goroutine out put to channel order fixed?", "body": "<p>The assumption that it <em>should</em> be a 50/50 chance is incorrect in this situation. To be clear, I'm not suggesting it should always be one or the other but rather that you shouldn't expect it to change each time the program runs. The behavior is not necessarily random (or even pseudo-random).</p>\n\n<p>A goroutine's guarantee is not that it will be scheduled at a random future time, but rather just that it will run at some time in the future. If the current implementation of the scheduler decided to put goroutines in a simple queue, it wouldn't automatically mean it's broken. For your particular code's case, if you stick a few <code>time.Sleep</code>s or <code>fmt.Printf</code>s in different places, you'd likely see the order change around sometimes.</p>\n\n<p>I wonder if you're confusing Go's scheduler's selection of the next goroutine with the documented pseudo-random behavior of <code>select</code> when used with channels. The behavior there is defined to be random and it's correct to say the behavior <em>should</em> have a 50/50 chance.</p>\n\n<p>As far as I've read, the choice of which goroutine the runtime will select is not random. That's not the same as saying it can't be random, but moreso that it's not <em>supposed</em> to be random.</p>\n\n<p>The important thing is that your code shouldn't care about the order in which goroutines are scheduled. Whether it's always in order like a queue, or backwards (a stack), or random, or something else (likely the reality).</p>\n"}], "owner": {"reputation": 27, "user_id": 4192807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be60ce182f061d51c668f20367c0084f?s=128&d=identicon&r=PG&f=1", "display_name": "Shawn", "link": "https://stackoverflow.com/users/4192807/shawn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 32676686, "answer_count": 1, "score": 2, "last_activity_date": 1442800669, "creation_date": 1442724568, "last_edit_date": 1442800669, "question_id": 32675924, "link": "https://stackoverflow.com/questions/32675924/goroutine-out-put-to-channel-order-fixed", "title": "goroutine out put to channel order fixed?", "body": "<pre><code>package main\n\nimport \"fmt\"\n\nfunc sum(a []int, c chan int) {\n    sum := 0\n    for _, v := range a {\n        sum += v\n    }\n    c &lt;- sum // send sum to c\n}\n\nfunc main() {\n    a := []int{7, 2, 8, -9, 4, 0}\n\n    c := make(chan int)\n    go sum(a[len(a)/2:], c)\n    go sum(a[:len(a)/2], c)\n\n    x, y := &lt;-c, &lt;-c // receive from c\n\n    fmt.Println(x, y, x+y)\n}\n</code></pre>\n\n<p><code>x, y := &lt;-c, &lt;-c // receive from c</code></p>\n\n<p>Why does this line always print the same result?</p>\n\n<p>I think it should be 50/50 chance to print\n<code>17 -5 12</code>\nor\n<code>-5 17 12</code></p>\n\n<p>I think the two go routines should be parallel</p>\n\n<p>Thanks in advance!</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\nimport \"math/rand\"\n\nfunc sum(a []int, c chan int) {\n    sum := 0\n    for _, v := range a {\n        sum += v\n    }\n    time.Sleep(time.Millisecond * time.Duration(rand.Intn(1000)))\n    c &lt;- sum // send sum to c\n\n}\n\nfunc main() {\n    a := []int{7, 2, 8, -9, 4, 0}\n\n    c := make(chan int)\n    go sum(a[len(a)/2:], c)\n    go sum(a[:len(a)/2], c)\n\n    x, y := &lt;-c, &lt;-c // receive from c\n\n    fmt.Println(x, y, x+y)\n}\n</code></pre>\n\n<p>I make the thread to sleep, but same thing happens. I am still confusing.</p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546187142, "post_id": 32674913, "comment_id": 94796012, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/11693865/lowercase-json-key-names-with-json-marshal-in-go\">Lowercase JSON key names with JSON Marshal in Go</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1475436429, "last_edit_date": 1475436429, "creation_date": 1442713517, "answer_id": 32674930, "question_id": 32674913, "link": "https://stackoverflow.com/questions/32674913/why-struct-fields-are-showing-empty/32674930#32674930", "title": "Why struct fields are showing empty?", "body": "<p>This has come up so many times. The problem is that only exported fields can be marshaled/unmarshaled.</p>\n\n<p>Export the struct fields by starting them with capital (upper-case) letters.</p>\n\n<pre><code>type Animal2 struct {\n    Name  string\n    Spec string\n    Id uint32\n}\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/rZe0qTL86_\" rel=\"nofollow\">Go Playground</a>.</p>\n\n<p>Note that the JSON text contains the field names with lowercased text, but the <code>json</code> package is \"clever\" enough to match them. If they would be completely different, you could use struct tags to tell the <code>json</code> package how they are found (or how they should be marshaled) in the JSON text, e.g.:</p>\n\n<pre><code>type Animal2 struct {\n    Name  string `json:\"json_name\"`\n    Spec string  `json:\"specification\"`\n    Id uint32    `json:\"some_custom_id\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 43489, "user_id": 568109, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/2hthl.gif?s=128&g=1", "display_name": "user568109", "link": "https://stackoverflow.com/users/568109/user568109"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 32674930, "answer_count": 1, "score": 2, "last_activity_date": 1475436489, "creation_date": 1442713225, "last_edit_date": 1475436489, "question_id": 32674913, "link": "https://stackoverflow.com/questions/32674913/why-struct-fields-are-showing-empty", "title": "Why struct fields are showing empty?", "body": "<p>I am struggling to get the correct output from the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n\n    var jsonBlob3 = []byte(`[\n        {\"name\": \"Platypus\", \"spec\": \"Monotremata\", \"id\":25 },\n        {\"name\": \"Quoll\",    \"spec\": \"Dasyuromorphia\", \"id\":25 }\n    ]`)\n    type Animal2 struct {\n        name  string\n        spec string\n        id uint32\n    }\n    var animals []Animal2\n    err := json.Unmarshal(jsonBlob3, &amp;animals)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n    fmt.Printf(\"%+v\\n\", animals)\n}\n</code></pre>\n\n<p>Playground <a href=\"http://play.golang.org/p/s-T2QAjaDr\" rel=\"nofollow\">snippet</a></p>\n\n<p>The struct fields are empty when printed. I am sure there is a dumb mistake somewhere but I am still new to Go and I have been stuck at this for hours. Please help.</p>\n"}, {"tags": ["elasticsearch", "go"], "answers": [{"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": false, "score": 2, "last_activity_date": 1442724819, "creation_date": 1442724819, "answer_id": 32675939, "question_id": 32674666, "link": "https://stackoverflow.com/questions/32674666/how-to-search-in-elasticsearch-with-go-filtering-results-by-time-frames/32675939#32675939", "title": "How to search in elasticsearch with Go filtering results by time frames", "body": "<p>See <a href=\"https://godoc.org/gopkg.in/olivere/elastic.v2#RangeFilter\" rel=\"nofollow\"><code>RangeFilter</code></a> and <a href=\"https://godoc.org/gopkg.in/olivere/elastic.v2#FilteredQuery\" rel=\"nofollow\"><code>FilteredQuery</code></a></p>\n\n<p>Here is an example producing the result you want :</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n\n    elastic \"gopkg.in/olivere/elastic.v2\"\n)\n\nfunc main() {\n\n    termQuery := elastic.NewTermQuery(\"message\", \"configuration\")\n\n    timeRangeFilter := elastic.NewRangeFilter(\"@timestamp\").Gte(1442100154219).Lte(1442704954219)\n\n    // Not sure this one is really useful, I just put it here to mimic what you said is the expected result\n    boolFilter := elastic.NewBoolFilter().Must(timeRangeFilter)\n\n    query := elastic.NewFilteredQuery(termQuery).Filter(boolFilter)\n\n    queryBytes, err := json.MarshalIndent(query.Source(), \"\", \"\\t\")\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(string(queryBytes))\n}\n</code></pre>\n\n<p>The output it produces is:</p>\n\n<pre><code>{\n    \"filtered\": {\n        \"filter\": {\n            \"bool\": {\n                \"must\": {\n                    \"range\": {\n                        \"@timestamp\": {\n                            \"from\": 1442100154219,\n                            \"include_lower\": true,\n                            \"include_upper\": true,\n                            \"to\": 1442704954219\n                        }\n                    }\n                }\n            }\n        },\n        \"query\": {\n            \"term\": {\n                \"message\": \"configuration\"\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 5023531, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JAZGA-Tc9M8/AAAAAAAAAAI/AAAAAAAAAB8/9IBW8snNoVQ/photo.jpg?sz=128", "display_name": "egorka", "link": "https://stackoverflow.com/users/5023531/egorka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3015, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1442727124, "creation_date": 1442710125, "last_edit_date": 1442727124, "question_id": 32674666, "link": "https://stackoverflow.com/questions/32674666/how-to-search-in-elasticsearch-with-go-filtering-results-by-time-frames", "title": "How to search in elasticsearch with Go filtering results by time frames", "body": "<p>I am retentively new to programming in Go.</p>\n\n<p>I am trying create a simple program which does only one thing searches string via elasticsearch API.\nMy question is specific to the \"<a href=\"https://godoc.org/gopkg.in/olivere/elastic.v2\" rel=\"nofollow\">gopkg.in/olivere/elastic.v2</a>\" package I am using.</p>\n\n<p>Here is a code sample: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/olivere/elastic.v2\"\n    \"log\"\n    \"reflect\"\n)\n\ntype Syslog struct {\n    Program   string\n    Message   string\n    Timestamp string\n}\n\n\nfunc main() {\n\n    client, err := elastic.NewClient(elastic.SetURL(\"http://localhost:9200\"))\n    if err != nil {\n        log.Fatal(err)\n    }\n    info, code, err := client.Ping().Do()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"Elasticsearch returned with code %d and version  %s\", code, info.Version.Number)\n\n    termQuery := elastic.NewTermQuery(\"message\", \"configuration\")\n\n    searchResult, err := client.Search().\n        //PostFilter(postFilter).\n        Index(\"logstash-*\").     // search in index \"logstash-*\"\n        Query(&amp;termQuery).       // specify the query\n        Sort(\"timestamp\", true). // sort by \"message\" field, ascending\n        From(0).Size(10).        // take documents 0-9\n        Pretty(true).            // pretty print request and response JSON\n        Do()                     // execute\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\" Query took %d milliseconds\\n\", searchResult.TookInMillis)\n\n    var ttyp Syslog\n\n    for _, item := range searchResult.Each(reflect.TypeOf(ttyp)) {\n        t := item.(Syslog)\n        fmt.Printf(\"Found %s %s %s\\n\", t.Timestamp, t.Program, t.Message)\n    }\n\n}\n</code></pre>\n\n<p>This works, however what I really want is to limit search by time range.</p>\n\n<p>As I understand I need to use FilteredQuery function. But I am lost in attempts to figure out how to create a filtered query.</p>\n\n<p>There is function which created it \"FilteredQuery\" it requires Query Type as an input parameter but there is no function to create Query itself. I can just create a variable of a required type, still it need to have fields like which filed in elasticsearch to look for and a string to look for.</p>\n\n<p>Same thing goes for the Filter variable in call for <code>func (FilteredQuery) Filter</code>.</p>\n\n<p>May be someone has already got an example or can point me into the right direction.</p>\n\n<p>I have an example of a JSON which if passed to elastcisearch gets me what I want:</p>\n\n<pre><code>\"query\": {\n    \"filtered\": {\n      \"query\": {\n        \"query_string\": {\n          \"query\": \"message:\\\"configuration\\\"\",\n          \"analyze_wildcard\": true\n        }\n      },\n      \"filter\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"range\": {\n                \"@timestamp\": {\n                  \"gte\": 1442100154219,\n                  \"lte\": 1442704954219\n                }\n              }\n            }\n          ],\n          \"must_not\": []\n        }\n      }\n    }\n  },\n</code></pre>\n\n<p>But I do not know how to implement the same in Go. Thanks.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "edited": false, "score": 0, "creation_date": 1442709899, "post_id": 32674557, "comment_id": 53194730, "body": "I&#39;m aware, but I&#39;m looking for an answer to the question as stated."}, {"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "reply_to_user": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "edited": false, "score": 0, "creation_date": 1442710998, "post_id": 32674557, "comment_id": 53194960, "body": "Please clarify the confusion.  The code I posted is the shortest way to initialize an integer and a pointer to that integer variable."}, {"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "edited": false, "score": 0, "creation_date": 1442711088, "post_id": 32674557, "comment_id": 53194973, "body": "I&#39;m aware of how your version works. I want to learn how to do it with <i>var</i>. This is not to say that I don&#39;t prefer the inferred-type syntax, but I want to get the question answered."}, {"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "reply_to_user": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "edited": false, "score": 0, "creation_date": 1442711275, "post_id": 32674557, "comment_id": 53195001, "body": "<code>var y *int = &amp;x</code> creates <code>y</code> as a pointer to <code>x</code>.  There&#39;s no need for <code>new</code> for references to initialized variables."}, {"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "edited": false, "score": 1, "creation_date": 1442711520, "post_id": 32674557, "comment_id": 53195035, "body": "Shoot. You&#39;re right. Eventually I was in the mindset of assigning a static integer before I realized that you had direct memory access with Go. When I realized that was the case, I switched to asking about how to initialize a new pointer with a reference but kept the same syntax that I was attempting for the static value. Thanks."}], "tags": [], "owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "is_accepted": true, "score": 1, "last_activity_date": 1442709404, "last_edit_date": 1442709404, "creation_date": 1442708988, "answer_id": 32674557, "question_id": 32674516, "link": "https://stackoverflow.com/questions/32674516/declaring-and-initializing-an-integer-pointer/32674557#32674557", "title": "Declaring and initializing an integer pointer", "body": "<p>There's no need to be verbose in assignments with go.  </p>\n\n<pre><code>x := 5\ny := &amp;x\n</code></pre>\n\n<p><code>x</code> will be created and initialized as an <code>int</code> and <code>y</code> will be <code>*int</code> upon compilation.  </p>\n\n<p>NOTE:  Because multiple assignment is processed as a single expression, <code>x, y := 5, &amp;x</code> will <strong>not</strong> work.  </p>\n"}], "owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 579, "favorite_count": 0, "accepted_answer_id": 32674557, "answer_count": 1, "score": 1, "last_activity_date": 1442709404, "creation_date": 1442708677, "question_id": 32674516, "link": "https://stackoverflow.com/questions/32674516/declaring-and-initializing-an-integer-pointer", "title": "Declaring and initializing an integer pointer", "body": "<p>I'm new to developing in Go. It seems like, though you're able to initialize a dictionary, structure, etc.. with a value (using curly-brackets), the same syntax can not be used to initialize an integer (all scalars?) pointer with a value. It might be because the curly bracket syntax seem to lend itself exclusively to [composite?] types.</p>\n\n<p>Invalid due to \"new(int) is not a type\" error:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var x int = 5\n    var y *int = new(int){x}\n\n    fmt.Println(x)\n    fmt.Println(y)\n}\n</code></pre>\n\n<p>So, <em>is</em> there a way to initialize an integer with a reference to another variable, or does this necessarily always have to be separate steps?</p>\n"}, {"tags": ["go", "first-class-functions"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1442761797, "post_id": 32673407, "comment_id": 53206206, "body": "In future please be more careful when cut-n-pasting code. Your code snippet isn&#39;t even valid Go (<code>struct B {</code> vs <code>type B struct {</code> and missing <code>)</code> in the <code>Generic</code> definition). You should also <code>gofmt</code> all Go code in questions (e.g. that would remove the extraneous parentheses you have around the return types that just make it harder to read). Finally, providing a play.golang.org link can be very helpful to both those trying to answer and those readers that want to try/experiment with the issue; e.g. <a href=\"https://play.golang.org/p/ON15IwPwDy\" rel=\"nofollow noreferrer\">play.golang.org/p/ON15IwPwDy</a>."}], "answers": [{"tags": [], "owner": {"reputation": 7931, "user_id": 441099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d18ac367611aeb431cef6e156525d5a?s=128&d=identicon&r=PG", "display_name": "Guy Sirton", "link": "https://stackoverflow.com/users/441099/guy-sirton"}, "is_accepted": false, "score": 0, "last_activity_date": 1442700380, "last_edit_date": 1442700380, "creation_date": 1442698813, "answer_id": 32673504, "question_id": 32673407, "link": "https://stackoverflow.com/questions/32673407/dynamic-function-call-in-go/32673504#32673504", "title": "Dynamic function call in Go", "body": "<p>Your return signature is different for these functions:\n<code>fn func() (interface {})</code> vs. <code>func doA() (A)</code> and <code>func doB() (B)</code></p>\n\n<p>You are getting a compiler error because you are passing a function with a different signature into your <code>Generic</code> function.  To address this issue you can change your functions to return <code>interface{}</code>.</p>\n\n<p>This is an example of how to do that, I am using anonymous structs and printing the return value out rather than serializing them but this applies just the same to your example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc doA() interface{} {\n    return struct {\n        Name  string\n        Value int\n    }{\n        \"something\",\n        5,\n    }\n}\n\nfunc doB() interface{} {\n    return struct {\n        Name1 string\n        Name2 string\n        Value float64\n    }{\n        \"something\",\n        \"or other\",\n        5.3,\n    }\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\", doA(), doB())\n}\n</code></pre>\n\n<p>Experiment with this in the Go Playground: <a href=\"http://play.golang.org/p/orrJw2XMW8\" rel=\"nofollow\">http://play.golang.org/p/orrJw2XMW8</a></p>\n"}, {"comments": [{"owner": {"reputation": 246, "user_id": 1873451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/828e13a3705219ae9ee32d9c375e05e1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1873451/eric"}, "edited": false, "score": 0, "creation_date": 1442734859, "post_id": 32673578, "comment_id": 53198936, "body": "I came to that conclusion as well, but I wanted to keep the strong typing for the return values of doA() and doB(). I guess there is no way to achieve that ?"}, {"owner": {"reputation": 11133, "user_id": 4275347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CdbsN.jpg?s=128&g=1", "display_name": "Michael Laszlo", "link": "https://stackoverflow.com/users/4275347/michael-laszlo"}, "reply_to_user": {"reputation": 246, "user_id": 1873451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/828e13a3705219ae9ee32d9c375e05e1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1873451/eric"}, "edited": false, "score": 0, "creation_date": 1442748243, "post_id": 32673578, "comment_id": 53202195, "body": "You can achieve that if you make your <code>Generic</code> function accept an argument of type <code>interface{}</code>. Please see my extended answer."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1442761911, "post_id": 32673578, "comment_id": 53206253, "body": "Although very interesting/informative, of course the &quot;real&quot; answer is &quot;don&#39;t do this&quot;. Reflection should only be used when all else fails, it should be the <i>last resort</i> you turn to and not the first thing you try. Also note this follows the OP example of having absolutely zero error checking which is a giant no-no, never ignore errors, e.g. from <code>json.Encode</code>."}, {"owner": {"reputation": 1593, "user_id": 688689, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/f8b3028279d9c29a3ee4c5d0f5fe6a23?s=128&d=identicon&r=PG&f=1", "display_name": "Diego Favero", "link": "https://stackoverflow.com/users/688689/diego-favero"}, "edited": false, "score": 0, "creation_date": 1584484452, "post_id": 32673578, "comment_id": 107450062, "body": "How to do that ?   \tfn := &quot;doA&quot; \tGeneric(os.Stdout, fn)"}], "tags": [], "owner": {"reputation": 11133, "user_id": 4275347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CdbsN.jpg?s=128&g=1", "display_name": "Michael Laszlo", "link": "https://stackoverflow.com/users/4275347/michael-laszlo"}, "is_accepted": true, "score": 10, "last_activity_date": 1442830249, "last_edit_date": 1442830249, "creation_date": 1442699374, "answer_id": 32673578, "question_id": 32673407, "link": "https://stackoverflow.com/questions/32673407/dynamic-function-call-in-go/32673578#32673578", "title": "Dynamic function call in Go", "body": "<p>First, let me remark that <code>func() (interface{})</code> means the same thing as <code>func() interface{}</code>, so I'll use the shorter form.</p>\n\n<h2>Passing a function of type <code>func() interface{}</code></h2>\n\n<p>You can write a generic function that takes a <code>func() interface{}</code> argument as long as the function that you pass to it has type <code>func() interface{}</code>, like this:</p>\n\n<pre><code>type A struct {\n    Name  string\n    Value int\n}\n\ntype B struct {\n    Name1 string\n    Name2 string\n    Value float64\n}\n\nfunc doA() interface{} {\n    return &amp;A{\"Cats\", 10}\n}\n\nfunc doB() interface{} {\n    return &amp;B{\"Cats\", \"Dogs\", 10.0}\n}\n\nfunc Generic(w io.Writer, fn func() interface{}) {\n    result := fn()\n    json.NewEncoder(w).Encode(result)\n}\n</code></pre>\n\n<p>You can try out this code in a live playground:</p>\n\n<p><a href=\"http://play.golang.org/p/JJeww9zNhE\" rel=\"noreferrer\">http://play.golang.org/p/JJeww9zNhE</a></p>\n\n<h1>Passing a function as an argument of type <code>interface{}</code></h1>\n\n<p>If you want to write functions <code>doA</code> and <code>doB</code> that return concretely typed values, you can pass the chosen function as an argument of type <code>interface{}</code>. Then you can use the <a href=\"https://golang.org/pkg/reflect/\" rel=\"noreferrer\"><code>reflect</code> package</a> to make a <code>func() interface{}</code> at run-time:</p>\n\n<pre><code>func Generic(w io.Writer, f interface{}) {\n    fnValue := reflect.ValueOf(f)        // Make a concrete value.\n    arguments := []reflect.Value{}       // Make an empty argument list.\n    fnResults := fnValue.Call(arguments) // Assume we have a function. Call it.\n    result := fnResults[0].Interface()   // Get the first result as interface{}.\n    json.NewEncoder(w).Encode(result)    // JSON-encode the result.\n}\n</code></pre>\n\n<p>More concisely:</p>\n\n<pre><code>func Generic(w io.Writer, fn interface{}) {\n    result := reflect.ValueOf(fn).Call([]reflect.Value{})[0].Interface()\n    json.NewEncoder(w).Encode(result)\n}\n</code></pre>\n\n<p>Complete program:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"io\"\n    \"os\"\n    \"reflect\"\n)\n\ntype A struct {\n    Name  string\n    Value int\n}\n\ntype B struct {\n    Name1 string\n    Name2 string\n    Value float64\n}\n\nfunc doA() *A {\n    return &amp;A{\"Cats\", 10}\n}\n\nfunc doB() *B {\n    return &amp;B{\"Cats\", \"Dogs\", 10.0}\n}\n\nfunc Generic(w io.Writer, fn interface{}) {\n    result := reflect.ValueOf(fn).Call([]reflect.Value{})[0].Interface()\n    json.NewEncoder(w).Encode(result)\n}\n\nfunc main() {\n    Generic(os.Stdout, doA)\n    Generic(os.Stdout, doB)\n}\n</code></pre>\n\n<p>Live playground:</p>\n\n<p><a href=\"http://play.golang.org/p/9M5Gr2HDRN\" rel=\"noreferrer\">http://play.golang.org/p/9M5Gr2HDRN</a></p>\n"}], "owner": {"reputation": 246, "user_id": 1873451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/828e13a3705219ae9ee32d9c375e05e1?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1873451/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14658, "favorite_count": 5, "accepted_answer_id": 32673578, "answer_count": 2, "score": 6, "last_activity_date": 1442830249, "creation_date": 1442698035, "last_edit_date": 1442700714, "question_id": 32673407, "link": "https://stackoverflow.com/questions/32673407/dynamic-function-call-in-go", "title": "Dynamic function call in Go", "body": "<p>I'm trying to dynamically call functions returning different types of <code>struct</code>.</p>\n\n<p>For example, let's take the following code.</p>\n\n<pre><code>struct A {\n   Name string\n   Value  int\n}\n\nstruct B {\n   Name1 string\n   Name2 string\n   Value   float\n}\n\nfunc doA() (A) {\n   // some code returning A\n}\n\nfunc doB() (B) {\n   // some code returning B\n}\n</code></pre>\n\n<p>I would like to pass either the function <code>doA</code> or <code>doB</code> as an argument to a generic function that would execute the function and JSON-encode the result. Like the following:</p>\n\n<pre><code>func Generic(w io.Writer, fn func() (interface {}) {\n    result := fn()\n    json.NewEncoder(w).Encode(result)\n}\n</code></pre>\n\n<p>But when I do:</p>\n\n<pre><code>Generic(w, doA)\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>cannot use doA (type func() (A)) as type func() (interface {})\n</code></pre>\n\n<p>Is there a way to achieve this dynamic call?</p>\n"}, {"tags": ["string", "utf-8", "go", "bytearray"], "answers": [{"tags": [], "owner": {"reputation": 179, "user_id": 1591805, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/052927ad3f499883463c047c10f529fc?s=128&d=identicon&r=PG", "display_name": "jordan9001", "link": "https://stackoverflow.com/users/1591805/jordan9001"}, "is_accepted": false, "score": 0, "last_activity_date": 1442695892, "creation_date": 1442695892, "answer_id": 32673111, "question_id": 32673014, "link": "https://stackoverflow.com/questions/32673014/why-is-go-adding-bytes-to-my-string/32673111#32673111", "title": "Why is Go adding bytes to my string?", "body": "<p>I haven't found a way to avoid adding that character, if I use <code>string(0x80)</code> to convert the byte. However, I did find that if I change the whole string to a slice of bytes, then add the byte, then switch back to a string, I can get the correct byte order in the string.</p>\n\n<p>Example:</p>\n\n<pre><code>bytearray := []byte(some_string)\nbytearray = append(bytearray, 0x80)\nsome_string = string(bytearray)\n</code></pre>\n\n<p>Kind of a silly work around, if anyone finds a better method, please post it.</p>\n"}, {"comments": [{"owner": {"reputation": 179, "user_id": 1591805, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/052927ad3f499883463c047c10f529fc?s=128&d=identicon&r=PG", "display_name": "jordan9001", "link": "https://stackoverflow.com/users/1591805/jordan9001"}, "edited": false, "score": 0, "creation_date": 1442698045, "post_id": 32673322, "comment_id": 53192427, "body": "But how can I add just the pure byte, if I don&#39;t know what the byte will be?"}, {"owner": {"reputation": 12763, "user_id": 1097065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26becbd681062e6da684a000c6b03ea?s=128&d=identicon&r=PG", "display_name": "andybalholm", "link": "https://stackoverflow.com/users/1097065/andybalholm"}, "edited": false, "score": 1, "creation_date": 1442702482, "post_id": 32673322, "comment_id": 53193395, "body": "<code>b := byte(0x80); s += string([]byte{b})</code>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1442712499, "post_id": 32673322, "comment_id": 53195170, "body": "Better yet don&#39;t use a non-mutable type (<code>string</code>) for something mutable. If you&#39;re adding bytes to a thing you probably want the thing to be a <code>[]byte</code> or a <code>*bytes.Buffer</code> or some-such. Especially if you&#39;re using <code>+=</code> a lot as each time it may need to allocate and re-copy the string."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1442703699, "last_edit_date": 1442703699, "creation_date": 1442697391, "answer_id": 32673322, "question_id": 32673014, "link": "https://stackoverflow.com/questions/32673014/why-is-go-adding-bytes-to-my-string/32673322#32673322", "title": "Why is Go adding bytes to my string?", "body": "<p>The From the <a href=\"https://golang.org/ref/spec#Conversions_to_and_from_a_string_type\" rel=\"nofollow\">specification</a>:</p>\n\n<blockquote>\n  <p>Converting a signed or unsigned integer value to a string type yields a string containing the UTF-8 representation of the integer.</p>\n</blockquote>\n\n<p>The expression string(0x80) evaluates to a string with the UTF-8 representation of 0x80, not a string containing  the single byte 0x80. The UTF-8 representation of 0x80 is 0xc2 0x80.</p>\n\n<p>Use the \\x hex escape to specify the byte 0x80 in a string:</p>\n\n<pre><code> s += \"\\x80\"\n</code></pre>\n\n<p>You can create a string from an arbitrary sequence of bytes using the string([]byte) conversion.</p>\n\n<pre><code> s += string([]byte{0x80})\n</code></pre>\n"}], "owner": {"reputation": 179, "user_id": 1591805, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/052927ad3f499883463c047c10f529fc?s=128&d=identicon&r=PG", "display_name": "jordan9001", "link": "https://stackoverflow.com/users/1591805/jordan9001"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 32673322, "answer_count": 2, "score": -1, "last_activity_date": 1442718454, "creation_date": 1442695319, "last_edit_date": 1442718454, "question_id": 32673014, "link": "https://stackoverflow.com/questions/32673014/why-is-go-adding-bytes-to-my-string", "title": "Why is Go adding bytes to my string?", "body": "<p>When I add a single byte to my string at 0x80 or above, golang will add 0xc2 before my byte.\nI think this has something to do with <a href=\"https://golang.org/pkg/unicode/utf8/\" rel=\"nofollow\">utf8 runes</a>. Either way, how do I just add 0x80 to the end of my string?</p>\n\n<p>Example:</p>\n\n<pre><code>var s string = \"\"\nlen(s) // this will be 0\ns += string(0x80)\nlen(s) // this will be 2, string is now bytes 0xc2 0x80\n</code></pre>\n"}, {"tags": ["string", "memory", "go", "duplicates"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 1, "creation_date": 1442695241, "post_id": 32672911, "comment_id": 53191627, "body": "I think the only true answer you will receive is by trying out and profile and compare."}, {"owner": {"reputation": 7931, "user_id": 441099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d18ac367611aeb431cef6e156525d5a?s=128&d=identicon&r=PG", "display_name": "Guy Sirton", "link": "https://stackoverflow.com/users/441099/guy-sirton"}, "reply_to_user": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1442699293, "post_id": 32672911, "comment_id": 53192728, "body": "What exactly are you doing with those strings?  A map will be very fast at looking up the string but if you&#39;re only trying to save memory this is almost certainly not worthwhile (though as @inf suggests profile to be sure, this is just my gut feel)."}], "answers": [{"tags": [], "owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "is_accepted": false, "score": 1, "last_activity_date": 1442924164, "creation_date": 1442924164, "answer_id": 32716626, "question_id": 32672911, "link": "https://stackoverflow.com/questions/32672911/in-memory-string-deduplication/32716626#32716626", "title": "in-memory string deduplication", "body": "<p>There are a lot of interesting data structures and algorithms that you could use here. It depends on what you are trying do in the stats and processing stages.</p>\n\n<p>I am not sure how compressible your logs are but you could pre-process the data, again depending on your uses cases : <a href=\"https://github.com/alecthomas/mph/blob/master/README.md\" rel=\"nofollow\">https://github.com/alecthomas/mph/blob/master/README.md</a></p>\n\n<p>Take a look at some of these data structures as well for background : </p>\n\n<p><a href=\"https://github.com/Workiva/go-datastructures\" rel=\"nofollow\">https://github.com/Workiva/go-datastructures</a></p>\n"}], "owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 422, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1442924164, "creation_date": 1442694707, "question_id": 32672911, "link": "https://stackoverflow.com/questions/32672911/in-memory-string-deduplication", "title": "in-memory string deduplication", "body": "<p>Context: I'm writing something to process log data which involves loading several GB of data into memory and cross checking various things, finding correlations in data and writing the results out to another file.  (This is essentially a cooking/denormalization step before loading into a Druid.io cluster.)  I want to avoid having to write the information to a database for both performance and code simplicity - it is assumed that in the foreseeable future the volume of data processed at one time can be handled by adding memory to the machine.</p>\n\n<p>My question is if it is a good idea to attempt to explicitly deduplicate strings in my code; and if so, what is a good approach.  Many of the values in these log files are the same exact pieces of text (probably about 25% of the total text values in the file are unique, rough guess).</p>\n\n<p>Since we're talking about gigs of data, and while ram is cheap and swap is possible, there is still a limit and if I'm careless I will very likely hit it. If I do something like this:</p>\n\n<pre><code>strstore := make(map[string]string)\n\n// do some work that involves slicing and dicing some text, resulting in:\nvar a = \"some string that we figured out that has about a 75% chance of being duplicate\"\n\n// note that there are about 10 other such variables that are calculated here, only \"a\" shown for simplicity\n\nif _, ok := strstore[a]; !ok {\n    strstore[a] = a\n} else {\n    a = strstore[a]\n}\n\n// now do some more stuff with \"a\" and keep it in a struct which is in\n// some map some place\n</code></pre>\n\n<p>It would seem to me that this would have the effect of \"reusing\" existing strings, at the cost of a hash lookup and compare.  Seemingly a good trade off.</p>\n\n<p>However, this might not be that helpful if the strings that are in fact new cause memory to be fragmented and have various holes that are left unclaimed.</p>\n\n<p>I could also try to keep one big byte array/slice which has the character data and index into that, but it would make the code hard to write (esp having to mess around with conversion between []byte and strings, which involves it's own allocation) and I would probably just be doing a poor job of something that is really the Go runtime's domain anyway.</p>\n\n<p>Looking for any advice on approaches to this problem, or if anyone's experience with this sort of thing has yielded particularly useful mechanisms to address this.</p>\n"}, {"tags": ["c++", "go", "cuda", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 8381, "user_id": 5239503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MqgeX.jpg?s=128&g=1", "display_name": "Gilles", "link": "https://stackoverflow.com/users/5239503/gilles"}, "is_accepted": false, "score": 1, "last_activity_date": 1442681042, "creation_date": 1442681042, "answer_id": 32670706, "question_id": 32670493, "link": "https://stackoverflow.com/questions/32670493/compiling-error-with-cgo-iostream3828-fatal-error-bits-cconfig-h-no-such/32670706#32670706", "title": "Compiling error with cgo: iostream:38:28: fatal error: bits/c++config.h: No such file or directory", "body": "<p>Just a wild guess here since I know nothing of go / cgo...</p>\n\n<p>It looks like you have amix-up between version 4.8 and 4.9 of the g++ complier.</p>\n\n<p>I would try to change the cgo CPPFLAGS line accordingly, to this:</p>\n\n<pre><code>#cgo CPPFLAGS: -I/usr/local/cuda-7.0/include/ -I/usr/include/c++/4.9\n</code></pre>\n\n<p>But again, just guessing...</p>\n"}], "owner": {"reputation": 107, "user_id": 4903180, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/10206015533888282/picture?type=large", "display_name": "Marco Jammajalla Mangraviti", "link": "https://stackoverflow.com/users/4903180/marco-jammajalla-mangraviti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2343, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1442682243, "creation_date": 1442679616, "last_edit_date": 1442682243, "question_id": 32670493, "link": "https://stackoverflow.com/questions/32670493/compiling-error-with-cgo-iostream3828-fatal-error-bits-cconfig-h-no-such", "title": "Compiling error with cgo: iostream:38:28: fatal error: bits/c++config.h: No such file or directory", "body": "<p>I tried to execute the saxpy exemple from the official cuda nvrtc guide in <a href=\"http://docs.nvidia.com/cuda/nvrtc/index.html#example-saxpy\" rel=\"nofollow\">this page</a></p>\n\n<p>It works fine with the g++ compiler on terminal and following the build instructions:</p>\n\n<pre><code>g++ saxpy.cpp -o saxpy -I $CUDA_PATH/include -L $CUDA_PATH/lib64 -lnvrtc -lcuda -Wl,-rpath,$CUDA_PATH/lib64\n</code></pre>\n\n<p>Now I'm trying to execute it in go language with the cgo tool.\nI named main function in \"my_function\" and I'm trying to call it with C.my_function.</p>\n\n<p>this is my cgo directives:</p>\n\n<pre><code>//PATH\n#cgo LDFLAGS: -L/usr/local/cuda-7.0/lib64 -L/usr/local/cuda-7.0/lib -lcuda -lnvrtc\n#cgo CPPFLAGS: -I/usr/local/cuda-7.0/include/ -I/usr/include/c++/4.8\n\n//FILE\n#include \"saxpy_header.h\"\n#include &lt;nvrtc.h&gt;\n#include \"iostream\"\n#include &lt;cuda.h&gt;\n</code></pre>\n\n<p>But I get this error message:</p>\n\n<pre><code>/usr/include/c++/4.8/iostream:38:28: fatal error: bits/c++config.h: No such file or directory\n#include &lt;bits/c++config.h&gt;\n</code></pre>\n\n<p>So I tried this:</p>\n\n<pre><code>#include \"/usr/include/x86_64-linux-gnu/c++/4.9/bits/c++config.h\"\n</code></pre>\n\n<p>And now I get this new error message:</p>\n\n<pre><code>/usr/include/x86_64-linux-gnu/c++/4.9/bits/c++config.h:430:29: fatal error: bits/os_defines.h: No such file or directory\n#include &lt;bits/os_defines.h&gt;\n</code></pre>\n\n<p>After adding <code>#include \"/usr/include/x86_64-linux-gnu/c++/4.9/bits/os_defines.h\"</code> I get the same error...</p>\n\n<p>How can i solve this problem?</p>\n"}, {"tags": ["css", "go", "build", "revel"], "comments": [{"owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 0, "creation_date": 1442672368, "post_id": 32669256, "comment_id": 53184037, "body": "The reason I haven&#39;t provided any code is I don&#39;t know where it goes."}, {"owner": {"reputation": 8677, "user_id": 2378910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51c5516f058929cbdca03b0319e61bf8?s=128&d=identicon&r=PG", "display_name": "Kenney", "link": "https://stackoverflow.com/users/2378910/kenney"}, "edited": false, "score": 0, "creation_date": 1442672722, "post_id": 32669256, "comment_id": 53184167, "body": "Check out <code>less css</code> or <code>sass</code>"}, {"owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "reply_to_user": {"reputation": 8677, "user_id": 2378910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51c5516f058929cbdca03b0319e61bf8?s=128&d=identicon&r=PG", "display_name": "Kenney", "link": "https://stackoverflow.com/users/2378910/kenney"}, "edited": false, "score": 0, "creation_date": 1442675278, "post_id": 32669256, "comment_id": 53185153, "body": "Thanks for telling me about those frameworks but the question I have is how I can integrate them in to my current build chain. The revel build chain is not clear to me and I would like a clarification of how I can integrate a new tool in the chain."}], "answers": [{"tags": [], "owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "is_accepted": false, "score": 0, "last_activity_date": 1442930052, "creation_date": 1442930052, "answer_id": 32718803, "question_id": 32669256, "link": "https://stackoverflow.com/questions/32669256/concatenating-css-files-in-revel-go-framework/32718803#32718803", "title": "Concatenating css files in revel go framework", "body": "<p>The revel build is pretty hard to hook into. What I have is a separate styles project with its own grunt build file that watches for changes and then packages the css up into the revel public directory.</p>\n\n<p>For grunt see <a href=\"http://gruntjs.com/\" rel=\"nofollow\">http://gruntjs.com/</a></p>\n\n<p>This Gruntfile.js should help, it uses bower and sass :</p>\n\n<pre><code>module.exports = function(grunt) {\n    grunt.initConfig({   \n        watch: {\n            files: ['scss/*.scss'],\n            tasks: ['sass']\n        },\n        bower: {\n            install: {\n                options: {\n                    copy: false\n                }\n            }\n        },\n        sass: {\n            dist: {\n                options: {\n                    style: 'expanded'\n                },\n                files: [\n                    {\n                        expand: true,\n                        cwd: 'scss',\n                        src: ['*.scss'],\n                        dest: '../project/public/css',\n                        ext: '.css'\n                    }\n                ]\n            }\n        }\n    });\n    grunt.loadNpmTasks('grunt-contrib-watch');\n    grunt.loadNpmTasks('grunt-bower-task');\n    grunt.loadNpmTasks('grunt-contrib-sass');\n    grunt.registerTask('default', ['bower', 'sass']);\n};\n</code></pre>\n"}], "owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 145, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1442930052, "creation_date": 1442672345, "question_id": 32669256, "link": "https://stackoverflow.com/questions/32669256/concatenating-css-files-in-revel-go-framework", "title": "Concatenating css files in revel go framework", "body": "<p>I would like to separate my css into component files just as i'm currently separating js files in to components. There seems to be no default support for this concatenating the css files in revel. Is there a simple way to integrate this in the server startup or build process? </p>\n\n<p>I'm looking for a way to create custom \"build/startup\" code that is supported in the framework. I want to make sure I don't invent the wheel again, so to speak.</p>\n"}, {"tags": ["go", "command-line-arguments", "psql"], "answers": [{"tags": [], "owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "is_accepted": true, "score": 1, "last_activity_date": 1442674137, "creation_date": 1442674137, "answer_id": 32669573, "question_id": 32669237, "link": "https://stackoverflow.com/questions/32669237/how-to-pipe-the-output-from-exec-command-into-another-commands-in-golang/32669573#32669573", "title": "how to pipe the output from exec.Command into another commands in Golang", "body": "<p>The <code>exec.Command</code> function only creates the command, it doesn't execute it.  </p>\n\n<p>To get the output from <code>tablesname := exec.Command(\"mdb-tables\", \"-1\", \"myaccessdatabase.mdb\")</code>, you need to run the command and capture its output:</p>\n\n<pre><code>tablesname := exec.Command(\"mdb-tables\", \"-1\", \"myaccessdatabase.mdb\")\n//capture the output pipe of the command\noutputStream := bufio.NewScanner(tablesname.StdoutPipe())\ntablesname.Start()  //Runs the command in the background\n\nfor outputStream.Scan() {   \n//Default scanner is a line-by-line scan, so this will advance to the next line\n    ls := exec.Command(\"mdb-export\", \"-I\", \"postgres\", \"-q\", \"\\'\", \"myaccessdatabase.mdb\", outputStream.Text())\n    ls.Run()  //Blocks until command finishes execution\n\n    visible := exec.Command(\"psql\", \"-d\", \"mypsqldatabase\", \"-U\", \"postgres\", \"-w\", \"-h\", \"localhost\")\n    visible.Run()\n}\n\ntablesname.Wait()  //Cleanup \n</code></pre>\n\n<p>BEWARE:  For database interactions, <code>exec</code> isn't idiomatic code.  </p>\n\n<p>The SQL library allows direct interaction with the database: <a href=\"http://golang.org/pkg/database/sql/\" rel=\"nofollow\">http://golang.org/pkg/database/sql/</a></p>\n"}], "owner": {"reputation": 3, "user_id": 5353782, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207424128699604/picture?type=large", "display_name": "Abdo Ruzaqi", "link": "https://stackoverflow.com/users/5353782/abdo-ruzaqi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1028, "favorite_count": 0, "accepted_answer_id": 32669573, "answer_count": 1, "score": 0, "last_activity_date": 1442674137, "creation_date": 1442672245, "question_id": 32669237, "link": "https://stackoverflow.com/questions/32669237/how-to-pipe-the-output-from-exec-command-into-another-commands-in-golang", "title": "how to pipe the output from exec.Command into another commands in Golang", "body": "<p>I have eight Microsoft access databases each one has around 215 tables and I needed to transfered those databases into postgresql so i used mdb-tools and exported the schemes which just one step ;but when it come to exporting tables data into postgres directly into postgresql i have to write this command for every single table:</p>\n\n<pre><code>mdb-export -I postgres -q \\' myaccessdatabase.mdb table-name | psql -d mypsqldatabase -U postgres -w -h localhost \n</code></pre>\n\n<p>so I have been trying to write a go command program to do as follows:\n1. firstly excute a command to list tables name. which will be the arg of the next command.\n2. then start for range looop to excute a command that export tanle data and the output of this command is pipe into the next command.\n3. this command is psql which will write the output from the previous command ( which is sql insert statment)</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n)\nfunc main() {\n    // command to Collect tables name and list it to the next command \n          tablesname := exec.Command(\"mdb-tables\", \"-1\", \"myaccessdatabase.mdb\")\n\n    // Run the command on each table name and get the output pipe/feed into the psql shell \n    for _, table := range tablesname {\n        ls := exec.Command(\"mdb-export\", \"-I\", \"postgres\", \"-q\", \"\\'\", \"myaccessdatabase.mdb\", table)\n\n        // | psql -d mydatabase -U postgres -w -h localhost command which will write each line from the output of previouse command's \n        visible := exec.Command(\"psql\", \"-d\", \"mypsqldatabase\", \"-U\", \"postgres\", \"-w\", \"-h\", \"localhost\")\n\n\n\n    }\n}\n</code></pre>\n\n<p>So i have tried to pipe the output into the stdin of the next command and couldn't implement it , meanwhile I am trying with goroutin and channels just been unable to even come with a way to make this into the last command.</p>\n\n<p>Thank you very much in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1442676565, "post_id": 32668268, "comment_id": 53185605, "body": "This is a continuation of <a href=\"http://stackoverflow.com/questions/32666182/filling-a-buffered-chan-until-gets-full-or-a-time-duration-passes\" title=\"filling a buffered chan until gets full or a time duration passes\">stackoverflow.com/questions/32666182/&hellip;</a>, should it just have been an addendum/edit to that question rather than a new question? (I had been about to comment on <a href=\"http://stackoverflow.com/a/32666358/55504\">an answer there</a> to point out this exact issue before I noticed this separate question)."}], "answers": [{"tags": [], "owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "is_accepted": true, "score": 3, "last_activity_date": 1442671866, "creation_date": 1442671866, "answer_id": 32669175, "question_id": 32668268, "link": "https://stackoverflow.com/questions/32668268/timing-out-with-time-after-does-not-behave-like-timing-out-with-a-ticker-or-a-ti/32669175#32669175", "title": "timing out with time.After does not behave like timing out with a ticker or a timer", "body": "<p>The problem lies within your code.</p>\n\n<p>In your first example, you are creating <em>one</em> ticker and use that for timing out.<br>\nIn your second example, you create a timer <strong>every time you loop</strong>:</p>\n\n<pre><code>case &lt;-time.After(maxDuration):\n</code></pre>\n\n<p>As can be seen in the <a href=\"http://golang.org/src/time/sleep.go?s=3012:3046#L99\" rel=\"nofollow\">library sources</a>, this is equivalent to</p>\n\n<pre><code>case &lt;- time.NewTimer(maxDuration).C:\n</code></pre>\n\n<p>If you create a new Ticker/Timer every time you loop (and discard the old one), it will probably never fire.</p>\n\n<p>So, to get your second example to behave correctly, do it like this (untested):</p>\n\n<pre><code>func fillChanTimeoutUsingTimeAfter(maxDuration time.Duration, chanSize int) chan string {\n    c := make(chan string, chanSize)\n    t := time.After(maxDuration)\n    for {\n        select {\n        case &lt;-t:\n            fmt.Println(\"time.After:operation timedout\")\n            return c\n        case c &lt;- \"Random message\":\n        default:\n            fmt.Println(\"time.After:chan is full\")\n            return c\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2325, "user_id": 1492051, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/07ecac667abb2bfa8d6698dc629bbb54?s=128&d=identicon&r=PG", "display_name": "FPGA", "link": "https://stackoverflow.com/users/1492051/fpga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 32669175, "answer_count": 1, "score": 0, "last_activity_date": 1442671866, "creation_date": 1442666032, "question_id": 32668268, "link": "https://stackoverflow.com/questions/32668268/timing-out-with-time-after-does-not-behave-like-timing-out-with-a-ticker-or-a-ti", "title": "timing out with time.After does not behave like timing out with a ticker or a timer", "body": "<p>I expect the follwoing to functions to behave the same way</p>\n\n<pre><code>func fillChanTimeoutUsingTicker(maxDuration time.Duration, chanSize int) chan string {\n    c := make(chan string, chanSize)\n    ticker := time.NewTicker(maxDuration)\n    for {\n        select {\n        case &lt;-ticker.C:\n            ticker.Stop()\n            fmt.Println(\"Ticker:operation timedout\")\n            return c\n        case c &lt;- \"Random message\":\n        default:\n            fmt.Println(\"Ticker:chan is full\")\n            return c\n        }\n    }\n}\n\nfunc fillChanTimeoutUsingTimeAfter(maxDuration time.Duration, chanSize int) chan string {\n    c := make(chan string, chanSize)\n    for {\n        select {\n        case &lt;-time.After(maxDuration):\n            fmt.Println(\"time.After:operation timedout\")\n            return c\n        case c &lt;- \"Random message\":\n        default:\n            fmt.Println(\"time.After:chan is full\")\n            return c\n        }\n    }\n}\n</code></pre>\n\n<p>calling them as :</p>\n\n<pre><code>    resWithTicker := fillChanTimeoutUsingTicker(time.Duration(1*time.Microsecond), 10000000)\n    fmt.Println(len(resWithTicker))\n    resWithTimeAfter := fillChanTimeoutUsingTimeAfter(time.Duration(1*time.Microsecond), 10000000)\n    fmt.Println(len(resWithTimeAfter))\n</code></pre>\n\n<p>prints:</p>\n\n<pre><code>Ticker:operation timedout\n43979\ntime.After:chan is full\n10000000\n</code></pre>\n\n<p>i thought that they would behave exactly the same way and i really don't get the huge difference, any thoughts on this?</p>\n\n<p>note also using a timer works as expected like in the ticker function.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5008, "user_id": 2088822, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c96b4e7fa4e410b2df9513f79cffd0fe?s=128&d=identicon&r=PG", "display_name": "afsantos", "link": "https://stackoverflow.com/users/2088822/afsantos"}, "is_accepted": true, "score": 1, "last_activity_date": 1442653619, "creation_date": 1442653619, "answer_id": 32666358, "question_id": 32666182, "link": "https://stackoverflow.com/questions/32666182/filling-a-buffered-chan-until-gets-full-or-a-time-duration-passes/32666358#32666358", "title": "filling a buffered chan until gets full or a time duration passes", "body": "<p>I am no expert in Go (in fact, I've never used it), but the documentation suggests <a href=\"http://golang.org/pkg/time/#Timer\" rel=\"nofollow\"><code>Timer</code></a>, or <a href=\"http://golang.org/pkg/time/#After\" rel=\"nofollow\"><code>After</code></a> for single events.</p>\n\n<pre><code>select {\ncase &lt;-time.After(1*time.Nanosecond):\n    return c\ncase c &lt;- \"Random message\":\ndefault:\n    return c\n}\n</code></pre>\n"}], "owner": {"reputation": 2325, "user_id": 1492051, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/07ecac667abb2bfa8d6698dc629bbb54?s=128&d=identicon&r=PG", "display_name": "FPGA", "link": "https://stackoverflow.com/users/1492051/fpga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 23, "favorite_count": 0, "accepted_answer_id": 32666358, "answer_count": 1, "score": 0, "last_activity_date": 1442653619, "creation_date": 1442652469, "question_id": 32666182, "link": "https://stackoverflow.com/questions/32666182/filling-a-buffered-chan-until-gets-full-or-a-time-duration-passes", "title": "filling a buffered chan until gets full or a time duration passes", "body": "<p>i have a <code>chan string</code> which is buffered, i keep filling it with random strings until a time.Duration passes or until it gets full.</p>\n\n<p>my question is should i use a ticker for that considering that its a one time task or is there a more convienient way?</p>\n\n<p>here is my current way of doing it</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    res := fillChan(time.Duration(1*time.Nanosecond), 100000)\n    fmt.Println(len(res))\n}\n\nfunc fillChan(maxDuration time.Duration, chanSize int) chan string {\n    c := make(chan string, chanSize)\n\n    ticker := time.NewTicker(maxDuration)\n\n    for {\n        select {\n        case &lt;-ticker.C:\n            ticker.Stop()\n            return c\n        case c &lt;- \"Random message\":\n        default:\n            return c\n        }\n    }\n\n}\n</code></pre>\n"}, {"tags": ["algorithm", "go", "binary-search"], "answers": [{"comments": [{"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "reply_to_user": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "edited": false, "score": 0, "creation_date": 1442644868, "post_id": 32664572, "comment_id": 53176214, "body": "@zola : He didn&#39;t formulate it well, but you can see in his code he made some fixes (the same as described in Michael Laszlo&#39;s answer) which make it works"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1442675996, "post_id": 32664572, "comment_id": 53185390, "body": "@mordeus instead of effectively just a link-only answer, you should include the relevant information directly in your answer. In this specific case you should point out what you changed and why. (See the &quot;Provide context for links&quot; part of <a href=\"https://stackoverflow.com/questions/how-to-answer\">How to Answer</a>)."}], "tags": [], "owner": {"reputation": 197, "user_id": 1117899, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tuscq.jpg?s=128&g=1", "display_name": "mortdeus", "link": "https://stackoverflow.com/users/1117899/mortdeus"}, "is_accepted": false, "score": 0, "last_activity_date": 1442640171, "creation_date": 1442640171, "answer_id": 32664572, "question_id": 32664475, "link": "https://stackoverflow.com/questions/32664475/go-recursive-binary-search/32664572#32664572", "title": "Go recursive binary search", "body": "<p><a href=\"http://play.golang.org/p/BbL-y7pJMi\" rel=\"nofollow\">http://play.golang.org/p/BbL-y7pJMi</a></p>\n\n<p>Works fine as far as I can tell. </p>\n"}, {"tags": [], "owner": {"reputation": 11133, "user_id": 4275347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CdbsN.jpg?s=128&g=1", "display_name": "Michael Laszlo", "link": "https://stackoverflow.com/users/4275347/michael-laszlo"}, "is_accepted": true, "score": 5, "last_activity_date": 1442644578, "creation_date": 1442644578, "answer_id": 32665094, "question_id": 32664475, "link": "https://stackoverflow.com/questions/32664475/go-recursive-binary-search/32665094#32665094", "title": "Go recursive binary search", "body": "<p>The logic of your binary search is sound. The only problem is that you've forgotten to assign the result of each recursive call to <code>index</code> and <code>found</code>.</p>\n\n<p>Currently you have these recursive calls:</p>\n\n<pre><code>BinarySearch(data, target, low, mid - 1)\n//...\nBinarySearch(data, target, mid + 1, high)\n</code></pre>\n\n<p>You merely have to assign the results:</p>\n\n<pre><code>index, found = BinarySearch(data, target, low, mid - 1)\n//...\nindex, found = BinarySearch(data, target, mid + 1, high)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4043, "user_id": 8342189, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/f40Rg.jpg?s=128&g=1", "display_name": "Philip Mutua", "link": "https://stackoverflow.com/users/8342189/philip-mutua"}, "is_accepted": false, "score": 1, "last_activity_date": 1534148986, "creation_date": 1534148986, "answer_id": 51818150, "question_id": 32664475, "link": "https://stackoverflow.com/questions/32664475/go-recursive-binary-search/51818150#51818150", "title": "Go recursive binary search", "body": "<h3>Logic for Binary Search</h3>\n\n<ul>\n<li>Target is to search for an item in an array.</li>\n<li>Get the middle item of the array.</li>\n<li>If more than the desired value => First item till the end item.</li>\n<li>If less than the desired value => Middle item till the end item </li>\n<li>Repeat process </li>\n</ul>\n\n<p>We implement this using recursion or a loop.</p>\n\n<h1>Using recursion to make a binary search</h1>\n\n<p>Function will include an array where we will do a search. Then target value is equal to the  value we are searching for.<br>\n<code>lowIndex</code> will indicate the begining of our search.<br>\n<code>highIndex</code> indicates the last position of our search.<br>\nThen the function returns the position of the target value we are searching for.<br>\nThe reason for including the <code>lowIndex</code> and <code>highIndex</code> in the arguments is to search a subset of the array.</p>\n\n<pre><code>func binarySearch(array []int, target int, lowIndex int, highIndex int) int {\n    //specify condition to end the recursion\n    if highIndex &lt; lowIndex {\n        return -1\n    }\n    // Define our middle index \n    mid := int((lowIndex + highIndex) / 2)\n    if array[mid] &gt; target {\n        return binarySearch(array, target, lowIndex,mid)\n    }else if array[mid] &lt; target {\n        return binarySearch(array, target,mid+1,highIndex)\n    }else {\n        return mid \n    }\n}\n</code></pre>\n\n<h1>Using a loop to make a binary search</h1>\n\n<pre><code>func iterbinarySearch(array []int, target int, lowIndex int, highIndex int) int {\n    startIndex := lowIndex\n    endIndex := highIndex\n\n    var mid int\n\n    for startIndex &lt; endIndex {\n        mid = int((lowIndex + highIndex) / 2)\n        if array[mid] &gt; target {\n            return binarySearch(array, target, lowIndex, mid)\n        } else if array[mid] &lt; target {\n            return binarySearch(array, target, mid+1, highIndex)\n        } else {\n            return mid\n        }\n\n    }\n    return -1\n}\n</code></pre>\n"}], "owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 842, "favorite_count": 0, "accepted_answer_id": 32665094, "answer_count": 3, "score": 0, "last_activity_date": 1534148986, "creation_date": 1442639385, "last_edit_date": 1442644679, "question_id": 32664475, "link": "https://stackoverflow.com/questions/32664475/go-recursive-binary-search", "title": "Go recursive binary search", "body": "<p>I know that Go has a <code>sort</code> package that contains search functions, but this is for educational purposes. I've been trying to implement a binary search algorithm in Go but I haven't been able to get it to work.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc BinarySearch(data []int, target int, low int, high int) (index int, found bool)  {\n    mid := (high + low) / 2\n    if low &gt; high {\n       index = -1\n       found = false\n    } else {\n        if target &lt; data[mid] {\n            BinarySearch(data, target, low, mid - 1)\n        } else if target &gt; data[mid] {\n            BinarySearch(data, target, mid + 1, high)\n        } else if target == data[mid] {\n           index = mid\n           found = true\n        } else {\n           index = -1\n           found = false\n        }\n   }\n   return\n}\n\nfunc main() {\n  data := []int {2, 4, 6, 8, 9, 11, 12, 24, 36, 37, 39, 41, 54, 55, 56,}\n  index, found := BinarySearch(data, 8, 0, len(data) - 1)\n  fmt.Println(index, found)\n}\n</code></pre>\n\n<p>It always prints <code>0 false</code>. Why?</p>\n"}, {"tags": ["postgresql", "go", "jsonb"], "comments": [{"owner": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "edited": false, "score": 0, "creation_date": 1442636129, "post_id": 32662478, "comment_id": 53174355, "body": "You&#39;re using &quot;smart quotes&quot;, which will not work. Use a plain text editor, not a word processor, when writing queries. Please also show the <i>exact text</i> of the error message."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "edited": false, "score": 0, "creation_date": 1442660242, "post_id": 32662478, "comment_id": 53180308, "body": "@CraigRinger added the error message. Could you show an example of plain text editor? And why doesn&#39;t smart quotes work?"}, {"owner": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "edited": false, "score": 0, "creation_date": 1442662232, "post_id": 32662478, "comment_id": 53180894, "body": "Apparently that was an artifact of the question editing, and the original text has base ASCII double quotes (<code>&quot;</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1442688025, "post_id": 32671401, "comment_id": 53189388, "body": "Coudl you provide am example of json object with multiple keys as well"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 4, "last_activity_date": 1442688711, "last_edit_date": 1442688711, "creation_date": 1442684823, "answer_id": 32671401, "question_id": 32662478, "link": "https://stackoverflow.com/questions/32662478/golang-sql-package-jsonb-operator/32671401#32671401", "title": "Golang SQL package jsonb operator", "body": "<p>AFAIK, you can't interpolate inside strings, but you can <a href=\"http://www.postgresql.org/docs/9.4/static/functions-json.html\" rel=\"nofollow\">build a JSON object</a> using <code>json_build_object</code> or <code>json_object</code>:</p>\n\n<pre><code>SELECT data FROM test\nWHERE data @&gt; json_build_object('stringdata', $1::text, 'foo', $2::int)::jsonb;\n</code></pre>\n\n<p>This is basically an equivalent of</p>\n\n<pre><code>SELECT data FROM test\nWHERE data @&gt; '{\"stringdata\":\"$1\",\"foo\":$2}';\n</code></pre>\n"}], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 820, "favorite_count": 0, "accepted_answer_id": 32671401, "answer_count": 1, "score": 2, "last_activity_date": 1442688711, "creation_date": 1442618856, "last_edit_date": 1442662108, "question_id": 32662478, "link": "https://stackoverflow.com/questions/32662478/golang-sql-package-jsonb-operator", "title": "Golang SQL package jsonb operator", "body": "<p>In sql package for postgresql jsonb how can I use the <code>@&gt;</code> operator with a string query for example </p>\n\n<ul>\n<li><code>WHERE data @&gt; '{\"stringdata\": $1}'</code> or </li>\n<li><code>WHERE data @&gt; '{\"stringdata\": \"$1\"}'</code> doesn\u2019t work</li>\n</ul>\n\n<p>The alternative is <code>data-&gt;&gt;'string_data' = $1</code> which I don\u2019t prefer for multiple statements</p>\n\n<p>Error is:</p>\n\n<pre><code>    \"Message\": \"invalid input syntax for type json\",\n    \"Detail\": \"Token \\\"$\\\" is invalid.\u201d,\n    \"Where\": \"JSON data, line 1: $...\",\n    \"Routine\": \"report_invalid_token\"\n</code></pre>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1442613010, "post_id": 32660980, "comment_id": 53169437, "body": "See the &quot;Explicit Cancellation&quot; section of <a href=\"https://blog.golang.org/pipelines#TOC_6.\" rel=\"nofollow noreferrer\">The Go Blog: Go Concurrency Patterns: Pipelines and cancellation</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1442614016, "post_id": 32660980, "comment_id": 53169808, "body": "Sending on a closed channel is a programming error. If you need to close a channel, it is generally the sender&#39;s responsibility. Closing a channel isn&#39;t a cleanup operation; you don&#39;t need to close them."}, {"owner": {"reputation": 1345, "user_id": 29442, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11f07822e8b5a23d3c58e3fb4cb57cd6?s=128&d=identicon&r=PG", "display_name": "Hannes Landeholm", "link": "https://stackoverflow.com/users/29442/hannes-landeholm"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442621182, "post_id": 32660980, "comment_id": 53171764, "body": "@JimB: Close() is exactly what is used to clean up a pipeline but is only &quot;allowed&quot; for one direction. See the link by dave-c. With my solution you don&#39;t need a separate done channel to clean up in the other direction."}], "answers": [{"comments": [{"owner": {"reputation": 1345, "user_id": 29442, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11f07822e8b5a23d3c58e3fb4cb57cd6?s=128&d=identicon&r=PG", "display_name": "Hannes Landeholm", "link": "https://stackoverflow.com/users/29442/hannes-landeholm"}, "edited": false, "score": 0, "creation_date": 1442663245, "post_id": 32666245, "comment_id": 53181204, "body": "&quot;This isn&#39;t particularly interesting until you&#39;re attempting to send on a channel that can be closed, as part of a select statement that involves other possible operations.&quot; Good answer. My suggested pattern doesn&#39;t scale to writing on more than one channel. It won&#39;t work if I e.g. want to write and wait for a timeout. It&#39;s worth noting that in an actor based model you generally want more actors though if you want to &quot;do&quot; more than one thing at once."}, {"owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "reply_to_user": {"reputation": 1345, "user_id": 29442, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11f07822e8b5a23d3c58e3fb4cb57cd6?s=128&d=identicon&r=PG", "display_name": "Hannes Landeholm", "link": "https://stackoverflow.com/users/29442/hannes-landeholm"}, "edited": false, "score": 0, "creation_date": 1442705623, "post_id": 32666245, "comment_id": 53193919, "body": "@HannesLandeholm: Yes spot on. And in Go, often the easiest solution is to spin up more goroutines as helpers for complex concurrency situations, just as you might use extra actors in the actor model."}], "tags": [], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "is_accepted": true, "score": 2, "last_activity_date": 1442652906, "creation_date": 1442652906, "answer_id": 32666245, "question_id": 32660980, "link": "https://stackoverflow.com/questions/32660980/is-a-graceful-close-write-concurrency-pattern-acceptable-in-golang/32666245#32666245", "title": "Is a graceful close-write concurrency pattern acceptable in golang?", "body": "<p>Because sending to a closed channel is a program error, your <strong>channel sends to channels that can be closed must be synchronized</strong>. Generally the correct pattern here is to obtain a lock of some kind prior to attempting to send, if the channel can be closed by a third party.</p>\n\n<p>This isn't particularly interesting until you're attempting to send on a channel that can be closed, as part of a <code>select</code> statement that involves other possible operations. In that case, a common pattern is to set channels to <code>nil</code> if operations on them shouldn't, or can't proceed. I have a very complex example of this in the <code>connection.writeOptimizer</code> function in my torrent client <a href=\"https://github.com/anacrolix/torrent/blob/master/connection.go#L493\" rel=\"nofollow\">here</a>.</p>\n\n<p>Note that there is carefully considered ownership of resources involved in the write pipeline in the example, and this is a good way to prevent issues with for example, closing channels. <code>writeOptimizer</code> effectively owns the <code>connection.writeCh</code>, and signals downstream that no further data is coming by closing it. It's also the only goroutine that is sending to that routine, thereby avoiding to having to synchronize writes with the closing of the channel by some other means.</p>\n"}], "owner": {"reputation": 1345, "user_id": 29442, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/11f07822e8b5a23d3c58e3fb4cb57cd6?s=128&d=identicon&r=PG", "display_name": "Hannes Landeholm", "link": "https://stackoverflow.com/users/29442/hannes-landeholm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 417, "favorite_count": 0, "accepted_answer_id": 32666245, "answer_count": 1, "score": 0, "last_activity_date": 1442652906, "creation_date": 1442610094, "question_id": 32660980, "link": "https://stackoverflow.com/questions/32660980/is-a-graceful-close-write-concurrency-pattern-acceptable-in-golang", "title": "Is a graceful close-write concurrency pattern acceptable in golang?", "body": "<p>I've just started using concurrency in go. I have experience from concurrency in other languages and was saddened that go throws a panic if you're trying to write to a closed channel.</p>\n\n<p>This pattern would have been really useful because you can decouple the lifecycle of actors and make them independent. This allows you to not have to synchronize the cleanup of them. Essentially I can let the reader close the channel before shutting down and let an arbitrary number of writers be notified and stop blocking (cancellation) via a write error on the channel.</p>\n\n<p>I therefore wrote a generic function to handle this form of message passing:</p>\n\n<pre><code>/// Sends a message to a remote general channel.\n/// Returns true if the message was sent (the send stopped blocking) or false if\n/// the sender closed the channel.\n/// When the channel is unbuffered, this function returning true means that the\n/// sender has received the message and is acting on it.\nfunc SendRemoteCmd(ch chan interface{}, msg interface{}) bool {\n    defer func() {\n        recover()\n    }()\n    ch &lt;- msg\n    return true\n}\n</code></pre>\n\n<p>It works great, I'm just afraid that golang developers will get angry, call me and tell me they will \"find me\" when they read this code. There is also probably some good reason why the language gods has decided that this should be a panic in the first place. If that is the case, what design do you suggest instead?</p>\n"}, {"tags": ["algorithm", "recursion", "go"], "answers": [{"comments": [{"owner": {"reputation": 6540, "user_id": 983333, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/af2e20bf7ed9b97f26878bda2d9d3288?s=128&d=identicon&r=PG", "display_name": "vinnylinux", "link": "https://stackoverflow.com/users/983333/vinnylinux"}, "edited": false, "score": 0, "creation_date": 1442609054, "post_id": 32660187, "comment_id": 53167885, "body": "What if the &quot;similar&quot; field needs subsets of the Post struct? Like, fewer fields. Instead of referencing, should i create a mapper?"}, {"owner": {"reputation": 11133, "user_id": 4275347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CdbsN.jpg?s=128&g=1", "display_name": "Michael Laszlo", "link": "https://stackoverflow.com/users/4275347/michael-laszlo"}, "reply_to_user": {"reputation": 6540, "user_id": 983333, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/af2e20bf7ed9b97f26878bda2d9d3288?s=128&d=identicon&r=PG", "display_name": "vinnylinux", "link": "https://stackoverflow.com/users/983333/vinnylinux"}, "edited": false, "score": 0, "creation_date": 1442611410, "post_id": 32660187, "comment_id": 53168879, "body": "If the <code>similar</code> data is a list of values, I think you would definitely want to represent the values with a slice. What you put in the slice is up to you. Each element could be a <code>map[string]bool</code>, for example, that stores a set of field names."}], "tags": [], "owner": {"reputation": 11133, "user_id": 4275347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CdbsN.jpg?s=128&g=1", "display_name": "Michael Laszlo", "link": "https://stackoverflow.com/users/4275347/michael-laszlo"}, "is_accepted": true, "score": 1, "last_activity_date": 1442607100, "last_edit_date": 1442607100, "creation_date": 1442606727, "answer_id": 32660187, "question_id": 32659414, "link": "https://stackoverflow.com/questions/32659414/algorithm-for-recursively-linked-objects/32660187#32660187", "title": "Algorithm for recursively linked objects", "body": "<p>The approach you're proposing won't work if there are cycles of <code>similar</code> relationships, which there probably are.</p>\n\n<p>For example, you've shown a post <code>1</code> that is similar to a post <code>2</code>. Let's say you come across post <code>1</code> first. It refers to post <code>2</code>, which isn't in the cache yet, so you push post <code>1</code> back onto the end of the queue. Now you get to post <code>2</code>. It refers to post <code>1</code>, which isn't in the cache yet, so you push post <code>2</code> back onto the end of the queue. This goes on forever.</p>\n\n<p>You can solve this problem by building the post objects in two passes. During the first pass, you make <code>Post</code> objects and fill them with all the information except for the <code>similar</code> references, and you build up a <code>map[int]*Post</code> that maps ID numbers to posts. On the second pass, for each post, you iterate over the <code>similar</code> ID numbers, look up each one in the map, and use the resulting <code>*Post</code> values to fill a <code>[]*Post</code> slice of similar posts.</p>\n"}], "owner": {"reputation": 6540, "user_id": 983333, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/af2e20bf7ed9b97f26878bda2d9d3288?s=128&d=identicon&r=PG", "display_name": "vinnylinux", "link": "https://stackoverflow.com/users/983333/vinnylinux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 32660187, "answer_count": 1, "score": 2, "last_activity_date": 1442607100, "creation_date": 1442603448, "last_edit_date": 1442607025, "question_id": 32659414, "link": "https://stackoverflow.com/questions/32659414/algorithm-for-recursively-linked-objects", "title": "Algorithm for recursively linked objects", "body": "<p>I'm maintaining a small program that goes through documents in a Neo4j database and dumps a JSON-encoded object to a document database. In Neo4j&mdash;for performance reasons, I imagine&mdash;there's no real data, just ID's.</p>\n\n<p>Imagine something like this:</p>\n\n<pre><code>posts:\n    post:\n        id: 1\n        tags: 1, 2\n        author: 2\n        similar: 1, 2, 3\n</code></pre>\n\n<p>I have no idea why it was done like this, but this is what I have to deal with. The program then uses the ID's to fetch information for each data structure, resulting in a proper structure. Instead of <code>author</code> being just an <code>int</code>, it's an <code>Author</code> object, with name, email, and so on.</p>\n\n<p>This worked well until the <code>similar</code> feature was added. <code>Similar</code> consists of ID's referencing other posts. Since in my loop I'm building the actual post objects, how can I reference them in an efficient manner? The only thing I could imagine was creating a cache with the posts I already \"converted\" and, if the referenced ID is not in the cache, put the current post on the bottom of the list. Eventually, they will all be processed.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 2780144, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a93bcfbf0518005fe617e99b27731a1c?s=128&d=identicon&r=PG&f=1", "display_name": "Craig", "link": "https://stackoverflow.com/users/2780144/craig"}, "edited": false, "score": 0, "creation_date": 1442603699, "post_id": 32659315, "comment_id": 53165311, "body": "That&#39;s reasonable.  Problem is that the order of the headers is mostly random so using a numeric index won&#39;t work.  That&#39;s why I was using the response.Headers[&quot;Location&quot;] syntax."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 91, "user_id": 2780144, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a93bcfbf0518005fe617e99b27731a1c?s=128&d=identicon&r=PG&f=1", "display_name": "Craig", "link": "https://stackoverflow.com/users/2780144/craig"}, "edited": false, "score": 0, "creation_date": 1442604422, "post_id": 32659315, "comment_id": 53165718, "body": "@Craig sorry I think you misunderstand. When you use this <code>response.Headers[&quot;Location&quot;]</code> you get an array of values back. So you&#39;re not going to mistakenly get the Content-Type header instead, my example assumes you&#39;ve already done <code>Location = response.Headers[&quot;Location&quot;]</code>, from there it&#39;s inspecting the array and taking the first item, assuming there is exactly one item in the array. The method JimB suggested using is basically doing the same thing for you, only it just returns the first item in the array with key <code>&quot;Location&quot;</code> rather than returning the array then indexing into it."}, {"owner": {"reputation": 91, "user_id": 2780144, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a93bcfbf0518005fe617e99b27731a1c?s=128&d=identicon&r=PG&f=1", "display_name": "Craig", "link": "https://stackoverflow.com/users/2780144/craig"}, "edited": false, "score": 0, "creation_date": 1442606786, "post_id": 32659315, "comment_id": 53166849, "body": "Ahh ok that makes sense.  Thanks for the explanation!"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1442603079, "creation_date": 1442603079, "answer_id": 32659315, "question_id": 32659191, "link": "https://stackoverflow.com/questions/32659191/go-properly-handling-slices-and-strings/32659315#32659315", "title": "go properly handling slices and strings", "body": "<p>The headers have location as an array, you just need to pass <code>Location[0]</code> to that method rather than simply <code>Location</code> because it is a slice. That being said, indexing into the array without checking the bounds is unsafe so you should probably do;</p>\n\n<pre><code>if len(Location) == 1 {\n     logoutRequest(Location[0])\n} else {\n    // error state\n}\n</code></pre>\n\n<p>One last thing to provide you guidance in the future. You can tell that the response headers object has a type more like this; <code>map[string][]string</code> (in reality that maybe []interface{} but I'm not certain from the output) by seeing that each item inside the outer brackets <code>[]</code> has it's values contained within another set of brackets, meaning it is an array that could contain 0 or more values.</p>\n"}, {"comments": [{"owner": {"reputation": 91, "user_id": 2780144, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a93bcfbf0518005fe617e99b27731a1c?s=128&d=identicon&r=PG&f=1", "display_name": "Craig", "link": "https://stackoverflow.com/users/2780144/craig"}, "edited": false, "score": 0, "creation_date": 1442604212, "post_id": 32659361, "comment_id": 53165605, "body": "That&#39;s it!  I never knew that there was a Get method on the response object.  Thanks Much!"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1442604735, "last_edit_date": 1442604735, "creation_date": 1442603254, "answer_id": 32659361, "question_id": 32659191, "link": "https://stackoverflow.com/questions/32659191/go-properly-handling-slices-and-strings/32659361#32659361", "title": "go properly handling slices and strings", "body": "<p>If you want one value, use the <a href=\"http://golang.org/pkg/net/http/#Header.Get\" rel=\"nofollow\">Header's Get method</a></p>\n\n<pre><code>location := response.Header.Get(\"Location\")\n</code></pre>\n\n<p>This also canonicalizes the header name for you, so that you still get a value even when using slightly different capitalization.</p>\n\n<p>You only need to index an <a href=\"http://golang.org/pkg/net/http/#Header\" rel=\"nofollow\"><code>http.Header</code></a> value directly when you need to get more than than the first possible value. If you want all values with a canonicalized header name, you can use <a href=\"http://golang.org/pkg/net/textproto/#CanonicalMIMEHeaderKey\" rel=\"nofollow\"><code>textproto.CanonicalMIMEHeaderKey</code></a></p>\n\n<pre><code>vals := response.Header[textproto.CanonicalMIMEHeaderKey(header)]\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 2780144, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a93bcfbf0518005fe617e99b27731a1c?s=128&d=identicon&r=PG&f=1", "display_name": "Craig", "link": "https://stackoverflow.com/users/2780144/craig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 32659361, "answer_count": 2, "score": 0, "last_activity_date": 1442604735, "creation_date": 1442602648, "question_id": 32659191, "link": "https://stackoverflow.com/questions/32659191/go-properly-handling-slices-and-strings", "title": "go properly handling slices and strings", "body": "<p>I am using goRequest <a href=\"http://parnurzeal.github.io/gorequest/\" rel=\"nofollow\">http://parnurzeal.github.io/gorequest/</a> to make some HTTP requests against a server process I need to talk to.  The authentication process works like this;</p>\n\n<p>send in a GET request with an authentication header set.  No problem there, but I need to grab a header from the response and use a returned value to reauthenticate each following request.</p>\n\n<p>The retuned HTTP header looks like this.</p>\n\n<pre><code>Response headers\nmap[Location:[900767244] Content-Type:[application/xml] Date:[Fri, 18     Sep 2015 18:19:41 GMT] Server:[Apache] X-Frame-Options:[SAMEORIGIN] Set-Cookie:[JSESSIONID=D5C976F5646365FF030DBAD770DA774C; Path=/; Secure; HttpOnly]]\n</code></pre>\n\n<p>I need to get that location value as it's my session token going forward.  If I grap it like this:</p>\n\n<pre><code>session, ok := response.Header[\"Location\"]\nif !ok {\n    fmt.Println(\"Did not receive a location header.\")\n}\n\nfmt.Println(\"Session: \", session)\n</code></pre>\n\n<p>I can get it, but it's a slice and NOT a string.  How can I get that value as a string so I can pop it back into my request headers going forward?  As you can see in the following error:</p>\n\n<pre><code>./login.go:133: cannot use session (type []string) as type string in argument to logoutRequest.Delete\n</code></pre>\n\n<p>Thanks a lot!\nCraig</p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1442617923, "post_id": 32657603, "comment_id": 53170995, "body": "This is just a guess, but since it looks like <code>wsHandler</code> always returns an error, perhaps the message is due to something trying to write out an error response page for you?  If the error reading from the web socket indicates the socket is closed, you should probably return <code>nil</code>."}], "answers": [{"comments": [{"owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "edited": false, "score": 0, "creation_date": 1442663833, "post_id": 32664146, "comment_id": 53181359, "body": "Thank you for the detailed explanation!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1442636378, "creation_date": 1442636378, "answer_id": 32664146, "question_id": 32657603, "link": "https://stackoverflow.com/questions/32657603/why-do-i-get-the-error-message-http-response-write-on-hijacked-connection/32664146#32664146", "title": "Why do I get the error message &quot;http: response.Write on hijacked connection&quot;?", "body": "<p>The <a href=\"http://godoc.org/github.com/gorilla/websocket#Upgrade\" rel=\"nofollow\">websocket.Upgrade</a> function <a href=\"https://github.com/gorilla/websocket/blob/39cd638460acf1c01aaac38effc6e54ee7e04bca/server.go#L134\" rel=\"nofollow\">hijacks the the underlying network connection from the http.ResponseWriter</a>.</p>\n\n<p>The <a href=\"http://godoc.org/net/http#ResponseWriter.Write\" rel=\"nofollow\">ResponseWriter.Write</a> method <a href=\"https://github.com/golang/go/blob/release-branch.go1.5/src/net/http/server.go#L682-L685\" rel=\"nofollow\">logs this message when write is called after the connection is hijacked from the writer</a>.</p>\n\n<p>It looks like the router or middleware used by the application is writing to connection after the websocket handler returns. </p>\n"}], "owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4879, "favorite_count": 0, "accepted_answer_id": 32664146, "answer_count": 1, "score": 1, "last_activity_date": 1442636378, "creation_date": 1442596419, "question_id": 32657603, "link": "https://stackoverflow.com/questions/32657603/why-do-i-get-the-error-message-http-response-write-on-hijacked-connection", "title": "Why do I get the error message &quot;http: response.Write on hijacked connection&quot;?", "body": "<p>I am trying out the gorilla websocket library to get a feel of how websockets work with Go. But I keep getting this error message when I hit refresh button on the browser.</p>\n\n<p>When I reload the web page that I am using to test the websocket, I get these error messages on the Go console:</p>\n\n<pre><code>2015/09/18 19:04:41 websocket: close 1001\n2015/09/18 19:04:41 http: response.Write on hijacked connection\n</code></pre>\n\n<p>The first one is status code for \"going away\". I am assuming it is because when I hit refresh it goes away from the websocket connection so that makes sense to me.</p>\n\n<p>But then I get an error message that I don't understand. The hijacked one. Why do I get it and what does it mean?</p>\n\n<p>I am running my code on localhost:8080 on a windows machine.</p>\n\n<p>The code I am using:</p>\n\n<pre><code>func wsHandler(w http.ResponseWriter, r *http.Request, _ httprouter.Params) error {\n    conn, err := websocket.Upgrade(w, r, nil, 1024, 1024)\n    if err != nil {\n        return err\n    }\n    defer conn.Close()\n\n    for {\n        _, msg, err := conn.ReadMessage()\n        if err != nil {\n            return err\n        }\n        log.Println(string(msg))\n    }\n    return nil\n}\n</code></pre>\n\n<p>Client side:</p>\n\n<pre><code>var conn = new WebSocket(\"ws://localhost:8080/api/messages/websocket\");\n\nconn.onclose = function (e) {\n    console.log(\"onclose fired\");\n};\n\nconn.onopen = function (e) {\n    console.log(\"onopen fired\");\n};\n\nconn.onmessage = function (e) {\n    console.log(e.data);\n};              \n\nsetTimeout(function () {\n    conn.send(\"foo!\");\n}, 1500);\n</code></pre>\n\n<p>When I load the page first time, only <code>foo!</code> is outputted to the console. So all in all, after loading the page once, and then reloading it twice I get an output like this:</p>\n\n<pre><code>2015/09/18 19:04:39 foo!\n2015/09/18 19:04:41 websocket: close 1001\n2015/09/18 19:04:41 http: response.Write on hijacked connection\n2015/09/18 19:04:43 foo!\n2015/09/18 19:04:44 websocket: close 1001\n2015/09/18 19:04:44 http: response.Write on hijacked connection\n2015/09/18 19:04:46 foo!\n</code></pre>\n\n<p>What does this mean? I'm I doing something wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1442592315, "post_id": 32656237, "comment_id": 53159415, "body": "<a href=\"http://tour.golang.org/\" rel=\"nofollow noreferrer\">A Tour of Go</a> is probably a much better way to &quot;learn as you practice&quot;. What you have here seems sort of random, and it&#39;s hard to see what your misunderstanding are."}, {"owner": {"reputation": 333, "user_id": 2022284, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/4be028eba9cf29f4d2714cb3cf9863ad?s=128&d=identicon&r=PG", "display_name": "user2022284", "link": "https://stackoverflow.com/users/2022284/user2022284"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442594201, "post_id": 32656237, "comment_id": 53160369, "body": "@JimB  I am working my way through the tour.  Here, I am simply looking to use multiple values of longitude and latitude for the forecast.Get function above. i can currently use just one."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442594854, "post_id": 32656237, "comment_id": 53160707, "body": "If there was more than one value of <code>p.lat</code> and <code>p.long</code>, how would you access them? The <code>p</code> here is a single <code>Place</code> value. Do you want a list (slice) of <code>Place</code>, a map of strings to lat-long pairs, a map of strings to <code>Place</code>?"}, {"owner": {"reputation": 333, "user_id": 2022284, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/4be028eba9cf29f4d2714cb3cf9863ad?s=128&d=identicon&r=PG", "display_name": "user2022284", "link": "https://stackoverflow.com/users/2022284/user2022284"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442596164, "post_id": 32656237, "comment_id": 53161375, "body": "I was thinking a map of strings to lat-long pairs"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442596498, "post_id": 32656237, "comment_id": 53161546, "body": "Have you tried that? Or try using what you have with <code>map[string]Place</code>."}, {"owner": {"reputation": 333, "user_id": 2022284, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/4be028eba9cf29f4d2714cb3cf9863ad?s=128&d=identicon&r=PG", "display_name": "user2022284", "link": "https://stackoverflow.com/users/2022284/user2022284"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442597579, "post_id": 32656237, "comment_id": 53162062, "body": "tried it but I think my syntax was wrong - hence asking for help here"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1442602975, "post_id": 32656237, "comment_id": 53164903, "body": "Have you tried the code I provided?"}], "answers": [{"comments": [{"owner": {"reputation": 333, "user_id": 2022284, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/4be028eba9cf29f4d2714cb3cf9863ad?s=128&d=identicon&r=PG", "display_name": "user2022284", "link": "https://stackoverflow.com/users/2022284/user2022284"}, "edited": false, "score": 0, "creation_date": 1442603665, "post_id": 32658373, "comment_id": 53165291, "body": "this is great! thank you. certainly a learning experience. Will be great to throw any other examples my way - like using maps. much appreciated."}, {"owner": {"reputation": 333, "user_id": 2022284, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/4be028eba9cf29f4d2714cb3cf9863ad?s=128&d=identicon&r=PG", "display_name": "user2022284", "link": "https://stackoverflow.com/users/2022284/user2022284"}, "edited": false, "score": 0, "creation_date": 1442604722, "post_id": 32658373, "comment_id": 53165872, "body": "works great. advice for a newbie - what is the most efficient way to do this?  The long and lat is being used to pull data from a weather api - the idea is to setup the Go code so it cycles through a list of given long/lat values like we have done.  Step 2 for me will be to decide ( and learn ) if its more efficient to pull the data from the api into a mongodb, then pull the data to the front end from there. One step at a time!"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 333, "user_id": 2022284, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/4be028eba9cf29f4d2714cb3cf9863ad?s=128&d=identicon&r=PG", "display_name": "user2022284", "link": "https://stackoverflow.com/users/2022284/user2022284"}, "edited": false, "score": 0, "creation_date": 1442604929, "post_id": 32658373, "comment_id": 53165961, "body": "@user2022284 I doubt that it will make much of a difference. In either case, the difference of map vs slice vs array will be very small in comparison to other factors like the time it takes the response to arrive from the third party API or the time it takes to deserialize it and do operations on the data. Generally speaking, arrays offer the best performance, but they&#39;re also the most constrained. If you for example know how many entries there will be in the list and you don&#39;t care about their order then an array will likely be the fastest structure. Hope that helps."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 0, "last_activity_date": 1442604249, "last_edit_date": 1442604249, "creation_date": 1442599416, "answer_id": 32658373, "question_id": 32656237, "link": "https://stackoverflow.com/questions/32656237/use-structs-maps-or-something-else/32658373#32658373", "title": "Use structs , maps or something else?", "body": "<p>The <code>Place</code> struct is a single object, it has three properties, a name and lat and long. In order to have more than one you have to instantiate them individually, and commonly, you'd store them in a collection. In Go, the sensible choices would be an array, slice, or map.</p>\n\n<p>Here is an example using a slice. The syntax for array is roughly the same. If you'd like I can provide an example that uses a map after I return from lunch. One other thing to note is that I'm allocating the collection using a syntax referred to as 'composite literal' there are other ways to do this... I could use the <code>append</code> method or more conventional assignment to indexes/keys like <code>myArray[0] = instanceOfPlaceThatIsAlreadyInitialized</code>. </p>\n\n<pre><code>places := []Place{\n        Place{placeName: \"Accra\", lat: \"43.6595\", long: \"-79.3433\"},\n        Place{placeName: \"Kumasi\", lat: \"43.6595\", long: \"-79.3433\"},\n        Place{placeName: \"Tamale\", lat: \"43.6595\", long: \"-79.3433\"},\n    }\n</code></pre>\n\n<p>Extended example; <a href=\"https://play.golang.org/p/EHBgn_I9dA\" rel=\"nofollow\">https://play.golang.org/p/EHBgn_I9dA</a></p>\n\n<p>EDIT: Same thing with a map;</p>\n\n<pre><code>places := map[string]Place{\n        \"Accra\":Place{placeName: \"Accra\", lat: \"43.6595\", long: \"-79.3433\"},\n        \"Kumasi\":Place{placeName: \"Kumasi\", lat: \"43.6595\", long: \"-79.3433\"},\n        \"Tamale\": Place{placeName: \"Tamale\", lat: \"43.6595\", long: \"-79.3433\"},\n    }\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/1A45-Z6k7q\" rel=\"nofollow\">https://play.golang.org/p/1A45-Z6k7q</a></p>\n"}], "owner": {"reputation": 333, "user_id": 2022284, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/4be028eba9cf29f4d2714cb3cf9863ad?s=128&d=identicon&r=PG", "display_name": "user2022284", "link": "https://stackoverflow.com/users/2022284/user2022284"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 32658373, "answer_count": 1, "score": -3, "last_activity_date": 1442604249, "creation_date": 1442591564, "question_id": 32656237, "link": "https://stackoverflow.com/questions/32656237/use-structs-maps-or-something-else", "title": "Use structs , maps or something else?", "body": "<p>I am new to Go ( and programming to an extent), so using a learn as you practice approach.</p>\n\n<p>For the code below ( which pulls weather forecast ), I am looking to populate the longitude and latitude from a list I have.</p>\n\n<p>I am not entirely sure how to setup that list in the first place - use structs and then pipe the value of the stored struct into this code? I tried that and it seems I can only hold one lon/lat pair in a struct. I was thinking of using maps but couldn't figure out how to set it all up. Perhaps, I should store the list of values in a text file and read from there:</p>\n\n<pre><code>p := Place{\n    placeName: \"Accra\", lat: \"43.6595\", long: \"-79.3433\",\n    placeName: \"Kumasi\", lat: \"43.6595\", long: \"-79.3433\",\n    placeName: \"Tamale\", lat: \"43.6595\", long: \"-79.3433\",\n}\n\nf, err := forecast.Get(key, p.lat, p.long, \"now\", forecast.CA)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>the struct looked like this ( I have about 10 separate long/lat values to use)</p>\n\n<pre><code>type Place struct {\n    placeName string\n    lat       string\n    long      string\n}\n</code></pre>\n"}, {"tags": ["javascript", "angularjs", "go"], "comments": [{"owner": {"reputation": 2103, "user_id": 2371073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f34eaab58517f584e646eaf2ef3d2c1f?s=128&d=identicon&r=PG", "display_name": "Joao Polo", "link": "https://stackoverflow.com/users/2371073/joao-polo"}, "edited": false, "score": 0, "creation_date": 1442586628, "post_id": 32654253, "comment_id": 53155554, "body": "You can to force https, and use basic auth. We implement this tech here, and it&#39;s a very efficient manner. (A sample: <a href=\"http://jasonwatmore.com/post/2014/05/26/AngularJS-Basic-HTTP-Authentication-Example.aspx\" rel=\"nofollow noreferrer\">jasonwatmore.com/post/2014/05/26/&hellip;</a> )"}, {"owner": {"reputation": 14511, "user_id": 384417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/966d07471c4adb05fed0e12d31e36584?s=128&d=identicon&r=PG", "display_name": "rewritten", "link": "https://stackoverflow.com/users/384417/rewritten"}, "reply_to_user": {"reputation": 2103, "user_id": 2371073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f34eaab58517f584e646eaf2ef3d2c1f?s=128&d=identicon&r=PG", "display_name": "Joao Polo", "link": "https://stackoverflow.com/users/2371073/joao-polo"}, "edited": false, "score": 0, "creation_date": 1442586744, "post_id": 32654253, "comment_id": 53155635, "body": "@JoaozitoPolo but at some point you need to check the authorization. Whatever method you put in place to do the authroization+file serving, it end up to be some (minimal) application code and then offloading the serving to something more efficient, linke Nginx."}, {"owner": {"reputation": 98901, "user_id": 12030, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dc69af7dd7151a00843602888638fabb?s=128&d=identicon&r=PG", "display_name": "Nick Johnson", "link": "https://stackoverflow.com/users/12030/nick-johnson"}, "edited": false, "score": 1, "creation_date": 1442586931, "post_id": 32654253, "comment_id": 53155797, "body": "&quot;Protect&quot; them from what? What is your threat model?"}, {"owner": {"reputation": 2103, "user_id": 2371073, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f34eaab58517f584e646eaf2ef3d2c1f?s=128&d=identicon&r=PG", "display_name": "Joao Polo", "link": "https://stackoverflow.com/users/2371073/joao-polo"}, "reply_to_user": {"reputation": 14511, "user_id": 384417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/966d07471c4adb05fed0e12d31e36584?s=128&d=identicon&r=PG", "display_name": "rewritten", "link": "https://stackoverflow.com/users/384417/rewritten"}, "edited": false, "score": 0, "creation_date": 1442587020, "post_id": 32654253, "comment_id": 53155858, "body": "@rewritten Here we send on basic auth a token (to identify the user) and the password encoded with sha256. Remember, using https... and then, on server, it&#39;s only a select to validate the user... it&#39;s can be implemented directly on nginx... and the nginx will be the &quot;firewall&quot; for auth, and the back server doesn&#39;t needs any auth rules, if he&#39;s inaccessible externally."}, {"owner": {"reputation": 14511, "user_id": 384417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/966d07471c4adb05fed0e12d31e36584?s=128&d=identicon&r=PG", "display_name": "rewritten", "link": "https://stackoverflow.com/users/384417/rewritten"}, "edited": false, "score": 0, "creation_date": 1442587486, "post_id": 32654253, "comment_id": 53156210, "body": "I&#39;d strongly advise not to do database access from Nginx and VERY STRONGLY advide not to distribute authentication and authorization code in several places. The OP asked for a way to protect admin-related assets, so it&#39;s a matter of authorization (what a specific user <i>can</i> do), so it&#39;s in the realm of their app business logic. What if the definition of &#39;admin&#39; changes? What if it&#39;s not in a SQL database anymore? (LDAP access, or just data stored in a session in a redis instance) You can&#39;t expect that your authorization works for long  if it&#39;s sparse in several seemingly unrelated places."}, {"owner": {"reputation": 14511, "user_id": 384417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/966d07471c4adb05fed0e12d31e36584?s=128&d=identicon&r=PG", "display_name": "rewritten", "link": "https://stackoverflow.com/users/384417/rewritten"}, "reply_to_user": {"reputation": 98901, "user_id": 12030, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dc69af7dd7151a00843602888638fabb?s=128&d=identicon&r=PG", "display_name": "Nick Johnson", "link": "https://stackoverflow.com/users/12030/nick-johnson"}, "edited": false, "score": 0, "creation_date": 1442587520, "post_id": 32654253, "comment_id": 53156236, "body": "@NickJohnson good catch."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "reply_to_user": {"reputation": 98901, "user_id": 12030, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/dc69af7dd7151a00843602888638fabb?s=128&d=identicon&r=PG", "display_name": "Nick Johnson", "link": "https://stackoverflow.com/users/12030/nick-johnson"}, "edited": false, "score": 0, "creation_date": 1442588743, "post_id": 32654253, "comment_id": 53157120, "body": "I don&#39;t use Nginx or Apache. I serve everything solely HTTPS with a strict routing combined with file-serving, custom tailored with a final catchAll, which prevents any directory listing or serving of paths/subpaths that I wouldn&#39;t want to be served. @NickJohnson as I stated it&#39;s not really to &quot;protect&quot;, but more to not have them open by default. So only the select few that have credentials to get into the admin-environment get the files served. This is more a convenience question than one of security."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1442803826, "post_id": 32654253, "comment_id": 53217722, "body": "Wrap the admin static handler with some auth middleware that checks for a Bearer Token in the Authorization header, else returns a 401. You should, however, operate under the model that the static assets may be accessed: relying on them to be protected is not a good plan."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "edited": false, "score": 0, "creation_date": 1442588912, "post_id": 32654458, "comment_id": 53157234, "body": "I don&#39;t use any standard technology and, as stated in my comment in my question, serve everything myself. This means I can easily achieve filtering out the paths that I want to not be serve-able to unauthorized users. I&#39;m just curious how other people approached this and what would be pros and cons of different solutions. I was indeed thinking of just bouncing 401&#39;s on non-authorized users that still try to access these paths. Maybe even just 404, but it might not be the most pretty one."}, {"owner": {"reputation": 14511, "user_id": 384417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/966d07471c4adb05fed0e12d31e36584?s=128&d=identicon&r=PG", "display_name": "rewritten", "link": "https://stackoverflow.com/users/384417/rewritten"}, "edited": false, "score": 0, "creation_date": 1442590580, "post_id": 32654458, "comment_id": 53158265, "body": "I understand that your application serves HTTP directly (as in fact most web apps do). In any case (even if it&#39;s off topic) i&#39;d always put a reverse proxy in front of anything written by myself, just in case; as an example, with a reverse proxy you han handle downtime much more gracefully. And if some work can be offloaded to it, much better!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "edited": false, "score": 0, "creation_date": 1442590826, "post_id": 32654458, "comment_id": 53158447, "body": "Thanks for your collaboration @rewritten I&#39;ll take that into consideration :)"}], "tags": [], "owner": {"reputation": 14511, "user_id": 384417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/966d07471c4adb05fed0e12d31e36584?s=128&d=identicon&r=PG", "display_name": "rewritten", "link": "https://stackoverflow.com/users/384417/rewritten"}, "is_accepted": true, "score": 3, "last_activity_date": 1442586330, "creation_date": 1442586330, "answer_id": 32654458, "question_id": 32654253, "link": "https://stackoverflow.com/questions/32654253/protecting-back-end-angular-source-files/32654458#32654458", "title": "Protecting &quot;back-end&quot; angular source files", "body": "<p>If you need a valid (and preferably authorized) session to get some static assets (being them JS code, stylesheets, images...), you need to pass through the application, the stack you use is not relevant at all.</p>\n\n<p>What I'd do is to point the resource to something controlled by your application, and then return either a 401 or an empty response with a <code>X-Sendfile</code> or <code>X-Accel-Redirect</code> header so the actual serving is offloaded to whatever reverse proxy you have in place.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 32654458, "answer_count": 1, "score": 0, "last_activity_date": 1442586330, "creation_date": 1442585772, "question_id": 32654253, "link": "https://stackoverflow.com/questions/32654253/protecting-back-end-angular-source-files", "title": "Protecting &quot;back-end&quot; angular source files", "body": "<p>I have a Angular system that solely talks with my Go back-end and with Gorilla I take care of my sessions for login.</p>\n\n<p>I started working on my admin environment, but I wondered what would be best practice for protecting the angular code for it. It's not really a problem for security because even the admin code will just have logic, and not dangerous data, still I prefer to not have it open to just anyone in the world.</p>\n\n<p>I was thinking of doing the following;</p>\n\n<p>I have a <code>mux</code> router that catches all my resource calls (deployment with Yeoman) and I was wondering that I would make 3 exceptions there for <code>images/admin</code>, <code>scripts/admin</code> and <code>styles/admin</code>. These paths can then only be served if you have a valid session active. Otherwise throwing a 401 header.</p>\n\n<p>Would this be a good solution or is there a more efficient way to achieve this?</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1442583303, "post_id": 32653109, "comment_id": 53153297, "body": "Use <code>reflect.TypeOf</code> and call <code>Name()</code> on the result."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1442825252, "last_edit_date": 1442825252, "creation_date": 1442584735, "answer_id": 32653923, "question_id": 32653109, "link": "https://stackoverflow.com/questions/32653109/how-to-print-type-of-array-items-in-go/32653923#32653923", "title": "How to print type of array items in Go?", "body": "<p>You are printing the types of the slices, not the types of the elements. And types of the slices are <code>[]interface{}</code>. That's why you see that.</p>\n\n<p>If you want to see the dynamic types of the elements (their static type is always <code>interface{}</code>), then print the types of the elements:</p>\n\n<pre><code>fmt.Printf(\"Expected element type: %T, got: %T\", expected[0], actual[0])\n</code></pre>\n\n<p>Which will output:</p>\n\n<pre><code>Expected element type: int, got: float64\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p>The above code assumes you are comparing 2 slices with 1 element. If you don't want to check slice length and you want to handle slices with any length, you can use other verbs. For example you can use the <code>%t</code> verb which expects a <code>bool</code> value and wants to print <code>true</code> or <code>false</code>. Note that this is just an implementation decision and not guaranteed, but using <code>%t</code> for example will print all the slice elements; printing the respective <code>bool</code> value if it is of type <code>bool</code>, and will print the dynamic type and value of the element if the it is not of type <code>bool</code>.</p>\n\n<p>Example:</p>\n\n<pre><code>data := []interface{}{1, float64(2), \"3\", time.Now()}\nfmt.Printf(\"%t\", data)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[%!t(int=1) %!t(float64=2) %!t(string=3)\n    {%!t(int64=63393490800) %!t(int32=0) %!t(*time.Location=&amp;{ [] [] 0 0 &lt;nil&gt;})}]\n</code></pre>\n\n<p>It's a bit ugly, but contains many useful info (e.g. types, values).</p>\n"}], "owner": {"reputation": 1508, "user_id": 1473140, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4e5523fa2c0d564764f3144815f8943d?s=128&d=identicon&r=PG", "display_name": "Sergey Kamardin", "link": "https://stackoverflow.com/users/1473140/sergey-kamardin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "accepted_answer_id": 32653923, "answer_count": 1, "score": 1, "last_activity_date": 1442825252, "creation_date": 1442582473, "question_id": 32653109, "link": "https://stackoverflow.com/questions/32653109/how-to-print-type-of-array-items-in-go", "title": "How to print type of array items in Go?", "body": "<p>When I try to unit test some code, I have some assertion like this:</p>\n\n<pre><code>expected := []interface{}{1}\nactual := []interface{}{float64(1)}\n\nif !reflect.DeepEqual(expected, actual); {\n    t.Errorf(\"Expected &lt;%T&gt; %#v to equal &lt;%T&gt; %#v\", actual, actual, expected, expected);\n}\n</code></pre>\n\n<p>And got this output:</p>\n\n<pre><code>Expected &lt;[]interface {}&gt; []interface {}{1} to equal &lt;[]interface {}&gt; []interface {}{1}\n</code></pre>\n\n<p>How can I print this message to be more explicit? </p>\n\n<p>Thanks!</p>\n\n<a href=\"http://play.golang.org/p/JigknXTcdx\" rel=\"nofollow\">see this code in play.golang.org</a>\n"}, {"tags": ["algorithm", "performance", "go"], "comments": [{"owner": {"reputation": 7450, "user_id": 657700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb044bd9a9f6548b9a9bae44617c97c7?s=128&d=identicon&r=PG", "display_name": "fjardon", "link": "https://stackoverflow.com/users/657700/fjardon"}, "edited": false, "score": 0, "creation_date": 1442582737, "post_id": 32653087, "comment_id": 53152902, "body": "<code>My code works but timeouts for the largest possible input</code>, so it doesn&#39;t work. Because the time limit is part of the problem: <code>My code works but it predicts tonight&#39;s weather tomorrow</code> is not a working code."}, {"owner": {"reputation": 35, "user_id": 4575956, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oJ3J2.png?s=128&g=1", "display_name": "pippo", "link": "https://stackoverflow.com/users/4575956/pippo"}, "reply_to_user": {"reputation": 7450, "user_id": 657700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb044bd9a9f6548b9a9bae44617c97c7?s=128&d=identicon&r=PG", "display_name": "fjardon", "link": "https://stackoverflow.com/users/657700/fjardon"}, "edited": false, "score": 0, "creation_date": 1442583216, "post_id": 32653087, "comment_id": 53153234, "body": "Thank you for your constructive feedback, I&#39;ve edited my text."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1442583437, "post_id": 32653087, "comment_id": 53153377, "body": "Maybe you need a different algorithm than just straightforward element by element comparison?"}, {"owner": {"reputation": 51521, "user_id": 2566198, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Y34ZA.jpg?s=128&g=1", "display_name": "Sobrique", "link": "https://stackoverflow.com/users/2566198/sobrique"}, "edited": false, "score": 2, "creation_date": 1442583739, "post_id": 32653087, "comment_id": 53153604, "body": "I&#39;m sure there&#39;s a case study on variable naming for code clarity here somewhere. But that aside - a brute force approach is usually the least efficient way of tackling a problem - one obvious such optimisation is read the small matrix first, and then <i>as you are processing</i> the large matrix, you can quickly discard any that don&#39;t contain the first row of the small matrix. (If you find that, then you will need to retain the next few lines)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1442585048, "post_id": 32653087, "comment_id": 53154525, "body": "I&#39;m voting to close this question as off-topic because it belongs to <a href=\"http://codereview.stackexchange.com/\">codereview.stackexchange.com</a>."}, {"owner": {"reputation": 6867, "user_id": 1707931, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/d3e0e7837e92db4a04348d6be77c9ff7?s=128&d=identicon&r=PG", "display_name": "Matthias Kauer", "link": "https://stackoverflow.com/users/1707931/matthias-kauer"}, "edited": false, "score": 0, "creation_date": 1447478383, "post_id": 32653087, "comment_id": 55182935, "body": "My guess is that your break statements aren&#39;t canceling early enough. I have solved this in C++ with a brute force approach, using a subroutine <code>find_brute_force_inner</code> that makes canceling early more clear for me. I&#39;d be surprised if Go was so much slower here. Have you found out more on this in the meantime?"}], "answers": [{"tags": [], "owner": {"reputation": 762, "user_id": 3472617, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3e8c66b132b669a637eb98980c1bc8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Amr", "link": "https://stackoverflow.com/users/3472617/amr"}, "is_accepted": false, "score": 2, "last_activity_date": 1442583913, "creation_date": 1442583913, "answer_id": 32653639, "question_id": 32653087, "link": "https://stackoverflow.com/questions/32653087/golang-code-too-slow-for-hackerrank/32653639#32653639", "title": "Golang code too slow for Hackerrank", "body": "<p>Well I am gonna point out an idea to you and then you can try to implement it. So create a new 2d array as large as your large array. Call it sumArray. Now let each cell in this sumArray represent the sum where the current cell is the most bottom-left cell. Now what you do is check only the cells that has the same sum as your small array instead of checking every element in the array.\n<br></p>\n\n<p>So if those are your inputs</p>\n\n<pre><code>1 1 1 1 1 1     \n1 1 1 1 1 1\n1 1 1 1 1 1\n1 1 1 1 1 1\n1 1 1 0 1 1\n\n1 1 1\n1 1 1\n1 1 0\n</code></pre>\n\n<p>First sum your small array --> 8</p>\n\n<p>Now let me show you how your sum array would look like</p>\n\n<pre><code>-1 -1 -1 -1 -1 -1     -1 means that we can't sum at this point because\n-1 -1 -1 -1 -1 -1      the dimensions are just smaller than your small array\n-1 -1  9  9  9  9      each other cell represent the sum of your original \n 9  9  9  9  9  9      matrix values.\n 9  9  9  8  9  9\n</code></pre>\n\n<p>Now if you scan trough this array only you can see that you will reduce your search space from every possible position to only the position where your sum is equal. This doesn't guarantee that the array are in this position you still have to add a verification step but it reduce your search space.</p>\n"}], "owner": {"reputation": 35, "user_id": 4575956, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oJ3J2.png?s=128&g=1", "display_name": "pippo", "link": "https://stackoverflow.com/users/4575956/pippo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1755, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1442583913, "creation_date": 1442582424, "last_edit_date": 1442583093, "question_id": 32653087, "link": "https://stackoverflow.com/questions/32653087/golang-code-too-slow-for-hackerrank", "title": "Golang code too slow for Hackerrank", "body": "<p>I've been trying to solve this Hackerrank challenge: <a href=\"https://www.hackerrank.com/challenges/the-grid-search\" rel=\"nofollow\">Link</a></p>\n\n<p>This is what you have to do:</p>\n\n<p>You have one large matrix:</p>\n\n<pre><code>1 1 1 1 1 1\n1 1 1 1 1 1\n1 1 1 1 1 1\n1 1 1 1 1 1\n1 1 1 0 1 1\n</code></pre>\n\n<p>and one small matrix:</p>\n\n<pre><code>1 1 1\n1 1 1\n1 1 0\n</code></pre>\n\n<p>You have to find out if the small matrix is present in the large matrix.</p>\n\n<p>There are up to 5 testcases and each matrix can be of max 1000x1000 size and I need to solve this in under 4 seconds.</p>\n\n<p>My code timeouts for the largest possible input, I thought that maybe how I'm scanning the matrix is too slow.</p>\n\n<p>This is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    var t, rL, cL, rS, cS, temp int\n    var s string\n    var sl []string\n    var mxL, mxS [][]int\n    var found bool\n    fmt.Scanf(\"%d\", &amp;t)\n    for ; t &gt; 0; t-- {\n        // Start scanning input\n        // Scanning large matrix\n        fmt.Scanf(\"%d%d\", &amp;rL, &amp;cL)\n        mxL = make([][]int, rL)\n        for i := range mxL {\n            mxL[i] = make([]int, cL)\n        }\n        for i := 0; i &lt; rL; i++ {\n            fmt.Scanf(\"%s\", &amp;s)\n            sl = strings.Split(s, \"\")\n            for j, v := range sl {\n                temp, _ = strconv.Atoi(v)\n                mxL[i][j] = temp\n            }\n        }\n        // Scanning small matrix\n        fmt.Scanf(\"%d%d\", &amp;rS, &amp;cS)\n        mxS = make([][]int, rS)\n        for i := range mxS {\n            mxS[i] = make([]int, cS)\n        }\n        for i := 0; i &lt; rS; i++ {\n            fmt.Scanf(\"%s\", &amp;s)\n            sl = strings.Split(s, \"\")\n            for j, v := range sl {\n                temp, _ = strconv.Atoi(v)\n                mxS[i][j] = temp\n            }\n        }\n        // Stop scanning input\n        // Start searching for small matrix in large matrix\n        found = true\n        for iL := 0; iL &lt;= rL-rS; iL++ {\n            for jL := 0; jL &lt;= cL-cS; jL++ {\n                found = true\n                if mxL[iL][jL] == mxS[0][0] {\n                    for iS := 0; iS &lt; rS; iS++ {\n                        for jS := 1; jS &lt; cS; jS++ {\n                            if mxS[iS][jS] != mxL[iS+iL][jS+jL] {\n                                found = false\n                                break\n                            }\n                        }\n                        if !found {\n                            break\n                        }\n                    }\n                    if found {\n                        break\n                    }\n                } else {\n                    found = false\n                }\n            }\n            if found {\n                fmt.Println(\"YES\")\n                break\n            }\n        }\n        if !found {\n            fmt.Println(\"NO\")\n        }\n        // Stop searching for small matrix in large matrix\n    }\n}\n</code></pre>\n\n<p>I'm using a slice of slices of ints to store the input.</p>\n\n<p><code>mxL</code> is the large matrix and <code>mxS</code> is the small matrix.</p>\n\n<p><code>rL</code> and <code>cL</code> stand for row and column of the large matrix.</p>\n\n<p><code>rS</code> and <code>cS</code> stand for row and column of the small matrix.</p>\n"}, {"tags": ["mongodb", "go", "mgo", "database"], "answers": [{"comments": [{"owner": {"reputation": 661, "user_id": 1680568, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/RkIg1.png?s=128&g=1", "display_name": "William Yang", "link": "https://stackoverflow.com/users/1680568/william-yang"}, "edited": false, "score": 0, "creation_date": 1442610522, "post_id": 32659543, "comment_id": 53168540, "body": "Hmm.... this works, but say, resp := bson.M{}  \t\t\tdatabase.C(&quot;schools&quot;).Pipe(pipeline).One(&amp;resp)  \t\t\tI could only read resp[&quot;dept_list&quot;] and not resp[&quot;dept_list&quot;][&quot;crse_list&quot;] because (type interface {} does not support indexing). I know there are ways to turn bson.M into an array and then index it from there, but I searched everywhere and haven&#39;t found something that works just yet."}, {"owner": {"reputation": 18455, "user_id": 2657550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88d553accfca32636d96a8d5075e85d1?s=128&d=identicon&r=PG", "display_name": "Gustavo Niemeyer", "link": "https://stackoverflow.com/users/2657550/gustavo-niemeyer"}, "reply_to_user": {"reputation": 661, "user_id": 1680568, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/RkIg1.png?s=128&g=1", "display_name": "William Yang", "link": "https://stackoverflow.com/users/1680568/william-yang"}, "edited": false, "score": 1, "creation_date": 1442843627, "post_id": 32659543, "comment_id": 53237200, "body": "Have a look at Go documentation. Search for type assertions."}, {"owner": {"reputation": 661, "user_id": 1680568, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/RkIg1.png?s=128&g=1", "display_name": "William Yang", "link": "https://stackoverflow.com/users/1680568/william-yang"}, "edited": false, "score": 0, "creation_date": 1442854106, "post_id": 32659543, "comment_id": 53244020, "body": "Excellent! I read the documentation and made it work using pipelines. But after reading the mongo docs a while I think material paths / ancestry is the way to go for implementing nested multi-level relationships."}], "tags": [], "owner": {"reputation": 18455, "user_id": 2657550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88d553accfca32636d96a8d5075e85d1?s=128&d=identicon&r=PG", "display_name": "Gustavo Niemeyer", "link": "https://stackoverflow.com/users/2657550/gustavo-niemeyer"}, "is_accepted": true, "score": 2, "last_activity_date": 1442604015, "creation_date": 1442604015, "answer_id": 32659543, "question_id": 32652182, "link": "https://stackoverflow.com/questions/32652182/mgo-how-to-find-nested-document-inside-nested-arrays/32659543#32659543", "title": "Mgo how to find nested document inside nested arrays?", "body": "<p>You can chain the Select statements, but the value of the second call will override the value of the first call, rather than doing what the example implies it does, which is to dive deeper into the nested structure.</p>\n\n<p>To achieve what apparently you are trying to do, you may use the aggregation framework to manipulate these nested objects in arbitrary ways.</p>\n\n<p>For example, this is a simple pipeline that would pull out the exact matching courses:</p>\n\n<pre><code>    pipeline := []bson.M{\n            {\"$match\": bson.M{\"school_name\": school}},\n            {\"$unwind\": \"$dept_list\"},\n            {\"$unwind\": \"$dept_list.crse_list\"},\n            {\"$match\": bson.M{\n                     \"dept_list.dept_name\": dept,\n                     \"dept_list.crse_list.crse_name\": crse,\n            }},\n    }\n    iter := coll.Pipe(pipeline).Iter()\n</code></pre>\n\n<p>You can use the resulting iterator the same way you use iterators from Find.</p>\n\n<p>For this pipeline, the resulting objects will look like:</p>\n\n<pre><code>    bson.M{\n            \"_id\":\"...\",\n            \"dept_list\": bson.M{\n                    \"dept_name\": \"Department A\",   \n                    \"crse_list\": bson.M{\n                            \"crse_name\": \"Class B\",\n                    }\n            },\n            \"school_name\":\"School ABC\",\n    }\n</code></pre>\n\n<p>You can change the shape of the resulting object in arbitrary ways, though. Have a look at the <a href=\"http://docs.mongodb.org/manual/core/aggregation-introduction/\" rel=\"nofollow\">aggregation framework</a> documentation for more details.</p>\n"}, {"tags": [], "owner": {"reputation": 661, "user_id": 1680568, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/RkIg1.png?s=128&g=1", "display_name": "William Yang", "link": "https://stackoverflow.com/users/1680568/william-yang"}, "is_accepted": false, "score": 0, "last_activity_date": 1442854447, "creation_date": 1442854447, "answer_id": 32700631, "question_id": 32652182, "link": "https://stackoverflow.com/questions/32652182/mgo-how-to-find-nested-document-inside-nested-arrays/32700631#32700631", "title": "Mgo how to find nested document inside nested arrays?", "body": "<p>After reading the mongo docs I think the preferred way to do nested relationship is to use tree structures with materialized paths as described <a href=\"http://docs.mongodb.org/manual/tutorial/model-tree-structures-with-materialized-paths/\" rel=\"nofollow\">here</a> on mongo.</p>\n\n<p>Also available are trees of <a href=\"http://docs.mongodb.org/manual/tutorial/model-tree-structures-with-ancestors-array/\" rel=\"nofollow\">array of ancestors</a> and <a href=\"http://docs.mongodb.org/manual/tutorial/model-tree-structures-with-parent-references/\" rel=\"nofollow\">parent / child references</a>. Take a look.</p>\n\n<p>It seems using trees is simpler, more elegant, and saves a lot of technical hassle.</p>\n"}], "owner": {"reputation": 661, "user_id": 1680568, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/RkIg1.png?s=128&g=1", "display_name": "William Yang", "link": "https://stackoverflow.com/users/1680568/william-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3090, "favorite_count": 2, "accepted_answer_id": 32659543, "answer_count": 2, "score": 2, "last_activity_date": 1501405855, "creation_date": 1442579710, "last_edit_date": 1506103077, "question_id": 32652182, "link": "https://stackoverflow.com/questions/32652182/mgo-how-to-find-nested-document-inside-nested-arrays", "title": "Mgo how to find nested document inside nested arrays?", "body": "<p>Here below I have document structure designed as follows:</p>\n\n<pre><code>type MIS_Course struct {\n    ID   bson.ObjectId `bson:\"_id,omitempty\"`\n    Name string        `bson:\"crse_name\"`\n}\n\ntype MIS_Department struct {\n    ID      bson.ObjectId `bson:\"_id,omitempty\"`\n    Name    string        `bson:\"dept_name\"`\n    Courses []MIS_Course  `bson:\"crse_list\"`\n}\n\ntype MIS_School struct {\n    ID          bson.ObjectId    `bson:\"_id,omitempty\"`\n    Name        string           `bson:\"school_name\"`\n    Departments []MIS_Department `bson:\"dept_list\"`\n}\n</code></pre>\n\n<p>And when initialized, I would have a \"School ABC\" in a sea of schools containing something that looks like below:</p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"55fbb522022aae7b3a000003\"),\n    \"school_name\" : \"School ABC\",\n    \"dept_list\" : [\n        {\n            \"dept_name\" : \"Department A\",\n            \"crse_list\" : [\n                {\n                    \"crse_name\" : \"Class A\"\n                },\n                {\n                    \"crse_name\" : \"Class B\"\n                },\n            ]\n        }\n    ]\n}\n</code></pre>\n\n<p>For hours on end I couldn't find a solution that effectively works by given the school_name, dept_name, and crse_name:</p>\n\n<p>Find the <code>dept_list</code> of <code>school_name</code> > find the <code>crse_list</code> of <code>dept_name</code> > find <code>crse_name</code></p>\n\n<p>The reason that such chain of finds are required is because the scope of the find should be limited to the school, and then the department. Logic and housekeeping happens after the each stages of finds. </p>\n\n<p>I tried code such as</p>\n\n<pre><code>result := MIS_School{}\n\nerr := database.C(\"schools\").Find(bson.M{\"school_name\": school}).Select(\nbson.M{\"dept_list\": bson.M{\"$elemMatch\": bson.M{\"dept_name\": dept}}}).Select(\nbson.M{\"crse_list\": bson.M{\"$elemMatch\": bson.M{\"crse_name\": crse}}}).One(&amp;result)\n</code></pre>\n\n<p>But it didn't work since Select projections can't be chained in Mgo(?)</p>\n\n<p>I have read from somewhere that mongodb doesn't have the capability to directly retrieve documents nested in arrays deeper than 1-2 levels (Getting Document C inside B array inside A array). Is that true? How could I work around this problem?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 1, "creation_date": 1442579730, "post_id": 32651999, "comment_id": 53150911, "body": "I can&#39;t reproduce your problem (after correcting the missing <code>http.</code> in your code as @ainar-g notes). How are you testing this?"}, {"owner": {"reputation": 2325, "user_id": 1492051, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/07ecac667abb2bfa8d6698dc629bbb54?s=128&d=identicon&r=PG", "display_name": "FPGA", "link": "https://stackoverflow.com/users/1492051/fpga"}, "reply_to_user": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1442579875, "post_id": 32651999, "comment_id": 53151012, "body": "@RobNapier by print statement saying cnnection closed after &lt;-notify, the http. part fixed the problem thanks a lot"}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 3, "last_activity_date": 1442579586, "creation_date": 1442579586, "answer_id": 32652143, "question_id": 32651999, "link": "https://stackoverflow.com/questions/32651999/closenotifier-for-http-responsewriter/32652143#32652143", "title": "CloseNotifier for http ResponseWriter", "body": "<p><code>http.CloseNotifier</code> has been there since <a href=\"http://golang.org/doc/go1.1\" rel=\"nofollow\">Go 1.1</a>. Your code doesn't work because you forgot the package part:</p>\n\n<pre><code>notify := w.(http.CloseNotifier).CloseNotify()\n</code></pre>\n"}], "owner": {"reputation": 2325, "user_id": 1492051, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/07ecac667abb2bfa8d6698dc629bbb54?s=128&d=identicon&r=PG", "display_name": "FPGA", "link": "https://stackoverflow.com/users/1492051/fpga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1126, "favorite_count": 0, "accepted_answer_id": 32652143, "answer_count": 1, "score": 0, "last_activity_date": 1442579586, "creation_date": 1442579087, "question_id": 32651999, "link": "https://stackoverflow.com/questions/32651999/closenotifier-for-http-responsewriter", "title": "CloseNotifier for http ResponseWriter", "body": "<p>i am using go 1.4.2 and the implementation doesn't seem to have <code>CloseNotifier</code> as i want to use it in a long polling handler with something like:</p>\n\n<pre><code>func Pollhandler(w http.ResponseWriter, r *http.Request) {\n\n    notify := w.(CloseNotifier).CloseNotify()\n\n    &lt;-notify //should block until the http connection is closed\n\n}\n</code></pre>\n\n<p>is the CloseNotifier not implemented for the http <code>ResponseWriter</code>? if so how can i get around this? or is there any implementation for http <code>ResponseWriter</code> that implements the <code>CloseNotifier</code> interface?</p>\n"}, {"tags": ["go", "concurrency"], "answers": [{"comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 3, "creation_date": 1442837306, "post_id": 32655919, "comment_id": 53232616, "body": "This is not historically complete and somewhat misrepresents Hoare&#39;s work."}], "tags": [], "owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "is_accepted": false, "score": 6, "last_activity_date": 1442944510, "last_edit_date": 1442944510, "creation_date": 1442590569, "answer_id": 32655919, "question_id": 32651557, "link": "https://stackoverflow.com/questions/32651557/golang-main-difference-from-csp-language-by-hoare/32655919#32655919", "title": "Golang main difference from CSP-Language by Hoare", "body": "<p>That's exactly the point: in the example language used in Hoare's initial paper (and also in Erlang), process A talks directly to process B, while in Go, goroutine A talks to channel C and goroutine B listens to channel C. I.e. in Go the channels are <em>explicit</em> while in Hoare's language and Erlang, they are <em>implicit</em>.</p>\n\n<p>See <a href=\"http://www.informit.com/articles/printerfriendly/1768317\" rel=\"noreferrer\">this article</a> for more info.</p>\n"}, {"comments": [{"owner": {"reputation": 13885, "user_id": 1509695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/04a3ca8cd41bf8e170b901072fcc667f?s=128&d=identicon&r=PG", "display_name": "matanster", "link": "https://stackoverflow.com/users/1509695/matanster"}, "edited": false, "score": 0, "creation_date": 1474301325, "post_id": 32696464, "comment_id": 66464912, "body": "Didn&#39;t get it about Java&#39;s mistake :)"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "reply_to_user": {"reputation": 13885, "user_id": 1509695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/04a3ca8cd41bf8e170b901072fcc667f?s=128&d=identicon&r=PG", "display_name": "matanster", "link": "https://stackoverflow.com/users/1509695/matanster"}, "edited": false, "score": 0, "creation_date": 1474411522, "post_id": 32696464, "comment_id": 66518090, "body": "In Hoare&#39;s Monitors, a thread can be put to sleep. When it wakes, it is in the <i>same state</i>; time has passed but nothing impairs its ability to carry on. In Java though, a thread will awake in a different state: it&#39;s now at the back of the run queue. This is dealt with using a <b>while</b> instead of <b>if</b>, but Welch&#39;s example shows how it can cause pathological behaviour that, in his example, results in starvation of one or more threads."}, {"owner": {"reputation": 6143, "user_id": 2147218, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JQVSl.jpg?s=128&g=1", "display_name": "bazza", "link": "https://stackoverflow.com/users/2147218/bazza"}, "edited": false, "score": 0, "creation_date": 1592690592, "post_id": 32696464, "comment_id": 110517093, "body": "One of the things I&#39;m very interested in is Rust&#39;s version of CSP. With Rust&#39;s knowledge of memory ownership and mutability it has the opportunity to implement CSP by passing ownership down channels, instead of data, and still be CSP. That could make it pretty fast, and with consistent transmission times. I remember in the old days on Transputers that channels between chips were a lot slower than internal channel, which was always a nuissance when load balancing a real time system... It is very nice to see CSP making a return in popular languages!"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1592848611, "post_id": 32696464, "comment_id": 110566332, "body": "That&#39;s a really good parallel. In is theoretical form, CSP channels are about events. The exchange of data via channels can have different implementations so passing data by copying or by using references, pointers or ownership seems equally valid to me."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1618999955, "post_id": 32696464, "comment_id": 118770451, "body": "I wrote <a href=\"https://pkg.go.dev/github.com/rickb777/process\" rel=\"nofollow noreferrer\">pkg.go.dev/github.com/rickb777/process</a> to model CSP processes better in Go. All it does is handle the join when a group of goroutines terminate"}], "tags": [], "owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "is_accepted": true, "score": 34, "last_activity_date": 1442841936, "creation_date": 1442841936, "answer_id": 32696464, "question_id": 32651557, "link": "https://stackoverflow.com/questions/32651557/golang-main-difference-from-csp-language-by-hoare/32696464#32696464", "title": "Golang main difference from CSP-Language by Hoare", "body": "<p>The answer requires a fuller understanding of Hoare's work on CSP. The progression of his work can be summarised in three stages:</p>\n\n<ul>\n<li><p>based on Dijkstra's semaphore's, Hoare developed <em>monitors</em>. These are as used in Java, except Java's implementation contains a mistake (see Welch's article <a href=\"http://www.cs.kent.ac.uk/projects/ofa/java-threads/0.html\" rel=\"noreferrer\">Wot No Chickens</a>). It's unfortunate that Java ignored Hoare's later work.</p></li>\n<li><p>CSP grew out of this. Initially, CSP required direct exchange from process A to process B. This rendezvous approach is used by Ada and Erlang.</p></li>\n<li><p>CSP was completed by 1985, when <a href=\"http://www.usingcsp.com/cspbook.pdf\" rel=\"noreferrer\">his Book</a> was first published. This final version of CSP includes channels as used in Go. Along with Hoare's team at Oxford, David May concurrently developed <em>Occam</em>, a language deliberately intended to blend CSP into a practical programming language. CSP and Occam influenced each other (for example in <a href=\"https://www.cs.ox.ac.uk/files/3376/PRG53.pdf\" rel=\"noreferrer\"><em>The Laws of Occam Programming</em></a>). For years, Occam was only available on the Transputer processor, which had its architecture tailored to suit CSP. More recently, <a href=\"http://www.cs.kent.ac.uk/projects/ofa/kroc/\" rel=\"noreferrer\">Occam has developed</a> to target other processors and has also absorbed Pi calculus, along with other general synchronisation primitives.</p></li>\n</ul>\n\n<p>So, to answer the original question, it is probably helpful to compare Go with both CSP and Occam.</p>\n\n<ol>\n<li><p>Channels: CSP, Go and Occam all have the same semantics for channels. In addition, Go makes it easy to add buffering into channels (Occam does not).</p></li>\n<li><p>Choices: CSP defines both the <em>internal</em> and <em>external</em> choice. However, both Go and Occam have a single kind of selection: <em>select</em> in Go and <em>ALT</em> in Occam. The fact that there are two kinds of CSP choice proved to be less important in practical languages.</p></li>\n<li><p>Occam's <em>ALT</em> allows condition guards, but Go's <em>select</em> does not (there is a workaround: channel aliases can be set to <em>nil</em> to imitate the same behaviour).</p></li>\n<li><p>Mobility: Go allows channel ends to be sent (along with other data) via channels. This creates a dynamically-changing topology and goes beyond what is possible in CSP, but Milner's Pi calculus was developed (out of his CCS) to describe such networks.</p></li>\n<li><p>Processes: A goroutine is a forked process; it terminates when it wants to and it doesn't have a parent. This is less like CSP / Occam, in which processes are compositional.</p></li>\n</ol>\n\n<p>An example will help here: firstly Occam (n.b. indentation matters)</p>\n\n<pre><code>SEQ\n  PAR\n    processA()\n    processB()\n  processC()\n</code></pre>\n\n<p>and secondly Go</p>\n\n<pre><code>go processA()\ngo processB()\nprocessC()\n</code></pre>\n\n<p>In the Occam case, processC doesn't start until both processA and processB have terminated. In Go, processA and processB fork very quickly, then processC runs straightaway.</p>\n\n<ol start=\"6\">\n<li><p>Shared data: CSP is not really concerned with data directly. But it is interesting to note there is an important difference between Go and Occam concerning shared data. When multiple goroutines share a common set of data variables, race conditions are possible; Go's excellent race detector helps to eliminate problems. But Occam takes a different stance: shared mutable data is prevented at compilation time.</p></li>\n<li><p>Aliases: related to the above, Go allows many pointers to refer to each data item. Such aliases are disallowed in Occam, so reducing the effort needed to detect race conditions.</p></li>\n</ol>\n\n<p>The latter two points are less about Hoare's CSP and more about May's Occam. But they are relevant because they directly concern safe concurrent coding.</p>\n"}, {"tags": [], "owner": {"reputation": 716, "user_id": 924272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077b810c7cc7deae3d83850675c0e86f?s=128&d=identicon&r=PG", "display_name": "user924272", "link": "https://stackoverflow.com/users/924272/user924272"}, "is_accepted": false, "score": 0, "last_activity_date": 1592688772, "creation_date": 1592688772, "answer_id": 62491946, "question_id": 32651557, "link": "https://stackoverflow.com/questions/32651557/golang-main-difference-from-csp-language-by-hoare/62491946#62491946", "title": "Golang main difference from CSP-Language by Hoare", "body": "<p>Recently, I've been working quite intensively with Go's channels, and have been working with concurrency and parallelism for many years, although I could never profess to know everything about this.</p>\n<p>I think what you're asking is what's the subtle difference between sending a message to a channel and sending directly to each other?  If I understand you, the quick answer is simple.</p>\n<p>Sending to a Channel give the opportunity for parallelism / concurrency on both sides of the channel.  Beautiful, and scalable.</p>\n<p>We live in a concurrent world.   Sending a long continuous stream of messages from A to B (asynchronously) means that B will need to process the messages at pretty much the same pace as A sends them, unless more than one instance of B has the opportunity to process a message taken from the channel, hence sharing the workload.</p>\n<p>The good thing about channels is that that you can have a number of producer/receiver go-routines which are able to push messages to the queue, or consume from the queue and process it accordingly.</p>\n<p>If you think linearly, like a single-core CPU, concurrency is basically like having a million jobs to do.  Knowing a single-core CPU can only do one thing at a time, and yet also see that it gives the illusion that lots of things are happening at the same time. When executing some code, the time the OS needs to wait a while for something to come back from the network, disk, keyboard, mouse, etc, or even some process which sleeps for a while, give the OS the opportunity to do something else in the meantime.   This all happens extremely quickly, creating the illusion of parallelism.</p>\n<p>Parallelism on the other hand is different in that the job can be run on a completely different CPU independent of what's going with other CPUs, and therefore doesn't run under the same constraints as the other CPU (although most OS's do a pretty good job at ensuring workloads are evenly distributed to run across all of it's CPUs - with perhaps the exception of CPU-hungry, uncooperative non-os-yielding-code, but even then the OS tames them.</p>\n<p>The point is, having multi-core CPUs means more parallelism and more concurrency can occur.</p>\n<p>Imagine a single queue at a bank which fans-out to a number of tellers who can help you. If no customers are being served by any teller, one teller elects to handle the next customer and becomes busy, until they all become busy.   Whenever a customer walks away from a teller, that teller is able to handle the next customer in the queue.</p>\n"}], "owner": {"reputation": 7731, "user_id": 1614378, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/lOzxR.png?s=128&g=1", "display_name": "dieter", "link": "https://stackoverflow.com/users/1614378/dieter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5663, "favorite_count": 15, "accepted_answer_id": 32696464, "answer_count": 3, "score": 21, "last_activity_date": 1592688772, "creation_date": 1442577663, "last_edit_date": 1445855267, "question_id": 32651557, "link": "https://stackoverflow.com/questions/32651557/golang-main-difference-from-csp-language-by-hoare", "title": "Golang main difference from CSP-Language by Hoare", "body": "<p>Look at this statement taken from <a href=\"https://godoc.org/github.com/thomas11/csp\">The examples from Tony Hoare's seminal 1978 paper</a>:</p>\n\n<blockquote>\n  <p>Go's design was strongly influenced by Hoare's paper. Although Go differs significantly from the example language used in the paper, the examples still translate rather easily. The biggest difference apart from syntax is that Go models the conduits of concurrent communication explicitly as channels, while the processes of Hoare's language send messages directly to each other, similar to Erlang. Hoare hints at this possibility in section 7.3, but with the limitation that \"each port is connected to exactly one other port in another process\", in which case it would be a mostly syntactic difference. </p>\n</blockquote>\n\n<p>I'm confused.</p>\n\n<p>Processes in Hoare's language communicate directly to each other. Go routines communicate also directly to each other but using channels.</p>\n\n<p>So what impact has the limitation in golang. What is the real difference?</p>\n"}, {"tags": ["reflection", "go"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 3628256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99bb5f77bbe7da810ca334f7c14c2647?s=128&d=identicon&r=PG&f=1", "display_name": "hitsu", "link": "https://stackoverflow.com/users/3628256/hitsu"}, "edited": false, "score": 0, "creation_date": 1442712129, "post_id": 32651478, "comment_id": 53195129, "body": "&gt; m := &amp;Method1{record: &quot;bar&quot;}     I need to create instance from methodName, because it shoud work when mehtodName is &quot;Method2&quot;."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 3, "user_id": 3628256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99bb5f77bbe7da810ca334f7c14c2647?s=128&d=identicon&r=PG&f=1", "display_name": "hitsu", "link": "https://stackoverflow.com/users/3628256/hitsu"}, "edited": false, "score": 0, "creation_date": 1442737693, "post_id": 32651478, "comment_id": 53199581, "body": "An instance of what? You <a href=\"http://stackoverflow.com/questions/23030884/is-there-a-way-to-create-an-instance-of-a-struct-from-a-string\">can&#39;t just instantiate types from strings</a>."}, {"owner": {"reputation": 3, "user_id": 3628256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99bb5f77bbe7da810ca334f7c14c2647?s=128&d=identicon&r=PG&f=1", "display_name": "hitsu", "link": "https://stackoverflow.com/users/3628256/hitsu"}, "edited": false, "score": 0, "creation_date": 1453993522, "post_id": 32651478, "comment_id": 57852898, "body": "I see. My question is same as the link. Thank you for giving reference."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 0, "last_activity_date": 1442577421, "creation_date": 1442577421, "answer_id": 32651478, "question_id": 32649870, "link": "https://stackoverflow.com/questions/32649870/golang-how-can-i-use-refect-package-with-exsisting-library/32651478#32651478", "title": "Golang: How can I use refect package with exsisting library", "body": "<p>You need to get <code>reflect.Value</code>s of client and method values with <code>reflect.ValueOf</code> and then use <code>reflect.Value.Call</code>:</p>\n\n<pre><code>methodName := \"Method1\"\n\nc := &amp;Client{id: \"foo\"}\nm := &amp;Method1{record: \"bar\"}\n\nargs := []reflect.Value{reflect.ValueOf(m)}\nreflect.ValueOf(c).MethodByName(methodName).Call(args)\nfmt.Printf(\"%s record is %s\", methodName, m.record)\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/PT33dqj9Q9\" rel=\"nofollow\">http://play.golang.org/p/PT33dqj9Q9</a>.</p>\n"}], "owner": {"reputation": 3, "user_id": 3628256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99bb5f77bbe7da810ca334f7c14c2647?s=128&d=identicon&r=PG&f=1", "display_name": "hitsu", "link": "https://stackoverflow.com/users/3628256/hitsu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 32651478, "answer_count": 1, "score": 0, "last_activity_date": 1442577421, "creation_date": 1442572449, "last_edit_date": 1442577169, "question_id": 32649870, "link": "https://stackoverflow.com/questions/32649870/golang-how-can-i-use-refect-package-with-exsisting-library", "title": "Golang: How can I use refect package with exsisting library", "body": "<p>I want to call a function in a existing library from function name.</p>\n\n<p>In golang, just calling method from methodname is OK, because reflect package has (v Value) MethodByName(name string).\nBut, for calling a method, all method argument should be reflect.Value.</p>\n\n<p>How can I call a function whose argument are not reflect.Value.</p>\n\n<pre><code>package main\n\n//-------------------------------\n// Example of existing library\n//-------------------------------\ntype Client struct {\n    id string\n}\n\ntype Method1 struct {\n    record string\n}\n\n// type Method2 struct{}\n// ...\n\n// defined at library : do not change\nfunc (c *Client) Method1(d *Method1) {\n    d.record = c.id\n}\n\n//------------------\n// Edit from here\n//------------------\nfunc main() {\n    // give MethodN from cmd line\n    method_name := \"Method1\"\n\n    // How can I call Method1(* Method1) propery???\n    // * Make Method1 instance\n    // * Call Method1 function\n    //...\n    //fmt.Printf(\"%s record is %s\", method_name, d.record)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/6B6-90GTwc\" rel=\"nofollow\">http://play.golang.org/p/6B6-90GTwc</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4395, "user_id": 442219, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TKAbI.jpg?s=128&g=1", "display_name": "tothemario", "link": "https://stackoverflow.com/users/442219/tothemario"}, "edited": false, "score": 7, "creation_date": 1490036603, "post_id": 32650077, "comment_id": 72922942, "body": "In go 1.8, the GOPATH env var is optional. What if the user doesn&#39;t have it? Is there a way to get the default one? I think the go runtime should have a way to get the gopath, letting Go itself figure it out for you."}, {"owner": {"reputation": 1125, "user_id": 1698309, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cDGnK.png?s=128&g=1", "display_name": "tmh", "link": "https://stackoverflow.com/users/1698309/tmh"}, "reply_to_user": {"reputation": 4395, "user_id": 442219, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TKAbI.jpg?s=128&g=1", "display_name": "tothemario", "link": "https://stackoverflow.com/users/442219/tothemario"}, "edited": false, "score": 0, "creation_date": 1490539045, "post_id": 32650077, "comment_id": 73145835, "body": "@tothemario I posted an answer how you could get the valid <code>GOPATH</code> since Go 1.8. However, I agree that ideally the runtime should provide a way of obtaining the user&#39;s <code>GOPATH</code>."}, {"owner": {"reputation": 6282, "user_id": 625540, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/r279R.jpg?s=128&g=1", "display_name": "codefreak", "link": "https://stackoverflow.com/users/625540/codefreak"}, "reply_to_user": {"reputation": 4395, "user_id": 442219, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TKAbI.jpg?s=128&g=1", "display_name": "tothemario", "link": "https://stackoverflow.com/users/442219/tothemario"}, "edited": false, "score": 1, "creation_date": 1490626166, "post_id": 32650077, "comment_id": 73183561, "body": "@tothemario updated answer using code from Go 1.8&#39;s default go path implementation."}, {"owner": {"reputation": 4580, "user_id": 262748, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O0oj4.png?s=128&g=1", "display_name": "Benny Jobigan", "link": "https://stackoverflow.com/users/262748/benny-jobigan"}, "edited": false, "score": 1, "creation_date": 1508520711, "post_id": 32650077, "comment_id": 80656116, "body": "don&#39;t forget that GOPATH could have multiple paths listed and separated by the os&#39;s path delimiter."}], "tags": [], "owner": {"reputation": 6282, "user_id": 625540, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/r279R.jpg?s=128&g=1", "display_name": "codefreak", "link": "https://stackoverflow.com/users/625540/codefreak"}, "is_accepted": true, "score": 22, "last_activity_date": 1515015924, "last_edit_date": 1515015924, "creation_date": 1442573154, "answer_id": 32650077, "question_id": 32649770, "link": "https://stackoverflow.com/questions/32649770/how-to-get-current-gopath-from-code/32650077#32650077", "title": "How to get current GOPATH from code", "body": "<p>Use <a href=\"https://golang.org/pkg/os/#Getenv\" rel=\"noreferrer\">os.Getenv</a></p>\n\n<p>From docs:</p>\n\n<blockquote>\n  <p>Getenv retrieves the value of the environment variable named by the\n  key. It returns the value, which will be empty if the variable is not\n  present.</p>\n</blockquote>\n\n<p>Example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    )\n\nfunc main() {\n    fmt.Println(os.Getenv(\"GOPATH\"))\n}\n</code></pre>\n\n<p><strong>Update for Go 1.8+</strong></p>\n\n<p>Go 1.8 has default GOPATH exported via go/build:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"go/build\"\n    \"os\"\n)\n\nfunc main() {\n    gopath := os.Getenv(\"GOPATH\")\n    if gopath == \"\" {\n        gopath = build.Default.GOPATH\n    }\n    fmt.Println(gopath)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6282, "user_id": 625540, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/r279R.jpg?s=128&g=1", "display_name": "codefreak", "link": "https://stackoverflow.com/users/625540/codefreak"}, "edited": false, "score": 1, "creation_date": 1490626345, "post_id": 43030083, "comment_id": 73183686, "body": "It&#39;s a bit of overkill. We can use code from Go&#39;s own source code to get default go path. See <a href=\"https://github.com/golang/go/blob/go1.8/src/go/build/build.go#L260-L277\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/go1.8/src/go/build/build.go#L260-L&zwnj;&#8203;277</a>"}, {"owner": {"reputation": 1125, "user_id": 1698309, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cDGnK.png?s=128&g=1", "display_name": "tmh", "link": "https://stackoverflow.com/users/1698309/tmh"}, "reply_to_user": {"reputation": 6282, "user_id": 625540, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/r279R.jpg?s=128&g=1", "display_name": "codefreak", "link": "https://stackoverflow.com/users/625540/codefreak"}, "edited": false, "score": 0, "creation_date": 1490644442, "post_id": 43030083, "comment_id": 73195125, "body": "@codefreak There are certainly simpler ways and your answer is valid, too. What I like about <code>go-homedir</code> is that when in doubt, it tries multiple ways of finding the home directory, and if all fails, it actually returns an error. So users of this code can return a meaningful error message. If you just return an empty string, users must check if it&#39;s empty. Should they neglect that, this might lead to unexpected behavior or weird errors in some edge cases."}, {"owner": {"reputation": 6282, "user_id": 625540, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/r279R.jpg?s=128&g=1", "display_name": "codefreak", "link": "https://stackoverflow.com/users/625540/codefreak"}, "edited": false, "score": 1, "creation_date": 1490646325, "post_id": 43030083, "comment_id": 73196143, "body": "Point of question is to find GOPATH, not home dir. go-homedir is great for finding home dir. But if Go itself uses defaultGOPATH function, what&#39;s the point of taking care of edge cases which Go build code itself doesn&#39;t take care of. Anyways let&#39;s let users decide what they like the most :)"}], "tags": [], "owner": {"reputation": 1125, "user_id": 1698309, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cDGnK.png?s=128&g=1", "display_name": "tmh", "link": "https://stackoverflow.com/users/1698309/tmh"}, "is_accepted": false, "score": 0, "last_activity_date": 1490538935, "creation_date": 1490538935, "answer_id": 43030083, "question_id": 32649770, "link": "https://stackoverflow.com/questions/32649770/how-to-get-current-gopath-from-code/43030083#43030083", "title": "How to get current GOPATH from code", "body": "<p>Since Go 1.8, there is a <a href=\"https://golang.org/doc/code.html#GOPATH\" rel=\"nofollow noreferrer\">default <code>GOPATH</code></a>:</p>\n\n<blockquote>\n  <p>The <code>GOPATH</code> environment variable specifies the location of your\n  workspace. It defaults to a directory named go inside your home\n  directory, so <code>$HOME/go</code> on Unix, <code>$home/go</code> on Plan 9, and\n  <code>%USERPROFILE%\\go</code> (usually <code>C:\\Users\\YourName\\go</code>) on Windows.</p>\n</blockquote>\n\n<p>This means the <code>GOPATH</code> environment variable is not necessarily set to anything in particular.</p>\n\n<p>You can still use <code>os.Getenv</code> to get the value, but in case it is not set you need to make sure that you use the the plattform-specific default value instead, for example using <a href=\"https://github.com/mitchellh/go-homedir\" rel=\"nofollow noreferrer\">mitchellh/go-homedir</a>:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"log\"\n        \"os\"\n\n        \"github.com/mitchellh/go-homedir\"\n)\n\nfunc main() {\n        p, err := gopath()\n        if err != nil {\n                log.Fatalf(\"Error finding GOPATH: %v\", err)\n        }\n\n        fmt.Println(p)\n}\n\nfunc gopath() (string, error) {\n        s := os.Getenv(\"GOPATH\")\n        if s != \"\" {\n                return s, nil\n        }\n        return homedir.Expand(\"~/go\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 111, "user_id": 5148945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c17846551ab7943456c1187824ef0d94?s=128&d=identicon&r=PG&f=1", "display_name": "rhysd", "link": "https://stackoverflow.com/users/5148945/rhysd"}, "is_accepted": false, "score": 11, "last_activity_date": 1495991417, "creation_date": 1495991417, "answer_id": 44229943, "question_id": 32649770, "link": "https://stackoverflow.com/questions/32649770/how-to-get-current-gopath-from-code/44229943#44229943", "title": "How to get current GOPATH from code", "body": "<p>You should use <a href=\"https://golang.org/pkg/go/build/\" rel=\"noreferrer\">go/build</a> package.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"go/build\"\n)\n\nfunc main() {\n    fmt.Println(build.Default.GOPATH)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4580, "user_id": 262748, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O0oj4.png?s=128&g=1", "display_name": "Benny Jobigan", "link": "https://stackoverflow.com/users/262748/benny-jobigan"}, "is_accepted": false, "score": 1, "last_activity_date": 1508522855, "creation_date": 1508522855, "answer_id": 46854882, "question_id": 32649770, "link": "https://stackoverflow.com/questions/32649770/how-to-get-current-gopath-from-code/46854882#46854882", "title": "How to get current GOPATH from code", "body": "<p>I was messing with this today for something I am working on, and it was more annoying than I'd have expected. In the end, this seemed to work for me in the various tests I did on it (not 'rigorous' tests).</p>\n\n<pre><code>goPath := strings.Split(os.Getenv(\"GOPATH\"), string(os.PathListSeparator))\nif len(goPath) == 0 {\n    goPath = append(goPath, build.Default.GOPATH)\n} else if goPath[0] == \"\" {\n    goPath[0] = build.Default.GOPATH\n}\n</code></pre>\n\n<p>Note that I decided to use only the 1st path if multiple paths are listed on GOPATH, as I suspect few will have more than 1 path listed, and the first would be where <code>go get</code> puts the source (I guess). This code also does not account for if the paths are valid or not.</p>\n\n<p>Also note that to build a file path after getting the GOPATH, I had to use <code>path/filepath.Join()</code> not <code>path.Join()</code>. The former will use \\ on windows if the first arg contains \\, and / for others. Although windows can accept / for paths apparently, all of my PATH and GOPATH-like environmental variables are written with the normal \\ of windows. <code>path.Join()</code> used /, producing an invalid path.</p>\n"}], "owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14868, "favorite_count": 2, "accepted_answer_id": 32650077, "answer_count": 4, "score": 18, "last_activity_date": 1515015924, "creation_date": 1442572160, "question_id": 32649770, "link": "https://stackoverflow.com/questions/32649770/how-to-get-current-gopath-from-code", "title": "How to get current GOPATH from code", "body": "<p>How do I get the current <code>GOPATH</code> from a block of code?</p>\n\n<p><code>runtime</code> only has <code>GOROOT</code>:</p>\n\n<pre><code>// GOROOT returns the root of the Go tree.\n// It uses the GOROOT environment variable, if set,\n// or else the root used during the Go build.\nfunc GOROOT() string {\n    s := gogetenv(\"GOROOT\")\n    if s != \"\" {\n        return s\n    }\n    return defaultGoroot\n}\n</code></pre>\n\n<p>I could make a function that has <code>GOROOT</code> replaced with <code>GOPATH</code>, but is there a buildin for this?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "edited": false, "score": 0, "creation_date": 1442571490, "post_id": 32649404, "comment_id": 53145971, "body": "Thanks! What if I do loadbalancing with multiple servers? How would I solve the issue of saving gorilla websocket connections so that all servers would be able to access it?"}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "reply_to_user": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "edited": false, "score": 0, "creation_date": 1442571825, "post_id": 32649404, "comment_id": 53146190, "body": "@Aiden you&#39;d have to serialise connections. I don&#39;t think that&#39;s possible. You&#39;d have to rethink your design"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1442803872, "post_id": 32649404, "comment_id": 53217731, "body": "One approach being sticky sessions."}], "tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": true, "score": 1, "last_activity_date": 1442571014, "last_edit_date": 1492086988, "creation_date": 1442571014, "answer_id": 32649404, "question_id": 32649346, "link": "https://stackoverflow.com/questions/32649346/gorilla-websocket-connections-when-running-multiple-instances-of-the-go-applicat/32649404#32649404", "title": "Gorilla websocket connections when running multiple instances of the Go application", "body": "<p>First of all, those aren't processes but threads, so they will indeed share the same global state. <a href=\"https://unix.stackexchange.com/questions/10362/why-does-htop-show-more-process-than-ps\">htop shows threads as if they were processes</a>.</p>\n\n<p>Whenever you need concurrent access to a map, you need to synchronise it. You can indeed do this with a mutex.</p>\n"}], "owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 476, "favorite_count": 0, "accepted_answer_id": 32649404, "answer_count": 1, "score": 0, "last_activity_date": 1442571014, "creation_date": 1442570811, "question_id": 32649346, "link": "https://stackoverflow.com/questions/32649346/gorilla-websocket-connections-when-running-multiple-instances-of-the-go-applicat", "title": "Gorilla websocket connections when running multiple instances of the Go application", "body": "<p>To save Gorilla websocket connections I could something like this where the key could be a userId.</p>\n\n<pre><code>connections := make(map[int]*connection)\n</code></pre>\n\n<p>I am using something called supervisord</p>\n\n<p><a href=\"http://supervisord.org/\" rel=\"nofollow noreferrer\">http://supervisord.org/</a></p>\n\n<p>which is a process control system so that I am able to run the go application\nin the background as a daemon. It looks like several instances are being spawned up.</p>\n\n<p><a href=\"https://i.stack.imgur.com/a57wl.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/a57wl.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>Does those instances know how to access the same connections variable if I make it global?</p>\n\n<pre><code>var connections map[int]*connection\n</code></pre>\n\n<p>Or will there be an issue?</p>\n\n<p>Also since map is not thread safe, should I create a struct and add <code>sync.RWMutex</code> and do RLock()/Lock() and RUnlock()/Unlock() before checking whether a key exists or when removing a key from the map?</p>\n"}, {"tags": ["rest", "google-app-engine", "go", "video-streaming", "google-cloud-storage"], "comments": [{"owner": {"reputation": 59, "user_id": 2266449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d29b1e96d9b7ccf1c070cc14f1dd16a?s=128&d=identicon&r=PG", "display_name": "user2266449", "link": "https://stackoverflow.com/users/2266449/user2266449"}, "edited": false, "score": 0, "creation_date": 1442566831, "post_id": 32644953, "comment_id": 53143183, "body": "<a href=\"https://cloud.google.com/storage/docs/access-control?hl=en\" rel=\"nofollow noreferrer\">cloud.google.com/storage/docs/access-control?hl=en</a> and look up &quot;signed URLS&quot;"}, {"owner": {"reputation": 59, "user_id": 2266449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d29b1e96d9b7ccf1c070cc14f1dd16a?s=128&d=identicon&r=PG", "display_name": "user2266449", "link": "https://stackoverflow.com/users/2266449/user2266449"}, "edited": false, "score": 1, "creation_date": 1442566848, "post_id": 32644953, "comment_id": 53143192, "body": "Ask just one question at a time please."}, {"owner": {"reputation": 720, "user_id": 1752124, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f37430e935542dafdc7f86c6e9fa03e4?s=128&d=identicon&r=PG", "display_name": "ravi", "link": "https://stackoverflow.com/users/1752124/ravi"}, "reply_to_user": {"reputation": 59, "user_id": 2266449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d29b1e96d9b7ccf1c070cc14f1dd16a?s=128&d=identicon&r=PG", "display_name": "user2266449", "link": "https://stackoverflow.com/users/2266449/user2266449"}, "edited": false, "score": 0, "creation_date": 1442822537, "post_id": 32644953, "comment_id": 53223892, "body": "Well! I am a naive. I thought that asking &quot;Whats your name?&quot; and &quot;Where do you live?&quot; together makes sense. Thanks for your bit."}], "answers": [{"comments": [{"owner": {"reputation": 720, "user_id": 1752124, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f37430e935542dafdc7f86c6e9fa03e4?s=128&d=identicon&r=PG", "display_name": "ravi", "link": "https://stackoverflow.com/users/1752124/ravi"}, "edited": false, "score": 0, "creation_date": 1442822422, "post_id": 32662746, "comment_id": 53223830, "body": "Thanks for the answer. I am a beginner in web programming, so confused at some bits. I am going to try this and will update."}], "tags": [], "owner": {"reputation": 32859, "user_id": 81491, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fa2d855b58c41269f0876b99eac9607d?s=128&d=identicon&r=PG", "display_name": "Brandon Yarbrough", "link": "https://stackoverflow.com/users/81491/brandon-yarbrough"}, "is_accepted": false, "score": 1, "last_activity_date": 1442621009, "creation_date": 1442621009, "answer_id": 32662746, "question_id": 32644953, "link": "https://stackoverflow.com/questions/32644953/storing-streaming-videos-and-handling-requests-using-rest-apis/32662746#32662746", "title": "Storing, Streaming videos and handling requests using REST APIs", "body": "<p>For question 1 (how to enable customers to upload objects), signed URLs are a good bet.</p>\n\n<p>Question 2 is a lot bigger. Depending on your needs you could simply point clients to GCS video files, but modern media serving is a bit more advanced than that. You may want to look into using GCE with a streaming video service, for example something like <a href=\"http://www.wowza.com/products/streaming-engine\" rel=\"nofollow\">Wowza</a>. Google offers a click-to-deploy experience for it: <a href=\"http://cloud.google.com/tryitnow/wowza\" rel=\"nofollow\">http://cloud.google.com/tryitnow/wowza</a></p>\n\n<p>(Keep in mind that Wowza is a separate products requiring a paid license. I don't have any experience with it and neither advocate for nor disapprove of it).</p>\n"}], "owner": {"reputation": 720, "user_id": 1752124, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f37430e935542dafdc7f86c6e9fa03e4?s=128&d=identicon&r=PG", "display_name": "ravi", "link": "https://stackoverflow.com/users/1752124/ravi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1442621009, "creation_date": 1442556512, "question_id": 32644953, "link": "https://stackoverflow.com/questions/32644953/storing-streaming-videos-and-handling-requests-using-rest-apis", "title": "Storing, Streaming videos and handling requests using REST APIs", "body": "<p>I am trying to create a web server(REST APIs), which should be able to store, organise and stream videos for a client request.</p>\n\n<p>My confusion:</p>\n\n<ul>\n<li>How should a user can upload videos. From research, I decided that I would store all the metadata for the videos in database(google datastore), and all the video files in separate storage(Google cloud storage). Now, to upload videos, what is the proper way?</li>\n<li>Once a video is uploaded and stored, how will the streaming will happen. Suppose a user make a request to watch a video, server will get a http request for that. But how to stream videos? Is there any service for this? Because using http streaming directly in code affects performance I guess.</li>\n</ul>\n\n<p>From my understanding, I want to use a service which should be able to stream videos from my storage to a client upon the server's request. I guessed the server should make request to this \"video streaming service\" only after verifying the user credentials.</p>\n"}, {"tags": ["go", "hashmap", "slice"], "comments": [{"owner": {"reputation": 988, "user_id": 1492846, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ad675aa5393ea400d2e54e08ff50d6c4?s=128&d=identicon&r=PG&f=1", "display_name": "bn00d", "link": "https://stackoverflow.com/users/1492846/bn00d"}, "edited": false, "score": 0, "creation_date": 1442589860, "post_id": 32644293, "comment_id": 53157802, "body": "I didn&#39;t knew if I was missing an initialization when I asked this question, so I don&#39;t know if this is technically a duplication. Otherwise, i knew how to initialize a map within struct or in this case map of interface slice."}], "answers": [{"comments": [{"owner": {"reputation": 988, "user_id": 1492846, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ad675aa5393ea400d2e54e08ff50d6c4?s=128&d=identicon&r=PG&f=1", "display_name": "bn00d", "link": "https://stackoverflow.com/users/1492846/bn00d"}, "edited": false, "score": 0, "creation_date": 1442553337, "post_id": 32644336, "comment_id": 53136534, "body": "I knew I was doing something really silly mistake. Thanks a lot, you saved me lot of time"}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 8, "last_activity_date": 1442553159, "creation_date": 1442553159, "answer_id": 32644336, "question_id": 32644293, "link": "https://stackoverflow.com/questions/32644293/golang-map-of-interface-panic-assignment-to-entry-in-nil-map/32644336#32644336", "title": "golang map of interface - panic: assignment to entry in nil map", "body": "<p>You need to initialise the map itself: <a href=\"https://play.golang.org/p/wl4mMGjmRP\" rel=\"noreferrer\">https://play.golang.org/p/wl4mMGjmRP</a></p>\n\n<pre><code>func (buffer *Buffer) AddRecord(key string, record interface{}) {\n    // Check for nil, else initialise the map\n    if buffer.records == nil {\n        buffer.records = make(map[string][]interface{})\n    }\n    _, ok := buffer.records[key]\n    if !ok {\n        buffer.records[key] = make([]interface{}, 0)\n    }\n\n    buffer.records[key] = append(buffer.records[key], record)\n}\n</code></pre>\n\n<p>You could also use a constructor for your struct type - e.g. <code>NewBuffer(...) *Buffer</code> - that initialises the field as well, but it's good practice to check for nil before using it. Same goes for accessing map keys.</p>\n"}], "owner": {"reputation": 988, "user_id": 1492846, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ad675aa5393ea400d2e54e08ff50d6c4?s=128&d=identicon&r=PG&f=1", "display_name": "bn00d", "link": "https://stackoverflow.com/users/1492846/bn00d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13560, "favorite_count": 0, "closed_date": 1442553802, "accepted_answer_id": 32644336, "answer_count": 1, "score": 0, "last_activity_date": 1442553159, "creation_date": 1442552966, "question_id": 32644293, "link": "https://stackoverflow.com/questions/32644293/golang-map-of-interface-panic-assignment-to-entry-in-nil-map", "closed_reason": "Duplicate", "title": "golang map of interface - panic: assignment to entry in nil map", "body": "<p>I am new to golang and I am trying to create a map of type map[string]interface{}.</p>\n\n<p>But when I try to create a new key when it doesn't exists, I get a runtime error \"panic: assignment to entry in nil map\". Can anyone tell me what I am doing wrong please?</p>\n\n<p>Go PlayGround: <a href=\"https://play.golang.org/p/vIEE0T11yl\" rel=\"nofollow\">https://play.golang.org/p/vIEE0T11yl</a></p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nfunc main() {\n    buffer := Buffer{}\n    buffer.AddRecord(\"myKey\", 12345)\n}\n\ntype Buffer struct {\n    records    map[string][]interface{}\n}\n\n// ProcessRecord adds a message to the buffer.\nfunc (buffer *Buffer) AddRecord(key string, record interface{}) {\n    _, ok := buffer.records[key]\n    if !ok {\n        buffer.records[key] = make([]interface{}, 0)\n    }\n\n    buffer.records[key] = append(buffer.records[key], record)\n}\n</code></pre>\n"}, {"tags": ["json", "go", "time", "struct"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1442550340, "post_id": 32643815, "comment_id": 53135673, "body": "The feature <a href=\"https://github.com/golang/go/blob/1fd78e1f600d10475b85381427bda9f14f86e0f0/src/encoding/json/encode.go#L278-L294\" rel=\"nofollow noreferrer\">does not work with time.Time</a>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1442551625, "post_id": 32643815, "comment_id": 53136029, "body": "Probably the easiest way to your goal would be to let MyStruct implement <a href=\"http://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Unmarshaler</a>."}, {"owner": {"reputation": 2782, "user_id": 1822711, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be72f7002ddb309d9b01bb6aea680b0d?s=128&d=identicon&r=PG", "display_name": "Joe Bergevin", "link": "https://stackoverflow.com/users/1822711/joe-bergevin"}, "edited": false, "score": 0, "creation_date": 1442552523, "post_id": 32643815, "comment_id": 53136282, "body": "Good to know and good advice. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 6, "last_activity_date": 1442553450, "creation_date": 1442553450, "answer_id": 32644378, "question_id": 32643815, "link": "https://stackoverflow.com/questions/32643815/json-omitempty-with-time-time-field/32644378#32644378", "title": "JSON omitempty With time.Time Field", "body": "<p>you may define you self Time type for custom marshal format, and use it everywhere instead <code>time.Time</code></p>\n\n<p><a href=\"http://play.golang.org/p/S9VIWNAaVS\" rel=\"noreferrer\">http://play.golang.org/p/S9VIWNAaVS</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\nimport \"encoding/json\"\n\ntype MyTime struct{\n    *time.Time\n}\n\nfunc (t MyTime) MarshalJSON() ([]byte, error) {\n        return []byte(t.Format(\"\\\"2006-01-02T15:04:05Z\\\"\")), nil\n   }\n\n\n   // UnmarshalJSON implements the json.Unmarshaler interface.\n    // The time is expected to be a quoted string in RFC 3339 format.\nfunc (t *MyTime) UnmarshalJSON(data []byte) (err error) {\n        // Fractional seconds are handled implicitly by Parse.\n        tt, err := time.Parse(\"\\\"2006-01-02T15:04:05Z\\\"\", string(data))\n        *t = MyTime{&amp;tt}\n        return\n   }\n\nfunc main() {\n    t := time.Now()\n    d, err := json.Marshal(MyTime{&amp;t})\n    fmt.Println(string(d), err)\n    var mt MyTime\n    json.Unmarshal(d, &amp;mt)\n    fmt.Println(mt)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2782, "user_id": 1822711, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be72f7002ddb309d9b01bb6aea680b0d?s=128&d=identicon&r=PG", "display_name": "Joe Bergevin", "link": "https://stackoverflow.com/users/1822711/joe-bergevin"}, "edited": false, "score": 1, "creation_date": 1442721336, "post_id": 32646035, "comment_id": 53196503, "body": "That&#39;s a great answer. Thanks!"}, {"owner": {"reputation": 2574, "user_id": 645042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8652e22d6e6694b8c4435b53d44120c?s=128&d=identicon&r=PG", "display_name": "Sam Critchley", "link": "https://stackoverflow.com/users/645042/sam-critchley"}, "edited": false, "score": 0, "creation_date": 1581435921, "post_id": 32646035, "comment_id": 106428360, "body": "It feels like this answer saved my life."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 97, "last_activity_date": 1485439358, "last_edit_date": 1485439358, "creation_date": 1442560631, "answer_id": 32646035, "question_id": 32643815, "link": "https://stackoverflow.com/questions/32643815/json-omitempty-with-time-time-field/32646035#32646035", "title": "JSON omitempty With time.Time Field", "body": "<p>The <code>omitempty</code> tag option does not work with <code>time.Time</code> as it is a <code>struct</code>. There is a \"zero\" value for structs, but that is a struct value where all fields have their zero values. This is a \"valid\" value, so it is not treated as \"empty\".</p>\n\n<p>But by simply changing it to a pointer: <code>*time.Time</code>, it will work (<code>nil</code> pointers are treated as \"empty\" for json marshaling/unmarshaling). So no need to write custom <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"noreferrer\"><code>Marshaler</code></a> in this case:</p>\n\n<pre><code>type MyStruct struct {\n    Timestamp *time.Time `json:\",omitempty\"`\n    Date      *time.Time `json:\",omitempty\"`\n    Field     string     `json:\",omitempty\"`\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>ts := time.Date(2015, 9, 18, 0, 0, 0, 0, time.UTC)\nms := MyStruct{\n    Timestamp: &amp;ts,\n    Field:     \"\",\n}\n</code></pre>\n\n<p>Output (as desired):</p>\n\n<pre><code>{\"Timestamp\":\"2015-09-18T00:00:00Z\"}\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/ahfIEsO80A\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>If you can't or don't want to change it to a pointer, you can still achieve what you want by implementing a custom <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"noreferrer\"><code>Marshaler</code></a> and <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"noreferrer\"><code>Unmarshaler</code></a>. If you do so, you can use the <a href=\"https://golang.org/pkg/time/#Time.IsZero\" rel=\"noreferrer\"><code>Time.IsZero()</code></a> method to decide if a <code>time.Time</code> value is the zero value.</p>\n"}, {"tags": [], "owner": {"reputation": 7639, "user_id": 673282, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/19b35416cb9ff0ed4f6573afaabd00a5?s=128&d=identicon&r=PG", "display_name": "chim", "link": "https://stackoverflow.com/users/673282/chim"}, "is_accepted": false, "score": 1, "last_activity_date": 1586187078, "last_edit_date": 1586187078, "creation_date": 1583508095, "answer_id": 60567000, "question_id": 32643815, "link": "https://stackoverflow.com/questions/32643815/json-omitempty-with-time-time-field/60567000#60567000", "title": "JSON omitempty With time.Time Field", "body": "<p>As a follow up to icza's answer here is a custom marshaller that omits an empty date field but keeps the rest of the fields unchanged.</p>\n\n<pre><code>func (ms *MyStruct) MarshalJSON() ([]byte, error) {\n    type Alias MyStruct\n    if ms.Timestamp.IsZero() {\n        return json.Marshal(&amp;struct {\n            Timestamp int64 `json:\",omitempty\"`\n            *Alias\n        }{\n            Timestamp: 0,\n            Alias:     (*Alias)(ms),\n        })\n    } else {\n        return json.Marshal(&amp;struct {\n            *Alias\n        }{\n            Alias: (*Alias)(ms),\n        })\n    }\n}\n</code></pre>\n\n<p>This borrows from <a href=\"http://choly.ca/post/go-json-marshalling/\" rel=\"nofollow noreferrer\">http://choly.ca/post/go-json-marshalling/</a></p>\n\n<p>The OPs case has two time fields which would make it much more complicated. (you'd have to check for neither, either and both being empty!)</p>\n\n<p>There may be better ways to achieve this, so comments are welcome.</p>\n"}], "owner": {"reputation": 2782, "user_id": 1822711, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be72f7002ddb309d9b01bb6aea680b0d?s=128&d=identicon&r=PG", "display_name": "Joe Bergevin", "link": "https://stackoverflow.com/users/1822711/joe-bergevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 21641, "favorite_count": 9, "accepted_answer_id": 32646035, "answer_count": 3, "score": 49, "last_activity_date": 1586187078, "creation_date": 1442550034, "last_edit_date": 1582491428, "question_id": 32643815, "link": "https://stackoverflow.com/questions/32643815/json-omitempty-with-time-time-field", "title": "JSON omitempty With time.Time Field", "body": "<p>Trying to json Marshal a struct that contains 2 time fields. But I only want the field to come through if it has a time value. So I'm using <code>json:\",omitempty\"</code> but it's not working.</p>\n\n<p>What can I set the Date value to so json.Marshal will treat it like an empty (zero) value and not include it in the json string?</p>\n\n<p>Playground: <a href=\"http://play.golang.org/p/QJwh7yBJlo\" rel=\"noreferrer\">http://play.golang.org/p/QJwh7yBJlo</a></p>\n\n<p><strong>Actual Outcome:</strong> </p>\n\n<blockquote>\n  <p>{\"Timestamp\":\"2015-09-18T00:00:00Z\",\"Date\":\"0001-01-01T00:00:00Z\"}</p>\n</blockquote>\n\n<p><strong><em>Desired Outcome:</em></strong> </p>\n\n<blockquote>\n  <p>{\"Timestamp\":\"2015-09-18T00:00:00Z\"}</p>\n</blockquote>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"time\"\n)\n\ntype MyStruct struct {\n    Timestamp time.Time `json:\",omitempty\"`\n    Date      time.Time `json:\",omitempty\"`\n    Field     string    `json:\",omitempty\"`\n}\n\nfunc main() {\n    ms := MyStruct{\n        Timestamp: time.Date(2015, 9, 18, 0, 0, 0, 0, time.UTC),\n        Field:     \"\",\n    }\n\n    bb, err := json.Marshal(ms)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(bb))\n}\n</code></pre>\n"}, {"tags": ["windows", "encoding", "utf-8", "go", "windows-console"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 3, "creation_date": 1442546218, "post_id": 32643125, "comment_id": 53134585, "body": "The output of your program is the same as its input, no encodings are changing, but the windows console displays it incorrectly due to some weirdness. I forget the details, and I also forget where to find them, but the win32 version of Perl had to deal with the same thing. Windows tries to map console output to utf16 or something like that. <a href=\"http://stackoverflow.com/questions/14109024/how-to-make-unicode-charset-in-cmd-exe-by-default\" title=\"how to make unicode charset in cmd exe by default\">stackoverflow.com/questions/14109024/&hellip;</a> is related however."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 2, "creation_date": 1442546463, "post_id": 32643125, "comment_id": 53134640, "body": "I think <a href=\"http://stackoverflow.com/questions/3130979/how-to-output-unicode-strings-on-the-windows-console?rq=1\">this</a> is the real root \u2014 programs that use stdio on Windows simply don&#39;t get to have non-garbled console output; they have to know that they&#39;re printing to the console and use <code>WriteConsoleW</code> from the win32 API."}, {"owner": {"reputation": 199, "user_id": 1166461, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/cd31a5d3f1923a938d1287f57e78a5c9?s=128&d=identicon&r=PG", "display_name": "Programus", "link": "https://stackoverflow.com/users/1166461/programus"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1442547698, "post_id": 32643125, "comment_id": 53134986, "body": "Thank you for your comment, @hobbs. I read the link, but I still cannot understand why it works when I just type into the stdin. If it works with UTF-8, it should also convert what I typed into UTF-8 and output a garbled text instead. And also, I cannot understand why the file is just non-unicode when I used a pipe input while utf-8 encoded when I typed the stdin."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1442597232, "post_id": 32643125, "comment_id": 53161874, "body": "You might find <a href=\"https://groups.google.com/d/topic/golang-nuts/our8DRS9gaU/discussion\" rel=\"nofollow noreferrer\">this discussion</a> enlightening -- it deals extensively on Windows, its approach to encoding on the console and Go."}], "answers": [{"comments": [{"owner": {"reputation": 199, "user_id": 1166461, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/cd31a5d3f1923a938d1287f57e78a5c9?s=128&d=identicon&r=PG", "display_name": "Programus", "link": "https://stackoverflow.com/users/1166461/programus"}, "edited": false, "score": 0, "creation_date": 1442554535, "post_id": 32644062, "comment_id": 53136893, "body": "Thank you for your answer. You make the problem clear for me. I think I should convert the output into utf-8 if I want the console display the character correctly. I wonder whether there is a way to let go language just pass the original input into output without any conversion. Because I am not sure what encoding would be for the input stream, it is hard to convert the encoding in the program."}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 0, "last_activity_date": 1442552232, "last_edit_date": 1442552232, "creation_date": 1442551716, "answer_id": 32644062, "question_id": 32643125, "link": "https://stackoverflow.com/questions/32643125/why-the-encoding-of-text-is-different-when-using-io-copy-in-go-language/32644062#32644062", "title": "Why the encoding of text is different when using io.Copy in go language?", "body": "<p>it not use utf8, why 5 bytes wrote is because there a space(0x20) after \u4e2d</p>\n\n<pre><code>C:\\Users\\jan&gt;echo \u4e2d| go run src/main.go\n00000000  d6 d0 0d 0a                                       |....|\n\ufffd\ufffd\n4 &lt;nil&gt;\n</code></pre>\n\n<p>so in my system, console not use utf8, but GBK.</p>\n\n<p>the bug is because windows console can not change the on screen character even the appended byte make the character another one. e.g. 'd6 d0' is \u4e2d, d6 already on screen as \ufffd, 0a appended, not make the two byte be one display character.</p>\n\n<p>for testing, i have a c# console program</p>\n\n<pre><code>static void Main(string[] args)\n    {\n\n        using (Stream stdout = Console.OpenStandardOutput())\n        {\n            stdout.WriteByte((byte)'A');\n            stdout.WriteByte(0xd6);\n            stdout.WriteByte(0xd0);\n        }\n\n        using (Stream stdout = Console.OpenStandardOutput())\n        {\n            stdout.WriteByte((byte)'B');\n            stdout.WriteByte(0xd6);\n\n        }\n\n        using (Stream stdout = Console.OpenStandardOutput())\n        {\n            stdout.WriteByte(0xd0);\n        }\n    }\n</code></pre>\n\n<p>get result:</p>\n\n<pre><code>A\u4e2dBPress any key to continue . . .\n</code></pre>\n\n<p>so I guess windows libc have a buffer before stdout, it make up two bytes be one character and print to console.</p>\n\n<p>the interesting thing i found is that, even if windows console in gbk page, go lang can write stdou with utf8 encoding. seems bytes wrote to <code>os.Stdout</code> not directly passed to console.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    os.Stdout.Write([]byte{0xe4,0xb8,0xad})\n    fmt.Print(\"\\xe4\")\n    fmt.Print(\"\\xb8\")\n    fmt.Println(\"\\xad\")\n}\n</code></pre>\n\n<p>got:</p>\n\n<pre><code>C:\\Users\\jan&gt;go run src/main.go\n\u4e2d\u4e2d\n\nC:\\Users\\jan&gt;\n</code></pre>\n"}], "owner": {"reputation": 199, "user_id": 1166461, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/cd31a5d3f1923a938d1287f57e78a5c9?s=128&d=identicon&r=PG", "display_name": "Programus", "link": "https://stackoverflow.com/users/1166461/programus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 880, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1442552232, "creation_date": 1442545162, "last_edit_date": 1442546181, "question_id": 32643125, "link": "https://stackoverflow.com/questions/32643125/why-the-encoding-of-text-is-different-when-using-io-copy-in-go-language", "title": "Why the encoding of text is different when using io.Copy in go language?", "body": "<p>I am trying to rebuild a tee-like util by go language on Windows. \nBut I found the encoding of the output is not always the same. </p>\n\n<p>To make the problem simple, I wrote this program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\nfunc main() {\n    count, err := io.Copy(os.Stdout, os.Stdin)\n    fmt.Println(count, err)\n}\n</code></pre>\n\n<p>I named it test. \nIn the Windows command console, I got these output:</p>\n\n<pre><code>&gt;test\n\u4e2d\n\u4e2d\n5 &lt;nil&gt;\n</code></pre>\n\n<p>It works fine with no pipe and redirect.</p>\n\n<pre><code>&gt;echo \u4e2d | test\n\ufffd\ufffd\n5 &lt;nil&gt;\n</code></pre>\n\n<p>The output is collapsed if I get stdin from a pipe. </p>\n\n<pre><code>&gt;echo \u4e2d | test &gt; test.txt\n\n&gt;type test.txt\n\u4e2d\n5 &lt;nil&gt;\n</code></pre>\n\n<p>It works again when I redirect the output to a file.</p>\n\n<pre><code>&gt;test &gt; test.txt\n\u4e2d\n\n&gt;type test.txt\n\u8373\uff6d\n5 &lt;nil&gt;\n</code></pre>\n\n<p>But not work when I use the normal stdin and redirect to a file. \nIf I open this test.txt here by other editors like notepad++, I found it is encoded in UTF-8 and the content is <code>\u4e2d</code>. </p>\n\n<p>If I use Cygwin with a UTF-8 encoded console on Windows, everything is just good. </p>\n\n<p>From the output, I know that the number of bytes the program copied is 5, which means it is using UTF-8 in the program no matter what the stdin is. \nBut as I know the windows command line console is basically use non-unicode encoding, why it is converted into UTF-8? And is there a way to let the program just copy what the stdin send without any converting? </p>\n\n<p>btw. If I use tee from gnuWin32 to do the same test, everything just works good. </p>\n\n<pre><code>&gt;where tee\nD:\\Tools\\gnuWin32\\bin\\tee.exe\n\n&gt;echo \u4e2d | tee\n\u4e2d\n\n&gt;tee tee.txt\n\u4e2d\n\u4e2d\n^C\n&gt;type tee.txt\n\u4e2d\n</code></pre>\n\n<p>Is there anyone know the reason of this and what is the solution? </p>\n"}, {"tags": ["go", "copy", "slice"], "answers": [{"tags": [], "owner": {"reputation": 15349, "user_id": 2282538, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0a4fff09f1f0e3360daeabb30c2c06bb?s=128&d=identicon&r=PG", "display_name": "Tyler", "link": "https://stackoverflow.com/users/2282538/tyler"}, "is_accepted": false, "score": 2, "last_activity_date": 1442545112, "last_edit_date": 1442545112, "creation_date": 1442544633, "answer_id": 32643063, "question_id": 32642907, "link": "https://stackoverflow.com/questions/32642907/how-does-the-copy-function-work/32643063#32643063", "title": "How does the copy function work?", "body": "<p>Here is a basic example of how to use the builtin copy function:</p>\n\n<pre><code>// The source slice\nsource := []int{1, 2, 3,}\n\n// The destination slice is where things will be copied to\ndestination := make([]int, len(source))\n\n// The copy function returns a count of how many elements are copied from the source slice to the destination slice\ncopies := copy(destination, source)\n\n// Some printing\nfmt.Printf(\"copied %d elements\\n\", copies)  // Outputs: copied 3 elements\nfmt.Println(\"destination slice:\", destination)  // Outputs: destination slice: [1 2 3]\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/E4dZ7Mz8Ey\" rel=\"nofollow\">Example Playground</a> </p>\n\n<hr>\n\n<p>If the <code>destination</code> slice is of length <code>n</code>, and the <code>source</code> slice is of length <code>m</code>, and <code>n</code> &lt; <code>m</code> the destination slice will be filled with the first <code>n</code> elements of the <code>source</code> slice:</p>\n\n<pre><code>source := []int{1, 2, 3,}\ndestination := make([]int, 1) // &lt;-- Notice the 1\ncopies := copy(destination, source)\nfmt.Printf(\"copied %d elements\\n\", copies)  // Outputs: copied 1 elements\nfmt.Println(\"destination slice:\", destination)  // Outputs: destination slice: [1]\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/b4lDlVv9G8\" rel=\"nofollow\">Example Playground</a></p>\n\n<hr>\n\n<p>A gotcha is that if you declare you destination slice as a slice literal like this:</p>\n\n<pre><code>destination := []int{}\n</code></pre>\n\n<p>The length will be 0 and nothing will be copied in.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 16, "last_activity_date": 1506407119, "last_edit_date": 1506407119, "creation_date": 1442557151, "answer_id": 32645098, "question_id": 32642907, "link": "https://stackoverflow.com/questions/32642907/how-does-the-copy-function-work/32645098#32645098", "title": "How does the copy function work?", "body": "<p>The spec also covers the builtin functions <code>append()</code> and <code>copy()</code>: <a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\" rel=\"noreferrer\">Appending to and copying slices</a>. You should read it, it's quite clear.</p>\n\n<p>Let's analyze the doc of the builtin <a href=\"https://golang.org/pkg/builtin/#copy\" rel=\"noreferrer\"><code>copy()</code></a> function and its uses with simple examples. You can try all the examples on the <a href=\"http://play.golang.org/p/DuGT2u7JH1\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>Signature:</p>\n\n<pre><code>func copy(dst, src []Type) int\n</code></pre>\n\n<p><code>copy()</code> is a function, it has 2 parameters, a destination and a source slice, whose element type is the same. It returns a number of type <code>int</code> which is the number of elements actually copied.</p>\n\n<blockquote>\n  <p>The copy built-in function copies elements from a source slice into a destination slice.</p>\n</blockquote>\n\n<p><code>copy()</code> will copy elements from the <code>src</code> slice into the <code>dst</code> slice.</p>\n\n<pre><code>src := []int{10, 11, 12, 13, 14}\ndst := []int{0, 1, 2, 3, 4}\n\nn := copy(dst, src)\nfmt.Println(\"n =\", n, \"src =\", src, \"dst =\", dst)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>n = 5 src = [10 11 12 13 14] dst = [10 11 12 13 14]\n</code></pre>\n\n<p>It copied all 5 elements, and after the copy the destination has the same elements as the source.</p>\n\n<p>Let's continue the example:</p>\n\n<pre><code>dst = []int{0, 1}\n\nn = copy(dst, src)\nfmt.Println(\"n =\", n, \"src =\", src, \"dst =\", dst)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>n = 2 src = [10 11 12 13 14] dst = [10 11]\n</code></pre>\n\n<p>Only 2 elements were copied because the destination only had 2 elements.</p>\n\n<p>Continuing:</p>\n\n<pre><code>src = []int{10, 11}\ndst = []int{0, 1, 2, 3, 4}\n\nn = copy(dst, src)\nfmt.Println(\"n =\", n, \"src =\", src, \"dst =\", dst)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>n = 2 src = [10 11] dst = [10 11 2 3 4]\n</code></pre>\n\n<p>Again, only 2 elements were copied but this time because the source had only 2 elements.</p>\n\n<p>So <code>copy()</code> will only copy as many elements as source or destination has, whichever is smaller. Or in other words, as many as the source \"provides\" or destination can \"accomodate\", whichever is smaller.</p>\n\n<blockquote>\n  <p>(As a special case, it also will copy bytes from a string to a slice of bytes.)</p>\n</blockquote>\n\n<p>This means that the source can also be a <code>string</code> if destination is a <code>[]byte</code>:</p>\n\n<pre><code>str := \"Hello World!\"\ndata := make([]byte, 5)\nn = copy(data, str)\nfmt.Println(\"n =\", n, \"str =\", str, \"data =\", data)\nfmt.Printf(\"data as string: %s\\n\", data)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>n = 5 str = Hello World! data = [72 101 108 108 111]\ndata as string: Hello\n</code></pre>\n\n<p>This time the source was a <code>string</code> and <code>copy()</code> copied 5 bytes of the UTF-8 representation of the <code>string</code> (this is how Go stores strings in memory).</p>\n\n<blockquote>\n  <p>The source and destination may overlap.</p>\n</blockquote>\n\n<p>This means that <code>copy()</code> works correctly even if the destination is a slice which shares the same underlying array as the source slice, and the part of the array designated by source and destination has common parts (overlap).</p>\n\n<p>For example:</p>\n\n<pre><code>copy(src, src[1:])\nfmt.Println(\"n =\", n, \"src =\", src)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>n = 4 src = [1 2 3 4 4]\n</code></pre>\n\n<p>Here I specified <code>src[1:]</code> as the source, which is the source without the first element (this is a <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"noreferrer\">reslicing</a>). Since I excluded the first element, the source of <code>copy()</code> has 4 elements, so <code>4</code> elements were copied. The result is that elements were \"shifted\" to a 1-less index (therefore the first element being <code>0</code> is now gone from the slice), and the last element was not touched (because only 4 elements were copied).</p>\n\n<blockquote>\n  <p>Copy returns the number of elements copied, which will be the minimum of len(src) and len(dst).</p>\n</blockquote>\n\n<p>We've seen this in the above examples.</p>\n\n<p>If you need to learn more about slices:</p>\n\n<p><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"noreferrer\">Go Slices: usage and internals</a></p>\n\n<p><a href=\"https://blog.golang.org/slices\" rel=\"noreferrer\">Arrays, slices (and strings): The mechanics of 'append'</a></p>\n"}], "owner": {"reputation": 325, "user_id": 3983594, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LXW7x.jpg?s=128&g=1", "display_name": "Jason Zhou", "link": "https://stackoverflow.com/users/3983594/jason-zhou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4780, "favorite_count": 2, "closed_date": 1442574525, "accepted_answer_id": 32645098, "answer_count": 2, "score": 1, "last_activity_date": 1506407119, "creation_date": 1442543437, "last_edit_date": 1442558296, "question_id": 32642907, "link": "https://stackoverflow.com/questions/32642907/how-does-the-copy-function-work", "closed_reason": "Needs details or clarity", "title": "How does the copy function work?", "body": "<p>I don't understand how the <code>copy</code> function works based on the documentation:</p>\n\n<blockquote>\n  <p>The copy built-in function copies elements from a source slice into a\n  destination slice. (As a special case, it also will copy bytes from a\n  string to a slice of bytes.) The source and destination may overlap. Copy\n  returns the number of elements copied, which will be the minimum of\n  len(src) and len(dst).</p>\n</blockquote>\n\n<pre><code>func copy(dst, src []Type) int\n</code></pre>\n"}, {"tags": ["types", "go", "scope"], "comments": [{"owner": {"reputation": 10507, "user_id": 56686, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/9nKtX.jpg?s=128&g=1", "display_name": "Mattias Wadman", "link": "https://stackoverflow.com/users/56686/mattias-wadman"}, "edited": false, "score": 0, "creation_date": 1442588810, "post_id": 32640820, "comment_id": 53157167, "body": "Got down vote. Not sure what&#39;t wrong with the question. Seems even one of the authors of the language thinks this is a bit inconsistent but so for good reasons."}], "answers": [{"tags": [], "owner": {"reputation": 10507, "user_id": 56686, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/9nKtX.jpg?s=128&g=1", "display_name": "Mattias Wadman", "link": "https://stackoverflow.com/users/56686/mattias-wadman"}, "is_accepted": false, "score": 0, "last_activity_date": 1442529032, "creation_date": 1442529032, "answer_id": 32640968, "question_id": 32640820, "link": "https://stackoverflow.com/questions/32640820/should-type-redeclare-order-in-a-scope-be-effected-by-outer-scope/32640968#32640968", "title": "Should type redeclare order in a scope be effected by outer scope?", "body": "<p>Found <a href=\"https://groups.google.com/d/msg/golang-nuts/w40shSAlObk/XQvoxqbJ9v4J\" rel=\"nofollow\">thread on golang-nuts list</a> talking about this:</p>\n\n<blockquote>\n  <p>Briefly, this is because order of declaration matters inside a function but does not outside. At package scope, the symbols are declared in the order that satisfies their dependencies independent of their appearance on the page; inside a function, they are declared in lexical order. A moment's reflection will show why this inconsistency has merit, although it is, well, inconsistent.<br>\n  -rob</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 10507, "user_id": 56686, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/9nKtX.jpg?s=128&g=1", "display_name": "Mattias Wadman", "link": "https://stackoverflow.com/users/56686/mattias-wadman"}, "edited": false, "score": 0, "creation_date": 1442529353, "post_id": 32640974, "comment_id": 53130667, "body": "Thanks. I guess that is more or less what rob answered but in a more formal way :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1442555967, "last_edit_date": 1442555967, "creation_date": 1442529057, "answer_id": 32640974, "question_id": 32640820, "link": "https://stackoverflow.com/questions/32640820/should-type-redeclare-order-in-a-scope-be-effected-by-outer-scope/32640974#32640974", "title": "Should type redeclare order in a scope be effected by outer scope?", "body": "<p>This is so by the language spec.</p>\n\n<p>Quoting the relevant part: <a href=\"http://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow\">Declarations and scope:</a></p>\n\n<blockquote>\n  <p>The scope of a type identifier declared inside a function <strong>begins at the identifier</strong> in the TypeSpec and ends at the end of the innermost containing block.</p>\n</blockquote>\n\n<p>Types declared inside a function are only in scope from the type identifier (being declared). Before that they are not. </p>\n\n<pre><code>type user struct {\n    Feeds []feed // This can only be the outer feed type\n}\n\ntype feed struct{} // new feed type is in scope from this line\n</code></pre>\n"}], "owner": {"reputation": 10507, "user_id": 56686, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/9nKtX.jpg?s=128&g=1", "display_name": "Mattias Wadman", "link": "https://stackoverflow.com/users/56686/mattias-wadman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 32640974, "answer_count": 2, "score": 2, "last_activity_date": 1442589518, "creation_date": 1442528142, "last_edit_date": 1442589518, "question_id": 32640820, "link": "https://stackoverflow.com/questions/32640820/should-type-redeclare-order-in-a-scope-be-effected-by-outer-scope", "title": "Should type redeclare order in a scope be effected by outer scope?", "body": "<p>I got a strange error message <code>cannot use []feed literal (type []feed) as type []feed in field value</code> and after some fiddling and minimizing the source I figured out that this situation seems to produce the error:</p>\n\n<pre><code>type user struct {\n    Feeds []feed\n}\ntype feed struct{}\n\nfunc fn() {\n    type user struct {\n        Feeds []feed // seems to refer to the outer feed type\n    }\n    type feed struct{}\n\n    _ = user{\n        // \"cannot use []feed literal (type []feed) as type []feed in field value\"\n        Feeds: []feed{},\n    }\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/gNIGhPwAgl\" rel=\"nofollow\">http://play.golang.org/p/gNIGhPwAgl</a></p>\n\n<p>Is this the intended behaviour or a bug? I've spend some time reading the language specification but can't find anything explicitly stating how type declaration order in scopes should work. It's a bit unintuitive that order does not matter in the outer scope but does in the inner.</p>\n"}, {"tags": ["android", "go", "mobile", "gomobile"], "comments": [{"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "edited": false, "score": 0, "creation_date": 1442536387, "post_id": 32636972, "comment_id": 53132553, "body": "Go&#39;s <code>nil</code> is a typed value, so I don&#39;t think it translates directly to Java&#39;s <code>null</code>.  You might need to check it against the zero value of <code>GoStruct</code>."}, {"owner": {"reputation": 3766, "user_id": 967100, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/lJq6z.jpg?s=128&g=1", "display_name": "Bruno Vieira", "link": "https://stackoverflow.com/users/967100/bruno-vieira"}, "reply_to_user": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "edited": false, "score": 0, "creation_date": 1442536652, "post_id": 32636972, "comment_id": 53132615, "body": "Yes, I tried that and then the app crashed mumbling something about improper pointer de-reference. BTW, if a struct is nil in go and you try to access it&#39;s fields, go also crashes, so testing GoStruct for Zero values is (literally) a no go for Java"}, {"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "edited": false, "score": 0, "creation_date": 1442537060, "post_id": 32636972, "comment_id": 53132699, "body": "Hmmm, I was afraid that would happen.  I&#39;m not sure how the bind is casting nil.  A really hacky solution would be a try/catch block to test for nil by forcing the exception.  And, yes I do feel dirty even suggesting it."}, {"owner": {"reputation": 3766, "user_id": 967100, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/lJq6z.jpg?s=128&g=1", "display_name": "Bruno Vieira", "link": "https://stackoverflow.com/users/967100/bruno-vieira"}, "reply_to_user": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "edited": false, "score": 0, "creation_date": 1442537510, "post_id": 32636972, "comment_id": 53132786, "body": "Actually that&#39;s what I came up doing. And then I wrapped all my code in yet another class to handle all my go functions just to avoid try/catch blocks, causing yet more overhead. I guess the folks at gomobile should have a very good reason to not map nil to null, I&#39;m just failing to see it"}], "answers": [{"comments": [{"owner": {"reputation": 3766, "user_id": 967100, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/lJq6z.jpg?s=128&g=1", "display_name": "Bruno Vieira", "link": "https://stackoverflow.com/users/967100/bruno-vieira"}, "edited": false, "score": 0, "creation_date": 1442540138, "post_id": 32642216, "comment_id": 53133310, "body": "I upvoted the question but somehow it doesn&#39;t work. I guess I&#39;ll have to keep try/catch -ing nil values."}, {"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "reply_to_user": {"reputation": 3766, "user_id": 967100, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/lJq6z.jpg?s=128&g=1", "display_name": "Bruno Vieira", "link": "https://stackoverflow.com/users/967100/bruno-vieira"}, "edited": false, "score": 1, "creation_date": 1442542986, "post_id": 32642216, "comment_id": 53133915, "body": "You could add a function <code>GoLibrary.NullVal()</code> that returns a typed <code>nil</code> value."}, {"owner": {"reputation": 3766, "user_id": 967100, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/lJq6z.jpg?s=128&g=1", "display_name": "Bruno Vieira", "link": "https://stackoverflow.com/users/967100/bruno-vieira"}, "edited": false, "score": 0, "creation_date": 1442543519, "post_id": 32642216, "comment_id": 53134021, "body": "There&#39;s no way to have a Struct as a return type when generating a .aar file via gomobile bind. Pointers to struct however work. That&#39;s why I&#39;m returning a pointer to my GoStruct in my ExportedGoFunction(). Also, by using NullVal()  I would end with something that&#39;s not idiomatic Go nor idiomatic Java and lose the flexibility of pointers."}, {"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "reply_to_user": {"reputation": 3766, "user_id": 967100, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/lJq6z.jpg?s=128&g=1", "display_name": "Bruno Vieira", "link": "https://stackoverflow.com/users/967100/bruno-vieira"}, "edited": false, "score": 0, "creation_date": 1442544608, "post_id": 32642216, "comment_id": 53134246, "body": "Sorry, I meant that to return a pointer rather than a struct.  I&#39;ll fix that in the code.  I don&#39;t mean to suggest that this is idiomatic in either language, but it&#39;s likely a more efficient alternative to wrappers and exception handling."}], "tags": [], "owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "is_accepted": false, "score": 1, "last_activity_date": 1442544618, "last_edit_date": 1442544618, "creation_date": 1442537551, "answer_id": 32642216, "question_id": 32636972, "link": "https://stackoverflow.com/questions/32636972/evaluate-nil-values-from-gomobile-bind/32642216#32642216", "title": "Evaluate nil values from gomobile bind", "body": "<p>Looking through the testing package for go mobile, it looks like you need to cast the null value to the type.</p>\n\n<p>From the SeqTest.java file:</p>\n\n<pre><code> public void testNilErr() throws Exception {\n    Testpkg.Err(null); // returns nil, no exception\n  }\n</code></pre>\n\n<p>Edit:  A non-exception example, too:  </p>\n\n<pre><code>byte[] got = Testpkg.BytesAppend(null, null);\nassertEquals(\"Bytes(null+null) should match\", (byte[])null, got);\ngot = Testpkg.BytesAppend(new byte[0], new byte[0]);\nassertEquals(\"Bytes(empty+empty) should match\", (byte[])null, got);\n</code></pre>\n\n<p>It may be as simple as:</p>\n\n<pre><code>GoLibrary.GoStruct goStruct = GoLibrary.ExportedGoFunction();\nif (goStruct != (GoLibrary.GoStruct)null) {\n   // This block should not be executed, but it is\n   Log.d(\"GoLog\", \"goStruct is not null\");\n}\n</code></pre>\n\n<p>EDIT:  Suggestion for utility method:</p>\n\n<p>You could add a utility function to the library to give you the typed <code>nil</code> value.</p>\n\n<pre><code>func NullVal() *GoStruct {\n    return nil\n}\n</code></pre>\n\n<p>Still a bit hacky, but it should be less overhead than multiple wrappers and exception handling.</p>\n"}, {"tags": [], "owner": {"reputation": 3766, "user_id": 967100, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/lJq6z.jpg?s=128&g=1", "display_name": "Bruno Vieira", "link": "https://stackoverflow.com/users/967100/bruno-vieira"}, "is_accepted": true, "score": 1, "last_activity_date": 1448327245, "last_edit_date": 1495542252, "creation_date": 1442798046, "answer_id": 32685997, "question_id": 32636972, "link": "https://stackoverflow.com/questions/32636972/evaluate-nil-values-from-gomobile-bind/32685997#32685997", "title": "Evaluate nil values from gomobile bind", "body": "<p>For possible future reference, as of <strong>09/2015</strong> I've come up with two ways of dealing with the problem.</p>\n\n<p>The first one is to return an error from the <strong>Go</strong> code and <strong>try/catch-ing</strong> the error in <strong>Java</strong>. Here's an example:</p>\n\n<pre><code>// ExportedGoFunction returns a pointer to a GoStruct or nil in case of fail\nfunc ExportedGoFunction() (*GoStruct, error) {\n   result := myUnexportedGoStruct()\n   if result == nil {\n      return nil, errors.New(\"Error: GoStruct is Nil\")\n   }\n\n   return result, nil\n}\n</code></pre>\n\n<p>And then try/catch the error in <strong>Java</strong></p>\n\n<pre><code>try {\n   GoLibrary.GoStruct myStruct = GoLibrary.ExportedGoFunction();\n} \ncatch (Exception e) {\n   e.printStackTrace(); // myStruct is nil   \n}\n</code></pre>\n\n<p>This approach is both idiomatic <strong>Go</strong> and <strong>Java</strong>, but even if it works on preventing the program to crash, it ends up bloating the code with try/catch statements and causing yet more overhead.</p>\n\n<p>So, based on user <a href=\"https://stackoverflow.com/users/4638952/snoproblem\" title=\"@SnoProblem\">@SnoProblem</a> answers the non-idiomatic way of solving it and properly handle null values I came up with was:</p>\n\n<pre><code>// NullGoStruct returns false if value is nil or true otherwise\nfunc NullGoStruct(value *GoStruct) bool {\n    return (value == nil) \n}\n</code></pre>\n\n<p>And then check the code in <strong>Java</strong> like:</p>\n\n<pre><code>GoLibrary.GoStruct value = GoLibrary.ExportedGoFunction();\nif (GoLibrary.NullGoStruct(value)) {\n   // This block is executed only if value has nil value in Go\n   Log.d(\"GoLog\", \"value is null\");\n}\n</code></pre>\n"}], "owner": {"reputation": 3766, "user_id": 967100, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/lJq6z.jpg?s=128&g=1", "display_name": "Bruno Vieira", "link": "https://stackoverflow.com/users/967100/bruno-vieira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 1, "accepted_answer_id": 32685997, "answer_count": 2, "score": 2, "last_activity_date": 1496249874, "creation_date": 1442512678, "last_edit_date": 1496249874, "question_id": 32636972, "link": "https://stackoverflow.com/questions/32636972/evaluate-nil-values-from-gomobile-bind", "title": "Evaluate nil values from gomobile bind", "body": "<p>What's the right way to evaluate <strong>nil</strong> returned values from <strong>Go</strong> functions in Android Java? </p>\n\n<p>Here's what I've tried:</p>\n\n<pre><code>// ExportedGoFunction returns a pointer to a GoStruct or nil in case of fail\nfunc ExportedGoFunction() *GoStruct {\n  return nil\n}\n</code></pre>\n\n<p>Then I generate a .aar file via gomobile using:</p>\n\n<p><code>gomobile bind -v --target=android</code> </p>\n\n<p>In my Java code I tried to evaluate <strong>nil</strong> as <strong>null</strong> but it's not working. Java Code:</p>\n\n<pre><code>GoLibrary.GoStruct goStruct = GoLibrary.ExportedGoFunction();\nif (goStruct != null) {\n   // This block should not be executed, but it is\n   Log.d(\"GoLog\", \"goStruct is not null\");\n}\n</code></pre>\n\n<p>Disclaimer: Other methods from the go library work flawless</p>\n"}, {"tags": ["jquery", "go"], "comments": [{"owner": {"reputation": 2447, "user_id": 5202722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cffc85a39f4801a4efa2d142f8a6d327?s=128&d=identicon&r=PG", "display_name": "Gregg Duncan", "link": "https://stackoverflow.com/users/5202722/gregg-duncan"}, "edited": false, "score": 0, "creation_date": 1442510202, "post_id": 32635943, "comment_id": 53121087, "body": "I&#39;m afraid I can&#39;t help with &#39;goquery&#39;. I&#39;m just curious why you would use it? It&#39;s own documentation says that it&#39;s an attempted knockoff of jQuery. Why not just use jQuery."}, {"owner": {"reputation": 520, "user_id": 989919, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/05b8e6b1915e4ae6ae963ec6b55af4a1?s=128&d=identicon&r=PG", "display_name": "mediocre", "link": "https://stackoverflow.com/users/989919/mediocre"}, "reply_to_user": {"reputation": 2447, "user_id": 5202722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cffc85a39f4801a4efa2d142f8a6d327?s=128&d=identicon&r=PG", "display_name": "Gregg Duncan", "link": "https://stackoverflow.com/users/5202722/gregg-duncan"}, "edited": false, "score": 0, "creation_date": 1442510264, "post_id": 32635943, "comment_id": 53121122, "body": "I&#39;m writing a parser for a website in Go as an exercise."}], "answers": [{"comments": [{"owner": {"reputation": 520, "user_id": 989919, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/05b8e6b1915e4ae6ae963ec6b55af4a1?s=128&d=identicon&r=PG", "display_name": "mediocre", "link": "https://stackoverflow.com/users/989919/mediocre"}, "edited": false, "score": 0, "creation_date": 1442510177, "post_id": 32636232, "comment_id": 53121074, "body": "Just tested this and this just returns &quot;Some value I don&#39;t need&quot;"}, {"owner": {"reputation": 10321, "user_id": 215552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26bda02894d869c95f620de4b7cd386d?s=128&d=identicon&r=PG", "display_name": "Heretic Monkey", "link": "https://stackoverflow.com/users/215552/heretic-monkey"}, "edited": false, "score": 1, "creation_date": 1442515119, "post_id": 32636232, "comment_id": 53123900, "body": "Please add some explanation of why this code helps the OP. This will help provide an answer future viewers can learn from. See <a href=\"https://stackoverflow.com/questions/how-to-answer\">How to Answer</a> for more information."}], "tags": [], "owner": {"reputation": 13457, "user_id": 954376, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/08PZK.jpg?s=128&g=1", "display_name": "NeoWang", "link": "https://stackoverflow.com/users/954376/neowang"}, "is_accepted": false, "score": -2, "last_activity_date": 1442510039, "creation_date": 1442510039, "answer_id": 32636232, "question_id": 32635943, "link": "https://stackoverflow.com/questions/32635943/get-text-from-div-without-child-elements/32636232#32636232", "title": "Get text from div without child elements", "body": "<p>How about:</p>\n\n<pre><code>doc.Find(\".outter-class .inner-class\").Children().First().Text()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 520, "user_id": 989919, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/05b8e6b1915e4ae6ae963ec6b55af4a1?s=128&d=identicon&r=PG", "display_name": "mediocre", "link": "https://stackoverflow.com/users/989919/mediocre"}, "edited": false, "score": 1, "creation_date": 1442528832, "post_id": 32640258, "comment_id": 53130485, "body": "You&#39;ll have to change <code>Children</code> to <code>Children()</code> but then it works. Thanks!"}, {"owner": {"reputation": 206, "user_id": 4824870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/713f8db8763a5352eca7d85e67859e6f?s=128&d=identicon&r=PG&f=1", "display_name": "alex mullins", "link": "https://stackoverflow.com/users/4824870/alex-mullins"}, "reply_to_user": {"reputation": 520, "user_id": 989919, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/05b8e6b1915e4ae6ae963ec6b55af4a1?s=128&d=identicon&r=PG", "display_name": "mediocre", "link": "https://stackoverflow.com/users/989919/mediocre"}, "edited": false, "score": 0, "creation_date": 1442530159, "post_id": 32640258, "comment_id": 53130893, "body": "Ahh yes thanks for catching the typo. I created a gist for this question so anyone in the future can have a runnable example to follow: <a href=\"https://gist.github.com/alexmullins/ac9581e106eb6b1a33ac\" rel=\"nofollow noreferrer\">gist.github.com/alexmullins/ac9581e106eb6b1a33ac</a>"}, {"owner": {"reputation": 206, "user_id": 4824870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/713f8db8763a5352eca7d85e67859e6f?s=128&d=identicon&r=PG&f=1", "display_name": "alex mullins", "link": "https://stackoverflow.com/users/4824870/alex-mullins"}, "reply_to_user": {"reputation": 520, "user_id": 989919, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/05b8e6b1915e4ae6ae963ec6b55af4a1?s=128&d=identicon&r=PG", "display_name": "mediocre", "link": "https://stackoverflow.com/users/989919/mediocre"}, "edited": false, "score": 0, "creation_date": 1442530430, "post_id": 32640258, "comment_id": 53130982, "body": "In there I also saved the initial selection from doc.Find(&quot;h1&quot;). It reduces some computation due not having to traverse the tree again to Find(&quot;h1&quot;)."}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 0, "creation_date": 1442547664, "post_id": 32640258, "comment_id": 53134976, "body": "@alexmullins : please edit your answer with your corrections"}], "tags": [], "owner": {"reputation": 206, "user_id": 4824870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/713f8db8763a5352eca7d85e67859e6f?s=128&d=identicon&r=PG&f=1", "display_name": "alex mullins", "link": "https://stackoverflow.com/users/4824870/alex-mullins"}, "is_accepted": true, "score": 4, "last_activity_date": 1442626564, "last_edit_date": 1442626564, "creation_date": 1442525273, "answer_id": 32640258, "question_id": 32635943, "link": "https://stackoverflow.com/questions/32635943/get-text-from-div-without-child-elements/32640258#32640258", "title": "Get text from div without child elements", "body": "<p>The way I got it to work was with:</p>\n\n<pre><code>// End() lets us jump back to the h1 selection to get its text\ntext := doc.Find(\"h1\").Children().Remove().End().Text()\ntext = strings.TrimSpace(text)\nfmt.Println(text)\n</code></pre>\n\n<p>Output:</p>\n\n<blockquote>\n  <p>The string I need</p>\n</blockquote>\n\n<p>The code removes the child nodes (the span elements) from the h1 element to get the correct output. There may be an easier way of doing this, but it works. :)</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6337843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iOaKn.png?s=128&g=1", "display_name": "A. Krieg", "link": "https://stackoverflow.com/users/6337843/a-krieg"}, "is_accepted": false, "score": 0, "last_activity_date": 1557673920, "creation_date": 1557673920, "answer_id": 56100578, "question_id": 32635943, "link": "https://stackoverflow.com/questions/32635943/get-text-from-div-without-child-elements/56100578#56100578", "title": "Get text from div without child elements", "body": "<p>Best way I've found to accomplish this:</p>\n\n<pre><code>text := dom.Find(\".inner-class\").Nodes[0].FirstChild.Data\n</code></pre>\n\n<p>I've spent quite a bit of time using the HTML parsing library under goquery so this doesn't really seem hacky to me, but it might to some.</p>\n"}], "owner": {"reputation": 520, "user_id": 989919, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/05b8e6b1915e4ae6ae963ec6b55af4a1?s=128&d=identicon&r=PG", "display_name": "mediocre", "link": "https://stackoverflow.com/users/989919/mediocre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 960, "favorite_count": 0, "accepted_answer_id": 32640258, "answer_count": 3, "score": 1, "last_activity_date": 1557673920, "creation_date": 1442508996, "last_edit_date": 1495535367, "question_id": 32635943, "link": "https://stackoverflow.com/questions/32635943/get-text-from-div-without-child-elements", "title": "Get text from div without child elements", "body": "<p>I'm trying to parse this html with the help of <code>goquery</code>. I can't figure out how to parse the string \"The string I need\" while throwing away everything else.</p>\n\n<pre><code>  &lt;div class=\"outter-class\"&gt;\n        &lt;h1 class=\"inner-class\"&gt;\n        The string I need\n        &lt;span class=\"other-class\" &gt;Some value I don't need&lt;/span&gt;\n        &lt;span class=\"other-class2\" title=\"sometitle\"&gt;&lt;/span&gt;\n        &lt;/h1&gt;\n        &lt;div class=\"other-class3\"&gt;\n            &lt;h3&gt;Some heading i don't need&lt;/h3&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n</code></pre>\n\n<p>I tried to use something like: <a href=\"https://stackoverflow.com/a/8851526/989919\">https://stackoverflow.com/a/8851526/989919</a> by adapting it to goquery like that:</p>\n\n<pre><code>test := s.Clone().Children().Empty().End().Text()\nfmt.Println(test.Text()) \n</code></pre>\n\n<p>But that doesn't work. I tried a lot of different variants from the <a href=\"https://godoc.org/github.com/PuerkitoBio/goquery\" rel=\"nofollow noreferrer\">API</a> but I can't figure it out.</p>\n"}, {"tags": ["go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 18455, "user_id": 2657550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88d553accfca32636d96a8d5075e85d1?s=128&d=identicon&r=PG", "display_name": "Gustavo Niemeyer", "link": "https://stackoverflow.com/users/2657550/gustavo-niemeyer"}, "is_accepted": true, "score": 1, "last_activity_date": 1442510078, "creation_date": 1442510078, "answer_id": 32636245, "question_id": 32635007, "link": "https://stackoverflow.com/questions/32635007/mgo-reduce-update-and-find-to-one-query-only/32636245#32636245", "title": "mgo - reduce update and find to one query only", "body": "<p>Yes, it is possible. Please have a look at the documentation of the <a href=\"http://gopkg.in/mgo.v2#Query.Apply\" rel=\"nofollow\">Query.Apply</a> method, which runs the <a href=\"https://docs.mongodb.org/manual/reference/command/findAndModify/\" rel=\"nofollow\">findAndModify</a> MongoDB command.</p>\n\n<p>Straight from the documentation, this example increments a counter and prints its new value:</p>\n\n<pre><code>change := mgo.Change{\n        Update: bson.M{\"$inc\": bson.M{\"n\": 1}},\n        ReturnNew: true,\n}\ninfo, err = col.Find(M{\"_id\": id}).Apply(change, &amp;doc)\nfmt.Println(doc.N)\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 510, "favorite_count": 0, "accepted_answer_id": 32636245, "answer_count": 1, "score": 2, "last_activity_date": 1442510078, "creation_date": 1442505848, "last_edit_date": 1442506330, "question_id": 32635007, "link": "https://stackoverflow.com/questions/32635007/mgo-reduce-update-and-find-to-one-query-only", "title": "mgo - reduce update and find to one query only", "body": "<p>I find myself having to write two db queries and I would like to know whether it's possible to reduce to one.</p>\n\n<p>I am updating a document and then finding the document again in the database. Is it possible to update and receive the full updated document in the response of the update query? This would save a call to the db.</p>\n\n<p>I should explain that the document I'm saving won't be a complete document which is why I'm having to retrieve it from the database to get all the fields.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3201, "user_id": 2616179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb90669caa64288bdb5767f736152bbe?s=128&d=identicon&r=PG", "display_name": "Makpoc", "link": "https://stackoverflow.com/users/2616179/makpoc"}, "edited": false, "score": 0, "creation_date": 1442559681, "post_id": 32635264, "comment_id": 53139106, "body": "Looks good to me. I&#39;ll go ahead and move to this structure and see how it feels as well. Thanks."}], "tags": [], "owner": {"reputation": 6647, "user_id": 914991, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/639555fcf960b5e80617a10f479ea476?s=128&d=identicon&r=PG", "display_name": "zmb", "link": "https://stackoverflow.com/users/914991/zmb"}, "is_accepted": true, "score": 5, "last_activity_date": 1442506672, "creation_date": 1442506672, "answer_id": 32635264, "question_id": 32634837, "link": "https://stackoverflow.com/questions/32634837/project-structure-for-a-tool-with-multiple-uis/32635264#32635264", "title": "Project structure for a tool with multiple UIs", "body": "<p>I agree that there's not much point in making separate projects/repositories if they're only going to be used for this library.  I would just have a <code>cmd</code> directory with a subdirectory for each executable you're building.  </p>\n\n<p>Something like this:</p>\n\n<ul>\n<li>github.com/user/project\n\n<ul>\n<li>generation</li>\n<li>cmd\n\n<ul>\n<li>cmdline\n\n<ul>\n<li>main.go</li>\n</ul></li>\n<li>web\n\n<ul>\n<li>main.go</li>\n</ul></li>\n</ul></li>\n</ul></li>\n</ul>\n\n<p>The main.go files can use the functionality that you've broken out into your \"generation\" package.</p>\n\n<p>The name of the executables produced by <code>go build</code> will be the name of the parent directory, so <code>cmdline</code> and <code>web</code> in this example (you would want to choose better names).</p>\n\n<p>Note: you don't actually have a package <code>cmdline</code> or <code>web</code>.  The files in those directories would all be in [their own separate] package <code>main</code>.</p>\n"}], "owner": {"reputation": 3201, "user_id": 2616179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb90669caa64288bdb5767f736152bbe?s=128&d=identicon&r=PG", "display_name": "Makpoc", "link": "https://stackoverflow.com/users/2616179/makpoc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 688, "favorite_count": 0, "accepted_answer_id": 32635264, "answer_count": 1, "score": 1, "last_activity_date": 1442506672, "creation_date": 1442505297, "last_edit_date": 1442505867, "question_id": 32634837, "link": "https://stackoverflow.com/questions/32634837/project-structure-for-a-tool-with-multiple-uis", "title": "Project structure for a tool with multiple UIs", "body": "<p>I'm playing with golang and made a tool for password generation. Initially it was intended to be used as a command line tool. I later separated the generation logic into a separate package (still same github repository) and left the main function in the root of the project. Now I also want to add a simple web frontend (nothing fancy), but I don't know how to structure the packages. </p>\n\n<p>Am I supposed to put both the command line entry point as well as the web UI into their own packages in the same project (which leaves the root empty). Or maybe I should move the actual generation library to the root and the UIs in separate packages. I guess the other option is to have the UIs in separate projects on github, but they are only going to be used for this library, so it does not seem like a good idea.</p>\n\n<p>I remember seeing in some projects packages named cmd for example, but never have I encountered one, with multiple front ends. Is there a go(-gettable-)way for doing this?</p>\n"}, {"tags": ["encryption", "go", "initialization-vector"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 3, "creation_date": 1442502417, "post_id": 32633732, "comment_id": 53116281, "body": "You&#39;re mistaken. In the encrypt case it&#39;s using a random IV. In the decrypt case it&#39;s using the IV from the message. Don&#39;t let the fact that the IV is initialized as a slice of the ciphertext fool you; the next thing it does is read random bytes into that slice from a <a href=\"http://golang.org/pkg/crypto/rand/#pkg-variables\" rel=\"nofollow noreferrer\">strong random source</a>."}, {"owner": {"reputation": 15, "user_id": 4299332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ab93ab11b18fc92379a767ea66b5ef5?s=128&d=identicon&r=PG&f=1", "display_name": "Vinzent", "link": "https://stackoverflow.com/users/4299332/vinzent"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1442504655, "post_id": 32633732, "comment_id": 53117775, "body": "Thanks for clarification about the GO exemple , which indeed randomize the IV by doing a  <code>io.ReadFull(rand.Reader, iv)</code>. I think that it is a bit misleading. Doing a <code>iv := make([]byte, [:aes.BlockSize])</code> assignment would be clearer."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1442507036, "post_id": 32633732, "comment_id": 53119320, "body": "that&#39;s not even valid syntax."}, {"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1442511986, "post_id": 32633732, "comment_id": 53122031, "body": "I was completely wrong. Please read my answer again. It should be correct now."}], "answers": [{"comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1442504880, "post_id": 32634304, "comment_id": 53117942, "body": "Your very first sentence is wrong. <code>make</code> always returns a zeroed slice. <code>ciphertext</code> will always be all zeroes in the OP&#39;s example."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 1, "creation_date": 1442507225, "post_id": 32634304, "comment_id": 53119424, "body": "100% of this is wrong. If the capacity isn&#39;t provided when making a slice, it&#39;s the same as the length. Whether or not it&#39;s provided has nothing to do with whether the backing array is initialized; it&#39;s always initialized to zeroes."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1442508246, "post_id": 32634304, "comment_id": 53119975, "body": "You can&#39;t access uninitialized memory in Go without using &quot;unsafe&quot;."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442508516, "post_id": 32634304, "comment_id": 53120132, "body": "Even if you were to use initialized memory for an IV, it is most certainly <i>not</i> sufficient. The chances of having non unique blocks of 16 bytes from your heap on subsequent runs is relatively high."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1442511527, "post_id": 32634304, "comment_id": 53121789, "body": "@ArtjomB. this is still wrong because the example <i>does</i> init the IV from <code>rand.Reader</code> exactly the way you&#39;re recommending (line 77 :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442512511, "post_id": 32634304, "comment_id": 53122326, "body": "@ArtjomB.: you can do pretty much anything through &quot;unsafe&quot;: <a href=\"http://play.golang.org/p/ncLFq2zsmx\" rel=\"nofollow noreferrer\">play.golang.org/p/ncLFq2zsmx</a> (and indirectly through cgo). There&#39;s no chance of accessing unsafe through the aes code, since it&#39;s not imported at all."}], "tags": [], "owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "is_accepted": true, "score": 1, "last_activity_date": 1442511895, "last_edit_date": 1442511895, "creation_date": 1442503715, "answer_id": 32634304, "question_id": 32633732, "link": "https://stackoverflow.com/questions/32633732/why-doesnt-the-golang-crypto-example-use-a-random-iv/32634304#32634304", "title": "Why doesn&#39;t the golang crypto example use a random IV?", "body": "<p>It is secure, because the IV is filled from a Cryptographically Secure Pseudo Random Number Generator (CSPRNG) which is <code>/dev/urandom</code> by default and provided from the OS. From the <code>ExampleNewCBCEncrypter</code> function:</p>\n\n<pre><code>iv := ciphertext[:aes.BlockSize]\nif _, err := io.ReadFull(rand.Reader, iv); err != nil {\n    panic(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 4299332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ab93ab11b18fc92379a767ea66b5ef5?s=128&d=identicon&r=PG&f=1", "display_name": "Vinzent", "link": "https://stackoverflow.com/users/4299332/vinzent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 900, "favorite_count": 0, "closed_date": 1442516211, "accepted_answer_id": 32634304, "answer_count": 1, "score": 1, "last_activity_date": 1442511895, "creation_date": 1442502219, "last_edit_date": 1442503917, "question_id": 32633732, "link": "https://stackoverflow.com/questions/32633732/why-doesnt-the-golang-crypto-example-use-a-random-iv", "closed_reason": "Needs details or clarity", "title": "Why doesn&#39;t the golang crypto example use a random IV?", "body": "<p>According to CWE-329 NON-Random IV's allow for the possibility of a dictionary attack. \nHowever, <a href=\"http://golang.org/src/crypto/cipher/example_test.go\" rel=\"nofollow\">in the AES crypto example</a>, golang docs use a non-random IV:</p>\n\n<pre><code>ciphertext := make([]byte, aes.BlockSize+len(plaintext))\niv := ciphertext[:aes.BlockSize]\n</code></pre>\n\n<p>Is this implementation safe or should I use a random function to get my IV?</p>\n"}, {"tags": ["ubuntu", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1442501021, "post_id": 32633131, "comment_id": 53115283, "body": "What does <code>go env</code> print?"}, {"owner": {"reputation": 28145, "user_id": 501187, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2bf8dee0b3c004589b62a9b0db09b04a?s=128&d=identicon&r=PG", "display_name": "Fresheyeball", "link": "https://stackoverflow.com/users/501187/fresheyeball"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1442502444, "post_id": 32633131, "comment_id": 53116298, "body": "Added to my question"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1442503620, "post_id": 32633131, "comment_id": 53117104, "body": "This is a very odd GOROOT. On my Ubuntu 14.04 it installs go to <code>&#47;usr&#47;lib&#47;go</code>. Are you sure you haven&#39;t set GOROOT anywhere? <code>env | grep GOROOT</code>?"}, {"owner": {"reputation": 28145, "user_id": 501187, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2bf8dee0b3c004589b62a9b0db09b04a?s=128&d=identicon&r=PG", "display_name": "Fresheyeball", "link": "https://stackoverflow.com/users/501187/fresheyeball"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1442505607, "post_id": 32633131, "comment_id": 53118437, "body": "Yes. GOROOT was set from <code>apt-get install</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1442513316, "post_id": 32633131, "comment_id": 53122828, "body": "That also looks like an out of date package. I would forgo the official apt repos and use the standard methods for installation <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">golang.org/doc/install</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1442514199, "post_id": 32633131, "comment_id": 53123377, "body": "Install the official stuff from golang.org."}], "answers": [{"tags": [], "owner": {"reputation": 2527, "user_id": 3476121, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/1c621706e2e37eed4f82f074af9f706a?s=128&d=identicon&r=PG", "display_name": "sadlil", "link": "https://stackoverflow.com/users/3476121/sadlil"}, "is_accepted": false, "score": 10, "last_activity_date": 1442550473, "creation_date": 1442550473, "answer_id": 32643882, "question_id": 32633131, "link": "https://stackoverflow.com/questions/32633131/go-setup-on-ubuntu/32643882#32643882", "title": "Go setup on ubuntu", "body": "<p>On my ubuntu machine i installed go by following those simple steps:</p>\n\n<pre><code>$ wget https://storage.googleapis.com/golang/go1.4.2.linux-amd64.tar.gz\n$ sudo tar -C /usr/local -xzf go1.4.2.linux-amd64.tar.gz\n$ rm go1.4.2.linux-amd64.tar.gz\n</code></pre>\n\n<p>Add go to your $PATH variable</p>\n\n<pre><code>$ mkdir $HOME/go\n$ nano ~/.bashrc\nexport GOPATH=$HOME/go\nexport PATH=$PATH:/usr/local/go/bin:$GOPATH/bin\n$ source ~/.bashrc\n</code></pre>\n\n<p>This Works just fine. </p>\n"}, {"tags": [], "owner": {"reputation": 28145, "user_id": 501187, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2bf8dee0b3c004589b62a9b0db09b04a?s=128&d=identicon&r=PG", "display_name": "Fresheyeball", "link": "https://stackoverflow.com/users/501187/fresheyeball"}, "is_accepted": true, "score": 5, "last_activity_date": 1442604794, "creation_date": 1442604794, "answer_id": 32659724, "question_id": 32633131, "link": "https://stackoverflow.com/questions/32633131/go-setup-on-ubuntu/32659724#32659724", "title": "Go setup on ubuntu", "body": "<p>So I eventually figured this out, and boy was it dumb on my part. I had a script that was effecting <code>$GOROOT</code>, and learned alot. Here are the big lessons:</p>\n\n<ul>\n<li>Do NOT use <code>sudo apt-get install golang</code> it is out of date and doing so means you now have to revert the install. <code>sudo apt-get install golang-go</code> is also out of date. Just don't use <code>apt-get</code>.</li>\n<li><code>sudo apt-get purge golang</code> does not reset environment variables or delete all go related folders.</li>\n<li><p><code>unset GOPATH GOHOME GOROOT</code> is important cleanup before trying another install </p></li>\n<li><p>ONLY install via <code>tar.gz</code> from the golang website</p></li>\n<li>GOROOT means the folder where go's internal files live, so basically where ever the contents of the <code>tar.gz</code> lives on your system. Typically <code>/usr/local/go</code></li>\n<li>GOHOME does not need to be set. If you set it, use <code>unset</code></li>\n<li>GOPATH is the location of your workspace, you need to <code>mkdir</code> to create that folder as well as set the GOPATH environment variable.</li>\n<li>Your path needs to included <code>$GOROOT/bin:$GOPATH/bin</code> for the setup to function.</li>\n</ul>\n\n<p>Usage of custom scripts that effect <code>.zshrc</code> or <code>bashrc</code> or <code>profile</code> should not contain setting of <code>$GOROOT</code>!!</p>\n"}, {"tags": [], "owner": {"reputation": 3755, "user_id": 1940850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zqElV.png?s=128&g=1", "display_name": "karel", "link": "https://stackoverflow.com/users/1940850/karel"}, "is_accepted": false, "score": 1, "last_activity_date": 1521236193, "last_edit_date": 1592644375, "creation_date": 1511288644, "answer_id": 47420118, "question_id": 32633131, "link": "https://stackoverflow.com/questions/32633131/go-setup-on-ubuntu/47420118#47420118", "title": "Go setup on ubuntu", "body": "<h3>For golang-go from the Ubuntu repositories</h3>\n<p>This answer refers to the golang-go package from the default Ubuntu repositories, not the go-lang package that can be installed using ubuntu-make.</p>\n<p>The key to understanding your question is the following line:</p>\n<pre><code>GOROOT=&quot;/usr/local/opt/go/libexec&quot;\n</code></pre>\n<p>If you typed the command <code>echo $GOROOT</code> it would return:</p>\n<pre><code>/usr/local/opt/go/libexec\n</code></pre>\n<p>This is not what you want GOROOT to be in an installation of golang-go from the default Ubuntu repositories. In a default golang-go installation in Ubuntu GOROOT refers to the root of the directories where go is installed. Running the command <code>which go</code> returns <code>/usr/bin/go</code> and examining the <code>/usr/bin/go</code> file reveals that it is symlinked to the go executable file located at <code>/usr/lib/go-1.6/bin/go</code> . There is your missing GOROOT. If you installed golang-go using the command <code>sudo apt install golang-go</code> GOROOT is the root directory of all the go files that are installed by golang-go; it is <code>/usr/lib/go-1.6</code> !</p>\n<p>It remains to apply the change in GOROOT to <code>/etc/environment</code> by editing the environment file in nano text editor with the following command:</p>\n<pre><code>sudo nano /etc/environment\n</code></pre>\n<p>Right after where it says <code>PATH=&quot;</code> in <code>/etc/environment</code> insert the following text to add it to the PATH:</p>\n<pre><code>/usr/lib/go-1.6:\n</code></pre>\n<p>Press the keyboard combination <kbd>Ctrl</kbd>+<kbd>O</kbd> and after that press <kbd>Enter</kbd> to save the file being edited in nano to its current location. Press the keyboard combination <kbd>Ctrl</kbd>+<kbd>X</kbd> to exit nano.</p>\n<p>The <code>:</code> character after <code>/usr/lib/go-1.6</code> is the delimiter character which separates the go path from the next path. It is advisable to check your work for accuracy with the following command:</p>\n<pre><code>cat /etc/environment\n</code></pre>\n<p>Now that you have updated the PATH you need to reload <code>/etc/environment</code> by logging out and logging back in.</p>\n"}, {"tags": [], "owner": {"reputation": 191, "user_id": 7588896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/949e623bb4766cb6090bbd3ca40cad06?s=128&d=identicon&r=PG&f=1", "display_name": "twitu", "link": "https://stackoverflow.com/users/7588896/twitu"}, "is_accepted": false, "score": 0, "last_activity_date": 1572097403, "creation_date": 1572097403, "answer_id": 58571322, "question_id": 32633131, "link": "https://stackoverflow.com/questions/32633131/go-setup-on-ubuntu/58571322#58571322", "title": "Go setup on ubuntu", "body": "<p>Adding to @sadlil's answer, you can have a compound <code>GOPATH</code>. You might have a separate directory where you have all your projects and you want to keep this directory structure. Create a go directory in your <code>all_projects</code> directory and append it to the <code>GOPATH</code>.</p>\n\n<p>This is my <code>.bashrc</code>.</p>\n\n<pre><code>export GOPATH=$HOME/go\nexport PATH=$PATH:/usr/local/go/bin:$GOPATH/bin\nexport GOPATH=$GOPATH:$HOME/all_projects/go  # add projects directory\n</code></pre>\n\n<p>Another point to note is that go prefers a specific directory structure. For e.g. if you are working on a project you host at github.com, you can have the following directory structure.</p>\n\n<pre><code>   go\n   |-bin\n   |-pkg\n   |-src\n   |---github.com\n   |-----username\n   |-------reponame\n</code></pre>\n\n<p>This <a href=\"https://youtu.be/PGq6CPff2EY\" rel=\"nofollow noreferrer\">youtube video</a> was very helpful in setting up VS Code for go.</p>\n"}], "owner": {"reputation": 28145, "user_id": 501187, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2bf8dee0b3c004589b62a9b0db09b04a?s=128&d=identicon&r=PG", "display_name": "Fresheyeball", "link": "https://stackoverflow.com/users/501187/fresheyeball"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2848, "favorite_count": 0, "accepted_answer_id": 32659724, "answer_count": 4, "score": 7, "last_activity_date": 1572097403, "creation_date": 1442500698, "last_edit_date": 1442502432, "question_id": 32633131, "link": "https://stackoverflow.com/questions/32633131/go-setup-on-ubuntu", "title": "Go setup on ubuntu", "body": "<p>I am trying to setup a go dev environment on Ubuntu, and having no luck. Following directions here <a href=\"https://github.com/golang/go/wiki/Ubuntu\" rel=\"noreferrer\">https://github.com/golang/go/wiki/Ubuntu</a> </p>\n\n<pre><code>sudo apt-get install golang\n</code></pre>\n\n<p>Then I </p>\n\n<pre><code>mkdir $HOME/golang\nexport GOPATH=$HOME/golang\n</code></pre>\n\n<p>No dice. Even doing something simple like <code>go version</code> throws the following error:</p>\n\n<pre><code>go: cannot find GOROOT directory: /usr/local/opt/go/libexec\n</code></pre>\n\n<p>Everywhere I look online says simply not to set <code>GOROOT</code>. Please help, I don't understand where to go from here. This is a fresh install on a fresh VM.</p>\n\n<hr>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCHAR=\"6\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/isaac/golang\"\nGORACE=\"\"\nGOROOT=\"/usr/local/opt/go/libexec\"\nGOTOOLDIR=\"/usr/local/opt/go/libexec/pkg/tool/linux_amd64\"\nTERM=\"dumb\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-g -O2 -fPIC -m64 -pthread\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1442498439, "post_id": 32632243, "comment_id": 53113419, "body": "This is only by chance. The race detector doesn&#39;t see the race is f() doesn&#39;t execute."}, {"owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442498708, "post_id": 32632243, "comment_id": 53113612, "body": "@JimB If I add <code>time.Sleep</code> to wait, there is still no race and output is 1 so <code>f</code> runs."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1442499990, "post_id": 32632243, "comment_id": 53114512, "body": "I see. Though your test is incorrect (and a sleep is not assurance that the goroutine will run), copying the value into an interface seems to have this curious behavior. (BTW the race detector is only guaranteed to have no false positives, so it can occasionally miss things)"}, {"owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442500015, "post_id": 32632243, "comment_id": 53114534, "body": "@JimB What you say about sleep is correct but here it suffices by seeing result. I already suspected your explanation about copy but wanted to ensure and see a proper answer so that I may learn something new. False positives, yes, better to check with race but we can&#39;t take no race granted."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442500572, "post_id": 32632243, "comment_id": 53114960, "body": "Filed here for reference: <a href=\"https://golang.org/issue/12664\" rel=\"nofollow noreferrer\">golang.org/issue/12664</a>"}, {"owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442501758, "post_id": 32632243, "comment_id": 53115811, "body": "@JimB Thanks. +1 for waiting via channel instead of sleep."}], "answers": [{"tags": [], "owner": {"reputation": 74157, "user_id": 82219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6ac2affc83317e12b56694ba7926d7f5?s=128&d=identicon&r=PG", "display_name": "tux21b", "link": "https://stackoverflow.com/users/82219/tux21b"}, "is_accepted": false, "score": 0, "last_activity_date": 1442865073, "creation_date": 1442865073, "answer_id": 32703407, "question_id": 32632243, "link": "https://stackoverflow.com/questions/32632243/different-output-in-race-detector-for-println-and-fmt-println/32703407#32703407", "title": "Different output in race detector for println and fmt.Println", "body": "<p>The race detector is a dynamic testing tool and no static analysis. In order to get reliable results from the race detector, you should strife for a high test coverage of your program, preferable by writing lots of <a href=\"https://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"nofollow\">benchmarks</a> using multiple processes (by setting GOMAXPROCS > 1, GOMAXPROCS=NumCPU is the default for Go 1.5) and use a continuous integration tool that executes those tests regularly.</p>\n\n<p>The race detector does not report any false positives so you should take every output serious. On the other hand it might not detect every race on every run, depending on the order goroutines and processes are scheduled.</p>\n\n<p>In your example, wrapping everything in a tight loop and re-executing the tests reports the race correctly in both cases.</p>\n"}], "owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1442865073, "creation_date": 1442498370, "question_id": 32632243, "link": "https://stackoverflow.com/questions/32632243/different-output-in-race-detector-for-println-and-fmt-println", "title": "Different output in race detector for println and fmt.Println", "body": "<p>I have a different output for <code>println</code> and <code>fmt.Println</code> in race detector which I couldn't explain. I expected both to be race, or at least both to be no race.</p>\n\n<pre><code>package main\n\nvar a int\n\nfunc f() {\n    a = 1\n}\n\nfunc main() {\n    go f()\n    println(a)\n}\n</code></pre>\n\n<p>And, it finds race condition as expected.</p>\n\n<pre><code>0\n==================\nWARNING: DATA RACE\nWrite by goroutine 5:\n  main.f()\n/home/felmas/test.go:6 +0x30\n\nPrevious read by main goroutine:\n  main.main()\n/home/felmas/test.go:11 +0x4d\n\nGoroutine 5 (running) created at:\n  main.main()\n/home/felmas/test.go:10 +0x38\n==================\nFound 1 data race(s)\n</code></pre>\n\n<p>However, this one runs without any detected race.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nvar a int\n\nfunc f() {\n    a = 1\n}\n\nfunc main() {\n    go f()\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>To my knowledge, no race is detected doesn't mean there is no race so is this one of these deficiencies or is there a deeper explanation since <code>println</code> is builtin and quite special?</p>\n"}, {"tags": ["linux", "go", "ssl-certificate", "x509"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442498117, "post_id": 32631289, "comment_id": 53113174, "body": "Is this what you&#39;re looking for? <a href=\"http://stackoverflow.com/questions/21562269/golang-how-to-specify-certificate-in-tls-config-for-http-client\" title=\"golang how to specify certificate in tls config for http client\">stackoverflow.com/questions/21562269/&hellip;</a>"}, {"owner": {"reputation": 67096, "user_id": 265521, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/34a66330977044d70165288c56740d4b?s=128&d=identicon&r=PG", "display_name": "Timmmm", "link": "https://stackoverflow.com/users/265521/timmmm"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442501004, "post_id": 32631289, "comment_id": 53115273, "body": "No, they specify a new root pool that they use with a custom <code>http.Client</code>. They don&#39;t replace the system roots. However I have found another way (answer in a minute...)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442501719, "post_id": 32631289, "comment_id": 53115778, "body": "you don&#39;t need to replace <code>systemRoots</code>, it&#39;s only providing a default. What can&#39;t you do with with a custom <code>tls.Config</code> and your own <code>RootCAs</code>."}, {"owner": {"reputation": 67096, "user_id": 265521, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/34a66330977044d70165288c56740d4b?s=128&d=identicon&r=PG", "display_name": "Timmmm", "link": "https://stackoverflow.com/users/265521/timmmm"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442561337, "post_id": 32631289, "comment_id": 53139973, "body": "The key was <code>http.DefaultTransport.TLSClientConfig</code>. The other question doesn&#39;t mention it. (This isn&#39;t a duplicate; I don&#39;t know why you marked it as such.)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1442580379, "post_id": 32631289, "comment_id": 53151325, "body": "Sorry, It seemed you were having trouble creating the tls.Config with custom RootCAs, and assigning it to the default was the obvious part."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1442580687, "post_id": 32633715, "comment_id": 53151543, "body": "You doesn&#39;t affect any tls functions, you&#39;re assigning something in the http package. You do need to assign this before you use http.DefaultTransport, which is used by any http.Client with no Transport defined."}], "tags": [], "owner": {"reputation": 67096, "user_id": 265521, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/34a66330977044d70165288c56740d4b?s=128&d=identicon&r=PG", "display_name": "Timmmm", "link": "https://stackoverflow.com/users/265521/timmmm"}, "is_accepted": false, "score": 0, "last_activity_date": 1442502176, "creation_date": 1442502176, "answer_id": 32633715, "question_id": 32631289, "link": "https://stackoverflow.com/questions/32631289/how-to-specify-custom-ssl-roots-with-go-on-linux/32633715#32633715", "title": "How to specify custom SSL roots with Go on Linux", "body": "<p>Something like this seems to work (I actually only need one certificate chain, which you can get from Firefox easily by clicking on the SSL lock icon, More Information, View Certificate, Details, Export, Change type to \"X509 certificate with chain (PEM)\".</p>\n\n<pre><code>func initCerts() error {\n    certs := x509.NewCertPool()\n    pemData, err := ioutil.ReadFile(\"api.example.crt\")\n    if err != nil {\n        return err\n    }\n    certs.AppendCertsFromPEM(pemData)\n\n    newTlsConfig := &amp;tls.Config{}\n    newTlsConfig.RootCAs = certs\n\n    defaultTransport := http.DefaultTransport.(*http.Transport)\n    defaultTransport.TLSClientConfig = newTlsConfig\n    return nil\n}\n</code></pre>\n\n<p>I'm not certain, but the docs suggest that you must do that before using any TLS functions, so I put it at the start of my <code>main()</code>.</p>\n"}], "owner": {"reputation": 67096, "user_id": 265521, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/34a66330977044d70165288c56740d4b?s=128&d=identicon&r=PG", "display_name": "Timmmm", "link": "https://stackoverflow.com/users/265521/timmmm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 693, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1442580382, "creation_date": 1442495860, "question_id": 32631289, "link": "https://stackoverflow.com/questions/32631289/how-to-specify-custom-ssl-roots-with-go-on-linux", "title": "How to specify custom SSL roots with Go on Linux", "body": "<p>Suppose I'm using a third party network library that I don't want to modify. It uses the standard <code>http.Request</code> interface to make some HTTPS requests.</p>\n\n<p>I'm running it on an embedded Linux instance that doesn't have a certificate roots installed, and the only directory I can access is <code>/data</code>. This means you get the error:</p>\n\n<pre><code>Get https://example.com/: x509: failed to load system roots and no roots provided\n</code></pre>\n\n<p>Is there any way to actually <em>provide</em> roots? As far as I can tell <a href=\"https://golang.org/src/crypto/x509/root_linux.go\" rel=\"nofollow\">Go looks in these directories for X509 certificate roots</a> (<a href=\"https://golang.org/src/crypto/x509/root_unix.go\" rel=\"nofollow\">see also</a>):</p>\n\n<pre><code>var certFiles = []string{\n    \"/etc/ssl/certs/ca-certificates.crt\", // Debian/Ubuntu/Gentoo etc.\n    \"/etc/pki/tls/certs/ca-bundle.crt\",   // Fedora/RHEL\n    \"/etc/ssl/ca-bundle.pem\",             // OpenSUSE\n    \"/etc/pki/tls/cacert.pem\",            // OpenELEC\n}\nvar certDirectories = []string{\n    \"/system/etc/security/cacerts\", // Android\n}\n</code></pre>\n\n<p>As I said, I don't have access to those, and the <a href=\"https://golang.org/src/crypto/x509/root.go\" rel=\"nofollow\">root pool seems to be private</a> so you can't append to it:</p>\n\n<pre><code>var (\n    once        sync.Once\n    systemRoots *CertPool\n)\nfunc systemRootsPool() *CertPool {\n    once.Do(initSystemRoots)\n    return systemRoots\n}\n</code></pre>\n\n<p>Is this just impossible with Go?</p>\n"}]