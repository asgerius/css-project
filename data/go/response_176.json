[{"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1527152184, "post_id": 50498930, "comment_id": 88022221, "body": "&quot;Unit testing&quot; and &quot;fastest way&quot; sound contradictory. You should always aim for simplicity over performance in unit testing. Performance does not matter that much in tests as it does in production code. What you suggested in your answer is perfectly fine for unit tests."}], "answers": [{"comments": [{"owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "edited": false, "score": 0, "creation_date": 1527119399, "post_id": 50498976, "comment_id": 88010789, "body": "Do I need the loop at all? Do I need to set the last byte to zero?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "edited": false, "score": 0, "creation_date": 1527119509, "post_id": 50498976, "comment_id": 88010820, "body": "The only way to extend the length of the builder is to append data with Write, WriteByte, WriteRune or  WriteString.  There&#39;s no SetLength(int) or similar call."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 7, "last_activity_date": 1527166339, "last_edit_date": 1527166339, "creation_date": 1527119175, "answer_id": 50498976, "question_id": 50498930, "link": "https://stackoverflow.com/questions/50498930/fastest-way-to-allocate-a-large-string-in-go/50498976#50498976", "title": "Fastest way to allocate a large string in Go?", "body": "<p>Use <a href=\"https://godoc.org/strings#Builder\" rel=\"nofollow noreferrer\">strings.Builder</a> to allocate a string without using extra buffers.</p>\n\n<pre><code>var b strings.Builder\nb.Grow(1048577)\nfor i := 0; i &lt; 1048577; i++ {\n  b.WriteByte(0)\n}\ns := b.String()\n</code></pre>\n\n<p>The call to the <a href=\"https://godoc.org/strings#Builder.Grow\" rel=\"nofollow noreferrer\">Grow</a> method allocates a slice with capacity 1048577. The WriteByte calls fill the slice to capacity.  The <a href=\"https://godoc.org/strings#Builder.String\" rel=\"nofollow noreferrer\">String()</a> method uses <a href=\"https://godoc.org/unsafe\" rel=\"nofollow noreferrer\">unsafe</a> to convert that slice to a string.</p>\n\n<p>The cost of the loop can be reduced by writing chunks of N bytes at a time and filling single bytes at the end.  </p>\n\n<p>If you are not opposed to using the unsafe package, then use this: </p>\n\n<pre><code>p := make([]byte, 1048577)\ns := *(*string)(unsafe.Pointer(&amp;p))\n</code></pre>\n\n<p>If you are asking about how to do this with the simplest code, then use the following:</p>\n\n<pre><code>s := string(make([]byte, 1048577)\n</code></pre>\n\n<p>This approach does not meet the requirements set forth in the question. It uses an extra buffer instead of allocating the string directly.  </p>\n"}, {"comments": [{"owner": {"reputation": 3191, "user_id": 798042, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4cd3f267885c0ed5ee510e5204762598?s=128&d=identicon&r=PG&f=1", "display_name": "dotslashlu", "link": "https://stackoverflow.com/users/798042/dotslashlu"}, "edited": false, "score": 0, "creation_date": 1527213525, "post_id": 50499035, "comment_id": 88053311, "body": "This exact method was mentioned by ThunderCat originally, why not just accept his answer?"}, {"owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "reply_to_user": {"reputation": 3191, "user_id": 798042, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4cd3f267885c0ed5ee510e5204762598?s=128&d=identicon&r=PG&f=1", "display_name": "dotslashlu", "link": "https://stackoverflow.com/users/798042/dotslashlu"}, "edited": false, "score": 0, "creation_date": 1527301429, "post_id": 50499035, "comment_id": 88089446, "body": "I provided this answer when @thundercat only had the first code sample"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528237662, "post_id": 50499035, "comment_id": 88428625, "body": "I didn&#39;t answer with this originally because you asked for a solution &quot;without concatenating or using buffers&quot;.  This answer uses a buffer."}], "tags": [], "owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "is_accepted": false, "score": 3, "last_activity_date": 1527119693, "creation_date": 1527119693, "answer_id": 50499035, "question_id": 50498930, "link": "https://stackoverflow.com/questions/50498930/fastest-way-to-allocate-a-large-string-in-go/50499035#50499035", "title": "Fastest way to allocate a large string in Go?", "body": "<p>I ended up using this:</p>\n\n<pre><code>string(make([]byte, 1048577))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/afPukPc1Esr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/afPukPc1Esr</a></p>\n"}], "owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2451, "favorite_count": 2, "answer_count": 2, "score": 4, "last_activity_date": 1527166339, "creation_date": 1527118831, "question_id": 50498930, "link": "https://stackoverflow.com/questions/50498930/fastest-way-to-allocate-a-large-string-in-go", "title": "Fastest way to allocate a large string in Go?", "body": "<p>I need to create a string in Go that is 1048577 characters (1MB + 1 byte). The content of the string is totally unimportant. Is there a way to allocate this directly without concatenating or using buffers?</p>\n\n<p>Also, it's worth noting that the value of string will not change. It's for a unit test to verify that strings that are too long will return an error.</p>\n"}, {"tags": ["templates", "go", "kubernetes", "kubernetes-helm"], "comments": [{"owner": {"reputation": 41, "user_id": 3787133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6bf95fa3828608323277d8e12d56ea9?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Gerrans", "link": "https://stackoverflow.com/users/3787133/matt-gerrans"}, "edited": false, "score": 0, "creation_date": 1527195462, "post_id": 50498569, "comment_id": 88048678, "body": "That linked question is different and does not answer this one.  Added a paragraph to the original to that end."}], "owner": {"reputation": 41, "user_id": 3787133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6bf95fa3828608323277d8e12d56ea9?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Gerrans", "link": "https://stackoverflow.com/users/3787133/matt-gerrans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1474, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1528828619, "creation_date": 1527115920, "last_edit_date": 1528828619, "question_id": 50498569, "link": "https://stackoverflow.com/questions/50498569/helm-go-template-to-combine-files", "title": "Helm Go Template to Combine Files", "body": "<p>Given as set of JSON files, that contain this simplified data:\nfile1.json:</p>\n\n<pre><code>{ \"name\" : \"file1\" }\n</code></pre>\n\n<p>file2.json:</p>\n\n<pre><code>{ \"name\" : \"file2\" }\n</code></pre>\n\n<p>And so on.\nI want to create a config map that ends up with the content of these files combined into a JSON map that looks like this:</p>\n\n<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: jsondata\ndata:\n  jsondata: |-\n    {\n      \"file1\":  { \"name\" : \"file1\" },\n      \"file2\":  { \"name\" : \"file2\" }\n    }\n</code></pre>\n\n<p>Note that the last item should not be followed by a comma. If I create template yaml that looks like this:</p>\n\n<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: jsondata\ndata:\n  jsondata: |-\n    {\n{{- $root := . }}\n{{- range $path, $bytes := .Files.Glob \"data/json/*.json\" }}\n  {{ base $path | replace \".json\" \"\" | quote | indent 4 }}:\n  {{ $root.Files.Get $path | indent 6 }}\n  {{- \",\" }}\n{{- end }}\n    }\n</code></pre>\n\n<p>I end up with an extra comma after the <em>file2</em> element, which breaks the json syntax.</p>\n\n<p>How can I iterate over the files and know where I am (on the first or the last) so I can control whether to insert the comma or not?   I've tried to figure out how to get the keys of the <strong>glob</strong> result into a <strong>list</strong> so I could use <strong>first</strong> and <strong>rest</strong>, but can't figure out what that syntax would be in the go template.</p>\n\n<p>This is not a duplicate of <a href=\"https://stackoverflow.com/questions/50085038/detect-last-item-inside-an-array-using-range-inside-go-templates\">detect last item inside an array using range inside go-templates</a> unless you can show how to get the glob results into an array that has an index.  The glob result doesn't have an index, it is a dictionary of file name / bytes.</p>\n\n<p><strong>Update</strong>:\nHmm, I guess this question is dead because it was <strong>incorrectly</strong> flagged as a \"duplicate.\"  It is a shame this system has this way of shutting something down when it isn't really a duplicate.</p>\n\n<p>For the interest of those who really need to solve a problem like this and are not helped by the substantially unrelated link to the \"duplicate\" that works on a simple list, here is a solution:</p>\n\n<pre><code>data:\n  appdata: |-\n    {\n      {{- $candidates := .Files.Glob \"data/json/*.json\" -}}\n      {{- $valuesJson := toJson $candidates -}}\n      {{- $filesMap := fromJson $valuesJson -}}\n      {{- $outputMap := dict -}}\n      {{- range $index, $filename := keys $filesMap -}}\n        {{- $fileContents := $.Files.Get $filename -}}\n        {{- $fileContentMap := fromJson $fileContents -}}\n        {{- $contentName := pluck \"name\" $fileContentMap | first -}}\n        {{- $_ := set $outputMap $filename $contentName -}}\n      {{- end -}}\n      {{- range $index, $filename := keys $outputMap -}}\n        {{- if ne $index 0 -}}\n          ,\n        {{- end -}}\n        {{- pluck $filename $outputMap | first | printf \"%q:\" | nindent 6 -}}\n        {{- $.Files.Get $filename | nindent 8 -}}\n      {{- end }}\n    }\n</code></pre>\n"}, {"tags": ["go", "aws-lambda", "amazon-kinesis"], "answers": [{"tags": [], "owner": {"reputation": 1278, "user_id": 108826, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/861ed516fb54db2217b7e90aee1d2d3f?s=128&d=identicon&r=PG&f=1", "display_name": "S2201", "link": "https://stackoverflow.com/users/108826/s2201"}, "is_accepted": true, "score": 0, "last_activity_date": 1527400291, "last_edit_date": 1527400291, "creation_date": 1527144976, "answer_id": 50502875, "question_id": 50497712, "link": "https://stackoverflow.com/questions/50497712/aws-lambda-golang-handler-api/50502875#50502875", "title": "AWS Lambda GoLang handler API", "body": "<p>Seems like the solution is quite simple. Just overwrite the lambda.Start() method:</p>\n\n<pre><code>func Start(handler func(t * MySpecificType, i int) error) {\n\n    lambda.Start(func(kinesisEvent events.KinesisEvent) (err error) {\n\n        for i, record := range kinesisEvent.Records {\n\n            mySpecType := new(MySpecificType)\n            if err = json.Unmarshal(record.Kinesis.Data, mySpecType); err != nil {\n                logrus.Errorf(\"records[%d]: %s\", i, err)\n                continue\n            }\n\n            err = handler(mySpecType, i)\n        }\n        return\n    })\n}\n</code></pre>\n\n<p>and then:</p>\n\n<pre><code>// main.go\nfunc Handler(m *MySpecificType, index int) error {\n// ...\n}\n\nfunc main() {\n    &lt;wherever_you_put_it_package&gt;.Start(Handler)\n    // instead of lambda.Start(Handler)\n}\n</code></pre>\n"}], "owner": {"reputation": 1278, "user_id": 108826, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/861ed516fb54db2217b7e90aee1d2d3f?s=128&d=identicon&r=PG&f=1", "display_name": "S2201", "link": "https://stackoverflow.com/users/108826/s2201"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 617, "favorite_count": 0, "accepted_answer_id": 50502875, "answer_count": 1, "score": 0, "last_activity_date": 1527400291, "creation_date": 1527110746, "last_edit_date": 1527113773, "question_id": 50497712, "link": "https://stackoverflow.com/questions/50497712/aws-lambda-golang-handler-api", "title": "AWS Lambda GoLang handler API", "body": "<p>Is it possible to implement Lambda function handler with custom API?</p>\n\n<p>For aws-lambda-go the valid handler is one of following types:</p>\n\n<pre><code>//  func ()\n//  func () error\n//  func (TIn) error\n//  func () (TOut, error)\n//  func (TIn) (TOut, error)\n//  func (context.Context) error\n//  func (context.Context, TIn) error\n//  func (context.Context) (TOut, error)\n//  func (context.Context, TIn) (TOut, error)\n</code></pre>\n\n<p>In my case, <code>TIn</code> is KinesisEvent containing <code>MySpecificType</code> as a payload.\nI'm looking for the way (maybe to overwrite <code>lambda.Start()</code>) to be able to create the handler of type</p>\n\n<pre><code>func(MySpecificType) error\n</code></pre>\n\n<p>The goal is to avoid extracting the payload from KinesisEvent in every lambda and make the handler source independent</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1527102318, "post_id": 50495722, "comment_id": 88004175, "body": "What is a &quot;view&quot;?"}, {"owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527102420, "post_id": 50495722, "comment_id": 88004234, "body": "@JimB it is template not view sorry"}], "answers": [{"comments": [{"owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "edited": false, "score": 0, "creation_date": 1527102733, "post_id": 50495820, "comment_id": 88004386, "body": "ok thanks for this"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1527102770, "last_edit_date": 1527102770, "creation_date": 1527102611, "answer_id": 50495820, "question_id": 50495722, "link": "https://stackoverflow.com/questions/50495722/how-to-do-for-loop-on-template-not-range-in-go/50495820#50495820", "title": "How to do for loop on template (not range) in Go?", "body": "<p>This is not supported. <code>range</code> is the only way to form a loop in Go templates. You can feed it the output of a function that produces a for loop for you. The <a href=\"https://godoc.org/github.com/Masterminds/sprig\" rel=\"nofollow noreferrer\"><code>until</code></a> function from the sprig library does something like this. It would be trivial to create your own, as well.</p>\n"}], "owner": {"reputation": 2195, "user_id": 1108279, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ceab1df9b9083d662c34efd1b7c7868?s=128&d=identicon&r=PG", "display_name": "pregmatch", "link": "https://stackoverflow.com/users/1108279/pregmatch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 992, "favorite_count": 0, "closed_date": 1527105836, "accepted_answer_id": 50495820, "answer_count": 1, "score": 0, "last_activity_date": 1527104765, "creation_date": 1527102259, "last_edit_date": 1527104765, "question_id": 50495722, "link": "https://stackoverflow.com/questions/50495722/how-to-do-for-loop-on-template-not-range-in-go", "closed_reason": "Duplicate", "title": "How to do for loop on template (not range) in Go?", "body": "<p>Simple, i need for loop in golang on view(template). I can not seams to find on how to do that. Or how to do same thing with <code>range</code>?</p>\n\n<pre><code>a := []int{1, 2, 3}\n\nfor i := 1; i &lt;= len(a); i++ {\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>how to do this on view?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1527096241, "post_id": 50494136, "comment_id": 88001158, "body": "Please include your definition for <code>Event</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1527096477, "post_id": 50494136, "comment_id": 88001257, "body": "<code>chan Event</code> and <code>chan FileEvent</code> are different types. You can\u2019t assign one to the other, as discussed in the linked document."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1527096453, "creation_date": 1527096453, "answer_id": 50494209, "question_id": 50494136, "link": "https://stackoverflow.com/questions/50494136/cannot-get-slices-of-interfaces-to-work/50494209#50494209", "title": "Cannot get slices of interfaces to work", "body": "<p><code>Event</code> may be an interface type, but <code>chan Event</code> is not; it is a specific channel type. A <code>[]chan Event</code> is a slice, in which every element must be of type <code>chan Event</code>. However, a <code>chan Event</code> could accept messages of any type implementing <code>Event</code>.</p>\n\n<p>Why? Consider this code:</p>\n\n<pre><code>chans := []chan Event {\n    make(chan FileEvent),\n    make(chan NetworkEvent),\n}\n\nch := chans[0] // ch is of type chan Event because that's the type of elements of chans\nch &lt;- NetworkEvent{} // Uh oh - we just tried to send a NetworkEvent to what's actually a chan FileEvent!\n</code></pre>\n\n<p>The send would be compile-time legal if your code were legal, but would cause a runtime type error, which is not allowed in Go as it uses strict static typing.</p>\n\n<p>You could, however, make them all <code>chan Event</code>, and then you could send whatever types you needed, and use type assertions when receiving from those channels.</p>\n"}], "owner": {"reputation": 165, "user_id": 4891517, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/71e2a6293b83f5da7fd6709b50444880?s=128&d=identicon&r=PG&f=1", "display_name": "Karsten Morks", "link": "https://stackoverflow.com/users/4891517/karsten-morks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 50494209, "answer_count": 1, "score": -4, "last_activity_date": 1527096467, "creation_date": 1527096134, "last_edit_date": 1527096467, "question_id": 50494136, "link": "https://stackoverflow.com/questions/50494136/cannot-get-slices-of-interfaces-to-work", "title": "Cannot get slices of interfaces to work", "body": "<p>What I'm trying to do is to create a slice of an <code>interface</code> type and populating it with some struct types that are implementing this interface.</p>\n\n<pre><code>chans := []chan Event {\n    make(chan FileEvent),\n    make(chan NetworkEvent),\n}\n</code></pre>\n\n<p>But this fails with <code>cannot use make(chan FileEvent) (type chan FileEvent) as type chan Event in array or slice literal</code>.</p>\n\n<p>Now I am aware that this is <a href=\"https://github.com/golang/go/wiki/InterfaceSlice\" rel=\"nofollow noreferrer\">meant to be that way</a>.<br>\nHowever the suggested solution is a) not practical because I have a bunch of different types and cannot easily iterate over them and b) I cannot even get it to work, it still gives me the same error. I tried:</p>\n\n<pre><code>chans := make([]chan Event, 2)\nchans[0] = make(chan FileEvent)\n</code></pre>\n\n<p>Do you guys know what I'm doing wrong or how this can be solved elegantly? Thanks a lot !!</p>\n\n<p>Here are the definitions of the types:</p>\n\n<pre><code>type Event interface {\n  GetId() string\n}\n\ntype FileEvent struct {\n}\n\nfunc (e FileEvent) GetId() string {\n  return \"FileEvent\"\n}\n</code></pre>\n"}, {"tags": ["go", "websocket", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1527097124, "post_id": 50494330, "comment_id": 88001588, "body": "Ah right, I meant to say error from the subsequent call to WriteMessage. Thanks for the info, this is very helpful!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1527096899, "creation_date": 1527096899, "answer_id": 50494330, "question_id": 50494034, "link": "https://stackoverflow.com/questions/50494034/interpretation-of-setwritedeadline-error/50494330#50494330", "title": "Interpretation of SetWriteDeadline error", "body": "<p>Websocket connections are independent of other websocket connections.  </p>\n\n<p>Websocket connections have an underlying network connection. These network connections are also independent of each other. </p>\n\n<p>An error returned from SetWriteDeadline indicates a problem with that specific websocket connection or the websocket connection's underlying network connection.</p>\n\n<p>Also note that <a href=\"https://github.com/gorilla/websocket/blob/21ab95fa12b9bdd8fecf5fa3586aad941cc98785/conn.go#L761-L764\" rel=\"nofollow noreferrer\">Gorilla's SetWriteDeadline</a> method never returns an error. </p>\n"}], "owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 50494330, "answer_count": 1, "score": 0, "last_activity_date": 1527096899, "creation_date": 1527095804, "last_edit_date": 1527095860, "question_id": 50494034, "link": "https://stackoverflow.com/questions/50494034/interpretation-of-setwritedeadline-error", "title": "Interpretation of SetWriteDeadline error", "body": "<p>I am writing a websocket server in Go that broadcasts messages to clients. I use SetWriteDeadline on each send so that the broadcast loop doesn't get stuck.</p>\n\n<p>My question is: how do I interpret an error from SetWriteDeadline? In particular, should I assume that there is something wrong with that particular client and unregister it? Or is it a server-side issue that happened to get triggered on this client?</p>\n\n<p>After researching SetWriteDeadline, I found that the deadline is for putting the message on the TCP stack server-side, <em>not</em> for the client to receive the message. So perhaps a better way to phrase my question is this: is there a separate TCP stack for each websocket client (perhaps this is the thing that has size WriteBufferSize), or is this buffer shared between clients? In the former case it seems like I should unregister the client on a SetWriteDeadline error, but not in the latter case.</p>\n"}, {"tags": ["docker", "go", "dockerfile", "codeship"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user745235"}, "edited": false, "score": 0, "creation_date": 1527106036, "post_id": 50493851, "comment_id": 88006034, "body": "Sorry but I don&#39;t get how it is related to Go."}, {"owner": {"reputation": 6511, "user_id": 99089, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/ge49Z.jpg?s=128&g=1", "display_name": "Paul J. Lucas", "link": "https://stackoverflow.com/users/99089/paul-j-lucas"}, "edited": false, "score": 0, "creation_date": 1527106160, "post_id": 50493851, "comment_id": 88006104, "body": "@Gerep Only peripherally, granted. It&#39;s a go service that&#39;s being built and it starts with the <code>golang:1.10</code> docker image."}], "answers": [{"tags": [], "owner": {"reputation": 4435, "user_id": 30545, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b5cd9155ff71d0971b0a8236d343615b?s=128&d=identicon&r=PG", "display_name": "mikefrey", "link": "https://stackoverflow.com/users/30545/mikefrey"}, "is_accepted": false, "score": 0, "last_activity_date": 1566371295, "creation_date": 1566371295, "answer_id": 57586243, "question_id": 50493851, "link": "https://stackoverflow.com/questions/50493851/docker-multi-stage-builds-and-codeship-running-container/57586243#57586243", "title": "Docker multi-stage builds and Codeship running container", "body": "<p>I was able to solve this problem using multi-stage builds split into two different files following this guide: <a href=\"https://documentation.codeship.com/pro/common-issues/caching-multi-stage-dockerfile/\" rel=\"nofollow noreferrer\">https://documentation.codeship.com/pro/common-issues/caching-multi-stage-dockerfile/</a></p>\n\n<p>Basically, you'll take your existing Dockerfile and split it into two files like so, with the second referencing the first:</p>\n\n<pre><code># Dockerfile.build-stage\nFROM golang:1.10 as build-stage\n\nENV TEMP /go/src/github.com/my-id/my-go-project\nWORKDIR $TEMP\nCOPY . .\nRUN make build\n</code></pre>\n\n<pre><code># Dockerfile\nFROM build-stage as build-stage\n\nFROM alpine:3.4\n\n# ...\nENV HOME /home/$USER\nENV TEMP /go/src/github.com/my-id/my-go-project\n\nCOPY --from=build $TEMP/bin/my-daemon $HOME/bin/\nRUN chown -R $USER:$GROUP $HOME\n\nUSER $USER\nENTRYPOINT [\"my-daemon\"]\n</code></pre>\n\n<p>Then, in your codeship-service.yml file:</p>\n\n<pre><code># codeship-services.yml\ncachemanager-build:\n  build:\n    dockerfile: Dockerfile.build-stage\ncachemanager-app:\n  build:\n    image: my-daemon\n    dockerfile: Dockerfile\n</code></pre>\n\n<p>And in your codeship-steps.yml file:</p>\n\n<pre><code># codeship-steps.yml\n- name: cachemanager build\n  tag: master\n  service: cachemanager-build\n  command: &lt;here you can run tests or linting&gt;\n- name: publish to registry\n  tag: master\n  service: cachemanager-app\n  ...\n</code></pre>\n\n<p>I don't think you want to actually run the <code>Dockerfile</code> because it will start your app. We use the second stage to push a smaller build to an image registry.</p>\n"}], "owner": {"reputation": 6511, "user_id": 99089, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/ge49Z.jpg?s=128&g=1", "display_name": "Paul J. Lucas", "link": "https://stackoverflow.com/users/99089/paul-j-lucas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 197, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566371295, "creation_date": 1527095045, "last_edit_date": 1527099671, "question_id": 50493851, "link": "https://stackoverflow.com/questions/50493851/docker-multi-stage-builds-and-codeship-running-container", "title": "Docker multi-stage builds and Codeship running container", "body": "<p>I'm doing a multi-stage Docker build:</p>\n\n<pre><code># Dockerfile\n\n########## Build stage ##########\nFROM golang:1.10 as build\n\nENV TEMP /go/src/github.com/my-id/my-go-project\nWORKDIR $TEMP\nCOPY . .\nRUN make build\n\n########## Final stage ##########\nFROM alpine:3.4\n\n# ...\nENV HOME /home/$USER\nENV TEMP /go/src/github.com/my-id/my-go-project\n\nCOPY --from=build $TEMP/bin/my-daemon $HOME/bin/\nRUN chown -R $USER:$GROUP $HOME\n\nUSER $USER\nENTRYPOINT [\"my-daemon\"]\n</code></pre>\n\n<p>and the <code>Makefile</code> contains in part:</p>\n\n<pre><code>build: bin\n        go build -v -o bin/my-daemon cmd/my-daemon/main.go\n\nbin:\n        mkdir $@\n</code></pre>\n\n<p>This all works just fine with a <code>docker build</code>.</p>\n\n<hr>\n\n<p>Now I want to use <a href=\"https://codeship.com\" rel=\"nofollow noreferrer\">Codeship</a>, so I have:</p>\n\n<pre><code># codeship-services.yml\ncachemanager:\n  build:\n    image: my-daemon\n    dockerfile: Dockerfile\n</code></pre>\n\n<p>and:</p>\n\n<pre><code># codeship-steps.yml\n- name: my-daemon build\n  tag: master\n  service: my-service\n  command: true\n</code></pre>\n\n<p>The issue is if I do <code>jet steps --master</code>, it builds everything OK, but then <em>runs</em> the container as if I did a <code>docker run</code>. Why? I <em>don't</em> want it to do that.</p>\n\n<p>It's as if I would have to have two <em>separate</em> <code>Dockerfile</code>s: one <em>only</em> for the build stage and one <em>only</em> for the run stage and use the former with <code>jet</code>. But then this defeats the point of Docker multi-stage builds.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 2, "creation_date": 1527091079, "post_id": 50492794, "comment_id": 87998457, "body": "For initializing a variable before main function use <code>init()</code> function"}], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1527095629, "post_id": 50492867, "comment_id": 88000846, "body": "This answer does not suggest the use of <code>init()</code>. It does answer OP&#39;s specific question."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 5, "last_activity_date": 1527091290, "creation_date": 1527091290, "answer_id": 50492867, "question_id": 50492794, "link": "https://stackoverflow.com/questions/50492794/properly-wait-for-a-global-variable-to-initialize/50492867#50492867", "title": "Properly wait for a global variable to initialize", "body": "<p><a href=\"https://golang.org/ref/spec#Program_initialization_and_execution\" rel=\"noreferrer\">Global variable initializers and package <code>init()</code> functions will always run before <code>main()</code></a>. If your <code>getGeneralConfig</code> function launches a goroutine, but you need it to complete before <code>main()</code> runs, either a) don't use a goroutine, or b) use a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"noreferrer\"><code>sync.WaitGroup</code></a> to ensure it completes before <code>getGeneralConfig</code> returns.</p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1527095685, "last_edit_date": 1527095685, "creation_date": 1527091471, "answer_id": 50492904, "question_id": 50492794, "link": "https://stackoverflow.com/questions/50492794/properly-wait-for-a-global-variable-to-initialize/50492904#50492904", "title": "Properly wait for a global variable to initialize", "body": "<p>The problem is when converting int to string. Just use <code>strconv</code> package to convert <code>int</code> value to <code>string</code> as:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nvar conf = getGeneralConfig()\n\nfunc getGeneralConfig() int {\n    return 8080\n}\n\nfunc main() {\n    //router := mux.NewRouter()\n    fmt.Println(\":\" + strconv.Itoa(conf))\n   // router.HandleFunc(\"/add\", add).Methods(\"POST\")\n   // conf is not yet ready here\n   // log.Fatal(http.ListenAndServe(\":\"+string(conf.PORT), router))\n}\n</code></pre>\n\n<p>Check <a href=\"https://play.golang.org/p/zeFNUZHyO2U\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1527094797, "last_edit_date": 1527094797, "creation_date": 1527093920, "answer_id": 50493553, "question_id": 50492794, "link": "https://stackoverflow.com/questions/50492794/properly-wait-for-a-global-variable-to-initialize/50493553#50493553", "title": "Properly wait for a global variable to initialize", "body": "<p>The variable is initialized before <code>main()</code> is run. See the <a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">package initialization section</a> of the language specification for all of the details.</p>\n\n<p>The issue is with the string conversion <code>string(conf.PORT)</code>. The <a href=\"https://golang.org/ref/spec#Conversions_to_and_from_a_string_type\" rel=\"nofollow noreferrer\">specification says this about the conversion used in the application</a>:</p>\n\n<blockquote>\n  <p>Converting a signed or unsigned integer value to a string type yields a string containing the UTF-8 representation of the integer.</p>\n</blockquote>\n\n<p>The string \"\u1f90\" is the UTF-8 encoding of the rune 8080. The fix is to use <a href=\"https://godoc.org/strconv#Itoa\" rel=\"nofollow noreferrer\">strconv.Itoa</a></p>\n\n<pre><code>log.Fatal(http.ListenAndServe(\":\"+strconv.Itoa(conf.PORT), router))\n</code></pre>\n\n<p>or <a href=\"https://godoc.org/fmt#Sprintf\" rel=\"nofollow noreferrer\">fmt.Sprintf</a> to convert the integer to a decimal representation</p>\n\n<pre><code>log.Fatal(http.ListenAndServe(fmt.Sprintf(\":%d\",conf.PORT), router))\n</code></pre>\n\n<p>A more flexible and simpler approach is specify the complete address as a string in the configuration. This allows the IP address to be specified in the configuration.</p>\n"}], "owner": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 50493553, "answer_count": 3, "score": 0, "last_activity_date": 1527095685, "creation_date": 1527091005, "question_id": 50492794, "link": "https://stackoverflow.com/questions/50492794/properly-wait-for-a-global-variable-to-initialize", "title": "Properly wait for a global variable to initialize", "body": "<p>I have a global variable that reads a config file which I use across different functions. When I execute the main method, and try to read a value from the configuration, the value is not ready yet, so I get a weird value <code>:\u1f90</code> which is supposed to be 8080. What is the proper way for waiting for the global var to be ready. </p>\n\n<pre><code>var conf = getGeneralConfig()\n\nfunc main() {\n    router := mux.NewRouter()\n    fmt.Println(\":\" + string(conf.PORT))\n    router.HandleFunc(\"/add\", add).Methods(\"POST\")\n   // conf is not yet ready here\n    log.Fatal(http.ListenAndServe(\":\"+string(conf.PORT), router))\n}\n</code></pre>\n\n<p>Thanks in advance. </p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1527089225, "post_id": 50492110, "comment_id": 87997251, "body": "This code doesn&#39;t even compile. Aside from you should not use <code>func</code> in interface defition, <code>VersionedEventHandler</code> is a struct type, so returning a closure will never compile."}, {"owner": {"reputation": 3641, "user_id": 3139595, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/r1GRx.png?s=128&g=1", "display_name": "Edwin O.", "link": "https://stackoverflow.com/users/3139595/edwin-o"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1527089772, "post_id": 50492110, "comment_id": 87997615, "body": "hi @icza, this is not the real code, as i am using a couple of libraries, i drafted this question with the above code,  hoping that it would give an idea what i am trying to achieve"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1527090166, "post_id": 50492110, "comment_id": 87997867, "body": "I understand that, but to increase your chances to get an answer, please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1527090972, "post_id": 50492110, "comment_id": 87998399, "body": "Also what is your question about writing a test for it? If you want to test an anonymous function returned by another function, call the function, execute the function it returns, and validate the result. What specific problem/question are you having?"}, {"owner": {"reputation": 3641, "user_id": 3139595, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/r1GRx.png?s=128&g=1", "display_name": "Edwin O.", "link": "https://stackoverflow.com/users/3139595/edwin-o"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527091145, "post_id": 50492110, "comment_id": 87998491, "body": "yep @Adrian, its basically the concept to write such a test for an anonymous function that i am seeking, i am not able to bend my head around that, but i&#39;ll see if i can find any snippet that implements your recommendation above"}, {"owner": {"reputation": 3641, "user_id": 3139595, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/r1GRx.png?s=128&g=1", "display_name": "Edwin O.", "link": "https://stackoverflow.com/users/3139595/edwin-o"}, "edited": false, "score": 0, "creation_date": 1527091290, "post_id": 50492110, "comment_id": 87998590, "body": "i am essentially after the concept to do such test in the idiomatic way, i updated the question"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1527091437, "post_id": 50492110, "comment_id": 87998685, "body": "There&#39;s nothing special about it. You have a function you want to test, so test it - it doesn&#39;t matter if it&#39;s an anonymous or a named function. If you&#39;ve run into some problem testing it, post the test code you&#39;re having trouble with, not just the code to be tested."}, {"owner": {"reputation": 3641, "user_id": 3139595, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/r1GRx.png?s=128&g=1", "display_name": "Edwin O.", "link": "https://stackoverflow.com/users/3139595/edwin-o"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527091542, "post_id": 50492110, "comment_id": 87998733, "body": "alright coolio @Adrian , gona follow you and see what comes out, functional programing is just curvy to me :))"}], "answers": [{"tags": [], "owner": {"reputation": 410, "user_id": 997132, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6prH5.jpg?s=128&g=1", "display_name": "William", "link": "https://stackoverflow.com/users/997132/william"}, "is_accepted": false, "score": 3, "last_activity_date": 1527098354, "last_edit_date": 1527098354, "creation_date": 1527096015, "answer_id": 50494104, "question_id": 50492110, "link": "https://stackoverflow.com/questions/50492110/testing-a-go-closure/50494104#50494104", "title": "testing a go closure", "body": "<p>It would help to have a working example, so I provided one.\n For this simple case, it would probbably suffice to just have a dict which maps version numbers to functions which handle the saving of an order. But I have tried to implement closer to what you have provided, with an order handler interface.</p>\n\n<p>For testing, you will want some sort of log to capture side effects, so that you can verify that the correct handler is being called. To do that, I added a global string array called eventLog which can be appended to. For testing, you will want to create more MultiVersionHandlers, and more test Messages. </p>\n\n<p>You will want to verify that the handlers respond to the test messages in the way you imagine, by calling the save() method on the handlers and comparing the contents of the eventLog with what you expected. Also, you will want to create messages that should fail. These messages would not map to a version that the handler supports. You then verify that the proper error value is returned. I have done some of this for you. </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype MultiVersionHandler struct {\n    handlers map[int]OrderRepoInterface\n}\n\ntype Message struct {\n    version int\n    payload string\n}\n\ntype OrderRepoInterface interface {\n    save(Message) error\n}\n\ntype OrderHandler struct {\n    saveHandler func(Message) error\n}\n\n// let's implement the OrderRepoInterface for a regular order handler\nfunc (oh OrderHandler) save(msg Message) error {\n    return oh.saveHandler(msg)\n}\n\n// let's implement the OrderRepoInterface for a multi version order handler\nfunc (mh MultiVersionHandler) save(msg Message) error {\n\n    if handler, ok := mh.handlers[msg.version]; ok {\n        return handler.save(msg)\n    }\n\n    return fmt.Errorf(\"doesn't support version %d, payload %q\",\n            msg.version,\n            msg.payload)\n\n}\n\n// We will use eventLog capture simulations of a log of events which\n// happen via our handlers. Useful for verification.\nvar eventLog = []string{}\n\nfunc main() {\n\n    multiHandler := MakeMultiHandler()\n\n    msg1 := Message{payload: \"make me a burger\", version: 1}\n\n    msg2 := Message{payload: \"make me a cake\", version: 2}\n\n    msg3 := Message{payload: \"make me a robot\", version: 3}\n\n    // Create a message which has no handler.\n    // This message for version 4, should cause an error.\n    msg4 := Message{payload: \"make me a planet\", version: 4}\n\n    err := multiHandler.save(msg1)\n    err  = multiHandler.save(msg2)\n    err  = multiHandler.save(msg3)\n    err  = multiHandler.save(msg4)\n    if err != nil {\n        fmt.Printf(\"Expecting an error: %q\\n\", err.Error())\n        // Expecting an error: \n        //  \"does not have a handler for version 4.\n        //   Cannot process payload \"make me a planet\"\"\n\n    }\n\n    fmt.Printf(\"Event Log:%#v\", eventLog)\n    // Event Log:[]string{\n    //   \"Amy will make me a burger\", \n    //   \"Brandy will make me a cake\", \n    //   \"Caleb will make me a robot\"}        \n\n\n\n}\n\n// This makes a multi version handler for an example. \n// You should create more of these for testing different scenarios.\nfunc MakeMultiHandler() OrderRepoInterface {\n\n    amy := OrderHandler{\n        saveHandler: func(msg Message) error {\n            action := \"Amy will \" + msg.payload\n            eventLog = append(eventLog, action)\n            return nil\n        },\n    }\n\n    brandy := OrderHandler{\n        saveHandler: func(msg Message) error {\n            action := \"Brandy will \" + msg.payload\n            eventLog = append(eventLog, action)\n            return nil\n        },\n    }\n\n    caleb := OrderHandler{\n        saveHandler: func(msg Message) error {\n            action := \"Caleb will \" + msg.payload\n            eventLog = append(eventLog, action)\n            return nil\n        },\n    }\n\n    multiHandler := MultiVersionHandler{\n        handlers: map[int]OrderRepoInterface{\n            1: amy,    // amy should handle version 1 message\n            2: brandy, // brandy should handle version 2 message\n            3: caleb,  // caleb should handle version 3 message\n        },\n    }\n\n    return multiHandler\n\n}\n</code></pre>\n"}], "owner": {"reputation": 3641, "user_id": 3139595, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/r1GRx.png?s=128&g=1", "display_name": "Edwin O.", "link": "https://stackoverflow.com/users/3139595/edwin-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 722, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1527098354, "creation_date": 1527089022, "last_edit_date": 1527091666, "question_id": 50492110, "link": "https://stackoverflow.com/questions/50492110/testing-a-go-closure", "title": "testing a go closure", "body": "<p>i have the following function that returns a closure in golang, any idea/reference how can possibly write a test for it?</p>\n\n<pre><code>  type (\n    OrderRepoInterface interface {\n       func save(msg Message) error\n    }\n\n    // OrderAggregation represents an event handler\n    EventHandler struct {\n        repo         OrderRepoInterface // in main.go i pass a concrete repository here\n    }\n\n    VersionedEventHandler struct {\n       function func(msg *Message) error\n    }\n\n    Message struct {\n       version int\n       payload string\n    }\n\n )\n\n    func (o *EventHandler) OnOrderWasCreated() VersionedEventHandler {\n        return func(msg *Message) error {\n            msg.version = 1\n            err := o.repo.save(msg)\n            return err\n        }\n    }\n</code></pre>\n\n<h3>ps</h3>\n\n<p>this is not the real code, as i am using a couple of libraries, i drafted this question with the above code,  hoping that it would give an idea what i am trying to achieve, so it may not compile</p>\n\n<h2>edit</h2>\n\n<p>what i am after is to see some idiomatic examples or ideas where a function that returns an anonymous function is tested in go.</p>\n\n<p>so i don't necessary need a working solution.</p>\n"}, {"tags": ["unit-testing", "go", "aws-lambda", "aws-sdk-go", "aws-lambda-go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1527086363, "last_edit_date": 1527086363, "creation_date": 1527085747, "answer_id": 50491002, "question_id": 50490782, "link": "https://stackoverflow.com/questions/50490782/mock-context-context-to-test-lambdacontext-fromcontext/50491002#50491002", "title": "Mock context.Context to test lambdacontext.FromContext", "body": "<p><a href=\"https://godoc.org/github.com/aws/aws-lambda-go/lambdacontext#FromContext\" rel=\"nofollow noreferrer\"><code>lambda.FromContext()</code></a> checks if the passed <a href=\"https://golang.org/pkg/context/#Context\" rel=\"nofollow noreferrer\"><code>context.Context</code></a> contains a value with a \"private\" key hold inside the <a href=\"https://godoc.org/github.com/aws/aws-lambda-go/lambdacontext\" rel=\"nofollow noreferrer\"><code>lambdacontext</code></a> package:</p>\n\n<pre><code>// An unexported type to be used as the key for types in this package.\n// This prevents collisions with keys defined in other packages.\ntype key struct{}\n\n// The key for a LambdaContext in Contexts.\n// Users of this package must use lambdacontext.NewContext and lambdacontext.FromContext\n// instead of using this key directly.\nvar contextKey = &amp;key{}\n\n// FromContext returns the LambdaContext value stored in ctx, if any.\nfunc FromContext(ctx context.Context) (*LambdaContext, bool) {\n    lc, ok := ctx.Value(contextKey).(*LambdaContext)\n    return lc, ok\n}\n</code></pre>\n\n<p>You cannot access this key, and you can't \"reproduce\" it (you can't create a value that will be equal to this \"private\" key).</p>\n\n<p>But there's an easy way, simply use the <a href=\"https://godoc.org/github.com/aws/aws-lambda-go/lambdacontext#NewContext\" rel=\"nofollow noreferrer\"><code>lambdacontext.NewContext()</code></a> to derive a context which will have this key:</p>\n\n<pre><code>// NewContext returns a new Context that carries value lc.\nfunc NewContext(parent context.Context, lc *LambdaContext) context.Context {\n    return context.WithValue(parent, contextKey, lc)\n}\n</code></pre>\n\n<p>So the solution:</p>\n\n<pre><code>ctx := context.Background()\n// Add keys to your liking, then:\nlc := new(lambdacontext.LambdaContext)\nctx = lambdacontext.NewContext(ctx, lc)\n</code></pre>\n"}], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2742, "favorite_count": 0, "accepted_answer_id": 50491002, "answer_count": 1, "score": 3, "last_activity_date": 1527086363, "creation_date": 1527085105, "last_edit_date": 1527085485, "question_id": 50490782, "link": "https://stackoverflow.com/questions/50490782/mock-context-context-to-test-lambdacontext-fromcontext", "title": "Mock context.Context to test lambdacontext.FromContext", "body": "<p>I'm building an aws lambda using <a href=\"https://github.com/aws/aws-sdk-go\" rel=\"nofollow noreferrer\">aws-sdk-go</a> and <a href=\"https://github.com/aws/aws-lambda-go\" rel=\"nofollow noreferrer\">aws-lambda-go</a> and I'm stuck with a little problem.</p>\n\n<p>I want to test my lambda handler. To do so, I need to mock a valid <a href=\"https://golang.org/pkg/context/#Context\" rel=\"nofollow noreferrer\">context.Context</a> containing valid attributes for <a href=\"https://godoc.org/github.com/aws/aws-lambda-go/lambdacontext#LambdaContext\" rel=\"nofollow noreferrer\">lamdacontext.LambdaContext</a> and satisfy <code>lambdacontext.FromContext</code>.</p>\n\n<p>I cannot seem to find a way to build such mock, since <code>lambdacontext.FromContext</code> always returns me <code>_, false</code>.</p>\n\n<p>Here's my main, with a simple handler on a <a href=\"https://godoc.org/github.com/aws/aws-lambda-go/events#SNSEvent\" rel=\"nofollow noreferrer\">events.SNSEvent</a> event:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n    \"github.com/aws/aws-lambda-go/lambdacontext\"\n)\n\nfunc main() {\n    lambda.Start(handleRequest)\n}\n\nfunc handleRequest(ctx context.Context, snsEvent events.SNSEvent) error {\n    lc, ok := lambdacontext.FromContext(ctx); if !ok {\n        // Always false\n        ...\n        return someErr\n    }\n    . . .\n    return nil\n}\n</code></pre>\n\n<p>And here's my test for <code>handleRequest</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambdacontext\"\n    \"github.com/stretchr/testify/assert\"\n    \"gitlab.easy-network.it/meg/aml-rekognition/testdata\"\n    \"testing\"\n)\n\nconst imgMock = `\n{\n  \\\"some_parameter\\\": \\\"some_value\\\"\n}`\n\nfunc TestHandleRequest(t *testing.T) {\n\n    c := context.Background()\n\n    ctxV := context.WithValue(c, \"\", map[string]interface{}{\n        \"AwsRequestID\" : \"some_aws_id\",\n        \"InvokedFunctionArn\" : \"some_arn\",\n        \"Identity\" : lambdacontext.CognitoIdentity{},\n        \"ClientContext\" : lambdacontext.ClientContext{},\n    })\n\n    snsEventMock := events.SNSEvent{\n        Records: []events.SNSEventRecord{\n            {\n                SNS: events.SNSEntity{\n                    Message: imgMock,\n                },\n            },\n        },\n    }\n\n    err := handleRequest(ctxV, snsEventMock)\n    assert.NoError(t, err)\n\n}\n</code></pre>\n\n<p>I also tried other mocks like passing it a struct with these parameters etc, but I always get <code>false</code>. For instance, I tried also:</p>\n\n<pre><code>type TestMock struct {\n    AwsRequestID string\n    InvokedFunctionArn string\n    Identity lambdacontext.CognitoIdentity\n    ClientContext lambdacontext.ClientContext\n}\n\nfunc TestHandleRequest(t *testing.T) {\n\n    c := context.Background()\n\n    testMock := TestMock{\n        AwsRequestID : \"some_aws_id\",\n        InvokedFunctionArn : \"some_arn\",\n        Identity : lambdacontext.CognitoIdentity{},\n        ClientContext : lambdacontext.ClientContext{},\n    }\n\n    ctxV := context.WithValue(c, \"\", testMock)\n\n    . . .\n\n}\n</code></pre>\n\n<p>I checked out the source of <code>FromContext</code> and I've been scratching my head for a while.</p>\n\n<pre><code>// LambdaContext is the set of metadata that is passed for every Invoke.\ntype LambdaContext struct {\n    AwsRequestID       string\n    InvokedFunctionArn string\n    Identity           CognitoIdentity\n    ClientContext      ClientContext\n}\n\n// An unexported type to be used as the key for types in this package.\n// This prevents collisions with keys defined in other packages.\ntype key struct{}\n\n// The key for a LambdaContext in Contexts.\n// Users of this package must use lambdacontext.NewContext and \nlambdacontext.FromContext\n\n// instead of using this key directly.\nvar contextKey = &amp;key{}\n\n// FromContext returns the LambdaContext value stored in ctx, if any.\nfunc FromContext(ctx context.Context) (*LambdaContext, bool) {\n    lc, ok := ctx.Value(contextKey).(*LambdaContext)\n    return lc, ok\n}\n</code></pre>\n\n<p>Of course, it returns <code>false</code> even if I just pass a <code>context.Background()</code> to it.</p>\n\n<p>Any idea on how should I build a valid <code>context.Context</code> to let <code>lambdacontext.FromContext</code> return <code>true</code>? </p>\n"}, {"tags": ["user-interface", "go"], "answers": [{"comments": [{"owner": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "edited": false, "score": 0, "creation_date": 1527249828, "post_id": 50490602, "comment_id": 88069136, "body": "The main problem ain&#39;t only updating entry form. App needs to read and then update. I update question with reader from connection and where i think this reader should be used. But it doesn&#39;t work."}], "tags": [], "owner": {"reputation": 1014, "user_id": 61360, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/70602c12ed1c06db5165ff6a88cd38e0?s=128&d=identicon&r=PG", "display_name": "Mat&#237;as Insaurralde", "link": "https://stackoverflow.com/users/61360/mat%c3%adas-insaurralde"}, "is_accepted": true, "score": 1, "last_activity_date": 1527084656, "creation_date": 1527084656, "answer_id": 50490602, "question_id": 50489942, "link": "https://stackoverflow.com/questions/50489942/updating-multiline-entry-from-connection-reading/50490602#50490602", "title": "Updating multiline entry from connection reading", "body": "<p>You can try using the <code>Append</code> method:</p>\n\n<pre><code>output := ui.NewMultilineNonWrappingEntry()\n\n// Call this from your message receiving function:\noutput.Append(\"message\")\n</code></pre>\n\n<p>The other option is to use <code>SetText</code> and keep a buffer of the text somewhere else:</p>\n\n<pre><code>// Create a buffer:\nbuf := bytes.Buffer{}\n\n// Write incoming messages to it:\nbuf.WriteString(\"message\")\n\n// Set the contents from the buffer\n// This might be called periodically (and the buffer reseted):\noutput.SetText(buf.String())\n</code></pre>\n"}], "owner": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 50490602, "answer_count": 1, "score": 1, "last_activity_date": 1527250111, "creation_date": 1527082752, "last_edit_date": 1527250111, "question_id": 50489942, "link": "https://stackoverflow.com/questions/50489942/updating-multiline-entry-from-connection-reading", "title": "Updating multiline entry from connection reading", "body": "<p>I got simply desktop application wrote on Go with this lib: github.com/ProtonMail/ui. The main window's drawing below:</p>\n\n<pre><code>err := ui.Main(func() {\n    window := ui.NewWindow(\"Chat\", 500, 500, false)\n    input := ui.NewEntry()\n    send := ui.NewButton(\"Send\")\n    output := ui.NewMultilineNonWrappingEntry()\n    output.SetReadOnly(true)\n    mainBox := ui.NewHorizontalBox()\n    usersBox := ui.NewVerticalBox()\n    messageBox:=ui.NewVerticalBox()\n    messageBox.Append(output, true)\n    messageBox.Append(input, false)\n    messageBox.Append(send, false)\n    mainBox.Append(usersBox, false)\n    mainBox.Append(messageBox, true)\n    send.OnClicked(func(*ui.Button) {\n        _, err := conn.Write([]byte(JSONencode(userExample1.Text(),input.Text(),\"SendMessageTo\")))\n        if err!=nil{\n            fmt.Println(\"OnClickedError!\")\n        }\n        input.SetText(\"\")\n    })\n    window.SetChild(mainBox)\n    window.OnClosing(func(*ui.Window) bool {\n        ui.Quit()\n        return true\n    })\n    window.Show()\n</code></pre>\n\n<p>And it's reading and outputting decoded string from server connection. Server sending described below: </p>\n\n<pre><code>func ParseJSON(bytes []byte, conn net.Conn) (Message, string, string) {\n    flag := \"tcp\"\n    message := Message{}\n    err := json.Unmarshal(bytes, &amp;message)\n    if err != nil {\n        log.Print(\"Unmarshal doesn't work: \")\n        log.Fatal(err)\n    }\n    fmt.Println(message.User.Login)\n    fmt.Println(message.Content)\n    conn.Write([]byte(message.Content))\n    return message, \"func\", flag\n}\n</code></pre>\n\n<p>How i can output in this entry form</p>\n\n<pre><code>output := ui.NewMultilineNonWrappingEntry()\noutput.SetReadOnly(true)\n</code></pre>\n\n<p>received strings from server?</p>\n\n<p>UPDATE:</p>\n\n<pre><code>go func() {\n            message, err := bufio.NewReader(conn).ReadString('\\n')\n            if err!=nil{\n                log.Fatal(err)\n            }\n            output.SetText(message)\n        }()\n</code></pre>\n\n<p>This code placed in ui.Main function, but it doesn't work.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1527082409, "post_id": 50489557, "comment_id": 87992432, "body": "If you don&#39;t want to execute something multiple times, then don&#39;t do that. If you want to execute something once per value received over a channel, then your example works fine. I&#39;m not sure what the actual question is."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1527082701, "post_id": 50489557, "comment_id": 87992659, "body": "Note that in your example one would normally just signal the goroutine by closing the channel: <a href=\"https://play.golang.org/p/svrXcmiHymx\" rel=\"nofollow noreferrer\">play.golang.org/p/svrXcmiHymx</a> Though if you&#39;re only going to have something execute once, what&#39;s the point of trying to have some sort of cancelation?"}, {"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 1, "creation_date": 1527082768, "post_id": 50489557, "comment_id": 87992714, "body": "Use the <code>sync</code> package (<code>sync.Once</code> specifically) to have something that will only be executed once. Use that in tandem with other channel logic to have a channel that signals something only once."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527083114, "post_id": 50489557, "comment_id": 87992951, "body": "@JimB yeah, i only want to execute the real work once, and the point is i also want to notify the goroutine to quit unconditionally based on something happened outside, like in http handler client close the connection before the response is ready. So i guess the notify once is the valid approach, but will it potentially create some issue? and also does go has some built-in mechanism to generate one time signal?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1527083263, "post_id": 50489557, "comment_id": 87993067, "body": "@Inshi, the point is that if you&#39;re only executing something once, there&#39;s nothing to quit, since you can return immediately after the work is done."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527083435, "post_id": 50489557, "comment_id": 87993185, "body": "@JimB u still didn&#39;t get it,  quit it unconditionally means force to stop it before it completing all its works, means: don&#39;t do the remain work, just quit"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1527083674, "post_id": 50489557, "comment_id": 87993338, "body": "@lnshi, You can&#39;t interrupt a blocking call. You either wait for it to complete, or rewrite it so that it can be interrupted. This is what a <a href=\"https://golang.org/pkg/context/#Context\" rel=\"nofollow noreferrer\"><code>Context</code></a> is usually used for."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527084285, "post_id": 50489557, "comment_id": 87993758, "body": "@JimB yes, i am exactly looking for a full solution for using the <code>Context</code> package, maybe u can refer to this question i just asked: <a href=\"https://stackoverflow.com/questions/50484914/is-the-go-http-handler-goroutine-expected-to-exit-immediately-in-this-case\" title=\"is the go http handler goroutine expected to exit immediately in this case\">stackoverflow.com/questions/50484914/&hellip;</a> and post ur answer? after that question even i monitored the context.cancel() i still cannot find a way to terminate my handler immediately."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1527084761, "post_id": 50489557, "comment_id": 87994086, "body": "@Inshi, your previous question has the correct answer already, I don&#39;t see anything I can add. I think you need to provide a concrete example of the problem you&#39;re having."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527086353, "post_id": 50489557, "comment_id": 87995252, "body": "@JimB I added my full thinking here: <a href=\"https://play.golang.org/p/7xjjiW7XdoQ\" rel=\"nofollow noreferrer\">play.golang.org/p/7xjjiW7XdoQ</a>, the answer of my previous question perfectly addressed my concern, also perfectly handled the timeout/deadline problem, but i found i still don&#39;t exactly know what to do with the cancellation problem, as u saw in the code, i want to achieve when client close connection my handler just simply quit, release all resources, don&#39;t do any remain work"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527086903, "post_id": 50489557, "comment_id": 87995620, "body": "@Inshi, first, that example is invalid because you can&#39;t asynchronously use an http.ResponseWriter and return from the handler, so you need to block. If you want <code>doStuff</code> to be interruptible in more places, you continue passing the cancelation context down through the calls to the grpc requests."}], "answers": [{"comments": [{"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1527086461, "post_id": 50490633, "comment_id": 87995321, "body": "thanks for ur answer, multiple checkpoints, i don&#39;t think we should have similar code in production :)"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "reply_to_user": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1527087702, "post_id": 50490633, "comment_id": 87996244, "body": "If you want to be able to abandon lengthy task &quot;whenever it is cancelled&quot; there is no other way than to select points in the task where it makes sense to check for the cancel signal and act appropriately (ie return without completing rest of the task)."}], "tags": [], "owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "is_accepted": false, "score": 0, "last_activity_date": 1527085064, "last_edit_date": 1527085064, "creation_date": 1527084742, "answer_id": 50490633, "question_id": 50489557, "link": "https://stackoverflow.com/questions/50489557/how-to-use-channel-to-notify-a-goroutine-to-quit-properly/50490633#50490633", "title": "How to use channel to notify a goroutine to quit properly", "body": "<p>Instead of using <code>for select</code> loop you want to check for the cancel signal in multiple places. But in order to not block you still have to use <code>select</code> (with empty default case) which makes it a bit akward. I'm using the context.Context instead of \"plain cancel channel\" but the idea is the same:</p>\n\n<pre><code>func doWork(ctx context.Context) {\n    fmt.Println(\"Doing some work 1\")\n    time.Sleep(time.Second * 5)\n    // check is the task cancelled\n    select {\n    case &lt;-ctx.Done():\n        fmt.Println(\"cancelled at checkpoint 1\")\n        return\n    default:\n    }\n    fmt.Println(\"Doing some work 2\")\n    time.Sleep(time.Second * 5)\n    // check is the task cancelled\n    select {\n    case &lt;-ctx.Done():\n        fmt.Println(\"cancelled at checkpoint 2\")\n        return\n    default:\n    }\n    fmt.Println(\"Doing some work 3\")\n    time.Sleep(time.Second * 5)\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    wg.Add(1)\n    ctx, cancel := context.WithTimeout(context.Background(), time.Second*10)\n    defer cancel()\n    go func() {\n        doWork(ctx)\n        wg.Done()\n    }()\n    wg.Wait()\n    fmt.Println(\"done\")\n}\n</code></pre>\n"}], "owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 967, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1527086692, "creation_date": 1527081694, "last_edit_date": 1527086692, "question_id": 50489557, "link": "https://stackoverflow.com/questions/50489557/how-to-use-channel-to-notify-a-goroutine-to-quit-properly", "title": "How to use channel to notify a goroutine to quit properly", "body": "<p><strong>Note:</strong> I searched this topic with google, and read nearly everything I can find, but still cannot get a proper/reasonable/production ready answer.</p>\n\n<p>Basically all answers are similar, just like this one: <a href=\"https://stackoverflow.com/questions/6807590/how-to-stop-a-goroutine\">how to stop a groutine</a>, all in same pattern, no exception: the real work is <code>fmt.Println(1)</code> to print something, or simply be <code>// Do other stuff</code>,</p>\n\n<p>But if keep the real work at <code>for select default case branch</code>, then it will be executed multiple times, for printing something it is fine, but clearly it is not ready for real work.</p>\n\n<p>The only valid approach I can imagine is put the real work on a case branch then send <strong>only one</strong> signal to that case to notify it to start, like here: <a href=\"https://play.golang.org/p/Kj5W00vwfks\" rel=\"nofollow noreferrer\">playground</a>, but just feel wried, also with this approach, does it create some issues potentially?</p>\n\n<p>Added code fragments to show exactly what i am trying to achieve: <a href=\"https://play.golang.org/p/7xjjiW7XdoQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7xjjiW7XdoQ</a>, i want to achieve when client close connection, then immediately terminate my handler, release the resources, and quit unconditionally.</p>\n"}, {"tags": ["pointers", "go"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 2, "last_activity_date": 1527080870, "creation_date": 1527080870, "answer_id": 50489271, "question_id": 50489223, "link": "https://stackoverflow.com/questions/50489223/golang-nil-pointer-assignment-with-ignored-output-nil/50489271#50489271", "title": "golang nil pointer assignment with ignored output - (*)(nil)", "body": "<p>This makes the compiler check if type <code>*Dir</code> fulfills <code>fs.Node</code> interface. </p>\n\n<p>Take a <code>nil</code> pointer, make it a <code>*Dir</code> pointer and assign it to an unnamed variable of interface type <code>fs.Node</code>. Since we never use this variable, we have to make it unnamed.</p>\n"}], "owner": {"reputation": 31, "user_id": 1153723, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Lu9CA.jpg?s=128&g=1", "display_name": "acud", "link": "https://stackoverflow.com/users/1153723/acud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "closed_date": 1527080907, "accepted_answer_id": 50489271, "answer_count": 1, "score": 1, "last_activity_date": 1527080870, "creation_date": 1527080744, "question_id": 50489223, "link": "https://stackoverflow.com/questions/50489223/golang-nil-pointer-assignment-with-ignored-output-nil", "closed_reason": "Duplicate", "title": "golang nil pointer assignment with ignored output - (*)(nil)", "body": "<p>while going through <a href=\"https://blog.gopheracademy.com/advent-2014/fuse-zipfs/\" rel=\"nofollow noreferrer\">this</a> tutorial on writing FUSE filesystems in go, I came across this cryptic assignment:</p>\n\n<pre><code>var _ fs.Node = (*Dir)(nil)\n</code></pre>\n\n<p>Can someone explain the mechanics of this syntax, and how does it fit in the context in which it is declared? As I understand the outcome of the assignment is actually ignored (and what does the right hand expression even result in? a nil Dir pointer?) </p>\n"}, {"tags": ["go", "sqlite", "go-gorm"], "comments": [{"owner": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "edited": false, "score": 0, "creation_date": 1527104241, "post_id": 50488936, "comment_id": 88005166, "body": "Where does that <code>db</code> package comes from? What are its contents?"}, {"owner": {"reputation": 11, "user_id": 3813438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GgOF7.jpg?s=128&g=1", "display_name": "PhilmacFLy", "link": "https://stackoverflow.com/users/3813438/philmacfly"}, "reply_to_user": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "edited": false, "score": 0, "creation_date": 1527147144, "post_id": 50488936, "comment_id": 88019304, "body": "@CarlosFrias Ah sorry db is: <code>var db *gorm.DB</code> and it get initalizied during the in the Initialisation function"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 3813438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GgOF7.jpg?s=128&g=1", "display_name": "PhilmacFLy", "link": "https://stackoverflow.com/users/3813438/philmacfly"}, "is_accepted": true, "score": 1, "last_activity_date": 1527152295, "creation_date": 1527152295, "answer_id": 50505119, "question_id": 50488936, "link": "https://stackoverflow.com/questions/50488936/invalid-association-with-one-to-many/50505119#50505119", "title": "Invalid association with one to many", "body": "<p>Ok turn out the kicker is the following sentence in the GORM documentation:</p>\n\n<blockquote>\n  <p>To define a has many relatinship, foreign key must exists, default foreign key\u2019s name is owner\u2019s type name plus its primary key.</p>\n</blockquote>\n\n<p>So In my case that would be</p>\n\n<blockquote>\n  <p>StoreStoreID</p>\n</blockquote>\n\n<p>So I had to change the Store struct lice so</p>\n\n<pre><code>type Store struct {\nStoreID   int    `gorm:\"primary_key;AUTO_INCREMENT;not null\"`\nName      string `gorm:\"not null\"`\nAdress    string `gorm:\"not null\"`\nManager   User   `gorm:\"not null\"`\nManagerID int    `gorm:\"foreignkey:ManagerID;not null\"`\nBoxes     []Box  `gorm:\"foreignkey:StoreID;association_foreignkey:StoreID\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 3813438, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GgOF7.jpg?s=128&g=1", "display_name": "PhilmacFLy", "link": "https://stackoverflow.com/users/3813438/philmacfly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 527, "favorite_count": 0, "accepted_answer_id": 50505119, "answer_count": 1, "score": 0, "last_activity_date": 1527152295, "creation_date": 1527079925, "last_edit_date": 1527080133, "question_id": 50488936, "link": "https://stackoverflow.com/questions/50488936/invalid-association-with-one-to-many", "title": "Invalid association with one to many", "body": "<p>I have the following structs </p>\n\n<pre><code>type Store struct {\n    StoreID   int    `gorm:\"primary_key;AUTO_INCREMENT;not null\"`\n    Name      string `gorm:\"not null\"`\n    Adress    string `gorm:\"not null\"`\n    Manager   User   `gorm:\"not null\"`\n    ManagerID int    `gorm:\"foreignkey:ManagerID;not null\"`\n    Boxes     []Box\n}\n\ntype Box struct {\n    BoxID       int `gorm:\"primary_key;AUTO_INCREMENT;not null\"`\n    StoreID     int `gorm:\"not null\"`\n    Items       []Item\n    Code        int    `gorm:\"type:integer(13)\"`\n    Description string `gorm:\"not null\"`\n}\n\nfunc (s *Store) AddBox(b Box) error {\n    err := db.Model(&amp;s).Association(\"Boxes\").Append(&amp;b)\n    return err.Error\n}\n</code></pre>\n\n<p>And I'm running tests on said struct, with their funcs. One of the tests looks like this</p>\n\n<pre><code>func TestStoreAddBox(t *testing.T) {\n    b := Box{BoxID: 1}\n    err := b.GetDetails()\n    if err != nil {\n        t.Errorf(\"Expected no #1 error but got %v\", err)\n    }\n    s := Store{StoreID: 2}\n    err = s.GetDetails()\n    if err != nil {\n        t.Errorf(\"Expected no #2 error but got %v\", err)\n    }\n    err = s.AddBox(b)\n    if err != nil {\n        t.Errorf(\"Expected no #3 error but got %v\", err)\n    }\n}\n</code></pre>\n\n<p>Now if I start my tests I'm getting the following error:</p>\n\n<pre><code>--- FAIL: TestStoreAddBox (0.00s)\n    db100_test.go:371: Expected no #3 error but got invalid association Boxes for db100.Store\n</code></pre>\n\n<p>Does anyone have a idea what the Problem here is?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-dynamodb"], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 9812197, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Denys Nahurnyi", "link": "https://stackoverflow.com/users/9812197/denys-nahurnyi"}, "is_accepted": true, "score": 0, "last_activity_date": 1527082137, "creation_date": 1527082137, "answer_id": 50489731, "question_id": 50488880, "link": "https://stackoverflow.com/questions/50488880/unmarshal-set-of-strings-in-dynamodb/50489731#50489731", "title": "Unmarshal set of strings in dynamodb", "body": "<p>Currently I have created custom unmarshaler following that example: </p>\n\n<p><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/dynamodbattribute/#UnixTime.UnmarshalDynamoDBAttributeValue\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/dynamodbattribute/#UnixTime.UnmarshalDynamoDBAttributeValue</a> </p>\n\n<p>but I still think that I am doin smth wrong because it should be easier way to parse set of strings...</p>\n"}], "owner": {"reputation": 31, "user_id": 9812197, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Denys Nahurnyi", "link": "https://stackoverflow.com/users/9812197/denys-nahurnyi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 0, "accepted_answer_id": 50489731, "answer_count": 1, "score": 1, "last_activity_date": 1527082137, "creation_date": 1527079769, "question_id": 50488880, "link": "https://stackoverflow.com/questions/50488880/unmarshal-set-of-strings-in-dynamodb", "title": "Unmarshal set of strings in dynamodb", "body": "<p>I am using golang and want to store some data in dynamo db in set of strings format <code>SS</code>. It is possible to store data but when I want to pull it back on unmarshaling stage it unmarshal every property except of prop that contain set of strings. Structure that I use to unmarshal in has <code>[]string</code> type of that property. I saw that <code>dynamodbattribute</code> have some specific methods for unmarshaling like <code>UnmarshalMap</code> and so one but I didn't find specific method for SS. Can someone give me an advise?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1527077482, "post_id": 50488013, "comment_id": 87988895, "body": "<a href=\"https://redis.io/\" rel=\"nofollow noreferrer\">Redis</a> would be a much better and easier choice for distributed locking."}, {"owner": {"reputation": 45, "user_id": 5883159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bf5753633697997d0754f12e3925f1e?s=128&d=identicon&r=PG&f=1", "display_name": "Rafael Bogaveev", "link": "https://stackoverflow.com/users/5883159/rafael-bogaveev"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1527077657, "post_id": 50488013, "comment_id": 87989014, "body": "Maybe it will help to use Redis just for locking, but how to do that in mongo?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1528204365, "last_edit_date": 1528204365, "creation_date": 1527078473, "answer_id": 50488423, "question_id": 50488013, "link": "https://stackoverflow.com/questions/50488013/how-to-synchronize-two-apps-running-in-two-different-servers-via-mongodb/50488423#50488423", "title": "How to synchronize two apps running in two different servers via MongoDB", "body": "<p>Note beforehand: Using <a href=\"https://redis.io/\" rel=\"nofollow noreferrer\">Redis</a> would be a better and more efficient choice for distributed locking.</p>\n\n<p>But if you still want to use MongoDB for this, read on.</p>\n\n<p>Some notes to the solutions below:</p>\n\n<ul>\n<li><p>All solutions below are safe and work even if you have multiple MongoDB servers (a shared cluster), because none of the solutions below rely on simple reads; and all writes (e.g. <code>insert</code> or <code>update</code>) go to the master instance.</p></li>\n<li><p>If a goroutine fails to obtain a lock, it may decide to sleep a little (e.g. 1 second), then retry obtaining the lock. There should be a max retry count before giving up.</p></li>\n</ul>\n\n<hr>\n\n<h2>Using the existence of a document as the lock</h2>\n\n<p>Simplest would be to rely on MongoDB not allowing 2 documents with the same ID to exist (in the same collection).</p>\n\n<p>So to acquire a lock, simply insert a document into a designated collection (e.g. <code>locks</code>) with the lock ID. If insertion succeeds, you successfully acquired the lock. If insertion fails, you did not. To release the lock, simply delete (remove) the document.</p>\n\n<p>Some things to note: you MUST release the lock, because if you fail to do so, all code that attempts to acquire this lock will never succeed. So releasing the lock should be done using a deferred function (<code>defer</code>). Unfortunately this won't ensure the release in case of some communication error (network failure).</p>\n\n<p>To have guarantee about lock release, you may create an index that specifies <a href=\"https://docs.mongodb.com/manual/tutorial/expire-data/\" rel=\"nofollow noreferrer\">document expiration</a>, so the locks would be deleted automatically after some time, should any problems arise in the Go app while it holds the lock.</p>\n\n<p>Example:</p>\n\n<p>Lock documents are not inserted prior. But an index is required:</p>\n\n<pre><code>db.locks.createIndex({lockedAt: 1}, {expireAfterSeconds: 30})\n</code></pre>\n\n<p>Acquiring the lock:</p>\n\n<pre><code>sess := ... // Obtain a MongoDB session\nc := sess.DB(\"\").C(\"locks\")\n\nerr := c.Insert(bson.M{\n    \"_id\":      \"l1\",\n    \"lockedAt\": time.Now(),\n})\nif err == nil {\n    // LOCK OBTAINED! DO YOUR STUFF\n}\n</code></pre>\n\n<p>Releasing the lock:</p>\n\n<pre><code>err := c.RemoveId(\"l1\")\n</code></pre>\n\n<p><strong>Pros:</strong> Simplest solution.</p>\n\n<p><strong>Cons:</strong> You can only specify the same timeout for all locks, harder to change it later (must drop and recreate the index).</p>\n\n<p>Note that this last statement is not entirely true, because you are not forced to set the current time to the <code>lockedAt</code> field. E.g. if you set a timestamp pointing 5 seconds in the past, the lock will auto-expire after 25 seconds. If you set it 5 seconds to the future, the lock will expire after 35 seconds.</p>\n\n<p>Also note that if a goroutine obtains a lock, and without any problems it needs to hold it for longer than 30 seconds, it could be done by updating the <code>lockedAt</code> field of the lock document. E.g. after 20 seconds if the goroutine does not encounter any problem but needs more time to finish its work holding the lock, it may update the <code>lockedAt</code> field to the current time preventing it to get auto-deleted (and thus giving green light to other goroutines waiting for that lock).</p>\n\n<h2>Using pre-created lock documents and <code>update()</code></h2>\n\n<p>Another solution could be to have a collection with pre-created lock documents. Locks could have an ID (<code>_id</code>), and a state telling if it is locked or not (<code>locked</code>).</p>\n\n<p>Creating a lock prior:</p>\n\n<pre><code>db.locks.insert({_id:\"l1\", locked:false})\n</code></pre>\n\n<p>To obtain a lock, use the <a href=\"https://godoc.org/github.com/globalsign/mgo#Collection.Update\" rel=\"nofollow noreferrer\"><code>Collection.Update()</code></a> method, where in the selector you must filter by ID and the locked state, where state must be unlocked. And the update value should be a <code>$set</code> operation, setting the locked state to <code>true</code>.</p>\n\n<pre><code>err := c.Update(bson.M{\n    \"_id\":    \"l1\",\n    \"locked\": false,\n}, bson.M{\n    \"$set\": bson.M{\"locked\": true},\n})\nif err == nil {\n    // LOCK OBTAINED! DO YOUR STUFF\n}\n</code></pre>\n\n<p>How does this work? If multiple Go instances (or even multiple goroutines in the same Go app) try to obtain the lock, only one will succeed, because the selector for the rest will return <code>mgo.ErrNotFound</code>, because the one that prevails sets the <code>locked</code> field to <code>true</code>.</p>\n\n<p>Once you did your stuff holding the lock, you must release the lock:</p>\n\n<pre><code>err := c.UpdateId(\"l1\", bson.M{\n    \"$set\": bson.M{\"locked\": false},\n})\n</code></pre>\n\n<p>To have guarantee of the lock release, you may include a timestamp in the lock documents when it was locked. And when attempting to acquire a lock, the selector should also accept locks that are locked but are older than a given timeout (e.g. 30 seconds). In this case the update should also set the locked timestamp.</p>\n\n<p>Example guaranteeing lock release with timeout:</p>\n\n<p>The lock document:</p>\n\n<pre><code>db.locks.insert({_id:\"l1\", locked:false})\n</code></pre>\n\n<p>Acquiring the lock:</p>\n\n<pre><code>err := c.Update(bson.M{\n    \"_id\": \"l1\",\n    \"$or\": []interface{}{\n        bson.M{\"locked\": false},\n        bson.M{\"lockedAt\": bson.M{\"$lt\": time.Now().Add(-30 * time.Second)}},\n    },\n}, bson.M{\n    \"$set\": bson.M{\n        \"locked\":   true,\n        \"lockedAt\": time.Now(),\n    },\n})\nif err == nil {\n    // LOCK OBTAINED! DO YOUR STUFF\n}\n</code></pre>\n\n<p>Releasing the lock:</p>\n\n<pre><code>err := c.UpdateId(\"l1\", bson.M{\n    \"$set\": bson.M{ \"locked\": false},\n})\n</code></pre>\n\n<p><strong>Pros:</strong> You can use different timeout for different locks, or even for the same locks at different places (although this would be bad practice).</p>\n\n<p><strong>Cons:</strong> Slightly more complex.</p>\n\n<p>Note that to \"extend the lifetime\" of a lock, the same technique can be used that is described above, that is, if the lock expiration is nearing and the goroutine needs more time, it may update the <code>lockedAt</code> field of the lock document.</p>\n"}, {"tags": [], "owner": {"reputation": 66, "user_id": 1414479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12924d69b67480c717dbde7d08a33c88?s=128&d=identicon&r=PG", "display_name": "Darth Cookie", "link": "https://stackoverflow.com/users/1414479/darth-cookie"}, "is_accepted": false, "score": 0, "last_activity_date": 1527079348, "last_edit_date": 1527079348, "creation_date": 1527078692, "answer_id": 50488498, "question_id": 50488013, "link": "https://stackoverflow.com/questions/50488013/how-to-synchronize-two-apps-running-in-two-different-servers-via-mongodb/50488498#50488498", "title": "How to synchronize two apps running in two different servers via MongoDB", "body": "<p>For single documents, update operations in Mongo <a href=\"https://www.tutorialspoint.com/mongodb/mongodb_atomic_operations.htm\" rel=\"nofollow noreferrer\">are atomic</a>. Your web applications will both receive a consistent view of a document because a \"write\" request will either update all fields at once or none at all. Examples at the above link.</p>\n\n<p>If the web app instances are updating multiple documents in a single query (if you're batching them with an updateMany), atomic operations are not available. You could use embedded documents to address that (link above) or <a href=\"https://www.tutorialkart.com/mongodb/mongodb-locks/\" rel=\"nofollow noreferrer\">document, collection, or database locking</a> which provides different read-write locks.</p>\n\n<p>The above links get right to business but for a comprehensive view, <a href=\"https://docs.mongodb.com/manual/faq/concurrency/\" rel=\"nofollow noreferrer\">here's the mongo documentation page</a>.</p>\n\n<p>If you could further detail your flow, the community may be able to give you a more specific answer.</p>\n"}], "owner": {"reputation": 45, "user_id": 5883159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bf5753633697997d0754f12e3925f1e?s=128&d=identicon&r=PG&f=1", "display_name": "Rafael Bogaveev", "link": "https://stackoverflow.com/users/5883159/rafael-bogaveev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 915, "favorite_count": 1, "accepted_answer_id": 50488423, "answer_count": 2, "score": 4, "last_activity_date": 1528204365, "creation_date": 1527077266, "last_edit_date": 1527092331, "question_id": 50488013, "link": "https://stackoverflow.com/questions/50488013/how-to-synchronize-two-apps-running-in-two-different-servers-via-mongodb", "title": "How to synchronize two apps running in two different servers via MongoDB", "body": "<p>I am developing a web application in golang and use single MongoDB instance as a datastorage. I have code that should be executed exclusively. Since my web application runs on two different servers I can't use golang synchronization tools for that. </p>\n\n<p><strong>Idea is to use MongoDB for that by locking document, but I don't know whether it is possible and if it is, how to do that?</strong> </p>\n"}, {"tags": ["go", "kubernetes", "google-kubernetes-engine"], "answers": [{"tags": [], "owner": {"reputation": 471, "user_id": 9611623, "user_type": "registered", "profile_image": "https://graph.facebook.com/10215580206998519/picture?type=large", "display_name": "Alex Lurye", "link": "https://stackoverflow.com/users/9611623/alex-lurye"}, "is_accepted": false, "score": 1, "last_activity_date": 1527177377, "creation_date": 1527177377, "answer_id": 50513576, "question_id": 50486223, "link": "https://stackoverflow.com/questions/50486223/how-to-configure-a-distributed-hashtable-on-kubernetes/50513576#50513576", "title": "How to configure a distributed hashtable on Kubernetes?", "body": "<p>Go Client Library is one of the options. Another (more simple) option is to setup a <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/#headless-services\" rel=\"nofollow noreferrer\">headless service</a> for groupcache, so with a single DNS lookup you can get all IP addresses of all groupcache pods.</p>\n"}], "owner": {"reputation": 3946, "user_id": 736070, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/2ffe94c53681b5b72e448cd8a575e687?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/736070/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 488, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1527177377, "creation_date": 1527071887, "question_id": 50486223, "link": "https://stackoverflow.com/questions/50486223/how-to-configure-a-distributed-hashtable-on-kubernetes", "title": "How to configure a distributed hashtable on Kubernetes?", "body": "<p>My application is running in Kubernetes pods and I would like to use <a href=\"https://github.com/golang/groupcache\" rel=\"nofollow noreferrer\">golang/groupcache</a> to distribute key/value entities amongst instances of the app.</p>\n\n<p>The groupcache library in each of my app instances is required to know the connection details (IP &amp; port) of all the other app instances so it can distribute the key/value entities as it sees fit. How can I let groupcache know the connection details of the other running instances of my application? Would it be preferable/possible to use the Kubernetes <a href=\"https://github.com/kubernetes/client-go\" rel=\"nofollow noreferrer\">Go Client Library</a>?</p>\n"}, {"tags": ["opengl", "go", "textures", "shader"], "comments": [{"owner": {"reputation": 23496, "user_id": 5468463, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8eafc92b719d65512cded4c5087892ff?s=128&d=identicon&r=PG&f=1", "display_name": "Vega", "link": "https://stackoverflow.com/users/5468463/vega"}, "edited": false, "score": 4, "creation_date": 1527070328, "post_id": 50485176, "comment_id": 87984162, "body": "Bold font wont give your question more importance"}, {"owner": {"reputation": 11, "user_id": 9832519, "user_type": "registered", "profile_image": "https://graph.facebook.com/194144448067210/picture?type=large", "display_name": "Iteravse Acheson", "link": "https://stackoverflow.com/users/9832519/iteravse-acheson"}, "reply_to_user": {"reputation": 23496, "user_id": 5468463, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8eafc92b719d65512cded4c5087892ff?s=128&d=identicon&r=PG&f=1", "display_name": "Vega", "link": "https://stackoverflow.com/users/5468463/vega"}, "edited": false, "score": 0, "creation_date": 1527071514, "post_id": 50485176, "comment_id": 87984916, "body": "so any idea?I&#39;ve had an excruciating for this question all day QWQ"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527071573, "post_id": 50485176, "comment_id": 87984960, "body": "Don&#39;t include (or link to) photos of text. Just copy-and-paste the text instead."}, {"owner": {"reputation": 11, "user_id": 9832519, "user_type": "registered", "profile_image": "https://graph.facebook.com/194144448067210/picture?type=large", "display_name": "Iteravse Acheson", "link": "https://stackoverflow.com/users/9832519/iteravse-acheson"}, "edited": false, "score": 0, "creation_date": 1527072372, "post_id": 50485176, "comment_id": 87985493, "body": "okey but why ? i want vivid metaphor for this questioin"}, {"owner": {"reputation": 18064, "user_id": 2579738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXata.png?s=128&g=1", "display_name": "BDL", "link": "https://stackoverflow.com/users/2579738/bdl"}, "edited": false, "score": 0, "creation_date": 1527073535, "post_id": 50485176, "comment_id": 87986266, "body": "Where is the rendering code? Where do you set the texture uniform? Did you check with a GPU debugger whether the texture contains valid data?"}, {"owner": {"reputation": 11, "user_id": 9832519, "user_type": "registered", "profile_image": "https://graph.facebook.com/194144448067210/picture?type=large", "display_name": "Iteravse Acheson", "link": "https://stackoverflow.com/users/9832519/iteravse-acheson"}, "edited": false, "score": 0, "creation_date": 1527128546, "post_id": 50485176, "comment_id": 88012691, "body": "i added rendering and texture uniform setting code,before  i did&#39;t put those code ,because  it no change in my using TEXTURE_CUBE_MAP those code works fine ,but i don&#39;t know how to debug shader program  in golang opengl, i &#39;dont know  texture value whether lawful in fact i never obseve on they running"}, {"owner": {"reputation": 11, "user_id": 9832519, "user_type": "registered", "profile_image": "https://graph.facebook.com/194144448067210/picture?type=large", "display_name": "Iteravse Acheson", "link": "https://stackoverflow.com/users/9832519/iteravse-acheson"}, "edited": false, "score": 0, "creation_date": 1527132988, "post_id": 50485176, "comment_id": 88013631, "body": "but the image load and TexCoord it valid because they all works fine in TEXTURE_CUBE_MAP mode"}, {"owner": {"reputation": 11, "user_id": 9832519, "user_type": "registered", "profile_image": "https://graph.facebook.com/194144448067210/picture?type=large", "display_name": "Iteravse Acheson", "link": "https://stackoverflow.com/users/9832519/iteravse-acheson"}, "reply_to_user": {"reputation": 18064, "user_id": 2579738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXata.png?s=128&g=1", "display_name": "BDL", "link": "https://stackoverflow.com/users/2579738/bdl"}, "edited": false, "score": 0, "creation_date": 1527144541, "post_id": 50485176, "comment_id": 88017734, "body": "@BDL so any idea?QWQ my vertexs and uv cooride works fine in  TEXTURE_2D but not on TEXTURE_2D_ARRAY mode"}, {"owner": {"reputation": 18064, "user_id": 2579738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXata.png?s=128&g=1", "display_name": "BDL", "link": "https://stackoverflow.com/users/2579738/bdl"}, "edited": false, "score": 0, "creation_date": 1527148189, "post_id": 50485176, "comment_id": 88019879, "body": "From what I see atm, you are calling <code>Uniform1i</code> before binding the correct shader (<code>UseProgram</code>). Uniforms can only be set when the corresponding shader is active."}, {"owner": {"reputation": 11, "user_id": 9832519, "user_type": "registered", "profile_image": "https://graph.facebook.com/194144448067210/picture?type=large", "display_name": "Iteravse Acheson", "link": "https://stackoverflow.com/users/9832519/iteravse-acheson"}, "reply_to_user": {"reputation": 18064, "user_id": 2579738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXata.png?s=128&g=1", "display_name": "BDL", "link": "https://stackoverflow.com/users/2579738/bdl"}, "edited": false, "score": 0, "creation_date": 1527158189, "post_id": 50485176, "comment_id": 88026251, "body": "@BDL yeah,i know that and i have two line write UseProgram,i delete that in loop"}, {"owner": {"reputation": 11, "user_id": 9832519, "user_type": "registered", "profile_image": "https://graph.facebook.com/194144448067210/picture?type=large", "display_name": "Iteravse Acheson", "link": "https://stackoverflow.com/users/9832519/iteravse-acheson"}, "reply_to_user": {"reputation": 18064, "user_id": 2579738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXata.png?s=128&g=1", "display_name": "BDL", "link": "https://stackoverflow.com/users/2579738/bdl"}, "edited": false, "score": 0, "creation_date": 1527160124, "post_id": 50485176, "comment_id": 88027597, "body": "@BDL another one is under the compileShader,i did&#39;t put that code,i test uniforms number ,and when shader receive the number will rendering blue cube and i successful for that test,but it seem Uniform1i works fine,and when i just delete redundant of UseProgram in forloop ,it still result is black cube  so\u2026\u2026 what&#39;s the problem?"}, {"owner": {"reputation": 11, "user_id": 9832519, "user_type": "registered", "profile_image": "https://graph.facebook.com/194144448067210/picture?type=large", "display_name": "Iteravse Acheson", "link": "https://stackoverflow.com/users/9832519/iteravse-acheson"}, "reply_to_user": {"reputation": 18064, "user_id": 2579738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXata.png?s=128&g=1", "display_name": "BDL", "link": "https://stackoverflow.com/users/2579738/bdl"}, "edited": false, "score": 0, "creation_date": 1527224809, "post_id": 50485176, "comment_id": 88055822, "body": "@BDL now i use Gpudebugger RenderDoc find sampler2DArray tex1 value in fact,i added that picture in my post,so what&#39;s the next?"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 9832519, "user_type": "registered", "profile_image": "https://graph.facebook.com/194144448067210/picture?type=large", "display_name": "Iteravse Acheson", "link": "https://stackoverflow.com/users/9832519/iteravse-acheson"}, "is_accepted": false, "score": 1, "last_activity_date": 1527262494, "creation_date": 1527262494, "answer_id": 50532642, "question_id": 50485176, "link": "https://stackoverflow.com/questions/50485176/texture-2d-array-not-rendering/50532642#50532642", "title": "TEXTURE_2D_ARRAY not rendering", "body": "<p>finally i find the reason, using <code>gl.GetError()</code> after <code>gl.TextureStorage3D</code> i get <code>INVALID_ENUM</code> ,reference this <a href=\"http://docs.gl/gl4/glTexStorage3D\" rel=\"nofollow noreferrer\">document</a> that means internal format has problem,so i change <code>gl.RGBA</code> to <code>gl.RGBA8</code>   </p>\n\n<p>everything is working perfect~ it a has multi texture binding one texture unit a <a href=\"https://i.stack.imgur.com/ygoCO.png\" rel=\"nofollow noreferrer\"> beautiful cube</a>~</p>\n\n<p>thanks for every answerer,  i'm not alone ^v^</p>\n"}], "owner": {"reputation": 11, "user_id": 9832519, "user_type": "registered", "profile_image": "https://graph.facebook.com/194144448067210/picture?type=large", "display_name": "Iteravse Acheson", "link": "https://stackoverflow.com/users/9832519/iteravse-acheson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1527262494, "creation_date": 1527069178, "last_edit_date": 1527224561, "question_id": 50485176, "link": "https://stackoverflow.com/questions/50485176/texture-2d-array-not-rendering", "title": "TEXTURE_2D_ARRAY not rendering", "body": "<p>I'm using golang with OpenGL.<br>\nI use TEXTURE_2D_ARRAY load texture render a cube, but it result is a black cube.\nI'm sure the texture unit is specified correctly because when I use <code>ActiveTexture(gl.TEXTURE3)</code> in <code>TEXTURE_CUBE_MAP</code> load mode, it's display purposes, but now use TEXTURE_2D_ARRAY look like texture doesn't work.</p>\n\n<p>texture loading code like this</p>\n\n<pre><code>func GenBindTexture(TextureType uint32) uint32{\n\nvar texture uint32\ngl.GenTextures(1, &amp;texture)\ngl.ActiveTexture(gl.TEXTURE3)\ngl.BindTexture(TextureType, texture)\n//gl.TexEnvi()\n\nreturn  texture\n}\nfunc TestTextureArray(){\nfmt.Println(\"texture number:\",GenBindTexture(gl.TEXTURE_2D_ARRAY))\nrgba,err:=DrawRGBA(\"Texture/T1.png\")\nif err!=nil{\n    fmt.Println(\"Err:\",err)\n    return\n}\ngl.TextureStorage3D(\n    gl.TEXTURE_2D_ARRAY,\n    1,\n    gl.RGBA,\n    int32(rgba.Rect.Size().X),int32(rgba.Rect.Size().Y),\n    1,\n)\nfmt.Printf(\"error is invlid option:%x\\n\",gl.GetError())//in here get INVALID_ENUM\n\ngl.TexSubImage3D(\n    gl.TEXTURE_2D_ARRAY,\n    0,\n    0,0,int32(0),\n    int32(rgba.Rect.Size().X),int32(rgba.Rect.Size().Y),1,\n    gl.RGBA,\n    gl.UNSIGNED_BYTE,\n    gl.Ptr(rgba.Pix),//they are color,i'm not set for random ,just test\n)\nfmt.Printf(\"error is invlid option:%x\\n\",gl.GetError())//in here get INVALID_Value\ngl.TexParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_MIN_FILTER, gl.LINEAR)\ngl.TexParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\ngl.TexParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\ngl.TexParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)//\n}\n</code></pre>\n\n<p>render&amp;uniform setting</p>\n\n<pre><code>    TestTextureArray()\ntextureUniform := gl.GetUniformLocation(program, gl.Str(\"tex1\\x00\"))\ngl.Uniform1i(textureUniform, 3) //\u4f20\u8f93tex1\u4e3a\u5bf9\u5e94\u7684\u7eb9\u7406\u5355\u5143id \uff0c\u5982\u679ctex1\u5df2\u7ecf\u88abbinding=\u7eb9\u7406\u5355\u5143id\u5219\u4e0d\u7528\u5982\u6b64\u64cd\u4f5c\n//gl.Uniform1i(0,0)\n\nfmt.Printf(\"error is:%x\\n\",gl.GetError())\ngl.ClearColor(0.9, 0.9, 0.9, 0.6)\n\nangle := 0.0\npreviousTime := glfw.GetTime()\n\nfor !window.ShouldClose() {\n    gl.Clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\n    // Update\n    time := glfw.GetTime()\n    elapsed := time - previousTime\n    previousTime = time\n\n    angle += elapsed\n    model = mgl32.HomogRotate3D(float32(angle), mgl32.Vec3{0, 1, 0})\n\n    // Render\n    gl.UseProgram(program)\n    gl.UniformMatrix4fv(modelUniform, 1, false,&amp;model[0])\n    gl.BindVertexArray(vao)\n    //gl.DrawArrays(gl.TRIANGLE_STRIP, 0, 6*4)\n    Render(program)\n    window.SwapBuffers()\n    glfw.PollEvents()\n}\n}\nfunc Render(program uint32){\nfor CubeFace:=0;CubeFace!=6;CubeFace++  {\n    SetUniformVar(program,\"Layer\",CubeFace)\n    //gl.DrawArrays(gl.TRIANGLE_STRIP, 0, 6*4)\ngl.DrawElementsBaseVertex(gl.TRIANGLE_STRIP,4,gl.UNSIGNED_INT,gl.PtrOffset(0),int32(CubeFace*4))\n}\n</code></pre>\n\n<p>}</p>\n\n<p>and shader code like this</p>\n\n<pre><code>var VertexShaderMulti=`\n# version 450\nuniform mat4 projection;\nuniform mat4 camera;\nuniform mat4 model;\n\nin vec3 vert;\nin vec2 vertTexCoord;\n\nout vec2 uv;\n\nvoid main() {\n    uv = vertTexCoord;\n    gl_Position = projection * camera * model * vec4(vert, 1.3);\n}\n` + \"\\x00\"\n\n\nvar FragmentShaderMulti=`\n# version 450\n\nuniform sampler2DArray tex1;\nuniform int Layer=2;\n\nin vec2 uv;\n\nout vec4 outputColor;\n\nvoid main(void){\n    outputColor=texture(tex1, vec3(uv,0));\n    }\n`+ \"\\x00\"\n</code></pre>\n\n<p>Now i use RenderDoc find sampler2DArray tex1 value in fact\n<a href=\"https://i.stack.imgur.com/15N03.png\" rel=\"nofollow noreferrer\">sampler2DArray tex1</a><br>\nany help and I would be very grateful!</p>\n"}, {"tags": ["http", "go", "cancellation"], "answers": [{"comments": [{"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1527069567, "post_id": 50485056, "comment_id": 87983608, "body": "oh, i see, so if i start new goroutines here, and maybe those goroutines will also start new ones, so for all the downstream goroutines i need to manually monitor the context? i thought somehow the context package will help me to terminate those goroutines immediately!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 1, "creation_date": 1527069858, "post_id": 50485056, "comment_id": 87983819, "body": "@lnshi The context only <i>carries</i> timeout and cancellation info, it does not have power to kill / terminate goroutines. The goroutines themselves have to monitor such cancellation signal and act upon it."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1527087002, "post_id": 50485056, "comment_id": 87995713, "body": "sorry, after monitored the cancellation i found i still don&#39;t know what exactly should to to terminate the handler, i added piece of my think here: <a href=\"https://play.golang.org/p/7xjjiW7XdoQ\" rel=\"nofollow noreferrer\">play.golang.org/p/7xjjiW7XdoQ</a> can u help to point me out the correct way? basically i want to achieve that when client close the connection, my server just immediately terminate the handler, release the resources, don&#39;t do any remained work, and just quit unconditionally."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1527087133, "post_id": 50485056, "comment_id": 87995825, "body": "@lnshi If cancellation is detected, you have to return from the handler. That signals the web server that serving that request ended. Depending on what your handler does, it must monitor (at least occasionally) the channel for cancellation, and it must terminate and return. This is your task to do, this won&#39;t happen automatically."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1527087502, "post_id": 50485056, "comment_id": 87996106, "body": "So use the approach that put the real work on a for select case branch and send it with a one time signal to notify it to start? Just feel wried"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1527087702, "post_id": 50485056, "comment_id": 87996246, "body": "@lnshi If the task can be broken down to small pieces, use a loop, each iteration does a small piece and also checks the cancellation signal. If cancelled, return. If not, continue with the next iteration. If a loop is not practical, just insert a check once in a while in the series of statements that realizes the job. Use common sense and logic."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1527070824, "last_edit_date": 1527070824, "creation_date": 1527068822, "answer_id": 50485056, "question_id": 50484914, "link": "https://stackoverflow.com/questions/50484914/is-the-go-http-handler-goroutine-expected-to-exit-immediately-in-this-case/50485056#50485056", "title": "Is the Go HTTP handler goroutine expected to exit immediately in this case?", "body": "<p>You create a <a href=\"https://golang.org/pkg/context/#Context\" rel=\"nofollow noreferrer\"><code>contex.Context</code></a> that can be cancelled, which you do cancel when the client closes the connection, BUT you do not check the context and your handler does nothing differently if it is cancelled. The context only <em>carries</em> timeout and cancellation signals, it does not have the power nor the intent to kill / terminate goroutines. The goroutines themselves have to monitor such cancellation signals and act upon it.</p>\n\n<p>So what you see is the expected output of your code.</p>\n\n<p>What you want is to monitor the context, and if it is cancelled, return \"immediately\" from the handler.</p>\n\n<p>Of course if you're \"sleeping\", you can't monitor the context meanwhile. So instead use <a href=\"https://golang.org/pkg/time/#After\" rel=\"nofollow noreferrer\"><code>time.After()</code></a>, like in this example:</p>\n\n<pre><code>mux.HandleFunc(\"/test\", func(w http.ResponseWriter, r *http.Request) {\n    ctx, cancel := context.WithCancel(context.Background())\n    defer cancel()\n\n    if cn, ok := w.(http.CloseNotifier); ok {\n        go func(done &lt;-chan struct{}, closed &lt;-chan bool) {\n            select {\n            case &lt;-done:\n            case &lt;-closed:\n                fmt.Println(\"client cancelled....................!!!!!!!!!\")\n                cancel()\n            }\n        }(ctx.Done(), cn.CloseNotify())\n    }\n\n    select {\n    case &lt;-time.After(5 * time.Second):\n        fmt.Println(\"5 seconds elapsed, client didn't close\")\n    case &lt;-ctx.Done():\n        fmt.Println(\"Context closed, client closed connection?\")\n        return\n    }\n\n    fmt.Fprint(w, \"cancellation testing......\")\n})\n</code></pre>\n"}], "owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1078, "favorite_count": 0, "accepted_answer_id": 50485056, "answer_count": 1, "score": 2, "last_activity_date": 1529250844, "creation_date": 1527068358, "last_edit_date": 1529250844, "question_id": 50484914, "link": "https://stackoverflow.com/questions/50484914/is-the-go-http-handler-goroutine-expected-to-exit-immediately-in-this-case", "title": "Is the Go HTTP handler goroutine expected to exit immediately in this case?", "body": "<p>I have one Go HTTP handler like this:</p>\n\n<pre><code>mux.HandleFunc(\"/test\", func(w http.ResponseWriter, r *http.Request) {\n    ctx, cancel := context.WithCancel(context.Background())\n\n    defer cancel()\n\n    if cn, ok := w.(http.CloseNotifier); ok {\n        go func(done &lt;-chan struct{}, closed &lt;-chan bool) {\n            select {\n            case &lt;-done:\n            case &lt;-closed:\n                fmt.Println(\"client cancelled....................!!!!!!!!!\")\n                cancel()\n            }\n        }(ctx.Done(), cn.CloseNotify())\n    }\n\n    time.Sleep(5 * time.Second)\n\n    fmt.Println(\"I am still running...........\")\n\n    fmt.Fprint(w, \"cancellation testing......\")\n})\n</code></pre>\n\n<p>The API works fine, then with curl before the request finish I terminate the curl command deliberately with <code>Control-C</code>, and on server side I do see the <code>client cancelled....................!!!!!!!!!</code> get logged out, but after a while the <code>I am still running...........</code> get logged out also, I thought this goroutine will be terminated immediately!</p>\n\n<p>So, is this desired behaviour, or I did something wrong?</p>\n\n<p>If it is expected, since whatever the goroutine will complete its work, then what is the point of the early cancellation?</p>\n\n<p>If I did something wrong, please help to point me out the correct way.</p>\n"}, {"tags": ["postgresql", "go", "networking", "connection-pooling", "psql"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1527067459, "post_id": 50484359, "comment_id": 87982175, "body": "Are you using a global db handle? Or openning one per each request? Are you closing <code>*sql.Rows</code> as you should? Are you executing new queries while looping through <code>*sql.Rows</code>?"}, {"owner": {"reputation": 5764, "user_id": 1336532, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/93e5830761f6e85757991d5915369349?s=128&d=identicon&r=PG", "display_name": "Mahoni", "link": "https://stackoverflow.com/users/1336532/mahoni"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527069471, "post_id": 50484359, "comment_id": 87983543, "body": "@mkopriva sqlx takes care of that. It&#39;s one db handle"}, {"owner": {"reputation": 5895, "user_id": 2834978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05b09a797fd0c59d1627b30fb4cdba01?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Mu&#241;oz", "link": "https://stackoverflow.com/users/2834978/luis-mu%c3%b1oz"}, "edited": false, "score": 0, "creation_date": 1527115952, "post_id": 50484359, "comment_id": 88009922, "body": "What&#39;s the MAX number of connections that your postgres can accept? May be it&#39;s a real case."}, {"owner": {"reputation": 5764, "user_id": 1336532, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/93e5830761f6e85757991d5915369349?s=128&d=identicon&r=PG", "display_name": "Mahoni", "link": "https://stackoverflow.com/users/1336532/mahoni"}, "reply_to_user": {"reputation": 5895, "user_id": 2834978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05b09a797fd0c59d1627b30fb4cdba01?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Mu&#241;oz", "link": "https://stackoverflow.com/users/2834978/luis-mu%c3%b1oz"}, "edited": false, "score": 0, "creation_date": 1527152501, "post_id": 50484359, "comment_id": 88022440, "body": "@LuisMu&#241;oz 50. If the problem would be at the end of Postgres, wouldn&#39;t I see error message sin the log?"}, {"owner": {"reputation": 5895, "user_id": 2834978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05b09a797fd0c59d1627b30fb4cdba01?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Mu&#241;oz", "link": "https://stackoverflow.com/users/2834978/luis-mu%c3%b1oz"}, "edited": false, "score": 0, "creation_date": 1527176505, "post_id": 50484359, "comment_id": 88039047, "body": "The point here is to find when the issue occurs, in the middle of an established connection/transaction? Check CPU/memory usage at postgres and system logs there."}, {"owner": {"reputation": 1292, "user_id": 6219718, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MEDMt70D6i4/AAAAAAAAAAI/AAAAAAAAASM/MoQBXDayncg/photo.jpg?sz=128", "display_name": "Yuri Lachin", "link": "https://stackoverflow.com/users/6219718/yuri-lachin"}, "edited": false, "score": 1, "creation_date": 1527767077, "post_id": 50484359, "comment_id": 88256773, "body": "Doc (<a href=\"http://jmoiron.github.io/sqlx/\" rel=\"nofollow noreferrer\">jmoiron.github.io/sqlx</a>) on db.Query warns: <code>be sure to call rows.Close() to return the connection back to the pool</code>. Could it be the cause in your case?"}], "owner": {"reputation": 5764, "user_id": 1336532, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/93e5830761f6e85757991d5915369349?s=128&d=identicon&r=PG", "display_name": "Mahoni", "link": "https://stackoverflow.com/users/1336532/mahoni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1906, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1527066839, "creation_date": 1527066839, "question_id": 50484359, "link": "https://stackoverflow.com/questions/50484359/connection-reset-by-peer-broken-pipe-by-too-many-postgres-conncetions", "title": "Connection reset by peer / broken pipe by too many Postgres conncetions", "body": "<p>Using <code>sqlx</code> with a couple concurrent connections I ran quickly into the issue of <code>Too many open connections</code>. Limiting <code>db.DB.MaxOpenConnections</code> got actually rid of the problem and activated the connection pooling I was hoping for.</p>\n\n<p>Now on some machines we observe at a test, which tests exactly that the too many open connections doesn't happen a different error:</p>\n\n<pre><code>read tcp [::1]:54883-&gt;[::1]:5432: read: connection reset by peer\nread tcp [::1]:54886-&gt;[::1]:5432: read: connection reset by peer\nread tcp [::1]:54884-&gt;[::1]:5432: read: connection reset by peer\nread tcp [::1]:54887-&gt;[::1]:5432: read: connection reset by peer\nread tcp [::1]:54885-&gt;[::1]:5432: read: connection reset by peer\nread tcp [::1]:54888-&gt;[::1]:5432: read: connection reset by peer\n\u2026\n</code></pre>\n\n<p>The Postgres logs don't reveal anything. Could it be possible that this happens on the network stack? What else can I do to debug this? I cannot reproduce it locally.</p>\n"}, {"tags": ["ruby", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527066513, "post_id": 50483866, "comment_id": 87981468, "body": "Your title and question don&#39;t match at all. Are you asking about how to send a POST, or how to get a cookie?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527066638, "post_id": 50483866, "comment_id": 87981547, "body": "<code>data[Account][username]=myusername&amp;data[Account][passwd]=myp&zwnj;&#8203;assword</code> is not <code>text&#47;html</code> in the least."}, {"owner": {"reputation": 3691, "user_id": 3732906, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d83d53cbd84d7427ebfd45190b9ded9d?s=128&d=identicon&r=PG&f=1", "display_name": "Coda Chang", "link": "https://stackoverflow.com/users/3732906/coda-chang"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527066915, "post_id": 50483866, "comment_id": 87981754, "body": "@Flimzy, actually, I am not sure how to send the post, so I can get the cookie. I don&#39;t know why to cause this problem. It might have some error of post, it might have errors when getting the cookie."}, {"owner": {"reputation": 3691, "user_id": 3732906, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d83d53cbd84d7427ebfd45190b9ded9d?s=128&d=identicon&r=PG&f=1", "display_name": "Coda Chang", "link": "https://stackoverflow.com/users/3732906/coda-chang"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527066988, "post_id": 50483866, "comment_id": 87981818, "body": "@mkopriva, I post in google chrome, and it states the content type is <code>text&#47;html</code>.  So what is the correct format of <code>data[Account][username]=myusername&amp;data[Account][passwd]=myp&zwnj;&#8203;assword</code> ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527067082, "post_id": 50483866, "comment_id": 87981880, "body": "@CodaChang, if the Content-Type header is not set manually, ruby&#39;s http.post(path, data) sets it automatically to <code>application&#47;x-www-form-urlencoded</code>. <a href=\"https://ruby-doc.org/stdlib-2.1.1/libdoc/net/http/rdoc/Net/HTTP.html#method-i-post\" rel=\"nofollow noreferrer\">ruby-doc.org/stdlib-2.1.1/libdoc/net/http/rdoc/Net/&hellip;</a>"}, {"owner": {"reputation": 3691, "user_id": 3732906, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d83d53cbd84d7427ebfd45190b9ded9d?s=128&d=identicon&r=PG&f=1", "display_name": "Coda Chang", "link": "https://stackoverflow.com/users/3732906/coda-chang"}, "edited": false, "score": 0, "creation_date": 1527067508, "post_id": 50483866, "comment_id": 87982209, "body": "Thanks, it seems the website take both <code>application&#47;x-www-form-urlencoded</code> and <code>text&#47;html</code> as well."}], "answers": [{"tags": [], "owner": {"reputation": 1014, "user_id": 61360, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/70602c12ed1c06db5165ff6a88cd38e0?s=128&d=identicon&r=PG", "display_name": "Mat&#237;as Insaurralde", "link": "https://stackoverflow.com/users/61360/mat%c3%adas-insaurralde"}, "is_accepted": true, "score": 13, "last_activity_date": 1527066173, "creation_date": 1527066173, "answer_id": 50484129, "question_id": 50483866, "link": "https://stackoverflow.com/questions/50483866/get-cookie-from-golang-post/50484129#50484129", "title": "Get cookie from Golang post", "body": "<p>To get the cookies you should call the <code>Cookies()</code> method that's part of <code>http.Response</code>, try this:</p>\n\n<pre><code>for _, cookie := range resp.Cookies() {\n  fmt.Println(\"Found a cookie named:\", cookie.Name)\n}\n</code></pre>\n\n<p>See the <code>Cookie</code> fields <a href=\"https://golang.org/pkg/net/http/#Cookie\" rel=\"noreferrer\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 11048506, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-aPzcWUxDzLQ/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNYAqJ-FvOa4I3E5729rOhDbY5R7g/mo/photo.jpg?sz=128", "display_name": "Muhammed Sertkaya", "link": "https://stackoverflow.com/users/11048506/muhammed-sertkaya"}, "is_accepted": false, "score": 6, "last_activity_date": 1576031122, "creation_date": 1576031122, "answer_id": 59278048, "question_id": 50483866, "link": "https://stackoverflow.com/questions/50483866/get-cookie-from-golang-post/59278048#59278048", "title": "Get cookie from Golang post", "body": "<p>//Create Client</p>\n\n<pre><code>client=http.client{}\n</code></pre>\n\n<p>//Create Varible </p>\n\n<pre><code>var cookie []*http.Cookie\n</code></pre>\n\n<p>//  Create Request</p>\n\n<pre><code>req, _ := http.NewRequest(\"GET\", url, nil)\nresp, err := client.Do(req) //send request\nif err != nil {\nreturn \n}\ncookie = resp.Cookies() //save cookies\n</code></pre>\n\n<p>//  Create New Request</p>\n\n<pre><code>req, _ := http.NewRequest(\"POST\", url, nil)   \nfor i := range cookie {\n    req.AddCookie(cookie[i])\n}\nresp, err := client.Do(req) //send request\nif err != nil {\n      return \n              }\n</code></pre>\n"}], "owner": {"reputation": 3691, "user_id": 3732906, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d83d53cbd84d7427ebfd45190b9ded9d?s=128&d=identicon&r=PG&f=1", "display_name": "Coda Chang", "link": "https://stackoverflow.com/users/3732906/coda-chang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12646, "favorite_count": 2, "accepted_answer_id": 50484129, "answer_count": 2, "score": 8, "last_activity_date": 1576031122, "creation_date": 1527065396, "question_id": 50483866, "link": "https://stackoverflow.com/questions/50483866/get-cookie-from-golang-post", "title": "Get cookie from Golang post", "body": "<p>How do I send the post in GoLang?</p>\n\n<p>I have the following code in <code>ruby</code>, now I need to transfer into Golang.</p>\n\n<pre><code>http = Net::HTTP.new('example.com', 443)\nhttp.use_ssl = true\nhttp\n\npath = '/abc/login'\ndata = 'data[Account][username]=myusername&amp;data[Account][passwd]=mypassword'\nresp, _ = http.post(path, data)\n</code></pre>\n\n<p>This way, I can get the cookie after login request.</p>\n\n<p>But I don't know how to send a post request in Go.</p>\n\n<p>I've written the following code.</p>\n\n<pre><code>path := \"https://example.com/abc/login\"\ndata := strings.NewReader(\"data[Account][username]=myusername&amp;data[Account][passwd]=mypassword\")\nresp, err := http.Post(path, \"text/html; charset=UTF-8\", data)\n</code></pre>\n\n<p>It seems not correct, because I didn't find a way to get cookie.</p>\n"}, {"tags": ["go", "struct", "cgo"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1527056257, "post_id": 50480392, "comment_id": 87975210, "body": "It&#39;s portable. Although your variable names are not idiomatic Go :)"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1527059739, "post_id": 50480392, "comment_id": 87977058, "body": "Notice that in 64 bit systems, size_t is not uint32 but uint64, and ssize_t is equivalent to int64"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1527061312, "post_id": 50480392, "comment_id": 87978045, "body": "If you want a type that changes based on the bitness of the target system, just use <code>int</code>."}], "owner": {"reputation": 121, "user_id": 5609026, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ca22b1192ce4ebf99ae93616b30897b?s=128&d=identicon&r=PG", "display_name": "Shajal Ahamed", "link": "https://stackoverflow.com/users/5609026/shajal-ahamed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1187, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1527056952, "creation_date": 1527053068, "last_edit_date": 1527056952, "question_id": 50480392, "link": "https://stackoverflow.com/questions/50480392/size-t-in-go-without-using-cgo", "title": "size_t in Go without using cgo", "body": "<p>This is a <strong>C</strong> <strong>struct</strong> that I want to port into <strong>Go struct</strong>:</p>\n\n<pre><code>struct InputBuffer_t {\n   char* buffer;\n   size_t buffer_length;\n   ssize_t input_length;\n};\n</code></pre>\n\n<p>But there is a way to declare <strong>buffer_length</strong> variable without using <strong>C.size_t cgo pointer</strong> in <strong>Go</strong>.</p>\n\n<p>This is a concern for portability. If I write the <strong>Go struct</strong> in this way, is it will be portable?</p>\n\n<pre><code>type InputBuffer struct {\n   Buffer        string\n   BufferLength uint32\n   InputLength  uint32\n};\n</code></pre>\n"}, {"tags": ["mysql", "go"], "answers": [{"tags": [], "owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "is_accepted": true, "score": 5, "last_activity_date": 1527035045, "creation_date": 1527035045, "answer_id": 50478187, "question_id": 50477597, "link": "https://stackoverflow.com/questions/50477597/can-i-parameterize-a-create-statement-in-go/50478187#50478187", "title": "Can I parameterize a create statement in Go?", "body": "<p>SQL query parameters take the place of a scalar value only.</p>\n\n<p>That is, you can use a parameter to substitute only where you would otherwise use a constant quoted string, constant quoted date/time, or constant numeric.</p>\n\n<p>SQL query parameters can't be used for:</p>\n\n<ul>\n<li>Table names, column names, or other identifiers</li>\n<li>SQL expressions</li>\n<li>Lists of scalar values (like in an <code>IN(...)</code> predicate)</li>\n<li>SQL keywords</li>\n</ul>\n\n<p>The proper way to write your app that takes user input which describes table structure is to interpret the user input as a guide, not as literal SQL syntax. Avoid passing user input (or any unsafe content) through to be executed as part of any SQL statement.</p>\n"}], "owner": {"reputation": 143, "user_id": 2855831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29dec7ccaaff52ec670d33a5861bec15?s=128&d=identicon&r=PG&f=1", "display_name": "thisischuck", "link": "https://stackoverflow.com/users/2855831/thisischuck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 50478187, "answer_count": 1, "score": 1, "last_activity_date": 1527056362, "creation_date": 1527030245, "last_edit_date": 1527056362, "question_id": 50477597, "link": "https://stackoverflow.com/questions/50477597/can-i-parameterize-a-create-statement-in-go", "title": "Can I parameterize a create statement in Go?", "body": "<p>Using the Go SQL library we can create SELECT, INSERT, UPDATE and DELETE statements with parameters like this:</p>\n\n<pre><code>db.Query(\"SELECT * FROM database.table WHERE param = ?\", param_value)\n</code></pre>\n\n<p>I want to create tables from user provided input that describes the table structure, users will be asked for the name of the table and the name and type of each column they want to create.  However, building a CREATE statement in the query interface  Creating a CREATE statement by concatenating strings together works, but that's a SQL injection attack waiting to happen.  </p>\n\n<p>Is there a way to parameterize CREATE statements using the Go SQL library? </p>\n"}, {"tags": ["go", "code-organization"], "comments": [{"owner": {"reputation": 143, "user_id": 2855831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29dec7ccaaff52ec670d33a5861bec15?s=128&d=identicon&r=PG&f=1", "display_name": "thisischuck", "link": "https://stackoverflow.com/users/2855831/thisischuck"}, "edited": false, "score": 0, "creation_date": 1527032408, "post_id": 50477360, "comment_id": 87969308, "body": "Is there a reason why you are storing node scripts in a Go project?  I assume you&#39;re writing your front end using node tools, the two projects can and should stand alone, communicating over API requests no?"}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "reply_to_user": {"reputation": 143, "user_id": 2855831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29dec7ccaaff52ec670d33a5861bec15?s=128&d=identicon&r=PG&f=1", "display_name": "thisischuck", "link": "https://stackoverflow.com/users/2855831/thisischuck"}, "edited": false, "score": 0, "creation_date": 1527033175, "post_id": 50477360, "comment_id": 87969483, "body": "The front end is totally separate. I have Node in the backend because there are a couple cases where I call a node script from a Go program (for these small tasks, the available Node libraries are much more developed than the comparable Go packages)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1527061339, "post_id": 50477360, "comment_id": 87978063, "body": "&quot;But it would be strange to stick a node script in go/src/project1/node_scripts&quot; Why? (Of course Node code should go to /dev/null :-)"}, {"owner": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "edited": false, "score": 0, "creation_date": 1527063698, "post_id": 50477360, "comment_id": 87979580, "body": "I used to dislike this aspect of Go as well but nowadays I just <code>go get</code> every repository from Github, also non-go repositories. I like that I can clone a repository and put in a logical place (with all other repositories of the same organisation) with a single command. There is nothing wrong with that."}], "owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1527040757, "creation_date": 1527028555, "last_edit_date": 1527040757, "question_id": 50477360, "link": "https://stackoverflow.com/questions/50477360/organizing-go-code-in-repo-alongside-other-languages", "title": "Organizing Go code in repo alongside other languages", "body": "<p>What is the standard way to organize Go code in a repo that also contains scripts from other languages? It seems like you are intended to just have one directory for all of your Go projects, with source code in <code>go/src/project1</code>, <code>go/src/project2</code> etc. But it would be strange to stick a node script in <code>go/src/project1/node_scripts</code>. </p>\n"}, {"tags": ["go", "mocking", "gomock"], "answers": [{"comments": [{"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1551537231, "post_id": 52502366, "comment_id": 96680487, "body": "Hi, I&#39;m having the same issue but your solution does not seem to work."}, {"owner": {"reputation": 31, "user_id": 9105629, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-56tR8LKT45A/AAAAAAAAAAI/AAAAAAAAAA0/Rr10yiHLES4/photo.jpg?sz=128", "display_name": "Patrick Vollebregt", "link": "https://stackoverflow.com/users/9105629/patrick-vollebregt"}, "edited": false, "score": 0, "creation_date": 1551912625, "post_id": 52502366, "comment_id": 96820561, "body": "See: <a href=\"https://github.com/golang/mock/pull/163\" rel=\"nofollow noreferrer\">github.com/golang/mock/pull/163</a> I googled a bit on this error in combination with protobuf and grpc. I guess it has to do with the context package. @mdittmer&#39;s suggestion to use reflect mode should solve your issue."}], "tags": [], "owner": {"reputation": 484, "user_id": 2784575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a8d3fa1b6101c65814851117d1ade9d?s=128&d=identicon&r=PG&f=1", "display_name": "mdittmer", "link": "https://stackoverflow.com/users/2784575/mdittmer"}, "is_accepted": false, "score": 2, "last_activity_date": 1537891265, "creation_date": 1537891265, "answer_id": 52502366, "question_id": 50476955, "link": "https://stackoverflow.com/questions/50476955/resolving-imported-package-collision-for-mockgen/52502366#52502366", "title": "resolving imported package collision for mockgen", "body": "<p>This seems to be an ongoing issue. I just ran into it with it claiming <code>\"rand\"</code> was imported twice (even though my code doesn't import <code>\"rand\"</code>).</p>\n\n<p>The following workaround worked for me: Write down the list of interfaces in <code>myproto.pb.go</code> you wish to mock, and use \"reflect mode\" instead of \"source mode\"</p>\n\n<pre><code>mockgen -package=mocks -destination=mocks/my_mocks.go path.to/package/containing/myproto/pb/go [space-separated interface names]\n</code></pre>\n\n<p>should be equivalent to your previous invocation:</p>\n\n<pre><code>mockgen -package=mocks -source=myproto.pb.go -destination=mocks/my_mocks.go\n</code></pre>\n\n<p>but for some reason is more robust and does not trigger the double-import error.</p>\n"}], "owner": {"reputation": 2880, "user_id": 2848483, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6593ff6dc03719571b02b89e5d23d661?s=128&d=identicon&r=PG", "display_name": "Bren", "link": "https://stackoverflow.com/users/2848483/bren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1548, "favorite_count": 2, "answer_count": 1, "score": 7, "last_activity_date": 1581372312, "creation_date": 1527025968, "last_edit_date": 1527026325, "question_id": 50476955, "link": "https://stackoverflow.com/questions/50476955/resolving-imported-package-collision-for-mockgen", "title": "resolving imported package collision for mockgen", "body": "<p>I have a package collision where I get the following error:\n<code>\nmockgen -package=mocks -source=myproto.pb.go -destination=mocks/my_mocks.go\nimported package collision: \"foo\" imported twice\n</code></p>\n\n<p>I see one import that is obvious:\n<code>import foo \"blah/blah/foo\"</code></p>\n\n<p>But I don't know where to start tracking down the duplicate import (nor where it is coming from). It seems strange to me that this is an issue as I am importing myproto.pb.go just fine, so I'm wondering if there is really an issue w/duplicate imports. Also, GoLand isn't showing any issues.  </p>\n\n<p>I'm hoping someone can point me in the direction of getting more information about where the duplicate import is coming form, checking if there is some issue and/or working around the issue. </p>\n"}, {"tags": ["macos", "shell", "go", "keychain"], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 110, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1527005335, "creation_date": 1527005335, "question_id": 50472149, "link": "https://stackoverflow.com/questions/50472149/retrieve-ssh-passphrase-in-macos-10-13", "title": "retrieve ssh passphrase in macOS &gt;= 10.13", "body": "<p>This is working in <code>macOS &lt; 10.13</code> via command line:</p>\n\n<pre><code>$ security find-generic-password -s \"SSH\" -a \"/Users/&lt;user&gt;/.ssh/id_rsa\" \n</code></pre>\n\n<p>Or using this <a href=\"https://golang.org/\" rel=\"nofollow noreferrer\">go</a> snippet (using <a href=\"https://github.com/keybase/go-keychain\" rel=\"nofollow noreferrer\">https://github.com/keybase/go-keychain</a>):</p>\n\n<pre><code>usr, _ := user.Current()\ndir := usr.HomeDir\nkeyPath, err := filepath.Abs(filepath.Join(dir, \".ssh/id_rsa\"))\nif err != nil {\n        log.Fatal(err)\n}\nkeyPassword, err := GetGenericPassword(\"SSH\", keyPath, \"\", \"\")\nif err != nil {\n        log.Fatal(err)\n}\nfmt.Printf(\"keyPassword = %s\\n\", keyPassword)\n</code></pre>\n\n<p>In macOS High Sierra this has been changed, doesn't work via command line also can't make it to work trying this:</p>\n\n<pre><code>keyPassword, err := keychain.GetGenericPassword(\"OpenSSH\", keyPath, \"SSH: \"+keyPath, \"com.apple.ssh.passphrases\")\nif err != nil {\n        log.Fatal(err)\n}\nfmt.Printf(\"keyPassword = %s\\n\", keyPassword)\n</code></pre>\n\n<p>I fund this post, could be related: <a href=\"https://apple.stackexchange.com/a/268175/104123\">https://apple.stackexchange.com/a/268175/104123</a>.</p>\n\n<p>Any ideas if this is possible in latest macOs versions?</p>\n"}, {"tags": ["go", "base64", "special-characters", "accent-sensitive"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1527004086, "post_id": 50471612, "comment_id": 87957038, "body": "Your base64 encoding string is wrong: <a href=\"https://play.golang.org/p/F8yG_0dyvun\" rel=\"nofollow noreferrer\">play.golang.org/p/F8yG_0dyvun</a>.  The encoded string <code>w5puaWNhOlPDrTp7W8O2w7FdfTpJbnZpdGFjacOzbg==</code> decodes properly to <code>&#218;nica:S&#237;:{[&#246;&#241;]}:Invitaci&#243;n</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1527004333, "post_id": 50471612, "comment_id": 87957187, "body": "The source string is in <a href=\"https://en.wikipedia.org/wiki/ISO/IEC_8859-1\" rel=\"nofollow noreferrer\">8859-1</a> or <a href=\"https://en.wikipedia.org/wiki/Windows-1252\" rel=\"nofollow noreferrer\">Windows-1252</a> encoding, not UTF-8 as the program expects.  Use the <a href=\"https://godoc.org/golang.org/x/text/encoding\" rel=\"nofollow noreferrer\">x/net/encoding</a> to convert the string to UTF-8"}, {"owner": {"reputation": 9, "user_id": 9829492, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-G90_Jf-I-yY/AAAAAAAAAAI/AAAAAAAAI5E/ZtSzkaX6bBM/photo.jpg?sz=128", "display_name": "Carlos Zu&#241;iga", "link": "https://stackoverflow.com/users/9829492/carlos-zu%c3%b1iga"}, "edited": false, "score": 0, "creation_date": 1527005050, "post_id": 50471612, "comment_id": 87957699, "body": "Maybe you are right, but the string of characters is as it is sent by the browser:  atob(&quot;2m5pY2E6U+06e1v28V19Okludml0YWNp824=&quot;) btoa(&quot;&#218;nica:S&#237;:{[&#246;&#241;]}:Invitaci&#243;n&quot;) Any other idea?"}, {"owner": {"reputation": 9, "user_id": 9829492, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-G90_Jf-I-yY/AAAAAAAAAAI/AAAAAAAAI5E/ZtSzkaX6bBM/photo.jpg?sz=128", "display_name": "Carlos Zu&#241;iga", "link": "https://stackoverflow.com/users/9829492/carlos-zu%c3%b1iga"}, "edited": false, "score": 0, "creation_date": 1527005594, "post_id": 50471612, "comment_id": 87958018, "body": "#ThunderCat has right. i just changed this line and everything works. Thanks:  dec := charmap.ISO8859_1.NewDecoder()"}], "answers": [{"tags": [], "owner": {"reputation": 9, "user_id": 9829492, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-G90_Jf-I-yY/AAAAAAAAAAI/AAAAAAAAI5E/ZtSzkaX6bBM/photo.jpg?sz=128", "display_name": "Carlos Zu&#241;iga", "link": "https://stackoverflow.com/users/9829492/carlos-zu%c3%b1iga"}, "is_accepted": false, "score": 0, "last_activity_date": 1527005833, "creation_date": 1527005833, "answer_id": 50472296, "question_id": 50471612, "link": "https://stackoverflow.com/questions/50471612/how-to-decode-base64-string-and-get-the-correct-characters-including-the-accents/50472296#50472296", "title": "How to decode base64 string and get the correct characters including the accents?", "body": "<p>This is the correct code:</p>\n\n<pre><code>    import (\n     \"encoding/base64\"\n     \"fmt\"\n     \"golang.org/x/text/encoding/charmap\"\n    )\n    var authStr = \"2m5pY2E6U+06e1v28V19Okludml0YWNp824=\"\n    arB, _ := base64.StdEncoding.DecodeString(authStr)\n    fmt.Println(\"De arB se obtuvo: \")\n    fmt.Println(string(arB)) \n    dec := charmap.ISO8859_1.NewDecoder()\n    arBdest := make([]byte, len(arB)*2)\n    if n, _, err := dec.Transform(arBdest, []byte(arB), true); err != nil {\n        fmt.Println(\"Error: \", err)\n    } else {\n        arBdest = arBdest[:n]\n        fmt.Println(\"De authStr se obtuvo: \")\n        fmt.Println(string(arBdest))         \n    }\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 9829492, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-G90_Jf-I-yY/AAAAAAAAAAI/AAAAAAAAI5E/ZtSzkaX6bBM/photo.jpg?sz=128", "display_name": "Carlos Zu&#241;iga", "link": "https://stackoverflow.com/users/9829492/carlos-zu%c3%b1iga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1063, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1527005833, "creation_date": 1527003499, "last_edit_date": 1527005677, "question_id": 50471612, "link": "https://stackoverflow.com/questions/50471612/how-to-decode-base64-string-and-get-the-correct-characters-including-the-accents", "title": "How to decode base64 string and get the correct characters including the accents?", "body": "<p>I must decode with golang a string that contains words in Spanish, with accents and special characters. But what I have tried does not work. Could you please guide me on the right path, to get what I need. Thanks in advance. This is my current code:</p>\n\n<pre><code>import (\n    \"encoding/base64\"\n    \"fmt\"\n\n    \"golang.org/x/text/encoding/unicode\"\n)\n\n    var authStr = \"2m5pY2E6U+06e1v28V19Okludml0YWNp824=\"\n    arB, _ := base64.StdEncoding.DecodeString(authStr)\n    fmt.Println(\"De arB se obtuvo: \")\n    fmt.Println(string(arB)) \n    // got-&gt;        \ufffdnica:S\ufffd:{[\ufffd\ufffd]}:Invitaci\ufffdn\n    // expected-&gt;   \u00danica:S\u00ed:{[\u00f6\u00f1]}:Invitaci\u00f3n\n    dec := unicode.UTF8.NewDecoder()\n    arButf8 := make([]byte, len(arB)*2)\n    if n, _, err := dec.Transform(arButf8, []byte(arB), true); err != nil {\n        fmt.Println(\"Error: \", err)\n    } else {\n        arButf8 = arButf8[:n]\n        fmt.Println(\"De authStr se obtuvo: \")\n        fmt.Println(string(arButf8)) \n        // got-&gt;        \ufffdnica:S\ufffd:{[\ufffd\ufffd]}:Invitaci\ufffdn\n        // expected-&gt;   \u00danica:S\u00ed:{[\u00f6\u00f1]}:Invitaci\u00f3n          \n    }\n    // If do with Javascript atob(\"2m5pY2E6U+06e1v28V19Okludml0YWNp824=\") works fine\n</code></pre>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1526999492, "post_id": 50470279, "comment_id": 87953867, "body": "Have you tried just passing the body to the new request?"}, {"owner": {"reputation": 3, "user_id": 9822357, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Bluetear", "link": "https://stackoverflow.com/users/9822357/bluetear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526999653, "post_id": 50470279, "comment_id": 87953989, "body": "Yes, but cannot work well."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1526999785, "post_id": 50470279, "comment_id": 87954072, "body": "What exactly is the problem? That is how you would &quot;stream&quot; the response to a new request."}, {"owner": {"reputation": 3, "user_id": 9822357, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Bluetear", "link": "https://stackoverflow.com/users/9822357/bluetear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527000208, "post_id": 50470279, "comment_id": 87954352, "body": "for example, i read 25 bytes to buf from original body every time, and the new request can read the buf streaming instead of must wait the end of &#39;ReadAll&#39; from body"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1527000495, "post_id": 50470279, "comment_id": 87954553, "body": "What <code>buf</code> are you talking about if you pass the Body directly to the new request? Please create an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> demonstrating the problem you&#39;re having."}, {"owner": {"reputation": 3, "user_id": 9822357, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Bluetear", "link": "https://stackoverflow.com/users/9822357/bluetear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527000844, "post_id": 50470279, "comment_id": 87954803, "body": "Are sure can pass body directly to the new request\uff1fi try this but failed. Thx."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1527000991, "post_id": 50470279, "comment_id": 87954912, "body": "Again, what did you do <i>exactly</i>, and how did it fail? Was there a compilation error? What was the result you expected and what was the result you received?"}, {"owner": {"reputation": 3, "user_id": 9822357, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Bluetear", "link": "https://stackoverflow.com/users/9822357/bluetear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527043104, "post_id": 50470279, "comment_id": 87971655, "body": "Sorry\uff0cI made a stupid mistake. As you said\uff0c pass the Body directly is OK\uff0cthank u very much\u3002"}], "answers": [{"tags": [], "owner": {"reputation": 15599, "user_id": 73831, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4813b578ef6e0ca5ba25a77f57fdb5f1?s=128&d=identicon&r=PG", "display_name": "Sudhir Jonathan", "link": "https://stackoverflow.com/users/73831/sudhir-jonathan"}, "is_accepted": true, "score": 0, "last_activity_date": 1527006350, "creation_date": 1527006350, "answer_id": 50472452, "question_id": 50470279, "link": "https://stackoverflow.com/questions/50470279/how-go-streaming-read-from-request-a-body-to-a-newrequest-s-body/50472452#50472452", "title": "How Go streaming read from request a.body to a newrequest\u2018s body", "body": "<p>Check the <a href=\"https://golang.org/pkg/io/\" rel=\"nofollow noreferrer\"><code>io</code></a> package if you want specialized reader - writer handling, the Pipe or Tee structs might be useful. </p>\n\n<p>In this case, though, </p>\n\n<p><code>request, err := http.NewRequest(http.MethodPut, url, request.Body)</code></p>\n\n<p>should actually just work fine. </p>\n"}], "owner": {"reputation": 3, "user_id": 9822357, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Bluetear", "link": "https://stackoverflow.com/users/9822357/bluetear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 396, "favorite_count": 0, "accepted_answer_id": 50472452, "answer_count": 1, "score": -3, "last_activity_date": 1527006350, "creation_date": 1526999416, "question_id": 50470279, "link": "https://stackoverflow.com/questions/50470279/how-go-streaming-read-from-request-a-body-to-a-newrequest-s-body", "title": "How Go streaming read from request a.body to a newrequest\u2018s body", "body": "<p>Now, i do something like this with Golang:</p>\n\n<pre><code>//read all bytes from body\nbytes, err := ioutil.ReadAll(request.Body)\n//set the bytes as NewReader to new request.body\nrequest, err := http.NewRequest(http.MethodPut, url, bytes.NewReader(bytes))\n</code></pre>\n\n<p>but i want to streaming read from original body(io.Reader) to the new, instead of read all bytes to memory by ReadAll\uff0cand then copy to NewRequest.</p>\n\n<p>How can i implement this?</p>\n\n<p>thx.</p>\n"}, {"tags": ["go", "mqtt", "paho"], "comments": [{"owner": {"reputation": 40434, "user_id": 504554, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/006ffde9ed3fac6396222405fc5e9bf0?s=128&d=identicon&r=PG", "display_name": "hardillb", "link": "https://stackoverflow.com/users/504554/hardillb"}, "edited": false, "score": 2, "creation_date": 1527062406, "post_id": 50469066, "comment_id": 87978776, "body": "You should probably raise that as bug. The client should probably apply all matching topics, not stop when it finds the first match"}, {"owner": {"reputation": 816, "user_id": 2359010, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/612536ffc2d4cb3a96b794da6113b8e9?s=128&d=identicon&r=PG", "display_name": "Arlo Guthrie", "link": "https://stackoverflow.com/users/2359010/arlo-guthrie"}, "edited": false, "score": 0, "creation_date": 1602331245, "post_id": 50469066, "comment_id": 113689942, "body": "Either they have fixed this or I&#39;m using a different version of Mosquitto, because this works for me regardless of the order of the subscription."}], "answers": [{"comments": [{"owner": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "edited": false, "score": 0, "creation_date": 1526998166, "post_id": 50469738, "comment_id": 87952939, "body": "I&#39;m sure that this is not the case. When you visit the implementation (<a href=\"https://github.com/eclipse/paho.mqtt.golang/blob/master/client.go#L550\" rel=\"nofollow noreferrer\">github.com/eclipse/paho.mqtt.golang/blob/master/client.go#L&zwnj;&#8203;550</a>) you see that it only allows one topic."}, {"owner": {"reputation": 573, "user_id": 9620620, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e564dd4ea9cee7b6e67180c0d3dcb5e?s=128&d=identicon&r=PG&f=1", "display_name": "webmite", "link": "https://stackoverflow.com/users/9620620/webmite"}, "reply_to_user": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "edited": false, "score": 0, "creation_date": 1527010857, "post_id": 50469738, "comment_id": 87960727, "body": "My mistake. I was referencing [<a href=\"https://github.com/eclipse/paho.mqtt.python]\" rel=\"nofollow noreferrer\">github.com/eclipse/paho.mqtt.python]</a>.  It supports this syntax and is not sensitive to order."}], "tags": [], "owner": {"reputation": 573, "user_id": 9620620, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e564dd4ea9cee7b6e67180c0d3dcb5e?s=128&d=identicon&r=PG&f=1", "display_name": "webmite", "link": "https://stackoverflow.com/users/9620620/webmite"}, "is_accepted": false, "score": -1, "last_activity_date": 1527011172, "last_edit_date": 1527011172, "creation_date": 1526997870, "answer_id": 50469738, "question_id": 50469066, "link": "https://stackoverflow.com/questions/50469066/how-to-subscribe-to-multiple-mqtt-topics-using-the-paho-mqtt-golang-library/50469738#50469738", "title": "How to subscribe to multiple MQTT topics using the paho.mqtt.golang library?", "body": "<p>For paho.mqtt.python implementation one client can subscribe to multiple subscriptions one call in an Array like so </p>\n\n<pre><code>client.subscribe([(\"P1/#\", 0),(\"P1/controller/registration\", 0)])\n</code></pre>\n\n<p>It is not sensitive to the order of items in the Array. This is not related to the 'golang' language implementation but I leave it here for reference sake.</p>\n"}], "owner": {"reputation": 486, "user_id": 6513167, "user_type": "registered", "accept_rate": 69, "profile_image": "https://graph.facebook.com/597312657096897/picture?type=large", "display_name": "Martin Niederl", "link": "https://stackoverflow.com/users/6513167/martin-niederl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2745, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1539806066, "creation_date": 1526995986, "last_edit_date": 1527003599, "question_id": 50469066, "link": "https://stackoverflow.com/questions/50469066/how-to-subscribe-to-multiple-mqtt-topics-using-the-paho-mqtt-golang-library", "title": "How to subscribe to multiple MQTT topics using the paho.mqtt.golang library?", "body": "<p>I try to connect to a MQTT broker running on an external server where I need to handle multiple different topics. The problem is, that <strong>only the last subscribed handler is called</strong>, even if the topic does not match the one passed as parameter to the <code>Subscribe()</code> method.</p>\n\n<p><strong>Example:</strong>\nsending any content to <code>p1/test</code> triggers the registrationHandler which only should listen for \"<em>P1/controller/registration</em>\". The other handlers or the DefaultPublishHandler are never called.</p>\n\n<p>A simplified version of my program:</p>\n\n<pre><code>func main(){\n    var opts = MQTT.NewClientOptions()\n    opts.AddBroker(address)\n    opts.SetClientID(\"go-controller\")\n\n    opts.SetDefaultPublishHandler(func(client MQTT.Client, msg MQTT.Message) {\n        log.Printf(\"topic: %s\\n\", msg.Topic())\n    })\n\n    client = MQTT.NewClient(opts)\n    if token := client.Connect(); token.Wait() &amp;&amp; token.Error() != nil {\n        log.Panicln(token.Error())\n    }\n\n    client.Subscribe(\"P1/#\", 0, logHandler)\n    client.Subscribe(\"P1/controller/registration\", 0, registrationHandler)\n}\n\nvar logHandler MQTT.MessageHandler = func(client MQTT.Client, msg MQTT.Message) {\n    ...\n    log.Printf(\"Topic %s logged...\\n\", msg.Topic())\n}\n\nvar registrationHandler MQTT.MessageHandler = func(client MQTT.Client, msg MQTT.Message) {\n    ...\n    log.Printf(\"Topic %s registered...\\n\", message.Value)\n}\n</code></pre>\n\n<p><strong>EDIT #1</strong></p>\n\n<p>I found out that the oder of subscribing to topics matters. When I swap both subscription calls the correct handlers get called.</p>\n"}, {"tags": ["go", "bit-manipulation"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1526995659, "post_id": 50468876, "comment_id": 87951033, "body": "Most likely not with the standard lib, but there are 3rd party libs, such as <a href=\"https://github.com/icza/bitio\" rel=\"nofollow noreferrer\"><code>github.com&#47;icza&#47;bitio</code></a> (it&#39;s a bit-level Reader and Writer for Go; disclosure: I&#39;m the author)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1526995718, "post_id": 50468876, "comment_id": 87951083, "body": "Assuming a bijective en-/decoding: No. Just write some code. (Other wise the problem becomes trivial)."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1527000267, "post_id": 50468876, "comment_id": 87954394, "body": "Can you share an example to demonstrate your issue and your attempted solution so others can learn?"}], "owner": {"reputation": 1829, "user_id": 261006, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/67ccb6ee1a893be3dac35a7feff19e09?s=128&d=identicon&r=PG", "display_name": "Jasper", "link": "https://stackoverflow.com/users/261006/jasper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1526995468, "creation_date": 1526995468, "question_id": 50468876, "link": "https://stackoverflow.com/questions/50468876/en-decode-3bit-uints-into-compact-format-e-g-byte-slice", "title": "En-/decode 3bit uints into compact format (e.g. byte slice)", "body": "<p>Having a slice of <code>uint8</code> but knowing that the uints are all smaller than 8: is there a simple way to en-/decode into a compact type using 3 bits a uint? </p>\n\n<p>Only thing I can come up with is a complicated way of building a byte slice.</p>\n"}, {"tags": ["go", "encryption", "hash", "bcrypt"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1526995079, "post_id": 50468319, "comment_id": 87950562, "body": "10 is the default cost and your benchmarks is nonsensical (0.3ns/op means code compiled away by the compiler)."}, {"owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1526995749, "post_id": 50468319, "comment_id": 87951115, "body": "@Volker how can I benchmark time taken to execute the function?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1526996102, "post_id": 50468319, "comment_id": 87951391, "body": "This is largely a matter of opinion and highly dependent upon what level of security is necessary for your particular application. Even <a href=\"https://pages.nist.gov/800-63-3/sp800-63b.html\" rel=\"nofollow noreferrer\">NIST</a> and <a href=\"https://www.owasp.org/index.php/Password_Storage_Cheat_Sheet#Work_Factor\" rel=\"nofollow noreferrer\">OWASP</a>, two of the top sources of security recommendations, remain intentionally vague on the subject of work factors."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1526997292, "post_id": 50468319, "comment_id": 87952311, "body": "@commonSenseCode by not throwing away the result of the hash but e.g. keep it in a global."}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1526997660, "post_id": 50468319, "comment_id": 87952584, "body": "@Volker I&#39;ve been digging into this, and it doesn&#39;t feel like that&#39;s the problem. Even printing the hash doesn&#39;t change the result. I&#39;ve also checked the error result, and it&#39;s fine, too. Even changing this to <code>result, _ = HashPassword(string(b.N), 10)</code> generates the same timing. I&#39;m wondering if it has to do with the calculation of N^work itself? (Though these times are really really short, so I&#39;m not convinced that&#39;s it either.)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1526999407, "post_id": 50468319, "comment_id": 87953794, "body": "@RobNapier This is the problem. Anything below 0.5 ns smells like optimized away. And 0.04ns is a clear sign that nothing was executed at all. You could peek a the generated assembly."}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1527010936, "post_id": 50468319, "comment_id": 87960774, "body": "@Volker Agreed, but\u2026what&#39;s happening? I can&#39;t figure out the Benchmark misuse."}, {"owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "edited": false, "score": 0, "creation_date": 1527184697, "post_id": 50468319, "comment_id": 88043426, "body": "I wonder if HashPassword() is being optimized away altogether? Not sure why changing the constant value would trigger that though."}, {"owner": {"reputation": 161, "user_id": 9069800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad9fe4eb376149861094a554aee23542?s=128&d=identicon&r=PG&f=1", "display_name": "mhombach", "link": "https://stackoverflow.com/users/9069800/mhombach"}, "edited": false, "score": 0, "creation_date": 1610629815, "post_id": 50468319, "comment_id": 116196526, "body": "Just adding for clarity to future readers: If someone gets access to your DB and pass-hashes, he will for sure not use some normal script-lang or lib for brute-forcing it. He will use a cloud-service with immensely GPU-powered power and insane optimized hash-algorithms. So you can&#39;t compare timings here with that. The goal here should not be to find a certain good hashround-number. Instead you should look how many rounds you can implement in YOUR system on YOUR hardware at maximum without reducing usability. Hashing is only one of many security-features :)"}], "answers": [{"comments": [{"owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "edited": false, "score": 1, "creation_date": 1527148373, "post_id": 50470009, "comment_id": 88019983, "body": "so better to just use <code>DefaultCost</code> var from bcrypt package. Do you have an idea why the benchmarks don&#39;t work? when should one use benchmarks? I though it was a perfect use case for comparing bcrypt cost performances"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "reply_to_user": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "edited": false, "score": 0, "creation_date": 1527169137, "post_id": 50470009, "comment_id": 88033929, "body": "I don&#39;t understand the Benchmark issue either. It&#39;s probably worth its own question. Probably worth exploring some other functions (to see if it&#39;s specific to the bcrypt function, or just something non-obvious about Benchmark generally)."}, {"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "edited": false, "score": 1, "creation_date": 1527185995, "post_id": 50470009, "comment_id": 88044088, "body": "Just a tip, you can use <code>time.Since(start)</code> instead of <code>time.Now().Sub(start)</code>"}, {"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 2, "creation_date": 1527199287, "post_id": 50470009, "comment_id": 88050168, "body": "The benchmark issue is due to the fact that you aren&#39;t running the code <code>b.N</code> times.  This is <a href=\"https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go\" rel=\"nofollow noreferrer\">required and not optional</a> when writing Go benchmarks."}, {"owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "reply_to_user": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 1, "creation_date": 1527233105, "post_id": 50470009, "comment_id": 88059223, "body": "check my update the benchmark was incorrectly set, I used @Luke Josua Park resource and got it working. Do you think the output now makes sense it is roughly doubling with every increase of bcryp"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1527254518, "post_id": 50470009, "comment_id": 88072193, "body": "Yes, you should expect doubling with each increase of the work factor. It&#39;s 2^n."}, {"owner": {"reputation": 455, "user_id": 4426048, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8463013a453190e779e152f68f489090?s=128&d=identicon&r=PG", "display_name": "My1", "link": "https://stackoverflow.com/users/4426048/my1"}, "edited": false, "score": 0, "creation_date": 1533202933, "post_id": 50470009, "comment_id": 90264111, "body": "@RobNapier while time is the target on your side, it would be helpful to know how much cost would be at the very least a reasonable minimum for any given era as not everyone has top of the line machines and the question is always whether this old machine that  can only go so far with bcrypt but it would be still ugly because the machine is too old for example. basically a &quot;how low can you go without impacting security too much&quot;"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1533216536, "post_id": 50470009, "comment_id": 90273182, "body": "Agreed. I generally scale work factors based on running tests on the slowest hardware I support, and target certain user experiences there (usually a &quot;slightly annoying, but not too painful&quot; user experience, with the assumption people upgrade eventually). This is also a reason to store your work factor in your data (which I think bcrypt does) so you can increase it over time while still being able to deal with old hashes. (This approach doesn&#39;t always work, especially when you&#39;re dealing with network protocols, but it&#39;s worth pursuing when possible.)"}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 7, "last_activity_date": 1543188705, "last_edit_date": 1543188705, "creation_date": 1526998680, "answer_id": 50470009, "question_id": 50468319, "link": "https://stackoverflow.com/questions/50468319/which-bcrypt-cost-to-use-for-2018/50470009#50470009", "title": "Which bcrypt cost to use for 2018?", "body": "<p>I'm not certain what's going on with Benchmark here. If you just time these, it works fine, and you can work out the right answer for you.</p>\n\n<pre><code>package main\n\nimport (\n    \"golang.org/x/crypto/bcrypt\"\n    \"time\"\n)\n\nfunc main() {\n    cost := 10\n\n    start := time.Now()\n    bcrypt.GenerateFromPassword([]byte(\"password\"), cost)\n    end := time.Now()\n\n    print(end.Sub(start) / time.Millisecond)\n}\n</code></pre>\n\n<p>For a work factor of 10, on my MacBook Pro I get 78ms. A work factor of 11 is 154ms, and 12 is 334ms. So we're seeing roughly doubling, as expected.</p>\n\n<p>The goal is not a work factor; it's a time. You want as long as you can live with. In my experience (mostly working on client apps), 80-100ms is a nice target because compared to a network request it's undetectable to the user, while being massive in terms of brute-force attacks (so the default of 10 is ideal for my common use). </p>\n\n<p>I generally avoid running password stretching on servers if I can help it, but this scale can be a reasonable trade-off between server impact and security. Remember that attackers may use something dramatically faster than a MacBook Pro, and may use multiple machines in parallel; I pick 80-100ms because of user experience trade-offs. (I perform password stretching on the client when I can get away with it, and then apply a cheap hash like SHA-256 on the server.)</p>\n\n<p>But if you don't do this very often, or can spend more time on it, then longer is of course better, and on my MacBook Pro a work factor of 14 is about 1.2s, which I would certainly accept for some purposes.</p>\n\n<p>But there's a reason that 10 is still the default. It's not an unreasonable value.</p>\n"}], "owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11052, "favorite_count": 2, "accepted_answer_id": 50470009, "answer_count": 1, "score": 5, "last_activity_date": 1543188705, "creation_date": 1526993849, "last_edit_date": 1527233007, "question_id": 50468319, "link": "https://stackoverflow.com/questions/50468319/which-bcrypt-cost-to-use-for-2018", "title": "Which bcrypt cost to use for 2018?", "body": "<h1>Update</h1>\n\n<p>Actually it seems the benchmark was incorrectly setup I have followed the <a href=\"https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go\" rel=\"noreferrer\">resource shared</a> by user @Luke Joshua Park and now it works.</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc benchmarkBcrypt(i int, b *testing.B){\n    for n:= 0; n &lt; b.N; n++ {\n        HashPassword(\"my pass\", i)\n        }\n\n}\n\nfunc BenchmarkBcrypt9(b *testing.B){\n    benchmarkBcrypt(9, b)\n}\n\nfunc BenchmarkBcrypt10(b *testing.B){\n    benchmarkBcrypt(10, b)\n}\n\nfunc BenchmarkBcrypt11(b *testing.B){\n    benchmarkBcrypt(11, b)\n}\n\nfunc BenchmarkBcrypt12(b *testing.B){\n    benchmarkBcrypt(12, b)\n}\n\nfunc BenchmarkBcrypt13(b *testing.B){\n    benchmarkBcrypt(13, b)\n}\n\nfunc BenchmarkBcrypt14(b *testing.B){\n    benchmarkBcrypt(14, b)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>BenchmarkBcrypt9-4            30      39543095 ns/op\nBenchmarkBcrypt10-4           20      79184657 ns/op\nBenchmarkBcrypt11-4           10     158688315 ns/op\nBenchmarkBcrypt12-4            5     316070133 ns/op\nBenchmarkBcrypt13-4            2     631838101 ns/op\nBenchmarkBcrypt14-4            1    1275047344 ns/op\nPASS\nok      go-playground   10.670s\n</code></pre>\n\n<hr>\n\n<h1>Old incorrect benchmark</h1>\n\n<p>I have a small set on benchmark test in golang and am curios of to what is a recommended bcrypt cost to use as of May 2018. </p>\n\n<p>This is my benchrmark file:</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc BenchmarkBcrypt10(b *testing.B){\n    HashPassword(\"my pass\", 10)\n}\n\nfunc BenchmarkBcrypt12(b *testing.B){\n    HashPassword(\"my pass\", 12)\n}\n\nfunc BenchmarkBcrypt13(b *testing.B){\n    HashPassword(\"my pass\", 13)\n}\n\n\nfunc BenchmarkBcrypt14(b *testing.B){\n    HashPassword(\"my pass\", 14)\n}\n\nfunc BenchmarkBcrypt15(b *testing.B){\n    HashPassword(\"my pass\", 15)\n}\n</code></pre>\n\n<p>and this is <code>HashPassword()</code> func inside <code>main.go</code>:</p>\n\n<pre><code>import (\n    \"golang.org/x/crypto/bcrypt\"\n)\n\nfunc HashPassword(password string, cost int) (string, error) {\n    bytes, err := bcrypt.GenerateFromPassword([]byte(password), cost)\n    return string(bytes), err\n}\n</code></pre>\n\n<p>The current output is:</p>\n\n<pre><code>go test -bench=.\nBenchmarkBcrypt10-4     2000000000           0.04 ns/op\nBenchmarkBcrypt12-4     2000000000           0.16 ns/op\nBenchmarkBcrypt13-4     2000000000           0.32 ns/op\nBenchmarkBcrypt14-4            1    1281338532 ns/op\nBenchmarkBcrypt15-4            1    2558998327 ns/op\nPASS\n</code></pre>\n\n<p>It seems that for a bcrypt with cost of 13 the time it takes is 0.32 nanoseconds, and for cost 14 the time is 1281338532ns or ~1.2 seconds\nWhich I believe is too much. What do is the best bcrypt cost to use for the current year 2018.</p>\n"}, {"tags": ["json", "go", "struct", "marshalling"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1526994499, "post_id": 50468174, "comment_id": 87950176, "body": "If you change the tag of any of the ID fields (to e.g. <code>`json:&quot;id2&quot;`</code>), both will end up in the JSON. Is that not good enough?"}, {"owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1526995221, "post_id": 50468174, "comment_id": 87950673, "body": "Not sure why people downvotes this question providing no feedback at all. Anyway @icza yes, that would work, but I hoped I did not have to change the JSON marshalling labels of the inner struct. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "edited": false, "score": 0, "creation_date": 1526995402, "post_id": 50468819, "comment_id": 87950819, "body": "Thanks, I&#39;ve amended the question to better suite the Go terminology. Is there a way to avoid changing the JSON marshalling rules for <code>Foo</code>? But doing something in <code>Bar</code> to achieve this same result you suggest?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "edited": false, "score": 1, "creation_date": 1526995603, "post_id": 50468819, "comment_id": 87950991, "body": "@TPPZ How should that work? Wher in the documentation of encoding/json did you find any hint that this might be possible? Why should this be possible at all? You serialize Foo. How Foo is serialized is governed by Foo not by Bar. This is not encoding/xml. If it&#39;s not documented that you can do this then it is not possible. No magic here."}, {"owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "edited": false, "score": 0, "creation_date": 1526995716, "post_id": 50468819, "comment_id": 87951079, "body": "You look so sure about this topic that you deserve your answer to be accepted as it provides a dead simple solution."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 1, "last_activity_date": 1526995287, "creation_date": 1526995287, "answer_id": 50468819, "question_id": 50468174, "link": "https://stackoverflow.com/questions/50468174/marshal-to-json-struct-extended-another-struct-with-the-same-field-label/50468819#50468819", "title": "Marshal to JSON struct extended another struct with the same field label", "body": "<blockquote>\n  <p>One struct (Bar) inherit from the other struct (Foo).</p>\n</blockquote>\n\n<p>Obviously not as there is no inheritance in Go.</p>\n\n<p>If yout want Foo's ID to be named foo_id:</p>\n\n<pre><code>type Foo struct {\n    ID int `json:\"foo_id\"`\n    Stuff string `json:\"stuff\"`\n}\n</code></pre>\n\n<p>Dead simple.</p>\n"}], "owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 566, "favorite_count": 0, "accepted_answer_id": 50468819, "answer_count": 1, "score": 1, "last_activity_date": 1527000140, "creation_date": 1526993383, "last_edit_date": 1527000140, "question_id": 50468174, "link": "https://stackoverflow.com/questions/50468174/marshal-to-json-struct-extended-another-struct-with-the-same-field-label", "title": "Marshal to JSON struct extended another struct with the same field label", "body": "<ul>\n<li>I have 2 <code>struct</code> containing a field with the same label (<code>id</code>) and the same JSON annotation (`json:\"id\"`).</li>\n<li>One <code>struct</code> (<code>Bar</code>) includes the fields labels and their values from the other <code>struct</code> (<code>Foo</code>).</li>\n</ul>\n\n<p>I would like to JSON marshal the wrapper <code>struct</code> <code>Bar</code> with both the <code>id</code> fields, but the inner one with a different JSON annotation (e.g. `json:\"foo_id\"`). I can not find a way to do it, but it looks like something that should be doable?</p>\n\n<p>Having a quick look here <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/</a> I can not find the solution.</p>\n\n<p>Is it possible at all? Is there any work around?\nI am trying to avoid all the boiler plate of get/set to copy/paste values between structs, I hope this is doable somehow.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Foo struct {\n    ID int `json:\"id\"`\n    Stuff string `json:\"stuff\"`\n}\n\ntype Bar struct {\n    ID int `json:\"id\"`\n    Foo\n    // the following does not work, \n    // I've tried a few variations with no luck so far\n    // Foo.ID int `json:\"foo_id\"`\n    OtherStuff string `json:\"other_stuff\"`\n}\n\nfunc main() {\n    foo := Foo{ID: 123, Stuff: \"abc\" }\n    bar := Bar{ID: 456, OtherStuff: \"xyz\", Foo: foo }\n\n    fooJsonStr, _ := json.Marshal(foo)\n    barJsonStr, _ := json.Marshal(bar)\n\n    fmt.Printf(\"Foo: %s\\n\", fooJsonStr)\n    fmt.Printf(\"Bar: %s\\n\", barJsonStr)\n}\n</code></pre>\n\n<p>Gives this output:</p>\n\n<pre><code>Foo: {\"id\":123,\"stuff\":\"abc\"} \nBar: {\"id\":456,\"stuff\":\"abc\",\"other_stuff\":\"xyz\"}\n</code></pre>\n"}, {"tags": ["go", "command-line", "command-line-interface"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1526990771, "post_id": 50467130, "comment_id": 87947510, "body": "Thanks i&#39;ll try it and let you know :)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1526991354, "post_id": 50467130, "comment_id": 87947899, "body": "question, in case I use <code>cmd.start</code> and then <code>cmd.wait</code>  where is better to close the indicator ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1526991423, "post_id": 50467130, "comment_id": 87947935, "body": "When the command completes, which in that case would be after <code>Cmd.Wait()</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1526991852, "post_id": 50467130, "comment_id": 87948222, "body": "its working and creating dots one after another until it prints someting, is there a way to print just 3 dots and start again like <code>. .. ...</code> <code>. .. ...</code> ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1526991956, "post_id": 50467130, "comment_id": 87948306, "body": "@RaynD For that you would need a 3rd party lib like <a href=\"https://github.com/nsf/termbox-go\" rel=\"nofollow noreferrer\"><code>termbox-go</code></a>. You could however also print a newline after every 3 or 5 dots if that helps, no 3rd party lib is needed for that."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1526992258, "post_id": 50467130, "comment_id": 87948561, "body": "I dont want to use third party :), so you are saying that with you code it cannot be done ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1526992333, "post_id": 50467130, "comment_id": 87948625, "body": "You want to manipulate text already written to the terminal, the standard library does not have support for this. You may do this with some terminals by printing control characters, but that solution is not portable."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1526992435, "post_id": 50467130, "comment_id": 87948707, "body": "and your suggestion to print new line, how can I know when to print new line, any example ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1526992667, "post_id": 50467130, "comment_id": 87948878, "body": "btw the lib <a href=\"https://github.com/kyu-suke/wot\" rel=\"nofollow noreferrer\">github.com/kyu-suke/wot</a> which you provide as reference is using a game as waiting indicator :) , for me it&#39;s a bit overkill..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1526993322, "post_id": 50467130, "comment_id": 87949323, "body": "im closing the question, it will be great if you can add example for your suggestion &quot;You could however also print a newline after every 3 or 5 dots if that help&quot; , thanks!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1526993352, "post_id": 50467130, "comment_id": 87949347, "body": "@RaynD Added example how to start a new line after every 5 dots."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1526993761, "post_id": 50467130, "comment_id": 87949636, "body": "do you mean someting like this` \ti := 0 \tticker := time.NewTicker(time.Second) \tdefer ticker.Stop() \tfor { \t\tselect { \t\tcase &lt;-ticker.C: \t\t \t\t\tfmt.Print(&quot;.&quot;) \t\t\ti++ \t\t\tif (i==3){ \t\t\t\tfmt.Println() \t\t\t\ti = 0 \t\t\t} \t\tcase &lt;-shutdownCh: \t\t\treturn \t\t} \t}` ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1526993798, "post_id": 50467130, "comment_id": 87949653, "body": "<code>func indicator(shutdownCh &lt;-chan struct{}) { \t \ti := 0 \tticker := time.NewTicker(time.Second) \tdefer ticker.Stop() \tfor { \t\tselect { \t\tcase &lt;-ticker.C: \t\t \t\t\tfmt.Print(&quot;.&quot;) \t\t\ti++ \t\t\tif (i==3){ \t\t\t\tfmt.Println() \t\t\t\ti = 0 \t\t\t} \t\tcase &lt;-shutdownCh: \t\t\treturn \t\t} \t} }</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1526998427, "last_edit_date": 1526998427, "creation_date": 1526990375, "answer_id": 50467130, "question_id": 50467037, "link": "https://stackoverflow.com/questions/50467037/creating-waiting-busy-indicator-for-executed-process/50467130#50467130", "title": "Creating waiting/busy indicator for executed process", "body": "<p>You may use another goroutine to print something (like a dot) periodically, like in every second. When the command completes, signal that goroutine to terminate.</p>\n\n<p>Something like this:</p>\n\n<pre><code>func indicator(shutdownCh &lt;-chan struct{}) {\n    ticker := time.NewTicker(time.Second)\n    defer ticker.Stop()\n    for {\n        select {\n        case &lt;-ticker.C:\n            fmt.Print(\".\")\n        case &lt;-shutdownCh:\n            return\n        }\n    }\n}\n\nfunc main() {\n    cmd := exec.Command(\"npm\", \"install\")\n    log.Printf(\"Running command and waiting for it to finish...\")\n\n    // Start indicator:\n    shutdownCh := make(chan struct{})\n    go indicator(shutdownCh)\n\n    err := cmd.Run()\n\n    close(shutdownCh) // Signal indicator() to terminate\n\n    fmt.Println()\n    log.Printf(\"Command finished with error: %v\", err)\n}\n</code></pre>\n\n<p>If you want to start a new line after every 5 dots, this is how it can be done:</p>\n\n<pre><code>func indicator(shutdownCh &lt;-chan struct{}) {\n    ticker := time.NewTicker(time.Second)\n    defer ticker.Stop()\n    for i := 0; ; {\n        select {\n        case &lt;-ticker.C:\n            fmt.Print(\".\")\n            if i++; i%5 == 0 {\n                fmt.Println()\n            }\n        case &lt;-shutdownCh:\n            return\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10920, "user_id": 60580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b03012df2fca279ed49526f5433fd0c?s=128&d=identicon&r=PG", "display_name": "Jimmy Stenke", "link": "https://stackoverflow.com/users/60580/jimmy-stenke"}, "is_accepted": false, "score": 1, "last_activity_date": 1526991569, "creation_date": 1526991569, "answer_id": 50467506, "question_id": 50467037, "link": "https://stackoverflow.com/questions/50467037/creating-waiting-busy-indicator-for-executed-process/50467506#50467506", "title": "Creating waiting/busy indicator for executed process", "body": "<p>Another way is to turn icza's answer around. Since the npm command is a long-running execution, it would probably be better to use a goroutine for it instead of the ticker (or both as a goroutine), but it's a matter of preference.</p>\n\n<p>Like this: </p>\n\n<pre><code>func npmInstall(done chan struct{}) {\n    cmd := exec.Command(\"npm\", \"install\")\n    log.Printf(\"Running command and waiting for it to finish...\")\n\n    err := cmd.Run()\n    if err != nil {\n        log.Printf(\"\\nCommand finished with error: %v\", err)\n    }\n    close(done)\n}\n\nfunc main() {\n    done := make(chan struct{})\n    go npmInstall(done)\n\n    ticker := time.NewTicker(3 * time.Second)\n    defer ticker.Stop()\n    for {\n        select {\n        case &lt;-ticker.C:\n            fmt.Print(\".\")\n        case &lt;-done:\n            fmt.Println()\n            return\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "accepted_answer_id": 50467130, "answer_count": 2, "score": 4, "last_activity_date": 1526998427, "creation_date": 1526990071, "question_id": 50467037, "link": "https://stackoverflow.com/questions/50467037/creating-waiting-busy-indicator-for-executed-process", "title": "Creating waiting/busy indicator for executed process", "body": "<p>i've program which execute child process like </p>\n\n<pre><code>cmd := exec.Command(\"npm\", \"install\")\nlog.Printf(\"Running command and waiting for it to finish...\")\nerr := cmd.Run()\nlog.Printf(\"Command finished with error: %v\", err)\n</code></pre>\n\n<p>While this command is running it download and install npm packages which take some time between 10 to 40 sec, and the user doesnt know what happen until he see the stdout (10-40 sec depend on the network) , there is something that I can use which prints something to the cli to make it more clear that something happen, some busy indicator(any type) until the stdout is printed to the cli ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1526989937, "post_id": 50466452, "comment_id": 87947023, "body": "I may be wrong but I don&#39;t think there is. The best you can do, I believe, is to use <a href=\"https://golang.org/pkg/testing/#Benchmark\" rel=\"nofollow noreferrer\">Benchmark</a> and print the <a href=\"https://golang.org/pkg/testing/#BenchmarkResult\" rel=\"nofollow noreferrer\">BenchmarkResult</a> however you want, but I&#39;m unsure whether that won&#39;t conflict with <code>-bench=.</code>."}, {"owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1526990225, "post_id": 50466452, "comment_id": 87947189, "body": "@mkopriva where would I override the benchmark func? inside the same file as where I wrote the benchmarks? I have included my benchmark file please see update. If you don&#39;t mind maybe you can include code sample thanks"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1526990911, "post_id": 50466452, "comment_id": 87947593, "body": "Does this help? <a href=\"https://play.golang.org/p/9aQmPFKDTFJ\" rel=\"nofollow noreferrer\">play.golang.org/p/9aQmPFKDTFJ</a>"}], "owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1614, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1526990251, "creation_date": 1526988234, "last_edit_date": 1526990251, "question_id": 50466452, "link": "https://stackoverflow.com/questions/50466452/change-golang-tests-benchmarks-time-unit-results", "title": "Change golang tests/benchmarks time unit results", "body": "<p>Currently when doing a golang benchmark on a small function I have in golang I get the following results</p>\n\n<pre><code>go test -bench=.\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>BenchmarkBcrypt10-4     1000000000           0.08 ns/op\nBenchmarkBcrypt15-4            1    2607594388 ns/op\nBenchmarkBcrypt18-4            1    20472224268 ns/op\nPASS\n</code></pre>\n\n<p>Is there anyway to change the time unit from ns to milisecons or seconds?</p>\n\n<h1>Update:</h1>\n\n<p>This is my benchmark file (<code>bcrypt_test.go</code>):</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc BenchmarkBcrypt10(b *testing.B){\n    HashPassword(\"my pass\", 10)\n}\n\nfunc BenchmarkBcrypt15(b *testing.B){\n    HashPassword(\"my pass\", 15)\n}\n\n\nfunc BenchmarkBcrypt18(b *testing.B){\n    HashPassword(\"my pass\", 18)\n}\n</code></pre>\n\n<p>and my <code>main.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"golang.org/x/crypto/bcrypt\"\n)\n\nfunc HashPassword(password string, cost int) (string, error) {\n    bytes, err := bcrypt.GenerateFromPassword([]byte(password), cost)\n    return string(bytes), err\n}\n\nfunc CheckPasswordHash(password, hash string) bool {\n    err := bcrypt.CompareHashAndPassword([]byte(hash), []byte(password))\n    return err == nil\n}\n\nfunc main() {\n    password := \"secret\"\n    hash, _ := HashPassword(password, 12) // ignore error for the sake of simplicity\n\n    fmt.Println(\"Password:\", password)\n    fmt.Println(\"Hash:    \", hash)\n\n    match := CheckPasswordHash(password, hash)\n    fmt.Println(\"Match:   \", match)\n}\n</code></pre>\n"}, {"tags": ["docker", "go"], "answers": [{"tags": [], "owner": {"reputation": 3913, "user_id": 3710800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b06275b7ae4d1d759875b312db2102f?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaume Barr&#233;", "link": "https://stackoverflow.com/users/3710800/guillaume-barr%c3%a9"}, "is_accepted": true, "score": 1, "last_activity_date": 1529392851, "creation_date": 1529392851, "answer_id": 50922687, "question_id": 50465273, "link": "https://stackoverflow.com/questions/50465273/go-docker-client-get-container-logs-every-seconds-returns-nothing/50922687#50922687", "title": "go-docker client get container logs every seconds returns nothing", "body": "<p>Finally I got it working using the <code>nowUTC :=time.Now().UTC()</code>, but the issue was not only on the time format used.</p>\n\n<p>The trick is that I was using \"<strong>Docker Machine</strong>\" on a laptop and I was closing my laptop every night. Whenever the laptop goes asleep the internal clock of the Docker Machine freeze.</p>\n\n<p>When the laptop wakes up from sleep it results into a time drift between the laptop clock and Docker Machine's clock, and my Docker Machine was x hours late.</p>\n\n<p>My Go code runs into an CLI app on my laptop and the time criteria of the request to extract the logs never matches the log content.</p>\n\n<p>Everything works fine after a <code>docker-machine restart</code></p>\n"}], "owner": {"reputation": 3913, "user_id": 3710800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b06275b7ae4d1d759875b312db2102f?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaume Barr&#233;", "link": "https://stackoverflow.com/users/3710800/guillaume-barr%c3%a9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 50922687, "answer_count": 1, "score": 1, "last_activity_date": 1529392851, "creation_date": 1526984438, "question_id": 50465273, "link": "https://stackoverflow.com/questions/50465273/go-docker-client-get-container-logs-every-seconds-returns-nothing", "title": "go-docker client get container logs every seconds returns nothing", "body": "<p>I'm using the <code>docker.io/go-docker</code> package to launch a container with GO.\nI'm able to get all the logs of the container once its main method returns</p>\n\n<pre><code>if err := cli.ContainerStart(context.Background(), resp.ID, types.ContainerStartOptions{}); err != nil {\n    panic(err)\n}\n\nstatusCh, errCh = cli.ContainerWait(context.Background(), resp.ID, container.WaitConditionNotRunning)\n\nselect {\n    case err := &lt;-errCh:\n        if err != nil {\n            panic(err)\n        }\n    case &lt;-statusCh:\n}\n\nout, err := cli.ContainerLogs(context.Background(), resp.ID, types.ContainerLogsOptions{ShowStdout: true, ShowStderr: true})\nif err != nil {\n    panic(err)\n}\n// Do something with the logs here...\n</code></pre>\n\n<p>The trick is that the main method execution takes a while and I want to show the container logs to the user every seconds.\nMy idea was to start a new goroutine to loop and make a request on <code>cli.ContainerLogs</code>. </p>\n\n<p>So I changed my implementation to this :</p>\n\n<pre><code>nowUTC := strconv.FormatInt(time.Now().UTC().UnixNano(), 10)\n\nif err := cli.ContainerStart(context.Background(), resp.ID, types.ContainerStartOptions{}); err != nil {\n    panic(err)\n}\n\nstatusCh, errCh = cli.ContainerWait(context.Background(), resp.ID, container.WaitConditionNotRunning)\n\nexitCh := make(chan bool)\n\ngo func(since string, exit chan bool) {\n\nLoop:\n\n    for {\n        select {\n        case &lt;-exit:\n            break Loop\n        default:\n\n            sinceReq := since\n            time.Sleep(time.Second)\n            since = strconv.FormatInt(time.Now().UTC().UnixNano(), 10)\n            out, err := cli.ContainerLogs(context.Background(), resp.ID, types.ContainerLogsOptions{Since: sinceReq, ShowStdout: true, ShowStderr: true})\n            if err != nil {\n                panic(err)\n            }\n\n            b, err := ioutil.ReadAll(out)\n            if err != nil {\n                panic(err)\n            }\n            log.Printf(\"Rolling log Contener \\n%s\", string(b))\n            // Do something with the logs here...\n        }\n    }\n}(nowUTC, exitCh)\n\n\nselect {\ncase err := &lt;-errCh:\n    exitCh &lt;- true\n    if err != nil {\n        panic(err)\n    }\ncase &lt;-statusCh:\n    exitCh &lt;- true\n}\n</code></pre>\n\n<p>Everything is fine except that <code>ioutil.ReadAll(out)</code> returns nothing.</p>\n\n<p>I have tried to use several times or time formats like but still without any results:</p>\n\n<ul>\n<li>nowUTC := strconv.FormatInt(time.Now().UTC().UnixNano(), 10)</li>\n<li>nowUTC := strconv.FormatInt(time.Now().UTC().Unix(), 10)</li>\n<li>nowUTC := strconv.FormatInt(time.Now().UnixNano(), 10)</li>\n<li>nowUTC := strconv.FormatInt(time.Now().Unix(), 10)</li>\n<li>nowUTC := time.Now().Format(time.RFC3339)</li>\n</ul>\n\n<p>What am I mising?</p>\n"}, {"tags": ["c#", "go", "compilation", "shared-libraries", "shared"], "comments": [{"owner": {"reputation": 7510, "user_id": 1132334, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8o6Nl.png?s=128&g=1", "display_name": "Cee McSharpface", "link": "https://stackoverflow.com/users/1132334/cee-mcsharpface"}, "edited": false, "score": 1, "creation_date": 1526982802, "post_id": 50464667, "comment_id": 87942572, "body": "why is the name of the referenced external function <code>File</code> and not <code>Test</code>? the error you get is related to 32bit WOW vs. 64bit image, probably due to the <code>-lWS2_32</code> compiler flag. both must have the same bitness."}, {"owner": {"reputation": 2804, "user_id": 2326753, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tzfnK.png?s=128&g=1", "display_name": "C4d", "link": "https://stackoverflow.com/users/2326753/c4d"}, "reply_to_user": {"reputation": 7510, "user_id": 1132334, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8o6Nl.png?s=128&g=1", "display_name": "Cee McSharpface", "link": "https://stackoverflow.com/users/1132334/cee-mcsharpface"}, "edited": false, "score": 0, "creation_date": 1526987186, "post_id": 50464667, "comment_id": 87945335, "body": "@dlatikay Was just a typo. In my first test both was called <code>File()</code>. Edited the question."}, {"owner": {"reputation": 2804, "user_id": 2326753, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tzfnK.png?s=128&g=1", "display_name": "C4d", "link": "https://stackoverflow.com/users/2326753/c4d"}, "reply_to_user": {"reputation": 7510, "user_id": 1132334, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8o6Nl.png?s=128&g=1", "display_name": "Cee McSharpface", "link": "https://stackoverflow.com/users/1132334/cee-mcsharpface"}, "edited": false, "score": 0, "creation_date": 1526990814, "post_id": 50464667, "comment_id": 87947543, "body": "I just don&#39;t get whats the counterpart of <code>WS2_32</code> for 64bit.."}], "answers": [{"tags": [], "owner": {"reputation": 2804, "user_id": 2326753, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tzfnK.png?s=128&g=1", "display_name": "C4d", "link": "https://stackoverflow.com/users/2326753/c4d"}, "is_accepted": true, "score": 1, "last_activity_date": 1526992945, "creation_date": 1526992945, "answer_id": 50468019, "question_id": 50464667, "link": "https://stackoverflow.com/questions/50464667/go-to-library-to-c-badimageformatexception/50468019#50468019", "title": "Go to library to C# | BadImageFormatException", "body": "<p>Well, in the given answer here <a href=\"https://social.msdn.microsoft.com/Forums/vstudio/en-US/ee3df896-1d33-451b-a8a3-716294b44b2b/socket-programming-on-64bit-machine?forum=vclanguage\" rel=\"nofollow noreferrer\">https://social.msdn.microsoft.com/Forums/vstudio/en-US/ee3df896-1d33-451b-a8a3-716294b44b2b/socket-programming-on-64bit-machine?forum=vclanguage</a> there is written:  </p>\n\n<blockquote>\n  <p>The implementation is in a file called ws2_32.dll and there are 32-bit and 64-bit versions of the DLL in 64-bit Windows.</p>\n</blockquote>\n\n<p>So the build as described in my question is correct.</p>\n\n<p><strong>Solution</strong><br>\nThe C#-Project has to be explicitly set to x64. <code>AnyCPU</code> won't work and throw the error shown in the question above.</p>\n\n<p>Everything is working now. I'm leaving the question and answer as this is a full explanation of how to get go-code running out of C#.</p>\n"}], "owner": {"reputation": 2804, "user_id": 2326753, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tzfnK.png?s=128&g=1", "display_name": "C4d", "link": "https://stackoverflow.com/users/2326753/c4d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 50468019, "answer_count": 1, "score": 1, "last_activity_date": 1526992945, "creation_date": 1526982599, "last_edit_date": 1526987132, "question_id": 50464667, "link": "https://stackoverflow.com/questions/50464667/go-to-library-to-c-badimageformatexception", "title": "Go to library to C# | BadImageFormatException", "body": "<p>I would like to create a library out of go-code and use it inside a C# winforms project.<br>\n<strong>For the error scroll to the bottom.</strong></p>\n\n<p><strong>Setup</strong>  </p>\n\n<ul>\n<li>GO 1.10.2  </li>\n<li>tdm-gcc-5.1.0-3</li>\n<li>Windows 10 / x64</li>\n<li>Go-project called <code>exprt</code></li>\n</ul>\n\n<p><strong>What I've tried</strong></p>\n\n<p>I've created a minimal go-tool that creates a file in the working-dir:</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"C\"\n)\n\nfunc main() {\n    // nothing here\n}\n\n//export Test\nfunc Test() {\n    os.OpenFile(\"created_file.txt\", os.O_RDONLY|os.O_CREATE, 0666);\n}\n</code></pre>\n\n<p><em>The next steps were taken from <a href=\"https://stackoverflow.com/questions/40573401/building-a-dll-with-go-1-7\">Building a dll with Go 1.7</a>.</em></p>\n\n<p>I've then compiled to <code>c-archive</code> with the following command: <code>go build -buildmode=c-archive</code> which gives me <code>exprt.a</code> and <code>exprt.h</code>.</p>\n\n<p>After that I've created a file called <code>goDLL.c</code> (1:1 as in the link above) and inserted this code:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include \"exprt.h\"\n// force gcc to link in go runtime (may be a better solution than this)\nvoid dummy() {\n    Test();\n}\nint main() {\n}\n</code></pre>\n\n<p>Lastly I've run this command to create my final dll:<br>\n<code>gcc -shared -pthread -o goDLL.dll goDLL.c exprt.a -lWinMM -lntdll -lWS2_32</code>\nwhich gave me \"goDLL.dll\".</p>\n\n<p><strong>My problem</strong></p>\n\n<p>In C# I've created a winforms-project with 1 button that calls this declared function (copied the dll to the debug-folder):</p>\n\n<pre><code>[DllImport(\"goDLL.dll\")]\nprivate static extern void Test();\n</code></pre>\n\n<p><strong>Error</strong></p>\n\n<p><code>System.BadImageFormatException: \"An attempt was made to load a program with an incorrect format. (HRESULT: 0x8007000B)\"</code></p>\n\n<p>Sorry for that big block of text but this was the most minimal test I could think off.  </p>\n\n<p>I appreciate every help in here.</p>\n"}, {"tags": ["c++", "linux", "windows", "user-interface", "go"], "owner": {"reputation": 41, "user_id": 8503790, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nMKDjgbgPW8/AAAAAAAAAAI/AAAAAAAABT8/8DP0kq44Trs/photo.jpg?sz=128", "display_name": "Anshu Ahirwar", "link": "https://stackoverflow.com/users/8503790/anshu-ahirwar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 159, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1527058374, "creation_date": 1526982156, "last_edit_date": 1527058374, "question_id": 50464515, "link": "https://stackoverflow.com/questions/50464515/how-to-set-length-of-box-in-golang-using-andlabs-ui", "title": "how to set length of box in golang using andlabs ui?", "body": "<p>I am making a graphics page using andlabs ui. I want to increase length of seearch box. How can we increase it? How can we increase box length and set box height and width?</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/andlabs/ui\"\n)\n\n\nfunc main() {\n    err := ui.Main(func() {\n\n        hbox := ui.NewHorizontalBox();      \n\n        left_hbox := ui.NewHorizontalBox();\n        hbox.Append(left_hbox, true)\n\n        search_vbox := ui.NewVerticalBox()\n        hbox.Append(search_vbox, true)\n\n        search_hbox := ui.NewHorizontalBox()\n        search_vbox.Append(search_hbox, true)\n\n        search_input := ui.NewEntry();\n        search_hbox.Append(search_input, true)\n\n        search_button := ui.NewButton(\"   \ud83d\udd0d   \");\n        search_hbox.Append(search_button, false)\n\n        right_hbox := ui.NewHorizontalBox();\n        hbox.Append(right_hbox, true)\n\n        upload_button := ui.NewButton(\"Upload\")\n        right_hbox.Append(upload_button, false)\n\n        box := ui.NewVerticalBox();\n        box.Append(hbox, false)\n\n        window := ui.NewWindow(\"MyWindow\", 800, 600, false)\n        window.SetMargined(true)\n        window.SetChild(box)\n        window.OnClosing(func(*ui.Window) bool {\n            ui.Quit()\n            return true\n        })\n        window.Show()\n    })\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>How can we do so? Is there any function so that we can set box length?</p>\n"}, {"tags": ["go", "aws-lambda"], "comments": [{"owner": {"reputation": 4395, "user_id": 442219, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TKAbI.jpg?s=128&g=1", "display_name": "tothemario", "link": "https://stackoverflow.com/users/442219/tothemario"}, "edited": false, "score": 0, "creation_date": 1574306243, "post_id": 50464253, "comment_id": 104188236, "body": "Mind adding a link to the docs? What is a cold-start exactly?"}, {"owner": {"reputation": 1278, "user_id": 108826, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/861ed516fb54db2217b7e90aee1d2d3f?s=128&d=identicon&r=PG&f=1", "display_name": "S2201", "link": "https://stackoverflow.com/users/108826/s2201"}, "reply_to_user": {"reputation": 4395, "user_id": 442219, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TKAbI.jpg?s=128&g=1", "display_name": "tothemario", "link": "https://stackoverflow.com/users/442219/tothemario"}, "edited": false, "score": 0, "creation_date": 1574397953, "post_id": 50464253, "comment_id": 104227146, "body": "@tothemario <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/go-programming-model-errors.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/lambda/latest/dg/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1278, "user_id": 108826, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/861ed516fb54db2217b7e90aee1d2d3f?s=128&d=identicon&r=PG&f=1", "display_name": "S2201", "link": "https://stackoverflow.com/users/108826/s2201"}, "edited": false, "score": 0, "creation_date": 1526992520, "post_id": 50465548, "comment_id": 87948767, "body": "Now I\u2019m thinking if the lambda can\u2019t create AWS session, maybe it\u2019s a good reason to cold restart?... to re-init the lambda."}], "tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": false, "score": 5, "last_activity_date": 1526985283, "creation_date": 1526985283, "answer_id": 50465548, "question_id": 50464253, "link": "https://stackoverflow.com/questions/50464253/aws-lambda-golang-errors/50465548#50465548", "title": "AWS Lambda GoLang Errors", "body": "<p>Yes. A panic will trigger a cold restart of your code. The use of panic should be reserved for exceptional circumstances; returning an error is to be preferred in most circumstances. </p>\n"}, {"tags": [], "owner": {"reputation": 36, "user_id": 8940517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a10915178248bfed489a9046dad4d0b?s=128&d=identicon&r=PG&f=1", "display_name": "Dmitriy Shadow", "link": "https://stackoverflow.com/users/8940517/dmitriy-shadow"}, "is_accepted": true, "score": 2, "last_activity_date": 1527623281, "creation_date": 1527623281, "answer_id": 50591885, "question_id": 50464253, "link": "https://stackoverflow.com/questions/50464253/aws-lambda-golang-errors/50591885#50591885", "title": "AWS Lambda GoLang Errors", "body": "<p>The answer depends on what is going on in init section. </p>\n\n<p>If you create session clients to connect to other services it might be good to panic and cause cold-start than continue container's lifecycle with the failed clients. </p>\n"}], "owner": {"reputation": 1278, "user_id": 108826, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/861ed516fb54db2217b7e90aee1d2d3f?s=128&d=identicon&r=PG&f=1", "display_name": "S2201", "link": "https://stackoverflow.com/users/108826/s2201"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1127, "favorite_count": 0, "accepted_answer_id": 50591885, "answer_count": 2, "score": 5, "last_activity_date": 1527623281, "creation_date": 1526981391, "question_id": 50464253, "link": "https://stackoverflow.com/questions/50464253/aws-lambda-golang-errors", "title": "AWS Lambda GoLang Errors", "body": "<p>Is it OK to <code>panic()</code> when failed to create AWS session?\nAs an opposite, I can just return the error from my handler function (in this case I have to create the session in the handler code, but not in the <code>init()</code>).</p>\n\n<p>The docs say</p>\n\n<blockquote>\n  <p>Lambda will re-create the function automatically</p>\n</blockquote>\n\n<p>Does it mean the panic always causes the cold-start and is preferred to return error from the handler?</p>\n"}, {"tags": ["go", "enums", "protocol-buffers"], "answers": [{"comments": [{"owner": {"reputation": 2304, "user_id": 2126889, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ZLkKF.jpg?s=128&g=1", "display_name": "timthelion", "link": "https://stackoverflow.com/users/2126889/timthelion"}, "edited": false, "score": 0, "creation_date": 1526983509, "post_id": 50464408, "comment_id": 87943082, "body": "When and why would the Enum method not be created?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2304, "user_id": 2126889, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ZLkKF.jpg?s=128&g=1", "display_name": "timthelion", "link": "https://stackoverflow.com/users/2126889/timthelion"}, "edited": false, "score": 0, "creation_date": 1526984426, "post_id": 50464408, "comment_id": 87943664, "body": "@timthelion I&#39;m not sure, but I use protobuf too, and I don&#39;t have this <code>Enum()</code> method generated to my enums."}, {"owner": {"reputation": 2304, "user_id": 2126889, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ZLkKF.jpg?s=128&g=1", "display_name": "timthelion", "link": "https://stackoverflow.com/users/2126889/timthelion"}, "edited": false, "score": 0, "creation_date": 1526985931, "post_id": 50464408, "comment_id": 87944547, "body": "are you using proto3 by any chance? Looking at <a href=\"https://github.com/golang/protobuf/blob/b4deda0973fb4c70b50d226b1af49f3da59f5265/protoc-gen-go/generator/generator.go#L1424\" rel=\"nofollow noreferrer\">the code</a> I see that the Enum method is not created for proto3 files, perhaps because proto3 does not support optional fields."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2304, "user_id": 2126889, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ZLkKF.jpg?s=128&g=1", "display_name": "timthelion", "link": "https://stackoverflow.com/users/2126889/timthelion"}, "edited": false, "score": 0, "creation_date": 1526985996, "post_id": 50464408, "comment_id": 87944580, "body": "@timthelion Yes, was just about to comment. I&#39;ve looked into it. If you use <code>syntax=&quot;proto2&quot;</code>, the field is generated as pointer, and <code>Enum()</code> method is added to enums. When <code>syntax=&quot;proto3&quot;</code>, the field is non-pointer, and no <code>Enum()</code> method is generated. So if you &quot;upgrade&quot; to <code>&quot;proto3&quot;</code>, you will &quot;lose&quot; the <code>Enum()</code> method. And yes, in <code>proto3</code>, fields are <code>optional</code> by default."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1526990684, "last_edit_date": 1526990684, "creation_date": 1526981820, "answer_id": 50464408, "question_id": 50464205, "link": "https://stackoverflow.com/questions/50464205/how-to-set-a-protobuf2-enum-using-golang/50464408#50464408", "title": "How to set a protobuf2 enum using golang", "body": "<p>Protobuf with <code>syntax=\"proto2\"</code> generates enum fields with pointer type, so <code>Foo.baz</code> will be of type <code>*Foo_Bar</code>. You can't assign a non-pointer <code>Foo_Bar</code> value to this field, only a pointer value.</p>\n\n<p>Also, the enum values you list in the protobuf files will be generated to be constants in Go. And you cannot take the address of constant values, for details see: <a href=\"https://stackoverflow.com/questions/35146286/find-address-of-constant-in-go/35146856#35146856\">Find address of constant in go</a></p>\n\n<p>If your protobuf generates an <code>Enum()</code> method returning a pointer to the value, then that's fine, you can use that. But this method is not always generated, so don't be surprised if you don't find this to some type / enum.</p>\n\n<p>If it's missing, the simplest is to create a (local) variable, and whose address you can take:</p>\n\n<pre><code>lol := enum.Foo_LOL\nmsg := &amp;enum.Foo{\n    Baz: &amp;lol,\n}\nerr := proto.Marshal(msg)\n</code></pre>\n\n<p>If you have to do this many times / many places, create a helper function which fills the purpose of the <code>Enum()</code> method. This is how you can create one:</p>\n\n<pre><code>func barPtr(b enum.Foo_Bar) *enum.Foo_Bar { return &amp;b }\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>msg := &amp;enum.Foo{\n    Baz: barPtr(enum.Foo_LOL),\n}\nerr := proto.Marshal(msg)\n</code></pre>\n\n<p>There are many other options to obtain a pointer to an integer type, but they are not necessarily cleaner or more efficient. You can see a list of different methods here: <a href=\"https://stackoverflow.com/questions/30716354/how-do-i-do-a-literal-int64-in-go/30716481#30716481\">How do I do a literal *int64 in Go?</a></p>\n"}], "owner": {"reputation": 2304, "user_id": 2126889, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ZLkKF.jpg?s=128&g=1", "display_name": "timthelion", "link": "https://stackoverflow.com/users/2126889/timthelion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2835, "favorite_count": 0, "accepted_answer_id": 50464408, "answer_count": 1, "score": 1, "last_activity_date": 1526990684, "creation_date": 1526981259, "question_id": 50464205, "link": "https://stackoverflow.com/questions/50464205/how-to-set-a-protobuf2-enum-using-golang", "title": "How to set a protobuf2 enum using golang", "body": "<p>I'm trying to use protobuf2 enums in golang but I cannot figure it out.</p>\n\n<p>I created a simple protobuf file:</p>\n\n<pre><code>syntax         =          \"proto2\" ;\npackage                    enum    ;\nmessage Foo{\n     enum Bar{\n         LOL = 1;\n     }\n     optional Bar baz = 1;\n}\n</code></pre>\n\n<p>And I created a simple golang file:</p>\n\n<pre><code>package main\n\nimport (\n    enum \"./enum\"\n    \"github.com/golang/protobuf/proto\"\n)\n\nfunc main() {\n    msg := &amp;enum.Foo{\n        Baz: enum.Foo_LOL,\n    }\n    proto.Marshal(&amp;msg)\n}\n</code></pre>\n\n<p>I got an error.</p>\n\n<pre><code>./foo.go:10: cannot use enum.Foo_LOL (type enum.Foo_Bar) as type *enum.Foo_Bar in field value\n</code></pre>\n\n<p>It seemed simple enough to solve, just add a <code>&amp;</code> in front of <code>enum.Foo_Bar</code>.</p>\n\n<pre><code>package main\n\nimport (\n    enum \"./enum\"\n    \"github.com/golang/protobuf/proto\"\n)\n\nfunc main() {\n    msg := &amp;enum.Foo{\n        Baz: &amp;enum.Foo_LOL,\n    }\n    proto.Marshal(&amp;msg)\n}\n</code></pre>\n\n<p>Nope:</p>\n\n<pre><code>./foo.go:10: cannot take the address of enum.Foo_LOL\n</code></pre>\n\n<p>I searched google and found <a href=\"https://github.com/kubernetes/client-go/issues/333\" rel=\"nofollow noreferrer\">this guy being trolled by a bot</a>. He had some working code, but it was verbose enough to bore a bible scholar:</p>\n\n<pre><code>package main\n\nimport (\n    enum \"./enum\"\n    \"github.com/golang/protobuf/proto\"\n)\n\nvar lolVar = enum.Foo_LOL\n\nfunc main() {\n    msg := &amp;enum.Foo{\n        Baz: &amp;lolVar,\n    }\n    proto.Marshal(msg)\n}\n</code></pre>\n\n<p>I looked in the generated code and found an <code>Enum</code> method, which also worked, but was verbose enough to bore a tax auditor:</p>\n\n<pre><code>package main\n\nimport (\n    enum \"./enum\"\n    \"github.com/golang/protobuf/proto\"\n)\n\nfunc main() {\n    msg := &amp;enum.Foo{\n        Baz: enum.Foo_LOL.Enum(),\n    }\n    proto.Marshal(msg)\n}\n</code></pre>\n\n<p>What is the intended method?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12817, "user_id": 1324709, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZzCz9.jpg?s=128&g=1", "display_name": "Branislav Lazic", "link": "https://stackoverflow.com/users/1324709/branislav-lazic"}, "edited": false, "score": 1, "creation_date": 1526977563, "post_id": 50463071, "comment_id": 87939087, "body": "Compiling exactly what? Please put an effort when asking a question. And aim to create a smallest possible example that reproduces your problem."}, {"owner": {"reputation": 31, "user_id": 2753506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f574e90df1bb79630517893626f2a2?s=128&d=identicon&r=PG&f=1", "display_name": "Raman", "link": "https://stackoverflow.com/users/2753506/raman"}, "reply_to_user": {"reputation": 12817, "user_id": 1324709, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZzCz9.jpg?s=128&g=1", "display_name": "Branislav Lazic", "link": "https://stackoverflow.com/users/1324709/branislav-lazic"}, "edited": false, "score": 0, "creation_date": 1526977944, "post_id": 50463071, "comment_id": 87939344, "body": "while compling check_name.go file , in which I have written the  above code."}, {"owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "edited": false, "score": 0, "creation_date": 1526979155, "post_id": 50463071, "comment_id": 87940137, "body": "<code>temp_address, _ := selection.Text()</code>"}, {"owner": {"reputation": 31, "user_id": 2753506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f574e90df1bb79630517893626f2a2?s=128&d=identicon&r=PG&f=1", "display_name": "Raman", "link": "https://stackoverflow.com/users/2753506/raman"}, "edited": false, "score": 0, "creation_date": 1526980140, "post_id": 50463071, "comment_id": 87940761, "body": "This worked. thanks a lot."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 2753506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f574e90df1bb79630517893626f2a2?s=128&d=identicon&r=PG&f=1", "display_name": "Raman", "link": "https://stackoverflow.com/users/2753506/raman"}, "edited": false, "score": 0, "creation_date": 1526978199, "post_id": 50463219, "comment_id": 87939501, "body": "Thanks for quick reply. But I tried this also and found this error ---&gt;                                                                                                                                                                                                                           assignment mismatch: 2 variables but 1 values"}, {"owner": {"reputation": 4567, "user_id": 1318734, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/S3JJ2.gif?s=128&g=1", "display_name": "rofls", "link": "https://stackoverflow.com/users/1318734/rofls"}, "reply_to_user": {"reputation": 31, "user_id": 2753506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f574e90df1bb79630517893626f2a2?s=128&d=identicon&r=PG&f=1", "display_name": "Raman", "link": "https://stackoverflow.com/users/2753506/raman"}, "edited": false, "score": 0, "creation_date": 1526978278, "post_id": 50463219, "comment_id": 87939563, "body": "Well, that method <i>does</i> return two variables. So, that error may be coming from somewhere else. Best if you share the full stack trace or spend more time deciphering it, to extract all the relevant parts."}, {"owner": {"reputation": 4567, "user_id": 1318734, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/S3JJ2.gif?s=128&g=1", "display_name": "rofls", "link": "https://stackoverflow.com/users/1318734/rofls"}, "reply_to_user": {"reputation": 31, "user_id": 2753506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f574e90df1bb79630517893626f2a2?s=128&d=identicon&r=PG&f=1", "display_name": "Raman", "link": "https://stackoverflow.com/users/2753506/raman"}, "edited": false, "score": 0, "creation_date": 1526978309, "post_id": 50463219, "comment_id": 87939587, "body": "Are you sharing all the code from your program in the question?"}, {"owner": {"reputation": 31, "user_id": 2753506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f574e90df1bb79630517893626f2a2?s=128&d=identicon&r=PG&f=1", "display_name": "Raman", "link": "https://stackoverflow.com/users/2753506/raman"}, "edited": false, "score": 0, "creation_date": 1526978665, "post_id": 50463219, "comment_id": 87939810, "body": "No, I have not shared the full code, above is only piece of code where I am getting the error."}, {"owner": {"reputation": 4567, "user_id": 1318734, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/S3JJ2.gif?s=128&g=1", "display_name": "rofls", "link": "https://stackoverflow.com/users/1318734/rofls"}, "reply_to_user": {"reputation": 31, "user_id": 2753506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f574e90df1bb79630517893626f2a2?s=128&d=identicon&r=PG&f=1", "display_name": "Raman", "link": "https://stackoverflow.com/users/2753506/raman"}, "edited": false, "score": 0, "creation_date": 1526978749, "post_id": 50463219, "comment_id": 87939869, "body": "If you share the full stack trace or more code I may be able to help you more. I&#39;m guessing the error is coming from somewhere else. It should show a line number at the top that is relevant."}, {"owner": {"reputation": 31, "user_id": 2753506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f574e90df1bb79630517893626f2a2?s=128&d=identicon&r=PG&f=1", "display_name": "Raman", "link": "https://stackoverflow.com/users/2753506/raman"}, "edited": false, "score": 0, "creation_date": 1526980057, "post_id": 50463219, "comment_id": 87940700, "body": "Thanks everyone for your quick reply.   It is solved."}], "tags": [], "owner": {"reputation": 4567, "user_id": 1318734, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/S3JJ2.gif?s=128&g=1", "display_name": "rofls", "link": "https://stackoverflow.com/users/1318734/rofls"}, "is_accepted": false, "score": 1, "last_activity_date": 1526978032, "creation_date": 1526978032, "answer_id": 50463219, "question_id": 50463071, "link": "https://stackoverflow.com/questions/50463071/multiple-value-selection-text-in-single-value-context/50463219#50463219", "title": "multiple-value selection.Text() in single-value context", "body": "<p>The <code>*agouti.Selection</code> method <code>Text()</code> returns a <code>(string, error)</code>. See here in the source code: <a href=\"https://github.com/sclevine/agouti/blob/dab7b01f206e43278618a7e0f5bc3ea39e48445a/selection_properties.go#L10\" rel=\"nofollow noreferrer\">https://github.com/sclevine/agouti/blob/dab7b01f206e43278618a7e0f5bc3ea39e48445a/selection_properties.go#L10</a></p>\n\n<p>You need to do:</p>\n\n<pre><code>selection, err = s1 tmp_address = selection.Text() \n</code></pre>\n\n<p>If you want to handle the error, or</p>\n\n<pre><code>selection, _ = s1 tmp_address = selection.Text() \n</code></pre>\n\n<p>If you wish to ignore it.</p>\n\n<p>Also, if you format your questions in the future properly it will help get better responses.</p>\n"}], "owner": {"reputation": 31, "user_id": 2753506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f574e90df1bb79630517893626f2a2?s=128&d=identicon&r=PG&f=1", "display_name": "Raman", "link": "https://stackoverflow.com/users/2753506/raman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "closed_date": 1526978118, "answer_count": 1, "score": 0, "last_activity_date": 1530548152, "creation_date": 1526977479, "last_edit_date": 1530548152, "question_id": 50463071, "link": "https://stackoverflow.com/questions/50463071/multiple-value-selection-text-in-single-value-context", "closed_reason": "Duplicate", "title": "multiple-value selection.Text() in single-value context", "body": "<p>I am getting below error while compiling</p>\n\n<p>multiple-value selection.Text() in single-value context</p>\n\n<pre><code>var selection *agouti.Selection\ns1 := a.page.FirstByXPath(`//*[@id=\"name\"]`)\nselection = s1\ntmp_address = selection.Text() // Error is occurring at this Line.\n</code></pre>\n\n<p>Please help to resolve this issue.</p>\n"}, {"tags": ["go", "unmarshalling", "gob"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1526977235, "post_id": 50462964, "comment_id": 87938893, "body": "Do not use gob for such things."}, {"owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "edited": false, "score": 0, "creation_date": 1526979505, "post_id": 50462964, "comment_id": 87940348, "body": "the error includes  <code>[]interface {}</code> but not <code>map[string]interface {}</code>. Are you sure the error message is correct? If so, then it looks it is coming from something else."}, {"owner": {"reputation": 171, "user_id": 3155208, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/f5f4bdd528730fc1310255550191bbf2?s=128&d=identicon&r=PG&f=1", "display_name": "user3155208", "link": "https://stackoverflow.com/users/3155208/user3155208"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1527056469, "post_id": 50462964, "comment_id": 87975307, "body": "@Volker. Can you be more specific? What is the right way on your opinion. I have the similar problem and use marshalling for this but internet is full of advices to use gob and benchmarks showing that gob is much faster and works."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1527061154, "post_id": 50462964, "comment_id": 87977936, "body": "Copying one map to an other map is done by iterating over the source like <code>for k,v := range src</code> and populating the destination like <code>dst[k] = v</code>. If your input and output types do not coincident then you have to convert the keys and values. This is called programming. The internet is not full of recommendations to use gob because gob is something very useful but also very specific. Stop looking for a &quot;magic&quot; solution. Think about what you want to do <i>exactly</i> and start writing code."}, {"owner": {"reputation": 171, "user_id": 3155208, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/f5f4bdd528730fc1310255550191bbf2?s=128&d=identicon&r=PG&f=1", "display_name": "user3155208", "link": "https://stackoverflow.com/users/3155208/user3155208"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1527062165, "post_id": 50462964, "comment_id": 87978620, "body": "@Volker You are right in general, but if your map has dynamic structure and hundreds of rows, you start dreaming about some magic rather than writing thousands rows of code with endless if/else, casts and type assertions.This part of programming (and yes, I&#39;ve heard about such a word) is less exciting. So I just wanted to be sure that there is no magic I&#39;m not aware of. Thanks anyway."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 171, "user_id": 3155208, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/f5f4bdd528730fc1310255550191bbf2?s=128&d=identicon&r=PG&f=1", "display_name": "user3155208", "link": "https://stackoverflow.com/users/3155208/user3155208"}, "edited": false, "score": 0, "creation_date": 1527069641, "post_id": 50462964, "comment_id": 87983661, "body": "@user3155208 Then redesign your data. Or use reflection. It seems your problem lacks a clear and sensible data modelling. Fix that. Otherwise its a XY problem."}], "owner": {"reputation": 11, "user_id": 5460659, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208168262629299/picture?type=large", "display_name": "Sagi Krichbets", "link": "https://stackoverflow.com/users/5460659/sagi-krichbets"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 776, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1526977150, "creation_date": 1526977150, "question_id": 50462964, "link": "https://stackoverflow.com/questions/50462964/gob-type-not-registered-for-interface-interface", "title": "gob: type not registered for interface: []interface {}", "body": "<p>I am trying to copy a map to another map so i used gob in order to do this.\nBut when i unmarshal a json to map[string]interface{} and then try to copy it to another map i get an error in the encoding part.</p>\n\n<p>This is the code:</p>\n\n<pre><code>    package main\n\nimport (\n    \"encoding/gob\"\n    \"bytes\"\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc CopyMapToAnotherMap(req map[string]interface{}) (cpy map[string]interface{}, err error) {\n    var mod bytes.Buffer\n    gob.Register(map[string]interface{}{})\n    enc := gob.NewEncoder(&amp;mod)\n    dec := gob.NewDecoder(&amp;mod)\n\n    err = enc.Encode(req)\n    if err != nil {\n        fmt.Println(\"Unable to encode map\", err)\n        return nil, err\n    }\n\n    err = dec.Decode(&amp;cpy)\n    if err != nil {\n        fmt.Println(\"Unable to decode map\", err)\n        return nil, err\n    }\n\n    return cpy, nil\n}\n\nfunc main() {\n    my := `{\"data\":[{\"aa\":1},{\"bb\":2}]}`\n    var m map[string]interface{}\n\n    err := json.Unmarshal([]byte(my), &amp;m)\n    if err !=  nil {\n        fmt.Println(err)\n    }\n    CopyMapToAnotherMap(m)\n}\n</code></pre>\n\n<p>and i am getting an error : gob: type not registered for interface: []interface {}</p>\n\n<p>How can this be avoided?</p>\n"}, {"tags": ["go", "datastore"], "answers": [{"tags": [], "owner": {"reputation": 115, "user_id": 1950786, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/502867800cde883695e502838bf5888d?s=128&d=identicon&r=PG", "display_name": "Ribice", "link": "https://stackoverflow.com/users/1950786/ribice"}, "is_accepted": true, "score": 1, "last_activity_date": 1526978063, "creation_date": 1526978063, "answer_id": 50463227, "question_id": 50462851, "link": "https://stackoverflow.com/questions/50462851/how-can-i-query-all-values-except-the-value-created-today/50463227#50463227", "title": "How can I query all values except the value created today?", "body": "<p>Add a filter by CreatedDate.</p>\n\n<pre><code>t := time.Now()\nzone, _ := time.LoadLocation(\"Europe/Amsterdam\")\nday := time.Date(t.Year(), t.Month(), t.Day(), 0, 0, 0, 0, zone)\nq := datastore.NewQuery(\"Encounter\").Filter(\"PatientID =\", patientID).Filter(\"CreatedDate &lt;\", day).Order(\"CreatedDate\").Order(\"-CreatedBy\")\n</code></pre>\n\n<p>This only returns items older than today. If you need both older and newer than today, since there is no inequality in filters, you can fetch older and newer than today, then iterate through them and append the results.</p>\n"}], "owner": {"reputation": 5, "user_id": 9770464, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-sPmFpSno-sU/AAAAAAAAAAI/AAAAAAAAACY/wbscpXbjqMY/photo.jpg?sz=128", "display_name": "sriNiha", "link": "https://stackoverflow.com/users/9770464/sriniha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 50463227, "answer_count": 1, "score": -1, "last_activity_date": 1526978063, "creation_date": 1526976799, "last_edit_date": 1526977609, "question_id": 50462851, "link": "https://stackoverflow.com/questions/50462851/how-can-i-query-all-values-except-the-value-created-today", "title": "How can I query all values except the value created today?", "body": "<pre><code>q := datastore.NewQuery(\"Encounter\").Filter(\"PatientID =\", patientID).Order(\"CreatedDate\").Order(\"-CreatedBy\")\n</code></pre>\n\n<p>How can I query all the values except the values created today?</p>\n"}, {"tags": ["http", "go", "http2"], "answers": [{"comments": [{"owner": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "edited": false, "score": 0, "creation_date": 1526977611, "post_id": 50462951, "comment_id": 87939113, "body": "So I tried using hpack package and doing hpack.HuffmanDecodeToString(headersframe.HeaderBlockFragment&zwnj;&#8203;()), but this gives error {hpack: invalid Huffman-encoded data}"}], "tags": [], "owner": {"reputation": 13642, "user_id": 1215076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7363920d78e5115b7d2cf0774b60d653?s=128&d=identicon&r=PG", "display_name": "sbordet", "link": "https://stackoverflow.com/users/1215076/sbordet"}, "is_accepted": false, "score": 0, "last_activity_date": 1526977113, "creation_date": 1526977113, "answer_id": 50462951, "question_id": 50462477, "link": "https://stackoverflow.com/questions/50462477/decoding-http2-frame-header-data-in-go/50462951#50462951", "title": "Decoding http2 frame header/data in Go", "body": "<p>The \"header block fragment\" is encoded using <a href=\"https://tools.ietf.org/html/rfc7541\" rel=\"nofollow noreferrer\">HPACK</a>.</p>\n\n<p>Go has an implementation to encode and decode HPACK, so you don't have to write your own.</p>\n\n<p>You can find <a href=\"https://github.com/tatsuhiro-t/go-http2-hpack\" rel=\"nofollow noreferrer\">here</a> an example of using both the encoder and decoder Go API. </p>\n"}, {"tags": [], "owner": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "is_accepted": true, "score": 0, "last_activity_date": 1526979281, "creation_date": 1526979281, "answer_id": 50463581, "question_id": 50462477, "link": "https://stackoverflow.com/questions/50462477/decoding-http2-frame-header-data-in-go/50463581#50463581", "title": "Decoding http2 frame header/data in Go", "body": "<p>I figured it out using Go hpack library (<a href=\"https://godoc.org/golang.org/x/net/http2/hpack\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/net/http2/hpack</a>) - </p>\n\n<pre><code>decoder := hpack.NewDecoder(2048, nil)\nhf, _ := decoder.DecodeFull(headersframe.HeaderBlockFragment())\nfor _, h := range hf {\n      fmt.Printf(\"%s\\n\", h.Name + \":\" + h.Value)\n}\n</code></pre>\n\n<p>This prints - </p>\n\n<pre><code>:method:GET\n:path:/\n:scheme:https\n:authority:127.0.0.1:5252\nuser-agent:curl/7.58.0\naccept:*/*\n</code></pre>\n"}], "owner": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1074, "favorite_count": 0, "accepted_answer_id": 50463581, "answer_count": 2, "score": 0, "last_activity_date": 1526979281, "creation_date": 1526975496, "last_edit_date": 1526975923, "question_id": 50462477, "link": "https://stackoverflow.com/questions/50462477/decoding-http2-frame-header-data-in-go", "title": "Decoding http2 frame header/data in Go", "body": "<p>I am trying to read from a tcp connection which contains HTTP/2 data. Below is the code for reading HEADERS frame - </p>\n\n<pre><code>framer := http2.NewFramer(conn, conn)\nframe, _ := framer.ReadFrame()\n\nfmt.Printf(\"fh type: %s\\n\", frame.Header().Type)\nfmt.Printf(\"fh type: %d\\n\", frame.Header().Type)\nfmt.Printf(\"fh flag: %d\\n\", frame.Header().Flags)\nfmt.Printf(\"fh length: %d\\n\", frame.Header().Length)\nfmt.Printf(\"fh streamid: %d\\n\", frame.Header().StreamID)\nheadersframe := (frame1.(*http2.HeadersFrame))\nfmt.Printf(\"stream ended? %v\\n\", headersframe.StreamEnded())\nfmt.Printf(\"block fragment: %x\\n\", headersframe.HeaderBlockFragment())        \n</code></pre>\n\n<p>I send request using curl as - </p>\n\n<pre><code>curl -v https://127.0.0.1:8000/ -k --http2\n</code></pre>\n\n<p>This is the output I get (after reading connection preface and SETTINGS), if I read from the conn using above code - </p>\n\n<pre><code>fh type: HEADERS\nfh type: 1\nfh flag: 5\nfh length: 30\nfh streamid: 1\nstream ended? true\nblock fragment: 828487418a089d5c0b8170dc6c4d8b7a8825b650c3abb6f2e053032a2f2a\n</code></pre>\n\n<p>I understand the ouput, except the <strong>block fragment</strong> part and how to decode it into ascii string? I want to know the protocol/method/url path information.</p>\n"}, {"tags": ["php", "go"], "comments": [{"owner": {"reputation": 1254, "user_id": 3732803, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GOKHk.jpg?s=128&g=1", "display_name": "Pyton", "link": "https://stackoverflow.com/users/3732803/pyton"}, "edited": false, "score": 0, "creation_date": 1526974970, "post_id": 50462090, "comment_id": 87937624, "body": "Try this one: <a href=\"https://stackoverflow.com/questions/44230634/how-to-read-an-rsa-key-from-file/44231740\" title=\"how to read an rsa key from file\">stackoverflow.com/questions/44230634/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 1, "last_activity_date": 1526989159, "creation_date": 1526989159, "answer_id": 50466768, "question_id": 50462090, "link": "https://stackoverflow.com/questions/50462090/is-there-equivalent-to-phps-openssl-pkey-get-private-in-golang/50466768#50466768", "title": "Is there equivalent to PHP&#39;s openssl_pkey_get_private in Golang?", "body": "<p>Of course Go can load x509 private keys, but there is no \"do-what-I-want\" function, such as openssl_pkey_get_private.</p>\n\n<p>After PEM decoding the key (and possibly decrypting it), use one of the Parse*PrivateKey functions in the <a href=\"https://golang.org/pkg/crypto/x509/\" rel=\"nofollow noreferrer\">x509 package</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto\"\n    \"crypto/x509\"\n    \"encoding/pem\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n    pemBytes, err := ioutil.ReadFile(\"sample.key.pem\")\n    check(err)\n\n    block := firstPrivateKey(pemBytes)\n    if block == nil {\n        log.Fatal(\"No private key in input\")\n    }\n\n    derBytes := block.Bytes\n    if x509.IsEncryptedPEMBlock(block) {\n        derBytes, err = x509.DecryptPEMBlock(block, []byte(\"password\"))\n        check(err)\n    }\n\n    var key crypto.PrivateKey\n    switch block.Type {\n    case \"RSA PRIVATE KEY\":\n        key, err = x509.ParsePKCS1PrivateKey(derBytes) // or PKCS8\n        check(err)\n    case \"EC PRIVATE KEY\":\n        key, err = x509.ParseECPrivateKey(derBytes)\n        check(err)\n    default:\n        log.Fatal(\"Unsupported key type\")\n    }\n\n    fmt.Println(key)\n}\n\nfunc firstPrivateKey(pemBytes []byte) *pem.Block {\n    var block *pem.Block\n    for len(pemBytes) &gt; 0 {\n        block, pemBytes = pem.Decode(pemBytes)\n        if strings.HasSuffix(block.Type, \" PRIVATE KEY\") {\n            return block\n        }\n    }\n    return nil\n}\n\nfunc check(err error) {\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 403, "user_id": 7294974, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/B26Kl.jpg?s=128&g=1", "display_name": "salamander", "link": "https://stackoverflow.com/users/7294974/salamander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "accepted_answer_id": 50466768, "answer_count": 1, "score": -2, "last_activity_date": 1526989159, "creation_date": 1526974116, "question_id": 50462090, "link": "https://stackoverflow.com/questions/50462090/is-there-equivalent-to-phps-openssl-pkey-get-private-in-golang", "title": "Is there equivalent to PHP&#39;s openssl_pkey_get_private in Golang?", "body": "<p>I have to translate PHP code to Golang and I encoutered this problem.</p>\n"}, {"tags": ["json", "parsing", "go", "yaml"], "answers": [{"comments": [{"owner": {"reputation": 99, "user_id": 1955900, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5abd355fd302e70058ee0f16c2aae777?s=128&d=identicon&r=PG", "display_name": "Eieio", "link": "https://stackoverflow.com/users/1955900/eieio"}, "edited": false, "score": 0, "creation_date": 1527005735, "post_id": 50462868, "comment_id": 87958096, "body": "Thanks Branislav, I really appreciate your help. That got me making progress again! Great spot on the map type too."}], "tags": [], "owner": {"reputation": 12817, "user_id": 1324709, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/ZzCz9.jpg?s=128&g=1", "display_name": "Branislav Lazic", "link": "https://stackoverflow.com/users/1324709/branislav-lazic"}, "is_accepted": true, "score": 1, "last_activity_date": 1526976854, "creation_date": 1526976854, "answer_id": 50462868, "question_id": 50462026, "link": "https://stackoverflow.com/questions/50462026/golang-yaml-with-nested-properties-to-json/50462868#50462868", "title": "Golang YAML with nested properties to JSON", "body": "<p>Make structs e.g. like this:</p>\n\n<pre><code>type Language struct {\n    De string `yaml:de`\n    En string `yaml:en`\n    Fr string `yaml:fr`\n    Ja string `yaml:ja`\n    Ru string `yaml:ru`\n    Zh string `yaml:zh`\n}\n\ntype Item struct {\n    Description   Language `yaml:description`\n    GroupID       int      `yaml:\"groupID\"`\n    IconID        int      `yaml:\"iconID\"`\n    GraphicID     int      `yaml:\"graphicID\"`\n    MarketGroupID int      `yaml:\"marketGroupID\"`\n    Mass          float64  `yaml:\"mass\"`\n    Name          Language `yaml:name`\n    Published     bool     `yaml:\"published\"`\n    Volume        float64  `yaml:\"volume\"`\n}\n</code></pre>\n\n<p>Also, as far as I see, it should be <code>map[int]Item{}</code> and not    <code>map[int][]Item{}</code>.</p>\n"}], "owner": {"reputation": 99, "user_id": 1955900, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5abd355fd302e70058ee0f16c2aae777?s=128&d=identicon&r=PG", "display_name": "Eieio", "link": "https://stackoverflow.com/users/1955900/eieio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 917, "favorite_count": 0, "accepted_answer_id": 50462868, "answer_count": 1, "score": 1, "last_activity_date": 1526976854, "creation_date": 1526973870, "question_id": 50462026, "link": "https://stackoverflow.com/questions/50462026/golang-yaml-with-nested-properties-to-json", "title": "Golang YAML with nested properties to JSON", "body": "<p>I'm trying to parse some YAML from a file and convert each item to a flat JSON object. </p>\n\n<p>I'm having some issues with datasets where there are multiple / nested objects.</p>\n\n<ul>\n<li>I'm failing to unmarshal multiple items per file.</li>\n<li>I'm unsure how to get nested properties such has item -> description -> en</li>\n</ul>\n\n<p>When I run the following code I get the error.</p>\n\n<blockquote>\n  <p>cannot unmarshal !!map into []item.Item</p>\n</blockquote>\n\n<p>I think I've got to look into sub-types within my structure, but I can't seem to get anything to work.</p>\n\n<p>Any help would be appreciated.</p>\n\n<hr>\n\n<p>Code:</p>\n\n<pre><code>import (\n\"gopkg.in/yaml.v2\"\n\"io/ioutil\"\n)\n\nfunc parseItemYaml() {\n    filePath := \"./typeIDs.yaml\"\n\n    yamlFile, err := ioutil.ReadFile(filePath)\n    if err != nil {\n        log.Printf(\"yamlFile.Get err #%v \", err)\n    }\n\n    itemData := map[int][]Item{}\n\n    err = yaml.Unmarshal(yamlFile, &amp;itemData)\n    if err != nil {\n        panic(err)\n    }\n\n    // Then convert to JSON\n    // Eventual persistance\n}\n</code></pre>\n\n<p>Item Structure:</p>\n\n<pre><code>type Item struct {\n    ID            int\n    Name          string  `yaml:\"name\"`\n    Description   string  `yaml:\"description\"`\n    GroupID       int     `yaml:\"groupID\"`\n    IconID        int     `yaml:\"iconID\"`\n    GraphicID     int     `yaml:\"graphicID\"`\n    MarketGroupID int     `yaml:\"marketGroupID\"`\n    Mass          float64 `yaml:\"mass\"`\n    Published     bool    `yaml:\"published\"`\n    Volume        float64 `yaml:\"volume\"`\n}\n</code></pre>\n\n<p>Desired JSON format:</p>\n\n<pre><code>{\n    \"ID\":1563,\n    \"Description\":\"Radiates an omnidirectional pulse from the ship that causes EM damage to surrounding vessels.\",\n    \"GroupID\":72,\n    \"IconID\":112,\n    \"GraphicID\":72,\n    \"MarketGroupID\":382,\n    \"Mass\":10.0,\n    \"Published\":true,\n    \"Volume\":12.5\n},\n{...},\n{...}\n</code></pre>\n\n<p>Data Subset:</p>\n\n<pre><code>1563:\n    description:\n        de: Ein ungerichteter Rundum-Impuls der vom Schiff ausgestrahlt wird und bei\n            umliegenden Schiffen EM-Schaden verursacht.\n        en: Radiates an omnidirectional pulse from the ship that causes EM damage\n            to surrounding vessels.\n        fr: \u00c9met une impulsion omnidirectionelle qui part du vaisseau et provoque\n            des d\u00e9g\u00e2ts \u00e9lectromagn\u00e9tiques \u00e0 tous les vaisseaux situ\u00e9s \u00e0 proximit\u00e9.\n        ja: \u5168\u65b9\u4f4d\u306b\u30d1\u30eb\u30b9\u3092\u653e\u5c04\u3057\u3001\u5468\u56f2\u306e\u8266\u306bEM\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u308b\u3002\n        ru: \u0418\u0441\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u0441\u0438\u043b\u044c\u043d\u044b\u0439 \u0432\u0441\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u0438\u043c\u043f\u0443\u043b\u044c\u0441, \u043d\u0430\u043d\u043e\u0441\u044f\u0449\u0438\u0439 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043c\u0430\u0433\u043d\u0438\u0442\u043d\u044b\u0439\n            \u0443\u0449\u0435\u0440\u0431 \u0432\u0441\u0435\u043c \u043e\u0431\u044a\u0435\u043a\u0442\u0430\u043c, \u043e\u043a\u0440\u0443\u0436\u0430\u044e\u0449\u0438\u043c \u043a\u043e\u0440\u0430\u0431\u043b\u044c.\n        zh: \u4ece\u8230\u8239\u4e0a\u53d1\u5c04\u4e00\u4e2a\u5168\u5411\u8109\u51b2\uff0c\u5bf9\u5468\u56f4\u8239\u53ea\u9020\u6210\u7535\u78c1\u4f24\u5bb3\u3002\n    graphicID: 2032\n    groupID: 72\n    iconID: 112\n    marketGroupID: 382\n    mass: 10.0\n    name:\n        de: Small EMP Smartbomb I\n        en: Small EMP Smartbomb I\n        fr: Petite bombe de proximit\u00e9 \u00e0 IEM I\n        ja: \u5c0f\u578bEMP\u30b9\u30de\u30fc\u30c8\u30dc\u30e0I\n        ru: Small EMP Smartbomb I\n        zh: \u5c0f\u578bEMP\u7acb\u4f53\u70b8\u5f39 I\n    portionSize: 1\n    published: true\n    radius: 1000.0\n    volume: 12.5\n1564:\n    basePrice: 650000.0\n    groupID: 152\n    iconID: 112\n    marketGroupID: 341\n    name:\n        de: Small EMP Smartbomb I Blueprint\n        en: Small EMP Smartbomb I Blueprint\n        fr: Plan de construction Petite bombe de proximit\u00e9 \u00e0 IEM I\n        ja: \u5c0f\u578bEMP\u30b9\u30de\u30fc\u30c8\u30dc\u30e0I\u30d6\u30eb\u30fc\u30d7\u30ea\u30f3\u30c8\n        ru: Small EMP Smartbomb I Blueprint\n        zh: \u5c0f\u578bEMP\u7acb\u4f53\u70b8\u5f39\u84dd\u56fe I\n    portionSize: 1\n    published: true\n    volume: 0.01\n1565:\n    description:\n        de: Ein ungerichteter Rundum-Impuls der vom Schiff ausgestrahlt wird und bei\n            umliegenden Schiffen EM-Schaden verursacht.\n        en: Radiates an omnidirectional pulse from the ship that causes EM damage\n            to surrounding vessels.\n        fr: \u00c9met une impulsion omnidirectionelle qui part du vaisseau et provoque\n            des d\u00e9g\u00e2ts \u00e9lectromagn\u00e9tiques \u00e0 tous les vaisseaux situ\u00e9s \u00e0 proximit\u00e9.\n        ja: \u5168\u65b9\u4f4d\u306b\u30d1\u30eb\u30b9\u3092\u653e\u5c04\u3057\u3001\u5468\u56f2\u306e\u8266\u306bEM\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u308b\u3002\n        ru: \u0418\u0441\u043f\u0443\u0441\u043a\u0430\u0435\u0442 \u0441\u0438\u043b\u044c\u043d\u044b\u0439 \u0432\u0441\u0435\u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u0438\u043c\u043f\u0443\u043b\u044c\u0441, \u043d\u0430\u043d\u043e\u0441\u044f\u0449\u0438\u0439 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043c\u0430\u0433\u043d\u0438\u0442\u043d\u044b\u0439\n            \u0443\u0449\u0435\u0440\u0431 \u0432\u0441\u0435\u043c \u043e\u0431\u044a\u0435\u043a\u0442\u0430\u043c, \u043e\u043a\u0440\u0443\u0436\u0430\u044e\u0449\u0438\u043c \u043a\u043e\u0440\u0430\u0431\u043b\u044c.\n        zh: \u4ece\u8230\u8239\u4e0a\u53d1\u5c04\u4e00\u4e2a\u5168\u5411\u8109\u51b2\uff0c\u5bf9\u5468\u56f4\u8239\u53ea\u9020\u6210\u7535\u78c1\u4f24\u5bb3\u3002\n    graphicID: 2032\n    groupID: 72\n    iconID: 112\n    marketGroupID: 382\n    mass: 40.0\n    name:\n        de: Small EMP Smartbomb II\n        en: Small EMP Smartbomb II\n        fr: Petite bombe de proximit\u00e9 \u00e0 IEM II\n        ja: \u5c0f\u578bEMP\u30b9\u30de\u30fc\u30c8\u30dc\u30e0II\n        ru: Small EMP Smartbomb II\n        zh: \u5c0f\u578bEMP\u7acb\u4f53\u70b8\u5f39 II\n    portionSize: 1\n    published: true\n    radius: 1000.0\n    volume: 5.0\n</code></pre>\n"}, {"tags": ["go", "cmd", "db2"], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 6408396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c704027e2787c39cb40a6a54195d553?s=128&d=identicon&r=PG&f=1", "display_name": "Shawn", "link": "https://stackoverflow.com/users/6408396/shawn"}, "is_accepted": false, "score": 0, "last_activity_date": 1526974895, "creation_date": 1526974895, "answer_id": 50462296, "question_id": 50461608, "link": "https://stackoverflow.com/questions/50461608/how-can-i-get-the-output-of-db2-command-run-by-db2cmd/50462296#50462296", "title": "How can I get the output of DB2 command run by db2cmd?", "body": "<p>I have found the answer here: <em><a href=\"https://www.ibm.com/support/knowledgecenter/en/SSEPGG_10.5.0/com.ibm.db2.luw.admin.cmd.doc/doc/r0002036.html\" rel=\"nofollow noreferrer\">https://www.ibm.com/support/knowledgecenter/en/SSEPGG_10.5.0/com.ibm.db2.luw.admin.cmd.doc/doc/r0002036.html</a></em></p>\n\n<p>So, just use the <code>-i</code> parameter like this:</p>\n\n<pre><code>cmd := exec.Command(\"db2cmd\", \"-i\", arg)\nbuf, err := cmd.Output()\nif err != nil {\n    log.Fatalf(\"Failed restoring backup with error:\\r\\n%s\\r\\n\", err)\n} else {\n    log.Printf(\"Successfully ran command with output:\\r\\n%s\\r\\n\", buf)\n}\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 6408396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c704027e2787c39cb40a6a54195d553?s=128&d=identicon&r=PG&f=1", "display_name": "Shawn", "link": "https://stackoverflow.com/users/6408396/shawn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 683, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1526974895, "creation_date": 1526972389, "question_id": 50461608, "link": "https://stackoverflow.com/questions/50461608/how-can-i-get-the-output-of-db2-command-run-by-db2cmd", "title": "How can I get the output of DB2 command run by db2cmd?", "body": "<p>I wrote a Go cli program and ran it with Windows cmd.\nIt then executed the following command:</p>\n\n<pre><code>db2cmd -c DB2 RESTORE DATABASE DMSCNDB FROM \"C:/DB\" TAKEN AT 20180522033009 ON C: INTO DMSCNDB  WITHOUT PROMPTING\n</code></pre>\n\n<p>Here is the Go code I used:</p>\n\n<pre><code>cmd := exec.Command(\"db2cmd\", \"-c\", arg)\nbuf, err := cmd.Output()\nif err != nil {\n    log.Fatalf(\"Failed restoring backup with error: %s\\r\\n\", err)\n} else {\n    log.Printf(\"Successfully restored backup with command output: %s\\r\\n\", buf)\n}\n</code></pre>\n\n<p>Everything worked fined, except for the command prompt spawned by the <code>db2cmd</code>. Is there any way to get the output of it? How can I get the output of DB2 command run by <code>db2cmd</code>?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1526971083, "post_id": 50461129, "comment_id": 87935595, "body": "It&#39;s not clear to me what exactly it is that you want. Do you want to create a new file for every request? Or do you want the content of each new request to be appended to the existing file?"}, {"owner": {"reputation": 23, "user_id": 5841430, "user_type": "registered", "profile_image": "https://graph.facebook.com/1207061002642281/picture?type=large", "display_name": "Gordon Soh", "link": "https://stackoverflow.com/users/5841430/gordon-soh"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1526971397, "post_id": 50461129, "comment_id": 87935756, "body": "@mkopriva yes, every request will create a new file. Is that possible?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1526975273, "post_id": 50461129, "comment_id": 87937784, "body": "In that case you need to create a new file for each request, right now you&#39;re using the hardcoded name &quot;output.json&quot; which will cause any previous file of that same name to be overwritten. That means that for each request you need to use a unique name for the output file."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1526975493, "post_id": 50461129, "comment_id": 87937914, "body": "... depending on how robust you need your code to be you could use a simple global counter, or an atomic one, a timestamp, or a random value. Using these you can then generate a unique name for the file."}, {"owner": {"reputation": 23, "user_id": 5841430, "user_type": "registered", "profile_image": "https://graph.facebook.com/1207061002642281/picture?type=large", "display_name": "Gordon Soh", "link": "https://stackoverflow.com/users/5841430/gordon-soh"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1526975600, "post_id": 50461129, "comment_id": 87937981, "body": "I see, do you have any references I can go to look? @mkopriva"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1526976056, "post_id": 50461129, "comment_id": 87938236, "body": "Take a look at the <code>time</code> package, its <code>Time</code> type&#39;s <code>Unix</code> method, and then at the <code>strconv</code> package and its <code>ParseInt</code> function."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 5841430, "user_type": "registered", "profile_image": "https://graph.facebook.com/1207061002642281/picture?type=large", "display_name": "Gordon Soh", "link": "https://stackoverflow.com/users/5841430/gordon-soh"}, "edited": false, "score": 0, "creation_date": 1526974398, "post_id": 50461319, "comment_id": 87937331, "body": "Hi @Florian, I tried using time.Now() in os.Create but I got an error from my console.  Here is the error: cannot use time.Now() (type time.Time) as type string in argument to os.Create.  Any advice?"}, {"owner": {"reputation": 72, "user_id": 8850201, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8Ga_nFEa-Yg/AAAAAAAAAAI/AAAAAAAAAAw/QnpLp8KGylQ/photo.jpg?sz=128", "display_name": "Florian", "link": "https://stackoverflow.com/users/8850201/florian"}, "reply_to_user": {"reputation": 23, "user_id": 5841430, "user_type": "registered", "profile_image": "https://graph.facebook.com/1207061002642281/picture?type=large", "display_name": "Gordon Soh", "link": "https://stackoverflow.com/users/5841430/gordon-soh"}, "edited": false, "score": 0, "creation_date": 1527063328, "post_id": 50461319, "comment_id": 87979326, "body": "You need to format the timestamp to a string. You can either use the unixtime <code>strconv.FormarInt(time.Now().Unix(), 10)</code> or a formated timestamp (See this tutorial: <a href=\"https://yourbasic.org/golang/format-parse-string-time-date-example/\" rel=\"nofollow noreferrer\">yourbasic.org/golang/format-parse-string-time-date-example</a>)"}], "tags": [], "owner": {"reputation": 72, "user_id": 8850201, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8Ga_nFEa-Yg/AAAAAAAAAAI/AAAAAAAAAAw/QnpLp8KGylQ/photo.jpg?sz=128", "display_name": "Florian", "link": "https://stackoverflow.com/users/8850201/florian"}, "is_accepted": false, "score": 0, "last_activity_date": 1526971209, "creation_date": 1526971209, "answer_id": 50461319, "question_id": 50461129, "link": "https://stackoverflow.com/questions/50461129/create-a-new-json-file-for-every-get-request/50461319#50461319", "title": "Create a new JSON file for every GET request", "body": "<p>If you don't want your file to be overwritten you can either give the file a different name (for example by appending the current time using <code>time.Now()</code>) or you can <a href=\"https://stackoverflow.com/questions/7151261/append-to-a-file-in-go\">append the output to the file</a>, so the output.json contains all json files.</p>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 5841430, "user_type": "registered", "profile_image": "https://graph.facebook.com/1207061002642281/picture?type=large", "display_name": "Gordon Soh", "link": "https://stackoverflow.com/users/5841430/gordon-soh"}, "edited": false, "score": 0, "creation_date": 1526994706, "post_id": 50467357, "comment_id": 87950303, "body": "Thank you for the recommendation, it worked well and it helped me understand Go more :)"}], "tags": [], "owner": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "is_accepted": true, "score": 1, "last_activity_date": 1526991143, "creation_date": 1526991143, "answer_id": 50467357, "question_id": 50461129, "link": "https://stackoverflow.com/questions/50461129/create-a-new-json-file-for-every-get-request/50467357#50467357", "title": "Create a new JSON file for every GET request", "body": "<p>If you want to append time in your filename (like @Florian suggested), you can do something like this when you are creating file:</p>\n\n<pre><code>out, err := os.Create(fmt.Sprintf(\"output-%d.json\", time.Now().Unix()))\n// filename =&gt; output-1257894000.json\n</code></pre>\n\n<p>Here <code>time.Now().Unix()</code> returns  the number of seconds elapsed since January 1, 1970 UTC (aka Unix time). So each time it will create different json file.</p>\n\n<p>More info about time: <a href=\"https://golang.org/pkg/time/#Time.Unix\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#Time.Unix</a></p>\n"}], "owner": {"reputation": 23, "user_id": 5841430, "user_type": "registered", "profile_image": "https://graph.facebook.com/1207061002642281/picture?type=large", "display_name": "Gordon Soh", "link": "https://stackoverflow.com/users/5841430/gordon-soh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 50467357, "answer_count": 2, "score": 1, "last_activity_date": 1527005067, "creation_date": 1526970431, "last_edit_date": 1527005067, "question_id": 50461129, "link": "https://stackoverflow.com/questions/50461129/create-a-new-json-file-for-every-get-request", "title": "Create a new JSON file for every GET request", "body": "<p>Background story: I'm retrieving details using a GET method. I managed to get the program to parse the output given by the server into a JSON file titled \"output.json\".</p>\n\n<p>Problem: Every time I make different requests, the output will overwrite any previous content in the output.json file. Is it possible to make a new JSON file for every request?\nI am rather new to GoLang and any help will be very useful :)</p>\n\n<p>Note: I am only showing the method that is being used to call the API, if need to, I will show the rest of my code.</p>\n\n<p>Here is my method used:</p>\n\n<pre><code>func render(endpoint string, w http.ResponseWriter, r *http.Request) {\n    // check if request has cookie set\n    if cookie, err := r.Cookie(COOKIE_NAME); err != nil {\n        // else redirect to OAuth Authorization EP\n        redirectToOAuth(w, r, endpoint)\n    } else {\n        session := cookie.Value\n        accessToken := sessions[session]\n\n        // pipe api endpoint\n        ep := fmt.Sprintf(\"%s/%s\", fidorConfig.FidorApiUrl, endpoint)\n        if api_req, err := http.NewRequest(\"GET\", ep, nil); err != nil {\n            w.WriteHeader(500)\n            w.Write([]byte(err.Error()))\n        } else {\n            api_req.Header.Set(\"Authorization\", fmt.Sprintf(\"Bearer %s\", accessToken))\n            api_req.Header.Set(\"Accept\", \"application/vnd.fidor.de; version=1,text/json\") \n\n            client := &amp;http.Client{}\n            if api_resp, err := client.Do(api_req); err != nil {\n                w.WriteHeader(500)\n                w.Write([]byte(err.Error()))\n            } else {\n                if api_resp.StatusCode == 401 { // token probably expired\n                    handleLogout(w, r, endpoint)\n                    return\n                }\n\n                w.Header().Set(\"Content-Type\", \"application/json\")\n                w.WriteHeader(api_resp.StatusCode)\n\n\n                defer api_resp.Body.Close()\n                out, err := os.Create(\"output.json\")\n                if err != nil {\n                    // panic?\n                }\n                defer out.Close()\n                io.Copy(out, api_resp.Body)\n\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "visual-studio-code", "vscode-debugger"], "comments": [{"owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 0, "creation_date": 1526976758, "post_id": 50460548, "comment_id": 87938622, "body": "What debugger are you using? how ? you are not giving enough information."}], "answers": [{"tags": [], "owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "is_accepted": true, "score": 1, "last_activity_date": 1526980179, "creation_date": 1526980179, "answer_id": 50463868, "question_id": 50460548, "link": "https://stackoverflow.com/questions/50460548/how-can-i-debug-specific-functions/50463868#50463868", "title": "How can I debug specific functions?", "body": "<p>It looks you are using vscode-go debugger.\nYou can configure the port from launch.json configuration file from your vscode.</p>\n\n<p>The config should look like this:</p>\n\n<pre><code>{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"Launch\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"debug\",\n            \"remotePath\": \"\",\n            \"port\": 2345,\n            \"host\": \"127.0.0.1\",\n            \"program\": \"${workspaceRoot}\",\n            \"env\": {\n                \"GOPATH\": &lt;your GOPATH&gt;\n            },\n            \"args\": [],\n            \"showLog\": true\n        }\n    ],\n    \"go.lintTool\": \"gometalinter\"\n}\n</code></pre>\n\n<p>You can change port from above settings. To find <code>launch.json</code>, just <code>ctrl+P</code> and type launch.json it will show dropdown result of search in your vscode.</p>\n"}], "owner": {"reputation": 2015, "user_id": 1591668, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cb658beece55f9525bd4cbb682fadc44?s=128&d=identicon&r=PG", "display_name": "user1591668", "link": "https://stackoverflow.com/users/1591668/user1591668"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 1, "accepted_answer_id": 50463868, "answer_count": 1, "score": 0, "last_activity_date": 1552314666, "creation_date": 1526967702, "last_edit_date": 1552314666, "question_id": 50460548, "link": "https://stackoverflow.com/questions/50460548/how-can-i-debug-specific-functions", "title": "How can I debug specific functions?", "body": "<p>I have a website that has several different functions . I can get to my website by using localhost:5000/ , when I run it in debug mode using vscode-go debugger I get the following message \n <strong>API server listening at: 127.0.0.1:52238</strong></p>\n\n<p>I have a Name function that returns several strings but I can not hit the breakpoint in debug mode . I put a breakpoint in my Name function and put the url as follows:   <em>127.0.0.1:52238/name</em> however it does not hit the breakpoint. What could be going on here ? My code is below if i run the application normally and put <a href=\"http://localhost:5000/name\" rel=\"nofollow noreferrer\">http://localhost:5000/name</a> then everything works but in debug mode this <strong>127.0.0.1:52238/name</strong> does not hit the breakpoint or page . I am using Go as a backend api so I'll need to hit url endpoints to see what's going on. <strong>Is there someway that I can make the debug port also :5000</strong> ?</p>\n\n<pre><code>  -- Main \n package main\n\n import (\n     \"github.com/gorilla/mux\"\n     \"runtime\"\n     \"./Models\"\n     \"./Controllers\"\n )\n\n func main() {\n\n  Controllers.CircleRoutes(r)\n\n     srv := &amp;http.Server{\n         ReadTimeout:  20 * time.Second,\n         WriteTimeout: 20 * time.Second,\n         IdleTimeout:  120 * time.Second,\n         Addr:         \":5000\",\n     }\n\n     srv.ListenAndServe()\n    }\n\n\n\n   // Circles Route\n\n package Controllers\n\nfunc Name(w http.ResponseWriter, r *http.Request) {\n\n    var result string\n    r.ParseForm()\n    result = \"Success\"\n\n    io.WriteString(w, result)\n}\n\n func CircleRoutes(r *mux.Router) {\n     r.HandleFunc(\"/name\", Name)\n }\n</code></pre>\n"}, {"tags": ["go", "pq"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 6128743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7f9f4a04d3e4297559a6e34437d814?s=128&d=identicon&r=PG&f=1", "display_name": "DJBrunelle", "link": "https://stackoverflow.com/users/6128743/djbrunelle"}, "edited": false, "score": 0, "creation_date": 1526960992, "post_id": 50459446, "comment_id": 87932229, "body": "This fixed my issue. A simple oversight on my part, thank you for the response!"}, {"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1526961150, "post_id": 50459446, "comment_id": 87932252, "body": "The infinite loop is in fact infinite connections to itself."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1526968194, "post_id": 50459446, "comment_id": 87934339, "body": "@SeanF, db.Ping does not send a valid HTTP request, so there is no recursion."}], "tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": true, "score": 1, "last_activity_date": 1526960552, "creation_date": 1526960552, "answer_id": 50459446, "question_id": 50459316, "link": "https://stackoverflow.com/questions/50459316/infinite-loop-when-db-ping-is-called/50459446#50459446", "title": "Infinite loop when db.Ping() is called", "body": "<p>Your database configurations are wrong. It's pointing to the Golang server port <code>8080</code>. It should point to the pgsql port(default 5432)</p>\n"}], "owner": {"reputation": 25, "user_id": 6128743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7f9f4a04d3e4297559a6e34437d814?s=128&d=identicon&r=PG&f=1", "display_name": "DJBrunelle", "link": "https://stackoverflow.com/users/6128743/djbrunelle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 50459446, "answer_count": 1, "score": 0, "last_activity_date": 1526960610, "creation_date": 1526959563, "last_edit_date": 1526960610, "question_id": 50459316, "link": "https://stackoverflow.com/questions/50459316/infinite-loop-when-db-ping-is-called", "title": "Infinite loop when db.Ping() is called", "body": "<p>I am attempting to create a basic connection to a database. The problem happens when I try to test the connection with <code>db.Ping()</code>; everything works until I get to this line. The <code>Ping</code> sends the program into an infinite loop (the function call never returns), and I'm not sure how to go about fixing this.</p>\n\n<pre><code>package main\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"html/template\"\n    \"net/http\"\n    _ \"github.com/lib/pq\"\n}\ntype Page struct {\n    Name     string\n    DBStatus bool\n}\nconst (\n    host     = \"localhost\"\n    port     = 8080\n    user     = \"username\"\n    password = \"password\"\n    dbname   = \"GoTest\"\n)\nfunc main() {\n\n    templates := template.Must(template.ParseFiles(\"templates/index.html\"))\n\n    psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\n        \"password=%s dbname=%s sslmode=disable\",\n        host, port, user, password, dbname)\n\n    db, err := sql.Open(\"postgres\", psqlInfo)\n    if err != nil {\n        panic(err)\n    }\n    defer db.Close()\n\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n\n        p := Page{Name: \"Gopher\"}\n\n        if name := r.FormValue(\"name\"); name != \"\" {\n            p.Name = name\n        }\n\n        p.DBStatus = db.Ping() == nil //this point is reached but never returned\n\n        if err := templates.ExecuteTemplate(w, \"index.html\", p); err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n        }\n    })\n\n    fmt.Println(http.ListenAndServe(\":8080\", nil))\n\n}\n</code></pre>\n\n<p>It seems I can connect to the database fine, as the <code>sql.Open</code> call doesn't return an error, and if I called the <code>Ping</code> outside of the http server handle function, it also returns just fine.</p>\n\n<p>Any help would be greatly appreciated!</p>\n"}, {"tags": ["json", "rest", "go", "server"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1526964847, "post_id": 50459159, "comment_id": 87933188, "body": "Duplicate. The 10&#39;000."}], "answers": [{"tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": true, "score": 1, "last_activity_date": 1526958895, "creation_date": 1526958895, "answer_id": 50459252, "question_id": 50459159, "link": "https://stackoverflow.com/questions/50459159/why-is-my-go-server-not-correctly-decoding-the-json-it-is-being-sent-from-the-cl/50459252#50459252", "title": "Why is my Go server not correctly decoding the JSON it is being sent from the client?", "body": "<p>Here the issue is with you json encoding. <code>AddPlayerData</code> struct should export it's fields inorder for json decoder/encoder to work.</p>\n\n<p>Modify your struct to below</p>\n\n<pre><code>type AddPlayerData struct {\n    Name string `json:\"name\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 8749680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b2eab410466f8eea22732fdc47da6bf?s=128&d=identicon&r=PG&f=1", "display_name": "Arnav Garg", "link": "https://stackoverflow.com/users/8749680/arnav-garg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 50459252, "answer_count": 1, "score": -1, "last_activity_date": 1526958895, "creation_date": 1526958025, "question_id": 50459159, "link": "https://stackoverflow.com/questions/50459159/why-is-my-go-server-not-correctly-decoding-the-json-it-is-being-sent-from-the-cl", "title": "Why is my Go server not correctly decoding the JSON it is being sent from the client?", "body": "<p>I am working on writing a server in Go for a project, which involves receiving JSON data from a client and sending back a JSON response. When I run the code, any request I make works correctly, but the response is always empty. Here is the code for my server.</p>\n\n<pre><code>type AddPlayerData struct {\n    name string\n}\n\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        fmt.Println(\"[ SUCCESS ] Request from \", r.RemoteAddr)\n        decoder := json.NewDecoder(r.Body)\n        var data AddPlayerData\n        err := decoder.Decode(&amp;data)\n        if err != nil {\n            panic(err)\n        }\n        defer r.Body.Close()\n\n        json.NewEncoder(w).Encode(data)\n    }).Methods(\"PUT\");\n\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n</code></pre>\n\n<p>The requests I am sending are PUT requests formatted as follows:</p>\n\n<pre><code>{\n    \"name\": \"test-player\"\n}\n</code></pre>\n\n<p>I am receiving a response, but it is always empty. </p>\n"}, {"tags": ["git", "docker", "go", "dockerfile"], "answers": [{"tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": false, "score": 2, "last_activity_date": 1526956057, "last_edit_date": 1526956057, "creation_date": 1526955486, "answer_id": 50458868, "question_id": 50458541, "link": "https://stackoverflow.com/questions/50458541/standard-init-linux-go185-exec-user-process-caused-no-such-file-or-directory/50458868#50458868", "title": "standard_init_linux.go:185: exec user process caused &quot;no such file or directory&quot; building docker image", "body": "<p>Your docker image starts from alpine linux dstro. Hence you should use a supported cpu architecture</p>\n\n<p><code>GOARCH=amd64</code> instead of <code>GOARCH=386</code>.</p>\n\n<p>You can see other supported architectures here. <a href=\"https://hub.docker.com/r/library/alpine/\" rel=\"nofollow noreferrer\">https://hub.docker.com/r/library/alpine/</a></p>\n\n<p>Links to the alpine docker images of other architectures  can be found \nhere <a href=\"https://github.com/docker-library/official-images#architectures-other-than-amd64\" rel=\"nofollow noreferrer\">https://github.com/docker-library/official-images#architectures-other-than-amd64</a></p>\n"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 811, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1526956057, "creation_date": 1526952322, "question_id": 50458541, "link": "https://stackoverflow.com/questions/50458541/standard-init-linux-go185-exec-user-process-caused-no-such-file-or-directory", "title": "standard_init_linux.go:185: exec user process caused &quot;no such file or directory&quot; building docker image", "body": "<p>I am trying to generate a docker image based on a binary of Go. I have the next Dockerfile:</p>\n\n<pre><code>FROM alpine\n\nWORKDIR /\n\n# Now just add the binary\nRUN apk add --update bash &amp;&amp; rm -rf /var/cache/apk/*\nADD mybinary /\nADD config /config\nADD data /data\n\nENTRYPOINT [\"./mybinary\"]\n</code></pre>\n\n<p>And I built the binary by doing:</p>\n\n<pre><code>env GOOS=linux GOARCH=386 CGO_ENABLED=1 go build -o mybinary\n</code></pre>\n\n<p>The binary works pretty good if I executed alone, and the docker image is created as well, but in the moment of execution then I get the error:</p>\n\n<pre><code> standard_init_linux.go:185: exec user process caused \"no such file or directory\"\n</code></pre>\n\n<p>I read in many post that it's something regarding git, so, I deleted and cloned the project again but still I get the same error</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1526950371, "post_id": 50458313, "comment_id": 87930128, "body": "<code>for v := range ic {</code> this blocks until <code>ic</code> is closed."}], "answers": [{"comments": [{"owner": {"reputation": 747, "user_id": 1022894, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/256a5e324a8815f390860c4a09efa40d?s=128&d=identicon&r=PG", "display_name": "Pritam", "link": "https://stackoverflow.com/users/1022894/pritam"}, "edited": false, "score": 1, "creation_date": 1526963640, "post_id": 50458736, "comment_id": 87932833, "body": "Thank you. That is what i was looking for."}, {"owner": {"reputation": 4567, "user_id": 1318734, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/S3JJ2.gif?s=128&g=1", "display_name": "rofls", "link": "https://stackoverflow.com/users/1318734/rofls"}, "reply_to_user": {"reputation": 747, "user_id": 1022894, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/256a5e324a8815f390860c4a09efa40d?s=128&d=identicon&r=PG", "display_name": "Pritam", "link": "https://stackoverflow.com/users/1022894/pritam"}, "edited": false, "score": 0, "creation_date": 1526970863, "post_id": 50458736, "comment_id": 87935497, "body": "Glad you got what you needed. I will add with regards to <code>read back all the strings from intermediate channel to another channel</code>, you might not need a second channel there -- channels are good for communicating between go routines, but if you want to aggregate them afterwards in a single threaded manner, for that I recommend using another string slice, e.g. <code>var strs []string</code>."}], "tags": [], "owner": {"reputation": 4567, "user_id": 1318734, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/S3JJ2.gif?s=128&g=1", "display_name": "rofls", "link": "https://stackoverflow.com/users/1318734/rofls"}, "is_accepted": true, "score": 1, "last_activity_date": 1526954142, "creation_date": 1526954142, "answer_id": 50458736, "question_id": 50458313, "link": "https://stackoverflow.com/questions/50458313/how-to-concat-multiple-slices-through-go-routines/50458736#50458736", "title": "how to concat multiple slices through go routines", "body": "<p>As @zerkms said in the comment, you need to close the channel when you're done writing to it, or the <code>for v := range ic {</code> will block.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc f1(c chan []string, q chan int) {\n    ic := make(chan []string, 10)\n\n    hmap := map[int][]string{\n        0: []string{\"a\", \"b\", \"c\"},\n        1: []string{\"d\", \"e\"},\n        2: []string{\"f\", \"g\", \"h\"},\n    }\n    for _, v := range hmap {\n        f2(v, ic)\n    }\n    // done writing strings, close the channel\n    close(ic)\n    var strs []string\n    for v := range ic {\n        strs = append(strs, v...)\n    }\n    fmt.Println(strs)\n    select {\n    case c &lt;- strs:\n        fmt.Println(\"Received strings.\")\n    default:\n        fmt.Println(\"did not receive anything.\")\n    }\n    q &lt;- 1\n}\n\nfunc f2(v []string, ic chan []string) {\n    select {\n    case ic &lt;- v:\n        fmt.Println(\"Sent to intermediate channel:\", v)\n    default:\n        fmt.Println(\"nothing to send...\")\n    }\n}\nfunc f3(c chan []string) {\n    fmt.Println(&lt;-c)\n}\n\nfunc main() {\n    c := make(chan []string, 10)\n    q := make(chan int)\n    go f1(c, q)\n    go f3(c)\n    fmt.Println(&lt;-q) // to wait for the quit to be set\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/qZoAElTlkAa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qZoAElTlkAa</a></p>\n"}], "owner": {"reputation": 747, "user_id": 1022894, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/256a5e324a8815f390860c4a09efa40d?s=128&d=identicon&r=PG", "display_name": "Pritam", "link": "https://stackoverflow.com/users/1022894/pritam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 0, "accepted_answer_id": 50458736, "answer_count": 1, "score": 0, "last_activity_date": 1526971808, "creation_date": 1526950081, "last_edit_date": 1526971808, "question_id": 50458313, "link": "https://stackoverflow.com/questions/50458313/how-to-concat-multiple-slices-through-go-routines", "title": "how to concat multiple slices through go routines", "body": "<p>New to go. I am trying to read a <code>map[int][]string</code>, write the slice of strings into an intermediate channel and then once everything is written,  read back all the strings from intermediate channel to another channel and finally read the channel into another goroutine. </p>\n\n<p>I am not able to figure out what is a good non-blocking way to read from the intermediate channel.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc f1(c chan []string, q chan int) {\n  // intermediate channel\n    ic := make(chan []string, 10)\n\n  hmap := map[int][]string{\n    0: []string{\"a\", \"b\", \"c\"},\n    1: []string{\"d\", \"e\",},\n    2: []string{\"f\", \"g\", \"h\"},\n  }\n  // for every elem in hmap put the values into intermediate channel\n    for _, v := range hmap {\n       f2(v, ic)\n    }\n\n  // everything is in intermediate channel by now\n  // read all the []string and concatenate them into a slice in a\n  // non-blocking fashion\n  var strs []string\n  for v := range ic {\n    strs = append(strs, v...)\n  }\n    // strs := &lt;-ic\n  fmt.Println(strs)\n    select {\n  case c &lt;- strs:\n    fmt.Println(\"Received strings.\")\n  default:\n    fmt.Println(\"did not receive anything.\")\n  }\n    q &lt;- 1\n}\n\nfunc f2(v []string, ic chan []string) {\n    select {\n    case ic &lt;- v:\n        fmt.Println(\"Sent to intermediate channel:\", v)\n    default:\n        fmt.Println(\"nothing to send...\")\n    }\n}\nfunc f3(c chan []string) {\n    fmt.Println(&lt;-c)\n}\n\nfunc main() {\n    c := make(chan []string, 10)\n    q := make(chan int)\n    go f1(c, q)\n    go f3(c)\n    fmt.Println(&lt;-q) // to wait for the quit to be set\n}\n</code></pre>\n\n<p><code>go run main.go</code> to run. </p>\n\n<p>This program goes into deadlock. How can I avoid the deadlock?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-sqs", "amazon-sns"], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 3564261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7ec9da953e6f6f5682f4900b47d96cc?s=128&d=identicon&r=PG", "display_name": "Luis Santos", "link": "https://stackoverflow.com/users/3564261/luis-santos"}, "is_accepted": false, "score": 0, "last_activity_date": 1527082036, "creation_date": 1527082036, "answer_id": 50489690, "question_id": 50458273, "link": "https://stackoverflow.com/questions/50458273/eventsource-behind-a-load-balanced-multi-instance-cluster/50489690#50489690", "title": "Eventsource behind a load balanced multi instance cluster", "body": "<p>My personal opinion is that you should find a key piece of technology (Push notifications, PubNub, Aws IOT, <a href=\"https://firebase.google.com/docs/cloud-messaging/js/client\" rel=\"nofollow noreferrer\">Firebase</a>) to helps you solve this problem instead of building your own. </p>\n\n<p>These HTTP instances are stateful and so you need to be able to share state between them. \nScaling persistent connections is difficult and it becomes even harder with a round-robin load balancer in front of it. \nI suggest you look for a service that does all of this for you.</p>\n\n<p>If you want roll your own i would suggest you look into:</p>\n\n<ul>\n<li><a href=\"https://redis.io/commands/rpoplpush\" rel=\"nofollow noreferrer\">Redis</a>. Using one queue per user.</li>\n<li>Rabbit MQ - Creating a queue per user. I don't think this will scale but maybe it works for your case. </li>\n<li>Use some sort sort fo clustering framework. I have no idea about GO. Platforms like Erlang/Elixir or <a href=\"https://doc.akka.io/docs/akka/2.5.5/scala/distributed-pub-sub.html\" rel=\"nofollow noreferrer\">Akka</a> have support for clustering. Typically you can connect to any of the nodes of the cluster and the messages will be delivered to you.</li>\n</ul>\n\n<p>These realtime systems don't scale well using a request/response/polling model. If you don't need it to scale just store your data in mysql or REDIS and poll it. </p>\n"}, {"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 1, "creation_date": 1527134502, "post_id": 50498987, "comment_id": 88014060, "body": "Thanks! I gave some feedback here <a href=\"https://github.com/unee-t/showhook/pull/1#issuecomment-391580790\" rel=\"nofollow noreferrer\">github.com/unee-t/showhook/pull/1#issuecomment-391580790</a> since I am thinking <a href=\"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-long-polling.html\" rel=\"nofollow noreferrer\">AWS SQS long polling</a> is a better approach. I am not a fan of service discovery based solutions, since I feel it&#39;s way more error prone."}, {"owner": {"reputation": 5501, "user_id": 524733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b4ddb8b9c296ecf6a7cc338da508f98?s=128&d=identicon&r=PG", "display_name": "Stephen Blum", "link": "https://stackoverflow.com/users/524733/stephen-blum"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1527180833, "post_id": 50498987, "comment_id": 88041451, "body": "Yes this should work nicely as well! Note that you will have a limit of 100 SQS Topics by default. You can ask for more. SQS is great for queuing work and tasks to be processed. \ud83d\udc4d  Broadcasting updates with SQS is possible and it wasn&#39;t built for it. SQS is ideal for queuing long-running tasks that need processing time across many EC2 servers. It can be used as a delivery queue for end-target clients as long as you only have 100 target clients."}], "tags": [], "owner": {"reputation": 5501, "user_id": 524733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b4ddb8b9c296ecf6a7cc338da508f98?s=128&d=identicon&r=PG", "display_name": "Stephen Blum", "link": "https://stackoverflow.com/users/524733/stephen-blum"}, "is_accepted": true, "score": 3, "last_activity_date": 1527124599, "last_edit_date": 1527124599, "creation_date": 1527119266, "answer_id": 50498987, "question_id": 50458273, "link": "https://stackoverflow.com/questions/50458273/eventsource-behind-a-load-balanced-multi-instance-cluster/50498987#50498987", "title": "Eventsource behind a load balanced multi instance cluster", "body": "<h1>EventSource SSE behind a Load Balanced Multi-instance Cluster</h1>\n\n<blockquote>\n  <p>Pull request: <a href=\"https://github.com/unee-t/showhook/pull/1\" rel=\"nofollow noreferrer\">https://github.com/unee-t/showhook/pull/1</a></p>\n</blockquote>\n\n<p>The servers behind the load balancer need to be kept informed of <code>/events</code>. When the event is received on the neighboring server, that server must inform the group of the received event.</p>\n\n<p><a href=\"https://i.stack.imgur.com/VxmAd.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/VxmAd.gif\" alt=\"EventSource Golang Server\"></a></p>\n\n<h2>Example Usage</h2>\n\n<p>Get the repository.</p>\n\n<pre><code>git clone git@github.com:stephenlb/showhook.git\ncd showhook\n</code></pre>\n\n<p>You have to setup the project with <code>make</code>.</p>\n\n<pre><code>make build\nmake network\n</code></pre>\n\n<p>Now you can run your containers.  Note that we have a 12MB container with your binary.  We made the container small by creating a build-container and a runtime-container in the <a href=\"https://github.com/stephenlb/showhook/blob/master/Dockerfile\" rel=\"nofollow noreferrer\">Dockerfile</a>.  This takes the container from 400MB down to 12MB. \ud83c\udf89</p>\n\n<pre><code>PORT=9000 NEIGHBORS=192.168.0.1:9001 make start\nPORT=9001 NEIGHBORS=192.168.0.1:9000 make start\n</code></pre>\n\n<p>Now open your browser to load the html file.</p>\n\n<ol>\n<li><a href=\"http://0.0.0.0:9000\" rel=\"nofollow noreferrer\">http://0.0.0.0:9000</a> </li>\n<li><a href=\"http://0.0.0.0:9001\" rel=\"nofollow noreferrer\">http://0.0.0.0:9001</a></li>\n</ol>\n\n<p>Click the <code>/hook</code> link on the page in a third tab.  Notice that your first two tabs will receive the EventSource notification.</p>\n\n<h2>Updated <code>main.go</code> App Server</h2>\n\n<p>Add an HTTP call to your neighbors on <code>/hook-neighbor</code> event handler.  You can add code to your existing Go code which notifies neighboring servers to become aware of the event.  This will allow any client to receive the event regardless of the server subscribed on the <code>EventSource('/events')</code>.</p>\n\n<h2>Dynamically adding new Event Servers</h2>\n\n<p>When you need to scale up and down, you'll want to add/remove servers.  An easy way to keep your servers informed on new neighbors is by using service discovery.  You may consider adding <strong>Service Discovery</strong> such as <a href=\"https://coreos.com/etcd/\" rel=\"nofollow noreferrer\">etcd</a> and <a href=\"https://www.consul.io/\" rel=\"nofollow noreferrer\">consul</a>.</p>\n\n<p>You have a great start!  I built the <a href=\"https://www.pubnub.com/products/global-data-stream-network/\" rel=\"nofollow noreferrer\">PubNub Network</a> with a similar approach.</p>\n"}, {"tags": [], "owner": {"reputation": 1069, "user_id": 1162989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea23c3ceaf98e205cb76c616bfad8574?s=128&d=identicon&r=PG", "display_name": "Leonardo Barbosa", "link": "https://stackoverflow.com/users/1162989/leonardo-barbosa"}, "is_accepted": false, "score": 0, "last_activity_date": 1533212226, "last_edit_date": 1592644375, "creation_date": 1533212226, "answer_id": 51653455, "question_id": 50458273, "link": "https://stackoverflow.com/questions/50458273/eventsource-behind-a-load-balanced-multi-instance-cluster/51653455#51653455", "title": "Eventsource behind a load balanced multi instance cluster", "body": "<h2>SNS + SQS Fanout</h2>\n<p>In my view, this is a problem that can be neatly solved using <strong>SNS</strong> + <strong>SQS</strong>, with the <strong>Fanout</strong> pattern. You can architect this by having a <strong>SNS Topic</strong> where one service would publish a specific message (not caring about consumers at all - this helps decoupling) and you would have queues subscribed to this topic where other services would be able to consume it, in their own pace, the same messages. So, yes, this would solve the many receivers (or subscribers) problem.</p>\n<p><a href=\"https://i.stack.imgur.com/JS2v0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/JS2v0.png\" alt=\"SNS + SQS Fanout\" /></a></p>\n<p>It would be something like this:</p>\n<blockquote>\n<p>You have a topic (<strong>TopicX</strong>) on SNS</p>\n<p><strong>Service B</strong> has its own queue (<strong>QueueB</strong>); <strong>QueueB</strong> is subscribed to <strong>TopicX</strong></p>\n<p><strong>Service C</strong> has its own queue (<strong>QueueC</strong>); <strong>QueueC</strong> is subscribed to <strong>TopicX</strong></p>\n<p><strong>Service A</strong> performs an operation that needs to be shared across your network</p>\n<p><strong>Service A</strong> publishes <strong>Message1</strong> to <strong>TopicX</strong></p>\n<p><strong>QueueB</strong> receives <strong>Message1</strong></p>\n<p><strong>QueueC</strong> receives <strong>Message1</strong></p>\n<p><strong>ServiceB</strong> consumes <strong>Message1</strong></p>\n<p><strong>ServiceB</strong> deletes <strong>Message1</strong> from <strong>QueueB</strong></p>\n<p><strong>ServiceC</strong> consumes <strong>Message1</strong></p>\n<p><strong>ServiceC</strong> deletes <strong>Message1</strong> from <strong>QueueC</strong></p>\n</blockquote>\n<p>Check <a href=\"https://docs.aws.amazon.com/sns/latest/dg/SNS_Scenarios.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sns/latest/dg/SNS_Scenarios.html</a> for more details on this pattern.</p>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 759, "favorite_count": 2, "closed_date": 1533250548, "accepted_answer_id": 50498987, "answer_count": 3, "score": 2, "last_activity_date": 1533212226, "creation_date": 1526949678, "last_edit_date": 1527145330, "question_id": 50458273, "link": "https://stackoverflow.com/questions/50458273/eventsource-behind-a-load-balanced-multi-instance-cluster", "closed_reason": "Not suitable for this site", "title": "Eventsource behind a load balanced multi instance cluster", "body": "<p>I wrote a simple Web application to print the <a href=\"https://github.com/unee-t/showhook\" rel=\"nofollow noreferrer\">http request via Eventsource</a>. However I realized then when deployed in a typical ECS cluster, i.e. upon <strong>at least two</strong> instances behind a load balancer, if the user is connected to one instance and the hook is received by the other instance (assuming load balancer dispatches two different instances), the request will not be shown.</p>\n\n<p>I've seen this sort of problem before fitting other (stateful?) applications into this AWS scaling style of deployment of spinning new instances behind a load balancer. Is there a name for it? Any suggestions how to fix my program so that it can fit the AWS model? I guess the hook would need to be written to some datastore and the eventsource publisher needs to poll or rather preferably event from it?</p>\n"}, {"tags": ["go", "coordinates", "geo"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1526944255, "post_id": 50457588, "comment_id": 87928892, "body": "I&#39;m curious if the <a href=\"https://redis.io/commands#geo\" rel=\"nofollow noreferrer\">redis geo implementation</a> provides better results. Do you mind loading your data in there and doing a comparison?"}], "answers": [{"tags": [], "owner": {"reputation": 23269, "user_id": 700825, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/6aea6e2f57f2a7b1cd6870375fbdc42f?s=128&d=identicon&r=PG", "display_name": "NoSenseEtAl", "link": "https://stackoverflow.com/users/700825/nosenseetal"}, "is_accepted": false, "score": -1, "last_activity_date": 1526944035, "creation_date": 1526944035, "answer_id": 50457660, "question_id": 50457588, "link": "https://stackoverflow.com/questions/50457588/fast-way-search-millions-of-coordinates-by-distance/50457660#50457660", "title": "Fast way search millions of coordinates by distance", "body": "<p>Idea would be to have a \"grid\" that partitions coordinates, so that when you do need to do a lookup you can safely return all coordinates in particular cell, do not return any from the cells too far away from target, and only do per coordinate comparison for coordinates that are in the cells that contains some coordinates within distance and some outside the distance. </p>\n\n<p>Simplified to 1D:</p>\n\n<p>Coordinates are from 1 to 100</p>\n\n<p>you partition into 5 blocks of 20</p>\n\n<p>When somebody looks for all coordinates within distance 25 from 47 \nyou return all coordinates in blocks [30,39], [40,49],[50,59],[60,69] and then after doing per coordinate analysis for blocks [20,29] and [70,79] you additionally return 22,23,24,25,26,27,28,29, 70,71,72.</p>\n\n<p>Unfortunately I have no realistic way to estimate speedup of this approach so you would need to implement it and benchmark it by yourself.</p>\n"}, {"tags": [], "owner": {"reputation": 99, "user_id": 5249889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ed081a68069d8a71404316895567711?s=128&d=identicon&r=PG&f=1", "display_name": "Smilliam", "link": "https://stackoverflow.com/users/5249889/smilliam"}, "is_accepted": false, "score": 3, "last_activity_date": 1526944355, "creation_date": 1526944355, "answer_id": 50457702, "question_id": 50457588, "link": "https://stackoverflow.com/questions/50457588/fast-way-search-millions-of-coordinates-by-distance/50457702#50457702", "title": "Fast way search millions of coordinates by distance", "body": "<p>I think that this is more of a data structure problem. One good way to store large sets of geospatial coordinates is with an <a href=\"https://en.wikipedia.org/wiki/R-tree\" rel=\"nofollow noreferrer\">R-tree</a>. It provides log<sub>n</sub> M search. I have limited knowledge of Go, but I have used an R-Tree to great effect for similarly sized datasets in a similar use case in a JS application. From a quick search it appears as though there are at least a couple Go R-Tree implementations out there.</p>\n"}, {"tags": [], "owner": {"reputation": 75, "user_id": 1638680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3daa6d9e1fd176087a06f2bac4475895?s=128&d=identicon&r=PG", "display_name": "dgm", "link": "https://stackoverflow.com/users/1638680/dgm"}, "is_accepted": false, "score": -3, "last_activity_date": 1526949271, "creation_date": 1526949271, "answer_id": 50458225, "question_id": 50457588, "link": "https://stackoverflow.com/questions/50457588/fast-way-search-millions-of-coordinates-by-distance/50458225#50458225", "title": "Fast way search millions of coordinates by distance", "body": "<p>MongoDB has various geographic searches $geoNear will allow you to search for points within a specific distance from a point or within a shape.</p>\n\n<p><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/geoNear/\" rel=\"nofollow noreferrer\">https://docs.mongodb.com/manual/reference/operator/aggregation/geoNear/</a></p>\n\n<p>PostGIS for Postgres has something similar, but I am not too familiar with it.</p>\n"}], "owner": {"reputation": 9463, "user_id": 104452, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/beba327eb1e4744fd01b111fe0e04eeb?s=128&d=identicon&r=PG", "display_name": "Ozzy", "link": "https://stackoverflow.com/users/104452/ozzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 475, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1526949271, "creation_date": 1526943435, "question_id": 50457588, "link": "https://stackoverflow.com/questions/50457588/fast-way-search-millions-of-coordinates-by-distance", "title": "Fast way search millions of coordinates by distance", "body": "<p>I have a data set of about 20 million coordinates. I want to be able to pass in a latitude, longitude, and distance in miles and return all coordinates that are within the mile range of my given coordinates. I need the response time to ideally be sub 50ms.</p>\n\n<p>I have tried loading all coordinates in memory in a golang service which, on every request, will loop through the data and using haversine filter all coordinates which are within the given miles distance of my given coordinate.</p>\n\n<p>This method sees the results return in around 2 seconds. What approach would be good to increase the speed of the results? I am open to any suggestions.</p>\n\n<p>I am toying around with the idea of grouping all coordinates by degree and only filtering by the nearest to the given coordinates. Haven't had any luck improving the response times yet though. My data set is only a test one too as the real data could potentially be in the hundreds of millions.</p>\n"}, {"tags": ["go", "uint64"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1526937909, "post_id": 50456745, "comment_id": 87927098, "body": "A 64-bit floating point only uses 52 bits (plus an implied 53rd) to represent the number itself, with another 11 used to represent the exponent, and then a sign bit.  That means it cannot precisely store numbers that require more than 53 bits to represent.  See <a href=\"https://wiki.sei.cmu.edu/confluence/display/c/FLP00-C.+Understand+the+limitations+of+floating-point+numbers\" rel=\"nofollow noreferrer\">this</a> and <a href=\"https://en.wikipedia.org/wiki/Double-precision_floating-point_format\" rel=\"nofollow noreferrer\">this</a> for more details, or the link in the comment above."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526938165, "post_id": 50456745, "comment_id": 87927177, "body": "Also see <a href=\"https://stackoverflow.com/questions/588004/is-floating-point-math-broken\">Is floating point math broken?</a>"}], "owner": {"reputation": 49, "user_id": 2992915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d95808cc18c1a2cffc006cddd1af6e0?s=128&d=identicon&r=PG&f=1", "display_name": "user2992915", "link": "https://stackoverflow.com/users/2992915/user2992915"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "closed_date": 1526938914, "answer_count": 0, "score": 0, "last_activity_date": 1526937502, "creation_date": 1526937502, "question_id": 50456745, "link": "https://stackoverflow.com/questions/50456745/golang-how-to-convert-large-uint64-to-float", "closed_reason": "Duplicate", "title": "Golang How to convert large uint64 to float?", "body": "<p>When I print out the maximum values for uint64, float32 and float64 it seems as though a float should accommodate a uint64.  However, I've tried a number of conversions and large uint64 numbers do not convert accurately. Am I doing something incorrectly?  Or am I misunderstanding the documentation and language constraints?</p>\n\n<pre><code>fmt.Printf(\"Max unit64 value = %d\\n\", uint64(math.MaxUint64))\nfmt.Printf(\"Max float32 value = %f\\n\", float32(math.MaxFloat32))\nfmt.Printf(\"Max float64 value = %f\\n\", float64(math.MaxFloat64))\n\nvar ui64 uint64\nui64 = uint64(math.MaxUint64)\nfmt.Printf(\"uint64(math.MaxUint64) = %d\\n\", ui64)\n\nvar f32 float32\nf32 = float32(ui64)\nfmt.Printf(\"%d as 32-bit float = %0.f\\n\", ui64, f32)\n\nvar f64 float64\nf64 = float64(ui64)\nfmt.Printf(\"%d as 64-bit float = %0.f\\n\", ui64, f64)\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>Max unit64 value = 18446744073709551615\nMax float32 value = 340282346638528859811704183484516925440.000000\nMax float64 value = 179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.000000\nuint64(math.MaxUint64) = 18446744073709551615\n18446744073709551615 as 32-bit float = 18446744073709551616\n18446744073709551615 as 64-bit float = 18446744073709551616\n</code></pre>\n\n<p>Go Playground -> <a href=\"https://play.golang.org/p/DhlaxbFixBD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DhlaxbFixBD</a></p>\n\n<p>I've also tried using a big.Float, which outputs the correct Text, but gives the same results when calling the Float64() function to get a float64. That makes it seem like some type of overflow is happening, but I'm not sure if it's a constraint of the language or something I'm doing incorrectly.  Assistance is greatly appreciated.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 1, "last_activity_date": 1526936282, "last_edit_date": 1526936282, "creation_date": 1526933201, "answer_id": 50455904, "question_id": 50455798, "link": "https://stackoverflow.com/questions/50455798/why-when-a-type-do-implementing-an-interface-there-is-a-difference-in-behavior/50455904#50455904", "title": "Why when a type do implementing an interface there is a difference in behavior?", "body": "<p>The reason is that when you change the receiver signature to <code>(p *Person)</code> it means that <code>*Person</code> implements the interface, not <code>Person</code>, so your \"Data\" array must be changed to match.</p>\n\n<p>That is, you must change the signature of the interface method <em>and</em> the contents of the \"d\" variable to contain Person pointers and it should work, since <code>&amp;Person{...}</code> is a <code>*Person</code> which is a GetNamer:</p>\n\n<pre><code>func (p *Person) GetName() {\n  // ...\n}\n\nvar d = Data{\n  &amp;Person{\"Vasya\"},\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 2893679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a6dd8a8bd315bbc5b725b951da7dccd?s=128&d=identicon&r=PG&f=1", "display_name": "Shamany", "link": "https://stackoverflow.com/users/2893679/shamany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 50455904, "answer_count": 1, "score": 0, "last_activity_date": 1526936282, "creation_date": 1526932710, "question_id": 50455798, "link": "https://stackoverflow.com/questions/50455798/why-when-a-type-do-implementing-an-interface-there-is-a-difference-in-behavior", "title": "Why when a type do implementing an interface there is a difference in behavior?", "body": "<p>Who can tell (or link where to read), why when a type do implementing an interface\nthere is a difference in behavior (depending on how to transfer the recipient)?\nHere so it works:</p>\n\n<pre><code>type GetNamer interface {\n  GetName()\n}\n\ntype Person struct {\n  PersonName string\n}\n\nfunc (p Person) GetName() {\n  fmt.Println(p.PersonName)\n}\n\ntype Data []GetNamer\n\nvar d = Data{\n    Person{\"Vasya\"},\n  }\n</code></pre>\n\n<p>But, if I pass the recipient by the link: <strong>(p *Person)</strong>\nI get an error that types (Person and GetNamer) do not match.</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 14370, "user_id": 2095534, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d3c704aafdd6b320be07e0fc21964b3f?s=128&d=identicon&r=PG&f=1", "display_name": "Kamil Gosciminski", "link": "https://stackoverflow.com/users/2095534/kamil-gosciminski"}, "edited": false, "score": 3, "creation_date": 1526940656, "post_id": 50455734, "comment_id": 87928016, "body": "Since I don&#39;t know go I&#39;ll just place it here to maybe give you some hint. As a workaround you could enable statement logging on server side for postgresql and investigate what&#39;s being executed"}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "reply_to_user": {"reputation": 14370, "user_id": 2095534, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d3c704aafdd6b320be07e0fc21964b3f?s=128&d=identicon&r=PG&f=1", "display_name": "Kamil Gosciminski", "link": "https://stackoverflow.com/users/2095534/kamil-gosciminski"}, "edited": false, "score": 0, "creation_date": 1526941348, "post_id": 50455734, "comment_id": 87928218, "body": "hint accepted! thanks @KamilG."}], "owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1526932374, "creation_date": 1526932374, "question_id": 50455734, "link": "https://stackoverflow.com/questions/50455734/get-actual-sql-statement-employed-behind-a-db-query-call", "title": "Get actual sql statement employed behind a Db.Query call", "body": "<p>So, is there any way to archieve something like the <code>Db.Translate</code> func in the below example?</p>\n\n<pre><code>func printStatement(values []int64) {\n    actualQueryAsString := Db.Translate(`\n        SELECT *\n        FROM table\n        WHERE values = ANY($1)`, pq.Array(values))\n    fmt.Println(\"The statement that will be used is :\", actualQueryAsString)\n}\n</code></pre>\n\n<p>I tried to find how to do it but ran out of ideas... thanks in advance.</p>\n"}, {"tags": ["go", "yaml", "go-templates"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1526932202, "post_id": 50455437, "comment_id": 87924776, "body": "It&#39;s not clear what you&#39;re asking - it sounds like you want to write data to a file just so you can read it from that file from the same process, which seems really inefficient when you already have the data in memory."}, {"owner": {"reputation": 374, "user_id": 4833237, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b99a13ba5d3fc3b181d50e97e606896d?s=128&d=identicon&r=PG&f=1", "display_name": "Maklaus", "link": "https://stackoverflow.com/users/4833237/maklaus"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1526937392, "post_id": 50455437, "comment_id": 87926918, "body": "The file on disk would be config.yaml.go created/edited manually. My app would read it once, parse it as a go template and then parse again as YAML. My question is if that&#39;s a good way of providing a configuration for an application which requires dynamic variables or I should use something like HCL from hashicorp. Does it make sense now?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1526997522, "post_id": 50455437, "comment_id": 87952476, "body": "That doesn&#39;t seem like a very good way to do that at all, but there&#39;s basically no information given in the question as to what you&#39;re actually trying to accomplish, so it&#39;s hard to give a better recommendation."}], "owner": {"reputation": 374, "user_id": 4833237, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b99a13ba5d3fc3b181d50e97e606896d?s=128&d=identicon&r=PG&f=1", "display_name": "Maklaus", "link": "https://stackoverflow.com/users/4833237/maklaus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2589, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1526937495, "creation_date": 1526930781, "last_edit_date": 1526937495, "question_id": 50455437, "link": "https://stackoverflow.com/questions/50455437/using-go-template-with-yaml", "title": "Using Go template with YAML", "body": "<p>My Go application provides an API which is doing health checks by contacting other internal APIs for the host passed in the request.</p>\n\n<p>For example the API endpoint will be <code>/api/v1/host/my-host-01</code>. In YAML configuration file app users will be specifying what healthchecks they want to be executed, it should support dynamic variables. For example config.yaml.go:</p>\n\n<pre><code>healthchecks:\n  hostIsAvailableInAnotherAPI:\n    httpGet:\n      path: /another-api/{{.Hostname}}\n</code></pre>\n\n<p>So before reading the YAML config I would render it with as a Go template on each GET request to my API with <code>.Hostname</code> and only then run the health checks and provide result.</p>\n\n<p>Is that a good approach to use Go template + YAML or is there a better way of doing that?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1526930096, "post_id": 50455238, "comment_id": 87923853, "body": "Use a buffered channel or run the send async (<code>go func() { chan1 &lt;- true }()</code>)"}, {"owner": {"reputation": 1186, "user_id": 2630704, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5bd309f01fdb11e8c8f0c53922685f61?s=128&d=identicon&r=PG", "display_name": "wmfrancia", "link": "https://stackoverflow.com/users/2630704/wmfrancia"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1526930468, "post_id": 50455238, "comment_id": 87924006, "body": "Thanks the Async does the trick, I will look at buffered channels though since the async looks a little messy."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 1, "creation_date": 1526930526, "post_id": 50455238, "comment_id": 87924032, "body": "Why the downvote on this question? It seems perfectly valid..."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1526930574, "post_id": 50455238, "comment_id": 87924049, "body": "Reposted as an answer with some example code. HTH."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1526930545, "creation_date": 1526930545, "answer_id": 50455383, "question_id": 50455238, "link": "https://stackoverflow.com/questions/50455238/send-data-to-multiple-channels-in-succession/50455383#50455383", "title": "Send data to multiple channels in succession", "body": "<p>Use a <a href=\"https://tour.golang.org/concurrency/3\" rel=\"nofollow noreferrer\">buffered channel</a>:</p>\n\n<pre><code>var chan1 = make(chan bool, 1)\nvar chan2 = make(chan bool, 1)\nvar chan3 = make(chan bool, 1)\n</code></pre>\n\n<p>Or run the send <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow noreferrer\">asynchronously</a>:</p>\n\n<pre><code>go func() {\n    chan1 &lt;- true\n}()\n</code></pre>\n"}], "owner": {"reputation": 1186, "user_id": 2630704, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5bd309f01fdb11e8c8f0c53922685f61?s=128&d=identicon&r=PG", "display_name": "wmfrancia", "link": "https://stackoverflow.com/users/2630704/wmfrancia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 50455383, "answer_count": 1, "score": 0, "last_activity_date": 1526930797, "creation_date": 1526929898, "last_edit_date": 1526930797, "question_id": 50455238, "link": "https://stackoverflow.com/questions/50455238/send-data-to-multiple-channels-in-succession", "title": "Send data to multiple channels in succession", "body": "<p>I have the following scenario: A function that is called every minute and each time it is called it attempts to send data to multiple defined channels as such.</p>\n\n<pre><code>var chan1 = make(chan bool)\nvar chan2 = make(chan bool)\nvar chan3 = make(chan bool)\n\ngo func() {\n for {\n  &lt;-time.After(1* time.Minute)\n  chan1 &lt;- true\n  chan2 &lt;- false\n  chan3 &lt;- true\n }\n}()\n</code></pre>\n\n<p>Then in three separate go routines each channel is read via a <code>select</code> like so.      </p>\n\n<pre><code>go func() {\n var myVar bool\n\n select {\n   case &lt;- chan1: //or chan2, chan3 etc...\n     myVar = true\n   default:\n     myVar = false\n}()\n</code></pre>\n\n<p>The issue is only <code>chan1</code> receives the data from the first time based loop. So what appears to be occurring is the sending of data is blocked for all subsequent channels until the first channel is read. How would I correct this?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1526926399, "post_id": 50454460, "comment_id": 87922153, "body": "You can&#39;t using <code>new</code>, but you don&#39;t have to use <code>new</code>. Try taking the <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">Tour of Go</a>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526927368, "post_id": 50454460, "comment_id": 87922605, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/4498998/how-to-initialize-members-in-go-struct\" title=\"how to initialize members in go struct\">stackoverflow.com/questions/4498998/&hellip;</a>,"}], "answers": [{"comments": [{"owner": {"reputation": 2936, "user_id": 39791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/661c7cc5565e5bc21fb0fc22c0354fef?s=128&d=identicon&r=PG", "display_name": "Joe McMahon", "link": "https://stackoverflow.com/users/39791/joe-mcmahon"}, "edited": false, "score": 3, "creation_date": 1526932141, "post_id": 50454548, "comment_id": 87924744, "body": "More detail as to <i>why</i> this solves the question would be very useful to other readers in the future."}], "tags": [], "owner": {"reputation": 39, "user_id": 3169724, "user_type": "registered", "accept_rate": 11, "profile_image": "https://graph.facebook.com/100003958622460/picture?type=large", "display_name": "user3169724", "link": "https://stackoverflow.com/users/3169724/user3169724"}, "is_accepted": false, "score": -1, "last_activity_date": 1526926773, "creation_date": 1526926773, "answer_id": 50454548, "question_id": 50454460, "link": "https://stackoverflow.com/questions/50454460/create-instance-of-struct-with-values/50454548#50454548", "title": "Create instance of struct with values", "body": "<pre><code>return &amp;InvalidIPError{HostRaw: raw}\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 3169724, "user_type": "registered", "accept_rate": 11, "profile_image": "https://graph.facebook.com/100003958622460/picture?type=large", "display_name": "user3169724", "link": "https://stackoverflow.com/users/3169724/user3169724"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1526926773, "creation_date": 1526926359, "question_id": 50454460, "link": "https://stackoverflow.com/questions/50454460/create-instance-of-struct-with-values", "title": "Create instance of struct with values", "body": "<pre><code>// Valid checks Config data\nfunc (c *Config) Valid() Error {\n    // Check mapping.hosts\n    for _, raw := range c.Mapping.Hosts {\n        if validIP := utils.ValidIP4(raw.IPAddress); !validIP {\n            err := new(InvalidIPError)\n            return err\n        }\n    }\n\n    return nil\n}\n\n// Error represents errors in config\ntype Error interface {\n    Error() string\n}\n\n// InvalidIPError raises when invalid ip provided\ntype InvalidIPError struct {\n    HostRaw HostRaw\n}\n\nfunc (e *InvalidIPError) Error() string {\n    return fmt.Sprintf(\"You specified invalid IP: %v\", e.HostRaw)\n}\n</code></pre>\n\n<p>How I can create instance of InvalidIPError with <code>new</code> keyword and values to send it to <code>return</code> in one line?</p>\n\n<p>For example something like this <code>return new(InvalidIPError{HostRaw: raw})</code></p>\n"}, {"tags": ["amazon-web-services", "unit-testing", "go", "request", "mocking"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1526926008, "post_id": 50454370, "comment_id": 87921971, "body": "What trouble specifically are you running into?"}, {"owner": {"reputation": 4348, "user_id": 3435610, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IBOFX.jpg?s=128&g=1", "display_name": "Sara Tibbetts", "link": "https://stackoverflow.com/users/3435610/sara-tibbetts"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1526926055, "post_id": 50454370, "comment_id": 87921988, "body": "@Adrian I&#39;m new to Go, so I have absolutely no idea how to start mocking the request that is returned from <code>GetSecretValueRequest</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1526932349, "post_id": 50454370, "comment_id": 87924845, "body": "To be able to mock the request as well you&#39;ll have to define an interface for it, just like there is an interface for the manger you&#39;ll need one for the request. If the sdk does not provide one you&#39;ll have to define it yourself. Here&#39;s an example: <a href=\"https://play.golang.org/p/muEuHe_Vesm\" rel=\"nofollow noreferrer\">play.golang.org/p/muEuHe_Vesm</a>"}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": true, "score": 3, "last_activity_date": 1527104926, "creation_date": 1527104926, "answer_id": 50496391, "question_id": 50454370, "link": "https://stackoverflow.com/questions/50454370/how-to-mock-out-aws-sdk-for-go-call/50496391#50496391", "title": "How to Mock out AWS SDK for Go call", "body": "<p>First, find the service in the \n<a href=\"https://docs.aws.amazon.com/sdk-for-go/api/\" rel=\"nofollow noreferrer\">\"AWS SDK for Go API Reference.\"</a></p>\n\n<p>Then look up the API call.  Your call is here\n<a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/secretsmanager/#SecretsManager.GetSecretValueRequest\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/secretsmanager/#SecretsManager.GetSecretValueRequest</a></p>\n\n<p>The prototype for the API call is</p>\n\n<pre><code>func (c *SecretsManager) GetSecretValueRequest(input *GetSecretValueInput) (req *request.Request, output *GetSecretValueOutput)\n</code></pre>\n\n<p>So it returns a request.Request and a GetSecretValueOutput</p>\n\n<p>The two output items are structs and they are linked in the documentation.  The mock should return those two items in the same way ie</p>\n\n<pre><code>func (m *MockSecretsManagerClient) GetSecretValueRequest(input *secretsmanager.GetSecretValueInput) (req *request.Request, resp *secretsmanager.GetSecretValueOutput) {\n\n    req = new(request.Request)\n    r := new(http.Response)\n    r.Status = \"200 OK\"\n    r.Status = 200\n    req.HTTPRequest = r\n    resp.SecretString = new(String(\"this is the dummy value\"))\n\n    return\n}\n</code></pre>\n\n<p>If you need the mock values to be mock like \"real\" data from a live API service then write a quick program to do a call and <code>Printf</code> the return values using <code>\"%#v\"</code> format.  This should give you most of what you need</p>\n"}], "owner": {"reputation": 4348, "user_id": 3435610, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IBOFX.jpg?s=128&g=1", "display_name": "Sara Tibbetts", "link": "https://stackoverflow.com/users/3435610/sara-tibbetts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3475, "favorite_count": 2, "accepted_answer_id": 50496391, "answer_count": 1, "score": 5, "last_activity_date": 1527104926, "creation_date": 1526925902, "last_edit_date": 1526926365, "question_id": 50454370, "link": "https://stackoverflow.com/questions/50454370/how-to-mock-out-aws-sdk-for-go-call", "title": "How to Mock out AWS SDK for Go call", "body": "<p>I am writing a unit test for a function that uses the AWS SDK for Go to get a secret from the AWS Secrets Manager: </p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>//Helper function to get secret from AWS Secret Manager\nfunc getAWSSecrets(svc secretsmanageriface.SecretsManagerAPI) (secretMap map[string]string, err error) {\n    //Get secret config values\n    req, resp := svc.GetSecretValueRequest(&amp;secretsmanager.GetSecretValueInput{\n        SecretId: aws.String(\"my/secret/string\"),\n    })\n\n    err = req.Send()\n    if err != nil {\n        return nil, err\n    }\n\n ...\n}\n</code></pre>\n\n<p>In order to test this, I need to create a mock AWS Secret Manager Client.  I've set up the basic skeleton of how that will work: </p>\n\n<p><strong>main_test.go</strong></p>\n\n<pre><code>type MockSecretsManagerClient struct {\n  secretsmanageriface.SecretsManagerAPI\n} \n\nfunc (m *MockSecretsManagerClient) GetSecretValueRequest(input *secretsmanager.GetSecretValueInput) (req *request.Request, resp *secretsmanager.GetSecretValueOutput){\n  // Confused on how to mock out the returned `req`\n}\n\n\n// tests getAWSSecrets\nfunc (suite *ServerTestSuite) TestGetAWSSecrets() {\n    //Setup test \n  mockSvc := &amp;MockSecretsManagerClient{}\n  req, resp := getAWSSecrets(mockSvc)\n}\n</code></pre>\n\n<p>I'm running into trouble trying to mock the returned request from <code>GetSecretValueRequest</code>.  Furthermore, once I mock this request, I'm not sure how to handle mocking <code>req.Send()</code>. Is there a simple way to do this? Or are there any good examples of someone doing this?    </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1526921387, "post_id": 50453253, "comment_id": 87919709, "body": "Because they <i>are</i> pointers. The <code>fmt</code> output doesn&#39;t recurse indefinitely."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1526921390, "post_id": 50453253, "comment_id": 87919711, "body": "Because that&#39;s how it is implemented. Although you can implement the Stringer interface on your pointer type."}, {"owner": {"reputation": 578, "user_id": 2618033, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100000332706842/picture?type=large", "display_name": "Ben Keil", "link": "https://stackoverflow.com/users/2618033/ben-keil"}, "edited": false, "score": 0, "creation_date": 1526921475, "post_id": 50453253, "comment_id": 87919760, "body": "sorry I&#39;m new to go, how I must change my code?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526921513, "post_id": 50453253, "comment_id": 87919785, "body": "What do you want it to do?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1526921520, "post_id": 50453253, "comment_id": 87919794, "body": "@BenKeil in this example <code>*T</code> implements the Stringer interface by virtue of implementing the String method: <a href=\"https://play.golang.org/p/xMwm7ZUbfjH\" rel=\"nofollow noreferrer\">play.golang.org/p/xMwm7ZUbfjH</a> (comment out the method to see the difference)"}, {"owner": {"reputation": 578, "user_id": 2618033, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100000332706842/picture?type=large", "display_name": "Ben Keil", "link": "https://stackoverflow.com/users/2618033/ben-keil"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1526921727, "post_id": 50453253, "comment_id": 87919907, "body": "@mkopriva thank you, that solved my problem. I thought there must be a way without implement the <code>String()</code> function."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1526921765, "post_id": 50453253, "comment_id": 87919930, "body": "Try the <code>%#v</code> format specifier after dereferencing the pointer"}], "owner": {"reputation": 578, "user_id": 2618033, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100000332706842/picture?type=large", "display_name": "Ben Keil", "link": "https://stackoverflow.com/users/2618033/ben-keil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 24, "favorite_count": 0, "closed_date": 1526921796, "answer_count": 0, "score": 0, "last_activity_date": 1526921184, "creation_date": 1526921184, "question_id": 50453253, "link": "https://stackoverflow.com/questions/50453253/go-printing-array-of-structs-prints-only-pointer-values", "closed_reason": "Duplicate", "title": "go printing array of structs prints only pointer values", "body": "<p>With the following code</p>\n\n<pre><code>checks := checkDeployment.CheckAll().All()\nfmt.Printf(\"checks: %+v\\n\", checks[0])\nfmt.Printf(\"checks: %+v\\n\", checks)\n</code></pre>\n\n<p>I got this output</p>\n\n<pre><code>checks: &amp;{name:CheckUpdateStrategy serviceState:0 message:everything ok}\nchecks: [0xc42050b9e0]\n</code></pre>\n\n<p>Why the array is printed as the value of a pointer and not formatted like a single element?</p>\n\n<pre><code>type (\n    // ServiceCheckResults contains multiple results for service checks\n    ServiceCheckResults interface {\n        All() []ServiceCheckResult\n    }\n\n    serviceCheckResultsImpl struct {\n        results map[string]ServiceCheckResult\n    }\n)\n\n// All returns all values from the set\nfunc (r *serviceCheckResultsImpl) All() []ServiceCheckResult {\n    values := []ServiceCheckResult{}\n    for _, value := range r.results {\n        values = append(values, value)\n    }\n    return values\n}\n</code></pre>\n"}, {"tags": ["go", "go-echo"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1526917627, "post_id": 50452235, "comment_id": 87917723, "body": "I really don&#39;t understand what you&#39;re trying to do... but you can&#39;t replace the echo context with some arbitrary type. What is the end-goal you&#39;re trying to achieve? This feels a lot like an XY problem."}, {"owner": {"reputation": 113, "user_id": 2801325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0e6d872d443c8b6838a03b8a40cdf96?s=128&d=identicon&r=PG&f=1", "display_name": "Lansi", "link": "https://stackoverflow.com/users/2801325/lansi"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526918236, "post_id": 50452235, "comment_id": 87918080, "body": "I just want to set error handler in custom context for make 404 error page."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1526918345, "post_id": 50452235, "comment_id": 87918130, "body": "That doesn&#39;t explain why you need a custom context. You can make a 404 page without that."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1526919436, "post_id": 50452235, "comment_id": 87918732, "body": "It also might be important to note that interfaces may be simplified, but not made more complex. Here is a mini example. In your case, you can set a <code>CustomContext</code> to a <code>echo.Context</code>, then, cast it back, but if it isn&#39;t originally a <code>CustomContext</code>, you can&#39;t &quot;upgrade&quot; it to one. <a href=\"https://play.golang.org/p/BnFquWSBsbk\" rel=\"nofollow noreferrer\">play.golang.org/p/BnFquWSBsbk</a>"}, {"owner": {"reputation": 113, "user_id": 2801325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0e6d872d443c8b6838a03b8a40cdf96?s=128&d=identicon&r=PG&f=1", "display_name": "Lansi", "link": "https://stackoverflow.com/users/2801325/lansi"}, "edited": false, "score": 0, "creation_date": 1526921036, "post_id": 50452235, "comment_id": 87919540, "body": "custom context converting is work very well in other method. i just guess echo.NotFoundHandler work before custom context converting middleware work."}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 2801325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0e6d872d443c8b6838a03b8a40cdf96?s=128&d=identicon&r=PG&f=1", "display_name": "Lansi", "link": "https://stackoverflow.com/users/2801325/lansi"}, "edited": false, "score": 0, "creation_date": 1526919240, "post_id": 50452469, "comment_id": 87918620, "body": "oh, i found a good solution. thanks! i use custom context for access DB, Session, my function, etc easily. i dont think use custom context is bad way. and i cant find better solution."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 113, "user_id": 2801325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0e6d872d443c8b6838a03b8a40cdf96?s=128&d=identicon&r=PG&f=1", "display_name": "Lansi", "link": "https://stackoverflow.com/users/2801325/lansi"}, "edited": false, "score": 0, "creation_date": 1526919430, "post_id": 50452469, "comment_id": 87918726, "body": "A standard go <code>context</code> is the better way."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1526918036, "creation_date": 1526918036, "answer_id": 50452469, "question_id": 50452235, "link": "https://stackoverflow.com/questions/50452235/echo-cant-use-custom-context-in-httperrorhandler/50452469#50452469", "title": "Echo can&#39;t use custom context in HTTPErrorHandler", "body": "<p>The immediate cause of the panic is that the error handler is being called with a \"standard\" context. To make your type assertion safe, use the two-value form:</p>\n\n<pre><code>e.HTTPErrorHandler = func(err error, c echo.Context) {\n    cc, ok := c.(*CustomContext)\n    if ok {\n        // A CustomContext was received\n    } else {\n        // Something else, probably a standard context, was received\n    }\n}\n</code></pre>\n\n<p>But more generally speaking, what you're doing (using a custom context type) is probably a bad idea.  If you explain what you're trying to accomplish, there is probably a better, more robust way to solve it.</p>\n\n<p>One obvious alternative would be to use standard Go contexts, as exposed through echo via <code>c.Request().Context()</code>.</p>\n"}], "owner": {"reputation": 113, "user_id": 2801325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0e6d872d443c8b6838a03b8a40cdf96?s=128&d=identicon&r=PG&f=1", "display_name": "Lansi", "link": "https://stackoverflow.com/users/2801325/lansi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1442, "favorite_count": 0, "accepted_answer_id": 50452469, "answer_count": 1, "score": -1, "last_activity_date": 1584955175, "creation_date": 1526917217, "last_edit_date": 1584955175, "question_id": 50452235, "link": "https://stackoverflow.com/questions/50452235/echo-cant-use-custom-context-in-httperrorhandler", "title": "Echo can&#39;t use custom context in HTTPErrorHandler", "body": "<pre class=\"lang-golang prettyprint-override\"><code>e.Use(func(h echo.HandlerFunc) echo.HandlerFunc {\n  return func(c echo.Context) error {\n    cc := c.(*CustomContext)\n    return h(cc)\n  }\n})\n\n\ne.HTTPErrorHandler = func(err error, c echo.Context) {\n  cc := c.(*CustomContext)\n}\n</code></pre>\n\n<p>I set custom HTTPErrorHandler and CustomContext.</p>\n\n<p>I want to use CustomContext in HTTPErrorHandler.</p>\n\n<pre><code>c.Error(echo.NewHTTPError(http.StatusUnauthorized, \"error\"))\n</code></pre>\n\n<p>is work well.</p>\n\n<p>but, panic <code>echo.Context is *echo.context, not *CustomContext</code> error when access not registered page.</p>\n\n<p>Why occurred panic error when access not found page?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 5, "last_activity_date": 1585171487, "last_edit_date": 1585171487, "creation_date": 1526916051, "answer_id": 50451913, "question_id": 50451865, "link": "https://stackoverflow.com/questions/50451865/returning-a-simple-json-response/50451913#50451913", "title": "Returning a simple JSON response", "body": "<p>For something that simple, you can just send a string:</p>\n\n<pre><code>w.Write([]byte(`{\"status\":\"OK\"}`))\n</code></pre>\n\n<p>But to answer your broader question, you need to define your object in Go notation. This can be as simple as:</p>\n\n<pre><code>json.NewEncoder(w).Encode(map[string]string{\"status\": \"OK\"})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1172, "user_id": 922457, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/56c9ee0dd7713d48f2ad2e50594a6d0c?s=128&d=identicon&r=PG", "display_name": "Edenshaw", "link": "https://stackoverflow.com/users/922457/edenshaw"}, "is_accepted": false, "score": 0, "last_activity_date": 1585155916, "creation_date": 1585155916, "answer_id": 60853769, "question_id": 50451865, "link": "https://stackoverflow.com/questions/50451865/returning-a-simple-json-response/60853769#60853769", "title": "Returning a simple JSON response", "body": "<p>Don't use Encode because it will return a base64 string, instead use this:</p>\n\n<pre><code>responseWriter.Header().Set(\"Content-Type\", \"application/json\")\nresponseWriter.WriteHeader(http.StatusOK)\njsonData := []byte(`{\"status\":\"OK\"}`)\nresponseWriter.Write(jsonData)\n</code></pre>\n\n<p>If you want to return a base64 string, use this then:</p>\n\n<pre><code>responseWriter.Header().Set(\"Content-Type\", \"application/json\")\nresponseWriter.WriteHeader(http.StatusOK)\njsonData := []byte(`{\"status\":\"OK\"}`)\njson.NewEncoder(responseWriter).Encode(jsonData)\n</code></pre>\n"}], "owner": {"reputation": 3038, "user_id": 7579156, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9e859f30bb49fd88ad3017b07d0ffb5d?s=128&d=identicon&r=PG&f=1", "display_name": "Harry Blue", "link": "https://stackoverflow.com/users/7579156/harry-blue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1644, "favorite_count": 0, "accepted_answer_id": 50451913, "answer_count": 2, "score": 1, "last_activity_date": 1585171514, "creation_date": 1526915922, "last_edit_date": 1585171514, "question_id": 50451865, "link": "https://stackoverflow.com/questions/50451865/returning-a-simple-json-response", "title": "Returning a simple JSON response", "body": "<p>I am currently moving an Express API over to a Golang implementation.</p>\n\n<p>In Express, if I want to return a simple, ad hoc json response I can do like</p>\n\n<pre><code>app.get('/status', (req, res) =&gt; res.json({status: 'OK'}))\n</code></pre>\n\n<p>However, I am struggling to understand this in Go.</p>\n\n<p>Do I need to create a struct for this simple response?</p>\n\n<p>I was trying something like this</p>\n\n<pre><code>func getStatus(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    json.NewEncoder(w).Encode({status: \"OK\"})\n}\n</code></pre>\n\n<p>but this is obviously not going to work.</p>\n"}, {"tags": ["go", "github"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1526915178, "post_id": 50451643, "comment_id": 87916380, "body": "Install the package with <code>go get</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1526915432, "post_id": 50451643, "comment_id": 87916505, "body": "<a href=\"https://golang.org/doc/articles/go_command.html\" rel=\"nofollow noreferrer\">golang.org/doc/articles/go_command.html</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1526915589, "post_id": 50451643, "comment_id": 87916578, "body": "<a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write go Code</a>"}, {"owner": {"reputation": 61, "user_id": 9524254, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Nnp5JPh1EnU/AAAAAAAAAAI/AAAAAAAAACE/SZyWOeKHPw4/photo.jpg?sz=128", "display_name": "Parth Rathod", "link": "https://stackoverflow.com/users/9524254/parth-rathod"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526967142, "post_id": 50451643, "comment_id": 87933900, "body": "@Flimzy, yes I have used Go Get"}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 9524254, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Nnp5JPh1EnU/AAAAAAAAAAI/AAAAAAAAACE/SZyWOeKHPw4/photo.jpg?sz=128", "display_name": "Parth Rathod", "link": "https://stackoverflow.com/users/9524254/parth-rathod"}, "edited": false, "score": 0, "creation_date": 1526963889, "post_id": 50451690, "comment_id": 87932899, "body": "Yes, I have taken care of this already. I have set GOROOT with &#39;C:\\Go\\&#39; I have also set GOPATH to the location where I have written my gocode. I have written my Gocode outside the &#39;C:\\Go\\&#39; folder at the location &#39;C:\\Users\\xyz\\src&#39; .  So the GOAPTH is set to the same value. But still it is showing the same error."}, {"owner": {"reputation": 61, "user_id": 9524254, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Nnp5JPh1EnU/AAAAAAAAAAI/AAAAAAAAACE/SZyWOeKHPw4/photo.jpg?sz=128", "display_name": "Parth Rathod", "link": "https://stackoverflow.com/users/9524254/parth-rathod"}, "edited": false, "score": 0, "creation_date": 1526964225, "post_id": 50451690, "comment_id": 87932995, "body": "The packages are installed properly inside the go folder at the location  &#39;C:\\Users\\xyz\\go\\src\\github.com&#39;."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user5283119"}, "is_accepted": false, "score": 0, "last_activity_date": 1526915304, "creation_date": 1526915304, "answer_id": 50451690, "question_id": 50451643, "link": "https://stackoverflow.com/questions/50451643/installing-external-packages-in-golang/50451690#50451690", "title": "Installing external packages in golang", "body": "<p>Ensure your <code>$GOPATH</code> environment variable is set up correctly.</p>\n\n<p>Then double check the packages are installed, if not you need to install the package which you can do with.</p>\n\n<p><code>go get github.com/mattbaird/jsonpatch</code></p>\n"}, {"comments": [{"owner": {"reputation": 61, "user_id": 9524254, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Nnp5JPh1EnU/AAAAAAAAAAI/AAAAAAAAACE/SZyWOeKHPw4/photo.jpg?sz=128", "display_name": "Parth Rathod", "link": "https://stackoverflow.com/users/9524254/parth-rathod"}, "edited": false, "score": 1, "creation_date": 1527159027, "post_id": 50506730, "comment_id": 88026845, "body": "Thanks a lot for clarifying this. Can you tell me how to access /opt/ folder"}, {"owner": {"reputation": 61, "user_id": 9524254, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Nnp5JPh1EnU/AAAAAAAAAAI/AAAAAAAAACE/SZyWOeKHPw4/photo.jpg?sz=128", "display_name": "Parth Rathod", "link": "https://stackoverflow.com/users/9524254/parth-rathod"}, "edited": false, "score": 0, "creation_date": 1527160601, "post_id": 50506730, "comment_id": 88027866, "body": "I&#39;am using windows system and I thought /usr/local/ is same as /opt/"}], "tags": [], "owner": {"reputation": 340, "user_id": 6464746, "user_type": "registered", "accept_rate": 22, "profile_image": "https://lh6.googleusercontent.com/-75L-hYPbdcQ/AAAAAAAAAAI/AAAAAAAAAKo/siHtIEA6B0g/photo.jpg?sz=128", "display_name": "Yash Goel", "link": "https://stackoverflow.com/users/6464746/yash-goel"}, "is_accepted": true, "score": 1, "last_activity_date": 1527156978, "creation_date": 1527156978, "answer_id": 50506730, "question_id": 50451643, "link": "https://stackoverflow.com/questions/50451643/installing-external-packages-in-golang/50506730#50506730", "title": "Installing external packages in golang", "body": "<p>Recheck your environment variables(<code>$GOPATH</code>, <code>$GOROOT</code>).</p>\n\n<p>The problem you are facing is that, your code is searching for the package <code>github.com/mattbaird/jsonpatch</code> in <code>/opt/go/src/github.com/</code>, <code>/chaincode/input/src/github.com/</code> and <code>/opt/gopath/src/github.com/</code> directories. But you have installed the package in <code>C:\\Users\\xyz\\go\\src\\github.com</code> directory.</p>\n"}], "owner": {"reputation": 61, "user_id": 9524254, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Nnp5JPh1EnU/AAAAAAAAAAI/AAAAAAAAACE/SZyWOeKHPw4/photo.jpg?sz=128", "display_name": "Parth Rathod", "link": "https://stackoverflow.com/users/9524254/parth-rathod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3332, "favorite_count": 0, "accepted_answer_id": 50506730, "answer_count": 2, "score": 1, "last_activity_date": 1527156978, "creation_date": 1526915144, "last_edit_date": 1526915156, "question_id": 50451643, "link": "https://stackoverflow.com/questions/50451643/installing-external-packages-in-golang", "title": "Installing external packages in golang", "body": "<p>I am trying to import a package in my golang code. But it is showing me this error:</p>\n\n<blockquote>\n  <p>cannot find package \"github.com/mattbaird/jsonpatch\" in any of:\n  /opt/go/src/github.com/mattbaird/jsonpatch (from $GOROOT)\n  /chaincode/input/src/github.com/mattbaird/jsonpatch (from $GOPATH)\n  /opt/gopath/src/github.com/mattbaird/jsonpatch \"</p>\n</blockquote>\n\n<p>Can somebody help me fix this?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 2, "last_activity_date": 1526915305, "creation_date": 1526915305, "answer_id": 50451692, "question_id": 50451609, "link": "https://stackoverflow.com/questions/50451609/unexpected-behavior-when-passing-a-pointer-to-a-slice-in-go/50451692#50451692", "title": "Unexpected behavior when passing a pointer to a slice in go", "body": "<p>You're passing around a pointer to the the same slice. In the end you wind up with a bunch of pointers to the same slice in your results, so of course all the values will be identical - it's the same slice printed over and over.</p>\n\n<p>It's also worth noting that a pointer to a slice is rarely what you want, as slices already contain a pointer to the underlying array.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9823642"}, "edited": false, "score": 1, "creation_date": 1526916836, "post_id": 50451931, "comment_id": 87917282, "body": "Thank you for your response. I&#39;m afraid, I am still a bit lost since *res = append(*res, s) does update the slice. No?"}, {"owner": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "edited": false, "score": 0, "creation_date": 1526918131, "post_id": 50451931, "comment_id": 87918025, "body": "I&#39;m editing the answer with a proposed refactor explaining a little bit"}, {"owner": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "edited": false, "score": 0, "creation_date": 1526920515, "post_id": 50451931, "comment_id": 87919270, "body": "@JF-Sebastian I just added a refactor, anyways I would recommend you read more about pointers and slices, since they are pretty tricky at the beginning. Generally you would use pointers with structs, and in some rare cases with maps."}], "tags": [], "owner": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "is_accepted": true, "score": 0, "last_activity_date": 1526920299, "last_edit_date": 1526920299, "creation_date": 1526916088, "answer_id": 50451931, "question_id": 50451609, "link": "https://stackoverflow.com/questions/50451609/unexpected-behavior-when-passing-a-pointer-to-a-slice-in-go/50451931#50451931", "title": "Unexpected behavior when passing a pointer to a slice in go", "body": "<p>There's no need for a pointer to the slice since slices are pointers themselves. \"a slice is a reference to a contiguous segment of an array.\", <a href=\"https://hackernoon.com/golang-slice-and-append-e18498cf924a\" rel=\"nofollow noreferrer\">reference</a>.</p>\n\n<p>The strange behavior you're seeing is because you're using append, when a slice grows beyond its capacity it's required to create a new slice with increased capacity and copy all the contents of the original one (this is what append does behind the scenes), hence new slice is no longer pointing to the original underlying array.</p>\n\n<p>Instead of modifying the incoming parameter, I suggest returning the slice as a return value for the function.</p>\n\n<pre><code>func permute(nums []int) [][]int {\n   res := permuteHlp(nums, 0, new([]int))\n   return res\n}\n</code></pre>\n\n<p>I recommend you read the blog post in golang.org about slices internals, <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">here</a></p>\n\n<hr>\n\n<p>Edit:</p>\n\n<p>I add a refactor, taking the algorithm from <a href=\"https://stackoverflow.com/a/30226442/5883716\">this answer</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"  \n)\n\nfunc permutations(arr []int)[][]int{\n    var helper func([]int, int)\n    res := [][]int{}\n\n    helper = func(arr []int, n int){\n        if n == 1{\n            tmp := make([]int, len(arr))\n            copy(tmp, arr)\n            res = append(res, tmp)\n        } else {\n            for i := 0; i &lt; n; i++{\n                helper(arr, n - 1)\n                if n % 2 == 1{\n                    tmp := arr[i]\n                    arr[i] = arr[n - 1]\n                    arr[n - 1] = tmp\n                } else {\n                    tmp := arr[0]\n                    arr[0] = arr[n - 1]\n                    arr[n - 1] = tmp\n                }\n            }\n        }\n    }\n    helper(arr, len(arr))\n    return res\n}\n\nfunc main() {\n    x := []int{1,2,3,4}\n    d := permutations(x)\n    fmt.Print(d)\n}\n</code></pre>\n\n<p>Generally you won't want to have a pointer to a slice, instead, return a new one from the function, another thing to comment on, try not to use recursion if possible as golang doesn't have tail call optimization, and its loops perform amazingly. Hope it helps!</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9823642"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 50451931, "answer_count": 2, "score": 1, "last_activity_date": 1526920299, "creation_date": 1526915048, "last_edit_date": 1526916135, "question_id": 50451609, "link": "https://stackoverflow.com/questions/50451609/unexpected-behavior-when-passing-a-pointer-to-a-slice-in-go", "title": "Unexpected behavior when passing a pointer to a slice in go", "body": "<p>The following go program is supposed to generate all permutations of a slice of integers:</p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc permute(nums []int) [][]int {\n    var res [][]int\n    var s []int\n    permuteHlp(&amp;res, nums, 0, s)\n    return res\n}\n\nfunc permuteHlp(res *[][]int, nums []int, i int, s []int) {\n    if i == len(nums) {\n        *res = append(*res, s)\n        return\n    }\n\n    for j := i; j &lt; len(nums); j++ {\n        s = append(s, nums[j])\n        nums[i], nums[j] = nums[j], nums[i]\n        permuteHlp(res, nums, i+1, s)\n        s = s[:len(s)-1]\n        nums[i], nums[j] = nums[j], nums[i]\n    }\n}\n\nfunc main() {\n    x := []int{1,2,3,4}\n    y := permute(x)\n\n    fmt.Println(y)\n}\n</code></pre>\n\n<p>The output is unexpected</p>\n\n<pre><code>[[1 2 4 3] [1 2 4 3] [1 3 4 2] [1 3 4 2] [1 4 2 3] [1 4 2 3] [2 1 4 3] [2 1 4 3] [2 3 4 1] [2 3 4 1] [2 4 1 3] [2 4 1 3] [3 2 4 1] [3 2 4 1] [3 1 4 2] [3 1 4 2] [3 4 2 1] [3 4 2 1] [4 2 1 3] [4 2 1 3] [4 3 1 2] [4 3 1 2] [4 1 2 3] [4 1 2 3]]\n</code></pre>\n\n<p>I don't understand what is wrong here. I would appreciate any help.\nThank you!</p>\n"}, {"tags": ["amazon-web-services", "unit-testing", "go", "mocking"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1526913576, "post_id": 50451159, "comment_id": 87915487, "body": "If you&#39;re truly constrained to not change the parameters, you&#39;ll have to mock it with a global variable placeholder. This is ugly for all the reasons global variables are ugly. If you can be a bit more flexible, by making <code>getAWSSecrets()</code> a method, rather than a function, for example, you&#39;ll have a lot more attractive options."}, {"owner": {"reputation": 4348, "user_id": 3435610, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IBOFX.jpg?s=128&g=1", "display_name": "Sara Tibbetts", "link": "https://stackoverflow.com/users/3435610/sara-tibbetts"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526914124, "post_id": 50451159, "comment_id": 87915800, "body": "@Flimzy do you think it would make more sense to just move the creation of the session and the Secrets Manager instance into the main function and to change the function to take the secrets manager in as a parameter like in the AWS example or to change the <code>getAWSSecrets()</code> function into a method?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1526914164, "post_id": 50451159, "comment_id": 87915826, "body": "If you have that flexibility, then you have the flexibility to change parameters, and thus do things right. :) What is your actual constraint that prompted you to say &quot;without changing parameters&quot;?"}, {"owner": {"reputation": 4348, "user_id": 3435610, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IBOFX.jpg?s=128&g=1", "display_name": "Sara Tibbetts", "link": "https://stackoverflow.com/users/3435610/sara-tibbetts"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526914338, "post_id": 50451159, "comment_id": 87915936, "body": "@Flimzy I can change the parameters if that&#39;s the best way to do it, it just seemed to make sense to have all the code related to the Secrets Manager wrapped in the <code>getAWSSecrets()</code> function."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1526920010, "post_id": 50451159, "comment_id": 87919024, "body": "Refactoring the function to accept a <code>SecretsManagerAPI</code> argument would hands down be the easiest way to make this mockable.  Since that&#39;s an interface type, mocking it out becomes trivial, and the returned struct from <code>secretsmanager.New()</code> fulfills that interface, so you can pass it into the refactored version of <code>getAWSSecrets()</code> without modification for production usage."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1526921213, "post_id": 50451159, "comment_id": 87919624, "body": "In cases where you really cannot change the api of a func you could take an approach like this one: <a href=\"https://github.com/golang/go/search?utf8=%E2%9C%93&amp;q=testHookServerServe&amp;type=\" rel=\"nofollow noreferrer\">github.com/golang/go/&hellip;</a> but in the general case, as the other commenters pointed out, just introduce a parameter or make the func a method."}], "answers": [{"tags": [], "owner": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "is_accepted": true, "score": 2, "last_activity_date": 1526927889, "last_edit_date": 1526927889, "creation_date": 1526927396, "answer_id": 50454670, "question_id": 50451159, "link": "https://stackoverflow.com/questions/50451159/is-it-possible-to-unit-test-this-go-function-that-uses-the-aws-sdk-without-chang/50454670#50454670", "title": "Is it possible to unit test this Go function that uses the AWS SDK without changing the parameters?", "body": "<p>As the comments say, make the function call a method, and take advantage of the interface AWS is providing.</p>\n\n<p>I would create a service, like this one:</p>\n\n<pre><code>package service\n\ntype SecretService struct {\n    AwsProvider aws.SecretsManagerAPI\n}\n\nfunc NewSecretService() (*SecretService, err) {\n    // Create new AWS session in order to get db info from SecretsManager\n    sess, err := session.NewSession()\n    if err != nil {\n        return nil, err\n    }\n\n    return &amp;SecretService{\n        AwsProvider: secretsmanager.New(sess),\n    }, nil\n}\n\nfunc (s *SecretService) GetAWSSecrets() {\n    req, resp := s.AwsProvider.GetSecretValueRequest(&amp;secretsmanager.GetSecretValueInput{\n        SecretId: aws.String(\"my/secret/string\"),\n    })\n\n    err = req.Send()\n    if err != nil {\n        return nil, err\n    }\n\n    // More magic below ...\n}\n</code></pre>\n\n<p>That way in the tests, I could pass any mock into SecretService, like this:</p>\n\n<pre><code>func TestSecretService_GetAWSSecrets(t *testing.T) {\n  service := &amp;service.SecretService{\n    AwsProvider: &lt;use your mock here&gt;\n  }\n}\n</code></pre>\n\n<p>One caveat, I guess is that the mock has to implement all methods of SecretsManagerAPI, which I think it's a lot of work for this simple scenario... in any case you can create your own interface inside the service package with only the subset of methods you'll use, let's say you're only going to use <code>GetSecretValueRequest</code>, and <code>CreateSecret</code>:</p>\n\n<pre><code>package service\n\ntype SecretProvider interface {\n    CreateSecret(*secretsmanager.CreateSecretInput) (*secretsmanager.CreateSecretOutput, error)\n    GetSecretValueRequest(*secretsmanager.GetSecretValueInput) (*request.Request, *secretsmanager.GetSecretValueOutput)\n}\n</code></pre>\n\n<p>Change the service:</p>\n\n<pre><code>type SecretService struct {\n    AwsProvider SecretProvider\n}\n</code></pre>\n\n<p>Now your mock only has to implement SecretProvider interface methods only. And of course, AWS SecretsManager implicitly impleements SecretProvider.</p>\n"}], "owner": {"reputation": 4348, "user_id": 3435610, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IBOFX.jpg?s=128&g=1", "display_name": "Sara Tibbetts", "link": "https://stackoverflow.com/users/3435610/sara-tibbetts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1469, "favorite_count": 0, "accepted_answer_id": 50454670, "answer_count": 1, "score": 2, "last_activity_date": 1526927889, "creation_date": 1526913397, "question_id": 50451159, "link": "https://stackoverflow.com/questions/50451159/is-it-possible-to-unit-test-this-go-function-that-uses-the-aws-sdk-without-chang", "title": "Is it possible to unit test this Go function that uses the AWS SDK without changing the parameters?", "body": "<p>I am new to Go and have written a function that uses the AWS Secrets Manager to fetch a secret: </p>\n\n<pre><code>//Helper function to get secret from AWS Secret Manager\nfunc getAWSSecrets() (secretMap map[string]string, err error) {\n    // Create new AWS session in order to get db info from SecretsManager\n    sess, err := session.NewSession()\n    if err != nil {\n        return nil, err\n    }\n\n    // Create a new instance of the SecretsManager client with session\n    svc := secretsmanager.New(sess)\n\n    //Get secret config values\n    req, resp := svc.GetSecretValueRequest(&amp;secretsmanager.GetSecretValueInput{\n        SecretId: aws.String(\"my/secret/string\"),\n    })\n\n    err = req.Send()\n    if err != nil {\n        return nil, err\n    }\n\n    ...\n}\n</code></pre>\n\n<p>I need to create a unit test for the function, and to do so I need to mock the AWS Secrets Manager.  I discovered a <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/secretsmanager/secretsmanageriface/\" rel=\"nofollow noreferrer\">Secrets Manager Interface that AWS was created to help with unit testing</a>.  In the example displayed, the AWS Secrets Manager is passed into the function being tested, making it easy to pass in the mock service.  Is this the only way to successfully unit test the function?  Or can the service be mocked in the function I have above? </p>\n"}, {"tags": ["go", "mux"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 3, "creation_date": 1526911131, "post_id": 50450518, "comment_id": 87914088, "body": "Your shell is interpreting the <code>&amp;</code> as your intention to fork the curl command to the background.  Wrap your URL in quotes to see the desired output."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1526911194, "post_id": 50450518, "comment_id": 87914125, "body": "Try wrapping your URL in single quotes when you run it in shell."}, {"owner": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "edited": false, "score": 0, "creation_date": 1526911279, "post_id": 50450518, "comment_id": 87914179, "body": "thanks it works :) not go related after all"}, {"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 0, "creation_date": 1576069880, "post_id": 50450518, "comment_id": 104778337, "body": "this is realed to  GET http method, not POST"}], "answers": [{"comments": [{"owner": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "edited": false, "score": 0, "creation_date": 1526915229, "post_id": 50451497, "comment_id": 87916404, "body": "Thanks. This was exactly what the guys in the comments said. Marking as accepted answer."}], "tags": [], "owner": {"reputation": 12147, "user_id": 4378400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wsSe.jpg?s=128&g=1", "display_name": "Yury Fedorov", "link": "https://stackoverflow.com/users/4378400/yury-fedorov"}, "is_accepted": true, "score": 1, "last_activity_date": 1526914661, "creation_date": 1526914661, "answer_id": 50451497, "question_id": 50450518, "link": "https://stackoverflow.com/questions/50450518/mux-handler-not-receiving-all-the-query-parameters-passed-from-curl-post/50451497#50451497", "title": "Mux handler not receiving all the query parameters passed from curl post", "body": "<p>The URL <code>http://localhost:8080/resize?width=100&amp;height=100</code> contains a special character <code>&amp;</code> that has <a href=\"http://bashitout.com/2013/05/18/Ampersands-on-the-command-line.html\" rel=\"nofollow noreferrer\">another meaning</a> to shell. </p>\n\n<p>In order to use ampersand (<code>&amp;</code>) as an actual character inside the URL, you need to put the URL in quotes: <strong>\"</strong><code>http://localhost:8080/resize?width=100&amp;height=100</code><strong>\"</strong></p>\n"}], "owner": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1144, "favorite_count": 0, "accepted_answer_id": 50451497, "answer_count": 1, "score": 1, "last_activity_date": 1526914713, "creation_date": 1526911036, "last_edit_date": 1526914713, "question_id": 50450518, "link": "https://stackoverflow.com/questions/50450518/mux-handler-not-receiving-all-the-query-parameters-passed-from-curl-post", "title": "Mux handler not receiving all the query parameters passed from curl post", "body": "<p>I am not able to receive all the query parameters using Mux. Only the first part is received</p>\n\n<pre><code>func main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/resize\", resizeImageFromPayload).Methods(\"POST\")\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n\nfunc resizeImageFromPayload(w http.ResponseWriter, r *http.Request) {\n    widthParameter := r.URL.Query().Get(\"width\")\n    heightParameter := r.URL.Query().Get(\"height\")\n    fmt.Println(r.URL.String())\n    fmt.Println(widthParameter)\n    fmt.Println(heightParameter)\n   //More code..\n}\n</code></pre>\n\n<p>When I call the api using curl <code>curl -XPOST http://localhost:8080/resize?width=100&amp;height=100 -o img_resize.png -F \"file=@snap1.png\"</code> This is what it prints:</p>\n\n<pre><code>/resize?width=100\n100\n</code></pre>\n\n<p>it seems like it omitted the &amp;height=100 part. Any idea ?</p>\n\n<p>Thanks in advance. </p>\n"}, {"tags": ["go", "visual-studio-code", "glide-golang"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526910887, "post_id": 50450452, "comment_id": 87913949, "body": "Where are your project code and the vendor directory located?"}, {"owner": {"reputation": 143, "user_id": 1885122, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67654cfb9cd17b795ec81d5748c5024d?s=128&d=identicon&r=PG", "display_name": "Martin Flower", "link": "https://stackoverflow.com/users/1885122/martin-flower"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526915249, "post_id": 50450452, "comment_id": 87916414, "body": "<code>&#47;Users&#47;martin&#47;go&#47;src&#47;xxxdc.visualstudio.com&#47;enlightcentre&#47;re&zwnj;&#8203;ports&#47;backend</code>"}, {"owner": {"reputation": 143, "user_id": 1885122, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67654cfb9cd17b795ec81d5748c5024d?s=128&d=identicon&r=PG", "display_name": "Martin Flower", "link": "https://stackoverflow.com/users/1885122/martin-flower"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526915310, "post_id": 50450452, "comment_id": 87916442, "body": "<code>&#47;Users&#47;martin&#47;go&#47;src&#47;xxxdc.visualstudio.com&#47;enlightcentre&#47;re&zwnj;&#8203;ports&#47;backend&#47;vendor&zwnj;&#8203;&#47;github.com&#47;xxx&#47;go-u&zwnj;&#8203;tility</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526915533, "post_id": 50450452, "comment_id": 87916555, "body": "That looks correct at first glance, are you sure there&#39;s no symlinks in that path? (you can quickly check from the project directory with <code>pwd -P</code>, which should match the paths above exactly)?"}, {"owner": {"reputation": 143, "user_id": 1885122, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67654cfb9cd17b795ec81d5748c5024d?s=128&d=identicon&r=PG", "display_name": "Martin Flower", "link": "https://stackoverflow.com/users/1885122/martin-flower"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526916361, "post_id": 50450452, "comment_id": 87917014, "body": "yes, there are symlinks in the path"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526916518, "post_id": 50450452, "comment_id": 87917109, "body": "You can&#39;t have symlinks in your GOPATH. It seems that Go is resolving the package location, sees it&#39;s not in the workspace, so it doesn&#39;t look for a vendor directory."}, {"owner": {"reputation": 143, "user_id": 1885122, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67654cfb9cd17b795ec81d5748c5024d?s=128&d=identicon&r=PG", "display_name": "Martin Flower", "link": "https://stackoverflow.com/users/1885122/martin-flower"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526916929, "post_id": 50450452, "comment_id": 87917342, "body": "I have just deleted the symlink and copied over all the files so the directory paths are now symlink-free. The project builds continues to build successfully from the command line. Visual Studio Code continues to report exactly the same problem."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526917189, "post_id": 50450452, "comment_id": 87917467, "body": "Does it build correctly when you use the package name, i.e. <code>go build xxxdc.visualstudio.com&#47;enlightcentre&#47;reports&#47;backend</code>? I&#39;m not sure what&#39;s different in your VSC setup, but the lack of checking for a vendor path means that it&#39;s not seeing the package directory as being properly located under GOPATH."}, {"owner": {"reputation": 143, "user_id": 1885122, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67654cfb9cd17b795ec81d5748c5024d?s=128&d=identicon&r=PG", "display_name": "Martin Flower", "link": "https://stackoverflow.com/users/1885122/martin-flower"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526917522, "post_id": 50450452, "comment_id": 87917655, "body": "pwd <code>&#47;Users&#47;martin&#47;go&#47;src&#47;xxxdc.visualstudio.com&#47;enlightcentre&#47;re&zwnj;&#8203;ports&#47;backend&#47;cmd&#47;co&zwnj;&#8203;mpliance&#47;getnoncompl&zwnj;&#8203;iantassets</code>"}, {"owner": {"reputation": 143, "user_id": 1885122, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67654cfb9cd17b795ec81d5748c5024d?s=128&d=identicon&r=PG", "display_name": "Martin Flower", "link": "https://stackoverflow.com/users/1885122/martin-flower"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526917548, "post_id": 50450452, "comment_id": 87917674, "body": "<code>go build xxxdc.visualstudio.com&#47;enlightcentre&#47;reports&#47;backend&#47;cmd&#47;com&zwnj;&#8203;pliance&#47;getnoncompli&zwnj;&#8203;antassets</code>"}, {"owner": {"reputation": 143, "user_id": 1885122, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67654cfb9cd17b795ec81d5748c5024d?s=128&d=identicon&r=PG", "display_name": "Martin Flower", "link": "https://stackoverflow.com/users/1885122/martin-flower"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526917758, "post_id": 50450452, "comment_id": 87917802, "body": "I note that in Visual Studio Code, the vendor directory is slightly darker - suggesting that it maybe should not be considered in the same way as the other source directories. I expect this is expected behaviour."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526918039, "post_id": 50450452, "comment_id": 87917964, "body": "How VSC highlights the directory could be from any plugin, e.g. git has changes in that path. I don&#39;t use VSC, but just started it up and no <code>vendor&#47;</code> directories are shaded any differently."}, {"owner": {"reputation": 143, "user_id": 1885122, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67654cfb9cd17b795ec81d5748c5024d?s=128&d=identicon&r=PG", "display_name": "Martin Flower", "link": "https://stackoverflow.com/users/1885122/martin-flower"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1526927994, "post_id": 50450452, "comment_id": 87922941, "body": "I&#39;ve just gone through these steps with a clean project (Hello World), and Visual Studio Code successfully finds the vendor dependencies, and the vendor directory is the same colour as the other directories. I have now deleted <code>vendor</code> from reports/.gitignore, and the VS Code error has now disappeared."}], "answers": [{"tags": [], "owner": {"reputation": 143, "user_id": 1885122, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67654cfb9cd17b795ec81d5748c5024d?s=128&d=identicon&r=PG", "display_name": "Martin Flower", "link": "https://stackoverflow.com/users/1885122/martin-flower"}, "is_accepted": false, "score": 2, "last_activity_date": 1528042333, "creation_date": 1528042333, "answer_id": 50668398, "question_id": 50450452, "link": "https://stackoverflow.com/questions/50450452/cannot-find-vendored-package-in-vs-code/50668398#50668398", "title": "Cannot find vendored package in VS Code", "body": "<p>As reported on vscode-go github issue <a href=\"https://github.com/Microsoft/vscode-go/issues/1587\" rel=\"nofollow noreferrer\">1587</a> my solution was to add the following to user settings (Code > Preferences > Settings)</p>\n\n<pre><code>{ \"search.useIgnoreFiles\": false }\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 1885122, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67654cfb9cd17b795ec81d5748c5024d?s=128&d=identicon&r=PG", "display_name": "Martin Flower", "link": "https://stackoverflow.com/users/1885122/martin-flower"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3987, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1553441133, "creation_date": 1526910816, "last_edit_date": 1553441133, "question_id": 50450452, "link": "https://stackoverflow.com/questions/50450452/cannot-find-vendored-package-in-vs-code", "title": "Cannot find vendored package in VS Code", "body": "<p>Using go go1.10.2 darwin/amd64 together with glide 0.13.1. Dependencies are in the vendor directory. There is no error building from the command line. When viewing the code in VS Code, the following error is displayed:</p>\n\n<blockquote>\n  <p>Cannot find package \"github.com/xxx/go-utility/log\" in any of:</p>\n  \n  <blockquote>\n    <p>/usr/local/Cellar/go/1.10.2/libexec/src/github.com/xxx/go-utility/log (from $GOROOT)\n       /Users/martin/go/src/github.com/xxx/go-utility/log (from $GOPATH)</p>\n  </blockquote>\n</blockquote>\n\n<p>Both the terminal and the VS Console report \n    GOPATH=\"/Users/martin/go\"</p>\n\n<p>I expect that I can make the message go away if I issue a go get, but this defeats the purpose of the vendor directory.</p>\n\n<p>This is a new installation on a new computer.</p>\n\n<p>What configuration have I forgotten?</p>\n"}, {"tags": ["json", "go", "interface"], "comments": [{"owner": {"reputation": 23, "user_id": 8541835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2794397cbe369b103c2d9a2a12da435?s=128&d=identicon&r=PG", "display_name": "Dumkin", "link": "https://stackoverflow.com/users/8541835/dumkin"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526903719, "post_id": 50448259, "comment_id": 87909934, "body": "@Flimzy as? if I have an array of different entities (int/object/string)"}, {"owner": {"reputation": 685, "user_id": 7047363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a4cda8321abd1a553445a95258babb?s=128&d=identicon&r=PG&f=1", "display_name": "muthukumar selvaraj", "link": "https://stackoverflow.com/users/7047363/muthukumar-selvaraj"}, "edited": false, "score": 0, "creation_date": 1528985187, "post_id": 50448259, "comment_id": 88721453, "body": "did you want to convert your <code>json format</code> to the <code>struct</code> data model"}], "answers": [{"tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": true, "score": 0, "last_activity_date": 1526904389, "creation_date": 1526904389, "answer_id": 50448555, "question_id": 50448259, "link": "https://stackoverflow.com/questions/50448259/one-of-the-elements-of-the-array-as-an-object/50448555#50448555", "title": "One of the elements of the array as an object", "body": "<p>It's simple: it is a <code>map[string]interface{}</code> hence</p>\n\n<pre><code>m, ok := testvar.Cd[0][6].(map[string]interface{})\n\nfmt.Println(m, ok, m[\"from\"])\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/XJGs_HsxMfZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/XJGs_HsxMfZ</a></p>\n"}], "owner": {"reputation": 23, "user_id": 8541835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2794397cbe369b103c2d9a2a12da435?s=128&d=identicon&r=PG", "display_name": "Dumkin", "link": "https://stackoverflow.com/users/8541835/dumkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 1, "accepted_answer_id": 50448555, "answer_count": 1, "score": 1, "last_activity_date": 1526904389, "creation_date": 1526903408, "question_id": 50448259, "link": "https://stackoverflow.com/questions/50448259/one-of-the-elements-of-the-array-as-an-object", "title": "One of the elements of the array as an object", "body": "<p>The question is how to get the \"from\" element? The rest is not a problem</p>\n\n<p>I know that in <a href=\"https://github.com/json-iterator/\" rel=\"nofollow noreferrer\">https://github.com/json-iterator/</a> it can be done, but I could not figure out how it works there</p>\n\n<p>Json:</p>\n\n<pre><code>{\n  \"ab\": 123456789,\n  \"cd\": [\n    [\n      4,\n      1234,\n      123456,\n      1000000001,\n      1234567890,\n      \"text\",\n      {\n        \"from\": \"123456\"\n      }\n    ],\n    [\n      4,\n      4321,\n      654321,\n      1000000001,\n      9876543210,\n      \"text\",\n      {\n        \"from\": \"654321\"\n      }\n    ]\n  ]\n}\n</code></pre>\n\n<p>Golang:</p>\n\n<pre><code>type test struct {\n    Ab int             `json:\"ab\"`\n    Cd [][]interface{} `json:\"cd\"`\n}\nvar testvar test\njson.Unmarshal(Data, &amp;testvar)\ntestvar.Cd[0][6][\"from\"].(string)\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>invalid operation: testvar.Cd[0][6][\"from\"] (type interface {} does not support indexing)\n</code></pre>\n"}, {"tags": ["go", "buffalo"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526903269, "post_id": 50447799, "comment_id": 87909696, "body": "Can you explain exactly what you&#39;re looking for? I suspect many (such as myself) don&#39;t know what Play framework is, so won&#39;t be able to provide an answer based on your current description."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1526909294, "post_id": 50447799, "comment_id": 87913015, "body": "Buffalo&#39;s router is a wrapper over gorilla/mux, but AFAIK it doesn&#39;t expose gorilla/mux&#39;s reverse routing functionality."}, {"owner": {"reputation": 165, "user_id": 647082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c31391c86295ddb1c12296ba7dcb1ad1?s=128&d=identicon&r=PG", "display_name": "jumper", "link": "https://stackoverflow.com/users/647082/jumper"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1526929331, "post_id": 50447799, "comment_id": 87923533, "body": "Thanks @MichaelHampton, you pointed me in the right direction!"}], "answers": [{"comments": [{"owner": {"reputation": 165, "user_id": 647082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c31391c86295ddb1c12296ba7dcb1ad1?s=128&d=identicon&r=PG", "display_name": "jumper", "link": "https://stackoverflow.com/users/647082/jumper"}, "edited": false, "score": 0, "creation_date": 1526929308, "post_id": 50455078, "comment_id": 87923527, "body": "I will leave this open for now, maybe somebody else can give a better answer."}], "tags": [], "owner": {"reputation": 165, "user_id": 647082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c31391c86295ddb1c12296ba7dcb1ad1?s=128&d=identicon&r=PG", "display_name": "jumper", "link": "https://stackoverflow.com/users/647082/jumper"}, "is_accepted": false, "score": 1, "last_activity_date": 1526929280, "creation_date": 1526929280, "answer_id": 50455078, "question_id": 50447799, "link": "https://stackoverflow.com/questions/50447799/reverse-routing-in-buffalo/50455078#50455078", "title": "Reverse routing in buffalo", "body": "<p>In app.go use Name() to define a name for the route (as in mux). For example:</p>\n\n<pre><code>auth.GET(\"/{provider}\", bah).Name(\"login\")\n</code></pre>\n\n<p>buffalo will however append \"Path\" to it and make it available as</p>\n\n<pre><code>loginPath({key : value})\n</code></pre>\n\n<p>for example:</p>\n\n<pre><code>&lt;a href=\"&lt;%= loginPath({provider: \"github\"}) %&gt;\"&gt;login&lt;/a&gt;\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 647082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c31391c86295ddb1c12296ba7dcb1ad1?s=128&d=identicon&r=PG", "display_name": "jumper", "link": "https://stackoverflow.com/users/647082/jumper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1526929280, "creation_date": 1526901775, "last_edit_date": 1526902769, "question_id": 50447799, "link": "https://stackoverflow.com/questions/50447799/reverse-routing-in-buffalo", "title": "Reverse routing in buffalo", "body": "<p>Is there any possibility to use a reverse router, e.g. similiar to the Play framework? This would be helpful in order not to hardcode URLs outside the app.go.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 673, "user_id": 921051, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/09bf092eb87afa75958cdc6624bd5b54?s=128&d=identicon&r=PG", "display_name": "Steffen", "link": "https://stackoverflow.com/users/921051/steffen"}, "edited": false, "score": 0, "creation_date": 1526903471, "post_id": 50448046, "comment_id": 87909811, "body": "A classic RTFM... Thanks!"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 3, "last_activity_date": 1526902705, "creation_date": 1526902705, "answer_id": 50448046, "question_id": 50447575, "link": "https://stackoverflow.com/questions/50447575/serving-static-file-with-go-gives-an-404-error/50448046#50448046", "title": "Serving static file with Go gives an 404 error", "body": "<p>The Gorilla router differs from Go's, in that Gorilla will only match the exact URL given, and not just the URL prefix. This is explained in more detail in the <a href=\"https://github.com/gorilla/mux#static-files\" rel=\"nofollow noreferrer\">Gorilla documentation</a>, where it explains how <a href=\"https://godoc.org/github.com/gorilla/mux#Route.PathPrefix\" rel=\"nofollow noreferrer\"><code>PathPrefix</code></a> can be used for serving files:</p>\n\n<pre><code>r.PathPrefix(\"/static/\").\n    Handler(http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"./static\"))))\n</code></pre>\n"}], "owner": {"reputation": 673, "user_id": 921051, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/09bf092eb87afa75958cdc6624bd5b54?s=128&d=identicon&r=PG", "display_name": "Steffen", "link": "https://stackoverflow.com/users/921051/steffen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 569, "favorite_count": 0, "accepted_answer_id": 50448046, "answer_count": 1, "score": 2, "last_activity_date": 1526902705, "creation_date": 1526900991, "question_id": 50447575, "link": "https://stackoverflow.com/questions/50447575/serving-static-file-with-go-gives-an-404-error", "title": "Serving static file with Go gives an 404 error", "body": "<h2>Task:</h2>\n\n<p>I try to serve a static file with Golang.</p>\n\n<h2>Problem:</h2>\n\n<p>The directory content is shown, but the file in the directory is not found.</p>\n\n<h2>Project structure:</h2>\n\n<pre><code>projectdir/\n\n  |- main.go\n  |- static/\n    |- main.css\n  |- templates\n    |- index.tmpl \n</code></pre>\n\n<h2>Source snippets:</h2>\n\n<p>main.go</p>\n\n<pre><code>func serv() {\n    r := mux.NewRouter()\n\n    r.HandleFunc(\"/\", HomeHandler)\n    r.Handle(\"/static/\", http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"./static\"))))\n\nsrv := &amp;http.Server{\n    Handler:      r,\n    Addr:         \"127.0.0.1:8666\",\n    WriteTimeout: 15 * time.Second,\n    ReadTimeout:  15 * time.Second,\n}\n</code></pre>\n\n<h2>Problem description</h2>\n\n<p>If I start the program and point my browser to 127.0.0.1:8666/static/, the content of the directory <em>./static</em> is listed, i.e. <em>main.css</em></p>\n\n<p>If I click the file <em>main.css</em>, the server response is 404.</p>\n\n<h2>Question</h2>\n\n<p>What do I miss?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["go", "github"], "answers": [{"tags": [], "owner": {"reputation": 27950, "user_id": 111777, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/730df0227780e818df8ce1e19c9a6c48?s=128&d=identicon&r=PG", "display_name": "Edward Dale", "link": "https://stackoverflow.com/users/111777/edward-dale"}, "is_accepted": true, "score": 3, "last_activity_date": 1537039475, "creation_date": 1537039475, "answer_id": 52348102, "question_id": 50447491, "link": "https://stackoverflow.com/questions/50447491/what-is-a-github-apps-integration-id-in-ghinstallation/52348102#52348102", "title": "What is a GitHub App&#39;s Integration ID in ghinstallation?", "body": "<p>The GitHub App Integration ID is the ID of your GitHub App. You can find it in the \"About\" section in the \"General\" tab of your GitHub App.</p>\n"}], "owner": {"reputation": 8204, "user_id": 6279569, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d065bd31fb32bdf56a00b9c7a856b0d8?s=128&d=identicon&r=PG&f=1", "display_name": "choasia", "link": "https://stackoverflow.com/users/6279569/choasia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 489, "favorite_count": 0, "accepted_answer_id": 52348102, "answer_count": 1, "score": 1, "last_activity_date": 1537039475, "creation_date": 1526900685, "question_id": 50447491, "link": "https://stackoverflow.com/questions/50447491/what-is-a-github-apps-integration-id-in-ghinstallation", "title": "What is a GitHub App&#39;s Integration ID in ghinstallation?", "body": "<p>I am trying to create a GitHub App in Golang by using a library named <a href=\"https://github.com/bradleyfalzon/ghinstallation\" rel=\"nofollow noreferrer\">ghinstallation</a>. As the description showed below, Integration ID and Installation ID are required. </p>\n\n<pre><code>// Wrap the shared transport for use with the integration ID 1 authenticating with installation ID 99.\nitr, err := ghinstallation.NewKeyFromFile(tr, 1, 99, \"2016-10-19.private-key.pem\")\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>I think the Installation ID is exactly the ID appears in the URL(<code>https://github.com/settings/installations/:installation_id</code>). \nHowever, I've no idea what the Integration ID is.</p>\n"}, {"tags": ["angular", "go", "ionic-framework"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1526898246, "post_id": 50446632, "comment_id": 87906957, "body": "Is your frontend served by the Go server? If not you will have to set <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\" rel=\"nofollow noreferrer\">cross-origin headers</a>. If this is the problem your browser will also complain loudly in the JavaScript console."}, {"owner": {"reputation": 653, "user_id": 8036445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bb5ed1c3c2b3b03d10f179fb8f4078c?s=128&d=identicon&r=PG", "display_name": "Velusamy Venkatraman", "link": "https://stackoverflow.com/users/8036445/velusamy-venkatraman"}, "edited": false, "score": 0, "creation_date": 1526898421, "post_id": 50446632, "comment_id": 87907064, "body": "Enable cross origin on Go code, Or else Add it <code>&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;</code> in to your header"}, {"owner": {"reputation": 27, "user_id": 9822273, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/65mbV.jpg?s=128&g=1", "display_name": "ddhille", "link": "https://stackoverflow.com/users/9822273/ddhille"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1526899340, "post_id": 50446632, "comment_id": 87907560, "body": "@Peter My REST-API is standalone. The Ionic app is served with Ionic serve."}, {"owner": {"reputation": 27, "user_id": 9822273, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/65mbV.jpg?s=128&g=1", "display_name": "ddhille", "link": "https://stackoverflow.com/users/9822273/ddhille"}, "reply_to_user": {"reputation": 653, "user_id": 8036445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bb5ed1c3c2b3b03d10f179fb8f4078c?s=128&d=identicon&r=PG", "display_name": "Velusamy Venkatraman", "link": "https://stackoverflow.com/users/8036445/velusamy-venkatraman"}, "edited": false, "score": 0, "creation_date": 1526899422, "post_id": 50446632, "comment_id": 87907597, "body": "@VeluDhanesh This worked! I love you :) Thanks for sharing your knowledge!"}], "owner": {"reputation": 27, "user_id": 9822273, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/65mbV.jpg?s=128&g=1", "display_name": "ddhille", "link": "https://stackoverflow.com/users/9822273/ddhille"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1526897778, "creation_date": 1526897778, "question_id": 50446632, "link": "https://stackoverflow.com/questions/50446632/which-headers-do-i-need-to-set-in-my-rest-api-response-to-get-my-simple-ionic-3", "title": "Which headers do i need to set in my REST-API response to get my simple Ionic 3 WebApp GET request working?", "body": "<p>I'm stuck in creating my first Ionic app.</p>\n\n<h2>Scenario:</h2>\n\n<ol>\n<li><p>Created a simple REST-API with Golang. It's working fine when i make the GET call in browser and / or Postman. The Output is:</p>\n\n<pre><code>[\n    {\n        \"id\": 1,\n        \"name\": \"Leanne Graham\"\n    },\n    {\n        \"id\": 100,\n        \"name\": \"I COME FROM YOUR OWN REST-API!!!\"\n    }\n]\n</code></pre></li>\n<li><p>I created a simple Ionic 3 (with Angular 5) web app based on some tutorials. I just wanted to diplay my test data in an ionic-list with ngFor. This is working fine with some static (hard-coded) data.</p></li>\n<li>I then switched from hard-coded data to a REST-API. The tutorial suggested me to use <code>http://jsonplaceholder.typicode.com/users</code>. This also worked fine; I was able to display the users' data (tried only with <code>id</code> and <code>name</code>) in my ionic-list.</li>\n<li>I then switched to my own REST-API. I took similar (a little less) JSON content like the one from <code>http://jsonplaceholder.typicode.com/users</code>. See above.</li>\n</ol>\n\n<h2>Problem:</h2>\n\n<p>My ionic-list stays empty after fetching data from my own REST-API but works with any other public API.</p>\n\n<h2>Thoughts:</h2>\n\n<ul>\n<li>Since the content of my REST-API response is nearly the same as the one from <code>http://jsonplaceholder.typicode.com/users</code> i guess there is something wrong in my api-response headers. No tutorial covers the header stuff. This is why I didn't set them. I tried different headers in my response like <code>w.Header().Set(\"content-type\", \"application/json\")</code> but this doesn't help.</li>\n<li>Are there general headers I always have to set when responding to a GET request from an Ionic app?</li>\n<li>When helpful I naturally will post my app's code here.</li>\n</ul>\n"}, {"tags": ["ubuntu", "go", "dep"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526903399, "post_id": 50446308, "comment_id": 87909767, "body": "If you can&#39;t provide an <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>, it&#39;s pretty unlikely we&#39;ll be able to help."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1526903430, "post_id": 50446308, "comment_id": 87909785, "body": "Also, it would be good to include the <i>actual</i> version numbers, since &quot;latest version&quot; could become obsolete quickly (perhaps within hours)."}, {"owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "edited": false, "score": 0, "creation_date": 1526903435, "post_id": 50446308, "comment_id": 87909787, "body": "You can try adding <code>-v</code> to <code>dep ensure</code> and maybe its output will help"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1532348074, "post_id": 50446308, "comment_id": 89925356, "body": "Try removing the vendor directory and run again <code>dep ensure</code>"}], "owner": {"reputation": 1, "user_id": 9822334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5d9e157d93f638457e52366011839a6?s=128&d=identicon&r=PG&f=1", "display_name": "Wouter Van Hecke", "link": "https://stackoverflow.com/users/9822334/wouter-van-hecke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 333, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1532347924, "creation_date": 1526896697, "last_edit_date": 1530190843, "question_id": 50446308, "link": "https://stackoverflow.com/questions/50446308/fresh-ubuntu-set-up-golang-dep-dep-ensure-doesnt-do-anything", "title": "Fresh ubuntu set-up Golang + dep, dep ensure doesn&#39;t do anything", "body": "<p>I'm having an annoying problem and I can't find what the problem is. I'm quite new to Ubuntu/Golang/dep but I'm trying to understand how it works.</p>\n\n<p>I have a source project, with the vendor files, when I run the command <code>dep ensure</code>, nothing happens, the cli just keeps running, no error message or any normal message, command is running for 30 minutes now and nothing happens.</p>\n\n<p>For specific reasons I can't share anything about the project itself. For all I know, the files of the projects shouldn't be the problem.</p>\n\n<p>The version of golang and dep are both the latest version.</p>\n\n<p>The path to the go bin and dep bin has been set in the <code>.profile</code>, together with the exportating of the GOPATH path.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 639, "user_id": 942236, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8fd79818fb74188fbd547baf5e2dabe0?s=128&d=identicon&r=PG", "display_name": "maxflow", "link": "https://stackoverflow.com/users/942236/maxflow"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526873987, "post_id": 50441555, "comment_id": 87897524, "body": "@ThunderCat done"}], "answers": [{"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 1, "last_activity_date": 1526876515, "last_edit_date": 1526876515, "creation_date": 1526875975, "answer_id": 50441912, "question_id": 50441555, "link": "https://stackoverflow.com/questions/50441555/add-slice-as-row-dynamically-to-2d-slice/50441912#50441912", "title": "Add slice as row dynamically to 2d slice", "body": "<p>You're adding all to the first row, and you need to add to the next row, see:<br>\nTry this (with minimum change to your code: made <code>count</code> a pointer):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    triangleNumber()\n}\nfunc triangleNumber() int {\n    sofar := []int{}\n    rest := []int{1, 2, 3, 4}\n    matrixSize := factorial(4) / (factorial(1) * factorial(3))\n    matrix := make([][]int, matrixSize)\n    count := 0\n    fmt.Println(matrixSize)\n    combinations(sofar, rest, 3, matrix, &amp;count)\n    fmt.Println(matrix)\n\n    return 0\n}\n\nfunc combinations(sofar []int, rest []int, n int, matrix [][]int, count *int) {\n    if n == 0 {\n        //Next two lines problematic\n        matrix[*count] = append(matrix[*count], sofar[0], sofar[1], sofar[2])\n        *count++\n        //  fmt.Println(count, sofar)\n    } else {\n        for i := range rest[:len(rest)] {\n            concat := sofar\n            concat = append(concat, rest[i])\n            combinations(concat, rest[i+1:], n-1, matrix, count)\n        }\n    }\n}\n\nfunc factorial(x uint) uint {\n    if x == 0 {\n        return 1\n    }\n    return x * factorial(x-1)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>4\n[[1 2 3] [1 2 4] [1 3 4] [2 3 4]]\n</code></pre>\n\n<hr>\n\n<p>Also for your special case, this works too:</p>\n\n<pre><code>matrix[*count] = []int{sofar[0], sofar[1], sofar[2]}\n</code></pre>\n\n<p>instead of:</p>\n\n<pre><code>matrix[*count] = append(matrix[*count], sofar[0], sofar[1], sofar[2])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": true, "score": 1, "last_activity_date": 1526880424, "last_edit_date": 1526880424, "creation_date": 1526876807, "answer_id": 50441999, "question_id": 50441555, "link": "https://stackoverflow.com/questions/50441555/add-slice-as-row-dynamically-to-2d-slice/50441999#50441999", "title": "Add slice as row dynamically to 2d slice", "body": "<p>Actually, there are a couple of things I note with your program:</p>\n\n<ol>\n<li>Append adds to the existing slice at its end (after length), so if you are using append for matrix, you need not allocate a slice of that size (see main in the code below)</li>\n<li>After you are adding elements to the matrix, it is simply being dumped in your current program. The <code>combinations</code> function needs to return it back so that when future elements (slice of ints) are added, they are actually all there.</li>\n</ol>\n\n<p>I've added some debugs and remodeled your program a bit, see if it makes sense:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    triangleNumber()\n}\nfunc combinations(sofar []int, rest []int, n int, matrix [][]int, count int) [][]int {\n    fmt.Println(\"Entered with matrix\", matrix)\n    if n == 0 {\n        fmt.Println(\"Entered with count\", count)\n        //Next two lines problematic\n        matrix = append(matrix, sofar)\n        count++\n        fmt.Println(sofar)\n        fmt.Println(\"Printing matrix\\n***\", matrix, \"\\n***\")\n        return matrix\n    } else {\n        for i := range rest[:len(rest)] {\n            concat := sofar\n            concat = append(concat, rest[i])\n            matrix = combinations(concat, rest[i+1:], n-1, matrix, count)\n            fmt.Println(\"Sending with count\", count)\n        }\n    }\n    return matrix\n}\n\nfunc factorial(x uint) uint {\n    if x == 0 {\n        return 1\n    }\n    return x * factorial(x-1)\n}\n\nfunc triangleNumber() int {\n    sofar := []int{}\n    rest := []int{1, 2, 3, 4}\n    matrixSize := factorial(4) / (factorial(1) * factorial(3))\n    matrix := make([][]int, 0)\n    count := 0\n    fmt.Println(matrixSize)\n    combinations(sofar, rest, 3, matrix, count)\n    return 0\n}\n</code></pre>\n\n<p>And as you can see, you can pretty much get rid of <code>count</code> too with this approach (look at the output). There's still some scope for improvement left though, but I guess this addresses what you were asking.</p>\n\n<p>On playground: <a href=\"https://play.golang.org/p/rnCdPcaIG3N\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rnCdPcaIG3N</a></p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 639, "user_id": 942236, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8fd79818fb74188fbd547baf5e2dabe0?s=128&d=identicon&r=PG", "display_name": "maxflow", "link": "https://stackoverflow.com/users/942236/maxflow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 50441999, "answer_count": 2, "score": 0, "last_activity_date": 1526880424, "creation_date": 1526872780, "last_edit_date": 1526873978, "question_id": 50441555, "link": "https://stackoverflow.com/questions/50441555/add-slice-as-row-dynamically-to-2d-slice", "title": "Add slice as row dynamically to 2d slice", "body": "<p>I'm trying to add the slice <code>sofar</code> to a new row in <code>matrix</code> after each iteration. </p>\n\n<pre><code>func combinations(sofar []int, rest []int, n int, matrix [][]int, count int) {\n    if n == 0 {\n        //Next two lines problematic\n        matrix[count] = append(matrix[count], sofar[0], sofar[1], sofar[2])\n        count++\n        fmt.Println(sofar)\n        } else {\n            for i := range rest[:len(rest)] {\n                concat := sofar\n                concat = append(concat, rest[i])\n                combinations(concat, rest[i+1:], n-1, matrix, count)\n            }\n        }\n}\n\nfunc factorial(x uint) uint {\n    if x == 0 {\n        return 1\n    }\n    return x * factorial(x-1)\n}\n</code></pre>\n\n<p>Driver program</p>\n\n<pre><code>func triangleNumber() int {\n    sofar := []int{}\n    rest := []int{1,2,3,4}\n    matrixSize := factorial(4)/(factorial(1)*factorial(3))\n    matrix := make([][]int, matrixSize)\n    count := 0 \n    fmt.Println(matrixSize)\n    combinations(sofar, rest, 3, matrix, count)\n    return 0\n}\n\ntriangleNumber()\n</code></pre>\n\n<p>I want <code>matrix</code> to be;</p>\n\n<pre><code>[1 2 3]\n[1 2 4]\n[1 3 4]\n[2 3 4]\n</code></pre>\n\n<p>But instead it's all going in the first row. Also is there a way I can get rid of <code>count</code>, and just add the slice <code>sofar</code> to the next row?</p>\n"}, {"tags": ["sql", "go", "ping"], "comments": [{"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1526888659, "post_id": 50441214, "comment_id": 87902039, "body": "what is your db driver ?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1526889107, "post_id": 50441214, "comment_id": 87902215, "body": "With <a href=\"https://golang.org/pkg/database/sql/#DB.PingContext\" rel=\"nofollow noreferrer\">PingContext</a> of course. Cancel the context to abort the ping early. Support for cancelation may not be supported by all drivers."}, {"owner": {"reputation": 313, "user_id": 8626433, "user_type": "registered", "profile_image": "https://graph.facebook.com/1276251982503903/picture?type=large", "display_name": "Damitha Dayananda", "link": "https://stackoverflow.com/users/8626433/damitha-dayananda"}, "edited": false, "score": 0, "creation_date": 1530619535, "post_id": 50441214, "comment_id": 89291479, "body": "actually no although context time expired PingContext also doesn&#39;t throw exception. it also try to build up connection about 2s"}], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 2, "last_activity_date": 1526886794, "creation_date": 1526886794, "answer_id": 50443715, "question_id": 50441214, "link": "https://stackoverflow.com/questions/50441214/golang-db-ping/50443715#50443715", "title": "golang db.ping()", "body": "<p>Really no, </p>\n\n<p>If you are waiting for a successful <code>ping</code> to happen before executing operations against the db then that's the price you have to pay!</p>\n\n<p>It entirely depends on which db, which library, what's the network like etc.</p>\n\n<p>From a top level, you could re-architect so that db healthchecks are not performed during user requests and then it won't really matter that the healthcheck is slow!</p>\n\n<p>Or a more aggressive approach would be to add timeouts. If you know that a success ping takes <code>20ms</code> then add a <code>40ms</code> or <code>50ms</code> timeout to the operation, and consider that to be a failure! Fail fast! </p>\n"}, {"tags": [], "owner": {"reputation": 313, "user_id": 8626433, "user_type": "registered", "profile_image": "https://graph.facebook.com/1276251982503903/picture?type=large", "display_name": "Damitha Dayananda", "link": "https://stackoverflow.com/users/8626433/damitha-dayananda"}, "is_accepted": false, "score": 0, "last_activity_date": 1568132820, "last_edit_date": 1568132820, "creation_date": 1530619402, "answer_id": 51154161, "question_id": 50441214, "link": "https://stackoverflow.com/questions/50441214/golang-db-ping/51154161#51154161", "title": "golang db.ping()", "body": "<p>I used <code>go-sql-driver/mysql</code> library: \n<a href=\"https://github.com/go-sql-driver/mysql\" rel=\"nofollow noreferrer\">https://github.com/go-sql-driver/mysql</a></p>\n\n<p>has this configuration options</p>\n\n<ul>\n<li>TimeOut</li>\n<li>ReadTimeOut</li>\n<li>WriteTimeOut</li>\n</ul>\n\n<p>by changing its values actually in my case <code>TimeOut</code>. I could reduce timeOut time to user defined time</p>\n"}], "owner": {"reputation": 313, "user_id": 8626433, "user_type": "registered", "profile_image": "https://graph.facebook.com/1276251982503903/picture?type=large", "display_name": "Damitha Dayananda", "link": "https://stackoverflow.com/users/8626433/damitha-dayananda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3002, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1568132820, "creation_date": 1526869600, "last_edit_date": 1526875302, "question_id": 50441214, "link": "https://stackoverflow.com/questions/50441214/golang-db-ping", "title": "golang db.ping()", "body": "<p><code>db.ping()</code> function takes about 2s to return a error if db gone offline while execution of programe. is there any way to reduce that time taken </p>\n"}, {"tags": ["html", "templates", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526872815, "post_id": 50441026, "comment_id": 87897326, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/50441026/show-parsed-html-string-from-database-to-template-using-golang\" title=\"show parsed html string from database to template using golang\">stackoverflow.com/questions/50441026/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 173, "user_id": 4557260, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IMnPjOPjOVc/AAAAAAAAAAI/AAAAAAAACak/Okt6PLeVim4/photo.jpg?sz=128", "display_name": "Arief Karfianto", "link": "https://stackoverflow.com/users/4557260/arief-karfianto"}, "is_accepted": true, "score": 0, "last_activity_date": 1526871194, "creation_date": 1526871194, "answer_id": 50441362, "question_id": 50441026, "link": "https://stackoverflow.com/questions/50441026/show-parsed-html-string-from-database-to-template-using-golang/50441362#50441362", "title": "Show parsed html string from database to template using Golang", "body": "<p>I just got the answer from another post I got after I post this question.\nHere's the post: <a href=\"https://stackoverflow.com/questions/18175630/go-template-executetemplate-include-html\">Go template.ExecuteTemplate include html</a></p>\n\n<p>All I need to change is from </p>\n\n<pre><code>type Criteria struct {\n    ...\n    CriteriaID      string        `db:\"criteria_id\"`\n    CriteriaName    string        `db:\"criteria_name\"`\n    ...\n</code></pre>\n\n<p>to </p>\n\n<pre><code>type Criteria struct {\n    ...\n    CriteriaID      string        `db:\"criteria_id\"`\n    CriteriaName    template.HTML `db:\"criteria_name\"`\n    ...\n</code></pre>\n\n<p>Hope this help someone having the same question.</p>\n"}], "owner": {"reputation": 173, "user_id": 4557260, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IMnPjOPjOVc/AAAAAAAAAAI/AAAAAAAACak/Okt6PLeVim4/photo.jpg?sz=128", "display_name": "Arief Karfianto", "link": "https://stackoverflow.com/users/4557260/arief-karfianto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 50441362, "answer_count": 1, "score": 0, "last_activity_date": 1526871194, "creation_date": 1526867563, "last_edit_date": 1526871046, "question_id": 50441026, "link": "https://stackoverflow.com/questions/50441026/show-parsed-html-string-from-database-to-template-using-golang", "title": "Show parsed html string from database to template using Golang", "body": "<p>Given my model</p>\n\n<pre><code>type Criteria struct {\n    ...\n    CriteriaID      string        `db:\"criteria_id\"`\n    CriteriaName    string        `db:\"criteria_name\"`\n    ...\n</code></pre>\n\n<p>and controller </p>\n\n<pre><code>func CriteriaReadGET(w http.ResponseWriter, r *http.Request) {\n\n    .....\n    // Display the view\n    v := view.New(r)\n    v.Name = \"criteria/read\"\n    v.Vars[\"criteria\"] = result\n    v.Render(w)\n}\n</code></pre>\n\n<p>One of the column in the result (query result from my model) contain html tags, which is generated from ckeditor or similar plugin. </p>\n\n<p>When I pass the output to my template, </p>\n\n<pre><code>{{.CriteriaName}}\n</code></pre>\n\n<p>it shows the html tags like</p>\n\n<pre><code>&lt;ul&gt;\n&lt;li&gt;One&lt;/li&gt;\n&lt;li&gt;Two&lt;/li&gt;\n&lt;/ul&gt;\n</code></pre>\n\n<p>How to show the content to looks like</p>\n\n<ul>\n<li>One </li>\n<li>Two</li>\n</ul>\n"}, {"tags": ["go", "search"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1526856760, "post_id": 50439231, "comment_id": 87894380, "body": "<a href=\"https://github.com/golang/tools/search?utf8=%E2%9C%93&amp;q=HandleSearch&amp;type=\" rel=\"nofollow noreferrer\">github.com/golang/tools/&hellip;</a> although the package is called godoc, this ought to be the source you want. (take a look at the templates in the /static folder of the package)."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526917376, "post_id": 50439231, "comment_id": 87917569, "body": "The question is cross posted at <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/kz_jsaepOlg\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/kz_jsaepOlg</a>"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1526849357, "creation_date": 1526849357, "question_id": 50439231, "link": "https://stackoverflow.com/questions/50439231/what-powers-search-on-golang-org", "title": "What powers search on golang.org?", "body": "<p>golang.org let\u2019s you search all stdlib go source code. </p>\n\n<p>For example, see <a href=\"https://golang.org/search?q=hello\" rel=\"nofollow noreferrer\">https://golang.org/search?q=hello</a> </p>\n\n<p>Where is the code that serves these search queries? If the code is not public, does it use a publicly available or at least publicly documented search engine?</p>\n\n<p><strong>I am not asking about <a href=\"https://godoc.org/?q=hello\" rel=\"nofollow noreferrer\">godoc.org search</a> which appears to be served from <a href=\"https://github.com/golang/gddo/search?utf8=%E2%9C%93&amp;q=appengine%20search&amp;type=\" rel=\"nofollow noreferrer\">appengine search</a>. godoc.org only indexes the name of the repo - not its content - whereas golang.org indexes all files in the go core libraries and runtime.</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1526847222, "post_id": 50438950, "comment_id": 87891996, "body": "&quot;Is the solution to simply always have a buffered channel in such cases?&quot; IIRC this is how <code>time.After</code> does it"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1526847353, "post_id": 50438950, "comment_id": 87892031, "body": "Ok that makes sense to me just wanted to sanity check"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1526849273, "post_id": 50438950, "comment_id": 87892535, "body": "To not block you can also put the send in a select statement with a default case. That only works if you know that receiver is ready at that time (or not interested anymore)."}, {"owner": {"reputation": 901, "user_id": 3615752, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/95f412691055035fad3a563e8b162dc4?s=128&d=identicon&r=PG&f=1", "display_name": "kamal", "link": "https://stackoverflow.com/users/3615752/kamal"}, "edited": false, "score": 0, "creation_date": 1526887456, "post_id": 50438950, "comment_id": 87901543, "body": "yes, it blocks - &quot;sending to a channel when no one receiving&quot;"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "is_accepted": true, "score": 0, "last_activity_date": 1526850250, "creation_date": 1526850250, "answer_id": 50439349, "question_id": 50438950, "link": "https://stackoverflow.com/questions/50438950/does-this-goroutine-leak-block-forever/50439349#50439349", "title": "Does this goroutine leak/block forever?", "body": "<p>To close this question out...the simple answer is yes.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 50439349, "answer_count": 1, "score": 1, "last_activity_date": 1526850250, "creation_date": 1526847006, "last_edit_date": 1526849003, "question_id": 50438950, "link": "https://stackoverflow.com/questions/50438950/does-this-goroutine-leak-block-forever", "title": "Does this goroutine leak/block forever?", "body": "<p>Was curious about the following behavior</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func test() error {\n        ctx, cancel := context.WithCancel(context.Background())\n        cancel()\n        doneChan := make(chan bool)\n        go func() {\n            // emulate a long running function\n            time.Sleep(time.Minute)\n            // never exits?\n            doneChan &lt;- true\n        }()\n        select {\n        case &lt;- ctx.Done():\n            return ctx.Err()\n        case &lt;- doneChan:\n            return nil\n        }\n}\n</code></pre>\n\n<p>Given the function above, if the <code>select</code> statement chooses the context cancellation is the goroutine trying to push onto the <code>doneChan</code> blocked forever? Is the solution to simply always have a buffered channel in such cases?</p>\n"}, {"tags": ["debugging", "go", "console-application", "goland"], "answers": [{"comments": [{"owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "edited": false, "score": 0, "creation_date": 1526927173, "post_id": 50453884, "comment_id": 87922503, "body": "This works nice. I had to run command <code>go get gops</code> to get the option to attach to a local process. Goland showed that option automatically after I tried to attach :) Still it would be nice to have an option to run this directly inside Goland. I will wait for other answers and if nothing better shows-up I will accept your answer. Thanks."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "edited": false, "score": 0, "creation_date": 1526927429, "post_id": 50453884, "comment_id": 87922633, "body": "The builtin terminal is not a PTY one, which means it won&#39;t work 100% as a real terminal, that&#39;s why there are no other alternatives for this. If I can replicate this and figure out a different way, I&#39;ll update the answer as mentioned."}, {"owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "edited": false, "score": 0, "creation_date": 1526930139, "post_id": 50453884, "comment_id": 87923867, "body": "Funny thing is that it runs inside the Goland&#39;s terminal, it just does not run inside the Goland&#39;s &quot;run console&quot;. I can manually start the app from the Goland&#39;s terminal and then attach to it."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "edited": false, "score": 0, "creation_date": 1526973493, "post_id": 50453884, "comment_id": 87936822, "body": "Can you please tell me a way to replicate this?"}, {"owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "edited": false, "score": 0, "creation_date": 1526981886, "post_id": 50453884, "comment_id": 87941983, "body": "Oh, I am sorry. I was so happy with your solution that then I got confused with my other attempts. I am just able to run the app inside the Goland&#39;s terminal but I am not able to attach to it :( Sorry."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "edited": false, "score": 0, "creation_date": 1526988697, "post_id": 50453884, "comment_id": 87946271, "body": "I&#39;m sorry, I don&#39;t really know what to make of this. Is this solved or not? If not, please open an issue at <a href=\"https://youtrack.jetbrains.com/issues/Go\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issues/Go</a> and I&#39;ll be happy to help. Provide a way to replicate this, with which steps I need to take, and eventually the code, if possible. Thank you."}, {"owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "edited": false, "score": 0, "creation_date": 1527016022, "post_id": 50453884, "comment_id": 87963211, "body": "I just tried it and it is possible to run a termui from Goland&#39;s terminal and attach it&#39;s debugger to it and step through code. Here is a screenshot from Windows 10 with a termui app paused at a breakpoint. <a href=\"https://www.dropbox.com/s/6gszx7dcm1pzxd7/goland_debug_termbox.png\" rel=\"nofollow noreferrer\">dropbox.com/s/6gszx7dcm1pzxd7/goland_debug_termbox.png</a>"}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 1, "last_activity_date": 1526923835, "creation_date": 1526923835, "answer_id": 50453884, "question_id": 50438543, "link": "https://stackoverflow.com/questions/50438543/run-termbox-go-app-in-golands-console/50453884#50453884", "title": "Run termbox-go app in GoLand&#39;s console", "body": "<p>I think the way to solve this is to build your executable with Go 1.10 or newer, compile it with the following flags: <code>-gcflags=\"all=-N -l\"</code> (these are very important and will allow the debugger to work a lot better, and then use the <code>Run | Attach to Local Process...</code> option from GoLand and attach to the local process. </p>\n\n<p>I'll see if I can replicate the bug and update this accordingly.</p>\n"}], "owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "accepted_answer_id": 50453884, "answer_count": 1, "score": 0, "last_activity_date": 1526923835, "creation_date": 1526843784, "question_id": 50438543, "link": "https://stackoverflow.com/questions/50438543/run-termbox-go-app-in-golands-console", "title": "Run termbox-go app in GoLand&#39;s console", "body": "<p>I want to create a Go app with a console UI using the termui library (which is built on top of the termbox-go library). I can build the app and run it from the command line, but it will not start inside the GoLand IDE (2018.1.3) on Windows 10.</p>\n\n<p>It fails during the termbox-go init when calling <code>syscall.Syscall</code> with <code>SetConsoleScreenBufferSize</code> parameter. The size for the screen buffer is 80x25. Error message is just \"The parameter is incorrect.\"</p>\n\n<p>How can I debug a termbox-go app in the GoLand or other IDE?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1526836038, "post_id": 50436786, "comment_id": 87888684, "body": "A Scanner buffers input.  Create a single scanner can call it multiple times to step through the lines. See <a href=\"https://godoc.org/bufio#example-Scanner--Lines\" rel=\"nofollow noreferrer\">the Scanner (lines) example</a> for a robust way to read from stdin."}, {"owner": {"reputation": 736, "user_id": 1223597, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4503cdbd311aaf863e4483deed05dbc2?s=128&d=identicon&r=PG", "display_name": "Joel V. Earnest-DeYoung", "link": "https://stackoverflow.com/users/1223597/joel-v-earnest-deyoung"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526843091, "post_id": 50436786, "comment_id": 87890765, "body": "@ThunderCat Yeah, I know that would work if all that was required was chugging though the input lines. The full program is interactive with different parts that can ask for user input as needed. Creating a new scanner each time user input is needed is a really easy way to handle this and works great with the terminal. It doesn&#39;t work, though, when users try to script their responses."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526843641, "post_id": 50436786, "comment_id": 87890934, "body": "Use a package-level variable for the scanner If you don&#39;t want to pass the scanner around through your code."}, {"owner": {"reputation": 736, "user_id": 1223597, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4503cdbd311aaf863e4483deed05dbc2?s=128&d=identicon&r=PG", "display_name": "Joel V. Earnest-DeYoung", "link": "https://stackoverflow.com/users/1223597/joel-v-earnest-deyoung"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526844372, "post_id": 50436786, "comment_id": 87891188, "body": "@ThunderCat I&#39;m not sure I can get the main author to accept a package-level variable. I&#39;ve added more background info."}, {"owner": {"reputation": 736, "user_id": 1223597, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4503cdbd311aaf863e4483deed05dbc2?s=128&d=identicon&r=PG", "display_name": "Joel V. Earnest-DeYoung", "link": "https://stackoverflow.com/users/1223597/joel-v-earnest-deyoung"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526847134, "post_id": 50436786, "comment_id": 87891980, "body": "@ThunderCat You&#39;re right: using <code>bufio.Scanner</code> which buffers input is the real problem. Is there a simple way to read a line of input without using buffers?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1526857233, "post_id": 50436786, "comment_id": 87894503, "body": "The alternative to buffered read is reading a byte a time. Read single bytes until \\n or some terminator is found and return the data up to that point."}], "answers": [{"comments": [{"owner": {"reputation": 736, "user_id": 1223597, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4503cdbd311aaf863e4483deed05dbc2?s=128&d=identicon&r=PG", "display_name": "Joel V. Earnest-DeYoung", "link": "https://stackoverflow.com/users/1223597/joel-v-earnest-deyoung"}, "edited": false, "score": 0, "creation_date": 1526846757, "post_id": 50438269, "comment_id": 87891873, "body": "I know there&#39;s only one stdin. If I run something like <code>seq -w 1 1000 | .&#47;main</code>, then I get <code>1: Text: 0001</code> <code>2: Text: 820</code> <code>3: Text:0003</code>. I guess the problem is that the first Scanner instance reads a large portion of stdin instead of just a single line."}, {"owner": {"reputation": 736, "user_id": 1223597, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4503cdbd311aaf863e4483deed05dbc2?s=128&d=identicon&r=PG", "display_name": "Joel V. Earnest-DeYoung", "link": "https://stackoverflow.com/users/1223597/joel-v-earnest-deyoung"}, "edited": false, "score": 0, "creation_date": 1526967602, "post_id": 50438269, "comment_id": 87934088, "body": "The technique you&#39;re suggesting - piping text into the Go application line-by-line with delays between the lines - is a really clever workaround to this problem with the <code>Scanner</code>. It has the drawback that users would need to script both the input they need <b>and</b> the timing that input needs to be provided (and timing will vary e.g. depending on what else is running on the same machine), but still in many cases it&#39;s a viable way to script input without fixing the application itself. Nice!"}], "tags": [], "owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "is_accepted": false, "score": 1, "last_activity_date": 1526859991, "last_edit_date": 1526859991, "creation_date": 1526841959, "answer_id": 50438269, "question_id": 50436786, "link": "https://stackoverflow.com/questions/50436786/how-to-read-from-os-stdin-repeatedly-without-shared-bufio-scanner/50438269#50438269", "title": "How to read from os.Stdin repeatedly without shared bufio.Scanner", "body": "<p>Your sequence is:</p>\n\n<ol>\n<li>create scanner</li>\n<li>wait read terminal</li>\n<li>print result</li>\n<li>repeat 1 to 3 (creating new scanner about stdin)</li>\n<li>repeat 2 to 3</li>\n<li>exit program</li>\n</ol>\n\n<p>When you exec echo in pipeline, only exists a stdin/stdout file being read/write, but you are trying to use two.</p>\n\n<p><strong>UPDATE:</strong> The flow of execution for echo is:</p>\n\n<ol>\n<li>read args</li>\n<li>process args</li>\n<li>write args in stdout</li>\n<li>terminal read stdout and print its</li>\n</ol>\n\n<p>See that this occur on press ENTER key. The argument whole is sent to echo program and not by line.</p>\n\n<blockquote>\n  <p>The echo utility writes its arguments to standard output, followed by\n  a . If there are no arguments, only the  is written.</p>\n</blockquote>\n\n<p>More here: <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/utilities/echo.html\" rel=\"nofollow noreferrer\">http://pubs.opengroup.org/onlinepubs/9699919799/utilities/echo.html</a>.</p>\n\n<p>See in <a href=\"https://git.savannah.gnu.org/cgit/coreutils.git/tree/src/echo.c\" rel=\"nofollow noreferrer\">source code</a> how echo work:</p>\n\n<pre><code>while (argc &gt; 0) \n{\n  fputs (argv[0], stdout);//&lt;-- send args to the same stdout\n  argc--;\n  argv++;\n  if (argc &gt; 0)\n    putchar (' ');\n}\n</code></pre>\n\n<p>So your code will work fine with this:</p>\n\n<pre><code>$ (n=1; while sleep 1; do echo a$n; n=$((n+1)); done) | ./print_stdin \n$ 1: Text=a1\n$ 2: Text=a2\n$ 3: Text=a3\n</code></pre>\n\n<p>If you need repeat args in differents stdout, use \"yes\" program or alternatives.\n<strong>yes</strong> program repeats the wrote args in stdout. More in:\n<a href=\"https://git.savannah.gnu.org/cgit/coreutils.git/tree/src/yes.c\" rel=\"nofollow noreferrer\">https://git.savannah.gnu.org/cgit/coreutils.git/tree/src/yes.c</a></p>\n\n<p>Example:</p>\n\n<pre><code>$ yes a | ./print_stdin \n$ 1: Text=a\n$ 2: Text=a\n$ 3: Text=a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 736, "user_id": 1223597, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4503cdbd311aaf863e4483deed05dbc2?s=128&d=identicon&r=PG", "display_name": "Joel V. Earnest-DeYoung", "link": "https://stackoverflow.com/users/1223597/joel-v-earnest-deyoung"}, "is_accepted": true, "score": 0, "last_activity_date": 1527012116, "creation_date": 1527012116, "answer_id": 50473882, "question_id": 50436786, "link": "https://stackoverflow.com/questions/50436786/how-to-read-from-os-stdin-repeatedly-without-shared-bufio-scanner/50473882#50473882", "title": "How to read from os.Stdin repeatedly without shared bufio.Scanner", "body": "<p>The suggestion in the <a href=\"https://stackoverflow.com/questions/50436786/how-to-read-from-os-stdin-repeatedly-without-shared-bufio-scanner#comment87894503_50436786\">comment</a> by <a href=\"http://stackoverflow.com/u/5728991\">ThunderCat</a> works.</p>\n\n<blockquote>\n  <p>The alternative to buffered read is reading a byte a time. Read single bytes until \\n or some terminator is found and return the data up to that point.</p>\n</blockquote>\n\n<p>Here's my implementation, heavily inspired by <a href=\"https://golang.org/pkg/bufio/#Scanner.Scan\" rel=\"nofollow noreferrer\">Scanner.Scan</a>:</p>\n\n<pre><code>package lineio\nimport (\n    \"errors\"\n    \"io\"\n)\n\nconst startBufSize = 4 * 1024\nconst maxBufSize = 64 * 1024\nconst maxConsecutiveEmptyReads = 100\n\nvar ErrTooLong = errors.New(\"lineio: line too long\")\n\nfunc ReadLine(r io.Reader) (string, error) {\n    lb := &amp;lineBuf {r:r, buf: make([]byte, startBufSize)}\n    for {\n        lb.ReadByte()\n        if lb.err != nil || lb.TrimCrlf() {\n            return lb.GetResult()\n        }\n    }\n}\n\ntype lineBuf struct {\n    r       io.Reader\n    buf     []byte\n    end     int\n    err     error\n}\n\nfunc (lb *lineBuf) ReadByte() {\n    if lb.EnsureBufSpace(); lb.err != nil {\n        return\n    }\n    for empties := 0; ; {\n        n := 0\n        if n, lb.err = lb.r.Read(lb.buf[lb.end:lb.end+1]); lb.err != nil {\n            return\n        }\n        if n &gt; 0 {\n            lb.end++\n            return\n        }\n        empties++\n        if empties &gt; maxConsecutiveEmptyReads {\n            lb.err = io.ErrNoProgress\n            return\n        }\n    }\n}\n\nfunc (lb *lineBuf) TrimCrlf() bool {\n    if !lb.EndsLf() {\n        return false\n    }\n    lb.end--\n    if lb.end &gt; 0 &amp;&amp; lb.buf[lb.end-1] == '\\r' {\n        lb.end--\n    }\n    return true\n}\n\nfunc (lb *lineBuf) GetResult() (string, error) {\n    if lb.err != nil &amp;&amp; lb.err != io.EOF {\n        return \"\", lb.err\n    }\n    return string(lb.buf[0:lb.end]), nil\n}\n\nfunc (lb *lineBuf) EndsLf() bool {\n    return lb.err == nil &amp;&amp; lb.end &gt; 0 &amp;&amp; (lb.buf[lb.end-1] == '\\n')\n}\n\nfunc (lb *lineBuf) EnsureBufSpace() {\n    if lb.end &lt; len(lb.buf) {\n        return\n    }\n    newSize := len(lb.buf) * 2\n    if newSize &gt; maxBufSize {\n        lb.err = ErrTooLong\n        return\n    }\n    newBuf := make([]byte, newSize)\n    copy(newBuf, lb.buf[0:lb.end])\n    lb.buf = newBuf\n    return\n}\n</code></pre>\n\n<hr>\n\n<h2>TESTING</h2>\n\n<p>Compiled lineio with <code>go install</code> and main (see below) with <code>go build -o read_each_byte</code>.</p>\n\n<p>Tested scripted input:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ seq 12 22 78 | ./read_each_byte\n1: Text: \"12\"\n2: Text: \"34\"\n3: Text: \"56\"\n</code></pre>\n\n<p>Tested input from an interactive terminal:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ ./read_each_byte\nabc\n1: Text: \"abc\"\n123\n2: Text: \"123\"\nx\\y\"z\n3: Text: \"x\\\\y\\\"z\"\n</code></pre>\n\n<p>Here's main:    </p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"lineio\"\n    \"os\"\n)\n\nfunc main() {\n    for i := 1; i &lt;= 3; i++ {\n        text, _ := lineio.ReadLine(os.Stdin)\n        fmt.Printf(\"%d: Text: %q\\n\", i, text)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 736, "user_id": 1223597, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4503cdbd311aaf863e4483deed05dbc2?s=128&d=identicon&r=PG", "display_name": "Joel V. Earnest-DeYoung", "link": "https://stackoverflow.com/users/1223597/joel-v-earnest-deyoung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 0, "accepted_answer_id": 50473882, "answer_count": 2, "score": 0, "last_activity_date": 1527012116, "creation_date": 1526832417, "last_edit_date": 1527004510, "question_id": 50436786, "link": "https://stackoverflow.com/questions/50436786/how-to-read-from-os-stdin-repeatedly-without-shared-bufio-scanner", "title": "How to read from os.Stdin repeatedly without shared bufio.Scanner", "body": "<p>In Go, can a single line of input be read from stdin in a simple way, which also meets the following requirements?</p>\n\n<ul>\n<li>can be called by disparate parts of a larger interactive application without having to create coupling between these different parts of the application (e.g. by passing a global <code>bufio.Scanner</code> between them)</li>\n<li>works whether users are running an interactive terminal or using pre-scripted input</li>\n</ul>\n\n<p>I'd like to modify an existing large Go application which currently creates a <code>bufio.Scanner</code> instance every time it asks users for a line of input. Multiple instances work fine when standard input is from a terminal, but when standard input is piped from another process, calls to <code>Scan</code> only succeed on the first instance of <code>bufio.Scanner</code>. Calls from all other instances fail.</p>\n\n<p>Here's some toy code that demonstrates the problem:</p>\n\n<pre><code>package main\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    // read with 1st scanner -&gt; works for both piped stdin and terminal\n    scanner1 := readStdinLine(1)\n    // read with 2nd scanner -&gt; fails for piped stdin, works for terminal\n    readStdinLine(2)\n    // read with 1st scanner -&gt; prints line 2 for piped stdin, line 3 for terminal\n    readLine(scanner1, 3)\n}\n\nfunc readStdinLine(lineNum int64) (scanner *bufio.Scanner) {\n    scanner = readLine(bufio.NewScanner(os.Stdin), lineNum)\n    return\n}\n\nfunc readLine(scannerIn *bufio.Scanner, lineNum int64) (scanner *bufio.Scanner) {\n    scanner = scannerIn\n    scanned := scanner.Scan()\n    fmt.Printf(\"%d: \", lineNum)\n    if scanned {\n        fmt.Printf(\"Text=%s\\n\", scanner.Text())\n        return\n    }\n    if scanErr := scanner.Err(); scanErr != nil {\n        fmt.Printf(\"Error=%s\\n\", scanErr)\n        return\n    }\n    fmt.Println(\"EOF\")\n    return\n}\n</code></pre>\n\n<p>I build this as <code>print_stdin</code>and run interactively from a bash shell:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>~$ ./print_stdin\nab\n1: Text=ab\ncd\n2: Text=cd\nef\n3: Text=ef\n</code></pre>\n\n<p>But if I pipe in the text, the second <code>bufio.Scanner</code> fails:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>~$ echo \"ab\n&gt; cd\n&gt; ef\" | ./print_stdin\n1: Text=ab\n2: EOF\n3: Text=cd\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1526829009, "post_id": 50436150, "comment_id": 87886542, "body": "See <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Passing_arguments_to_..._parameters</a>"}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1526829246, "post_id": 50436150, "comment_id": 87886631, "body": "See in playground: <a href=\"https://play.golang.org/p/YiwQhlHisE_K\" rel=\"nofollow noreferrer\">play.golang.org/p/YiwQhlHisE_K</a>"}, {"owner": {"reputation": 3391, "user_id": 194508, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d57afc217d360cd3aad3e2a8d4e5a0?s=128&d=identicon&r=PG", "display_name": "Ladislav Prskavec", "link": "https://stackoverflow.com/users/194508/ladislav-prskavec"}, "edited": false, "score": 0, "creation_date": 1526829647, "post_id": 50436150, "comment_id": 87886752, "body": "Thanks, found here too <a href=\"https://medium.com/golangspec/variadic-functions-in-go-13c33182b851\" rel=\"nofollow noreferrer\">medium.com/golangspec/variadic-functions-in-go-13c33182b851</a>"}], "owner": {"reputation": 3391, "user_id": 194508, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d57afc217d360cd3aad3e2a8d4e5a0?s=128&d=identicon&r=PG", "display_name": "Ladislav Prskavec", "link": "https://stackoverflow.com/users/194508/ladislav-prskavec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "closed_date": 1526829206, "answer_count": 0, "score": 0, "last_activity_date": 1526829697, "creation_date": 1526828576, "last_edit_date": 1526829697, "question_id": 50436150, "link": "https://stackoverflow.com/questions/50436150/how-to-make-type-for-variadic-function", "closed_reason": "Duplicate", "title": "How to make type for variadic function", "body": "<p>I have simple variardic function:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc test(names ...string) {\n  fmt.Println(names)\n}\n\nfunc main() {\n\n  test(\"11\", \"12\", \"13\")\n\n  // x := []string{\"a\", \"b\"}\n  // x := [\"xxx\", \"xxx22\"]\n  // test(x)\n}\n</code></pre>\n\n<p>I commented my experiments but still didn't find how make this working. Any ideas? </p>\n"}, {"tags": ["windows", "go", "swagger", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 9243463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/addb85f1464aaa0d1348dd9025ce1bb0?s=128&d=identicon&r=PG&f=1", "display_name": "dailygoing", "link": "https://stackoverflow.com/users/9243463/dailygoing"}, "is_accepted": false, "score": 0, "last_activity_date": 1537439858, "last_edit_date": 1537439858, "creation_date": 1537436301, "answer_id": 52422018, "question_id": 50436118, "link": "https://stackoverflow.com/questions/50436118/installing-swaggo-on-windows-swagger-gin/52422018#52422018", "title": "Installing swaggo on windows (swagger + gin)", "body": "<p>add $GOPATH/bin   to  PATH, for example:</p>\n\n<p>export PATH=$PATH:/Users/.../go/bin</p>\n"}, {"comments": [{"owner": {"reputation": 169, "user_id": 8559065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3b664a5fc00d478c41abda565c0dfd3?s=128&d=identicon&r=PG&f=1", "display_name": "etah jet", "link": "https://stackoverflow.com/users/8559065/etah-jet"}, "edited": false, "score": 0, "creation_date": 1598077210, "post_id": 63533106, "comment_id": 112345863, "body": "for more information go here <code>https:&#47;&#47;github.com&#47;swaggo&#47;http-swagger</code>"}, {"owner": {"reputation": 169, "user_id": 8559065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3b664a5fc00d478c41abda565c0dfd3?s=128&d=identicon&r=PG&f=1", "display_name": "etah jet", "link": "https://stackoverflow.com/users/8559065/etah-jet"}, "edited": false, "score": 0, "creation_date": 1598078049, "post_id": 63533106, "comment_id": 112346008, "body": "also with this  for gin-swagger <code>https:&#47;&#47;github.com&#47;swaggo&#47;gin-swagger</code>"}], "tags": [], "owner": {"reputation": 169, "user_id": 8559065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3b664a5fc00d478c41abda565c0dfd3?s=128&d=identicon&r=PG&f=1", "display_name": "etah jet", "link": "https://stackoverflow.com/users/8559065/etah-jet"}, "is_accepted": false, "score": 0, "last_activity_date": 1598076419, "creation_date": 1598076419, "answer_id": 63533106, "question_id": 50436118, "link": "https://stackoverflow.com/questions/50436118/installing-swaggo-on-windows-swagger-gin/63533106#63533106", "title": "Installing swaggo on windows (swagger + gin)", "body": "<p>first of all clear your cache</p>\n<pre><code>-go clean --modcache\n</code></pre>\n<p>how to install swagger in go</p>\n<pre><code>-https://libraries.io/go/github.com%2Fswaggo%2Fhttp-swagger\n</code></pre>\n<p>-go to your file path them install the following packages\n1-<code>go get github.com/swaggo/http-swagger</code>\n2-Download Swag for Go by using:</p>\n<pre><code>-go get github.com/swaggo/swag/cmd/swag\n</code></pre>\n<p>3-Run the Swag in your Go project root folder which contains main.go file, Swag will parse comments and generate required files(docs folder and docs/doc.go).</p>\n<pre><code>-swag init\n</code></pre>\n<p>4.Download http-swagger by using:</p>\n<pre><code>- go get -u github.com/swaggo/http-swagger\n</code></pre>\n<p>5-Run it, and browser to\n<code>-http://localhost:1323/swagger/index.html</code>, you can see Swagger 2.0 Api documents.</p>\n<p>And to know the path you are working on type</p>\n<pre><code>-go env\n</code></pre>\n<p>then look for <code>GOPATH=</code> there you will see your path</p>\n"}], "owner": {"reputation": 337, "user_id": 7194432, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rfFME_si650/AAAAAAAAAAI/AAAAAAAAAms/kiywFysMIjY/photo.jpg?sz=128", "display_name": "Bob Meijwaard", "link": "https://stackoverflow.com/users/7194432/bob-meijwaard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1221, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1598076419, "creation_date": 1526828389, "last_edit_date": 1597431522, "question_id": 50436118, "link": "https://stackoverflow.com/questions/50436118/installing-swaggo-on-windows-swagger-gin", "title": "Installing swaggo on windows (swagger + gin)", "body": "<p>I am trying to setup swagger for gin-gonic on windows. \nDocumentation of swaggo states that I should run:</p>\n\n<pre><code>go get -u github.com/swaggo/swag/cmd/swag\n</code></pre>\n\n<p>After installation I should be able to run <code>swag init</code> from within the root of my project where I have <code>main.go</code>, but the cmdlet states the following: </p>\n\n<pre><code>swag : The term 'swag' is not recognized as the name of a cmdlet, function, script file, or operable program. Check\nthe spelling of the name, or if a path was included, verify that the path is    correct and try again.\nAt line:1 char:1\n+ swag\n+ ~~~~\n+ CategoryInfo          : ObjectNotFound: (swag:String) [],  CommandNotFoundException\n+ FullyQualifiedErrorId : CommandNotFoundException\n</code></pre>\n\n<p>How can I add swag to PATH or how should I proceed from here?</p>\n\n<p>Ps, i followed documentation from <a href=\"https://github.com/swaggo/swag\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p><strong>Update</strong>: So I did a clean installation of Go on another PC, followed by <code>go get -u github.com/swaggo/swag/cmd/swag</code> and <code>swag</code> runs right of the bat. Earlier I followed <a href=\"https://revel.github.io/tutorial/gettingstarted.html\" rel=\"nofollow noreferrer\">this</a> tutorial and I might have accidentally messed up my <code>$GOPATH</code> on the original PC.</p>\n"}, {"tags": ["go", "kubernetes"], "comments": [{"owner": {"reputation": 163, "user_id": 4805558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92ca629ce65dd6fe18aaf2e96510fd9f?s=128&d=identicon&r=PG&f=1", "display_name": "pep8", "link": "https://stackoverflow.com/users/4805558/pep8"}, "edited": false, "score": 0, "creation_date": 1608726584, "post_id": 50435564, "comment_id": 115667054, "body": "I tried invoking this from a main() method:          firstConfig,<i>,</i> := GetKubeClient(&quot;first&quot;)  I&#39;ve a kubeconfig file with a context called first.  But I get this error: panic: runtime error: invalid memory address or nil pointer dereference [signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x12a7a9a]"}], "answers": [{"tags": [], "owner": {"reputation": 578, "user_id": 2618033, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100000332706842/picture?type=large", "display_name": "Ben Keil", "link": "https://stackoverflow.com/users/2618033/ben-keil"}, "is_accepted": false, "score": 1, "last_activity_date": 1526884034, "creation_date": 1526884034, "answer_id": 50443153, "question_id": 50435564, "link": "https://stackoverflow.com/questions/50435564/use-kubectl-context-in-kubernetes-client-go/50443153#50443153", "title": "Use kubectl context in kubernetes client-go", "body": "<p>Found the problem. The implementation of <code>github.com/imdario/mergo</code> changed in a newer version and breaks the actual behavior of generating the client config. So just only use revision <code>6633656539c1639d9d78127b7d47c622b5d7b6dc</code> like in the official kubernetes cient-go repository.</p>\n\n<p><a href=\"https://github.com/kubernetes/client-go/issues/415\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/client-go/issues/415</a></p>\n"}], "owner": {"reputation": 578, "user_id": 2618033, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100000332706842/picture?type=large", "display_name": "Ben Keil", "link": "https://stackoverflow.com/users/2618033/ben-keil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2654, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1526884034, "creation_date": 1526824605, "last_edit_date": 1526825391, "question_id": 50435564, "link": "https://stackoverflow.com/questions/50435564/use-kubectl-context-in-kubernetes-client-go", "title": "Use kubectl context in kubernetes client-go", "body": "<p>How can I use a normal context to configure the kubernetes client-go?</p>\n\n<pre><code>    package kube\n\n    import (\n        \"fmt\"\n\n        \"k8s.io/client-go/kubernetes\"\n        \"k8s.io/client-go/rest\"\n        \"k8s.io/client-go/tools/clientcmd\"\n    )\n\n    // GetKubeClient creates a Kubernetes config and client for a given kubeconfig context.\n    func GetKubeClient(context string) (*rest.Config, kubernetes.Interface, error) {\n        config, err := configForContext(context)\n        if err != nil {\n            return nil, nil, err\n        }\n        client, err := kubernetes.NewForConfig(config)\n        if err != nil {\n            return nil, nil, fmt.Errorf(\"could not get Kubernetes client: %s\", err)\n        }\n        return config, client, nil\n    }\n\n    // configForContext creates a Kubernetes REST client configuration for a given kubeconfig context.\n    func configForContext(context string) (*rest.Config, error) {\n        config, err := getConfig(context).ClientConfig()\n        if err != nil {\n            return nil, fmt.Errorf(\"could not get Kubernetes config for context %q: %s\", context, err)\n        }\n        return config, nil\n    }\n\n    // getConfig returns a Kubernetes client config for a given context.\n    func getConfig(context string) clientcmd.ClientConfig {\n        rules := clientcmd.NewDefaultClientConfigLoadingRules()\n        rules.DefaultClientConfig = &amp;clientcmd.DefaultClientConfig\n\n        overrides := &amp;clientcmd.ConfigOverrides{ClusterDefaults: clientcmd.ClusterDefaults}\n\n        if context != \"\" {\n            overrides.CurrentContext = context\n        }\n        return clientcmd.NewNonInteractiveDeferredLoadingClientConfig(rules, overrides)\n    }\n</code></pre>\n\n<p>If I try this code (got it from helm), the api server is not correctly set and the client wants to connect to the default host <code>localhost:8080</code>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2269, "user_id": 1329396, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/Cg8rf.png?s=128&g=1", "display_name": "Robert Snyder", "link": "https://stackoverflow.com/users/1329396/robert-snyder"}, "edited": false, "score": 0, "creation_date": 1526841276, "post_id": 50435501, "comment_id": 87890218, "body": "i think i figured it out. I gotta test to make sure, but it looks like the self assignment in the init was messing up. I renamed the parameter on init to be somethign different and it appears to be working now :D"}, {"owner": {"reputation": 4498, "user_id": 58768, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9bbffd2d873441279b4661070e8add4b?s=128&d=identicon&r=PG", "display_name": "bohdan_trotsenko", "link": "https://stackoverflow.com/users/58768/bohdan-trotsenko"}, "edited": false, "score": 1, "creation_date": 1526894887, "post_id": 50435501, "comment_id": 87905029, "body": "I think you&#39;ll regret using a global variable here."}, {"owner": {"reputation": 2269, "user_id": 1329396, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/Cg8rf.png?s=128&g=1", "display_name": "Robert Snyder", "link": "https://stackoverflow.com/users/1329396/robert-snyder"}, "reply_to_user": {"reputation": 4498, "user_id": 58768, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9bbffd2d873441279b4661070e8add4b?s=128&d=identicon&r=PG", "display_name": "bohdan_trotsenko", "link": "https://stackoverflow.com/users/58768/bohdan-trotsenko"}, "edited": false, "score": 0, "creation_date": 1526906541, "post_id": 50435501, "comment_id": 87911450, "body": "@bohdan_trotsenko I&#39;ve had my doubts about using it. I&#39;m still very new to go. What would be better practice? making a non-exported struct to hold my values in?"}, {"owner": {"reputation": 4498, "user_id": 58768, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9bbffd2d873441279b4661070e8add4b?s=128&d=identicon&r=PG", "display_name": "bohdan_trotsenko", "link": "https://stackoverflow.com/users/58768/bohdan-trotsenko"}, "edited": false, "score": 1, "creation_date": 1526996391, "post_id": 50435501, "comment_id": 87951607, "body": "I advise to have a public struct with parameters, just drop the global variable. Update your functions to be methods on a <code>*api.ScheduleHandlerParameters</code>;"}, {"owner": {"reputation": 4498, "user_id": 58768, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9bbffd2d873441279b4661070e8add4b?s=128&d=identicon&r=PG", "display_name": "bohdan_trotsenko", "link": "https://stackoverflow.com/users/58768/bohdan-trotsenko"}, "edited": false, "score": 1, "creation_date": 1526996843, "post_id": 50435501, "comment_id": 87951992, "body": "(that&#39;s the least; you may update or use a different set of structs/methods)"}], "answers": [{"tags": [], "owner": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "is_accepted": true, "score": 1, "last_activity_date": 1526893859, "creation_date": 1526893859, "answer_id": 50445427, "question_id": 50435501, "link": "https://stackoverflow.com/questions/50435501/error-500-after-encapsulating-handler-code/50445427#50445427", "title": "Error 500 after encapsulating handler code", "body": "<p>Exactly! When you are doing this:</p>\n\n<pre><code>func Init(parameters *ScheduleHandlerParameters) {\n    parameters = parameters\n    // ....\n}\n</code></pre>\n\n<p><code>parameters</code> becomes a local variable to this function and next line is just assigning it to itself. And global variable <code>parameters</code> still holds <code>nil</code> value, was never changed. Which caused error!</p>\n\n<p>Changing function param to something like this should work fine:</p>\n\n<pre><code>func Init(shPrms *ScheduleHandlerParameters) {\n    parameters = shPrms\n    // ....\n}\n</code></pre>\n"}], "owner": {"reputation": 2269, "user_id": 1329396, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/Cg8rf.png?s=128&g=1", "display_name": "Robert Snyder", "link": "https://stackoverflow.com/users/1329396/robert-snyder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 50445427, "answer_count": 1, "score": 0, "last_activity_date": 1526893859, "creation_date": 1526824143, "question_id": 50435501, "link": "https://stackoverflow.com/questions/50435501/error-500-after-encapsulating-handler-code", "title": "Error 500 after encapsulating handler code", "body": "<p>I've inherited code that was done by 2 other developers. It appears that a proof of concept website turned into production code so most all of the code is in main. It's a simple program in theory. The setup is a raspberry pi that controls sprinklers written in go that can set a schedule of turning on different zones. I've successfully encapsulated the relay controller into a package, now I want to encapsulate the schedule api. The part is a fairly straight forward CRUD operations.for simplicity I'll just post where I call it from main and the bare basics in the schedule_handler. so first:</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>func main() {\n    log.SetFlags(log.LstdFlags | log.LUTC)\n    log.SetOutput(&amp;lumberjack.Logger{\n        Filename:   \"application.log\",\n        MaxSize:    10, // megabytes\n        MaxBackups: 3,\n        MaxAge:     365, //days\n        LocalTime:  false,\n    })\n    log.Printf(\"System Startup\\n\")\n\n    parseTemplates()\n    loadConfig()\n    config.Eth0Addr = getIPv4ForInterfaceName(\"eth0\")\n    saveConfig()\n    log.Printf(\"local ethernet address: %s\\n\", config.Eth0Addr)\n\n    // gin.SetMode(gin.ReleaseMode)\n    gin.SetMode(gin.DebugMode)\n    r := gin.Default()\n\n    r.GET(\"/\", mainGetHandler) // homepage\n    r.GET(\"/login\", loginGetHandler)\n    r.POST(\"/login\", loginPostHandler)\n    r.GET(\"/logout\", authRequired(), logoutGetHandler)\n\n    scheduleRepository = nsScheduleRepository.Default(\"schedule.json\")\n    parameters := nsScheduleApi.ScheduleHandlerParameters{\n        Engine:     r,\n        Repository: scheduleRepository,\n    }\n    nsScheduleApi.Init(&amp;parameters)\n    r.GET(\"/schedule\", authRequired(), scheduleGetHandler)\n\n    http.Handle(\"/\", r)\n    r.Static(\"/static/\", \"./static/\")\n    config.URL = \"\"\n    // hack - wait 10 seconds for network to come up...\n    time.Sleep(10 * time.Second)\n    log.Println(\"Starting up on port 80\")\n    log.Fatal(http.ListenAndServe(\":80\", r))\n}\n</code></pre>\n\n<p><strong>schedule/api/schedule_handler.go</strong></p>\n\n<pre><code>package api\n\nimport (\n    \"mysprinkler/schedule\"\n    \"github.com/gin-gonic/gin\"\n    \"log\"\n    \"strconv\"\n)\n\ntype ScheduleHandlerParameters struct {\n    Repository schedule.ScheduleRepository\n    Engine     *gin.Engine\n}\n\nvar parameters *ScheduleHandlerParameters\n\nfunc getSchedules(c *gin.Context) {\n    repository := parameters.Repository\n    circuitnum, _ := strconv.ParseInt(c.Query(\"circuitnum\"), 10, 64)\n    log.Printf(\"[ScheduleHandler] getting schedules %d\", circuitnum)\n    var scheds = make([]*schedule.Schedule2, 0)\n    if circuitnum &gt; 0 {\n        schedule := repository.Get(string(circuitnum))\n        if schedule == nil {\n            // c.AbortWithStatus(404)\n            log.Printf(\"[ScheduleHandler] Could not find schedule '%d' in db\", circuitnum)\n        } else {\n            scheds = append(scheds, schedule)\n        }\n    } else {\n        scheds = repository.GetAll()\n    }\n    c.JSON(200, scheds)\n}\n\nfunc getSchedule(c *gin.Context) {\n    repository := parameters.Repository\n    id := c.Params.ByName(\"id\")\n    log.Printf(\"[ScheduleHandler] getting schedule %s\", id)\n    sched := repository.Get(id)\n    c.JSON(200, sched)\n}\n\nfunc createSchedule(c *gin.Context) {\n    repository := parameters.Repository\n    var sched schedule.Schedule2\n    err := c.BindJSON(&amp;sched)\n    if err != nil {\n        log.Printf(\"[ScheduleHandler] Error creating schedule %s\", err)\n    } else {\n        log.Printf(\"[ScheduleHandler] insert schedule for circuit %d\", sched.CircuitNum)\n    }\n    err = repository.InsertOrUpdate(&amp;sched)\n    if err != nil {\n        c.AbortWithError(500, err)\n        return\n    }\n    logSchedule(&amp;sched, \"created\")\n    c.JSON(200, sched)\n}\n\nfunc updateSchedule(c *gin.Context) {\n    repository := parameters.Repository\n    id := c.Params.ByName(\"id\")\n    log.Printf(\"[ScheduleHandler] updating schedule %s\", id)\n    sched := repository.Get(id)\n    c.BindJSON(&amp;sched)\n    err := repository.InsertOrUpdate(sched)\n    if err != nil {\n        c.AbortWithError(500, err)\n        return\n    }\n    logSchedule(sched, \"updated\")\n    c.JSON(200, sched)\n}\n\nfunc deleteSchedule(c *gin.Context) {\n    repository := parameters.Repository\n    id := c.Params.ByName(\"id\")\n    log.Printf(\"[ScheduleHandler] deleting schedule %s\", id)\n    err := repository.Delete(id)\n    if err != nil {\n        c.Error(err)\n        return\n    }\n    c.JSON(200, gin.H{\"id #\" + id: \"deleted\"})\n}\n\nfunc logSchedule(sched *schedule.Schedule2, action string) {\n    log.Printf(\"schedule: %s\\n\", action)\n    log.Printf(\"***  id: %d\\n\", sched.ID)\n    log.Printf(\"***  load: %d\\n\", sched.CircuitNum+1)\n    log.Printf(\"***  on time: %s\\n\", sched.OnTime)\n    log.Printf(\"***  off time: %s\\n\", sched.OffTime)\n    log.Printf(\"***  enabled: %v\", sched.Enabled)\n    log.Printf(\"***  sun: %v\", sched.Sun)\n    log.Printf(\"***  mon: %v\", sched.Mon)\n    log.Printf(\"***  tue: %v\", sched.Tue)\n    log.Printf(\"***  wed: %v\", sched.Wed)\n    log.Printf(\"***  thu: %v\", sched.Thu)\n    log.Printf(\"***  fri: %v\", sched.Fri)\n    log.Printf(\"***  sat: %v\", sched.Sat)\n}\n\n// Init creates a handler for the schedule api\nfunc Init(parameters *ScheduleHandlerParameters) {\n    parameters = parameters\n    r := parameters.Engine\n    r.GET(\"/schedule2\", getSchedules)\n    r.GET(\"/schedule2/:id\", getSchedule)\n    r.POST(\"/schedule2\", createSchedule)\n    r.PUT(\"/schedule2/:id\", updateSchedule)\n    r.DELETE(\"/schedule2/:id\", deleteSchedule)\n}\n</code></pre>\n\n<p>In the log I'm seeing </p>\n\n<pre><code>2018/05/20 12:14:36 System Startup\n2018/05/20 12:14:36 local ethernet address: 10.0.0.7\n2018/05/20 12:14:36 [GIN-debug] [WARNING] Running in \"debug\" mode. Switch to \"release\" mode in production.\n- using env:    export GIN_MODE=release\n- using code:   gin.SetMode(gin.ReleaseMode)\n\n2018/05/20 12:14:36 [GIN-debug] GET    /                         --&gt; main.mainGetHandler (3 handlers)\n2018/05/20 12:14:36 [GIN-debug] GET    /login                    --&gt; main.loginGetHandler (3 handlers)\n2018/05/20 12:14:36 [GIN-debug] POST   /login                    --&gt; main.loginPostHandler (3 handlers)\n2018/05/20 12:14:36 [GIN-debug] GET    /logout                   --&gt; main.logoutGetHandler (4 handlers)\n2018/05/20 12:14:36 [GIN-debug] GET    /schedule2                --&gt; sprinkler/schedule/api.getSchedules (3 handlers)\n2018/05/20 12:14:36 [GIN-debug] GET    /schedule2/:id            --&gt; sprinkler/schedule/api.getSchedule (3 handlers)\n2018/05/20 12:14:36 [GIN-debug] POST   /schedule2                --&gt; sprinkler/schedule/api.createSchedule (3 handlers)\n2018/05/20 12:14:36 [GIN-debug] PUT    /schedule2/:id            --&gt; sprinkler/schedule/api.updateSchedule (3 handlers)\n2018/05/20 12:14:36 [GIN-debug] DELETE /schedule2/:id            --&gt; sprinkler/schedule/api.deleteSchedule (3 handlers)\n2018/05/20 12:14:36 [GIN-debug] GET    /static/*filepath         --&gt; github.com/gin-gonic/gin.(*RouterGroup).createStaticHandler.func1 (3 handlers)\n2018/05/20 12:14:36 [GIN-debug] HEAD   /static/*filepath         --&gt; github.com/gin-gonic/gin.(*RouterGroup).createStaticHandler.func1 (3 handlers)\n2018/05/20 12:14:46 Starting up on port 80\n2018/05/20 12:15:15 admin logged in\n</code></pre>\n\n<p>but when I navigate to /schedule the template is loaded then immediatly i get two internal 500 errors (one for each call to /schedule2?circuitnum=1). Now this code worked before when it was all in main i just moved the methods into the schedule_api file then made an <code>Init</code> and put that setup code into it. Having a C# background I'm lost as to why this broke. My first guess is that I'm losing a reference to my schedule handler when it drops out of scope of <code>Main</code> but I don't understand why. Any ideas where I went wrong? </p>\n"}, {"tags": ["http", "go", "http2"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1526844574, "post_id": 50434269, "comment_id": 87891265, "body": "Why do you write your own HTTP server when the standard library includes an HTTP server that already supports HTTP/2? Reinventing the wheel is usually a bad idea."}, {"owner": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1526885522, "post_id": 50434269, "comment_id": 87900648, "body": "My use case is a bit different. Plus I would want to understand more of Go and http2 through this experiment."}], "answers": [{"comments": [{"owner": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "edited": false, "score": 0, "creation_date": 1526833822, "post_id": 50435197, "comment_id": 87888016, "body": "So the question remains how should I &#39;ignore&#39; it? And I am assuming if I read from tcp connection again, I should get the GET request. By the way, I am using Go&#39;s http.ReadRequest to parse http requests and I write directly onto the TCP connection."}, {"owner": {"reputation": 30128, "user_id": 2144578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6sbqF.png?s=128&g=1", "display_name": "Barry Pollard", "link": "https://stackoverflow.com/users/2144578/barry-pollard"}, "reply_to_user": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "edited": false, "score": 0, "creation_date": 1526835421, "post_id": 50435197, "comment_id": 87888500, "body": "I don&#39;t know Go that well to be honest, but I would imagine it should handle this transparently and not make it available to you if you have Go with HTTP/2 support. Are you using Go 1.6 or above?"}, {"owner": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "edited": false, "score": 0, "creation_date": 1526836111, "post_id": 50435197, "comment_id": 87888702, "body": "I am using Go 1.10.2. What is baffling to me is why is PRI even needed for http2 requests when ALPN handshake sets the protocol as &quot;h2&quot;."}, {"owner": {"reputation": 30128, "user_id": 2144578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6sbqF.png?s=128&g=1", "display_name": "Barry Pollard", "link": "https://stackoverflow.com/users/2144578/barry-pollard"}, "reply_to_user": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "edited": false, "score": 0, "creation_date": 1526837012, "post_id": 50435197, "comment_id": 87888963, "body": "Because ALPN is a TLS thing, and technically has nothing to do with HTTP. At a HTTP layer it has no idea which ALPN method was selected (h2 or http/1.1) - though of course the web server will know and could use that knowledge to handle the request appropriately. On the other hand, while this may not technically be needed for the h2 method of HTTP/2 negotiation, it is for all the other h2c methods, and I guess they thought it would be better to be consistent. Also it is possible to offload TLS at edge server and send the decrypted message to a h2c web server so it would be needed for that."}, {"owner": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "edited": false, "score": 0, "creation_date": 1526886465, "post_id": 50435197, "comment_id": 87901082, "body": "I can get along with the consistency reasoning. On debugging more, I found that I can read a blob (original req) directly from tcp connection after the connection preface, but http.ReadRequest blocks without throwing any read error."}, {"owner": {"reputation": 30128, "user_id": 2144578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6sbqF.png?s=128&g=1", "display_name": "Barry Pollard", "link": "https://stackoverflow.com/users/2144578/barry-pollard"}, "reply_to_user": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "edited": false, "score": 0, "creation_date": 1526887257, "post_id": 50435197, "comment_id": 87901443, "body": "Without knowing Go it really sounds to me like http.ReadRequest is expecting HTTP/1.1 formatted messages, otherwise it would just swallow the PRI message and give you the first real message."}, {"owner": {"reputation": 30128, "user_id": 2144578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6sbqF.png?s=128&g=1", "display_name": "Barry Pollard", "link": "https://stackoverflow.com/users/2144578/barry-pollard"}, "reply_to_user": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "edited": false, "score": 0, "creation_date": 1526887590, "post_id": 50435197, "comment_id": 87901593, "body": "And reading the blob is going to be complicated - the first HTTP/2 Frame that a client should send is a SETTINGS Frame. You should also send your own SETTINGS Frame and acknowledge that the Client sent one. HTTP/2 really is quite a different beast than HTTP/1.1 and building a full HTTP/2 server is quite complicated. If it\u2019s not too much of a shameless plug, Chapter 4 of my book (<a href=\"https://www.manning.com/books/http2-in-action\" rel=\"nofollow noreferrer\">manning.com/books/http2-in-action</a>) delves into the binary format and walks you through the messaging sequence, though HPACK Header compression is not covered until Chapter 7."}, {"owner": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "edited": false, "score": 0, "creation_date": 1526888353, "post_id": 50435197, "comment_id": 87901905, "body": "Sure. I&#39;ll go through it."}], "tags": [], "owner": {"reputation": 30128, "user_id": 2144578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6sbqF.png?s=128&g=1", "display_name": "Barry Pollard", "link": "https://stackoverflow.com/users/2144578/barry-pollard"}, "is_accepted": false, "score": 5, "last_activity_date": 1526821940, "creation_date": 1526821940, "answer_id": 50435197, "question_id": 50434269, "link": "https://stackoverflow.com/questions/50434269/pri-method-in-http2-implementation-causing-issue/50435197#50435197", "title": "PRI method in http2 implementation causing issue", "body": "<p>The first message a HTTP/2 client should send is this PRI message. From the <a href=\"https://httpwg.org/specs/rfc7540.html#ConnectionHeader\" rel=\"noreferrer\">HTTP/2 specification</a>:</p>\n\n<blockquote>\n  <p>In HTTP/2, each endpoint is required to send a connection preface as a final confirmation of the protocol in use and to establish the initial settings for the HTTP/2 connection. The client and server each send a different connection preface.</p>\n  \n  <p>The client connection preface starts with a sequence of 24 octets, which in hex notation is:</p>\n\n<pre><code>0x505249202a20485454502f322e300d0a0d0a534d0d0a0d0a\n</code></pre>\n  \n  <p>That is, the connection preface starts with the string PRI * HTTP/2.0\\r\\n\\r\\nSM\\r\\n\\r\\n). This sequence MUST be followed by a SETTINGS frame (Section 6.5), which MAY be empty.</p>\n  \n  <p>...</p>\n  \n  <p><strong>Note</strong>: The client connection preface is selected so that a large proportion of HTTP/1.1 or HTTP/1.0 servers and intermediaries do not attempt to process further frames.</p>\n</blockquote>\n\n<p>The point of this message is that it is a fake HTTP/1-like message so any server which is not HTTP/2 aware should response with an error.</p>\n\n<p>Any HTTP/2 server should expect this message to be sent, and then should just ignore it, and the carry on speaking HTTP/2.</p>\n\n<p>In fact if this message is NOT sent, then the server should treat this as an error and not continue:</p>\n\n<blockquote>\n  <p>Clients and servers MUST treat an invalid connection preface as a connection error (Section 5.4.1) of type PROTOCOL_ERROR. A GOAWAY frame (Section 6.8) MAY be omitted in this case, since an invalid preface indicates that the peer is not using HTTP/2.</p>\n</blockquote>\n"}], "owner": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3509, "favorite_count": 4, "answer_count": 1, "score": 1, "last_activity_date": 1526842082, "creation_date": 1526815011, "last_edit_date": 1526842082, "question_id": 50434269, "link": "https://stackoverflow.com/questions/50434269/pri-method-in-http2-implementation-causing-issue", "title": "PRI method in http2 implementation causing issue", "body": "<p>I am trying to extend a server with <strong>HTTP/2</strong> which already supports <strong>HTTP/1.1</strong> with <strong>TLS v1.2</strong>. I am writing it in <strong>Go</strong> where I define tls config like this - </p>\n\n<pre><code>tlsConfig := &amp;tls.Config{\n                    Certificates: []tls.Certificate{cert},\n                    ServerName:   \"mysrvr\",\n                    NextProtos:   []string{\"h2\", \"http/1.1\", \"http/1.0\"},\n                    Time:         time.Now,\n                    Rand:         rand.Reader,\n            }\n</code></pre>\n\n<p>As is evident, I have used \"<strong>h2</strong>\" string to set up ALPN handshake.</p>\n\n<p>Now when I make request via curl, I receive this request - </p>\n\n<pre><code>$ curl -v https://127.0.0.1:8000 -k --http2\n</code></pre>\n\n<p>When I parse request, it shows a <strong>PRI</strong> method being sent first instead of <strong>GET</strong> -</p>\n\n<pre><code>HTTP/2.0\nPRI\n</code></pre>\n\n<p>I got some idea on <strong>PRI</strong> method from <a href=\"https://tools.ietf.org/html/rfc7540#page-78\" rel=\"nofollow noreferrer\">https://tools.ietf.org/html/rfc7540#page-78</a> wherein it says the following -</p>\n\n<pre><code>This method is never used by an actual client.\nThis method will appear to be used when an HTTP/1.1 server or\nintermediary attempts to parse an HTTP/2 connection preface. \n</code></pre>\n\n<p>My question now is why was <strong>PRI</strong> request sent, when clearly the server supports <strong>HTTP/2</strong>? Do I need to parse it and respond with empty <strong>SETTINGS</strong> frame in accordance with HTTP/2 spec or should the Go http2 runtime should have taken care of it?</p>\n\n<p>I am using <code>http.ReadRequest</code> to parse client requests, but that doesn't seem to be working for <strong>HTTP/2</strong> requests even when I ignore <strong>PRI</strong> requests (as suggested below).</p>\n"}, {"tags": ["c", "go", "unsafe"], "answers": [{"comments": [{"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1527642733, "post_id": 50444766, "comment_id": 88199215, "body": "thanks, I assume, the <code>{size of the union}</code> would be the longest of the union types"}], "tags": [], "owner": {"reputation": 3191, "user_id": 798042, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4cd3f267885c0ed5ee510e5204762598?s=128&d=identicon&r=PG&f=1", "display_name": "dotslashlu", "link": "https://stackoverflow.com/users/798042/dotslashlu"}, "is_accepted": true, "score": 2, "last_activity_date": 1526891284, "creation_date": 1526891284, "answer_id": 50444766, "question_id": 50432806, "link": "https://stackoverflow.com/questions/50432806/map-c-struct-with-union-field-to-go-struct/50444766#50444766", "title": "Map C struct with union field to Go struct", "body": "<p>As stated in the <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">cgo documentation</a>, </p>\n\n<blockquote>\n  <p>As Go doesn't have support for C's union type in the general case, C's union types are represented as a Go byte array with the same length.</p>\n</blockquote>\n\n<p>Maybe you should try this </p>\n\n<pre><code>type SPC_LINK struct {\n    dwLinkChoice  DWORD\n    dwLink        [{size of the union}]byte\n}\n</code></pre>\n"}], "owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 652, "favorite_count": 1, "accepted_answer_id": 50444766, "answer_count": 1, "score": 3, "last_activity_date": 1526891284, "creation_date": 1526803145, "last_edit_date": 1526811360, "question_id": 50432806, "link": "https://stackoverflow.com/questions/50432806/map-c-struct-with-union-field-to-go-struct", "title": "Map C struct with union field to Go struct", "body": "<p>I'm getting results from syscall to some WinApi in Go. I map simple structs from C code easily, but how to deal with C structs like the following?</p>\n\n<pre><code>typedef struct SPC_LINK_\n{\n    DWORD dwLinkChoice;\n#               define          SPC_URL_LINK_CHOICE         1\n#               define          SPC_MONIKER_LINK_CHOICE     2\n#               define          SPC_FILE_LINK_CHOICE        3\n\n    union\n    {\n        LPWSTR                  pwszUrl;\n        SPC_SERIALIZED_OBJECT   Moniker;\n        LPWSTR                  pwszFile;\n    };\n\n} SPC_LINK, *PSPC_LINK;\n</code></pre>\n\n<p>If all possible types are defined in Go</p>\n\n<pre><code>type SPC_LINK struct {\n    dwLinkChoice  DWORD\n    Moniker       SPC_SERIALIZED_OBJECT\n    pwszFile      LPWSTR\n    pwszUrl       LPWSTR\n}\n</code></pre>\n\n<p>after the syscall with <code>unsafe.Pointer</code> to this Go struct as a parameter, I've got it in memory and can access it in Go as usual, but only the first field after <code>dwLinkChoice</code> (<code>Moniker</code> in the code above) is always filled, the other two are always empty. I know this is expected behavior in C, as you can have only one union field at a time. Taking this into account, should I ignore the whole union structure and have some sort of a placeholder in my Go struct?</p>\n\n<pre><code>type SPC_LINK struct {\n    dwLinkChoice  DWORD\n    dwLink        uintptr // a placeholder, will hold any possible value\n}\n</code></pre>\n\n<p>I set type for the placeholder to uintptr, but what if the original C structure has some other non-pointer types in the union block? I'm really not sure how to handle C unions and looking for any suggestions.</p>\n"}, {"tags": ["go", "godoc"], "comments": [{"owner": {"reputation": 872, "user_id": 644470, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8a33421d2bcd8a9924c8a516619c2731?s=128&d=identicon&r=PG", "display_name": "Michael McLoughlin", "link": "https://stackoverflow.com/users/644470/michael-mcloughlin"}, "edited": false, "score": 0, "creation_date": 1526958262, "post_id": 50431892, "comment_id": 87931624, "body": "The end result was <a href=\"https://github.com/mmcloughlin/geohash/pull/7\" rel=\"nofollow noreferrer\">github.com/mmcloughlin/geohash/pull/7</a>"}], "answers": [{"comments": [{"owner": {"reputation": 872, "user_id": 644470, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8a33421d2bcd8a9924c8a516619c2731?s=128&d=identicon&r=PG", "display_name": "Michael McLoughlin", "link": "https://stackoverflow.com/users/644470/michael-mcloughlin"}, "edited": false, "score": 1, "creation_date": 1526824168, "post_id": 50435231, "comment_id": 87885087, "body": "Thank you this is extremely helpful! However it doesn&#39;t quite handle the <code>cpuid</code> check. I&#39;ve found useful sample code in the <code>runtime</code> package. For example <a href=\"https://github.com/golang/go/blob/cc09212f59ee215cae5345dc1ffcd1ed81664e1b/src/runtime/asm_386.s#L168\" rel=\"nofollow noreferrer\">populating a support_sse2 flag</a> and adding a <a href=\"https://github.com/golang/go/blob/cc09212f59ee215cae5345dc1ffcd1ed81664e1b/src/runtime/asm_386.s#L920-L921\" rel=\"nofollow noreferrer\">conditional jump to the start of cputicks function</a>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 872, "user_id": 644470, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8a33421d2bcd8a9924c8a516619c2731?s=128&d=identicon&r=PG", "display_name": "Michael McLoughlin", "link": "https://stackoverflow.com/users/644470/michael-mcloughlin"}, "edited": false, "score": 0, "creation_date": 1526841209, "post_id": 50435231, "comment_id": 87890197, "body": "To handle the cpuid check, set a package variable in init() and conditionally jump based on that variable in the assembly implementation."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1526841195, "last_edit_date": 1526841195, "creation_date": 1526822238, "answer_id": 50435231, "question_id": 50431892, "link": "https://stackoverflow.com/questions/50431892/documentation-for-architecture-specific-golang-function/50435231#50435231", "title": "Documentation for architecture-specific Golang function", "body": "<p>See <a href=\"https://github.com/golang/go/blob/cc09212f59ee215cae5345dc1ffcd1ed81664e1b/src/math/sqrt.go\" rel=\"nofollow noreferrer\">math.Sqrt</a> for an example of how to do this.</p>\n\n<ul>\n<li>Write a <a href=\"https://github.com/golang/go/blob/cc09212f59ee215cae5345dc1ffcd1ed81664e1b/src/math/sqrt.go#L85-L92\" rel=\"nofollow noreferrer\">stub function with the documentation</a></li>\n<li>Write a <a href=\"https://github.com/golang/go/blob/cc09212f59ee215cae5345dc1ffcd1ed81664e1b/src/math/sqrt.go#L99-L144\" rel=\"nofollow noreferrer\">generic implementation as an unexported function</a>.</li>\n<li>For each architecture, write a function in assembler that <a href=\"https://github.com/golang/go/blob/cc09212f59ee215cae5345dc1ffcd1ed81664e1b/src/math/stubs_mips64x.s#L102-L103\" rel=\"nofollow noreferrer\">jumps to the unexported generic implementation</a> or <a href=\"https://github.com/golang/go/blob/cc09212f59ee215cae5345dc1ffcd1ed81664e1b/src/math/sqrt_amd64.s#L8-L12\" rel=\"nofollow noreferrer\">implements the function directly</a>.</li>\n</ul>\n\n<p>To handle the cpuid check, set a package variable in <code>init()</code> and conditionally jump based on that variable in the assembly implementation.</p>\n"}], "owner": {"reputation": 872, "user_id": 644470, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8a33421d2bcd8a9924c8a516619c2731?s=128&d=identicon&r=PG", "display_name": "Michael McLoughlin", "link": "https://stackoverflow.com/users/644470/michael-mcloughlin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 50435231, "answer_count": 1, "score": 3, "last_activity_date": 1526841195, "creation_date": 1526793444, "question_id": 50431892, "link": "https://stackoverflow.com/questions/50431892/documentation-for-architecture-specific-golang-function", "title": "Documentation for architecture-specific Golang function", "body": "<p>I have a function that I would like to provide an assembly implementation for\non <code>amd64</code> architecture. For the sake of discussion let's just suppose it's an\n<code>Add</code> function, but it's actually more complicated than this. I have the\nassembly version working but my question concerns getting the godoc to display\ncorrectly. I have a feeling this is currenty impossible, but I wanted to seek\nadvice.</p>\n\n<p>Some more details:</p>\n\n<ul>\n<li>The assembly implementation of this function contains only a few\ninstructions. In particular, the mere cost of calling the function is a\nsignificant part of the entire cost.</li>\n<li>It makes use of special instructions (<code>BMI2</code>) therefore can only be used\nfollowing a <code>CPUID</code> capability check.</li>\n</ul>\n\n<p>The implementation is <a href=\"https://gist.github.com/mmcloughlin/bb80af98cdc45fa11b011db4c94a04a3\" rel=\"nofollow noreferrer\">structured like this gist</a>. At a high level:</p>\n\n<ul>\n<li>In the generic (non-<code>amd64</code> case) the function is defined by delegating to\n<code>addGeneric</code>.</li>\n<li>In the <code>amd64</code> case the function is actually a variable, initially set to\n<code>addGeneric</code> but replaced by <code>addAsm</code> in the <code>init</code> function if a <code>cpuid</code>\ncheck passes.</li>\n</ul>\n\n<p>This approach works. However the godoc output is crappy because in the\n<code>amd64</code> case the function is actually a variable. Note godoc appears to be\npicking up the same build tags as the machine it's running on. I'm not sure\nwhat <code>godoc.org</code> would do.</p>\n\n<p>Alternatives considered:</p>\n\n<ul>\n<li>The <code>Add</code> function delegates to <code>addImpl</code>. Then we pull some similar trick\nto replace <code>addImpl</code> in the <code>amd64</code> case. The problem with this is (in my\nexperiments) Go doesn't seem to be able to inline the call, and the assembly\nis now wrapped in two function calls. Since the assembly is so small already\nthis has a noticable impact on performance.</li>\n<li>In the <code>amd64</code> case we define a plain function <code>Add</code> that has the <code>useAsm</code>\ncheck inside it, and calls one of <code>addGeneric</code> and <code>addAsm</code> depending on the\nresult. This would have an even worse impact on performance.</li>\n</ul>\n\n<p>So I guess the questions are:</p>\n\n<ol>\n<li>Is there a better way to structure the code to achieve the performance I\nwant, and have it appear properly in documentation.</li>\n<li>If there is no alternative, is there some other way to \"trick\" godoc?</li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1526786115, "post_id": 50431251, "comment_id": 87877065, "body": "When do you get the indicated error?  When you compile?  Or when you run?  You also say &quot;While I write a sub package hi, I get error&quot;.  What error?  And what does it mean that you get it while you write?  Is that when you compile or run?"}, {"owner": {"reputation": 127, "user_id": 9577564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bef59c06bc854ca66ad39e85e08bf5f?s=128&d=identicon&r=PG&f=1", "display_name": "Minusy", "link": "https://stackoverflow.com/users/9577564/minusy"}, "reply_to_user": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1526787974, "post_id": 50431251, "comment_id": 87877279, "body": "@SeanF Thanks a lot. I had updated my question."}], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 9577564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bef59c06bc854ca66ad39e85e08bf5f?s=128&d=identicon&r=PG&f=1", "display_name": "Minusy", "link": "https://stackoverflow.com/users/9577564/minusy"}, "edited": false, "score": 0, "creation_date": 1526800339, "post_id": 50432379, "comment_id": 87879256, "body": "Thank you for your answer sincerely. You solved my puzzle. But has it another way to achieve my goals? It&#39;s very complicated to put all go file into a directory."}, {"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "reply_to_user": {"reputation": 127, "user_id": 9577564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bef59c06bc854ca66ad39e85e08bf5f?s=128&d=identicon&r=PG&f=1", "display_name": "Minusy", "link": "https://stackoverflow.com/users/9577564/minusy"}, "edited": false, "score": 0, "creation_date": 1526800485, "post_id": 50432379, "comment_id": 87879285, "body": "I&#39;m not sure what you mean by &quot;very complicated&quot;.  The go compiler will create your .a files in the right places and you just need to remove the source files and add just a single source file with //go:binary-only-package for each root package.   Then you send that to other people."}, {"owner": {"reputation": 127, "user_id": 9577564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bef59c06bc854ca66ad39e85e08bf5f?s=128&d=identicon&r=PG&f=1", "display_name": "Minusy", "link": "https://stackoverflow.com/users/9577564/minusy"}, "edited": false, "score": 0, "creation_date": 1526800678, "post_id": 50432379, "comment_id": 87879308, "body": "I mean that it has many sub-package. Should I move greet/hi/hi.go to greet/hi.go?"}, {"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "reply_to_user": {"reputation": 127, "user_id": 9577564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bef59c06bc854ca66ad39e85e08bf5f?s=128&d=identicon&r=PG&f=1", "display_name": "Minusy", "link": "https://stackoverflow.com/users/9577564/minusy"}, "edited": false, "score": 0, "creation_date": 1526800873, "post_id": 50432379, "comment_id": 87879350, "body": "Well, it&#39;s probably not hard to write a simple script or even a go program that makes the necessary changes to the source files so that you don&#39;t have to do it manually.  Whether you want to move your code around or change your code is up to you, but normally you organize your code based on its functionality and not things like this."}, {"owner": {"reputation": 127, "user_id": 9577564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bef59c06bc854ca66ad39e85e08bf5f?s=128&d=identicon&r=PG&f=1", "display_name": "Minusy", "link": "https://stackoverflow.com/users/9577564/minusy"}, "edited": false, "score": 0, "creation_date": 1526801236, "post_id": 50432379, "comment_id": 87879411, "body": "Ok, I see. Much appreciated."}], "tags": [], "owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "is_accepted": true, "score": 0, "last_activity_date": 1526798772, "creation_date": 1526798772, "answer_id": 50432379, "question_id": 50431251, "link": "https://stackoverflow.com/questions/50431251/how-to-distribute-go-binary-only-package/50432379#50432379", "title": "how to distribute go binary only package", "body": "<p>\"go run\" will compile and run the given main package.  So it will check the timestamps of your source files and recompile them if it sees they are newer than the previously compiled  libraries (.a files).</p>\n\n<p>It will skip this step for binary only packages.  So in this case it will check for any given package that there is just a single source file with the text //go:binary-only-package.  That is how the feature is specified.  When it sees that, it will use the .a files only.</p>\n\n<p>When you have a subpackage with a source file in it, it seems that files in there end up counting as part of the enclosing root package and the requirement of having just a single source file is broken.  So then \"go run\" will fail.  I suspect that is why it doesn't work.  And that is why deleting the hi subpackage causes it to work.</p>\n\n<p>The intended use case for binary-only is that you compile your package, and then when you make it available to others you do not include any source files, just the .a files.  But for this to work you need to be able to tell other peoples' compilers that your package is just the .a files.  For that you need to include just the one source file with the text //go:binary-only-package.  And you've basically shown here that for a package that has subpackages, the whole thing must have just a single such source file, there can be only one, you cannot have more of them in the subpackage folders.  So just provide the one.  That is how the feature works.  You provide the .a files and just that one source file to others.</p>\n"}, {"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1551254341, "post_id": 54165072, "comment_id": 96568644, "body": "This has a consequence on licenses: <a href=\"https://medium.com/@henvic/opensource-and-go-what-license-f6b36c201854\" rel=\"nofollow noreferrer\">medium.com/@henvic/opensource-and-go-what-license-f6b36c2018&zwnj;&#8203;54</a>"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 2, "last_activity_date": 1547338711, "creation_date": 1547338711, "answer_id": 54165072, "question_id": 50431251, "link": "https://stackoverflow.com/questions/50431251/how-to-distribute-go-binary-only-package/54165072#54165072", "title": "how to distribute go binary only package", "body": "<p>Note (2019): binary-only packages won't be supported much longer.</p>\n\n<p>As the <a href=\"https://tip.golang.org/doc/go1.12#binary-only\" rel=\"nofollow noreferrer\">Go 1.12 (February 2019) release notes</a> states (following <a href=\"https://go-review.googlesource.com/c/go/+/152918/\" rel=\"nofollow noreferrer\">CL 152918</a>):</p>\n\n<blockquote>\n  <h2>Binary-only packages</h2>\n  \n  <p><strong>Go 1.12 is the last release that will support binary-only packages</strong>. </p>\n</blockquote>\n\n<p>This is detailed in <a href=\"https://github.com/golang/go/issues/28152\" rel=\"nofollow noreferrer\">Go issue 28152</a>:</p>\n\n<blockquote>\n  <p><strong>Binary-only packages are increasingly hard to support safely.</strong> </p>\n  \n  <p>There is no guarantee that the compilation of the binary-only package used the same versions of the dependencies that the final link does (and it would probably be too onerous to insist on that).<br>\n  As a result, the binary-only package may have been compiled using escape analysis results or inline function bodies for dependencies that are no longer accurate.<br>\n  <strong>The result can be silent memory corruption.</strong></p>\n  \n  <p>My memory is that we added binary-only packages originally so that a professor could hand out binary solution sets so that a student who didn't finish lab 2 could still move on to lab 3.<br>\n  I don't know why else anyone uses them anymore, but they're probably going to break more and more as the compiler gets more sophisticated.</p>\n</blockquote>\n\n<p><a href=\"https://groups.google.com/forum/#!msg/golang-nuts/juPzaRDVB9c/6PYP56-0CAAJ\" rel=\"nofollow noreferrer\">This was also discussed here</a>.</p>\n"}], "owner": {"reputation": 127, "user_id": 9577564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bef59c06bc854ca66ad39e85e08bf5f?s=128&d=identicon&r=PG&f=1", "display_name": "Minusy", "link": "https://stackoverflow.com/users/9577564/minusy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2522, "favorite_count": 2, "accepted_answer_id": 50432379, "answer_count": 2, "score": 0, "last_activity_date": 1547338711, "creation_date": 1526784730, "last_edit_date": 1526797317, "question_id": 50431251, "link": "https://stackoverflow.com/questions/50431251/how-to-distribute-go-binary-only-package", "title": "how to distribute go binary only package", "body": "<p>I want to distribute packages in binary form without including the source code.</p>\n\n<p>my demo project directory structure is like this:  </p>\n\n<pre><code>demo\n\u251c\u2500\u2500 greet\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 greet.go\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 hi\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 hi.go\n\u251c\u2500\u2500 hello\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 hello.go\n\u2514\u2500\u2500 main.go\n</code></pre>\n\n<p><strong>main.go:</strong>  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"demo/greet\"\n    \"demo/hello\"\n)\n\nfunc main(){\n    fmt.Println(\"greet:\")\n    greet.Greet()\n\n    fmt.Println(\"hello:\")\n    hello.Hello()\n}\n</code></pre>\n\n<p><strong>greet.go</strong>  </p>\n\n<pre><code>package greet\n\nimport (\n    \"demo/greet/hi\"\n    \"fmt\"\n)\n\nfunc Greet(){\n    fmt.Println(\"Greet Call Hi\")\n    hi.Hi()\n}\n</code></pre>\n\n<p><strong>hi.go</strong>  </p>\n\n<pre><code>package hi\n\nimport \"fmt\"\n\nfunc Hi(){\n    fmt.Println(\"Hi\")\n}\n</code></pre>\n\n<p><strong>hello.go</strong>  </p>\n\n<pre><code>package hello\n\nimport (\n    \"fmt\"\n    \"demo/greet\"\n)\n\nfunc Hello(){\n    fmt.Println(\"hello call greet\")\n    greet.Greet()\n}\n</code></pre>\n\n<p>And I do this:</p>\n\n<pre><code>[user@localhost greet]$ go install -a ./...\n</code></pre>\n\n<p>It generated greet.a and greet/hi.a in $GOPATH/pkg/linux_amd64/demo.\nThen I edit hi.go and greet.go.</p>\n\n<pre><code>[user@localhost greet]$ cat greet.go\n//go:binary-only-package\n\npackage greet\n[user@localhost greet]$ cat hi/hi.go\n//go:binary-only-package\n\npackage hi\n</code></pre>\n\n<p>Then I run main.go, I get errors:  </p>\n\n<pre><code>[user@localhost greet]$ cat hi/hi.go\n# command-line-arguments\ncannot find package demo/greet/hi (using -importcfg)\n/home/user/go/pkg/tool/linux_amd64/link: cannot open file : open : no such file or directory\n</code></pre>\n\n<p><strong><em>greet</em></strong> is the package I want to distribute. If I delete package <strong><em>hi</em></strong>, main.go can run well.</p>\n\n<pre><code>demo\n\u251c\u2500\u2500 greet\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 greet.go\n\u251c\u2500\u2500 hello\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 hello.go\n\u2514\u2500\u2500 main.go\n</code></pre>\n\n<p>install:  </p>\n\n<pre><code>[user@localhost greet]$ go install .\n[user@localhost greet]$ vim greet.go\n//go:binary-only-package\n\npackage greet\n[user@localhost greet]$ cd ..\n[user@localhost demo]$ go run main.go\ngreet:\nGreet ...\nhello:\nhello call greet\nGreet ...\n[user@localhost demo]$ \n</code></pre>\n\n<h3>So my main problem is: how can I build binary lib and others can't see my source code. And the package has many sub-package.(If the package haven't sub-package, I use <code>//go:binary-only-package</code> method can work well)</h3>\n\n<p>Please help or try to give some ideas how to solve this. Thanks in advance.</p>\n"}, {"tags": ["http", "go", "server", "request"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1526759362, "post_id": 50428856, "comment_id": 87872500, "body": "<a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Server</a> and <a href=\"https://golang.org/pkg/net/http/#Server.Close\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Server.Close</a>"}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1526765224, "post_id": 50429396, "comment_id": 87873915, "body": "Do note that, if you have other servers run by the same program, and they too use the DefaultServeMux, you might get unnecessary conflict for the <code>&quot;&#47;&quot;</code> path. So you may want to use the Server&#39;s Handler field instead. Something like this: <a href=\"https://play.golang.org/p/KR46siACwmo\" rel=\"nofollow noreferrer\">play.golang.org/p/KR46siACwmo</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1526825542, "post_id": 50429396, "comment_id": 87885469, "body": "Don&#39;t rely on this. It&#39;s very racy."}, {"owner": {"reputation": 69, "user_id": 9720302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db83dca4efa48bccd4f3a06c2020302c?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas", "link": "https://stackoverflow.com/users/9720302/jonas"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526831300, "post_id": 50429396, "comment_id": 87887233, "body": "@Flimzy I&#39;m currently single threaded and it is supposed to just listen on localhost, but I&#39;ll keep that in mind"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526831412, "post_id": 50429396, "comment_id": 87887264, "body": "@Jona: You&#39;re not single-threaded, as <code>ListenAndServe</code> is inherently multi-threaded (well, it uses concurrency, which translates to multi-threaded by default if you have more than one CPU). But listening just on localhost helps."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526831548, "post_id": 50429396, "comment_id": 87887316, "body": "What I would suggest instead, regardless of localhost or not, is to wait until you know you&#39;ve received the HTTP request you&#39;re expecting, then shut down. And in case you receive other requests in the meantime, queue them, and just process them on a FIFO basis. This will work in any environment."}, {"owner": {"reputation": 69, "user_id": 9720302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db83dca4efa48bccd4f3a06c2020302c?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas", "link": "https://stackoverflow.com/users/9720302/jonas"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526840426, "post_id": 50429396, "comment_id": 87889955, "body": "@Flimzy With single threaded I meant everything in my program will wait until the HandleFunc get&#39;s called, so I think there shouldn&#39;t be too much of racing issues. And, I think thats important, this is not server code but client code. That&#39;s the reason why I don&#39;t want to wait a constant amount of time before closing the server, I&#39;m waiting for user input here."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526841161, "post_id": 50429396, "comment_id": 87890183, "body": "<code>ListenAndServe</code> makes it server code, by definition. :) And what happens if something other than <i>your</i> code makes a connection to that server?"}, {"owner": {"reputation": 69, "user_id": 9720302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db83dca4efa48bccd4f3a06c2020302c?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas", "link": "https://stackoverflow.com/users/9720302/jonas"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526843971, "post_id": 50429396, "comment_id": 87891040, "body": "@Flimzy Sure, you&#39;re right :-D I meant it is supposed to run directly on the users system, not as a productive server environment. If something else will make a connection it&#39;s fine if it breaks, since this route handles user authentication and I suppose something is going really wrong if another app tries to connect to that route."}, {"owner": {"reputation": 69, "user_id": 9720302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db83dca4efa48bccd4f3a06c2020302c?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas", "link": "https://stackoverflow.com/users/9720302/jonas"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526845457, "post_id": 50429396, "comment_id": 87891533, "body": "@Flimzy to not flood the comment section to much: I think currently it is a better fit for my application to just listen for one request because the application is still quite simple and I got the feeling that the user is more aware of what&#39;s happening if it will fail when another application tries to connect to it, which is not supposed to happen. However, I appreciate your input and since the architecture might change in the future and I will keep in mind to rethink that pattern."}], "tags": [], "owner": {"reputation": 69, "user_id": 9720302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db83dca4efa48bccd4f3a06c2020302c?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas", "link": "https://stackoverflow.com/users/9720302/jonas"}, "is_accepted": false, "score": 0, "last_activity_date": 1526768546, "last_edit_date": 1526768546, "creation_date": 1526763178, "answer_id": 50429396, "question_id": 50428856, "link": "https://stackoverflow.com/questions/50428856/how-to-stop-the-http-serving-function-after-one-request/50429396#50429396", "title": "How to stop the HTTP serving function after one request", "body": "<p>Thanks to @mkopriva I was able to do it.</p>\n\n<p>It's actually pretty simple, just create a server object manually and then call s.Close() in your handle function</p>\n\n<pre><code>s := &amp;http.Server{\n    Addr: \"localhost:8085\",\n}\nhttp.HandleFunc(\"/\", func(w http.ResponseWriter, req *http.Request) {\n    //do sth\n    s.Close()\n})\ns.ListenAndServe()\n//do sth else\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 9720302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db83dca4efa48bccd4f3a06c2020302c?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas", "link": "https://stackoverflow.com/users/9720302/jonas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1526768546, "creation_date": 1526758840, "question_id": 50428856, "link": "https://stackoverflow.com/questions/50428856/how-to-stop-the-http-serving-function-after-one-request", "title": "How to stop the HTTP serving function after one request", "body": "<p>To authenticate a user with a 3rd party service I need to listen and wait on a localport so I get a token by that service.</p>\n\n<p>How is it possible to exit a server in go after one request?</p>\n\n<p>As far as I'm aware it's only possible with listenAndServer to that forever, but on for just one single request</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 10, "last_activity_date": 1526753755, "creation_date": 1526753755, "answer_id": 50428201, "question_id": 50428176, "link": "https://stackoverflow.com/questions/50428176/how-to-get-ip-and-port-from-net-addr-when-it-could-be-a-net-udpaddr-or-net-tcpad/50428201#50428201", "title": "How to get IP and Port from net.Addr when it could be a net.UDPAddr or net.TCPAddr", "body": "<p>No need for reflection, just do a proper type assertion switch instead:</p>\n\n<pre><code>switch addr := remoteAddr.(type) {\ncase *net.UDPAddr:\n    p.SrcIP = addr.IP.String()\n    p.SrcPort = uint(addr.Port)\n    p.DstPort = uint(localAddr.(*net.UDPAddr).Port)\ncase *net.TCPAddr:\n    p.SrcIP = addr.IP.String()\n    p.SrcPort = uint(addr.Port)\n    p.DstPort = uint(localAddr.(*net.TCPAddr).Port)\n}\n</code></pre>\n"}], "owner": {"reputation": 580, "user_id": 1365365, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/055d0f6ffe233d86ebe186ccad2656d8?s=128&d=identicon&r=PG", "display_name": "Jamie H", "link": "https://stackoverflow.com/users/1365365/jamie-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4252, "favorite_count": 0, "accepted_answer_id": 50428201, "answer_count": 1, "score": 2, "last_activity_date": 1526753755, "creation_date": 1526753527, "question_id": 50428176, "link": "https://stackoverflow.com/questions/50428176/how-to-get-ip-and-port-from-net-addr-when-it-could-be-a-net-udpaddr-or-net-tcpad", "title": "How to get IP and Port from net.Addr when it could be a net.UDPAddr or net.TCPAddr", "body": "<p>I'm running a hybrid server which listens on both TCP and UDP and need to get the local port, remote IP address and remote port. Currently the way I'm checking if the underlying type is net.UDPAddr or a net.TCPAddr is the following:</p>\n\n<pre><code>// BAD: but not sure a better way\nswitch reflect.TypeOf(remoteAddr).String() {\ncase \"*net.UDPAddr\":\n    p.SrcIP = remoteAddr.(*net.UDPAddr).IP.String()\n    p.SrcPort = uint(remoteAddr.(*net.UDPAddr).Port)\n    p.DstPort = uint(localAddr.(*net.UDPAddr).Port)\ncase \"*net.TCPAddr\":\n    p.SrcIP = remoteAddr.(*net.TCPAddr).IP.String()\n    p.SrcPort = uint(remoteAddr.(*net.TCPAddr).Port)\n    p.DstPort = uint(localAddr.(*net.TCPAddr).Port)\n}\n</code></pre>\n\n<p>I'm not the greatest fan of this, if anyone has any cleaner looking solutions that would be greatly appreciated </p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda"], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 10757128, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-kcMCfzzlC38/AAAAAAAAAAI/AAAAAAAAAAc/9lI2AshB3PI/photo.jpg?sz=128", "display_name": "RPayne", "link": "https://stackoverflow.com/users/10757128/rpayne"}, "is_accepted": false, "score": 3, "last_activity_date": 1544841954, "creation_date": 1544841954, "answer_id": 53789115, "question_id": 50427698, "link": "https://stackoverflow.com/questions/50427698/lambda-invoke-payload-error/53789115#53789115", "title": "lambda invoke payload error", "body": "<p>The error is in the assignment of ClientContext in InvokeInput.  </p>\n\n<p>Try, initially at least, commenting out ClientContext - this will get it working. The doco states:    </p>\n\n<p><em>The ClientContext JSON must be base64-encoded and has a maximum size of 3583 bytes.</em></p>\n\n<pre><code>input := &amp;lambda.InvokeInput{\n    // ClientContext:  aws.String(\"MyApp\"),\n    FunctionName:   aws.String(\"arn:aws:lambda:us-region:arnnum:function:testrpredis\"),\n    InvocationType: aws.String(\"RequestResponse\"),\n    LogType:        aws.String(\"Tail\"),\n    Payload:        payload,\n    Qualifier:      aws.String(\"$LATEST\"),\n}\n</code></pre>\n\n<p>If you want to use ClientContext, that is a separate exercise. I'm still trying to figure out.</p>\n"}], "owner": {"reputation": 2732, "user_id": 2061886, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/dkfiz.jpg?s=128&g=1", "display_name": "lightweight", "link": "https://stackoverflow.com/users/2061886/lightweight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 766, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1544841954, "creation_date": 1526749942, "last_edit_date": 1526801947, "question_id": 50427698, "link": "https://stackoverflow.com/questions/50427698/lambda-invoke-payload-error", "title": "lambda invoke payload error", "body": "<p>I'm trying to invoke a lambda function (written in Go) with the <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/lambda/#Lambda.Invoke\" rel=\"nofollow noreferrer\">Go SDK</a> \n from another app but run into issues with the payload, but not when I test the lambda function via the console with the same output. </p>\n\n<p>here is the function that invokes lambda:</p>\n\n<pre><code>type RedisPair struct {\n    RedisKey        string      `json:\"redis_key\"`\n    RedisValue      string      `json:\"redis_value\"`\n}\n\ntype RedisBatch struct {\n    RedisPairs      []RedisPair\n    GroupId         string      `json:\"group_id\"`\n}\n\nfunc lambdawrite (redisbatch RedisBatch) {\n\n    //fmt.Println(\"invoking lambda\")\n\n    fmt.Println(\"Batch type: \", reflect.TypeOf(redisbatch))\n\n    payload, err := json.Marshal(redisbatch)\n\n    fmt.Println(\"Payload type: \", reflect.TypeOf(payload))\n\n    if err != nil {\n        fmt.Println(\"Error marshalling MyGetItemsFunction request\")\n    }\n\n    svc := lambda.New(session.New())\n    input := &amp;lambda.InvokeInput{\n        ClientContext:  aws.String(\"MyApp\"),\n        FunctionName:   aws.String(\"arn:aws:lambda:us-region:arnnum:function:testrpredis\"),\n        InvocationType: aws.String(\"RequestResponse\"),\n        LogType:        aws.String(\"Tail\"),\n        Payload:        payload,\n        Qualifier:      aws.String(\"$LATEST\"),\n    }\n\n    result, err := svc.Invoke(input)\n    if err != nil {\n        if aerr, ok := err.(awserr.Error); ok {\n            //error stuff...\n            }\n        } else {\n            // Print the error, cast err to awserr.Error to get the Code and\n            // Message from an error.\n            fmt.Println(\"error 2\")\n            fmt.Println(err.Error())\n        }\n        return\n    }\n    //fmt.Println(\"good\")\n    fmt.Println(result)\n\n}\n</code></pre>\n\n<p>and here is the lambda function itself:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/go-redis/redis\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n    \"log\"\n    \"os\"\n    \"time\"\n)\n\ntype Event struct {\n    RedisPairs      []RedisPair\n    GroupId         string      `json:\"group_id\"`\n}\n\ntype Response struct {\n    Message        string    `json:\"message\"`\n    Ok            bool    `json:\"ok\"`\n}\n\ntype RedisPair struct {\n    RedisKey   string `json:\"redis_key\"`\n    RedisValue string `json:\"redis_value\"`\n}\n\nfunc redis_pipeline(batch Event) (Response, error) {\n\n    clientrds := redis.NewClient(&amp;redis.Options{\n        Addr:         os.Getenv(\"REDIS_HOST\") + \":6379\",\n        DialTimeout:  10 * time.Second,\n        ReadTimeout:  30 * time.Second,\n        WriteTimeout: 30 * time.Second,\n        PoolSize:     100,\n        PoolTimeout:  30 * time.Second,\n    })\n    clientrds.FlushDB()\n\n    log.Print(\"start pipe\")\n\n    pipe := clientrds.Pipeline()\n\n    var response Response\n\n    log.Print(\"starting range lop\")\n\n    for b := range batch.RedisPairs {\n        //fmt.Println(\"adding\", batch.RedisPairs[b].RedisKey, batch.RedisPairs[b].RedisValue)\n        pipe.Set(batch.RedisPairs[b].RedisKey, batch.RedisPairs[b].RedisValue, 0)\n    }\n\n    //fmt.Println(uuid, \"...time now start: \", time.Now(), \", start time: \", startTime)\n    log.Print(\"write to redis\")\n    _, err := pipe.Exec()\n    if err != nil {\n\n        log.Print(\"points error\")\n        response = Response{\n            Message: err.Error(),\n            Ok:         false,\n        }\n    } else {\n\n        log.Print(\"points written\")\n        response = Response{\n            Message: \"Points wrttien!\",\n            Ok:         true,\n        }\n    }\n\n    log.Print(\"close pipe\")\n\n    pipe.Close()\n\n    return response, err\n\n}\n\nfunc main() {\n    log.Print(\"start main v2\")\n    lambda.Start(redis_pipeline)\n}\n</code></pre>\n\n<p>when I invoke lambda via the first function, the lambda logs show this every time I invoke the function:</p>\n\n<pre><code>invalid character ')' after top-level value: SyntaxError\nnull\n</code></pre>\n\n<p>If I output <code>RedisBatch</code> struct to a file in the first function, and use that output to manually test the lambda function via the aws console, it works successfully then. the output looks like this too:</p>\n\n<pre><code>{\n  \"RedisPairs\": [\n    {\n      \"redis_key\": \"kafka9\", \n      \"redis_value\": \"{\\\"metric_value_number\\\":1,\\\"path\\\":\\\"/sdp/sw/logstashjmx/jmxcfgs\\\",\\\"cluster\\\":\\\"card01\\\",\\\"@timestamp\\\":\\\"2018-05-17T08:32:50.035Z\\\",\\\"@version\\\":\\\"1\\\",\\\"host\\\":\\\"localhost\\\",\\\"metric_path\\\":\\\"dsdpecard01kfk05.kafka.log:type=Log,name=NumLogSegments,topic=private.topic.lsrp.created.v1,partition=4.Value\\\",\\\"type\\\":null,\\\"region\\\":\\\"us-east-1\\\"}\\n\"\n    }, \n    {\n      \"redis_key\": \"kafka10\", \n      \"redis_value\": \"{\\\"metric_value_number\\\":1,\\\"path\\\":\\\"/sdp/sw/logstashjmx/jmxcfgs\\\",\\\"cluster\\\":\\\"card01\\\",\\\"@timestamp\\\":\\\"2018-05-17T08:32:50.045Z\\\",\\\"@version\\\":\\\"1\\\",\\\"host\\\":\\\"localhost\\\",\\\"metric_path\\\":\\\"dsdpecard01kfk05.kafka.log:type=Log,name=NumLogSegments,topic=credit-topic.v1,partition=6.Value\\\",\\\"type\\\":null,\\\"region\\\":\\\"us-east-1\\\"}\\n\"\n    }, \n    {\n      \"redis_key\": \"kafka1\", \n      \"redis_value\": \"{\\\"metric_value_number\\\":0,\\\"path\\\":\\\"/sdp/sw/logstashjmx/jmxcfgs\\\",\\\"cluster\\\":\\\"card01\\\",\\\"@timestamp\\\":\\\"2018-05-17T08:32:50.063Z\\\",\\\"@version\\\":\\\"1\\\",\\\"host\\\":\\\"localhost\\\",\\\"metric_path\\\":\\\"dsdpecard01kfk05.kafka.log:type=Log,name=LogEndOffset,topic=credit.test1122.created.v1,partition=3.Value\\\",\\\"type\\\":null,\\\"region\\\":\\\"us-east-1\\\"}\\n\"\n    }, \n    {\n      \"redis_key\": \"kafka2\", \n      \"redis_value\": \"{\\\"metric_value_number\\\":0,\\\"path\\\":\\\"/sdp/sw/logstashjmx/jmxcfgs\\\",\\\"cluster\\\":\\\"card01\\\",\\\"@timestamp\\\":\\\"2018-05-17T08:32:50.074Z\\\",\\\"@version\\\":\\\"1\\\",\\\"host\\\":\\\"localhost\\\",\\\"metric_path\\\":\\\"dsdpecard01kfk05.kafka.log:type=Log,name=LogEndOffset,topic=connect-offsets-east,partition=9.Value\\\",\\\"type\\\":null,\\\"region\\\":\\\"us-east-1\\\"}\\n\"\n    }, \n    {\n      \"redis_key\": \"kafka3\", \n      \"redis_value\": \"{\\\"metric_value_number\\\":0,\\\"path\\\":\\\"/sdp/sw/logstashjmx/jmxcfgs\\\",\\\"cluster\\\":\\\"card01\\\",\\\"@timestamp\\\":\\\"2018-05-17T08:32:50.085Z\\\",\\\"@version\\\":\\\"1\\\",\\\"host\\\":\\\"localhost\\\",\\\"metric_path\\\":\\\"dsdpecard01kfk05.kafka.log:type=Log,name=Size,topic=credit-uxtest2.created.v1,partition=9.Value\\\",\\\"type\\\":null,\\\"region\\\":\\\"us-east-1\\\"}\\n\"\n    }, \n    {\n      \"redis_key\": \"kafka5\", \n      \"redis_value\": \"{\\\"metric_value_number\\\":60,\\\"path\\\":\\\"/sdp/sw/logstashjmx/jmxcfgs\\\",\\\"cluster\\\":\\\"card01\\\",\\\"@timestamp\\\":\\\"2018-05-17T08:32:50.097Z\\\",\\\"@version\\\":\\\"1\\\",\\\"host\\\":\\\"localhost\\\",\\\"metric_path\\\":\\\"dsdpecard01kfk05.kafka.log:type=Log,name=LogEndOffset,topic=rte.enrichment.rules,partition=7.Value\\\",\\\"type\\\":null,\\\"region\\\":\\\"us-east-1\\\"}\\n\"\n    }\n  ], \n  \"group_id\": \"testehb4\"\n}\n</code></pre>\n\n<p>why does it work when I manually output the data and test it, but not when I invoke the function programmatically?</p>\n\n<p>-----EDIT------</p>\n\n<p>just realized this works with the <code>Event</code> invocation type but not <code>RequestResponse</code> type. Whats the difference in how you send the payload between the two? can't seem to find the right docs for it or an example...</p>\n"}, {"tags": ["go", "go-map"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1526748125, "post_id": 50427411, "comment_id": 87869506, "body": "Because the length of slice is 0 so you cannot append to it"}, {"owner": {"reputation": 639, "user_id": 942236, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8fd79818fb74188fbd547baf5e2dabe0?s=128&d=identicon&r=PG", "display_name": "maxflow", "link": "https://stackoverflow.com/users/942236/maxflow"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1526748229, "post_id": 50427411, "comment_id": 87869541, "body": "@Himanshu isn&#39;t the purpose of append to dynamically change size of slice? i tried graph := [][]int{} and that doesn&#39;t work either."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1526748288, "post_id": 50427411, "comment_id": 87869565, "body": "yes it does but you have to set its key first since its two dimension slice that&#39;s why the error."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 2, "last_activity_date": 1529489679, "last_edit_date": 1529489679, "creation_date": 1526748384, "answer_id": 50427473, "question_id": 50427411, "link": "https://stackoverflow.com/questions/50427411/slice-out-of-bounds-using-int-but-works-with-mapintint/50427473#50427473", "title": "Slice out of bounds using [][]int but works with map[int][]int", "body": "<p>The code panics due to slice length being <code>0</code>. If you want to append anything to the slice, you just have to provide its length as below.</p>\n\n<pre><code>graph := make([][]int, 1)\nfmt.Println(len(graph))\ngraph[0] = append(graph[0], 1)\nfmt.Println(graph)\n</code></pre>\n\n<p>To append data to a slice at first level, append to its first index and then append to second level just like below.</p>\n\n<pre><code>graph := make([][]int, 0)\nfmt.Println(len(graph))\ngraph = append(graph, []int{1})\n</code></pre>\n\n<p>Check <a href=\"https://play.golang.org/p/Uzt77tFl_Eq\" rel=\"nofollow noreferrer\">Playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 6, "last_activity_date": 1526748994, "creation_date": 1526748994, "answer_id": 50427557, "question_id": 50427411, "link": "https://stackoverflow.com/questions/50427411/slice-out-of-bounds-using-int-but-works-with-mapintint/50427557#50427557", "title": "Slice out of bounds using [][]int but works with map[int][]int", "body": "<p>Lets simplify your code, to make it more obvious what's happening (<a href=\"https://play.golang.org/p/M85Qo8lW_0N\" rel=\"noreferrer\">Playground link</a>):</p>\n\n<pre><code>graph1 := make(map[int]int, 0)\ngraph2 := make([]int, 0)\n\nx := graph1[0] // Success\ny := graph2[0] // Panic\n</code></pre>\n\n<p>From this we see that the difference is due to <code>map[int]</code> vs <code>[]int</code> -- the second array in your type is actually irrelevant.</p>\n\n<p>Now to understand why this is happening, we need to understand how Go handles map and slice access.  From <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"noreferrer\">Go Maps in Action</a> we learn:</p>\n\n<blockquote>\n  <p>If the requested key doesn't exist, we get the value type's <em>zero value</em>.</p>\n</blockquote>\n\n<p>In your original code, the zero value for a slice (<code>[]int</code>), is <code>nil</code>, and <code>append()</code> treats <code>nil</code> as the first argument as an empty slice.</p>\n\n<p>But when we try to access the <em>0th</em> element of an empty slice, we get a panic, because the slice is empty.</p>\n\n<p>In summary, <code>append</code> and the second slice of your type are both red herrings in your question. The panic happens when trying to access the non-existent element in the first dimension of your slice.</p>\n"}, {"tags": [], "owner": {"reputation": 9345, "user_id": 4237316, "user_type": "registered", "accept_rate": 47, "profile_image": "https://graph.facebook.com/100004533998341/picture?type=large", "display_name": "Harald Nordgren", "link": "https://stackoverflow.com/users/4237316/harald-nordgren"}, "is_accepted": false, "score": 1, "last_activity_date": 1526749563, "last_edit_date": 1526749563, "creation_date": 1526749258, "answer_id": 50427604, "question_id": 50427411, "link": "https://stackoverflow.com/questions/50427411/slice-out-of-bounds-using-int-but-works-with-mapintint/50427604#50427604", "title": "Slice out of bounds using [][]int but works with map[int][]int", "body": "<p><code>make(map[int][]int, 0)</code> creates a <code>map</code> of <code>[]int</code>.</p>\n\n<p>By design in Go you can get any element from a map. And if it doesn't exist you receive the \"zero\" value which here is an empty slice.</p>\n\n<pre><code>graph := make(map[int][]int)\n\ngraph[4] = append(graph[4], 1)\ngraph[7] = append([]int{}, 1, 2)\ngraph[11] = append([]int{1, 2, 3}, 4, 5)\n</code></pre>\n\n<p>printing it gives this slice:</p>\n\n<pre><code>fmt.Printf(\"%#v\\n\", graph)\n\nmap[int][]int{\n    4:[]int{1},\n    7:[]int{1, 2},\n    11:[]int{1, 2, 3, 4, 5},\n}\n</code></pre>\n\n<p>Your second example create an empty slice of <code>[]int</code> slices. Slices work differently from maps, so indexing an element that doesn't exist will give you a panic.</p>\n"}, {"tags": [], "owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "is_accepted": true, "score": 2, "last_activity_date": 1526824247, "last_edit_date": 1526824247, "creation_date": 1526750078, "answer_id": 50427718, "question_id": 50427411, "link": "https://stackoverflow.com/questions/50427411/slice-out-of-bounds-using-int-but-works-with-mapintint/50427718#50427718", "title": "Slice out of bounds using [][]int but works with map[int][]int", "body": "<p>When you do make in <code>graph := make(map[int][]int, 0)</code>, you are allocating memory to your map, not to array. So you might do this only \n<code>graph := make(map[int][]int)</code>.</p>\n\n<p>Decomping you code:</p>\n\n<pre><code>type a []int\ntype m map[int]a\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n\n    //decomping graph := make(map[int][]int, 0)\n    graph := make(m)\n\n    //map is empty\n    fmt.Println(len(graph))\n\n    //decomping graph[0] := append(graph[0], 1)\n    itm_a := 1\n    arr_a := []int{}\n\n    //appeding item to \"a\" type\n    arr_a = append(arr_a, itm_a)\n\n    //appending array of a to graph\n    graph[0] = arr_a\n\n    //print graph\n    fmt.Println(graph)\n}\n</code></pre>\n\n<p>See in <a href=\"https://play.golang.org/p/BmMeM-2t0Xh\" rel=\"nofollow noreferrer\">playground</a>.</p>\n\n<p>The error that you are getting is caused for conceptual error. \nWhen you does <code>graph := make([][]int, 0)</code>, you are allocation memory to a slice of slice, not an array. See in <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-slices-usage-and-internals</a>.</p>\n\n<p>So you can does this (decomping solution):</p>\n\n<pre><code>type a []int\ntype m []a\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n\n    //decomping graph := make([][]int, 0)\n    //see that you must be set the length\n    graph := make(m, 0)\n\n    //map is empty\n    fmt.Println(len(graph))\n\n    //this is incorrect: graph[0] := append(graph[0], 1)\n    //this is correct:   graph[0] := append(graph[0], []int{1})\n    //see:\n    itm_a := 1\n    arr_a := []int{}\n\n    //appeding item to \"a\" type\n    arr_a = append(arr_a, itm_a)\n\n    //appending slice of a to graph (slice)\n    graph = append(graph, arr_a)\n\n    //print graph\n    fmt.Println(graph)\n}\n</code></pre>\n\n<p>See in <a href=\"https://play.golang.org/p/wtSGKzwwEPL\" rel=\"nofollow noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 639, "user_id": 942236, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8fd79818fb74188fbd547baf5e2dabe0?s=128&d=identicon&r=PG", "display_name": "maxflow", "link": "https://stackoverflow.com/users/942236/maxflow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 50427718, "answer_count": 4, "score": 1, "last_activity_date": 1531404512, "creation_date": 1526747881, "last_edit_date": 1531404512, "question_id": 50427411, "link": "https://stackoverflow.com/questions/50427411/slice-out-of-bounds-using-int-but-works-with-mapintint", "title": "Slice out of bounds using [][]int but works with map[int][]int", "body": "<p>Why does this code work</p>\n\n<pre><code>graph := make(map[int][]int, 0)\n\ngraph[0] = append(graph[0], 1)\n</code></pre>\n\n<p>But if you replace first line with <code>graph := make([][]int, 0)</code> I get <code>panic: runtime error: index out of range</code>? It's very weird.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 8, "last_activity_date": 1526843188, "last_edit_date": 1526843188, "creation_date": 1526745723, "answer_id": 50427102, "question_id": 50426955, "link": "https://stackoverflow.com/questions/50426955/net-ip-as-map-key-type-in-golang/50427102#50427102", "title": "net.IP as map key type in golang?", "body": "<p>A <a href=\"https://godoc.org/net#IP\" rel=\"noreferrer\">net.IP</a> is a slice type.  Because slices are mutable, they cannot be used as map keys. Use a string as the key type:</p>\n\n<pre><code>MapOfValues map[string]chan string\n</code></pre>\n\n<p>Use a <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">type conversion</a> to convert from net.IP to string and back. Use <a href=\"https://godoc.org/net#IP.To4\" rel=\"noreferrer\">IP.To16</a> to normalize addresses to the 16 byte representation.</p>\n\n<pre><code>x.MapOfValues[string(ip.To16())] = v\n\nfor k, v := range x.MapOfValues {\n   ip := net.IP(k) // convert string to net.IP\n   ...\n}\n</code></pre>\n\n<p>If you want the keys to be printable, then use the <a href=\"https://godoc.org/net#IP.String\" rel=\"noreferrer\">IP.String</a> and <a href=\"https://godoc.org/net#ParseIP\" rel=\"noreferrer\">net.ParseIP</a> functions to do the conversions:</p>\n\n<pre><code>x.MapOfValues[ip.String()] = v\n\nfor k, v := range x.MapOfValues {\n   ip := net.ParseIP(k) \n   ...\n}\n</code></pre>\n"}], "owner": {"reputation": 182, "user_id": 6602000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e5dcac1b0f7352f6750312830062607?s=128&d=identicon&r=PG&f=1", "display_name": "Ronin Goda", "link": "https://stackoverflow.com/users/6602000/ronin-goda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2277, "favorite_count": 0, "accepted_answer_id": 50427102, "answer_count": 1, "score": 6, "last_activity_date": 1526843188, "creation_date": 1526744629, "last_edit_date": 1526753272, "question_id": 50426955, "link": "https://stackoverflow.com/questions/50426955/net-ip-as-map-key-type-in-golang", "title": "net.IP as map key type in golang?", "body": "<p>I have map with key as net.IP and value as a channel.\nBut I'm getting a weird compile time error (invalid map key type)</p>\n\n<pre><code>17 type UdpServer struct {\n18     ListenPort int\n19\n20     ConnRef *net.UDPConn\n21     Log_ref *Logger\n22     MapOfValues map[net.IP]chan string\n23 }\n\n\n$ go build c-manager.go\ncmanager/c-udp_server.go:22:14: invalid map key type net.IP\n\n$ go version\n  go version go1.10.2 linux/amd64\n</code></pre>\n\n<p>What am I doing wrong? Can't we have net.IP as map key type?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526739632, "post_id": 50426204, "comment_id": 87867073, "body": "Starting an unlimited number of goroutines is usually not a good idea.  A better approach is to start a fixed number of goroutines that search for a solution."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9772923"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526740396, "post_id": 50426204, "comment_id": 87867319, "body": "I don\u2019t actually want an infinite number of goroutines but rather to continue adding racers until one of them wins and then discard all the losers."}, {"owner": {"reputation": 813, "user_id": 2318227, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/87b41d9768dc83f751f5e49d16d6bb06?s=128&d=identicon&r=PG", "display_name": "Naveen Kumar", "link": "https://stackoverflow.com/users/2318227/naveen-kumar"}, "edited": false, "score": 0, "creation_date": 1526740436, "post_id": 50426204, "comment_id": 87867328, "body": "if the 1st for loop is infinite, then the program control will not come out of it at all and you will be generating infinite number of go routines ."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9772923"}, "edited": false, "score": 0, "creation_date": 1526740689, "post_id": 50426204, "comment_id": 87867404, "body": "Perhaps I should simply try N racers and if there are still no winners at the end of the race then have another race (start another loop). Basically I am trying to refactor a recursive function with go routines and channels."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1526740792, "post_id": 50426204, "comment_id": 87867439, "body": "use quit for sending value on a channel to quit"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9772923"}, "edited": false, "score": 0, "creation_date": 1526750019, "post_id": 50426454, "comment_id": 87870066, "body": "Unfortunately like the code posted in my question this doesn&#39;t solve the recursion problem."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526750679, "post_id": 50426454, "comment_id": 87870241, "body": "@malablaster I answered the question as posed. Update the question to explain your requirements including an example that reflects those requirements. Nothing in the question indicates that recursion is required."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9772923"}, "edited": false, "score": 0, "creation_date": 1526756692, "post_id": 50426454, "comment_id": 87871863, "body": "Recursion is mentioned in the comments. I\u2019m not seeing what value your solution adds over my original code. Could you elaborate?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1526757859, "post_id": 50426454, "comment_id": 87872143, "body": "@malablaster the value added is that this solution actually works... you&#39;ll have to elaborate on what difference it makes that your function is recursive. I can&#39;t see how that would change anything."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526758818, "post_id": 50426454, "comment_id": 87872377, "body": "@malablaster The comment says that you are refactoring a recursive function. That does not imply that recursion is required, nor does it provide enough information to answer your question.  For example, I don&#39;t know if the recursion is in <code>myFunc</code> or <code>someOp</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526759010, "post_id": 50426454, "comment_id": 87872421, "body": "The code in the question calls <code>someOp</code> ten times and leaks goroutines if more than one call to <code>someOp</code>  returns a value &gt; .9.  The code in this answer calls <code>someOp</code> until a result is found and does not leak goroutines."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9772923"}, "edited": false, "score": 0, "creation_date": 1526763456, "post_id": 50426454, "comment_id": 87873507, "body": "@ThunderCat I&#39;m not clear on what you mean by leaks goroutines since I believe they&#39;ll be abandoned and GC&#39;d.  Recursion does matter: what happens in your solution if 10 iterations occur without a solution?  I had assumed the recursion in <code>myFunc</code> was evident because of the talk of an infinite loop but I think I was wrong it wasn&#39;t clear."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9772923"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1526763578, "post_id": 50426454, "comment_id": 87873540, "body": "@RayfenWindspear The original code works too. See above comment for the significance of recursion."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1526763764, "post_id": 50426454, "comment_id": 87873588, "body": "@malablaster you mention recursion, but the significance in unclear. In response to your question to ThunderCat, it doesn&#39;t run 10 iterations, it runs 10 gouroutines which run infinitely until one spits out a value, then they all quit. Notice the inner for loop is an infinite one, but will return when finished. See this example I made it harder and printed. <a href=\"https://play.golang.org/p/DfbUkkZT4TD\" rel=\"nofollow noreferrer\">play.golang.org/p/DfbUkkZT4TD</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9772923"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1526763944, "post_id": 50426454, "comment_id": 87873642, "body": "@RayfenWindspear I see. My mistake I didn&#39;t get that before; my eye glossed over the <code>for</code> loop in there. Ok now I get the value. Yes that is a good approach. Run 10 things infinitely rather than (trying to add) infinite things that run once."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9772923"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1526765502, "post_id": 50426454, "comment_id": 87873979, "body": "Thanks @rayfenwindspear and thundercat for your help. I\u2019m new to concurrency thinking but regardless I now realize how silly what i was trying to do was."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526765591, "post_id": 50426454, "comment_id": 87873994, "body": "@malablaster See <a href=\"https://play.golang.org/p/t3YbfS_QQ9a\" rel=\"nofollow noreferrer\">play.golang.org/p/t3YbfS_QQ9a</a> for demonstration of leak.  First goroutine to send on channel is successful and returns.  Subsequent goroutines to send on channel block and leak."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9772923"}, "edited": false, "score": 0, "creation_date": 1526909723, "post_id": 50426454, "comment_id": 87913240, "body": "@ThunderCat Isn&#39;t it the same problem in your solution though? It seems to me like all 10 goroutines still run in spite of the first one getting the answer: <a href=\"https://play.golang.org/p/euwolBx6rCh\" rel=\"nofollow noreferrer\">play.golang.org/p/euwolBx6rCh</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1526909915, "post_id": 50426454, "comment_id": 87913344, "body": "The playground  link in previous comment does not show if goroutines exit or not. The answer uses select w/ default to avoid leak present in the question.   <a href=\"https://play.golang.org/p/VNJmM2BM29Y\" rel=\"nofollow noreferrer\">play.golang.org/p/VNJmM2BM29Y</a>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1526741184, "last_edit_date": 1526741184, "creation_date": 1526740816, "answer_id": 50426454, "question_id": 50426204, "link": "https://stackoverflow.com/questions/50426204/infinite-goroutines-until-received-desired-response/50426454#50426454", "title": "Infinite goroutines until received desired response", "body": "<p>Starting an unlimited number of goroutines is usually not a good idea. A better approach is to start a fixed number of goroutines that loop looking for an answer. Return from these goroutines when an answer is found.</p>\n\n<pre><code>func myFunc() float64 {\n    c := make(chan float64, 1) // Size 1 prevents race between main goroutine and workers\n\n    done := make(chan struct{})\n    defer close(done)\n\n    // Start a fixed number of goroutines\n    for i := 0; i &lt; 10; i++ {\n        go func() {\n            for {\n                select {\n                case &lt;-done:\n                    // myfunc exited with result, return from this goroutine\n                    return\n                default:\n                    var value float64\n                    value = someOp()\n                    if value &gt; .9 {\n                        select {\n                        case c &lt;- value:\n                            // This is first goroutine to send a value\n                        default:\n                            // Another goroutine sent a value\n                        }\n                        return\n                    }\n\n                }\n            }\n        }()\n    }\n    return &lt;-c\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/SRpeT8k34eA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/SRpeT8k34eA</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9772923"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 50426454, "answer_count": 1, "score": 0, "last_activity_date": 1526741184, "creation_date": 1526739099, "question_id": 50426204, "link": "https://stackoverflow.com/questions/50426204/infinite-goroutines-until-received-desired-response", "title": "Infinite goroutines until received desired response", "body": "<p>I'm trying launch goroutines in an infinite loop until I get the response I'm looking for but the <code>select</code> is unreachable if I change <code>for i := 0; i &lt; 10; i++ {}</code> to <code>for {}</code>. What's a pattern for solving this?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc myFunc() float64 {\n\n    c := make(chan float64)\n\n    for i := 0; i &lt; 10; i++ {\n        go func() {\n\n            var value float64\n            value = someOp()\n\n            if value &gt; .9 {\n                c &lt;- value\n            }\n\n        }()\n    }\n\n    // unreachable code the if the for loop above is infinite\n    for {\n        select {\n        case x := &lt;-c:\n            return x\n        default:\n        }\n    }\n\n}\n\nfunc someOp() float64 {\n    rand.Seed(time.Now().UnixNano())\n    return rand.Float64()\n}\n\nfunc main() {\n    fmt.Println(myFunc())\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526732362, "post_id": 50425180, "comment_id": 87865125, "body": "There&#39;s no direct answer to that question. It depends on what you&#39;re trying to do. In many cases, <code>io.Copy</code> is perfect for that task--but it would typically be run in a goroutine."}, {"owner": {"reputation": 15832, "user_id": 1156707, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/99055b620fb3a9d30a8f6ac480c25227?s=128&d=identicon&r=PG", "display_name": "Louis Thibault", "link": "https://stackoverflow.com/users/1156707/louis-thibault"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526732795, "post_id": 50425180, "comment_id": 87865210, "body": "@Flimzy &quot;In many cases, io.Copy is perfect for that task&quot; -- well no, since an unbounded stream won&#39;t ever EOF.  What i&#39;m looking to do is roughly &quot;put bytes in some buffer as they arrive, and have a separate goroutine read from the same buffer concurrently&quot;.  It sounds like <code>bytes.Buffer</code> isn&#39;t quite the circular buffer I&#39;d imagined."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526732886, "post_id": 50425180, "comment_id": 87865229, "body": "In many cases, <code>io.Copy</code> <i>is</i> perfect for the task. Your case may not be one of these. :)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526732937, "post_id": 50425180, "comment_id": 87865243, "body": "I don&#39;t know what this separate goroutine is doing with these bytes, but it sounds like you should just have that goroutine read directly from the stream, with no intermediate <code>io.Copy</code> or anything else."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1526732817, "last_edit_date": 1526732817, "creation_date": 1526732309, "answer_id": 50425231, "question_id": 50425180, "link": "https://stackoverflow.com/questions/50425180/why-does-io-copy-provoke-a-networkidletimeout-error/50425231#50425231", "title": "Why does io.Copy provoke a NetworkIdleTimeout error?", "body": "<p>This isn't related to your use of <code>bytes.Buffer</code>. Rather, <code>io.Copy</code> waits for EOF. <code>Read</code> just reads what's present at the moment. If your stream is never closed, <code>io.Copy</code> will never finish.</p>\n\n<p>This means that, all else being equal, the timeout will occur regardless of your use of <code>io.Copy</code> or <code>Read</code>--you just may not notice it when using <code>Read</code>, because <code>Read</code> returns immediately, and the timeout only happens 30 seconds later.</p>\n"}], "owner": {"reputation": 15832, "user_id": 1156707, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/99055b620fb3a9d30a8f6ac480c25227?s=128&d=identicon&r=PG", "display_name": "Louis Thibault", "link": "https://stackoverflow.com/users/1156707/louis-thibault"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 0, "accepted_answer_id": 50425231, "answer_count": 1, "score": 0, "last_activity_date": 1526732817, "creation_date": 1526731920, "question_id": 50425180, "link": "https://stackoverflow.com/questions/50425180/why-does-io-copy-provoke-a-networkidletimeout-error", "title": "Why does io.Copy provoke a NetworkIdleTimeout error?", "body": "<p>please consider the runnable example below.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"encoding/pem\"\n    \"io\"\n    \"log\"\n    \"math/big\"\n    \"time\"\n\n    quic \"github.com/lucas-clemente/quic-go\"\n)\n\n// var qc = &amp;quic.Config{Versions: []quic.VersionNumber{101}}\nvar qc *quic.Config\n\n// GenerateTLSConfig creates bare-bones TLS config for the server\nfunc GenerateTLSConfig() *tls.Config {\n    key, err := rsa.GenerateKey(rand.Reader, 1024)\n    if err != nil {\n        panic(err)\n    }\n\n    // generate a random serial number (a real cert authority would have some logic behind this)\n    serialNumberLimit := new(big.Int).Lsh(big.NewInt(1), 128)\n    serialNumber, err := rand.Int(rand.Reader, serialNumberLimit)\n    if err != nil {\n        panic(\"failed to generate serial number: \" + err.Error())\n    }\n\n    template := x509.Certificate{\n        SerialNumber: serialNumber,\n        // DNSNames:              []string{\"localhost\"}, // keep mint happy\n        NotBefore:             time.Now(),\n        NotAfter:              time.Now().Add(time.Hour * 87600), // in 10 years\n        BasicConstraintsValid: true,\n    }\n    certDER, err := x509.CreateCertificate(rand.Reader, &amp;template, &amp;template, &amp;key.PublicKey, key)\n    if err != nil {\n        panic(err)\n    }\n    keyPEM := pem.EncodeToMemory(&amp;pem.Block{Type: \"RSA PRIVATE KEY\", Bytes: x509.MarshalPKCS1PrivateKey(key)})\n    certPEM := pem.EncodeToMemory(&amp;pem.Block{Type: \"CERTIFICATE\", Bytes: certDER})\n\n    tlsCert, err := tls.X509KeyPair(certPEM, keyPEM)\n    if err != nil {\n        panic(err)\n    }\n    return &amp;tls.Config{\n        Certificates:       []tls.Certificate{tlsCert},\n        InsecureSkipVerify: true,\n    }\n}\n\nfunc server() (quic.Listener, error) {\n    return quic.ListenAddr(\"localhost:9001\", GenerateTLSConfig(), qc)\n}\n\nfunc accept(l quic.Listener) (quic.Session, error) {\n    return l.Accept()\n}\n\nfunc acceptStream(sess quic.Session) (quic.Stream, error) {\n    return sess.AcceptStream()\n}\n\nfunc client() (quic.Session, error) {\n    return quic.DialAddr(\"localhost:9001\", GenerateTLSConfig(), qc)\n}\n\nfunc openStream(sess quic.Session) (quic.Stream, error) {\n    return sess.OpenStreamSync()\n}\n\nfunc main() {\n    ch := make(chan struct{})\n\n    go func() {\n        l, err := server()\n        if err != nil {\n            log.Fatal(\"failed to listen:\", err)\n        }\n\n        sess, err := accept(l)\n        if err != nil {\n            log.Fatal(\"failed to accept session:\", err)\n        }\n\n        s, err := acceptStream(sess)\n        if err != nil {\n            log.Fatal(\"failed to accept stream:\", err)\n        }\n\n        log.Println(\"stream accepted\")\n\n        // b := make([]byte, len(\"hello, world\"))\n        // if _, err = s.Read(b); err != nil {\n        //  log.Fatal(\"failed to read from stream:\", err)\n        // }\n        // log.Println(string(b))\n\n        buf := bytes.NewBuffer(make([]byte, len(\"hello, world\")))\n        if _, err = io.Copy(buf, s); err != nil {\n            log.Fatal(\"failed to read from stream:\", err)\n        }\n        log.Println(buf.String())\n\n        close(ch)\n    }()\n\n    sess, err := client()\n    if err != nil {\n        log.Fatal(\"failed to dial:\", err)\n    }\n\n    s, err := openStream(sess)\n    if err != nil {\n        log.Fatal(\"failed to open stream:\", err)\n    }\n\n    log.Print(\"writing\")\n    if _, err = io.Copy(s, bytes.NewBuffer([]byte(\"hello, world\"))); err != nil {\n        log.Fatal(\"failed to write:\", err)\n    }\n    log.Print(\"wrote\")\n\n    &lt;-ch\n}\n</code></pre>\n\n<p>Running this example will produce the following output:</p>\n\n<pre><code>$ go run cmd/scratch/main.go                                                                                                    (656ms)\n2018/05/19 13:09:17 writing\n2018/05/19 13:09:17 wrote\n2018/05/19 13:09:17 stream accepted\n2018/05/19 13:09:47 failed to read from stream:NetworkIdleTimeout: No recent network activity.\nexit status 1\n</code></pre>\n\n<p>changing</p>\n\n<pre><code>buf := bytes.NewBuffer(make([]byte, len(\"hello, world\")))\nif _, err = io.Copy(buf, s); err != nil {\n    log.Fatal(\"failed to read from stream:\", err)\n}\nlog.Println(buf.String())\n</code></pre>\n\n<p>to </p>\n\n<pre><code>b := make([]byte, len(\"hello, world\"))\nif _, err = s.Read(b); err != nil {\n    log.Fatal(\"failed to read from stream:\", err)\n}\nlog.Println(string(b))\n</code></pre>\n\n<p>seems to fix the issue.</p>\n\n<h1>Question:</h1>\n\n<p>Why doesn't using <code>io.Copy</code> with a <code>bytes.Buffer</code> work in this case?</p>\n"}, {"tags": ["go", "struct", "comparison"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1526718294, "post_id": 50423265, "comment_id": 87861386, "body": "In any case, please show your best attempt, and explain how you want to see it improved. This type of question might be better suited for <a href=\"https://codereview.stackexchange.com/\">Code Review</a>, however."}], "answers": [{"comments": [{"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 1, "creation_date": 1526721997, "post_id": 50423720, "comment_id": 87862245, "body": "Great answer! Definitely cleaner than my solution (given all fields are comparable)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1526723818, "post_id": 50423720, "comment_id": 87862769, "body": "@EmilePels If there are uncomparable fields, comparing with <code>reflect.DeepEqual()</code> is still simpler, &quot;safer&quot; and more universal."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1526723723, "last_edit_date": 1526723723, "creation_date": 1526721774, "answer_id": 50423720, "question_id": 50423265, "link": "https://stackoverflow.com/questions/50423265/check-if-every-item-in-a-struct-is-unchanged/50423720#50423720", "title": "Check if every item in a struct is unchanged", "body": "<p>Struct values are comparable if all their fields are comparable (see <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">Spec: Comparison operators</a>). And since in your case this holds, we can take advantage of this.</p>\n\n<p>In your case the simplest and most efficient way to achieve this is to save a struct value holding the initial value, and whenever you want to tell if a struct value (if any of its fields) has changed, simply compare it to the saved, initial value. This is all it takes:</p>\n\n<pre><code>var defaultState = InitState()\n\nfunc isUnchanged(s State) bool {\n    return s == defaultState\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>s := InitState()\nfmt.Println(isUnchanged(s))\n\ns.Threads = 1\nfmt.Println(isUnchanged(s))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/fZxxdq4Lyiu\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>true\nfalse\n</code></pre>\n\n<p>Note that this solution will still work without any modification if you change the <code>State</code> type by adding / removing / renaming / rearranging fields as long as they all will still be comparable. As a counter example, if you add a field of slice type, it won't work anymore as slices are not comparable. It will result in a compile-time error. To handle such cases, <a href=\"https://golang.org/pkg/reflect/#DeepEqual\" rel=\"nofollow noreferrer\"><code>reflect.DeepEqual()</code></a> might be used instead of the simple <code>==</code> comparison operator.</p>\n\n<p>Also note that you should create default values of <code>State</code> like this:</p>\n\n<pre><code>func NewState() State {\n    return State{Threads: 20}\n}\n</code></pre>\n\n<p>You don't have to list fields whose values are the zero values of their types.</p>\n"}], "owner": {"reputation": 8208, "user_id": 692572, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/tmid4.png?s=128&g=1", "display_name": "Michael A", "link": "https://stackoverflow.com/users/692572/michael-a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 50423720, "answer_count": 1, "score": 1, "last_activity_date": 1526723723, "creation_date": 1526718010, "last_edit_date": 1526721991, "question_id": 50423265, "link": "https://stackoverflow.com/questions/50423265/check-if-every-item-in-a-struct-is-unchanged", "title": "Check if every item in a struct is unchanged", "body": "<p>I have the following package:</p>\n\n<pre><code>// Contains state read in from the command line\ntype State struct {\n    Domain          string  // Domain to check for\n    DomainList      string  // File location for a list of domains\n    OutputNormal    string  // File to output in normal format\n    OutputDomains   string  // File to output domains only to\n    Verbose         bool    // Verbose prints, incl. Debug information\n    Threads         int     // Number of threads to use\n    NoColour        bool    // Strip colour from output\n    Silent          bool    // Output domains only\n    Usage           bool    // Print usage information\n}\n\nfunc InitState() (state State) {\n    return State { \"\", \"\", \"\", \"\", false, 20, false, false, false }\n}\n\nfunc ValidateState(s *State) (result bool, error string ) {\n    if s.Domain == \"\" &amp;&amp; s.DomainList == \"\" {\n        return false, \"You must specify either a domain or list of domains to test\"\n    }\n\n    return true, \"\"\n}\n</code></pre>\n\n<p>Within <code>ValidateState()</code> I would like to return true if every item in <code>State</code> is the same as what is defined in <code>InitState()</code>. I can see a few ways to do this, but nothing that seems concise. I would greatly value some direction!</p>\n"}, {"tags": ["go", "atomic"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 5, "last_activity_date": 1538114897, "last_edit_date": 1538114897, "creation_date": 1526718176, "answer_id": 50423286, "question_id": 50423209, "link": "https://stackoverflow.com/questions/50423209/how-to-convert-time-time-variable-to-atomic-in-go/50423286#50423286", "title": "How to convert time.Time variable to atomic in Go?", "body": "<p>This can't be done, as such, because <a href=\"https://golang.org/src/time/time.go?s=5813:6814#L106\" rel=\"nofollow noreferrer\"><code>time.Time</code></a> is a compound type:</p>\n\n<pre><code>type Time struct {\n    // wall and ext encode the wall time seconds, wall time nanoseconds,\n    // and optional monotonic clock reading in nanoseconds.\n    //\n    // From high to low bit position, wall encodes a 1-bit flag (hasMonotonic),\n    // a 33-bit seconds field, and a 30-bit wall time nanoseconds field.\n    // The nanoseconds field is in the range [0, 999999999].\n    // If the hasMonotonic bit is 0, then the 33-bit field must be zero\n    // and the full signed 64-bit wall seconds since Jan 1 year 1 is stored in ext.\n    // If the hasMonotonic bit is 1, then the 33-bit field holds a 33-bit\n    // unsigned wall seconds since Jan 1 year 1885, and ext holds a\n    // signed 64-bit monotonic clock reading, nanoseconds since process start.\n    wall uint64\n    ext  int64\n\n    // loc specifies the Location that should be used to\n    // determine the minute, hour, month, day, and year\n    // that correspond to this Time.\n    // The nil location means UTC.\n    // All UTC times are represented with loc==nil, never loc==&amp;utcLoc.\n    loc *Location\n}\n</code></pre>\n\n<p>However, you can do this with pointers, so <code>*time.Time</code> would be possible, if this suits your needs. But of course, this is discouraged, by virtue of the fact that <code>atomic.LoadPointer</code> and <code>atomic.StorePointer</code> use the <code>unsafe</code> package to accomplish their magic.</p>\n\n<p>A much better approach, if it will work for you, is just to use a mutex to protect your value. There are many ways to do this, but one minimal example:</p>\n\n<pre><code>type MyTime struct {\n    t  time.Time\n    mu sync.RWMutex\n}\n\nfunc (t *MyTime) Time() time.Time {\n    t.mu.RLock()\n    defer t.mu.RUnlock()\n    return t.t\n}\n\nfunc (t *MyTime) SetTime(tm time.Time) {\n    t.mu.Lock()\n    defer t.mu.Unlock()\n    t.t = tm\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1718, "user_id": 102484, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4287b4d3f492373628c3972c6aec3180?s=128&d=identicon&r=PG", "display_name": "noonex", "link": "https://stackoverflow.com/users/102484/noonex"}, "is_accepted": false, "score": 3, "last_activity_date": 1527685414, "creation_date": 1527685414, "answer_id": 50605462, "question_id": 50423209, "link": "https://stackoverflow.com/questions/50423209/how-to-convert-time-time-variable-to-atomic-in-go/50605462#50605462", "title": "How to convert time.Time variable to atomic in Go?", "body": "<p>You can keep unix time <a href=\"https://golang.org/pkg/time/#example_Time_Unix\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#example_Time_Unix</a> as atomic which is int64. Then convert to go time after you've read atomic value.</p>\n"}], "owner": {"reputation": 555, "user_id": 8337498, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8b22e7b8121ee9ea74b80f0783247a02?s=128&d=identicon&r=PG&f=1", "display_name": "taraf", "link": "https://stackoverflow.com/users/8337498/taraf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1293, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1545063466, "creation_date": 1526717492, "last_edit_date": 1545063466, "question_id": 50423209, "link": "https://stackoverflow.com/questions/50423209/how-to-convert-time-time-variable-to-atomic-in-go", "title": "How to convert time.Time variable to atomic in Go?", "body": "<p>In my RESTFUL web service which is an online game, I'm storing starting time of every question in an global variable like this: <code>var MyTime time.Time</code> which I should update it after every level of the game. My application is distributed, so I want to make sure all of my apps are not updating it at the same time. That's why I've decided to make it atomic.\nActually I'm familiar with Golang <code>sync/atomic</code> package.\nI tried to use <code>atomic.LoadPointer()</code> method but it needs specific argument type which isn't safe. Do you any other way for this?</p>\n\n<p><strong>Update:</strong> \nOkay I solved my problem like this. \nI defined time variable as <code>atomic.Value</code> and used atomic Load and Store methods. This is the code: \n<code>var myTime atomic.Value\n myTime.Store(newTime)</code> and load <code>myTime.Load().(time.Time)</code>.</p>\n\n<p>Consider that Load() method returns interface, so you should write (time.Time) at the end in order to convert it to time.Time type.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 1, "user_id": 6743799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b228cd1ef5c77725b8125b930ba51512?s=128&d=identicon&r=PG&f=1", "display_name": "Csaba Dobo", "link": "https://stackoverflow.com/users/6743799/csaba-dobo"}, "edited": false, "score": 0, "creation_date": 1527067679, "post_id": 50423041, "comment_id": 87982319, "body": "My next question is about write: err = col.Insert(&amp;UserDetails{name: &quot;Example&quot;, phone: &quot;65 234 4321&quot;}) only insert ids, but not the actual data map[_id:ObjectIdHex(&quot;5b052ff3cd1d98d5dda89ed8&quot;)] what am I missing?"}, {"owner": {"reputation": 1, "user_id": 6743799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b228cd1ef5c77725b8125b930ba51512?s=128&d=identicon&r=PG&f=1", "display_name": "Csaba Dobo", "link": "https://stackoverflow.com/users/6743799/csaba-dobo"}, "edited": false, "score": 0, "creation_date": 1527078990, "post_id": 50423041, "comment_id": 87989985, "body": "Found the error: type UserDetails struct {         _id        bson.ObjectId <code>bson:&quot;_id,omitempty&quot;</code>         name    string         phone   string } name should be Name phone should be Phone and write also works!"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 6743799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b228cd1ef5c77725b8125b930ba51512?s=128&d=identicon&r=PG&f=1", "display_name": "Csaba Dobo", "link": "https://stackoverflow.com/users/6743799/csaba-dobo"}, "edited": false, "score": 0, "creation_date": 1526829176, "post_id": 50423145, "comment_id": 87886603, "body": "Anybody else with something tested?"}, {"owner": {"reputation": 1, "user_id": 6743799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b228cd1ef5c77725b8125b930ba51512?s=128&d=identicon&r=PG&f=1", "display_name": "Csaba Dobo", "link": "https://stackoverflow.com/users/6743799/csaba-dobo"}, "edited": false, "score": 0, "creation_date": 1526997581, "post_id": 50423145, "comment_id": 87952528, "body": "This is what I am getting: Database Name: myinfo Collection FullName: myinfo.userdetails Documents count: 2 {           } so it is empty"}], "tags": [], "owner": {"reputation": 509, "user_id": 1667722, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/357f75e7e6403c10721a5a79c45c3782?s=128&d=identicon&r=PG", "display_name": "Hank", "link": "https://stackoverflow.com/users/1667722/hank"}, "is_accepted": false, "score": 0, "last_activity_date": 1526717089, "creation_date": 1526717089, "answer_id": 50423145, "question_id": 50423041, "link": "https://stackoverflow.com/questions/50423041/mgo-mongodb-read-write-example/50423145#50423145", "title": "mgo mongodb read / write example", "body": "<p>Try this:</p>\n\n<pre><code>import (\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype UserDetails struct {\n    Id bson.ObjectId `bson:\"_id,omitempty\"`\n    UserId string `bson:\"user_id\"`\n    Password string `bson:\"password\"`\n}\nuserDetails := []UserDetails{}\nquery := bson.M{\n    \"user_id\": \"xxx\",\n    \"password\" :\"xxx\"\n}\nerr := col.Find(query).All(&amp;userDetails)\nif err != nil {\n    return\n}\nfor _, userDetail := range userDetails {\n    fmt.Println(userDetail)\n}\n</code></pre>\n\n<p>I haven't test this code. It's just an example.</p>\n"}, {"tags": [], "owner": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "is_accepted": false, "score": 0, "last_activity_date": 1526895046, "creation_date": 1526895046, "answer_id": 50445769, "question_id": 50423041, "link": "https://stackoverflow.com/questions/50423041/mgo-mongodb-read-write-example/50445769#50445769", "title": "mgo mongodb read / write example", "body": "<p>Here's fairly simple example of mgo package: <a href=\"https://gist.github.com/border/3489566\" rel=\"nofollow noreferrer\">https://gist.github.com/border/3489566</a></p>\n\n<p>I would suggest to go through the official documentation for details and references. <a href=\"https://godoc.org/github.com/globalsign/mgo#Collection.Find\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/globalsign/mgo#Collection.Find</a></p>\n\n<p>Note that <code>\"gopkg.in/mgo.v2/bson\"</code> package is no longer maintained. <code>https://github.com/globalsign/mgo</code> is a fork of that package and maintained by community.</p>\n"}], "owner": {"reputation": 1, "user_id": 6743799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b228cd1ef5c77725b8125b930ba51512?s=128&d=identicon&r=PG&f=1", "display_name": "Csaba Dobo", "link": "https://stackoverflow.com/users/6743799/csaba-dobo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1264, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1527063870, "creation_date": 1526716120, "last_edit_date": 1527063870, "question_id": 50423041, "link": "https://stackoverflow.com/questions/50423041/mgo-mongodb-read-write-example", "title": "mgo mongodb read / write example", "body": "<p>I am new to mgo and would need some help with this:\nI can succesfully connect and print out db name, collection name and number of item is collection, but do not know how to print out contents in it and write back.\nWhat would be an equivalent in mgo to the below mongodb shell commands?</p>\n\n<pre><code>- db.coll.find()\n- document=({\"user_id\" : \"xxx\",\"password\" :\"xxx\"....});\n- db.coll.insert(document)\n</code></pre>\n\n<p>//////////////////////////////////////////////////////////////////////</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"gopkg.in/mgo.v2\"\n)\n\n//const MongoDb details\nconst (\n    hosts      = \"mongodb.xxx:27017\"\n    database   = \"myinfo\"\n    username   = \"xxxxx\"\n    password   = \"start123\"\n    collection = \"userdetails\"\n)\n\nfunc main() {\n\n    info := &amp;mgo.DialInfo{\n        Addrs:    []string{hosts},\n        Timeout:  60 * time.Second,\n        Database: database,\n        Username: username,\n        Password: password,\n    }\n\n    session, err1 := mgo.DialWithInfo(info)\n    if err1 != nil {\n        panic(err1)\n    }\n\n    col := session.DB(database).C(collection)\n    datab := session.DB(database)\n\n    count, err2 := col.Count()\n    if err2 != nil {\n        panic(err2)\n    }\n\n    fmt.Println(\"Database Name:\", datab.Name)\n    fmt.Println(\"Collection FullName:\", col.FullName)\n    fmt.Println(fmt.Sprintf(\"Documents count: %d\", count))\n\n}\n</code></pre>\n\n<p>Here is a version that works:</p>\n\n<pre><code>    package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\n//const MongoDb details\nconst (\n    hosts      = \"xxx:27017\"\n    database   = \"myinfo\"\n    username   = \"xxxx\"\n    password   = \"start123\"\n    collection = \"userdetails2\"\n)\n\n\ntype UserDetails struct {\n        _id        bson.ObjectId `bson:\"_id,omitempty\"`\n        name    string\n        phone   string\n}\n\nfunc main() {\n\n    info := &amp;mgo.DialInfo{\n        Addrs:    []string{hosts},\n        Timeout:  60 * time.Second,\n        Database: database,\n        Username: username,\n        Password: password,\n    }\n\n    session, err1 := mgo.DialWithInfo(info)\n    if err1 != nil {\n        panic(err1)\n    }\n\n    col := session.DB(database).C(collection)\n    datab := session.DB(database)\n\n    count, err2 := col.Count()\n    if err2 != nil {\n        panic(err2)\n    }\n\n\n        fmt.Println(\"Database Name:\", datab.Name)\n        fmt.Println(\"Collection FullName:\", col.FullName)\n        fmt.Println(fmt.Sprintf(\"Documents count: %d\", count))\n\n        var userDetail []bson.M\n        _ = col.Find(nil).All(&amp;userDetail)\n        for _, v := range userDetail {\n        fmt.Println(v)\n}\n\n}\n</code></pre>\n"}]