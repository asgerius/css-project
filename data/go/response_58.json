[{"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 490, "user_id": 3310759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/409b69c3ae7b431fc16129ccdadae9cd?s=128&d=identicon&r=PG", "display_name": "driusan", "link": "https://stackoverflow.com/users/3310759/driusan"}, "is_accepted": false, "score": 11, "last_activity_date": 1455745150, "last_edit_date": 1455745150, "creation_date": 1455744890, "answer_id": 35468236, "question_id": 35468166, "link": "https://stackoverflow.com/questions/35468166/explain-this-go-statement/35468236#35468236", "title": "Explain this Go statement", "body": "<p>You have three things going on in that statement that are different language features all working together.</p>\n\n<ul>\n<li><code>return</code> returns a value from a function</li>\n<li><code>&lt;-reply</code> reads a value from the channel named reply</li>\n<li><code>var.(type)</code> asserts an interface contains that type.</li>\n</ul>\n\n<p>So putting them all together, you're reading an interface value from the reply channel, asserting that value is an integer, and then returning that integer value.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 9, "last_activity_date": 1455746763, "last_edit_date": 1455746763, "creation_date": 1455746003, "answer_id": 35468551, "question_id": 35468166, "link": "https://stackoverflow.com/questions/35468166/explain-this-go-statement/35468551#35468551", "title": "Explain this Go statement", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Receive_operator\">Receive operator</a></p>\n  \n  <p>For an operand ch of channel type, the value of the receive operation\n  &lt;-ch is the value received from the channel ch. The channel direction\n  must permit receive operations, and the type of the receive operation\n  is the element type of the channel. The expression blocks until a\n  value is available. Receiving from a nil channel blocks forever. A\n  receive operation on a closed channel can always proceed immediately,\n  yielding the element type's zero value after any previously sent\n  values have been received.</p>\n\n<pre><code>v1 := &lt;-ch\nv2 = &lt;-ch\nf(&lt;-ch)\n&lt;-strobe  // wait until clock pulse and discard received value\n</code></pre>\n  \n  <p>A receive expression used in an assignment or initialization of the\n  special form</p>\n\n<pre><code>x, ok = &lt;-ch\nx, ok := &lt;-ch\nvar x, ok = &lt;-ch\n</code></pre>\n  \n  <p>yields an additional untyped boolean result reporting whether the\n  communication succeeded. The value of ok is true if the value received\n  was delivered by a successful send operation to the channel, or false\n  if it is a zero value generated because the channel is closed and\n  empty.</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Type_assertions\">Type assertions</a></p>\n  \n  <p>For an expression x of interface type and a type T, the primary\n  expression</p>\n  \n  <p><code>x.(T)</code></p>\n  \n  <p>asserts that x is not nil and that the value stored in x is of type T.\n  The notation x.(T) is called a type assertion. </p>\n  \n  <p>If the type assertion holds, the value of the expression is the value\n  stored in x and its type is T. If the type assertion is false, a\n  run-time panic occurs. In other words, even though the dynamic type of\n  x is known only at run time, the type of x.(T) is known to be T in a\n  correct program.</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Return_statements\">Return statements</a></p>\n  \n  <p>A \"return\" statement in a function F terminates the execution of F,\n  and optionally provides one or more result values. Any functions\n  deferred by F are executed before F returns to its caller. </p>\n</blockquote>\n\n<p>For <code>return (&lt;-reply).(int)</code>, </p>\n\n<p><code>&lt;-reply</code> receives a value from channel <code>reply</code>.</p>\n\n<p><code>(&lt;-reply).(int)</code> asserts that the value received from channel <code>reply</code> is of type <code>int</code>. </p>\n\n<p><code>return (&lt;-reply).(int)</code> returns the <code>int</code> value received from channel <code>reply</code> and terminates the function or method.</p>\n"}, {"tags": [], "owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "is_accepted": false, "score": 0, "last_activity_date": 1587422282, "last_edit_date": 1587422282, "creation_date": 1587421913, "answer_id": 61333139, "question_id": 35468166, "link": "https://stackoverflow.com/questions/35468166/explain-this-go-statement/61333139#61333139", "title": "Explain this Go statement", "body": "<p><code>return (&lt;-reply).(int)</code> in a simple example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc F() int {\n    reply := make(chan interface{})\n    go func() { reply &lt;- 1 }()\n    return (&lt;-reply).(int)\n}\n\nfunc main() {fmt.Println(F())}\n</code></pre>\n"}], "owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1587422282, "creation_date": 1455744642, "last_edit_date": 1455747305, "question_id": 35468166, "link": "https://stackoverflow.com/questions/35468166/explain-this-go-statement", "title": "Explain this Go statement", "body": "<p>I found this is in a Go book and can not find it in the syntax of the language. Can anyone explain this?  Is it essentially a \"tag\" of some sort?</p>\n\n<pre><code>return (&lt;-reply).(int)\n</code></pre>\n"}, {"tags": ["json", "amazon-web-services", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455744121, "post_id": 35467766, "comment_id": 58631536, "body": "<code>resp.ConfigurationSettings</code> doesn&#39;t need to be parsed, it&#39;s already a <code>[]*ConfigurationSettingsDescription</code>."}], "answers": [{"tags": [], "owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "is_accepted": false, "score": 2, "last_activity_date": 1455772506, "creation_date": 1455772506, "answer_id": 35473363, "question_id": 35467766, "link": "https://stackoverflow.com/questions/35467766/how-to-parse-response-from-aws-go-api/35473363#35473363", "title": "how to parse response from AWS Go API", "body": "<p><code>resp.ConfigurationSettings</code> is not in JSON format any more, the <code>aws-sdk-go</code> package handled that for you. When you do,</p>\n\n<pre><code>v := resp.ConfigurationSettings\n</code></pre>\n\n<p><code>v</code> contains an instance <code>[]*ConfigurationSettingsDescription</code> that was parsed from the JSON response, and you don't have to parse it yourself. What you are seeing when you print it out is the Go struct representation. You can just go ahead and use it:</p>\n\n<pre><code>if len(v) &gt; 0 {\n    log.Println(v[0].ApplicationName)\n}\n</code></pre>\n\n<p>This should print out <code>myApp</code></p>\n"}], "owner": {"reputation": 313, "user_id": 5737452, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/17e1cbf59bde9523ef8a433fbe774cad?s=128&d=identicon&r=PG&f=1", "display_name": "desi Joe", "link": "https://stackoverflow.com/users/5737452/desi-joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 912, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1455772506, "creation_date": 1455743215, "question_id": 35467766, "link": "https://stackoverflow.com/questions/35467766/how-to-parse-response-from-aws-go-api", "title": "how to parse response from AWS Go API", "body": "<p>I am using the following sample program:</p>\n\n<pre><code>func getEnv(appName string, env string) {\n    svc := elasticbeanstalk.New(session.New(), &amp;aws.Config{Region: aws.String(\"us-east-1\")})\n\n    params := &amp;elasticbeanstalk.DescribeConfigurationSettingsInput{\n        ApplicationName: aws.String(appName), // Required\n        EnvironmentName: aws.String(env),\n    }\n    resp, err := svc.DescribeConfigurationSettings(params)\n\n    if err != nil {\n        fmt.Println(err.Error())\n        return\n    }\n    v := resp.ConfigurationSettings\n    fmt.Printf(\"%s\", v)\n}\n</code></pre>\n\n<p>It's printing out the following response; this looks like a valid json except for the missing quote makes. ex: ApplicationName and not \"ApplicationName\". </p>\n\n<p>How do I parse this? or get a valid json from AWS?</p>\n\n<pre><code>ConfigurationSettings: [{\n          ApplicationName: \"myApp\",\n          DateCreated: 2016-01-12 00:10:10 +0000 UTC,\n          DateUpdated: 2016-01-12 00:10:10 +0000 UTC,\n          DeploymentStatus: \"deployed\",\n          Description: \"Environment created from the EB CLI using \\\"eb create\\\"\",\n          EnvironmentName: \"stag-myApp-app-s1\",\n          OptionSettings: [\n            ...\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 1046, "user_id": 1212463, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2f71fd74e5a4d487a4db70e4039d655b?s=128&d=identicon&r=PG", "display_name": "lmazgon", "link": "https://stackoverflow.com/users/1212463/lmazgon"}, "edited": false, "score": 3, "creation_date": 1455735325, "post_id": 35465152, "comment_id": 58626217, "body": "Have you tried validating your JSON string? You can use JSONLint - <a href=\"http://jsonlint.com/\" rel=\"nofollow noreferrer\">jsonlint.com</a> . Maybe a quote is not properly escaped and the next character after the quote is <code>&lt;</code>, which is invalid in JSON."}, {"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "reply_to_user": {"reputation": 1046, "user_id": 1212463, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2f71fd74e5a4d487a4db70e4039d655b?s=128&d=identicon&r=PG", "display_name": "lmazgon", "link": "https://stackoverflow.com/users/1212463/lmazgon"}, "edited": false, "score": 0, "creation_date": 1455735746, "post_id": 35465152, "comment_id": 58626458, "body": "I just checked it and it said valid JSON.  I would have been surprised if it was bad since it comes from a commercial site that has been using it for a long time."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 2, "creation_date": 1455738337, "post_id": 35465152, "comment_id": 58628178, "body": "My general advice is to do this in two steps; 1) unmarshal json with the xml fields set to <code>[]byte</code> or <code>string</code> 2) unmashal the xml into objects"}, {"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1455739886, "post_id": 35465152, "comment_id": 58629163, "body": "The original is returned as a array of JSON entries.  I went back to ruby code and it all works fine with this code:     y = JSON.parse x     puts &quot;type of x: #{y.class}&quot;     pp y[0]  So I have to assume that the json is correct because of this and the fact this is commercial running code."}, {"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1455740534, "post_id": 35465152, "comment_id": 58629577, "body": "evanmcdonnal: I get the same error using a byte array and string. THe parser is not liking the &lt; after the quote that starts the data of the ccda element."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455741430, "post_id": 35465152, "comment_id": 58630080, "body": "Can you make a reproducible example, because the snippet you provide here works: <a href=\"http://play.golang.org/p/cQOlQ40Xy_\" rel=\"nofollow noreferrer\">play.golang.org/p/cQOlQ40Xy_</a>"}, {"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1455744418, "post_id": 35465152, "comment_id": 58631723, "body": "how can I get the body of the http get uncompressed?  I will be glad to send it."}, {"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1455746727, "post_id": 35465152, "comment_id": 58633048, "body": "I got the data by taking the string of the Body byte array. I could not put it in a comment, so I updated the question.  Something is very different.  Same call works in other languages, the sites non GO test setup.  On this one only I get the raw  xml when it should be xml in json.  I can request XML from the site I it is properly formatted with indentions."}, {"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1455832504, "post_id": 35465152, "comment_id": 58679058, "body": "I just spoke with the vendor and it seems to be a problem with go.  They are producing the json with the one element named ccda and the value being an XML string. It was confirmed it works properly on the other languages they support.  I am doing some further digging to be able to duplicate it with a small set of data."}], "answers": [{"comments": [{"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 1, "creation_date": 1455740327, "post_id": 35465831, "comment_id": 58629448, "body": "The error is exactly where I suspected the first &lt;.   I get this:   invalid character &#39;&lt;&#39; looking for beginning of value: &lt; &lt;&lt;--ERROR ?xml version=&quot;1.0&quot;?&gt; &lt;ClinicalDocument xmlns=&quot;urn:hl7-org:v3&quot; xmlns:xsi=&quot;<a href=\"http://www.w3.org/2001/XMLSchema-instance\" rel=\"nofollow noreferrer\">w3.org/2001/XMLSchema-instance</a>&quot;   However this is valid JSON. IT validates with jsonlint, It also runs with Ruby and I assume others since the commercial site it is from is live and has been."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1455743168, "post_id": 35465831, "comment_id": 58631028, "body": "@DonaldFrench The text in your comment is XML, not JSON.  Are you validating the response body fetched by the Go program, or are you validating copy / paste from browser or some other source?"}, {"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1455744167, "post_id": 35465831, "comment_id": 58631560, "body": "The text is json.  The first and only json data item ccda has a content of an XML string.I am not trying to parse the XML. In fact I do not want it parsed. I need to pass it along exactly as I received it."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1455747238, "post_id": 35465831, "comment_id": 58633295, "body": "If the text in your first comment to this answer is the output from the print statement in the answer, then the response body starts with <code>&lt;?xml version=&quot;1.0&quot;?&gt;</code>.  That&#39;s XML."}, {"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1455747843, "post_id": 35465831, "comment_id": 58633557, "body": "Then why do I get the proper data when using Ruby? and Python and on all other calls to other data, just not this one in GO?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1455747999, "post_id": 35465831, "comment_id": 58633631, "body": "Please provide a link to a Ruby or Python program that works.  Also, show the Go code you use to make the request. It&#39;s difficult to figure out what&#39;s going on with so little information."}, {"owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "edited": false, "score": 0, "creation_date": 1455749978, "post_id": 35465831, "comment_id": 58634486, "body": "I can give you the programs however I can not give you access. The site is a secure healthcare site.  Can not risk.  The Ruby returns the json directly I do not need to parse it.  I suspect because the response type is JSON."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1455748868, "last_edit_date": 1455748868, "creation_date": 1455736999, "answer_id": 35465831, "question_id": 35465152, "link": "https://stackoverflow.com/questions/35465152/golang-parsing-json-with-embeded-xml/35465831#35465831", "title": "Golang parsing JSON with embeded XML", "body": "<p>The JSON package is reporting a syntax error in the JSON text. To find the byte offset of the error, type assert the error to <a href=\"https://godoc.org/encoding/json#SyntaxError\" rel=\"nofollow\">*json.SyntaxError</a> and examine the Offset field:</p>\n\n<pre><code>if e, ok := err.(*json.SyntaxError); ok {\n    fmt.Printf(\"%v: %s &lt;&lt;--ERROR %s\\n\", e, body[:e.Offset], body[e.Offset:])\n}\n</code></pre>\n\n<p>Here's a wild guess about what's going on: The response body returned to the Go program is XML, not JSON.  The program is not getting the expected JSON response type because the program is not setting the request accept header, query parameter or file extension to request a JSON response.</p>\n"}], "owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1455748868, "creation_date": 1455734935, "last_edit_date": 1455746498, "question_id": 35465152, "link": "https://stackoverflow.com/questions/35465152/golang-parsing-json-with-embeded-xml", "title": "Golang parsing JSON with embeded XML", "body": "<p>I have a http response body that is in JSON however it contains one field and that is an XML document as a string. I do not want to parse the XML at all, I just want to extract it because I need to send it somewhere else as XML. When I attempt to use:</p>\n\n<pre><code>body, err := ioutil.ReadAll(resp.Body)\ndefer resp.Body.Close()\nvar ccr []models.Ccda\nerr = json.Unmarshal(body, &amp;ccr)\n</code></pre>\n\n<p>The Model is this:</p>\n\n<pre><code>Ccda struct {\n    CCDA string `json:\"ccda\"`\n}\n</code></pre>\n\n<p>I get an err of \"invalid character '&lt;' looking for beginning of value\"</p>\n\n<p>I have attempted it with string maps also and still same error.</p>\n\n<p>The beginning of the json response is:</p>\n\n<pre><code>[{\n    \"ccda\": \"&lt;?xml version=\\\"1.0\\\"?&gt;\\n&lt;ClinicalDocument xmlns=\\\"urn:hl7-org:v3\\\"...\"\n}]\n</code></pre>\n\n<p>ccda is the only element in the json string.  Again, I have no desire to parse the XML.</p>\n\n<p>Is there a problem with the way GO is handling the escaped quotes?  The value of the json element ccda is the XML string.</p>\n\n<p>Looking at the raw data from the vendor's site(their tool) I get this:</p>\n\n<p>[{\n    \"ccda\": \"\\n\\n  \\n  \\n  \\n  \\n  \\n  \\n }]</p>\n\n<p>When I read the response.Body and convert to string I get this (it is incorrect, though I may be able to use it):</p>\n\n<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;ClinicalDocument xmlns=\"urn:hl7-org:v3\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:sdtc=\"urn:hl7-org:sdtc\"&gt;\n  &lt;realmCode code=\"US\"/&gt;\n  &lt;typeId root=\"2.16.840.1.113883.1.3\" extension=\"POCD_HD000040\"/&gt;\n  &lt;templateId root=\"2.16.840.1.113883.10.20.22.1.1\"/&gt;\n  &lt;templateId root=\"2.16.840.1.113883.10.20.22.1.2\"/&gt;\n  &lt;id root=\"0cf1a768-2016-505e-2fd3c-001A64958C30\"/&gt;\n  &lt;code code=\"34133-9\" codeSystem=\"2.16.840.1.113883.6.1\" displayName=\"Summarization of Episode Note\"/&gt;\n&lt;\\ClinicalDocument&gt;\n</code></pre>\n\n<p>When I do other calls for other information in GO, I do get back the proper JSON on all tests go/ruby/site tools. just not on this call on GO.</p>\n"}, {"tags": ["email", "ssl", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455733050, "post_id": 35464211, "comment_id": 58624888, "body": "That openssl session is connected with <code>RC4-SHA</code>. RC4 is weak, and is now officially prohibited in the TLS spec. If the server offers nothing else, then the default Go tls config can&#39;t connect."}, {"owner": {"reputation": 601, "user_id": 1347268, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/abd1a63352cf4aa1e8e18228eb2c88c3?s=128&d=identicon&r=PG", "display_name": "Mark Fletcher", "link": "https://stackoverflow.com/users/1347268/mark-fletcher"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455733349, "post_id": 35464211, "comment_id": 58625058, "body": "Is there any way to add <code>RC4-SHA</code> support? The user has no problems receiving email from other services."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1455733892, "creation_date": 1455733892, "answer_id": 35464839, "question_id": 35464211, "link": "https://stackoverflow.com/questions/35464211/sending-email-with-go-tls-results-in-remote-error-handshake-failure-response/35464839#35464839", "title": "Sending email with Go/TLS results in &quot;remote error: handshake failure&quot; response", "body": "<p>If you're certain that the server only accepts insecure cipher suites and can't be updated, go does have some RC4 ciphers included, but disabled.</p>\n\n<p>The <code>smtp.SendMail</code> convenience function doesn't have a way to change the <code>tls.Config</code>, but it's easy to take the body of that function and use the <code>smtp.Client</code> manually.</p>\n\n<p>You can create a <code>tls.Config</code> with the CipherSuites you want, and pass it to <code>Client.StartTLS</code></p>\n\n<pre><code>config := &amp;tls.Config{\n    ServerName:   serverName,\n    CipherSuites: []uint16{tls.TLS_RSA_WITH_RC4_128_SHA},\n}\n\n// c is an smtp.Client\nif err = c.StartTLS(config); err != nil {\n    return err\n}\n</code></pre>\n"}], "owner": {"reputation": 601, "user_id": 1347268, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/abd1a63352cf4aa1e8e18228eb2c88c3?s=128&d=identicon&r=PG", "display_name": "Mark Fletcher", "link": "https://stackoverflow.com/users/1347268/mark-fletcher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 35464839, "answer_count": 1, "score": 1, "last_activity_date": 1455733892, "creation_date": 1455731814, "question_id": 35464211, "link": "https://stackoverflow.com/questions/35464211/sending-email-with-go-tls-results-in-remote-error-handshake-failure-response", "title": "Sending email with Go/TLS results in &quot;remote error: handshake failure&quot; response", "body": "<p>We're using the Go smtp.SendMail() function to send email. If we disable that function from using TLS, we have no problems sending email to kaser.com. With using TLS, we get the following error: <code>remote error: handshake failure</code>.</p>\n\n<p>If I run <code>openssl s_client -connect kaser.com:25 -starttls smtp</code>, I get the following:</p>\n\n<pre><code>CONNECTED(00000003)\ndepth=3 C = SE, O = AddTrust AB, OU = AddTrust External TTP Network, CN = AddTrust External CA Root\nverify return:1\ndepth=2 C = GB, ST = Greater Manchester, L = Salford, O = COMODO CA Limited, CN = COMODO RSA Certification Authority\nverify return:1\ndepth=1 C = GB, ST = Greater Manchester, L = Salford, O = COMODO CA Limited, CN = COMODO RSA Domain Validation Secure Server CA\nverify return:1\ndepth=0 OU = Domain Control Validated, OU = COMODO SSL Wildcard, CN = *.inmotionhosting.com\nverify return:1\n---\nCertificate chain\n 0 s:/OU=Domain Control Validated/OU=COMODO SSL Wildcard/CN=*.inmotionhosting.com\n   i:/C=GB/ST=Greater Manchester/L=Salford/O=COMODO CA Limited/CN=COMODO RSA Domain Validation Secure Server CA\n 1 s:/C=GB/ST=Greater Manchester/L=Salford/O=COMODO CA Limited/CN=COMODO RSA Domain Validation Secure Server CA\n   i:/C=GB/ST=Greater Manchester/L=Salford/O=COMODO CA Limited/CN=COMODO RSA Certification Authority\n 2 s:/C=GB/ST=Greater Manchester/L=Salford/O=COMODO CA Limited/CN=COMODO RSA Certification Authority\n   i:/C=SE/O=AddTrust AB/OU=AddTrust External TTP Network/CN=AddTrust External CA Root\n---\nServer certificate\n-----BEGIN CERTIFICATE-----\nMIIFZTCCBE2gAwIBAgIQPO5olnzo7AmygRYMaAwxWjANBgkqhkiG9w0BAQsFADCB\nkDELMAkGA1UEBhMCR0IxGzAZBgNVBAgTEkdyZWF0ZXIgTWFuY2hlc3RlcjEQMA4G\nA1UEBxMHU2FsZm9yZDEaMBgGA1UEChMRQ09NT0RPIENBIExpbWl0ZWQxNjA0BgNV\nBAMTLUNPTU9ETyBSU0EgRG9tYWluIFZhbGlkYXRpb24gU2VjdXJlIFNlcnZlciBD\nQTAeFw0xNDAyMjQwMDAwMDBaFw0xNzAyMjMyMzU5NTlaMGExITAfBgNVBAsTGERv\nbWFpbiBDb250cm9sIFZhbGlkYXRlZDEcMBoGA1UECxMTQ09NT0RPIFNTTCBXaWxk\nY2FyZDEeMBwGA1UEAxQVKi5pbm1vdGlvbmhvc3RpbmcuY29tMIIBIjANBgkqhkiG\n9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqGodB+JkHpHHJHsJx+vYmSaUQOxqP9oS6YVk\nOpoqKDygz6n5PgYm11KZzhSzdD+mY8YSGQOCmDry21irojJxxEsxt2+ATwJFC9V2\n4FYfwKngMDoWy0n21gopeISgo7O8TIgAP+i/HxIFm0N3ROfs5nVvp8CvBhQSakRS\nx5Zh+jB5Lo6Ajmko8Z8aRqq3WQvx3CCnJ0psb+efGVsVJ4kv8nHbsqJZqyHxw0Zv\n3V58S3wWMO1RORDaG+1AyYCn6192zrpWwEeaQXaxNw9B6SZLTB37ixaQoQoze8wD\nNn7JAQ2x7SrCKIHO1tyRZqZvJion01g0E/MbCOh502H323KihwIDAQABo4IB5zCC\nAeMwHwYDVR0jBBgwFoAUkK9qOpRaC9iQ6hJWc99DtDoo2ucwHQYDVR0OBBYEFHuv\nzpQRevgYmNy3FzxVJSVSOi+OMA4GA1UdDwEB/wQEAwIFoDAMBgNVHRMBAf8EAjAA\nMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjBPBgNVHSAESDBGMDoGCysG\nAQQBsjEBAgIHMCswKQYIKwYBBQUHAgEWHWh0dHBzOi8vc2VjdXJlLmNvbW9kby5j\nb20vQ1BTMAgGBmeBDAECATBUBgNVHR8ETTBLMEmgR6BFhkNodHRwOi8vY3JsLmNv\nbW9kb2NhLmNvbS9DT01PRE9SU0FEb21haW5WYWxpZGF0aW9uU2VjdXJlU2VydmVy\nQ0EuY3JsMIGFBggrBgEFBQcBAQR5MHcwTwYIKwYBBQUHMAKGQ2h0dHA6Ly9jcnQu\nY29tb2RvY2EuY29tL0NPTU9ET1JTQURvbWFpblZhbGlkYXRpb25TZWN1cmVTZXJ2\nZXJDQS5jcnQwJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLmNvbW9kb2NhLmNvbTA1\nBgNVHREELjAsghUqLmlubW90aW9uaG9zdGluZy5jb22CE2lubW90aW9uaG9zdGlu\nZy5jb20wDQYJKoZIhvcNAQELBQADggEBAAGSDm2jXQFgodUt5YBajGv4fUm1kVeX\nwHcWnOWrYkdnzg1cdUgqQZx5evQxg/CBuxz6SKEos8ao1udFpXHcyVOqhs7vo8Vy\nQjItiVX4zevtRnpqXzJ2LjlFqd5N+/ENq2pYMihJl6SvHGB/ejG5C0+DHw4RyOtc\nc9OeKCfr7d/JGFSqzLidabSVboenzGBJW1aG4r2uza7J3QyxPpCsnL4sg1w2gagE\nNAnHrghU50lK0Ha2NiWn4+G6PFQRiXanmPdFqqUGbMn/ZN6rK8+LIOEJ7NL8L3ED\nmMh1aMqza9RY4iN8MXgxQ7da9l2rGbHf24FbdFM/qV7+FBoStQm6it8=\n-----END CERTIFICATE-----\nsubject=/OU=Domain Control Validated/OU=COMODO SSL Wildcard/CN=*.inmotionhosting.com\nissuer=/C=GB/ST=Greater Manchester/L=Salford/O=COMODO CA Limited/CN=COMODO RSA Domain Validation Secure Server CA\n---\nNo client certificate CA names sent\n---\nSSL handshake has read 4861 bytes and written 596 bytes\n---\nNew, TLSv1/SSLv3, Cipher is RC4-SHA\nServer public key is 2048 bit\nSecure Renegotiation IS supported\nCompression: NONE\nExpansion: NONE\nSSL-Session:\n    Protocol  : TLSv1\n    Cipher    : RC4-SHA\n    Session-ID: F532F400F99290364AECE777619E466E7C3C3086D23F77F694AEA7F86DB4A2A7\n    Session-ID-ctx:\n    Master-Key: BF3551E6A77A02A7AA8F0273B1478D7C17AF6404D176974F55CDC4287671FAC71C7E454224001BE15C57BE6254CE5094\n    Key-Arg   : None\n    Krb5 Principal: None\n    PSK identity: None\n    PSK identity hint: None\n    Start Time: 1455730440\n    Timeout   : 300 (sec)\n    Verify return code: 0 (ok)\n---\n250 HELP\nquit\n</code></pre>\n\n<p>Any ideas why it doesn't like Go's TLS?</p>\n"}, {"tags": ["go", "interface"], "answers": [{"comments": [{"owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 0, "creation_date": 1455731781, "post_id": 35464126, "comment_id": 58624171, "body": "You are correct. Now I get <code>oracle: no type or method here</code> when there is a type on that line for sure. Is my command incomplete?"}, {"owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 0, "creation_date": 1455732424, "post_id": 35464126, "comment_id": 58624538, "body": "I guess I&#39;m confused as to what offset means here. An offset of 20 works fine on my machine as well. Why does the offset work when pointing to <code>func NewNullLogFactory</code> and not at offset 3 where it points to <code>type nullLog struct {}</code>?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 2, "creation_date": 1455732675, "post_id": 35464126, "comment_id": 58624676, "body": "Offset is the index of the byte in the file."}, {"owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "edited": false, "score": 1, "creation_date": 1455732799, "post_id": 35464126, "comment_id": 58624743, "body": "I just found out <code>oracle help</code> includes a link to <a href=\"http://golang.org/s/oracle-user-manual\" rel=\"nofollow noreferrer\">golang.org/s/oracle-user-manual</a> which confirms your explanation. Thank you."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1455732701, "last_edit_date": 1455732701, "creation_date": 1455731536, "answer_id": 35464126, "question_id": 35463716, "link": "https://stackoverflow.com/questions/35463716/how-to-list-interfaces-satisfied-by-a-type-in-a-cli/35464126#35464126", "title": "How to list interfaces satisfied by a type in a CLI?", "body": "<p>Use the following command:</p>\n\n<pre><code>oracle -pos=$GOPATH/src/path/to/project/vendor/github.com/quickfixgo/quickfix/null_log.go:#20 implements\n</code></pre>\n\n<p>Note the \":\" and that position is a byte offset in the file.</p>\n\n<p>The oracle tool is intended to be used from an editor plugin where the plugin calculates the offset in the file.</p>\n\n<p>Here's the output when I run the tool using the current version of quickfix:</p>\n\n<pre><code>$ oracle -pos=$GOPATH/src/github.com/quickfixgo/quickfix/null_log.go:#20 implements\n/Users/muffin/gopath/src/github.com/quickfixgo/quickfix/null_log.go:3:6: struct type nullLog\n/Users/muffin/gopath/src/github.com/quickfixgo/quickfix/log.go:4:6:     implements Log\n</code></pre>\n"}], "owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 35464126, "answer_count": 1, "score": 1, "last_activity_date": 1455732701, "creation_date": 1455730340, "last_edit_date": 1455730688, "question_id": 35463716, "link": "https://stackoverflow.com/questions/35463716/how-to-list-interfaces-satisfied-by-a-type-in-a-cli", "title": "How to list interfaces satisfied by a type in a CLI?", "body": "<p>I'm being unsuccessful in using the following command:</p>\n\n<blockquote>\n  <p>oracle -pos=$GOPATH/src/path/to/project/vendor/github.com/quickfixgo/quickfix/null_log.go#3 implements</p>\n</blockquote>\n\n<p>To which I get the error:</p>\n\n<blockquote>\n  <p>oracle: invalid source position -pos=$GOPATH/src/path/to/project/vendor/github.com/quickfixgo/quickfix/null_log.go#3</p>\n</blockquote>\n\n<p>I want to list the interfaces satisfied by the <code>nullLog</code> struct found on the 3rd line of the package found in the path above.</p>\n\n<p>If <code>oracle</code> is the right tool for my problem, how can I use it properly?\nIf not, is there another tool I can use to accomplish this?</p>\n"}, {"tags": ["google-app-engine", "go", "smtp"], "comments": [{"owner": {"reputation": 4932, "user_id": 1037753, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16171e0d57d12b30006d90dfb4e43909?s=128&d=identicon&r=PG", "display_name": "konqi", "link": "https://stackoverflow.com/users/1037753/konqi"}, "edited": false, "score": 3, "creation_date": 1455713832, "post_id": 35457268, "comment_id": 58611007, "body": "Take a look here: <a href=\"https://cloud.google.com/appengine/docs/go/mail/\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/go/mail</a>"}, {"owner": {"reputation": 4932, "user_id": 1037753, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16171e0d57d12b30006d90dfb4e43909?s=128&d=identicon&r=PG", "display_name": "konqi", "link": "https://stackoverflow.com/users/1037753/konqi"}, "edited": false, "score": 2, "creation_date": 1455713896, "post_id": 35457268, "comment_id": 58611059, "body": "If you with to use smtp itself you&#39;ll probably have to use the socket api, see <a href=\"https://cloud.google.com/appengine/docs/go/sockets/\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/go/sockets</a>"}], "owner": {"reputation": 1, "user_id": 5939859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f034d69a4462887c42fb674f60cb9432?s=128&d=identicon&r=PG&f=1", "display_name": "Ben Bel", "link": "https://stackoverflow.com/users/5939859/ben-bel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1455715427, "creation_date": 1455713476, "last_edit_date": 1455715427, "question_id": 35457268, "link": "https://stackoverflow.com/questions/35457268/trouble-sending-smtp-email-through-app-engine", "title": "trouble sending smtp email through App engine", "body": "<p>I have created a go application that sends an email using net/smtp and PlainAuth. And everything is working fine. But when I deploy this same code on the google app engine it is not sending. If I serve using goapp serve it work locally. Below is the code:</p>\n\n<pre><code>func sendMail(body string, subject string) {\nvar err error\nvar doc bytes.Buffer\nauth := smtp.PlainAuth(\"\",\n    \"from@gmail.com\",\n    \"********\",\n    \"smtp.gmail.com\")\n\nparameters := &amp;SmtpTemplateData{\n    \"from@gmail.com\",\n    \"to@gmail.com\",\n    \"Subject\",\nbody,\n}\n\nbuffer := new(bytes.Buffer)\n\ntemplate := template.Must(template.New(\"emailTemplate\").Parse(emailScript()))\ntemplate.Execute(buffer, parameters)\n\nt := template.New(\"emailTemplate1\")\nt, err = t.Parse(emailTemplate)\nif err != nil {\n    fmt.Println(\"error trying to parse mail template\")\n}\nerr = t.Execute(&amp;doc, parameters)\n\n\nsmtp.SendMail(\n        \"smtp.gmail.com:587\",\n        auth,\n        \"from@gmail.com\",\n        []string{\"to@gmail.com\"},\n        doc.Bytes(),\n)\n}\n</code></pre>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 4049, "user_id": 1133802, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/c77d19fe400931dea2eb52303a851bb6?s=128&d=identicon&r=PG", "display_name": "mostruash", "link": "https://stackoverflow.com/users/1133802/mostruash"}, "edited": false, "score": 0, "creation_date": 1455710806, "post_id": 35456076, "comment_id": 58608836, "body": "No sir, mgo doesn&#39;t do what you want to achieve."}], "answers": [{"tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": true, "score": 1, "last_activity_date": 1455720562, "last_edit_date": 1495535297, "creation_date": 1455720234, "answer_id": 35459818, "question_id": 35456076, "link": "https://stackoverflow.com/questions/35456076/defining-a-mongodb-schema-collection-in-mgo/35459818#35459818", "title": "Defining a MongoDB Schema/Collection in mgo", "body": "<p>mgo isn't an ORM or a validation tool. mgo is only an interface to MongoDB.</p>\n\n<p>It's not bad to do validation all by yourself.</p>\n\n<pre><code>type CompanyType int\n\nconst (\n  CompanyA CompanyType = iota // this is the default\n  CompanyB CompanyType\n  CompanyC CompanyType\n)\n\ntype Company struct {\n  Name string\n  CompanyType string\n}\n\nfunc (c Company) Valid() bool {\n  if c.Name == \"\" {\n    return false\n  }\n  // If it's a user input, you'd want to validate CompanyType's underlying\n  // integer isn't out of the enum's range.\n  if c.CompanyType &lt; CompanyA || c.CompanyType &gt; CompanyB {\n    return false\n  }\n  return true\n}\n</code></pre>\n\n<p>Check <a href=\"https://stackoverflow.com/questions/14426366/what-is-an-idiomatic-way-of-representing-enums-in-golang\">this</a> out for more about enums in Go.</p>\n"}], "owner": {"reputation": 5260, "user_id": 668929, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1ca58d0a4a10ea07fabd4e4d32968982?s=128&d=identicon&r=PG", "display_name": "Dhanush Gopinath", "link": "https://stackoverflow.com/users/668929/dhanush-gopinath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1323, "favorite_count": 0, "accepted_answer_id": 35459818, "answer_count": 1, "score": 0, "last_activity_date": 1455720562, "creation_date": 1455710247, "question_id": 35456076, "link": "https://stackoverflow.com/questions/35456076/defining-a-mongodb-schema-collection-in-mgo", "title": "Defining a MongoDB Schema/Collection in mgo", "body": "<p>I want to use mgo to create/save a MongoDB collection. But I would like to define it more extensively (for e.g to mention that one of the attribute is mandatory, another one is of an enum type and has a default value).</p>\n\n<p>I have defined the struct like this, but don't know how to describe the constraints on it.</p>\n\n<pre><code>type Company struct {\n    Name        string `json:\"name\" bson:\"name\"` // --&gt; I WANT THIS TO BE MANDATORY\n    CompanyType string `json:\"companyType\" bson:\"companyType\"` // --&gt;I WANT THIS TO BE AN ENUM\n}\n</code></pre>\n\n<p>Is this possible to do in mgo, like how we can do it in MongooseJS? </p>\n"}, {"tags": ["c", "pointers", "go", "unsafe", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 2, "last_activity_date": 1455709831, "creation_date": 1455709831, "answer_id": 35455921, "question_id": 35455702, "link": "https://stackoverflow.com/questions/35455702/getting-double-free-or-corruption-out-when-using-free-in-cgo-golang/35455921#35455921", "title": "Getting double free or corruption (out) when using free in cgo, golang", "body": "<p>From <a href=\"https://golang.org/cmd/cgo/#hdr-Go_references_to_C\" rel=\"nofollow\">https://golang.org/cmd/cgo/#hdr-Go_references_to_C</a> :</p>\n\n<pre><code>// Go string to C string\n// The C string is allocated in the C heap using malloc.\n// It is the caller's responsibility to arrange for it to be\n// freed, such as by calling C.free (be sure to include stdlib.h\n// if C.free is needed).\nfunc C.CString(string) *C.char\n</code></pre>\n\n<p>Your</p>\n\n<pre><code>path := C.CString(filename)\n</code></pre>\n\n<p>makes a copy and you have to free it while <code>statt</code> is a normal Go-memory-managed variable.</p>\n"}], "owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 915, "favorite_count": 0, "accepted_answer_id": 35455921, "answer_count": 1, "score": 1, "last_activity_date": 1455709831, "creation_date": 1455709255, "question_id": 35455702, "link": "https://stackoverflow.com/questions/35455702/getting-double-free-or-corruption-out-when-using-free-in-cgo-golang", "title": "Getting double free or corruption (out) when using free in cgo, golang", "body": "<p>I am trying to understand and learn cgo, and as a part of that, I wrote a function that checks for filepermission using <code>C.stat</code>. </p>\n\n<pre><code>import (\n    \"fmt\"\n    \"unsafe\"\n    \"os\"\n)\n//#include &lt;sys/stat.h&gt;\n//#include &lt;stdlib.h&gt;\nimport \"C\"\n\nfunc CheckPerm(filename string) {\n\n    statt := C.stat //stat struct from C\n    path := C.CString(filename)\n    st := *(*C.struct_stat)(unsafe.Pointer(statt)) //Casting unsafe pointer to C.struct_stat\n    defer C.free(unsafe.Pointer(path)) //free\n    defer C.free(unsafe.Pointer(statt))\n    C.stat(path, &amp;st)\n    if st.st_mode &amp; C.S_IRGRP &gt; 0 || st.st_mode &amp; C.S_IWGRP &gt; 0 || st.st_mode &amp; C.S_IXGRP &gt; 0 || st.st_mode &amp; C.S_IROTH &gt; 0 || st.st_mode &amp; C.S_IWOTH &gt; 0 || st.st_mode &amp; C.S_IXOTH &gt; 0 {\n        fmt.Println(\"file permission too broad, make it non-readable to groups and others.\")\n        os.Exit(1)\n    }\n    fmt.Println(\"File permission looks fine\")\n</code></pre>\n\n<p>}</p>\n\n<p>Upon passing a filepath to the function, it errors out saying </p>\n\n<pre><code>*** Error in `/tmp/Build go-sync.go and run77go': double free or corruption (out): 0x0000000000609480 ***\nSIGABRT: abort\nPC=0x7fe4302f3267 m=0\nsignal arrived during cgo execution\n\ngoroutine 1 [syscall, locked to thread]:\nruntime.cgocall(0x401930, 0xc820097808, 0xc800000000)\n/usr/lib/go/src/runtime/cgocall.go:120 +0x11b fp=0xc8200977d8 sp=0xc8200977a8\ngosyncmodules._Cfunc_free(0x609480)\n==========snip============\n</code></pre>\n\n<p>Because of the last line pasted here <code>gosyncmodules._Cfunc_free(0x609480)</code>, I removed the <code>defer C.free(unsafe.Pointer(statt))</code> and it works fine now.</p>\n\n<ul>\n<li>Why is it throwing error when I am trying to free the struct that was created, whereas it can be used to free the path variable?</li>\n<li>Will a similar scenario cause a memory leak, if not in this case?</li>\n</ul>\n"}, {"tags": ["go", "distributed-computing", "raft"], "answers": [{"comments": [{"owner": {"reputation": 708, "user_id": 5938492, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/4b3d66b498065d5a9d5b6b61108b922c?s=128&d=identicon&r=PG&f=1", "display_name": "Mr x", "link": "https://stackoverflow.com/users/5938492/mr-x"}, "edited": false, "score": 0, "creation_date": 1455775925, "post_id": 35473675, "comment_id": 58642897, "body": "Thanks to share your solutions over here so that any one can access it as go-raft is unmaintained so expecting reply on github is useless."}], "tags": [], "owner": {"reputation": 786, "user_id": 3970774, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/31c6c201b5b8718914fae0a47c7a7967?s=128&d=identicon&r=PG&f=1", "display_name": "NIket", "link": "https://stackoverflow.com/users/3970774/niket"}, "is_accepted": true, "score": 1, "last_activity_date": 1455773895, "creation_date": 1455773895, "answer_id": 35473675, "question_id": 35452424, "link": "https://stackoverflow.com/questions/35452424/status-of-all-nodes-in-goraft/35473675#35473675", "title": "Status of all nodes in goraft", "body": "<p>I did it.</p>\n\n<p>I have just insertednew line in goraft-library code where leader selection happens.</p>\n\n<p>So to make it just goto\nserver.go file of goraft and make following changes.</p>\n\n<p>Original Server.go - line [287-309]</p>\n\n<pre><code>// Sets the state of the server.\nfunc (s *server) setState(state string) {\n    s.mutex.Lock()\n    defer s.mutex.Unlock()\n\n    // Temporarily store previous values.\n    prevState := s.state\n    prevLeader := s.leader\n\n    // Update state and leader.\n    s.state = state\n    if state == Leader {\n        s.leader = s.Name()\n        s.syncedPeer = make(map[string]bool)\n    }\n\n    // Dispatch state and leader change events.\n    s.DispatchEvent(newEvent(StateChangeEventType, s.state, prevState))\n\n    if prevLeader != s.leader {\n        s.DispatchEvent(newEvent(LeaderChangeEventType, s.leader, prevLeader))\n    }\n}\n</code></pre>\n\n<p>Edited Server.go </p>\n\n<pre><code>// Sets the state of the server.\nfunc (s *server) setState(state string) {\n    s.mutex.Lock()\n    defer s.mutex.Unlock()\n\n    // Temporarily store previous values.\n    prevState := s.state\n    prevLeader := s.leader\n\n    // Update state and leader.\n    s.state = state\n    if state == Leader {\n        s.leader = s.Name()\n        s.syncedPeer = make(map[string]bool)\n    }\n\n    // Dispatch state and leader change events.\n    s.DispatchEvent(newEvent(StateChangeEventType, s.state, prevState))\n\n    if prevLeader != s.leader {\n        fmt.Println(\"I am the Leader..!!  \",s.connectionString,\"   \",s.path)\n        s.DispatchEvent(newEvent(LeaderChangeEventType, s.leader, prevLeader))\n    }\n}\n</code></pre>\n\n<p>So it will print connection Stirng as well as storage path of the current server on the console of active master server. </p>\n"}], "owner": {"reputation": 786, "user_id": 3970774, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/31c6c201b5b8718914fae0a47c7a7967?s=128&d=identicon&r=PG&f=1", "display_name": "NIket", "link": "https://stackoverflow.com/users/3970774/niket"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 2, "accepted_answer_id": 35473675, "answer_count": 1, "score": 1, "last_activity_date": 1455773895, "creation_date": 1455700775, "question_id": 35452424, "link": "https://stackoverflow.com/questions/35452424/status-of-all-nodes-in-goraft", "title": "Status of all nodes in goraft", "body": "<p>I have cluster of 4nodes 2001,2002,2003 &amp; 2004.\nThey are bind using goraft.\nSupppose 2001 is master server.\nNow when it fails, another node becomes the server.\nNow what I want is that, the node which becomes the current server should send message that I am the new LEADER.\nSo how to achieve that?\nI am using GORAFT with GORAFD implementation.\nI am here attaching the source code.</p>\n\n<p>main.go - For CLient</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"github.com/goraft/raft\"\n    \"github.com/goraft/raftd/command\"\n    \"github.com/goraft/raftd/server\"\n    \"log\"\n    \"math/rand\"\n    \"os\"\n    \"time\"\n    \"strconv\"\n)\n\nvar verbose bool\nvar trace bool\nvar debug bool\nvar host string\nvar port int\nvar join string\n\nfunc init() {\n    flag.Parse()\n    flag.BoolVar(&amp;verbose, \"v\", false, \"verbose logging\")\n    flag.BoolVar(&amp;trace, \"trace\", false, \"Raft trace debugging\")\n    flag.BoolVar(&amp;debug, \"debug\", false, \"Raft debugging\")\n    flag.StringVar(&amp;host, \"h\", \"localhost\", \"hostname\")\n    p,_:=strconv.Atoi(flag.Arg(1))\n    flag.IntVar(&amp;port, \"p\", p, \"port\")\n    flag.StringVar(&amp;join, \"join\", \"\", \"host:port of leader to join\")\n    flag.Usage = func() {\n        fmt.Fprintf(os.Stderr, \"Usage: %s [arguments] &lt;data-path&gt; \\n\", os.Args[0])\n        flag.PrintDefaults()\n    }\n}\n\nfunc main() {\n    log.SetFlags(0)\n    flag.Parse()\n    if verbose {\n        log.Print(\"Verbose logging enabled.\")\n    }\n    if trace {\n        raft.SetLogLevel(raft.Trace)\n        log.Print(\"Raft trace debugging enabled.\")\n    } else if debug {\n        raft.SetLogLevel(raft.Debug)\n        log.Print(\"Raft debugging enabled.\")\n    }\n\n    rand.Seed(time.Now().UnixNano())\n\n    // Setup commands.\n    raft.RegisterCommand(&amp;command.WriteCommand{})\n\n    // Set the data directory.\n    if flag.NArg() == 0 {\n        flag.Usage()\n        log.Fatal(\"Data path argument required\")\n    }\n    path := flag.Arg(0)\n    if err := os.MkdirAll(path, 0744); err != nil {\n        log.Fatalf(\"Unable to create path: %v\", err)\n    }\n\n    log.SetFlags(log.LstdFlags)\n    s := server.New(path, host, port)\n    log.Fatal(s.ListenAndServe(\"localhost:2001\"))\n    fmt.Println(\"I am changing my status\");\n}\n</code></pre>\n\n<p>Main.go - for Server i.e 2001</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"github.com/goraft/raft\"\n    \"github.com/goraft/raftd/command\"\n    \"github.com/goraft/raftd/server\"\n    \"log\"\n    \"math/rand\"\n    \"os\"\n    \"time\"\n    \"strconv\"\n)\n\nvar verbose bool\nvar trace bool\nvar debug bool\nvar host string\nvar port int\nvar join string\n\nfunc init() {\n    flag.Parse()\n    flag.BoolVar(&amp;verbose, \"v\", false, \"verbose logging\")\n    flag.BoolVar(&amp;trace, \"trace\", false, \"Raft trace debugging\")\n    flag.BoolVar(&amp;debug, \"debug\", false, \"Raft debugging\")\n    flag.StringVar(&amp;host, \"h\", \"localhost\", \"hostname\")\n    p,_:=strconv.Atoi(flag.Arg(1))\n    flag.IntVar(&amp;port, \"p\", p, \"port\")\n    flag.StringVar(&amp;join, \"join\", \"\", \"host:port of leader to join\")\n    flag.Usage = func() {\n        fmt.Fprintf(os.Stderr, \"Usage: %s [arguments] &lt;data-path&gt; \\n\", os.Args[0])\n        flag.PrintDefaults()\n    }\n}\n\nfunc main() {\n    log.SetFlags(0)\n    flag.Parse()\n    if verbose {\n        log.Print(\"Verbose logging enabled.\")\n    }\n    if trace {\n        raft.SetLogLevel(raft.Trace)\n        log.Print(\"Raft trace debugging enabled.\")\n    } else if debug {\n        raft.SetLogLevel(raft.Debug)\n        log.Print(\"Raft debugging enabled.\")\n    }\n\n    rand.Seed(time.Now().UnixNano())\n\n    // Setup commands.\n    raft.RegisterCommand(&amp;command.WriteCommand{})\n\n    // Set the data directory.\n    if flag.NArg() == 0 {\n        flag.Usage()\n        log.Fatal(\"Data path argument required\")\n    }\n    path := flag.Arg(0)\n    if err := os.MkdirAll(path, 0744); err != nil {\n        log.Fatalf(\"Unable to create path: %v\", err)\n    }\n\n    log.SetFlags(log.LstdFlags)\n    s := server.New(path, host, port)\n    log.Fatal(s.ListenAndServe(join))\n}\n</code></pre>\n\n<p>Common Server.go code</p>\n\n<pre><code>package server\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"github.com/goraft/raft\"\n    \"github.com/goraft/raftd/command\"\n    \"github.com/goraft/raftd/db\"\n    \"github.com/gorilla/mux\"\n    \"io/ioutil\"\n    \"log\"\n    \"math/rand\"\n    \"net/http\"\n    \"path/filepath\"\n    \"sync\"\n    \"time\"\n)\n\n// The raftd server is a combination of the Raft server and an HTTP\n// server which acts as the transport.\ntype Server struct {\n    name       string\n    host       string\n    port       int\n    path       string\n    router     *mux.Router\n    raftServer raft.Server\n    httpServer *http.Server\n    db         *db.DB\n    mutex      sync.RWMutex\n}\n\n// Creates a new server.\nfunc New(path string, host string, port int) *Server {\n    s := &amp;Server{\n        host:   host,\n        port:   port,\n        path:   path,\n        db:     db.New(),\n        router: mux.NewRouter(),\n    }\n\n    // Read existing name or generate a new one.\n    if b, err := ioutil.ReadFile(filepath.Join(path, \"name\")); err == nil {\n        s.name = string(b)\n    } else {\n        s.name = fmt.Sprintf(\"%07x\", rand.Int())[0:7]\n        if err = ioutil.WriteFile(filepath.Join(path, \"name\"), []byte(s.name), 0644); err != nil {\n            panic(err)\n        }\n    }\n\n    return s\n}\n\n// Returns the connection string.\nfunc (s *Server) connectionString() string {\n    return fmt.Sprintf(\"http://%s:%d\", s.host, s.port)\n}\n\n// Starts the server.\nfunc (s *Server) ListenAndServe(leader string) error {\n    var err error\n\n    log.Printf(\"Initializing Raft Server: %s\", s.path)\n\n    // Initialize and start Raft server.\n    transporter := raft.NewHTTPTransporter(\"/raft\", 200*time.Millisecond)\n    s.raftServer, err = raft.NewServer(s.name, s.path, transporter, nil, s.db, \"\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    transporter.Install(s.raftServer, s)\n    s.raftServer.Start()\n\n    if leader != \"\" {\n        // Join to leader if specified.\n\n        log.Println(\"Attempting to join leader:\", leader)\n\n        if !s.raftServer.IsLogEmpty() {\n            log.Fatal(\"Cannot join with an existing log\")\n        }\n        if err := s.Join(leader); err != nil {\n            log.Fatal(err)\n        }\n\n    } else if s.raftServer.IsLogEmpty() {\n        // Initialize the server by joining itself.\n\n        log.Println(\"Initializing new cluster\")\n\n        _, err := s.raftServer.Do(&amp;raft.DefaultJoinCommand{\n            Name:             s.raftServer.Name(),\n            ConnectionString: s.connectionString(),\n        })\n        if err != nil {\n            log.Fatal(err)\n        }\n\n    } else {\n        log.Println(\"Recovered from log\")\n    }\n\n    log.Println(\"Initializing HTTP server\")\n\n    // Initialize and start HTTP server.\n    s.httpServer = &amp;http.Server{\n        Addr:    fmt.Sprintf(\":%d\", s.port),\n        Handler: s.router,\n    }\n\n    s.router.HandleFunc(\"/db/{key}\", s.readHandler).Methods(\"GET\")\n    s.router.HandleFunc(\"/db/{key}\", s.writeHandler).Methods(\"POST\")\n    s.router.HandleFunc(\"/join\", s.joinHandler).Methods(\"POST\")\n\n    log.Println(\"Listening at:\", s.connectionString())\n\n    return s.httpServer.ListenAndServe()\n}\n\n// This is a hack around Gorilla mux not providing the correct net/http\n// HandleFunc() interface.\nfunc (s *Server) HandleFunc(pattern string, handler func(http.ResponseWriter, *http.Request)) {\n    s.router.HandleFunc(pattern, handler)\n}\n\n// Joins to the leader of an existing cluster.\nfunc (s *Server) Join(leader string) error {\n    command := &amp;raft.DefaultJoinCommand{\n        Name:     s.raftServer.Name(),\n        ConnectionString: s.connectionString(),\n    }\n\n    var b bytes.Buffer\n    json.NewEncoder(&amp;b).Encode(command)\n    resp, err := http.Post(fmt.Sprintf(\"http://%s/join\", leader), \"application/json\", &amp;b)\n    if err != nil {\n        return err\n    }\n    resp.Body.Close()\n\n    return nil\n}\n\nfunc (s *Server) joinHandler(w http.ResponseWriter, req *http.Request) {\n    command := &amp;raft.DefaultJoinCommand{}\n\n    if err := json.NewDecoder(req.Body).Decode(&amp;command); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    if _, err := s.raftServer.Do(command); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n}\n\nfunc (s *Server) readHandler(w http.ResponseWriter, req *http.Request) {\n    vars := mux.Vars(req)\n    value := s.db.Get(vars[\"key\"])\n    w.Write([]byte(value))\n}\n\nfunc (s *Server) writeHandler(w http.ResponseWriter, req *http.Request) {\n    vars := mux.Vars(req)\n\n    // Read the value from the POST body.\n    b, err := ioutil.ReadAll(req.Body)\n    if err != nil {\n        w.WriteHeader(http.StatusBadRequest)\n        return\n    }\n    value := string(b)\n\n    // Execute the command against the Raft server.\n    _, err = s.raftServer.Do(command.NewWriteCommand(vars[\"key\"], value))\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusBadRequest)\n    }\n}\n</code></pre>\n\n<p>Please give some solutions.</p>\n"}, {"tags": ["go", "ssh"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 5939031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e56194e6e6af45ccb0d38ed23b086ff?s=128&d=identicon&r=PG&f=1", "display_name": "braunbeard", "link": "https://stackoverflow.com/users/5939031/braunbeard"}, "edited": false, "score": 0, "creation_date": 1455696045, "post_id": 35450719, "comment_id": 58598701, "body": "thx for your quick response, this sounds like a possible solution but how do i access the now available debug information?"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 53, "user_id": 5939031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e56194e6e6af45ccb0d38ed23b086ff?s=128&d=identicon&r=PG&f=1", "display_name": "braunbeard", "link": "https://stackoverflow.com/users/5939031/braunbeard"}, "edited": false, "score": 0, "creation_date": 1455696835, "post_id": 35450719, "comment_id": 58599092, "body": "if you run your program the debug information will be logged on the console."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 1, "last_activity_date": 1455697669, "last_edit_date": 1455697669, "creation_date": 1455695343, "answer_id": 35450719, "question_id": 35450430, "link": "https://stackoverflow.com/questions/35450430/how-to-increase-golang-org-x-crypto-ssh-verbosity/35450719#35450719", "title": "how to increase golang.org/x/crypto/ssh verbosity", "body": "<p>As a quick hack you can open <code>$GOPATH/golang.org/x/crypto/ssh/mux.go</code> file, change <code>const debugMux = false</code> to <code>const debugMux = true</code> and recompile your program.</p>\n\n<p>In order to see the debug logging make your program do something first:</p>\n\n<pre><code>s, err := c.NewSession()\nif err != nil {\n    fmt.Printf(\"Failed to create session: %s\", err)\n}\nfmt.Println(s.CombinedOutput(\"hostname\"))\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 5939031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e56194e6e6af45ccb0d38ed23b086ff?s=128&d=identicon&r=PG&f=1", "display_name": "braunbeard", "link": "https://stackoverflow.com/users/5939031/braunbeard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1189, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1455697669, "creation_date": 1455694302, "question_id": 35450430, "link": "https://stackoverflow.com/questions/35450430/how-to-increase-golang-org-x-crypto-ssh-verbosity", "title": "how to increase golang.org/x/crypto/ssh verbosity", "body": "<p>i wanted to use golang.org/x/crypto/ssh to write a little program which is able to read the equivalent to ssh -v output. While i am able to connect via the ssh package to my server i have no idea how to enable verbose output or get to the desired information in it. As i am new to golang i am not even able to decide if it is possible at all. </p>\n\n<p>Here is my code so far</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"golang.org/x/crypto/ssh\"\n)\n\ntype SSHClient struct {\n    Config *ssh.ClientConfig\n    Host   string\n    Port   int\n}\n\nfunc main() {\n    sshConfig := &amp;ssh.ClientConfig{\n        User: \"your_user_name\",\n        Auth: []ssh.AuthMethod{\n            ssh.Password(\"your_password\"),\n        },\n    }\n\n    client := &amp;SSHClient{\n        Config: sshConfig,\n        Host:   \"example.com\",\n        Port:   22,\n    }\n\n    client.test()\n    _, err := ssh.Dial(\"tcp\", \"example.com:22\", sshConfig)\n    if err != nil {\n        fmt.Printf(\"Failed to dial: %s\", err)\n    }\n\n}\n\nfunc (client *SSHClient) test() {\n    fmt.Println(\"test\")\n}\n</code></pre>\n"}, {"tags": ["go", "usb", "serial-number"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1455697444, "post_id": 35450288, "comment_id": 58599432, "body": "Does this help you? <a href=\"https://github.com/kylelemons/gousb\" rel=\"nofollow noreferrer\">gousb</a>, doc is at <a href=\"https://godoc.org/github.com/kylelemons/gousb\" rel=\"nofollow noreferrer\">godoc</a>"}, {"owner": {"reputation": 473, "user_id": 279890, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c814f355aec49a73a7c3bbcc3b0eb27?s=128&d=identicon&r=PG", "display_name": "Yannick", "link": "https://stackoverflow.com/users/279890/yannick"}, "edited": false, "score": 0, "creation_date": 1455701932, "post_id": 35450288, "comment_id": 58602373, "body": "If you are on unix/osx use system commands."}], "answers": [{"tags": [], "owner": {"reputation": 286, "user_id": 5899150, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4380bc3fef16ee11788a3efea8e1cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Majonsi", "link": "https://stackoverflow.com/users/5899150/majonsi"}, "is_accepted": false, "score": 1, "last_activity_date": 1458231767, "creation_date": 1458231767, "answer_id": 36066262, "question_id": 35450288, "link": "https://stackoverflow.com/questions/35450288/how-to-get-the-serial-number-of-usb-device-with-golang/36066262#36066262", "title": "How to get the serial Number of USB device with golang?", "body": "<p>You must use a wrapper of libusb in golang (an example is <a href=\"https://github.com/kylelemons/gousb\" rel=\"nofollow\">gousb</a>).\nBut this wrapper doesn't have the command in order to get the serial number.\nSo you have to implement it. The command in libusb in order to do this is:</p>\n\n<pre><code>C.libusb_get_string_descriptor_ascii\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 0, "creation_date": 1459953268, "post_id": 36156825, "comment_id": 60521147, "body": "I got the error when I <code>go get github.com&#47;gotmc&#47;libusb</code>"}, {"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 0, "creation_date": 1459953364, "post_id": 36156825, "comment_id": 60521219, "body": "` bjbus@bjbus:~$ go get github.com/gotmc/libusb # pkg-config --cflags libusb-1.0 libusb-1.0 libusb-1.0 libusb-1.0 libusb-1.0  ... to the PKG_CONFIG_PATH environment variable Package libusb-1.0 was not found in the pkg-config search path. Perhaps you should add the directory containing <code>libusb-1.0.pc&#39; to the PKG_CONFIG_PATH environment variable No package &#39;libusb-1.0&#39; found ... pkg-config: exit status 1 </code>"}, {"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 0, "creation_date": 1459953587, "post_id": 36156825, "comment_id": 60521388, "body": "I retry  <code>go get github.com&#47;gotmc&#47;libusb</code> after <code>apt-get install libusb-1.0-0-dev</code>. and got the message: <code>could not determine kind of name for C.LIBUSB_TRANSFER_TYPE_BULK_STREAM</code>"}, {"owner": {"reputation": 397892, "user_id": 95592, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/utY5u.jpg?s=128&g=1", "display_name": "Matthew Rankin", "link": "https://stackoverflow.com/users/95592/matthew-rankin"}, "reply_to_user": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 0, "creation_date": 1459966934, "post_id": 36156825, "comment_id": 60530685, "body": "@sope Did you also perform <code>sudo apt-get install libusb-1.0-0</code>? I&#39;m not sure if <code>libusb-1.0-0-dev</code> installs the <code>libusb-1.0-0</code> dependency or not."}, {"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 0, "creation_date": 1459999035, "post_id": 36156825, "comment_id": 60543480, "body": "libusb-1.0-0  has already been installed default in ubuntu 14.04"}, {"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 0, "creation_date": 1459999189, "post_id": 36156825, "comment_id": 60543508, "body": "Thank you for your replay. I forked the gousb and implemented C.libusb_get_string_descriptor_ascii with golang."}], "tags": [], "owner": {"reputation": 397892, "user_id": 95592, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/utY5u.jpg?s=128&g=1", "display_name": "Matthew Rankin", "link": "https://stackoverflow.com/users/95592/matthew-rankin"}, "is_accepted": false, "score": 0, "last_activity_date": 1458656762, "last_edit_date": 1458656762, "creation_date": 1458656125, "answer_id": 36156825, "question_id": 35450288, "link": "https://stackoverflow.com/questions/35450288/how-to-get-the-serial-number-of-usb-device-with-golang/36156825#36156825", "title": "How to get the serial Number of USB device with golang?", "body": "<p>The <a href=\"https://github.com/gotmc/libusb/\" rel=\"nofollow\">libusb</a> Go package has a method <a href=\"https://godoc.org/github.com/gotmc/libusb#DeviceHandle.GetStringDescriptorASCII\" rel=\"nofollow\"><code>GetStringDesciptorASCII</code></a> that can be used to get the S/N of a USB device.</p>\n\n<h2>Example without error handling</h2>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n\n    \"github.com/gotmc/libusb\"\n)\n\nfunc main() {\n    ctx, _ := libusb.Init()\n    defer ctx.Exit()\n    devices, _ := ctx.GetDeviceList()\n    for _, device := range devices {\n        usbDeviceDescriptor, _ := device.GetDeviceDescriptor()\n        handle, _ := device.Open()\n        defer handle.Close()\n        snIndex := usbDeviceDescriptor.SerialNumberIndex\n        serialNumber, _ := handle.GetStringDescriptorASCII(snIndex)\n        log.Printf(\"Found S/N: %s\", serialNumber)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3151, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1458656762, "creation_date": 1455693709, "question_id": 35450288, "link": "https://stackoverflow.com/questions/35450288/how-to-get-the-serial-number-of-usb-device-with-golang", "title": "How to get the serial Number of USB device with golang?", "body": "<p>How to get the serial Number of USB device with golang ?</p>\n\n<p>Is there any example code ?</p>\n\n<p>Anyone who know !</p>\n"}, {"tags": ["pointers", "go", "interface", "yaml", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "edited": false, "score": 0, "creation_date": 1455693335, "post_id": 35449654, "comment_id": 58597337, "body": "Thanks @icza! would you mind to have a look at the &quot;Long&quot; example I provided? I understand what you are pointing out but have not found a way to apply this to unmarshalYAML() yet..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "edited": false, "score": 0, "creation_date": 1455695732, "post_id": 35449654, "comment_id": 58598548, "body": "@sontags But that&#39;s exactly what happens. More or less. In the above example I don&#39;t check if a map or a <code>nil</code> map value was passed, it will just &quot;overwrite&quot; the map variable that was passed. But it will be visible from the outside."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "edited": false, "score": 0, "creation_date": 1455695854, "post_id": 35449654, "comment_id": 58598610, "body": "@sontags Additionally you could check if <code>*dest</code> is not <code>nil</code>, and if it&#39;s not, you could add (copy) values to that map, but it&#39;s clearer to just assign as that map might already contain values, giving further confusion where those elements come from (e.g. were already in the map, or were the result of unmarshalling)."}, {"owner": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "edited": false, "score": 0, "creation_date": 1455696109, "post_id": 35449654, "comment_id": 58598732, "body": "All fine! it took me to long to write my comment, meanwhile you updated your answer! Thanks very much!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1480509244, "last_edit_date": 1480509244, "creation_date": 1455691401, "answer_id": 35449654, "question_id": 35449466, "link": "https://stackoverflow.com/questions/35449466/passing-values-to-interface/35449654#35449654", "title": "Passing values to interface{}", "body": "<h3>Using Type assertion</h3>\n\n<p>Inside your <code>unmarshalJSON()</code> function the parameter <code>s</code> behaves like a local variable. When you assign something to it:</p>\n\n<pre><code>s = result\n</code></pre>\n\n<p>It will only change the value of the local variable.</p>\n\n<p>Since you want it to work with changing the value of a <code>*map[string]interface{}</code> and that is what you pass to it, you could use a simple <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> to obtain the map pointer from it, and pass this pointer to <code>json.Unmarshal()</code>:</p>\n\n<pre><code>func unmarshalJSON(in []byte, s interface{}) error {\n    if m, ok := s.(*map[string]interface{}); !ok {\n        return errors.New(\"Expecting *map[string]interface{}\")\n    } else {\n        return json.Unmarshal(in, m)\n    }\n}\n</code></pre>\n\n<p>Try your modified, working example on the <a href=\"https://play.golang.org/p/hhVZpvaPKw\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h3>Just passing it along</h3>\n\n<p>Also note that however this is completely unnecessary as <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\"><code>json.Unmarshal()</code></a> is also defined to take the destination as a value of type <code>interface{}</code>, the same thing you have. So you don't even have to do anything just pass it along:</p>\n\n<pre><code>func unmarshalJSON(in []byte, s interface{}) error {\n    return json.Unmarshal(in, s)\n}\n</code></pre>\n\n<p>Try this on the <a href=\"https://play.golang.org/p/cQqKBo6_j9\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h3>With a variable of function type</h3>\n\n<p>As an interesting thing note that the <em>signature</em> of your <code>unmarshalJSON()</code> and the library function <code>json.Unmarshal()</code> is identical:</p>\n\n<pre><code>// Yours:\nfunc unmarshalJSON(in []byte, s interface{}) error\n\n// json package\nfunc Unmarshal(data []byte, v interface{}) error\n</code></pre>\n\n<p>This means there is another option, that is you could use a variable named <code>unmarshalJSON</code> of a <a href=\"https://golang.org/ref/spec#Function_types\" rel=\"nofollow noreferrer\">function type</a>, and just simply assign the function value <code>json.Unmarshal</code>:</p>\n\n<pre><code>var unmarshalJSON func([]byte, interface{}) error = json.Unmarshal\n</code></pre>\n\n<p>Now you have a variable <code>unmarshalJSON</code> which is of function type, and you can call it as if it would be a function:</p>\n\n<pre><code>err := unmarshalJSON(b, &amp;s)\n</code></pre>\n\n<p>Try this function value on the <a href=\"https://play.golang.org/p/oZiWI-124c\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h3>Now on to your <code>unmarshalYAML()</code> function</h3>\n\n<p>In your <code>unmarshalYAML()</code> you do the same mistake:</p>\n\n<pre><code>s = cleanUpInterfaceMap(result)\n</code></pre>\n\n<p>This will only change the value of your local <code>s</code> variable (parameter), and it will not \"populate\" the map (pointer) passed to <code>unmarshalYAML()</code>.</p>\n\n<p>Use the type assertion technique detailed above to obtain the pointer from the <code>s</code> <code>interface{}</code> argument, and once you have that, you can change the <em>pointed</em> object (the \"outside\" map).</p>\n\n<pre><code>func unmarshalYAML(in []byte, s interface{}) error {\n    var dest *map[string]interface{}\n    var ok bool\n    if dest, ok = s.(*map[string]interface{}); !ok {\n        return errors.New(\"Expecting *map[string]interface{}\")\n    }\n\n    var result map[interface{}]interface{}\n    if err := yaml.Unmarshal(in, &amp;result); err != nil {\n        return err\n    }\n    m := cleanUpInterfaceMap(result)\n\n    // m holds the results, dest is the pointer that was passed to us,\n    // we can just set the pointed object (map):\n    *dest = m\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 35449654, "answer_count": 1, "score": 1, "last_activity_date": 1480509244, "creation_date": 1455690700, "last_edit_date": 1455695484, "question_id": 35449466, "link": "https://stackoverflow.com/questions/35449466/passing-values-to-interface", "title": "Passing values to interface{}", "body": "<p><strong>Short</strong></p>\n\n<p>The following code does not exactly do what expected: \n<a href=\"https://play.golang.org/p/sO4w4I_Lle\" rel=\"nofollow\">https://play.golang.org/p/sO4w4I_Lle</a></p>\n\n<p>I assume that I mess up some pointer/reference stuff as usual, however I expect my...</p>\n\n<pre><code>func unmarshalJSON(in []byte, s interface{}) error\n</code></pre>\n\n<p>... and <code>encoding/json</code>s...</p>\n\n<pre><code>func Unmarshal(data []byte, v interface{}) error \n</code></pre>\n\n<p>...to behave the same way (eg. update the referenced passed as second argument).</p>\n\n<p><strong>Long</strong></p>\n\n<p>The example above is a minimal reproducer that does not make much sense. This is in order to make it work on the playground. However, an less minimal example that does make sense is this: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"gopkg.in/yaml.v2\"\n)\n\nfunc unmarshalYAML(in []byte, s interface{}) error {\n    var result map[interface{}]interface{}\n    err := yaml.Unmarshal(in, &amp;result)\n    s = cleanUpInterfaceMap(result)\n    // s is printed as expected\n    fmt.Println(s) // map[aoeu:[test aoeu] oaeu:[map[mahl:aoec tase:aoeu]]]\n    return err\n}\n\nfunc cleanUpInterfaceArray(in []interface{}) []interface{} {\n    out := make([]interface{}, len(in))\n    for i, v := range in {\n        out[i] = cleanUpMapValue(v)\n    }\n    return out\n}\n\nfunc cleanUpInterfaceMap(in map[interface{}]interface{}) map[string]interface{} {\n    out := make(map[string]interface{})\n    for k, v := range in {\n        out[fmt.Sprintf(\"%v\", k)] = cleanUpMapValue(v)\n    }\n    return out\n}\n\nfunc cleanUpMapValue(v interface{}) interface{} {\n    switch v := v.(type) {\n    case []interface{}:\n        return cleanUpInterfaceArray(v)\n    case map[interface{}]interface{}:\n        return cleanUpInterfaceMap(v)\n    case string:\n        return v\n    default:\n        return fmt.Sprintf(\"%v\", v)\n    }\n}\n\nfunc main() {\n    s := make(map[string]interface{})\n    b := []byte(`---\naoeu:\n- test\n- aoeu\noaeu:\n- { tase: aoeu, mahl: aoec}\n`)\n    err := unmarshalYAML(b, &amp;s)\n    if err != nil {\n        panic(err)\n    }\n    // s is still an empty map\n    fmt.Println(s) // map[]\n}\n</code></pre>\n\n<p>The idea is to unmarshal YAML to <code>map[string]interface{}</code> (instead of <code>map[interface{}]interface{}</code>) is order to allow to serialize to JSON (where identifiers need to be strings). The <code>unmarshalYAML</code> function should provide the same func signture as <code>yaml.Unmarshal</code>...</p>\n"}, {"tags": ["go", "emacs", "autocomplete", "flyspell"], "answers": [{"tags": [], "owner": {"reputation": 8261, "user_id": 245173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c6145047e62b215306e1a3e6d6800f?s=128&d=identicon&r=PG", "display_name": "jpkotta", "link": "https://stackoverflow.com/users/245173/jpkotta"}, "is_accepted": true, "score": 0, "last_activity_date": 1455726399, "creation_date": 1455726399, "answer_id": 35462319, "question_id": 35447757, "link": "https://stackoverflow.com/questions/35447757/use-flyspell-prog-mode-with-go-autocomplete/35462319#35462319", "title": "Use Flyspell-prog-mode with go-autocomplete", "body": "<p>This is a general issue with <code>auto-complete</code>.  Just do</p>\n\n<pre><code>(ac-flyspell-workaround)\n</code></pre>\n\n<p>after setting up <code>auto-complete</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 199, "user_id": 4052566, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/cRNUL.jpg?s=128&g=1", "display_name": "Tobin", "link": "https://stackoverflow.com/users/4052566/tobin"}, "is_accepted": false, "score": 0, "last_activity_date": 1455789510, "creation_date": 1455789510, "answer_id": 35478218, "question_id": 35447757, "link": "https://stackoverflow.com/questions/35447757/use-flyspell-prog-mode-with-go-autocomplete/35478218#35478218", "title": "Use Flyspell-prog-mode with go-autocomplete", "body": "<p>jpkotta was correct. Complete solution for reference was:</p>\n\n<pre><code>(with-eval-after-load 'go-mode \n (require 'go-autocomplete) \n (ac-flyspell-workaround))\n</code></pre>\n"}], "owner": {"reputation": 199, "user_id": 4052566, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/cRNUL.jpg?s=128&g=1", "display_name": "Tobin", "link": "https://stackoverflow.com/users/4052566/tobin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 35462319, "answer_count": 2, "score": 0, "last_activity_date": 1455789510, "creation_date": 1455682033, "last_edit_date": 1455726740, "question_id": 35447757, "link": "https://stackoverflow.com/questions/35447757/use-flyspell-prog-mode-with-go-autocomplete", "title": "Use Flyspell-prog-mode with go-autocomplete", "body": "<p>Using flyspell-prog-mode in emacs causes go-automplete to choke. Is there anyway I can make these two modes play nicely together?</p>\n\n<p>I have researched using another spell checker but did not find one that has same capabilities as flyspell (i.e only check comments and strings, and do it on the fly). Any tips most appreciated, thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1455689826, "post_id": 35447480, "comment_id": 58595710, "body": "Can you explain what you mean by &quot;full&quot; in the first sentence you write that you want to make a (full) copy of a pointer type?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1455718673, "post_id": 35447480, "comment_id": 58614561, "body": "A simple a := auth.userType is only a shallow copy; it still points to the same underlying value."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1455722276, "post_id": 35447480, "comment_id": 58617398, "body": "Do you need a new zero value for decoding, or do you actually need a copy to some level (shallow copy of underlying value, deep copy the entire value, ...)?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1455722546, "post_id": 35447480, "comment_id": 58617611, "body": "Zero value for decoding (so that encoding/json&#39;s use of reflect.TypeOf allows it to decode the previously stored copy)."}], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1455849761, "post_id": 35460124, "comment_id": 58685023, "body": "Thanks for this. I was trying to keep the interface small, and correct usage (actually returning a pointer) by end-users requires clear documentation, but I prefer interfaces to reflect magic (and I think most of us do too)."}, {"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1456063535, "post_id": 35460124, "comment_id": 58762742, "body": "@elithrar I had many opportunities to reduce LOC with reflection. I think the best use for reflection is when it can actually reduce complexity, not LOC or verbosity."}], "tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": true, "score": 1, "last_activity_date": 1455721026, "creation_date": 1455721026, "answer_id": 35460124, "question_id": 35447480, "link": "https://stackoverflow.com/questions/35447480/decode-json-into-interface-value/35460124#35460124", "title": "Decode JSON into Interface Value", "body": "<p>If you need to deep copy an interface, add that method to your interface.</p>\n\n<pre><code>type User interface {\n  GetID() string\n  Copy() User\n}\n\ntype LocalUser struct {\n  ID string\n  Name string\n  Created time.Time\n}\n\n// Copy receives a copy of LocalUser and returns a pointer to it.\nfunc (u LocalUser) Copy() User {\n  return &amp;u\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1455849668, "post_id": 35461255, "comment_id": 58684992, "body": "Although I prefer this for &quot;API surface area&quot; reasons, I (like many!) wanted to avoid reflect as much as reasonably possible. It&#39;s a good fix for the problem though, so thanks!"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1455850629, "post_id": 35461255, "comment_id": 58685247, "body": "Why do you want to avoid the reflect package? If performance is concern, then you should probably avoid encoding/json as well."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1455851207, "post_id": 35461255, "comment_id": 58685411, "body": "encoding/json is still &quot;fast enough&quot; for what is a reasonably hands-off serializer. Especially if your types are compatible, when compared to encoding/gob. Serializers like msgpack, et. al aren&#39;t (default) options as they require (at the least) implementing non-trivial interface methods, or code generation. This is totally OK for optional encoders, but in most cases the bottleneck won&#39;t be encoding/json but instead RTT to Redis/Postgres/etc. My lib. supports custom encoders, but needs convenient defaults. It&#39;s used in a similar context to securecookie."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1455856973, "post_id": 35461255, "comment_id": 58686895, "body": "OK, performance is not the issue. What is your objection to using the reflect package?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1455857364, "post_id": 35461255, "comment_id": 58686996, "body": "Many Gophers, myself included, prefer to steer away from using reflect if there is a more idiomatic (i.e. non-runtime) way to solve the problem. That&#39;s <i>not</i> to save that reflect isn&#39;t useful (serialization libraries, gorilla/schema, sqlx, etc. wouldn&#39;t exist without it). Someone aiming to solve a different problem than mine be fine with using it. As I also stated in my comment on the other answer, the cost of <i>not</i> using reflect is that there&#39;s a degree of reliance on the package user implementing that interface method correctly (reflect can avoid that)."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1455858187, "post_id": 35461255, "comment_id": 58687240, "body": "(and FWIW, the Copy() interface is, at a HTTP request level, not measurably slower/faster than reflect - 99th percentile latency is effectively identical and the bottleneck is the HTTP processing at a CPU level). <code>reflect</code> might be slower in a tight loop, but next to any kind of serialization (even if I were using capnproto) it&#39;s negligible."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1455729708, "last_edit_date": 1455729708, "creation_date": 1455723719, "answer_id": 35461255, "question_id": 35447480, "link": "https://stackoverflow.com/questions/35447480/decode-json-into-interface-value/35461255#35461255", "title": "Decode JSON into Interface Value", "body": "<p>Because the application will decode to a <code>User</code> and the argument to the JSON decoder must be a pointer value, we can assume that <code>User</code> values are pointer values. Given this assumption, the following code can be used to create a new zero value for decoding:</p>\n\n<pre><code>uzero := reflect.New(reflect.TypeOf(u).Elem()).Interface().(User)\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/PYMRLMA2eZ\" rel=\"nofollow\">playground example</a></p>\n"}], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 830, "favorite_count": 0, "accepted_answer_id": 35460124, "answer_count": 2, "score": 0, "last_activity_date": 1455729708, "creation_date": 1455680523, "last_edit_date": 1455683254, "question_id": 35447480, "link": "https://stackoverflow.com/questions/35447480/decode-json-into-interface-value", "title": "Decode JSON into Interface Value", "body": "<p>As encoding/json needs a non-nil interface to unmarshal into: how can I reliably make a (full) copy of a user-provided pointer type, store that in my <code>User</code> interface, and then JSON decode into that ad-hoc? </p>\n\n<p>Note: the goal here is to do this 'unattended' - that is, pull the bytes from Redis/BoltDB, decode into the interface type, and then check that the <code>GetID()</code> method the interface defines returns a non-empty string, with request middleware.</p>\n\n<p>Playground: <a href=\"http://play.golang.org/p/rYODiNrfWw\" rel=\"nofollow\">http://play.golang.org/p/rYODiNrfWw</a></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n    \"time\"\n)\n\ntype session struct {\n    ID      string\n    User    User\n    Expires int64\n}\n\ntype User interface {\n    GetID() string\n}\n\ntype LocalUser struct {\n    ID      string\n    Name    string\n    Created time.Time\n}\n\nfunc (u *LocalUser) GetID() string {\n    return u.ID\n}\n\ntype Auth struct {\n    key []byte\n    // We store an instance of userType here so we can unmarshal into it when\n    // deserializing from JSON (or other non-gob decoders) into *session.User.\n    // Attempting to unmarshal into a nil session.User would otherwise fail.\n    // We do this so we can unmarshal from our data-store per-request *without\n    // the package user having to do so manually* in the HTTP middleware. We can't\n    // rely on the user passing in an fresh instance of their User satisfying type.\n    userType User\n}\n\nfunc main() {\n    // auth is a pointer to avoid copying the struct per-request: although small\n    // here, it contains a 32-byte key, options fields, etc. outside of this example.\n    var auth = &amp;Auth{key: []byte(\"abc\")}\n    local := &amp;LocalUser{\"19313\", \"Matt\", time.Now()}\n\n    b, _, _, err := auth.SetUser(local)\n    if err != nil {\n        log.Fatalf(\"SetUser: %v\", err)\n    }\n\n    user, err := auth.GetUser(b)\n    if err != nil {\n        log.Fatalf(\"GetUser: %#v\", err)\n    }\n\n    fmt.Fprintf(os.Stdout, \"%v\\n\", user)\n\n}\n\nfunc (auth *Auth) SetUser(user User) (buf []byte, id string, expires int64, err error) {\n    sess := newSession(user)\n\n    // Shallow copy the user into our config. struct so we can copy and then unmarshal\n    // into it in our middleware without requiring the user to provide it themselves\n    // at the start of every request\n    auth.userType = user\n\n    b := bytes.NewBuffer(make([]byte, 0))\n    err = json.NewEncoder(b).Encode(sess)\n    if err != nil {\n        return nil, id, expires, err\n    }\n\n    return b.Bytes(), sess.ID, sess.Expires, err\n}\n\nfunc (auth *Auth) GetUser(b []byte) (User, error) {\n    sess := &amp;session{}\n\n    // Another shallow copy, which means we're re-using the same auth.userType\n    // across requests (bad).\n    // Also note that we need to copy into it session.User so that encoding/json\n    // can unmarshal into its fields.\n    sess.User = auth.userType\n\n    err := json.NewDecoder(bytes.NewBuffer(b)).Decode(sess)\n    if err != nil {\n        return nil, err\n    }\n\n    return sess.User, err\n}\n\nfunc (auth *Auth) RequireAuth(h http.Handler) http.Handler {\n    fn := func(w http.ResponseWriter, r *http.Request) {\n        // e.g. user, err := store.Get(r, auth.store, auth.userType)\n        // This would require us to have a fresh instance of userType to unmarshal into\n        // on each request.\n\n        // Alternative might be to have:\n        // func (auth *Auth) RequireAuth(userType User) func(h http.Handler) http.Handler\n        // e.g. called like http.Handle(\"/monitor\", RequireAuth(&amp;LocalUser{})(SomeHandler)\n        // ... which is clunky and using closures like that is uncommon/non-obvious.\n    }\n\n    return http.HandlerFunc(fn)\n}\n\nfunc newSession(u User) *session {\n    return &amp;session{\n        ID:      \"12345\",\n        User:    u,\n        Expires: time.Now().Unix() + 3600,\n    }\n}\n</code></pre>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 88945, "user_id": 290085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/306077a2fb7af6587f470214a1b337ff?s=128&d=identicon&r=PG", "display_name": "kjhughes", "link": "https://stackoverflow.com/users/290085/kjhughes"}, "edited": false, "score": 4, "creation_date": 1455679225, "post_id": 35447040, "comment_id": 58592218, "body": "That&#39;s not <i>bad</i> XML.   It&#39;s simply <i>not</i> XML."}, {"owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "reply_to_user": {"reputation": 88945, "user_id": 290085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/306077a2fb7af6587f470214a1b337ff?s=128&d=identicon&r=PG", "display_name": "kjhughes", "link": "https://stackoverflow.com/users/290085/kjhughes"}, "edited": false, "score": 1, "creation_date": 1455683850, "post_id": 35447040, "comment_id": 58593547, "body": "To expand on @kjhughes&#39;s comment: it doesn&#39;t seem like you would be able to use the Go xml package directly here. But you could consider forking the xml package and changing the <code>isName</code> function to allow your format, or you need to sanitize the XML first, changing it into valid XML, and then using the Go xml package to do the parsing. Yet another option (probably a good one, depending on how wild your &quot;xml&quot; input is), is to implement your own parser: <a href=\"https://blog.gopheracademy.com/advent-2014/parsers-lexers/\" rel=\"nofollow noreferrer\">blog.gopheracademy.com/advent-2014/parsers-lexers</a>"}, {"owner": {"reputation": 667, "user_id": 5627286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeYlo.jpg?s=128&g=1", "display_name": "aMike", "link": "https://stackoverflow.com/users/5627286/amike"}, "edited": false, "score": 0, "creation_date": 1455757904, "post_id": 35447040, "comment_id": 58637262, "body": "Thank you for the comments, the suggestions, and the link. All are helpful. Yes, I under-sold the poorness of the XML file... it&#39;s sad that it starts with the XML header and then violates the spec. I was hoping that there was a way of using the existing xml decoder (in a stream fashion?) that could be forced to deal with that file. The file is small enough that maybe I&#39;ll just regex &quot;&lt;[0-9]&quot; to &quot;&lt;p\\1&quot; or something - force the xml &#39;name&#39; to start with a letter. Thanks again!"}, {"owner": {"reputation": 667, "user_id": 5627286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeYlo.jpg?s=128&g=1", "display_name": "aMike", "link": "https://stackoverflow.com/users/5627286/amike"}, "reply_to_user": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "edited": false, "score": 0, "creation_date": 1456363316, "post_id": 35447040, "comment_id": 58916321, "body": "@Herman - if you want to make an answer, I&#39;ll be happy to accept it."}, {"owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "edited": false, "score": 0, "creation_date": 1456365905, "post_id": 35447040, "comment_id": 58917021, "body": "@aMike okay sure, glad it helped!"}], "answers": [{"tags": [], "owner": {"reputation": 667, "user_id": 5627286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeYlo.jpg?s=128&g=1", "display_name": "aMike", "link": "https://stackoverflow.com/users/5627286/amike"}, "is_accepted": false, "score": 1, "last_activity_date": 1456363860, "creation_date": 1456363860, "answer_id": 35616609, "question_id": 35447040, "link": "https://stackoverflow.com/questions/35447040/how-to-read-bad-xml-with-go/35616609#35616609", "title": "How to read bad XML with Go", "body": "<p>Thanks to your pointers and suggestions, I was able to read the XML files.\nJust rewrite the bad entries to good, and let Unmarshall do its job.\nThe malformed files I have are small (less than 10k),\nso this might not be a good choice if the XML file was 100 MB.</p>\n\n<pre><code>re := regexp.MustCompile(\"&lt;([0-9]+)\")\ns := re.ReplaceAllString(string(raw), \"&lt;splat n=\\\"${1}\\\"\")\n\nx := Something{Abc: \"0\"}\nerr = xml.Unmarshal([]byte(s), &amp;x)\n</code></pre>\n\n<p>Thank you!</p>\n"}, {"tags": [], "owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "is_accepted": true, "score": 2, "last_activity_date": 1456365888, "creation_date": 1456365888, "answer_id": 35616907, "question_id": 35447040, "link": "https://stackoverflow.com/questions/35447040/how-to-read-bad-xml-with-go/35616907#35616907", "title": "How to read bad XML with Go", "body": "<p>Posting my comment as an answer.</p>\n\n<p>It doesn't seem like you would be able to use the Go xml package directly here. But you could:</p>\n\n<ul>\n<li>consider forking the xml package and changing the <code>isName</code> function to allow your format, or </li>\n<li>sanitize the XML first, changing it into valid XML, and then use the Go <code>xml</code> package to do the parsing. </li>\n<li>Yet another option (probably a good one, depending on how wild your \"XML\" input is), is to implement your own parser, as explained on the Gopher Academy blog: <a href=\"http://blog.gopheracademy.com/advent-2014/parsers-lexers\" rel=\"nofollow\">advent-2014/parsers-lexers</a></li>\n</ul>\n"}], "owner": {"reputation": 667, "user_id": 5627286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeYlo.jpg?s=128&g=1", "display_name": "aMike", "link": "https://stackoverflow.com/users/5627286/amike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 819, "favorite_count": 0, "accepted_answer_id": 35616907, "answer_count": 2, "score": 1, "last_activity_date": 1456365888, "creation_date": 1455677861, "question_id": 35447040, "link": "https://stackoverflow.com/questions/35447040/how-to-read-bad-xml-with-go", "title": "How to read bad XML with Go", "body": "<p>I'd like to use Go to read an XML file. The problem is that it's a bad XML file -- it doesn't conform to the spec.  Here's a sample:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;something abc=\"1\" def=\"2\"&gt;\n    &lt;0 x=\"a\"/&gt;\n    &lt;1 x=\"b\"/&gt;\n    &lt;2 x=\"c\"/&gt;\n    &lt;26 x=\"z\"/&gt;\n&lt;/something&gt;\n</code></pre>\n\n<p>My Go program correctly gives an error when trying to read this:</p>\n\n<pre><code>$ go run rs.go &lt;real.xml\nchardata: '\n'\nstart: name.local='something'\nstart {{ something} [{{ abc} 1} {{ def} 2}]}\n'abc'='1'\n'def'='2'\noffset=66\nchardata: '\n    '\nXML syntax error on line 3: invalid XML name: 0\nexit status 1\n</code></pre>\n\n<p>Here's the little Go program:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\n//  &lt;something abc=\"1\" def=\"2\"&gt;\ntype Something struct {\n    abc   string `xml:\"abc\"`\n    def   string `xml:\"def\"`\n    spots []Spot\n}\n\n//    &lt;0 x=\"a\"/&gt;\ntype Spot struct {\n    num  int    // ??\n    xval string `xml:\"x\"`\n}\n\nfunc main() {\n    dec := xml.NewDecoder(os.Stdin)\n    //  dec.Strict = false      // doesn't help  &lt;0 ...&gt; problem\n    //  dec.Entity = xml.HTMLEntity\n\n    for {\n        tok, err := dec.Token()\n        if err == io.EOF {\n            break\n        } else if err != nil {\n            fmt.Fprintf(os.Stderr, \"%v\\n\", err)\n            os.Exit(1)\n        }\n\n        switch tok := tok.(type) {\n        case xml.StartElement:\n            fmt.Printf(\"start: name.local='%s'\\n\", tok.Name.Local)\n            fmt.Printf(\"start %v\\n\", tok)\n            for _, a := range tok.Attr {\n                fmt.Printf(\"'%s'='%s'\\n\", a.Name.Local, a.Value)\n            }\n            fmt.Printf(\"offset=%d\\n\", dec.InputOffset())\n        case xml.EndElement:\n            fmt.Printf(\"end: name.local='%s'\\n\", tok.Name.Local)\n        case xml.CharData:\n            fmt.Printf(\"chardata: '%s'\\n\", tok)\n        case xml.Comment:\n            fmt.Printf(\"comment: '%s'\\n\", tok)\n        }\n    }\n}\n</code></pre>\n\n<p>Is there a Go expert out there who can help me figure out how to get Go to read this goofy XML file?  Thanks!</p>\n"}, {"tags": ["go", "revel"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1455670109, "post_id": 35445831, "comment_id": 58589640, "body": "I think all the pieces are <a href=\"http://stackoverflow.com/questions/16141467/how-to-use-index-inside-range-in-html-template-to-iterate-through-parallel-array\">here</a> but I don&#39;t have the opportunity to test them enough to be confident in answering. Essentially: iterate over a range with len(.templates) and use indexing to get the values"}, {"owner": {"reputation": 1338, "user_id": 1772510, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/507de10a282f571a93a2ad2193b5b9e0?s=128&d=identicon&r=PG", "display_name": "dreadiscool", "link": "https://stackoverflow.com/users/1772510/dreadiscool"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1455675946, "post_id": 35445831, "comment_id": 58591298, "body": "Is there a more idiomatic way to do so? I&#39;ve updated hte question with the details"}], "answers": [{"comments": [{"owner": {"reputation": 1338, "user_id": 1772510, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/507de10a282f571a93a2ad2193b5b9e0?s=128&d=identicon&r=PG", "display_name": "dreadiscool", "link": "https://stackoverflow.com/users/1772510/dreadiscool"}, "edited": false, "score": 0, "creation_date": 1455678766, "post_id": 35447132, "comment_id": 58592077, "body": "Close, but I want to specify the name of the template based on the items in the array, not arguments passed to a static template name. I&#39;ve tried using a range, and just doing {{template $t .}} but it doesn&#39;t seem to like that"}, {"owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "reply_to_user": {"reputation": 1338, "user_id": 1772510, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/507de10a282f571a93a2ad2193b5b9e0?s=128&d=identicon&r=PG", "display_name": "dreadiscool", "link": "https://stackoverflow.com/users/1772510/dreadiscool"}, "edited": false, "score": 0, "creation_date": 1455679400, "post_id": 35447132, "comment_id": 58592266, "body": "Oh, okay, I see. Well, Go templates require a static parameter for the first argument of <code>template</code>. So variables won&#39;t do, not without some hackery :) But there is a thread here that might help you, if you&#39;re set on it: <a href=\"https://github.com/revel/revel/issues/988\" rel=\"nofollow noreferrer\">github.com/revel/revel/issues/988</a>"}], "tags": [], "owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "is_accepted": true, "score": 2, "last_activity_date": 1455678422, "creation_date": 1455678422, "answer_id": 35447132, "question_id": 35445831, "link": "https://stackoverflow.com/questions/35445831/golang-revel-template-engine-template-with-variable/35447132#35447132", "title": "Golang/Revel template engine template with variable", "body": "<p>If I understand your question correctly, you can use the <code>range</code> built-in to get the index, and then pass it to the template like this:</p>\n\n<pre><code>{{range $i, $t := .templates}}\n   {{template \"Template.html\" $i}}\n{{end}}\n</code></pre>\n\n<p>So if the <code>templates</code> variable was defined like this:</p>\n\n<pre><code>templates := []string{\"One\", \"Two\"}\n</code></pre>\n\n<p>and <code>Template.html</code> contains:</p>\n\n<pre><code>This is from Template.html: {{ . }}&lt;br&gt;\n</code></pre>\n\n<p>Then the final output will be:</p>\n\n<pre><code>This is from Template.html: 0&lt;br&gt;\nThis is from Template.html: 1&lt;br&gt;\n</code></pre>\n"}], "owner": {"reputation": 1338, "user_id": 1772510, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/507de10a282f571a93a2ad2193b5b9e0?s=128&d=identicon&r=PG", "display_name": "dreadiscool", "link": "https://stackoverflow.com/users/1772510/dreadiscool"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 961, "favorite_count": 0, "accepted_answer_id": 35447132, "answer_count": 1, "score": 1, "last_activity_date": 1455678422, "creation_date": 1455669704, "last_edit_date": 1455675993, "question_id": 35445831, "link": "https://stackoverflow.com/questions/35445831/golang-revel-template-engine-template-with-variable", "title": "Golang/Revel template engine template with variable", "body": "<p>Is there a way to pass a variable that was iterated over into a Golang/Revel template?</p>\n\n<p>For example, in \"header.html\", I have</p>\n\n<pre><code>{{range .templates}}\n    {{template \"something\" .}}\n{{end}}\n</code></pre>\n\n<p>How can I use current index from the array as an argument to template? I tried embedding another {{.}} as shown in the Revel examples, but that leads to a template compliation error. Would the variable be something like $i?</p>\n\n<p>For example, iterating through in Revel is done like so</p>\n\n<pre><code>{{range .messages}}\n    &lt;p&gt;{{.}}&lt;/p&gt;\n{{end}}\n</code></pre>\n\n<p>However, I read that the . means nil.... how does this work in Revel?</p>\n"}, {"tags": ["json", "data-structures", "go"], "answers": [{"tags": [], "owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "is_accepted": true, "score": 2, "last_activity_date": 1455669979, "creation_date": 1455669979, "answer_id": 35445882, "question_id": 35445698, "link": "https://stackoverflow.com/questions/35445698/typed-nested-json-decoding-in-go/35445882#35445882", "title": "typed nested json decoding in go", "body": "<p>All struct fields you want to marshal should start with uppercase letter (be public). This works <a href=\"https://play.golang.org/p/ReCp3BAfTb\" rel=\"nofollow\">https://play.golang.org/p/ReCp3BAfTb</a> </p>\n"}], "owner": {"reputation": 933, "user_id": 386398, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/949f531863019049764e4aca8fb1b6ef?s=128&d=identicon&r=PG", "display_name": "santa", "link": "https://stackoverflow.com/users/386398/santa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "closed_date": 1455671131, "accepted_answer_id": 35445882, "answer_count": 1, "score": 0, "last_activity_date": 1455669979, "creation_date": 1455668936, "question_id": 35445698, "link": "https://stackoverflow.com/questions/35445698/typed-nested-json-decoding-in-go", "closed_reason": "Duplicate", "title": "typed nested json decoding in go", "body": "<p>I try to Unmarshal some nested JSON in go, the structs go something along this</p>\n\n<pre><code>type GameState struct {\n  missiles []*Missile\n  others   []*Player\n  you      *Player\n}\ntype Message struct {\n  gamestate   *GameState\n  messagetype string\n}\n// json like {\"gamestate\":{...},\"messagetype\":\"stateupdate\"}\n</code></pre>\n\n<p>I've also put a <a href=\"https://play.golang.org/p/M234bEOEwc\" rel=\"nofollow\">running example</a> online.</p>\n\n<p>Now when I use <strong><em>map[string]interface{}</em></strong> to Unmarshal everything gets deserialized. But the moment I use the structs to Unmarshal I get nil back, both as result and error.</p>\n\n<p>How come?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "edited": false, "score": 0, "creation_date": 1455669152, "post_id": 35445694, "comment_id": 58589341, "body": "The break statement goes to DONE: and then would call the"}, {"owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "edited": false, "score": 0, "creation_date": 1455669217, "post_id": 35445694, "comment_id": 58589355, "body": "for loop again.  How does DONE: escape the FOR Loop.  If you jump to DONE you execute a for {} block again."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "edited": false, "score": 0, "creation_date": 1455671185, "post_id": 35445694, "comment_id": 58589992, "body": "@Godfather nah that is denoting the scope, it&#39;s not like a <code>goto</code> that&#39;s saying when I call break, break from the scope of <code>DONE</code> it&#39;s so you can nest loops and break statements. If you wrap the loop in yet another loop, and put a different label on it like <code>REALLYDONE</code> then you can see this because when you break <code>DONE</code> it will continue looping in the scope of <code>REALLYDONE</code>"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1455668894, "creation_date": 1455668894, "answer_id": 35445694, "question_id": 35445630, "link": "https://stackoverflow.com/questions/35445630/how-does-this-for-loop-break-when-select-is-done/35445694#35445694", "title": "How does this FOR Loop Break when select is done", "body": "<p>The confusion comes from the idea that you're going to block there on the first case. That's not what happens. You iterate the select options indefinitely taking the one available until you encounter the break. In this case, it would indicate there is nothing to receive from the <code>results</code> channel on your first iteration so it automatically falls into the default cause, prints <code>Break DONE</code> and you're done.</p>\n"}, {"tags": [], "owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "is_accepted": false, "score": 2, "last_activity_date": 1455670154, "creation_date": 1455670154, "answer_id": 35445914, "question_id": 35445630, "link": "https://stackoverflow.com/questions/35445630/how-does-this-for-loop-break-when-select-is-done/35445914#35445914", "title": "How does this FOR Loop Break when select is done", "body": "<p><code>break DONE</code> is not the same as <code>goto DONE</code> in C or other languages. The label marks the for loop which <code>break DONE</code> statement will terminate when executed. It doesn't jump to <code>DONE</code> label, it terminates the for loop marked with the <code>DONE</code> label. Labeled breaks are very usefull when you want to break from nested loops or, like in your case, terminate loop from inside of select. Without a label break would only terminate select.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 2987492, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8531472d57bf831002bc51bd5407e775?s=128&d=identicon&r=PG&f=1", "display_name": "Badsector", "link": "https://stackoverflow.com/users/2987492/badsector"}, "is_accepted": false, "score": 0, "last_activity_date": 1455705773, "creation_date": 1455705773, "answer_id": 35454377, "question_id": 35445630, "link": "https://stackoverflow.com/questions/35445630/how-does-this-for-loop-break-when-select-is-done/35454377#35454377", "title": "How does this FOR Loop Break when select is done", "body": "<p>the break keyword used terminate the execution, when you debug this code, the default option will selected and then break keyword perform which stop the program. Program will not able go at DONE label </p>\n"}, {"tags": [], "owner": {"reputation": 651, "user_id": 621973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88f4ee43bc2722fdd9240db6da9c0b39?s=128&d=identicon&r=PG", "display_name": "foo", "link": "https://stackoverflow.com/users/621973/foo"}, "is_accepted": false, "score": 1, "last_activity_date": 1455784977, "creation_date": 1455784977, "answer_id": 35476555, "question_id": 35445630, "link": "https://stackoverflow.com/questions/35445630/how-does-this-for-loop-break-when-select-is-done/35476555#35476555", "title": "How does this FOR Loop Break when select is done", "body": "<blockquote>\n  <p>If there is a label, it must be that of an enclosing \"for\", \"switch\", or \"select\" statement, and that is the one whose execution terminates.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/ref/spec#Break_statements\" rel=\"nofollow\">https://golang.org/ref/spec#Break_statements</a></p>\n\n<p>The label in this example explicitly marks the \"for\" to terminate.</p>\n"}], "owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1807, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1455784977, "creation_date": 1455668552, "last_edit_date": 1455670568, "question_id": 35445630, "link": "https://stackoverflow.com/questions/35445630/how-does-this-for-loop-break-when-select-is-done", "title": "How does this FOR Loop Break when select is done", "body": "<p>The following code waits for the 'results' channel to be empty\nand then the DEFAULT branch breaks to Label DONE. </p>\n\n<p>Now the question:  Why does this break the FOR LOOP?? It seems\nthat the FOR loop would continue to skip to DEFAULT and never\nend.</p>\n\n<p>WHAT IS BREAKING THE FOR LOOP.</p>\n\n<p>The Output is as follows:</p>\n\n<p>Break DONE</p>\n\n<p>End For</p>\n\n<hr>\n\n<pre><code>...\nDONE:\nfor {\n    select { // Nonblocking\n    case result := &lt;-results:\n        fmt.Printf(\"%s:%d:%s\\n\", result.filename, result.lino,\n            result.line)\n    default:\n        fmt.Println(\"Break DONE\")\n        break DONE\n    }\n    fmt.Println(\"END Select\")\n}\nfmt.Println(\"End For\")\n</code></pre>\n"}, {"tags": ["go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1455664072, "last_edit_date": 1455664072, "creation_date": 1455663305, "answer_id": 35444615, "question_id": 35444329, "link": "https://stackoverflow.com/questions/35444329/how-to-access-specific-fields-from-structs-in-golang/35444615#35444615", "title": "How to access specific fields from structs in Golang", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow\">Exported identifiers</a></p>\n  \n  <p>An identifier may be exported to permit access to it from another\n  package. An identifier is exported if both:</p>\n  \n  <p>the first character of the identifier's name is a Unicode upper case\n  letter (Unicode class \"Lu\"); and</p>\n  \n  <p>the identifier is declared in the package block or it is a field name\n  or method name.</p>\n  \n  <p>All other identifiers are not exported.</p>\n</blockquote>\n\n<p>Give <code>User</code> its own package and don't export the password.</p>\n\n<p>For example,</p>\n\n<pre><code>package user\n\ntype User struct {\n    ID       string\n    Username string\n    Name     string\n    password string\n}\n\nfunc (u *User) IsPassword(password string) bool {\n    return password == u.password\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 4, "last_activity_date": 1455663439, "creation_date": 1455663439, "answer_id": 35444649, "question_id": 35444329, "link": "https://stackoverflow.com/questions/35444329/how-to-access-specific-fields-from-structs-in-golang/35444649#35444649", "title": "How to access specific fields from structs in Golang", "body": "<p>Assuming the types are in different packages you can do this by exporting vs not exporting the fields. A field who's name begins with a lower case letter is not exported, meaning it is not visible outside the package where it is declared/defined. So, in this case if the user existed in one package, call it <code>user</code> while the other type were declared in another you could accomplish this 'hiding' of properties by changing the definition to;</p>\n\n<pre><code>type User struct {\n    ID              string\n    username        string\n    name            string\n    password        string\n}\n</code></pre>\n\n<p>If the two types live in the same package there is no way of making a field private/hidden/ect, everything will be available in that scope.</p>\n"}], "owner": {"reputation": 419, "user_id": 4142855, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-2FYIVZaaVow/AAAAAAAAAAI/AAAAAAAAALo/SMJpZYi-MQ8/photo.jpg?sz=128", "display_name": "alexcons", "link": "https://stackoverflow.com/users/4142855/alexcons"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2929, "favorite_count": 1, "accepted_answer_id": 35444649, "answer_count": 2, "score": 2, "last_activity_date": 1455664072, "creation_date": 1455662040, "question_id": 35444329, "link": "https://stackoverflow.com/questions/35444329/how-to-access-specific-fields-from-structs-in-golang", "title": "How to access specific fields from structs in Golang", "body": "<p>Suppose I have the following code:</p>\n\n<pre><code>type User struct {\n    ID              string\n    Username        string\n    Name            string\n    Password        string\n}\n</code></pre>\n\n<p>What I want to do is create another struct that can access certain fields from the User struct, instead of accessing all of it, to prevent people from seeing the password, for example.\nThis does not work:</p>\n\n<pre><code>type Note struct {\n    ID         string\n    Text       string\n    UserID     User.ID          \n}\n</code></pre>\n\n<p>Is there any way to do this, or do I simply create the Note.UserID field to have the same data type as the ID in the User struct?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1455661239, "post_id": 35444119, "comment_id": 58586396, "body": "Does the code you posted work? If not, what&#39;s the error message. If so, what&#39;s your question?"}, {"owner": {"reputation": 228, "user_id": 1661521, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/72c70f159ec31f2af8ed145cc8c087f6?s=128&d=identicon&r=PG", "display_name": "PythonNewbie", "link": "https://stackoverflow.com/users/1661521/pythonnewbie"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1455661605, "post_id": 35444119, "comment_id": 58586583, "body": "Hi @AdamSmith did you see the bold letters ? But yes the code work, I got no error message(implicit when I said the code works), the question is in terms of efficiency ... what i&#39;m looking is to see if anyone can replicate the same thing I did but in a more efficient way then I did . I know that my code could improve well just look at it :) if you see something that you would do different that would make it faster, or better in memory management wise .. well i&#39;m open to suggestions or critics."}, {"owner": {"reputation": 69864, "user_id": 444991, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c57f597182ae324d8eb33b935f7d38af?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/444991/matt"}, "edited": false, "score": 0, "creation_date": 1455800106, "post_id": 35444119, "comment_id": 58657551, "body": "I&#39;m voting to close this question as off-topic because it is asking for review, which is too broad on Stack Overflow. Consider asking your question on <a href=\"http://codereview.stackexchange.com\">codereview.stackexchange.com</a> instead, but be sure to read their <a href=\"http://codereview.stackexchange.com/help/how-to-ask\">asking guidelines</a> first; specifically, add background &amp; an desired output of your application to the question itself."}, {"owner": {"reputation": 228, "user_id": 1661521, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/72c70f159ec31f2af8ed145cc8c087f6?s=128&d=identicon&r=PG", "display_name": "PythonNewbie", "link": "https://stackoverflow.com/users/1661521/pythonnewbie"}, "reply_to_user": {"reputation": 69864, "user_id": 444991, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c57f597182ae324d8eb33b935f7d38af?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/444991/matt"}, "edited": false, "score": 0, "creation_date": 1455805381, "post_id": 35444119, "comment_id": 58661441, "body": "@Matt the problem is now described, and you got a example of what i&#180;m doing, it&#180;s not a code review or a request for reccommendations in libraries what i want to know if there is a function or a design solution that i did not implemented that could be implemented that could result in a speed increase in terms of processing the results."}], "answers": [{"comments": [{"owner": {"reputation": 228, "user_id": 1661521, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/72c70f159ec31f2af8ed145cc8c087f6?s=128&d=identicon&r=PG", "display_name": "PythonNewbie", "link": "https://stackoverflow.com/users/1661521/pythonnewbie"}, "edited": false, "score": 0, "creation_date": 1455661959, "post_id": 35444304, "comment_id": 58586751, "body": "thanks going to look at it"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1455661925, "creation_date": 1455661925, "answer_id": 35444304, "question_id": 35444119, "link": "https://stackoverflow.com/questions/35444119/fuzzer-in-go-replicating-python-one/35444304#35444304", "title": "Fuzzer in go replicating Python one", "body": "<blockquote>\n  <p><a href=\"https://godoc.org/github.com/google/gofuzz\" rel=\"nofollow\">package fuzz</a></p>\n\n<pre><code>import \"github.com/google/gofuzz\"\n</code></pre>\n  \n  <p>Package fuzz is a library for populating go objects with random\n  values.</p>\n</blockquote>\n\n<p>For an example of an efficient Go fuzzer, see the Go package fuzz.</p>\n"}], "owner": {"reputation": 228, "user_id": 1661521, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/72c70f159ec31f2af8ed145cc8c087f6?s=128&d=identicon&r=PG", "display_name": "PythonNewbie", "link": "https://stackoverflow.com/users/1661521/pythonnewbie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 2, "closed_date": 1455800106, "accepted_answer_id": 35444304, "answer_count": 1, "score": 1, "last_activity_date": 1455805060, "creation_date": 1455661152, "last_edit_date": 1455805060, "question_id": 35444119, "link": "https://stackoverflow.com/questions/35444119/fuzzer-in-go-replicating-python-one", "closed_reason": "Not suitable for this site", "title": "Fuzzer in go replicating Python one", "body": "<p>I'm recreating a fuzzer(the actual fuzzer is on the link and it's written in python) for this tutorial:</p>\n\n<p><a href=\"http://www.primalsecurity.net/0x0-exploit-tutorial-buffer-overflow-vanilla-eip-overwrite-2/\" rel=\"nofollow\">Link for the tutorial</a></p>\n\n<blockquote>\n  <p>well actually the objective is to do all of the code but using Go.</p>\n</blockquote>\n\n<p>**My question is more in terms of a correct way to do things the process to reach big incremental numbers in the code are getting slower and slower. Anyone have any ideia if there of a interface/lib that does this. Or any functionality that i\u00b4m forgeting in Go that could be use to do it better.:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"strings\"\n)\n\nconst payload = \"\\x41\"\n\nfunc main() {\n    //Banner\n    fmt.Printf(\"\\nLauching Fuzzer..\\n\")\n    payL := strings.Repeat(payload, 50)\n\n    for {\n        payL += strings.Repeat(payload, 50)\n        conn, err := net.Dial(\"tcp\", \"localhost:21\")\n        if err != nil {\n            fmt.Println(\"Crash Error: \", err)\n        }\n        final_payload := fmt.Sprint(\"User \" + payL + \"\\r\\n\")\n        _, err = conn.Write([]byte(final_payload))\n        if err != nil {\n            fmt.Println(\"Error: \", err)\n            break\n        } else {\n            fmt.Println(\"Sending buffer with length: \", final_payload)\n            conn.Close()\n        }\n\n    }\n</code></pre>\n"}, {"tags": ["pointers", "go", "interface", "null"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1455660455, "post_id": 35443787, "comment_id": 58586003, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/29138591/hiding-nil-values-understanding-why-golang-fails-here#29138676\">Hiding nil values, understanding why golang fails here</a>."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 3, "creation_date": 1455661023, "post_id": 35443787, "comment_id": 58586280, "body": "The output from your interface example is <code>s is &lt;nil&gt;</code> and <code>s is not nil</code>."}], "answers": [{"comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 3, "creation_date": 1455660245, "post_id": 35443871, "comment_id": 58585898, "body": "I don&#39;t understand where the explicit word <code>null</code> came from. It&#39;s not a construct of Go at all."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1455660278, "post_id": 35443871, "comment_id": 58585918, "body": "I get this distinction and can extend that to explain the behavior of <code>Printf</code> however, I wouldn&#39;t consider this as answering the question so I recommend elaborating on that."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1455660337, "post_id": 35443871, "comment_id": 58585954, "body": "@Not_a_Golfer I would guess there is a special case in <code>fmt</code> for <code>%v</code> with interface types however like I said, MuffinTop should explain that since he didn&#39;t really answer the question as much as point out some details about interfaces."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1455660379, "post_id": 35443871, "comment_id": 58585966, "body": "@evanmcdonnal I tried to write a short playground for this, and didn&#39;t get <code>null</code> as an output."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1455660470, "post_id": 35443871, "comment_id": 58586015, "body": "@Not_a_Golfer interesting... Perhaps the answer is wrong. I was about to do the same until this answer was provided but maybe I should look into it a bit more :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 3, "creation_date": 1455661245, "post_id": 35443871, "comment_id": 58586404, "body": "@Not_a_Golfer: &quot;null&quot; shouldn&#39;t come from the fmt package. It&#39;s likely a custom type, with slightly incorrect terminology, something like <a href=\"http://play.golang.org/p/CRFKJxEkGE\" rel=\"nofollow noreferrer\">play.golang.org/p/CRFKJxEkGE</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1455661823, "post_id": 35443871, "comment_id": 58586686, "body": "@evanmcdonnal I elaborated the answer as you suggested.  I am assuming that &quot;null&quot; in question is a typo and should read &quot;&lt;nil&gt;&quot; as pointed out in comment.  If &quot;null&quot; is printed, then someStruct has a <code>String() string</code> method or some other customization used by the fmt package."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1455664618, "post_id": 35443871, "comment_id": 58587893, "body": "Yeah that makes sense. Couple interesting things at work there. Someone writing poorly in their custom types <code>String()</code> implementation makes a lot more sense than a special case for the <code>%v</code> format specifier."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 3, "last_activity_date": 1455664012, "last_edit_date": 1455664012, "creation_date": 1455660142, "answer_id": 35443871, "question_id": 35443787, "link": "https://stackoverflow.com/questions/35443787/null-vs-nil-in-golang/35443871#35443871", "title": "Null vs nil in golang?", "body": "<p>An interface value contains a reference to a type and a value. In the following code:</p>\n\n<pre><code>var s *someStruct\nFoo(s)\n</code></pre>\n\n<p>the interface value passed to Foo contains a reference to the type <code>*someStruct</code> and a nil.</p>\n\n<p>The statement <code>fmt.Printf(\"s is %v\\n\", s)</code> outputs <code>s is &lt;nil&gt;</code> because of the following:\nThe <code>%v</code> format prints a value using the default format for the type. The value <code>s</code> contains a pointer type. The default format for a pointer type is <code>%p</code>. The <code>%p</code> format prints nil pointers as <code>&lt;nil&gt;</code>. </p>\n\n<p>The expression <code>s != nil</code> evaluates to true because an interface value is equal to nil if and only if the type reference is nil.  In this case, the interface value references the type <code>*someStruct</code>.</p>\n"}], "owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4808, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1455664012, "creation_date": 1455659801, "question_id": 35443787, "link": "https://stackoverflow.com/questions/35443787/null-vs-nil-in-golang", "title": "Null vs nil in golang?", "body": "<p>I ran into a strange bug today. I had a function:</p>\n\n<pre><code>func Foo(s *someStruct) {\n    fmt.Printf(\"s is %v\\n\", s)\n    if s!=nil {\n        fmt.Printf(\"s is not nil\")\n        ...\n    }\n}\n</code></pre>\n\n<p>I would call the function like:</p>\n\n<pre><code>var s *someStruct\nFoo(s)\n</code></pre>\n\n<p>And then I decided to convert the structure into interface:</p>\n\n<pre><code>func Foo(s someStructInterface) {\n    fmt.Printf(\"s is %v\\n\", s)\n    if s!=nil {\n        fmt.Printf(\"s is not nil\")\n        ...\n    }\n}\n</code></pre>\n\n<p>Which gave me a strange output:</p>\n\n<pre><code>s is null\ns is not nil\n</code></pre>\n\n<p>While I expected to get <code>s is nil</code>, which is what I was getting usually. What is the difference between null and nil in this scenario in Go and how can I check if something is null or nil to execute the code properly?</p>\n"}, {"tags": ["multithreading", "go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1455659898, "post_id": 35443781, "comment_id": 58585689, "body": "You won&#39;t need a mutex if you pass a <code>result</code> channel into each routine, send the url you crawl on that back to the calling scope and append there. I wouldn&#39;t recommend trying to cooridinate access to a shared resource within the routines, it&#39;s a lot easier to pass the data back out to a context where there is no concurrency. Just my 2 cents. You can do it with mutexes too."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455659977, "post_id": 35443781, "comment_id": 58585732, "body": "It&#39;s also much easier to reason about if you break out all map access into separate methods, and then <code>Lock(); defer Unlock()</code> in each."}, {"owner": {"reputation": 1580, "user_id": 2089665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/655dc65ea59b2ffee7f63ac94069ac9e?s=128&d=identicon&r=PG", "display_name": "Ian McMahon", "link": "https://stackoverflow.com/users/2089665/ian-mcmahon"}, "edited": false, "score": 0, "creation_date": 1455659990, "post_id": 35443781, "comment_id": 58585740, "body": "Also might be worth exploring a <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"nofollow noreferrer\">RWMutex</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1580, "user_id": 2089665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/655dc65ea59b2ffee7f63ac94069ac9e?s=128&d=identicon&r=PG", "display_name": "Ian McMahon", "link": "https://stackoverflow.com/users/2089665/ian-mcmahon"}, "edited": false, "score": 0, "creation_date": 1455660101, "post_id": 35443781, "comment_id": 58585802, "body": "(@IanMcMahon, RWMutex is a little slower, more to think about, and not usually beneficial around a map since map indexing is very fast)"}], "answers": [{"tags": [], "owner": {"reputation": 624, "user_id": 1887309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8ba562230112c5953454a7b7ec7acb6?s=128&d=identicon&r=PG", "display_name": "Cedmundo", "link": "https://stackoverflow.com/users/1887309/cedmundo"}, "is_accepted": true, "score": 2, "last_activity_date": 1455904838, "creation_date": 1455904838, "answer_id": 35511833, "question_id": 35443781, "link": "https://stackoverflow.com/questions/35443781/multiple-goroutines-access-modify-a-list-map/35511833#35511833", "title": "Multiple goroutines access/modify a list/map", "body": "<p>Well you have two chooses, for a little and simple implementation, I would recommend to separate the operations on the map into a separate structure.</p>\n\n<pre><code>// Index is a shared page index\ntype Index struct {\n    access sync.Mutex\n    pages map[string]bool\n}\n\n// Mark reports that a site have been visited\nfunc (i Index) Mark(name string) {\n    i.access.Lock()\n    i.pages[name] = true\n    i.access.Unlock()\n}\n\n// Visited returns true if a site have been visited\nfunc (i Index) Visited(name string) bool {\n    i.access.Lock()\n    defer i.access.Unlock()\n\n    return i.pages[name]\n}\n</code></pre>\n\n<p>Then, add another structure like this:</p>\n\n<pre><code>// Crawler is a web spider :D\ntype Crawler struct {\n    index Index\n    /* ... other important stuff like visited sites ... */\n}\n\n// Crawl looks for content\nfunc (c *Crawler) Crawl(site string) {\n    // Implement your logic here \n    // For example: \n    if !c.index.Visited(site) {\n        c.index.Mark(site) // When marked\n    }\n}\n</code></pre>\n\n<p>That way you keep things nice and clear, probably a little more code, but definitely more readable. You need to instance crawler like this:</p>\n\n<pre><code>sameIndex := Index{pages: make(map[string]bool)}\nasManyAsYouWant := Crawler{sameIndex, 0} // They will share sameIndex\n</code></pre>\n\n<p>If you want to go further with a high level solution, then I would recommend Producer/Consumer architecture.</p>\n"}], "owner": {"reputation": 2065, "user_id": 1367192, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b8541d7729fff6737972059ded409793?s=128&d=identicon&r=PG", "display_name": "dds", "link": "https://stackoverflow.com/users/1367192/dds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 894, "favorite_count": 0, "accepted_answer_id": 35511833, "answer_count": 1, "score": 1, "last_activity_date": 1455904838, "creation_date": 1455659758, "question_id": 35443781, "link": "https://stackoverflow.com/questions/35443781/multiple-goroutines-access-modify-a-list-map", "title": "Multiple goroutines access/modify a list/map", "body": "<p>I am trying to implement a multithreaded crawler using a go lang as a sample task to learn the language.</p>\n\n<p>It supposed to scan pages, follow links and save them do DB.</p>\n\n<p>To avoid duplicates I'm trying to use map where I save all the URLs I've already saved.</p>\n\n<p>The synchronous version works fine, but I have troubles when I'm trying to use goroutines.</p>\n\n<p>I'm trying to use mutex as a sync object for map, and channel as a way to coordinate goroutines. But obviously I don't have clear understanding of them. </p>\n\n<p>The problem is that I have many duplicate entries, so my map store/check does not work properly.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"golang.org/x/net/html\"\n    \"strings\"\n    \"database/sql\"\n    _ \"github.com/ziutek/mymysql/godrv\"\n    \"io/ioutil\"\n    \"runtime/debug\"\n    \"sync\"\n)\n\nconst maxDepth = 2;\n\nvar workers = make(chan bool)\n\ntype Pages struct {\n    mu sync.Mutex\n    pagesMap map[string]bool\n}\n\nfunc main() {\n    var pagesMutex Pages\n    fmt.Println(\"Start\")\n    const database = \"gotest\"\n    const user = \"root\"\n    const password = \"123\"\n\n    //open connection to DB\n    con, err := sql.Open(\"mymysql\", database + \"/\" + user + \"/\" + password)\n    if err != nil { /* error handling */\n        fmt.Printf(\"%s\", err)\n        debug.PrintStack()\n    }\n\n    fmt.Println(\"call 1st save site\")\n    pagesMutex.pagesMap = make(map[string]bool)\n    go pagesMutex.saveSite(con, \"http://golang.org/\", 0)\n\n    fmt.Println(\"saving true to channel\")\n    workers &lt;- true\n\n    fmt.Println(\"finishing in main\")\n    defer con.Close()\n}\n\n\nfunc (p *Pages) saveSite(con *sql.DB, url string, depth int) {\n    fmt.Println(\"Save \", url, depth)\n    fmt.Println(\"trying to lock\")\n    p.mu.Lock()\n    fmt.Println(\"locked on mutex\")\n    pageDownloaded := p.pagesMap[url] == true\n    if pageDownloaded {\n        p.mu.Unlock()\n        return\n    } else {\n        p.pagesMap[url] = true\n    }\n    p.mu.Unlock()\n\n    response, err := http.Get(url)\n    if err != nil {\n        fmt.Printf(\"%s\", err)\n        debug.PrintStack()\n    } else {\n        defer response.Body.Close()\n\n        contents, err := ioutil.ReadAll(response.Body)\n        if err != nil {\n            if err != nil {\n                fmt.Printf(\"%s\", err)\n                debug.PrintStack()\n            }\n        }\n\n        _, err = con.Exec(\"insert into pages (url) values (?)\", string(url))\n        if err != nil {\n            fmt.Printf(\"%s\", err)\n            debug.PrintStack()\n        }\n        z := html.NewTokenizer(strings.NewReader((string(contents))))\n\n        for {\n            tokenType := z.Next()\n            if tokenType == html.ErrorToken {\n                return\n            }\n\n            token := z.Token()\n            switch tokenType {\n            case html.StartTagToken: // &lt;tag&gt;\n\n                tagName := token.Data\n                if strings.Compare(string(tagName), \"a\") == 0 {\n                    for _, attr := range token.Attr {\n                        if strings.Compare(attr.Key, \"href\") == 0 {\n                            if depth &lt; maxDepth  {\n                                urlNew := attr.Val\n                                if !strings.HasPrefix(urlNew, \"http\")  {\n                                    if strings.HasPrefix(urlNew, \"/\")  {\n                                        urlNew = urlNew[1:]\n                                    }\n                                    urlNew = url + urlNew\n                                }\n                                //urlNew = path.Clean(urlNew)\n                                go  p.saveSite(con, urlNew, depth + 1)\n\n                            }\n                        }\n                    }\n\n                }\n            case html.TextToken: // text between start and end tag\n            case html.EndTagToken: // &lt;/tag&gt;\n            case html.SelfClosingTagToken: // &lt;tag/&gt;\n\n            }\n\n        }\n\n    }\n    val := &lt;-workers\n    fmt.Println(\"finished Save Site\", val)\n}\n</code></pre>\n\n<p>Could someone explain to me how to do this properly, please?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1455658230, "post_id": 35443292, "comment_id": 58584761, "body": "See <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>"}], "answers": [{"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 2, "last_activity_date": 1455658513, "creation_date": 1455658513, "answer_id": 35443459, "question_id": 35443292, "link": "https://stackoverflow.com/questions/35443292/issue-with-interfaces-and-types/35443459#35443459", "title": "issue with interfaces and types", "body": "<p>As Volker mentions in the comments, slices can't be implicitly converted the way their elements can. A <code>Gopher</code> can quack like an <code>Animal</code>, but a <code>[]Gopher</code> can't quack like an <code>[]Animal</code>.</p>\n\n<p>The minimal change to get this working is:</p>\n\n<pre><code>func main() {\n    gophers := []Gopher{{}, {}}\n    out := make([]Animal, len(gophers))\n    for i, val := range gophers {\n        out[i] = Animal(val)\n    }\n    runForest(out...)\n}\n</code></pre>\n"}], "owner": {"reputation": 547, "user_id": 2780187, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c82623ac37e00724492a4a22186b36b3?s=128&d=identicon&r=PG&f=1", "display_name": "user2780187", "link": "https://stackoverflow.com/users/2780187/user2780187"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 35443459, "answer_count": 1, "score": 3, "last_activity_date": 1455658513, "creation_date": 1455657902, "last_edit_date": 1455658252, "question_id": 35443292, "link": "https://stackoverflow.com/questions/35443292/issue-with-interfaces-and-types", "title": "issue with interfaces and types", "body": "<p>Can someone please explain as to why duck typing does not work when a slice is passed to the variadic function.<br>\nCases 1 and 2 as indicated below seems to work, but case-3 below initializes a slice and thereafter passes the dereferenced slice to the function that accepts the interface.</p>\n\n<p>The error message is : <code>cannot use gophers (type []Gopher) as type []Animal in argument to runForest</code></p>\n\n<pre><code>package main\n\n    import (\n        \"fmt\"\n    )\n\n    type Animal interface {\n        Run() string\n    }\n\n    type Gopher struct {\n    }\n\n    func (g Gopher) Run() string {\n        return \"Waddle.. Waddle\"\n    }\n\n    func runForest(animals ...Animal) {\n        for _, animal := range animals {\n            fmt.Println(animal.Run())\n        }\n    }\n\n    func main() {\n\n        //works\n        runForest(Gopher{})\n\n        //works\n        runForest(Gopher{},Gopher{})\n\n        // does not work\n        gophers := []Gopher{{},{}}\n        runForest(gophers...)\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1455657755, "post_id": 35442911, "comment_id": 58584468, "body": "Maybe &quot;How to implement an interface in Go&quot; or &quot;How to implement the sort interface in Go&quot; would be a more descriptive title?"}], "answers": [{"tags": [], "owner": {"reputation": 13632, "user_id": 1071383, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f4bf0fbd4cc6de6159d78f9f9fb3aa6?s=128&d=identicon&r=PG", "display_name": "jabclab", "link": "https://stackoverflow.com/users/1071383/jabclab"}, "is_accepted": false, "score": 7, "last_activity_date": 1455658378, "last_edit_date": 1455658378, "creation_date": 1455657529, "answer_id": 35443185, "question_id": 35442911, "link": "https://stackoverflow.com/questions/35442911/how-to-extend-functions-onto-imported-types-in-golang/35443185#35443185", "title": "How to extend functions onto imported types in Golang", "body": "<p>The <a href=\"https://golang.org/pkg/sort/#Interface\" rel=\"nofollow\"><code>sort.Interface</code></a> defines three methods which must be implemented:</p>\n\n<pre><code>// Len is the number of elements in the collection.\nLen() int\n\n// Less reports whether the element with\n// index i should sort before the element with index j.\nLess(i, j int) bool\n\n// Swap swaps the elements with indexes i and j.\nSwap(i, j int)\n</code></pre>\n\n<p>In this context this would look something like:</p>\n\n<pre><code>type ExternalType struct {\n   quantity int\n}\n\ntype ExternalArray []*ExternalType\n\nfunc (ea ExternalArray) Len() int {\n    return len(ea)\n}\n\nfunc (ea ExternalArray) Less(i, j int) bool {\n    return ea[i].quantity &lt; ea[j].quantity\n}\n\nfunc (ea ExternalArray) Swap(i, j int) {\n    ea[i], ea[j] = ea[j], ea[i]\n}\n</code></pre>\n\n<p>In order to do the sort you can then use <a href=\"https://golang.org/pkg/sort/#Sort\" rel=\"nofollow\"><code>sort.Sort</code></a>, for example:</p>\n\n<pre><code>arr := ExternalArray{\n    &amp;ExternalType{quantity: 33},\n    &amp;ExternalType{quantity: 44},\n    &amp;ExternalType{quantity: 22},\n    &amp;ExternalType{quantity: 11},\n}\n\nsort.Sort(arr)\n// `arr` is now sorted :-)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/BKuffu3XEW\" rel=\"nofollow\">Here</a> is a working example in the playground.</p>\n"}, {"comments": [{"owner": {"reputation": 1580, "user_id": 2089665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/655dc65ea59b2ffee7f63ac94069ac9e?s=128&d=identicon&r=PG", "display_name": "Ian McMahon", "link": "https://stackoverflow.com/users/2089665/ian-mcmahon"}, "edited": false, "score": 0, "creation_date": 1455658026, "post_id": 35443260, "comment_id": 58584640, "body": "Nice solution for multiple sort criteria on a single type!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1531998584, "last_edit_date": 1531998584, "creation_date": 1455657797, "answer_id": 35443260, "question_id": 35442911, "link": "https://stackoverflow.com/questions/35442911/how-to-extend-functions-onto-imported-types-in-golang/35443260#35443260", "title": "How to extend functions onto imported types in Golang", "body": "<p>Define a type in the current package that sorts a slice with the same element type as the imported type:</p>\n\n<pre><code>type byQuantity []*pkg.ExternalType\n\nfunc (a byQuantity) Len() int           { return len(a) }\nfunc (a byQuantity) Swap(i, j int)      { a[i], a[j] = a[j], a[i] }\nfunc (a byQuantity) Less(i, j int) bool { return a[i].Quantity &lt; a[j].Quantity }\n</code></pre>\n\n<p><a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">Convert</a> the imported slice type value to the type defined above and sort:</p>\n\n<pre><code>a := pkg.ExternalArray{{1}, {3}, {2}}\nsort.Sort(byQuantity(a))\n// a is now sorted by quantity\n</code></pre>\n\n<p>Because the original slice and the converted slice share the same backing array, sort on the converted slice also sorts the original slice. </p>\n\n<p><a href=\"http://play.golang.org/p/34Le_ERxdR\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 13300, "user_id": 2521225, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/39c72c6dc4d20a8e736f8ed0d08fa646?s=128&d=identicon&r=PG&f=1", "display_name": "samol", "link": "https://stackoverflow.com/users/2521225/samol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2179, "favorite_count": 0, "accepted_answer_id": 35443260, "answer_count": 2, "score": 0, "last_activity_date": 1531998584, "creation_date": 1455656569, "last_edit_date": 1455657446, "question_id": 35442911, "link": "https://stackoverflow.com/questions/35442911/how-to-extend-functions-onto-imported-types-in-golang", "title": "How to extend functions onto imported types in Golang", "body": "<p>I have an imported type</p>\n\n<pre><code>type ExternalType struct {\n   quantity int\n}\n\n\ntype ExternalArray []*ExternalType\n</code></pre>\n\n<p>I want to be able to implement the sort interface for ExternalArray for so that I sort it by quantity.</p>\n\n<p>However, I am not sure how I could do that?</p>\n\n<p>A concrete example is this:</p>\n\n<p><a href=\"https://play.golang.org/p/bEPtJ8NHQK\" rel=\"nofollow\">https://play.golang.org/p/bEPtJ8NHQK</a></p>\n"}, {"tags": ["sockets", "go", "udp"], "comments": [{"owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455674021, "post_id": 35442824, "comment_id": 58590796, "body": "No, each local interface has its own addresses. However, multiple local interfaces can join the same multicast group. I need to know the exact interface where a datagram addressed to group G was received. Also, I need to know the source address."}], "answers": [{"tags": [], "owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "is_accepted": true, "score": 1, "last_activity_date": 1455723124, "creation_date": 1455723124, "answer_id": 35461010, "question_id": 35442824, "link": "https://stackoverflow.com/questions/35442824/how-to-read-both-input-interface-and-remote-socket-address-for-an-udp-datagram-r/35461010#35461010", "title": "How to read both input interface and remote socket address for an UDP datagram received in Golang?", "body": "<p>When the underlying socket is UDP, .ReadFrom() returns a *net.UDPAddr object as a net.Addr result.</p>\n\n<p>Thus .ReadFrom() can be used go obtain both input interface (as ifIndex) and remote socket full endpoint address (IPaddr+port within net.UDPAddr).</p>\n\n<pre><code>// c is *ipv4.PacketConn\n\nn, cm, srcAddr, err := c.ReadFrom(buf)\n\nswitch srcAddr.(type) {\n    case *net.UDPAddr:\n        udpAddr := srcAddr.(*net.UDPAddr)\n}\n</code></pre>\n"}], "owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 35461010, "answer_count": 1, "score": 0, "last_activity_date": 1455723124, "creation_date": 1455656233, "last_edit_date": 1455711199, "question_id": 35442824, "link": "https://stackoverflow.com/questions/35442824/how-to-read-both-input-interface-and-remote-socket-address-for-an-udp-datagram-r", "title": "How to read both input interface and remote socket address for an UDP datagram received in Golang?", "body": "<p><code>PacketConn.ReadFrom()</code> can provide <code>ControlMessage</code> containing the ifIndex for the input interface.</p>\n\n<p><code>UDPConn.ReadFromUDP()</code> returns <code>net.UDPAddr</code> with the source socket address (srcIP+srcPort) of the datagram.</p>\n\n<p>However, how to get BOTH informations: input interface ifIndex <strong>AND</strong> remote socket address (srcIP+srcPort) ?</p>\n\n<p>EDIT: I have filled an issue: <a href=\"https://github.com/golang/go/issues/14362\" rel=\"nofollow\">https://github.com/golang/go/issues/14362</a></p>\n"}, {"tags": ["json", "go", "solr"], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 5, "last_activity_date": 1455650688, "creation_date": 1455650688, "answer_id": 35441343, "question_id": 35441254, "link": "https://stackoverflow.com/questions/35441254/making-minimal-modification-to-json-data-without-a-structure-in-golang/35441343#35441343", "title": "Making minimal modification to JSON data without a structure in golang", "body": "<p>Here's a really brief example of how to do this quickly and easily. The steps are; unmarshal into the universal <code>map[string]interface{}</code> then, assuming no errors, marshal only the inner object which you want.</p>\n\n<pre><code>var temp := &amp;map[string]interface{}\n\nif err := json.Unmarshal(input, temp); err != nil {\n     return err;\n}\n\nreturn json.Marshal(temp[\"response\"])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 3285226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aRvYZ.jpg?s=128&g=1", "display_name": "Oliver N", "link": "https://stackoverflow.com/users/3285226/oliver-n"}, "is_accepted": false, "score": 0, "last_activity_date": 1613622698, "last_edit_date": 1613622698, "creation_date": 1610164635, "answer_id": 65639211, "question_id": 35441254, "link": "https://stackoverflow.com/questions/35441254/making-minimal-modification-to-json-data-without-a-structure-in-golang/65639211#65639211", "title": "Making minimal modification to JSON data without a structure in golang", "body": "<p>I wrote a package <a href=\"https://github.com/olvrng/ujson\" rel=\"nofollow noreferrer\">\u00b5json</a> to do exactly that: performing generic transformations on JSON documents without unmarshalling them.</p>\n<p><a href=\"https://play.golang.org/p/RHlqJPeUEkz\" rel=\"nofollow noreferrer\">Run on Go Playground</a></p>\n<pre class=\"lang-golang prettyprint-override\"><code>input := []byte(`\n{\n  &quot;responseHeader&quot;: {\n    &quot;status&quot;: 0,\n    &quot;QTime&quot;: 0,\n    &quot;params&quot;: {\n      &quot;q&quot;: &quot;solo&quot;,\n      &quot;wt&quot;: &quot;json&quot;\n    }\n  },\n  &quot;response&quot;: {\n    &quot;numFound&quot;: 2,\n    &quot;start&quot;: 0,\n    &quot;docs&quot;: [\n      { &quot;name&quot;: &quot;foo&quot; },\n      { &quot;name&quot;: &quot;bar&quot; }\n    ]\n  }\n}`)\n\nblacklistFields := [][]byte{\n    []byte(`&quot;responseHeader&quot;`), // note the quotes\n}\nb := make([]byte, 0, 1024)\nerr := ujson.Walk(input, func(_ int, key, value []byte) bool {\n    for _, blacklist := range blacklistFields {\n        if bytes.Equal(key, blacklist) {\n            // remove the key and value from the output\n            return false\n        }\n    }\n\n    // write to output\n    if len(b) != 0 &amp;&amp; ujson.ShouldAddComma(value, b[len(b)-1]) {\n        b = append(b, ',')\n    }\n    if len(key) &gt; 0 {\n        b = append(b, key...)\n        b = append(b, ':')\n    }\n    b = append(b, value...)\n    return true\n})\nif err != nil {\n    panic(err)\n}\nfmt.Printf(&quot;%s&quot;, b)\n// Output: {&quot;response&quot;:{&quot;numFound&quot;:2,&quot;start&quot;:0,&quot;docs&quot;:[{&quot;name&quot;:&quot;foo&quot;},{&quot;name&quot;:&quot;bar&quot;}]}}\n</code></pre>\n<p>You can <a href=\"https://olvrng.github.io/w/ujson/\" rel=\"nofollow noreferrer\">read more about it on the blog post</a>. I put the answer here just in case someone else might need it.</p>\n"}], "owner": {"reputation": 33, "user_id": 5424335, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3tauo07I2vY/AAAAAAAAAAI/AAAAAAAAAG8/7AznHrsmyP0/photo.jpg?sz=128", "display_name": "Henrik Franz&#233;n", "link": "https://stackoverflow.com/users/5424335/henrik-franz%c3%a9n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 570, "favorite_count": 1, "accepted_answer_id": 35441343, "answer_count": 2, "score": 2, "last_activity_date": 1613622698, "creation_date": 1455650415, "last_edit_date": 1455653641, "question_id": 35441254, "link": "https://stackoverflow.com/questions/35441254/making-minimal-modification-to-json-data-without-a-structure-in-golang", "title": "Making minimal modification to JSON data without a structure in golang", "body": "<p>I have a solr response in JSON format which looks like this:</p>\n\n<pre><code> {\n  \"responseHeader\": {\n    \"status\": 0,\n    \"QTime\": 0,\n    \"params\": {\n      \"q\": \"solo\",\n      \"wt\": \"json\"\n    }\n  },\n  \"response\": {\n    \"numFound\": 2,\n    \"start\": 0,\n    \"docs\": [\n      {\n          &lt;Large nested JSON element&gt;\n      },\n      {\n          &lt;Large nested JSON element&gt;\n      }\n    ]\n  }\n}\n</code></pre>\n\n<p>Now, in my Golang app, I would like to quickly remove the \"responseHeader\" so that I can return the \"response\" alone. How can I do this without creating large structures?</p>\n\n<hr>\n\n<h1>Edit 1</h1>\n\n<p>The answer by evanmcdonnal was the solution to this problem, but it had some minor typos, this is what I ended up using:</p>\n\n<pre><code>var temp map[string]interface{}\n\nif err := json.Unmarshal(body, &amp;temp); err != nil {\n    panic(err.Error())\n}\n\nresult, err := json.Marshal(temp[\"response\"])\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1218, "user_id": 1407527, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/4033d9b1475b98e7d87d1f89a6e2dec8?s=128&d=identicon&r=PG", "display_name": "Ozum Safa", "link": "https://stackoverflow.com/users/1407527/ozum-safa"}, "edited": false, "score": 0, "creation_date": 1455655208, "post_id": 35440724, "comment_id": 58582958, "body": "You mean, tag is created at an address once, and the value in the address is overwritten in each loop?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1218, "user_id": 1407527, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/4033d9b1475b98e7d87d1f89a6e2dec8?s=128&d=identicon&r=PG", "display_name": "Ozum Safa", "link": "https://stackoverflow.com/users/1407527/ozum-safa"}, "edited": false, "score": 0, "creation_date": 1455655615, "post_id": 35440724, "comment_id": 58583199, "body": "@OzumSafa: yes, precisely."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1455654779, "last_edit_date": 1455654779, "creation_date": 1455648636, "answer_id": 35440724, "question_id": 35440619, "link": "https://stackoverflow.com/questions/35440619/golang-content-of-a-pointer-in-a-slice-changes-during-recursive-function-run/35440724#35440724", "title": "golang - Content of a pointer in a slice changes during recursive function run", "body": "<p>The <code>tag</code> variable is declared once at the start of the loop, and the value of <code>tag</code> is overwritten on each iteration. This is the same problem you see in the <a href=\"https://golang.org/doc/faq\" rel=\"nofollow\">FAQ</a> with: <a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow\">\"What happens with closures running as goroutines?\"</a></p>\n\n<p>You can declare a new variable during each iteration to get a unique pointer for the function call:</p>\n\n<pre><code>for _, tag := range htmlTag.ChildTags {\n    tag := tag\n    getAllCertainDivs(className, idName, &amp;tag, matchingDivs)\n}\n</code></pre>\n\n<p>Alternatively you can elide the range value, and use the index directly:</p>\n\n<pre><code>for i := range htmlTag.ChildTags {\n    getAllCertainDivs(className, idName, &amp;htmlTag.ChildTags[i], matchingDivs)\n}\n</code></pre>\n"}], "owner": {"reputation": 1218, "user_id": 1407527, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/4033d9b1475b98e7d87d1f89a6e2dec8?s=128&d=identicon&r=PG", "display_name": "Ozum Safa", "link": "https://stackoverflow.com/users/1407527/ozum-safa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 765, "favorite_count": 0, "accepted_answer_id": 35440724, "answer_count": 1, "score": 0, "last_activity_date": 1529454330, "creation_date": 1455648263, "last_edit_date": 1455649902, "question_id": 35440619, "link": "https://stackoverflow.com/questions/35440619/golang-content-of-a-pointer-in-a-slice-changes-during-recursive-function-run", "title": "golang - Content of a pointer in a slice changes during recursive function run", "body": "<pre><code>func getAllCertainDivs(className string, idName string, htmlTag *HtmlTag, matchingDivs *[]*HtmlTag) {\n    fmt.Println(htmlTag.Class)\n    if htmlTag.XMLName.Local == \"div\" {\n        if htmlTag.Class == className &amp;&amp; htmlTag.Id == idName {\n            *matchingDivs = append(*matchingDivs, htmlTag)\n        }\n    }\n\n    for _, tag := range htmlTag.ChildTags {\n        getAllCertainDivs(className, idName, &amp;tag, matchingDivs)\n    }\n}\n</code></pre>\n\n<p>In the function above, as you can see, I pass a pointer of a slice into the <code>getAllCertainDivs</code> function. At a point a <code>HtmlTag</code> pointer is pushed into the slice <code>matchingDivs</code>. After the <code>append</code> I check the content of the matchingDiv slice, before letting the function call itself recursively again. Then below the if where <code>append</code> was made, the function calls itself recursively one time. And I stop at the <code>fmt.Println(htmlTag.Class)</code> and check the content of <code>matchingDivs</code> slice again. And the content is completely different than before.</p>\n\n<p>There has only been one <code>append</code>, how can the content change ? Does <code>golang</code> use the same <code>HtmlTag</code> pointer, everytime I pass it into next recursive call ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 1, "creation_date": 1455644272, "post_id": 35439281, "comment_id": 58576507, "body": "The values are swapped inside your <code>swap</code> function, but the changes are not passed outside the function. See @JimB answer on how to fix it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1455644345, "post_id": 35439281, "comment_id": 58576547, "body": "If you are new to go, you should go through the <a href=\"http://tour.golang.org/\" rel=\"nofollow noreferrer\">Tour of Go</a>. It will cover all the basics like this."}, {"owner": {"reputation": 1948, "user_id": 1924657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gumlg.jpg?s=128&g=1", "display_name": "Bryce", "link": "https://stackoverflow.com/users/1924657/bryce"}, "edited": false, "score": 0, "creation_date": 1469785064, "post_id": 35439281, "comment_id": 64692142, "body": "Go&#39;s function parameters are passed by copy. And it&#39;s not just golang that pass by copy."}], "answers": [{"comments": [{"owner": {"reputation": 2345, "user_id": 4511585, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/IC7eZ.jpg?s=128&g=1", "display_name": "albttx", "link": "https://stackoverflow.com/users/4511585/albttx"}, "edited": false, "score": 0, "creation_date": 1455644377, "post_id": 35439337, "comment_id": 58576567, "body": "Thanks you, i tried with pointers, but i didn&#39;t wrote the * before all variables"}, {"owner": {"reputation": 607, "user_id": 1182718, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6795184bd530bb90fef8abfcaed4800d?s=128&d=identicon&r=PG", "display_name": "Burst", "link": "https://stackoverflow.com/users/1182718/burst"}, "edited": false, "score": 0, "creation_date": 1594054089, "post_id": 35439337, "comment_id": 110985737, "body": "Why not just   a,b = b,a   as shown here: <a href=\"https://stackoverflow.com/a/38571485\">stackoverflow.com/a/38571485</a>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 607, "user_id": 1182718, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6795184bd530bb90fef8abfcaed4800d?s=128&d=identicon&r=PG", "display_name": "Burst", "link": "https://stackoverflow.com/users/1182718/burst"}, "edited": false, "score": 0, "creation_date": 1594056017, "post_id": 35439337, "comment_id": 110986618, "body": "@Burst: because the point of this trivial example was the function implementation, <i>not</i> doing it inline, and in the function you need pointers to modify the values."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1455653771, "last_edit_date": 1455653771, "creation_date": 1455644192, "answer_id": 35439337, "question_id": 35439281, "link": "https://stackoverflow.com/questions/35439281/swap-two-strings-golang/35439337#35439337", "title": "swap two strings (Golang)", "body": "<p>Swapping <code>str1</code> and <code>str2</code> doesn't change <code>a</code> and <code>b</code>, because they are copies of <code>a</code> and <code>b</code>. Use pointers:</p>\n\n<pre><code>func swap(str1, str2 *string) {\n    *str1, *str2 = *str2, *str1\n}\n\nfunc main() {\n    a := \"salut\"\n    b := \"les gens\"\n    swap(&amp;a, &amp;b)\n    fmt.Printf(\"a=%s\\nb=%s\\n\", a, b)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/Qw0t5I-XGT\" rel=\"nofollow\">http://play.golang.org/p/Qw0t5I-XGT</a></p>\n"}, {"tags": [], "owner": {"reputation": 607, "user_id": 6001349, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PTE_eA98cOE/AAAAAAAAAAI/AAAAAAAAACI/GhBOo8gJQbU/photo.jpg?sz=128", "display_name": "harold ramos", "link": "https://stackoverflow.com/users/6001349/harold-ramos"}, "is_accepted": false, "score": 1, "last_activity_date": 1462882515, "last_edit_date": 1462882515, "creation_date": 1462878985, "answer_id": 37136964, "question_id": 35439281, "link": "https://stackoverflow.com/questions/35439281/swap-two-strings-golang/37136964#37136964", "title": "swap two strings (Golang)", "body": "<p>This will be the  idiomatic way.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc swap(a, b string)(string, string) {\n    return b, a\n}\n\nfunc main() {\n    f, s := swap(\"world\" , \"hello\")\n    fmt.Println(f, s)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6428330, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/037e18d09d6150a101b9f1f3f7fd7b45?s=128&d=identicon&r=PG", "display_name": "acf", "link": "https://stackoverflow.com/users/6428330/acf"}, "is_accepted": false, "score": 0, "last_activity_date": 1465177602, "creation_date": 1465177602, "answer_id": 37648540, "question_id": 35439281, "link": "https://stackoverflow.com/questions/35439281/swap-two-strings-golang/37648540#37648540", "title": "swap two strings (Golang)", "body": "<p>you can write as that:</p>\n\n<pre><code>a := \"hello\"\nb := \"world\"\na, b = b, a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1633, "user_id": 1683398, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1feeb235dd5c51c93460ded77c6dccf0?s=128&d=identicon&r=PG", "display_name": "Anchal Sarraf", "link": "https://stackoverflow.com/users/1683398/anchal-sarraf"}, "is_accepted": false, "score": 0, "last_activity_date": 1467615835, "creation_date": 1467615835, "answer_id": 38178680, "question_id": 35439281, "link": "https://stackoverflow.com/questions/35439281/swap-two-strings-golang/38178680#38178680", "title": "swap two strings (Golang)", "body": "<pre><code>package main\n\nimport \"fmt\"\n\nfunc swap(a,b string)(string, string){\nreturn b,a\n}\n\nfunc main(){\nfmt.Println(swap(\"Lang\",\"Go\"))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5, "user_id": 5972783, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-OO9JsI4bOnw/AAAAAAAAAAI/AAAAAAAAAOs/zc_U0p1GtTs/photo.jpg?sz=128", "display_name": "borey", "link": "https://stackoverflow.com/users/5972783/borey"}, "is_accepted": false, "score": 1, "last_activity_date": 1471665445, "creation_date": 1471665445, "answer_id": 39050331, "question_id": 35439281, "link": "https://stackoverflow.com/questions/35439281/swap-two-strings-golang/39050331#39050331", "title": "swap two strings (Golang)", "body": "<p>Built-in types as function arguments are passed by value, but if the elements for dereference will modify the original value, such as slice, map. e.g.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"strings\"\n)\n\nfunc f_1(a int) {\n    a = 2\n}\n\nfunc f_1_1(a *int) {\n    *a = 2\n}\n\nfunc f_2(s string) {\n    s = \"cba\"\n}\n\nfunc f_2_1(s *string) {\n    *s = \"cba\"\n}\n\nfunc f_3(v []string) {\n    v[0] = \"haha\"\n}\n\nfunc f_3_1(v []string) {\n    v = nil\n}\n\nfunc f_3_2(v *[]string) {\n    *v = nil\n}\n\nfunc f_4(m map[int]int) {\n    m[1] = 3\n    m[3] = 1\n}\n\nfunc f_4_1(m map[int]int) {\n    m = nil\n}\n\nfunc f_4_2(m *map[int]int) {\n    *m = nil\n}\n\nfunc f_5(b []byte) {\n    b[0] = 0x40\n}\n\nfunc f_5_1(b []byte) {\n    b = bytes.Replace(b, []byte(\"1\"), []byte(\"a\"), -1)\n}\n\nfunc f_5_2(b *[]byte) {\n    *b = bytes.Replace(*b, []byte(\"1\"), []byte(\"a\"), -1)\n}\n\ntype why struct {\n    s []string\n}\n\nfunc (ss why) SetV(s []string) {\n    ss.s = s\n}\n\nfunc (ss *why) SetP(s []string) {\n    ss.s = s\n}\n\nfunc (ss why) String() string {\n    return strings.Join(ss.s, \",\")\n}\n\nfunc main() {\n    a := 1\n    s := \"abc\"\n    v := []string{\"sd\", \"aa\"}\n    m := map[int]int{1: 1, 2: 2, 3: 3}\n    f_1(a)\n    f_2(s)\n    f_3(v)\n    f_4(m)\n    fmt.Printf(\"%d,%s,%v,%v\\n\", a, s, v, m)\n    f_3_1(v)\n    f_4_1(m)\n    fmt.Printf(\"%d,%s,%v,%v\\n\", a, s, v, m)\n    f_1_1(&amp;a)\n    f_2_1(&amp;s)\n    f_3_2(&amp;v)\n    f_4_2(&amp;m)\n    fmt.Printf(\"%d,%s,%v,%v\\n\", a, s, v, m)\n    b := []byte(\"12145178\")\n    f_5(b)\n    fmt.Printf(\"%s\\n\", b)\n    f_5_1(b)\n    fmt.Printf(\"%s\\n\", b)\n    f_5_2(&amp;b)\n    fmt.Printf(\"%s\\n\", b)\n    ss := &amp;why{}\n    ss.SetV([]string{\"abc\", \"efg\"})\n    fmt.Println(ss)\n    ss.SetP([]string{\"abc\", \"efg\"})\n    fmt.Println(ss)\n}\n</code></pre>\n"}], "owner": {"reputation": 2345, "user_id": 4511585, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/IC7eZ.jpg?s=128&g=1", "display_name": "albttx", "link": "https://stackoverflow.com/users/4511585/albttx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1378, "favorite_count": 0, "accepted_answer_id": 35439337, "answer_count": 5, "score": 0, "last_activity_date": 1471665445, "creation_date": 1455644052, "question_id": 35439281, "link": "https://stackoverflow.com/questions/35439281/swap-two-strings-golang", "title": "swap two strings (Golang)", "body": "<p>I am currently learning Golang, and i decided to write few simple algorithm for learning the syntax. i hope it's not already answers but i didn't found it ..</p>\n\n<p>I have a problem for swapping string</p>\n\n<pre><code>func swap(str1, str2 string) {\n    /*\n     * Also possible :\n     * str1, str2 = str2, str1\n     */\n    // str1, str2 = str2, str1\n    tmp := str1\n    str1 = str2\n    str2 = tmp\n}\n\nfunc main() {\n    a := \"World !\"\n    b := \"Hello\"\n    swap(a, b)\n    fmt.Printf(\"a=%s\\nb=%s\\n\", a, b)\n}\n</code></pre>\n\n<p>Why this code didn't work ?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 1, "last_activity_date": 1455636701, "creation_date": 1455636701, "answer_id": 35436585, "question_id": 35436424, "link": "https://stackoverflow.com/questions/35436424/get-keys-and-values-from-json-decoder/35436585#35436585", "title": "Get keys and values from json.Decoder", "body": "<p>Your 'name' field within your <code>Weather</code> struct is unexported. Field types must be exported for other packages to see them (and therefore, unmarshal/decode into them): <a href=\"https://tour.golang.org/basics/3\" rel=\"nofollow\">https://tour.golang.org/basics/3</a></p>\n\n<p>You can use struct tags to map Go field names to JSON keys as well:</p>\n\n<pre><code>type Weather struct {\n    Name string `json:\"name\"`\n}\n</code></pre>\n\n<p>... and for the future, you can use <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow\">https://mholt.github.io/json-to-go/</a> to auto-generate Go structs from JSON.</p>\n"}], "owner": {"reputation": 512, "user_id": 3782382, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0e0f24876474e579ce70cbbdd45e9571?s=128&d=identicon&r=PG&f=1", "display_name": "asyndrige", "link": "https://stackoverflow.com/users/3782382/asyndrige"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 35436585, "answer_count": 1, "score": 0, "last_activity_date": 1455637210, "creation_date": 1455636338, "last_edit_date": 1455637210, "question_id": 35436424, "link": "https://stackoverflow.com/questions/35436424/get-keys-and-values-from-json-decoder", "title": "Get keys and values from json.Decoder", "body": "<p>Playing with Golang in my spare time. Trying to perform typical web task: get json from GET request and print its values.</p>\n\n<pre><code>type Weather struct {\n    name string\n}\n// some code\ndecoder := json.NewDecoder(res.Body)\nfor {\n        var weather Weather\n        if err := decoder.Decode(&amp;weather); err == io.EOF {\n            break\n        } else if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Println(weather.name)\n    }\n</code></pre>\n\n<p>JSON:</p>\n\n<pre><code>{\"coord\":{\"lon\":145.77,\"lat\":-16.92},\"weather\":[{\"id\":801,\"main\":\"Clouds\",\"description\":\"few clouds\",\"icon\":\"02n\"}],\"base\":\"stations\",\"main\":{\"temp\":300.15,\"pressure\":1007,\"humidity\":74,\"temp_min\":300.15,\"temp_max\":300.15},\"visibility\":10000,\"wind\":{\"speed\":2.6,\"deg\":260},\"clouds\":{\"all\":20},\"dt\":1455633000,\"sys\":{\"type\":1,\"id\":8166,\"message\":0.0314,\"country\":\"AU\",\"sunrise\":1455567124,\"sunset\":1455612583},\"id\":2172797,\"name\":\"Cairns\",\"cod\":200}\n</code></pre>\n\n<p>As I understand, I need to declare a struct to get json values, but it prints nothing. What is my mistake? </p>\n\n<p>And what if I need to operate json with unknown fields? Is there a way to construct map directly from json?</p>\n"}, {"tags": ["sockets", "go", "network-programming"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1455636995, "post_id": 35436262, "comment_id": 58571341, "body": "I could be wrong but that sounds more like a bug in the package, if noone posts something helpful, try to file an <a href=\"https://github.com/golang/go/issues/new?title=x/net/ipv4:\" rel=\"nofollow noreferrer\">issue</a>."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 1, "creation_date": 1455638950, "post_id": 35436262, "comment_id": 58572833, "body": "Do you call <code>p.JoinGroup()</code> anywhere, as the docs you link to does ?"}, {"owner": {"reputation": 1508, "user_id": 448420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6025e3530546eb4f2e6abb51b2c11ce8?s=128&d=identicon&r=PG", "display_name": "runec", "link": "https://stackoverflow.com/users/448420/runec"}, "edited": false, "score": 0, "creation_date": 1455641628, "post_id": 35436262, "comment_id": 58574774, "body": "I&#39;m sorry! You&#39;re quite right nos - I removed too much when removing error checks. Code is updated now."}], "owner": {"reputation": 1508, "user_id": 448420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6025e3530546eb4f2e6abb51b2c11ce8?s=128&d=identicon&r=PG", "display_name": "runec", "link": "https://stackoverflow.com/users/448420/runec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 777, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1455641559, "creation_date": 1455635967, "last_edit_date": 1455641559, "question_id": 35436262, "link": "https://stackoverflow.com/questions/35436262/multicast-udp-communication-using-golang-org-x-net-ipv4", "title": "Multicast UDP communication using golang.org/x/net/ipv4", "body": "<p>Using Go 1.5.2 and the standard net package I've implemented an UDP multicast sender and receiver for Windows. \nHowever, because of some issues sending MC UDP package through a router, I'm re-implementing it using golang.org/x/net/ipv4.</p>\n\n<p>For the 2 functions below, the first one is able to receive multicast UDP, the socond one not. Can someone please tell me what's wrong?</p>\n\n<p>Never returns from ReadFrom:</p>\n\n<pre><code>import (\n    \"golang.org/x/net/ipv4\"\n    \"net\"\n    ...\n)\n\nfunc fails(intf net.Interface, mcaddr string, buff []byte) ( n int, err error) {\n    ipRemote, err := net.ResolveUDPAddr(\"udp\", mcaddr)\n    // error check\n\n    c, err := net.ListenPacket(\"udp4\", \":0\")\n    // error check\n\n    p := ipv4.NewPacketConn(c)\n    // error check\n    err := p.JoinGroup(intf, &amp;ipRemote)\n    // err check\n\n    n, _, _, err = p.ReadFrom(buff)     // never returns\n    // error check\n}\n</code></pre>\n\n<p>Returns data:</p>\n\n<pre><code>func succeeds(intf net.Interface, mcaddr string, buff []byte) ( n int, err error) {\n    ipRemote, err := net.ResolveUDPAddr(\"udp\", mcaddr)\n    // error check\n\n    conn, err := net.ListenMulticastUDP(\"udp\", intf, ipRemote)\n    // error check\n\n    n, err = conn.Read(buff)        // Returns when data is received\n    // error check\n}\n</code></pre>\n\n<p>I'm using, e.g.,  224.4.3.224:60300, for mcaddr. Using exactly same arguments for both functions, the first fails and the second succeeds.</p>\n\n<p>The first function is implemented based on <a href=\"https://godoc.org/golang.org/x/net/ipv4\" rel=\"nofollow\">https://godoc.org/golang.org/x/net/ipv4</a>. Windows does not support the <code>p.SetControlMessage()</code> function used there.</p>\n"}, {"tags": ["go", "url", "query-string", "revel"], "answers": [{"comments": [{"owner": {"reputation": 58, "user_id": 3173409, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d6e363f7845b9b2ab6efbf756c53749d?s=128&d=identicon&r=PG&f=1", "display_name": "Rudys", "link": "https://stackoverflow.com/users/3173409/rudys"}, "edited": false, "score": 0, "creation_date": 1455633215, "post_id": 35434991, "comment_id": 58568581, "body": "hi @simo-endre thanks for your answer.So if we pass the url : localhost:9000/company?name=ABC so the route in your answer will handle this?"}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 0, "last_activity_date": 1455632452, "creation_date": 1455632452, "answer_id": 35434991, "question_id": 35433979, "link": "https://stackoverflow.com/questions/35433979/how-to-read-query-parameters-in-revel-using-the-routes-file/35434991#35434991", "title": "How to read query parameters in Revel using the &#39;routes&#39; file?", "body": "<p>According to revel documentation, all request parameters are collected into the single Params object which includes:</p>\n\n<pre><code>The URL /:path parameters\nThe URL ?query parameters\nSubmitted Form values\nFile multipart uploads\n</code></pre>\n\n<p>Extracted parameters are available via Action method <a href=\"https://revel.github.io/manual/parameters.html\" rel=\"nofollow\"><code>parameters</code></a>.</p>\n\n<pre><code>type Params struct {\n    url.Values\n    Files map[string][]*multipart.FileHeader\n}\n</code></pre>\n\n<p>Checking the Params struct we can observe that it use <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow\"><code>url.Values</code></a></p>\n\n<p>According to above information the query param url route can be set as:</p>\n\n<pre><code>GET    /company/:name?name            APP.ShowByName\n</code></pre>\n\n<p>And the controller action:</p>\n\n<pre><code>func (c APP) ShowByName(name string) revel.Result {\n    ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 58, "user_id": 3173409, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d6e363f7845b9b2ab6efbf756c53749d?s=128&d=identicon&r=PG&f=1", "display_name": "Rudys", "link": "https://stackoverflow.com/users/3173409/rudys"}, "is_accepted": true, "score": 0, "last_activity_date": 1458045869, "creation_date": 1458045869, "answer_id": 36011718, "question_id": 35433979, "link": "https://stackoverflow.com/questions/35433979/how-to-read-query-parameters-in-revel-using-the-routes-file/36011718#36011718", "title": "How to read query parameters in Revel using the &#39;routes&#39; file?", "body": "<p>I found solution to this.</p>\n\n<p>In action I placed the below code :</p>\n\n<pre><code>c.Params.Query=c.Request.URL.Query()\nvar limit int\nc.Params.Bind(&amp;limit,\"limit\")\n</code></pre>\n\n<p>and it work for the below URL:</p>\n\n<pre><code>localhost:9000?limit=21\n</code></pre>\n\n<p>Here is the complete code for that\n<a href=\"https://github.com/rishirajdev/revel-queryParameters.git\" rel=\"nofollow\">revel read query parameter</a></p>\n"}, {"tags": [], "owner": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "is_accepted": false, "score": 0, "last_activity_date": 1549094007, "last_edit_date": 1549094007, "creation_date": 1549092351, "answer_id": 54490980, "question_id": 35433979, "link": "https://stackoverflow.com/questions/35433979/how-to-read-query-parameters-in-revel-using-the-routes-file/54490980#54490980", "title": "How to read query parameters in Revel using the &#39;routes&#39; file?", "body": "<p>URL query parameters are automatically passed to controllers.</p>\n\n<p>In your <code>routes</code> file, just specify the URL path (ignoring the query string).\nFor the example <code>localhost:9000/company?name=ABC</code> given in the question, you would just have:</p>\n\n<pre><code>(routes file)\n\nGET /company      SomeController.ShowByName\n</code></pre>\n\n<p>Then within the controller, just add function parameters. Revel will bind these to the appropriate query string values:</p>\n\n<pre><code>func (c SomeController) ShowByName(name string) revel.Result {\n  if name == \"\" {\n    // handle missing or empty\n  }\n  // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 58, "user_id": 3173409, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d6e363f7845b9b2ab6efbf756c53749d?s=128&d=identicon&r=PG&f=1", "display_name": "Rudys", "link": "https://stackoverflow.com/users/3173409/rudys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1354, "favorite_count": 0, "accepted_answer_id": 36011718, "answer_count": 3, "score": 1, "last_activity_date": 1549094007, "creation_date": 1455629471, "last_edit_date": 1549092582, "question_id": 35433979, "link": "https://stackoverflow.com/questions/35433979/how-to-read-query-parameters-in-revel-using-the-routes-file", "title": "How to read query parameters in Revel using the &#39;routes&#39; file?", "body": "<p>I am new to Revel and golang. I need help as to how can I access query paramters in Revel and configure it in routes.</p>\n\n<p>Example: <code>localhost:9000/company?name=ABC</code>.</p>\n\n<p>I am sending above get request to fetch the company by name from database. I don't know how can I configure it in the <code>routes</code> file. </p>\n\n<p>My action has</p>\n\n<pre><code>func (c APP) ShowByName(name string){..}\n</code></pre>\n\n<p>This is how I have set the routes:</p>\n\n<pre><code>GET /company?name:name      APP.ShowByName\n</code></pre>\n"}, {"tags": ["go", "process", "signals", "fork"], "answers": [{"comments": [{"owner": {"reputation": 535, "user_id": 1781494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fw1u3.png?s=128&g=1", "display_name": "GreNodge", "link": "https://stackoverflow.com/users/1781494/grenodge"}, "edited": false, "score": 0, "creation_date": 1455640567, "post_id": 35435038, "comment_id": 58574011, "body": "This works perfectly for Linux. Can I expect that the follwing lines do the same for Windows?  \tcmd.SysProcAttr = &amp;syscall.SysProcAttr{ \t\tCreationFlags: 0x00000008, \t}  Following the codes listed on: <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms684863(v=vs.85).aspx\" rel=\"nofollow noreferrer\">msdn.microsoft.com/en-us/library/windows/desktop/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 535, "user_id": 1781494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fw1u3.png?s=128&g=1", "display_name": "GreNodge", "link": "https://stackoverflow.com/users/1781494/grenodge"}, "edited": false, "score": 0, "creation_date": 1455641444, "post_id": 35435038, "comment_id": 58574648, "body": "@GreNodge: I don&#39;t know about windows, but that doesn&#39;t sound like the same thing (though it may do what you want). The description for <code>syscall.CREATE_NEW_PROCESS_GROUP</code> sounds similar to POSIX setpgid."}, {"owner": {"reputation": 535, "user_id": 1781494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fw1u3.png?s=128&g=1", "display_name": "GreNodge", "link": "https://stackoverflow.com/users/1781494/grenodge"}, "edited": false, "score": 0, "creation_date": 1455645707, "post_id": 35435038, "comment_id": 58577465, "body": "I try both out. Both seems to work like expected. But I agree with you that syscall.CREATE_NEW_PROCESS_GROUP seems to be the better matching kind. Thank you for your support."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1455636519, "last_edit_date": 1455636519, "creation_date": 1455632593, "answer_id": 35435038, "question_id": 35433741, "link": "https://stackoverflow.com/questions/35433741/in-golang-prevent-child-processes-to-receive-signals-from-calling-process/35435038#35435038", "title": "In golang: Prevent child processes to receive signals from calling process", "body": "<p>The child processes are starting in the same process group by default, and your shell is sending the signal to all the processes at once when you press <code>ctrl+c</code>. This is the default behavior of the shell to try and clean up when you interrupt a program.</p>\n\n<p>The child processes won't receive signals sent directly to the parent. </p>\n\n<p>If you want to prevent the <code>ctrl+c</code> behavior, you can force the child processes to start in their own process groups with with the <code>Setpgid</code> and <code>Pgid</code> fields in <a href=\"https://golang.org/pkg/syscall/#SysProcAttr\" rel=\"noreferrer\"><code>syscall.SysProcAttr</code></a> before starting the processes. </p>\n\n<pre><code>cmd.SysProcAttr = &amp;syscall.SysProcAttr{\n    Setpgid: true,\n    Pgid:    0,\n}\n</code></pre>\n"}], "owner": {"reputation": 535, "user_id": 1781494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/fw1u3.png?s=128&g=1", "display_name": "GreNodge", "link": "https://stackoverflow.com/users/1781494/grenodge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2768, "favorite_count": 2, "accepted_answer_id": 35435038, "answer_count": 1, "score": 2, "last_activity_date": 1455636519, "creation_date": 1455628760, "question_id": 35433741, "link": "https://stackoverflow.com/questions/35433741/in-golang-prevent-child-processes-to-receive-signals-from-calling-process", "title": "In golang: Prevent child processes to receive signals from calling process", "body": "<p>Given is the following code:</p>\n\n<pre><code>package main\nimport (\n    \"os\"\n    \"fmt\"\n    \"os/exec\"\n    \"os/signal\"\n    \"syscall\"\n)\n\nconst NUMBER_OF_PEASANTS = 3\n\nfunc createPeasants() map[string]*exec.Cmd {\n    peasants := map[string]*exec.Cmd{}\n    for i := 0; i &lt; NUMBER_OF_PEASANTS; i++ {\n        name := fmt.Sprintf(\"peasant#%d\", i + 1)\n        fmt.Printf(\"[master] Start %s...\\n\", name)\n        cmd := exec.Command(os.Args[0], name)\n        cmd.Stderr = os.Stderr\n        cmd.Stdin = os.Stdin\n        cmd.Stdout = os.Stdout\n        if err := cmd.Start(); err != nil {\n            panic(err)\n        }\n        peasants[name] = cmd\n    }\n    return peasants\n}\n\nfunc masterWaitForSignal(c chan os.Signal) {\n    for true {\n        s := &lt;-c\n        fmt.Printf(\"[master] Got signal %v but still running...\\n\", s)\n    }\n}\n\nfunc peasantWaitForSignal(name string, c chan os.Signal) {\n    s := &lt;-c\n    fmt.Printf(\"[%s] Got signal %v and will exit not with code 66\\n\", name, s)\n    os.Exit(66)\n}\n\nfunc waitForPeasants(peasants map[string]*exec.Cmd) {\n    for name, peasant := range peasants {\n        if err := peasant.Wait(); err != nil {\n            if exitError, ok := err.(*exec.ExitError); ok {\n                waitStatus := exitError.Sys().(syscall.WaitStatus)\n                fmt.Printf(\"[master] %s ended with exit code %d.\\n\", name, waitStatus.ExitStatus())\n            } else {\n                panic(err)\n            }\n        }\n    }\n}\n\nfunc actAsMaster() {\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt)\n\n    peasants := createPeasants()\n\n    fmt.Printf(\"[master] Started.\\n\")\n    go masterWaitForSignal(c)\n    waitForPeasants(peasants)\n    fmt.Printf(\"[master] Done.\\n\")\n}\n\nfunc actAsPeasant(name string) {\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt)\n\n    fmt.Printf(\"[%s] Started.\\n\", name)\n    peasantWaitForSignal(name, c)\n    fmt.Printf(\"[%s] Done.\\n\", name)\n}\n\nfunc main() {\n    if len(os.Args) &gt; 1 {\n        actAsPeasant(os.Args[1])\n    } else {\n        actAsMaster()\n    }\n}\n</code></pre>\n\n<p>When I run the code and hit [Ctrl]+[C] (while it runs) the following output it produced:</p>\n\n<pre><code>$ go run signaldemo.go \n[master] Start peasant#1...\n[master] Start peasant#2...\n[master] Start peasant#3...\n[peasant#1] Started.\n[master] Started.\n[peasant#2] Started.\n[peasant#3] Started.\n^C[peasant#2] Got signal interrupt and will exit not with code 66\n[peasant#1] Got signal interrupt and will exit not with code 66\n[master] Got signal interrupt but still running...\n[master] peasant#1 ended with exit code 66.\n[master] peasant#2 ended with exit code 66.\n[peasant#3] Got signal interrupt and will exit not with code 66\n[master] peasant#3 ended with exit code 66.\n[master] Done.\n</code></pre>\n\n<p>How can I prevent that the children receives the Interrupt signal? But I do not want to rewrite the children. A change in the calling process is required.</p>\n"}, {"tags": ["json", "rest", "go", "swagger"], "answers": [{"tags": [], "owner": {"reputation": 1537, "user_id": 1284054, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/yTh6O.jpg?s=128&g=1", "display_name": "pomkine", "link": "https://stackoverflow.com/users/1284054/pomkine"}, "is_accepted": true, "score": 0, "last_activity_date": 1455636403, "creation_date": 1455636403, "answer_id": 35436450, "question_id": 35432369, "link": "https://stackoverflow.com/questions/35432369/go-swagger-generate-spec-for-route-with-path-parameter/35436450#35436450", "title": "go-swagger generate spec for route with path parameter", "body": "<p>Try to add your endpoint operatin id ('updateBar') as a parameter operation id. Something like:</p>\n\n<pre><code>// swagger:parameters updateBar\ntype BarParam struct {\n\n    // aaaa\n    // in: path\n    bar string\n}\n</code></pre>\n\n<p>And remove 'Parameters' from your endpoint swagger doc</p>\n"}, {"tags": [], "owner": {"reputation": 500, "user_id": 7101880, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209175470396691/picture?type=large", "display_name": "Adrien Parrochia", "link": "https://stackoverflow.com/users/7101880/adrien-parrochia"}, "is_accepted": false, "score": 0, "last_activity_date": 1498035604, "creation_date": 1498035604, "answer_id": 44671438, "question_id": 35432369, "link": "https://stackoverflow.com/questions/35432369/go-swagger-generate-spec-for-route-with-path-parameter/44671438#44671438", "title": "go-swagger generate spec for route with path parameter", "body": "<p>If you want to Switch Bar to lowercase, you have to set :  </p>\n\n<pre><code>// swagger:parameters updateBar\ntype BarParam struct {\n    Bar string `json:\"bar\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 5052008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df9c09f33e324a77ac39589157618b1?s=128&d=identicon&r=PG&f=1", "display_name": "gregs", "link": "https://stackoverflow.com/users/5052008/gregs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1766, "favorite_count": 0, "accepted_answer_id": 35436450, "answer_count": 2, "score": 2, "last_activity_date": 1498035604, "creation_date": 1455624921, "question_id": 35432369, "link": "https://stackoverflow.com/questions/35432369/go-swagger-generate-spec-for-route-with-path-parameter", "title": "go-swagger generate spec for route with path parameter", "body": "<p>I am trying to generate json API documentation compliant with <a href=\"http://swagger.io/specification/\" rel=\"nofollow\">Swagger2.0 specification</a> using <a href=\"https://github.com/go-swagger/go-swagger\" rel=\"nofollow\">go-swagger</a>.</p>\n\n<p>I have a problem generating JSON doc for the route with path param which looks like this:</p>\n\n<blockquote>\n  <p>PUT /foo/{bar}</p>\n</blockquote>\n\n<p>Currently my godoc looks like this:</p>\n\n<pre><code>// Update bar in foo\n// swagger:route PUT /foo/{bar} updateBar\n//     Parameters:\n//       bar: barParam\n//     Responses:\n//       500: myErrorResponse\nfunc (h *handler) update(req *http.Request, params martini.Params) (int, string)\n</code></pre>\n\n<p>Struct wrapping bar parameter:</p>\n\n<pre><code>// swagger:parameters barParam\ntype BarParam struct {\n\n    // aaaa\n    // in: path\n    bar string\n}\n</code></pre>\n\n<p>When I run:</p>\n\n<pre><code>swagger generate spec -o ./swagger.json\n</code></pre>\n\n<p>The generated JSON currently looks like this:</p>\n\n<pre><code>    \"/foo/{bar}\": {\n        \"put\": {\n            \"description\": \"bar: barParam\",\n            \"operationId\": \"updateBar\",\n            \"responses\": {\n                \"500\": {\n                    \"$ref\": \"#/responses/myErrorResponse\"\n                }\n            },\n            \"summary\": \"Parameters:\"\n        }\n    }\n</code></pre>\n\n<p>But I want to generate the following JSON (compliant with Swagger2.0):</p>\n\n<pre><code>    \"/v2/foo/{bar}\": {\n        \"put\": {\n            \"operationId\": \"updateBar\",\n            \"responses\": {\n                \"500\": {\n                    \"$ref\": \"#/responses/myErrorResponse\"\n                }\n            },\n            \"parameters\": [\n                {\n                    \"in\": \"path\",\n                    \"name\": \"bar\",\n                    \"description\": \"aaaa\",\n                    \"required\": true,\n                    \"type\": \"string\"\n                }\n            ]\n        }\n    }\n</code></pre>\n\n<p>How can I modify the doc comments for go-swagger to achieve that? Is there any documentation that describes the exact comments format for go-swagger?</p>\n"}, {"tags": ["multithreading", "go", "thread-safety"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1455623194, "post_id": 35431102, "comment_id": 58561435, "body": "You will corrupt memory. In go 1.6 it will purposely crash the program to prevent unsafe behavior when this is detected. It doesn&#39;t matter that a map specifically isn&#39;t safe to use concurrently, no values are safe to read and write concurrently in go, ever."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1455624125, "post_id": 35431102, "comment_id": 58562106, "body": "There is really no need to know the answers to your specific questions. Your code is broken. Broken, not &quot;broken but broken in this specific way which is okay in this situation&quot;. Just broken."}, {"owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455624606, "post_id": 35431102, "comment_id": 58562448, "body": "@JimB thanks. Needless to say, I know this, otherwise I would not link to the above mentioned sources. I have actually written this repo to handle it: <a href=\"https://github.com/streamrail/concurrent-map\" rel=\"nofollow noreferrer\">github.com/streamrail/concurrent-map</a>  However I was never able to demonstrate this issue, which is why I have asked the above. Any reference to code that will answer my question will be appreciated."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1455627950, "post_id": 35431102, "comment_id": 58564807, "body": "Even if you find the answers to your questions, those answers may be outdated in the next Go release, or on another platform, or when a different compiler is used... which pretty much renders the information useless... Also possible duplicate of <a href=\"http://stackoverflow.com/questions/34732483/what-happens-if-i-concurrently-access-a-single-go-map\">this</a> or <a href=\"http://stackoverflow.com/questions/11063473/map-with-concurrent-access\">this</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455628683, "post_id": 35431102, "comment_id": 58565351, "body": "The only universal answer is that like with any race condition, anything could happen. Especially with a map, once it&#39;s corrupted you can be reading and writing from anywhere in your programs memory. Whenever someone has a &quot;strange runtime bug&quot;, it&#39;s almost always a data race."}], "answers": [{"tags": [], "owner": {"reputation": 616, "user_id": 2744934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72727bdc9c905a07064920beb874cdab?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Spear", "link": "https://stackoverflow.com/users/2744934/mike-spear"}, "is_accepted": true, "score": 5, "last_activity_date": 1455634262, "creation_date": 1455634262, "answer_id": 35435641, "question_id": 35431102, "link": "https://stackoverflow.com/questions/35431102/what-is-the-danger-of-neglecting-goroutine-thread-safety-when-using-a-map-in-go/35435641#35435641", "title": "What is the danger of neglecting goroutine/thread-safety when using a map in Go?", "body": "<p>As the comments have already stated, races are bad.  Go has very weak guarantees, unlike Java, and hence a program that has <strong>any</strong> race is allowed to have undefined behavior <em>even when the race-containing code is not executed</em>.  In C, this is called \"catch-fire semantics\".  The presence of a race means any outcome is possible, to include your computer catching on fire.</p>\n\n<p>However, in Go it is easy to make a map thread-safe.  Consider the following:</p>\n\n<pre><code>// Global variable defining a map\nvar safemap = struct {\n    sync.RWMutex\n    m map[string]string\n}{m: make(map[string]string)}\n</code></pre>\n\n<p>You can do safe reads from the map like this:</p>\n\n<pre><code>// Get a read lock, then read from the map\nsafemap.RLock()\ndefer safemap.RUnlock()\nreturn safemap.m[mykey] == myval\n</code></pre>\n\n<p>And you can do safe modifications like this:</p>\n\n<pre><code>// Delete from the map\nsafemap.Lock()\ndelete(safemap.m, mykey)\nsafemap.Unlock()\n</code></pre>\n\n<p>or this:</p>\n\n<pre><code>// Insert into the map\nsafemap.Lock()\nsafemap.m[mykey] = myval\nsafemap.Unlock()\n</code></pre>\n"}], "owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 785, "favorite_count": 0, "accepted_answer_id": 35435641, "answer_count": 1, "score": -2, "last_activity_date": 1455634262, "creation_date": 1455621424, "last_edit_date": 1455623395, "question_id": 35431102, "link": "https://stackoverflow.com/questions/35431102/what-is-the-danger-of-neglecting-goroutine-thread-safety-when-using-a-map-in-go", "title": "What is the danger of neglecting goroutine/thread-safety when using a map in Go?", "body": "<p>Go's <code>map</code> is said not to be <code>goroutine-safe</code> (see <a href=\"https://golang.org/doc/faq#atomic_maps\" rel=\"nofollow\">here</a> and <a href=\"http://blog.golang.org/go-maps-in-action\" rel=\"nofollow\">here</a>). I'm interested at finding out what could happen in a case where I neglect to protect access to the map using mutex/etc.</p>\n\n<p><strong>Specifically</strong>, can any of the following happen?</p>\n\n<ol>\n<li>Assuming I have a map with keys <code>k1</code>, <code>k2</code>, ..., <code>kn</code>, can a concurrency issue lead to getting <code>map[ki]</code> when I asked for <code>map[kj]</code> (i != j)? </li>\n<li>Can it lead to a <code>panic</code> in the application? </li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1455619176, "post_id": 35429480, "comment_id": 58558791, "body": "Are you sure it actually print this? As pointed out below this is probably a display problem on your side."}], "answers": [{"tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": false, "score": 5, "last_activity_date": 1455632839, "last_edit_date": 1455632839, "creation_date": 1455617894, "answer_id": 35429736, "question_id": 35429480, "link": "https://stackoverflow.com/questions/35429480/what-b5s-mean-when-print-duration-in-golang-using-v/35429736#35429736", "title": "what `B5s` mean when print Duration in golang, using %v", "body": "<p>I think it comes from <code>U+00B5</code>, i.e. <a href=\"http://www.fileformat.info/info/unicode/char/00b5/index.htm\" rel=\"nofollow\">\u00b5 (micro)</a>. It looks like it is trying to <a href=\"https://golang.org/src/time/time.go?s=15077:15110#L490\" rel=\"nofollow\">print microseconds</a>.</p>\n"}], "owner": {"reputation": 41, "user_id": 5934363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc10af18e2069096476980fe34f9e3d2?s=128&d=identicon&r=PG&f=1", "display_name": "Mingqiang Liang", "link": "https://stackoverflow.com/users/5934363/mingqiang-liang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1494311092, "creation_date": 1455617285, "last_edit_date": 1494311092, "question_id": 35429480, "link": "https://stackoverflow.com/questions/35429480/what-b5s-mean-when-print-duration-in-golang-using-v", "title": "what `B5s` mean when print Duration in golang, using %v", "body": "<pre><code>glog.Info(\"%v\", time.Now().Sub(t1))\n</code></pre>\n\n<p>will output:<code>11.302B5s</code></p>\n\n<p>What does <code>B5s</code> mean?</p>\n"}, {"tags": ["reflection", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1455619355, "post_id": 35429132, "comment_id": 58558904, "body": "If you are new to Go you should not use reflection. Nobody should recommend it, especially not to somebody learning the language. I have no idea what your code tries to do."}, {"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1455619718, "post_id": 35429132, "comment_id": 58559169, "body": "I&#39;m trying to call function, of the my custom interface. I calls it successfully. And found out how to pass params, but gets the error <code>reflect: Call using *models.NoaggModel as type models.NoaggModel</code>. I&#39;ll update my questions for details"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1455620530, "post_id": 35429132, "comment_id": 58559670, "body": "<code>Elem()</code> help dereferencing pointers inside reflect.Values and might help."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1455620995, "post_id": 35429132, "comment_id": 58559934, "body": "Don&#39;t get what you&#39;re trying to do either, but I highly doubt reflection is necessary. Interfaces should do the trick."}, {"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 0, "creation_date": 1455621580, "post_id": 35429132, "comment_id": 58560302, "body": "I&#39;m trying to switch between some struct types, and call the methods from the correct interface, according to the incoming string parameter. I have some interfaces for sources of data, and this data has to be filtered and counted in a different ways. So I need to get cache, put it to the struct, and call same methods but from different interfaces. I descided to make a type assertion before calling to cache, so I make a variable of type <code>interface{}</code>, assert type to the one of needed, get cache and try to calling for the methods using reflection. I have names of methods as strings."}], "answers": [{"comments": [{"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 0, "creation_date": 1455631655, "post_id": 35434496, "comment_id": 58567479, "body": "That looks very nice and clear. Speaking about amount of types, there are 2 only now. The amount will be growing during the months of usage. other sources of data would be adopted to the app, and the list of this types would grow. At the same time, I&#39;m sure that the list wouldn&#39;t be more than 30-40 .."}, {"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 0, "creation_date": 1455632086, "post_id": 35434496, "comment_id": 58567810, "body": "Still, if I would rewrite code, to avoid usage of reflect , how can I call methods of interface by string name, that comes as parameter from <code>POST</code>.  Each type (<code>oracleModel</code>, <code>NoaggModel</code>) after filtering data has to be counted in different ways. So I planned to make methods for each interface, and call them by name. If not using reflect, I would need to make slice or map of method names, and call them by name from map ?"}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 1, "creation_date": 1455632851, "post_id": 35434496, "comment_id": 58568304, "body": "@Altenrion You could also use a <code>switch</code> for the <code>methodName</code>: <code>switch methodName { case &quot;filterData&quot;: deserializedData.FilterData(filter) ... }</code> . And if not all models implements all methods? Well, then you can create an interface for each of the methods and try to make a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\"><code>type assertion</code></a> to check if the model type implements a specific method."}, {"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 0, "creation_date": 1455633188, "post_id": 35434496, "comment_id": 58568566, "body": "last time i was talking exactly about source specific methods. For example : OracleModel (countByX, countByY), NoaggMoldel(countByZ, countByS) I want to save centralized manner, to avoid lots of switches, and to have more or less secure code , to avoid runtime errors"}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 1, "creation_date": 1455635933, "post_id": 35434496, "comment_id": 58570514, "body": "@Altenrion Another attempt at trying to understand :)  What about not having different methods <code>OracleModel.Count(a X, b Y)</code> and <code>NoaggModel.Count(a Z, b S)</code>, but instead you could have an interface with the method <code>Count(a interface{}, b interface{}) Result</code>. Each model&#39;s Count method then will handle the assertion of <code>a</code> and <code>b</code> to type <code>X</code>/<code>Y</code> or <code>Z</code>/<code>S</code>?"}, {"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 0, "creation_date": 1455638716, "post_id": 35434496, "comment_id": 58572661, "body": "=)) you disn&#39;t understand the concept. I&#39;ll try again. Noagg provide the data, that has 7 fields. A slice, of rows, that have 7 fields in each. And i can count different stats from this 7 integers. OracleModel provides rows of 5 fields, and i can count other stats, not same as those, that i can count from noagg. So methods are just different, and wirks with different structs. Noagg and Oracle models have a few samr fields like &#39;Date&#39;, but other fields are integers and they are totally different. Hope that makes the situation a little bit clearer))"}, {"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 0, "creation_date": 1455710407, "post_id": 35434496, "comment_id": 58608565, "body": "This way of doing type casting helped a lot, and made code cleaner"}], "tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": true, "score": 2, "last_activity_date": 1455630981, "creation_date": 1455630981, "answer_id": 35434496, "question_id": 35429132, "link": "https://stackoverflow.com/questions/35429132/go-reflect-call-with-too-few-input-arguments/35434496#35434496", "title": "Go: reflect : Call with too few input arguments", "body": "<p>Reflection is not easy. And should be avoided if possible.</p>\n\n<p>I admit that I did recommend using <code>reflect</code> to dynamically create instances of types based on a map, which is really useful when you don't know which types you might have to handle. But in your case you should consider using interfaces.</p>\n\n<p>While I don't really know what you want to achieve, I would suggest starting by creating an interface that all your Models need to implement (modify it to fit your needs):</p>\n\n<pre><code>type Model interface {\n    FilterData(interface{})\n}\n</code></pre>\n\n<p><code>NoaggModel</code> and <code>OracleModel</code> would then implement the above interface by defining similar methods like this:</p>\n\n<pre><code>func (ng *NoaggModel) FilterData(filter interface{}) {\n    fmt.Printf(\"data: %#v, filter: %#v\\n\", ng, filter)\n}\n</code></pre>\n\n<p>Then, change <code>deserializedData</code> (and <code>statData</code>) to be of the interface type <code>Model</code> instead of <code>interface{}</code>. And since you only have two types, you can avoid using reflect by having a switch instead:</p>\n\n<pre><code>...\nvar deserializedData Model\n\nswitch sourceName {\ncase \"noagg\":\n    deserializedData = new(models.NoaggModel)\ncase \"oracle\":\n    deserializedData = new(models.OracleModel)\n}\n...\n// Marshal the values into deserializedData which now holds an instance of the desired type\n...\ndeserializedData.FilterData(\"Replace this string with your filter\")\n</code></pre>\n\n<p>And it is done without having to import <code>reflect</code>!</p>\n"}], "owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1818, "favorite_count": 0, "accepted_answer_id": 35434496, "answer_count": 1, "score": -1, "last_activity_date": 1455630981, "creation_date": 1455616417, "last_edit_date": 1455620149, "question_id": 35429132, "link": "https://stackoverflow.com/questions/35429132/go-reflect-call-with-too-few-input-arguments", "title": "Go: reflect : Call with too few input arguments", "body": "<p>I've stucked with problems of using reflect library. I descided to use it because of many recomendations, but i'm just learning go and some parts are not really easy..</p>\n\n<p>I've got this part of code : </p>\n\n<pre><code> func countDataByName(sourceName string, statData interface{}, filters Filter, chartName string) []ChartElement {\n            ...\n    //step 1 - filter\n    filteredData := reflect.ValueOf(statData).MethodByName(\"FilterData\").Call([]reflect.Value{})\n\n    //step 2 - cluster\n    //  clusterData := reflect.ValueOf(filteredData).MethodByName(\"clusterData\").Call([]reflect.Value{})\n\n    //step 3 - count\n    //  countedData := reflect.ValueOf(clusterData).MethodByName(chartName).Call([]reflect.Value{})\n\n    fmt.Println(\"Never prints to anywhere\", filteredData)\n\n            ...\n     return filterData\n }\n</code></pre>\n\n<p>If I execute the method like this, I get error : <code>reflect: Call with too few input arguments</code>. But if I change <code>reflect.ValueOf(statData)</code> on <code>reflect.ValueOf(&amp;statData)</code> than error is <code>reflect: call of reflect.Value.Call on zero Value</code></p>\n\n<p><code>statData</code> comes with one of 2 types, and fore this types I have structs and methods, like this : </p>\n\n<pre><code>type NoaggModel struct {\n    Date             string\n    Hour             int\n    Id_user          int\n    Id_line          int\n    Id_region        int\n    Id_tree_devision int\n    N_inb            int\n    N_inb_d          int\n    T_ring           int\n    T_inb            int\n    T_inb_d          int\n    T_hold           int\n    T_acw            int\n    T_acw_d          int\n    T_wait           int\n}\n\nfunc (ng *NoaggModel) FilterData( data NoaggModel) {\n    fmt.Println(\"FilterData\")\n    fmt.Println(\"data : \", data)\n}\n</code></pre>\n\n<p>this Println also not works. Code panics above , and method was not triggered. Where is my mistake here? </p>\n\n<p><strong><em>Upd 1:</em></strong></p>\n\n<p>Found that if I remove param <code>data</code> in functioin that I want to call, than it calls nicely. But! \nI have <code>statData</code> as 1 row, of structs, so type is <code>NoaggModel</code>. And in the method <code>FilterData</code> I get this 1 row as <code>ng</code>. But I need to change it to the <code>[]NoaggModel</code>. How to call <code>reflect</code> in this case and how to pass parameter to the filter function ? </p>\n\n<p><strong><em>Upd 2:</em></strong>\nI modified few parts : </p>\n\n<pre><code>func (ng *NoaggModel) FilterData(filter interface{}, data NoaggModel) {\n    fmt.Println(\"data : \",ng)\n}\n</code></pre>\n\n<p>In here, how to pass correct type to <code>filter</code>, if it is set up in revel controller, and method is in model. Or should I set the type in each model and call it in controller? </p>\n\n<p>And in controller I wrote : </p>\n\n<pre><code>//step 1 - filter\n    in := make([]reflect.Value, 2)\n\n    in[0] = reflect.ValueOf(filters)\n    in[1] = reflect.ValueOf(statData)\n\n    filteredData := reflect.ValueOf(statData).MethodByName(\"FilterData\").Call(in)\n</code></pre>\n\n<p><code>StatData</code> is a row of type NoaggModel, but I get the error : </p>\n\n<pre><code> reflect: Call using *models.NoaggModel as type models.NoaggModel \n</code></pre>\n\n<p>The type was set also by <code>reflect</code> in code above, like this : </p>\n\n<pre><code>    ...\n    var sourceTypes = map[string]reflect.Type{\n        \"noagg\": reflect.TypeOf(models.NoaggModel{}),\n        \"oracle\": reflect.TypeOf(models.OracleModel{}),\n    }\n    deserializedData = reflect.New(sourceTypes[sourceName]).Interface()\n    ...\n    // deserialised becomes statData\n</code></pre>\n"}, {"tags": ["go", "architecture", "cross-platform"], "comments": [{"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1455636524, "post_id": 35428963, "comment_id": 58570969, "body": "Out of curiosity, what do you mean by &quot;encapsulate&quot;? Also, what&#39;s wrong with <code>runtime.GOOS</code>, with an if statement?"}, {"owner": {"reputation": 6569, "user_id": 371530, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/UJz1r.jpg?s=128&g=1", "display_name": "Robin", "link": "https://stackoverflow.com/users/371530/robin"}, "reply_to_user": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1455637882, "post_id": 35428963, "comment_id": 58572012, "body": "I used encapsulate, because I wanted to ask for the Go-way to separate platform specific code. Nothing is wrong with runtime.GOOS, if it can handle platform specific code, which probably doesn&#39;t compile on other platforms."}, {"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 1, "creation_date": 1455638858, "post_id": 35428963, "comment_id": 58572766, "body": "Ah, that makes more sense. I&#39;m not sure encapsulate is the correct word, but fair enough. To your second point, I honestly can&#39;t think of an example of valid Go code that will compile on one <i>platform</i> but not on another. (Different compilers are a different problem.) I can think of a few examples that might crash or break, however, but that&#39;s the idea of <code>if runtime.GOOS == &quot;windows&quot; {}</code>."}, {"owner": {"reputation": 6569, "user_id": 371530, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/UJz1r.jpg?s=128&g=1", "display_name": "Robin", "link": "https://stackoverflow.com/users/371530/robin"}, "reply_to_user": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1455638993, "post_id": 35428963, "comment_id": 58572868, "body": "What would be a better word? I&#39;m always up to learn something :-)"}, {"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1455639486, "post_id": 35428963, "comment_id": 58573239, "body": "Well, to me, &quot;encapsulate&quot; has connotations of A) absurd OOP object models and design / API principles (Java#, anyone?) or B) hiding what&#39;s happening through source code obfuscation / more absurd API exposure principles. Better words might be &quot;separate&quot;, or perhaps in this case &quot;conditionally compile&quot;. :)"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 11, "last_activity_date": 1455634108, "last_edit_date": 1455634108, "creation_date": 1455616285, "answer_id": 35429081, "question_id": 35428963, "link": "https://stackoverflow.com/questions/35428963/what-is-the-right-approach-to-encapsulate-platform-specific-code-in-go/35429081#35429081", "title": "What is the right approach to encapsulate platform specific code in Go?", "body": "<p>The solution to platform specific code is the <a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"noreferrer\">build constraints</a>.</p>\n\n<blockquote>\n  <p>A build constraint, also known as a build tag, is a line comment that begins</p>\n\n<pre><code>// +build\n</code></pre>\n  \n  <p>that lists the conditions under which a file should be included in the package. Constraints may appear in any kind of source file (not just Go), but they must appear near the top of the file, preceded only by blank lines and other line comments. These rules mean that in Go files a build constraint must appear before the package clause.</p>\n</blockquote>\n\n<p>So basically each platform specific Go code should go into different files, and you can mark each of these Go files with the target they are intended for.</p>\n\n<p>For example if a file contains Linux specific code (e.g. syscalls), start it with:</p>\n\n<pre><code>// +build linux\n</code></pre>\n\n<p>If a file contains Windows specific syscalls, start it with:</p>\n\n<pre><code>// +build windows\n</code></pre>\n\n<p>A lot more \"options\" are available, read the linked docs. For example you can specify constraints to the OS, Architecture, Go version, the compiler being used. You can also specify multiple constraints that will be interpreted with logical OR or AND, or you can use negation (e.g. this code is for every target platform except linux).</p>\n\n<p>You can even mark a <code>.go</code> file to be ignored with the following constraint:</p>\n\n<pre><code>// +build ignore\n</code></pre>\n\n<p>Note that build constraints are compiler specific. If a specific compiler does not recognize a build constraint, the compiler will ignore the file. As an example the Go AppEngine SDK comes with a built-in, modified Go compiler which additionally recognizes the </p>\n\n<pre><code>// +build appengine\n</code></pre>\n\n<p>constraint, which means the source file is intended for the Google App Engine Platform only. \"Regular\" Go compilers will ignore the file, giving you the possibility to not have a bunch of compiler errors if someone tries to build the code without the Go AppEngine SDK.</p>\n"}, {"tags": [], "owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "is_accepted": false, "score": 4, "last_activity_date": 1455640350, "last_edit_date": 1495539900, "creation_date": 1455640350, "answer_id": 35437929, "question_id": 35428963, "link": "https://stackoverflow.com/questions/35428963/what-is-the-right-approach-to-encapsulate-platform-specific-code-in-go/35437929#35437929", "title": "What is the right approach to encapsulate platform specific code in Go?", "body": "<p>While <a href=\"https://stackoverflow.com/a/35429081/4532996\">@icza's answer</a> is definitely the proper authoritative answer to OP's question about condtional compilation, in this specific case a simpler approach may be worthwhile.</p>\n\n<p>Go is a language designed to compile the same (with the same compiler) on every platform, to encourage cross-platform code and library reuse. Go is not C/C++, for which time must be spent to write explicitly cross-platform code.</p>\n\n<p>Of course, the platform agnosticity only goes as far as Go's runtime, and you're trying to capture keypresses, for which there's no real single platform-agnostic solution.</p>\n\n<p>Thus, my simpler suggestion <em>for this use case</em> resembles the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"runtime\"\n    kp \"kplib\"\n)\n\nfunc main () {\n    switch runtime.GOOS {\n    case \"windows\":\n        kp.WinKey()\n    case \"darwin\":\n        kp.MacKey()\n    case \"linux\":\n        kp.UnixKey()\n    default:\n        kp.TryKey()\n    }\n}\n</code></pre>\n\n<p>With the implicit assurance the hypothetical <code>kplib</code> will compile everywhere (just be sure to call the right methods on the given platform!).</p>\n"}], "owner": {"reputation": 6569, "user_id": 371530, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/UJz1r.jpg?s=128&g=1", "display_name": "Robin", "link": "https://stackoverflow.com/users/371530/robin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3076, "favorite_count": 2, "accepted_answer_id": 35429081, "answer_count": 2, "score": 9, "last_activity_date": 1455640350, "creation_date": 1455615968, "last_edit_date": 1455616367, "question_id": 35428963, "link": "https://stackoverflow.com/questions/35428963/what-is-the-right-approach-to-encapsulate-platform-specific-code-in-go", "title": "What is the right approach to encapsulate platform specific code in Go?", "body": "<p>I want to develop a small Go application, which shows the used key stroke shortcuts to the audience of a presentation.</p>\n\n<p>To hook into the keyboard events I will have to use some platform specific code. <strong>What is the Go way to encapsulate platform specific code?</strong> I've been searching for keywords like compiler switch or platform modules, but I couldn't really find something about.</p>\n"}, {"tags": ["nginx", "go", "websocket", "wildcard", "nginx-location"], "answers": [{"comments": [{"owner": {"reputation": 1989, "user_id": 788273, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/927348f4c16e03d3b290bd9b558c1b0d?s=128&d=identicon&r=PG", "display_name": "Kr0e", "link": "https://stackoverflow.com/users/788273/kr0e"}, "edited": false, "score": 0, "creation_date": 1455616852, "post_id": 35429023, "comment_id": 58557115, "body": "Thanks, I will check it."}], "tags": [], "owner": {"reputation": 3334, "user_id": 4473327, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hP14q.jpg?s=128&g=1", "display_name": "neuhaus", "link": "https://stackoverflow.com/users/4473327/neuhaus"}, "is_accepted": true, "score": 2, "last_activity_date": 1455616138, "creation_date": 1455616138, "answer_id": 35429023, "question_id": 35428731, "link": "https://stackoverflow.com/questions/35428731/nginx-websocket-wildcard-location/35429023#35429023", "title": "Nginx: WebSocket wildcard location", "body": "<p>Check out the article at <a href=\"https://www.digitalocean.com/community/tutorials/understanding-nginx-server-and-location-block-selection-algorithms\" rel=\"nofollow\">https://www.digitalocean.com/community/tutorials/understanding-nginx-server-and-location-block-selection-algorithms</a></p>\n\n<p>You are not using any <code>location_match</code>, so the match is a prefix match.</p>\n\n<p>Use <code>~</code> as the location match modifier to have it interpreted as a regular expression.</p>\n\n<p>The line <code>location /ws</code> should match every query starting with <code>/ws</code>.</p>\n"}], "owner": {"reputation": 1989, "user_id": 788273, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/927348f4c16e03d3b290bd9b558c1b0d?s=128&d=identicon&r=PG", "display_name": "Kr0e", "link": "https://stackoverflow.com/users/788273/kr0e"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 708, "favorite_count": 0, "accepted_answer_id": 35429023, "answer_count": 1, "score": 2, "last_activity_date": 1459830479, "creation_date": 1455615340, "last_edit_date": 1459830479, "question_id": 35428731, "link": "https://stackoverflow.com/questions/35428731/nginx-websocket-wildcard-location", "title": "Nginx: WebSocket wildcard location", "body": "<p>I use a nginx instance in front of a Go service.</p>\n\n<ul>\n<li>I want to redirect anything on port 80 to https. [done]</li>\n<li>All (non-websocket) https requests at /* should go to <a href=\"https://localhost:8443/\" rel=\"nofollow\">https://localhost:8443/</a>* [done]</li>\n<li>All websocket https requests at /ws/* should go to <a href=\"https://localhost:8443/ws/\" rel=\"nofollow\">https://localhost:8443/ws/</a>* [missing]</li>\n</ul>\n\n<p>My current config:</p>\n\n<pre><code>ssl_certificate                 ...\nssl_certificate_key             ...\nssl_ciphers                     ...\nssl_prefer_server_ciphers       on;\n\nserver {\n        listen         80;\n        location / {\n                return 301 https://$host$request_uri;\n        }\n}\n\nserver {\n        listen          443 ssl;\n        server_name     www.mydomain.com mydomain.com;\n\n        add_header Strict-Transport-Security \"max-age=31536000\";\n\n        location /ws {   &lt;--- This only works for /ws but not /ws/app1\n            proxy_pass http://localhost:8443/ws;\n            proxy_http_version 1.1;\n            proxy_set_header Host $http_host;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection \"upgrade\";\n        }\n\n        location / {    &lt;--- Catches anything, even without wildcard ?!\n                proxy_pass http://localhost:8443;\n        }\n}\n\nserver {\n        listen 443 ssl;\n        server_name *.mydomain.com;\n        return 444;\n}\n</code></pre>\n\n<p>Why is this necessary ? Well, as I understand, you have to set the upgrade headers explicitly, so I guess you <em>have</em> to specify another location.</p>\n\n<p>Ideally, I would just use one location, but then websockets are blocked (because upgrade headers never make it to the Go service...)</p>\n\n<p>I'm not a nginx expert, so bear with me =).</p>\n\n<p>[EDIT]</p>\n\n<p>I got it working now. I'm not sure if its ok to always set_header Upgrade/Connection, even if it's not a websocket request, but my Go service doesn't give a ****, so it works for me =]</p>\n\n<pre><code>ssl_certificate                 ...\nssl_certificate_key             ...\nssl_ciphers                     ...\nssl_prefer_server_ciphers       on;\n\nserver {\n        listen         80;\n        location / {\n                return 301 https://$host$request_uri;\n        }\n}\n\nserver {\n        listen          443 ssl;\n        server_name     www.mydomain.com mydomain.com;\n\n        add_header Strict-Transport-Security \"max-age=31536000\";\n\n        location / {    &lt;--- Catches anything, even without wildcard ?!\n            proxy_pass http://localhost:8443;\n            proxy_redirect off;\n            proxy_http_version 1.1;\n            proxy_set_header Host $http_host;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection \"upgrade\";\n        }\n}\n\nserver {\n        listen 443 ssl;\n        server_name *.mydomain.com;\n        return 444;\n}\n</code></pre>\n"}, {"tags": ["go", "google-compute-engine", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 2917, "user_id": 2300755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/412477c4e9148bdff2e30f283d7794b0?s=128&d=identicon&r=PG", "display_name": "Ed Davisson", "link": "https://stackoverflow.com/users/2300755/ed-davisson"}, "edited": false, "score": 0, "creation_date": 1455647417, "post_id": 35427729, "comment_id": 58578503, "body": "As a first step, I&#39;d suggest filing an issue on the gcloud-golang project: <a href=\"https://github.com/GoogleCloudPlatform/gcloud-golang\" rel=\"nofollow noreferrer\">github.com/GoogleCloudPlatform/gcloud-golang</a>."}, {"owner": {"reputation": 11, "user_id": 5507746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e5ecfe042edf4c40475eede37bab39a?s=128&d=identicon&r=PG&f=1", "display_name": "sup3rs3nior", "link": "https://stackoverflow.com/users/5507746/sup3rs3nior"}, "reply_to_user": {"reputation": 2917, "user_id": 2300755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/412477c4e9148bdff2e30f283d7794b0?s=128&d=identicon&r=PG", "display_name": "Ed Davisson", "link": "https://stackoverflow.com/users/2300755/ed-davisson"}, "edited": false, "score": 0, "creation_date": 1455655956, "post_id": 35427729, "comment_id": 58583395, "body": "Thank you for your advice. I&#39;m really nervous to file an issue on a big project like that but I will give it a shot. Hopefully it&#39;s not a silly mistake on my end."}, {"owner": {"reputation": 11, "user_id": 5507746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e5ecfe042edf4c40475eede37bab39a?s=128&d=identicon&r=PG&f=1", "display_name": "sup3rs3nior", "link": "https://stackoverflow.com/users/5507746/sup3rs3nior"}, "reply_to_user": {"reputation": 2917, "user_id": 2300755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/412477c4e9148bdff2e30f283d7794b0?s=128&d=identicon&r=PG", "display_name": "Ed Davisson", "link": "https://stackoverflow.com/users/2300755/ed-davisson"}, "edited": false, "score": 0, "creation_date": 1455656719, "post_id": 35427729, "comment_id": 58583857, "body": "Issue logged: <a href=\"https://github.com/GoogleCloudPlatform/gcloud-golang/issues/212\" rel=\"nofollow noreferrer\">github.com/GoogleCloudPlatform/gcloud-golang/issues/212</a>"}], "owner": {"reputation": 11, "user_id": 5507746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e5ecfe042edf4c40475eede37bab39a?s=128&d=identicon&r=PG&f=1", "display_name": "sup3rs3nior", "link": "https://stackoverflow.com/users/5507746/sup3rs3nior"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 332, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1455612407, "creation_date": 1455612407, "last_edit_date": 1495541254, "question_id": 35427729, "link": "https://stackoverflow.com/questions/35427729/how-do-i-connect-to-google-cloud-datastore-in-golang-from-a-gce-vm", "title": "How do I connect to Google Cloud Datastore in golang from a GCE VM?", "body": "<p>When I try running <a href=\"https://github.com/GoogleCloudPlatform/gcloud-golang/blob/master/datastore/example_test.go\" rel=\"nofollow noreferrer\">these example functions</a> to connect to Cloud Datastore, I get a 401 Invalid Credentials error.</p>\n\n<p>I'm running the go code from a VM within a Google Cloud Project. I have enabled the Datastore API and generated a JSON key which is loaded by the example code.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/27479833/connecting-to-google-cloud-datastore-using-go\">This question</a> is very similar and even mentions the same repo, but does not use the same authentication shown in the examples, and was related to a 403 Unauthorized error.</p>\n\n<p>For some reason the Datastore documentation does not mention go outside the context of App Engine.</p>\n"}, {"tags": ["shell", "go", "minecraft", "gnu-screen"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1455633705, "post_id": 35425461, "comment_id": 58568934, "body": "Supervisor/systemd/monit are all proper tools for supervising services on a server. If you were desperate to write something in Go, <a href=\"https://github.com/kardianos/service\" rel=\"nofollow noreferrer\">github.com/kardianos/service</a> might be a good fit too."}, {"owner": {"reputation": 113, "user_id": 3369284, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GbrvE.jpg?s=128&g=1", "display_name": "Nathan Young", "link": "https://stackoverflow.com/users/3369284/nathan-young"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1455661145, "post_id": 35425461, "comment_id": 58586346, "body": "It&#39;s not so much about keeping the Minecraft server running; that&#39;s actually pretty easy, because as you say there are many tools for just that (monit, cron, supervisor, screen, tmux, nohup, etc). The real trick is being able to access the server console again when desired to enable sending commands directly into it while simultaneously being able to see the console.  I&#39;m sure a solution similar in functionality to tail with repl-like behavior wouldn&#39;t be too different from what I want, but if there&#39;s a less hacky way to do it (such as directly attaching to the screen) then that&#39;s preferable."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1455665346, "post_id": 35425461, "comment_id": 58588157, "body": "That depends. You can send your program signals and have it interact based on those via Supervisor/systemd, etc. Otherwise you need to attach (and later, detach) from the process&#39; stdin &amp; stdout."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1541176938, "post_id": 35425461, "comment_id": 93139837, "body": "Does it really only accept commands via standard input?! That&#39;s bizarre, especially for something that&#39;s meant to be a server."}], "owner": {"reputation": 113, "user_id": 3369284, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GbrvE.jpg?s=128&g=1", "display_name": "Nathan Young", "link": "https://stackoverflow.com/users/3369284/nathan-young"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 160, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1541174450, "creation_date": 1455604769, "last_edit_date": 1541174450, "question_id": 35425461, "link": "https://stackoverflow.com/questions/35425461/having-issues-attaching-to-a-screen-session-with-golang-repository-inside", "title": "Having issues attaching to a screen session with golang - repository inside", "body": "<p>I'm working on MSCT, a little Minecraft server administration utility for personal use (for now). I'm starting the server in a screen session, and it's working just fine. I'm just having no luck getting the screen to start attached or getting MSCT to resume the screen.</p>\n\n<p>Repo is here: <a href=\"https://github.com/nathanpaulyoung/msct/blob/master/msct.go\" rel=\"nofollow\">https://github.com/nathanpaulyoung/msct/blob/master/msct.go</a></p>\n\n<p>The relevant function on line 48 is:  </p>\n\n<pre><code>resumeCommand()\n</code></pre>\n\n<p>And here's a snippet:</p>\n\n<pre><code>func resumeCommand() cli.Command {\n    command := cli.Command{\n        Name:    \"resume\",\n        Aliases: []string{\"r\"},\n        Usage:   \"resume a server's screen session\",\n        Action: func(c *cli.Context) {\n            servername := c.Args().First()\n            screenname := buildScreenName(servername)\n            args := []string{\"-x\", screenname}\n            cmd := exec.Command(\"screen\", args...)\n            if serverExists(servername) {\n                output, _ := cmd.Output()\n                println(output)\n            } else {\n                println(\"No server known by the name \\\"\" + servername + \"\\\". Either server.jar is missing or the server directory was not configured before compilation.\")\n                os.Exit(999)\n            }\n        },\n    }\n    return command\n}\n</code></pre>\n\n<p>I feel like it must be something I am simply unaware of, like some sort of special way to invoke a new tty or something. If any of you know of the solution, please chip in with advice or a pull request.</p>\n\n<p>That said, I've been thinking more about the real goal here, and figured I'd mention that, in case that yields a solution that is equally satisfactory if not what I expected. <em>I want the Minecraft server to continue running even when I'm not actively looking at the server console.</em> Whether that means when I'm not currently ssh'd in to the box it's running on, or (in the case of screen) not actually connected to the screen session, it should keep running without my eyes on it. If there's a way to, perhaps, pipe screen content into a custom golang terminal session using <a href=\"https://golang.org/x/crypto/ssh/terminal\" rel=\"nofollow\">https://golang.org/x/crypto/ssh/terminal</a>, or a way to create something similar to screen wherein the Minecraft server can run, those would be just as satisfactory.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1455593395, "post_id": 35422868, "comment_id": 58546382, "body": "<a href=\"https://godoc.org/?q=maildir\" rel=\"nofollow noreferrer\">godoc.org/?q=maildir</a>"}, {"owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1455593790, "post_id": 35422868, "comment_id": 58546484, "body": "All those libraries deal specifically with the maildir - not with multipart email parsing. Thank you for your help though..."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1455595061, "post_id": 35422868, "comment_id": 58546886, "body": "I haven&#39;t used these libraries myself, but probably net/mail, mime, mime/multipart packages from the standard library provide enough functionality."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 5589648, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kAceB.png?s=128&g=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/5589648/jesse"}, "is_accepted": false, "score": 0, "last_activity_date": 1497183679, "last_edit_date": 1497183679, "creation_date": 1497182519, "answer_id": 44483632, "question_id": 35422868, "link": "https://stackoverflow.com/questions/35422868/golang-parsing-multi-part-emails-from-maildir/44483632#44483632", "title": "Golang: Parsing multi-part emails from maildir", "body": "<p>Here is my example: The part missing is extracting the attachments. Please let me know if you figured that part out... Been scratching my head to extract attachments for weeks now...</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/mail\"\n)\n\nfunc extractEmail(mail *mail.Message){\n    header := mail.Header\n\n    fmt.Println(header.Get(\"Date\"))\n    fmt.Println(header.Get(\"From\"))\n    fmt.Println(header.Get(\"To\"))\n    fmt.Println(header.Get(\"cc\"))\n    fmt.Println(header.Get(\"bcc\"))\n    fmt.Println(header.Get(\"Subject\"))\n\n    body, err := ioutil.ReadAll(mail.Body)\n    if err != nil {\n        checkErr(err, \"Reading Body\")\n    }\n\n    fmt.Println(body)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 189, "user_id": 4087690, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-c6RCzcmF6uI/AAAAAAAAAAI/AAAAAAAAABk/3r-QzG6_5iI/photo.jpg?sz=128", "display_name": "cool_php", "link": "https://stackoverflow.com/users/4087690/cool-php"}, "edited": false, "score": 0, "creation_date": 1615889783, "post_id": 50499133, "comment_id": 117825440, "body": "This library doesn&#39;t work if there is any very large single line in the email body."}, {"owner": {"reputation": 6354, "user_id": 4258430, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7a2d5075177b2ff473c38f6d8fb64894?s=128&d=identicon&r=PG", "display_name": "Allen Luce", "link": "https://stackoverflow.com/users/4258430/allen-luce"}, "reply_to_user": {"reputation": 189, "user_id": 4087690, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-c6RCzcmF6uI/AAAAAAAAAAI/AAAAAAAAABk/3r-QzG6_5iI/photo.jpg?sz=128", "display_name": "cool_php", "link": "https://stackoverflow.com/users/4087690/cool-php"}, "edited": false, "score": 0, "creation_date": 1616017830, "post_id": 50499133, "comment_id": 117875520, "body": "Looks like there&#39;s a workaround at the moment (with the downside that it changes the original content by chopping up the long string with newlines): <a href=\"https://github.com/jhillyerd/enmime/issues/185#issuecomment-801185131\" rel=\"nofollow noreferrer\">github.com/jhillyerd/enmime/issues/185#issuecomment-80118513&zwnj;&#8203;1</a>"}], "tags": [], "owner": {"reputation": 6354, "user_id": 4258430, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7a2d5075177b2ff473c38f6d8fb64894?s=128&d=identicon&r=PG", "display_name": "Allen Luce", "link": "https://stackoverflow.com/users/4258430/allen-luce"}, "is_accepted": false, "score": 4, "last_activity_date": 1527120640, "creation_date": 1527120640, "answer_id": 50499133, "question_id": 35422868, "link": "https://stackoverflow.com/questions/35422868/golang-parsing-multi-part-emails-from-maildir/50499133#50499133", "title": "Golang: Parsing multi-part emails from maildir", "body": "<p>I've had some luck doing this with the <a href=\"https://github.com/jhillyerd/enmime\" rel=\"nofollow noreferrer\">github.com/jhillyerd/enmime</a> package. Given an <code>io.Reader</code> <code>r</code>:</p>\n\n<pre><code>// Parse message body\nenv, _ := enmime.ReadEnvelope(r)\n// Headers can be retrieved via Envelope.GetHeader(name).\nfmt.Printf(\"From: %v\\n\", env.GetHeader(\"From\"))\n// Address-type headers can be parsed into a list of decoded mail.Address structs.\nalist, _ := env.AddressList(\"To\")\nfor _, addr := range alist {\n  fmt.Printf(\"To: %s &lt;%s&gt;\\n\", addr.Name, addr.Address)\n}\nfmt.Printf(\"Subject: %v\\n\", env.GetHeader(\"Subject\"))\n\n// The plain text body is available as mime.Text.\nfmt.Printf(\"Text Body: %v chars\\n\", len(env.Text))\n\n// The HTML body is stored in mime.HTML.\nfmt.Printf(\"HTML Body: %v chars\\n\", len(env.HTML))\n\n// mime.Inlines is a slice of inlined attacments.\nfmt.Printf(\"Inlines: %v\\n\", len(env.Inlines))\n\n// mime.Attachments contains the non-inline attachments.\nfmt.Printf(\"Attachments: %v\\n\", len(env.Attachments))\n</code></pre>\n"}], "owner": {"reputation": 8143, "user_id": 1004369, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b7e385af406a6422cea353066baf068a?s=128&d=identicon&r=PG", "display_name": "r.sendecky", "link": "https://stackoverflow.com/users/1004369/r-sendecky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1610, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1527120640, "creation_date": 1455591514, "last_edit_date": 1455594177, "question_id": 35422868, "link": "https://stackoverflow.com/questions/35422868/golang-parsing-multi-part-emails-from-maildir", "title": "Golang: Parsing multi-part emails from maildir", "body": "<p>I need to parse a multi-part email files read from unix maildir.\nCan you please suggest an appropriate library(s) to do this?</p>\n\n<p>The emails are sucked in via IMAP and dumped to a maildir.\nI need to parse those email files and extract all the parts including header, base64 attachments, html parts and plaintext parts.</p>\n\n<p>Thanks</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I know I can search for the libraries with keywords and stuff but I also would like some opinions on quality and experience if possible.</p>\n\n<p>I can deal with the actual maildir and picking up mail files. My concern is the parsing of the multipart emails (being fed as strings) and extracting individual parts.</p>\n"}, {"tags": ["pointers", "methods", "go", "tree"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 4, "creation_date": 1455581812, "post_id": 35421495, "comment_id": 58543452, "body": "If you want to modify a <code>tree *</code> held by someone else you need to write a function that takes (or receives) a <code>tree **</code>. In order to modify a pointer you need a pointer to it."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 1, "creation_date": 1455581976, "post_id": 35421495, "comment_id": 58543503, "body": "I&#39;d make it return the updated <code>*AvlTree</code>. Alternatively, you could change around your type definitions so what you now call <code>AvlTree</code> is named, say, <code>Node</code> (or <code>node</code> if you don&#39;t want it public) and define <code>type AvlTree *Node</code>, so a method on <code>*AvlTree</code> can change the node pointer. (This would execute just like what @hobbs is talking about, just with different names.) Using a pointer-to-pointer could result in a few more allocations and a little more pointer chasing, but maybe not enough to care about."}, {"owner": {"reputation": 335, "user_id": 1760916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be995d238d1d798b181d0282dc1c1b03?s=128&d=identicon&r=PG", "display_name": "Saigo", "link": "https://stackoverflow.com/users/1760916/saigo"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1455604577, "post_id": 35421495, "comment_id": 58550152, "body": "@hobbs Thanks for the suggestion.  I tried passing a tree** into a function, and it seems to have exactly the same problem. Is there a step I&#39;m missing? <code>func rotateLeftToRoot(ptrToTreePtr **AvlTree) { ... tree := *ptrToTreePtr &#47;*manipulations on tree, tree = prevLeft*&#47; *ptrToTreePtr = tree }</code>  Once the function returns, the tree points to the original node instead of to prevLeft."}, {"owner": {"reputation": 335, "user_id": 1760916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be995d238d1d798b181d0282dc1c1b03?s=128&d=identicon&r=PG", "display_name": "Saigo", "link": "https://stackoverflow.com/users/1760916/saigo"}, "edited": false, "score": 0, "creation_date": 1455678903, "post_id": 35421495, "comment_id": 58592110, "body": "I tried again with updated tests, and the local function rotateLeft(ptree **AvlTree) worked successfully.  Thank you hobbs and twotwotwo for your suggestions."}], "answers": [{"comments": [{"owner": {"reputation": 335, "user_id": 1760916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be995d238d1d798b181d0282dc1c1b03?s=128&d=identicon&r=PG", "display_name": "Saigo", "link": "https://stackoverflow.com/users/1760916/saigo"}, "edited": false, "score": 0, "creation_date": 1455678251, "post_id": 35426997, "comment_id": 58591936, "body": "Thank you icza for the thorough answer.  I had a working version that returns the new pointer, and was looking for a way to update the pointer value from within a function or struct method, as described in your option 1.  I tried this again with rewritten tests and it works as intended.  Most of the information is already understood or contained in other people&#39;s comments, but this is a very well-formed post that may be useful to other people as well."}, {"owner": {"reputation": 335, "user_id": 1760916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be995d238d1d798b181d0282dc1c1b03?s=128&d=identicon&r=PG", "display_name": "Saigo", "link": "https://stackoverflow.com/users/1760916/saigo"}, "edited": false, "score": 0, "creation_date": 1455678384, "post_id": 35426997, "comment_id": 58591975, "body": "Is there a Golang preference between keeping a struct method that returns a new value, and having a local function that updates the struct pointer value?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 335, "user_id": 1760916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be995d238d1d798b181d0282dc1c1b03?s=128&d=identicon&r=PG", "display_name": "Saigo", "link": "https://stackoverflow.com/users/1760916/saigo"}, "edited": false, "score": 0, "creation_date": 1455696197, "post_id": 35426997, "comment_id": 58598774, "body": "@Saigo Whichever suits you. Passing a <code>**AvlTree</code> is safer as the caller don&#39;t have to remember to assign the return value, but the other solution is easier to understand, and it can be a method (not just a function). I would go with the <code>**AvlTree</code> for safety, but that&#39;s just my personal preference."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1475439825, "last_edit_date": 1475439825, "creation_date": 1455610069, "answer_id": 35426997, "question_id": 35421495, "link": "https://stackoverflow.com/questions/35421495/can-the-pointer-in-a-struct-pointer-method-be-reassigned-to-another-instance/35426997#35426997", "title": "Can the pointer in a struct pointer method be reassigned to another instance?", "body": "<p>Pointers are values just like let's say <code>int</code> numbers. The difference is the interpretation of that value: pointers are interpreted as memory addresses, and <code>int</code>s are interpreted as integer numbers.</p>\n\n<p>When you want to change the value of a variable of type <code>int</code>, you pass a pointer to that <code>int</code> which is of type <code>*int</code>, and you modify the pointed object: <code>*i = newvalue</code> (the value assigned is an <code>int</code>).</p>\n\n<p>Same goes with pointers: when you want to change the value of a variable of pointer type <code>*int</code>, you pass a pointer to that <code>*int</code> which is of type <code>**int</code> and you modify the pointed object: <code>*i = &amp;newvalue</code> (the value assigned is an <code>*int</code>).</p>\n\n<p><sup>Passing a pointer is required because a copy is made from everything you pass, and you could only modify the copy. When you pass a pointer, the same thing happens: a copy is also made of that pointer, but we're not modifying the pointer itself but the <em>pointed</em> value.</sup></p>\n\n<p>You want to modify a variable of type <code>*AvlTree</code>. In Go the receiver cannot be a pointer to pointer. <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"noreferrer\">Spec: Method declarations:</a></p>\n\n<blockquote>\n  <p>The receiver's type must be of the form <code>T</code> or <code>*T</code>(possibly using parentheses) where <code>T</code> is a type name.  The type denoted by <code>T</code> is called the receiver <em>base type</em>; <strong>it must not be a pointer</strong> or interface type and it must be declared in the same package as the method.</p>\n</blockquote>\n\n<p>So you have 2 choices:</p>\n\n<ol>\n<li><p>either write a simple function (not method) that takes a <code>**AvlTree</code> and you can pass the address of your tree pointer, so the function can modify the tree pointer (the pointed object)</p></li>\n<li><p>or return the tree pointer from your function/method and have the caller assign it to the variable being the tree pointer.</p></li>\n</ol>\n\n<p>Addressing your concerns regarding returning the tree pointer: there's nothing wrong with that. Take a look at the builtin function <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"noreferrer\"><code>append()</code></a>: it appends elements to a slice <em>and</em> returns the modified slice. You (the caller) have to assign the returned slice to your slice variable, because <code>append()</code> may modify the slice by allocating a new one if the additional elements do not fit into the original (and since <code>append()</code> takes a non-pointer, the modified value must be returned).</p>\n\n<p>Here's how the solution going with #1 would look like:</p>\n\n<pre><code>func rotateLeftToRoot(ptree **AvlTree) {\n    tree := *ptree\n    if tree == nil {\n        return\n    }\n    prevLeft := tree.left\n    if prevLeft != nil {\n        tree.left = prevLeft.right\n        prevLeft.right = tree\n        tree = prevLeft\n    }\n    *ptree = tree\n}\n</code></pre>\n\n<p>I've implemented it on the <a href=\"http://play.golang.org/p/uOS1s4xF65\" rel=\"noreferrer\">Go Playground</a> to prove it works.</p>\n\n<p>I've used this type:</p>\n\n<pre><code>type AvlTree struct {\n    value string\n    left  *AvlTree\n    right *AvlTree\n}\n</code></pre>\n\n<p>And to easily check the result, I've implemented some methods to produce a <code>string</code> representation:</p>\n\n<pre><code>func (tree *AvlTree) String() string { return tree.str(1) }\n\nfunc (tree *AvlTree) str(n int) string {\n    if tree == nil {\n        return \"&lt;nil&gt;\"\n    }\n    return fmt.Sprintf(\"%q\\n%s%v,%v\\n%s\", tree.value, strings.Repeat(\"\\t\", n),\n        tree.left.str(n+1), tree.right.str(n+1), strings.Repeat(\"\\t\", n-1))\n}\n</code></pre>\n\n<p>And this is how a tree is constructed and transformed:</p>\n\n<pre><code>tree := &amp;AvlTree{\n    value: \"t\",\n    left: &amp;AvlTree{\n        value: \"L\",\n        left: &amp;AvlTree{\n            value: \"LL\",\n        },\n        right: &amp;AvlTree{\n            value: \"LR\",\n        },\n    },\n    right: &amp;AvlTree{\n        value: \"R\",\n    },\n}\nfmt.Println(tree)\nrotateLeftToRoot(&amp;tree)\nfmt.Println(tree)\n</code></pre>\n\n<p>The original tree (without transformation):</p>\n\n<pre><code>\"t\"\n    \"L\"\n        \"LL\"\n            &lt;nil&gt;,&lt;nil&gt;\n        ,\"LR\"\n            &lt;nil&gt;,&lt;nil&gt;\n\n    ,\"R\"\n        &lt;nil&gt;,&lt;nil&gt;\n</code></pre>\n\n<p>And the transformed tree (exactly what you wanted):</p>\n\n<pre><code>\"L\"\n    \"LL\"\n        &lt;nil&gt;,&lt;nil&gt;\n    ,\"t\"\n        \"LR\"\n            &lt;nil&gt;,&lt;nil&gt;\n        ,\"R\"\n            &lt;nil&gt;,&lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 335, "user_id": 1760916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be995d238d1d798b181d0282dc1c1b03?s=128&d=identicon&r=PG", "display_name": "Saigo", "link": "https://stackoverflow.com/users/1760916/saigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5528, "favorite_count": 1, "accepted_answer_id": 35426997, "answer_count": 1, "score": 5, "last_activity_date": 1560166274, "creation_date": 1455581607, "last_edit_date": 1560166274, "question_id": 35421495, "link": "https://stackoverflow.com/questions/35421495/can-the-pointer-in-a-struct-pointer-method-be-reassigned-to-another-instance", "title": "Can the pointer in a struct pointer method be reassigned to another instance?", "body": "<p>I've been looking into Golang and have been implementing a few data structures to learn how the language works.  I've come across the following issue while writing the code for an AVL tree:</p>\n\n<p>Assigning the primary pointer from a struct pointer method seems to have no effect outside the scope of the function.  E.g. <code>tree.rotateLeftToRoot()</code> doesn't result in <code>tree.left</code> becoming the new tree.</p>\n\n<p><strong>Question:</strong> Is there a way to reassign the pointer in a struct pointer method in Golang, or is this generally discouraged?  In the example this would be the <code>\"tree = prevLeft\"</code> line.</p>\n\n<p>Code snippet:</p>\n\n<pre><code>//Graphical representation of t.rotateLeftToRoot():\n//      t                  L\n//   L     R     -&gt;    LL     t\n//LL LR                     LR  R\nfunc (tree *AvlTree) rotateLeftToRoot() {\n   if tree == nil {\n      return\n   }\n   prevLeft := tree.left\n   if prevLeft != nil {\n      tree.left = prevLeft.right //tree.left passed root its right branch\n      prevLeft.right = tree      //tree becomes tree.left's right branch\n      tree.updateHeight()\n      prevLeft.updateHeight()\n      tree = prevLeft            //desired behaviour: tree.left becomes the new tree\n                                 //actual behaviour: no effect when function returns\n   }\n}\n</code></pre>\n\n<p>I've tried other combinations of setting the value or address of tree, and none of them had the intended effect. For example, <code>*tree = *prevLeft</code> results in an infinite loop.</p>\n\n<p>Additional note: Returning <code>tree</code> and setting <code>\"tree = tree.rotateLeftToRoot()\"</code> avoids the issue.  This works, but it seems dirty to be mixing effects and requiring assignment to returned values, when the caller really just wants to be able to call a function to update the tree.</p>\n\n<p>Can the <code>tree</code> be set to <code>prevLeft</code> from within the function?</p>\n"}, {"tags": ["json", "go", "config"], "comments": [{"owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 0, "creation_date": 1455571352, "post_id": 35419263, "comment_id": 58539212, "body": "Where is your config.json located?"}, {"owner": {"reputation": 2648, "user_id": 1673772, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pyqck.jpg?s=128&g=1", "display_name": "Armand Grillet", "link": "https://stackoverflow.com/users/1673772/armand-grillet"}, "reply_to_user": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 0, "creation_date": 1455571454, "post_id": 35419263, "comment_id": 58539283, "body": "@fl0cke Everything is in the same directory, I&#39;ve added the information to the post."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1455571944, "post_id": 35419263, "comment_id": 58539518, "body": "Always make a way to find config files via a full path. A path relative to your source files has no meaning when deployed to another system."}], "answers": [{"tags": [], "owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "is_accepted": false, "score": 4, "last_activity_date": 1455571918, "creation_date": 1455571918, "answer_id": 35419465, "question_id": 35419263, "link": "https://stackoverflow.com/questions/35419263/using-a-configuration-file-with-a-compiled-go-program/35419465#35419465", "title": "Using a configuration file with a compiled Go program", "body": "<p>Depending on whether you use <code>go install &lt;your_package&gt;</code> or <code>go build &lt;your_package&gt;</code>, your final executable will end up in different location.</p>\n\n<p>If you are using <code>go build &lt;your_package&gt;</code>, your executable will be located in the folder where you invoked the command. IOW, it will likely work if your run <code>go build &lt;your_package&gt;</code> in the folder that contains your <code>main.go</code> and <code>config.json</code>.</p>\n\n<p>If you use <code>go install &lt;your_package&gt;</code>, your executable will be located in your <code>$GOPATH/bin</code>. In that case, you will have to update the argument to your <code>ioutil.ReadFile()</code> function call accordingly.</p>\n\n<p>The better approach is to pass the file location of your <code>config.json</code> as an argument to your executable, instead of hard-coding it.</p>\n"}, {"comments": [{"owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1455576707, "post_id": 35419545, "comment_id": 58541729, "body": "@Volker Good suggestion. Added a second paragraph to my answer."}, {"owner": {"reputation": 521, "user_id": 2881510, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-wFrbXPC097c/AAAAAAAAAAI/AAAAAAAAABI/gD38fJX7sUA/photo.jpg?sz=128", "display_name": "Philippe CARLE", "link": "https://stackoverflow.com/users/2881510/philippe-carle"}, "edited": false, "score": 0, "creation_date": 1469019102, "post_id": 35419545, "comment_id": 64365700, "body": "imho I would say that using homedir hidden file like ~/.myappconfig and prompt user for information to put in it when not present could be a good practice too, depending on usage context. Achievable with <a href=\"https://github.com/mitchellh/go-homedir\" rel=\"nofollow noreferrer\">github.com/mitchellh/go-homedir</a>"}], "tags": [], "owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "is_accepted": true, "score": 8, "last_activity_date": 1455576657, "last_edit_date": 1455576657, "creation_date": 1455572218, "answer_id": 35419545, "question_id": 35419263, "link": "https://stackoverflow.com/questions/35419263/using-a-configuration-file-with-a-compiled-go-program/35419545#35419545", "title": "Using a configuration file with a compiled Go program", "body": "<p>Your config file is probably not in the working directory you have started your application in.\nBut hardcoding the path to the file is not the best of practices. </p>\n\n<h2>Approach #1: Command-line argument</h2>\n\n<p>Use the <a href=\"https://golang.org/pkg/flag/\" rel=\"nofollow\"><code>flag</code></a> package to pass the path to your config file as a command-line flag:</p>\n\n<pre><code>var filename = flag.String(\"config\", \"config.json\", \"Location of the config file.\")\n\nfunc main() {\n        flag.Parse()\n        data, err := ioutil.ReadFile(*filename)\n        check(err)\n\n        var config config\n        err = json.Unmarshal(data, &amp;config)\n        check(err)\n}\n</code></pre>\n\n<p>Start the application with <code>./application -config=/path/to/config.json</code> (depends on your platform). </p>\n\n<hr>\n\n<h2>Approach #2: Environment variable</h2>\n\n<p>Use the <a href=\"https://golang.org/pkg/os/\" rel=\"nofollow\"><code>os</code></a> package to read the path from your system environment.</p>\n\n<pre><code>func main() {\n        filename := os.Getenv(\"PATH_TO_CONFIG\")\n        if filename == \"\" {\n          filename = \"config.json\"\n        }\n\n        data, err := ioutil.ReadFile(filename)\n        check(err)\n\n        var config config\n        err = json.Unmarshal(data, &amp;config)\n        check(err)\n}\n</code></pre>\n\n<p>Set the environment variable <code>export PATH_TO_CONFIG=/path/to/config.json</code> (depends on your platform) and start the application. </p>\n\n<p>Both approaches will attempt to find <code>config.json</code> in the working directory if no path was provided to the application.</p>\n"}], "owner": {"reputation": 2648, "user_id": 1673772, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pyqck.jpg?s=128&g=1", "display_name": "Armand Grillet", "link": "https://stackoverflow.com/users/1673772/armand-grillet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5797, "favorite_count": 1, "accepted_answer_id": 35419545, "answer_count": 2, "score": 3, "last_activity_date": 1455576657, "creation_date": 1455571046, "last_edit_date": 1455571430, "question_id": 35419263, "link": "https://stackoverflow.com/questions/35419263/using-a-configuration-file-with-a-compiled-go-program", "title": "Using a configuration file with a compiled Go program", "body": "<p>I have a Go application using a <code>config.json</code> file to get some information. When doing a <code>go run main.go</code> it works but when I'm compiling the application into an executable I have the error <code>open config.json: no such file or directory</code>.</p>\n\n<p>My code is:</p>\n\n<pre><code>func main() {\n        data, err := ioutil.ReadFile(\"./config.json\")\n        check(err)\n\n        var config config\n        err = json.Unmarshal(data, &amp;config)\n        check(err)\n}\n</code></pre>\n\n<p>I also have tried <code>ioutil.ReadFile(\"config.json\")</code> and it does not work. <code>check(err)</code> and the <code>config</code> structure are in the <code>main.go</code>, the problem does not come from here. </p>\n\n<p><code>main.go</code>, <code>config.json</code> and the executable are in the same directory.</p>\n\n<p>What should I do to be able to use the <code>config.json</code> file once the program is compiled?</p>\n"}, {"tags": ["go", "code-structure"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1455568197, "post_id": 35418451, "comment_id": 58537636, "body": "Are you certain these are the saved versions of the source files? That error suggests that the <code>quickfind.go</code> file says <code>package quickfind</code> (actually, it looks like you pasted the same file twice. What is quickfind.go?)"}, {"owner": {"reputation": 5713, "user_id": 846163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/623857ee8390f91edba65fcac0d152ab?s=128&d=identicon&r=PG", "display_name": "sschmeck", "link": "https://stackoverflow.com/users/846163/sschmeck"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455568471, "post_id": 35418451, "comment_id": 58537774, "body": "@JimB Thanks, I copied the first file two times. Now it should be correct."}, {"owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 5, "creation_date": 1455568991, "post_id": 35418451, "comment_id": 58538030, "body": "You can&#39;t have two packages in the same folder. Please read <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455569298, "post_id": 35418451, "comment_id": 58538191, "body": "also <a href=\"http://stackoverflow.com/questions/9985559/organizing-a-multiple-file-go-project\" title=\"organizing a multiple file go project\">stackoverflow.com/questions/9985559/&hellip;</a> if it helps"}, {"owner": {"reputation": 5713, "user_id": 846163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/623857ee8390f91edba65fcac0d152ab?s=128&d=identicon&r=PG", "display_name": "sschmeck", "link": "https://stackoverflow.com/users/846163/sschmeck"}, "reply_to_user": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 0, "creation_date": 1455569708, "post_id": 35418451, "comment_id": 58538387, "body": "@fl0cke Ok. How can I reorganize my code? Just moving the files into subfolders results in other errors."}, {"owner": {"reputation": 5713, "user_id": 846163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/623857ee8390f91edba65fcac0d152ab?s=128&d=identicon&r=PG", "display_name": "sschmeck", "link": "https://stackoverflow.com/users/846163/sschmeck"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455569954, "post_id": 35418451, "comment_id": 58538504, "body": "@JimB My problem is that I want to separate the <code>struct</code> from the functions but have no idea how the Go way is to achieve this. After the quick find I plan to create a <i>quick union</i> and a <i>weighted quick union</i> algorithm all using the same <code>struct</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1455570422, "post_id": 35418451, "comment_id": 58538729, "body": "@sschmeck: the full answer your question is to read the documentation at <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>, linked here and in both duplicate answers. The direct answer to your error is the same as those others, you can&#39;t have multiple package declarations in a single directory. The other issue you have is that you can&#39;t define methods on a type from another package . The method set is part of the type, and types are defined within a &quot;package&quot;. (you also have a relative import which should never be used)"}, {"owner": {"reputation": 5713, "user_id": 846163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/623857ee8390f91edba65fcac0d152ab?s=128&d=identicon&r=PG", "display_name": "sschmeck", "link": "https://stackoverflow.com/users/846163/sschmeck"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455570692, "post_id": 35418451, "comment_id": 58538859, "body": "@JimB This means that it&#39;s impossible to share a <code>struct</code> over several <i>union find</i> implementations or methods. But how do you share structures in Go?"}, {"owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 2, "creation_date": 1455571186, "post_id": 35418451, "comment_id": 58539127, "body": "@sschmeck I would suggest starting with a simpler program &amp; reading some tutorials. The comment section of a closed question is not the best place for this kind of advice. Here is list of go books <a href=\"https://github.com/dariubs/GoBooks\" rel=\"nofollow noreferrer\">github.com/dariubs/GoBooks</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1455571737, "post_id": 35418451, "comment_id": 58539429, "body": "@sschmeck: I don&#39;t understand the question (since you already know you can export types). By share, do you mean modify? Go is a statically typed language, you can&#39;t directly extend an imported type. You can implement interfaces locally in your package, for example, see the <a href=\"https://golang.org/pkg/sort/\" rel=\"nofollow noreferrer\">sort package</a>, or how the crypto hash functions all return a <a href=\"https://golang.org/pkg/hash/#Hash\" rel=\"nofollow noreferrer\"><code>hash.Hash</code></a> interface.  (You might want to visit a forum better suited for a conversation, like the mailing list.)"}, {"owner": {"reputation": 5713, "user_id": 846163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/623857ee8390f91edba65fcac0d152ab?s=128&d=identicon&r=PG", "display_name": "sschmeck", "link": "https://stackoverflow.com/users/846163/sschmeck"}, "reply_to_user": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 0, "creation_date": 1455571868, "post_id": 35418451, "comment_id": 58539485, "body": "@fl0cke I read the free Introduction book and parts of the Phrasebook. But I&#39;ve no idea how to structure code. The hello example using a stringutil library seems so heavy weight to me. Is this the Go way of separating code?"}], "answers": [{"comments": [{"owner": {"reputation": 5713, "user_id": 846163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/623857ee8390f91edba65fcac0d152ab?s=128&d=identicon&r=PG", "display_name": "sschmeck", "link": "https://stackoverflow.com/users/846163/sschmeck"}, "edited": false, "score": 1, "creation_date": 1455575140, "post_id": 35419794, "comment_id": 58541029, "body": "How do you know that I&#39;m reading Sedgewick ;-) Thanks for the link. BTW: I assumed that the algorithm is less important than the fact that I want a structure to use in different ways."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1455574845, "last_edit_date": 1455574845, "creation_date": 1455573163, "answer_id": 35419794, "question_id": 35418451, "link": "https://stackoverflow.com/questions/35418451/how-to-organize-go-code-in-packages/35419794#35419794", "title": "How to organize Go code in packages", "body": "<p>The first thing to do is to explain your problem clearly. For example,</p>\n\n<p>I want to implement several alternative union-find algorithms in Go. For example, quick-fund, quick-union, weighted QU, path compression, and weighted + path. See <a href=\"https://www.cs.princeton.edu/~rs/AlgsDS07/01UnionFind.pdf\" rel=\"nofollow noreferrer\">Union-Find Algorithms, Princeton University</a> and <a href=\"https://rads.stackoverflow.com/amzn/click/com/0201361205\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">Chapter one of Algorithms in Java by Sedgwick</a>.</p>\n\n<hr>\n\n<p>An analog might be the Go <code>crypto</code> package which implements many alternative cryptographic hash functions.</p>\n"}, {"tags": [], "owner": {"reputation": 5713, "user_id": 846163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/623857ee8390f91edba65fcac0d152ab?s=128&d=identicon&r=PG", "display_name": "sschmeck", "link": "https://stackoverflow.com/users/846163/sschmeck"}, "is_accepted": false, "score": 0, "last_activity_date": 1455574910, "creation_date": 1455574910, "answer_id": 35420187, "question_id": 35418451, "link": "https://stackoverflow.com/questions/35418451/how-to-organize-go-code-in-packages/35420187#35420187", "title": "How to organize Go code in packages", "body": "<p>I adapted my code to get a working solution.</p>\n\n<ul>\n<li>provide a library/package <code>unionfind</code> for the common type <code>Unionfind</code></li>\n<li>put the <em>quick find</em> algorithm into its own package 'quickfind' with its own folder</li>\n<li>import the <code>unionfind</code> the default way using the <code>GOPATH</code></li>\n<li>replace the methods by functions</li>\n</ul>\n\n<p>The first file is <code>algorithms/unionfind/unionfindtype.go</code>.</p>\n\n<pre><code>package unionfind\n\ntype Unionfind struct {\n    Elements []int\n}\n\nfunc MakeUnionfind(n int) Unionfind {\n    elements := make([]int, n)\n    for idx := range elements {\n        elements[idx] = idx\n    }\n    return Unionfind{elements}\n}\n</code></pre>\n\n<p>The second file is <code>algorithms/unionfind/quickfind/quickfind.go</code>.</p>\n\n<pre><code>package quickfind\n\nimport ufp \"algorithms/unionfind\"\n\nfunc union(uf *ufp.Unionfind, a int, b int) {\n    aroot := uf.Elements[a]\n    broot := uf.Elements[b]\n    for k, v := range uf.Elements {\n        if v == aroot {\n            uf.Elements[k] = broot\n        }\n    }\n}\n\nfunc connected(uf *ufp.Unionfind, a int, b int) bool {\n    return uf.Elements[a] == uf.Elements[b]\n}\n</code></pre>\n\n<p>Thanks to JimB and fl0cke for the suggestions.</p>\n"}, {"comments": [{"owner": {"reputation": 5713, "user_id": 846163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/623857ee8390f91edba65fcac0d152ab?s=128&d=identicon&r=PG", "display_name": "sschmeck", "link": "https://stackoverflow.com/users/846163/sschmeck"}, "edited": false, "score": 0, "creation_date": 1456916386, "post_id": 35421835, "comment_id": 59163835, "body": "I implemented your approach. You can use the <code>Unionfind struct</code> as <i>embedded type</i> if necessary. The main benefit for a single package was that you can share functions without exporting them."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 1, "last_activity_date": 1455592709, "last_edit_date": 1455592709, "creation_date": 1455584175, "answer_id": 35421835, "question_id": 35418451, "link": "https://stackoverflow.com/questions/35418451/how-to-organize-go-code-in-packages/35421835#35421835", "title": "How to organize Go code in packages", "body": "<p>You won't be able to use the same struct for all union find implementations. For example <em>weighted quick union</em> requires array of tree sizes in addition to the elements.</p>\n\n<p>What you are trying to achieve here is to have the same operations implemented differently. This is what interfaces are for in Go.</p>\n\n<p>Additionally using aliases for package imports to save a few key strokes is not a good practice. Instead it is better to come up with good names such as package name together with its interace/struct/function names makes sense.</p>\n\n<p>I would organize all algorithms in one package with the following structure:</p>\n\n<pre><code>package algorithms\n\ntype UnionFind interface {\n    Union(a int, b int)\n    Connected(a int, b int) bool\n}\n\nfunc QuickFind(n int) UnionFind {\n    return &amp;quickFind{......}\n}\n\nfunc QuickUnion(n int) UnionFind {\n    return &amp;quickUnion{......}\n}\n\ntype quickUnion struct {\n    ....\n}\n\nfunc (qu *quickUnion) Union(a int, b int) {\n    ...\n}\n\nfunc (qu *quickUnion) Connected(a int, b int) bool {\n    ...\n}\n\ntype quickFind struct {\n    ....\n}\n\nfunc (qf *quickFind) Union(a int, b int) {\n    ...\n}\n\nfunc (qf *quickFind) Connected(a int, b int) bool {\n    ...\n}\n</code></pre>\n"}], "owner": {"reputation": 5713, "user_id": 846163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/623857ee8390f91edba65fcac0d152ab?s=128&d=identicon&r=PG", "display_name": "sschmeck", "link": "https://stackoverflow.com/users/846163/sschmeck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 1, "accepted_answer_id": 35421835, "answer_count": 3, "score": 1, "last_activity_date": 1455592709, "creation_date": 1455568058, "last_edit_date": 1455571547, "question_id": 35418451, "link": "https://stackoverflow.com/questions/35418451/how-to-organize-go-code-in-packages", "title": "How to organize Go code in packages", "body": "<p>I'm trying to implement the union find algorithm using Go. I want to implement different strategies like <em>quick find</em>, <em>quick union</em> and <em>weighted quick union</em> using one structure <code>UnionFind</code> see below. I put the code into a package <code>unionfind</code></p>\n\n<pre><code>package unionfind\n\ntype Unionfind struct {\n    elements []int\n}\n\nfunc makeUnionfind(n int) Unionfind {\n    elements := make([]int, n)\n    for idx := range elements {\n        elements[idx] = idx\n    }\n    return Unionfind{elements}\n}\n</code></pre>\n\n<p>Next I create the functions for the different strategies starting with <code>quick find</code>. The example below isn't working. But I have no idea where to put the strategy specific code, how to name the package and how to import the common structure type.</p>\n\n<pre><code>// create a separate package for each strategy?\npackage quickfind\n\n// import the structure locally?\nimport ufp \"./unionfind\"\n\n// prefer methods over functions for convenience?\nfunc (uf *ufp.Unionfind) union(a int, b int) {\n    aroot := uf.elements[a]\n    broot := uf.elements[b]\n    for k, v := range uf.elements {\n        if v == aroot {\n            uf.elements[k] = broot\n        }\n    }\n}\n\nfunc (uf *ufp.Unionfind) connected(a int, b int) bool {\n    return uf.elements[a] == uf.elements[b]\n}\n</code></pre>\n\n<p>How should I organize my code the get the <em>quick find</em> algorithm working but have the <code>UnionFind</code>structure separated?</p>\n"}, {"tags": ["go", "google-signin", "jwt-go"], "comments": [{"owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 0, "creation_date": 1455568579, "post_id": 35416762, "comment_id": 58537819, "body": "Why are you not using OAuth2? Like in <a href=\"https://github.com/googleplus/gplus-quickstart-go\" rel=\"nofollow noreferrer\">this example</a> ?"}, {"owner": {"reputation": 233, "user_id": 3902647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7268e6ad34b4bfa1c7144c27082c4ca5?s=128&d=identicon&r=PG", "display_name": "kendo5731", "link": "https://stackoverflow.com/users/3902647/kendo5731"}, "reply_to_user": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 0, "creation_date": 1455571763, "post_id": 35416762, "comment_id": 58539444, "body": "Hey :) from what I see, this example you mentioned doesn&#39;t seem to cover the implicit flow in which you need to validate the signature of the token on the server side. Please correct me if I&#39;m wrong, but the library only seems to support the authorization code grant type."}, {"owner": {"reputation": 651, "user_id": 621973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88f4ee43bc2722fdd9240db6da9c0b39?s=128&d=identicon&r=PG", "display_name": "foo", "link": "https://stackoverflow.com/users/621973/foo"}, "edited": false, "score": 0, "creation_date": 1455764713, "post_id": 35416762, "comment_id": 58639213, "body": "I have not sorted how the n and e are encoded, but the DecodeString of n is returning an err: &quot;Error illegal base64 data at input byte 340&quot;.  Having a dickens of a time finding a description of the n and e fields from the document.  I think you are very close if we crack how those ints are encoded."}], "answers": [{"tags": [], "owner": {"reputation": 233, "user_id": 3902647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7268e6ad34b4bfa1c7144c27082c4ca5?s=128&d=identicon&r=PG", "display_name": "kendo5731", "link": "https://stackoverflow.com/users/3902647/kendo5731"}, "is_accepted": true, "score": 0, "last_activity_date": 1456423087, "creation_date": 1456423087, "answer_id": 35634790, "question_id": 35416762, "link": "https://stackoverflow.com/questions/35416762/google-signin-validation-error-using-jwt-go/35634790#35634790", "title": "Google SignIn validation error using jwt-go", "body": "<p>I finally made it work, more details here : <a href=\"https://github.com/dgrijalva/jwt-go/issues/116#issuecomment-188903951\" rel=\"nofollow\">https://github.com/dgrijalva/jwt-go/issues/116#issuecomment-188903951</a></p>\n"}], "owner": {"reputation": 233, "user_id": 3902647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7268e6ad34b4bfa1c7144c27082c4ca5?s=128&d=identicon&r=PG", "display_name": "kendo5731", "link": "https://stackoverflow.com/users/3902647/kendo5731"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 35634790, "answer_count": 1, "score": 0, "last_activity_date": 1588098999, "creation_date": 1455561778, "last_edit_date": 1588098999, "question_id": 35416762, "link": "https://stackoverflow.com/questions/35416762/google-signin-validation-error-using-jwt-go", "title": "Google SignIn validation error using jwt-go", "body": "<p>I'm currently trying to integrate my app with Google SignIn. I want my Golang backend to be able to decode and validate OIDC tokens. I'm trying to use the <a href=\"https://github.com/dgrijalva/jwt-go/\" rel=\"nofollow noreferrer\">JWT-GO library</a>, but I'm stuck with the validation of the signature of the JWT.</p>\n\n<p>I found <a href=\"https://stackoverflow.com/questions/26159658/golang-token-validation-error/26287613#26287613\">this post</a> and it helped me well, still I can't figure out why I'm getting an <code>crypto/rsa: verification error</code>.</p>\n\n<p>I pushed an example code in this <a href=\"https://github.com/aubm/golang-google-sign-in\" rel=\"nofollow noreferrer\">Github repository</a>. Would be great if someone could help with that.</p>\n\n<p>Thanks in advance :)</p>\n"}, {"tags": ["go", "websocket", "handshake", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 2154, "user_id": 827559, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a52398a850ef25b0465dc0d6e0e2db38?s=128&d=identicon&r=PG", "display_name": "Artur Sapek", "link": "https://stackoverflow.com/users/827559/artur-sapek"}, "edited": false, "score": 0, "creation_date": 1508249810, "post_id": 35419891, "comment_id": 80531178, "body": "I know this answer is old, but this seems wrong: &quot;use <code>select {}</code> instead of <code>for {}</code>. The former blocks forever. The latter spins forever.&quot; The OP is not reading from chans. That&#39;s what select is for. <code>conn.ReadMessage()</code> is already blocking."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 2154, "user_id": 827559, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/a52398a850ef25b0465dc0d6e0e2db38?s=128&d=identicon&r=PG", "display_name": "Artur Sapek", "link": "https://stackoverflow.com/users/827559/artur-sapek"}, "edited": false, "score": 2, "creation_date": 1508251986, "post_id": 35419891, "comment_id": 80532787, "body": "@ArturSapek The comment is in reference to the use of <code>for {}</code> at the end of OP&#39;s code.  The <code>for {}</code> construct burns CPU time.  The <code>select {}</code> will simply block.  The call to <code>conn.ReadMessage()</code> does not block the main goroutine."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1508347722, "last_edit_date": 1508347722, "creation_date": 1455573574, "answer_id": 35419891, "question_id": 35415833, "link": "https://stackoverflow.com/questions/35415833/websocket-closing-handshake-gorilla/35419891#35419891", "title": "WebSocket - Closing Handshake Gorilla", "body": "<p>The server responds to a close frame with the <a href=\"https://github.com/gorilla/websocket/blob/b824a5d8536651ad2d690c17e270d58855dbfd02/conn.go#L729\" rel=\"nofollow noreferrer\">code</a>:</p>\n\n<pre><code>    c.WriteControl(CloseMessage, []byte{}, time.Now().Add(writeWait))\n</code></pre>\n\n<p>This is translated to close code 1005 (no status received) by the client.</p>\n\n<p>The 1000 oops close frame written by the server is not seen by the client application because the websocket connection stops reading from network after receiving the first close frame. </p>\n\n<p>The client application should exit the loop when an error is returned from ReadMessage. There's no need to check for specific close codes.</p>\n\n<pre><code>for {\n    // Read Messages\n    _, _, err := conn.ReadMessage()\n    if err != nil {\n        break\n    }\n}\n</code></pre>\n\n<p>Unrelated to the issue in the question, the server application should <a href=\"https://godoc.org/github.com/gorilla/websocket#Conn.Close\" rel=\"nofollow noreferrer\">close</a> the websocket connection after sending the close frame.</p>\n\n<p>Also unrelated to the issue in the question, use <code>select {}</code> instead of <code>for {}</code> to block the main goroutine. The former simply blocks the goroutine.  The latter spins using CPU time.</p>\n"}], "owner": {"reputation": 253, "user_id": 5719160, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/abd92cbc314012f263ee283c0fe8f323?s=128&d=identicon&r=PG&f=1", "display_name": "Kim Byer", "link": "https://stackoverflow.com/users/5719160/kim-byer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10023, "favorite_count": 1, "accepted_answer_id": 35419891, "answer_count": 1, "score": 2, "last_activity_date": 1508347722, "creation_date": 1455558552, "last_edit_date": 1458254841, "question_id": 35415833, "link": "https://stackoverflow.com/questions/35415833/websocket-closing-handshake-gorilla", "title": "WebSocket - Closing Handshake Gorilla", "body": "<p>Snippet from WebSocket RFC:</p>\n\n<blockquote>\n  <p>To <em>Start the WebSocket Closing Handshake</em> with a status code (Section 7.4) /code/ and an optional close reason (Section 7.1.6) /reason/, an endpoint MUST send a Close control frame, as described in Section 5.5.1, whose status code is set to /code/ and whose close reason is set to /reason/.  Once an endpoint has both sent and received a Close control frame, that endpoint SHOULD <em>Close the WebSocket Connection</em> as defined in Section 7.1.1.</p>\n</blockquote>\n\n<p>I am trying to do the Close Handshake using <a href=\"https://github.com/gorilla/websocket\" rel=\"nofollow\">Gorilla WebSocket</a> package with the following code:</p>\n\n<p>Server:</p>\n\n<pre><code>// Create upgrader function\nconn, err := upgrader.Upgrade(w, r, nil)\n\n// If there is an error stop everything.\nif err != nil {\n    fmt.Println(err)\n    return\n}\n\nfor {\n    // Read Messages\n    _, _, err := conn.ReadMessage()\n    // Client is programmed to send a close frame immediately...\n    // When reading close frame resend close frame with same\n    // reason and code\n    conn.WriteMessage(websocket.CloseMessage, websocket.FormatCloseMessage(1000, \"woops\"))\n    fmt.Println(err)\n    break\n}\n</code></pre>\n\n<p>Client:</p>\n\n<pre><code>d := &amp;websocket.Dialer{}\n\nconn, _, err := d.Dial(\"ws://localhost:8080\", nil)\n\nif err != nil {\n    fmt.Println(err)\n    return\n}\n\ngo func() {\n    for {\n        // Read Messages\n        _, _, err := conn.ReadMessage()\n\n        if c, k := err.(*websocket.CloseError); k {\n            if(c.Code == 1000) {\n                // Never entering since c.Code == 1005\n                fmt.Println(err)\n                break\n            }\n        }\n    }\n}()\n\nconn.WriteMessage(websocket.CloseMessage, websocket.FormatCloseMessage(1000, \"woops\"))\n\nfor {}\n</code></pre>\n\n<p>The server is reading the Close Frame as expected outputting the following:</p>\n\n<blockquote>\n  <p>websocket: close 1000 (normal): woops</p>\n</blockquote>\n\n<p>However the client is like its stopping to read once it sends a close message. The <code>ReadMessage</code> continue to return error 1005. What am I doing wrong?</p>\n"}, {"tags": ["mongodb", "go", "mongodb-query", "aggregation-framework", "mgo"], "comments": [{"owner": {"reputation": 1220, "user_id": 3636525, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TX9HF.png?s=128&g=1", "display_name": "dgiugg", "link": "https://stackoverflow.com/users/3636525/dgiugg"}, "edited": false, "score": 0, "creation_date": 1455558753, "post_id": 35415604, "comment_id": 58532626, "body": "Why don&#39;t you have an <code>_id</code> in the output? <code>dayofyear</code> and <code>actualyear</code> should be in the <code>_id</code>."}, {"owner": {"reputation": 41, "user_id": 4322480, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eeb6c3b0c3b472884d38a07157c3fb35?s=128&d=identicon&r=PG&f=1", "display_name": "mommabear", "link": "https://stackoverflow.com/users/4322480/mommabear"}, "reply_to_user": {"reputation": 1220, "user_id": 3636525, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TX9HF.png?s=128&g=1", "display_name": "dgiugg", "link": "https://stackoverflow.com/users/3636525/dgiugg"}, "edited": false, "score": 0, "creation_date": 1455559147, "post_id": 35415604, "comment_id": 58532861, "body": "I&#39;ve added how the output is generated. Should I do this differently?"}], "answers": [{"comments": [{"owner": {"reputation": 1284, "user_id": 1065251, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bVhOf.gif?s=128&g=1", "display_name": "arnoudhgz", "link": "https://stackoverflow.com/users/1065251/arnoudhgz"}, "edited": false, "score": 0, "creation_date": 1479805664, "post_id": 35863810, "comment_id": 68701277, "body": "I get <code>cannot use bson.M literal (type bson.M) as type bson.D in array or slice literal</code> (similar case)"}, {"owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "reply_to_user": {"reputation": 1284, "user_id": 1065251, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bVhOf.gif?s=128&g=1", "display_name": "arnoudhgz", "link": "https://stackoverflow.com/users/1065251/arnoudhgz"}, "edited": false, "score": 0, "creation_date": 1479806927, "post_id": 35863810, "comment_id": 68702114, "body": "@arnoudhgz Change the <code>bson.D</code> to <code>bson.M</code> which should compile."}], "tags": [], "owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "is_accepted": false, "score": 4, "last_activity_date": 1479806845, "last_edit_date": 1479806845, "creation_date": 1457429973, "answer_id": 35863810, "question_id": 35415604, "link": "https://stackoverflow.com/questions/35415604/golang-mgo-returning-value-with-aggregate-group/35863810#35863810", "title": "Golang mgo returning value with aggregate $group", "body": "<p>Running the following pipeline in mongo shell should give you the correct result:</p>\n\n<pre><code>pipeline = [\n    {\n        \"$match\": { \"transactiontype\": transactiontype }\n    },\n    { \n        \"$group\": {\n            \"_id\": {\n                \"year\": { \"$year\": \"$transactiondate\" },\n                \"dayOfYear\": { \"$dayOfYear\": \"$transactiondate\" }               \n            },\n            \"totalamount\": { \"$sum\": \"$qty\" }, \n            \"count\": { \"$sum\": 1 },\n            \"date\": { \"$first\": \"$transactiondate\"}\n        }\n    },\n    {\n        \"$project\": {\n            \"_id\": 0,\n            \"totalamount\": 1,\n            \"dayOfYear\": \"$_id.dayOfYear\",\n            \"actualyear\": { \"$substr\": [ \"$_id.year\", 0, 4 ] },\n            \"transactiondate\": { \n                \"$dateToString\": { \"format\": \"%Y-%m-%d %H:%M\", \"date\": \"$date\" } \n            },\n            \"count\": 1\n        }\n    }\n]\ndb.collection.aggregate(pipeline)\n</code></pre>\n\n<p>of which the equivalent mGo expression follows (untested):</p>\n\n<pre><code>pipeline := []bson.M{   \n    bson.M{\n        \"$match\": bson.M{ \"transactiontype\": transactiontype }\n    },\n    bson.M{\n        \"$group\": bson.M{\n            \"_id\": bson.M{\n                \"year\": bson.M{ \"$year\": \"$transactiondate\" },\n                \"dayOfYear\": bson.M{ \"$dayOfYear\": \"$transactiondate\" }             \n            },\n            \"totalamount\": bson.M{ \"$sum\": \"$qty\" }, \n            \"count\": bson.M{ \"$sum\": 1 },\n            \"date\": bson.M{ \"$first\": \"$transactiondate\"}\n        }\n    },\n    bson.M{\n        \"$project\": bson.M{\n            \"_id\": 0,\n            \"totalamount\": 1,\n            \"dayOfYear\": \"$_id.dayOfYear\",\n            \"actualyear\": bson.M{ \"$substr\": []interface{}{ \"$_id.year\", 0, 4 } },\n            \"transactiondate\": bson.M{ \n                \"$dateToString\": bson.M{ \"format\": \"%Y-%m-%d %H:%M\", \"date\": \"$date\" } \n            },\n            \"count\": 1\n        }\n    }   \n}\n\npipe := collection.Pipe(pipeline)\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 4322480, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eeb6c3b0c3b472884d38a07157c3fb35?s=128&d=identicon&r=PG&f=1", "display_name": "mommabear", "link": "https://stackoverflow.com/users/4322480/mommabear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7417, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1479806873, "creation_date": 1455557794, "last_edit_date": 1479806873, "question_id": 35415604, "link": "https://stackoverflow.com/questions/35415604/golang-mgo-returning-value-with-aggregate-group", "title": "Golang mgo returning value with aggregate $group", "body": "<p>How do I get an aggregate query to return field values used in the $group statement.</p>\n\n<p>The code:</p>\n\n<pre><code>type TheGroup struct{\n    Id bson.ObjectId `json:\"id,omitempty\" bson:\"_id,omitempty\"` \n    Totalamount int\n    Dayofyear int\n    Actualyear string\n    Transactiondate string\n    Count int\n}\n\nvar results []TheGroup\n\no1 := bson.M{\"$match\" :bson.M{\"transactiontype\": transactiontype},}\no2 := bson.M{\"$group\" : bson.M{\"_id\": bson.M{\"day\": \"$dayofyear\", \"year\":\"$actualyear\"},\"totalamount\":bson.M{\"$sum\":\"$qty\"}, \"count\":bson.M{\"$sum\":1}},}\noperations := []bson.M{o1, o2}\npipe := collection.Pipe(operations)\nerr1 := pipe.All(&amp;results)\n\nif err := json.NewEncoder(w).Encode(results); err != nil {\npanic(err)\n}\n</code></pre>\n\n<p>The output is as follows:</p>\n\n<pre><code>[{\"Totalamount\":2061,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":679},{\"Totalamount\":8705,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":2145},{\"Totalamount\":8156,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":2806},{\"Totalamount\":9865,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":3294},{\"Totalamount\":9619,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":3102},{\"Totalamount\":9975,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":3457},{\"Totalamount\":14839,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":4036},{\"Totalamount\":5100,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":1699},{\"Totalamount\":9649,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":2854},{\"Totalamount\":11457,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":3220},{\"Totalamount\":12643,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":3860},{\"Totalamount\":10301,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":3620},{\"Totalamount\":7681,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":2816},{\"Totalamount\":8130,\"Dayofyear\":0,\"Actualyear\":\"\",\"Transactiondate\":\"\",\"Count\":3023}]\n</code></pre>\n\n<p>I think I understand why Dayofyear / Actualyear are not populated - because as there is no aggregration of the document values as the matched documents are traversed by the $group - but how do I get them to populate? </p>\n"}, {"tags": ["reflection", "go", "orm", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 651, "user_id": 621973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88f4ee43bc2722fdd9240db6da9c0b39?s=128&d=identicon&r=PG", "display_name": "foo", "link": "https://stackoverflow.com/users/621973/foo"}, "is_accepted": true, "score": 2, "last_activity_date": 1455610979, "last_edit_date": 1495539193, "creation_date": 1455610277, "answer_id": 35427059, "question_id": 35414556, "link": "https://stackoverflow.com/questions/35414556/go-reflect-with-gorm-library/35427059#35427059", "title": "Go reflect with gorm library", "body": "<p>The db.First method returns db reference and hydrates the row into the passed structure.</p>\n\n<p>The closest to your desired method is</p>\n\n<pre><code>func GetFirstItem(item interface{}) error {\n    return db.First(item).Error\n}\n</code></pre>\n\n<p>This simply requires you keep a reference to the parameter</p>\n\n<pre><code>var firstHotel &amp;Hotel{}\nerr := GetFirstItem(firstHotel)\n</code></pre>\n\n<p>Returning the hydrated object for all types would required type parameters (generics).  I think you'll find the current situation is workable within limits.</p>\n\n<p>see also: <a href=\"https://stackoverflow.com/questions/3912089/why-no-generics-in-go\">Why no generics in Go?</a></p>\n"}], "owner": {"reputation": 2762, "user_id": 357937, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cec99ad76b136c8e5c8002370499365e?s=128&d=identicon&r=PG", "display_name": "Ondra", "link": "https://stackoverflow.com/users/357937/ondra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 968, "favorite_count": 0, "accepted_answer_id": 35427059, "answer_count": 1, "score": 0, "last_activity_date": 1455610979, "creation_date": 1455554424, "question_id": 35414556, "link": "https://stackoverflow.com/questions/35414556/go-reflect-with-gorm-library", "title": "Go reflect with gorm library", "body": "<p>I am using gorm package (<a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow\">https://github.com/jinzhu/gorm</a>) as my database library in golang. I have many classes (database tables) like \"Hotel\" or \"Package\". Duplicating code is not good programming practice. As a silly example - lets assume I want to get first object from each table. I can write this method (<code>GetFirstHotel</code>, <code>GetFirstPackage</code>...) for each object. But better way would be to have just a single method <code>GetFirstItem</code>, where I would use first param to create object with same class as parameter, then pass it to gorm, which will fill it with data from database, then return it as <code>interface{}</code>. I tried to use reflect for that, but failed, because I probably don't understand it much.</p>\n\n<p>Maybe I just didn't discover some function in gorm library, or I can't use reflect package properly. How should I implement <code>GetFirstItem</code> function. Is it possible to have this implemented, or should I rather repeat my code?</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/jinzhu/gorm\"\n)\n\nvar db gorm.DB\n\ntype Hotel struct {\n    ID   int64\n    Name string\n    Lat  float64\n    Lon  float64\n}\n\ntype Package struct {\n    ID   int64\n    Name string\n    Text string\n}\n\nfunc GetFirstHotel() (hotel Hotel) {\n    db.First(&amp;hotel)\n}\n\nfunc GetFirstPackage() (pack Package) {\n    db.First(&amp;pack)\n}\n\nfunc main() {\n    var firstHotel, firstPackage interface{}\n\n    //first method\n    firstHotel = GetFirstHotel()\n    firstPackage = GetFirstPackage()\n\n    //method i want to use\n    firstHotel = GetFirstItem(Hotel{})\n    firstPackage = GetFirstItem(Package{})\n}\n\nfunc GetFirstItem(item interface{}) interface{} {\n    //how to implement this?\n    //probably with some use of reflect package\n}\n</code></pre>\n"}, {"tags": ["go", "error-handling", "exception-handling"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1455550580, "post_id": 35412449, "comment_id": 58527289, "body": "I have both upvoted your question and voted for it to be closed: while sensible and interesting, it breaks one of the SO&#39;s guidelines--that questions should not provoke answers which will be primarily opinion-based. I&#39;d recommend you to ask questions of this style on the <a href=\"https://groups.google.com/forum/#!forum/golang-nuts/\" rel=\"nofollow noreferrer\">Go mailing list</a> instead."}, {"owner": {"reputation": 46273, "user_id": 574479, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/79f682361ccbe900f8846a1098d13921?s=128&d=identicon&r=PG", "display_name": "biziclop", "link": "https://stackoverflow.com/users/574479/biziclop"}, "edited": false, "score": 2, "creation_date": 1455550663, "post_id": 35412449, "comment_id": 58527354, "body": "Though if we replace &quot;Why did Go add...&quot; with &quot;What is the use of...&quot;, it becomes an objectively answerable question."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1455552771, "post_id": 35412449, "comment_id": 58528802, "body": "@zlatanski, what you ignore is: 1) SO is not the sole medium in the world to get knowledge on programming topics. It was designed with a set of goals clearly stated in its FAQ. The fact you have decided you do not like these goals is your problem, not that of SO; 2) That&#39;s you who decided to break the rules. Finger-pointing at me is hence surprising: suppose you moved from US to England but decided to still drive on the right part of the road; will you blame the cop which will stop you?"}], "answers": [{"comments": [{"owner": {"reputation": 715, "user_id": 3076234, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2ea4ede4673ba2e3e7d9b34de3ebd063?s=128&d=identicon&r=PG&f=1", "display_name": "zlatanski", "link": "https://stackoverflow.com/users/3076234/zlatanski"}, "edited": false, "score": 0, "creation_date": 1455551354, "post_id": 35413011, "comment_id": 58527805, "body": "Thanks for answer. I did read FAQ and blog. They conflict. FAQ say &quot;truly exceptional conditions&quot;. Blog say &quot;malformed JSON is encountered... unwind stack&quot; so basically uses it for control flow on bad JSON (which does not strike me as &quot;truly exceptional condition&quot; like some unexpected OS error, just user input error)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 715, "user_id": 3076234, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2ea4ede4673ba2e3e7d9b34de3ebd063?s=128&d=identicon&r=PG&f=1", "display_name": "zlatanski", "link": "https://stackoverflow.com/users/3076234/zlatanski"}, "edited": false, "score": 2, "creation_date": 1455551681, "post_id": 35413011, "comment_id": 58528006, "body": "@zlatanski, no, using <code>panic</code> for the case you&#39;re referring to is clearly <i>abusing</i> the feature. But the thing is, abusing it that way makes code more readable/understandable and maintainable than checking flags etc. It&#39;s better to give up some purity and win in maintainability than the other way around ;-)"}, {"owner": {"reputation": 715, "user_id": 3076234, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2ea4ede4673ba2e3e7d9b34de3ebd063?s=128&d=identicon&r=PG&f=1", "display_name": "zlatanski", "link": "https://stackoverflow.com/users/3076234/zlatanski"}, "edited": false, "score": 3, "creation_date": 1455551890, "post_id": 35413011, "comment_id": 58528158, "body": "Thanks for digging up the history too, very insightful"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 13, "last_activity_date": 1455552172, "last_edit_date": 1455552172, "creation_date": 1455549763, "answer_id": 35413011, "question_id": 35412449, "link": "https://stackoverflow.com/questions/35412449/why-did-go-add-panic-and-recover-in-addition-to-error-handling/35413011#35413011", "title": "Why did Go add panic and recover in addition to error handling?", "body": "<p><strong>Some history:</strong></p>\n\n<p>In the early days of Go (before version 1.0) there was no <code>recover()</code>. A call to <code>panic()</code> would terminate an application without any way to stop that.</p>\n\n<p>I've found the original discussion that led to adding <code>recover()</code>, you can read it on the golang-nuts discussion forum:</p>\n\n<p><a href=\"https://groups.google.com/forum/#!topic/golang-nuts/HOXNBQu5c-Q%5B1-25%5D\" rel=\"noreferrer\"><strong>Proposal for an exception-like mechanism</strong></a></p>\n\n<p>Beware: the discussion dates back to March, 25, 2010, and it is quite exhausting and long (150 posts through 6 pages).</p>\n\n<p>Eventually it was added on <a href=\"https://go.googlesource.com/go/+/weekly.2010-03-30/doc/devel/release.html\" rel=\"noreferrer\">2010-03-30</a>:</p>\n\n<blockquote>\n  <p>This release contains three language changes:   </p>\n  \n  <ol start=\"3\">\n  <li>The functions <code>panic</code> and <code>recover</code>, intended for reporting and recovering from\n  failure, have been added to the spec:<br>\n  <a href=\"http://golang.org/doc/go_spec.html#Handling_panics\" rel=\"noreferrer\">http://golang.org/doc/go_spec.html#Handling_panics</a><br>\n  In a related change, <code>panicln</code> is gone, and <code>panic</code> is now a single-argument\n  function.  Panic and recover are recognized by the gc compilers but the new\n  behavior is not yet implemented.</li>\n  </ol>\n</blockquote>\n\n<hr>\n\n<p>Multi-return values and conventions provide a cleaner way to handle errors in Go.</p>\n\n<p>That does not mean however that in some (rare) cases the panic-recover is not useful.</p>\n\n<p>Quoting from the official <a href=\"https://golang.org/doc/faq#exceptions\" rel=\"noreferrer\">FAQ: Why does Go not have exceptions?</a></p>\n\n<blockquote>\n  <p>Go also has a couple of built-in functions to signal and recover from truly exceptional conditions. The recovery mechanism is executed only as part of a function's state being torn down after an error, which is sufficient to handle catastrophe but requires no extra control structures and, when used well, can result in clean error-handling code.</p>\n</blockquote>\n\n<p>Here is a \"real-life\" example for when/how it can be useful: quoting from blog post <a href=\"http://blog.golang.org/defer-panic-and-recover\" rel=\"noreferrer\">Defer, Panic and Recover</a>:</p>\n\n<blockquote>\n  <p>For a real-world example of <strong>panic</strong> and <strong>recover</strong>, see the <a href=\"http://golang.org/pkg/encoding/json/\" rel=\"noreferrer\">json package</a> from the Go standard library. It decodes JSON-encoded data with a set of recursive functions. When malformed JSON is encountered, the parser calls panic to unwind the stack to the top-level function call, which recovers from the panic and returns an appropriate error value (see the 'error' and 'unmarshal' methods of the decodeState type in <a href=\"http://golang.org/src/pkg/encoding/json/decode.go\" rel=\"noreferrer\">decode.go</a>).</p>\n</blockquote>\n\n<p>Another example is when you write code (e.g. package) which calls a user-supplied function. You can't trust the provided function that it won't panic. One way is not to deal with it (let the panic wind up), or you may choose to \"protect\" your code by recovering from those panics. A good example of this is the <a href=\"https://golang.org/pkg/net/http/\" rel=\"noreferrer\">http server</a> provided in the standard library: you are the one providing functions that the server will call (the <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"noreferrer\">handlers</a> or <a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"noreferrer\">handler functions</a>), and if your handlers panic, the server will recover from those panics and not let your complete application die.</p>\n\n<p>How you should use them:</p>\n\n<blockquote>\n  <p>The convention in the Go libraries is that even when a package uses panic internally, its external API still presents explicit error return values.</p>\n</blockquote>\n\n<p>Related and useful readings:</p>\n\n<p><a href=\"http://blog.golang.org/defer-panic-and-recover\" rel=\"noreferrer\">http://blog.golang.org/defer-panic-and-recover</a></p>\n\n<p><a href=\"http://dave.cheney.net/2012/01/18/why-go-gets-exceptions-right\" rel=\"noreferrer\">http://dave.cheney.net/2012/01/18/why-go-gets-exceptions-right</a></p>\n\n<p><a href=\"https://golang.org/doc/faq#exceptions\" rel=\"noreferrer\">https://golang.org/doc/faq#exceptions</a></p>\n\n<p><a href=\"http://evanfarrer.blogspot.co.uk/2012/05/go-programming-language-has-exceptions.html\" rel=\"noreferrer\">http://evanfarrer.blogspot.co.uk/2012/05/go-programming-language-has-exceptions.html</a></p>\n"}, {"comments": [{"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 5, "creation_date": 1455551643, "post_id": 35413233, "comment_id": 58527981, "body": "<code>Hence Go clearly separates exceptional cases from plain normal errors</code>, except there is no clear distinction between them and it entirely depends on the context for almost all cases. Hence why many languages chose exceptions as universal error handling mechanism without making artificial separation. Like it or not, it works and has it&#39;s own very big advantage - clear separation of error handling and actual business logic. Something that Go cannot do by definition - all Go code is a mess of if&#39;s and some logic inbetween. It works in simple cases but gets unreadable very quickly."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1455551924, "post_id": 35413233, "comment_id": 58528181, "body": "@creker, basically that&#39;s why I voted to close the answer: people <i>do</i> have different opinions regarding these matters. I know I had my own &quot;wow!&quot; reaction when reading my first book on C++ but 15 years in the industry which followed changed my mind. I don&#39;t think I could sum my concerns up better than the author of 0MQ whose post I linked to so I invite you to read it. But sure your approaches and priorities and taste could certainly differ from mine. That&#39;s why we all love different languages after all ;-)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1455552179, "post_id": 35413233, "comment_id": 58528395, "body": "@creker, I know my response is a bit glib but the format of the medium we use (SO comments) is unfit for detailed discussions with examples and cases. So if you feel like it, I think we could have a constructive discussion on the mailing list I suggested the OP to use."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1455552368, "post_id": 35413233, "comment_id": 58528516, "body": "the sad thing is that both ways (C#/Java and Go. C++ exceptions are bad without exceptions) are good in different cases.. We need something different. Maybe Rust could be a solution."}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "reply_to_user": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1532006894, "post_id": 35413233, "comment_id": 89818808, "body": "@creker Note that Java use exceptions universally, but it still has a hierarchy <a href=\"https://www.javamex.com/tutorials/exceptions/exceptions_hierarchy.shtml\" rel=\"nofollow noreferrer\">javamex.com/tutorials/exceptions/exceptions_hierarchy.shtml</a> This allows to separates exceptional cases (RuntimeException) from plain normal errors."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1455551183, "last_edit_date": 1495540863, "creation_date": 1455550443, "answer_id": 35413233, "question_id": 35412449, "link": "https://stackoverflow.com/questions/35412449/why-did-go-add-panic-and-recover-in-addition-to-error-handling/35413233#35413233", "title": "Why did Go add panic and recover in addition to error handling?", "body": "<p>I think that your question is the result of a mental model you maintain which is instilled by popular mainstream languages such as Java, C++, C#, PHP and zillions of other which simply <em>got exceptions wrong.</em></p>\n\n<p>The thing is, exceptions per se are not a wrong concept but abusing them to handle cases which are, in reality, not exceptional is.  My personal pet peeve is the filesystem handling API of Java (and .NET, which copied that of Java almost verbatim): why on Earth failure to open a file results in an exception if that file does not exist?  The filesystem is an inherently racy medium, and is specified to be racy, so the only correct way to ensure a file exists before opening it for reading is to just open it and then check for \"file does not exist\" error: the case of the file not existing is not exceptional at all.</p>\n\n<p>Hence Go clearly separates exceptional cases from plain <em>normal</em> errors.\nThe motto of the stance Go maintains on handling errors is \"Errors are values\" and thus normal expected errors are handled as values, and <code>panic()</code> serves to handle exceptional cases. A good simple example:</p>\n\n<ul>\n<li><p>An attempt to dereference a <code>nil</code> pointer results in a <code>panic</code>.</p>\n\n<p>The rationale: your code went on and tried to dereference a pointer which does not point to any value.  The immediately following code clearly expects that value to be available&mdash;as the result of the dereferencing operation.  Hence the control flow clearly can't proceed normally in any sensible way, and that's why this is an exceptional situation: in a correct program, dereferencing of <code>nil</code> pointers cannot occur.</p></li>\n<li><p>The remote end of a TCP stream abruptly closed its side of the stream and the next attempt to read from it resulted in an error.</p>\n\n<p>That's pretty normal situation: one cannot sensbily expect a TCP session to be rock-solid: network outages, packet drops, unexpected power blackouts do occur, and we have to be prepared for unexpected stream closures by our remote peers.</p></li>\n</ul>\n\n<p>A minor twist to <code>panic()</code> is that Go does not force you to blindly follow certain dogmas, and you can freely \"abuse\" panic/recover in tightly-controlled specific cases such as breaking out from a deeply-nested processing loop by <code>panic</code>king with an error value of a specific type known <em>and checked for</em> at the site performing <code>recover</code>.</p>\n\n<p>Further reading:</p>\n\n<ul>\n<li><a href=\"http://250bpm.com/blog:4\" rel=\"nofollow noreferrer\">\"Why should I have written ZeroMQ in C, not C++\"</a>.</li>\n<li><a href=\"https://blog.golang.org/errors-are-values\" rel=\"nofollow noreferrer\">\"Errors are values\"</a>.</li>\n<li><a href=\"https://stackoverflow.com/a/22865084/720999\">\"Is function parameter validation using errors a good pattern in Go?\"</a>.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1455567905, "creation_date": 1455567905, "answer_id": 35418399, "question_id": 35412449, "link": "https://stackoverflow.com/questions/35412449/why-did-go-add-panic-and-recover-in-addition-to-error-handling/35418399#35418399", "title": "Why did Go add panic and recover in addition to error handling?", "body": "<p>I think the reason is concurrency model. Go is highly concurrent language in nature and core syntax. Scenario when some computation localized to concurrent process failure, but hole system continue to work can be viewed as normal. To my mind panic and recover are about failure handling, not exceptions.</p>\n"}, {"tags": [], "owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "is_accepted": false, "score": 0, "last_activity_date": 1532007324, "creation_date": 1532007324, "answer_id": 51424083, "question_id": 35412449, "link": "https://stackoverflow.com/questions/35412449/why-did-go-add-panic-and-recover-in-addition-to-error-handling/51424083#51424083", "title": "Why did Go add panic and recover in addition to error handling?", "body": "<p>Because this is more powerful as it allows to create more resilient programs.</p>\n\n<p>In C you can't recover from a NULL pointer dereference.</p>\n\n<p>In Go you can catch it with <code>recover</code>.</p>\n\n<p>This allows for example to create in Go an HTTP server that can catch a NULL pointer dereference when handling a request and return an error 500 instead of crashing the whole server.</p>\n"}], "owner": {"reputation": 715, "user_id": 3076234, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2ea4ede4673ba2e3e7d9b34de3ebd063?s=128&d=identicon&r=PG&f=1", "display_name": "zlatanski", "link": "https://stackoverflow.com/users/3076234/zlatanski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1863, "favorite_count": 2, "closed_date": 1532029144, "answer_count": 4, "score": 11, "last_activity_date": 1532007324, "creation_date": 1455548084, "last_edit_date": 1455570797, "question_id": 35412449, "link": "https://stackoverflow.com/questions/35412449/why-did-go-add-panic-and-recover-in-addition-to-error-handling", "closed_reason": "Opinion-based", "title": "Why did Go add panic and recover in addition to error handling?", "body": "<p>Why did Go end up adopting exception handling with panic/recover, when the language is so idiomatic and a strong advocate of error codes? What scenarios did the designers of Go envision not handled by error codes and necessitate panic/recover?</p>\n\n<p>I understand convention says limit panic/recover, but does the runtime also limit them in ways that they can't be used as general throw/catch in C++?</p>\n"}, {"tags": ["video", "go", "frame"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1455545585, "post_id": 35411585, "comment_id": 58523859, "body": "First frame of many videos is just a black, blank picture (e.g. movies). You should aim at something more meaningful, e.g. a frame from its middle."}, {"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1455545669, "post_id": 35411585, "comment_id": 58523913, "body": "You could: a) decode the video stream and take any frame you like, b) find a library that decodes the video stream and take any frame you like or c) use an external program to do that for you, I guess <code>ffmpeg</code> could do it"}], "answers": [{"comments": [{"owner": {"reputation": 509, "user_id": 4800543, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fnsLIF0yC-k/AAAAAAAAAAI/AAAAAAAAAF0/HtHWkVj5rLs/photo.jpg?sz=128", "display_name": "\u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0421\u0430\u0432\u0438\u043d", "link": "https://stackoverflow.com/users/4800543/%d0%90%d1%80%d1%81%d0%b5%d0%bd%d0%b8%d0%b9-%d0%a1%d0%b0%d0%b2%d0%b8%d0%bd"}, "edited": false, "score": 0, "creation_date": 1607194049, "post_id": 35411887, "comment_id": 115197805, "body": "Tim your answer&#39;s helped me. Tanks you Tim. I&#39;m extended your example. I&#39;m using stdin and stdout for work ffmpeg. <a href=\"https://gist.github.com/ArseniySavin/04f3d50ff6f38bbb472dc2f715b1936f\" rel=\"nofollow noreferrer\">stdin/stdout gist</a>"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 8, "last_activity_date": 1455546373, "last_edit_date": 1495542330, "creation_date": 1455546373, "answer_id": 35411887, "question_id": 35411585, "link": "https://stackoverflow.com/questions/35411585/first-frame-of-video/35411887#35411887", "title": "First frame of video", "body": "<p>As suggested in the comments, using <a href=\"https://ffmpeg.org/\" rel=\"noreferrer\">ffmpeg</a> would be the easiest approach.  Below is an example adapted from <a href=\"https://stackoverflow.com/a/4425466/142162\">this answer</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"os/exec\"\n)\nfunc main() {\n    filename := \"test.mp4\"\n    width := 640\n    height := 360\n    cmd := exec.Command(\"ffmpeg\", \"-i\", filename, \"-vframes\", \"1\", \"-s\", fmt.Sprintf(\"%dx%d\", width, height), \"-f\", \"singlejpeg\", \"-\")\n    var buffer bytes.Buffer\n    cmd.Stdout = &amp;buffer\n    if cmd.Run() != nil {\n        panic(\"could not generate frame\")\n    }\n    // Do something with buffer, which contains a JPEG image\n}\n</code></pre>\n"}], "owner": {"reputation": 1040, "user_id": 5081185, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/yQ8Wl.jpg?s=128&g=1", "display_name": "Mat&#250;\u0161 \u010congr&#225;dy", "link": "https://stackoverflow.com/users/5081185/mat%c3%ba%c5%a1-%c4%8congr%c3%a1dy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3351, "favorite_count": 6, "accepted_answer_id": 35411887, "answer_count": 1, "score": 5, "last_activity_date": 1553884329, "creation_date": 1455545478, "last_edit_date": 1553884329, "question_id": 35411585, "link": "https://stackoverflow.com/questions/35411585/first-frame-of-video", "title": "First frame of video", "body": "<p>I'm creating a single page application with Golang on the backend and javascript on the frontend. \nI\u00b4d like to find a way how to get the first frame of a video using Golang.</p>\n\n<p>First, I upload a .mp4 video file to the server. It is saved on the server.</p>\n\n<p>Is there a way to get the first frame of this video, using Golang?\nIt should be possible to do it using Javascript on frontend, but I don't feel like it is the right way to solve this issue.</p>\n\n<p>I have no idea how to implement it using Golang, and I haven't found any useful libraries, not even built-in functions that could help me to solve this.</p>\n\n<p>Every piece of advice or any recommendations will be much appreciated.</p>\n"}, {"tags": ["sql", "sqlite", "go", "sql-insert", "junction-table"], "answers": [{"tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": false, "score": 0, "last_activity_date": 1455545624, "creation_date": 1455545624, "answer_id": 35411635, "question_id": 35410494, "link": "https://stackoverflow.com/questions/35410494/sqlite-golang-and-junction-table/35411635#35411635", "title": "SQLite, Golang and junction table", "body": "<p>My advice would be to <code>SELECT</code> you list of authors and <code>INSERT</code> the ones that are missing. The solution is naive, but it works and is simple.\nI'm not up-to-date with SQLite relationnal features, but using them isn't always the simplest wway to deal with foreign keys\u2026.</p>\n\n<p>Now, if you have a big bulk of data to process, do the same operation but start by merging your books authors so you can have only one <code>SELECT</code> then one <code>INSERT</code> to do.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 5059021, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153439375919264/picture?type=large", "display_name": "Paul Poloskov", "link": "https://stackoverflow.com/users/5059021/paul-poloskov"}, "is_accepted": false, "score": 0, "last_activity_date": 1455550295, "creation_date": 1455550295, "answer_id": 35413163, "question_id": 35410494, "link": "https://stackoverflow.com/questions/35410494/sqlite-golang-and-junction-table/35413163#35413163", "title": "SQLite, Golang and junction table", "body": "<p>As a quick'n'dirty hack I did a select after adding an author:</p>\n\n<pre><code>err = db.QueryRow(\"select id from authors where fname = ? and mname = ? and lname = ?\", a.Fname, a.Mname, a.Lname).Scan(&amp;a_id)\nif err != nil {\n    log.Fatal(err)\n}\nres, err = db.Exec(\"Insert into booksauthors(bookid, authorid) values(?, ?)\", b_id, a_id)\nif err != nil {\n    enter code herelog.Fatal(err)\n}\n</code></pre>\n\n<p>But I'm still looking for better answer...</p>\n"}], "owner": {"reputation": 21, "user_id": 5059021, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153439375919264/picture?type=large", "display_name": "Paul Poloskov", "link": "https://stackoverflow.com/users/5059021/paul-poloskov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 963, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1455550295, "creation_date": 1455542562, "last_edit_date": 1495541734, "question_id": 35410494, "link": "https://stackoverflow.com/questions/35410494/sqlite-golang-and-junction-table", "title": "SQLite, Golang and junction table", "body": "<p>I would like to create a small database of books using Go and sqlite. I took the main from this advise <a href=\"https://stackoverflow.com/questions/13934994/sqlite-foreign-key-examples\">SQLite foreign key examples</a> and redeveloped it a bit.</p>\n\n<pre><code>package main                                                                                                                                                \n\nimport (\n    \"database/sql\"\n...\n    _ \"github.com/mattn/go-sqlite3\"\n)\n\n...\ndb, err := sql.Open(\"sqlite3\", \"./foo.db\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer db.Close()\n\nsqlStmt := `\n    create table books (\n        id integer primary key autoincrement, \n        title text\n    );\n\n    create table booksauthors ( \n        bookid integer references books(id), \n        uthorid integer references authors(id) ON DELETE CASCADE ON UPDATE CASCADE\n    );\n\n    create table authors (\n        id integer primary key autoincrement, \n        fname text, \n        mname text,\n        lname text,\n        unique (fname, mname, lname) on conflict ignore\n    );\n`\n</code></pre>\n\n<p>So, I'd like to keep list of unique authors and maintain many-to-many connection with books tables (one book may have more then one author, and author might write more then one book).</p>\n\n<p>Then I simply add books in cycle, get LastIndexID and put it to junction table (code is reduces for illustration, b is book struct):</p>\n\n<pre><code>tx, err := db.Begin()\nif err != nil {\n    log.Fatal(err)\n}\n\nres, err := db.Exec(\"Insert into books(title) values(?)\", b.Title)\nif err != nil {\n    log.Fatal(err)\n}\nb_id, _ := res.LastInsertId()\nfor _, a := range b.Authors {\n    res, err = db.Exec(\"Insert into authors(fname, mname, lname) values(?, ?, ?)\", a.Fname, a.Mname, a.Lname)\n    if err != nil {\n        log.Fatal(err)\n    }\n    a_id, _ := res.LastInsertId()\n    fmt.Println(a_id, b_id, a)\n\n    res, err = db.Exec(\"Insert into booksauthors(bookid, authorid) values(?, ?)\", b_id, a_id)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\ntx.Commit()\n</code></pre>\n\n<p>By here comes trouble - a_id is increased if I add more then one book of the same author, but junctions table contains older value of it.\nFor example:</p>\n\n<pre><code>Books:                       \nid | Title                   \n---|--------------------\n1  | Atlas Shrugged pt.1 \n2  | Atlas Shrugged pt.2\n3  | Atlas Shrugged pt.3\n\nAuthors:\nid | Fname | Mname | Lname \n---|-------|-------|------\n702| Ayn   |       | Rand\n\nJunction table:\nBookId | AuthorID\n-------|---------\n 1     |  700\n 2     |  701\n 3     |  702\n\nWhat I want - Junction table:\nBookId | AuthorID\n-------|---------\n 1     |  702\n 2     |  702\n 3     |  702\n</code></pre>\n\n<p>How can I fix it so correct AuthorId would be reflected at the table? I don't want use GORM or any of ORM tools and trying to solve it using pure (well, more or less) SQL.</p>\n\n<p>One of the solutions I see now I can first SELECT, then INSERT if nothing is found and then SELECT once again, however I'm not sure how idiomatic this idea is. Please note that I have considerable numbers of records to add.</p>\n"}, {"tags": ["go", "types"], "answers": [{"comments": [{"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 0, "creation_date": 1455544919, "post_id": 35410028, "comment_id": 58523360, "body": "Thank you, i&#39;d remember this type of switching"}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 1, "creation_date": 1455607167, "post_id": 35410028, "comment_id": 58551412, "body": "@Altenrion Welcome :) . Of course, you can use an ordinary switch too: <code>switch sourceName { case &quot;foo&quot;: deserializedData = new(Foo) ... }</code> . Then you can avoid using <code>reflect</code>. Using a map is good if you want other packages to be able to add source types (eg. if you are writing a jsonrpc library). An ordinary switch is preferable if you have a limited and static set of types. Take your pick :)"}], "tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": true, "score": 4, "last_activity_date": 1455541237, "creation_date": 1455541237, "answer_id": 35410028, "question_id": 35409342, "link": "https://stackoverflow.com/questions/35409342/go-type-assert-of-interface/35410028#35410028", "title": "go: type assert of interface", "body": "<p>Creating an instance of a type dynamically during runtime can be done using the <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow\">reflect</a> package. You can use a map to store the different types that you should be able to create:</p>\n\n<p><strong>Example:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Foo struct {\n    Foo string\n}\n\ntype Bar struct {\n    Bar int\n}\n\nfunc main() {\n    var sourceTypes = map[string]reflect.Type{\n        \"foo\": reflect.TypeOf(Foo{}),\n        \"bar\": reflect.TypeOf(Bar{}),\n    }\n\n    sourceName := \"foo\"\n    var deserializedData interface{}\n\n    deserializedData = reflect.New(sourceTypes[sourceName]).Interface()\n    fmt.Printf(\"%#v\", deserializedData)\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<blockquote>\n  <p>&amp;main.Foo{Foo:\"\"}</p>\n</blockquote>\n\n<p><strong>Playground:</strong> <a href=\"http://play.golang.org/p/qeDA4cu5et\" rel=\"nofollow\">http://play.golang.org/p/qeDA4cu5et</a></p>\n"}], "owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 867, "favorite_count": 0, "accepted_answer_id": 35410028, "answer_count": 1, "score": 0, "last_activity_date": 1455544932, "creation_date": 1455539116, "last_edit_date": 1455539454, "question_id": 35409342, "link": "https://stackoverflow.com/questions/35409342/go-type-assert-of-interface", "title": "go: type assert of interface", "body": "<p>I have a problem with making dynamic model of a struct. I mean that I want to assert or cast, or just change the type of struct according to the incoming data strut. </p>\n\n<p>if <code>sourceName</code> variable would be <code>type_x</code> , than the type of <code>deserializedData</code> should be <code>type_x</code>, if <code>type_y</code>, than <code>type_y</code>. How to set the variable <code>deserializedData</code> dynamicly for this ? </p>\n\n<p>I have this part in my code: </p>\n\n<pre><code>    .... \n\n\n\n  var cacheData []byte\n    var deserializedData models.NoaggModel\n\n    cache_err := cache.Get(string(string(sourceName) + \"_\" + string(t.Date)), &amp;cacheData);\n            if cache_err != nil {\n                fmt.Println(\"cache_error: \", cache_err)\n                panic(\"the cache is empty\")\n            }\n\n            err2 := json.Unmarshal([]byte(cacheData), &amp;deserializedData)\n            if err2 == nil {\n                fmt.Println(\"deserialized data: \" + string(sourceName), deserializedData)\n            }\n\n            for _, chart := range charts {\n                w.Name = chart.Name\n\n            if err2 == nil {\n\n                w.Data = countDataByName(sourceName, deserializedData, t.Request.Filters, string(chart.Name))\n            }\n            out &lt;- w\n        }\n....\n</code></pre>\n\n<p>How to modify it, to avoid setting <code>models.Noagg Model</code> type in a strict way?</p>\n"}, {"tags": ["web-services", "web", "go", "architecture"], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 5913774, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/2NphR.jpg?s=128&g=1", "display_name": "macurie", "link": "https://stackoverflow.com/users/5913774/macurie"}, "edited": false, "score": 0, "creation_date": 1455539084, "post_id": 35409260, "comment_id": 58519435, "body": "Doesn&#39;t BoltDB hold the data in memory? If so, the data will be lost if the program quits, right?"}, {"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "reply_to_user": {"reputation": 113, "user_id": 5913774, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/2NphR.jpg?s=128&g=1", "display_name": "macurie", "link": "https://stackoverflow.com/users/5913774/macurie"}, "edited": false, "score": 0, "creation_date": 1455540246, "post_id": 35409260, "comment_id": 58520163, "body": "BoltDB stores the data on the disk."}, {"owner": {"reputation": 113, "user_id": 5913774, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/2NphR.jpg?s=128&g=1", "display_name": "macurie", "link": "https://stackoverflow.com/users/5913774/macurie"}, "edited": false, "score": 0, "creation_date": 1455542798, "post_id": 35409260, "comment_id": 58521779, "body": "I&#39;ve updated my question with some code. What do you think? Is it correct to put the mutex in the list instead of the individual applicant?"}, {"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "reply_to_user": {"reputation": 113, "user_id": 5913774, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/2NphR.jpg?s=128&g=1", "display_name": "macurie", "link": "https://stackoverflow.com/users/5913774/macurie"}, "edited": false, "score": 0, "creation_date": 1455545111, "post_id": 35409260, "comment_id": 58523499, "body": "If you use BoltDB you don&#39;t need a Mutex. Bolt internally handles the locking and unlocking. You only need a Mutex if you use files on your own."}, {"owner": {"reputation": 113, "user_id": 5913774, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/2NphR.jpg?s=128&g=1", "display_name": "macurie", "link": "https://stackoverflow.com/users/5913774/macurie"}, "edited": false, "score": 0, "creation_date": 1455556987, "post_id": 35409260, "comment_id": 58531571, "body": "Should I even use a <code>prioryList</code> struct as above or should I modify the data directly in the database?"}], "tags": [], "owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "is_accepted": true, "score": 0, "last_activity_date": 1455538870, "creation_date": 1455538870, "answer_id": 35409260, "question_id": 35409157, "link": "https://stackoverflow.com/questions/35409157/simple-list-of-applicants-webapp/35409260#35409260", "title": "Simple list of applicants webapp", "body": "<p>If you use a file, you could use a <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"nofollow\"><code>Mutex</code></a> to block concurrent writes.</p>\n\n<p>Otherwise a database would be fine. For example <a href=\"https://github.com/boltdb/bolt\" rel=\"nofollow\">BoltDB</a> could be suitable. It is pure go and runs withing your program.</p>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1455551529, "creation_date": 1455551529, "answer_id": 35413611, "question_id": 35409157, "link": "https://stackoverflow.com/questions/35409157/simple-list-of-applicants-webapp/35413611#35413611", "title": "Simple list of applicants webapp", "body": "<p>There are many approaches. You can use file and protect it with Go mutex or system lock. You can memory map the file for performance. You either can use BoltDB which is nice peace of software and provide needed machinery and can work in-process. If you write rare and mostly read, then constant DB <a href=\"https://github.com/colinmarc/cdb\" rel=\"nofollow\">https://github.com/colinmarc/cdb</a> also looks interesting.\nBut, classic SQL DB has some advantages</p>\n\n<ul>\n<li>You can use third party store for data and easely migrate when needed</li>\n<li>You can access your data from third party app or just plain SQL\nrequest</li>\n<li>You can think about data schema and code logic separately</li>\n</ul>\n"}], "owner": {"reputation": 113, "user_id": 5913774, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/2NphR.jpg?s=128&g=1", "display_name": "macurie", "link": "https://stackoverflow.com/users/5913774/macurie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 35409260, "answer_count": 2, "score": 1, "last_activity_date": 1455551529, "creation_date": 1455538566, "last_edit_date": 1455543504, "question_id": 35409157, "link": "https://stackoverflow.com/questions/35409157/simple-list-of-applicants-webapp", "title": "Simple list of applicants webapp", "body": "<p>I am creating a web application that lists applicants and their position on a waiting list.</p>\n\n<p>We need to be able to add new applicants to this list and remove applicants from the list. There will be under 10k applicants in the list.</p>\n\n<p><strong>Specifics:</strong></p>\n\n<ul>\n<li><p>I plan to write the app in Golang.</p></li>\n<li><p>The list needs to be safe, I the program shuts down, it should be recoverable.</p></li>\n<li><p>The app should contain this data for every applicant: Name, Student ID, position.</p></li>\n</ul>\n\n<p><strong>Questions:</strong></p>\n\n<ol>\n<li>How do I secure the list (lock?) so it is updated correctly for both if two updates to it is made at the same time?</li>\n<li>Should I save the data in a database or use a file?</li>\n</ol>\n\n<p>I need your help!</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p><strong>Mockup code:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"sync\"\n    \"time\"\n\n    \"github.com/boltdb/bolt\"\n)\n\ntype applicant struct {\n    FirstName string\n    LastName  string\n    StudentID string\n    Position  int\n}\n\ntype priorityList struct {\n    sync.Mutex\n    applicants []applicant\n}\n\nfunc (l *priorityList) newApplicant(fn string, ln string, sid string) error {\n\n    // add applicant to priorityList\n    return nil\n}\n\nfunc (l *priorityList) removeApplicant(sid string) error {\n    // remove applicant from priorityList\n    return nil\n}\n\nfunc (l *priorityList) editApplicant(sid string) error {\n    // edit applicant in priorityList\n    return nil\n}\n\nfunc main() {\n    // Database\n    db, err := bolt.Open(\"priorityList.db\", 0600, &amp;bolt.Options{Timeout: 1 * time.Second})\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 25, "user_id": 5076622, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d233a55e0265ca344016e6c28bddd9a0?s=128&d=identicon&r=PG&f=1", "display_name": "Sohail Shaikh", "link": "https://stackoverflow.com/users/5076622/sohail-shaikh"}, "is_accepted": true, "score": 0, "last_activity_date": 1455541556, "creation_date": 1455541556, "answer_id": 35410136, "question_id": 35409153, "link": "https://stackoverflow.com/questions/35409153/how-to-retrieve-unstructured-form-of-data-from-mongo-using-go-map/35410136#35410136", "title": "How to retrieve unstructured form of data from mongo using go map", "body": "<pre><code>var m []bson.M\n    err := collection.Find(bson.M{\"taskData.Priority\" : \"2\"}).All(&amp;m) \n    if err != nil {\n        fmt.Println(\"Error : \",err)\n    }else{\n      fmt.Println(\"Map : \",m)\n    }\n  }\n</code></pre>\n\n<p>Here is the description \n<a href=\"https://docs.mongodb.org/manual/tutorial/query-documents/#equality-match-on-fields-within-an-embedded-document\" rel=\"nofollow\">https://docs.mongodb.org/manual/tutorial/query-documents/#equality-match-on-fields-within-an-embedded-document</a></p>\n"}], "owner": {"reputation": 25, "user_id": 5076622, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d233a55e0265ca344016e6c28bddd9a0?s=128&d=identicon&r=PG&f=1", "display_name": "Sohail Shaikh", "link": "https://stackoverflow.com/users/5076622/sohail-shaikh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 35410136, "answer_count": 1, "score": 0, "last_activity_date": 1455541556, "creation_date": 1455538551, "question_id": 35409153, "link": "https://stackoverflow.com/questions/35409153/how-to-retrieve-unstructured-form-of-data-from-mongo-using-go-map", "title": "How to retrieve unstructured form of data from mongo using go map", "body": "<p>I'm trying to retrieve data using go map. The data in mongo is like </p>\n\n<pre><code>\"_id\" : ObjectId(\"56bf128f5a9a6a0ebfdd5075\"),\n    \"deadLine\" : {\n      \"Start_time\" : ISODate(\"2016-05-24T00:00:00Z\"),\n      \"End_time\" : ISODate(\"2016-05-29T00:00:00Z\")\n    },\n    \"taskData\" : {\n      \"Task_content\" : \"Something\",\n      \"Priority\" : \"3\"\n    },\n    \"group\" : {\n      \"1\" : {\n      \"grp_name\" : \"grp\"\n      },\n      \"2\" : {\n      \"grp_name\" : \"secondGrp\"\n      }\n    }\n</code></pre>\n\n<p>And I want to retrieve all records according to <code>Priority</code>. </p>\n\n<p>the sample code which i tried ...</p>\n\n<pre><code>var m []bson.M\n    err := collection.Find(bson.M{\"taskData\":bson.M{\"Priority\" : \"2\"}}).All(&amp;m) // stuck here in `Find()`\n    if err != nil {\n        fmt.Println(\"Error : \",err)\n    }else{\n      fmt.Println(\"Map : \",m)\n    }\n  }\n</code></pre>\n\n<p>If i use \n<code>err := collection.Find(bson.M{\"_id\":bson.ObjectIdHex(\"56bf128f5a9a6a0ebfdd5075\")}).All(&amp;m)</code> \nthen it fetch all records.\nKindly correct my mistake. </p>\n\n<p>Thanks in advance </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 163714, "user_id": 123527, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/99e0b39c091e10d9c7d4452a34ca52dc?s=128&d=identicon&r=PG", "display_name": "Simone Carletti", "link": "https://stackoverflow.com/users/123527/simone-carletti"}, "is_accepted": false, "score": 2, "last_activity_date": 1455538227, "creation_date": 1455538227, "answer_id": 35409050, "question_id": 35408860, "link": "https://stackoverflow.com/questions/35408860/how-to-use-go-newrequest-method/35409050#35409050", "title": "how to use Go newRequest method", "body": "<p>Your assumption is correct, you can't use the <a href=\"https://golang.org/pkg/net/http/#NewRequest\" rel=\"nofollow\"><code>NewRequest</code></a> method from the <code>net/http</code> package in that way.</p>\n\n<p>Moreover, it doesn't make a lot of sense as the third parameter of the <code>NewRequest</code> function is supposed to be the body payload of the request, not the headers.</p>\n\n<pre><code>func NewRequest(method, urlStr string, body io.Reader) (*Request, error)\n</code></pre>\n\n<p>Assuming the library is not incorrect, My assumption is that the <code>http</code> package here is not the <code>net/http</code> package, rather some sort of other HTTP client that is imported as <code>http</code>. In fact, if you import</p>\n\n<pre><code>import (\n  \"github.com/foobar/someclient/http\"\n)\n</code></pre>\n\n<p>it will also be referenced as <code>http</code>. You should check the import of the file.</p>\n\n<p>FYI, the correct way to add headers is:</p>\n\n<pre><code>req, err := http.NewRequest(\"DELETE\", \"/path/to/something\", nil)\nif err != nil {\n    // do something\n}\nreq.Header.Add(\"authorization\", \"1432536546\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 5412965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ada9d591c1cf7922dabde515b95c90f?s=128&d=identicon&r=PG&f=1", "display_name": "Micoloth", "link": "https://stackoverflow.com/users/5412965/micoloth"}, "edited": false, "score": 0, "creation_date": 1455558502, "post_id": 35409154, "comment_id": 58532474, "body": "Thanks, this works, even if we probably should not read the sorce code of a programming language to use it.   Also, two more questions: so, how does this work? When is the request actually sent, if I modify it after the newRequest call?"}, {"owner": {"reputation": 13, "user_id": 5412965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ada9d591c1cf7922dabde515b95c90f?s=128&d=identicon&r=PG&f=1", "display_name": "Micoloth", "link": "https://stackoverflow.com/users/5412965/micoloth"}, "edited": false, "score": 0, "creation_date": 1455558713, "post_id": 35409154, "comment_id": 58532611, "body": "And also: there is no way to add a whole map at once? This is just syntax, but it would be nice"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 13, "user_id": 5412965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ada9d591c1cf7922dabde515b95c90f?s=128&d=identicon&r=PG&f=1", "display_name": "Micoloth", "link": "https://stackoverflow.com/users/5412965/micoloth"}, "edited": false, "score": 1, "creation_date": 1455564941, "post_id": 35409154, "comment_id": 58536004, "body": "@Micoloth you don&#39;t need to read the source, you can try to read the documentation... And no you can&#39;t add the whole map but you can do something like <code>for k, v := yourMap { req.Headers.Add(k, v) }</code>"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 13, "user_id": 5412965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ada9d591c1cf7922dabde515b95c90f?s=128&d=identicon&r=PG&f=1", "display_name": "Micoloth", "link": "https://stackoverflow.com/users/5412965/micoloth"}, "edited": false, "score": 0, "creation_date": 1455565062, "post_id": 35409154, "comment_id": 58536068, "body": "@Micoloth <a href=\"http://tip.golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">tip.golang.org/pkg/net/http</a> look at the 3rd example in the overview."}], "tags": [], "owner": {"reputation": 8775, "user_id": 821110, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/fa6fca5f613944238a91d2daeba67b9d?s=128&d=identicon&r=PG", "display_name": "W.K.S", "link": "https://stackoverflow.com/users/821110/w-k-s"}, "is_accepted": true, "score": 2, "last_activity_date": 1455572740, "last_edit_date": 1455572740, "creation_date": 1455538556, "answer_id": 35409154, "question_id": 35408860, "link": "https://stackoverflow.com/questions/35408860/how-to-use-go-newrequest-method/35409154#35409154", "title": "how to use Go newRequest method", "body": "<p>The third parameter is <a href=\"https://golang.org/src/net/http/request.go?s=17718:17790#L536\" rel=\"nofollow\">Body</a>, which is used in POST requests. It is not for headers.\nTo add headers, </p>\n\n<pre><code>req, err := http.NewRequest(\"DELETE\", url, nil)\nif err != nil{\n    panic(err);\n}\n\nreq.Header.Add(\"Authorization\",\"1432536546\") //string, string\n</code></pre>\n\n<p>The Go documentation does provide several examples. This one is the first example in the <code>Overview</code> section.</p>\n"}], "owner": {"reputation": 13, "user_id": 5412965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ada9d591c1cf7922dabde515b95c90f?s=128&d=identicon&r=PG&f=1", "display_name": "Micoloth", "link": "https://stackoverflow.com/users/5412965/micoloth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1402, "favorite_count": 0, "accepted_answer_id": 35409154, "answer_count": 2, "score": -2, "last_activity_date": 1455572740, "creation_date": 1455537670, "last_edit_date": 1455540283, "question_id": 35408860, "link": "https://stackoverflow.com/questions/35408860/how-to-use-go-newrequest-method", "title": "how to use Go newRequest method", "body": "<p>So, I've just started with Go and I'm trying to learn <code>HTTP</code> package. I found this program on the internet</p>\n\n<pre><code>headers := make(map[string]string)\nheaders[\"authorization\"] = \"1432536546\" //the auhorization string\n\nurl :=    \"anUrl\\\"\n\nreq, err := http.NewRequest(\"DELETE\", url, headers)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>But it is wrong, as it appears you can't use maps like this as they don't implement the <code>io.Reader</code> interface:</p>\n\n<pre><code>  cannot use headers (type map[string]string) as type io.Reader in argument to http.NewRequest:\n  map[string]string does not implement io.Reader (missing Read method)\n</code></pre>\n\n<p>This is one of the first code snippets I tried, I actually got it from what I thought to be a reliable source, and obviously it doesn't compile. Go looks pretty interesting, but it  has pretty much zero tutorials and useful documentation... Please help me, what is the right way to do it?</p>\n"}, {"tags": ["ruby", "sockets", "go", "tcp"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1455543697, "post_id": 35407717, "comment_id": 58522435, "body": "The go rpc server isn&#39;t using json, so a ruby json rpc client isn&#39;t going to speak the same protocol."}, {"owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455692226, "post_id": 35407717, "comment_id": 58596816, "body": "@JimB   Hi,  I only used json in that Ruby example as that was the only example i could find online as how to get Ruby to talk to a Go RPC over TCP.  Do you know how another language (like Ruby) is supposed to pass the function identifier down the socket?  I assume with a socket I need to write the data in a particular format for the receiving end of the socket to know how to deal with it?"}, {"owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455701191, "post_id": 35407717, "comment_id": 58601841, "body": "Hmm, so it seems that the net/rpc only works with Go clients as they speak <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/gob</a> with the server. I&#39;ve tried switching to jsonrpc but using the example I&#39;m getting back <code>{&quot;id&quot;=&gt;nil, &quot;result&quot;=&gt;nil, &quot;error&quot;=&gt;&quot;json: cannot unmarshal string into Go value of type [1]interface {}&quot;}</code> which I&#39;m not sure how to resolve"}], "answers": [{"tags": [], "owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "is_accepted": true, "score": 0, "last_activity_date": 1455790270, "creation_date": 1455790270, "answer_id": 35478477, "question_id": 35407717, "link": "https://stackoverflow.com/questions/35407717/ruby-socket-client-hanging-when-calling-go-rpc-tcp-service/35478477#35478477", "title": "Ruby Socket Client hanging when calling Go RPC TCP Service", "body": "<p>OK, so the actual fix I needed to make in my code was as follows:</p>\n\n<p>The incoming args needed to be a custom type so you could export it and the fields themselves within that type need to be exported...</p>\n\n<pre><code>type Args struct {\n    Foo string\n    Bar string\n}\n</code></pre>\n\n<p>But more importantly, on the Ruby side, you need to send your JSON in a format that makes this requirement -> <a href=\"https://golang.org/src/net/rpc/jsonrpc/client.go#L45\" rel=\"nofollow\">https://golang.org/src/net/rpc/jsonrpc/client.go#L45</a> &lt;- happy</p>\n\n<p>So do this...</p>\n\n<pre><code>b = {\n  :method =&gt; \"Compose.Details\",\n  :params =&gt; [{ :Foo =&gt; \"Foo!\", :Bar =&gt; \"Bar!\" }],\n  :id     =&gt; \"0\" # id is just echo'ed back to the client\n}\n</code></pre>\n"}], "owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 423, "favorite_count": 0, "accepted_answer_id": 35478477, "answer_count": 1, "score": 0, "last_activity_date": 1455790270, "creation_date": 1455534326, "last_edit_date": 1455785950, "question_id": 35407717, "link": "https://stackoverflow.com/questions/35407717/ruby-socket-client-hanging-when-calling-go-rpc-tcp-service", "title": "Ruby Socket Client hanging when calling Go RPC TCP Service", "body": "<p>I have a working RPC TCP service written in Go, but when using Ruby to connect to the service it hangs because no data appears to be sent back through the open socket connection.</p>\n\n<p>Remote RPC Function:</p>\n\n<pre><code>package remote\n\nimport \"fmt\"\n\n// Compose is our RPC functions return type\ntype Compose string\n\n// Details is our exposed RPC function\nfunc (c *Compose) Details(arg string, reply *string) error {\n    fmt.Printf(\"Arg received: %+v\\n\", arg)\n    *c = \"some value\"\n    *reply = \"Blah!\"\n    return nil\n}\n</code></pre>\n\n<p>Remote RPC Endpoint Exposed:</p>\n\n<pre><code>package remote\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"net/rpc\"\n)\n\n// Endpoint exposes our RPC over TCP service\nfunc Endpoint() {\n    compose := new(Compose)\n    rpc.Register(compose)\n\n    listener, err := net.Listen(\"tcp\", \":8080\")\n    // error handling omitted\n\n    for {\n        conn, err := listener.Accept()\n        // error handling omitted\n\n        go rpc.ServeConn(conn)\n    }\n}\n</code></pre>\n\n<p>Client Connection over TCP to Remote RPC function (using Golang so I know it works at least in that respect):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/rpc\"\n)\n\nfunc main() {\n    client, err := rpc.Dial(\"tcp\", \"localhost:8080\")\n    if err != nil {\n        log.Fatal(\"dialing:\", err)\n    }\n\n    var reply string\n\n    e := client.Call(\"Compose.Details\", \"my string\", &amp;reply)\n    if e != nil {\n        log.Fatalf(\"Something went wrong: %v\", e.Error())\n    }\n\n    fmt.Printf(\"The 'reply' pointer value has been changed to: %s\", reply)\n}\n</code></pre>\n\n<p>Here is the Ruby code I'm attempting to use:</p>\n\n<pre><code>require \"socket\"\nrequire \"json\"\n\nsocket = TCPSocket.new \"localhost\", \"8080\"\n\nb = {\n  method: \"Compose.Details\",\n  params: \"foobar\"\n}\n\nsocket.write(JSON.dump(b))\n\nresp = JSON.load(socket.readline)\n\np resp\n</code></pre>\n\n<p>The reason I think it doesn't work is because the Go RPC requires a pointer to be provided as the second argument to the exposed RPC function but I'm not sure how that works in a different programming language such as Ruby?</p>\n\n<p>I've also tried utilising a library such as <a href=\"https://github.com/chriskite/jimson\" rel=\"nofollow\">https://github.com/chriskite/jimson</a></p>\n\n<pre><code>require \"jimson\"\n\nclient = Jimson::Client.new(\"localhost:8080\")\nresult = client.Details(\"foobar\")\n</code></pre>\n\n<p>But all I get back is:</p>\n\n<pre><code>RestClient::ServerBrokeConnection: Server broke connection\n</code></pre>\n\n<hr>\n\n<h2>UPDATE</h2>\n\n<p>So as indicated by JimB in the comments, I needed to use the JSON RPC library instead. Things still don't quite work, as you'll see...</p>\n\n<p>Here's the updated Ruby client:</p>\n\n<pre><code>require \"socket\"\nrequire \"json\"\n\nsocket = TCPSocket.new \"localhost\", \"8080\"\n\nb = {\n  method: \"Compose.Details\",\n  params: [{ :args =&gt; { :foo =&gt; \"Foo!\", :bar =&gt; \"Bar!\" }, :id =&gt; \"0\" }]\n}\n\nsocket.write(JSON.dump(b))\n\np JSON.load(socket.readline)\n</code></pre>\n\n<p>Followed by the updated Go client:</p>\n\n<pre><code>package remote\n\nimport \"fmt\"\n\n// Args is structured around the client's provided parameters\ntype Args struct {\n foo string\n bar string\n}\n\n// Compose is our RPC functions return type\ntype Compose string\n\n// Details is our exposed RPC function\nfunc (c *Compose) Details(args *Args, reply *string) error {\n fmt.Printf(\"Args received: %+v\\n\", args)\n *c = \"some value\"\n *reply = \"Blah!\"\n return nil\n}\n</code></pre>\n\n<p>When I run this my Ruby client sees the following:</p>\n\n<pre><code>{\"id\"=&gt;nil, \"result\"=&gt;\"Blah!\", \"error\"=&gt;nil}\n</code></pre>\n\n<p>So I'm getting a result back, but if my actual RPC code tried to use the provided args in any way to generate the result then this would be a broken example because the stdout I get from the Go RPC function is a set of empty arg values?</p>\n\n<pre><code>Args received: &amp;{foo: bar:}\n</code></pre>\n\n<p>I'm not sure why the RPC function isn't able to pull in the arguments I've provided to it?</p>\n\n<p>Also the \"id\" key: why would I get one back from the RPC function? and how can I give it a meaningful value? </p>\n\n<p>I tried setting an \"id\" key with a value from my Ruby client but that didn't effect the response from the Go RPC.</p>\n"}, {"tags": ["mongodb", "go", "bson", "mgo"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1455540174, "post_id": 35404841, "comment_id": 58520121, "body": "Why is key &quot;AB.Value.to&quot; incremented by two? Is that a type or is it because it was second to be added?"}], "answers": [{"tags": [], "owner": {"reputation": 135, "user_id": 3841436, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/100000631286631/picture?type=large", "display_name": "Vinay Sawant", "link": "https://stackoverflow.com/users/3841436/vinay-sawant"}, "is_accepted": true, "score": 0, "last_activity_date": 1456317385, "creation_date": 1456317385, "answer_id": 35602392, "question_id": 35404841, "link": "https://stackoverflow.com/questions/35404841/how-do-i-combine-list-of-bson-m-elements-into-a-single-bson-m-in-mongo-in-golang/35602392#35602392", "title": "How do i combine list of bson.M elements into a single bson.M in mongo in golang?", "body": "<pre><code>func (o *MongoOps) AddToBsonMapElement(lstMap map[string]interface{},     Operation string, key string, value interface{}) (result map[string]interface{})     {\nstatus, msg := EmptyStructCheck(o)\nif status == true {\n    LogError(msg)\n    panic(msg)\n}\nif Operation == \"$addToSetEach\" {\n    if _, ok := lstMap[\"$addToSet\"]; ok {\n        childmap := lstMap[\"$addToSet\"]\n        subchildmap := childmap.(map[string]interface{})\n        var val map[string]interface{}\n        val = make(map[string]interface{})\n        val[\"$each\"] = value\n        subchildmap[key] = val\n        lstMap[\"$addToSet\"] = subchildmap\n\n    } else {\n        lstMap[\"$addToSet\"] = bson.M{key: bson.M{\"$each\": value}}\n    }\n\n    fmt.Println(reflect.TypeOf(lstMap))\n} else if _, ok := lstMap[Operation]; ok {\n    childmap := lstMap[Operation]\n    subchildmap := childmap.(map[string]interface{})\n    subchildmap[key] = value\n    lstMap[Operation] = subchildmap\n\n} else {\n    childmap := make(map[string]interface{}, 0)\n    childmap[key] = value\n    lstMap[Operation] = childmap\n}\n\nreturn lstMap\n}\n</code></pre>\n\n<p>This is what you can try</p>\n"}], "owner": {"reputation": 111, "user_id": 5160937, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-CTaThgLXQ6Y/AAAAAAAAAAI/AAAAAAAAADE/kxPAFcOgtFM/photo.jpg?sz=128", "display_name": "Vinay Sawant", "link": "https://stackoverflow.com/users/5160937/vinay-sawant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1467, "favorite_count": 0, "accepted_answer_id": 35602392, "answer_count": 1, "score": 0, "last_activity_date": 1456317385, "creation_date": 1455525954, "question_id": 35404841, "link": "https://stackoverflow.com/questions/35404841/how-do-i-combine-list-of-bson-m-elements-into-a-single-bson-m-in-mongo-in-golang", "title": "How do i combine list of bson.M elements into a single bson.M in mongo in golang?", "body": "<pre><code>lstMap := make([]interface{}, 0)\nlstMap = mongoOps.AddToBsonMap(lstMap, bson.M{\"$inc\": bson.M{\"Google.ab.Value\": 1}})\nlstMap = mongoOps.AddToBsonMap(lstMap, bson.M{\"$inc\": bson.M{\"Google.ab1.Value1\": 1}})\n\nfunc (o *MongoOps) AddToBsonMap(lstMap []interface{}, value interface{}) (result []interface{}) {\nlstMap = append(lstMap, value)\nreturn lstMap\n</code></pre>\n\n<p>}</p>\n\n<pre><code> I want the in this format :\n bson.M{\"$inc\": bson.M{\"Google.ab.Value\": 1, \"AB.Value.to\": 2}}\n</code></pre>\n\n<p>All the operation of same key needs to be appended.Thank you in advance</p>\n"}, {"tags": ["javascript", "json", "time", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 0, "creation_date": 1455529084, "post_id": 35405060, "comment_id": 58512928, "body": "Man, you saved me a great amount of time, Thank you so much!! Hope  that other people would be as helpful for you!!!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1455527008, "last_edit_date": 1455527008, "creation_date": 1455526659, "answer_id": 35405060, "question_id": 35404588, "link": "https://stackoverflow.com/questions/35404588/go-format-struct-for-javascript-json-without-keys/35405060#35405060", "title": "Go : format struct for javascript (json without keys)", "body": "<p>The output format you want:</p>\n\n<pre><code>[[\"1455523840380\",1],[\"1455523840383\",2],[\"1455523840384\",3]]\n</code></pre>\n\n<p>In JSON it is not an array of struct, but an array of arrays.</p>\n\n<p>Since the \"internal\" array has various types (string and numeric), you can model it like this:</p>\n\n<pre><code>type ChartElement []interface{}\n</code></pre>\n\n<p>And you can populate it like this:</p>\n\n<pre><code>s := []ChartElement{{\"1455523840380\", 1}, {\"1455523840383\", 2}, {\"1455523840384\", 3}}\n</code></pre>\n\n<p>And if you marshal it to JSON:</p>\n\n<pre><code>data, err := json.Marshal(s)\nfmt.Println(string(data), err)\n</code></pre>\n\n<p>Output is what you expect:</p>\n\n<pre><code>[[\"1455523840380\",1],[\"1455523840383\",2],[\"1455523840384\",3]] &lt;nil&gt;\n</code></pre>\n\n<p>And the time values such as <code>1455523840380</code> are the the number of milliseconds elapsed since January 1, 1970 UTC. In Go you can get this value from a <code>time.Time</code> value with its <a href=\"https://golang.org/pkg/time/#Time.UnixNano\" rel=\"nofollow\"><code>Time.UnixNano()</code></a> method and dividing it by <code>1000000</code> (to get milliseconds from nanoseconds), for example:</p>\n\n<pre><code>fmt.Println(time.Now().UnixNano() / 1000000) // Output: 1455526958178\n</code></pre>\n\n<p>Note that in order to have time values as strings in the JSON output, you have to add these time values as <code>string</code>s in the <code>[]ChartElement</code>. To convert this millisecond value to <code>string</code>, you can use <a href=\"https://golang.org/pkg/strconv/#FormatInt\" rel=\"nofollow\"><code>strconv.FormatInt()</code></a>, e.g.</p>\n\n<pre><code>t := time.Now().UnixNano() / 1000000\ntimestr := strconv.FormatInt(t, 10) // timestr is of type string\n</code></pre>\n"}], "owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 35405060, "answer_count": 1, "score": 1, "last_activity_date": 1455527008, "creation_date": 1455524981, "question_id": 35404588, "link": "https://stackoverflow.com/questions/35404588/go-format-struct-for-javascript-json-without-keys", "title": "Go : format struct for javascript (json without keys)", "body": "<p>I have to form a slice of structs for the chart. Marshal it, and return to the frontend widget. \nWidget is waiting for the format like this : </p>\n\n<pre><code>[[\"1455523840380\",1],[\"1455523840383\",2],[\"1455523840384\",3]]\n</code></pre>\n\n<p>But My data comes like this : </p>\n\n<pre><code>[{\"Time\":1.45552462158e+12,\"Value\":1},{\"Time\":1.45552462158e+12,\"Value2},{\"Time\":1.45552462158e+12,\"Value3}]\n</code></pre>\n\n<p>My struct that is coming to the slice is made like this : </p>\n\n<pre><code>type ChartElement struct {\n    Time  int `json:\"\"`\n    Value int `json:\"\"`\n}\n</code></pre>\n\n<p>I have now 2 main troubles: </p>\n\n<ol>\n<li>how to make the json without keys, but just 2 values with comma\nbetween  them?  </li>\n<li>how to convert date or time to the javascript\nmiliseconds correctly?</li>\n</ol>\n"}, {"tags": ["reflection", "go", "struct", "interface", "embedding"], "answers": [{"comments": [{"owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "edited": false, "score": 0, "creation_date": 1455523553, "post_id": 35404006, "comment_id": 58509769, "body": "I like the idiomatic part of your answer. It is clean an straight forward. Thank you Icza!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1554198981, "last_edit_date": 1554198981, "creation_date": 1455522568, "answer_id": 35404006, "question_id": 35403796, "link": "https://stackoverflow.com/questions/35403796/accessing-embedded-type-fields-through-interface/35404006#35404006", "title": "Accessing embedded type fields through interface", "body": "<p>You could use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> if you know the exact type which is fast, and only revert to reflection if that fails.</p>\n\n<p>For example:</p>\n\n<pre><code>func EngineCheck(v Vehicle) {\n    var power float64\n    if eng, ok := v.(*Car); ok {\n        power = eng.Power\n    } else {\n        power = reflect.ValueOf(v).Elem().FieldByName(\"Power\").Interface().(float64)\n    }\n    fmt.Println(power)\n}\n</code></pre>\n\n<p>Note that the types <code>Car</code> and <code>*Car</code> are different, and the above example would only \"skip\" the reflection part if the value you pass is indeed a pointer: <code>*Car</code>.</p>\n\n<p>If there are multiple possible \"acceptable\" types, you could use a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">type switch</a>. For example if you pass a <code>Car</code> or <code>*Car</code>, you can get the <code>Power</code> value from both. Also if <code>Engine</code> or <code>*Engine</code> would be passed, the same thing applies.</p>\n\n<pre><code>func EngineCheck(v Vehicle) {\n    var power float64\n    switch i := v.(type) {\n    case *Car:\n        power = i.Power\n    case Car:\n        power = i.Power\n    case *Engine:\n        power = i.Power\n    case Engine:\n        power = i.Power\n    default:\n        power = reflect.ValueOf(v).Elem().FieldByName(\"Power\").Interface().(float64)\n    }\n    fmt.Println(power)\n}\n</code></pre>\n\n<p>But the idiomatic solution would still be to add a getter function to <code>Vehicle</code>:</p>\n\n<pre><code>type Vehicle interface {\n    GetPower() float64\n}\n</code></pre>\n\n<p>Note that you do not have to implement <code>GetPower()</code> everywhere. If you implement it at the <code>Engine</code>:</p>\n\n<pre><code>func (e Engine) GetPower() float64 {\n    return e.Power\n}\n</code></pre>\n\n<p>And you embed <code>Engine</code> into <code>Car</code> (as you did), your <code>Car</code> type will automatically have this <code>GetPower()</code> method (promoted) in its <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method set</a> and thus it will automatically implement <code>Vehicle</code>. And then your <code>EngineCheck()</code> function would be as simple as:</p>\n\n<pre><code>func EngineCheck(v Vehicle) {\n    fmt.Println(v.GetPower())\n}\n</code></pre>\n\n<p>Try all these 3 variants on the <a href=\"http://play.golang.org/p/_obSaCL_Sj\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 35404006, "answer_count": 1, "score": 1, "last_activity_date": 1554198981, "creation_date": 1455521704, "last_edit_date": 1455523738, "question_id": 35403796, "link": "https://stackoverflow.com/questions/35403796/accessing-embedded-type-fields-through-interface", "title": "Accessing embedded type fields through interface", "body": "<p>It seems like I missed something important but I can not figure out what it is. I use reflect to access embedded type fields through an interface. The problem I have is that according to <code>runtime/pprof</code> it eats up a lot of CPU. I do not like to implement Setter and Getter methods on all Vehicles so is there a better way of doing this?</p>\n\n<p>Simplified sample:</p>\n\n<pre><code>package main\n\nimport(\n    \"reflect\"\n    \"fmt\"\n)\n\n// the \"contract\" is that all vehicles have an embedded Engine\ntype Vehicle interface {}\n\ntype Engine struct {\n    Power float64\n    Cubic float64\n}\n\ntype Car struct {\n    Engine\n    Weight float64\n    TopSpeed float64\n}\n\n// more Vehicles with Engines here...\n\nfunc EngineCheck(v Vehicle) {\n    // this does not work:\n    //power := v.Power\n    // reflection works but eats up a lot of CPU:\n    power := reflect.ValueOf(v).Elem().FieldByName(\"Power\").Interface().(float64)\n    fmt.Println(power)\n}\n\nfunc main() {\n    c1 := &amp;Car{Engine{120.0, 1.2}, 1.5, 250}\n\n    EngineCheck(c1)\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "types", "append", "slice"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1455518085, "post_id": 35402105, "comment_id": 58507280, "body": "I&#39;m not sure I understand the question. If you create an item of type keyvalue for a user, you append it with userslice = append(userslice, user). Is that what you&#39;re asking?"}], "answers": [{"tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 2, "last_activity_date": 1455518573, "creation_date": 1455518573, "answer_id": 35403012, "question_id": 35402105, "link": "https://stackoverflow.com/questions/35402105/golang-append-to-a-slice-of-type/35403012#35403012", "title": "Golang append to a slice of type", "body": "<p>Just use <code>keyvalue</code> instead of <code>map[string]interface{}</code> in your code:</p>\n\n<pre><code>type keyvalue map[string]interface{}\n\n....\n\nuser1 := make(keyvalue)\nuser1[\"distinguishedName\"] = \"[CN=user.1,OU=random,DC=example,DC=com]\"\nuser1[\"givenName\"] = \"user\"\n\nvar userslice []keyvalue\nuserslice = append(userslice, user1)\n\nfmt.Printf(\"%#v\", userslice)\n</code></pre>\n"}], "owner": {"reputation": 384, "user_id": 3559707, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/721418784d6d08b44a97bca804195eeb?s=128&d=identicon&r=PG&f=1", "display_name": "file2cable", "link": "https://stackoverflow.com/users/3559707/file2cable"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 675, "favorite_count": 0, "accepted_answer_id": 35403012, "answer_count": 1, "score": 0, "last_activity_date": 1455518573, "creation_date": 1455514295, "question_id": 35402105, "link": "https://stackoverflow.com/questions/35402105/golang-append-to-a-slice-of-type", "title": "Golang append to a slice of type", "body": "<p>I am doing an ldap query, and I want to populate the result into a slice. The result looks something like</p>\n\n<pre><code>objectClass [top person organizationalPerson user]\ncn [user.1]\nsn [one]\ndescription [user.1]\ngivenName [user]\ndistinguishedName [CN=user.1,OU=random,DC=example,DC=com]\n...\n</code></pre>\n\n<p>I am trying to populate it to a map and for that, I created a type.</p>\n\n<pre><code>    type keyvalue map[string]interface{}\n</code></pre>\n\n<p>Now I want to create a slice of this type, so that the data would look something like this for multiple users taken</p>\n\n<pre><code>objectClass [top person organizationalPerson user]\ncn [user.1]\nsn [one]\ndescription [user.1]\ngivenName [user]\ndistinguishedName [CN=user.1,OU=random,DC=example,DC=com]\n...\nobjectClass [top person organizationalPerson user]\ncn [user.2]\nsn [one]\ndescription [user.2]\ngivenName [user]\ndistinguishedName [CN=user.2,OU=random,DC=example,DC=com]\n...\n</code></pre>\n\n<p>For that, I created a slice of the type that I created above.</p>\n\n<pre><code>userslice := make([]keyvalue, 1, 1)\n</code></pre>\n\n<p>How will I append each users's parameters into the slice in each iteration? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2680, "user_id": 5556676, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/873efb3aa94e7f6805c489dcc0ebb57f?s=128&d=identicon&r=PG&f=1", "display_name": "init_js", "link": "https://stackoverflow.com/users/5556676/init-js"}, "edited": false, "score": 3, "creation_date": 1553712040, "post_id": 35401692, "comment_id": 97490669, "body": "As an aside, if you&#39;re using this to setup a dev environment, know that this installs the <code>godef</code> binary in <code>DIR&#47;bin&#47;</code>, where DIR is the first entry in your GOPATH. make sure that the corresponding <code>DIR&#47;bin</code> is also part of your shell&#39;s <code>PATH</code>. I had it already installed it in another folder covered by GOPATH (but outside my PATH), and <code>go get</code> is a no-op in that case."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 37, "last_activity_date": 1455511901, "creation_date": 1455511901, "answer_id": 35401692, "question_id": 35401625, "link": "https://stackoverflow.com/questions/35401625/where-to-get-godef-binary/35401692#35401692", "title": "Where to get godef binary?", "body": "<p>The current source for godef is at <a href=\"https://github.com/rogpeppe/godef\">https://github.com/rogpeppe/godef</a>. Use the following command to install godef:</p>\n\n<pre><code>go get github.com/rogpeppe/godef\n</code></pre>\n"}], "owner": {"reputation": 575, "user_id": 550324, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5450829d6fe4fdd97aa2f73fd6ae7b74?s=128&d=identicon&r=PG", "display_name": "Chao Sun", "link": "https://stackoverflow.com/users/550324/chao-sun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11383, "favorite_count": 2, "accepted_answer_id": 35401692, "answer_count": 1, "score": 13, "last_activity_date": 1556658850, "creation_date": 1455511412, "question_id": 35401625, "link": "https://stackoverflow.com/questions/35401625/where-to-get-godef-binary", "title": "Where to get godef binary?", "body": "<p>I'm trying to install godef binary using the command:</p>\n\n<pre><code>go get -v code.google.com/p/rog-go/exp/cmd/godef\n</code></pre>\n\n<p>However it keeps giving me error:</p>\n\n<pre><code>package code.google.com/p/rog-go/exp/cmd/godef: unable to detect version control system for code.google.com/ path\n</code></pre>\n\n<p>How do I install godef binary?</p>\n"}, {"tags": ["go", "cassandra", "gocql"], "answers": [{"tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 2, "last_activity_date": 1455518880, "creation_date": 1455518880, "answer_id": 35403086, "question_id": 35401344, "link": "https://stackoverflow.com/questions/35401344/passing-a-map-as-a-value-to-insert-into-cassandra/35403086#35403086", "title": "Passing a map as a value to insert into Cassandra", "body": "<p>I haven't used Go casandra client before but I guess passing map as a map instead of string should work:</p>\n\n<pre><code>mapValue := map[string]string{\"key\": \"value\"}\nif err := session.Query(\"INSERT INTO emergency_records (mapColumn) VALUES (?)\", mapValue).Exec(); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 3418145, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/25ef6e2115c78cfc748c186a1f57de62?s=128&d=identicon&r=PG&f=1", "display_name": "Joshua de Leon", "link": "https://stackoverflow.com/users/3418145/joshua-de-leon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 849, "favorite_count": 0, "accepted_answer_id": 35403086, "answer_count": 1, "score": 1, "last_activity_date": 1455518880, "creation_date": 1455509147, "question_id": 35401344, "link": "https://stackoverflow.com/questions/35401344/passing-a-map-as-a-value-to-insert-into-cassandra", "title": "Passing a map as a value to insert into Cassandra", "body": "<p>I'm trying to insert a map value into my Cassandra database. I'm using Go to write my client. Currently its throwing the error \"can not marshal string into map(varchar, varchar)\". I understand what the error is, but I can't resolve it. Here is the code that I've written. </p>\n\n<pre><code>if err := session.Query(\"INSERT INTO emergency_records\n        (mapColumn)\n        VALUES (?)\",\n        \"{'key' : 'value'}\").Exec();\n         err != nil {\n            log.Fatal(err)\n        }\n</code></pre>\n\n<p>What I don't get is that I've written one query as a whole unbroken string and it works fine without throwing this error. Yet breaking it down with the question mark it throws the error. I know this is something simple that I'm just overlooking and couldn't find in the documentation, but any help would be great thanks. </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1455518450, "post_id": 35400928, "comment_id": 58507433, "body": "OP: &quot;Golang newbie&quot;. You &quot; consider using Go&#39;s atomic memory primitives&quot;. Not good advice. From package atomic: &quot;These functions require great care to be used correctly&quot;."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1455505916, "creation_date": 1455505916, "answer_id": 35400928, "question_id": 35400859, "link": "https://stackoverflow.com/questions/35400859/make-variable-update-visible-to-other-go-routines/35400928#35400928", "title": "Make variable update visible to other go-routines", "body": "<p>If Java atomic variables would meet your needs in a Java app, then consider using Go's <a href=\"https://godoc.org/sync/atomic\" rel=\"nofollow\">atomic memory primitives</a> or the higher-level <a href=\"https://godoc.org/sync#Mutex\" rel=\"nofollow\">sync.Mutex</a> / <a href=\"https://godoc.org/sync#RWMutex\" rel=\"nofollow\">sync.RWMutex</a>.</p>\n\n<p>There's not enough information in the question to know if the application can be structured to make good use of channels.</p>\n"}, {"comments": [{"owner": {"reputation": 155, "user_id": 141123, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/a8a29651f8eabf0f1d0965f2b943f78f?s=128&d=identicon&r=PG", "display_name": "Felix", "link": "https://stackoverflow.com/users/141123/felix"}, "edited": false, "score": 0, "creation_date": 1455523814, "post_id": 35403159, "comment_id": 58509883, "body": "Thanks kostya, atomic.Value looks like the straightforward solution for me."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 2, "last_activity_date": 1455519557, "last_edit_date": 1455519557, "creation_date": 1455519243, "answer_id": 35403159, "question_id": 35400859, "link": "https://stackoverflow.com/questions/35400859/make-variable-update-visible-to-other-go-routines/35403159#35403159", "title": "Make variable update visible to other go-routines", "body": "<p>I agree with @Volker that atomic functions should be used with care however for this simple scenario using <a href=\"https://godoc.org/sync/atomic#Value\" rel=\"nofollow\">atomic.Value</a> is fairly straightforward:</p>\n\n<pre><code>var envVar atomic.Value\nenvVar.Store(\"\")\n\n...\n\n// in write goroutine:\nenvVar.Store(os.Getenv(\"ENVVAR\"))\n\n...\n\n// in read goroutine:\nv := envVar.Load().(string)\n</code></pre>\n"}], "owner": {"reputation": 155, "user_id": 141123, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/a8a29651f8eabf0f1d0965f2b943f78f?s=128&d=identicon&r=PG", "display_name": "Felix", "link": "https://stackoverflow.com/users/141123/felix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 472, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1455519557, "creation_date": 1455505392, "question_id": 35400859, "link": "https://stackoverflow.com/questions/35400859/make-variable-update-visible-to-other-go-routines", "title": "Make variable update visible to other go-routines", "body": "<p>Golang newbie. In my program, a back group go-routine check environment and update a variable periodically. This variable is used in http handler method servers client request. So basically it is kind of single value cache has one updater and many consumers.</p>\n\n<p>In language like Java, simply make this variable volatile could make sure updated value are visible to all those consumers. But since volatile is not an option in Go, what is the recommended solution here?</p>\n\n<p>RW lock could work, but it seems overkill for this simple scenario.</p>\n\n<p>Or this problem could be converted to communication via channel somehow?</p>\n"}, {"tags": ["ubuntu", "go"], "comments": [{"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1455502399, "post_id": 35400455, "comment_id": 58503125, "body": "<code>Getwd</code> is the working directory, not the directory containing the file that&#39;s the argument to <code>go run</code>.  It&#39;s the equivalent of executing <code>pwd</code> in your shell."}], "answers": [{"comments": [{"owner": {"reputation": 249, "user_id": 1099048, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1260843c6e5f21070791189681043525?s=128&d=identicon&r=PG", "display_name": "ranggadablues", "link": "https://stackoverflow.com/users/1099048/ranggadablues"}, "edited": false, "score": 0, "creation_date": 1455503171, "post_id": 35400526, "comment_id": 58503257, "body": "thanks for fast response. i have another OS installed on my PC, the other one is windows, when I called Getwd function the path is correctly to my GOPATH as i set already. ok I will try, thanks"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1455502952, "last_edit_date": 1455502952, "creation_date": 1455502549, "answer_id": 35400526, "question_id": 35400455, "link": "https://stackoverflow.com/questions/35400455/gopath-not-set-correctly/35400526#35400526", "title": "GOPATH not set correctly", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/os/\" rel=\"nofollow\">Package os</a></p>\n  \n  <p><a href=\"https://golang.org/pkg/os/#Getwd\" rel=\"nofollow\">func Getwd</a></p>\n\n<pre><code>func Getwd() (dir string, err error)\n</code></pre>\n  \n  <p>Getwd returns a rooted path name corresponding to the current\n  directory. If the current directory can be reached via multiple paths\n  (due to symbolic links), Getwd may return any one of them.</p>\n</blockquote>\n\n<pre><code>$ go run /home/rangga/go/src/Test/testpath.go\n$ /home/rangga\n</code></pre>\n\n<p>You got what you asked for, your current directory: <code>/home/rangga</code>.</p>\n\n<p>Change your current directory,</p>\n\n<pre><code>$ cd /home/rangga/go/src/Test/\n$ go run testpath.go\n$ /home/rangga/go/src/Test\n</code></pre>\n"}], "owner": {"reputation": 249, "user_id": 1099048, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1260843c6e5f21070791189681043525?s=128&d=identicon&r=PG", "display_name": "ranggadablues", "link": "https://stackoverflow.com/users/1099048/ranggadablues"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 446, "favorite_count": 2, "accepted_answer_id": 35400526, "answer_count": 1, "score": 0, "last_activity_date": 1561473507, "creation_date": 1455501920, "last_edit_date": 1459470505, "question_id": 35400455, "link": "https://stackoverflow.com/questions/35400455/gopath-not-set-correctly", "title": "GOPATH not set correctly", "body": "<p>i was installed go on xubuntu. after that iI change the GOPATH on</p>\n\n<pre><code>$ export GOPATH=$HOME/go\n$ echo $GOPATH\n$ /home/rangga/go\n</code></pre>\n\n<p>if I do go run</p>\n\n<pre><code>$ go run /home/rangga/go/src/Test/testpath.go\n$ /home/rangga\n</code></pre>\n\n<p>i used <code>os.Getwd()</code> for test the current path</p>\n\n<p>it should be the output like these <code>/home/rangga/go/src/Test</code></p>\n\n<p>FYI, here's my go env</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCHAR=\"6\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/rangga/go\"\nGORACE=\"\"\nGOROOT=\"/usr\"\nGOTOOLDIR=\"/usr/lib/gccgo/tool\"\nTERM=\"dumb\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-g -O2 -fPIC -m64 -pthread\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n\n<p>do i made wrong in export GOPATH?, please how to make the GOPATH is workable on go language?</p>\n\n<p>thank you</p>\n\n<p><strong>EDIT</strong>\nok, this is my mistake i should change to the current work directory after then do go run</p>\n\n<p>thanks to peterSO</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 6322903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de2151f4096fcc3bf643a87683dc8e6b?s=128&d=identicon&r=PG&f=1", "display_name": "mickep76", "link": "https://stackoverflow.com/users/6322903/mickep76"}, "edited": false, "score": 0, "creation_date": 1584951120, "post_id": 35410501, "comment_id": 107588121, "body": "There&#39;s a feature request for this <a href=\"https://github.com/golang/go/issues/12073\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/12073</a>"}, {"owner": {"reputation": 101, "user_id": 6322903, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de2151f4096fcc3bf643a87683dc8e6b?s=128&d=identicon&r=PG&f=1", "display_name": "mickep76", "link": "https://stackoverflow.com/users/6322903/mickep76"}, "edited": false, "score": 0, "creation_date": 1584952504, "post_id": 35410501, "comment_id": 107588627, "body": "This adds the missing code for the Go tabwriter from JuJu. <a href=\"https://github.com/juju/ansiterm\" rel=\"nofollow noreferrer\">github.com/juju/ansiterm</a>"}], "tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": true, "score": 4, "last_activity_date": 1455542588, "creation_date": 1455542588, "answer_id": 35410501, "question_id": 35398497, "link": "https://stackoverflow.com/questions/35398497/how-do-i-get-colors-to-work-with-golang-tabwriter/35410501#35410501", "title": "How do I get colors to work with golang tabwriter?", "body": "<h1>Short answer</h1>\n\n<p>You can't.</p>\n\n<h1>Naive answer</h1>\n\n<p>Use the <code>color.Color.SprintFunc()</code> method to get a function and wrap your strigns using this function.</p>\n\n<h1>Real answer</h1>\n\n<p>That won't work either, because the color is set using a special character sequence that isn't recognized by the <code>tabwriter</code>, so this row will be shorter by the length of twice the marker (one to set the color and one to get back to the standard color).</p>\n\n<h1>Solution</h1>\n\n<p>Write an alternative tabwriter (the algoerithm isn't even complex) that recognized the color character sequence and ignore it.</p>\n"}, {"tags": [], "owner": {"reputation": 2782, "user_id": 295163, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ac53c51514b817b9700be1dfc93e9be?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/295163/dave"}, "is_accepted": false, "score": 7, "last_activity_date": 1505348434, "creation_date": 1505348434, "answer_id": 46208644, "question_id": 35398497, "link": "https://stackoverflow.com/questions/35398497/how-do-i-get-colors-to-work-with-golang-tabwriter/46208644#46208644", "title": "How do I get colors to work with golang tabwriter?", "body": "<p>Despite what the accepted answer says, it is possible, you just have to be very careful about field length.</p>\n\n<p>Wrap each \"field\" (i.e. a specific row and column) with a color+reset code. If all codes are of the same string length, <code>tabwriter</code> will give you a good result.</p>\n\n<p>I have a crude demonstration here: <a href=\"https://play.golang.org/p/r6GNeV1gbH\" rel=\"noreferrer\">https://play.golang.org/p/r6GNeV1gbH</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/IJUO8.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/IJUO8.png\" alt=\"enter image description here\"></a></p>\n\n<p>I didn't do so in my demo, but you should also add the background codes as well (you can simply add them together as in <code>RedText + YellowBackground</code>), providing a default background. In this way, everything will be of equal length and you'll have background support as well.</p>\n\n<p>Please note that I am a beginner Go programmer. I don't claim that my code is any good.</p>\n"}], "owner": {"reputation": 1579, "user_id": 1354514, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e83e6f559891e7489995dfa43e010fa3?s=128&d=identicon&r=PG", "display_name": "steve landiss", "link": "https://stackoverflow.com/users/1354514/steve-landiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1919, "favorite_count": 2, "accepted_answer_id": 35410501, "answer_count": 2, "score": 7, "last_activity_date": 1505348434, "creation_date": 1455487004, "question_id": 35398497, "link": "https://stackoverflow.com/questions/35398497/how-do-i-get-colors-to-work-with-golang-tabwriter", "title": "How do I get colors to work with golang tabwriter?", "body": "<p>I am using the tabwriter and I cannot get it to work with colors.  I am using the \"github.com/fatih/color\" package.</p>\n\n<p>Basically the problem is that I need to call tabwriter's <code>w.Flush()</code> in order to get the colors to render... I cannot switch colors if I have not called a flush.</p>\n\n<p>Calling Flush in turn screws with the tabwriter formatting.</p>\n\n<p>Any ideas on how to combine the two?</p>\n\n<pre><code>    package main\n\n    import \"fmt\"\n    import \"text/tabwriter\"\n    import \"os\"\n    import \"github.com/fatih/color\"\n\n    func main() {\n        w := new(tabwriter.Writer)\n        w.Init(os.Stderr, 0, 8, 0, '\\t', 0)\n        color.Set(color.FgGreen)\n        fmt.Fprintln(w, \"ID\\tNAME\\tSIZE\\tFIELD1\\tSTATUS\\tSTATE\")\n        // ------&gt; Calling w.Flush() here cases problems.\n        color.Set(color.FgYellow)\n        fmt.Fprintln(w, \"8617833164795356724\\tfoo1\\t1.1 Gb\\t3\\tsome_status\\tsome_state\")\n        fmt.Fprintln(w) \n        w.Flush()\n    }\n</code></pre>\n"}, {"tags": ["linux", "time", "go", "multicore", "nanotime"], "comments": [{"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1455473878, "post_id": 35395092, "comment_id": 58494379, "body": "Which programming language (or Framework) are you talking about?"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1455482438, "creation_date": 1455482438, "answer_id": 35397730, "question_id": 35395092, "link": "https://stackoverflow.com/questions/35395092/does-system-nanotime-leap-back-or-forward/35397730#35397730", "title": "Does System.nanotime leap back or forward", "body": "<p>Go uses monotonic timers for Linux, FreeBSD, OpenBSD, DragonflyBSD, and Windows.</p>\n"}], "owner": {"reputation": 9547, "user_id": 46279, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/df9614769cb56c2cc06330efa2599e3f?s=128&d=identicon&r=PG", "display_name": "coder_bro", "link": "https://stackoverflow.com/users/46279/coder-bro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 1, "accepted_answer_id": 35397730, "answer_count": 1, "score": 1, "last_activity_date": 1455482438, "creation_date": 1455472426, "last_edit_date": 1455480141, "question_id": 35395092, "link": "https://stackoverflow.com/questions/35395092/does-system-nanotime-leap-back-or-forward", "title": "Does System.nanotime leap back or forward", "body": "<p>I found multiple (conflicting) sources on the internet about whether System.Nanotime does or does not \"leap back\\forward\"</p>\n\n<p>I found sources to indicate that clock resets do not affect System.nanotime.\nBut do server restarts change system.nanotime? \nAre there situations in which System.Nanotime does leap back or forward?</p>\n\n<p>To be specific: I will be using GO's Ticker which internally relies on nanotime</p>\n"}, {"tags": ["go", "websocket", "handshake", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 253, "user_id": 5719160, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/abd92cbc314012f263ee283c0fe8f323?s=128&d=identicon&r=PG&f=1", "display_name": "Kim Byer", "link": "https://stackoverflow.com/users/5719160/kim-byer"}, "edited": false, "score": 0, "creation_date": 1455457759, "post_id": 35392459, "comment_id": 58488855, "body": "I took a look at the <a href=\"https://github.com/gorilla/websocket/blob/master/conn.go#L823-L831\" rel=\"nofollow noreferrer\">implementation of ReadMessage</a> and for me at least doesn&#39;t seems to be sending any Close Frames to the connected endpoint."}, {"owner": {"reputation": 253, "user_id": 5719160, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/abd92cbc314012f263ee283c0fe8f323?s=128&d=identicon&r=PG&f=1", "display_name": "Kim Byer", "link": "https://stackoverflow.com/users/5719160/kim-byer"}, "edited": false, "score": 0, "creation_date": 1455457865, "post_id": 35392459, "comment_id": 58488889, "body": "By Starting the Closing Handshake I&#39;m referring to this <a href=\"https://tools.ietf.org/html/rfc6455#section-7.1.2\" rel=\"nofollow noreferrer\">section of the WebSocket RFC</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 253, "user_id": 5719160, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/abd92cbc314012f263ee283c0fe8f323?s=128&d=identicon&r=PG&f=1", "display_name": "Kim Byer", "link": "https://stackoverflow.com/users/5719160/kim-byer"}, "edited": false, "score": 0, "creation_date": 1455457946, "post_id": 35392459, "comment_id": 58488919, "body": "The method <a href=\"https://github.com/gorilla/websocket/blob/b824a5d8536651ad2d690c17e270d58855dbfd02/conn.go#L742\" rel=\"nofollow noreferrer\">handleProtocolError</a> sends the closing handshake."}, {"owner": {"reputation": 253, "user_id": 5719160, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/abd92cbc314012f263ee283c0fe8f323?s=128&d=identicon&r=PG&f=1", "display_name": "Kim Byer", "link": "https://stackoverflow.com/users/5719160/kim-byer"}, "edited": false, "score": 0, "creation_date": 1455458560, "post_id": 35392459, "comment_id": 58489099, "body": "Fine, this handles errors for when the frame being sent by the connected endpoint doesn&#39;t conform with the Web Socket spec. However if I closed the connection with Code 1000, I am responsible to implement the Closing Handshake. Or am I still wrong?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 253, "user_id": 5719160, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/abd92cbc314012f263ee283c0fe8f323?s=128&d=identicon&r=PG&f=1", "display_name": "Kim Byer", "link": "https://stackoverflow.com/users/5719160/kim-byer"}, "edited": false, "score": 0, "creation_date": 1455458789, "post_id": 35392459, "comment_id": 58489165, "body": "If the application decides to close the connection, then the application should start the closing handshake.  Gorilla starts the handshake on protocol errors and replies to the handshake from the peer application."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1455483432, "last_edit_date": 1455483432, "creation_date": 1455457238, "answer_id": 35392459, "question_id": 35391457, "link": "https://stackoverflow.com/questions/35391457/websocket-when-to-use-close-handshake/35392459#35392459", "title": "WebSocket When To Use Close Handshake", "body": "<p>Applications should only send close frames when the application decides to close the connection. The Gorilla package handles all other cases.</p>\n\n<p>The Gorilla package sends the closing handshake on read errors. The Gorilla internal method <a href=\"https://github.com/gorilla/websocket/blob/b824a5d8536651ad2d690c17e270d58855dbfd02/conn.go#L742\" rel=\"nofollow\"><code>handleProtocolError</code></a> starts the closing handshake.</p>\n\n<p>Gorilla <a href=\"https://github.com/gorilla/websocket/blob/b824a5d8536651ad2d690c17e270d58855dbfd02/conn.go#L729\" rel=\"nofollow\">replies to closing handshakes from the peer application</a>.</p>\n"}], "owner": {"reputation": 253, "user_id": 5719160, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/abd92cbc314012f263ee283c0fe8f323?s=128&d=identicon&r=PG&f=1", "display_name": "Kim Byer", "link": "https://stackoverflow.com/users/5719160/kim-byer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 489, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1457819300, "creation_date": 1455451036, "last_edit_date": 1457819300, "question_id": 35391457, "link": "https://stackoverflow.com/questions/35391457/websocket-when-to-use-close-handshake", "title": "WebSocket When To Use Close Handshake", "body": "<p>I'm experimenting with Gorilla WebSocket Package and I would like to know whether there is a way based on the error retrieved from <code>.ReadMessage</code> to determine whether to start the Closing Handshake (ex. 1000 - normal closure) or stop the connection immediately (ex. 1006 - abnormal closure).</p>\n\n<p>Currently what I'm doing is to store the list of error codes that I might use to close the websocket connection and if an error code is equals to one of the codes in my list, I do the Closing Handshake. However I'm not sure whether this complies with the WebSocket Spec.</p>\n\n<p>Is there another way to do this or this is how it is suppose to be done?</p>\n"}, {"tags": ["encoding", "go", "gob"], "comments": [{"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "edited": false, "score": 1, "creation_date": 1455474510, "post_id": 35391319, "comment_id": 58494576, "body": "Without doing totally unsafe things like using the <code>unsafe</code> package to call private methods on the decoder object, the answer is no - they&#39;d have to explicitly add support for this, as the current API doesn&#39;t allow for it."}], "owner": {"reputation": 1034, "user_id": 2089648, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8b29d87d89de9c1abac217464e57b191?s=128&d=identicon&r=PG", "display_name": "user2089648", "link": "https://stackoverflow.com/users/2089648/user2089648"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 372, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1455450054, "creation_date": 1455450054, "question_id": 35391319, "link": "https://stackoverflow.com/questions/35391319/golang-gob-type-of-next-variable", "title": "Golang Gob Type of next Variable", "body": "<p>When using golang -> encoding/gob, I want to determine the type of the next variable I am going to get.\nOne way of doing it, would be to alternate between an enum and the unknown variables, with the enum telling me what the next variable will be.</p>\n\n<p>However, the gob-stream already knows the type of the next variable.\n(Or at least it's name, which would be good enough for me.)\nAs can be seen in this example:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/gob\"\n    \"fmt\"\n    \"log\"\n)\n\ntype Vector struct {\n    X, Y, Z int\n}\n\nfunc main() {\n    var network bytes.Buffer // Stand-in for the network.\n    // Create an encoder and send a value.\n    enc := gob.NewEncoder(&amp;network)\n    err := enc.Encode(Vector{3, 4, 5})\n    if err != nil {\n        log.Fatal(\"encode:\", err)\n    }\n\n    // Create a decoder and receive a value.\n    dec := gob.NewDecoder(&amp;network)\n    var v interface{}\n    err = dec.Decode(&amp;v)\n    if err != nil {\n        // This will run, outputting:\n        // local interface type *interface {} can only be decoded from remote interface type; received concrete type Vector = struct { X int; Y int; Z int; }\n        log.Fatal(\"decode:\", err)\n    }\n    fmt.Println(v)\n}\n</code></pre>\n\n<p>It sees, that the next thing it gets has to be a struct with name vector and throws me an error.\nIs there a way to query the next type beforehead. (Again, without me explicitly sending it, in effect generating unnecessary overhead)</p>\n"}, {"tags": ["ssl", "go", "reverse-proxy"], "answers": [{"tags": [], "owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "is_accepted": true, "score": 4, "last_activity_date": 1455495524, "creation_date": 1455495524, "answer_id": 35399699, "question_id": 35390726, "link": "https://stackoverflow.com/questions/35390726/confirm-tls-certificate-while-performing-reverseproxy-in-golang/35399699#35399699", "title": "Confirm TLS certificate while performing ReverseProxy in GoLang", "body": "<p>To access the certificate, you will have get access to the <a href=\"https://golang.org/pkg/crypto/tls/#Conn.ConnectionState\" rel=\"nofollow\">ConnectionState</a>. The easiest way to do that is to provide your own version of <a href=\"https://golang.org/pkg/net/http/#Transport\" rel=\"nofollow\">DialTLS</a>. In there you connect to the server using <a href=\"https://golang.org/pkg/net/#Dial\" rel=\"nofollow\">net.Dial</a>, do the TLS handshake and then you are free to verify.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n)\n\nfunc main() {\n    proxy := httputil.NewSingleHostReverseProxy(&amp;url.URL{\n        Scheme: \"https\",\n        Host:   \"sha256.badssl.com\",\n    })\n\n    // Set a custom DialTLS to access the TLS connection state\n    proxy.Transport = &amp;http.Transport{DialTLS: dialTLS}\n\n    // Change req.Host so badssl.com host check is passed\n    director := proxy.Director\n    proxy.Director = func(req *http.Request) {\n        director(req)\n        req.Host = req.URL.Host\n    }\n\n    log.Fatal(http.ListenAndServe(\"127.0.0.1:3000\", proxy))\n}\n\nfunc dialTLS(network, addr string) (net.Conn, error) {\n    conn, err := net.Dial(network, addr)\n    if err != nil {\n        return nil, err\n    }\n\n    host, _, err := net.SplitHostPort(addr)\n    if err != nil {\n        return nil, err\n    }\n    cfg := &amp;tls.Config{ServerName: host}\n\n    tlsConn := tls.Client(conn, cfg)\n    if err := tlsConn.Handshake(); err != nil {\n        conn.Close()\n        return nil, err\n    }\n\n    cs := tlsConn.ConnectionState()\n    cert := cs.PeerCertificates[0]\n\n    // Verify here\n    cert.VerifyHostname(host)\n    log.Println(cert.Subject)\n\n    return tlsConn, nil\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3296, "user_id": 3086289, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VhG15.png?s=128&g=1", "display_name": "Sangam Belose", "link": "https://stackoverflow.com/users/3086289/sangam-belose"}, "edited": false, "score": 1, "creation_date": 1561724926, "post_id": 56806904, "comment_id": 100167822, "body": "Please add some more description around your answer. This will be helpful for future users."}], "tags": [], "owner": {"reputation": 21, "user_id": 8950865, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-D9s9BHG0E7U/AAAAAAAAAAI/AAAAAAAAAEI/kLtd8uvefLQ/photo.jpg?sz=128", "display_name": "Alexander Koch", "link": "https://stackoverflow.com/users/8950865/alexander-koch"}, "is_accepted": false, "score": 2, "last_activity_date": 1562235450, "last_edit_date": 1562235450, "creation_date": 1561724660, "answer_id": 56806904, "question_id": 35390726, "link": "https://stackoverflow.com/questions/35390726/confirm-tls-certificate-while-performing-reverseproxy-in-golang/56806904#56806904", "title": "Confirm TLS certificate while performing ReverseProxy in GoLang", "body": "<p>To tweak the SSL to the Reverse Host, it is possible to set the transport\noptions. So if you want to skip the verify you can set it like this.</p>\n\n<pre><code>proxy := httputil.NewSingleHostReverseProxy(&amp;url.URL{\n         Scheme: \"https\",\n         Host:   \"sha256.badssl.com\",\n})\n\nproxy.Transport = &amp;http.Transport{\n        TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},\n}\n\nhttp.ListenAndServe(\"127.0.0.1:80\", proxy)\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 2257892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a48f7d00bd5e6d39d8437edc70c9f?s=128&d=identicon&r=PG", "display_name": "user2257892", "link": "https://stackoverflow.com/users/2257892/user2257892"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5248, "favorite_count": 1, "accepted_answer_id": 35399699, "answer_count": 2, "score": 5, "last_activity_date": 1612353776, "creation_date": 1455445758, "last_edit_date": 1612353776, "question_id": 35390726, "link": "https://stackoverflow.com/questions/35390726/confirm-tls-certificate-while-performing-reverseproxy-in-golang", "title": "Confirm TLS certificate while performing ReverseProxy in GoLang", "body": "<p>In Go I'm using NewSingleHostReverseProxy to perform a reverse proxy, however I need to confirm the SSL certificates of the host site, to make sure I have the correct secure certificate... any ideas how I should do this? Should I be doing this with the handler or transport? I'm new to Go and still getting my head around it.</p>\n<pre><code>proxy := httputil.NewSingleHostReverseProxy(&amp;url.URL{\n         Scheme: &quot;https&quot;,\n         Host:   &quot;sha256.badssl.com&quot;,\n})\n\nhttp.ListenAndServe(&quot;127.0.0.1:80&quot;, proxy)\n</code></pre>\n"}, {"tags": ["algorithm", "go"], "answers": [{"comments": [{"owner": {"reputation": 581, "user_id": 5896062, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73b2c04c398d1678bba28f0ef427fac9?s=128&d=identicon&r=PG&f=1", "display_name": "Tbalz", "link": "https://stackoverflow.com/users/5896062/tbalz"}, "edited": false, "score": 0, "creation_date": 1455436087, "post_id": 35389499, "comment_id": 58482964, "body": "sure the file says 1 2 3 4 5"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 581, "user_id": 5896062, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73b2c04c398d1678bba28f0ef427fac9?s=128&d=identicon&r=PG&f=1", "display_name": "Tbalz", "link": "https://stackoverflow.com/users/5896062/tbalz"}, "edited": false, "score": 1, "creation_date": 1455471079, "post_id": 35389499, "comment_id": 58493389, "body": "@Tbalz, you&#39;re using <code>fmt.Fscanln</code> which reads the whole line at a time, he&#39;s using <code>fmt.Fscan</code>."}, {"owner": {"reputation": 581, "user_id": 5896062, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73b2c04c398d1678bba28f0ef427fac9?s=128&d=identicon&r=PG&f=1", "display_name": "Tbalz", "link": "https://stackoverflow.com/users/5896062/tbalz"}, "edited": false, "score": 0, "creation_date": 1455471342, "post_id": 35389499, "comment_id": 58493471, "body": "Ah I see that makes sense !"}], "tags": [], "owner": {"reputation": 651, "user_id": 621973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88f4ee43bc2722fdd9240db6da9c0b39?s=128&d=identicon&r=PG", "display_name": "foo", "link": "https://stackoverflow.com/users/621973/foo"}, "is_accepted": true, "score": 2, "last_activity_date": 1455437826, "last_edit_date": 1495539901, "creation_date": 1455435816, "answer_id": 35389499, "question_id": 35389257, "link": "https://stackoverflow.com/questions/35389257/golang-read-text-file-and-take-a-slice-from-one-of-the-read-in-values/35389499#35389499", "title": "Golang Read text file and take a slice from one of the read in values", "body": "<p>Your code worked fine in my test.  Likely the file is formatted slightly differently or is in a different location?</p>\n\n<pre><code>for {\n    var z int\n    var n int\n    n, err = fmt.Fscan(f, &amp;z)\n    if n == 0 || err != nil {\n        break\n    }\n    fmt.Println(\"int z :\", z)\n}\n</code></pre>\n\n<p>really, a variation of this question:\n<a href=\"https://stackoverflow.com/questions/3751429/reading-an-integer-from-standard-input-in-golang\">Reading an integer from standard input in Golang</a></p>\n"}], "owner": {"reputation": 581, "user_id": 5896062, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/73b2c04c398d1678bba28f0ef427fac9?s=128&d=identicon&r=PG&f=1", "display_name": "Tbalz", "link": "https://stackoverflow.com/users/5896062/tbalz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 1, "accepted_answer_id": 35389499, "answer_count": 1, "score": 0, "last_activity_date": 1455437826, "creation_date": 1455433595, "question_id": 35389257, "link": "https://stackoverflow.com/questions/35389257/golang-read-text-file-and-take-a-slice-from-one-of-the-read-in-values", "title": "Golang Read text file and take a slice from one of the read in values", "body": "<p>In my code below, I'm hoping to read a text file filled with a number 1-5 per line. I want it to scan the line and read one of values and see if its &lt; 6 and perform an action. Unfortunately I'm unable to take a slice of the values, they only print as an array. Any advice on how i can fix my code please?</p>\n\n<pre><code>//This is the part of the program that will read from a text file named \"file\"\n//To see what numbers were selected last time so the recipe for week two can be\n//a completely new recipe group of 5\nf, err := os.Open(\"file\")\nif err != nil {\n    fmt.Println(err)\n}\nfor {\n    var z int\n    var n int\n    n, err = fmt.Fscanln(f, &amp;z)\n    if n == 0 || err != nil {\n        break\n    }\n    fmt.Println(\"int z :\", z)\n}\n</code></pre>\n"}, {"tags": ["go", "dropbox-api"], "comments": [{"owner": {"reputation": 2958, "user_id": 3597730, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/d76b8f632aeb1d920d79d7dd5ab63097?s=128&d=identicon&r=PG", "display_name": "ruby_newbie", "link": "https://stackoverflow.com/users/3597730/ruby-newbie"}, "edited": false, "score": 0, "creation_date": 1455434979, "post_id": 35389062, "comment_id": 58482735, "body": "Go is usually really helpful in it&#39;s error messages so I am going go guess you have malformed Json.   Is the output of list valid json?"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 5921597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3582a2b9195a94875bd05483bd1de9a5?s=128&d=identicon&r=PG&f=1", "display_name": "DTaylor", "link": "https://stackoverflow.com/users/5921597/dtaylor"}, "edited": false, "score": 0, "creation_date": 1455478979, "post_id": 35389583, "comment_id": 58496958, "body": "That was it. Thanks!"}], "tags": [], "owner": {"reputation": 651, "user_id": 621973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88f4ee43bc2722fdd9240db6da9c0b39?s=128&d=identicon&r=PG", "display_name": "foo", "link": "https://stackoverflow.com/users/621973/foo"}, "is_accepted": true, "score": 1, "last_activity_date": 1455444518, "last_edit_date": 1455444518, "creation_date": 1455436494, "answer_id": 35389583, "question_id": 35389062, "link": "https://stackoverflow.com/questions/35389062/json-issue-in-getting-date-in-golang-dropbox-library/35389583#35389583", "title": "Json issue in getting date in golang dropbox library", "body": "<p>You want:</p>\n\n<pre><code>date, err := list.ClientMtime.MarshalJSON()\n</code></pre>\n\n<p><code>UnmarshalJson</code> goes the other way; <code>[]byte -&gt; DBTime</code> \nThat's why it's an end of input error, the <code>[]byte</code> is empty.</p>\n\n<p>Optionally, <code>ClientMTime</code> is a time. Time which has <code>String()</code> and <code>Format()</code> methods.</p>\n\n<p>You can access all the time formatting features by converting it.</p>\n\n<p>See: <a href=\"https://github.com/stacktic/dropbox/blob/master/dropbox.go#L158\" rel=\"nofollow\">https://github.com/stacktic/dropbox/blob/master/dropbox.go#L158</a></p>\n"}], "owner": {"reputation": 13, "user_id": 5921597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3582a2b9195a94875bd05483bd1de9a5?s=128&d=identicon&r=PG&f=1", "display_name": "DTaylor", "link": "https://stackoverflow.com/users/5921597/dtaylor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 35389583, "answer_count": 1, "score": 1, "last_activity_date": 1455444518, "creation_date": 1455431393, "question_id": 35389062, "link": "https://stackoverflow.com/questions/35389062/json-issue-in-getting-date-in-golang-dropbox-library", "title": "Json issue in getting date in golang dropbox library", "body": "<p>I'm writing a little program using the dropbox api to learn go. I'm using the client library here: <a href=\"https://github.com/stacktic/dropbox\" rel=\"nofollow\">https://github.com/stacktic/dropbox</a>. </p>\n\n<p>I'm able to upload and download a file so I know my api keys and what not are working correctly. Using the Metadata method I can get the metadata for a file. However, when I try to use the <a href=\"https://godoc.org/github.com/stacktic/dropbox#DBTime.UnmarshalJSON\" rel=\"nofollow\">UnmarshalJSON</a> method to get a human readable date from the ClientMtime item in the entry struct, I get \"unexpected end of JSON input\". Any ideas on what's the issue? </p>\n\n<p>The code I'm using is as follows:</p>\n\n<pre><code>func main() {\n\n  db := dropbox.NewDropbox()\n  db.SetAppInfo(\"Blah\", \"blah\")\n  db.SetAccessToken(\"Token\")\n  list,err := db.Metadata(\"/app_folder/test.jpg\", true, false, \"\", \"\", 1)\n\n  if err != nil {\n    log.Fatal(err)\n  }\n\n  var date []byte\n  err = list.ClientMtime.UnmarshalJSON(date)\n\n  if err != nil {\n    log.Fatal(err)\n  }\n\n  fmt.Printf(\"%v\", date)\n}\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1455428186, "last_edit_date": 1455428186, "creation_date": 1455427753, "answer_id": 35388687, "question_id": 35388559, "link": "https://stackoverflow.com/questions/35388559/golang-3-ways-to-create-a-new-instance-but-whats-the-difference-beginner/35388687#35388687", "title": "Golang: 3 ways to create a new instance but what&#39;s the difference? (Beginner)", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow\">Composite literals</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Allocation\" rel=\"nofollow\">Allocation</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Variable_declarations\" rel=\"nofollow\">Variable declarations</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow\">Short variable declarations</a></p>\n</blockquote>\n\n<pre><code>a := MyStruct {}  \nb := new(MyStruct) \nc := &amp;MyStruct {} \n</code></pre>\n\n<p><code>a</code> is a composite literal value. <code>b</code> is a pointer to a zero value for the type. <code>c</code> is a pointer to a composite literal value. <code>a</code> and <code>c</code> are very common. <code>b</code> is uncommon, in most cases, <code>c</code> is used.</p>\n\n<p>Take the <a href=\"http://tour.golang.org/welcome/1\" rel=\"nofollow\">Tour of Go</a> for examples.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1152113"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 1, "accepted_answer_id": 35388687, "answer_count": 1, "score": -1, "last_activity_date": 1455428186, "creation_date": 1455426413, "question_id": 35388559, "link": "https://stackoverflow.com/questions/35388559/golang-3-ways-to-create-a-new-instance-but-whats-the-difference-beginner", "title": "Golang: 3 ways to create a new instance but what&#39;s the difference? (Beginner)", "body": "<p>I'm new to Golang and from what I've learned so far there are 3 different ways to new up a struct: </p>\n\n<pre><code>a := MyStruct {}  // plain by value style. Is that what this is called?\nb := new(MyStruct) // using new\nc := &amp;MyStruct {} // using a reference\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/AEAn_JVbsv\" rel=\"nofollow\">Example</a></p>\n\n<p>I'm not clear as to the actual differences between each of these other then I've found that I have to add a reference <code>&amp;</code> symbol when printing the memory address of the object like this <code>fmt.Printf(\"%p\\n\", &amp;a)</code> when using the \"plain\" style vs <code>fmt.Printf(\"%p\\n\", b)</code> for the \"new\" and \"reference\" styles. My assumption is that this is because using the \"plain\" style allocates memory differently but this is just a guess. </p>\n\n<p>It appears that using the \"new\" and \"reference\" styles are equivalent options so choosing between those to is a stylistic decision? Is there an idiomatic preference in this language as to which method I should use? Are there other styles that I've not discovered yet? </p>\n"}, {"tags": ["unit-testing", "go", "assert"], "answers": [{"comments": [{"owner": {"reputation": 6509, "user_id": 356011, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d17ff41be1044be6fb5ef186b83efb20?s=128&d=identicon&r=PG", "display_name": "marathon", "link": "https://stackoverflow.com/users/356011/marathon"}, "edited": false, "score": 0, "creation_date": 1455473649, "post_id": 35391915, "comment_id": 58494309, "body": "Weird.   If I run just your file it works.  If I run your file via my make file with other tests, it fails with that error (which does come from assert.Contains).   Something in my environment must be getting corrupted either by the makefile or the other tests.   All the other assert.* functions work ok, though."}, {"owner": {"reputation": 9002, "user_id": 4509510, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mpfsBKz4Yjk/AAAAAAAAAAI/AAAAAAAAAGU/cLLwAFfWdUM/photo.jpg?sz=128", "display_name": "JesusTinoco", "link": "https://stackoverflow.com/users/4509510/jesustinoco"}, "reply_to_user": {"reputation": 6509, "user_id": 356011, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d17ff41be1044be6fb5ef186b83efb20?s=128&d=identicon&r=PG", "display_name": "marathon", "link": "https://stackoverflow.com/users/356011/marathon"}, "edited": false, "score": 0, "creation_date": 1455474857, "post_id": 35391915, "comment_id": 58494702, "body": "Could you provide us with your test file and the makefile? Just to reproduce it on our side."}, {"owner": {"reputation": 6509, "user_id": 356011, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d17ff41be1044be6fb5ef186b83efb20?s=128&d=identicon&r=PG", "display_name": "marathon", "link": "https://stackoverflow.com/users/356011/marathon"}, "edited": false, "score": 0, "creation_date": 1455478125, "post_id": 35391915, "comment_id": 58496681, "body": "get docker-machine from github and drop the test file into drivers/virtualbox.  Run <code>make test</code>.    <a href=\"https://github.com/docker/machine/blob/master/CONTRIBUTING.md\" rel=\"nofollow noreferrer\">github.com/docker/machine/blob/master/CONTRIBUTING.md</a>  I just double checked with a fresh copy off master to make sure I didn&#39;t introduce something.  Still fails."}], "tags": [], "owner": {"reputation": 9002, "user_id": 4509510, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mpfsBKz4Yjk/AAAAAAAAAAI/AAAAAAAAAGU/cLLwAFfWdUM/photo.jpg?sz=128", "display_name": "JesusTinoco", "link": "https://stackoverflow.com/users/4509510/jesustinoco"}, "is_accepted": true, "score": 6, "last_activity_date": 1455453894, "creation_date": 1455453894, "answer_id": 35391915, "question_id": 35387510, "link": "https://stackoverflow.com/questions/35387510/how-is-testify-assert-contains-used-with-a-map/35391915#35391915", "title": "How is testify/assert.Contains used with a map?", "body": "<p>I checked that and it works fine to me. Are you sure that the displayed error is related to that code? That's what I tried:</p>\n\n<pre><code>package main\n\nimport \"testing\"\nimport \"github.com/stretchr/testify/assert\"\n\nfunc TestContains(t *testing.T) {\n    mymap := map[string]string{}\n    mymap[\"Hello\"] = \"World\"\n    assert.Contains(t, mymap, \"Hello\")\n}\n</code></pre>\n\n<p>And the test doesn't fail:</p>\n\n<pre><code>\u2192 go test stackoverflow/35387510/contains_test.go\nok      command-line-arguments  0.009s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5920669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8bcdf545f89dd75bfb5d8fa7f5e1511?s=128&d=identicon&r=PG&f=1", "display_name": "Majid Syed", "link": "https://stackoverflow.com/users/5920669/majid-syed"}, "is_accepted": false, "score": 0, "last_activity_date": 1536338479, "creation_date": 1536338479, "answer_id": 52226592, "question_id": 35387510, "link": "https://stackoverflow.com/questions/35387510/how-is-testify-assert-contains-used-with-a-map/52226592#52226592", "title": "How is testify/assert.Contains used with a map?", "body": "<p>Looks like you must be using type assertion </p>\n\n<pre><code>package main\n\nimport \"testing\"\nimport \"github.com/stretchr/testify/assert\"\n\nfunc TestContains(t *testing.T) {\n     // Initialize assert as below\n    assert := assert.New(t)\n    mymap := map[string]string{}\n    mymap[\"Hello\"] = \"World\"\n    //then no need to pass t in contains\n    assert.Contains(mymap, \"Hello\")\n}\n</code></pre>\n\n<p>In <a href=\"https://godoc.org/github.com/stretchr/testify/assert\" rel=\"nofollow noreferrer\">docs</a> which for contains in type assertions</p>\n"}], "owner": {"reputation": 6509, "user_id": 356011, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d17ff41be1044be6fb5ef186b83efb20?s=128&d=identicon&r=PG", "display_name": "marathon", "link": "https://stackoverflow.com/users/356011/marathon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9088, "favorite_count": 0, "accepted_answer_id": 35391915, "answer_count": 2, "score": 4, "last_activity_date": 1536338479, "creation_date": 1455414445, "question_id": 35387510, "link": "https://stackoverflow.com/questions/35387510/how-is-testify-assert-contains-used-with-a-map", "title": "How is testify/assert.Contains used with a map?", "body": "<p>the <a href=\"https://godoc.org/github.com/stretchr/testify/assert#Contains\" rel=\"nofollow\">docs</a> show this as an example:</p>\n\n<p><code>assert.Contains(t, {\"Hello\": \"World\"}, \"Hello\", \"But {'Hello': 'World'} does contain 'Hello'\")</code></p>\n\n<p>But running this fails</p>\n\n<pre><code>mymap := map[string]string{}\nmymap[\"Hello\"] = \"World\"\nassert.Contains(t, mymap, \"Hello\")\n</code></pre>\n\n<p>results in the error:</p>\n\n<p><code>Error:     \"map[Hello:World]\" could not be applied builtin len()</code></p>\n\n<p>switching mymap and \"hello\" results in this:</p>\n\n<p><code>Error:     \"Hello\" does not contain \"map[Hello:World]\"</code></p>\n"}, {"tags": ["json", "go", "decode"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 3398940, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/16406ac47da87674b5ce8f203de8b5ec?s=128&d=identicon&r=PG&f=1", "display_name": "user3398940", "link": "https://stackoverflow.com/users/3398940/user3398940"}, "edited": false, "score": 0, "creation_date": 1455422090, "post_id": 35388079, "comment_id": 58480606, "body": "wow thank you very much I tried to figure it out whole day. This struc and json allways where hard for me :("}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1455421555, "last_edit_date": 1455421555, "creation_date": 1455420910, "answer_id": 35388079, "question_id": 35387215, "link": "https://stackoverflow.com/questions/35387215/decode-json-including-json-encoded-strings/35388079#35388079", "title": "decode json including json encoded strings", "body": "<p>The application is parsing data containing the substring <code>\"text\":\"&lt;a href=\"https</code>.  This is not valid JSON.  The error message is complaining about the <code>h</code> in <code>href</code>.</p>\n\n<p>Because the JSON value includes encoded JSON values, the application must decode in two steps:</p>\n\n<pre><code>type main struct {\n  Name string   `json:\"name\"`\n  Args []string `json:\"args\"`\n}\n\ntype arg struct {\n  Method string `json:\"method\"`\n  Params par    `json:\"params\"`\n}\ntype par struct {\n  Channel   string `json:\"channel,omitempty\"`\n  Name      string `json:\"name,omitempty\"`\n  NameColor string `json:\"nameColor,omitempty\"`\n  Text      string `json:\"text,omitempty\"`\n  Time      int64  `json:\"time,omitempty\"`\n}\n\nstr := `{\"name\":\"message\",\"args\":[\"{\\\"method\\\":\\\"chatMsg\\\",\\\"params\\\":{\\\"channel\\\":\\\"channel\\\",\\\"name\\\":\\\"name\\\",\\\"nameColor\\\":\\\"B5B11E\\\",\\\"text\\\":\\\"&lt;a href=\\\\\\\"https://play.spotify.com/browse\\\\\\\" target=\\\\\\\"_blank\\\\\\\"&gt;https://play.spotify.com/browse&lt;/a&gt;\\\",\\\"time\\\":1455397119}}\"]}`\nvar m main\nif err := json.Unmarshal([]byte(str), &amp;m); err != nil {\n    log.Fatal(err)\n}\nvar args arg\nif err := json.Unmarshal([]byte(m.Args[0]), &amp;args); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/oVC_IO-Pgy\" rel=\"nofollow\">playground example</a></p>\n"}], "owner": {"reputation": 95, "user_id": 3398940, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/16406ac47da87674b5ce8f203de8b5ec?s=128&d=identicon&r=PG&f=1", "display_name": "user3398940", "link": "https://stackoverflow.com/users/3398940/user3398940"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 35388079, "answer_count": 1, "score": 0, "last_activity_date": 1455913158, "creation_date": 1455411741, "last_edit_date": 1455913158, "question_id": 35387215, "link": "https://stackoverflow.com/questions/35387215/decode-json-including-json-encoded-strings", "title": "decode json including json encoded strings", "body": "<p>Hey guys I am getting websocket information from external Api and it's give me json response in this way:</p>\n\n<pre><code> `{\"name\":\"message\",\"args\":[\"{\\\"method\\\":\\\"chatMsg\\\",\\\"params\\\":{\\\"channel\\\":\\\"channel\\\",\\\"name\\\":\\\"name\\\",\\\"nameColor\\\":\\\"B5B11E\\\",\\\"text\\\":\\\"&lt;a href=\\\\\\\"https://play.spotify.com/browse\\\\\\\" target=\\\\\\\"_blank\\\\\\\"&gt;https://play.spotify.com/browse&lt;/a&gt;\\\",\\\"time\\\":1455397119}}\"]}`\n</code></pre>\n\n<p>I am putting it into this struc</p>\n\n<pre><code>type main struct {\n\nName string `json:\"name\"`\nArgs []arg  `json:\"args\"`\n}\n\ntype arg struct {\n    Method string`json:\"method\"`\n    Params par `json:\"params\"`\n}\ntype par struct {\n    Channel     string `json:\"channel,omitempty\"`\n    Name        string `json:\"name,omitempty\"`\n    NameColor   string `json:\"nameColor,omitempty\"`\n    Text        string `json:\"text,omitempty\"`\n    Time        int64  `json:\"time,omitempty\"`\n}\n</code></pre>\n\n<p>and decode it with code</p>\n\n<pre><code>sReplace := strings.NewReplacer(`\"{`, \"{\", `\"]`, \"]\", \"\\\\\", ``)\nstrN := sReplace.Replace(str)\nr := strings.NewReader(strN)\nd := json.NewDecoder(r)\nm := main{}\n</code></pre>\n\n<p>I am getting error </p>\n\n<pre><code>invalid character 'h' after object key:value pair\n</code></pre>\n\n<p>I know that the error is result of text field value. Is there any good way to clean it up or tell the decoder to ignore content of text field?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1455403257, "post_id": 35386151, "comment_id": 58476773, "body": "<code>func combatRound(ref p, ref e Character)  {</code> what is this <code>ref</code> business? Does it even compile?"}, {"owner": {"reputation": 187, "user_id": 4761444, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/05fada9fbff70555aaae8d89790bfb43?s=128&d=identicon&r=PG&f=1", "display_name": "nathan rogers", "link": "https://stackoverflow.com/users/4761444/nathan-rogers"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1455403477, "post_id": 35386151, "comment_id": 58476836, "body": "oh shit, that was something I was trying and forgot to change. sorry  fixed."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 1, "creation_date": 1455413361, "post_id": 35386151, "comment_id": 58479104, "body": "You&#39;d be better to name your interface <code>Attacker</code> then any <code>Character</code> that has an <code>Attack</code> function will satisfy it. I think you could even make a <code>AttackTarget</code> interface and then the <code>Attack</code> function would be <code>target.TakeDamage(c.atk)</code>. Then Characters, Objects, Traps, Boxes, whatever, can Attack and TakeDamage individually."}], "answers": [{"comments": [{"owner": {"reputation": 187, "user_id": 4761444, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/05fada9fbff70555aaae8d89790bfb43?s=128&d=identicon&r=PG&f=1", "display_name": "nathan rogers", "link": "https://stackoverflow.com/users/4761444/nathan-rogers"}, "edited": false, "score": 0, "creation_date": 1455422763, "post_id": 35386768, "comment_id": 58480717, "body": "I see what you did, and it&#39;s so much more legible and straightforward. I see what&#39;s happening now, and was able to fix my code. Can you explain real quick what is happening with  player, enemy = enemy, player? That&#39;s just reassigning the objects? without a temp variable? I&#39;m not following, sorry.  usually to swap you see something like        var temp = enemy       enemy = player       player = temp      it actually works this way in go? and where can i read more about what you are doing there?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 187, "user_id": 4761444, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/05fada9fbff70555aaae8d89790bfb43?s=128&d=identicon&r=PG&f=1", "display_name": "nathan rogers", "link": "https://stackoverflow.com/users/4761444/nathan-rogers"}, "edited": false, "score": 1, "creation_date": 1455425558, "post_id": 35386768, "comment_id": 58481157, "body": "@nathanrogers: For <code>player, enemy = enemy, player</code>, see my revised answer."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1455425860, "last_edit_date": 1455425860, "creation_date": 1455407670, "answer_id": 35386768, "question_id": 35386151, "link": "https://stackoverflow.com/questions/35386151/go-change-struct-property-values/35386768#35386768", "title": "Go change struct property values", "body": "<p>In Go, the parameters and receivers of a call to a function or method are always passed by value (by assignment).</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\ntype Attacker interface {\n    Attacks(a *Character)\n}\n\ntype Character struct {\n    Health, Attack int\n}\n\nfunc (c *Character) Attacks(a *Character) {\n    a.Health -= c.Attack\n}\n\nfunc combatRound(player, enemy *Character) {\n    if rand.Intn(100) &lt;= 30 {\n        player, enemy = enemy, player\n    }\n    player.Attacks(enemy)\n}\n\nfunc main() {\n    rand.Seed(time.Now().UnixNano())\n    p := &amp;Character{20, 5}\n    e := &amp;Character{20, 5}\n    combatRound(p, e)\n    fmt.Printf(\"Player Health: %d\\nEnemy Health: %d\\n\", p.Health, e.Health)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run attack.go\nPlayer Health: 20 \nEnemy Health: 15\n$ go run attack.go\nPlayer Health: 20 \nEnemy Health: 15\n$ go run attack.go\nPlayer Health: 15 \nEnemy Health: 20\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow\">Assignments</a></p>\n\n<pre><code>Assignment = ExpressionList assign_op ExpressionList .\n\nassign_op = [ add_op | mul_op ] \"=\" .\n</code></pre>\n  \n  <p>Each left-hand side operand must be addressable, a map index\n  expression, or (for = assignments only) the blank identifier. Operands\n  may be parenthesized.</p>\n  \n  <p>A tuple assignment assigns the individual elements of a multi-valued\n  operation to a list of variables. There are two forms. In the first,\n  the right hand operand is a single multi-valued expression such as a\n  function call, a channel or map operation, or a type assertion. The\n  number of operands on the left hand side must match the number of\n  values. For instance, if f is a function returning two values,</p>\n\n<pre><code>x, y = f()\n</code></pre>\n  \n  <p>assigns the first value to x and the second to y. In the second form,\n  the number of operands on the left must equal the number of\n  expressions on the right, each of which must be single-valued, and the\n  nth expression on the right is assigned to the nth operand on the\n  left:</p>\n\n<pre><code>one, two, three = '\u4e00', '\u4e8c', '\u4e09'\n</code></pre>\n  \n  <p>The assignment proceeds in two phases. First, the operands of index\n  expressions and pointer indirections (including implicit pointer\n  indirections in selectors) on the left and the expressions on the\n  right are all evaluated in the usual order. Second, the assignments\n  are carried out in left-to-right order.</p>\n\n<pre><code>a, b = b, a  // exchange a and b\n</code></pre>\n</blockquote>\n\n<p>The Go statement</p>\n\n<pre><code>player, enemy = enemy, player\n</code></pre>\n\n<p>is the second form of a tuple assignment. It's the idiomatic way to swap or exchange two values. The operands on the left and the expressions on the right are evaluated before the assignments take place. The compiler takes care of any temporary variables for you.</p>\n\n<p>In the <code>combatRound</code> function, for 31 out ot 100 (interval [0, 30] of [0, 100)) calls, on average, roles are reversed or swapped, the <code>enemy</code> (defender) repulses the <code>player</code> (attacker). Swapping the pointers to the <code>Characters</code> reflects the role reversal. and the player's health declines, not the enemy's.</p>\n"}], "owner": {"reputation": 187, "user_id": 4761444, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/05fada9fbff70555aaae8d89790bfb43?s=128&d=identicon&r=PG&f=1", "display_name": "nathan rogers", "link": "https://stackoverflow.com/users/4761444/nathan-rogers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 1, "accepted_answer_id": 35386768, "answer_count": 1, "score": 1, "last_activity_date": 1455425860, "creation_date": 1455402882, "last_edit_date": 1455408378, "question_id": 35386151, "link": "https://stackoverflow.com/questions/35386151/go-change-struct-property-values", "title": "Go change struct property values", "body": "<p><a href=\"http://openmymind.net/Things-I-Wish-Someone-Had-Told-Me-About-Go/\" rel=\"nofollow\">http://openmymind.net/Things-I-Wish-Someone-Had-Told-Me-About-Go/</a></p>\n\n<p>Trying to get my head around Go, still pretty new. I know refs and pointers in C and I can't seem to get it working in Go. I've read a number of articles on the issue, and still not really managing to understand and implement a solution. </p>\n\n<p>Characters have health and atk points.</p>\n\n<p>Chars can Attack(). </p>\n\n<p>Combat round calls Attack() on which Character can attack this round.</p>\n\n<p>Intent, when Attack() is called on Character, health is changed on another Character.</p>\n\n<p>Currently Health never changes on Characters. </p>\n\n<p>Can someone give me a concise example of how to change the values on objects around the RIGHT way?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\n//Character health + atk of\ntype Character struct {\n    Health, Atk int\n}\n\n//Attack ... Character can Attack\nfunc (c *Character) Attack(health, atk int) {\n    health -= atk\n}\n\n//CharacterInterface ... methods for characters\ntype CharacterInterface interface {\n    Attack(health, atk int)\n}\n\nfunc combatRound(p, e Character) {\n    whoAtks := rand.Intn(100)\n    if whoAtks &gt; 30 {\n        p.Attack(e.Health, p.Atk)\n        fmt.Println(p.Health)\n    } else {\n        e.Attack(p.Health, e.Atk)\n\n        fmt.Println(p.Health)\n    }\n}\n\nfunc main() {\n    //seed rand generator for the current run\n    rand.Seed(time.Now().UTC().UnixNano())\n    p := Character{20, 5}\n    e := Character{20, 5}\n    combatRound(p, e)\n    fmt.Println(\"Player Health: %d \\n Enemy Health: %d\", p.Health, e.Health)\n\n}\n</code></pre>\n"}, {"tags": ["c", "ruby", "linux", "bash", "go"], "comments": [{"owner": {"reputation": 95812, "user_id": 477037, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/dde78fe4cdc16eb855d68ff7a8cd017d?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/477037/stefan"}, "edited": false, "score": 0, "creation_date": 1455402086, "post_id": 35385952, "comment_id": 58476417, "body": "This looks like <a href=\"https://en.wikipedia.org/wiki/Ncurses\" rel=\"nofollow noreferrer\">ncurses</a>. Check out <a href=\"https://github.com/ruby/curses\" rel=\"nofollow noreferrer\">github.com/ruby/curses</a>"}, {"owner": {"reputation": 1686, "user_id": 3551483, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/I4c4V.png?s=128&g=1", "display_name": "Fang", "link": "https://stackoverflow.com/users/3551483/fang"}, "edited": false, "score": 0, "creation_date": 1455402307, "post_id": 35385952, "comment_id": 58476492, "body": "As Stefan mentioned, this is ncurses. There&#39;s also CDK which comes with some predefined widgets (check it out at <a href=\"http://invisible-island.net/cdk/\" rel=\"nofollow noreferrer\">invisible-island.net/cdk</a>). CDK is built on top of ncurses."}, {"owner": {"reputation": 14469, "user_id": 2191105, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/tPiCW.png?s=128&g=1", "display_name": "David Hoelzer", "link": "https://stackoverflow.com/users/2191105/david-hoelzer"}, "edited": false, "score": 1, "creation_date": 1455402547, "post_id": 35385952, "comment_id": 58476575, "body": "Actually, it&#39;s dialog."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "reply_to_user": {"reputation": 1686, "user_id": 3551483, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/I4c4V.png?s=128&g=1", "display_name": "Fang", "link": "https://stackoverflow.com/users/3551483/fang"}, "edited": false, "score": 0, "creation_date": 1455402560, "post_id": 35385952, "comment_id": 58476576, "body": "@Fang This dialog was made with a higher-level toolkit but I forgot its name."}, {"owner": {"reputation": 1686, "user_id": 3551483, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/I4c4V.png?s=128&g=1", "display_name": "Fang", "link": "https://stackoverflow.com/users/3551483/fang"}, "edited": false, "score": 0, "creation_date": 1455402605, "post_id": 35385952, "comment_id": 58476591, "body": "I wasn&#39;t aware of &quot;Dialog&quot;. Learn something new everyday :)"}], "answers": [{"tags": [], "owner": {"reputation": 14469, "user_id": 2191105, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/tPiCW.png?s=128&g=1", "display_name": "David Hoelzer", "link": "https://stackoverflow.com/users/2191105/david-hoelzer"}, "is_accepted": false, "score": 4, "last_activity_date": 1455638266, "last_edit_date": 1455638266, "creation_date": 1455402449, "answer_id": 35386083, "question_id": 35385952, "link": "https://stackoverflow.com/questions/35385952/how-to-write-a-text-mode-gui-in-linux/35386083#35386083", "title": "How to write a text mode gui in Linux?", "body": "<p>In the past this was known as \"Dialog,\" though as Thomas points out (as the maintainer of Dialog!!) this is no longer the case.  This is most likely the Newt library.  While you could certainly write something lower level using ncurses, Newt is available in Linux pretty much universally.  Dialog can also be installed under Linux.  You can read some basic documentation for it <a href=\"http://linuxcommand.org/lc3_adv_dialog.php\" rel=\"nofollow\">here</a>.</p>\n\n<p>Choosing to use this over a curses based approach allows you to focus on what it is you're actually looking to do rather than doing all of the work to build a UI.  If, however, you are really looking to build UI elements, <a href=\"http://invisible-island.net/ncurses/man/\" rel=\"nofollow\">ncurses</a> would be the way to go.</p>\n"}, {"comments": [{"owner": {"reputation": 32690, "user_id": 3266847, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/U0oyt.png?s=128&g=1", "display_name": "Benjamin W.", "link": "https://stackoverflow.com/users/3266847/benjamin-w"}, "edited": false, "score": 2, "creation_date": 1455408151, "post_id": 35386352, "comment_id": 58478041, "body": "Eh, I think it&#39;s allowed to mention that you&#39;re the maintainer of dialog, making this answer rather authoritative."}, {"owner": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "reply_to_user": {"reputation": 32690, "user_id": 3266847, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/U0oyt.png?s=128&g=1", "display_name": "Benjamin W.", "link": "https://stackoverflow.com/users/3266847/benjamin-w"}, "edited": false, "score": 1, "creation_date": 1455408755, "post_id": 35386352, "comment_id": 58478184, "body": "I suppose so, but the point is to provide information and show where the reader can learn more."}, {"owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "edited": false, "score": 0, "creation_date": 1455602951, "post_id": 35386352, "comment_id": 58549481, "body": "Thanks Thomas. I notice there&#39;s a Golang newt library at <a href=\"https://github.com/aklyachkin/go-newt\" rel=\"nofollow noreferrer\">github.com/aklyachkin/go-newt</a> which should make things easier."}], "tags": [], "owner": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "is_accepted": true, "score": 7, "last_activity_date": 1455406052, "last_edit_date": 1455406052, "creation_date": 1455404417, "answer_id": 35386352, "question_id": 35385952, "link": "https://stackoverflow.com/questions/35385952/how-to-write-a-text-mode-gui-in-linux/35386352#35386352", "title": "How to write a text mode gui in Linux?", "body": "<p>Actually, that is not <a href=\"http://invisible-island.net/dialog/dialog.html\">dialog</a>, but the newt library (there are a few differences in appearance).  It is used by <a href=\"https://fedoraproject.org/wiki/Anaconda\">anaconda</a> on Red Hat systems.  The whiptail program uses the library, however it has no real relationship to anaconda.</p>\n\n<p>Anaconda is mostly in Python; it uses the newt shared library (written in C) from a Python binding.</p>\n\n<p>For learning it... documentation is largely non-existent.  You have the source code.  </p>\n\n<p>Further reading:</p>\n\n<ul>\n<li><a href=\"http://invisible-island.net/dialog/dialog-figures.html\">screenshots for <strong>dialog</strong></a></li>\n<li><a href=\"https://git.fedorahosted.org/git/newt\">newt.git</a></li>\n<li><a href=\"https://github.com/rhinstaller/anaconda\">anaconda.git</a></li>\n<li><a href=\"http://www.thecodingforums.com/threads/any-examples-documentation-for-python-newt.718922/\">Any examples/documentation for python-newt</a> (discussion of newt vs documentation)</li>\n<li><a href=\"http://opensourceforu.efytimes.com/2011/11/spicing-up-console-for-fun-profit-2/\">Spicing up the Console for Fun and Profit, Part 2</a></li>\n</ul>\n"}], "owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1819, "favorite_count": 0, "closed_date": 1455746902, "accepted_answer_id": 35386352, "answer_count": 2, "score": 1, "last_activity_date": 1455638266, "creation_date": 1455401648, "question_id": 35385952, "link": "https://stackoverflow.com/questions/35385952/how-to-write-a-text-mode-gui-in-linux", "closed_reason": "Not suitable for this site", "title": "How to write a text mode gui in Linux?", "body": "<p>When I write scripts/programs, often I would like to pop up a simple text 'gui' to prompt for input:</p>\n\n<p><a href=\"https://i.stack.imgur.com/RPvZe.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/RPvZe.png\" alt=\"debian install screen\"></a></p>\n\n<p>How would I do this? For example from Shell, Ruby, Golang or C. I don't even know what this is called and Google isn't reponding to \"text thingy from scripts\".</p>\n\n<p>(The example is from the Debian installer).</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "edited": false, "score": 0, "creation_date": 1455401745, "post_id": 35385880, "comment_id": 58476321, "body": "You might get better answers, if you provide a minimal complete source file illustrating the problem, so that we don&#39;t need to guess what <code>mt</code> and <code>si</code> stand for."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 4256708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ca01180b910aac7a6e9ca8e68494163?s=128&d=identicon&r=PG&f=1", "display_name": "toastergod", "link": "https://stackoverflow.com/users/4256708/toastergod"}, "edited": false, "score": 0, "creation_date": 1455401858, "post_id": 35385954, "comment_id": 58476355, "body": "Ohp, yeah that fixed it. I assumed that since types have the brackets before the type name, it would be the same for variables. Thank you!"}], "tags": [], "owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "is_accepted": true, "score": 1, "last_activity_date": 1455401652, "creation_date": 1455401652, "answer_id": 35385954, "question_id": 35385880, "link": "https://stackoverflow.com/questions/35385880/go-why-does-my-for-loop-throw-unexpected-semi-colon-or-new-line/35385954#35385954", "title": "Go- Why Does My For Loop Throw &quot;Unexpected Semi-colon or New-line&quot;?", "body": "<p>Your loop has several problems:</p>\n\n<ol>\n<li>The use of square brackets is odd.  Outside of type definitions, these go after slice/array names, e.g. <code>x[i]</code> would give you the <em>i</em>th element of the slice <code>x</code>.</li>\n<li>There is no reference to <code>i</code> inside the loop body, and thus each iteration of the loop will do the same thing.</li>\n<li>You should probably write <code>output = output + ...</code> without the colon.  Otherwise, a new variable <code>output</code> is declared during each iteration of the loop, and forgotten immediately after so that the loop has no effect.</li>\n</ol>\n\n<p>The compiler error is probably caused by the first of these problems.</p>\n"}, {"tags": [], "owner": {"reputation": 490, "user_id": 3310759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/409b69c3ae7b431fc16129ccdadae9cd?s=128&d=identicon&r=PG", "display_name": "driusan", "link": "https://stackoverflow.com/users/3310759/driusan"}, "is_accepted": false, "score": 0, "last_activity_date": 1455401820, "creation_date": 1455401820, "answer_id": 35385980, "question_id": 35385880, "link": "https://stackoverflow.com/questions/35385880/go-why-does-my-for-loop-throw-unexpected-semi-colon-or-new-line/35385980#35385980", "title": "Go- Why Does My For Loop Throw &quot;Unexpected Semi-colon or New-line&quot;?", "body": "<p>You access an array with varname[idx] in Go, just like in most other languages. It's only when declaring a new array of type si that you use the [size]si prefix syntax. You're getting the error because your code is syntactically invalid. You're trying to compare i to an array of 0 si s.</p>\n"}], "owner": {"reputation": 11, "user_id": 4256708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ca01180b910aac7a6e9ca8e68494163?s=128&d=identicon&r=PG&f=1", "display_name": "toastergod", "link": "https://stackoverflow.com/users/4256708/toastergod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 35385954, "answer_count": 2, "score": 0, "last_activity_date": 1455401820, "creation_date": 1455401173, "question_id": 35385880, "link": "https://stackoverflow.com/questions/35385880/go-why-does-my-for-loop-throw-unexpected-semi-colon-or-new-line", "title": "Go- Why Does My For Loop Throw &quot;Unexpected Semi-colon or New-line&quot;?", "body": "<p>I'm writing a dice rolling function. In order to add the result of each die, I added to an output variable using a for loop. However, I'm getting an error thrown when I attempt to build;</p>\n\n<blockquote>\n  <p>syntax error: unexpected semicolon or newline, expecting {</p>\n</blockquote>\n\n<p>This was thrown on the line initializing the for loop.\nHere is my code:</p>\n\n<pre><code>    for i := 0; i &lt; [0]si; i++ {\n        output := output + mt.Intn([1]si)\n    }\n</code></pre>\n\n<p>si is simply an int array holding 2 values, and mt is the name I gave to math/rand when I imported it.</p>\n"}, {"tags": ["go", "parallel-processing", "goroutine"], "comments": [{"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1455390029, "post_id": 35384033, "comment_id": 58472534, "body": "Is it possible that the goroutines have to wait for some io? E.g reading data from the disk / db?"}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 2, "creation_date": 1455390495, "post_id": 35384033, "comment_id": 58472705, "body": "At least give us some code that behaves that way. Mathematical operation, long time, does not block - it doesn&#39;t mean anything in terms of CPU utilisation. There can be a million reasons why it doesn&#39;t perform like you want it to."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 6, "creation_date": 1455390611, "post_id": 35384033, "comment_id": 58472750, "body": "There&#39;s no point in guessing. Show us some code: <a href=\"http://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example.</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1455397823, "post_id": 35384033, "comment_id": 58475157, "body": "Use a separate rng for each goroutine, so that they&#39;re not all waiting for the same lock."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 5923235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2032e4c30fa077d3f1c244a3adf4ad0?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Johnson", "link": "https://stackoverflow.com/users/5923235/kevin-johnson"}, "edited": false, "score": 0, "creation_date": 1455406629, "post_id": 35386184, "comment_id": 58477658, "body": "Awesome, that did the trick.  Making a separate random number generator stopped each go routine from blocking on the global one.  Thank you very much."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1455412443, "post_id": 35386184, "comment_id": 58478928, "body": "&quot;there are lies, damn lies, and benchmarks&quot;. Let us not forget answers to support tickets, which depending on the situation are either worse or (slightly) better than benchmarks."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1455404921, "last_edit_date": 1495541735, "creation_date": 1455403158, "answer_id": 35386184, "question_id": 35384033, "link": "https://stackoverflow.com/questions/35384033/in-golang-my-go-routines-are-using-all-cores-but-only-between-50-and-75-of-eac/35386184#35386184", "title": "In golang my go routines are using all cores, but only between 50 and 75% of each core", "body": "<p>To paraphrase, there are lies, damn lies, and benchmarks.</p>\n\n<p>Despite being asked, you still haven't posted the code necessary to reproduce your issue: <a href=\"https://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example.</a></p>\n\n<p>Here's a reproducible benchmark, which uses a PRNG, that should drive your CPUs to close to 100%:</p>\n\n<pre><code>package main\n\nimport (\n    \"math/rand\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc DoSomeCPU(done &lt;-chan bool) {\n    r := rand.New(rand.NewSource(time.Now().UnixNano()))\n    k := 0\n    for i := 0; i &lt; 1000000; i++ {\n        j := i*i + 2\n        k += i * r.Intn(j)\n    }\n    _ = k\n    &lt;-done\n}\n\nfunc main() {\n    numCPU := runtime.NumCPU()\n    runtime.GOMAXPROCS(numCPU)\n    done := make(chan bool, 2*numCPU)\n    for {\n        done &lt;- true\n        go DoSomeCPU(done)\n    }\n}\n</code></pre>\n\n<p>What results do you get when you run this code?</p>\n"}, {"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 1, "last_activity_date": 1455427643, "creation_date": 1455427643, "answer_id": 35388675, "question_id": 35384033, "link": "https://stackoverflow.com/questions/35384033/in-golang-my-go-routines-are-using-all-cores-but-only-between-50-and-75-of-eac/35388675#35388675", "title": "In golang my go routines are using all cores, but only between 50 and 75% of each core", "body": "<p>The main reason is, the global <code>rand.*</code> uses a mutex, so at any given point, you can only generate one random number at a time.</p>\n\n<p>The reason @peterSO's answer works is because there's no mutex now and it's 1 generator per routine, however you can end up with duplicate state if 2 or more goroutines start at the exact nano second, although unlikely.</p>\n\n<p>Look <a href=\"https://golang.org/src/math/rand/rand.go#L233\" rel=\"nofollow\">here</a> to see how the global rand works under the hood.</p>\n"}], "owner": {"reputation": 11, "user_id": 5923235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2032e4c30fa077d3f1c244a3adf4ad0?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Johnson", "link": "https://stackoverflow.com/users/5923235/kevin-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1455427643, "creation_date": 1455389926, "last_edit_date": 1455398788, "question_id": 35384033, "link": "https://stackoverflow.com/questions/35384033/in-golang-my-go-routines-are-using-all-cores-but-only-between-50-and-75-of-eac", "title": "In golang my go routines are using all cores, but only between 50 and 75% of each core", "body": "<p>I am using version go1.5.3 linux/amd64 of the go language.  I have a go routine that performs a mathematical operation that takes some time.  Each go routine acts independently and does not have to block.</p>\n\n<p>My systems has 12 cores.  If I spawn 12 go routines, it only takes the average use of all cores up to 31%.  If I use 24 go routines, it brings the average use of all cores up to 49%.  If I use 240, i get 77%.  2400 gives me 76%.</p>\n\n<p>Apparently, the rand.Intn(j) operation is what is slowing it down.  Without it, the cores will run at 100%.  </p>\n\n<pre><code>func DoSomeMath() int {\n    k := 0\n    for i := 0; i &lt; 1000; i++ {\n        j := i*i + 2\n        k += i * rand.Intn(j)\n    }\n    return k\n}\n</code></pre>\n\n<p>How can I get the program to use all the cores at 100% while using an RNG?</p>\n"}, {"tags": ["postgresql", "go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "edited": false, "score": 0, "creation_date": 1456101966, "post_id": 35388503, "comment_id": 58776988, "body": "stupid follow-up: how do I then iterate through my rows (like I do in Python):  for d in mylist:     dict_writer = csv.DictWriter(p.stdin, keys, quoting=csv.QUOTE_MINIMAL)     dict_writer.writerow(d)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "edited": false, "score": 0, "creation_date": 1456172544, "post_id": 35388503, "comment_id": 58814287, "body": "The Bulk Imports in lib/pq is really slow. It seems to do a round-trip to the DB for each row."}, {"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1456189500, "post_id": 35388503, "comment_id": 58821973, "body": "You can use the multi-row format of INSERT to improve performance. Say 50 rows at a time to start. Just build up the SQL as a string."}], "tags": [], "owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "is_accepted": true, "score": 2, "last_activity_date": 1455425848, "creation_date": 1455425848, "answer_id": 35388503, "question_id": 35383998, "link": "https://stackoverflow.com/questions/35383998/how-do-i-import-rows-to-postgresql-from-stdin/35388503#35388503", "title": "How do I import rows to Postgresql from STDIN?", "body": "<p>The following code should point you in the direction you want to go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n    \"strings\"\n)\n\nfunc main() {\n    keys := []string{\"customer\"}\n    sqlCmd := fmt.Sprintf(\"COPY tester(%s) FROM STDIN (FORMAT CSV)\", strings.Join(keys, \",\"))\n    cmd := exec.Command(\"psql\", \"&lt;dbname&gt;\", \"-U\", \"&lt;username&gt;\", \"-h\", \"&lt;host_ip&gt;\", \"--no-password\", \"-c\", sqlCmd)\n    cmd.Stdin = os.Stdin\n    output, _ := cmd.CombinedOutput()\n    log.Println(string(output))\n}\n</code></pre>\n\n<p>If the keys need to be dynamic you can harvest them from <code>os.Args</code>.</p>\n\n<p>Please note that if you plan to use the psql command then you don't need to import database/sql or lib/pq. If you are interested in using lib/pq then have a look at <a href=\"https://godoc.org/github.com/lib/pq#hdr-Bulk_imports\" rel=\"nofollow\">Bulk Imports</a> in the lib/pq documentation.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "edited": false, "score": 0, "creation_date": 1456420685, "post_id": 35630126, "comment_id": 58949633, "body": "That makes a round trip to the db for each row, which slows it down significantly."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1456421402, "post_id": 35630126, "comment_id": 58950109, "body": "@kristen Actually if you look at <a href=\"https://github.com/lib/pq/blob/fde2b33cb1c820fbd3ff19eb9414be2d86b1bd12/copy.go#L203\" rel=\"nofollow noreferrer\">the code</a> you&#39;ll notice that there is a buffer, so it doesn&#39;t round trip to the DB for <i>each</i> row."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "edited": false, "score": 0, "creation_date": 1456423246, "post_id": 35630126, "comment_id": 58951272, "body": "Whatever it does it seems really slow."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "edited": false, "score": 0, "creation_date": 1456423310, "post_id": 35630126, "comment_id": 58951315, "body": "The edit I have made would be faster since it doesn&#39;t have that buffer"}, {"owner": {"reputation": 1410, "user_id": 1662069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/076911833bf08bdd287142c5e26b833c?s=128&d=identicon&r=PG", "display_name": "Zangetsu", "link": "https://stackoverflow.com/users/1662069/zangetsu"}, "edited": false, "score": 0, "creation_date": 1507571078, "post_id": 35630126, "comment_id": 80253250, "body": "Getting <code>pq: syntax error at or near &quot;STDIN&quot;</code> for <code>tx.Prepare(pq.CopyIn(...))</code>"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 3, "last_activity_date": 1456410607, "creation_date": 1456410607, "answer_id": 35630126, "question_id": 35383998, "link": "https://stackoverflow.com/questions/35383998/how-do-i-import-rows-to-postgresql-from-stdin/35630126#35630126", "title": "How do I import rows to Postgresql from STDIN?", "body": "<p>The <code>github.com/lib/pq</code> package docs actually have <a href=\"https://godoc.org/github.com/lib/pq#hdr-Bulk_imports\" rel=\"nofollow\">an example</a> of how to do what you want. Here is the adapted text of the whole program:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"log\"\n\n    \"github.com/lib/pq\"\n)\n\nfunc main() {\n    records := [][]string{\n        {\"Rob\", \"Pike\"},\n        {\"Ken\", \"Thompson\"},\n        {\"Robert\", \"Griesemer\"},\n    }\n\n    db, err := sql.Open(\"postgres\", \"dbname=postgres user=postgres password=postgres\")\n    if err != nil {\n        log.Fatalf(\"open: %v\", err)\n    }\n    if err = db.Ping(); err != nil {\n        log.Fatalf(\"open ping: %v\", err)\n    }\n    defer db.Close()\n\n    txn, err := db.Begin()\n    if err != nil {\n        log.Fatalf(\"begin: %v\", err)\n    }\n\n    stmt, err := txn.Prepare(pq.CopyIn(\"test\", \"first_name\", \"last_name\"))\n    if err != nil {\n        log.Fatalf(\"prepare: %v\", err)\n    }\n\n    for _, r := range records {\n        _, err = stmt.Exec(r[0], r[1])\n        if err != nil {\n            log.Fatalf(\"exec: %v\", err)\n        }\n    }\n\n    _, err = stmt.Exec()\n    if err != nil {\n        log.Fatalf(\"exec: %v\", err)\n    }\n\n    err = stmt.Close()\n    if err != nil {\n        log.Fatalf(\"stmt close: %v\", err)\n    }\n\n    err = txn.Commit()\n    if err != nil {\n        log.Fatalf(\"commit: %v\", err)\n    }\n}\n</code></pre>\n\n<p>On my machine this imports 1 000 000 records in about 2 seconds.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2314, "favorite_count": 3, "accepted_answer_id": 35388503, "answer_count": 2, "score": 3, "last_activity_date": 1456410607, "creation_date": 1455389721, "last_edit_date": 1456201296, "question_id": 35383998, "link": "https://stackoverflow.com/questions/35383998/how-do-i-import-rows-to-postgresql-from-stdin", "title": "How do I import rows to Postgresql from STDIN?", "body": "<p>In Python I have the following that will bulk-load rows to Postgresql without using a file:</p>\n\n<pre><code>import csv\nimport subprocess\n\nmylist, keys = [{'name': 'fred'}, {'name': 'mary'}], ['name']\np = subprocess.Popen(['psql', 'mydb', '-U', 'openupitsme', '-h', 'my.ip.address', '--no-password', '-c',\n    '\\COPY tester(%s) FROM STDIN (FORMAT CSV)' % ', '.join(keys),\n    '--set=ON_ERROR_STOP=false'\n    ], stdin=subprocess.PIPE\n)\nfor d in mylist:\n    dict_writer = csv.DictWriter(p.stdin, keys, quoting=csv.QUOTE_MINIMAL)\n    dict_writer.writerow(d)\np.stdin.close()\n</code></pre>\n\n<p>I am trying to accomplish the same in Go. I am currently writing the rows to a file then importing them and then deleting that file. I'd like to import the rows from STDIN like I do in Python. I have:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n\n    _ \"github.com/lib/pq\"\n)\n\nvar (\n    err error\n    db  *sql.DB\n)\n\nfunc main() {\n    var err error\n    fh := \"/path/to/my/file.txt\"\n    f, err := os.Create(fh)\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n    defer os.Remove(fh)\n    rows := []string{\"fred\", \"mary\"}\n    for _, n := range rows {\n        _, err = f.WriteString(n + \"\\n\")\n        if err != nil {\n            panic(err)\n        }\n    }\n    // dump to postgresql\n    c := exec.Command(\"psql\", \"mydb\", \"-U\", \"openupitsme\", \"-h\", \"my.ip.address\", \"--no-password\",\n        \"-c\", `\\COPY tester(customer) FROM `+fh)\n    if out, err := c.CombinedOutput(); err != nil {\n        log.Println(string(out), err)\n    }\n}\n</code></pre>\n\n<p>EDIT:\nA bit further along but this is not inserting records:</p>\n\n<pre><code>    keys := []string{\"link\", \"domain\"}\n    records := [][]string{\n        {\"first_name\", \"last_name\"},\n        {\"Rob\", \"Pike\"},\n        {\"Ken\", \"Thompson\"},\n        {\"Robert\", \"Griesemer\"},\n    }\n\n    cmd := exec.Command(\"psql\")\n    stdin, err := cmd.StdinPipe()\n    if err != nil {\n        log.Println(err)\n    }\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        log.Println(err)\n    }\n    if err := cmd.Start(); err != nil {\n        log.Println(err)\n    }\n    go func() {\n        _, err = io.WriteString(stdin, \"search -U meyo -h 1.2.3.4 -p 1111 --no-password -c \")\n        if err != nil {\n            log.Println(err)\n        }\n        _, err := io.WriteString(stdin, fmt.Sprintf(\"COPY links(%s) FROM STDIN (FORMAT CSV)\", strings.Join(keys, \",\")))\n        if err != nil {\n            log.Println(err)\n        }\n        w := csv.NewWriter(stdin)\n        if err := w.WriteAll(records); err != nil {\n            log.Fatalln(\"error writing record to csv:\", err)\n        }\n        w.Flush()\n        if err := w.Error(); err != nil {\n            log.Fatal(err)\n        }\n        if err != nil {\n            log.Println(err)\n        }\n        stdin.Close()\n    }()\n\n    done := make(chan bool)\n    go func() {\n        _, err := io.Copy(os.Stdout, stdout)\n        if err != nil {\n            log.Fatal(err)\n        }\n        stdout.Close()\n        done &lt;- true\n    }()\n    &lt;-done\n\n    if err := cmd.Wait(); err != nil {\n        log.Println(err, cmd.Args, stdout)\n    }\n</code></pre>\n\n<p>No records are inserted and I get a non-helpful error:</p>\n\n<pre><code>exit status 2\n</code></pre>\n"}, {"tags": ["file", "csv", "go"], "comments": [{"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 1, "creation_date": 1455370724, "post_id": 35379958, "comment_id": 58465921, "body": "There is no way to directly jump to a line without iteration. It is possible to jump to an offset (byte length) with <code>Seek()</code> and <code>ReadAt()</code> though. Why not read the input file line by line and write those lines to a new file, while ignoring the ones that match your substring?"}], "answers": [{"comments": [{"owner": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1455377509, "post_id": 35381272, "comment_id": 58468293, "body": "Thanks.  Textarea&#39;s are not my preferred IDE :)."}, {"owner": {"reputation": 1180, "user_id": 2857193, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1PnWH.jpg?s=128&g=1", "display_name": "James Tan", "link": "https://stackoverflow.com/users/2857193/james-tan"}, "edited": false, "score": 0, "creation_date": 1537637144, "post_id": 35381272, "comment_id": 91860394, "body": "what if some line contains \\r\\n ?"}], "tags": [], "owner": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "is_accepted": false, "score": 0, "last_activity_date": 1455375610, "last_edit_date": 1455375610, "creation_date": 1455374763, "answer_id": 35381272, "question_id": 35379958, "link": "https://stackoverflow.com/questions/35379958/jump-to-specific-line-in-file-in-go/35381272#35381272", "title": "Jump to specific line in file in Go", "body": "<p>Based on my read of the linecache module it takes a file and explodes it into an array based on '\\n' line endings. You could replicate the same behavior in Go by using <a href=\"https://golang.org/pkg/strings/\" rel=\"nofollow\">strings</a> or <a href=\"https://golang.org/pkg/bytes/#Split\" rel=\"nofollow\">bytes</a>.  You could also use the <a href=\"https://golang.org/pkg/bufio/#example_Scanner_lines\" rel=\"nofollow\">bufio</a> library to read a file a line by line and only store or save the lines you want.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n)\nimport \"io/ioutil\"\n\nfunc main() {\n\n    b, e := ioutil.ReadFile(\"filename.txt\")\n    if e != nil {\n        panic(e)\n    }\n    array := bytes.Split(b, []byte(\"\\n\"))\n\n    fmt.Printf(\"%v\", array)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 51, "user_id": 1922054, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2d463aa207571bd3b09740eeb9ea602?s=128&d=identicon&r=PG", "display_name": "james tan", "link": "https://stackoverflow.com/users/1922054/james-tan"}, "edited": false, "score": 2, "creation_date": 1537637083, "post_id": 35383125, "comment_id": 91860380, "body": "this isn&#39;t memory efficient"}], "tags": [], "owner": {"reputation": 9002, "user_id": 4509510, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mpfsBKz4Yjk/AAAAAAAAAAI/AAAAAAAAAGU/cLLwAFfWdUM/photo.jpg?sz=128", "display_name": "JesusTinoco", "link": "https://stackoverflow.com/users/4509510/jesustinoco"}, "is_accepted": true, "score": 0, "last_activity_date": 1455385214, "creation_date": 1455385214, "answer_id": 35383125, "question_id": 35379958, "link": "https://stackoverflow.com/questions/35379958/jump-to-specific-line-in-file-in-go/35383125#35383125", "title": "Jump to specific line in file in Go", "body": "<p>I wrote a small function that allowing you remove from a file a specific line.</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"os\"\n    \"strings\"\n)\n\nfunc main() {\n    path := \"path/to/file.txt\"\n    removeLine(path, 2)\n}\n\nfunc removeLine(path string, lineNumber int) {\n    file, err := ioutil.ReadFile(path)\n    if err != nil {\n        panic(err)\n    }\n\n    info, _ := os.Stat(path)\n    mode := info.Mode()\n\n    array := strings.Split(string(file), \"\\n\")\n    array = append(array[:lineNumber], array[lineNumber+1:]...)\n    ioutil.WriteFile(path, []byte(strings.Join(array, \"\\n\")), mode)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 6883043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea0dbf4004088d28836e2632789dade7?s=128&d=identicon&r=PG&f=1", "display_name": "StoicPerlman", "link": "https://stackoverflow.com/users/6883043/stoicperlman"}, "is_accepted": false, "score": 1, "last_activity_date": 1513951647, "creation_date": 1513951647, "answer_id": 47942862, "question_id": 35379958, "link": "https://stackoverflow.com/questions/35379958/jump-to-specific-line-in-file-in-go/47942862#47942862", "title": "Jump to specific line in file in Go", "body": "<p>This is an old question, but if anyone is looking for a solution I wrote a package that handles going to any line in a file. <a href=\"https://github.com/StoicPerlman/fls\" rel=\"nofollow noreferrer\">Link here</a>. It can open a file and seek to any line position without reading the whole file into memory and splitting. </p>\n\n<pre><code>import \"github.com/stoicperlman/fls\"\n\n// This is just a wrapper around os.OpenFile. Alternatively \n// you could open from os.File and use fls.LineFile(file) to get f\nf, err := fls.OpenFile(\"test.log\", os.O_CREATE|os.O_WRONLY, 0600)\ndefer f.Close()\n\n// return begining line 1/begining of file\n// equivalent to f.Seek(0, io.SeekStart)\npos, err := f.SeekLine(0, io.SeekStart)\n\n// return begining line 2\npos, err := f.SeekLine(1, io.SeekStart)\n\n// return begining of last line\npos, err := f.SeekLine(0, io.SeekEnd) \n\n// return begining of second to last line\npos, err := f.SeekLine(-1, io.SeekEnd) \n</code></pre>\n\n<p>Unfortunately I'm not sure how you would delete, this just handles getting you to the correct position in the file. For your case you could use it to go to the line you want to delete and save the position. Then seek to the next line and save that as well. You now have the bookends of the line to delete.</p>\n\n<pre><code>// might want lineToDelete - 1\n// this acts like 0 based array\npos1, err := f.SeekLine(lineToDelete, io.SeekStart)\n\n// skip ahead 1 line\npos2, err := f.SeekLine(1, io.SeekCurrent)\n\n// pos2 will be the position of the first character in next line\n// might want pos2 - 1 depending on how the function works\nDeleteBytesFromFileFunction(f, pos1, pos2)\n</code></pre>\n"}], "owner": {"reputation": 223, "user_id": 3502035, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/1918db6efe80204a2a26c8ef590e9c04?s=128&d=identicon&r=PG&f=1", "display_name": "user3502035", "link": "https://stackoverflow.com/users/3502035/user3502035"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2717, "favorite_count": 0, "accepted_answer_id": 35383125, "answer_count": 3, "score": 3, "last_activity_date": 1513951647, "creation_date": 1455367241, "question_id": 35379958, "link": "https://stackoverflow.com/questions/35379958/jump-to-specific-line-in-file-in-go", "title": "Jump to specific line in file in Go", "body": "<p>In Go is it possible to jump to particular line number in a file and delete it? Something like <a href=\"http://docs.python.org/library/linecache.html?highlight=linecache#module-linecache\" rel=\"nofollow\">linecache</a> in python.</p>\n\n<p>I'm trying to match some substrings in a file and remove the corresponding lines. The matching part I've taken care of and I have an array with line numbers I need to delete but I'm stuck on how to delete the matching lines in the file.</p>\n"}, {"tags": ["go", "runtime-error", "goroutine"], "comments": [{"owner": {"reputation": 1218, "user_id": 3238659, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XTCTW.png?s=128&g=1", "display_name": "asadmshah", "link": "https://stackoverflow.com/users/3238659/asadmshah"}, "edited": false, "score": 0, "creation_date": 1455365989, "post_id": 35379378, "comment_id": 58464351, "body": "Looks like your channel passed into <code>receiveWork</code> never closes. You need to make sure it closes in order for the for loop to end."}, {"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "reply_to_user": {"reputation": 1218, "user_id": 3238659, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XTCTW.png?s=128&g=1", "display_name": "asadmshah", "link": "https://stackoverflow.com/users/3238659/asadmshah"}, "edited": false, "score": 0, "creation_date": 1455366128, "post_id": 35379378, "comment_id": 58464411, "body": "It ends up, in main function, when all goroutines done their work, and writing to the out channel is finished."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 30, "last_activity_date": 1455367012, "creation_date": 1455367012, "answer_id": 35379919, "question_id": 35379378, "link": "https://stackoverflow.com/questions/35379378/go-assignment-to-entry-in-nil-map/35379919#35379919", "title": "Go : assignment to entry in nil map", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Map_types\">Map types</a></p>\n  \n  <p>A new, empty map value is made using the built-in function make, which\n  takes the map type and an optional capacity hint as arguments:</p>\n\n<pre><code>make(map[string]int)\nmake(map[string]int, 100)\n</code></pre>\n  \n  <p>The initial capacity does not bound its size: maps grow to accommodate\n  the number of items stored in them, with the exception of nil maps. A\n  nil map is equivalent to an empty map except that no elements may be\n  added.</p>\n</blockquote>\n\n<p>You write:</p>\n\n<pre><code>var countedData map[string][]ChartElement\n</code></pre>\n\n<p>Instead, to initialize the map, write,</p>\n\n<pre><code>countedData := make(map[string][]ChartElement)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1612839777, "creation_date": 1612839777, "answer_id": 66112389, "question_id": 35379378, "link": "https://stackoverflow.com/questions/35379378/go-assignment-to-entry-in-nil-map/66112389#66112389", "title": "Go : assignment to entry in nil map", "body": "<p>Another option is to use a composite literal:</p>\n<pre><code>countedData := map[string][]ChartElement{}\n</code></pre>\n<p><a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Composite_literals</a></p>\n"}], "owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17370, "favorite_count": 2, "accepted_answer_id": 35379919, "answer_count": 2, "score": 6, "last_activity_date": 1612839777, "creation_date": 1455363607, "last_edit_date": 1571379493, "question_id": 35379378, "link": "https://stackoverflow.com/questions/35379378/go-assignment-to-entry-in-nil-map", "title": "Go : assignment to entry in nil map", "body": "<p>When trying to set value to the <code>map</code>(<code>countedData</code>) in the below code, I am getting an error that says, <code>assignment to entry in nil map</code>. </p>\n\n<pre><code>func receiveWork(out &lt;-chan Work) map[string][]ChartElement {\n\n    var countedData map[string][]ChartElement\n\n    for el := range out {\n        countedData[el.Name] = el.Data\n    }\n    fmt.Println(\"This is never executed !!!\")\n\n    return countedData\n}\n</code></pre>\n\n<p><code>Println</code> does not execute (as the error occurs on a lien before that). </p>\n\n<p>There are some goroutines , that are sending data to channel, and <code>receiveWork</code> method should be making a map like this: </p>\n\n<pre><code>map =&gt;\n    \"typeOne\" =&gt; \n       [\n         ChartElement,\n         ChartElement,\n         ChartElement,\n       ],\n    \"typeTwo\" =&gt; \n       [\n         ChartElement,\n         ChartElement,\n         ChartElement,\n       ]\n</code></pre>\n\n<p>Please help me fix the error.</p>\n"}, {"tags": ["go", "drone"], "owner": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 165, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1455378387, "creation_date": 1455360376, "last_edit_date": 1455369865, "question_id": 35378904, "link": "https://stackoverflow.com/questions/35378904/how-go-install-finds-out-when-to-rebuild", "title": "How go install finds out when to rebuild?", "body": "<p>I'm trying to use <code>go install</code> inside a drone build with caching(whole $GOPATH, see <a href=\"http://readme.drone.io/usage/caching/\" rel=\"nofollow\">http://readme.drone.io/usage/caching/</a>) and it works but <code>go install</code> rebuilds all packages doesn't matter what I do with the cache(I checked and cache store/restore seems to work correct - all .a files inside pkg are present)</p>\n\n<p>How does <code>go install</code> find out what to rebuild?</p>\n\n<p>edit: sigh... it must be caused by timestamps change, for some reason drone does not preserve them(access/modify/change change)</p>\n\n<p>edit2: I found out I could use drone volumes for the same purpose, I did so and file access times as well as structure/contents are perfectly the same across builds - still <code>go install</code> ignores everything and rebuilds... What's the trick?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1455361018, "post_id": 35377477, "comment_id": 58462981, "body": "Erm, that is NOT a valid map..."}, {"owner": {"reputation": 26921, "user_id": 1088797, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bltA9.png?s=128&g=1", "display_name": "Dan Prince", "link": "https://stackoverflow.com/users/1088797/dan-prince"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1455361499, "post_id": 35377477, "comment_id": 58463094, "body": "It&#39;s not a literal, it&#39;s the printed output after the map has been created."}], "answers": [{"comments": [{"owner": {"reputation": 730, "user_id": 1338215, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/710f013206b53ff1c7d853880093dcf3?s=128&d=identicon&r=PG", "display_name": "Taleh Ibrahimli", "link": "https://stackoverflow.com/users/1338215/taleh-ibrahimli"}, "edited": false, "score": 0, "creation_date": 1611025561, "post_id": 35382394, "comment_id": 116311815, "body": "It is the reason, not a solution :)"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 2, "last_activity_date": 1455381269, "creation_date": 1455381269, "answer_id": 35382394, "question_id": 35377477, "link": "https://stackoverflow.com/questions/35377477/marshaling-a-nested-map-into-json/35382394#35382394", "title": "Marshaling a nested map into JSON", "body": "<p>Most likely, the sub-maps are being created as map[interface{}]interface{} by the YAML parser.</p>\n\n<p>Print out your map with \"%#v\" instead of \"%v\" and you will see the types.</p>\n\n<p><a href=\"http://play.golang.org/p/OUlMlv0dpu\" rel=\"nofollow\">Here's an example</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    a := map[string]interface{}{\n        \"A\": map[interface{}]interface{}{\n            \"B\": 123,\n        },\n    }\n    fmt.Printf(\"%#v\\n\",a)\n}\n</code></pre>\n\n<p>Produces:</p>\n\n<pre><code>map[string]interface {}{\"A\":map[interface {}]interface {}{\"B\":123}}\n</code></pre>\n"}], "owner": {"reputation": 26921, "user_id": 1088797, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bltA9.png?s=128&g=1", "display_name": "Dan Prince", "link": "https://stackoverflow.com/users/1088797/dan-prince"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2616, "favorite_count": 1, "accepted_answer_id": 35382394, "answer_count": 1, "score": 2, "last_activity_date": 1455381269, "creation_date": 1455349986, "last_edit_date": 1455361572, "question_id": 35377477, "link": "https://stackoverflow.com/questions/35377477/marshaling-a-nested-map-into-json", "title": "Marshaling a nested map into JSON", "body": "<p>I'm trying to marshal this nested map into a JSON string.</p>\n\n<pre><code>map[\n  description:Foo Bar\n  url:http://foobar.co.uk\n  theme_color:#1b1b1b\n  markdown:kramdown\n  sass:map[\n    style:compressed\n  ]\n  collections:map[\n    projects:map[\n      output:true\n      permalink:/project/:path\n    ]\n    jobs:map[\n      output:true\n      permalink:/job/:path\n    ]\n  ]\n  title:Foo Bar\n  email:foo@foobarco.uk\n]\n</code></pre>\n\n<p>(Cleaned up output from <code>fmt.Printf(\"%v\", m)</code>)</p>\n\n<p>Initially a config file is read and parsed to produce the map, so I don't know the fields in advance, meaning I can't(?) use a struct.</p>\n\n<p>Unmarshalling from YAML into this map of <code>map[string]interface{}</code> works fine, but when I pass this map to <code>json.Marshal</code>, I get the following error.</p>\n\n<pre><code>json: unsupported type: map[interface {}]interface{}\n</code></pre>\n\n<p>From reading around, I can see that this error is thrown because JSON only supports string keys. What's confusing me, is that the map above doesn't seem to have any non-string keys.</p>\n\n<p>If I remove the nested <code>sass</code> and <code>collections</code> keys, it marshals without any issues.</p>\n\n<p>Is it possible to do some sanity check on the map to confirm that all the keys are infact <code>string</code> and not just <code>interface{}</code> looking like strings?</p>\n"}, {"tags": ["go", "struct", "anonymous"], "answers": [{"comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1455345620, "post_id": 35376088, "comment_id": 58459460, "body": "Specced <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">here</a>. Packages also don&#39;t become part of the field&#39;s name. Note that if you embed a lowercase typename like <code>int</code> it will wind up an unexported field, i.e., you won&#39;t be able to do <code>a.int</code> from another package."}], "tags": [], "owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "is_accepted": false, "score": 1, "last_activity_date": 1455337698, "creation_date": 1455337698, "answer_id": 35376088, "question_id": 35376025, "link": "https://stackoverflow.com/questions/35376025/how-to-initialize-go-struct-with-anonymous-member-of-pointer-type/35376088#35376088", "title": "How to initialize Go struct with anonymous member of pointer type?", "body": "<p>The name of <code>*int</code> field is just <code>int</code>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype AA struct {\n    *int\n    xx string\n}\n\nfunc main() {\n    i := 1\n    a := &amp;AA{\n        int: &amp;i,\n        xx:  \"2\",\n    }\n    fmt.Println(a)\n}\n</code></pre>\n"}], "owner": {"reputation": 1006, "user_id": 1300023, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7fe2a52fd5ef64a129677878df2a8b35?s=128&d=identicon&r=PG", "display_name": "HardySimpson", "link": "https://stackoverflow.com/users/1300023/hardysimpson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1098, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1455337731, "creation_date": 1455337121, "last_edit_date": 1455337731, "question_id": 35376025, "link": "https://stackoverflow.com/questions/35376025/how-to-initialize-go-struct-with-anonymous-member-of-pointer-type", "title": "How to initialize Go struct with anonymous member of pointer type?", "body": "<p>the normal way to initial a struct with anonymous member is like this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n\ntype AA struct {\n        int\n        xx string\n}\n\nfunc main() {\n        a := &amp;AA{\n                int : 1,\n                xx : \"2\",\n        }\n        fmt.Println(a) // &amp;{1 2}\n}\n</code></pre>\n\n<p>but, if the type is a pointer, can't do this any more</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n\ntype AA struct {\n        *int\n        xx string\n}\n\nfunc main() {\n        i := 1\n        a := &amp;AA{\n                *int : &amp;i,\n                xx : \"2\",\n        }\n        fmt.Println(a)\n}\n// .\\hello.go:14: invalid field name *int in struct initializer\n</code></pre>\n\n<p>is there any better way?</p>\n"}, {"tags": ["go", "rpc"], "answers": [{"tags": [], "owner": {"reputation": 651, "user_id": 621973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88f4ee43bc2722fdd9240db6da9c0b39?s=128&d=identicon&r=PG", "display_name": "foo", "link": "https://stackoverflow.com/users/621973/foo"}, "is_accepted": true, "score": 1, "last_activity_date": 1455438569, "creation_date": 1455438569, "answer_id": 35389823, "question_id": 35374389, "link": "https://stackoverflow.com/questions/35374389/how-do-i-return-an-empty-string-from-an-rpc-call/35389823#35389823", "title": "How do I return an empty string from an RPC call?", "body": "<p>\"\" (the empty string) is often interpreted by libraries (database, rpc, json) as the default value and just ignored.</p>\n\n<p>To get more control over nil, and \"\", change the rpc signature to:</p>\n\n<pre><code>type ValReply struct {\n    Val *string \n}\n</code></pre>\n\n<p>and then the library will distinguish empty, from null etc.</p>\n"}], "owner": {"reputation": 995, "user_id": 4872477, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/a52a31b0da099d83aa619226a0174b20?s=128&d=identicon&r=PG&f=1", "display_name": "GreySage", "link": "https://stackoverflow.com/users/4872477/greysage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 35389823, "answer_count": 1, "score": 1, "last_activity_date": 1455438569, "creation_date": 1455322334, "last_edit_date": 1455324172, "question_id": 35374389, "link": "https://stackoverflow.com/questions/35374389/how-do-i-return-an-empty-string-from-an-rpc-call", "title": "How do I return an empty string from an RPC call?", "body": "<p>I have an RPC system, where the interface used for the result is as follows:</p>\n\n<pre><code>type ValReply struct {\n    Val string \n}\n</code></pre>\n\n<p>Sometimes, my RPC will set reply.Val to <code>\"\"</code>(the empty string). In these cases, the previous value in reply.Val is not overwritten, leaving the incorrect result to be used by the client.</p>\n\n<p>How can I get my RPC call to return an empty string?</p>\n\n<p>I have googled this issue, and I can't find anything about not returning empty strings in the RPC API.</p>\n"}, {"tags": ["go", "bit-manipulation"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1455323085, "creation_date": 1455323085, "answer_id": 35374494, "question_id": 35374300, "link": "https://stackoverflow.com/questions/35374300/why-does-golang-rgba-rgba-method-use-and/35374494#35374494", "title": "Why does golang RGBA.RGBA() method use | and &lt;&lt;?", "body": "<p>To convert from 8- to 16-bits per RGB component, copy the byte into the high byte of the 16-bit value. e.g., 0x03 becomes 0x0303, 0xFE becomes 0xFEFE, so that the 8-bit values 0 through 255 (0xFF) produce 16-bit values 0 to 65,535 (0xFFFF) with an even distribution of values.</p>\n"}, {"tags": [], "owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "is_accepted": true, "score": 8, "last_activity_date": 1455384233, "last_edit_date": 1455384233, "creation_date": 1455323333, "answer_id": 35374532, "question_id": 35374300, "link": "https://stackoverflow.com/questions/35374300/why-does-golang-rgba-rgba-method-use-and/35374532#35374532", "title": "Why does golang RGBA.RGBA() method use | and &lt;&lt;?", "body": "<p>From the the excellent \"<a href=\"http://blog.golang.org/go-image-package\" rel=\"noreferrer\">The Go image package</a>\" blogpost:</p>\n\n<blockquote>\n  <p>[...] the channels have a 16-bit effective range: 100% red is represented by\n  RGBA returning an r of 65535, not 255, so that converting from CMYK or\n  YCbCr is not as lossy. Third, the type returned is uint32, even though\n  the maximum value is 65535, to guarantee that multiplying two values\n  together won't overflow.</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>Note that the R field of an RGBA is an 8-bit alpha-premultiplied color in the range [0, 255]. RGBA satisfies the Color interface by multiplying that value by 0x101 to generate a 16-bit alpha-premultiplied color in the range [0, 65535]</p>\n</blockquote>\n\n<p>So if we look at the bit representation of a color with the value <code>c.R = 10101010</code> then this operation</p>\n\n<pre><code>r = uint32(c.R)\nr |= r &lt;&lt; 8\n</code></pre>\n\n<p>effectively copies the first byte to the second byte. </p>\n\n<pre><code>   00000000000000000000000010101010 (r)\n | 00000000000000001010101000000000 (r &lt;&lt; 8)\n--------------------------------------\n   00000000000000001010101010101010 (r |= r &lt;&lt; 8)\n</code></pre>\n\n<p>This is equivalent to a multiplication with the factor <code>0x101</code> and distributes all 256 possible values evenly across the range [0, 65535].</p>\n"}, {"tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": false, "score": 7, "last_activity_date": 1455323485, "creation_date": 1455323485, "answer_id": 35374556, "question_id": 35374300, "link": "https://stackoverflow.com/questions/35374300/why-does-golang-rgba-rgba-method-use-and/35374556#35374556", "title": "Why does golang RGBA.RGBA() method use | and &lt;&lt;?", "body": "<p>The <code>color.RGBA</code> type implements the <code>RGBA</code> method to satisfy the <a href=\"https://golang.org/pkg/image/color/#Color\" rel=\"noreferrer\"><code>color.Color</code></a> interface:</p>\n\n<pre><code>type Color interface {\n    // RGBA returns the alpha-premultiplied red, green, blue and alpha values\n    // for the color. Each value ranges within [0, 0xffff], but is represented\n    // by a uint32 so that multiplying by a blend factor up to 0xffff will not\n    // overflow.\n    //\n    // An alpha-premultiplied color component c has been scaled by alpha (a),\n    // so has valid values 0 &lt;= c &lt;= a.\n    RGBA() (r, g, b, a uint32)\n}\n</code></pre>\n\n<p>Now the RGBA type represents the colour channels with the <code>uint8</code> type, giving a range of [0, 0xff].  Simply converting these values to <code>uint32</code> would not extend the range up to [0, 0xffff].</p>\n\n<p>An appropriate conversion would be something like:</p>\n\n<pre><code>r = uint32((float64(c.R) / 0xff) * 0xffff)\n</code></pre>\n\n<p>However, they want to avoid the floating point arithmetic.  Luckily <code>0xffff / 0xff</code> is <code>0x0101</code>, so we can simplify the expression (ignoring the type conversions for now):</p>\n\n<pre><code>r = c.R * 0x0101\n  = c.R * 0x0100 + c.R\n  = (c.R &lt;&lt; 8) + c.R    # multiply by power of 2 is equivalent to shift\n  = (c.R &lt;&lt; 8) | c.R    # equivalent, since bottom 8 bits of first operand are 0\n</code></pre>\n\n<p>And that's essentially what the code in the standard library is doing.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user862787"}, "is_accepted": false, "score": 3, "last_activity_date": 1455323786, "creation_date": 1455323786, "answer_id": 35374587, "question_id": 35374300, "link": "https://stackoverflow.com/questions/35374300/why-does-golang-rgba-rgba-method-use-and/35374587#35374587", "title": "Why does golang RGBA.RGBA() method use | and &lt;&lt;?", "body": "<p>Converting a value in the range 0 to 255 (an 8-bit RGB component) to a value in the range 0 to 65535 (a 16-bit RGB component) would be done by multiplying the 8-bit value by 65535/255; 65535/255 is exactly 257, which is hex 101, so multiplying a one-byte by 65535/255 can be done by shifting that byte value left 8 bits and ORing it with the original value.</p>\n\n<p>(There's nothing Go-specific about this; similar tricks are done elsewhere, in other languages, when converting 8-bit RGB/RGBA components to 16-bit RGB/RGBA components.)</p>\n"}], "owner": {"reputation": 111, "user_id": 2702117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37ea6c2812deff668185600a7999bbb5?s=128&d=identicon&r=PG&f=1", "display_name": "Wang Ke", "link": "https://stackoverflow.com/users/2702117/wang-ke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3461, "favorite_count": 1, "accepted_answer_id": 35374532, "answer_count": 4, "score": 10, "last_activity_date": 1455384233, "creation_date": 1455321752, "last_edit_date": 1455322022, "question_id": 35374300, "link": "https://stackoverflow.com/questions/35374300/why-does-golang-rgba-rgba-method-use-and", "title": "Why does golang RGBA.RGBA() method use | and &lt;&lt;?", "body": "<p>In the golang color package, there is a method to get r,g,b,a values from an <code>RGBA</code> object:</p>\n\n<pre><code>func (c RGBA) RGBA() (r, g, b, a uint32) {\n    r = uint32(c.R)\n    r |= r &lt;&lt; 8\n    g = uint32(c.G)\n    g |= g &lt;&lt; 8\n    b = uint32(c.B)\n    b |= b &lt;&lt; 8\n    a = uint32(c.A)\n    a |= a &lt;&lt; 8\n    return\n}\n</code></pre>\n\n<p>If I were to implement this simple function, I would just write this</p>\n\n<pre><code>func (c RGBA) RGBA() (r, g, b, a uint32) {\n    r = uint32(c.R)\n    g = uint32(c.G)\n    b = uint32(c.B)\n    a = uint32(c.A)\n    return\n}\n</code></pre>\n\n<p>What's the reason <code>r |= r &lt;&lt; 8</code> is used?</p>\n"}, {"tags": ["arrays", "postgresql", "go"], "answers": [{"comments": [{"owner": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "edited": false, "score": 0, "creation_date": 1455314999, "post_id": 35372953, "comment_id": 58451945, "body": "Yes i think too i need to rethink the way im implementing tag column, but i really would like to know the best way to convert varchar array to string array, but thanks for your answer"}, {"owner": {"reputation": 4076, "user_id": 1806763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GXLjI.png?s=128&g=1", "display_name": "JD D", "link": "https://stackoverflow.com/users/1806763/jd-d"}, "reply_to_user": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "edited": false, "score": 0, "creation_date": 1455317049, "post_id": 35372953, "comment_id": 58452792, "body": "The code sample at the bottom should result in a string array for your results...  there may be an easier way but I don&#39;t know what your query looks like, have you tried passing in a reference to a []string instead of a reference to a []unit8 into Scan?  (See first code snippet)... this still may work but not sure what your query or table looks like"}, {"owner": {"reputation": 221, "user_id": 6115462, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WUOeLU_AErY/AAAAAAAAAAI/AAAAAAAAARk/Xd0y6Gejvzk/photo.jpg?sz=128", "display_name": "Ludi Rehak", "link": "https://stackoverflow.com/users/6115462/ludi-rehak"}, "edited": false, "score": 0, "creation_date": 1499221805, "post_id": 35372953, "comment_id": 76808499, "body": "If you try to scan into *[]string, you will get an error: <code>sql: Scan error on column index 0: unsupported Scan, storing driver.Value type []uint8 into type *[]string</code>. Scan converts columns read from the database into only a subset of the common Go types, which does not include []string."}], "tags": [], "owner": {"reputation": 4076, "user_id": 1806763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GXLjI.png?s=128&g=1", "display_name": "JD D", "link": "https://stackoverflow.com/users/1806763/jd-d"}, "is_accepted": false, "score": 0, "last_activity_date": 1455314622, "creation_date": 1455314622, "answer_id": 35372953, "question_id": 35372436, "link": "https://stackoverflow.com/questions/35372436/array-varchar-psql-to-array-string-golang/35372953#35372953", "title": "Array Varchar (psql) to array string (golang)", "body": "<p>First of all, why do you have an column called tags that contains multiple tag values?  Wouldn't it be better to have another table with a foreign key to the one that tags column is currently in so that each tag value is it's own row?  If you have that, you should be able to do something really easy like:</p>\n\n<pre><code>rows := db.QueryRow(\"SELECT tag from tags_table where foreign_key = 123\")\nvar asSlice []string\nerr := row.Scan(&amp;asSlice) \n</code></pre>\n\n<p>If you have to put it all inside of one column, would it be possible to just store it as JSON?  Then you could use the \"encoding/json\" package do something simple like:</p>\n\n<pre><code>func Uint8toString(array []uint8) []string {\n     var stringArray []string\n     json.Unmarshal(array, &amp;stringArray)\n     return stringArray\n}\n</code></pre>\n\n<p>Although I think you should rethink the way you are implementing the above tags column, you could also use the following logic to parse it into strings but it assumes that the format will always be similar to what you've posted:</p>\n\n<pre><code>func Uint8toString(array []uint8) []string {\n    stringNoBrackets := string(array[1:len(array)-1])\n    return strings.Split(stringNoBrackets,\",\")\n}\n</code></pre>\n"}], "owner": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1752, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1499225832, "creation_date": 1455312315, "question_id": 35372436, "link": "https://stackoverflow.com/questions/35372436/array-varchar-psql-to-array-string-golang", "title": "Array Varchar (psql) to array string (golang)", "body": "<p>I would like to know how i can get my array varchar in my psql database in array string in go for render it in json.</p>\n\n<p>I actually do that</p>\n\n<p>In creation of my table i create my column like that :</p>\n\n<pre><code>tags varchar(50)[] default NULL\n</code></pre>\n\n<p>when i use my select request for get it in golang :</p>\n\n<pre><code>var rowtags []uint8\nerr = rows.Scan(&amp;rowtags)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>i have try to make a fonction that transform uint8[] to string[]</p>\n\n<pre><code>func Uint8toString(array []uint8) []string {\n\n    var ret = make([]string, len(array))\n    for i := 0; i &lt; len(array); i++{\n        ret[i] = string(array[i])\n    }\n    return (ret)\n}\n</code></pre>\n\n<p>so i apply function of my var rowstag</p>\n\n<pre><code>var tags := Uint8toString(rowtags)\n</code></pre>\n\n<p>and when i render struct where var tags is, I get that</p>\n\n<pre><code>  \"Tags\": [\n    \"{\",\n    \"#\",\n    \"c\",\n    \",\",\n    \"#\",\n    \"c\",\n    \",\",\n    \"#\",\n    \"c\",\n    \"o\",\n    \"u\",\n    \"c\",\n    \"o\",\n    \"u\",\n    \",\",\n    \"#\",\n    \"c\",\n    \"d\",\n    \"}\"\n  ],\n</code></pre>\n\n<p>of course I would like it</p>\n\n<pre><code>  \"Tags\": [\n    \"#c\",\n    \"#c\",\n    \"#coucou\",\n    \"#cd\"\n  ],\n</code></pre>\n\n<p>thank's for helping me , I'm on golang a short time , and I find no solution.</p>\n"}, {"tags": ["go", "casting"], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1504307734, "post_id": 35371760, "comment_id": 78978974, "body": "Hi, should i use the constants <code>MaxVarintLenXX</code> to determine the size of buffer before put ?"}, {"owner": {"reputation": 5437, "user_id": 1257094, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Ob6MH.jpg?s=128&g=1", "display_name": "milgner", "link": "https://stackoverflow.com/users/1257094/milgner"}, "edited": false, "score": 0, "creation_date": 1577042311, "post_id": 35371760, "comment_id": 105077260, "body": "No, <code>PutUint64</code> uses fixed length encoding. You only need <code>MaxVarintLenXX</code> when using <code>PutVarint</code>."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 72, "last_activity_date": 1455309836, "last_edit_date": 1455309836, "creation_date": 1455309464, "answer_id": 35371760, "question_id": 35371385, "link": "https://stackoverflow.com/questions/35371385/how-can-i-convert-an-int64-into-a-byte-array-in-go/35371760#35371760", "title": "How can I convert an int64 into a byte array in go?", "body": "<p>Converting between <code>int64</code> and <code>uint64</code> doesn't change the sign bit, only the way it's interpreted. </p>\n\n<p>You can use <code>Uint64</code> and <code>PutUint64</code> with the correct <a href=\"https://golang.org/pkg/encoding/binary/#ByteOrder\" rel=\"noreferrer\"><code>ByteOrder</code></a></p>\n\n<p><a href=\"http://play.golang.org/p/wN3ZlB40wH\" rel=\"noreferrer\">http://play.golang.org/p/wN3ZlB40wH</a></p>\n\n<pre><code>i := int64(-123456789)\n\nfmt.Println(i)\n\nb := make([]byte, 8)\nbinary.LittleEndian.PutUint64(b, uint64(i))\n\nfmt.Println(b)\n\ni = int64(binary.LittleEndian.Uint64(b))\nfmt.Println(i)\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>-123456789\n[235 50 164 248 255 255 255 255]\n-123456789\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1536667788, "post_id": 47978539, "comment_id": 91498649, "body": "what is the b := buf[:n] line for?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1554405215, "post_id": 47978539, "comment_id": 97750959, "body": "@JohnBalvinArias: it&#39;s because this example uses a variable length encoding"}], "tags": [], "owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "is_accepted": false, "score": 4, "last_activity_date": 1514290637, "creation_date": 1514290637, "answer_id": 47978539, "question_id": 35371385, "link": "https://stackoverflow.com/questions/35371385/how-can-i-convert-an-int64-into-a-byte-array-in-go/47978539#47978539", "title": "How can I convert an int64 into a byte array in go?", "body": "<p>The code:</p>\n\n<pre><code>var num int64 = -123456789\n\n// convert int64 to []byte\nbuf := make([]byte, binary.MaxVarintLen64)\nn := binary.PutVarint(buf, num)\nb := buf[:n]\n\n// convert []byte to int64\nx, n := binary.Varint(b)\nfmt.Printf(\"x is: %v, n is: %v\\n\", x, n)\n</code></pre>\n\n<p>outputs</p>\n\n<pre><code>x is: -123456789, n is: 4\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 187, "user_id": 3758517, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fLT1J.png?s=128&g=1", "display_name": "Jonathan Hecl", "link": "https://stackoverflow.com/users/3758517/jonathan-hecl"}, "is_accepted": false, "score": 3, "last_activity_date": 1534028547, "creation_date": 1534028547, "answer_id": 51804425, "question_id": 35371385, "link": "https://stackoverflow.com/questions/35371385/how-can-i-convert-an-int64-into-a-byte-array-in-go/51804425#51804425", "title": "How can I convert an int64 into a byte array in go?", "body": "<p>You can use this too:</p>\n\n<pre><code>var num int64 = -123456789\n\nb := []byte(strconv.FormatInt(num, 10))\n\nfmt.Printf(\"num is: %v, in string is: %s\", b, string(b))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>num is: [45 49 50 51 52 53 54 55 56 57], in string is: -123456789\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "is_accepted": false, "score": 5, "last_activity_date": 1564464873, "creation_date": 1564464873, "answer_id": 57264894, "question_id": 35371385, "link": "https://stackoverflow.com/questions/35371385/how-can-i-convert-an-int64-into-a-byte-array-in-go/57264894#57264894", "title": "How can I convert an int64 into a byte array in go?", "body": "<p>If you don't care about the sign or endianness (for example, reasons like hashing keys for maps etc), you can simply shift bits, then AND them with 0b11111111 (0xFF):</p>\n\n<p>(assume v is an int32)</p>\n\n<pre><code>b := [4]byte{\n        byte(0xff &amp; v),\n        byte(0xff &amp; (v &gt;&gt; 8)),\n        byte(0xff &amp; (v &gt;&gt; 16)),\n        byte(0xff &amp; (v &gt;&gt; 24))}\n</code></pre>\n\n<p>(for int64/uint64, you'd need to have a byte slice of length 8)</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 11140930, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-CmPNrto3kGk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcI9FbimQZWqpTZ1P9K81WXDCL1RA/mo/photo.jpg?sz=128", "display_name": "Gezman", "link": "https://stackoverflow.com/users/11140930/gezman"}, "is_accepted": false, "score": 0, "last_activity_date": 1615709738, "creation_date": 1615709738, "answer_id": 66622380, "question_id": 35371385, "link": "https://stackoverflow.com/questions/35371385/how-can-i-convert-an-int64-into-a-byte-array-in-go/66622380#66622380", "title": "How can I convert an int64 into a byte array in go?", "body": "<p>in <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow noreferrer\">&quot;encoding/binary&quot;</a> library you can use methods PutVariant([]byte,int64) to transfer from int64 to bytes and Variant([]byte) to transfer from bytes to int64, without any further casting. This code in <a href=\"https://play.golang.org/p/9zicJfKpZhK\" rel=\"nofollow noreferrer\">Go playgruond</a></p>\n<pre><code>buf := make([]byte, 8)\n\nvar toBytes int64 = 900\nfmt.Printf(&quot;toBytes:%d\\n&quot;, toBytes)\n\nbinary.PutVarint(buf, toBytes)\nfmt.Printf(&quot;buffer:%v\\n&quot;, buf[:])\n\nfromBytes, _ := binary.Varint(buf)\nfmt.Printf(&quot;fromBytes:%d\\n&quot;, fromBytes)\n</code></pre>\n"}], "owner": {"reputation": 4478, "user_id": 557406, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/99836456ec6d87389df32d2cdcf8d825?s=128&d=identicon&r=PG", "display_name": "Charles L.", "link": "https://stackoverflow.com/users/557406/charles-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38161, "favorite_count": 4, "accepted_answer_id": 35371760, "answer_count": 5, "score": 36, "last_activity_date": 1615709738, "creation_date": 1455307861, "question_id": 35371385, "link": "https://stackoverflow.com/questions/35371385/how-can-i-convert-an-int64-into-a-byte-array-in-go", "title": "How can I convert an int64 into a byte array in go?", "body": "<p>I have an id that is represented at an <code>int64</code>.  How can I convert this to a <code>[]byte</code>?  I see that the binary package does this for uints, but I want to make sure I don't break negative numbers.</p>\n"}, {"tags": ["go", "user32"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1455305631, "post_id": 35370748, "comment_id": 58447551, "body": "To rephrase the error, the <code>printme</code> argument is of type <code>uintptr</code>, and you&#39;re passing it a <code>func(win.HANDLE, uintptr)</code>."}, {"owner": {"reputation": 11, "user_id": 5920217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90d8c3b7c606c894552ecc4ba3038d52?s=128&d=identicon&r=PG", "display_name": "5k3105", "link": "https://stackoverflow.com/users/5920217/5k3105"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455306811, "post_id": 35370748, "comment_id": 58448197, "body": "The function requires a callback function. How would I convince the compiler?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455307387, "post_id": 35370748, "comment_id": 58448450, "body": "You can&#39;t &quot;convince&quot; the compiler that a go function is a uintptr, because that simply can&#39;t work. What is <code>lxn&#47;win</code>, and is there any documentation for using the <code>EnumChildWindows</code> function?"}, {"owner": {"reputation": 11, "user_id": 5920217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90d8c3b7c606c894552ecc4ba3038d52?s=128&d=identicon&r=PG", "display_name": "5k3105", "link": "https://stackoverflow.com/users/5920217/5k3105"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455307884, "post_id": 35370748, "comment_id": 58448691, "body": "lxn/win is an interface to windows user32.dll. No examples of it&#39;s use other than the standard: <a href=\"https://godoc.org/github.com/lxn/win#EnumChildWindows\" rel=\"nofollow noreferrer\">lxn/win</a>. I could ask on github."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1455308042, "post_id": 35370748, "comment_id": 58448761, "body": "If this is for a windows syscall, you probably need to use <code>syscall.NewCallback</code> (or maybe <code>syscall.NewCallbackDecl</code>, I don&#39;t know anything about windows.)"}, {"owner": {"reputation": 11, "user_id": 5920217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90d8c3b7c606c894552ecc4ba3038d52?s=128&d=identicon&r=PG", "display_name": "5k3105", "link": "https://stackoverflow.com/users/5920217/5k3105"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455310860, "post_id": 35370748, "comment_id": 58450104, "body": "Thanks. The compiler took it but I couldn&#39;t get the function to print anything. I&#39;ll create an issue on github. Thanks for your help!"}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1557619904, "creation_date": 1557619904, "answer_id": 56095222, "question_id": 35370748, "link": "https://stackoverflow.com/questions/35370748/enumchildwindows-callback-function-in-golang/56095222#56095222", "title": "EnumChildWindows callback function in golang", "body": "<p>I made it work with:</p>\n\n<pre><code>win.EnumChildWindows(hwnd, syscall.NewCallback(printme), 0)\n\nfunc printme(hwnd uintptr, lParam uintptr) uintptr {\n    spew.Dump(hwnd)\n    fmt.Printf(\"getWindowText: '%s'\\n\", getWindowText(hwnd))\n    return 1 // true to continue\n}\n</code></pre>\n\n<p>See <a href=\"https://github.com/lxn/win/issues/19\" rel=\"nofollow noreferrer\"><code>lxn/win</code> issue 19</a>:</p>\n\n<blockquote>\n  <p>The callback signature is wrong: it has to return a value of type <code>int32</code> (<code>C BOOL</code>) that is nonzero if the function should continue enumeration.<br>\n  <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms633493%28v=vs.85%29.aspx\" rel=\"nofollow noreferrer\">See MSDN</a>. </p>\n  \n  <p>For example, it could be:</p>\n\n<pre><code>func printme(hwnd uintptr, lParam uintptr) int32 {\n    spew.Dump(hwnd)\n    return 1 // true to continue\n}\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 11, "user_id": 5920217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90d8c3b7c606c894552ecc4ba3038d52?s=128&d=identicon&r=PG", "display_name": "5k3105", "link": "https://stackoverflow.com/users/5920217/5k3105"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 394, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1557619904, "creation_date": 1455305401, "question_id": 35370748, "link": "https://stackoverflow.com/questions/35370748/enumchildwindows-callback-function-in-golang", "title": "EnumChildWindows callback function in golang", "body": "<p>Using package lxn/win in main:</p>\n\n<pre><code>win.EnumChildWindows(hw, printme, 0)\n</code></pre>\n\n<p>Then after main:</p>\n\n<pre><code>func printme(HWND win.HANDLE, LPARAM uintptr) { //HWND hwnd, LPARAM lParam\n    spew.Dump(HWND)\n}\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>.\\test.go:40: cannot use printme (type func(win.HANDLE, uintptr)) as type uintptr in argument to win.EnumChildWindows\n\nerror:exit status 2\n</code></pre>\n\n<p>I don't understand the error message.</p>\n"}, {"tags": ["angular", "go", "routing"], "comments": [{"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "edited": false, "score": 1, "creation_date": 1459576274, "post_id": 35366887, "comment_id": 60358231, "body": "Why is this downvoted? I got the same question!!"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2515948"}, "edited": false, "score": 1, "creation_date": 1455296323, "post_id": 35367973, "comment_id": 58442187, "body": "same problem, i visit &quot;/login&quot; and get a 404."}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 0, "creation_date": 1455297823, "post_id": 35367973, "comment_id": 58443170, "body": "Are you still using httprouter?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2515948"}, "edited": false, "score": 0, "creation_date": 1455299092, "post_id": 35367973, "comment_id": 58443900, "body": "no, i&#39;m not. just plain Go. With your edited solution i&#39;m getting blank pages, so i guess that&#39;s one step closer already."}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 0, "creation_date": 1455304822, "post_id": 35367973, "comment_id": 58447094, "body": "check your browser console for any javascript errors. Your page might be getting served but angular might not be rendering the page"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2515948"}, "edited": false, "score": 1, "creation_date": 1455305255, "post_id": 35367973, "comment_id": 58447331, "body": "yeah, i&#39;m getting &quot;Unexpected token &lt;&quot; on every .js file"}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 0, "creation_date": 1455310987, "post_id": 35367973, "comment_id": 58450154, "body": "sounds like html files are getting served instead js files."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2515948"}, "edited": false, "score": 1, "creation_date": 1455314929, "post_id": 35367973, "comment_id": 58451909, "body": "yeah, i&#39;m also getting &quot;Resource interpreted as stylesheet but transferred with MIME type text/html&quot; ..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2515948"}, "reply_to_user": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 0, "creation_date": 1455316689, "post_id": 35367973, "comment_id": 58452644, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/103341/discussion-between-ninja-andrej-and-jmaloney\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": false, "score": 2, "last_activity_date": 1455297810, "last_edit_date": 1455297810, "creation_date": 1455295712, "answer_id": 35367973, "question_id": 35366887, "link": "https://stackoverflow.com/questions/35366887/golang-angular/35367973#35367973", "title": "Golang + Angular", "body": "<p>You can use the <code>http</code> package directly.</p>\n\n<h3>Index page</h3>\n\n<pre><code>http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    http.ServeFile(w, r, \"./public/index.html\")\n})\n</code></pre>\n\n<p>This will serve the index.html file on all requests that don't match a route.</p>\n\n<h3>File server</h3>\n\n<pre><code>http.Handle(\"/public/\", http.StripPrefix(\"/public/\", http.FileServer(http.Dir(\"./public\"))))\n</code></pre>\n\n<p>This will serve all files from the public directory.</p>\n\n<p>Don't forget to start your server</p>\n\n<pre><code>http.ListenAndServe(\":8000\", nil)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "is_accepted": false, "score": 1, "last_activity_date": 1455312821, "creation_date": 1455312821, "answer_id": 35372544, "question_id": 35366887, "link": "https://stackoverflow.com/questions/35366887/golang-angular/35372544#35372544", "title": "Golang + Angular", "body": "<p>use goji micro framwork</p>\n\n<p><a href=\"https://github.com/zenazn/goji\" rel=\"nofollow\">https://github.com/zenazn/goji</a></p>\n\n<p>It's easy to use</p>\n\n<pre><code>func render_html_page(w http.ResponseWriter, url string) {\n    t, err := template.ParseFiles(url) \n    if err != nil {\n        panic (err)\n    }\n    t.Execute(w, nil)\n}\n\nfunc index(c web.C, w http.ResponseWriter, r *http.Request) {\n    render_html_page(w, \"./public/index.html\")\n}\n\nfunc main() {\n        goji.Get(\"/\", index)\n        goji.Serve()\n}\n</code></pre>\n\n<p>this code works, you need just make imports</p>\n"}, {"tags": [], "owner": {"reputation": 1073, "user_id": 2232573, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/207cb35beb3a38a12e8ec83fd12511f0?s=128&d=identicon&r=PG", "display_name": "nurp", "link": "https://stackoverflow.com/users/2232573/nurp"}, "is_accepted": false, "score": 0, "last_activity_date": 1456691467, "creation_date": 1456691467, "answer_id": 35687892, "question_id": 35366887, "link": "https://stackoverflow.com/questions/35366887/golang-angular/35687892#35687892", "title": "Golang + Angular", "body": "<p>I had the exact 404 problem. This routing is html5mode. You need to tell handlers in your app.yaml. Check my fork of Tour of Heroes project here <a href=\"https://github.com/nurp/angular2-tour-of-heroes\" rel=\"nofollow\">https://github.com/nurp/angular2-tour-of-heroes</a></p>\n\n<p>adding this to your app.yaml might solve the problem.</p>\n\n<pre><code>- url: /.*\n  static_files: index.html\n  upload: index.html\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "is_accepted": false, "score": 13, "last_activity_date": 1470219291, "last_edit_date": 1470219291, "creation_date": 1459611009, "answer_id": 36375162, "question_id": 35366887, "link": "https://stackoverflow.com/questions/35366887/golang-angular/36375162#36375162", "title": "Golang + Angular", "body": "<p>This is what I am using with the standard Go library, and routing works great.</p>\n\n<p>Check out the <a href=\"http://go-talks.appspot.com/github.com/matryer/golanguk/building-apis.slide#30\" rel=\"noreferrer\">Adapt function here</a></p>\n\n<pre><code>// Creates a new serve mux\nmux := http.NewServeMux()\n\n// Create room for static files serving\nmux.Handle(\"/node_modules/\", http.StripPrefix(\"/node_modules\", http.FileServer(http.Dir(\"./node_modules\"))))\nmux.Handle(\"/html/\", http.StripPrefix(\"/html\", http.FileServer(http.Dir(\"./html\"))))\nmux.Handle(\"/js/\", http.StripPrefix(\"/js\", http.FileServer(http.Dir(\"./js\"))))\nmux.Handle(\"/ts/\", http.StripPrefix(\"/ts\", http.FileServer(http.Dir(\"./ts\"))))\nmux.Handle(\"/css/\", http.StripPrefix(\"/css\", http.FileServer(http.Dir(\"./css\"))))\n\n// Do your api stuff**\nmux.Handle(\"/api/register\", util.Adapt(api.RegisterHandler(mux),\n    api.GetMongoConnection(),\n    api.CheckEmptyUserForm(),\n    api.EncodeUserJson(),\n    api.ExpectBody(),\n    api.ExpectPOST(),\n\n))\nmux.HandleFunc(\"/api/login\", api.Login)\nmux.HandleFunc(\"/api/authenticate\", api.Authenticate)\n\n// Any other request, we should render our SPA's only html file,\n// Allowing angular to do the routing on anything else other then the api    \n// and the files it needs for itself to work.\n// Order here is critical. This html should contain the base tag like\n// &lt;base href=\"/\"&gt; *href here should match the HandleFunc path below \nmux.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    http.ServeFile(w, r, \"html/index.html\")\n})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1168, "user_id": 2551024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5c64dfe155dc7e2d79ec11ec61e254b?s=128&d=identicon&r=PG", "display_name": "Xing", "link": "https://stackoverflow.com/users/2551024/xing"}, "is_accepted": false, "score": 0, "last_activity_date": 1544548452, "creation_date": 1544548452, "answer_id": 53729133, "question_id": 35366887, "link": "https://stackoverflow.com/questions/35366887/golang-angular/53729133#53729133", "title": "Golang + Angular", "body": "<p>Please define router.Notfound handler to serve angular index.html file.</p>\n\n<pre><code>import (\n  \"log\"\n  \"net/http\"\n\n  \"github.com/julienschmidt/httprouter\"\n)\n\nfunc angularHandler(w http.ResponseWriter, r *http.Request) {\n  http.ServeFile(w, r, \"./public/index.html\")\n}\n\nfunc main() {\n  router := httprouter.New()\n\n  // handle angular\n  router.NotFound = http.HandlerFunc(angularHandler)\n\n  // serve static files\n  router.ServeFiles(\"/*filepath\", http.Dir(\"./public\"))\n\n  log.Fatal(http.ListenAndServe(\":3000\", router))\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2515948"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14697, "favorite_count": 12, "answer_count": 5, "score": 14, "last_activity_date": 1544548452, "creation_date": 1455292581, "last_edit_date": 1501429179, "question_id": 35366887, "link": "https://stackoverflow.com/questions/35366887/golang-angular", "title": "Golang + Angular", "body": "<p>I started trying to work with Go and Angular, but I have a weird issue.. I guess I'm just missing a tiny detail, but I can't figure it out.</p>\n\n<p>I'm using <a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow noreferrer\">https://github.com/julienschmidt/httprouter</a> as a router for Go ... now with Angular, I should be able to copy &amp; paste a URL into the browser and Angular should handle the according routes, right?</p>\n\n<p>I have a \"/login\" route. Which works if the route gets accessed via the front-end .... but doesn't if I type in \"mypage.com/login\" into the browser, getting a 404. </p>\n\n<p>Go routing basically is only doing </p>\n\n<pre><code>router.NotFound = http.FileServer(http.Dir(\"./public\"))\n</code></pre>\n\n<p>Which works for the \"/\" route, but not for anything else. Which seems to be correct. But how do I setup the routing correctly, so Angular handles all the routing?</p>\n"}, {"tags": ["list", "sorting", "dictionary", "go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1455292746, "last_edit_date": 1455292746, "creation_date": 1455292238, "answer_id": 35366762, "question_id": 35366224, "link": "https://stackoverflow.com/questions/35366224/how-to-get-sorted-list-of-map-keys-in-go/35366762#35366762", "title": "How to get sorted list of map keys in Go?", "body": "<p>Since <code>map[string]bool</code> and <code>map[string]string</code> and <code>map[string]Whatever</code> are all distinct types, the only way to create a single function to sort the keys of all possible <code>map[string]*</code> types is via reflection.</p>\n\n<pre><code>func SortedMapKeys(m interface{}) (keyList []string) {\n    keys := reflect.ValueOf(m).MapKeys()\n\n    for _, key := range keys {\n        keyList = append(keyList, key.Interface().(string))\n    }\n    sort.Strings(keyList)\n    return\n}\n</code></pre>\n\n<p>For an in-between solution, since there are probably only a few combinations of types you're concerned with, you can use a type switch to extract the keys</p>\n\n<pre><code>func SortedMapKeys(m interface{}) (keyList []string) {\n    switch m := m.(type) {\n    case map[string]string:\n        for k := range m {\n            keyList = append(keyList, k)\n        }\n    case map[string]bool:\n        for k := range m {\n            keyList = append(keyList, k)\n        }\n    default:\n        panic(\"unknown map type\")\n    }\n\n    sort.Strings(keyList)\n    return\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 555, "user_id": 5058168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/2VxPP.png?s=128&g=1", "display_name": "RhinoLarva", "link": "https://stackoverflow.com/users/5058168/rhinolarva"}, "edited": false, "score": 0, "creation_date": 1455312764, "post_id": 35371297, "comment_id": 58450970, "body": "Thank you for your answer, but I&#39;m not sure that this in an idiomatic way of solving the task. Still. Since I have duplicated logic of collecting keys (even if it&#39;s within the same method), I will have to write unit tests to check each duplicated fragment of code. What if one day I will want to support 5 types of map? 10? 20? What if this code will be organized as a library and a programmer will want to collect keys of map[string]SomeCustomStruct?"}], "tags": [], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "is_accepted": false, "score": 1, "last_activity_date": 1455307561, "creation_date": 1455307561, "answer_id": 35371297, "question_id": 35366224, "link": "https://stackoverflow.com/questions/35366224/how-to-get-sorted-list-of-map-keys-in-go/35371297#35371297", "title": "How to get sorted list of map keys in Go?", "body": "<p>Here's my 0.02$. Since keys extracting logic is unlikely to change and you want to keep everything in one place you can create variant and choose non-nil map from it:</p>\n\n<pre><code>type MapVariant struct {\n    Bool   map[string]bool\n    String map[string]string\n}\n\nfunc SortedMapKeys(variant MapVariant) (keyList []string) {\n    if variant.String != nil {\n        for k := range variant.String {\n            keyList = append(keyList, k)\n        }\n        goto SORT\n    }\n    if variant.Bool != nil {\n        for k := range variant.Bool {\n            keyList = append(keyList, k)\n        }\n        goto SORT\n    }\n\nSORT:\n    sort.Strings(keyList)\n    return\n}\n</code></pre>\n\n<p>Of course you can avoid goto statements by adding more conditions but I personally find it clearer.</p>\n\n<p>Then you can use the function like:</p>\n\n<pre><code>SortedMapKeys(MapVariant{\n    Bool: map[string]bool{\"a\": true, \"b\": false}\n})\nSortedMapKeys(MapVariant{\n    String: map[string]string{\"c\": \"v1\", \"b\": \"v2\"}\n})\n</code></pre>\n"}], "owner": {"reputation": 555, "user_id": 5058168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/2VxPP.png?s=128&g=1", "display_name": "RhinoLarva", "link": "https://stackoverflow.com/users/5058168/rhinolarva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1625, "favorite_count": 1, "accepted_answer_id": 35366762, "answer_count": 2, "score": 4, "last_activity_date": 1455307561, "creation_date": 1455290748, "last_edit_date": 1455290938, "question_id": 35366224, "link": "https://stackoverflow.com/questions/35366224/how-to-get-sorted-list-of-map-keys-in-go", "title": "How to get sorted list of map keys in Go?", "body": "<p>Let's imagine I have a map: <code>map[string]string</code>. I would like to get the list of sorted keys for this map. So I could do something like this:</p>\n\n<pre><code>func SortedMapKeys(m map[string]string) (keyList []string) {\n    for key := range m {\n        keyList = append(keyList, key)\n    }\n    sort.Strings(keyList)\n    return\n}\n</code></pre>\n\n<p>Then I will have another map of type <code>map[string]bool</code>. I would like to get it's keys also. But the problem is that function SortedMapKeys accepts a <code>map[string]string</code> argument. So I need to write exactly the same function, with the only one difference - it will accept a <code>map[string]bool</code>.</p>\n\n<p>For obvious reasons it's not an option. If one day I would like to change the logic of how I get and sort my keys, I will need to track and update all these functions. Also, I will have to write the same unit tests for all these functions which actually do the same thing since their bodies are 100% equal (code duplicate).</p>\n\n<p>Is there any way to create a generic function which could accept an <code>map[string]</code> <em>of whatever</em>?</p>\n"}, {"tags": ["mongodb", "go", "crud"], "comments": [{"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 4, "creation_date": 1455290841, "post_id": 35364816, "comment_id": 58438327, "body": "you are deleting the records, re-inserting them then using a hard coded id.  When you insert a record, it get&#39;s a random id assigned to it.  It will be different every run.  Your hardcoded id can&#39;t work"}], "answers": [{"comments": [{"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "reply_to_user": {"reputation": 829, "user_id": 3480706, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/HzcVm.jpg?s=128&g=1", "display_name": "Nuwan Indika", "link": "https://stackoverflow.com/users/3480706/nuwan-indika"}, "edited": false, "score": 2, "creation_date": 1455291070, "post_id": 35365246, "comment_id": 58438538, "body": "David Budworth is right. Don&#39;t drop collection, or don&#39;t hardcode ids."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1512731378, "post_id": 35365246, "comment_id": 82386126, "body": "This answer is wrong. You either use <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.FindId\" rel=\"nofollow noreferrer\"><code>Collection.FindId()</code></a> and then you pass only the id value, or you use <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Find\" rel=\"nofollow noreferrer\"><code>Collection.Find()</code></a> and then you have to specify a value with the field name too. See this answer: <a href=\"https://stackoverflow.com/questions/41244024/find-by-id-with-mgo/41244172#41244172\">Find by id with mgo</a>."}, {"owner": {"reputation": 1715, "user_id": 8712494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-iWUnn1PqAuw/AAAAAAAAAAI/AAAAAAAAAGQ/2OslFo_DLk4/photo.jpg?sz=128", "display_name": "Amin Shojaei", "link": "https://stackoverflow.com/users/8712494/amin-shojaei"}, "edited": false, "score": 0, "creation_date": 1599032958, "post_id": 35365246, "comment_id": 112644307, "body": "This is a wrong answer, Because the returned type of <code>ObjectIdHex()</code> is <code>bson.ObjectId</code>, but you actually need to pass <code>primitive.ObjectID</code> type to mongo filter."}], "tags": [], "owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "is_accepted": true, "score": 14, "last_activity_date": 1455287947, "creation_date": 1455287947, "answer_id": 35365246, "question_id": 35364816, "link": "https://stackoverflow.com/questions/35364816/how-to-find-by-id-in-golang-and-mongodb/35365246#35365246", "title": "How to find by id in golang and mongodb", "body": "<p>It should be <code>_id</code> not <code>Id</code>:</p>\n\n<pre><code>c.FindId(bson.M{\"_id\": bson.ObjectIdHex(\"56bdd27ecfa93bfe3d35047d\")})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2064, "user_id": 1927543, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ad92404d9739ea60c7c90e1a7d0c6742?s=128&d=identicon&r=PG", "display_name": "Karthikeyan", "link": "https://stackoverflow.com/users/1927543/karthikeyan"}, "is_accepted": false, "score": 9, "last_activity_date": 1595867626, "last_edit_date": 1595867626, "creation_date": 1570550229, "answer_id": 58290005, "question_id": 35364816, "link": "https://stackoverflow.com/questions/35364816/how-to-find-by-id-in-golang-and-mongodb/58290005#58290005", "title": "How to find by id in golang and mongodb", "body": "<p>Use can do the same with Golang official driver as follows:</p>\n<pre><code>// convert id string to ObjectId\nobjectId, err := primitive.ObjectIDFromHex(&quot;5b9223c86486b341ea76910c&quot;)\nif err != nil{\n    log.Println(&quot;Invalid id&quot;)\n}\n\n// find\nresult:= client.Database(database).Collection(&quot;user&quot;).FindOne(context.Background(), bson.M{&quot;_id&quot;: objectId})\nuser := model.User{}\nresult.Decode(user)\n</code></pre>\n"}], "owner": {"reputation": 829, "user_id": 3480706, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/HzcVm.jpg?s=128&g=1", "display_name": "Nuwan Indika", "link": "https://stackoverflow.com/users/3480706/nuwan-indika"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16500, "favorite_count": 3, "accepted_answer_id": 35365246, "answer_count": 2, "score": 16, "last_activity_date": 1595867626, "creation_date": 1455286706, "last_edit_date": 1455286845, "question_id": 35364816, "link": "https://stackoverflow.com/questions/35364816/how-to-find-by-id-in-golang-and-mongodb", "title": "How to find by id in golang and mongodb", "body": "<p>I need get values using ObjectIdHex and do update and also view the result. I'm using mongodb and golang.But following code doesn't work as expected </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype Person struct {\n    Id      bson.ObjectId `json:\"id\" bson:\"_id,omitempty\"`\n    Name  string\n    Phone string\n}\n\nfunc checkError(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n\nconst (\n    DB_NAME       = \"gotest\"\n    DB_COLLECTION = \"pepole_new1\"\n)\n\nfunc main() {\n    session, err := mgo.Dial(\"localhost\")\n    checkError(err)\n    defer session.Close()\n\n    session.SetMode(mgo.Monotonic, true)\n\n    c := session.DB(DB_NAME).C(DB_COLLECTION)\n    err = c.DropCollection()\n    checkError(err)\n\n    ale := Person{Name:\"Ale\", Phone:\"555-5555\"}\n    cla := Person{Name:\"Cla\", Phone:\"555-1234-2222\"}\n    kasaun := Person{Name:\"kasaun\", Phone:\"533-12554-2222\"}\n    chamila := Person{Name:\"chamila\", Phone:\"533-545-6784\"}\n\n    fmt.Println(\"Inserting\")\n    err = c.Insert(&amp;ale, &amp;cla, &amp;kasaun, &amp;chamila)\n    checkError(err)\n\n    fmt.Println(\"findbyID\")\n    var resultsID []Person\n    //err = c.FindId(bson.ObjectIdHex(\"56bdd27ecfa93bfe3d35047d\")).One(&amp;resultsID)\n    err = c.FindId(bson.M{\"Id\": bson.ObjectIdHex(\"56bdd27ecfa93bfe3d35047d\")}).One(&amp;resultsID)\n    checkError(err)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(\"Phone:\", resultsID)\n\n\n\n    fmt.Println(\"Queryingall\")\n    var results []Person\n    err = c.Find(nil).All(&amp;results)\n\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(\"Results All: \", results)\n\n\n}\n</code></pre>\n\n<p><code>FindId(bson.M{\"Id\": bson.ObjectIdHex(\"56bdd27ecfa93bfe3d35047d\")}).One(&amp;resultsID)</code> didn't work for me and giving me following output </p>\n\n<pre><code>Inserting\nQueryingall\nResults All:  [{ObjectIdHex(\"56bddee2cfa93bfe3d3504a1\") Ale 555-5555} {ObjectIdHex(\"56bddee2cfa93bfe3d3504a2\") Cla 555-1234-2222} {ObjectIdHex(\"56bddee2cfa93bfe3d3504a3\") kasaun 533-12554-2222} {ObjectIdHex(\"56bddee2cfa93bfe3d3504a4\") chamila 533-545-6784}]\nfindbyID\npanic: not found\n\ngoroutine 1 [running]:\nmain.checkError(0x7f33d524b000, 0xc8200689b0)\n</code></pre>\n\n<p>How can i fix this problem? i need get value using oid and do update also how can i do that  </p>\n"}, {"tags": ["git", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1455289506, "post_id": 35364755, "comment_id": 58437434, "body": "Also see <a href=\"https://github.com/libgit2/git2go\" rel=\"nofollow noreferrer\">github.com/libgit2/git2go</a>"}, {"owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "edited": false, "score": 0, "creation_date": 1455294847, "post_id": 35364755, "comment_id": 58441203, "body": "@elithrat is that a pure go implementation or hust a wrapper around the C lib?"}, {"owner": {"reputation": 490, "user_id": 3310759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/409b69c3ae7b431fc16129ccdadae9cd?s=128&d=identicon&r=PG", "display_name": "driusan", "link": "https://stackoverflow.com/users/3310759/driusan"}, "edited": false, "score": 0, "creation_date": 1455306388, "post_id": 35364755, "comment_id": 58447945, "body": "Do you have the .idx file or just the .pack file?"}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1455333251, "post_id": 35364755, "comment_id": 58457061, "body": "I have only the pack file."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1455333639, "post_id": 35364755, "comment_id": 58457136, "body": "@elithar git2go is a c binding so I can&#39;t use it due some environment restrictions"}], "answers": [{"tags": [], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "is_accepted": false, "score": 0, "last_activity_date": 1455370972, "creation_date": 1455370972, "answer_id": 35380668, "question_id": 35364755, "link": "https://stackoverflow.com/questions/35364755/how-to-unpack-a-git-pack-file-with-go/35380668#35380668", "title": "How to unpack a git pack file with Go?", "body": "<p>For what it's worth I ended-up with a brute-force approach. Not a robust solution but it works for what I need (decode a pack file of a known object type).</p>\n\n<pre><code>package main\n\nimport(\n    \"compress/zlib\"\n    log \"github.com/golang/glog\"\n    \"io/ioutil\"\n    \"bytes\"\n    \"flag\"\n    \"io\"\n)\n\nfunc main(){\n    flag.Parse()\n    defer log.Flush()\n    packPath := \"/Users/usr/test_pack_no_header\"\n    b, err := ioutil.ReadFile(packPath)\n    if err !=nil{\n        panic(err)\n    }\n    buf := bytes.NewBuffer(b)\n\n    i := 0\n    for {\n        decoded, err := readObjectRaw(bytes.NewBuffer(buf.Bytes()))\n        if err ==nil{\n            log.Errorf(\"i %v, decoded is %s\", i, decoded)\n            //return\n        }\n        if _, err = buf.ReadByte(); err ==  io.EOF{\n            log.Errorf(\"EOF\")\n            return\n        }\n        i++\n    }\n\n}\n\n\nfunc readObjectRaw(reader io.Reader)([]byte, error){\n    r, err := zlib.NewReader(reader)\n    if err !=nil{\n        //log.Error(err)\n        return nil, err\n    }\n    defer r.Close()\n    def := bytes.NewBuffer(nil)\n    _, err = io.Copy(def, r)\n    if err !=nil{\n        //log.Errorf(\"%v bytes copied, err %v\", i, err)\n        return nil, err\n    }\n    return def.Bytes(), nil\n}\n</code></pre>\n"}], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 350, "favorite_count": 2, "answer_count": 1, "score": 0, "last_activity_date": 1455370972, "creation_date": 1455286510, "last_edit_date": 1455333516, "question_id": 35364755, "link": "https://stackoverflow.com/questions/35364755/how-to-unpack-a-git-pack-file-with-go", "title": "How to unpack a git pack file with Go?", "body": "<p>I'm trying to unpack a git <a href=\"https://dl.dropboxusercontent.com/u/24369602/test_pack_no_header\" rel=\"nofollow\">pack file</a> using pure go. The only lib I could find is <a href=\"https://github.com/jbrukh/ggit/tree/master/api/parse\" rel=\"nofollow\">github.com/jbrukh/ggit/api -> parse</a> but I have a hard me to figure out how it is supposed to work. \n   Basically all I need is to provide the body of the pack file and get back the git objects (which I assume are compressed using zlib). I've tried several approaches including forking and trying to use the private functions but with no success(i.e it panics). </p>\n\n<pre><code>package main\n\nimport(\n\n    log \"github.com/golang/glog\"\n    \"io/ioutil\"\n    \"bytes\"\n    \"bufio\"\n    \"flag\"\n    \"os\"\n    \"github.com/jbrukh/ggit/api/parse\"\n)\n\nfunc main(){\n    flag.Parse()\n    defer log.Flush()\n    packPath := \"/Users/user/go/src/gopath/test_pack_no_header\"\n    b, err := ioutil.ReadFile(packPath)\n    if err !=nil{\n        panic(err)\n    }\n    sha := \"9eabf5b536662000f79978c4d1b6e4eff5c8d785\"\n\n    reader := bufio.NewReader(bytes.NewBuffer(b))\n    openner := func()(*os.File, error){\n        return os.Open(packPath)\n    }\n    po  := parse.NewPackIdxParser(reader, openner,  sha)\n    if err !=nil{\n        log.Error(err)\n        return\n    }\n    pack := po.ParsePack()  \n    log.Error(\"oo is %s\", pack)\n\n}\n</code></pre>\n\n<p>Panic:</p>\n\n<pre><code>go run main.go -logtostderr\npanic: expected string: \ufffdtOc\n\ngoroutine 1 [running]:\ngithub.com/jbrukh/ggit/util.PanicErrf(0x1d4b30, 0x13, 0xc8200537d8, 0x1, 0x1)\n    /Users/user/go/src/github.com/jbrukh/ggit/util/data_parser.go:72 +0x63\ngithub.com/jbrukh/ggit/util.(*DataParser).ConsumeString(0xc820086380, 0x1b3910, 0x4)\n    /Users/user/go/src/github.com/jbrukh/ggit/util/data_parser.go:226 +0x1a5\ngithub.com/jbrukh/ggit/api/parse.(*packIdxParser).parseIdx(0xc820053ed0, 0xc820053ba0)\n    /Users/user/go/src/github.com/jbrukh/ggit/api/parse/pack.go:320 +0x66\ngithub.com/jbrukh/ggit/api/parse.(*packIdxParser).ParsePack(0xc820053ed0, 0xc820086380)\n    /Users/user/go/src/github.com/jbrukh/ggit/api/parse/pack.go:400 +0x4e\nmain.main()\n    /Users/user/go/src/gopath/tools/main.go:33 +0x450\nexit status 2\nexit status 1\n2016-02-12 16:28:16.322504062 +0200 EET\n</code></pre>\n\n<p>Note: I need to unpack only a pack file and as in the attempted example above I don't have the idx file. </p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"tags": [], "owner": {"reputation": 38473, "user_id": 821657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/qDRGg.png?s=128&g=1", "display_name": "Andrei Volgin", "link": "https://stackoverflow.com/users/821657/andrei-volgin"}, "is_accepted": true, "score": 1, "last_activity_date": 1455293043, "creation_date": 1455293043, "answer_id": 35367022, "question_id": 35364628, "link": "https://stackoverflow.com/questions/35364628/setting-a-slice-as-noindex-in-datastore-does-not-take-any-effect/35367022#35367022", "title": "Setting a slice as noindex in Datastore does not take any effect", "body": "<p>Setting <code>noindex</code> will only affect new entities. Entities that have been previously saved will remain indexed until you over-write them.</p>\n"}], "owner": {"reputation": 585, "user_id": 3473875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1dc1668f1b206adf1e3c19e72f63892?s=128&d=identicon&r=PG", "display_name": "poWar", "link": "https://stackoverflow.com/users/3473875/powar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 35367022, "answer_count": 1, "score": 0, "last_activity_date": 1474814380, "creation_date": 1455286085, "last_edit_date": 1474814380, "question_id": 35364628, "link": "https://stackoverflow.com/questions/35364628/setting-a-slice-as-noindex-in-datastore-does-not-take-any-effect", "title": "Setting a slice as noindex in Datastore does not take any effect", "body": "<p>Given,</p>\n\n<pre><code>type Person struct {\n Name string `datastore:\"name\"`\n Pets []Pet `datastore:\"pets,noindex\"`\n}\n\ntype Pet struct {\n Age int `datastore:\"age\"`\n}\n</code></pre>\n\n<p>Datastore still indexes <code>Pets</code> field and all fields in <code>Pet</code>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 0, "creation_date": 1455284917, "post_id": 35363398, "comment_id": 58434236, "body": "I can&#39;t really help you as I haven&#39;t played with these packages, but at a quick glance frontmatter.Unmarshal doesn&#39;t seem to do any checks whether the second argument is a struct or not, yet it calls reflect.NumField on it which will panic on non-structs. I&#39;m guessing you&#39;ll have to find another way if you want to unmarshal into a map."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1455285137, "post_id": 35363398, "comment_id": 58434384, "body": "<code>frontmatter</code> assumes you&#39;re going to pass in a pointer to a struct but doesn&#39;t actually check for this to be the case. I&#39;d advice for a better, more robust an generalized implementation if there&#39;s one available."}, {"owner": {"reputation": 26921, "user_id": 1088797, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bltA9.png?s=128&g=1", "display_name": "Dan Prince", "link": "https://stackoverflow.com/users/1088797/dan-prince"}, "edited": false, "score": 0, "creation_date": 1455285464, "post_id": 35363398, "comment_id": 58434588, "body": "But <code>frontmatter</code> doesn&#39;t actually do anything with the pointer itself, it just <a href=\"https://github.com/ericaro/frontmatter/blob/master/frontmatter.go#L73\" rel=\"nofollow noreferrer\">forwards it on to <code>yaml.Unmarshal</code></a> which is shown to take a map in the example."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1455285623, "post_id": 35363398, "comment_id": 58434696, "body": "@DanPrince correct, but after doing that it then calls <code>frontmatter.WriteString</code>, which calls <code>findField</code> which calls reflect&#39;s <code>NumField</code>, blindly assuming that you&#39;re passing a pointer to a struct."}, {"owner": {"reputation": 26921, "user_id": 1088797, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bltA9.png?s=128&g=1", "display_name": "Dan Prince", "link": "https://stackoverflow.com/users/1088797/dan-prince"}, "edited": false, "score": 0, "creation_date": 1455285833, "post_id": 35363398, "comment_id": 58434823, "body": "Ah, yep. Should have seen that from the stack trace."}], "answers": [{"tags": [], "owner": {"reputation": 26921, "user_id": 1088797, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bltA9.png?s=128&g=1", "display_name": "Dan Prince", "link": "https://stackoverflow.com/users/1088797/dan-prince"}, "is_accepted": true, "score": 0, "last_activity_date": 1455288358, "creation_date": 1455288358, "answer_id": 35365396, "question_id": 35363398, "link": "https://stackoverflow.com/questions/35363398/interface-with-unknown-properties/35365396#35365396", "title": "Interface with unknown properties", "body": "<p>Turns out that the raw <code>yaml.Unmarshal</code> method is robust enough to only pick up the front matter, even when presented with the entire file.</p>\n\n<p>The solution I ended up using looks like this.</p>\n\n<pre><code>// read file made up of front matter and content\ndata, err := ioutil.ReadFile(file)\n\nif err != nil {\n  log.Fatal(err)\n}\n\nmeta := make(map[interface{}]interface{})\nyaml.Unmarshal([]byte(data), &amp;meta)\n</code></pre>\n\n<p>This means dropping the <code>frontmatter</code> package and using the <code>yaml</code> package directly.</p>\n"}], "owner": {"reputation": 26921, "user_id": 1088797, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bltA9.png?s=128&g=1", "display_name": "Dan Prince", "link": "https://stackoverflow.com/users/1088797/dan-prince"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 35365396, "answer_count": 1, "score": 3, "last_activity_date": 1455288358, "creation_date": 1455282350, "question_id": 35363398, "link": "https://stackoverflow.com/questions/35363398/interface-with-unknown-properties", "title": "Interface with unknown properties", "body": "<p>I'm trying to use the <a href=\"https://godoc.org/github.com/ericaro/frontmatter#Unmarshal\" rel=\"nofollow\"><code>Unmarshal</code> method</a> from the <a href=\"https://godoc.org/github.com/ericaro/frontmatter\" rel=\"nofollow\">frontmatter</a> package to parse front matter from a markdown file.</p>\n\n<p>The type signature for the function is as follows</p>\n\n<pre><code>func Unmarshal(data []byte, v interface{}) (err error)\n</code></pre>\n\n<p>I've got the byte data and I understand that I need to pass an interface/struct with the appropriate fields as the second argument\u2014however I don't know what the fields are going to be in the files that I parse and it's important that I don't lose data.</p>\n\n<p>Internally this package uses <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow\">yaml.v2</a> which provides a more comprehensive example for defining the interface before unmarshaling.</p>\n\n<pre><code>type T struct {\n    A string\n    B struct {\n        RenamedC int   `yaml:\"c\"`\n        D        []int `yaml:\",flow\"`\n    }\n}\n</code></pre>\n\n<p>Then create an instance of the struct <code>t</code> and pass a pointer to <code>t</code> through to <code>Unmarshal</code>.</p>\n\n<pre><code>t := T{}\n\nerr := yaml.Unmarshal([]byte(data), &amp;t)\n</code></pre>\n\n<p>As I understand, this is only going to work if the YAML looks like this:</p>\n\n<pre><code>a: Easy!\nb:\n  c: 2\n  d: [3, 4]\n</code></pre>\n\n<p>The second example looks closer to what I need. Rather than creating a struct, it seems to use a map of <code>interface{} -&gt; interface{}</code>.</p>\n\n<pre><code>m := make(map[interface{}]interface{})\n\nerr = yaml.Unmarshal([]byte(data), &amp;m)\n</code></pre>\n\n<p>I'm relatively new to Go and to me this looks like a generic map, which would be ideal for reading in unknown values.</p>\n\n<p>I've adapted the example for my own project and ended up with the following code.</p>\n\n<pre><code>m := make(map[interface{}]interface{})\nerr := frontmatter.Unmarshal(data, &amp;m)\n</code></pre>\n\n<p>But this results in a runtime error</p>\n\n<blockquote>\n<pre><code>panic: reflect: NumField of non-struct type\n</code></pre>\n</blockquote>\n\n<p>Full stacktrace <a href=\"https://gist.github.com/danprince/b5672db782a4f14451e2\" rel=\"nofollow\">here</a>.</p>\n\n<hr>\n\n<p>Am I heading in the right direction? If so, what's going wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 806, "user_id": 2547389, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f943f94b1bfe169a3291c5b94b7f938a?s=128&d=identicon&r=PG", "display_name": "wlredeye", "link": "https://stackoverflow.com/users/2547389/wlredeye"}, "edited": false, "score": 0, "creation_date": 1455281824, "post_id": 35362948, "comment_id": 58432189, "body": "Do you want to create a slice of servers that contains details(Name, IPAddress) for each server?"}, {"owner": {"reputation": 1046, "user_id": 1381490, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/24b364d9482cf1733dfc2cc1c992471b?s=128&d=identicon&r=PG&f=1", "display_name": "intrixius", "link": "https://stackoverflow.com/users/1381490/intrixius"}, "reply_to_user": {"reputation": 806, "user_id": 2547389, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f943f94b1bfe169a3291c5b94b7f938a?s=128&d=identicon&r=PG", "display_name": "wlredeye", "link": "https://stackoverflow.com/users/2547389/wlredeye"}, "edited": false, "score": 0, "creation_date": 1455282063, "post_id": 35362948, "comment_id": 58432330, "body": "No, <code>servers</code> is already holding all the details on multiple servers, where each server has the elements <code>Name</code> and <code>IPAddress</code>. Will update the question a bit"}, {"owner": {"reputation": 806, "user_id": 2547389, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f943f94b1bfe169a3291c5b94b7f938a?s=128&d=identicon&r=PG", "display_name": "wlredeye", "link": "https://stackoverflow.com/users/2547389/wlredeye"}, "edited": false, "score": 0, "creation_date": 1455282484, "post_id": 35362948, "comment_id": 58432591, "body": "I just don&#39;t understand what you want to print out?"}, {"owner": {"reputation": 1046, "user_id": 1381490, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/24b364d9482cf1733dfc2cc1c992471b?s=128&d=identicon&r=PG&f=1", "display_name": "intrixius", "link": "https://stackoverflow.com/users/1381490/intrixius"}, "reply_to_user": {"reputation": 806, "user_id": 2547389, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f943f94b1bfe169a3291c5b94b7f938a?s=128&d=identicon&r=PG", "display_name": "wlredeye", "link": "https://stackoverflow.com/users/2547389/wlredeye"}, "edited": false, "score": 0, "creation_date": 1455283023, "post_id": 35362948, "comment_id": 58432940, "body": "see my multiple edits to make it more clear hopefully"}], "answers": [{"comments": [{"owner": {"reputation": 1046, "user_id": 1381490, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/24b364d9482cf1733dfc2cc1c992471b?s=128&d=identicon&r=PG&f=1", "display_name": "intrixius", "link": "https://stackoverflow.com/users/1381490/intrixius"}, "edited": false, "score": 0, "creation_date": 1455283861, "post_id": 35363731, "comment_id": 58433555, "body": "You&#39;re quite right that I come from JS and Python ;-) the serverVariables initialization was indeed wrong in this example, because I copy/pasted it from my original source code"}, {"owner": {"reputation": 1046, "user_id": 1381490, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/24b364d9482cf1733dfc2cc1c992471b?s=128&d=identicon&r=PG&f=1", "display_name": "intrixius", "link": "https://stackoverflow.com/users/1381490/intrixius"}, "edited": false, "score": 0, "creation_date": 1455284268, "post_id": 35363731, "comment_id": 58433822, "body": "It works, thanks! I am aware now that the compiler will not catch typos and stuff when using the <code>FieldByName</code> approach"}, {"owner": {"reputation": 1046, "user_id": 1381490, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/24b364d9482cf1733dfc2cc1c992471b?s=128&d=identicon&r=PG&f=1", "display_name": "intrixius", "link": "https://stackoverflow.com/users/1381490/intrixius"}, "edited": false, "score": 0, "creation_date": 1455284364, "post_id": 35363731, "comment_id": 58433893, "body": "small additional question, is <code>fmt.Println(reflect.ValueOf(server).FieldByName(element))</code> faster/better then using an additional variable <code>v</code> as you did?"}, {"owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "reply_to_user": {"reputation": 1046, "user_id": 1381490, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/24b364d9482cf1733dfc2cc1c992471b?s=128&d=identicon&r=PG&f=1", "display_name": "intrixius", "link": "https://stackoverflow.com/users/1381490/intrixius"}, "edited": false, "score": 0, "creation_date": 1455284677, "post_id": 35363731, "comment_id": 58434067, "body": "It&#39;s actually slower, because it has to create reflect.Value for every field you want to read."}, {"owner": {"reputation": 1046, "user_id": 1381490, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/24b364d9482cf1733dfc2cc1c992471b?s=128&d=identicon&r=PG&f=1", "display_name": "intrixius", "link": "https://stackoverflow.com/users/1381490/intrixius"}, "edited": false, "score": 0, "creation_date": 1455284719, "post_id": 35363731, "comment_id": 58434095, "body": "indeed, could have thought of that myself ;-)"}], "tags": [], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "is_accepted": true, "score": 0, "last_activity_date": 1455285247, "last_edit_date": 1455285247, "creation_date": 1455283402, "answer_id": 35363731, "question_id": 35362948, "link": "https://stackoverflow.com/questions/35362948/convert-array-of-strings-to-field-name/35363731#35363731", "title": "Convert array of strings to field name", "body": "<p>Reflection is what you probably want to use:</p>\n\n<pre><code>for _, server := range servers {\n    v := reflect.ValueOf(server)\n    for _, element := range serverVariables {\n        fmt.Println(v.FieldByName(element))\n    }\n}\n</code></pre>\n\n<p>You should also change <code>serverVariables</code> initialization to be <code>serverVariables := []string{}</code></p>\n\n<p>Playground example: <a href=\"https://play.golang.org/p/s_kzIJ7-B7\" rel=\"nofollow\">https://play.golang.org/p/s_kzIJ7-B7</a></p>\n\n<p>It seems to me that you have experience in some dynamic language like Python or JavaScript. Go is compiled and strongly typed. Besides reflection being slower, when using it compiler can't help you with finding basic errors in your code and what is most important you lose type of the accessed variable.\nMore info on <a href=\"http://blog.golang.org/laws-of-reflection\" rel=\"nofollow\">http://blog.golang.org/laws-of-reflection</a></p>\n\n<p>So I strongly recommend you to keep your current approach:</p>\n\n<pre><code>for _, server := range servers {\n   fmt.Println(server.Name)\n   fmt.Println(server.IPAddress)\n}\n</code></pre>\n"}], "owner": {"reputation": 1046, "user_id": 1381490, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/24b364d9482cf1733dfc2cc1c992471b?s=128&d=identicon&r=PG&f=1", "display_name": "intrixius", "link": "https://stackoverflow.com/users/1381490/intrixius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 35363731, "answer_count": 1, "score": 0, "last_activity_date": 1455285247, "creation_date": 1455280920, "last_edit_date": 1455284889, "question_id": 35362948, "link": "https://stackoverflow.com/questions/35362948/convert-array-of-strings-to-field-name", "title": "Convert array of strings to field name", "body": "<p>Newbie question:\nI want to print various variables of a library (is that the correct name? <code>reflect.TypeOf(servers)</code> gives <code>[]lib.Server</code>)</p>\n\n<p>I want to do something like this, but this obviously does not work:</p>\n\n<pre><code>servers, err := GetClient().GetServers() //call to external API\n\nserverVariables := []string{}\nserverVariables = append(serverVariables, \"Name\")\nserverVariables = append(serverVariables, \"IPAddress\")\n\nfor _, server := range servers {\n   for _,element := range serverVariables {\n     fmt.Println(server.element)\n   }\n}\n</code></pre>\n\n<p>What I already can do is the following (but I want to do it using the above approach):</p>\n\n<pre><code>servers, err := GetClient().GetServers() //call to external API\n\nfor _, server := range servers {\n   fmt.Println(server.Name)\n   fmt.Println(server.IPAddress)\n}\n</code></pre>\n\n<p>giving the following output:</p>\n\n<pre><code>ServerNameOne\n192.168.0.1\nServerNameTwo\n192.168.0.2\n</code></pre>\n"}, {"tags": ["dictionary", "go", "hashmap", "slice", "key-value"], "answers": [{"tags": [], "owner": {"reputation": 806, "user_id": 2547389, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f943f94b1bfe169a3291c5b94b7f938a?s=128&d=identicon&r=PG", "display_name": "wlredeye", "link": "https://stackoverflow.com/users/2547389/wlredeye"}, "is_accepted": true, "score": 14, "last_activity_date": 1520867989, "last_edit_date": 1520867989, "creation_date": 1455280145, "answer_id": 35362695, "question_id": 35362459, "link": "https://stackoverflow.com/questions/35362459/golang-create-a-slice-of-maps/35362695#35362695", "title": "Golang create a slice of maps", "body": "<p><code>keyvalue</code> is a <strong>variable</strong> not a <strong>type</strong>, you can't create a slice of variables. If you want to define custom type you can do this like</p>\n\n<pre><code>type keyvalue map[string]interface{}\n</code></pre>\n\n<p>then you can create a slice of <code>keyvalue</code>s:</p>\n\n<pre><code>keyvalueslice := make([]keyvalue, 1, 1)\n</code></pre>\n\n<p>Example on <a href=\"https://play.golang.org/p/8MraIphEmlC\" rel=\"noreferrer\">playground</a></p>\n\n<p>Or you can do this without defining custom type:</p>\n\n<pre><code>keyvalueslice := make([]map[string]interface{}, 1, 1)\n</code></pre>\n"}], "owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16309, "favorite_count": 2, "accepted_answer_id": 35362695, "answer_count": 1, "score": 10, "last_activity_date": 1582895813, "creation_date": 1455279385, "last_edit_date": 1455319894, "question_id": 35362459, "link": "https://stackoverflow.com/questions/35362459/golang-create-a-slice-of-maps", "title": "Golang create a slice of maps", "body": "<p>I was trying to create a slice of maps the following way.</p>\n\n<pre><code>keyvalue := make(map[string]interface{})\nkeyvalueslice := make([]keyvalue, 1, 1)\n</code></pre>\n\n<p>I was trying to create it just like the way string slice is created, however I am getting an error saying <code>keyvalue is not a type.</code> I am creating this slice to append data to <code>keyvalueslice</code> variable later. </p>\n\n<p>Can someone explain what is wrong?</p>\n"}, {"tags": ["go", "profiling", "pprof"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1455276973, "post_id": 35360089, "comment_id": 58429047, "body": "The <code>defer</code> in <code>main</code> never runs because <code>http.ListenAndServe</code> blocks forever. You get multiple files when you put it in the request handler because the handler is called multiple times and each time creates a new profile."}, {"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1455277156, "post_id": 35360089, "comment_id": 58429165, "body": "but if i write it in the before calling <code>serveHTTP</code>. It&#39;s doesn&#39;t write anything in the file."}, {"owner": {"reputation": 1749, "user_id": 3243380, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrCc3.jpg?s=128&g=1", "display_name": "nussjustin", "link": "https://stackoverflow.com/users/3243380/nussjustin"}, "edited": false, "score": 1, "creation_date": 1455282417, "post_id": 35360089, "comment_id": 58432555, "body": "You can&#39;t use the <code>defer profile.Start(profile.CPUProfile).Stop()</code> line in main, as the defer will never be called (ListenAndServe blocks and waits forever). When you call <code>defer profile.Start(profile.CPUProfile).Stop()</code> in your serveHTTP function, the profiler is already running (from main) so it won&#39;t write anything (as the profiler can&#39;t run more than once at a time)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1455286262, "post_id": 35360089, "comment_id": 58435113, "body": "You can&#39;t profile a single handler by itself. pprof is a sampling profiler, so unless the handler runs for a very long time, you&#39;re not going to get any samples. Profile your entire app, and just generate sufficient load on your handler. This is even easier if you import <a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow noreferrer\">&quot;net/http/pprof&quot;</a> and profile the running binary."}], "answers": [{"comments": [{"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 2, "creation_date": 1455286418, "post_id": 35364699, "comment_id": 58435223, "body": "+1. And if you really want to use the standard profiler, use <code>os&#47;signal</code> to implement a graceful shutdown (or a graceful shutdown library), so your defer will be called when needed."}, {"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1455305104, "post_id": 35364699, "comment_id": 58447246, "body": "@fl0cke I wil try this. Could you please also tell. Lines which I have attached definitely has memory leaks and it clearly indicate it is due to [] byte and s3client. So, is there any method to destroy or close them in go lang"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 1, "creation_date": 1455311038, "post_id": 35364699, "comment_id": 58450177, "body": "@Naresh: this isn&#39;t what this kind of profiling is for, and those lines on their own don&#39;t signify any memory leak.  Go is garbage collected, so there&#39;s no outright way to destroy a <code>[]byte</code>, and an <code>*S3</code> doesn&#39;t have a close method.  We can&#39;t tell from the code fragments, but it looks like you&#39;re not checking the error returned from <code>GetObject</code> (<i>always check errors</i>), nor are you closing the response body from <code>GetObject</code>."}, {"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1455449361, "post_id": 35364699, "comment_id": 58486374, "body": "@JimB Thanking you. I handled the error and close the response body. Could you please tell me if i don&#39;t handle the error would it leave a memory leak? Moreover, If memory profiler doesn&#39;t give the true memory leak points then how do we find out from where does memory leak happens."}, {"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1455530712, "post_id": 35364699, "comment_id": 58514098, "body": "@fl0cke As you suggested I imported the <code>&quot;net&#47;http&#47;pprof&quot;</code> and tried to browse the same Url. But it  give the <code>ERROR:  Not sufficient parameters were provided</code>. Reason being key passed to s3 client would be empty. FYI, as you can see I am using the default mux in my code"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1455553759, "post_id": 35364699, "comment_id": 58529504, "body": "@Naresh: go has a fully precise garbage collector, so in essence there is no such thing as a &quot;memory leak&quot; -- the only way to leak resources is to have running code referencing them. The memory profiler shows where memory is allocated, but it can&#39;t tell you where you should have released those resources. Even without looking at the source, it could be assumed that the response references a network connection, and probably everything required for an http request, which needs to be cleaned up. Not handling the error leaves the possibility of having an invalid response and possibility of panics."}], "tags": [], "owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "is_accepted": false, "score": 4, "last_activity_date": 1455286289, "creation_date": 1455286289, "answer_id": 35364699, "question_id": 35360089, "link": "https://stackoverflow.com/questions/35360089/profiling-http-handler-in-go-lang/35364699#35364699", "title": "profiling http handler in go lang", "body": "<p>To profile a http server while it's running you can use the <a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow\"><code>net/http/pprof</code></a> package. </p>\n\n<p>Just add </p>\n\n<pre><code>import _ \"net/http/pprof\"\n</code></pre>\n\n<p>to your imports and open <code>http://localhost:8081/debug/pprof/</code> in your browser.</p>\n"}, {"tags": [], "owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "is_accepted": true, "score": 2, "last_activity_date": 1613269021, "last_edit_date": 1613269021, "creation_date": 1455536250, "answer_id": 35408377, "question_id": 35360089, "link": "https://stackoverflow.com/questions/35360089/profiling-http-handler-in-go-lang/35408377#35408377", "title": "profiling http handler in go lang", "body": "<p>First of all use <code>import &quot;net/http/pprof&quot;</code> <strong>NOT import _ &quot;net/http/pprof</strong>. later one didn't recognize the <code>pprof</code> in the below routes.</p>\n<p>I was using the default serveMux/multiplexer. But then I created my own as people suggested it has performance implication.</p>\n<pre><code>myMux := http.NewServeMux()\n</code></pre>\n<p>Then added the route for the request</p>\n<pre><code>myMux.HandleFunc(&quot;/&quot;, serveHTTP)\n</code></pre>\n<p>Morever, I also added the routes for to make the <code>http://localhost:8081/debug/pprof/</code> work</p>\n<pre><code>        myMux.HandleFunc(&quot;/debug/pprof/&quot;, pprof.Index)\n        myMux.HandleFunc(&quot;/debug/pprof/{action}&quot;, pprof.Index)\n        myMux.HandleFunc(&quot;/debug/pprof/symbol&quot;, pprof.Symbol)\n</code></pre>\n<p>So, final code would be :</p>\n<p>import &quot;net/http/pprof</p>\n<pre><code>func main() {                                    \n        \n        myMux := http.NewServeMux()\n        myMux.HandleFunc(&quot;/&quot;, serveHTTP)\n\n        myMux.HandleFunc(&quot;/debug/pprof/&quot;, pprof.Index)\n        myMux.HandleFunc(&quot;/debug/pprof/{action}&quot;, pprof.Index)\n        myMux.HandleFunc(&quot;/debug/pprof/symbol&quot;, pprof.Symbol)   \n\n    if err := http.ListenAndServe(&quot;:8081&quot;, myMux); err != nil {\n        logFatal(&quot;Error when starting or running http server: %v&quot;, err)\n    }       \n\n}\n</code></pre>\n"}], "owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1475, "favorite_count": 0, "accepted_answer_id": 35408377, "answer_count": 2, "score": 1, "last_activity_date": 1613269021, "creation_date": 1455272532, "last_edit_date": 1455280506, "question_id": 35360089, "link": "https://stackoverflow.com/questions/35360089/profiling-http-handler-in-go-lang", "title": "profiling http handler in go lang", "body": "<p>I am trying to profile my http handler written in go. Which on every http request download an image from S3, resize it/crop it and write it in response. </p>\n\n<p>I have followed this <a href=\"http://saml.rilspace.org/profiling-and-creating-call-graphs-for-go-programs-with-go-tool-pprof#rest\" rel=\"nofollow\">link</a> and tried to profile my code as mentioned using easy method as well as hard method. Now, when i use the following line as mentioned in the code. </p>\n\n<pre><code>defer profile.Start(profile.CPUProfile).Stop() \n</code></pre>\n\n<p>It doesn't write anything in the <code>/tmp/profie[some number]/cpu.pprof</code> file</p>\n\n<pre><code>func main() {                                    \n\n       defer profile.Start(profile.CPUProfile).Stop()   \n\n      if err := http.ListenAndServe(\":8081\", http.HandlerFunc(serveHTTP)); err != nil {\n       logFatal(\"Error when starting or running http server: %v\", err)\n    }       \n}\n\nfunc serveHTTP(w http.ResponseWriter, r *http.Request) {\n        keyName := r.URL.Path[1:]\n        s3Client := s3.New(session.New(), &amp;aws.Config{Region: aws.String(region)})\n        params := &amp;s3.GetObjectInput{\n        Bucket: aws.String(bucketName),\n        Key: aws.String(keyName),\n        }\n\n    mw := imagick.NewMagickWand()\n    defer mw.Destroy()\n    ...\n}\n</code></pre>\n\n<p>Moreover, when i used the <code>defer profile.Start(profile.CPUProfile).Stop()</code> line inside the <code>serveHTTP</code> like :</p>\n\n<pre><code>func serveHTTP(w http.ResponseWriter, r *http.Request) {\n\n    defer profile.Start(profile.CPUProfile).Stop()\n    ......\n}\n</code></pre>\n\n<p>It creates multiple files in the <code>/tmp/profile[some number]</code> folder. So, first question is why it is not writing in the file and secondly shouldn't it be places inside the <code>serveHTTP method</code> because server will get started only once. Hence <code>main()</code> will be called once wheres <code>serveHTTP</code> wil be called on every request. </p>\n\n<p>Part 1 </p>\n\n<pre><code> .               124:   s3Client := s3.New(session.New(), &amp;aws.Config{Region: aws.String(region)})\n .          .    125:        params := &amp;s3.GetObjectInput{\n .          .    126:       Bucket: aws.String(masterBucketName),\n .          .    127:       Key: aws.String(keyName),\n .    32.01kB    128:       }\n .          .    129:\n .          .    130:   mw := imagick.NewMagickWand()\n .          .    131:   defer mw.Destroy()\n .          .    132:   \n .          .    133:   out, err := s3Client.GetObject(params)          \n .          .    134:\n .          .    135:   if strings.EqualFold(keyName[strings.LastIndex(keyName,\".\")+1:len(keyName)], \"gif\") {\n .          .    136:\n .    40.11kB    137:       blobGiff, err := ioutil.ReadAll(out.Body)\n .          .    138:       w.Header().Set(\"Content-Type\", \"image/gif\")\n .          .    139:       w.Header().Set(\"Cache-Control\", \"max-age: 604800, public\")  \n .          .    140:       w.Header().Set(\"Last-Modified\", time.Now().Format(http.TimeFormat))\n .          .    141:       w.Header().Set(\"Expires\", time.Now().AddDate(1, 0, 0).Format(http.TimeFormat))  \n .          .    142:\n</code></pre>\n\n<p>Part 2 :</p>\n\n<pre><code>                                   else {\n         .          .    167:       img, err := ioutil.ReadAll(out.Body)\n         .          .    168:       if err != nil {\n         .          .    169:          \n         .          .    170:          w.WriteHeader(http.StatusNotFound) \n         .     1.56MB    171:          return      \n         .          .    172:       }   \n</code></pre>\n\n<p>Also, in the above two parts line 128, 137 and 171 has memory leaks, right? Also, I don't find any option to close/destroy the <code>s3Client</code> and <code>blobGiff</code> (byte []). </p>\n"}, {"tags": ["string", "replace", "go"], "answers": [{"comments": [{"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1455273496, "post_id": 35360396, "comment_id": 58426842, "body": "If the strings are obtained by iterating a huge slice, which one would you recommend for performance? Regex or iteration?"}, {"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "reply_to_user": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1455273607, "post_id": 35360396, "comment_id": 58426908, "body": "I would still recommed regex, though if you want to merge those strings later (say, into a slice) then <code>string.Split()</code> and iteration might be a better choice."}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1455273643, "post_id": 35360396, "comment_id": 58426931, "body": "Thank you @REACHUS. Much appreciated."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1455277481, "post_id": 35360396, "comment_id": 58429363, "body": "I disagree. &quot;If the strings are obtained in a <b>huge</b> slice&quot;, aka []string. So, in order to apply the regex, you&#39;d need to convert said huge slice to a string consuming both time and memory, only to apply the regex after then and converting the string back to a []string. Actually, a blank line in a []string would be denoted by the <i>rune</i> <code>&#39;\\n&#39;</code> which could be identified by a simple comparison."}, {"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1455279293, "post_id": 35360396, "comment_id": 58430556, "body": "@MarkusWMahlberg As I have understand it, a single element a <code>[]string</code> would contain a string with mutlitple lines. Then, it would make sense to filter out empty lines with a regex. <b>However</b>, if a single element of a slice would represent a single line, it would of course be more efficient to iterate over the slice and check if an element is an empty line by comparing it to <code>&#39;\\n&#39;</code>."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1455282576, "post_id": 35360396, "comment_id": 58432641, "body": "As I have read it, the string would be constructed from a slice. Well, your comments should make that clear. ;)"}], "tags": [], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "is_accepted": true, "score": 2, "last_activity_date": 1455273394, "creation_date": 1455273394, "answer_id": 35360396, "question_id": 35360080, "link": "https://stackoverflow.com/questions/35360080/golang-idiomatic-way-to-remove-a-blank-line-from-a-multi-line-string/35360396#35360396", "title": "Golang idiomatic way to remove a blank line from a multi-line string", "body": "<p>Assumming that you want to have the same string with empty lines removed as an output, I would use regular expressions:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n\n    var s = `line 1\nline 2\n\nline 3`\n\n    regex, err := regexp.Compile(\"\\n\\n\")\n    if err != nil {\n        return\n    }\n    s = regex.ReplaceAllString(s, \"\\n\")\n\n    fmt.Println(s)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 165, "user_id": 5155378, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rqX7q.jpg?s=128&g=1", "display_name": "john", "link": "https://stackoverflow.com/users/5155378/john"}, "edited": false, "score": 0, "creation_date": 1586553486, "post_id": 39514341, "comment_id": 108178288, "body": "This should be the better answer"}], "tags": [], "owner": {"reputation": 434, "user_id": 3961221, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y8Wtj.jpg?s=128&g=1", "display_name": "plamer", "link": "https://stackoverflow.com/users/3961221/plamer"}, "is_accepted": false, "score": 1, "last_activity_date": 1474277006, "last_edit_date": 1474277006, "creation_date": 1473951579, "answer_id": 39514341, "question_id": 35360080, "link": "https://stackoverflow.com/questions/35360080/golang-idiomatic-way-to-remove-a-blank-line-from-a-multi-line-string/39514341#39514341", "title": "Golang idiomatic way to remove a blank line from a multi-line string", "body": "<p>Similar to \u0394\u03bb\u041b's answer it can be done with strings.Replace:</p>\n\n<blockquote>\n  <p>func Replace(s, old, new string, n int) string\n  Replace returns a copy of the string s with the first n non-overlapping instances of old replaced by new. If old is empty, it matches at the beginning of the string and after each UTF-8 sequence, yielding up to k+1 replacements for a k-rune string. If n &lt; 0, there is no limit on the number of replacements.</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n\n    var s = `line 1\nline 2\n\nline 3`\n\n    s = strings.Replace(s, \"\\n\\n\", \"\\n\", -1)\n\n    fmt.Println(s)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/lu5UI74SLo\" rel=\"nofollow\">https://play.golang.org/p/lu5UI74SLo</a></p>\n"}, {"tags": [], "owner": {"reputation": 795, "user_id": 3479043, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xGd30.png?s=128&g=1", "display_name": "xh3b4sd", "link": "https://stackoverflow.com/users/3479043/xh3b4sd"}, "is_accepted": false, "score": 0, "last_activity_date": 1563442527, "creation_date": 1563442527, "answer_id": 57091438, "question_id": 35360080, "link": "https://stackoverflow.com/questions/35360080/golang-idiomatic-way-to-remove-a-blank-line-from-a-multi-line-string/57091438#57091438", "title": "Golang idiomatic way to remove a blank line from a multi-line string", "body": "<p>The more generic approach would be something like this maybe.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n    \"strings\"\n)\n\nfunc main() {\n    s := `\n\n\n    #### \n\n    ####\n\n\n\n\n    ####\n\n\n    ####\n\n\n\n\n    `\n\n    fmt.Println(regexp.MustCompile(`[\\t\\r\\n]+`).ReplaceAllString(strings.TrimSpace(s), \"\\n\"))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/uWyHfUIDw-o\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uWyHfUIDw-o</a></p>\n"}], "owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9424, "favorite_count": 0, "accepted_answer_id": 35360396, "answer_count": 3, "score": 4, "last_activity_date": 1563442527, "creation_date": 1455272510, "question_id": 35360080, "link": "https://stackoverflow.com/questions/35360080/golang-idiomatic-way-to-remove-a-blank-line-from-a-multi-line-string", "title": "Golang idiomatic way to remove a blank line from a multi-line string", "body": "<p>If I have a multi line string like</p>\n\n<pre><code>this is a line\n\nthis is another line\n</code></pre>\n\n<p>what is the best way to remove the empty line? I could make it work by splitting, iterating, and doing a condition check, but is there a better way?</p>\n"}, {"tags": ["go", "struct", "datastore"], "comments": [{"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 2, "creation_date": 1455271643, "post_id": 35358946, "comment_id": 58425592, "body": "About the <code>json:&quot;name&quot;</code> thing: <a href=\"http://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go\" title=\"what are the uses for tags in go\">stackoverflow.com/questions/10858787/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 0, "last_activity_date": 1455269911, "creation_date": 1455269911, "answer_id": 35359189, "question_id": 35358946, "link": "https://stackoverflow.com/questions/35358946/how-can-i-add-a-new-boolean-property-to-a-golang-struct-and-set-the-default-valu/35359189#35359189", "title": "How can I add a new boolean property to a Golang struct and set the default value to true?", "body": "<p>You have to set the default value as true at the moment when you are passing the struct type to a variable, but this means you need to extend that struct with a  new <code>Active</code> field.</p>\n\n<pre><code>type User struct {\n    Id              int64     `json:\"id\"`\n    Name            string    `json:\"name\"`\n    Active          bool\n}\n\nuser := User{1, \"John\", true}\n</code></pre>\n\n<p><code>json:\"id\"</code> means that you are mapping the json decoded object field to the field <code>id</code> in your struct type. Practically you are deserialize the json string into object fields which later you can map to their specific field inside the struct.</p>\n"}, {"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1455283072, "post_id": 35363433, "comment_id": 58432975, "body": "I think more idiomatic would be <code>NewUser</code>, with <code>Active</code> set to true when this is the default value and provide a <code>Deactivate()</code> method."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 2, "last_activity_date": 1455282506, "creation_date": 1455282506, "answer_id": 35363433, "question_id": 35358946, "link": "https://stackoverflow.com/questions/35358946/how-can-i-add-a-new-boolean-property-to-a-golang-struct-and-set-the-default-valu/35363433#35363433", "title": "How can I add a new boolean property to a Golang struct and set the default value to true?", "body": "<pre><code>//You can't change declared type.\ntype User struct {\n    Id              int64     `json:\"id\"`\n    Name            string    `json:\"name\"`\n}\n//Instead you construct a new one embedding existent\ntype ActiveUser struct {\n    User\n    Active bool\n}\n//you instantiate type literally\nuser := User{1, \"John\"}\n//and you can provide constructor for your type\nfunc MakeUserActive(u User) ActiveUser {\n    auser := ActiveUser{u, true}\n    return auser\n}\nactiveuser := MakeUserActive(user)\n</code></pre>\n\n<p>You can see it works <a href=\"https://play.golang.org/p/UU7RAn5RVK\" rel=\"nofollow\">https://play.golang.org/p/UU7RAn5RVK</a></p>\n"}], "owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5005, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1455282506, "creation_date": 1455269147, "question_id": 35358946, "link": "https://stackoverflow.com/questions/35358946/how-can-i-add-a-new-boolean-property-to-a-golang-struct-and-set-the-default-valu", "title": "How can I add a new boolean property to a Golang struct and set the default value to true?", "body": "<p>I have a user struct that corresponds to an entity. How can I add a new property <code>active</code> and set the default value to <code>true</code>?</p>\n\n<p>Can I also set the value of that property to <code>true</code> for all existing entities by some easy method?</p>\n\n<pre><code>type User struct {\n    Id              int64     `json:\"id\"`\n    Name            string    `json:\"name\"`\n}\n</code></pre>\n\n<p>Bonus questions: I don't quite understand the syntax in the struct. What do the three columns represent? What do the JSON strings have ``around them?</p>\n"}]