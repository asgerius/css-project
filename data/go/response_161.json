[{"tags": ["go", "struct", "yaml", "unmarshalling"], "answers": [{"tags": [], "owner": {"reputation": 1529, "user_id": 3029676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qTCxh.png?s=128&g=1", "display_name": "wgoodall01", "link": "https://stackoverflow.com/users/3029676/wgoodall01"}, "is_accepted": false, "score": 1, "last_activity_date": 1518060732, "creation_date": 1518060732, "answer_id": 48677092, "question_id": 48674624, "link": "https://stackoverflow.com/questions/48674624/unmarshal-a-yaml-to-a-struct-with-unexpected-fields-in-go/48677092#48677092", "title": "Unmarshal a YAML to a struct with unexpected fields in Go", "body": "<p>Because most Go unmarshalling packages (including the <code>encoding/*</code> packages) use the <code>reflect</code> package to get at struct fields, and <code>reflect</code> can't access unexported struct fields, the unmarshaler can't parse into unexported fields.</p>\n\n<p>That said, there is still a way to do it. You can unmarshall the YAML into an an unexported type with public fields, which can then be embedded into an exported type. Getters and setters in the same package can just use the embedded struct.</p>\n\n<p>For example:</p>\n\n<pre><code>// Define the types...\n\ntype innerData struct {\n    ExportedField string\n    unexportedField string\n}\n\ntype Data struct {\n    innerData\n}\n\n\n// and then...\n\nd := Data{}\nDoSomeUnmarshalling(yamlbytes, &amp;d.innerData)\n\n\n// and then you can use getters/setters/whatever on `Data`\n\nfunc (d *Data) GetUnexported() string {\n    return d.innerData.unexportedField;\n}\n</code></pre>\n\n<p>(warning: completely untested)</p>\n\n<p>See <a href=\"https://stackoverflow.com/questions/11126793/json-and-dealing-with-unexported-fields\">JSON and dealing with unexported fields</a> for reference.</p>\n"}], "owner": {"reputation": 237, "user_id": 1946459, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/d4ba3f1a4f7308f53ece5bb4872bb505?s=128&d=identicon&r=PG", "display_name": "xaxes", "link": "https://stackoverflow.com/users/1946459/xaxes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1685, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1518204008, "creation_date": 1518043728, "last_edit_date": 1518204008, "question_id": 48674624, "link": "https://stackoverflow.com/questions/48674624/unmarshal-a-yaml-to-a-struct-with-unexpected-fields-in-go", "title": "Unmarshal a YAML to a struct with unexpected fields in Go", "body": "<p>I encountered an issue while trying to unmarshal a struct with an unexported field using <code>github.com/go-yaml/yaml</code>. The struct looks like:</p>\n\n<pre><code>type Example struct {\n    ExportedField   string                     `yaml:\"exported-field\"`\n    OneMoreExported string                     `yaml:\"one-more-exported\"`\n    unexportedField map[string]*AnotherExample `yaml:\"unexported-field\"`\n}\n\ntype AnotherExample struct {\n    Name string `yaml:\"name\"`\n}\n</code></pre>\n\n<p>And I'd like to unmarshal such YAML as</p>\n\n<pre><code>exported-field: lorem ipsum\none-more-exported: dolor set\nunexported-field:\n  something:\n    name: anything\n</code></pre>\n\n<p>What I tried is a custom unmarshaler:</p>\n\n<pre><code>func (example *Example) UnmarshalYAML(unmarshal func(interface{}) error) error {\n    type Alias Example\n    tmp := struct {\n        UnexportedField map[string]*AnotherExample `yaml:\"unexported-field\"`\n        *Alias\n    }{\n        Alias: (*Alias)(example),\n    }\n    if err := unmarshal(&amp;tmp); err != nil {\n        return err\n    }\n    if tmp.UnexportedField != nil {\n        example.unexportedField = tmp.UnexportedField\n    }\n    example.CopyJobNonNil(Example(*tmp.Alias)) // Copies all the non-nil fields from the passed Example instance\n\n    return nil\n}\n</code></pre>\n\n<p><code>tmp</code> after calling <code>unmarshal()</code> doesn't contain any fields but unexportedField \u2014 other fields seems to be omitted.</p>\n\n<p>The reproduced issue on Go Playground (although it isn't working due to the dependencies): <a href=\"https://play.golang.org/p/XZg7tEPGXna\" rel=\"nofollow noreferrer\">https://play.golang.org/p/XZg7tEPGXna</a></p>\n"}, {"tags": ["dictionary", "go", "reflection"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518043559, "post_id": 48674547, "comment_id": 84347623, "body": "Can you better explain what you&#39;re trying to do? Map values are never addressable., but they might already be a pointer value. Why do you need to ensure that you&#39;re traversing everything through a pointer?"}, {"owner": {"reputation": 2008, "user_id": 710618, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/779233af08fd9f187990a44146f1778c?s=128&d=identicon&r=PG", "display_name": "Alexandre Thenorio", "link": "https://stackoverflow.com/users/710618/alexandre-thenorio"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518045029, "post_id": 48674547, "comment_id": 84348176, "body": "Hi. I have updated the code above to better reflect the issue. My struct consists of pointers of that struct and I want to find all references of that type (what I work with I don&#39;t care much but the struct consists of Pointers thus why I look for pointers). The issue is that it seems that getting the map value returns the concrete type even though it is a map of pointers. I am unsure how to go about that. Ultimately, what is not shown in the code is that the Second struct has a method on it I am going to call through reflection but felt it is irrelevant to the issue at hand"}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 3, "creation_date": 1518045240, "post_id": 48674547, "comment_id": 84348253, "body": "It is generally better to include any relevant code in your question than to link to it somewhere else. Including a play.golang.org link is great but it should augment the question rather than contain part of the question."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1518045349, "post_id": 48674547, "comment_id": 84348290, "body": "@ByteFlinger: the updated example works, so I don&#39;t understand what the question is."}, {"owner": {"reputation": 2008, "user_id": 710618, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/779233af08fd9f187990a44146f1778c?s=128&d=identicon&r=PG", "display_name": "Alexandre Thenorio", "link": "https://stackoverflow.com/users/710618/alexandre-thenorio"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518046543, "post_id": 48674547, "comment_id": 84348728, "body": "@JimB Actually it does not. Noticed that it prints out that it finds the Second struct only once. it should print it twice but the second time is not printed because even though it is a map of <code>*Second</code>, it comes in as <code>Second</code> thus not matching the check of <code>reflect.TypeOf(&amp;Second)</code>.  I am just a bit confused on why the check doesn&#39;t work"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1518046708, "post_id": 48674547, "comment_id": 84348800, "body": "You need to show what you expect it to do in order for us to know what&#39;s not working. You can&#39;t match <code>&amp;Second{}</code> because right before that you call <code>Indirect()</code>. Do you want something like this?: <a href=\"https://play.golang.org/p/PNWQM-PDBxf\" rel=\"nofollow noreferrer\">play.golang.org/p/PNWQM-PDBxf</a>"}, {"owner": {"reputation": 2008, "user_id": 710618, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/779233af08fd9f187990a44146f1778c?s=128&d=identicon&r=PG", "display_name": "Alexandre Thenorio", "link": "https://stackoverflow.com/users/710618/alexandre-thenorio"}, "edited": false, "score": 0, "creation_date": 1519162880, "post_id": 48674547, "comment_id": 84795154, "body": "Yes. That works well, thank you"}], "owner": {"reputation": 2008, "user_id": 710618, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/779233af08fd9f187990a44146f1778c?s=128&d=identicon&r=PG", "display_name": "Alexandre Thenorio", "link": "https://stackoverflow.com/users/710618/alexandre-thenorio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 245, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1518044777, "creation_date": 1518043342, "last_edit_date": 1518044777, "question_id": 48674547, "link": "https://stackoverflow.com/questions/48674547/how-to-traverse-a-map-in-go-through-reflection", "title": "How to traverse a map in Go through reflection", "body": "<p>I am attempting to write a simple recursive function to traverse a structure in Go and look for a certain type however I am having a hard time dealing with a structure in a map and reflection</p>\n\n<p>The example below illustrates the issue</p>\n\n<p><a href=\"https://play.golang.org/p/LxuInxyIIEG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LxuInxyIIEG</a></p>\n\n<p>I cannot call <code>v.MapIndex(key)</code> because I get an issue that it is not a pointer and I cannot address it either.</p>\n\n<p>How do I deal with that?</p>\n\n<p>Also when looking for a struct type by comparing v.Type, how do I make sure that I found the type regardless of whether it is a pointer or not (As I might want to call a function on it)? My code above compares to <code>reflect.TypeOf(Second{})</code> but I would also like to cover a pointer of Second. Would adding the check for <code>reflect.TypeOf(&amp;Second{})</code> suffice?</p>\n"}, {"tags": ["go", "printf", "ascii"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1518039165, "post_id": 48673517, "comment_id": 84345645, "body": "There&#39;s no official &quot;extended ascii&quot; character set. If you mean &quot;ISO 8859-1&quot;, then you would have to encode it properly yourself. Go assumes strings are utf-8."}, {"owner": {"reputation": 43, "user_id": 3575979, "user_type": "registered", "profile_image": "https://graph.facebook.com/733760197/picture?type=large", "display_name": "Kstulen", "link": "https://stackoverflow.com/users/3575979/kstulen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518039998, "post_id": 48673517, "comment_id": 84345991, "body": "Could using []bytes be an alternative here?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518041633, "post_id": 48673517, "comment_id": 84346758, "body": "An alternative to what, and how? Now seeing that you have a euro symbol here, but expect it to be 0x80, I&#39;m not sure what encoding you&#39;re expecting. If your terminal is using the same encoding, then you could write the raw bytes to the terminal. Most terminals however also usually use utf-8 by default, so you would need to encode it properly."}, {"owner": {"reputation": 43, "user_id": 3575979, "user_type": "registered", "profile_image": "https://graph.facebook.com/733760197/picture?type=large", "display_name": "Kstulen", "link": "https://stackoverflow.com/users/3575979/kstulen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518042550, "post_id": 48673517, "comment_id": 84347163, "body": "What I want to do is to generate a print from a sequence of bytes ([] bytes). I&#39;ve tried looking at something like this:     <code>func ExtendedASCIIText() string { \tmessage := []byte(&quot;\\x80\\xf7\\xbe&quot;) \tfor i := 0; i &lt; len(message); i++ { \t\tfmt.Printf(&quot;%q&quot;, message[i]) \t} \toutput := string(message) \treturn output     } </code> But I don&#39;t know enough about the [] bytes type to be able to figure it out. Any tips?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518042873, "post_id": 48673517, "comment_id": 84347318, "body": "This doesn&#39;t have anything to do with the <code>[]byte</code> type (though you really should know how that works here, because it is fundamental to just about everything). You still haven&#39;t specified what character set you&#39;re expecting, but it looks like it might be <code>windows1252</code>? The <a href=\"https://godoc.org/golang.org/x/text/encoding/charmap\" rel=\"nofollow noreferrer\">charmap package</a> has the tables to deal with that. But if you don&#39;t know what these things are, or how to do it, you would really just be better off sticking with utf8 like everything else."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1518057405, "last_edit_date": 1518057405, "creation_date": 1518054398, "answer_id": 48676186, "question_id": 48673517, "link": "https://stackoverflow.com/questions/48673517/printing-ascii-characters-in-golang/48676186#48676186", "title": "Printing ASCII characters in Golang", "body": "<blockquote>\n  <p>Can anyone tell me why this doesn't work?</p>\n</blockquote>\n\n<p>Yes. You don't appear to understand the problem. The term extended ASCII is not well-defined. You likely want to translate from (Windows) code page 1252 to Unicode.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc cp1252ToUTF8(cp string) string {\n    r := make([]rune, len(cp))\n    for i := 0; i &lt; len(cp); i++ {\n        r[i] = cp1252[cp[i]]\n    }\n    return string(r)\n}\n\nfunc main() {\n    cp := \"\\x80\\xf7\\xbe dollar\"\n    str := cp1252ToUTF8(cp)\n    fmt.Printf(\"%q\\n\", str)\n}\n\nfunc init() {\n    for i, r := range cp1252 {\n        if r == 0 {\n            cp1252[i] = rune(i)\n        }\n    }\n}\n\n// cp1252 to Unicode table\n// ftp://ftp.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WINDOWS/CP1252.TXT\nvar cp1252 = [256]rune{\n    0x80: '\\u20AC', // EURO SIGN\n    0x81: '\\uFFFD', // UNDEFINED\n    0x82: '\\u201A', // SINGLE LOW-9 QUOTATION MARK\n    0x83: '\\u0192', // LATIN SMALL LETTER F WITH HOOK\n    0x84: '\\u201E', // DOUBLE LOW-9 QUOTATION MARK\n    0x85: '\\u2026', // HORIZONTAL ELLIPSIS\n    0x86: '\\u2020', // DAGGER\n    0x87: '\\u2021', // DOUBLE DAGGER\n    0x88: '\\u02C6', // MODIFIER LETTER CIRCUMFLEX ACCENT\n    0x89: '\\u2030', // PER MILLE SIGN\n    0x8A: '\\u0160', // LATIN CAPITAL LETTER S WITH CARON\n    0x8B: '\\u2039', // SINGLE LEFT-POINTING ANGLE QUOTATION MARK\n    0x8C: '\\u0152', // LATIN CAPITAL LIGATURE OE\n    0x8D: '\\uFFFD', // UNDEFINED\n    0x8E: '\\u017D', // LATIN CAPITAL LETTER Z WITH CARON\n    0x8F: '\\uFFFD', // UNDEFINED\n    0x90: '\\uFFFD', // UNDEFINED\n    0x91: '\\u2018', // LEFT SINGLE QUOTATION MARK\n    0x92: '\\u2019', // RIGHT SINGLE QUOTATION MARK\n    0x93: '\\u201C', // LEFT DOUBLE QUOTATION MARK\n    0x94: '\\u201D', // RIGHT DOUBLE QUOTATION MARK\n    0x95: '\\u2022', // BULLET\n    0x96: '\\u2013', // EN DASH\n    0x97: '\\u2014', // EM DASH\n    0x98: '\\u02DC', // SMALL TILDE\n    0x99: '\\u2122', // TRADE MARK SIGN\n    0x9A: '\\u0161', // LATIN SMALL LETTER S WITH CARON\n    0x9B: '\\u203A', // SINGLE RIGHT-POINTING ANGLE QUOTATION MARK\n    0x9C: '\\u0153', // LATIN SMALL LIGATURE OE\n    0x9D: '\\uFFFD', // UNDEFINED\n    0x9E: '\\u017E', // LATIN SMALL LETTER Z WITH CARON\n    0x9F: '\\u0178', // LATIN CAPITAL LETTER Y WITH DIAERESIS\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/U3dlRahOxQN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/U3dlRahOxQN</a></p>\n\n<p>Output:</p>\n\n<pre><code>\"\u20ac\u00f7\u00be dollar\"\n</code></pre>\n\n<p>References:</p>\n\n<p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a> </p>\n\n<p><a href=\"https://unicode.org/\" rel=\"nofollow noreferrer\">The Unicode Consortium</a></p>\n"}], "owner": {"reputation": 43, "user_id": 3575979, "user_type": "registered", "profile_image": "https://graph.facebook.com/733760197/picture?type=large", "display_name": "Kstulen", "link": "https://stackoverflow.com/users/3575979/kstulen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8596, "favorite_count": 2, "accepted_answer_id": 48676186, "answer_count": 1, "score": 1, "last_activity_date": 1518057405, "creation_date": 1518038800, "question_id": 48673517, "link": "https://stackoverflow.com/questions/48673517/printing-ascii-characters-in-golang", "title": "Printing ASCII characters in Golang", "body": "<p>I'm currently learning Golang and working on a code piece that where I'm printing all the Extended ASCII characters to console.\nI've made my loop go from X80-XFF, and it works fine. However, I want to print a line in the bottom of the loop output that says \"\u20ac \u00f7 \u00be dollar\", but my code only prints out the hex for the three characters I want to print + dollar. Can anyone tell me why this doesn't work?</p>\n\n<pre><code>package ascii\n\nimport \"fmt\"\n\nconst Ascii = \n\"\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\" \n+\n\"\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\" +\n\"\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\" +\n\"\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\" +\n\"\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\" +\n\"\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\" +\n\"\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\"+\n\"\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\"\n\n\nfunc IterateOverASCIIStringLiteral(sample string) {\nfor i := 0; i &lt; len(sample); i++ {\n    fmt.Printf(\"%X %q %b\\n\", sample[i], sample[i], sample[i])\n}\n}\n\nfunc ExtendedASCIIText() {\n    fmt.Printf(\"%q\",\"\\x80\\xf7\\xbe dollar\")\n}\n</code></pre>\n\n<p>Throwing in my main.go for good measure:</p>\n\n<pre><code>package main\nimport \"./ascii\"\n\n\nfunc main() {\nascii.IterateOverASCIIStringLiteral(ascii.Ascii)\nascii.ExtendedASCIIText()\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1518038517, "post_id": 48673006, "comment_id": 84345307, "body": "I doubt that the order in which struct fields are initialized is requlated by the spec (but did not check) so it is okay for the compiler to do one field first (instead of source order)."}, {"owner": {"reputation": 1356, "user_id": 5688488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b0072c03a45630ffe30f8a9e1a3f00?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Kadish", "link": "https://stackoverflow.com/users/5688488/benjamin-kadish"}, "edited": false, "score": 0, "creation_date": 1518038579, "post_id": 48673006, "comment_id": 84345337, "body": "It could automatically do it this way for speed reasons. i.e. functions take longer to evaluate than anything else"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1518038699, "post_id": 48673006, "comment_id": 84345396, "body": "Yes, the order is not specified, so there is no reason to assume that one field will be initialized before the other."}], "answers": [{"tags": [], "owner": {"reputation": 1714, "user_id": 992898, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b2e22ad8e9c7c782976df0acf69d3362?s=128&d=identicon&r=PG", "display_name": "ardhitama", "link": "https://stackoverflow.com/users/992898/ardhitama"}, "is_accepted": true, "score": 1, "last_activity_date": 1518236502, "creation_date": 1518236502, "answer_id": 48717201, "question_id": 48673006, "link": "https://stackoverflow.com/questions/48673006/struct-initialization-with-data-from-nil-pointer/48717201#48717201", "title": "Struct initialization with data from nil pointer", "body": "<p>By changing <code>func (m *MyStruct) Sent() bool {</code> (pointer receiver) to <code>func (m MyStruct) Sent() bool {</code> (value receiver) you can see that the stacktrace changed from </p>\n\n<pre><code>goroutine 1 [running]:\nmain.(*MyStruct).Sent(...)\n    /tmp/sandbox520127412/main.go:14\nmain.main()\n    /tmp/sandbox520127412/main.go:21 +0x1a\n</code></pre>\n\n<p>into</p>\n\n<pre><code>goroutine 1 [running]:\nmain.MyStruct.Sent(...)\n    /tmp/sandbox497151564/main.go:21\nmain.main()\n    /tmp/sandbox497151564/main.go:21 +0x1a\n</code></pre>\n\n<p>which tell us that golang treat pointer receiver differently.</p>\n\n<p>If you check <a href=\"https://golang.org/ref/spec#Order_of_evaluation\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Order_of_evaluation</a>, the struct order never was specified. But function call is evaluated first in this case, the mentioned behaviour is not guaranteed in another version of compiler as far as the spec states.</p>\n"}], "owner": {"reputation": 231, "user_id": 2334521, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9b83c9e339f69e3fcd0aea81f04274f9?s=128&d=identicon&r=PG", "display_name": "Yuri A. Brito", "link": "https://stackoverflow.com/users/2334521/yuri-a-brito"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 48717201, "answer_count": 1, "score": 2, "last_activity_date": 1518236502, "creation_date": 1518036657, "question_id": 48673006, "link": "https://stackoverflow.com/questions/48673006/struct-initialization-with-data-from-nil-pointer", "title": "Struct initialization with data from nil pointer", "body": "<p>When initializing a struct type using data from a possible 'nil' pointer, the panic message always refers to the first line calling a function in that pointer, instead of a value.</p>\n\n<p><a href=\"https://play.golang.org/p/VgX59Y08syi\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VgX59Y08syi</a></p>\n\n<p>For example, if you swap lines 20 and 21 in the above code, the panic occurs in the line where a function is called, instead of the first dereference to the nil pointer.</p>\n\n<p>Why this happens, instead of the panic happening on \"myStruct.MyString\"?</p>\n"}, {"tags": ["azure", "go", "azure-storage"], "comments": [{"owner": {"reputation": 19351, "user_id": 4148708, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/jLI9o.jpg?s=128&g=1", "display_name": "evilSnobu", "link": "https://stackoverflow.com/users/4148708/evilsnobu"}, "edited": false, "score": 1, "creation_date": 1518040243, "post_id": 48672712, "comment_id": 84346114, "body": "Yes, base64 encode it."}], "answers": [{"comments": [{"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "edited": false, "score": 0, "creation_date": 1518122470, "post_id": 48692712, "comment_id": 84387350, "body": "I need something lossless so that I can decode and get original. Also seems unlikely this could handle Chinese characters which is the example I gave. But very curious to see what it outputs for my example text."}], "tags": [], "owner": {"reputation": 2255, "user_id": 6591675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DvSsj.jpg?s=128&g=1", "display_name": "Adam Smith - Microsoft Azure", "link": "https://stackoverflow.com/users/6591675/adam-smith-microsoft-azure"}, "is_accepted": false, "score": 1, "last_activity_date": 1518115650, "creation_date": 1518115650, "answer_id": 48692712, "question_id": 48672712, "link": "https://stackoverflow.com/questions/48672712/use-international-characters-in-azure-storage-metadata/48692712#48692712", "title": "Use international characters in azure storage metadata?", "body": "<p>Since you mentioned Go in the tag, I assume you are looking for using a transliterator, there is this one in github which you should try\n: <a href=\"https://github.com/rainycape/unidecode\" rel=\"nofollow noreferrer\">https://github.com/rainycape/unidecode</a> </p>\n"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518115650, "creation_date": 1518035376, "question_id": 48672712, "link": "https://stackoverflow.com/questions/48672712/use-international-characters-in-azure-storage-metadata", "title": "Use international characters in azure storage metadata?", "body": "<p>When I run this request using <a href=\"https://github.com/Azure/azure-storage-blob-go\" rel=\"nofollow noreferrer\">this azure library</a>:</p>\n\n<p><code>blobURL.PutBlob(ctx, strings.NewReader(\"Some text\"), azblob.BlobHTTPHeaders{}, azblob.Metadata{\"Foo\": \"/\u611b\u77e5\u770c/bar\"}, azblob.BlobAccessConditions{})</code></p>\n\n<p>I get this error:</p>\n\n<pre><code>===== RESPONSE ERROR (ServiceCode=AuthenticationFailed) =====\nDescription=Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.\nRequestId:daf8a672-001e-000e-2f4b-a033f3000000\nTime:2018-02-07T19:38:09.6740273Z, Details: \n   AuthenticationErrorDetail: The MAC signature found in the HTTP request 'REDACTED' is not the same as any computed signature. Server used following string to sign: 'PUT\n\n9\n\nx-ms-blob-cache-control:\nx-ms-blob-content-disposition:\nx-ms-blob-content-encoding:\nx-ms-blob-content-language:\nx-ms-blob-content-type:\nx-ms-blob-type:BlockBlob\nx-ms-client-request-id:f18fd538-3780-4f62-5236-777ac244affa\nx-ms-date:Wed, 07 Feb 2018 19:38:09 GMT\nx-ms-meta-foo:/\u00e6\u201e\u203a\u00e7\u0178\u00a5\u00e7\u0153\u0152/bar\nx-ms-version:2016-05-31\n/MYACCOUNT/MYCONTAINER/ReadMe.txt\ntimeout:61.\n   PUT https://MYACCOUNT.blob.core.cloudapi.de/MYCONTAINER/ReadMe.txt?timeout=61\n   Authorization: REDACTED\n   Content-Length: [9]\n   User-Agent: [Azure-Storage/0.1 (go1.9.3; darwin)]\n   X-Ms-Blob-Cache-Control: []\n   X-Ms-Blob-Content-Disposition: []\n   X-Ms-Blob-Content-Encoding: []\n   X-Ms-Blob-Content-Language: []\n   X-Ms-Blob-Content-Type: []\n   X-Ms-Blob-Type: [BlockBlob]\n   X-Ms-Client-Request-Id: [f18fd538-3780-4f62-5236-777ac244affa]\n   X-Ms-Date: [Wed, 07 Feb 2018 19:38:09 GMT]\n   X-Ms-Meta-Foo: [/\u611b\u77e5\u770c/bar]\n   X-Ms-Version: [2016-05-31]\n   --------------------------------------------------------------------------------\n   RESPONSE Status: 403 Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.\n   Content-Length: [936]\n   Content-Type: [application/xml]\n   Date: [Wed, 07 Feb 2018 19:38:09 GMT]\n   Server: [Microsoft-HTTPAPI/2.0]\n   X-Ms-Request-Id: [daf8a672-001e-000e-2f4b-a033f3000000]\n\n\nexit status 1\n</code></pre>\n\n<p><strong>Is this because \"/\u611b\u77e5\u770c/bar\" != \"/\u00e6\u201e\u203a\u00e7\u0178\u00a5\u00e7\u0153\u0152/bar\"?\nDo you see any way to set non-ascii character like \"/\u611b\u77e5\u770c/bar\" as a metadata value?</strong></p>\n"}, {"tags": ["testing", "go", "initialization", "profiling"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518034836, "post_id": 48672553, "comment_id": 84343370, "body": "The Go toolchain tool for this would be <a href=\"https://golang.org/pkg/runtime/pprof/\" rel=\"nofollow noreferrer\">pprof</a>. Requests for third-party tools are off-topic for StackOverflow."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1518035017, "post_id": 48672553, "comment_id": 84343472, "body": "The tested package still needs to be compiled every time. You can use the <code>-x</code> flag to see all build steps if you want to see all compilation steps."}, {"owner": {"reputation": 1461, "user_id": 1604579, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b319d5df97f51461e30c82bb04dba9a5?s=128&d=identicon&r=PG", "display_name": "myyk", "link": "https://stackoverflow.com/users/1604579/myyk"}, "edited": false, "score": 0, "creation_date": 1518075430, "post_id": 48672553, "comment_id": 84357069, "body": "Adrian, wouldn&#39;t pprof end up profiling after initializations have all run, if that is my issue, I&#39;d like to know how much time is spend in those. JimB, that flag is helpful, I can see it&#39;s spending a good amount of that time compiling now. I may just have too many transitive dependencies to have a quick build."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1518099288, "post_id": 48672553, "comment_id": 84372863, "body": "@myyk: go1.10 has a new build cache system which may speed things up considerably. You can try the RCs right now if you want."}], "owner": {"reputation": 1461, "user_id": 1604579, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b319d5df97f51461e30c82bb04dba9a5?s=128&d=identicon&r=PG", "display_name": "myyk", "link": "https://stackoverflow.com/users/1604579/myyk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1518099209, "creation_date": 1518034730, "last_edit_date": 1518099209, "question_id": 48672553, "link": "https://stackoverflow.com/questions/48672553/in-go-how-do-you-profile-transitive-init-cpu-usage", "title": "In Go, how do you profile transitive init() cpu usage?", "body": "<p>I'm working on a project with a very large monorepo. When I run tests, the tests do not take very long to run the actual test case, but there is a lot of setup time before running the test.</p>\n\n<p>I've tried <code>go test -i</code> not seeing much of a difference. I think that would suggest that the time is not a compilation time issue, so my next step is to profile everything that happens before running the test case.</p>\n\n<p>There are many transitive dependencies and I would prefer to not manually look through the graph adding printlns to get the timings. Are there any tools to profile all the transitive initialization that happens in Go before running a test?</p>\n"}, {"tags": ["url", "go", "build"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518033164, "post_id": 48671938, "comment_id": 84342525, "body": "If you&#39;re seeing the std lib packages being built locally, that just means your local Go install isn&#39;t correct, you&#39;re cross compiling, or you&#39;re supplying the <code>-a</code> flag to <code>go install</code>."}, {"owner": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518033859, "post_id": 48671938, "comment_id": 84342856, "body": "@JimB Ok, thank you for clarifying this. I&#39;m not supplying <code>-a</code>, just using the command as above. So this would be unrelated to the issue of ending up with different, I guess?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518035317, "post_id": 48671938, "comment_id": 84343639, "body": "The output you see is unrelated, but if you say the local binary works correctly, then there must be a difference. Are your deps all vendored (if they are you wouldn&#39;t need to run <code>dep ensure</code>), or pulling the exact same version? Start by building your project with the exact same go version, in a clean GOPATH."}, {"owner": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518043133, "post_id": 48671938, "comment_id": 84347451, "body": "Only the <code>Gopkg.lock</code> is committed at this stage (the project still rapidly evolving), hence the <code>dep ensure</code> command."}, {"owner": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518087701, "post_id": 48671938, "comment_id": 84364875, "body": "@JimB After trying a build locally using the same Docker container I was able to reproduce the issue and can rule out AWS CodePipeline. The question has been updated accordingly."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518097975, "post_id": 48671938, "comment_id": 84371861, "body": "Are you absolutely certain you have the same version of Go locally? I have a feeling that you just have an old (or modified?) version locally that&#39;s not catching the invalid character in the user info. If you escape the <code>{</code> it works correctly: <a href=\"https://play.golang.org/p/ifFpjYybNj4\" rel=\"nofollow noreferrer\">play.golang.org/p/ifFpjYybNj4</a>"}, {"owner": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518107156, "post_id": 48671938, "comment_id": 84378477, "body": "I checked again, it got caused by a change in v1.9.4 that got released yesterday. My apologies \ud83d\ude48. After updating locally to v1.9.4 the behaviour is identical no matter the platform."}, {"owner": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518108483, "post_id": 48671938, "comment_id": 84379383, "body": "@JimB I just updated the question with the full explanation, it may still be useful for others?"}, {"owner": {"reputation": 8681, "user_id": 629493, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/44253c64ffb24f76f5917e48188ce6ab?s=128&d=identicon&r=PG", "display_name": "Unsigned", "link": "https://stackoverflow.com/users/629493/unsigned"}, "edited": false, "score": 0, "creation_date": 1518128391, "post_id": 48671938, "comment_id": 84390152, "body": "@klotz It&#39;s recommended you instead answer your own question with the solution, instead of editing it into the question. As it stands now, this question might be deleted, since it is no longer really a question."}, {"owner": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "reply_to_user": {"reputation": 8681, "user_id": 629493, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/44253c64ffb24f76f5917e48188ce6ab?s=128&d=identicon&r=PG", "display_name": "Unsigned", "link": "https://stackoverflow.com/users/629493/unsigned"}, "edited": false, "score": 0, "creation_date": 1518176917, "post_id": 48671938, "comment_id": 84408582, "body": "@Unsigned thanks for pointing it out, rewrote the question and posted accurate answer."}, {"owner": {"reputation": 8681, "user_id": 629493, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/44253c64ffb24f76f5917e48188ce6ab?s=128&d=identicon&r=PG", "display_name": "Unsigned", "link": "https://stackoverflow.com/users/629493/unsigned"}, "edited": false, "score": 0, "creation_date": 1518199737, "post_id": 48671938, "comment_id": 84422452, "body": "@klotz No problem. Be sure to accept your answer too :)"}], "answers": [{"tags": [], "owner": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "is_accepted": true, "score": 1, "last_activity_date": 1518176869, "creation_date": 1518176869, "answer_id": 48705145, "question_id": 48671938, "link": "https://stackoverflow.com/questions/48671938/go-url-parsestring-fails-with-certain-user-names-or-passwords/48705145#48705145", "title": "Go url.Parse(string) fails with certain user names or passwords", "body": "<p>It turns out up until Go v1.9.3 <code>net/url</code> didn't validate the user info when parsing a url. This may break existing applications when compiled using v1.9.4 if the username or password contain special characters. </p>\n\n<p>It now expects the user info to be percent encoded string in order to handle special characters. The new behaviour got introduced in <a href=\"https://github.com/golang/go/commit/ba1018b4549f3edc257221cc8e49221255e03290\" rel=\"nofollow noreferrer\"><code>ba1018b</code></a>.</p>\n\n<h2>Fixed sample application</h2>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/url\"\n)\n\nfunc main() {\n    dsn1 := \"postgres://user:abc{DEf1=ghi@example.com:5432/db?sslmode=require\" // this works up until 1.9.3 but no longer in 1.9.4\n    dsn2 := \"postgres://user:abc%7BDEf1=ghi@example.com:5432/db?sslmode=require\" // this works everywhere, note { is now %7B\n\n    u, err := url.Parse(dsn1)\n    fmt.Println(\"1st url:\\t\", u, err)\n\n    u, err = url.Parse(dsn2)\n    fmt.Println(\"2nd url:\\t\", u, err)\n}\n</code></pre>\n\n<p>Run the code on <a href=\"https://play.golang.com/p/jGIQgbiKZwz\" rel=\"nofollow noreferrer\">https://play.golang.com/p/jGIQgbiKZwz</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 195, "user_id": 1133061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef1ce6a1ef5e8b4a544a7391c741acbd?s=128&d=identicon&r=PG", "display_name": "Grrrben", "link": "https://stackoverflow.com/users/1133061/grrrben"}, "is_accepted": false, "score": 5, "last_activity_date": 1619057494, "last_edit_date": 1619057494, "creation_date": 1531166634, "answer_id": 51253226, "question_id": 48671938, "link": "https://stackoverflow.com/questions/48671938/go-url-parsestring-fails-with-certain-user-names-or-passwords/51253226#51253226", "title": "Go url.Parse(string) fails with certain user names or passwords", "body": "<p>Well, you can just</p>\n<pre><code>url.QueryEscape(&quot;your#$%^&amp;*(proper$#$%%^(password&quot;)\n</code></pre>\n<p>and use this one to parse your url.</p>\n"}, {"tags": [], "owner": {"reputation": 500, "user_id": 7101880, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209175470396691/picture?type=large", "display_name": "Adrien Parrochia", "link": "https://stackoverflow.com/users/7101880/adrien-parrochia"}, "is_accepted": false, "score": 0, "last_activity_date": 1605261050, "creation_date": 1605261050, "answer_id": 64818762, "question_id": 48671938, "link": "https://stackoverflow.com/questions/48671938/go-url-parsestring-fails-with-certain-user-names-or-passwords/64818762#64818762", "title": "Go url.Parse(string) fails with certain user names or passwords", "body": "<p>Use url.UserPassword func :</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;net/url&quot;\n)\n\nfunc main() {\n    dsn := &quot;postgres://example.com:5432/db?sslmode=require&quot; \n\n    u, err := url.Parse(dsn)\n    if err != nil {\n         fmt.Printf(&quot;ERROR: %v\\n&quot;, err)\n         return\n    }\n    u.User = url.UserPassword(&quot;user&quot;, &quot;abc{DEf1=ghi&quot;)\n    fmt.Println(&quot;url:\\t&quot;, u)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2935, "favorite_count": 0, "accepted_answer_id": 48705145, "answer_count": 3, "score": 8, "last_activity_date": 1619057494, "creation_date": 1518032265, "last_edit_date": 1518177011, "question_id": 48671938, "link": "https://stackoverflow.com/questions/48671938/go-url-parsestring-fails-with-certain-user-names-or-passwords", "title": "Go url.Parse(string) fails with certain user names or passwords", "body": "<p>Using a URL that has worked in the past, I know receive a parsing error from <code>net/url</code>. What's wrong with it?</p>\n\n<pre><code>parse postgres://user:abc{DEf1=ghi@example.com:5432/db?sslmode=require: net/url: invalid userinfo\n</code></pre>\n\n<h2>Sample application</h2>\n\n<p>See <a href=\"https://play.golang.com/p/mQZaN5JN3_q\" rel=\"noreferrer\">https://play.golang.com/p/mQZaN5JN3_q</a> to run.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/url\"\n)\n\nfunc main() {\n    dsn := \"postgres://user:abc{DEf1=ghi@example.com:5432/db?sslmode=require\"\n\n    u, err := url.Parse(dsn)\n    fmt.Println(u, err)\n}\n</code></pre>\n"}, {"tags": ["authentication", "go", "proxy", "google-cloud-platform"], "answers": [{"tags": [], "owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "is_accepted": true, "score": 1, "last_activity_date": 1518375956, "creation_date": 1518375956, "answer_id": 48735299, "question_id": 48671333, "link": "https://stackoverflow.com/questions/48671333/providing-google-service-account-credentials-manually-in-golang/48735299#48735299", "title": "Providing Google service account credentials manually in Golang", "body": "<p>When using the <code>cloudsql-proxy</code> package, you're not directly connecting to your cloud SQL instance, but creating a <a href=\"https://cloud.google.com/sql/docs/mysql/connect-external-app#proxy\" rel=\"nofollow noreferrer\">proxy</a> and connecting to it. It's the proxy connection where you have to provide the credentials.</p>\n\n<p>In the tests for the cloud-sql package there is an example of <a href=\"https://github.com/GoogleCloudPlatform/cloudsql-proxy/blob/master/tests/dialers_test.go#L63\" rel=\"nofollow noreferrer\">how to init the proxy with credentials</a>.</p>\n\n<p>The proxy <a href=\"https://github.com/GoogleCloudPlatform/cloudsql-proxy/blob/master/proxy/dialers/mysql/hook.go#L29\" rel=\"nofollow noreferrer\">initializes by itself</a> if you don't do it manually, but you can call <a href=\"https://godoc.org/github.com/GoogleCloudPlatform/cloudsql-proxy/proxy/proxy#Init\" rel=\"nofollow noreferrer\"><code>proxy.Init</code></a> with an http client, and you can create an http client with credentials.</p>\n\n<p>I've not tested this, but you could try something like <code>proxy.Init(oauth2.NewClient(ctx, oauth2.StaticTokenSource(&amp;oauth2.Token{AccessToken: &lt;YOUR_TOKEN&gt;})), nil, nil)</code> before the <code>DialCfg</code> call.</p>\n\n<p>A better example, if you provide your credentials file (so it's not hard-coded) would be something like:</p>\n\n<pre><code>func main()\n  credsFile := \"path/to/your/credentials.json\"\n  SQLScope := \"https://www.googleapis.com/auth/sqlservice.admin\"\n  ctx := context.Background()\n\n  creds, err := ioutil.ReadFile(credsFile)\n  if err != nil {\n    # handle error\n  }\n\n  cfg, err := goauth.JWTConfigFromJSON(creds, SQLScope)\n  if err != nil {\n    # handle error\n  }\n\n  client := cfg.Client(ctx)\n  proxy.Init(client, nil, nil)\n\n  var db *sql.DB\n\n  cfg := mysql.Cfg(\"mysql\", \"********\", \"********\") //name , username, password\n  cfg.DBName = \"MyDBName\"\n  db, err := mysql.DialCfg(cfg)\n  if err != nil {\n    # handle error\n  }\n  defer db.Close()\n\n  # your calls to cloudSQL\n\n}\n</code></pre>\n\n<p>(This is mainly a copy of <a href=\"https://github.com/GoogleCloudPlatform/cloudsql-proxy/blob/master/tests/dialers_test.go\" rel=\"nofollow noreferrer\">the tests on that package</a>.)</p>\n"}], "owner": {"reputation": 445, "user_id": 92323, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1047661124/picture?type=large", "display_name": "MarcoW", "link": "https://stackoverflow.com/users/92323/marcow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1370, "favorite_count": 0, "accepted_answer_id": 48735299, "answer_count": 1, "score": 2, "last_activity_date": 1518375956, "creation_date": 1518029788, "question_id": 48671333, "link": "https://stackoverflow.com/questions/48671333/providing-google-service-account-credentials-manually-in-golang", "title": "Providing Google service account credentials manually in Golang", "body": "<p>To remotely connect to a Google-cloud Mysql database via the Go Proxy library, I need to provide service account credentials. This can be done through setting the <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable, but since I want the application to be able to run on different machines without having to set the environment variable everywhere, that is not an option.</p>\n\n<p>As a result, I have to provide the service account credentials manually to my Golang application. The code below (without the authentication) gives this error message: </p>\n\n<blockquote>\n  <p>default proxy initialization failed; consider calling proxy.Init explicitly: google: could not find default credentials. See <a href=\"https://developers.google.com/accounts/docs/application-default-credentials\" rel=\"nofollow noreferrer\">https://developers.google.com/accounts/docs/application-default-credentials</a> for more information.</p>\n</blockquote>\n\n<p>Google provides elaborate documentation on how to fix the manual authentication for a number of programming languages, but not for Go:</p>\n\n<blockquote>\n  <p><a href=\"https://cloud.google.com/docs/authentication/production#auth-cloud-explicit-csharp\" rel=\"nofollow noreferrer\">https://cloud.google.com/docs/authentication/production#auth-cloud-explicit-csharp</a></p>\n</blockquote>\n\n<p>Could anyone help me out with setting authentication credentials manually in Golang?</p>\n\n<p>Thanks a bunch!</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"github.com/GoogleCloudPlatform/cloudsql-proxy/proxy/dialers/mysql\"\n)\n\nvar db *sql.DB\n\nfunc main() {\n\ncfg := mysql.Cfg(\"mysql\", \"********\", \"********\") //name , username, password\ncfg.DBName = \"MyDBName\"\ndb := mysql.DialCfg(cfg)\ndefer db.Close()\n\n}\n</code></pre>\n"}, {"tags": ["xml", "go", "xmpp"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1518029888, "post_id": 48671268, "comment_id": 84340635, "body": "Have you tried anything? Like, for example, <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow noreferrer\">the <code>xml</code> package</a>?"}, {"owner": {"reputation": 301, "user_id": 1976600, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2ac93d56bfa3d51d5daa1432cb3b6cc3?s=128&d=identicon&r=PG", "display_name": "John Ostin", "link": "https://stackoverflow.com/users/1976600/john-ostin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1518030189, "post_id": 48671268, "comment_id": 84340819, "body": "Of course I tried, but all examples is <code>xml</code> package documentation doesn&#39;t illustrate namespaces."}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1518088188, "post_id": 48671268, "comment_id": 84365226, "body": "This <a href=\"https://stackoverflow.com/a/14152832/229154\">answer</a> may be helpful for your case."}], "answers": [{"tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 0, "last_activity_date": 1573334716, "last_edit_date": 1573334716, "creation_date": 1573334287, "answer_id": 58783576, "question_id": 48671268, "link": "https://stackoverflow.com/questions/48671268/iterate-over-elements-in-xml-with-namespace/58783576#58783576", "title": "Iterate over elements in xml with namespace", "body": "<p>There are two mechanisms for parsing XML documents in the standard library, a streaming mechanism and a struct based mechanism.</p>\n\n<hr>\n\n<p><strong>Streaming API</strong></p>\n\n<p>Using the streaming mechanism will be a tad more verbose, but also very efficient for large documents (such as a large roster). The basic idea would be to create a decoder, iterate over the tokens and extract the data you need. In this case, you just need the JID attribute which will only be on the start elements, so you will also need to iterate over the attributes of each start element to find one named \"jid\". The following is a minimal example of doing this, for a real project you'd likely also want to validate that each start element is an \"item\":</p>\n\n<pre><code>func main() {\n    d := xml.NewDecoder(strings.NewReader(v.Query))\n    var jids []string\n    for {\n        tok, err := d.Token()\n        if err != nil &amp;&amp; err != io.EOF {\n            panic(err)\n        }\n        if tok == nil {\n            break\n        }\n        start, ok := tok.(xml.StartElement)\n        if !ok {\n            // We'll skip anything that's not a start element in this example.\n            continue\n        }\n\n        jid := getAttr(\"jid\", start.Attr)\n        if jid != \"\" {\n            jids = append(jids, jid)\n        }\n    }\n\n    fmt.Println(jids)\n}\n\nfunc getAttr(name string, attr []xml.Attr) string {\n    for _, a := range attr {\n        if a.Name.Local == name {\n            return a.Value\n        }\n    }\n    return \"\"\n}\n</code></pre>\n\n<p>You can run this example on the playground here: <a href=\"https://play.golang.org/p/s6flTADDsnT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/s6flTADDsnT</a></p>\n\n<hr>\n\n<p><strong>Struct based API</strong></p>\n\n<p>The struct based API is a little easier, but also may be less efficient with a large roster. Instead of streaming the XML payload token by token, we'll create a struct that represents the payload, unmarshal the data into it, and then iterate over it and pull out the JIDs. A struct representing the roster response would look like this:</p>\n\n<pre><code>type rosterResponse struct {\n    XMLName xml.Name `xml:\"jabber:iq:roster query\"`\n    Items   []struct {\n        JID string `xml:\"jid,attr\"`\n    } `xml:\"item\"`\n}\n</code></pre>\n\n<p>An example of unmarshaling into it can be found here:</p>\n\n<p><a href=\"https://play.golang.org/p/g2qLUkdZ7qt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/g2qLUkdZ7qt</a></p>\n\n<p>For a better understanding of what is going on in these two examples, I highly recommend reading the package level documentation for <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow noreferrer\"><code>encoding/xml</code></a>, it covers all this and a lot more useful information!</p>\n"}], "owner": {"reputation": 301, "user_id": 1976600, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2ac93d56bfa3d51d5daa1432cb3b6cc3?s=128&d=identicon&r=PG", "display_name": "John Ostin", "link": "https://stackoverflow.com/users/1976600/john-ostin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1573334716, "creation_date": 1518029613, "question_id": 48671268, "link": "https://stackoverflow.com/questions/48671268/iterate-over-elements-in-xml-with-namespace", "title": "Iterate over elements in xml with namespace", "body": "<p>I want to operate with XMPP users with <code>github.com/mattn/go-xmpp</code> Golang package. I change a little official <a href=\"https://github.com/mattn/go-xmpp/blob/master/_example/example.go#L67\" rel=\"nofollow noreferrer\">example</a> and got something like this:</p>\n\n<pre><code>switch v := chat.(type) {\ncase xmpp.IQ:\n    if len(v.Query) != 0 {\n        fmt.Printf(\"Query: %s\", v.Query)\n    }\ndefault:\n    fmt.Printf(\"detect default type: %T\\n\", v)\n}\n</code></pre>\n\n<p><code>v.Query</code> is a XML document with namespace like</p>\n\n<pre><code>&lt;query xmlns=\"jabber:iq:roster\"&gt;\n&lt;item jid=\"JID1\" name=\"Name\" subscription=\"none\" ask=\"subscribe\"&gt;\n    &lt;group&gt;&lt;/group&gt;\n&lt;/item&gt;\n&lt;item jid=\"JID2\" name=\"Another name\" subscription=\"both\"&gt;\n    &lt;group&gt;Group&lt;/group&gt;\n&lt;/item&gt;\n&lt;item jid=\"JID3\" name=\"Eman\" subscription=\"both\"&gt;\n    &lt;group&gt;AnotherGroup&lt;/group&gt;\n&lt;/item&gt;\n&lt;/query&gt;\n</code></pre>\n\n<p>How can I parse this document and iterate over <code>jid</code> elements?</p>\n"}, {"tags": ["go", "types", "type-assertion"], "comments": [{"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1518028908, "post_id": 48671031, "comment_id": 84340039, "body": "You probably should provide what library you use to get this value. Also Did you check what type it really returning maybe it returns int64/int32/uint?"}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "reply_to_user": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1518029086, "post_id": 48671031, "comment_id": 84340152, "body": "<a href=\"https://github.com/tidwall/gjson\" rel=\"nofollow noreferrer\">github.com/tidwall/gjson</a> I have added a note to what I am using. @ttomalak"}], "answers": [{"comments": [{"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "edited": false, "score": 0, "creation_date": 1518029381, "post_id": 48671153, "comment_id": 84340342, "body": "Thing is If I change the line to gjson.Get(spec, &quot;age&quot;).Value().(float64) it stops working and returns null. :("}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "reply_to_user": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "edited": false, "score": 0, "creation_date": 1518029717, "post_id": 48671153, "comment_id": 84340530, "body": "Can you do <code>fmt.Println(reflect.TypeOf(value))</code> where value is <code>value := gjson.Get(spec, &quot;age&quot;).Value()</code>"}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "edited": false, "score": 0, "creation_date": 1518029771, "post_id": 48671153, "comment_id": 84340566, "body": "oh no. Sorry. You are right. Its working fine. Its returning null because there are no error. Thanks!"}], "tags": [], "owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "is_accepted": true, "score": 2, "last_activity_date": 1518029131, "creation_date": 1518029131, "answer_id": 48671153, "question_id": 48671031, "link": "https://stackoverflow.com/questions/48671031/check-if-a-value-is-an-int/48671153#48671153", "title": "Check if a value is an int", "body": "<p>It seems like this lib for json numbers it return float64</p>\n\n<pre><code>bool, for JSON booleans\nfloat64, for JSON numbers\nstring, for JSON string literals\nnil, for JSON null\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6577, "user_id": 424124, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7a29d3d0553d3965a7b923b4fb42d7a9?s=128&d=identicon&r=PG", "display_name": "tidwall", "link": "https://stackoverflow.com/users/424124/tidwall"}, "edited": false, "score": 0, "creation_date": 1518117781, "post_id": 48671531, "comment_id": 84384885, "body": "It may be worth noting that a gjson result can hold large 64-bit integers, not just floating points."}], "tags": [], "owner": {"reputation": 542, "user_id": 5822368, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q75QC.jpg?s=128&g=1", "display_name": "Vikram Jakhar", "link": "https://stackoverflow.com/users/5822368/vikram-jakhar"}, "is_accepted": false, "score": 1, "last_activity_date": 1518030545, "creation_date": 1518030545, "answer_id": 48671531, "question_id": 48671031, "link": "https://stackoverflow.com/questions/48671031/check-if-a-value-is-an-int/48671531#48671531", "title": "Check if a value is an int", "body": "<p>As in github.com/tidwall/gjson result type can only hold float64 for json numbers. </p>\n\n<p>Though you can use Int() instead of Value() to get an integer value.</p>\n\n<pre><code>fmt.Println(gjson.Get(spec, \"age\").Int())  // 123\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6577, "user_id": 424124, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7a29d3d0553d3965a7b923b4fb42d7a9?s=128&d=identicon&r=PG", "display_name": "tidwall", "link": "https://stackoverflow.com/users/424124/tidwall"}, "is_accepted": false, "score": 0, "last_activity_date": 1518118242, "creation_date": 1518118242, "answer_id": 48693376, "question_id": 48671031, "link": "https://stackoverflow.com/questions/48671031/check-if-a-value-is-an-int/48693376#48693376", "title": "Check if a value is an int", "body": "<p>You can use the <code>result.Type</code> field to check the type:</p>\n\n<pre><code>res := gjson.Get(spec, \"age\")\nif res.Type != gjson.Number {\n    n := validator_error{Path: \"_.age\", Message: \"should be an int\"}\n}\n</code></pre>\n\n<p>If you require that the value is a whole number <code>123</code> not <code>123.5</code>:</p>\n\n<pre><code>res := gjson.Get(spec, \"age\")\nif res.Type != gjson.Number || math.Floor(res.Num) != res.Num {\n    n := validator_error{Path: \"_.age\", Message: \"should be an int\"}\n}\n</code></pre>\n"}], "owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1540, "favorite_count": 0, "accepted_answer_id": 48671153, "answer_count": 3, "score": -1, "last_activity_date": 1518118242, "creation_date": 1518028646, "last_edit_date": 1518079682, "question_id": 48671031, "link": "https://stackoverflow.com/questions/48671031/check-if-a-value-is-an-int", "title": "Check if a value is an int", "body": "<p>So Im sending this payload to my app : </p>\n\n<pre><code>{\n    \"name\" : \"Matias Barrios\",\n    \"age\" : 123\n}\n</code></pre>\n\n<p>The problem I am facing is that when I test if <code>name</code> is a string it works perfectly. But test if <code>age</code> is an int is always returning false, no matter what I do.</p>\n\n<pre><code>if gjson.Get(spec, \"name\").Exists() {\n            if _, ok := gjson.Get(spec, \"name\").Value().(string); !ok {\n                n := validator_error{Path: \"_.name\", Message: \"should be a string\"}\n                errors = append(errors,n)\n            }\n}\n\nif gjson.Get(spec, \"age\").Exists() {\n            if _, ok := gjson.Get(spec, \"age\").Value().(int); !ok {\n                n := validator_error{Path: \"_.age\", Message: \"should be an int\"}\n                errors = append(errors,n)\n            }\n\n        }\n</code></pre>\n\n<p>Could someone tell me where is the error here?</p>\n\n<p>Note - I am using this <a href=\"https://github.com/tidwall/gjson\" rel=\"nofollow noreferrer\">https://github.com/tidwall/gjson</a> to get the values out of the JSON.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 8084, "user_id": 2896626, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd83959d7fe39c658d2e49cfecfe4b6?s=128&d=identicon&r=PG&f=1", "display_name": "Paul92", "link": "https://stackoverflow.com/users/2896626/paul92"}, "is_accepted": false, "score": 0, "last_activity_date": 1518028668, "creation_date": 1518028668, "answer_id": 48671040, "question_id": 48670980, "link": "https://stackoverflow.com/questions/48670980/equals-keyword-ambiguity-in-golang-documentation/48671040#48671040", "title": "Equals keyword ambiguity in golang documentation", "body": "<p>It's not a keyword, is the variable (struct member, actually) name.</p>\n\n<p>In <code>golang</code>, the format to declare a variable is <code>name type</code>. Thus, on that line, a member named Equals of type string is defined. The capital letter means public visibility.</p>\n"}, {"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 0, "last_activity_date": 1518028669, "creation_date": 1518028669, "answer_id": 48671041, "question_id": 48670980, "link": "https://stackoverflow.com/questions/48670980/equals-keyword-ambiguity-in-golang-documentation/48671041#48671041", "title": "Equals keyword ambiguity in golang documentation", "body": "<p>This isn't the golang documentation, Equals is not a keyword, and it's not a type <em>or</em> a function in the code that you linked; it's the name of a struct field.</p>\n"}, {"tags": [], "owner": {"reputation": 542, "user_id": 5822368, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q75QC.jpg?s=128&g=1", "display_name": "Vikram Jakhar", "link": "https://stackoverflow.com/users/5822368/vikram-jakhar"}, "is_accepted": true, "score": 0, "last_activity_date": 1518031208, "creation_date": 1518031208, "answer_id": 48671707, "question_id": 48670980, "link": "https://stackoverflow.com/questions/48670980/equals-keyword-ambiguity-in-golang-documentation/48671707#48671707", "title": "Equals keyword ambiguity in golang documentation", "body": "<p>A struct is a user-defined type in golang having a group of fields. So in your case</p>\n\n<pre><code>type StringEqualCondition struct {\n    Equals string `json:\"equals\"`\n} \n</code></pre>\n\n<p>StringEqualCondition is a struct having a field named Equals.</p>\n\n<p>It's just a simple variable of type string in the struct.</p>\n"}], "owner": {"reputation": 1, "user_id": 6185061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08753fb5426d563495063581b3569aca?s=128&d=identicon&r=PG&f=1", "display_name": "Adhithya K R", "link": "https://stackoverflow.com/users/6185061/adhithya-k-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 48671707, "answer_count": 3, "score": -4, "last_activity_date": 1518031208, "creation_date": 1518028459, "question_id": 48670980, "link": "https://stackoverflow.com/questions/48670980/equals-keyword-ambiguity-in-golang-documentation", "title": "Equals keyword ambiguity in golang documentation", "body": "<p>I am having trouble understanding the Equals keyword in this context. Could someone explain whether it is a type or a function as I am not able to find docs for golang pertaining to this. <a href=\"https://github.com/ory/ladon/blob/9fada03c11c183e37c13f581ee6deca8d8e747f9/condition_string_equal.go#L19-L21\" rel=\"nofollow noreferrer\">https://github.com/ory/ladon/blob/9fada03c11c183e37c13f581ee6deca8d8e747f9/condition_string_equal.go#L19-L21</a></p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518024959, "post_id": 48670024, "comment_id": 84337769, "body": "You&#39;ve only guaranteed that the value is received in the goroutine, nothing else. Your goroutine also never returns, so I&#39;m not sure what you mean by &quot;the anonymous function exited&quot;"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1518025088, "post_id": 48670024, "comment_id": 84337832, "body": "It is because the main retuned and thus the program ends. Even if the value is returned <code>fmt.Printx</code> involves a syscall which can lead to reschedule"}, {"owner": {"reputation": 156, "user_id": 2072030, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/hAv1U.jpg?s=128&g=1", "display_name": "Vishwa", "link": "https://stackoverflow.com/users/2072030/vishwa"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518091608, "post_id": 48670024, "comment_id": 84367398, "body": "@JimB Other question/answers solved my problem."}], "owner": {"reputation": 156, "user_id": 2072030, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/hAv1U.jpg?s=128&g=1", "display_name": "Vishwa", "link": "https://stackoverflow.com/users/2072030/vishwa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "closed_date": 1518025138, "answer_count": 0, "score": 0, "last_activity_date": 1518025207, "creation_date": 1518024863, "question_id": 48670024, "link": "https://stackoverflow.com/questions/48670024/is-go-routine-closed-before-channel-is-written-from-main-function", "closed_reason": "Duplicate", "title": "Is Go routine closed before channel is written from main function", "body": "<p>The blow code does not print anything even if main function is writing to channel. \nIs it because the goroutine running the anonymous function exited before channel could receive any value?</p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc main() {\n  ch := make(chan int)\n  go func () {for{fmt.Println(&lt;-ch)}} ()\n  ch &lt;- 1\n}\n</code></pre>\n"}, {"tags": ["http", "go", "cookies"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1518022824, "post_id": 48669172, "comment_id": 84336469, "body": "This just refers to the &quot;name&quot; parameter. The function returns the cookie with the given name. In your example there is one cookie with the name &quot;My-Cookie&quot;."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1518022895, "post_id": 48669172, "comment_id": 84336521, "body": "Try printing the <code>Cookie.Name</code> directly. When you print <code>req.Cookies()</code>, it sanitizes the cookie name (replaces <code>\\n</code> and <code>\\r</code> with <code>-</code>)"}, {"owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518025629, "post_id": 48669172, "comment_id": 84338170, "body": "Thank you @Marc. That was the issue"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1518027337, "post_id": 48669172, "comment_id": 84339180, "body": "It also looks like you have a cookie inside a cookie, as there are no semicolons in the output, <code>Path</code> is listed twice, and <code>HttpOnly=</code> isn&#39;t a valid output format."}], "answers": [{"tags": [], "owner": {"reputation": 86, "user_id": 467082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9aBYd.png?s=128&g=1", "display_name": "blackbox", "link": "https://stackoverflow.com/users/467082/blackbox"}, "is_accepted": true, "score": 2, "last_activity_date": 1518123485, "last_edit_date": 1518123485, "creation_date": 1518118572, "answer_id": 48693450, "question_id": 48669172, "link": "https://stackoverflow.com/questions/48669172/what-is-a-named-cookie/48693450#48693450", "title": "What is a named cookie?", "body": "<p>Here is a <a href=\"https://play.golang.org/p/_VX_ZvlC_9A\" rel=\"nofollow noreferrer\">golang playground</a>. It shows that what the OP posted works, so the bug is somewhere else. It also answers the question by showing what the named cookie is.</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"net/http\"\n)\n\nfunc main() {\n  r := &amp;http.Request{\n    Header: http.Header{\n      \"Cookie\": []string{\n        \"My-Cookie=a783e7e4-c331-4802-6544-7374f5128882 Path=/svc Expires=Tue, 07 Feb 2068 16:05:53 GMT Path=/svc HttpOnly=\",\n      },\n    },\n  }\n\n  fmt.Println(r.Cookies())\n\n  c, err := r.Cookie(\"My-Cookie\")\n  if err != nil {\n    fmt.Println(\"Error:\", err)\n    return\n  }\n\n  // only cookie name and value are parsed\n  fmt.Println(\"Name\", c.Name)\n  fmt.Println(\"Value\", c.Value)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 538, "favorite_count": 0, "accepted_answer_id": 48693450, "answer_count": 1, "score": 3, "last_activity_date": 1518123485, "creation_date": 1518022341, "question_id": 48669172, "link": "https://stackoverflow.com/questions/48669172/what-is-a-named-cookie", "title": "What is a named cookie?", "body": "<p>I am reading <a href=\"https://golang.org/pkg/net/http/#Request.Cookie\" rel=\"nofollow noreferrer\">official documentation</a> about Go language and found:</p>\n\n<blockquote>\n  <p><code>Cookie</code> returns the named cookie provided in the request</p>\n</blockquote>\n\n<p>When I try <code>req.Cookie(\"My-Cookie\")</code> I receive <code>named cookie not present</code></p>\n\n<p>While when I <code>fmt.Println(req.Cookies())</code> I receive following string:</p>\n\n<pre><code>[My-Cookie=a783e7e4-c331-4802-6544-7374f5128882 Path=/svc Expires=\"Tue, 07 Feb 2068 16:05:53 GMT\" Path=/svc HttpOnly=]\n</code></pre>\n\n<p>What is the named cookie then?</p>\n"}, {"tags": ["json", "go", "jsonschema"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1518020253, "post_id": 48668453, "comment_id": 84334739, "body": "The second question is off-topic for SO: <i>Questions asking us to recommend or find a book, tool, software library, tutorial or other off-site resource are off-topic for Stack Overflow as they tend to attract opinionated answers and spam.</i>"}], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 9328575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7230e3fb2ba1b9151719721dce2afef7?s=128&d=identicon&r=PG&f=1", "display_name": "A_Noniem", "link": "https://stackoverflow.com/users/9328575/a-noniem"}, "is_accepted": true, "score": 3, "last_activity_date": 1518029544, "creation_date": 1518029544, "answer_id": 48671245, "question_id": 48668453, "link": "https://stackoverflow.com/questions/48668453/multiple-schema-json-validation-in-golang/48671245#48671245", "title": "Multiple schema JSON validation in Golang", "body": "<p>The way to refer to a file using <code>$ref</code> is to specify the absolute path of the file using a URL scheme. If you change the <code>$ref</code> to look like <code>\"$ref\" : \"file:///home/user/directory/CommonTypes.json#/definitions/Type01Definition</code>, your example will work as expected.</p>\n\n<p>If you need a bit more flexibility you can either try <code>gojsonschema</code>'s <a href=\"https://godoc.org/github.com/xeipuuv/gojsonschema#NewReferenceLoaderFileSystem\" rel=\"nofollow noreferrer\">NewReferenceLoaderFilesystem</a> or switch to a different <code>Golang</code> library <a href=\"https://github.com/santhosh-tekuri/jsonschema\" rel=\"nofollow noreferrer\">https://github.com/santhosh-tekuri/jsonschema</a>. That library allows you to add custom resources so you can load several schemas at once.</p>\n"}], "owner": {"reputation": 2998, "user_id": 1089799, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/927059cce12f1e3337ae1e908f510cf9?s=128&d=identicon&r=PG", "display_name": "Dante", "link": "https://stackoverflow.com/users/1089799/dante"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1456, "favorite_count": 0, "accepted_answer_id": 48671245, "answer_count": 1, "score": 2, "last_activity_date": 1518029544, "creation_date": 1518020168, "question_id": 48668453, "link": "https://stackoverflow.com/questions/48668453/multiple-schema-json-validation-in-golang", "title": "Multiple schema JSON validation in Golang", "body": "<p>I need to validate several <code>JSON</code> files against a schema in <code>Golang</code>.</p>\n\n<p>I have been able to achieve it by using <a href=\"https://github.com/xeipuuv/gojsonschema\" rel=\"nofollow noreferrer\">gojsonschema</a>, that is really a straight forward library.</p>\n\n<p>However, the problem I'm facing right now is that I have been given with schemas that have dependencies to another schemas and haven't found the way to load all the schemas that I need. Therefore, my validations always fail.</p>\n\n<p>This is my main schema:</p>\n\n<pre><code>{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"$ref\": \"#/definitions/List\",\n    \"definitions\": {\n        \"List\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"$ref\": \"#/definitions/Item\"\n            }\n        },\n        \"Item\": {\n            \"description\": \"An item ....\",\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"properties\": {\n                \"property01\": {\n                    \"description\": \"The property01 code.\",\n                    \"$ref\": \"./CommonTypes.json#/definitions/Type01Definition\"\n                }\n            },\n            \"required\": [\n                \"property01\"\n            ]\n        }\n    }\n}\n</code></pre>\n\n<p>And, I have another one with common types:</p>\n\n<pre><code>{\n    \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n    \"definitions\": {\n        \"Type01Definition\": {\n            \"description\": \"The definition for the type 01\",\n            \"type\": \"string\",\n            \"pattern\": \"^[A-Z0-9]{3}$\"\n        }\n    }\n}\n</code></pre>\n\n<p>Is there a way to load several schemas using that library? Or is there any other <code>Golang</code> library that allows to achieve that?</p>\n"}, {"tags": ["go", "goroutine", "channels"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1518018062, "post_id": 48667676, "comment_id": 84333127, "body": "Where are you running this? If <code>GOMAXPROCS</code> is greater than 1, then it will print it <code>0</code>, then deadlock."}, {"owner": {"reputation": 280, "user_id": 3629623, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/nITcO.jpg?s=128&g=1", "display_name": "Subomi", "link": "https://stackoverflow.com/users/3629623/subomi"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518018240, "post_id": 48667676, "comment_id": 84333281, "body": "It prints nothing in my case, just throws that error"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518018321, "post_id": 48667676, "comment_id": 84333363, "body": "Sure it prints. You&#39;re showing the output yourself: <code>0fatal error ...</code>. The <code>0</code> at the beginning of the line is from the print statement."}, {"owner": {"reputation": 280, "user_id": 3629623, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/nITcO.jpg?s=128&g=1", "display_name": "Subomi", "link": "https://stackoverflow.com/users/3629623/subomi"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518018572, "post_id": 48667676, "comment_id": 84333544, "body": "Wow .. Actually, Your response was king about this. My code actually works. The problem was i wasn&#39;t ending well so when all goroutines sleep .. it deadlocks."}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1521473467, "post_id": 48667676, "comment_id": 85734008, "body": "move on of the goroutines to a for loop in main if it deadlock because main is not doing anything it means you should probaly do one of your routines in the main function,"}], "answers": [{"comments": [{"owner": {"reputation": 280, "user_id": 3629623, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/nITcO.jpg?s=128&g=1", "display_name": "Subomi", "link": "https://stackoverflow.com/users/3629623/subomi"}, "edited": false, "score": 0, "creation_date": 1518018607, "post_id": 48667822, "comment_id": 84333577, "body": "Thanks as well! .. for the loop in the first go routine. I have a better understanding of it now."}], "tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": false, "score": 1, "last_activity_date": 1518375519, "last_edit_date": 1518375519, "creation_date": 1518018250, "answer_id": 48667822, "question_id": 48667676, "link": "https://stackoverflow.com/questions/48667676/i-want-to-communicate-between-goroutines-and-block-main-thread-indefinitely/48667822#48667822", "title": "I want to communicate between goroutines and block main thread indefinitely", "body": "<p>I think you want to print all value <code>[0:99]</code>. Then you need loop in 1st <code>go routine</code>.</p>\n\n<p>And also, you need to pass signal to break loop</p>\n\n<pre><code>func main() {\n    ch := make(chan int)\n    stopProgram := make(chan bool)\n\n    go func() {\n        for i := 0; i &lt; 100; i++ {\n            value := &lt;-ch\n            fmt.Println(value)\n        }\n        // Send signal through stopProgram to stop loop\n        stopProgram &lt;- true\n    }()\n\n    go func() {\n        for i := 0; i &lt; 100; i++ {\n            time.Sleep(100 * time.Millisecond)\n            ch &lt;- i\n        }\n    }()\n\n    // your problem will wait here until it get stop signal through channel\n    &lt;-stopProgram\n}\n</code></pre>\n"}], "owner": {"reputation": 280, "user_id": 3629623, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/nITcO.jpg?s=128&g=1", "display_name": "Subomi", "link": "https://stackoverflow.com/users/3629623/subomi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 984, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1518375519, "creation_date": 1518017826, "question_id": 48667676, "link": "https://stackoverflow.com/questions/48667676/i-want-to-communicate-between-goroutines-and-block-main-thread-indefinitely", "title": "I want to communicate between goroutines and block main thread indefinitely", "body": "<p>How do i block the the main func and allow goroutines communicate through channels the following code sample throws me an error</p>\n\n<p>0fatal error: all goroutines are asleep - deadlock!</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"time\"\n)\n\nfunc main() {\n   ch := make(chan int)\n\n   go func() {\n       value := &lt;-ch\n       fmt.Print(value) // This never prints!\n   }()\n\n   go func() {\n       for i := 0; i &lt; 100; i++ {\n           time.Sleep(100 * time.Millisecond)\n           ch &lt;- i\n       }\n   }()\n\n   c := make(chan int)\n   &lt;-c\n}\n</code></pre>\n"}, {"tags": ["go", "null"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1518016709, "post_id": 48667212, "comment_id": 84332152, "body": "<code>nil</code> is not a valid value for the <code>string</code> type, so even a check like <code>plz == nil</code> is a compile time error."}, {"owner": {"reputation": 2072, "user_id": 1195266, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/6c5Fj.jpg?s=128&g=1", "display_name": "Macilias", "link": "https://stackoverflow.com/users/1195266/macilias"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518017972, "post_id": 48667212, "comment_id": 84333053, "body": "yes, sorry I was to quick with the post, and missed that, the question has been updated in the meantime"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518016805, "post_id": 48667246, "comment_id": 84332213, "body": "Yeah, but the impression I got from the question was it&#39;s about the syntax of an inline <code>nil</code> check, not literally checking if a <code>string</code> is <code>nil</code> or not. Updated answer to add that note just in case."}, {"owner": {"reputation": 2072, "user_id": 1195266, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/6c5Fj.jpg?s=128&g=1", "display_name": "Macilias", "link": "https://stackoverflow.com/users/1195266/macilias"}, "edited": false, "score": 0, "creation_date": 1518017538, "post_id": 48667246, "comment_id": 84332759, "body": "yes sorry was just about to update the question, you&#180;ve been too fast :) but the answer is good!"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1518016766, "last_edit_date": 1518016766, "creation_date": 1518016667, "answer_id": 48667246, "question_id": 48667212, "link": "https://stackoverflow.com/questions/48667212/multiple-nil-nil-detection-in-go/48667246#48667246", "title": "multiple nil, nil, ... detection in Go", "body": "<p>Not quite that succinctly, but yes:</p>\n\n<pre><code>if plz, street := getAdressParts(); plz == nil &amp;&amp; street == nil {\n    // Do stuff\n}\n</code></pre>\n\n<p>This is demonstrated in <a href=\"https://tour.golang.org/flowcontrol/6\" rel=\"nofollow noreferrer\">the Go tour</a> and <a href=\"https://golang.org/ref/spec#If_statements\" rel=\"nofollow noreferrer\">the Go spec</a>.</p>\n\n<p>Note as icza points out, this doesn't make any sense for <code>string</code>s (which can't be <code>nil</code>), but the syntax you'd use for a valid test is as above.</p>\n"}, {"comments": [{"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1518016941, "post_id": 48667299, "comment_id": 84332325, "body": "what about <code>a+b==&quot;&quot;</code>? Is not more costly than yours?"}, {"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 1, "creation_date": 1518104316, "post_id": 48667299, "comment_id": 84376518, "body": "In the case where a or b is not empty, that seems more expensive as it&#39;ll require an allocation and 2 copes."}], "tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": false, "score": 3, "last_activity_date": 1518016809, "creation_date": 1518016809, "answer_id": 48667299, "question_id": 48667212, "link": "https://stackoverflow.com/questions/48667212/multiple-nil-nil-detection-in-go/48667299#48667299", "title": "multiple nil, nil, ... detection in Go", "body": "<p>string can't be nil, but i think you'll need to do</p>\n\n<pre><code>if a, b := getAdressParts(); a == \"\" &amp;&amp; b == \"\" {\n    println(\"nil\")\n}\n</code></pre>\n"}], "owner": {"reputation": 2072, "user_id": 1195266, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/6c5Fj.jpg?s=128&g=1", "display_name": "Macilias", "link": "https://stackoverflow.com/users/1195266/macilias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 48667246, "answer_count": 2, "score": -2, "last_activity_date": 1518018404, "creation_date": 1518016574, "last_edit_date": 1518018404, "question_id": 48667212, "link": "https://stackoverflow.com/questions/48667212/multiple-nil-nil-detection-in-go", "title": "multiple nil, nil, ... detection in Go", "body": "<p>In go you can have several returns like:</p>\n\n<pre><code>func getAdressParts() (plz *string, street *string) {\n    return nil, nil\n}\n\nfunc main() {\n\n    //if getAdressParts() == nil, nill {\n    //   println(true)\n    //} else {\n    //   println(false)\n    //}\n\n    // As already suggested the answer is:\n    if plz, street := getAdressParts(); plz == nil &amp;&amp; street == nil {\n        println(\"Hurra\")\n    } else {\n        println(\"nope\")\n    }\n\n}\n</code></pre>\n\n<p>is there any way to check both inline for nil like:</p>\n\n<pre><code>if getAdressParts() == nil, nil {\n   ...\n}\n</code></pre>\n\n<p>you can play with example here: <a href=\"https://play.golang.org/p/xbHCxl_AJyw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/xbHCxl_AJyw</a></p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1518013542, "post_id": 48666021, "comment_id": 84329827, "body": "Obviously the later. Where on earth did you see the second variant in the standard library?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1518013570, "post_id": 48666021, "comment_id": 84329848, "body": "If that\u2019s supposed to be an output parameter, Go has multiple return parameters, there no reason for output parameters on their own. I that\u2019s not, you need to provide more info."}, {"owner": {"reputation": 1373, "user_id": 4165479, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed71eed5c9cf3f219c4e303d76dd79ff?s=128&d=identicon&r=PG&f=1", "display_name": "LuMa", "link": "https://stackoverflow.com/users/4165479/luma"}, "edited": false, "score": 0, "creation_date": 1518014022, "post_id": 48666021, "comment_id": 84330183, "body": "Yes, it&#39;s supposed to be an output parameter."}, {"owner": {"reputation": 1373, "user_id": 4165479, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed71eed5c9cf3f219c4e303d76dd79ff?s=128&d=identicon&r=PG&f=1", "display_name": "LuMa", "link": "https://stackoverflow.com/users/4165479/luma"}, "edited": false, "score": 0, "creation_date": 1518014109, "post_id": 48666021, "comment_id": 84330249, "body": "I thought about <code>func Unmarshal(data []byte, v interface{}) error</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1518014165, "post_id": 48666021, "comment_id": 84330311, "body": "Both are idiomatic (the name not withstanding). But they do entirely different things."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1518015580, "post_id": 48666021, "comment_id": 84331345, "body": "@Volker I think you mean &quot;obviously the former&quot;, based on the second sentence."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1518016466, "post_id": 48666021, "comment_id": 84331978, "body": "Both forms appear in the stdlib. sql.DB.Query and runtime.MemStats, for instance."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 7, "last_activity_date": 1518015356, "creation_date": 1518015356, "answer_id": 48666813, "question_id": 48666021, "link": "https://stackoverflow.com/questions/48666021/what-is-more-idiomatic-in-go/48666813#48666813", "title": "What is more idiomatic in go?", "body": "<p>Depends on the intended purpose.</p>\n\n<p>If the purpose is to \u00ad\u2014 given an identifier \u2014 fetch the information\nabout the user <em>and fill a user-supplied variable</em> (of an appropriate type)\nwith that information, then it's the case for\n<code>func GetUser(id string, u *User) error</code>.</p>\n\n<p>If the purpose is to fetch that information and <em>create a new value</em>\n(of an appropriate type) containing that information and return it\n(or \u2014 as in your case \u2014 a pointer to it) to the user, then it's the case\nfor <code>func GetUser(id string) (*User, error)</code>.</p>\n\n<p>So, in the end, it's not about comparing \"idiomaticity factor\" of the\ntwo solutions; they capture different ways to deal with the obtained\ndata.</p>\n"}], "owner": {"reputation": 1373, "user_id": 4165479, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed71eed5c9cf3f219c4e303d76dd79ff?s=128&d=identicon&r=PG&f=1", "display_name": "LuMa", "link": "https://stackoverflow.com/users/4165479/luma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 48666813, "answer_count": 1, "score": -3, "last_activity_date": 1518016165, "creation_date": 1518012840, "last_edit_date": 1518016165, "question_id": 48666021, "link": "https://stackoverflow.com/questions/48666021/what-is-more-idiomatic-in-go", "title": "What is more idiomatic in go?", "body": "<p>I'm designing an interface and wonder, what's the more idiomatic way:</p>\n\n<pre><code>func GetUser(id string) (*User, error)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>func GetUser(id string, u *User) error\n</code></pre>\n"}, {"tags": ["linux", "go", "raspberry-pi3", "raspbian", "indoor-positioning-system"], "answers": [{"tags": [], "owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "is_accepted": false, "score": 0, "last_activity_date": 1518020173, "creation_date": 1518020173, "answer_id": 48668455, "question_id": 48666003, "link": "https://stackoverflow.com/questions/48666003/how-to-install-find-internal-positiong/48668455#48668455", "title": "How to install find / internal positiong", "body": "<p>go get disable \"terminal prompt\" by default. This can be changed by set the env of git:</p>\n\n<pre><code>env GIT_TERMINAL_PROMPT=1 go get github.com/schollz/find/...\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 7431463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1cd892825c3217182bb0d59a64e6f58?s=128&d=identicon&r=PG", "display_name": "Nanne118", "link": "https://stackoverflow.com/users/7431463/nanne118"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 168, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518020173, "creation_date": 1518012791, "last_edit_date": 1518018879, "question_id": 48666003, "link": "https://stackoverflow.com/questions/48666003/how-to-install-find-internal-positiong", "title": "How to install find / internal positiong", "body": "<p>I am trying to install the find server, the internal positioning (<a href=\"https://github.com/schollz/find\" rel=\"nofollow noreferrer\">https://github.com/schollz/find</a>)  (<a href=\"https://www.internalpositioning.com/\" rel=\"nofollow noreferrer\">https://www.internalpositioning.com/</a>) software that has a server for on the Raspberry Pi (3). </p>\n\n<p>The install works by using golang, and I cannot quite figure out how to make go(lang) install the find package. The directions given on the otherwise helpful install page (<a href=\"https://www.internalpositioning.com/server/\" rel=\"nofollow noreferrer\">https://www.internalpositioning.com/server/</a>) are to install go (which I have done by $ sudo apt-get install golang) and that indeed does tell me that I have go version go1.7.4 linux/arm (command <code>$ go version</code>).</p>\n\n<p>Additionally I have set the root paths so that the Raspberry Pi actually knows where to find go:</p>\n\n<pre><code>export GOROOT=/usr/local/go\nexport GOPATH=$HOME/go\nexport PATH=$PATH:$GOROOTH/bin\n</code></pre>\n\n<p>We then proceed with the actual commands to install find (internal positioning software server) by cloning it from github and installing it with go(lang); via the following commands.</p>\n\n<pre><code>$ git clone https://github.com/schollz/find.git    \n$ cd find    \n$ go get ./...\n$ go build\n</code></pre>\n\n<p>I cannot get the '/find $ go get ./...' command to work with whatever parameters I put in. Clearly the command needs input parameters / directories but none of the input paths I have tried seem to work, and I cannot figure out which one it wants from googling the issue or indeed looking it up on stackoverflow.</p>\n\n<p>Running '/find $ go get ./...' does not appear to give me any response from the raspberry pi; there is not message that it is doing something and the raspberry pi cpu percentage stays low; after 5 - 10 minutes I get: </p>\n\n<pre><code># cd .; git clone https://github.com/foo/vendored /home/pi/go/src/github.com/foo/vendored\nCloning into '/home/pi/go/src/github.com/foo/vendored'...\nfatal: could not read Username for 'https://github.com': terminal prompts disabled\npackage github.com/foo/vendored: exit status 128\nPassword: \n</code></pre>\n\n<p>which does not help me a whole lot either. Running it by pointing golang towards the go github location also does not yield anything promising:</p>\n\n<pre><code>/find $ go get https://github.com/schollz/find.git   \npackage https:/github.com/schollz/find.git: \"https://\" not allowed in import path\n</code></pre>\n\n<p>nor does   </p>\n\n<pre><code> /find $ go get /home/pi./find\npackage /home/pi./find: unrecognized import path \"/home/pi./find\" (import path does not begin with hostname)\n</code></pre>\n\n<p>I have no clue what go wants of me; anyone able to shed a light?</p>\n\n<p>EDIT: I seem to have fixed the issue where the gopath is not being found correctly: rather than using <code>export GOPATH=$HOME/go</code> I have used <code>GOPATH=$HOME/go</code>; no idea why that fixes things.</p>\n\n<p>I now get the error when I use the command <code>$ go get ./...</code></p>\n\n<pre><code>find $ go get ./...\n# cd .; git clone https://github.com/foo/vendored /home/pi/go/src/github.com/foo/vendored\nCloning into '/home/pi/go/src/github.com/foo/vendored'...\nfatal: could not read Username for 'https://github.com': terminal prompts disabled\npackage github.com/foo/vendored: exit status 128\nPassword: \n</code></pre>\n\n<p>Indicating I would need to login: however I cannot seem to make this happen either.</p>\n"}, {"tags": ["go", "build", "compilation"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 3, "creation_date": 1518006071, "post_id": 48663549, "comment_id": 84324579, "body": "It is really hard to migrate the whole <code>GOPATH</code> thing into your current structure. I would suggest have a <code>GOPATH</code> and write codes there, then use soft link to link back into your current structure."}, {"owner": {"reputation": 1089, "user_id": 3829310, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/blWdU.jpg?s=128&g=1", "display_name": "Steve Amerige", "link": "https://stackoverflow.com/users/3829310/steve-amerige"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1518006190, "post_id": 48663549, "comment_id": 84324645, "body": "@leafbebop - using symbolic links back to the read-only source location is a good improvement. If it is not possible to configure Go building to specify the src, pkg, and bin directories, then please feel free to write up your reply as an answer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1518006316, "post_id": 48663549, "comment_id": 84324731, "body": "If you want to use the go tool, you have to follow the Go conventions. You can compile and link code however you want, but it\u2019s a lot of work, and no one else\u2019s workflow will be compatible with yours."}, {"owner": {"reputation": 1089, "user_id": 3829310, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/blWdU.jpg?s=128&g=1", "display_name": "Steve Amerige", "link": "https://stackoverflow.com/users/3829310/steve-amerige"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518006495, "post_id": 48663549, "comment_id": 84324844, "body": "@JimB - thanks... as a new Go programmer, this is the kind of advice I need. In other programming paradigms, the use of <code>autoconf</code> or other similar things is possible to guide many build aspects. Knowing the truth of things matters most and, yes, I don&#39;t want to do a lot of extra work. But, Go is not an island and needs to co-exist with other code in my case. So, I&#39;m looking for a way that is as harmonious as possible."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1518006581, "post_id": 48663549, "comment_id": 84324894, "body": "If you are &quot;new to the Go programming language&quot; there is just one advice: Don&#39;t fight the language. Stop doing what you try to do (no idea what it is) and use Go as intended. Once you understand Go: Invoke compiler and linker yourself (see how the go tool does it by running it with -x)."}, {"owner": {"reputation": 1089, "user_id": 3829310, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/blWdU.jpg?s=128&g=1", "display_name": "Steve Amerige", "link": "https://stackoverflow.com/users/3829310/steve-amerige"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1518006790, "post_id": 48663549, "comment_id": 84325023, "body": "@Volker - the main focus of the question is integrating Go into existing code. Btw, I&#39;m not sure why my OP got a down vote, because the question of code integration is valid, in my opinion. It seems that Go program development does not allow the kind of integration that is possible with other programming languages. And that is fine and is part of the answer. Thanks for your feedback."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1518006979, "post_id": 48663549, "comment_id": 84325127, "body": "Why do you want to integrate with existing code? What problem are you trying to solve? This seems a lot like an XY problem (and a terrible solution)."}, {"owner": {"reputation": 1089, "user_id": 3829310, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/blWdU.jpg?s=128&g=1", "display_name": "Steve Amerige", "link": "https://stackoverflow.com/users/3829310/steve-amerige"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1518007315, "post_id": 48663549, "comment_id": 84325320, "body": "@Flimzy - a large body of code already exists into which this will be a part. There isn&#39;t a specific problem I&#39;m trying to solve here... I&#39;m merely looking to integrate Go code into a larger body of existing code and looking to see if it were possible."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1518007436, "post_id": 48663549, "comment_id": 84325418, "body": "Then develop your Go code the Go way, until you have a problem. Then address that problem. Don&#39;t complicate things before you know what you need to fix."}, {"owner": {"reputation": 1089, "user_id": 3829310, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/blWdU.jpg?s=128&g=1", "display_name": "Steve Amerige", "link": "https://stackoverflow.com/users/3829310/steve-amerige"}, "edited": false, "score": 0, "creation_date": 1518007471, "post_id": 48663549, "comment_id": 84325445, "body": "The problem is one of integration."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1518007505, "post_id": 48663549, "comment_id": 84325468, "body": "Your Go code will produce an executable. That&#39;s true whether you do things the Go way, or your complex way. If you can integrate an executable with your complex structure, you can do it more easily the Go way."}, {"owner": {"reputation": 1089, "user_id": 3829310, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/blWdU.jpg?s=128&g=1", "display_name": "Steve Amerige", "link": "https://stackoverflow.com/users/3829310/steve-amerige"}, "edited": false, "score": 0, "creation_date": 1518007620, "post_id": 48663549, "comment_id": 84325538, "body": "Having to separate code into different directories means that the maintainer of code has to look in different locations for code that deals with the same topic. This makes maintenance more difficult. It would be easier if all related code were closer to each other. But, I see from the responses above that Go does not readily make this easy: having Go code alongside other code."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1518007792, "post_id": 48663549, "comment_id": 84325643, "body": "I really think you&#39;re abstracting/grouping at the wrong level. I&#39;ve worked on many multi-langauge projects, and have never had reason to integrate multiple languages in the same directory structure, and can&#39;t imagine why I would ever want to. Maybe you have a use case that falls outside of my expertise, but it would be good to explain that in your question, if you believe you have a special case."}, {"owner": {"reputation": 1089, "user_id": 3829310, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/blWdU.jpg?s=128&g=1", "display_name": "Steve Amerige", "link": "https://stackoverflow.com/users/3829310/steve-amerige"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1518007869, "post_id": 48663549, "comment_id": 84325697, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/164693/discussion-between-steve-amerige-and-flimzy\">continue this discussion in chat</a>."}, {"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 1, "creation_date": 1518008510, "post_id": 48663549, "comment_id": 84326207, "body": "go build have a &#171; -o &#187; switch to choose where to produce the executable. You can also append path to the GOPATH env variable for more place look for packages.  I set all that in a Makefile and type make to build. It\u2019s not how go is made to works, but it works in my case. (I was already using complicate Makefile structure on the rest of the code that is in C++)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1518009002, "post_id": 48663549, "comment_id": 84326621, "body": "&quot;the question is integrating Go into existing code&quot; there is no easy way to integrate Go into other languages, you&#39;ll have a hard time calling into Go code from your Python/Ruby/C++/Haskel/Whatever code. So the question is obviously <i>not</i> about &quot;integrating&quot; Go with other languages but on how to structure a multi-language project. And the only answer here is do not try to force a directory structure on Go which is unsuitable."}], "answers": [{"tags": [], "owner": {"reputation": 387, "user_id": 697895, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/05ce691b8b3ce3669b488ffbe47e248a?s=128&d=identicon&r=PG", "display_name": "jgrump2012", "link": "https://stackoverflow.com/users/697895/jgrump2012"}, "is_accepted": true, "score": 2, "last_activity_date": 1518008845, "creation_date": 1518008845, "answer_id": 48664644, "question_id": 48663549, "link": "https://stackoverflow.com/questions/48663549/how-to-build-go-without-the-literal-bin-pkg-and-src-directories/48664644#48664644", "title": "How to build Go without the literal bin, pkg, and src directories?", "body": "<p>That against Go's conventions and is not a recommended practice</p>\n"}], "owner": {"reputation": 1089, "user_id": 3829310, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/blWdU.jpg?s=128&g=1", "display_name": "Steve Amerige", "link": "https://stackoverflow.com/users/3829310/steve-amerige"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 48664644, "answer_count": 1, "score": -1, "last_activity_date": 1518008845, "creation_date": 1518005677, "question_id": 48663549, "link": "https://stackoverflow.com/questions/48663549/how-to-build-go-without-the-literal-bin-pkg-and-src-directories", "title": "How to build Go without the literal bin, pkg, and src directories?", "body": "<p>I am new to the Go programming language. I am hoping to integrate Go code, if possible, into existing code that contains heterogeneous code. My present organization of code is:</p>\n\n<pre><code>&lt;reverse-TLD&gt;/&lt;component-path&gt;/&lt;code&gt;&lt;extension&gt;\n</code></pre>\n\n<p>where:</p>\n\n<ul>\n<li><strong>&lt;reverse-TLD&gt;</strong> is the domain with parts reversed. For example, <code>com.mydomain.mysubdomain</code>.</li>\n<li><strong>&lt;component-path&gt;</strong> is 1 or more subdirectories under which code lives. For example, <code>image/jpeg</code>.</li>\n<li><strong>&lt;code&gt;</strong> is the part of a code filename before the extension. For example, <code>jpeg2000</code>.</li>\n<li><strong>&lt;extension&gt;</strong> is the extension. For example, <code>.sh</code>, <code>.py</code>, etc. For example, this taken with the other elements above would have a path: <code>com.mydomain.mysubdomain/image/jpeg/jpeg2000.go</code>.</li>\n</ul>\n\n<p>Note that code files other than Go files are in the same directory as Go files.</p>\n\n<p><strong>My issues are:</strong></p>\n\n<ol>\n<li>My existing structure above doesn't include <strong>src</strong>, <strong>pkg</strong>, or <strong>bin</strong> directories. Are there environment or Go env variables that allow me to specify these directories?</li>\n<li>The directory &lt;reverse-TLD&gt; and all files under it is read-only. I need the output of the compilation to be based under another directory, given as <code>$BUILD_DIR</code>. That directory can have whatever directories are needed under it.</li>\n<li>I am thinking that as a convention, I could use lowercase filenames for Go code that will become an executable command and leading-uppercase filenames for Go code that will become package objects. Is there a best practice naming convention for making this distinction in the Go community?</li>\n<li>Is there any problem with my using reverse TLDs? For example, <code>com.mydomain.mysubdomain</code> vs. <code>mysubdomain.mydomain.com</code>.</li>\n</ol>\n\n<p>If the <strong>src</strong>, <strong>pkg</strong>, and <strong>bin</strong> directories are hard requirements, then I think I'll have to write a script that finds Go files and copies them to a temporary directory that meets the requirements, compile them, and then move the built artifacts to the <code>$BUILD_DIR</code>. But, I'm hoping that Go is flexible enough to allow me to do this.</p>\n\n<p>If it is possible, could you show me the commands or environment variables that are needed to compile given the constraints above? And, comments on items 1-4 above are appreciated. Thank you!</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1518004570, "post_id": 48663141, "comment_id": 84323613, "body": "&quot;syntactic sugar&quot; and Go do not mix well. Stop looking and start writing code."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1518004823, "post_id": 48663141, "comment_id": 84323788, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/48305430/named-keys-for-go-sql-driver-scan\">Named keys for go-sql-driver Scan()</a>"}, {"owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "edited": false, "score": 0, "creation_date": 1518016216, "post_id": 48663141, "comment_id": 84331785, "body": "I don&#39;t know what purpose downvoting without specifying a reason serves. Does it show lack of research? Is it unclear? Or is it unhelpful?"}], "answers": [{"comments": [{"owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "edited": false, "score": 0, "creation_date": 1518009631, "post_id": 48663581, "comment_id": 84327092, "body": "I won&#39;t use this solution as it is an overkill for what I&#39;m trying to do, but this answer perfectly answers my question."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 2, "last_activity_date": 1518005793, "creation_date": 1518005793, "answer_id": 48663581, "question_id": 48663141, "link": "https://stackoverflow.com/questions/48663141/how-to-list-pointers-to-all-fields-of-golang-struct/48663581#48663581", "title": "How to list pointers to all fields of golang struct?", "body": "<p>Besides all sql specified tools, if you want to access to pointers of a struct, you can use <code>reflect</code>. Be warned that the package is tricky and rob pike said it is not for everyone.</p>\n\n<p><code>reflect.Value</code> has methods <code>NumField</code> which returns the numbber of fields in the struct and <code>Field(int)</code> which accepts the index of a field and return the field itself.</p>\n\n<p>But as you want to set a value to it, it is more complicated than just calling the two methods. Let me show you in code:</p>\n\n<pre><code>func Scan(x interface{}) {\n    v := reflect.ValueOf(x).Elem()\n    for i := 0; i &lt; v.NumField(); i++ {\n        switch f := v.Field(i); f.Kind() {\n        case reflect.Int:\n            nv := 37\n            f.Set(reflect.ValueOf(nv))\n        case reflect.Bool:\n            nv := true\n            f.Set(reflect.ValueOf(nv))\n        }\n    }\n}\n</code></pre>\n\n<p>First, you need to pass a pointer of the struct into <code>Scan</code>, since you are modifying data and the value must be settable. That is why we are calling <code>.Elem()</code>, to dereference the pointer.</p>\n\n<p>Second, <code>reflect.Value.Set</code> must use a same type to set. You cannot set <code>uint32</code> to a <code>int64</code> like normal assignment.</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/grvXAc1Px8g\" rel=\"nofollow noreferrer\">https://play.golang.org/p/grvXAc1Px8g</a></p>\n"}], "owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 0, "accepted_answer_id": 48663581, "answer_count": 1, "score": -2, "last_activity_date": 1518010159, "creation_date": 1518004355, "last_edit_date": 1518010159, "question_id": 48663141, "link": "https://stackoverflow.com/questions/48663141/how-to-list-pointers-to-all-fields-of-golang-struct", "title": "How to list pointers to all fields of golang struct?", "body": "<p>Is there a good way in golang to pass all fields of some struct instance <code>c</code>?</p>\n\n<p>I'm looking for some syntactic sugar functionality, so that instead of doing this:</p>\n\n<pre><code>method(&amp;c.field1, &amp;c.field2, &amp;c.field3, &amp;c.field4, &amp;c.field5, ...)\n</code></pre>\n\n<p>I could do this:</p>\n\n<pre><code>method(FieldsPointers(c)...)\n</code></pre>\n\n<p>I'm rather new to golang and still learning the basics, if there is no good way to do what I want for a good reason, I'd appreciate an explanation as to why.</p>\n"}, {"tags": ["unit-testing", "go", "mockito", "gomock"], "answers": [{"comments": [{"owner": {"reputation": 99, "user_id": 6118542, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jWxxY.png?s=128&g=1", "display_name": "Marcin Kulik", "link": "https://stackoverflow.com/users/6118542/marcin-kulik"}, "edited": false, "score": 0, "creation_date": 1594821424, "post_id": 48661968, "comment_id": 111261215, "body": "unfortunately the author of this library does not give permission to use this tool for any purpose <a href=\"https://github.com/bouk/monkey/blob/master/LICENSE.md\" rel=\"nofollow noreferrer\">github.com/bouk/monkey/blob/master/LICENSE.md</a>"}], "tags": [], "owner": {"reputation": 170, "user_id": 6465854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12e2c829785e38dc5485403c02849abb?s=128&d=identicon&r=PG", "display_name": "Rodrigo Brito", "link": "https://stackoverflow.com/users/6465854/rodrigo-brito"}, "is_accepted": false, "score": 0, "last_activity_date": 1518000729, "creation_date": 1518000729, "answer_id": 48661968, "question_id": 48661794, "link": "https://stackoverflow.com/questions/48661794/is-there-any-option-to-use-something-similar-to-mockito-argument-captor/48661968#48661968", "title": "Is there any option to use something similar to mockito argument captor?", "body": "<p>This project can help you: <a href=\"https://github.com/bouk/monkey\" rel=\"nofollow noreferrer\">https://github.com/bouk/monkey</a>.\nYou can replace a function and use a bool variable to check the use.</p>\n\n<pre><code>called := false    \nmonkey.Patch(package.One, func(result interface{}) error {\n    if result == expected {\n       called := true\n       return nil\n    }\n    return errors.new(\"not expected\")\n})\n</code></pre>\n\n<p>Dont't forget to restore your original function.</p>\n\n<pre><code>defer monkey.Unpatch(package.One)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 638, "user_id": 2384711, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/35c459dceaf828216ef2dac845118096?s=128&d=identicon&r=PG", "display_name": "Paul Liang", "link": "https://stackoverflow.com/users/2384711/paul-liang"}, "is_accepted": false, "score": 2, "last_activity_date": 1548045178, "creation_date": 1548045178, "answer_id": 54283552, "question_id": 48661794, "link": "https://stackoverflow.com/questions/48661794/is-there-any-option-to-use-something-similar-to-mockito-argument-captor/54283552#54283552", "title": "Is there any option to use something similar to mockito argument captor?", "body": "<p>This can be achieved via <a href=\"https://godoc.org/github.com/golang/mock/gomock#Call.Do\" rel=\"nofollow noreferrer\">Do</a>.</p>\n\n<p>Copy &amp; Paste of Github example from <a href=\"https://github.com/poy\" rel=\"nofollow noreferrer\">poy</a>.</p>\n\n<pre><code>var capturedArgs []int\n\nsomeMock.\n  EXPECT().\n  SomeMethod(gomock.Any()).\n  Do(func(arg int){\n    capturedArgs = append(capturedArgs, arg)\n  })\n</code></pre>\n\n<p>Ref: <a href=\"https://github.com/golang/mock/pull/149\" rel=\"nofollow noreferrer\">https://github.com/golang/mock/pull/149</a></p>\n"}], "owner": {"reputation": 4354, "user_id": 1806005, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ee889ac6797f1f23ebb955164162bd39?s=128&d=identicon&r=PG", "display_name": "freakman", "link": "https://stackoverflow.com/users/1806005/freakman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1809, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1548045178, "creation_date": 1518000220, "last_edit_date": 1518005035, "question_id": 48661794, "link": "https://stackoverflow.com/questions/48661794/is-there-any-option-to-use-something-similar-to-mockito-argument-captor", "title": "Is there any option to use something similar to mockito argument captor?", "body": "<p>we are using gopkg.in/mgo.v2/bson to talk with mongo, and its API populates passed structures instead returning results, for example:</p>\n\n<pre><code>func (p *Pipe) One(result interface{}) error {...\n</code></pre>\n\n<p>Problems occurs when I want to mock / test code which is using that. I want to both mock this execution and somehow get pupulated value in 'result'.\nCurrently test has:</p>\n\n<pre><code>query.EXPECT().One(gomock.Any())\n</code></pre>\n\n<p>So as you can see I dont get any value, I just configure gomock to check that when I run my method then query.One has to be called.\nI cannot pass structure like </p>\n\n<pre><code>mystruct := MyStruct{}\nquery.EXPECT().One(&amp;mystruct)\n</code></pre>\n\n<p>because mystruct in test code and in real code is different and verifing mock will fail (references are different). Im looking for something similar to mockito's argument captor:\n<a href=\"https://static.javadoc.io/org.mockito/mockito-core/2.6.9/org/mockito/ArgumentCaptor.html\" rel=\"nofollow noreferrer\">https://static.javadoc.io/org.mockito/mockito-core/2.6.9/org/mockito/ArgumentCaptor.html</a></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": false, "score": -1, "last_activity_date": 1518020327, "last_edit_date": 1518020327, "creation_date": 1518000193, "answer_id": 48661784, "question_id": 48661642, "link": "https://stackoverflow.com/questions/48661642/how-to-convert-string-like-11aacc-to-hex-value-byte-x11-xaa-cc-in-golang/48661784#48661784", "title": "how to convert string like &quot;11aacc&quot; to hex value []byte(&quot;\\x11\\xaa\\cc&quot;) in golang", "body": "<p>You can use <code>DecodeString</code> from <code>encoding/hex</code> package to convert your hex string to []byte.</p>\n\n<p>example: <a href=\"https://play.golang.org/p/t200M1LqJQ3\" rel=\"nofollow noreferrer\">https://play.golang.org/p/t200M1LqJQ3</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/hex\"\n    \"fmt\"\n    \"log\"\n)\n\nfunc main() {\n    s := \"11AACC\"\n    h, err := hex.DecodeString(s)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(h)\n}\n</code></pre>\n\n<p>Link to DecodeString: <a href=\"https://golang.org/pkg/encoding/hex/#DecodeString\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/hex/#DecodeString</a></p>\n"}], "owner": {"reputation": 21, "user_id": 1329584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64fe303b1e322d67332ee9d16f8b35b7?s=128&d=identicon&r=PG", "display_name": "frankwang", "link": "https://stackoverflow.com/users/1329584/frankwang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518020327, "creation_date": 1517999811, "question_id": 48661642, "link": "https://stackoverflow.com/questions/48661642/how-to-convert-string-like-11aacc-to-hex-value-byte-x11-xaa-cc-in-golang", "title": "how to convert string like &quot;11aacc&quot; to hex value []byte(&quot;\\x11\\xaa\\cc&quot;) in golang", "body": "<p>i want to use UDP to send packet with content like 0x11AACC, \"11AACC\" is fetched from database, so it's string.</p>\n\n<p>I don't know how to change it to hex value 11AACC, if I use []byte(\"11AACC\")to convert it, it'll change to 6 bytes content.</p>\n\n<p>thanks.</p>\n"}, {"tags": ["go", "web", "naming-conventions"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1517997072, "post_id": 48660262, "comment_id": 84318695, "body": "No there is not."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518014894, "post_id": 48660262, "comment_id": 84330830, "body": "This is completely opinion-based so not posting an answer, and Voker is right, there is absolutely no standard or even any particularly popular convention. Personally I like something like &quot;.tpl.html&quot; because ending in &quot;.html&quot; means I can open the file in a random editor or browser and it will be handled more or less correctly."}], "answers": [{"comments": [{"owner": {"reputation": 459, "user_id": 4413286, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/zyADZ.jpg?s=128&g=1", "display_name": "Cris", "link": "https://stackoverflow.com/users/4413286/cris"}, "edited": false, "score": 1, "creation_date": 1517998676, "post_id": 48660415, "comment_id": 84319738, "body": "Mmmh that&#39;s quite contradictory because <a href=\"https://golang.org/pkg/text/template/#example_Template_helpers\" rel=\"nofollow noreferrer\">in this example</a> they&#39;re using <code>.tmpl</code> files... I guess they&#39;re not using a fixed convention too"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "reply_to_user": {"reputation": 459, "user_id": 4413286, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/zyADZ.jpg?s=128&g=1", "display_name": "Cris", "link": "https://stackoverflow.com/users/4413286/cris"}, "edited": false, "score": 1, "creation_date": 1518022984, "post_id": 48660415, "comment_id": 84336591, "body": "@Cris that&#39;s the text template documentation -- which would make it more generic -- not the html template documentation.  But you can actually find <code>.tmpl</code> in the html documentation too, so it is used in both package docs.  But then not in the blog.  I agree with the other comments that there is no fixed, universal standard."}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 2, "last_activity_date": 1518024709, "last_edit_date": 1518024709, "creation_date": 1517996451, "answer_id": 48660415, "question_id": 48660262, "link": "https://stackoverflow.com/questions/48660262/go-standard-for-file-extensions-in-web-development/48660415#48660415", "title": "Go standard for file extensions in web development?", "body": "<p>There's no fixed standard, but there are some fairly common practices.  For templates on web projects, I use the extension appropriate for the type of file it is, e.g. <code>.html</code>, <code>.css</code>, etc.  That's what's done in the widely-read-and-cited <a href=\"https://golang.org/doc/articles/wiki/#tmp_10\" rel=\"nofollow noreferrer\">Writing Web Applications</a> blog post on the official Go blog, which makes it fairly standard.  I find it useful for easy syntax highlighting without changing my editor's settings/config, and processing by other tools.  I put these templates in a <code>/templates/</code> directory to keep them separate from non-template files.</p>\n\n<p>I've seen and used <code>.tmpl</code> before, it's in official docs for both html and text template packages, which makes that fairly standard too, and I think it makes sense if you're making a file-type-agnostic template, or you don't have any associations that are useful by more specialized file type.</p>\n\n<p>For Go code files, I always use the <code>.go</code> extension, which works well with the Go toolset.  It's what you generally see in official Go documentation, such as <a href=\"https://golang.org/doc/code.html#Organization\" rel=\"nofollow noreferrer\">this introductory document on How to Write Go Code</a>.  For executables, I don't append any file extension.  The default result when you <code>go build &lt;name&gt;.go</code>is an executable called <code>&lt;name&gt;</code>, and so that makes it a common practice.</p>\n"}], "owner": {"reputation": 459, "user_id": 4413286, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/zyADZ.jpg?s=128&g=1", "display_name": "Cris", "link": "https://stackoverflow.com/users/4413286/cris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 658, "favorite_count": 0, "accepted_answer_id": 48660415, "answer_count": 1, "score": 1, "last_activity_date": 1518024709, "creation_date": 1517995998, "question_id": 48660262, "link": "https://stackoverflow.com/questions/48660262/go-standard-for-file-extensions-in-web-development", "title": "Go standard for file extensions in web development?", "body": "<p>I'm learning Go but I can't find this answer anywhere. Is there any official standard for file extensions in web development? I've seen multiple conventions like <code>.tmpl</code> and <code>.gtpl</code>, which is what? Thanks.</p>\n"}, {"tags": ["multithreading", "go", "goroutine"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1517993572, "post_id": 48659334, "comment_id": 84316382, "body": "This is too broad to give you a good answer. In general, goroutines are very lightweight, so there little advantage in re-using them. If you want to rate-limit how many things you&#39;re processing at once, it&#39;s easier to do with other mechanisms (plain counter) than a worker pool."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1517997112, "post_id": 48659334, "comment_id": 84318718, "body": "No it does not. The whole idea of coroutines is to get rid of the need of a pool."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518016030, "post_id": 48666250, "comment_id": 84331656, "body": "The question states flat-out &quot;the gorutines them self don&#39;t have any state they reuse per execution&quot;."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1518018145, "post_id": 48666250, "comment_id": 84333206, "body": "@Adrian, there&#39;s a neat thing I&#39;m going to tell you flat-out: StackOverflow exists not only as a Q&amp;A service but also as a platform where people can search for existing answers. Most use Google for that, but no matter how they search, that searching uses keywords to find relevant material. That&#39;s why\u2014in my book\u2014answering questions in a generic way helps. All-in-all, my answer provides enough general information to completely address the more narrowly-scoped original answer."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518018562, "post_id": 48666250, "comment_id": 84333537, "body": "Gosh that is super neat, you&#39;re right! If you want to answer more than was asked, great! Just say something like &quot;it looks like this may not apply to your current situation, but...&quot; so that askers can easily tell which parts are answering their question, and which parts are just stuff you think someone might find useful some day."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 3, "last_activity_date": 1518013642, "creation_date": 1518013642, "answer_id": 48666250, "question_id": 48659334, "link": "https://stackoverflow.com/questions/48659334/does-a-goroutine-pool-make-sense-like-thread-pools-in-other-languages/48666250#48666250", "title": "Does a goroutine pool make sense like thread pools in other languages?", "body": "<p>Since a goroutine is an <em>executing function,</em> it can be thought of as comprising the set of the followng resources:</p>\n\n<ul>\n<li>The code it executes; </li>\n<li>The state the Go runtime scheduler maintains for that goroutine;</li>\n<li>The state which is <em>private to the goroutine.</em></li>\n</ul>\n\n<p>The latter is values a goroutine has allocated locally\n(on its stack) and on the heap.</p>\n\n<p>The code is shared;\nthe state in the scheduler has reasonably negligible cost\nbut the state a goroutine keeps <em>may</em> be costly to re-create.</p>\n\n<p>The latter point may be used as a justification to keep goroutines\naround in a pool.  But on the other hand, most of the time it's simpler\nto pool the resources group of goroutines carrying out similar tasks\nre-use \u2014 instead of the goroutines themselves.</p>\n"}], "owner": {"reputation": 388, "user_id": 2390386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e821ce2f9a62685e76e30a88d2d56e3?s=128&d=identicon&r=PG", "display_name": "Towlie288", "link": "https://stackoverflow.com/users/2390386/towlie288"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 943, "favorite_count": 1, "accepted_answer_id": 48666250, "answer_count": 1, "score": 2, "last_activity_date": 1518013642, "creation_date": 1517993003, "last_edit_date": 1518006632, "question_id": 48659334, "link": "https://stackoverflow.com/questions/48659334/does-a-goroutine-pool-make-sense-like-thread-pools-in-other-languages", "title": "Does a goroutine pool make sense like thread pools in other languages?", "body": "<p>I build a simple <code>goroutine</code> worker pool with a few <code>chan</code> for a stream of events and it works totally fine. Due to the nature of <code>goroutines</code> I started to ask myself what I gain by doing that other then limiting the concurrent workers. The <code>gorutines</code> them self don't have any state they reuse per execution so that there would be value in keeping them around. </p>\n\n<p>So the question is, does it even make sense to start <code>goroutines</code> and reuse them or just always create a fresh one and just limit the number possible to create/run at the same time?</p>\n"}, {"tags": ["go", "struct", "interface"], "comments": [{"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1517993713, "post_id": 48659218, "comment_id": 84316463, "body": "You didn&#39;t share your definition of type Probe.  An answer could probably be more specific if you added that."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1518016218, "post_id": 48659218, "comment_id": 84331786, "body": "&quot;I want create new probes extending the basic probe&quot; - stop right there. You cannot &quot;extend&quot; in Go; Go has no inheritance. If you&#39;re thinking about it this way, you&#39;re going to create a design that is fundamentally incompatible with Go; you&#39;ll find yourself misusing composition in unusual ways and creating an unmaintainable mess. I would highly recommend reading up on Go interfaces, how they work, and how they&#39;re used, before attempting a complex design like this."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1517993194, "creation_date": 1517993194, "answer_id": 48659382, "question_id": 48659218, "link": "https://stackoverflow.com/questions/48659218/struct-with-dynamic-type/48659382#48659382", "title": "Struct with dynamic type", "body": "<p>There are different approaches to your question.</p>\n\n<p>The most direct answer would be:  You need to convert your <code>interface{}</code> to a concrete type before calling any methods on it. Example:</p>\n\n<pre><code>probe.Probe.(ShellProbe).New(...)\n</code></pre>\n\n<p>But this is a really confusing API to use.</p>\n\n<p>A better approach is probably to re-think your entire API.  It's hard to do this level of design thinking with the limited information you've provided.</p>\n\n<p>I don't know whether this will work for you, but a common pattern is to define an interface:</p>\n\n<pre><code>type Probe interface {\n    New(string, JsonConfig)\n    Exec() bool\n    // ... etc\n}\n</code></pre>\n\n<p>Then make all of your probe types implement the interface.  Then use that interface instead of <code>interface{}</code>, as you initially did:</p>\n\n<pre><code>type LoadableProbe struct {\n    Name   string\n    Probe  Probe\n    Active bool\n}\n</code></pre>\n\n<p>Then your syntax should work again, because the <code>Probe</code> interface includes a <code>New</code> method.</p>\n\n<pre><code>probe.Probe.New(...)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 1, "last_activity_date": 1517995663, "last_edit_date": 1517995663, "creation_date": 1517994880, "answer_id": 48659893, "question_id": 48659218, "link": "https://stackoverflow.com/questions/48659218/struct-with-dynamic-type/48659893#48659893", "title": "Struct with dynamic type", "body": "<p>If you will have common data fields in each probe type, you might consider using <code>Probe</code> as a concrete base type defining your base data fields and base methods, and using a new <code>ProbeInterface</code> interface as an abstract base type defining common expected method signatures to allow you to pass around / collect / manage different specialized probe types.</p>\n\n<p>You would embed <code>Probe</code> into each specialized probe type, and methods and fields would be promoted according to rules of embedding.  It looks like you're familiar with embedding in general, but the details are worth reviewing in <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">the \"Embedding\" section of Effective Go</a> if you haven't looked at it recently.</p>\n\n<p>You could override <code>Probe</code> methods in specialized probe types to execute type-specific code.</p>\n\n<p>It might look something like this:</p>\n\n<pre><code>type ProbeInterface interface {\n     New()\n     Exec() bool\n     // whatever other methods are common to all probes\n}\n\ntype Probe struct {\n    // whatever's in a probe\n}\n\nfunc (p *Probe) New() {\n    // init stuff\n}\n\nfunc (p *Probe) Exec() bool {\n    // exec stuff\n    return true\n}\n\n// Probe's methods and fields are promoted to ShellProbe according to the rules of embedding\ntype ShellProbe struct {\n    Probe\n    // any specialized ShellProbe fields\n}\n\n// override Probe's Exec() method to have it do something ShellProbe specific.\nfunc (sp *ShellProbe) Exec() bool {\n    // do something ShellProbe-ish\n    return true\n}\n\ntype LoadableProbe struct {\n    Name        string\n    P           ProbeInterface\n    Active      bool\n}\n\nfunc RegisterProbe(name string, probe ProbeInterface, state bool) {\n    LoadableProbes = append(LoadableProbes, LoadableProbe{name, probe, state})\n}\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 2902646, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/100003353062944/picture?type=large", "display_name": "Sylvanas Garde", "link": "https://stackoverflow.com/users/2902646/sylvanas-garde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 48659893, "answer_count": 2, "score": 1, "last_activity_date": 1517995663, "creation_date": 1517992579, "last_edit_date": 1517993211, "question_id": 48659218, "link": "https://stackoverflow.com/questions/48659218/struct-with-dynamic-type", "title": "Struct with dynamic type", "body": "<p>I am learning Go at the moment and I write a small project with some probes which report to a internal Log. I have a basic probe and I want create new probes extending the basic probe.</p>\n\n<p>I want save the objects in an array/slice LoadedProbes.</p>\n\n<pre><code>type LoadableProbe struct {\n    Name   string\n    Probe  Probe\n    Active bool\n}\n\nvar LoadableProbes []LoadableProbe\n</code></pre>\n\n<p>The basic probe struct is:</p>\n\n<pre><code>type ProbeModule struct {\n    version   VersionStruct\n    name      string\n    author    string\n    log       []internals.ProbeLog\n    lastcall  time.Time\n    active    bool\n}\n\nfunc (m *ProbeModule) New(name string, jconf JsonConfig) {\n    // read jsonConfig \n}\nfunc (m *ProbeModule) Exec() bool {\n    // do some stuff\n    return true\n}\n\nfunc (m *ProbeModule) String() string {\n    return m.name + \" from \" + m.author\n}\n\nfunc (m *ProbeModule) GetLogCount() int {\n    return len(m.log)\n}\n[...]\n</code></pre>\n\n<p>I am using this basic struct for other probes, for example:</p>\n\n<pre><code>type ShellProbe struct {\n    ProbeModule\n}\n\nfunc (s *ShellProbe) New(name string, jconf JsonConfig) {\n    s.ProbeModule.New(name, jconf)\n    fmt.Println(\"Hello from the shell\")\n}\n\nfunc (s *ShellProbe) Exec() bool {\n    // do other stuff\n    return true\n}\n</code></pre>\n\n<p>during Init() I call the following code:</p>\n\n<pre><code>func init() {\n    RegisterProbe(\"ShellProbe\", ShellProbe{}, true)\n}\n\nfunc RegisterProbe(name string, probe Probe, state bool) {\n    LoadableProbes = append(LoadableProbes, LoadableProbe{name, probe, state})\n}\n</code></pre>\n\n<p>The Problem is now that I can't add the type Shellprobe the the LoadableProbe struct, which expects a Probe struct. </p>\n\n<p>My idea was to use interface{} instead the Probe struct in the Loadable Probe struct. But when I call the New() method of the Probe object:</p>\n\n<pre><code>for _, p := range probes.LoadableProbes {\n    probe.Probe.New(probe.Name, jconf)\n}\n</code></pre>\n\n<p>But I got the error: p.Probe.New undefined (type interface {} is interface with no methods)</p>\n\n<p>how can I solve this problem?</p>\n"}, {"tags": ["go", "named-pipes", "mkfifo"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1517990146, "post_id": 48656281, "comment_id": 84314658, "body": "Please add the code to the question by editing it."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517994735, "post_id": 48656281, "comment_id": 84317064, "body": "You need to open the pipes as non-blocking, or your <code>Open</code> call just sits there waiting for the other end to show up. See this <a href=\"http://www.albertoleal.me/posts/golang-pipes.html\" rel=\"nofollow noreferrer\">pipes 101 with Go</a> for more details. I would recommend you get one pipe right before trying both."}, {"owner": {"reputation": 359, "user_id": 2327670, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/QGdzi.jpg?s=128&g=1", "display_name": "rikonor", "link": "https://stackoverflow.com/users/2327670/rikonor"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1518014706, "post_id": 48656281, "comment_id": 84330700, "body": "@marc I actually did try adding <code>syscall.O_NONBLOCK</code> to the file mode but it causes an error: <code>device not configured</code>. I did go through getting each pipe working on it&#39;s own first which culminated in the code I posted above. The weird thing is that if I run the code, then do this in two different terminals: <code>$ cat inPipe</code> and <code>$ echo 123 &gt; outPipe</code>, then the code progresses as expected, but if I try to do it in one command, e.g <code>$ cat inPipe &gt; outPipe</code> then Open still hangs. Not sure why."}], "owner": {"reputation": 359, "user_id": 2327670, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/QGdzi.jpg?s=128&g=1", "display_name": "rikonor", "link": "https://stackoverflow.com/users/2327670/rikonor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1518014495, "creation_date": 1517979364, "last_edit_date": 1518014495, "question_id": 48656281, "link": "https://stackoverflow.com/questions/48656281/wrapping-executable-that-takes-input-and-output-files-such-that-it-uses-stdin-an", "title": "Wrapping executable that takes input and output files such that it uses stdin and stdout instead (using named pipes)", "body": "<p>I'm trying to wrap an executable that takes an input and output file paths as arguments, such that it will be possible to provide the input and output as <code>stdin</code> and <code>stdout</code>.</p>\n\n<p>I've written a short script in Go that attempts to do this, but for some reason which eludes me, it hangs forever.</p>\n\n<p>See <a href=\"https://goplay.space/#le6Hexg1ZiJ\" rel=\"nofollow noreferrer\">https://goplay.space/#le6Hexg1ZiJ</a>.</p>\n\n<p>I can add more details as required, but to start, I'd rather not pollute the question with possibly less relevant information.</p>\n\n<p>EDIT: As requested, I'm adding the code here.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"strings\"\n    \"syscall\"\n\n    \"golang.org/x/sync/errgroup\"\n)\n\n/*\n    Expected behavior:\n\n    # Terminal 1\n    $ go run main.go\n\n    # Terminal 2\n    $ cat inPipe &gt; outPipe\n\n    The go program is writing to inPipe and reading from outPipe\n\n    Actual behavior: The program stalls\n*/\n\nfunc main() {\n    eg := &amp;errgroup.Group{}\n\n    inPipe := \"inPipe\"\n    outPipe := \"outPipe\"\n\n    if err := syscall.Mkfifo(inPipe, 0644); err != nil {\n        log.Fatal(err)\n    }\n    defer os.Remove(inPipe)\n\n    if err := syscall.Mkfifo(outPipe, 0644); err != nil {\n        log.Fatal(err)\n    }\n    defer os.Remove(outPipe)\n\n    fIn, err := os.OpenFile(inPipe, os.O_WRONLY, os.ModeNamedPipe)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer fIn.Close()\n\n    eg.Go(func() error {\n        _, err := io.Copy(fIn, strings.NewReader(\"123\"))\n        return err\n    })\n\n    fOut, err := os.OpenFile(outPipe, os.O_RDONLY, os.ModeNamedPipe)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer fOut.Close()\n\n    buf := &amp;bytes.Buffer{}\n\n    eg.Go(func() error {\n        _, err := io.Copy(buf, fOut)\n        return err\n    })\n\n    if err := eg.Wait(); err != nil {\n        log.Fatal(err)\n    }\n\n    if _, err := io.Copy(os.Stdout, buf); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1517968336, "post_id": 48654710, "comment_id": 84307635, "body": "Because a slice is a reference type (a pointer type). So <code>yy[y]=xx</code> is just putting slices with a same underlying array into <code>yy</code>. To solve it, use <code>copy(yy[y],xx)</code> instead."}, {"owner": {"reputation": 6818, "user_id": 391339, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/efa2e9771e789a25ad7f423f723ce184?s=128&d=identicon&r=PG", "display_name": "user391339", "link": "https://stackoverflow.com/users/391339/user391339"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517968387, "post_id": 48654710, "comment_id": 84307647, "body": "Ok thanks, let me try this."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517969005, "post_id": 48654710, "comment_id": 84307816, "body": "Like the answer(s) stated, use make inside the loop is a better idea as it saves copy. I was just trying to one-line-fix your issue."}, {"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 1, "creation_date": 1517976024, "post_id": 48654710, "comment_id": 84309419, "body": "Just move the line: &quot;xx := ... &quot;  inside the loop."}], "answers": [{"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 3, "last_activity_date": 1517968977, "last_edit_date": 1517968977, "creation_date": 1517968660, "answer_id": 48654810, "question_id": 48654710, "link": "https://stackoverflow.com/questions/48654710/why-is-my-2d-golang-array-being-populated-with-row-after-row-of-the-same-value/48654810#48654810", "title": "Why is my 2D golang array being populated with row after row of the same value?", "body": "<p>The problem is <code>yy[y] = xx</code> does not copy <code>xx</code>, it assigns a reference to it.</p>\n\n<pre><code>for y := range yy {\n    for x := range xx {\n        xx[x] = uint8((y))\n    }\n\n    // This is not a copy.\n    yy[y] = xx\n\n    fmt.Println(y, yy[y])\n}\n</code></pre>\n\n<p>The first iteration <code>y = 0</code>. It writes 0 to all of <code>xx</code>, then <code>yy[y] = xx</code> assigns <strong><em>a reference to xx</em></strong> to <code>yy[0]</code>, not a copy of <code>xx</code>.</p>\n\n<p>The next iteration of the loop <code>y = 1</code>. It writes 1 to all of <code>xx</code>, the same <code>xx</code> as before, which also alters the reference to <code>xx</code> in <code>yy[0]</code>. It then assigns a reference to <code>xx</code> as <code>yy[1]</code>. Repeat 256 times.</p>\n\n<p><code>xx</code>, <code>yy[0]</code> and <code>yy[1]</code> and <code>yy[2]</code> and so on all refer to the same data.</p>\n\n<p>When you print <code>yy</code> at the end, you're really just printing <code>xx</code> 256 times. You can see this clearly by printing the pointer value, <code>%p</code>.</p>\n\n<pre><code>fmt.Printf(\"%3s %p\\n\", \"xx\", xx);\nfor y := range yy {\n    fmt.Printf(\"%03v %p\\n\", y, yy[y])\n}\n\n xx 0xc420096000\n000 0xc420096000\n001 0xc420096000\n002 0xc420096000\n003 0xc420096000\n004 0xc420096000\n005 0xc420096000\n</code></pre>\n\n<hr>\n\n<p>The solution is to allocate <code>xx</code> inside the loop, so a new <code>xx</code> is allocated each loop iteration.</p>\n\n<pre><code>for y := range yy {\n    xx := make([]uint8, dx)\n\n    for x := range xx {\n        xx[x] = uint8((y))\n    }\n\n    // Still takes a reference to xx, but a different xx each time.\n    yy[y] = xx\n\n    fmt.Println(y, yy[y])\n}\n</code></pre>\n\n<p>Or you can copy <code>xx</code>, but this approach is safer: there's no possibility to accidentally reuse the same reference.</p>\n"}, {"tags": [], "owner": {"reputation": 1728, "user_id": 428627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d69816f34545ac97949ab9fc821bf3b1?s=128&d=identicon&r=PG", "display_name": "giorgiga", "link": "https://stackoverflow.com/users/428627/giorgiga"}, "is_accepted": false, "score": 3, "last_activity_date": 1517968677, "creation_date": 1517968677, "answer_id": 48654811, "question_id": 48654710, "link": "https://stackoverflow.com/questions/48654710/why-is-my-2d-golang-array-being-populated-with-row-after-row-of-the-same-value/48654811#48654811", "title": "Why is my 2D golang array being populated with row after row of the same value?", "body": "<p>It's because you are assigning (by reference) <code>xx</code> to all places in <code>yy</code> (as if <code>yy := [][]uint8{ xx, xx, xx, xx, ... }</code>.</p>\n\n<p>Try allocating a new <code>xx</code> for each place in <code>yy</code>:</p>\n\n<pre><code>yy := make([][]uint8, dy)\nfor y := range yy {\n    xx := make([]uint8, dx)\n</code></pre>\n"}], "owner": {"reputation": 6818, "user_id": 391339, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/efa2e9771e789a25ad7f423f723ce184?s=128&d=identicon&r=PG", "display_name": "user391339", "link": "https://stackoverflow.com/users/391339/user391339"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 48654810, "answer_count": 2, "score": 2, "last_activity_date": 1517968977, "creation_date": 1517967732, "last_edit_date": 1517968166, "question_id": 48654710, "link": "https://stackoverflow.com/questions/48654710/why-is-my-2d-golang-array-being-populated-with-row-after-row-of-the-same-value", "title": "Why is my 2D golang array being populated with row after row of the same value?", "body": "<p>I am taking a tour of the Go language and am trying to do the following example (populating 2D arrays):\n <a href=\"https://tour.golang.org/moretypes/18\" rel=\"nofollow noreferrer\">https://tour.golang.org/moretypes/18</a>  --  see the code below... </p>\n\n<p>In the example we are supposed to populate a 2D array of uint8 with values (based on a function of our choice), then displaying these as a photo/pattern. </p>\n\n<p>In my code, <code>yy</code> should be a <code>[][]uint8</code> array populated with single rows of <code>[]uint8</code> (<code>xx</code>).  </p>\n\n<p>For the pattern/data I kept it simple - with each index of yy (y-axis), I increase the values placed in rows of xx - so the data should output a row of 0's, then a row of 1's, then a row of 2's, etc.  </p>\n\n<p>Although my code appears to work correctly based on the output of the first Println statement below (listed inside the loop as I attempt to populate the 2D array yy), the final values stored in the yy 2d array are all rows of 255!  It's somehow using the value of the last x-axis row for everything.  </p>\n\n<p>I think somehow instead of making new value assignments I am somehow \"pointing\" to a single row of x-axis data that's being over-written, so at the end I get a matrix filled with the values that went in that final row.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"golang.org/x/tour/pic\"\n)\n\nfunc Pic(dx, dy int) [][]uint8 {\n\n\n    //HERE I DYNAMICALLY CREATE THE ARRAYS BASED ON WHAT I WAS TAUGHT PREVIOUSLY\n    //I UNDERSTAND THAT TECHNICALLY THESE MAY BE SLICES NOT ARRAYS ...\n    //AND THUS MAYBE POINT SOMEWHERE AND DON'T ACTUALLY STORE ALL THE DATA (???)\n    yy := make([][]uint8, dy)\n    xx := make([]uint8, dx)\n\n    for y := range yy {\n        for x := range xx {\n            xx[x] = uint8((y)) // FOR SIMPLICITY I MADE PATTERN ROW x = y\n        }\n        yy[y] = xx\n        //THIS OUTPUT IS CORRECT; ROW OF 0's, ROW OF 1's, ROW OF 2's, ETC\n        fmt.Println(y, yy[y])\n    }\n\n    for y := range yy {\n        //THIS OUTPUT IS INCORRECT; ALL 255!\n        //IT POPULATED ALL ROWS W/ VALUES FROM THE LAST LOOP\n        fmt.Println(y, yy[y])\n    }\n\n    return yy\n\n}\n\nfunc main() {\n    pic.Show(Pic)\n}\n</code></pre>\n\n<p>Note: Because I am debugging, use of \"fmt.Println()\" abrogates the display of the photo in my hands (but don't worry about that aspect).  If you delete the fmt.Println() calls you can get the photo to display (albeit with the wrong/unexpected data).</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1517969665, "post_id": 48654752, "comment_id": 84307966, "body": "Thank you. I understand. But I think there is a typo in your answer, a slice should stores 3 8-byte ints on a 64bit machine, right?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1517969810, "post_id": 48654752, "comment_id": 84308003, "body": "Yes it is a typo. I will fix it when I am not on mobile."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1517994335, "last_edit_date": 1517994335, "creation_date": 1517968093, "answer_id": 48654752, "question_id": 48654563, "link": "https://stackoverflow.com/questions/48654563/encode-object-to-bytes-by-golang-unsafe/48654752#48654752", "title": "encode object to bytes by golang unsafe?", "body": "<p>First, <code>unsafe.Sizeof</code> returns the bytes that needs to store the type. It is a little bit tricky, but it does not mean bytes that needs to store the data.</p>\n\n<p>For example, a slice, as it is well known, stores 3 4-byte ints on a 32bit machine. One uintptr for memory address of the underlying array, and two <code>int32</code> for <code>len</code> and <code>cap</code>. So no matter how long a slice is or what type it is of, a slice takes always 12 bytes on a 32 bit machine. Likely, a string uses 8 bytes: 1 <code>uintptr</code> for address and 1 <code>int32</code> for <code>len</code>.</p>\n\n<p>As for difference between <code>reflect.TypeOf().Size</code>, it is about interface. <code>reflect.TypeOf</code> looks into the interface and gets an concrete type, and reports bytes needed about the concrete type, while <code>unsafe.Sizeof</code> just returns 8 for an interface type: 2 <code>uintptr</code> for a pointer to the data and a pointer to the method lists.</p>\n\n<p>Second part is quite clear now. For one, <code>unsafe.Pointer</code> is taking the address of the interface, instead of the concrete type. Two, in <code>TestEncode</code>, <code>unsafe.Pointer</code> is taking address to the 12-byte slice \"header\". There might be other errors, but with the two mentioned, they are meaningless to spot.</p>\n\n<p>Note: I avoid talking about orders of the <code>uintptr</code> and <code>int32</code> not only because I don't know, but also becuase they are not documented, unsafe, and implentation depended.</p>\n\n<p>Note 2: Conclusion: Don't try to dump memory of a Go data.</p>\n\n<p>Note 3: I change everything to 32 bit becuase playground is using it, so it is easier to check.</p>\n"}], "owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 0, "accepted_answer_id": 48654752, "answer_count": 1, "score": 1, "last_activity_date": 1517994335, "creation_date": 1517966647, "question_id": 48654563, "link": "https://stackoverflow.com/questions/48654563/encode-object-to-bytes-by-golang-unsafe", "title": "encode object to bytes by golang unsafe?", "body": "<pre><code>func Encode(i interface{}) ([]byte, error) {\n    buffer := bytes.NewBuffer(make([]byte, 0, 1024))\n    // size := unsafe.Sizeof(i)\n    size := reflect.TypeOf(i).Size()\n    fmt.Println(size)\n    ptr := unsafe.Pointer(&amp;i)\n    startAddr := uintptr(ptr)\n    endAddr := startAddr + size\n    for i := startAddr; i &lt; endAddr; i++ {\n        bytePtr := unsafe.Pointer(i)\n        b := *(*byte)(bytePtr)\n        buffer.WriteByte(b)\n    }\n    return buffer.Bytes(), nil\n}\n\nfunc TestEncode(t *testing.T) {\n    test := Test{10, \"hello world\"}\n    b, _ := Encode(test)\n    ptr := unsafe.Pointer(&amp;b)\n    newTest := *(*Test)(ptr)\n    fmt.Println(newTest.X)\n}\n</code></pre>\n\n<p>I am learning how to use golang unsafe and wrote this function for encoding any object. I meet with two problems, first, dose unsafe.Sizeof(obj) always return obj's pointer size? Why it different from  reflect.TypeOf(obj).Size()? Second, I want to iterate the underlying bytes of obj and convert it back to obj in TestEncode function by unsafe.Pointer(), but the object's values all corrupt, why?</p>\n"}, {"tags": ["arrays", "go", "structure", "slice"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517993398, "post_id": 48653941, "comment_id": 84316293, "body": "No, it&#39;s not a slice of type json. It&#39;s a slice of type <code>json.RawMessage</code>."}], "answers": [{"tags": [], "owner": {"reputation": 6967, "user_id": 7803650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WH7uu.png?s=128&g=1", "display_name": "Oswin Noetzelmann", "link": "https://stackoverflow.com/users/7803650/oswin-noetzelmann"}, "is_accepted": false, "score": 1, "last_activity_date": 1517963167, "creation_date": 1517963167, "answer_id": 48654122, "question_id": 48653941, "link": "https://stackoverflow.com/questions/48653941/what-is-the-meaning-of-json-rawmessage/48654122#48654122", "title": "What is the meaning of []json.Rawmessage", "body": "<p>[] is defining a slice</p>\n\n<p><code>json</code> is the package <a href=\"https://thenewstack.io/understanding-golang-packages/\" rel=\"nofollow noreferrer\">import</a> name (from your import statement above)</p>\n\n<p><code>RawMessage</code> is the <a href=\"https://golang.org/src/encoding/json/stream.go?s=6218:6240#L237\" rel=\"nofollow noreferrer\">type</a> within the package. In this case for a []byte type.</p>\n\n<p><code>json:\"params\"</code> is a <a href=\"https://flaviocopes.com/go-tags/\" rel=\"nofollow noreferrer\">field tag</a>. The json package reads it with reflection and determines what name to use for json.</p>\n"}, {"comments": [{"owner": {"reputation": 55, "user_id": 9301799, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/eb051a881076864cefa0edcb05fd5b14?s=128&d=identicon&r=PG", "display_name": "heretolearn", "link": "https://stackoverflow.com/users/9301799/heretolearn"}, "edited": false, "score": 0, "creation_date": 1517977873, "post_id": 48655798, "comment_id": 84309866, "body": "Is &#39;[]byte(jsonString)&#39;  a slice of type jsonstring or is it the function byte() that is receiving jsonString and then returning a slice of those bytes?"}, {"owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "reply_to_user": {"reputation": 55, "user_id": 9301799, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/eb051a881076864cefa0edcb05fd5b14?s=128&d=identicon&r=PG", "display_name": "heretolearn", "link": "https://stackoverflow.com/users/9301799/heretolearn"}, "edited": false, "score": 1, "creation_date": 1517980932, "post_id": 48655798, "comment_id": 84310731, "body": "the type of <code>jsonString</code> is just <code>string</code>, and <code>string</code> is an slice of byte. <code>[]byte(jsonString)</code> is the syntax for <code>type conversions</code> <a href=\"https://tour.golang.org/basics/13\" rel=\"nofollow noreferrer\">tour.golang.org/basics/13</a>"}], "tags": [], "owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "is_accepted": false, "score": 1, "last_activity_date": 1517992388, "last_edit_date": 1517992388, "creation_date": 1517976147, "answer_id": 48655798, "question_id": 48653941, "link": "https://stackoverflow.com/questions/48653941/what-is-the-meaning-of-json-rawmessage/48655798#48655798", "title": "What is the meaning of []json.Rawmessage", "body": "<p>Most of the time time you need to look in to the package doc rather than some book and the online tour.  </p>\n\n<p>The <code>json:\"jsonrpc\"</code> is a struct tag.<br>\nFor this specific case the json.Marshal function will read that struct tag and return the JSON field name with the given value. For more about \"encoding/json\" struct tags usage: <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/#Marshal</a>  </p>\n\n<p>For RawMessage, you can read more about it here <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/#RawMessage</a> \n<code>\ntype RawMessage []byte\n</code></p>\n\n<p>Normally I use it when having a \"generic\" kind of JSON object that don't need to be process right the way (maybe I just send them to another service, or I will unmarshall it later depending on conditions). For example (I will use your <code>Request</code> struct):  </p>\n\n<pre><code>jsonString := `[\n  {\n    \"id\": 123,\n    \"method\": \"getSomething\",\n    \"params\": [{\"A\": 1, \"B\": 2}]\n  }\n  {\n    \"id\": 123,\n    \"method\": \"getSomethingElse\",\n    \"params\": [{\"C\": 1, \"D\": 2}]\n  }\n]`\n</code></pre>\n\n<p>With this processing code:</p>\n\n<pre><code>var requests []Request\njson.Unmarshal([]byte(jsonString), &amp;requests)\n// if no error, you will have 2 items in requests\n// requests[0].Params[0] is equal to []byte(`{\"A\": 1, \"B\": 2}`)\n// requests[1].Params[0] is equal to []byte(`{\"C\": 1, \"D\": 2}`)\n\nfor _, req := range requests {\n  if req.Method == \"getSomething\" {\n    justProxyThisRequestToAnotherService(req)\n  } else if req.Method == \"getSomethingElse\" {\n    var params []map[string]int\n    json.Unmarshal(req.Params, &amp;params)\n    // then do something with params\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 9301799, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/eb051a881076864cefa0edcb05fd5b14?s=128&d=identicon&r=PG", "display_name": "heretolearn", "link": "https://stackoverflow.com/users/9301799/heretolearn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2109, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1517993380, "creation_date": 1517961982, "last_edit_date": 1517993380, "question_id": 48653941, "link": "https://stackoverflow.com/questions/48653941/what-is-the-meaning-of-json-rawmessage", "title": "What is the meaning of []json.Rawmessage", "body": "<p>What is the meaning of <code>[]json.Rawmessage</code>. Its within this structure here:</p>\n\n<pre><code>type Request struct {\n    Jsonrpc string            `json:\"jsonrpc\"`\n    Method  string            `json:\"method\"`\n    Params  []json.RawMessage `json:\"params\"`\n    ID      interface{}       `json:\"id\"`\n}\n</code></pre>\n\n<p>I know its a slice of type json. I do not understand what the <code>.RawMessage</code> is referring to.  I tried looking it up in both golang tour and my golang book.  Also ultimately I know <code>Params</code> is type <code>[]json.Rawmessage</code> being bundled into another type called <code>Request</code> </p>\n\n<p>Futhermore:</p>\n\n<p>What is going on with these segments <code>json:\"jsonrpc\"</code>.  Is a string literal somehow being attached to var? Again this is not in golang tour or my golang book. Thanks for your time. </p>\n"}, {"tags": ["loops", "for-loop", "go", "signals", "sigint"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517960048, "post_id": 48653502, "comment_id": 84305396, "body": "What you want to acheive is simply 1) capture a key stroke in terminal 2) when a specified key stroke is captured, exit the program 3) the whole process does not block the program so it can run other codes (like an infinite loop). The thrid part is auctually done with the goroutine, so only two left. And I believe searching both of them on Google will yield helpful results."}, {"owner": {"reputation": 3405, "user_id": 7034183, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YcIEw.jpg?s=128&g=1", "display_name": "Remario", "link": "https://stackoverflow.com/users/7034183/remario"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517960122, "post_id": 48653502, "comment_id": 84305418, "body": "@leafbebop who said the OP wanted user input, that would the obvious solution."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 3405, "user_id": 7034183, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YcIEw.jpg?s=128&g=1", "display_name": "Remario", "link": "https://stackoverflow.com/users/7034183/remario"}, "edited": false, "score": 0, "creation_date": 1517960162, "post_id": 48653502, "comment_id": 84305437, "body": "@Remario What would you say the OP want instead?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1517960478, "post_id": 48653502, "comment_id": 84305527, "body": "As far as I can tell &quot;pressing the Q key&quot; is not sending a signal nor anything else than a key stroke."}, {"owner": {"reputation": 43, "user_id": 3575979, "user_type": "registered", "profile_image": "https://graph.facebook.com/733760197/picture?type=large", "display_name": "Kstulen", "link": "https://stackoverflow.com/users/3575979/kstulen"}, "edited": false, "score": 0, "creation_date": 1517963259, "post_id": 48653502, "comment_id": 84306304, "body": "I understand I might have phrased myself badly here. What I want to do is to create an interruption signal in addition to Ctrl + C that can be used for the same thing (interrupting a running infinite loop process). Is that possible? If so, how would I do it? Thanks for the quick responses!"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517963725, "post_id": 48653502, "comment_id": 84306423, "body": "@Kstulen would you show some code of how c++ do it so we can understand what you mean better?"}, {"owner": {"reputation": 43, "user_id": 3575979, "user_type": "registered", "profile_image": "https://graph.facebook.com/733760197/picture?type=large", "display_name": "Kstulen", "link": "https://stackoverflow.com/users/3575979/kstulen"}, "edited": false, "score": 0, "creation_date": 1517964278, "post_id": 48653502, "comment_id": 84306567, "body": "I might have talked past myself here actually. Are there any other signals that could be used to interrupt/terminate an infinite loop process? Would it work if I added os.Kill? I\u2019m sorry, I can\u2019t provide any c++ code, I\u2019m totally new to this..."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 3575979, "user_type": "registered", "profile_image": "https://graph.facebook.com/733760197/picture?type=large", "display_name": "Kstulen", "link": "https://stackoverflow.com/users/3575979/kstulen"}, "edited": false, "score": 0, "creation_date": 1517966354, "post_id": 48654419, "comment_id": 84307153, "body": "Thanks for a great reply! This leaves me with some options. I will check them out!"}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 0, "last_activity_date": 1517965577, "creation_date": 1517965577, "answer_id": 48654419, "question_id": 48653502, "link": "https://stackoverflow.com/questions/48653502/interrupting-an-infinite-loop-in-golang-with-signals/48654419#48654419", "title": "Interrupting an infinite loop in Golang with signals", "body": "<p>Then I would stick to my first comment. I would explain a little more.</p>\n\n<p>You don't need a signal to have your program terminate - you have control over it. Call <code>os.Exit</code> at any time would exit the program, and return from <code>main()</code> has the same effect. </p>\n\n<p>The problem is, instead, that when to trigger these \"exits\". Or, in your example, how to trigger the exit when the <code>key Q</code> is pressed.</p>\n\n<p>To solve the problem, you need to break it down into parts. As I said in the comments, the part 1 is capturing the key stroke. It is not as simple as an <code>fmt.Scan</code>, as it would require the user press an enter after it. It requires some os specific code to do so, but hopefully a lib can save you all the trouble, like <a href=\"https://github.com/nsf/termbox-go\" rel=\"nofollow noreferrer\">termbox-go</a>.</p>\n\n<p>The part 2 is tightly associated with part 1. That is to specify the event, the key stroke. In your example, to know the key pressed is Q, and then call <code>os.Exit</code>. Usually a lib can handle that pretty easily, sometimes one can hardly notice there is a part. But if you want some more complicated key stokes, like <code>ctrl-alt-backspace</code>, or even <code>a-s-d-f</code> (at the same time), this will require some codes.</p>\n\n<p>The 3rd part is about not blocking the program. In Go, it can easily be acheived by using a seperate goroutine to check an event loop, or use the good-old callback way. It is up to library you pick. </p>\n\n<p>A little more about signal and the <code>ctrl-c</code> case. It is common practice that <code>ctrl-c</code> is bound to send a sigint to the program, in most situations. And if not modified, a sigint terminates a program. However, a program can modify the behavior of dealing with sigint, like your orignal code does (adds a message to print). When pressing other keys, it is unlikely the os would bind it to another signal, so you can not deal with it.</p>\n\n<p>Of corse another solution would be bind a key compostion (multiple key strokes) to sending a sigint to the program, but as long as the program is the program receiving the key stroke itself, that is a redunctant.</p>\n\n<p>Note: Because of the choice of libs can be varied, the codes are very much differed, so I don't think I can (or should) provide an example.</p>\n"}], "owner": {"reputation": 43, "user_id": 3575979, "user_type": "registered", "profile_image": "https://graph.facebook.com/733760197/picture?type=large", "display_name": "Kstulen", "link": "https://stackoverflow.com/users/3575979/kstulen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2136, "favorite_count": 0, "accepted_answer_id": 48654419, "answer_count": 1, "score": 2, "last_activity_date": 1517965577, "creation_date": 1517958927, "last_edit_date": 1517959696, "question_id": 48653502, "link": "https://stackoverflow.com/questions/48653502/interrupting-an-infinite-loop-in-golang-with-signals", "title": "Interrupting an infinite loop in Golang with signals", "body": "<p>I'm trying to make a program that uses signals to interrupt an infinite counter loop. I've managed to interrupt the program with SIGINT (ctrl + C), but I'm unable to interrupt it otherwise. I'm wondering if I can make other ways of interrupting the loop, for example by pressing the Q key while it is running in the terminal.</p>\n\n<p>I've made two Go-files, the first one containing the actual infinite loop:</p>\n\n<pre><code>package infinite\n\nimport \"fmt\"\nimport \"time\"\n\nfunc Infinite01 (msg string) {\nfor i := 0; ; i++ {\n    fmt.Println(msg, i)\n    time.Sleep(time.Second)\n    }\n}\n</code></pre>\n\n<p>And then the file to catch the SIGINT signal and interrupt the loop:</p>\n\n<pre><code>package main\n\nimport (\n\"./infinite\"\n\"os/signal\"\n\"os\"\n\"fmt\"\n)\n\nfunc main() {\nsigs := make(chan os.Signal, 1)\nsignal.Notify(sigs, os.Interrupt)\ngo func() {\n    &lt;-sigs\n    fmt.Printf(\"You pressed ctrl + C. User interrupted infinite loop.\")\n    os.Exit(0)\n}()\nLoop()\n}\n\nfunc Loop() {\ninfinite.Infinite01(\"Look, I can count forever:\")\n}\n</code></pre>\n"}, {"tags": ["pointers", "go", "thrift"], "comments": [{"owner": {"reputation": 5668, "user_id": 712526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06e3c4065e9d08da698b4f4de3959294?s=128&d=identicon&r=PG", "display_name": "jpaugh", "link": "https://stackoverflow.com/users/712526/jpaugh"}, "edited": false, "score": 0, "creation_date": 1517958604, "post_id": 48653386, "comment_id": 84304965, "body": "<code>&amp;i</code> returns the address of (or reference to) <code>i</code>, not the value. (In other words, it <i>references</i> <code>i</code>.) So, that address is what is stored in <code>o</code>. In order to get to the actual value, you need to <i>dereference</i> the reference stored in <code>o</code>."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517958847, "post_id": 48653386, "comment_id": 84305048, "body": "I think there are many libraries dedicate to that, one of them being <a href=\"https://godoc.org/github.com/davecgh/go-spew/spew\" rel=\"nofollow noreferrer\">godoc.org/github.com/davecgh/go-spew/spew</a>"}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 4532360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/306e56e14d4a795ced280d1c1c36d67b?s=128&d=identicon&r=PG&f=1", "display_name": "ryebread", "link": "https://stackoverflow.com/users/4532360/ryebread"}, "edited": false, "score": 0, "creation_date": 1517958973, "post_id": 48653503, "comment_id": 84305099, "body": "yeah, I&#39;m just wondering if there&#39;s a fmt shortcut (similar to %+v) that will dereference pointer fields implicitly rather than having to explicitly specify each field. you can imagine for a struct with many fields, %+v is nice because it provides the logic of looping through the entire struct without explicitly specifying each field. I want to retain that functionality while showing values instead of pointers"}, {"owner": {"reputation": 5668, "user_id": 712526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06e3c4065e9d08da698b4f4de3959294?s=128&d=identicon&r=PG", "display_name": "jpaugh", "link": "https://stackoverflow.com/users/712526/jpaugh"}, "reply_to_user": {"reputation": 149, "user_id": 4532360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/306e56e14d4a795ced280d1c1c36d67b?s=128&d=identicon&r=PG&f=1", "display_name": "ryebread", "link": "https://stackoverflow.com/users/4532360/ryebread"}, "edited": false, "score": 0, "creation_date": 1517959114, "post_id": 48653503, "comment_id": 84305141, "body": "I&#39;m not familiar enough with golang to answer that. But, FWIW, the mistake you&#39;ve made in your verbiage (reference versus de-reference) is very common among C programmers, as well. It&#39;s quite useful to know the difference, as that precisely explains what&#39;s happening in your example."}, {"owner": {"reputation": 5668, "user_id": 712526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06e3c4065e9d08da698b4f4de3959294?s=128&d=identicon&r=PG", "display_name": "jpaugh", "link": "https://stackoverflow.com/users/712526/jpaugh"}, "reply_to_user": {"reputation": 149, "user_id": 4532360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/306e56e14d4a795ced280d1c1c36d67b?s=128&d=identicon&r=PG&f=1", "display_name": "ryebread", "link": "https://stackoverflow.com/users/4532360/ryebread"}, "edited": false, "score": 0, "creation_date": 1517959161, "post_id": 48653503, "comment_id": 84305156, "body": "BTW, if you want to ask about <code>%+v</code> instead, why not ask a separate question?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517959168, "post_id": 48653503, "comment_id": 84305159, "body": "I think it is not about what to store in the value, but about how to print (or, pretty-print) a already stored and fixed data structure."}, {"owner": {"reputation": 5668, "user_id": 712526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06e3c4065e9d08da698b4f4de3959294?s=128&d=identicon&r=PG", "display_name": "jpaugh", "link": "https://stackoverflow.com/users/712526/jpaugh"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517959245, "post_id": 48653503, "comment_id": 84305182, "body": "@leafbebop I addressed that (dereference <code>o</code>); as well as the confusion of what is actually stored in the value (that is, why de-referencing <code>o</code> is necessary)."}, {"owner": {"reputation": 149, "user_id": 4532360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/306e56e14d4a795ced280d1c1c36d67b?s=128&d=identicon&r=PG&f=1", "display_name": "ryebread", "link": "https://stackoverflow.com/users/4532360/ryebread"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517959275, "post_id": 48653503, "comment_id": 84305187, "body": "@leafbebop that&#39;s exactly it"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517959356, "post_id": 48653503, "comment_id": 84305205, "body": "@jpaugh Yes I understand your answer&#39;s contents as well as its purpose, and that is why I think you got the <i>question</i> wrong."}, {"owner": {"reputation": 5668, "user_id": 712526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06e3c4065e9d08da698b4f4de3959294?s=128&d=identicon&r=PG", "display_name": "jpaugh", "link": "https://stackoverflow.com/users/712526/jpaugh"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517959408, "post_id": 48653503, "comment_id": 84305218, "body": "@leafbebop. Perhaps. IMO, the OP asked a different question than what he needed an answer for."}, {"owner": {"reputation": 149, "user_id": 4532360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/306e56e14d4a795ced280d1c1c36d67b?s=128&d=identicon&r=PG&f=1", "display_name": "ryebread", "link": "https://stackoverflow.com/users/4532360/ryebread"}, "edited": false, "score": 0, "creation_date": 1517959418, "post_id": 48653503, "comment_id": 84305220, "body": "@jpaugh thanks for your help - i do know that de-referencing o is necessary, i&#39;m just wondering if there&#39;s a fmt shortcut (or some analogous solution) that will do that implicitly without having to explicitly access that field"}, {"owner": {"reputation": 5668, "user_id": 712526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06e3c4065e9d08da698b4f4de3959294?s=128&d=identicon&r=PG", "display_name": "jpaugh", "link": "https://stackoverflow.com/users/712526/jpaugh"}, "reply_to_user": {"reputation": 149, "user_id": 4532360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/306e56e14d4a795ced280d1c1c36d67b?s=128&d=identicon&r=PG&f=1", "display_name": "ryebread", "link": "https://stackoverflow.com/users/4532360/ryebread"}, "edited": false, "score": 0, "creation_date": 1517959460, "post_id": 48653503, "comment_id": 84305234, "body": "@ryebread You&#39;ve asked me that. I said I did not know. I also suggested asking another question. But perhaps editing your question to include that detail will help others answer it."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 149, "user_id": 4532360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/306e56e14d4a795ced280d1c1c36d67b?s=128&d=identicon&r=PG&f=1", "display_name": "ryebread", "link": "https://stackoverflow.com/users/4532360/ryebread"}, "edited": false, "score": 2, "creation_date": 1517959498, "post_id": 48653503, "comment_id": 84305245, "body": "@ryebread in short, simply using package <code>fmt</code> and not write extra code like custom <code>Stringer</code>, it is impossible to do the pretty-print, reasons are stated in this answer and I think you are aware of that. However, it can be done by some third-party pretty-print libraries, if you search on godoc.org with the keyword &quot;pretty&quot;."}], "tags": [], "owner": {"reputation": 5668, "user_id": 712526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06e3c4065e9d08da698b4f4de3959294?s=128&d=identicon&r=PG", "display_name": "jpaugh", "link": "https://stackoverflow.com/users/712526/jpaugh"}, "is_accepted": false, "score": 0, "last_activity_date": 1517958975, "last_edit_date": 1517958975, "creation_date": 1517958928, "answer_id": 48653503, "question_id": 48653386, "link": "https://stackoverflow.com/questions/48653386/how-to-print-dereferenced-value-of-field-without-explicitly-specifying-that-fiel/48653503#48653503", "title": "How to print dereferenced value of field without explicitly specifying that field golang", "body": "<p>When you use <code>&amp;i</code> it <em>does not</em> dereference <code>i</code>. Rather it <em>references</em> <code>i</code>, which means that it copies the address of <code>i</code> into <code>o</code>. See the documentation for the <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">Address operators</a>.</p>\n\n<p>From what I gather, you should be able to use <code>*o</code> to <em>dereference</em> the pointer; in other words, go from the address back to the original variable.</p>\n\n<blockquote>\n  <p>For an operand x of pointer type *T, the pointer indirection *x denotes the variable of type T pointed to by x. If x is nil, an attempt to evaluate *x will cause a run-time panic. </p>\n</blockquote>\n"}], "owner": {"reputation": 149, "user_id": 4532360, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/306e56e14d4a795ced280d1c1c36d67b?s=128&d=identicon&r=PG&f=1", "display_name": "ryebread", "link": "https://stackoverflow.com/users/4532360/ryebread"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1517959633, "creation_date": 1517958255, "last_edit_date": 1517959633, "question_id": 48653386, "link": "https://stackoverflow.com/questions/48653386/how-to-print-dereferenced-value-of-field-without-explicitly-specifying-that-fiel", "title": "How to print dereferenced value of field without explicitly specifying that field golang", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype outer struct {\n    in *int\n}\n\nfunc main() {\n    i := 4\n    o := outer{&amp;i}\n    fmt.Printf(\"%+v\", o)\n}\n</code></pre>\n\n<p>I'd like to see {in:4} at the end of this, not {in:0x......}, i.e. pretty print the data structure.</p>\n\n<p>I'd like to accomplish this in a similar manner to the code posted (e.g. with a fmt shortcut similar to %+v or an analogous solution).</p>\n\n<p>This is for autogenerated code from a required field of a thrift struct.</p>\n\n<p>What's the best way to go about this?</p>\n"}, {"tags": ["c", "go", "bpf", "ebpf"], "comments": [{"owner": {"reputation": 5010, "user_id": 3150445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bfca2588483eadf6695a120cbcef1f8?s=128&d=identicon&r=PG&f=1", "display_name": "jwdonahue", "link": "https://stackoverflow.com/users/3150445/jwdonahue"}, "edited": false, "score": 0, "creation_date": 1517959174, "post_id": 48653164, "comment_id": 84305161, "body": "Is this a GO or C code problem?  You should take the <a href=\"https://stackoverflow.com/tour\">tour</a>, read <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a> and <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "reply_to_user": {"reputation": 5010, "user_id": 3150445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bfca2588483eadf6695a120cbcef1f8?s=128&d=identicon&r=PG&f=1", "display_name": "jwdonahue", "link": "https://stackoverflow.com/users/3150445/jwdonahue"}, "edited": false, "score": 0, "creation_date": 1517959572, "post_id": 48653164, "comment_id": 84305266, "body": "Strictly Go - I tagged C as I&#39;m importing the C package. It&#39;s not really a problem in any language, it&#39;s a error returned from the <code>bpf</code> syscall"}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "reply_to_user": {"reputation": 5010, "user_id": 3150445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bfca2588483eadf6695a120cbcef1f8?s=128&d=identicon&r=PG&f=1", "display_name": "jwdonahue", "link": "https://stackoverflow.com/users/3150445/jwdonahue"}, "edited": false, "score": 0, "creation_date": 1517959598, "post_id": 48653164, "comment_id": 84305271, "body": "But I will read those things, I guess I haven&#39;t included enough detail for it to be answered properly"}, {"owner": {"reputation": 7068, "user_id": 6884590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0b52ad2211a26c4e1cefb472e09cbe?s=128&d=identicon&r=PG", "display_name": "pchaigno", "link": "https://stackoverflow.com/users/6884590/pchaigno"}, "edited": false, "score": 0, "creation_date": 1517986751, "post_id": 48653164, "comment_id": 84313023, "body": "@dippynark Could you add the C code of the BPF program (or the bytecode if you didn&#39;t write it in C)? This error usually comes from an incorrect use of BPF helpers."}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "reply_to_user": {"reputation": 5010, "user_id": 3150445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bfca2588483eadf6695a120cbcef1f8?s=128&d=identicon&r=PG&f=1", "display_name": "jwdonahue", "link": "https://stackoverflow.com/users/3150445/jwdonahue"}, "edited": false, "score": 0, "creation_date": 1517995847, "post_id": 48653164, "comment_id": 84317831, "body": "@jwdonahue I&#39;ve added back the C tag as it uses both C and Go and I&#39;m not sure where the root cause is"}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "reply_to_user": {"reputation": 7068, "user_id": 6884590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0b52ad2211a26c4e1cefb472e09cbe?s=128&d=identicon&r=PG", "display_name": "pchaigno", "link": "https://stackoverflow.com/users/6884590/pchaigno"}, "edited": false, "score": 0, "creation_date": 1517995893, "post_id": 48653164, "comment_id": 84317862, "body": "@pchaigno I&#39;ve added the BPF program I&#39;m trying to load with a bit more of a description of the problem - the BPF program does nothing to try and narrow down where the issue is coming from"}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1518028764, "post_id": 48653164, "comment_id": 84339960, "body": "I think the padding in your Go program&#39;s <code>lba</code> struct is throwing things off. The C struct <code>{ __u32   prog_type; __u32 insn_cnt;...}</code> doesn&#39;t have padding between those first two members (verified with a small C program). So you&#39;re passing a struct that is bigger than expected, and the kernel code in <code>check_uarg_tail_zero</code> checks all the excess bytes and returns E2BIG if any are nonzero."}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1518034761, "post_id": 48653164, "comment_id": 84343334, "body": "@MarkPlotnick Good spot, I put in padding because some of the input attributes needed to be &#39;aligned&#39;, but I&#39;m now getting a different error: invalid argument. The definition is <code>EINVAL: For BPF_PROG_LOAD, indicates an attempt to load an invalid program. eBPF programs can be deemed invalid due to unrecognized instructions, the use of reserved fields, jumps out of range, infinite loops or calls of unknown functions.</code> from <a href=\"https://manpages.debian.org/testing/manpages-dev/bpf.2.en.html#ERRORS\" rel=\"nofollow noreferrer\">manpages.debian.org/testing/manpages-dev/bpf.2.en.html#ERROR&zwnj;&#8203;S</a>"}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1518034869, "post_id": 48653164, "comment_id": 84343389, "body": "@MarkPlotnick I tried inserting the program <a href=\"https://github.com/torvalds/linux/blob/master/samples/bpf/test_overhead_kprobe_kern.c\" rel=\"nofollow noreferrer\">github.com/torvalds/linux/blob/master/samples/bpf/&hellip;</a> compiled using the provided Makefile, so I&#39;m fairly sure there isn&#39;t an error in the program, but I received <code>invalid argument</code> again"}], "answers": [{"comments": [{"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "edited": false, "score": 0, "creation_date": 1517998471, "post_id": 48660939, "comment_id": 84319599, "body": "@pchaigo <code>isnt_cnt</code> is not non-zero; even with just a task_struct definition it is over 300 bytes big. I&#39;ve tried with a full program of about 1KB in size with the same issue"}, {"owner": {"reputation": 7068, "user_id": 6884590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0b52ad2211a26c4e1cefb472e09cbe?s=128&d=identicon&r=PG", "display_name": "pchaigno", "link": "https://stackoverflow.com/users/6884590/pchaigno"}, "reply_to_user": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "edited": false, "score": 0, "creation_date": 1517998587, "post_id": 48660939, "comment_id": 84319684, "body": "Hm, I&#39;ll run some more checks. What is 300B big? The bpf/bbf_tty.o file?"}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "edited": false, "score": 0, "creation_date": 1517998758, "post_id": 48660939, "comment_id": 84319777, "body": "Yeah, even with just that task_group struct above. I guess there&#39;s come default overhead that&#39;s added - the details of C compilation is not one of my strong points"}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "edited": false, "score": 0, "creation_date": 1517998812, "post_id": 48660939, "comment_id": 84319812, "body": "I&#39;m using CLANG for the compilation of the BPF program in the same way as Cilium do here: <a href=\"https://github.com/cilium/cilium/blob/master/bpf/Makefile\" rel=\"nofollow noreferrer\">github.com/cilium/cilium/blob/master/bpf/Makefile</a>"}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "edited": false, "score": 0, "creation_date": 1517999002, "post_id": 48660939, "comment_id": 84319946, "body": "@pchaigo have you managed to recreate the error at all? I realise there&#39;s a lot of stuff around the edges that&#39;s missing, just didn&#39;t want to clog the question"}, {"owner": {"reputation": 7068, "user_id": 6884590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0b52ad2211a26c4e1cefb472e09cbe?s=128&d=identicon&r=PG", "display_name": "pchaigno", "link": "https://stackoverflow.com/users/6884590/pchaigno"}, "reply_to_user": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "edited": false, "score": 0, "creation_date": 1517999297, "post_id": 48660939, "comment_id": 84320152, "body": "I&#39;ve added details in my answer to show that there are actually 0 instructions for that BPF program. Hope that help."}, {"owner": {"reputation": 7068, "user_id": 6884590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0b52ad2211a26c4e1cefb472e09cbe?s=128&d=identicon&r=PG", "display_name": "pchaigno", "link": "https://stackoverflow.com/users/6884590/pchaigno"}, "reply_to_user": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "edited": false, "score": 0, "creation_date": 1517999362, "post_id": 48660939, "comment_id": 84320202, "body": "If you have a minimal test case from your full program, I can check again."}, {"owner": {"reputation": 4454, "user_id": 3716552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/078Ob.jpg?s=128&g=1", "display_name": "Qeole", "link": "https://stackoverflow.com/users/3716552/qeole"}, "edited": false, "score": 0, "creation_date": 1517999404, "post_id": 48660939, "comment_id": 84320238, "body": "Dumb question (never used Go): what does <code>ioutil.ReadFile(&quot;bpf&#47;bbf_tty.o&quot;)</code> do? Does it retrieve a specific section from the ELF file and perform eBPF map relocation, or do you just feed all the bytes as read from the file to the <code>bpf()</code> syscall?"}, {"owner": {"reputation": 7068, "user_id": 6884590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0b52ad2211a26c4e1cefb472e09cbe?s=128&d=identicon&r=PG", "display_name": "pchaigno", "link": "https://stackoverflow.com/users/6884590/pchaigno"}, "edited": false, "score": 0, "creation_date": 1517999536, "post_id": 48660939, "comment_id": 84320346, "body": "Hm, right. Missed that. I think you&#39;re on to something Qeole :) It just reads the bytes. Do you want to post an answer?"}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "reply_to_user": {"reputation": 4454, "user_id": 3716552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/078Ob.jpg?s=128&g=1", "display_name": "Qeole", "link": "https://stackoverflow.com/users/3716552/qeole"}, "edited": false, "score": 0, "creation_date": 1517999703, "post_id": 48660939, "comment_id": 84320482, "body": "@Qeole Yeah it just feeds to object file byte for byte into the <code>bpf</code> syscall, should you instead strip off any ELF headers etc. so you&#39;re left with just the text section?"}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "edited": false, "score": 0, "creation_date": 1517999775, "post_id": 48660939, "comment_id": 84320532, "body": "@pchaigno Nice one showing that the .text section is empty - I guess the compiler is stripping out unused parts. My full program definitely will have had a .text section though - I&#39;ll post that now"}, {"owner": {"reputation": 4454, "user_id": 3716552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/078Ob.jpg?s=128&g=1", "display_name": "Qeole", "link": "https://stackoverflow.com/users/3716552/qeole"}, "edited": false, "score": 0, "creation_date": 1518000104, "post_id": 48660939, "comment_id": 84320763, "body": "@pchaigno I have no idea how to fix that in Go :-) Please proceed if you know what function/lib to use. Or there is the Gobpf thing, maybe."}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "edited": false, "score": 0, "creation_date": 1518000142, "post_id": 48660939, "comment_id": 84320796, "body": "@pchaigno I&#39;ve included my full BPF program at the bottom of the question - using your technique I can see it does have a .text section, so I don&#39;t <i>think</i> that&#39;s this issue in this case"}, {"owner": {"reputation": 7068, "user_id": 6884590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0b52ad2211a26c4e1cefb472e09cbe?s=128&d=identicon&r=PG", "display_name": "pchaigno", "link": "https://stackoverflow.com/users/6884590/pchaigno"}, "reply_to_user": {"reputation": 4454, "user_id": 3716552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/078Ob.jpg?s=128&g=1", "display_name": "Qeole", "link": "https://stackoverflow.com/users/3716552/qeole"}, "edited": false, "score": 0, "creation_date": 1518000217, "post_id": 48660939, "comment_id": 84320849, "body": "@Qeole Honestly, I think pointing to the issue and how you found it is enough. We&#39;re not supposed to write programs for other developers. This is a debugging question ;)"}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "edited": false, "score": 0, "creation_date": 1518000584, "post_id": 48660939, "comment_id": 84321110, "body": "@pchaigno yeah true, but simplifying my problem (by reducing the BPF program) has actually changed what the problem is. The problem with my original BPF program still remains - the full code is here if you have any extra time <a href=\"https://github.com/dippynark/kubepf/tree/add-ebpf-program\" rel=\"nofollow noreferrer\">github.com/dippynark/kubepf/tree/add-ebpf-program</a> - I will keep trying. Thanks for your help"}], "tags": [], "owner": {"reputation": 7068, "user_id": 6884590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0b52ad2211a26c4e1cefb472e09cbe?s=128&d=identicon&r=PG", "display_name": "pchaigno", "link": "https://stackoverflow.com/users/6884590/pchaigno"}, "is_accepted": false, "score": 1, "last_activity_date": 1518003858, "last_edit_date": 1518003858, "creation_date": 1517997883, "answer_id": 48660939, "question_id": 48653164, "link": "https://stackoverflow.com/questions/48653164/argument-list-too-long-to-when-loading-an-ebpf-program-via-the-bpf-syscall/48660939#48660939", "title": "Argument list too long to when loading an eBPF program via the bpf syscall", "body": "<blockquote>\n  <p><strong>See @Qeole's answer for the actual cause of this error message.</strong></p>\n</blockquote>\n\n<p>You need a non-empty BPF program. Otherwise, you will fail the following precondition in <a href=\"http://elixir.free-electrons.com/linux/v4.15.1/source/kernel/bpf/syscall.c#L1137\" rel=\"nofollow noreferrer\"><code>bpf_prog_load</code></a>:</p>\n\n<pre><code>if (attr-&gt;insn_cnt == 0 || attr-&gt;insn_cnt &gt; BPF_MAXINSNS)\n    return -E2BIG;\n</code></pre>\n\n<p>Your current compiled BPF program appears to be empty since it does not contain any function. Therefore, <code>attr-&gt;insn_cnt</code> is null.</p>\n\n<hr>\n\n<p><strong>Details</strong> I've checked that <code>attr-&gt;insn_cnt</code> is actually null:</p>\n\n<pre><code>$ cat tmp.c \nstruct task_group {};\n$ clang -O2 -target bpf -c tmp.c -o tmp.o\n$ ls -lh tmp.o \n-rw-rw-r-- 1 paul paul 368 f\u00e9vr.  7 11:21 tmp.o\n$ readelf -x .text tmp.o\n\nSection '.text' has no data to dump.\n</code></pre>\n\n<p>The object file is not empty but its .text section, which should contains the BPF instructions, is. If I run <code>readelf -x .text tmp.o</code> on one of my own programs I get a hexdump, as expected.</p>\n"}, {"comments": [{"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "edited": false, "score": 0, "creation_date": 1518002260, "post_id": 48661976, "comment_id": 84322170, "body": "I&#39;ve got my program working with Gobpf but had issues when moving it into a container (I want to run distributed tracing with Kubernetes) so tried to go back to basics and implement everything myself through the syscall - thanks for pointing that out though, I&#39;ll try those things asap"}, {"owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "edited": false, "score": 0, "creation_date": 1518387103, "post_id": 48661976, "comment_id": 84473547, "body": "started using gobpf&#39;s elf package instead of the bcc package and it works nicely without having to compile the BPF program on the fly :)"}], "tags": [], "owner": {"reputation": 4454, "user_id": 3716552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/078Ob.jpg?s=128&g=1", "display_name": "Qeole", "link": "https://stackoverflow.com/users/3716552/qeole"}, "is_accepted": true, "score": 2, "last_activity_date": 1518000754, "creation_date": 1518000754, "answer_id": 48661976, "question_id": 48653164, "link": "https://stackoverflow.com/questions/48653164/argument-list-too-long-to-when-loading-an-ebpf-program-via-the-bpf-syscall/48661976#48661976", "title": "Argument list too long to when loading an eBPF program via the bpf syscall", "body": "<p>Your problem here is the way you try to load the BPF bytecode.</p>\n\n<pre><code>b, err := ioutil.ReadFile(\"bpf/bbf_tty.o\")\n</code></pre>\n\n<p>I have never used Go, but from what I understand this reads all the bytes from the ELF object file, without any specific processing, and feed them to the <code>bpf()</code> syscall later in your code.</p>\n\n<p>The thing is, this is not how things work: when it compiles into eBPF, clang puts your program into <em>one</em> particular section (by default, <code>.text</code>, but you could specify another name). In addition, if you use eBPF maps, some magic happens (\u201cmap relocation\u201d) so that your ELF file can embed map info, and your userspace program calling to <code>bpf()</code> can retrieve it and send it to the kernel.</p>\n\n<p>So when you load the whole file to send it to <code>bpf()</code>, you load your actual bytecode, plus all ELF sections and header. The kernel probably does not like it much. I don't know how to fix it in Go, but here are some pointers that might be helpful:</p>\n\n<ul>\n<li>libbpf, a C library that can load eBPF programs from the ELF files: located <a href=\"https://git.kernel.org/pub/scm/linux/kernel/git/davem/net-next.git/tree/tools/lib/bpf/libbpf.c\" rel=\"nofollow noreferrer\">in the kernel tree</a>.</li>\n<li>Gobpf, some framework to use eBPF programs with Go (<a href=\"https://github.com/iovisor/gobpf\" rel=\"nofollow noreferrer\">link</a>). I've never used it, but surely they would have some code to load programs from object files?</li>\n</ul>\n"}], "owner": {"reputation": 2018, "user_id": 6180803, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/x8pJW.jpg?s=128&g=1", "display_name": "dippynark", "link": "https://stackoverflow.com/users/6180803/dippynark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1018, "favorite_count": 0, "accepted_answer_id": 48661976, "answer_count": 2, "score": 1, "last_activity_date": 1550830042, "creation_date": 1517956898, "last_edit_date": 1550830042, "question_id": 48653164, "link": "https://stackoverflow.com/questions/48653164/argument-list-too-long-to-when-loading-an-ebpf-program-via-the-bpf-syscall", "title": "Argument list too long to when loading an eBPF program via the bpf syscall", "body": "<p>I am trying to load an eBPF program via the <code>bpf</code> syscall in Go but am seeing an error returned from the syscall. In order to restrict the problem I am using the following minimal eBPF program, which does nothing:</p>\n\n<pre><code>struct task_group {};    \n</code></pre>\n\n<p>The important parts of the Go program are as follows:</p>\n\n<pre><code>b, err := ioutil.ReadFile(\"bpf/bbf_tty.o\")\nif err != nil {\n    fmt.Print(err)\n}\n\nprogType := BPF_PROG_TYPE_KPROBE\ninsns := unsafe.Pointer(&amp;b)\ninsnCnt := len(b)\n\nlba := struct {\n    progType    uint32\n    pad0        [4]byte\n    insnCnt     uint32\n    pad1        [4]byte\n    insns       uint64\n    license     uint64\n    logLevel    uint32\n    pad2        [4]byte\n    logSize     uint32\n    pad3        [4]byte\n    logBuf      uint64\n    kernVersion uint32\n    pad4        [4]byte\n}{\n    progType:    uint32(progType),\n    insns:       uint64(uintptr(insns)),\n    insnCnt:     uint32(insnCnt),\n    license:     uint64(uintptr(0)),\n    logBuf:      uint64(uintptr(0)),\n    logSize:     uint32(0),\n    logLevel:    uint32(0),\n    kernVersion: uint32(4),\n}\n\nret, _, err := unix.Syscall(\n    unix.SYS_BPF,\n    bpf.BPF_PROG_LOAD,\n    uintptr(unsafe.Pointer(&amp;lba)),\n    unsafe.Sizeof(lba),\n)\n\nif ret != 0 || err != 0 {\n    return fmt.Errorf(\"Unable to load program: %s\", err)\n}\n</code></pre>\n\n<p>However the error that's getting returned is <code>Unable to load program: argument list too long</code>. Why is this? Or better yet, how can I get a more verbose output to find out the root cause of the issue?</p>\n\n<p>From <a href=\"http://elixir.free-electrons.com/linux/latest/source/kernel/bpf/syscall.c\" rel=\"nofollow noreferrer\">here</a> there are only three places that <code>E2BIG</code> (argument list too long) gets returned from the <code>bpf</code> syscall, but none of them seem to fit.</p>\n\n<p>I can provide a more complete version of my code if needed, I just tried to strip out the irrelevant parts for brevity. </p>\n\n<p>To help with recreating this issue, I have included my full BPF program below. The full repo is <a href=\"https://github.com/dippynark/kubepf/tree/add-ebpf-program\" rel=\"nofollow noreferrer\">here</a>:</p>\n\n<pre><code>#include &lt;node_config.h&gt;\n#include &lt;netdev_config.h&gt;\n#include &lt;filter_config.h&gt;\n\n#include &lt;bpf/api.h&gt;\n\n#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n\n#include &lt;linux/bpf.h&gt;\n#include &lt;linux/if_ether.h&gt;\n\n#include \"lib/utils.h\"\n#include \"lib/common.h\"\n#include \"lib/maps.h\"\n#include \"lib/xdp.h\"\n#include \"lib/eps.h\"\n#include \"lib/events.h\"\n\n// define structures\nenum pid_type\n{\n    PIDTYPE_PID,\n    PIDTYPE_PGID,\n    PIDTYPE_SID,\n    PIDTYPE_MAX,\n    // only valid to __task_pid_nr_ns() \n    __PIDTYPE_TGID\n};\nstruct upid {\n  int nr;\n};\nstruct pid\n{\n  struct upid numbers[1];\n};\nstruct pid_link\n{\n  struct pid *pid;\n};\nstruct task_group {\n};\nstruct task_struct {\n  struct task_struct *group_leader;\n  struct pid_link           pids[PIDTYPE_MAX];\n};\nstruct sid_t {\n    int sid;\n};\n\n#define BUFSIZE 256\nstruct tty_write_t {\n    int count;\n    char buf[BUFSIZE];\n    unsigned int sessionid;\n};\n\n// define maps\nstruct bpf_elf_map __section_maps active_sids = {\n    .type       = BPF_MAP_TYPE_HASH,\n    .size_key   = sizeof(struct sid_t),\n    .size_value = sizeof(uint64_t),\n};\n\nstruct bpf_elf_map __section_maps tty_writes = {\n    .type       = BPF_MAP_TYPE_PERF_EVENT_ARRAY,\n};\n\n// save_sid saves a sessionid generated from a call\n// to setsid to the active_sids map\nint save_sid(struct pt_regs *ctx) {\n\n    struct sid_t sid_struct = {};\n    int sid = PT_REGS_RC(ctx);\n    uint64_t time_ns = bpf_ktime_get_ns();\n\n    sid_struct.sid = sid;\n\n    bpf_map_update(&amp;sid_struct, &amp;time_ns);\n\n    return 0;\n\n}\n\n//int kprobe__tty_write(struct pt_regs *ctx, struct file *file, const char __user *buf, size_t count)\nint kprobe__tty_write(struct pt_regs *ctx, struct file *file, const char *buf, size_t count)\n{\n    struct task_struct *task;\n    struct pid_link pid_link;\n    struct pid pid;\n    int sessionid;\n\n    // get current sessionid\n    task = (struct task_struct *)bpf_get_current_task();\n    bpf_probe_read(&amp;pid_link, sizeof(pid_link), (void *)&amp;task-&gt;group_leader-&gt;pids[PIDTYPE_SID]);\n    bpf_probe_read(&amp;pid, sizeof(pid), (void *)pid_link.pid);\n    sessionid = pid.numbers[0].nr;\n\n    // build session struct key\n    struct sid_t sid_key;\n    sid_key.sid = sessionid;\n\n    // if sid does not exist in our map then return\n    //u64 *time_ns = active_sids.lookup(&amp;sid_key);\n    //if (!time_ns) {\n    //    return 0;\n    //}\n\n    // bpf_probe_read() can only use a fixed size, so truncate to count\n    // in user space:\n    struct tty_write_t tty_write = {};\n    bpf_probe_read(&amp;tty_write.buf, BUFSIZE, (void *)buf);\n    if (count &gt; BUFSIZE) {\n        tty_write.count = BUFSIZE;\n    } else {\n        tty_write.count = count;\n    }\n\n    // add sessionid to tty_write structure and submit\n    tty_write.sessionid = sessionid;\n    bpf_perf_event_output(ctx, &amp;tty_write, sizeof(tty_write));\n\n    return 0;\n}\n</code></pre>\n"}, {"tags": ["go", "amazon-s3"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517951035, "post_id": 48651899, "comment_id": 84301754, "body": "What is <code>pWriter</code>? Why do you say it will wait until writing finishes?"}, {"owner": {"reputation": 525, "user_id": 1264021, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/270f846af2d52aab055b25a3037c97e1?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1264021/james"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517951073, "post_id": 48651899, "comment_id": 84301777, "body": "pWriter was a typo, corrected now. Sorry!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517951078, "post_id": 48651899, "comment_id": 84301779, "body": "The Uploader docs say: <code>Upload uploads an object to S3, intelligently buffering large files into smaller chunks</code> -- isn&#39;t that what you&#39;re asking?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517951106, "post_id": 48651899, "comment_id": 84301790, "body": "I don&#39;t see anything in the code that would cause it to wait for writes to finish before uploading."}, {"owner": {"reputation": 525, "user_id": 1264021, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/270f846af2d52aab055b25a3037c97e1?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1264021/james"}, "edited": false, "score": 0, "creation_date": 1517951529, "post_id": 48651899, "comment_id": 84301987, "body": "Interesting, maybe I&#39;ve misunderstood what&#39;s happening here then. If the upload starts before the Close() is called then it could be doing what I want already. I&#39;ll test it out with some larger datasets and see what the memory usage is like."}], "answers": [{"tags": [], "owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "is_accepted": true, "score": 0, "last_activity_date": 1517961748, "creation_date": 1517961748, "answer_id": 48653909, "question_id": 48651899, "link": "https://stackoverflow.com/questions/48651899/multipart-upload-to-s3-while-writing-to-reader/48653909#48653909", "title": "Multipart upload to s3 while writing to reader", "body": "<p>The uploader is supported multipart upload if I had read source code of the uploader in right way: <a href=\"https://github.com/aws/aws-sdk-go/blob/master/service/s3/s3manager/upload.go\" rel=\"nofollow noreferrer\">https://github.com/aws/aws-sdk-go/blob/master/service/s3/s3manager/upload.go</a></p>\n\n<p>The minimum size of an uploaded part is 5 Mb.</p>\n\n<pre><code>// MaxUploadParts is the maximum allowed number of parts in a multi-part upload\n// on Amazon S3.\nconst MaxUploadParts = 10000\n// MinUploadPartSize is the minimum allowed part size when uploading a part to\n// Amazon S3.\nconst MinUploadPartSize int64 = 1024 * 1024 * 5\n// DefaultUploadPartSize is the default part size to buffer chunks of a\n// payload into.\nconst DefaultUploadPartSize = MinUploadPartSize\n\nu := &amp;Uploader{\n    PartSize:          DefaultUploadPartSize,\n    MaxUploadParts:    MaxUploadParts,\n    .......\n}\n\nfunc (u Uploader) UploadWithContext(ctx aws.Context, input *UploadInput, opts ...func(*Uploader)) (*UploadOutput, error) {\n   i := uploader{in: input, cfg: u, ctx: ctx}\n   .......\n\nfunc (u *uploader) nextReader() (io.ReadSeeker, int, error) {\n    .............\n    switch r := u.in.Body.(type) {\n    .........\n    default:\n        part := make([]byte, u.cfg.PartSize)\n        n, err := readFillBuf(r, part)\n        u.readerPos += int64(n)\n\n        return bytes.NewReader(part[0:n]), n, err\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 525, "user_id": 1264021, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/270f846af2d52aab055b25a3037c97e1?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1264021/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 734, "favorite_count": 0, "accepted_answer_id": 48653909, "answer_count": 1, "score": 0, "last_activity_date": 1517961748, "creation_date": 1517950880, "last_edit_date": 1517951045, "question_id": 48651899, "link": "https://stackoverflow.com/questions/48651899/multipart-upload-to-s3-while-writing-to-reader", "title": "Multipart upload to s3 while writing to reader", "body": "<p>I've found a few questions that are similar to mine, but nothing that answers my specific question. </p>\n\n<p>I want to upload CSV data to s3. My basic code is along the lines of (I've simplified getting the data for brevity, normally it's reading from a database):</p>\n\n<pre><code>reader, writer := io.Pipe()\n\ngo func() {\n    cWriter := csv.NewWriter(pWriter)\n\n    for _, line := range lines {\n        cWriter.Write(line)\n    }\n\n    cWriter.Flush()\n    writer.Close()\n}()\n\nsess := session.New(//...)\nuploader := s3manager.NewUploader(sess)\n    result, err := uploader.Upload(&amp;s3manager.UploadInput{\n        Body:   reader,\n        //...\n})\n</code></pre>\n\n<p>The way I understand it, the code will wait for writing to finish and then will upload the contents to s3, so I end up with the full contents of the file in memory. Is it possible to chunk the upload (possibly using the s3 multipart upload?) so that for larger uploads, I'm only storing part of the data in memory at any one time?</p>\n"}, {"tags": ["elasticsearch", "go", "elasticsearch-5"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517948015, "post_id": 48651036, "comment_id": 84300269, "body": "That&#39;s not even how the Elastic API in the docs you linked work, though. Per that linked page, it &quot;returns documents that have at least one non-null value in the original field&quot;. It does not return true or false based on whether a field exists in an index - which is sort of an odd question in Elastic anyway, given that Elastic is schemaless."}, {"owner": {"reputation": 1811, "user_id": 3004041, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e9c675dd9408721a8e8e1106774a9d11?s=128&d=identicon&r=PG&f=1", "display_name": "covfefe", "link": "https://stackoverflow.com/users/3004041/covfefe"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517948498, "post_id": 48651036, "comment_id": 84300558, "body": "I guess I should have specified, I&#39;m looking for whether a field exists in a document, not an index."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1517948674, "post_id": 48651036, "comment_id": 84300665, "body": "Then just get the document and check for the field. You can use <code>StoreFields</code> to omit all other fields if the documents are overly large. Nothing like your hypothetical <code>elasticClient.Exists().Field(&quot;datefield&quot;)</code> could work because it doesn&#39;t specify a document ID."}, {"owner": {"reputation": 2732, "user_id": 2061886, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/dkfiz.jpg?s=128&g=1", "display_name": "lightweight", "link": "https://stackoverflow.com/users/2061886/lightweight"}, "edited": false, "score": 0, "creation_date": 1520614456, "post_id": 48651036, "comment_id": 85402004, "body": "did you find out how to do this?"}, {"owner": {"reputation": 408, "user_id": 9826697, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Pu78FyghZgI/AAAAAAAAAAI/AAAAAAAAAIE/AM4Xk2-XPaU/photo.jpg?sz=128", "display_name": "Rizki Hadiaturrasyid", "link": "https://stackoverflow.com/users/9826697/rizki-hadiaturrasyid"}, "edited": false, "score": 0, "creation_date": 1610440432, "post_id": 48651036, "comment_id": 116126265, "body": "for those who are still looking: query.Must(elastic.NewExistsQuery(&quot;someobject.somefield&quot;))"}], "owner": {"reputation": 1811, "user_id": 3004041, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e9c675dd9408721a8e8e1106774a9d11?s=128&d=identicon&r=PG&f=1", "display_name": "covfefe", "link": "https://stackoverflow.com/users/3004041/covfefe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 715, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1517948509, "creation_date": 1517947325, "last_edit_date": 1517948509, "question_id": 48651036, "link": "https://stackoverflow.com/questions/48651036/elasticsearch-in-go-check-if-field-exists-in-a-document", "title": "Elasticsearch in Go check if field exists in a document", "body": "<p>I'm using olivere's v.5 elasticsearch library - <a href=\"https://godoc.org/github.com/olivere/elastic\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/olivere/elastic</a></p>\n\n<p>Trying to check if a particular field exists in a document. According to ES docs, it's possible - <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html\" rel=\"nofollow noreferrer\">https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html</a></p>\n\n<p>But I can't find a Go query in the library to execute that. I found the NewExistsService but I don't see a method to search by field name. I need something like</p>\n\n<pre><code>elasticClient.Exists().Field(\"datefield\")\n</code></pre>\n\n<p>which returns true or false. But 'Field' is not a method of 'NewExistsService'. Any help would be appreciated.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1517945372, "post_id": 48650422, "comment_id": 84298813, "body": "Unless you do something crazy, each solution is going to be the same &quot;efficiency&quot;. Why not just optimize to make your code simpler?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517945924, "post_id": 48650422, "comment_id": 84299119, "body": "@JimB - Thanks, what do you mean by optimize ? I&#39;m open to any suggestion..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517946321, "post_id": 48650422, "comment_id": 84299341, "body": "I mean &quot;optimize to make the code simpler&quot;. If you can do it in 3 steps, why do it in more with no good reason?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517946666, "post_id": 48650422, "comment_id": 84299517, "body": "@JimB - Sorry im not sure that i understand :), what do you mean by 3 steps ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517946763, "post_id": 48650422, "comment_id": 84299558, "body": "The 3 steps you already laid out -- &quot;delete the app1 folder&quot;, &quot;create and empty folder&quot;, &quot;move the zip file&quot;."}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517946778, "post_id": 48650422, "comment_id": 84299567, "body": "I think what @JimB is saying is that there is no significant difference in efficiency between those two approaches, which I agree with.  So do whatever is easier/faster for you to implement and maintain.  If you mean something different from &quot;efficiency&quot;, please clarify your question."}, {"owner": {"reputation": 482, "user_id": 159650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9440222a0c3e33f369eef79712e12204?s=128&d=identicon&r=PG", "display_name": "dwright", "link": "https://stackoverflow.com/users/159650/dwright"}, "edited": false, "score": 0, "creation_date": 1517948098, "post_id": 48650422, "comment_id": 84300317, "body": "By &#39;efficient&#39; I believe you are referring to your code complexity not as it relates to how the underlying os handles the files/folders. Well which is less/cleaner code? I would assume #1."}], "answers": [{"comments": [{"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1518551004, "post_id": 48774418, "comment_id": 84550427, "body": "Thanks, but unfortunately Your suggestion is doesn&#39;t really help ...see the update with the code I&#39;ve provided , I&#39;ve provided 100 bounty for this...Btw, the internal tool is legacy which I cannot change :("}], "tags": [], "owner": {"reputation": 6001, "user_id": 1797000, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5974f50172fd161e3cccac40ecbe3934?s=128&d=identicon&r=PG", "display_name": "hdante", "link": "https://stackoverflow.com/users/1797000/hdante"}, "is_accepted": false, "score": 1, "last_activity_date": 1518550828, "creation_date": 1518550828, "answer_id": 48774418, "question_id": 48650422, "link": "https://stackoverflow.com/questions/48650422/golang-create-maybe-corrupted-file/48774418#48774418", "title": "Golang create maybe corrupted file", "body": "<p>First of all it's impossible for the files to be identical and the interpreter program to give different results. You're not writing the whole history in your description.</p>\n\n<ol>\n<li>How can I check if the file is corrupted ?</li>\n</ol>\n\n<p>The answer is in the internal tool. You should improve its debug message: \"Error while retrieving archive entry\". What error ? Debug your old tool. And it's suggesting the problem is in the zip file, not the json file.</p>\n\n<ol start=\"2\">\n<li>Should I try to use other API to check it? if yes, which ?</li>\n</ol>\n\n<p>Yes, unzip both files by hand and diff the output.</p>\n\n<ol start=\"3\">\n<li>Any other direction ?</li>\n</ol>\n\n<p>Read the code for your old java tool.</p>\n"}, {"comments": [{"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1518558751, "post_id": 48776005, "comment_id": 84554332, "body": "Thanks, Sound a direction to check becouse the tool who reading the zip is java based tool..., It will be great if you can provide compelite  example with my contect and i&#39;ll try it and let you know."}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1518586129, "post_id": 48776005, "comment_id": 84562014, "body": "@shopiaT Try to use source code from an updated part."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1518594619, "post_id": 48776005, "comment_id": 84565447, "body": "HI Alex, it seems that this is a good direction ,but when I try to use the api you suggest and I try at the process end to unzip the files (from mac)  I got error, do you have an idea ? maybe using other OS ?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1518594790, "post_id": 48776005, "comment_id": 84565534, "body": "what do you think about this - go get github.com/mholt/archiver/cmd/archiver?"}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1518594980, "post_id": 48776005, "comment_id": 84565623, "body": "@shopiaT I tested it on MacOS. Yes, I got an error for unpack, but it is good for your Java tools. The solution is compromise. How often do you unpack the result archive by hand? Does it need in general way?"}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1518595067, "post_id": 48776005, "comment_id": 84565673, "body": "@shopiaT Do you test the solution using your Java tools?"}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1518595148, "post_id": 48776005, "comment_id": 84565704, "body": "github.com/mholt/archiver is just a wrapper for a standard Go archive/zip, etc. package without fix the ZIP64 format file for a ZipInputStream."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1518595292, "post_id": 48776005, "comment_id": 84565776, "body": "Ok, I&#39;ll now test it with the tool but before I need to remove the parent folder, i.e. when unzip I need to see just the files inside and not the parent folder. i&#39;ve tried to play with the <code>ExcludeBaseDir: true</code> which doesnt help, any idea?"}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1518595556, "post_id": 48776005, "comment_id": 84565883, "body": "I recommend you to call zipper.Process after your version Zipit function call against using zipper.Archive with Options. It is more compliance your requirements and archive workflow."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1518596242, "post_id": 48776005, "comment_id": 84566215, "body": "when I use the process I got error from the tool :<code>zip: checksum error</code> , any idea why?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "edited": false, "score": 0, "creation_date": 1518596469, "post_id": 48776005, "comment_id": 84566311, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/165115/discussion-between-shopia-t-and-alexey-p\">continue this discussion in chat</a>."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519023256, "post_id": 48776005, "comment_id": 84724779, "body": "Hi Alexey , are you available"}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519032692, "post_id": 48776005, "comment_id": 84729108, "body": "Yes. Did you try to use zip command to fix golang made an archive?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519033150, "post_id": 48776005, "comment_id": 84729399, "body": "Yes but Im getting different errors, do you have mac or windows?"}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519037917, "post_id": 48776005, "comment_id": 84732377, "body": "I have no error on Mac OS when using exec.Command(&quot;zip&quot;, &quot;-F&quot;, archiveName, &quot;--out&quot;, fixedArchiveName).Run() without apply zipper package."}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519037999, "post_id": 48776005, "comment_id": 84732420, "body": "Continue in chat?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519038975, "post_id": 48776005, "comment_id": 84732962, "body": "yes, can you re-join ? did you see my update ? did you try to zip the folder I sent <a href=\"https://drive.google.com/open?id=1IWnOKHktbHIUAmEQFMCHdkK3-4ClSkdI\" rel=\"nofollow noreferrer\">drive.google.com/open?id=1IWnOKHktbHIUAmEQFMCHdkK3-4ClSkdI</a>"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519047500, "post_id": 48776005, "comment_id": 84738071, "body": "HI Alex, can you chat ?"}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519059817, "post_id": 48776005, "comment_id": 84745485, "body": "@shopiaT see my third update. It was created as a result of chat conversation."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519062813, "post_id": 48776005, "comment_id": 84746962, "body": "HI Alex I&#39;ll check it in 20 min, I&#39;m currently on train"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519065760, "post_id": 48776005, "comment_id": 84748479, "body": "HI, I still getting the same error , did you check the artifacts and it look the same with <code>diff -y (unzip -l old.zip | psub) (unzip -l new.zip | psub)</code> ?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519065797, "post_id": 48776005, "comment_id": 84748497, "body": "can you share also the whole code that I can test it on my end, just to verify that I dont miss anything..."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519113221, "post_id": 48776005, "comment_id": 84764469, "body": "Hi Alex, can we chat shortly"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519118125, "post_id": 48776005, "comment_id": 84767183, "body": "HI alex can you assist?"}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1519126872, "post_id": 48776005, "comment_id": 84773355, "body": "See my answer in the chat."}], "tags": [], "owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "is_accepted": true, "score": 2, "last_activity_date": 1519059689, "last_edit_date": 1519059689, "creation_date": 1518557599, "answer_id": 48776005, "question_id": 48650422, "link": "https://stackoverflow.com/questions/48650422/golang-create-maybe-corrupted-file/48776005#48776005", "title": "Golang create maybe corrupted file", "body": "<p>The problem is the same discussed <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/0iae5Ng-I-0\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!topic/golang-nuts/0iae5Ng-I-0</a> and depends on ZIP64 format, which used Go archive/go.</p>\n\n<p>An answer recommended using a Go wrapper for Java's ZipInputStream <a href=\"https://github.com/30x/zipper\" rel=\"nofollow noreferrer\">https://github.com/30x/zipper</a>.</p>\n\n<p><strong>Updated:</strong>\nFirst, call </p>\n\n<pre><code>go get github.com/30x/zipper\n</code></pre>\n\n<p>to load zipper package.</p>\n\n<p>Then try to use this version of your Zipit function to check a solution:</p>\n\n<pre><code>import \"github.com/30x/zipper\"\n......\nfunc Zipit(params ...string) error {\n    return zipper.Archive(params[0], params[1], zipper.Options{\n        ExcludeBaseDir: false, // or true \n    })\n}\n</code></pre>\n\n<p>Or try to fix archive created your Zipit function (as in the question) to make it ZipInputStream compatible. Call the zipper.Process function next your Zipit version function call in your project:</p>\n\n<pre><code>archiveName := \"archive.zip\" // example code, using yours\n\nerr := Zipit(tmpDirPath, archiveName)\nif err!=nil {\n    return err\n}\nerr := zipper.Process(archiveName, archiveName)\nif err!=nil {\n    return err\n}\n</code></pre>\n\n<p><strong>Second version</strong> to fix an archive - using zip with an option -F:</p>\n\n<pre><code>archiveName := \"ui5.pre.zip\" \nfixedArchiveName := \"ui5.zip\" \n\nif err := Zipit(\"ui5\", archiveName); err != nil { \n    fmt.Println(err) \n} \n\nif err := exec.Command(\"zip\", \"-F\", archiveName, \"--out\", fixedArchiveName).Run(); err != nil { \n    fmt.Println(err) \n} \n</code></pre>\n\n<hr>\n\n<p><strong>The result</strong> of the chat conversation.\nThe problem is placed in two parts in your code.</p>\n\n<p><strong>First part</strong> depends on file info of archive item. Path has to be as a relative, but not absolute. File info header name needs to trim '/' in prefix.</p>\n\n<p>Two piece of code needs to fix.</p>\n\n<p>First:</p>\n\n<pre><code>var baseDir string\nif info.IsDir(); len(params) &gt; 2 {\n    baseDir = params[2]\n} else {\n    baseDir = filepath.Base(params[0])\n}\n// add the line:\nif len(baseDir)&gt;0 {\n    baseDir += \"/\" // add a suffix to trim it in a file name\n}\n</code></pre>\n\n<p>Second:</p>\n\n<pre><code>if baseDir != \"\" {\n    header.Name = filepath.Join(strings.TrimPrefix(path, baseDir)) // using baseDir to trim but not params[0]\n}\n</code></pre>\n\n<p><strong>Second part</strong> depends on directories added to an archive.</p>\n\n<p>Skip directories at all while building an archive to get the same result as your Java tools.</p>\n\n<pre><code>filepath.Walk(params[0], func(path string, info os.FileInfo, err error) error {\n    if err != nil {\n        return err\n    }\n    // move up this piece of code\n    if info.IsDir() {\n        return nil\n    }\n\n    header, err := zip.FileInfoHeader(info)\n    if err != nil {\n        return err\n    }\n\n    if baseDir != \"\" {\n        header.Name = filepath.Join(strings.TrimPrefix(path, baseDir))\n    }\n\n    // simplify code - just define a method \n    //if info.IsDir() {\n    //  header.Name += \"/\"\n    //} else {\n    header.Method = zip.Deflate\n    //}\n\n    writer, err := archive.CreateHeader(header)\n    if err != nil {\n        return err\n    }\n    // too late - directory is already in the archive\n    //if info.IsDir() {\n    //  return nil\n    //}\n</code></pre>\n"}], "owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1080, "favorite_count": 2, "accepted_answer_id": 48776005, "answer_count": 2, "score": -2, "last_activity_date": 1519070508, "creation_date": 1517944799, "last_edit_date": 1519070508, "question_id": 48650422, "link": "https://stackoverflow.com/questions/48650422/golang-create-maybe-corrupted-file", "title": "Golang create maybe corrupted file", "body": "<p>I use the following code which writes YAML content to a file,\nwe have an old tool in java that do exactly the same and now we are building <strong>new tool</strong> which will do the <strong>same</strong> in Golang.</p>\n\n<p>To create a file with the content I use</p>\n\n<pre><code>err := ioutil.WriteFile(tmpDirPath, fileContent, 0777)\n</code></pre>\n\n<p>I don't get any error from this process</p>\n\n<p>I was able to see the <strong>file content and it looks OK</strong> (exactly like the file that was created in the old tool) We have an internal tool which failed to read the file. The error is: </p>\n\n<blockquote>\n  <p>Error while retrieving archive entry</p>\n</blockquote>\n\n<p>I check the content (with file diff) and I see that it exactly the same (from the java and Go tools), I'm really Frustrated :( because I don't know how to proceed, maybe the file is corrupted.\nI've also tried with <code>file.Mode = 0644</code> and it doesn't help.</p>\n\n<pre><code>I've Mac and if I can run some checks with command line or other tool to see the diffrent  between the files or maybe between the zip's, (which is created by the old and the new tool) please let me know what to do ...\n</code></pre>\n\n<p>Btw, after I've created the files, I'm, zipping the files and provide it to the internal tool to use it.</p>\n\n<p>If the zip code it needs and can help to identify the problem I can share it also if needed</p>\n\n<p>To create the dir that the file is inside I use</p>\n\n<pre><code>func CreateDirIfNotExist(dir string) {\n    if _, err := os.Stat(dir); os.IsNotExist(err) {\n        err := os.MkdirAll(dir, 0777)\n        if err != nil {\n            panic(err)\n        }\n    }\n}\n</code></pre>\n\n<p>To zip all content I use after I finish processing:</p>\n\n<pre><code>func Zipit(params ...string) error {\n    zipfile, err := os.Create(params[1])\n    if err != nil {\n        return err\n    }\n    defer zipfile.Close()\n\n    archive := zip.NewWriter(zipfile)\n    defer archive.Close()\n\n    info, err := os.Stat(params[0])\n    if err != nil {\n        return nil\n    }\n\n    var baseDir string\n    if info.IsDir(); len(params) &gt; 2 {\n        baseDir = params[2]\n    } else {\n        baseDir = filepath.Base(params[0])\n\n    }\n\n    filepath.Walk(params[0], func(path string, info os.FileInfo, err error) error {\n        if err != nil {\n            return err\n        }\n\n        header, err := zip.FileInfoHeader(info)\n        if err != nil {\n            return err\n        }\n\n        if baseDir != \"\" {\n            header.Name = filepath.Join(strings.TrimPrefix(path, params[0]))\n        }\n\n        if info.IsDir() {\n            header.Name += \"/\"\n        } else {\n            header.Method = zip.Deflate\n        }\n\n        writer, err := archive.CreateHeader(header)\n        if err != nil {\n            return err\n        }\n\n        if info.IsDir() {\n            return nil\n        }\n\n        file, err := os.Open(path)\n        if err != nil {\n            return err\n        }\n        defer file.Close()\n        _, err = io.Copy(writer, file)\n        return err\n    })\n\n    return err\n}\n</code></pre>\n\n<p><strong>update</strong></p>\n\n<p>I've this folder in my <strong>MAC</strong></p>\n\n<p>I need to build it on go that I will able to uzip it on mac without errors,\nI've tried two tools and I get different errors.</p>\n\n<p>I use the code above to zip the content of it, I know that in the command line there is no error when unzip but our tool cannot read it...\nwhat am I doing wrong with the zip code ? (I need it without the base dir compression )</p>\n\n<p><strong>some errors is:</strong> with the mac default archive tool and other tool</p>\n\n<p><a href=\"https://i.stack.imgur.com/dbvvO.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/dbvvO.jpg\" alt=\"enter image description here\"></a> </p>\n\n<p>[![enter image description here][2]][2]</p>\n\n<p><strong>UPDATE 2</strong> </p>\n\n<p>As requested this is <strong>my whole program</strong> which zip the folder successfully after the process done but with the MAC tools it's not possible to unzip them, see the errors above with two diffrent utils, and this dont happen (with mac tools) for other zip files...</p>\n\n<pre><code>package main\n\nimport (\n    \"archive/zip\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n    \"path/filepath\"\n    \"strings\"\n    \"bufio\"\n    \"unicode/utf8\"\n)\n\nfunc Zipit(params ...string) error {\n    zipfile, err := os.Create(params[1])\n    if err != nil {\n        return err\n    }\n    defer zipfile.Close()\n\n    archive := zip.NewWriter(zipfile)\n    defer archive.Close()\n\n    info, err := os.Stat(params[0])\n    if err != nil {\n        return err\n    }\n\n    var baseDir string\n    if info.IsDir(); len(params) &gt; 2 {\n        baseDir = params[2]\n    } else {\n        baseDir = filepath.Base(params[0])\n    }\n\n    filepath.Walk(params[0], func(path string, info os.FileInfo, err error) error {\n        if err != nil {\n            return err\n        }\n\n        header, err := zip.FileInfoHeader(info)\n        if err != nil {\n            return err\n        }\n\n        fmt.Printf(\"header: %#v\\n\", header)\n\n        if baseDir != \"\" {\n            header.Name = filepath.Join(strings.TrimPrefix(path, params[0]))\n        }\n\n        if info.IsDir() {\n            header.Name += \"/\"\n        } else {\n            header.Method = zip.Deflate\n        }\n\n        writer, err := archive.CreateHeader(header)\n        if err != nil {\n            return err\n        }\n\n        if info.IsDir() {\n            return nil\n        }\n\n        file, err := os.Open(path)\n        if err != nil {\n            return err\n        }\n        defer file.Close()\n        _, err = io.Copy(writer, file)\n        return err\n    })\n\n    return err\n}\n\nfunc CreateDirIfNotExist(dir string) {\n    if _, err := os.Stat(dir); os.IsNotExist(err) {\n        err := os.MkdirAll(dir, 0777)\n        if err != nil {\n            panic(err)\n        }\n    }\n}\n\nfunc main() {\n    archiveName := \"ui5.pre.zip\"\n    fixedArchiveName := \"ui5.zip\"\n\n    cmdParams := [][]string{\n        {\"./ui5\", \"npm\", \"install\"},\n    }\n\n    for _, cp := range cmdParams {\n        log.Printf(\"[INFO] - Starting %s in folder %s...\", cp[1:], cp[0])\n        cmd := exec.Command(cp[1], cp[2:]...)\n        cmd.Dir = cp[0]\n        // Wait to finish, get output:\n\n        stdout, err := cmd.StdoutPipe()\n        if err != nil {\n            log.Panic(\"%s cmd.StdoutPipe() error: %v\\n\", cp[1:], err)\n\n        }\n\n        // Start command:\n        cmd.Start()\n\n        // Stream the execution of the current command\n        scanner := bufio.NewScanner(stdout)\n        scanner.Split(bufio.ScanRunes)\n        oneRune := make([]byte, utf8.UTFMax)\n        for {\n            count, err := stdout.Read(oneRune)\n            if err != nil {\n                break\n            }\n            fmt.Printf(\"%s\", oneRune[:count])\n        }\n        log.Println()\n\n        // Get execution success or failure:\n        if err := cmd.Wait(); err != nil {\n            log.Panic(\"Error running %s: %v\\n\", cp[1:], err)\n\n        }\n        log.Println(\"Finished %s\", cp[1:])\n\n    }\n\n    if err := Zipit(\"ui5\", \"ui5.pre.zip\"); err != nil {\n        fmt.Println(err)\n    }\n\n    if err := exec.Command(\"zip\", \"-F\", archiveName, \"--out\", \"./\"+fixedArchiveName).Run(); err != nil {\n        fmt.Println(err)\n    }\n\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1517942419, "post_id": 48649718, "comment_id": 84297197, "body": "&quot;Other than the differences&quot; -- the superficial difference is all there is. <a href=\"https://github.com/golang/go/blob/23e8e197b0cd40312d96dd7576a44796f65dfb50/src/net/http/server.go#L2367\" rel=\"nofollow noreferrer\">The <code>ServeMux</code> calls <code>Handle</code> on both</a>"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1517942430, "post_id": 48649718, "comment_id": 84297208, "body": "There&#39;s <i>a lot</i> of online material -- blog posts, etc. -- about net/http and these functions.  Not to mention stackoverflow questions that are nearly identical to the one you just asked, e.g. <a href=\"https://stackoverflow.com/questions/21957455/difference-between-http-handle-and-http-handlefunc\" title=\"difference between http handle and http handlefunc\">stackoverflow.com/questions/21957455/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 7, "last_activity_date": 1517942212, "creation_date": 1517942212, "answer_id": 48649731, "question_id": 48649718, "link": "https://stackoverflow.com/questions/48649718/what-is-the-difference-between-handle-and-handlefunc/48649731#48649731", "title": "What is the difference between Handle and HandleFunc?", "body": "<p>You'd use whichever one fits your handler implementation. If you've implemented your handler as a function, you'd use <code>HandleFunc</code>; if you've implemented it as a type with a <code>ServeHTTP</code> method, you'd use <code>Handle</code>.</p>\n"}], "owner": {"reputation": 3699, "user_id": 4816175, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/697df6176ef55a7ea25f159e0fcdec38?s=128&d=identicon&r=PG", "display_name": "cool breeze", "link": "https://stackoverflow.com/users/4816175/cool-breeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 869, "favorite_count": 0, "closed_date": 1517942643, "answer_count": 1, "score": -2, "last_activity_date": 1517942212, "creation_date": 1517942145, "question_id": 48649718, "link": "https://stackoverflow.com/questions/48649718/what-is-the-difference-between-handle-and-handlefunc", "closed_reason": "Duplicate", "title": "What is the difference between Handle and HandleFunc?", "body": "<p>I'm trying to understand the differences between Handle and HandleFunc.</p>\n\n<p>Other than the differences, when would you use one over the other when building a Go web app?</p>\n\n<p><a href=\"https://golang.org/pkg/net/http/#Handle\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Handle</a></p>\n"}, {"tags": ["pointers", "dictionary", "go"], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1517936062, "post_id": 48648081, "comment_id": 84293720, "body": "Copying the id is not needed and use a underscore in variable is adviced against in Go. And I think you should mention why one should do this."}], "tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": false, "score": 6, "last_activity_date": 1517938638, "last_edit_date": 1517938638, "creation_date": 1517935934, "answer_id": 48648081, "question_id": 48648000, "link": "https://stackoverflow.com/questions/48648000/how-to-assign-a-pointer-to-a-go-map/48648081#48648081", "title": "How to assign a pointer to a Go map", "body": "<p>When you are putting <code>&amp;v</code> into <code>c.Collections[v.ID]</code>, you are actually assigning same address of loop variable <code>v</code>.</p>\n\n<p>This address finally holds the last value of your list. That's why you are getting <code>bb Test B</code> for all key.</p>\n\n<p>Print these value and you will see same address.</p>\n\n<pre><code>fmt.Printf(\"%p\\n\", c.Collections[\"aa\"])\nfmt.Printf(\"%p\\n\", c.Collections[\"bb\"])\n</code></pre>\n\n<p>And by copying it to a new variable in the loop scope, the issue is solved. Each step in the loop you will put a new and unique address into the cache.</p>\n\n<pre><code>for k, v := range cols.Collections {\n    coll := v\n    c.Collections[v.ID] = &amp;coll\n    fmt.Println(\"DEBUG k\", k)\n    fmt.Println(\"DEBUG v\", v)\n    i++\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517939902, "post_id": 48648209, "comment_id": 84295944, "body": "There is a difference between taking address of a copied value and of the one stored in the slice: will the map&#39;s value change if the slice value change? Though it is not specified by OP, I think it makes better sense to make two independent of each other."}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517943450, "post_id": 48648209, "comment_id": 84297715, "body": "The matter os usage. Storing addresses of the same objects is important for the two collections as indexes to access one."}], "tags": [], "owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "is_accepted": false, "score": 0, "last_activity_date": 1517939466, "last_edit_date": 1517939466, "creation_date": 1517936408, "answer_id": 48648209, "question_id": 48648000, "link": "https://stackoverflow.com/questions/48648000/how-to-assign-a-pointer-to-a-go-map/48648209#48648209", "title": "How to assign a pointer to a Go map", "body": "<p>The answer about same pointer is a map contains the address of a variable v, but not array items.</p>\n\n<pre><code>for k, v := range cols.Collections {\n   ......\n   c.Collections[v.ID] = &amp;v\n</code></pre>\n\n<p>A right solution is storing a pointer to array, but not a value.</p>\n\n<pre><code>type collections struct {\n     Collections []*collection\n}\n\ncols.Collections = append(cols.Collections, &amp;col1)\ncols.Collections = append(cols.Collections, &amp;col2)\n</code></pre>\n\n<p>Or get address of map item (as the answer higher)</p>\n\n<pre><code>for k, v := range cols.Collections {\n    c.Index = i\n    p := &amp;cols.Collections[k]\n    c.Collections[v.ID] = p\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 2, "creation_date": 1517939789, "post_id": 48649011, "comment_id": 84295873, "body": "In Go, taking address to a local variable is perfectly fine. Go compiler deals with that by let the variable &quot;escape&quot; to the heap."}, {"owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "edited": false, "score": 0, "creation_date": 1517943885, "post_id": 48649011, "comment_id": 84297994, "body": "Getting the address of a local variable is normal.  But very often this is the cause of the error (closures, several collection, etc.), especcially unexpected suprice with bytes slices as a properties.  Second, using two or more copy of objects is a case of heavy usage memory and performance.  For this example, IMHO, there is an error for the case of two or more collections as indexes."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517944157, "post_id": 48649011, "comment_id": 84298149, "body": "Your solution is another use case scenario.  What if OP wants to separate <code>slice</code> and <code>map</code>. You can explain pros and cons. But its not wise to say that my solution has an error."}], "tags": [], "owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "is_accepted": true, "score": 3, "last_activity_date": 1517939274, "creation_date": 1517939274, "answer_id": 48649011, "question_id": 48648000, "link": "https://stackoverflow.com/questions/48648000/how-to-assign-a-pointer-to-a-go-map/48649011#48649011", "title": "How to assign a pointer to a Go map", "body": "<p>Unfortunately, the code in the first answer has an error - a pointer to a local variable coll:</p>\n\n<pre><code>for k, v := range cols.Collections {\n    coll := v\n    c.Collections[v.ID] = &amp;coll\n</code></pre>\n\n<p>Just try to change a property value of a collection:</p>\n\n<pre><code>cols.Collections[0].Name = \"Text C\"\nfmt.Println(\"Collection 1\", cols.Collections[0].Name)\nfmt.Println(\"Collection 1\", c.Collections[\"aa\"].Name)\n//  Collection 1 Text C\n//  Collection 1 Text A\n</code></pre>\n\n<p>But the another code will print an expected result:</p>\n\n<pre><code>for k, v := range cols.Collections {\n    c.Index = i\n    p := &amp;cols.Collections[k]\n    c.Collections[v.ID] = p\n\n....\ncols.Collections[0].Name = \"Text C\"\nfmt.Println(\"Collection 1\", cols.Collections[0].Name)\nfmt.Println(\"Collection 1\", c.Collections[\"aa\"].Name)\n// Collection 1 Text C\n// Collection 1 Text C\n</code></pre>\n"}], "owner": {"reputation": 740, "user_id": 4488456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4146daa51bdb93084db63bbf9b5d5c43?s=128&d=identicon&r=PG", "display_name": "jordan2175", "link": "https://stackoverflow.com/users/4488456/jordan2175"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 849, "favorite_count": 0, "accepted_answer_id": 48649011, "answer_count": 3, "score": 2, "last_activity_date": 1517941247, "creation_date": 1517935643, "last_edit_date": 1517941247, "question_id": 48648000, "link": "https://stackoverflow.com/questions/48648000/how-to-assign-a-pointer-to-a-go-map", "title": "How to assign a pointer to a Go map", "body": "<p>I am having problems assigning a pointer to a map.  Maybe this is a bug in Go? Or maybe I am just doing something wrong. The code is here on the playground as well, <a href=\"https://play.golang.org/p/p0NosPtkptz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/p0NosPtkptz</a></p>\n\n<p>Here is some super simplified code that illustrates the problem.  I am creating an object called collections that has two collection objects in it. I am then looping through those collections and assigning them to a map where the key in the map is the collection ID.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype collection struct {\n    ID string\n    Name string\n}\n\ntype collections struct {\n    Collections []collection\n}\n\ntype cache struct {\n    Index int\n    Collections map[string]*collection\n}\n\nfunc main() {\n    var c cache\n    c.Collections = make(map[string]*collection)\n\n    // Create 2 Collections\n    var col1, col2 collection\n    col1.ID = \"aa\"\n    col1.Name = \"Text A\"\n    col2.ID = \"bb\"\n    col2.Name = \"Test B\"\n\n    // Add to Collections\n    var cols collections\n    cols.Collections = append(cols.Collections, col1)\n    cols.Collections = append(cols.Collections, col2)\n    fmt.Println(\"DEBUG Collections Type\", cols)\n\n    i := 0\n    for k, v := range cols.Collections {\n        c.Index = i\n        c.Collections[v.ID] = &amp;v\n        fmt.Println(\"DEBUG k\", k)\n        fmt.Println(\"DEBUG v\", v)\n        i++\n    }\n    fmt.Println(\"Collection 1\", c.Collections[\"aa\"].ID)\n    fmt.Println(\"Collection 2\", c.Collections[\"bb\"].ID)\n    fmt.Println(c)\n}\n</code></pre>\n\n<p>The output from this playground code looks like:</p>\n\n<pre><code>DEBUG Collections Type {[{aa Text A} {bb Test B}]}\nDEBUG k 0\nDEBUG v {aa Text A}\nDEBUG k 1\nDEBUG v {bb Test B}\nCollection 1 bb\nCollection 2 bb\n{1 map[aa:0x1040a0f0 bb:0x1040a0f0]}\n</code></pre>\n\n<p>So it seems like the map is for some reason getting the same pointer for each entry. All of the \"DEBUG\" lines print out what I would expect. However, the three print lines at the very end, do not.  Collection 1 should be \"aa\" not \"bb\".</p>\n"}, {"tags": ["go", "ffmpeg", "google-cloud-platform", "google-speech-api"], "answers": [{"comments": [{"owner": {"reputation": 3270, "user_id": 862410, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9945fb55767debfe2e7a4267a2e16bdc?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/862410/josh"}, "edited": false, "score": 0, "creation_date": 1518695866, "post_id": 48793772, "comment_id": 84616074, "body": "So the stdout Buffer has a mutex which locks when reading and writing. Good instinct that this would be losing data but when I assemble the video there is no data lost. That is, the video is complete with no jitters or missing portions. The reason I have 2 services is that I expect more things will need to consume the transcoded data in the future. Seems crazy to transcode for each use case. Seemed sensible to do it once and allow subscribers to take the results for their own ends. Thanks for the answer though, nice to have other eyes on it."}], "tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": false, "score": 1, "last_activity_date": 1518632280, "creation_date": 1518632280, "answer_id": 48793772, "question_id": 48647680, "link": "https://stackoverflow.com/questions/48647680/google-speech-api-go-transcribing-audio-stream-of-unknown-length/48793772#48793772", "title": "Google Speech API + Go - Transcribing Audio Stream of Unknown Length", "body": "<p>I think you are right that splitting the text into chunks causes many words to be chopped off.</p>\n\n<p>I see another problem in the publishing. Between the calls <code>topic.Publish</code> and <code>stdout.Reset()</code> some time will pass and ffmpeg will probably have written some unpublished bytes to stdout, which will get cleared by the reset.</p>\n\n<p>I am afraid the architecture is not fitted for your problem. The constraint of the message size causes many problems. The idea of a PubSub system is that a publisher notifies subscribers of events, but not necessarily to hold a large payload.</p>\n\n<p>Do you really need two services? You could use two go routines to communicate via a channel. That would eliminate the pub sub system.</p>\n\n<p>A strategy would be to make the chunks as large as possible. A possible solution:</p>\n\n<ul>\n<li>Make the chunks as large as possible (nearly 60 seconds)</li>\n<li>Make the chunks overlap each other by a short time (e.g. 5 seconds)</li>\n<li>Programmatically detect the overlaps and remove them</li>\n</ul>\n"}], "owner": {"reputation": 3270, "user_id": 862410, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9945fb55767debfe2e7a4267a2e16bdc?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/862410/josh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 589, "favorite_count": 2, "answer_count": 1, "score": 5, "last_activity_date": 1518632280, "creation_date": 1517934719, "question_id": 48647680, "link": "https://stackoverflow.com/questions/48647680/google-speech-api-go-transcribing-audio-stream-of-unknown-length", "title": "Google Speech API + Go - Transcribing Audio Stream of Unknown Length", "body": "<p>I have an rtmp stream of a video call and I want to transcribe it. I have created 2 services in Go and I'm getting results but it's not very accurate and a lot of data seems to get lost.</p>\n\n<p>Let me explain. </p>\n\n<p>I have a <code>transcode</code> service, I use ffmpeg to transcode the video to Linear16 audio and place the output bytes onto a PubSub queue for a <code>transcribe</code> service to handle. Obviously there is a limit to the size of the PubSub message, and I want to start transcribing before the end of the video call. So, I chunk the transcoded data into 3 second clips (not fixed length, just seems about right) and put them onto the queue.</p>\n\n<p>The data is transcoded quite simply:</p>\n\n<pre><code>var stdout Buffer\n\ncmd := exec.Command(\"ffmpeg\", \"-i\", url, \"-f\", \"s16le\", \"-acodec\", \"pcm_s16le\", \"-ar\", \"16000\", \"-ac\", \"1\", \"-\")\ncmd.Stdout = &amp;stdout\n\nif err := cmd.Start(); err != nil {\n    log.Fatal(err)\n}\n\nticker := time.NewTicker(3 * time.Second)\n\nfor {\n    select {\n    case &lt;-ticker.C:\n        bytesConverted := stdout.Len()\n        log.Infof(\"Converted %d bytes\", bytesConverted)\n\n        // Send the data we converted, even if there are no bytes.\n        topic.Publish(ctx, &amp;pubsub.Message{\n            Data: stdout.Bytes(),\n        })\n\n        stdout.Reset()\n    }\n}\n</code></pre>\n\n<p>The <code>transcribe</code> service pulls messages from the queue at a rate of 1 every 3 seconds, helping to process the audio data at about the same rate as it's being created. There are limits on the Speech API stream, it can't be longer than 60 seconds so I stop the old stream and start a new one every 30 seconds so we never hit the limit, no matter how long the video call lasts for.</p>\n\n<p>This is how I'm transcribing it:</p>\n\n<pre><code>stream := prepareNewStream()\nclipLengthTicker := time.NewTicker(30 * time.Second)\nchunkLengthTicker := time.NewTicker(3 * time.Second)\n\ncctx, cancel := context.WithCancel(context.TODO())\nerr := subscription.Receive(cctx, func(ctx context.Context, msg *pubsub.Message) {\n\n    select {\n    case &lt;-clipLengthTicker.C:\n        log.Infof(\"Clip length reached.\")\n        log.Infof(\"Closing stream and starting over\")\n\n        err := stream.CloseSend()\n        if err != nil {\n            log.Fatalf(\"Could not close stream: %v\", err)\n        }\n\n        go getResult(stream)\n        stream = prepareNewStream()\n\n    case &lt;-chunkLengthTicker.C:\n        log.Infof(\"Chunk length reached.\")\n\n        bytesConverted := len(msg.Data)\n\n        log.Infof(\"Received %d bytes\\n\", bytesConverted)\n\n        if bytesConverted &gt; 0 {\n            if err := stream.Send(&amp;speechpb.StreamingRecognizeRequest{\n                StreamingRequest: &amp;speechpb.StreamingRecognizeRequest_AudioContent{\n                    AudioContent: transcodedChunk.Data,\n                },\n            }); err != nil {\n                resp, _ := stream.Recv()\n                log.Errorf(\"Could not send audio: %v\", resp.GetError())\n            }\n        }\n\n        msg.Ack()\n    }\n})\n</code></pre>\n\n<p>I think the problem is that my 3 second chunks don't necessarily line up with starts and end of phrases or sentences so I suspect that the Speech API is a recurrent neural network which has been trained on full sentences rather than individual words. So starting a clip in the middle of a sentence loses some data because it can't figure out the first few words up to the natural end of a phrase. Also, I lose some data in changing from an old stream to a new stream. There's some context lost. I guess overlapping clips might help with this.</p>\n\n<p>I have a couple of questions:</p>\n\n<p>1) Does this architecture seem appropriate for my constraints (unknown length of audio stream, etc.)?</p>\n\n<p>2) What can I do to improve accuracy and minimise lost data? </p>\n\n<p>(Note I've simplified the examples for readability. Point out if anything doesn't make sense because I've been heavy handed in cutting the examples down.) </p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 5185, "user_id": 679240, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c6c18851c01fa33057f636caea371047?s=128&d=identicon&r=PG", "display_name": "Haroldo_OK", "link": "https://stackoverflow.com/users/679240/haroldo-ok"}, "edited": false, "score": 0, "creation_date": 1517931363, "post_id": 48646580, "comment_id": 84290495, "body": "You will probably need to use big integers: <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow noreferrer\">golang.org/pkg/math/big</a>"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517931480, "post_id": 48646580, "comment_id": 84290574, "body": "cosume the string 8bits by 8 bits to form a byte (uint8)."}, {"owner": {"reputation": 3765, "user_id": 843443, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07748ad3a158dfc6aee92c9bbac06b90?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/843443/jeff"}, "edited": false, "score": 0, "creation_date": 1517931514, "post_id": 48646580, "comment_id": 84290593, "body": "I just clicked that link. I&#39;ll look at the sizes of those. And yes, I should do it byte by byte i suppose."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517932302, "post_id": 48646580, "comment_id": 84291079, "body": "Do you want each sequence of 8 bits to be stored as a byte, the whole number as something that can be used as a number, or one byte for each bit? Your sample code sounds like one big number, requiring <code>math&#47;big</code>"}, {"owner": {"reputation": 3765, "user_id": 843443, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07748ad3a158dfc6aee92c9bbac06b90?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/843443/jeff"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517932454, "post_id": 48646580, "comment_id": 84291180, "body": "Sorry @Marc, that was unclear. I am wanting an array of bytes."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517933717, "post_id": 48646580, "comment_id": 84291997, "body": "@Jeff: why do you expect it to be hex, when you&#39;re not formatting it as hex?"}, {"owner": {"reputation": 3765, "user_id": 843443, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07748ad3a158dfc6aee92c9bbac06b90?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/843443/jeff"}, "edited": false, "score": 0, "creation_date": 1517933881, "post_id": 48646580, "comment_id": 84292098, "body": "I am used to other languages representing a byte array as hex (python, i think?). I&#39;m new to golang."}], "answers": [{"comments": [{"owner": {"reputation": 3765, "user_id": 843443, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07748ad3a158dfc6aee92c9bbac06b90?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/843443/jeff"}, "edited": false, "score": 0, "creation_date": 1517933156, "post_id": 48647052, "comment_id": 84291635, "body": "Your answer got me the same (except I just wanted my byte array to be a bit larger)."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 3765, "user_id": 843443, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07748ad3a158dfc6aee92c9bbac06b90?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/843443/jeff"}, "edited": false, "score": 0, "creation_date": 1517934875, "post_id": 48647052, "comment_id": 84292876, "body": "@Jeff waht do you mean by larger?"}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 1, "last_activity_date": 1517932748, "creation_date": 1517932748, "answer_id": 48647052, "question_id": 48646580, "link": "https://stackoverflow.com/questions/48646580/convert-a-bitstring-into-a-byte-array/48647052#48647052", "title": "Convert a bitstring into a byte array", "body": "<p>I think in case of this very specified tasks, it is good to construct the array just by hands.</p>\n\n<pre><code>func main() {\n    /* goal: convert a bit string (ex \"10110110\") to a byte array */\n    bitString := \"00000000000000000000000100111000100001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000011\"\n\n    lenB := len(bitString) / 8 + 1\n    bs:=make([]byte,lenB)\n\n    count,i := 0,0\n    var now byte\n    for _,v:=range bitString {\n        if count == 8 {\n            bs[i]=now\n            i++\n            now,count = 0,0\n        }\n        now = now &lt;&lt; 1 + byte(v-'0')\n        count++\n    }\n    if count!=0 {\n        bs[i]=now &lt;&lt; (8-byte(count))\n        i++\n    }\n\n    bs=bs[:i:i]\n    fmt.Println(bs)\n\n}\n</code></pre>\n\n<p>The code uses a <code>count</code> to count the numbers of digit consumed since last \"flush\" and \"flush\" when there is 8. variable <code>i</code> keeps info on the bytes area and after the loop there might be a final flush.</p>\n\n<p><code>byte(v-'0')</code> is the converting from rune to a bit.</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/eB1mc_FjiQc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/eB1mc_FjiQc</a></p>\n"}, {"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517936172, "post_id": 48647614, "comment_id": 84293787, "body": "The most overhead is in <code>strconv.ParseUint</code>. Not memory allocation."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517965321, "post_id": 48647614, "comment_id": 84306841, "body": "@leafbebop fair enough... but that&#39;s what pprof is for :)."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517965378, "post_id": 48647614, "comment_id": 84306862, "body": "And that is auctually what pprof told me before (I can&#39;t find the exact code but basically the same)."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 2, "last_activity_date": 1517934556, "creation_date": 1517934556, "answer_id": 48647614, "question_id": 48646580, "link": "https://stackoverflow.com/questions/48646580/convert-a-bitstring-into-a-byte-array/48647614#48647614", "title": "Convert a bitstring into a byte array", "body": "<p>I would opt for making a new type, butString, with methods for converting to a []byte and []string (for hex if you like).  This should also guard against an input string not evenly divisible by 8.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/hex\"\n    \"fmt\"\n    \"strconv\"\n)\n\ntype bitString string\n\nfunc (b bitString) AsByteSlice() []byte {\n    var out []byte\n    var str string\n\n    for i := len(b); i &gt; 0; i -= 8 {\n        if i-8 &lt; 0 {\n            str = string(b[0:i])\n        } else {\n            str = string(b[i-8 : i])\n        }\n        v, err := strconv.ParseUint(str, 2, 8)\n        if err != nil {\n            panic(err)\n        }\n        out = append([]byte{byte(v)}, out...)\n    }\n    return out\n}\n\nfunc (b bitString) AsHexSlice() []string {\n    var out []string\n    byteSlice := b.AsByteSlice()\n    for _, b := range byteSlice {\n        out = append(out, \"0x\" + hex.EncodeToString([]byte{b}))\n    }\n    return out\n}\n\nfunc main() {\n    x := bitString(\"00000000000000000000000100111000100001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000011\")\n    fmt.Println(x.AsByteSlice())\n    fmt.Println(x.AsHexSlice())\n}\n</code></pre>\n\n<p><strong>OUTPUT</strong></p>\n\n<pre><code>[64 0 1 56 134 0 0 0 0 0 0 0 0 0 0 3]\n[0x00 0x00 0x01 0x38 0x86 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03]\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Lp9edSDAoA2\" rel=\"nofollow noreferrer\">Playgroud</a></p>\n\n<p>If speed is a concern, then optimization can be achieved by allocating the slice with the appropriate capacity and tracking the index yourself.</p>\n"}, {"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1517940410, "post_id": 48648849, "comment_id": 84296233, "body": "What about <code>b[i &gt;&gt; 3] |= byte((r-&#39;0&#39;) &lt;&lt; uint(7-i&amp;7)</code>?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517943288, "post_id": 48648849, "comment_id": 84297631, "body": "Makes sense. I was under impression that <code>%</code> is slow. That is not for Go, it seems."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517960107, "post_id": 48648849, "comment_id": 84305413, "body": "Thanks for the code, I would like to have more discussion later when I am not on mobile, but I think it is too off topic."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1517961876, "last_edit_date": 1517961876, "creation_date": 1517938651, "answer_id": 48648849, "question_id": 48646580, "link": "https://stackoverflow.com/questions/48646580/convert-a-bitstring-into-a-byte-array/48648849#48648849", "title": "Convert a bitstring into a byte array", "body": "<p>Here is a simple solution.</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n)\n\nvar ErrRange = errors.New(\"value out of range\")\n\nfunc bitStringToBytes(s string) ([]byte, error) {\n    b := make([]byte, (len(s)+(8-1))/8)\n    for i := 0; i &lt; len(s); i++ {\n        c := s[i]\n        if c &lt; '0' || c &gt; '1' {\n            return nil, ErrRange\n        }\n        b[i&gt;&gt;3] |= (c - '0') &lt;&lt; uint(7-i&amp;7)\n    }\n    return b, nil\n}\n\nfunc main() {\n    s := \"00000000000000000000000100111000100001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000011\"\n    b, err := bitStringToBytes(s)\n    if err != nil {\n        fmt.Println(s, err)\n    }\n    fmt.Println(b)\n    fmt.Printf(\"%b\\n\", b)\n    fmt.Printf(\"%x\\n\", b)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Ils1gzkY4Dg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Ils1gzkY4Dg</a></p>\n\n<p>Output:</p>\n\n<pre><code>[0 0 1 56 134 0 0 0 0 0 0 0 0 0 0 3]\n[0 0 1 111000 10000110 0 0 0 0 0 0 0 0 0 0 11]\n00000138860000000000000000000003\n</code></pre>\n\n<p>Note: Updated with <a href=\"https://stackoverflow.com/users/9143962/leaf-bebop\">@leaf bebop</a>'s optimization.</p>\n"}], "owner": {"reputation": 3765, "user_id": 843443, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07748ad3a158dfc6aee92c9bbac06b90?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/843443/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1675, "favorite_count": 1, "accepted_answer_id": 48647614, "answer_count": 3, "score": 0, "last_activity_date": 1517961876, "creation_date": 1517931202, "last_edit_date": 1517936073, "question_id": 48646580, "link": "https://stackoverflow.com/questions/48646580/convert-a-bitstring-into-a-byte-array", "title": "Convert a bitstring into a byte array", "body": "<p>I can't seem to convert a bit string of 1s and 0s to a byte array.</p>\n\n<p>Here is the code I have so far:</p>\n\n<pre><code>package main\n\nimport (\n    \"strconv\"\n    \"encoding/binary\"\n    \"fmt\"\n)\n\nfunc main() {\n    /* goal: convert a bit string (ex \"10110110\") to a byte array */\n    bitString := \"00000000000000000000000100111000100001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000011\"\n\n    bitNum, err := strconv.ParseUint(bitString, 2, 128) // turn my 128-bit bitstring into an int\n\n    if err != nil {\n        panic(err) // currently panics with \"value out of range\"\n    }\n\n    // convert my integer to a byte array\n    // code from https://stackoverflow.com/questions/16888357/convert-an-integer-to-a-byte-array\n    bs := make([]byte, 128)                   // allocate memory for my byte array\n    binary.LittleEndian.PutUint64(bs, bitNum) // convert my bitnum to a byte array\n    fmt.Println(bs)\n\n}\n</code></pre>\n\n<p>I am clearly missing something, but I can't seem to convert a bit string of that size to a byte array.</p>\n\n<p><strong>edit</strong> I got passed the first error with this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    /* goal: convert a bit string (ex \"10110110\") to a byte array */\n    bitString := \"00000000000000000000000100111000100001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000011\"\n\n    myBytes := make([]byte, 16)\n    for len(bitString) &gt; 7 {\n        currentByteStr := bitString[:8]\n        bitString = bitString[8:]\n        currentByteInt, _ := strconv.ParseUint(currentByteStr, 2, 8)\n        currentByte := byte(currentByteInt)\n        myBytes = append(myBytes, currentByte)\n    }\n\n    fmt.Println(myBytes)\n\n}\n</code></pre>\n\n<p>but it doesn't output what I would expect a byte array to look like:</p>\n\n<pre><code>[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 56 134 0 0 0 0 0 0 0 0 0 0 3]\n</code></pre>\n\n<p>I would have expected it to be hex? is that not what a byte array looks like in golang?</p>\n"}, {"tags": ["mongodb", "go", "bson", "gridfs"], "answers": [{"comments": [{"owner": {"reputation": 235, "user_id": 5951039, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/kk1ZP.jpg?s=128&g=1", "display_name": "Kiran Suvarna", "link": "https://stackoverflow.com/users/5951039/kiran-suvarna"}, "edited": false, "score": 0, "creation_date": 1517927863, "post_id": 48645157, "comment_id": 84287925, "body": "I replaced bson.M{} with ID, and its still giving &quot;not found&quot; error. The snippet, <code>videoIDHex := bson.ObjectIdHex(&quot;5966e9ca0531713218127ddd&quot;)</code>  <code>file, err := mongoDatabase.GridFS(&quot;collection_files&quot;).OpenId(videoIDHex)</code>"}, {"owner": {"reputation": 235, "user_id": 5951039, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/kk1ZP.jpg?s=128&g=1", "display_name": "Kiran Suvarna", "link": "https://stackoverflow.com/users/5951039/kiran-suvarna"}, "edited": false, "score": 0, "creation_date": 1517931032, "post_id": 48645157, "comment_id": 84290266, "body": "changing the collection name really worked! Actually, my collection name is &quot;videos&quot;, but I was using &quot;video.files&quot;. Changing from &quot;videos.files&quot; to &quot;videos&quot; worked for me. Thank you."}], "tags": [], "owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "is_accepted": true, "score": 2, "last_activity_date": 1517928929, "last_edit_date": 1517928929, "creation_date": 1517926795, "answer_id": 48645157, "question_id": 48644884, "link": "https://stackoverflow.com/questions/48644884/if-bson-objectid-is-passed-to-gridfs-openid-in-golang-im-getting-error-not/48645157#48645157", "title": "If bson ObjectId is passed to GridFS OpenId() in golang, i&#39;m getting error &quot;not found&quot;", "body": "<p>It's just <code>id</code>:</p>\n\n<pre><code>.OpenId(videoIDHex)\n</code></pre>\n\n<p>not </p>\n\n<pre><code>.OpenId(bson.M{\"_id\": videoIDHex})\n</code></pre>\n\n<p><code>OpenId</code> wraps the parameter into <code>bson.M</code> by itself:\n<a href=\"https://github.com/go-mgo/mgo/blob/9a2573d4ae52a2bf9f5b7900a50e2f8bcceeb774/gridfs.go#L197\" rel=\"nofollow noreferrer\">https://github.com/go-mgo/mgo/blob/9a2573d4ae52a2bf9f5b7900a50e2f8bcceeb774/gridfs.go#L197</a></p>\n\n<p>Also, collection names should follow the naming conventions. <code>GridFS()</code> accepts a prefix as a single parameter, which is used to build 2 collections: files and chunks: <a href=\"https://github.com/go-mgo/mgo/blob/9a2573d4ae52a2bf9f5b7900a50e2f8bcceeb774/gridfs.go#L100\" rel=\"nofollow noreferrer\">https://github.com/go-mgo/mgo/blob/9a2573d4ae52a2bf9f5b7900a50e2f8bcceeb774/gridfs.go#L100</a></p>\n\n<pre><code>mongoDatabase.GridFS(\"collection_files\")\n</code></pre>\n\n<p>search files in collection <code>collection_files.files</code></p>\n"}], "owner": {"reputation": 235, "user_id": 5951039, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/kk1ZP.jpg?s=128&g=1", "display_name": "Kiran Suvarna", "link": "https://stackoverflow.com/users/5951039/kiran-suvarna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 48645157, "answer_count": 1, "score": 0, "last_activity_date": 1517928929, "creation_date": 1517925827, "question_id": 48644884, "link": "https://stackoverflow.com/questions/48644884/if-bson-objectid-is-passed-to-gridfs-openid-in-golang-im-getting-error-not", "title": "If bson ObjectId is passed to GridFS OpenId() in golang, i&#39;m getting error &quot;not found&quot;", "body": "<p>I'm trying to read a video file from MongoDB using GridFS in GoLang. This is my code snippet, </p>\n\n<pre><code>    videoIDHex := bson.ObjectIdHex(\"5966e9ca0531713218127ddd\")\n    file, err := mongoDatabase.GridFS(\"collection_files\").OpenId(bson.M{\"_id\": videoIDHex})\n    if err != nil {\n        log.Println(\"Error finding the video : \", err)\n    }\n</code></pre>\n\n<p>When I ran it I always got the error,</p>\n\n<blockquote>\n  <p>not found</p>\n</blockquote>\n\n<p>But, when I tried using <strong><em>find</em></strong> it works fine. I can able to get the document by,</p>\n\n<pre><code>    videoIDHex := bson.ObjectIdHex(\"5966e9ca0531713218127ddd\")\n    collection := mongoDatabase.C(\"collection_files\")\n    var file interface{}\n    collection.Find(bson.M{\"_id\": videoIDHex}).One(&amp;file)\n    log.Println(\"file : \", file)\n</code></pre>\n\n<p>So, how can I solve the issue with GridFS OpenId? If it's solved, I can able to put the GridFS file to buffer and can finally stream it.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1517925340, "post_id": 48644694, "comment_id": 84286109, "body": "An <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a> isn&#39;t guaranteed to read any specific amount. That&#39;s why it returns the number of bytes read. You&#39;re also checking for <code>io.EOF</code> before checking <code>n</code>, which means you could lose data here. Read that linked documentation carefully."}, {"owner": {"reputation": 113, "user_id": 8807932, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9858abf46f35cb7cb47666ab28c4feb4?s=128&d=identicon&r=PG&f=1", "display_name": "MadsRC", "link": "https://stackoverflow.com/users/8807932/madsrc"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517928440, "post_id": 48644694, "comment_id": 84288413, "body": "Ah, I must have missed that part. I guess not mentioning anything about guaranteed amount of bytes read is the same as not guaranteeing it...  Thanks for pointing the part of checking <code>io.EOF</code> out before checking <code>n</code> - I&#39;ll make sure to do that in production (Code snippet is simply a small testcase I wrote, quickly)"}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 8807932, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9858abf46f35cb7cb47666ab28c4feb4?s=128&d=identicon&r=PG&f=1", "display_name": "MadsRC", "link": "https://stackoverflow.com/users/8807932/madsrc"}, "edited": false, "score": 0, "creation_date": 1517928291, "post_id": 48644833, "comment_id": 84288290, "body": "Looking at the documentation, it seems that <code>io.ReadFull</code> would solve my problem if I replaced <code>n, err = part.Read(buf)</code> with <code>n, err = io.ReadFull(part, buf)</code> - However, I&#39;m not aware wether or not <code>io.ReadFull</code> will, when wrapped in a for loop, read all the data in chunks of size X, or read the same chunk of size X over and over again?"}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 113, "user_id": 8807932, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9858abf46f35cb7cb47666ab28c4feb4?s=128&d=identicon&r=PG&f=1", "display_name": "MadsRC", "link": "https://stackoverflow.com/users/8807932/madsrc"}, "edited": false, "score": 0, "creation_date": 1517945580, "post_id": 48644833, "comment_id": 84298917, "body": "@MadsRC you can&#39;t &quot;read the same chunk over and over again&quot; without seeking (and even then, only if a stream is seekable, which a <code>multpart.Part</code> is not). Reading data always moves the read point forward."}], "tags": [], "owner": {"reputation": 3363, "user_id": 1148194, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/bb21b27fe43fac2f302cdf3bfc59a6e9?s=128&d=identicon&r=PG", "display_name": "Tiago Peczenyj", "link": "https://stackoverflow.com/users/1148194/tiago-peczenyj"}, "is_accepted": false, "score": 1, "last_activity_date": 1517925641, "creation_date": 1517925641, "answer_id": 48644833, "question_id": 48644694, "link": "https://stackoverflow.com/questions/48644694/reading-more-than-4096-bytes-per-chunk-with-part-read/48644833#48644833", "title": "Reading more than 4096 bytes per chunk with part.Read", "body": "<p>Instead change the chunk size, why not use <code>io.ReadFull</code> ?</p>\n\n<p><a href=\"https://golang.org/pkg/io/#ReadFull\" rel=\"nofollow noreferrer\">https://golang.org/pkg/io/#ReadFull</a></p>\n\n<p>This can manage the entire logic, and if can't read it will just return an error. </p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1517945361, "creation_date": 1517945361, "answer_id": 48650547, "question_id": 48644694, "link": "https://stackoverflow.com/questions/48644694/reading-more-than-4096-bytes-per-chunk-with-part-read/48650547#48650547", "title": "Reading more than 4096 bytes per chunk with part.Read", "body": "<p>The part reader does not attempt to fill the caller's buffer as allowed by the <a href=\"http://godoc.org/io#Reader\" rel=\"nofollow noreferrer\">io.Reader</a> contract.</p>\n\n<p>The best way to handle this depends on the requirements of the application.  </p>\n\n<p>If you want to slurp the part into memory, then use <a href=\"https://godoc.org/io/ioutil#ReadAll\" rel=\"nofollow noreferrer\">ioutil.ReadAll</a>:</p>\n\n<pre><code>for {\n    part, err := reader.NextPart()\n    if err == io.EOF {\n      break\n    }\n    if err != nil {\n      // handle error\n    }\n    p, err := ioutil.ReadAll(part)\n    if err != nil {\n      // handle error\n    }\n    // p is []byte with the contents of the part\n}\n</code></pre>\n\n<p>If you want to copy the part to the io.Writer <code>w</code>, then use <a href=\"https://godoc.org/io#Copy\" rel=\"nofollow noreferrer\">io.Copy</a>:</p>\n\n<pre><code>for {\n    part, err := reader.NextPart()\n    if err == io.EOF {\n      break\n    }\n    if err != nil {\n      // handle error\n    }\n    w := // open a writer\n    _, err := io.Copy(w, part)\n    if err != nil {\n      // handle error\n    }\n}\n</code></pre>\n\n<p>If you want to process fixed size chunks, then use <a href=\"https://godoc.org/io#ReadFull\" rel=\"nofollow noreferrer\">io.ReadFull</a>:</p>\n\n<pre><code> buf := make([]byte, chunkSize)\n for {\n    part, err := reader.NextPart()\n    if err == io.EOF {\n      break\n    }\n    if err != nil {\n      // handle error\n    }\n    _, err := io.ReadFull(part, buf)\n    if err != nil {\n      // handle error\n      // Note that ReadFull returns an error if it cannot fill buf\n    }\n    // process the next chunk in buf\n}\n</code></pre>\n\n<p>If the application data is structured in some other way than fix sized chunks, then <a href=\"https://godoc.org/bufio#Scanner\" rel=\"nofollow noreferrer\">bufio.Scanner</a> might be of help.</p>\n"}], "owner": {"reputation": 113, "user_id": 8807932, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9858abf46f35cb7cb47666ab28c4feb4?s=128&d=identicon&r=PG&f=1", "display_name": "MadsRC", "link": "https://stackoverflow.com/users/8807932/madsrc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 852, "favorite_count": 0, "accepted_answer_id": 48650547, "answer_count": 2, "score": 1, "last_activity_date": 1517945361, "creation_date": 1517925173, "last_edit_date": 1517936907, "question_id": 48644694, "link": "https://stackoverflow.com/questions/48644694/reading-more-than-4096-bytes-per-chunk-with-part-read", "title": "Reading more than 4096 bytes per chunk with part.Read", "body": "<p>I'm trying to process a multipart file upload in small chunks to avoid storing the entire file in memory. The following function seems to solve this, however when passing a <code>[]byte</code> as the destination for the <code>part.Read()</code> method, it reads the part in chunks of 4096 bytes instead of in chunks of the destination size (<code>len([]byte)</code>).</p>\n\n<p>When opening a local file and <code>Read()</code>'ing it into a <code>[]byte</code> of the same size, it uses the entire space available as expected. Thus I think it's something specific to the <code>part.Reader()</code>. However, I'm unable to find anything about a default or max size for that function.</p>\n\n<p>For reference, the function is as follows:</p>\n\n<pre><code>func ReceiveFile(w http.ResponseWriter, r *http.Request) {\n  reader, err := r.MultipartReader()\n  if err != nil {\n    panic(err)\n  }\n  if reader == nil {\n    panic(\"Wrong media type\")\n  }\n  buf := make([]byte, 16384)\n  fmt.Println(len(buf))\n  for {\n    part, err := reader.NextPart()\n    if err == io.EOF {\n      break\n    }\n    if err != nil {\n      panic(err)\n    }\n    var n int\n    for {\n      n, err = part.Read(buf)\n      if err == io.EOF {\n        break\n      }\n      if err != nil {\n        panic(err)\n      }\n      fmt.Printf(\"Read %d bytes into buf\\n\", n)\n      fmt.Println(len(buf))\n    }\n    n, err = part.Read(buf)\n    fmt.Printf(\"Finally read %d bytes into buf\\n\", n)\n    fmt.Println(len(buf))\n  }\n</code></pre>\n"}, {"tags": ["json", "go", "unicode", "utf-8"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517933512, "post_id": 48644507, "comment_id": 84291858, "body": "That&#39;s not UTF-8, that&#39;s ASCII with literal escape sequences. Your text actually contains e.g. the string <code>\\u0003</code>."}, {"owner": {"reputation": 3363, "user_id": 1148194, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/bb21b27fe43fac2f302cdf3bfc59a6e9?s=128&d=identicon&r=PG", "display_name": "Tiago Peczenyj", "link": "https://stackoverflow.com/users/1148194/tiago-peczenyj"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517934189, "post_id": 48644507, "comment_id": 84292309, "body": "yes @Adrian but when I convert the original content ( json ) I find an UTF-8 String but I need raw bytes. ex: if I find 0xC3 and 0xB3 I need convert to 0xF3"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517934288, "post_id": 48644507, "comment_id": 84292384, "body": "Where is the quoted output coming from? I only see three printing statements, one of which (the error logging) isn&#39;t being executed, so only two of the four lines of output are accounted for, and it&#39;s not clear what&#39;s what. Also if e.g. you know that <code>v</code> will be a <code>string</code>, why are you unmarshalling into <code>interface{}</code> and doing a type conversion?"}, {"owner": {"reputation": 170455, "user_id": 149341, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/omfTQ.png?s=128&g=1", "display_name": "duskwuff -inactive-", "link": "https://stackoverflow.com/users/149341/duskwuff-inactive"}, "edited": false, "score": 3, "creation_date": 1517935632, "post_id": 48644507, "comment_id": 84293438, "body": "Your comparison to <code>utf8::decode</code> is just confusing matters. That function is rather specific to Perl&#39;s Unicode implementation. I don&#39;t think it&#39;s applicable at all to Go, and certainly not to this situation."}], "owner": {"reputation": 3363, "user_id": 1148194, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/bb21b27fe43fac2f302cdf3bfc59a6e9?s=128&d=identicon&r=PG", "display_name": "Tiago Peczenyj", "link": "https://stackoverflow.com/users/1148194/tiago-peczenyj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1517935583, "creation_date": 1517924591, "last_edit_date": 1517935583, "question_id": 48644507, "link": "https://stackoverflow.com/questions/48644507/go-equivalent-of-perl-5-utfdecode", "title": "Go equivalent of Perl 5 utf::decode", "body": "<p>What is the equivalent to this Perl program, in Go?</p>\n\n<pre><code>use utf8;\nmy $bin = \"...\"; # the data may came from file, network, etc\nutf8::decode( $bin ); # Encode::decode( 'UTF-8', $bin ) also works\n</code></pre>\n\n<p>defined in <a href=\"http://perldoc.perl.org/utf8.html\" rel=\"nofollow noreferrer\">http://perldoc.perl.org/utf8.html</a></p>\n\n<p>I try several forms of transformation/ normalization/ convert to bytes/runes/etc without success.</p>\n\n<p>Context:</p>\n\n<p>I am using Sereal ( <a href=\"https://github.com/Sereal/Sereal\" rel=\"nofollow noreferrer\">https://github.com/Sereal/Sereal</a> ) to serialize some data structures in a NoSQL database, first we had a Perl 5.12.2 version, them we are using Go. Sereal format is a binary</p>\n\n<p>However, somehow, some perl programs made an extra JSON encode/decode on the final BLOB (in a UTF-8 string), so it is fine for perl programs read and write data, but when Go try to decode it does not work.</p>\n\n<p>Of course, the best solution is <em>stop</em> this double encoding, but since we have entries in our database with this format I want to see if I can try to decode it</p>\n\n<p>Proof-of-Concept - here is my Json with an utf-8 converted string from my sereal bytes</p>\n\n<pre><code>$ hexdump -C min.bin \n00000000  22 3d c3 b3 72 6c 5c 75  30 30 30 33 5c 75 30 30  |\"=..rl\\u0003\\u00|\n00000010  30 30 51 6b 6c 61 73 74  5f 75 70 64 61 74 65 20  |00Qklast_update |\n00000020  c2 82 c3 9a c3 a6 c3 93  5c 75 30 30 30 35 22     |........\\u0005\"|\n0000002f\n</code></pre>\n\n<p>decode.pl</p>\n\n<pre><code>use strict;\nuse warnings;\nuse JSON;\nuse Sereal::Decoder;\nuse Data::Dumper;\nuse File::Slurp;\n\nmy $data = read_file( \"min.bin\", { binmode =&gt; ':raw' } );\nmy $bin = JSON-&gt;new-&gt;allow_nonref(1)-&gt;decode( $data );\nutf8::decode( $bin ); # MAGIC !!!\nmy $out = Sereal::Decoder-&gt;new-&gt;decode( $bin );\nprint(Dumper( $out ));\n</code></pre>\n\n<p>output</p>\n\n<pre><code>$VAR1 = {\n          'last_update' =&gt; 1517923586\n        };\n</code></pre>\n\n<p>decode.go</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n\n    \"github.com/Sereal/Sereal/Go/sereal\"\n    \"github.com/davecgh/go-spew/spew\"\n)\n\nfunc main() {\n    data, err := ioutil.ReadFile(\"min.bin\")\n    if err != nil {\n        fmt.Printf(\"unexpected error while reading fixtures file: '%+v'\\n\", err)\n    }\n    var v interface{}\n    err = json.Unmarshal(data, &amp;v)\n    spew.Dump(v, err)\n\n    var vbody interface{}\n    instance := sereal.NewDecoder()\n    instance.PerlCompat = false\n    str := v.(string)\n    // something here to be able to decode?\n    err = instance.Unmarshal([]byte(str), vbody)\n    spew.Dump(vbody, err)\n}\n</code></pre>\n\n<p>output</p>\n\n<pre><code>(string) (len=30) \"=\u00f3rl\\x03\\x00Qklast_update \\u0082\u00da\u00e6\u00d3\\x05\"\n(interface {}) &lt;nil&gt;\n(interface {}) &lt;nil&gt;\n(*errors.errorString)(0xc42000e370)(bad header: it seems your document was accidentally UTF-8 encoded)\n</code></pre>\n\n<p>edit: this code works, but I think it is not the proper way:</p>\n\n<pre><code>  buff := &amp;bytes.Buffer{}\n  for len(s) &gt; 0 {\n     r, size := utf8.DecodeRuneInString( s )\n     buff.WriteByte( byte(r ) ) \n     s = s[size:]\n  }\n\n  rawBytes := buff.Bytes() // yeah\n</code></pre>\n\n<p>Regards</p>\n\n<p>Tiago</p>\n"}, {"tags": ["go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 26, "last_activity_date": 1517923116, "creation_date": 1517923116, "answer_id": 48644018, "question_id": 48643906, "link": "https://stackoverflow.com/questions/48643906/how-to-extend-a-go-interface-to-another-interface/48644018#48644018", "title": "How to extend a Go interface to another interface?", "body": "<p>You can embed interface types. See the <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"noreferrer\">Interface type specification</a></p>\n\n<pre><code>type Student interface {\n    People\n    GetScore() int\n    GetSchoolName() string\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 1, "creation_date": 1589959745, "post_id": 48644275, "comment_id": 109495997, "body": "It helps a lot when there&#39;s a full example like the one given here."}], "tags": [], "owner": {"reputation": 1798, "user_id": 4438921, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/kYGzp.jpg?s=128&g=1", "display_name": "linrongbin", "link": "https://stackoverflow.com/users/4438921/linrongbin"}, "is_accepted": false, "score": 10, "last_activity_date": 1517923885, "creation_date": 1517923885, "answer_id": 48644275, "question_id": 48643906, "link": "https://stackoverflow.com/questions/48643906/how-to-extend-a-go-interface-to-another-interface/48644275#48644275", "title": "How to extend a Go interface to another interface?", "body": "<p>This is a full example about interface extend:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype People interface {\n    GetName() string\n    GetAge() int\n}\n\ntype Student interface {\n    People\n    GetScore() int\n    GetSchool() string\n}\n\ntype StudentImpl struct {\n    name string\n    age int\n    score int\n    school string\n}\n\nfunc NewStudent() Student {\n    var s = new(StudentImpl)\n    s.name = \"Jack\"\n    s.age = 18\n    s.score = 100\n    s.school = \"HighSchool\"\n    return s\n}\n\nfunc (a *StudentImpl) GetName() string {\n    return a.name\n}\n\nfunc (a *StudentImpl) GetAge() int {\n    return a.age\n}\n\nfunc (a *StudentImpl) GetScore() int {\n    return a.score\n}\n\nfunc (a *StudentImpl) GetSchool() string {\n    return a.school\n}\n\n\nfunc main() {\n    var a = NewStudent()\n    fmt.Println(a.GetName())\n    fmt.Println(a.GetAge())\n    fmt.Println(a.GetScore())\n    fmt.Println(a.GetSchool())\n}\n</code></pre>\n"}], "owner": {"reputation": 1798, "user_id": 4438921, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/kYGzp.jpg?s=128&g=1", "display_name": "linrongbin", "link": "https://stackoverflow.com/users/4438921/linrongbin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6905, "favorite_count": 1, "accepted_answer_id": 48644018, "answer_count": 2, "score": 6, "last_activity_date": 1517923885, "creation_date": 1517922770, "last_edit_date": 1517923482, "question_id": 48643906, "link": "https://stackoverflow.com/questions/48643906/how-to-extend-a-go-interface-to-another-interface", "title": "How to extend a Go interface to another interface?", "body": "<p>I have a Go interface: </p>\n\n<pre><code>type People interface {\n    GetName() string\n    GetAge() string\n}\n</code></pre>\n\n<p>Now I want another interface <code>Student</code>:</p>\n\n<p>1.</p>\n\n<pre><code>type Student interface {\n    GetName() string\n    GetAge() string\n    GetScore() int\n    GetSchoolName() string\n}\n</code></pre>\n\n<p>But I don't want to write the duplicate function <code>GetName</code> and <code>GetAge</code>.</p>\n\n<p>Is there a way to avoid write <code>GetName</code> and <code>GetAge</code> in <code>Student</code> interface ? like: </p>\n\n<p>2.</p>\n\n<pre><code>type Student interface {\n    People interface\n    GetScore() int\n    GetSchoolName() string\n}\n</code></pre>\n"}, {"tags": ["json", "go", "encoding", "interface"], "comments": [{"owner": {"reputation": 1562, "user_id": 4303758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/nbL0i.jpg?s=128&g=1", "display_name": "Manjeet Thakur", "link": "https://stackoverflow.com/users/4303758/manjeet-thakur"}, "edited": false, "score": 0, "creation_date": 1517922745, "post_id": 48643718, "comment_id": 84284302, "body": "try this <code>var bodyJSON *A</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1517923844, "post_id": 48643718, "comment_id": 84285038, "body": "If you don&#39;t provide a concrete type, the package can&#39;t know what to unmarshal into."}, {"owner": {"reputation": 196, "user_id": 2013845, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/21620aac62a4ba71e637921d99ad1fcf?s=128&d=identicon&r=PG", "display_name": "Karthik Venkateswaran", "link": "https://stackoverflow.com/users/2013845/karthik-venkateswaran"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517924362, "post_id": 48643718, "comment_id": 84285377, "body": "@JimB Yes I agree. Otherwise there is no way for the runtime to figure out which type to unmarshal to. The way I can make it work is read it as an <code>interface{}</code> and type cast it to appropriate type depending on a certain condition. Kindly let me know if there is any better approach to achieve this."}], "answers": [{"tags": [], "owner": {"reputation": 56, "user_id": 9340815, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-C60nvp5twK8/AAAAAAAAAAI/AAAAAAAAAWM/jiSMjZ0QR7E/photo.jpg?sz=128", "display_name": "Nathan", "link": "https://stackoverflow.com/users/9340815/nathan"}, "is_accepted": false, "score": 1, "last_activity_date": 1518222526, "creation_date": 1518222526, "answer_id": 48715989, "question_id": 48643718, "link": "https://stackoverflow.com/questions/48643718/unmarshal-json-request-body-to-a-structure-which-has-a-struct-member-of-custom-i/48715989#48715989", "title": "Unmarshal json request body to a structure which has a struct member of custom interface type", "body": "<p>The <code>json.Unmarshal</code> function by itself does not let you unmarshal into interface types except for the empty interfaces (<code>interface{}</code>) that don't have any methods:</p>\n\n<blockquote>\n  <p>To unmarshal JSON into an interface value, Unmarshal stores <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">one of these</a> in the interface value:</p>\n  \n  <ul>\n  <li><code>bool</code>, for JSON booleans</li>\n  <li><code>float64</code>, for JSON numbers</li>\n  <li><code>string</code>, for JSON strings</li>\n  <li><code>[]interface{}</code>, for JSON arrays</li>\n  <li><code>map[string]interface{}</code>, for JSON objects</li>\n  <li><code>nil</code> for JSON null</li>\n  </ul>\n</blockquote>\n\n<p>However, in some simple cases the following scheme can work.</p>\n\n<pre><code>type CustomerEntity struct {\n    CustomerName string `json:\"customer_name\"`\n    Address      string `json:\"customer_address\"`\n}\n\ntype EmployeeEntity struct {\n    EmployeeName string `json:\"employee_name\"`\n    ID           int    `json:\"employee_id\"`\n}\n</code></pre>\n\n<p>If we know that an entity is either an employee or a customer, then we can define an <code>Entity</code> that embeds each:</p>\n\n<pre><code>type Entity struct {\n    CustomerEntity\n    EmployeeEntity\n}\n</code></pre>\n\n<p>We can give it methods to check whether it's a customer or an employee:</p>\n\n<pre><code>func (s Entity) IsCustomer() bool {\n    return s.CustomerEntity != CustomerEntity{}\n}\nfunc (s Entity) IsEmployee() bool {\n    return s.EmployeeEntity != EmployeeEntity{}\n}\n</code></pre>\n\n<p>Really, these are just checking that at least one field is set.</p>\n\n<p>Then we unmarshal the following JSON:</p>\n\n<pre><code>{\n    \"entity\": {\n        \"employee_name\": \"Bob\",\n        \"employee_id\": 77\n    }\n}\n</code></pre>\n\n<p>Here's a complete example:</p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Example struct {\n    Entity Entity `json:\"entity\"`\n}\n\ntype Entity struct {\n    CustomerEntity\n    EmployeeEntity\n}\n\nfunc (s Entity) IsCustomer() bool {\n    return s.CustomerEntity != CustomerEntity{}\n}\nfunc (s Entity) IsEmployee() bool {\n    return s.EmployeeEntity != EmployeeEntity{}\n}\n\ntype CustomerEntity struct {\n    CustomerName    string `json:\"customer_name\"`\n    CustomerAddress string `json:\"customer_address\"`\n}\n\ntype EmployeeEntity struct {\n    EmployeeName string `json:\"employee_name\"`\n    EmployeeID   int    `json:\"employee_id\"`\n}\n\nfunc main() {\n    var example Example\n    if err := json.Unmarshal([]byte(`{\"entity\":{\"employee_name\":\"Bob\", \"employee_id\":77}}`), &amp;example); err != nil {\n        panic(\"won't fail\")\n    }\n    fmt.Printf(\"%#v\\n\", example)\n    if example.Entity.IsCustomer() {\n        fmt.Printf(\"customer %s lives at %d\\n\", example.Entity.CustomerName, example.Entity.CustomerAddress)\n    }\n    if example.Entity.IsEmployee() {\n        fmt.Printf(\"employee %s has id %d\\n\", example.Entity.EmployeeName, example.Entity.EmployeeID)\n    }\n}\n</code></pre>\n\n<p>which outputs</p>\n\n<pre><code>main.Example{Entity:main.Entity{CustomerEntity:main.CustomerEntity{CustomerName:\"\", CustomerAddress:\"\"}, EmployeeEntity:main.EmployeeEntity{EmployeeName:\"Bob\", EmployeeID:77}}}\nemployee Bob has id 77\n</code></pre>\n\n<p>as we might expect.</p>\n\n<p>There are a few caveats. First, this won't work if there's overlap in either the JSON or the Go field names for the entity types. Second, nothing stops you from (accidentally) initializing some fields in both the customer and employee types and causing it to return true for both <code>IsCustomer</code> and <code>IsEmployee</code>.</p>\n\n<p>If your JSON data has a <code>\"type\"</code> field, then you could use it to decide what is held instead:</p>\n\n<pre><code>type Entity struct {\n    Type string `json:\"type\"`\n    CustomerEntity\n    EmployeeEntity\n}\n</code></pre>\n\n<p>although this has the same drawbacks as the other solution mentioned above.</p>\n"}], "owner": {"reputation": 196, "user_id": 2013845, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/21620aac62a4ba71e637921d99ad1fcf?s=128&d=identicon&r=PG", "display_name": "Karthik Venkateswaran", "link": "https://stackoverflow.com/users/2013845/karthik-venkateswaran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 981, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518222526, "creation_date": 1517922152, "last_edit_date": 1517922616, "question_id": 48643718, "link": "https://stackoverflow.com/questions/48643718/unmarshal-json-request-body-to-a-structure-which-has-a-struct-member-of-custom-i", "title": "Unmarshal json request body to a structure which has a struct member of custom interface type", "body": "<p>Lets consider the following code </p>\n\n<pre><code>type A struct {\n    Column1 string `json:\"column1\"`\n    Entity CustomInterface `json:\"entity\"`\n}\n\ntype CustomInterface interface {\n    GetType() string\n}\n\ntype Entity1 struct {\n    ColumnX string `json:\"columnx\"`\n    ColumnY string `json:\"columny\"`\n}\n\ntype Entity2 struct {\n    ColumnP string `json:\"columnp\"`\n    ColumnQ string `json:\"columnq\"`\n}\n\nfunc (*e Entity1) GetType() string {\n    return \"ENTITY1\"\n}\n\nfunc (*e Entity2) GetType() string {\n    return \"ENTITY2\"\n}\n</code></pre>\n\n<p>Now if I am trying to bind an instance of <code>A</code> type as follows</p>\n\n<pre><code>var bodyJSON A\nShouldBindWith(&amp;bodyJson, binding.JSON)\n</code></pre>\n\n<p>I am getting the following error</p>\n\n<pre><code>json: cannot unmarshal object into Go struct field A.entity of type package.CustomInterface\n</code></pre>\n\n<p>Am I doing anything very silly here?</p>\n\n<p>PS: I just started exploring go. Apologies if this question is very noob level.</p>\n"}, {"tags": ["go", "tcp", "rpc", "json-rpc"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1517920852, "post_id": 48642454, "comment_id": 84283099, "body": "You&#39;ll need to a tcp conn instead of the rpc package. See <a href=\"https://ipfs.io/ipfs/QmfYeDhGH9bZzihBUDEQbCbTc5k5FZKURMUoUvfmc27BwL/socket/tcp_sockets.html\" rel=\"nofollow noreferrer\">ipfs.io/ipfs/QmfYeDhGH9bZzihBUDEQbCbTc5k5FZKURMUoUvfmc27BwL/&zwnj;&#8203;&hellip;</a> for examples."}, {"owner": {"reputation": 1968, "user_id": 4402916, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2ed524952816b84787b70aea7c8bcf8a?s=128&d=identicon&r=PG&f=1", "display_name": "Arkon", "link": "https://stackoverflow.com/users/4402916/arkon"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517921759, "post_id": 48642454, "comment_id": 84283668, "body": "Thanks Marc. The documentation is explicitly specifying the need to use RPC and it also says that &quot;Antenna and remove device are both server and client&quot;. It makes very little sense to me.."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517922666, "post_id": 48642454, "comment_id": 84284249, "body": "Rpc is a fairly generic term. Is it talking about the Go net.rpc package specifically, or just RPC? If the latter, it doesn&#39;t actually mean anything specific."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517925454, "post_id": 48642454, "comment_id": 84286186, "body": "What is the protocol you&#39;re intending to use for this proposed &quot;bidirectional rpc&quot;?"}], "owner": {"reputation": 1968, "user_id": 4402916, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2ed524952816b84787b70aea7c8bcf8a?s=128&d=identicon&r=PG&f=1", "display_name": "Arkon", "link": "https://stackoverflow.com/users/4402916/arkon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 755, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1517921877, "creation_date": 1517917955, "last_edit_date": 1517921877, "question_id": 48642454, "link": "https://stackoverflow.com/questions/48642454/bidirectional-communication-with-rpc", "title": "Bidirectional communication with RPC", "body": "<p>I am currently implementing an RPC interface (both client and server) about some proprietary product on top of a raw TCP connection. The documentation explicitly demands a JSON-RPC communication and it also adds the following tip:</p>\n\n<pre><code>In &lt;doc number&gt;, antenna and remote device are both server and client\n</code></pre>\n\n<p>In the interface, it appears that the client should be able to receive <code>notifications</code> from the server, simple json message without the need to respond to them.</p>\n\n<p>Basically, it looks like this:</p>\n\n<pre><code>Server ---------------------------------------------------- Client\n\n       &lt;------------------------ Client Initiate Connection\n       Server acknowledge connection opened --------------&gt;\n\n       Server sends a notification about some event-------&gt;\n       Server sends another notif. about another event----&gt;\n\n       &lt;---------------------------- Client Stop Connection\n       Server acknowledge connection stopped -------------&gt;\n</code></pre>\n\n<p>Doing a simple request/response event is easy:</p>\n\n<p>The server looks like this:</p>\n\n<pre><code>func (l *Listener) GetLine(line []byte, ack *bool) error {\n    fmt.Println(string(line))\n    return nil\n}\n\nfunc main() {\n    addy, err := net.ResolveTCPAddr(\"tcp\", \"0.0.0.0:42586\")\n    inbound, _:= net.ListenTCP(\"tcp\", addy)\n    listener := new(Listener)\n    rpc.Register(listener)\n    rpc.Accept(inbound)\n}\n</code></pre>\n\n<p>And the client is able to call to the server function</p>\n\n<pre><code>client, err := rpc.Dial(\"tcp\", \"localhost:42586\")\nin := bufio.NewReader(os.Stdin)\nfor {\n    line, _, err := in.ReadLine()\n    var reply bool\n    client.Call(\"Listener.GetLine\", line, &amp;reply)\n}\n</code></pre>\n\n<p>In this situation, I do not see how I can send data from the server to the client. How can I do this using the same TCP connection? How can they be both server and client ?</p>\n"}, {"tags": ["linux", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1517916943, "post_id": 48641958, "comment_id": 84280636, "body": "Your code creates a new v4 UUID--this is entirely unrelated to the system uuid reported by dmidecode.  If you want the system uuid, you need to read the /proc filesystem (or your OS equivalent)."}, {"owner": {"reputation": 3793, "user_id": 2136970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e0b3de472b291902c62f5e1b414bbe3?s=128&d=identicon&r=PG", "display_name": "Kevin Sandow", "link": "https://stackoverflow.com/users/2136970/kevin-sandow"}, "edited": false, "score": 0, "creation_date": 1517917412, "post_id": 48641958, "comment_id": 84280966, "body": "Have a look at <a href=\"https://github.com/ochapman/godmi\" rel=\"nofollow noreferrer\">github.com/ochapman/godmi</a>"}, {"owner": {"reputation": 739, "user_id": 3390851, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/HEm4K.jpg?s=128&g=1", "display_name": "Katiyman", "link": "https://stackoverflow.com/users/3390851/katiyman"}, "edited": false, "score": 0, "creation_date": 1517918688, "post_id": 48641958, "comment_id": 84281749, "body": "Thanks will check and revert back."}], "answers": [{"tags": [], "owner": {"reputation": 739, "user_id": 3390851, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/HEm4K.jpg?s=128&g=1", "display_name": "Katiyman", "link": "https://stackoverflow.com/users/3390851/katiyman"}, "is_accepted": true, "score": 0, "last_activity_date": 1517978551, "creation_date": 1517978551, "answer_id": 48656158, "question_id": 48641958, "link": "https://stackoverflow.com/questions/48641958/get-system-unique-uuid-using-golang/48656158#48656158", "title": "Get System Unique UUID using GOLANG", "body": "<p>I used \"github.com/dselans/dmidecode\" for getting the System UUID.\n<a href=\"https://github.com/dselans/dmidecode/\" rel=\"nofollow noreferrer\" title=\"dmidecode\">dmidecode</a></p>\n\n<p>Simple Code snippet is below</p>\n\n<pre><code>func main() {\n    dmi := dmidecode.New()\n\n    if err := dmi.Run(); err != nil {\n        fmt.Printf(\"Unable to get dmidecode information. Error: %v\\n\", err)\n    }\n\n    byNameData, _ := dmi.SearchByName(\"UUID\")\n    fmt.Printf(\"uuid2: %v \", byNameData)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 739, "user_id": 3390851, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/HEm4K.jpg?s=128&g=1", "display_name": "Katiyman", "link": "https://stackoverflow.com/users/3390851/katiyman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1491, "favorite_count": 1, "accepted_answer_id": 48656158, "answer_count": 1, "score": -4, "last_activity_date": 1517978551, "creation_date": 1517916432, "last_edit_date": 1517916911, "question_id": 48641958, "link": "https://stackoverflow.com/questions/48641958/get-system-unique-uuid-using-golang", "title": "Get System Unique UUID using GOLANG", "body": "<p>I was trying to figure out a way to get the system unique UUID.</p>\n\n<p>like generated by </p>\n\n<pre><code>sudo dmidecode -s system-uuid\n</code></pre>\n\n<p>I tried using <code>github.com/satori/go.uuid</code> but each time I execute it, \nit gives me a new UUID.</p>\n\n<p>The code that I am using is as below.</p>\n\n<pre><code>func main() {\n\n    u2, err := uuid.NewV4()\n    if err != nil {\n        fmt.Printf(\"Something went wrong: %s\", err)\n        return\n    }\n    fmt.Printf(\"UUIDv4: %s\\n\", u2)\n}\n</code></pre>\n"}, {"tags": ["go", "sqlite"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517908679, "post_id": 48639051, "comment_id": 84275033, "body": "Include your complete error message."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1517908757, "post_id": 48639051, "comment_id": 84275091, "body": "<code>strings.Split</code> is used to split a string into a slice, not to convert a slice into a string. You probably want <code>Join</code> instead."}], "answers": [{"tags": [], "owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "is_accepted": false, "score": 1, "last_activity_date": 1517922017, "last_edit_date": 1517922017, "creation_date": 1517921714, "answer_id": 48643574, "question_id": 48639051, "link": "https://stackoverflow.com/questions/48639051/how-to-insert-an-array-in-sqlite/48643574#48643574", "title": "how to insert an array in sqlite?", "body": "<p>Complementary to <code>database/sql/driver.Valuer</code> you need also to implement <code>database/sql.Scanner</code> for reading your type from the database.\nWhen you think of how to implement it, it's obvious that in <code>Valuer</code> you should <code>Join</code> your slice with some delimiter character/string (not occurring in the data of course) to be able to <code>Split</code> it back when retrieving. </p>\n\n<p>Assuming that such delimiter would be <code>;</code> (my wild guess), the code for reading would look like:</p>\n\n<pre><code>func (a *strArray) Scan(value interface{}) error {\n  if value == nil {\n    return nil  // case when value from the db was NULL\n  }\n  s, ok := value.(string)\n  if !ok {\n    return fmt.Errorf(\"failed to cast value to string: %v\", value)\n  }\n  *a = strings.Split(s, \";\")\n  return nil\n}\n</code></pre>\n\n<p>For writing, you'd need to use <code>strings.Join(strarr, \";\")</code> in <code>Valuer</code> implementation.</p>\n\n<p>Other less-trivial implementation would require marshaling your slice and encoding the resulting bytes as string somehow (base32/64? json?). In any case you need to not loose the information what are distinct slice elements when saving them to the database.</p>\n"}], "owner": {"reputation": 657, "user_id": 1758354, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/52dae9523c89ed427f6b2269fab6800c?s=128&d=identicon&r=PG", "display_name": "nebi", "link": "https://stackoverflow.com/users/1758354/nebi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 723, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1517922017, "creation_date": 1517907608, "last_edit_date": 1517910708, "question_id": 48639051, "link": "https://stackoverflow.com/questions/48639051/how-to-insert-an-array-in-sqlite", "title": "how to insert an array in sqlite?", "body": "<p>I have struct like:</p>\n\n<pre><code>type Foo struct {\n  bars []string\n}\n</code></pre>\n\n<p>Since sqlite3 doesn't have array data type supported, can we store <code>[]string</code> as string and while retrieving return as slice of string? Was trying to implement like below, but getting error because of type mismatch. What need to be done here?</p>\n\n<p>Edit: I have changed the code and look like working</p>\n\n<pre><code>type strArray []string\n\nfunc (strarr StrArray) Value() (driver.Value, error) {\n    if strarr != nil {\n        resarr := strings.Join(strarr, \"\")\n        return resarr, nil\n    }\n    return nil, nil\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1517910285, "post_id": 48638663, "comment_id": 84276139, "body": "I think you should take measures to gain more generic knowledge about how a contemporary commodity OS shares CPU time and other resources between the processes running on it. You can start <a href=\"https://en.wikipedia.org/wiki/Preemption_(computing)\" rel=\"nofollow noreferrer\">here</a> but a good introductory-level book should also help."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1576708545, "post_id": 48638663, "comment_id": 104990918, "body": "Related: <a href=\"https://stackoverflow.com/q/24599645/1256452\">How do goroutines work? (or: goroutines and OS threads relation)</a>"}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1517910146, "post_id": 48639240, "comment_id": 84276045, "body": "I&#39;d also recommend to read <a href=\"https://rakyll.org/scheduler/\" rel=\"nofollow noreferrer\">this post</a> by one of the Go developers."}, {"owner": {"reputation": 996, "user_id": 5156646, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/d51f0ac02939a9cf8d85df751e01d21c?s=128&d=identicon&r=PG&f=1", "display_name": "Jim Green", "link": "https://stackoverflow.com/users/5156646/jim-green"}, "edited": false, "score": 0, "creation_date": 1517911432, "post_id": 48639240, "comment_id": 84277002, "body": "Thank you very much for your answer.You solve a lot of my questions. What happened if <code>GOMAXPROCS </code> &gt; cpu numbers? Will it cause os schedule from user-level thread -&gt;kernel thread -&gt; user-level thread ?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517912418, "post_id": 48639240, "comment_id": 84277646, "body": "No, the OS only schedules kernel threads, it doesn&#39;t know about user threads. It&#39;s also not rare for the actual number of OS threads used by Go to exceed GOMAXPROCS. See <a href=\"https://dave.cheney.net/tag/gomaxprocs\" rel=\"nofollow noreferrer\">dave.cheney.net/tag/gomaxprocs</a>. It sounds like you need to read up on OS basics. Maybe start with <a href=\"https://en.wikipedia.org/wiki/Scheduling_(computing)\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Scheduling_(computing)</a>"}, {"owner": {"reputation": 996, "user_id": 5156646, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/d51f0ac02939a9cf8d85df751e01d21c?s=128&d=identicon&r=PG&f=1", "display_name": "Jim Green", "link": "https://stackoverflow.com/users/5156646/jim-green"}, "edited": false, "score": 0, "creation_date": 1517913906, "post_id": 48639240, "comment_id": 84278674, "body": "I have read your reference . So what will happened if GOMAXPROCS &gt; cpu numbers?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517914018, "post_id": 48639240, "comment_id": 84278729, "body": "Again: nothing bad. Go will make use of more kernel threads than there are cpus, and the kernel will keep scheduling those appropriately. The reason GOMAXPROCS is set to the number of CPUs is that the fanning out is done with goroutines, so there&#39;s little point in having more scheduling contexts than there are CPUs. Also: there are often more when they&#39;re waiting, or executing cgo."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 13, "last_activity_date": 1517908620, "last_edit_date": 1517908620, "creation_date": 1517908267, "answer_id": 48639240, "question_id": 48638663, "link": "https://stackoverflow.com/questions/48638663/what-is-relationship-between-goroutine-and-thread-in-kernel-and-user-state/48639240#48639240", "title": "What is relationship between goroutine and thread in kernel and user state", "body": "<p>Let's include the picture from the <a href=\"http://morsmachine.dk/go-scheduler\" rel=\"noreferrer\">go-scheduler</a> page you linked to.</p>\n\n<p><a href=\"https://i.stack.imgur.com/BnqDb.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/BnqDb.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>And establish the terminology:</p>\n\n<ul>\n<li><strong>M</strong>: OS thread, can also be called a kernel thread</li>\n<li><strong>P</strong>: processor, or scheduling context</li>\n<li><strong>G</strong>: Goroutine</li>\n</ul>\n\n<p>goroutines are what we are most familiar with in Go, and could be considered user threads. A more technical name for those is <a href=\"https://en.wikipedia.org/wiki/Green_threads\" rel=\"noreferrer\">Green Threads</a>.</p>\n\n<p><strong>P</strong> is used to perform the mapping from many goroutines to many OS threads. There is one per OS thread, and the number is determined by the value of <code>GOMAXPROCS</code> (by default, the number of CPUs as reported by your system).</p>\n\n<p>So, to answer your questions in order:</p>\n\n<ul>\n<li>OS thread means kernel thread</li>\n<li><code>GOMAXPROCS</code> defaults to the number of cores, but you can change that. Just because you can run on all cores does not mean you're not leaving CPU time for other processes. Concurrency usually involves a lot of waiting for IO. Even if you're going crazy hashing things, the kernel scheduler will boot you off to run other things.</li>\n<li>there are as many OS threads as needed. Looking at <code>ps -eL</code>, my system currently has 1434, some of them actual kernel jobs, some for my go program.</li>\n</ul>\n\n<p>You can find a really good explanation of OS vs Green threads in <a href=\"https://stackoverflow.com/questions/15983872/difference-between-user-level-and-kernel-supported-threads\">this answer</a></p>\n"}], "owner": {"reputation": 996, "user_id": 5156646, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/d51f0ac02939a9cf8d85df751e01d21c?s=128&d=identicon&r=PG&f=1", "display_name": "Jim Green", "link": "https://stackoverflow.com/users/5156646/jim-green"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2027, "favorite_count": 4, "answer_count": 1, "score": 10, "last_activity_date": 1517908620, "creation_date": 1517906231, "last_edit_date": 1517907606, "question_id": 48638663, "link": "https://stackoverflow.com/questions/48638663/what-is-relationship-between-goroutine-and-thread-in-kernel-and-user-state", "title": "What is relationship between goroutine and thread in kernel and user state", "body": "<p>I am confused by goroutine, user thread, and kernel thread concepts</p>\n\n<ol>\n<li><p>From <a href=\"http://golang-jp.org/doc/effective_go.html#goroutines\" rel=\"noreferrer\">effective go introduce goroutine</a>, so what does <code>os threads</code> means which mentioned by the paper? Does it mean user thread or kernel thread?</p></li>\n<li><p>From <a href=\"http://morsmachine.dk/go-scheduler\" rel=\"noreferrer\">go-scheduler paper</a>, I learn about <code>M G P</code>, and why the numbers of <code>P</code> is equal to the numbers of CPU? If all the cpus serve for the go program, but other program in the os system have no cpu thread to execute?</p></li>\n<li><p>How many kernel thread generated by the os system?</p></li>\n</ol>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1517903069, "post_id": 48637624, "comment_id": 84271949, "body": "Are you executing your go code in the same docker host which you expect to execute docker commands?"}, {"owner": {"reputation": 91, "user_id": 4158971, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/25feab08ae7bcd755b8bc46c757636ed?s=128&d=identicon&r=PG&f=1", "display_name": "\u5ed6\u524d\u7a0b", "link": "https://stackoverflow.com/users/4158971/%e5%bb%96%e5%89%8d%e7%a8%8b"}, "reply_to_user": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1517904818, "post_id": 48637624, "comment_id": 84272858, "body": "Unfortunately, my code executing on other hosts that I can&#39;t execute <code>docker version</code>"}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 4158971, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/25feab08ae7bcd755b8bc46c757636ed?s=128&d=identicon&r=PG&f=1", "display_name": "\u5ed6\u524d\u7a0b", "link": "https://stackoverflow.com/users/4158971/%e5%bb%96%e5%89%8d%e7%a8%8b"}, "edited": false, "score": 0, "creation_date": 1517904969, "post_id": 48638182, "comment_id": 84272932, "body": "thank for your answer, but it does not suit me, my code executing on another host."}], "tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": false, "score": 1, "last_activity_date": 1517904345, "creation_date": 1517904345, "answer_id": 48638182, "question_id": 48637624, "link": "https://stackoverflow.com/questions/48637624/how-to-get-docker-api-version-by-sdk-of-golang/48638182#48638182", "title": "how to get docker api version by SDK of Golang?", "body": "<p>If you are executing your code in the same docker host you can use the following approach to get the API version. It execute <code>docker version</code> command and get the API version from that output.</p>\n\n<pre><code>package main\n\nimport (\n    \"os/exec\"\n    \"bytes\"\n    \"os\"\n    \"github.com/docker/docker/client\"\n    \"golang.org/x/net/context\"\n    \"github.com/docker/docker/api/types\"\n    \"strings\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"docker\", \"version\", \"--format\", \"{{.Server.APIVersion}}\")\n    cmdOutput := &amp;bytes.Buffer{}\n    cmd.Stdout = cmdOutput\n\n    err := cmd.Run()\n    if err != nil {\n        panic(err)\n    }\n    apiVersion := strings.TrimSpace(string(cmdOutput.Bytes()))\n    // TODO: (optional) verify the api version is in the correct format(a.b)\n    os.Setenv(\"DOCKER_API_VERSION\", apiVersion)\n    // execute docker commands\n    ctx := context.Background()\n    cli, err := client.NewEnvClient()\n    if err != nil {\n        panic(err)\n    }\n    _, err = cli.ImagePull(ctx, \"alpine\", types.ImagePullOptions{})\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 4158971, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/25feab08ae7bcd755b8bc46c757636ed?s=128&d=identicon&r=PG&f=1", "display_name": "\u5ed6\u524d\u7a0b", "link": "https://stackoverflow.com/users/4158971/%e5%bb%96%e5%89%8d%e7%a8%8b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 902, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1517904345, "creation_date": 1517902071, "question_id": 48637624, "link": "https://stackoverflow.com/questions/48637624/how-to-get-docker-api-version-by-sdk-of-golang", "title": "how to get docker api version by SDK of Golang?", "body": "<p>I need to know Docker Daemon API version and setup the environment variable of <code>DOCKER_API_VERSION</code> when I have to create Docker client with <a href=\"https://godoc.org/github.com/moby/moby/client#NewEnvClient\" rel=\"nofollow noreferrer\">NewEnvClient()</a>, if not I will get an error about:</p>\n\n<pre><code>Error response from daemon: client version 1.36 is too new. Maximum supported API version is 1.35\n</code></pre>\n"}, {"tags": ["json", "go", "reflection", "unmarshalling", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 5257901, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ac6091746b9bc9342ef454f204d4224?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey Burdin", "link": "https://stackoverflow.com/users/5257901/alexey-burdin"}, "edited": false, "score": 0, "creation_date": 1517896281, "post_id": 48636174, "comment_id": 84269137, "body": "Thanks. What was wrong with <code>return v.Elem().Interface()</code>? I liked it better."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 125, "user_id": 5257901, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ac6091746b9bc9342ef454f204d4224?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey Burdin", "link": "https://stackoverflow.com/users/5257901/alexey-burdin"}, "edited": false, "score": 1, "creation_date": 1517896385, "post_id": 48636174, "comment_id": 84269168, "body": "If the application is unmarshalling large <code>struct</code> values, then returning a pointer to the struct is usually better.  I updated the question to show how to return the value as well."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 125, "user_id": 5257901, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ac6091746b9bc9342ef454f204d4224?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey Burdin", "link": "https://stackoverflow.com/users/5257901/alexey-burdin"}, "edited": false, "score": 1, "creation_date": 1517898844, "post_id": 48636174, "comment_id": 84270040, "body": "@AlexeyBurdin See new and improved answer that return structs by value or by pointer depending on the argument to Data."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1517898794, "last_edit_date": 1517898794, "creation_date": 1517895666, "answer_id": 48636174, "question_id": 48636077, "link": "https://stackoverflow.com/questions/48636077/unmarshal-json-to-reflected-struct-continued/48636174#48636174", "title": "Unmarshal json to reflected struct (continued)", "body": "<p>The code in the question is close. </p>\n\n<p>Try the following function. The resulting function returns the same type as the type of <code>i</code>:</p>\n\n<pre><code>func Data(i interface{}) func(string) (interface{}, error) {\n    return func(data string) (interface{}, error) {\n        v := reflect.New(reflect.TypeOf(i))\n        err := json.Unmarshal([]byte(data), v.Interface())\n        return v.Elem().Interface(), err\n    }\n}\n</code></pre>\n\n<p>Example use:</p>\n\n<pre><code>type Test struct {\n    A string\n    B string\n}\n\nf := Data((*Test)(nil))\nv, err := f(`{\"A\": \"hello\", \"B\": \"world\"}`)\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Printf(\"%#v\\n\", v) // v is a *Test\n\nf = Data(\"\")\nv, err = f(`\"Hello\"`)\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Printf(\"%#v\\n\", v)  // v is a string\n</code></pre>\n\n<p>If you want to return a struct value, then pass a struct value as the argument to Data:</p>\n\n<pre><code>f = Data(Test{})\nv, err = f(`{\"A\": \"hello\", \"B\": \"world\"}`)\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Printf(\"%#v\\n\", v) // v is a Test\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/sJeziITzfuF\" rel=\"nofollow noreferrer\">Playground example</a></p>\n"}], "owner": {"reputation": 125, "user_id": 5257901, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ac6091746b9bc9342ef454f204d4224?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey Burdin", "link": "https://stackoverflow.com/users/5257901/alexey-burdin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 713, "favorite_count": 0, "accepted_answer_id": 48636174, "answer_count": 1, "score": 0, "last_activity_date": 1597430927, "creation_date": 1517895089, "last_edit_date": 1597430927, "question_id": 48636077, "link": "https://stackoverflow.com/questions/48636077/unmarshal-json-to-reflected-struct-continued", "title": "Unmarshal json to reflected struct (continued)", "body": "<p>I want to write a gin middleware handler which gets data from <code>c.Request.FormValue(\"data\")</code>, unmarshalls it into a structure (structures are rather different) and sets a variable in context (<code>c.Set(\"Data\",newP)</code>). So I searched and wrote this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package middleware\n\nimport (\n    \"reflect\"\n    \"fmt\"\n    \"github.com/gin-gonic/gin\"\n    \"encoding/json\"\n)\n\n//https://semaphoreci.com/community/tutorials/test-driven-development-of-go-web-applications-with-gin\n//https://github.com/gin-gonic/gin/issues/420\nfunc Data(t reflect.Type) gin.HandlerFunc {\n    return func(c *gin.Context) {\n        //https://stackoverflow.com/a/7855298/5257901\n        //https://stackoverflow.com/a/45680060/5257901\n        //t := reflect.TypeOf(orig)\n        v := reflect.New(t.Elem())\n        // reflected pointer\n        newP := v.Interface()\n\n        data:=c.Request.FormValue(\"data\")\n        fmt.Printf(\"%s data:%s\\n\",c.Request.URL.Path,data)\n        if err:=json.Unmarshal([]byte(data),newP); err!=nil{\n            fmt.Printf(\"%s data unmarshall %s, data(in quotes):\\\"%s\\\"\",c.Request.URL.Path,err,data)\n            c.Abort()\n            return\n        }\n        ustr, _:=json.Marshal(newP)\n        fmt.Printf(\"%s unmarshalled:%s\\n\",c.Request.URL.Path,ustr)\n        c.Set(\"Data\",newP)\n        c.Next()\n    }\n}\n</code></pre>\n\n<p>and I use it like this:</p>\n\n<pre><code>func InitHandle(R *gin.Engine) {\n    Plan := R.Group(\"/Plan\")\n    Plan.POST(\"/clickCreate\",middleware.Data(reflect.TypeOf(new(tls.PlanTabel))), clickCreatePlanHandle)\n}\n</code></pre>\n\n<p>and </p>\n\n<pre><code>var data = *(c.MustGet(\"Data\").(*tls.PlanTabel))\n</code></pre>\n\n<p>which is rather heavy and ugly. I want to </p>\n\n<pre><code>middleware.Data(tls.PlanTabel{})\n</code></pre>\n\n<p>and</p>\n\n<pre><code>var data = c.MustGet(\"Data\").(tls.PlanTabel)\n</code></pre>\n\n<p><strong>In other words</strong>, omitting gin, I want a closure that eats <code>i interface{}</code> and returns a function <code>(data string) (o interface{})</code></p>\n\n<pre><code>func Data(i interface{}) (func (string) (interface{})) {\n    //some reflect magic goes here\n    //extract the structure type from interface{} :\n\n    //gets a reflect type pointer to it, like\n    //t := reflect.TypeOf(orig)\n    return func(data string) (o interface{}) {\n        //new reflected structure (pointer?)\n        v := reflect.New(t.Elem())\n        //interface to it\n        newP := v.Interface()\n        //unmarshal\n        json.Unmarshal([]byte(data),newP);\n        //get the structure from the pointer back\n\n        //returns interface to the structure\n\n        //reflect magic ends\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1517910458, "post_id": 48635928, "comment_id": 84276277, "body": "Can you show the directory structure and main file from where you are calling <code>LoadConfiguration</code> function"}], "answers": [{"tags": [], "owner": {"reputation": 542, "user_id": 5822368, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q75QC.jpg?s=128&g=1", "display_name": "Vikram Jakhar", "link": "https://stackoverflow.com/users/5822368/vikram-jakhar"}, "is_accepted": false, "score": 0, "last_activity_date": 1517896424, "creation_date": 1517896424, "answer_id": 48636324, "question_id": 48635928, "link": "https://stackoverflow.com/questions/48635928/how-to-read-config-json-in-go-lang/48636324#48636324", "title": "How to read config.json in Go lang?", "body": "<p>The issue might be with the filename you're providing. Below is the code sample that working fine for me.</p>\n\n<pre><code>func loadConfig() {\n    var AppConfig Conf\n    raw, err := ioutil.ReadFile(\"conf/conf.json\")\n    if err != nil {\n       log.Println(\"Error occured while reading config\")\n       return\n    }\n    json.Unmarshal(raw, &amp;AppConfig)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 4, "last_activity_date": 1517900885, "creation_date": 1517900885, "answer_id": 48637309, "question_id": 48635928, "link": "https://stackoverflow.com/questions/48635928/how-to-read-config-json-in-go-lang/48637309#48637309", "title": "How to read config.json in Go lang?", "body": "<p>The path of <code>*.go</code> file is not directly relevant to the working directory of the executing compiled code. Verify where your code thinks it actually is (compare to where you think it should be :).</p>\n\n<pre><code>import(\n  \"os\" \n  \"fmt\"\n  \"log\"\n)\n\nfunc main() {\n  dir, err := os.Getwd()\n  if err != nil {\n    log.Fatal(err)\n  }\n  fmt.Println(dir)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5840856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79b6f7143f7189eae8b73cf05f6a814?s=128&d=identicon&r=PG&f=1", "display_name": "Ali Faghani Hamedani", "link": "https://stackoverflow.com/users/5840856/ali-faghani-hamedani"}, "is_accepted": false, "score": 0, "last_activity_date": 1588109739, "creation_date": 1588109739, "answer_id": 61490362, "question_id": 48635928, "link": "https://stackoverflow.com/questions/48635928/how-to-read-config-json-in-go-lang/61490362#61490362", "title": "How to read config.json in Go lang?", "body": "<p>I found this library <a href=\"https://github.com/alics/go-json-config\" rel=\"nofollow noreferrer\">enter link description here</a> </p>\n\n<p>It is a very simple and easy to use configuration library, allowing Json based config files for your Go application. Configuration provider reads configuration data from config.json file. You can get the string value of a configuration, or bind an interface to a valid JSON section by related section name convention parameter.\nConsider the following config.json file:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>{\r\n  \"ConnectionStrings\": {\r\n    \"DbConnection\": \"Server=.;User Id=app;Password=123;Database=Db\",\r\n    \"LogDbConnection\": \"Server=.;User Id=app;Password=123;Database=Log\"\r\n  },\r\n  \"Caching\": {\r\n    \"ApplicationKey\": \"key\",\r\n    \"Host\": \"127.0.01\"\r\n  },\r\n  \"Website\": {\r\n    \"ActivityLogEnable\": \"true\",\r\n    \"ErrorMessages\": {\r\n      \"InvalidTelephoneNumber\": \"Invalid Telephone Number\",\r\n      \"RequestNotFound\": \"Request Not Found\",\r\n      \"InvalidConfirmationCode\": \"Invalid Confirmation Code\"\r\n    }\r\n  },\r\n  \"Services\": {\r\n    \"List\": [\r\n      {\r\n        \"Id\": 1,\r\n        \"Name\": \"Service1\"\r\n      },\r\n      {\r\n        \"Id\": 2,\r\n        \"Name\": \"Service2\"\r\n      },\r\n      {\r\n        \"Id\": 3,\r\n        \"Name\": \"Service3\"\r\n      }\r\n    ]\r\n  }\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>The following code displays how to access some of the preceding configuration settings. You can get config value via GetSection function with specifying Json sections as string parameter split by \":\"</p>\n\n<pre><code>c, err :=  jsonconfig.GetSection(\"ConnectionStrings:DbConnection\")\n</code></pre>\n\n<p>Any valid Json is a valid configuration type. You can also bind a struct via jsonconfig. For example, Caching configuration can be bind to valid struct:</p>\n\n<pre><code>type Caching struct {\nApplicationKey string\nHost           string\n</code></pre>\n\n<p>}</p>\n\n<p>var c Caching\nerr = jsonconfig.Bind(&amp;c, \"Caching\")</p>\n"}], "owner": {"reputation": 381, "user_id": 7572953, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d007bc1359ffae4a2a0a879c18ac3307?s=128&d=identicon&r=PG&f=1", "display_name": "Shikha", "link": "https://stackoverflow.com/users/7572953/shikha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1551, "favorite_count": 0, "answer_count": 3, "score": -4, "last_activity_date": 1588109739, "creation_date": 1517894225, "question_id": 48635928, "link": "https://stackoverflow.com/questions/48635928/how-to-read-config-json-in-go-lang", "title": "How to read config.json in Go lang?", "body": "<p>I have used the following code in filLib.go: </p>\n\n<pre><code>func LoadConfiguration(filename string) (Configuration, error) {\n    bytes, err := ioutil.ReadFile(filename)\n    if err != nil {\n        return Configuration{}, err\n    }\n\n    var c Configuration\n    err = json.Unmarshal(bytes, &amp;c)\n    if err != nil {\n        return Configuration{}, err\n    }\n\n    return c, nil\n}\n</code></pre>\n\n<p>But ioutil.ReadFile(filename) return *os.PathError.</p>\n\n<p>Both the files config.json and filLib.go are in same folder.</p>\n"}, {"tags": ["go", "gopath"], "answers": [{"comments": [{"owner": {"reputation": 1752, "user_id": 1597059, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/AEZlG.png?s=128&g=1", "display_name": "A23149577", "link": "https://stackoverflow.com/users/1597059/a23149577"}, "edited": false, "score": 2, "creation_date": 1517895892, "post_id": 48635880, "comment_id": 84268983, "body": "OMG! I certainly did not know it considers comments as well! You&#39;re a lifesaver!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1752, "user_id": 1597059, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/AEZlG.png?s=128&g=1", "display_name": "A23149577", "link": "https://stackoverflow.com/users/1597059/a23149577"}, "edited": false, "score": 0, "creation_date": 1517925582, "post_id": 48635880, "comment_id": 84286269, "body": "@A23149577: see the <a href=\"https://golang.org/cmd/go/#hdr-Import_path_checking\" rel=\"nofollow noreferrer\">Import Path Checking documentation</a>"}], "tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": true, "score": 6, "last_activity_date": 1517893905, "creation_date": 1517893905, "answer_id": 48635880, "question_id": 48635662, "link": "https://stackoverflow.com/questions/48635662/code-in-directory-expects-import/48635880#48635880", "title": "Code in directory expects import", "body": "<p>line number 66 sha3/docs.go has the import comment. </p>\n\n<pre><code>import \"golang.org/x/crypto/sha3\"\n</code></pre>\n\n<p>You can get rid of the build error by removing that.</p>\n"}], "owner": {"reputation": 1752, "user_id": 1597059, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/AEZlG.png?s=128&g=1", "display_name": "A23149577", "link": "https://stackoverflow.com/users/1597059/a23149577"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6090, "favorite_count": 0, "accepted_answer_id": 48635880, "answer_count": 1, "score": 1, "last_activity_date": 1517893905, "creation_date": 1517892443, "last_edit_date": 1517892877, "question_id": 48635662, "link": "https://stackoverflow.com/questions/48635662/code-in-directory-expects-import", "title": "Code in directory expects import", "body": "<p>I have a package which is forked from a repository <code>myproject</code>. Inside the project, I want to use some functions from <code>sha3</code> package, however, I need to first add a <code>go</code> file to <code>sha3</code> package which contains some extra functionalities. I want to include this custom <code>sha3</code> package inside my project. I copied and pasted the <code>sha3</code> directory into <code>myproject</code> directory, and inside my <code>go</code> codes, I imported <code>sha3</code> package as:\n<code>import . \"github.com/myproject/sha3\"</code>. Now, when I try to build <code>myproject</code> package, I am getting:\n<code>code in directory /src/github.com/myproject/sha3 expects import \"golang.org/x/crypto/sha3\"</code>. I cannot understand what the problem is. I checked all the <code>go</code> files inside <code>sha3</code> directory and none of them requires any import! </p>\n"}, {"tags": ["mongodb", "go", "aggregation-framework", "mgo"], "comments": [{"owner": {"reputation": 762, "user_id": 2009642, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/XNvOp.jpg?s=128&g=1", "display_name": "Prathibha Chiranthana", "link": "https://stackoverflow.com/users/2009642/prathibha-chiranthana"}, "edited": false, "score": 0, "creation_date": 1517903676, "post_id": 48635604, "comment_id": 84272276, "body": "Why are you using bson.D try with bson.M I would attach a sample code to get an out put."}, {"owner": {"reputation": 762, "user_id": 2009642, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/XNvOp.jpg?s=128&g=1", "display_name": "Prathibha Chiranthana", "link": "https://stackoverflow.com/users/2009642/prathibha-chiranthana"}, "edited": false, "score": 0, "creation_date": 1517904031, "post_id": 48635604, "comment_id": 84272471, "body": "If you provide sample data that would be easier to modify the answer."}], "answers": [{"tags": [], "owner": {"reputation": 762, "user_id": 2009642, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/XNvOp.jpg?s=128&g=1", "display_name": "Prathibha Chiranthana", "link": "https://stackoverflow.com/users/2009642/prathibha-chiranthana"}, "is_accepted": true, "score": 0, "last_activity_date": 1517904045, "creation_date": 1517904045, "answer_id": 48638099, "question_id": 48635604, "link": "https://stackoverflow.com/questions/48635604/mongodb-aggregation-gives-error-in-golang/48638099#48638099", "title": "mongodb aggregation gives error in golang", "body": "<p>Hi this is a sample code I modified to use pipelines with MgO golang. Watch It and try to apply it. \n    package main</p>\n\n<pre><code>import (\"fmt\"\n    \"log\"\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype Method struct {\n        Type string `json:\"Type\" bson:\"Type\"`\n        Host float64 `json:\"Host\" bson:\"Host\"`\n}\n\ntype Out struct {\n        Type string `json:\"Type\" bson:\"Type\"`\n        Count float64 `json:\"count\" bson:\"count\"`\n}\n\nfunc main() {\n\n        session, err := mgo.Dial(\"localhost\")\n        if err != nil {\n                panic(err)\n        }\n        defer session.Close()\n\n        // Optional. Switch the session to a monotonic behavior.\n        session.SetMode(mgo.Monotonic, true)\n\n        c := session.DB(\"test\").C(\"api\")\n        // err = c.Insert(&amp;Method{\"GET\", 1.0},\n           //         &amp;Method{\"PUT\", 2.0},\n           //         &amp;Method{\"POST\", 2.0})\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        pipe := c.Pipe(\n                []bson.M{\n                    bson.M{\n                        \"$unwind\":\"$Type\",\n                    },\n                    bson.M{\n                        \"$group\":bson.M{\n                        \"_id\":\"$Type\", \n                        \"count\":bson.M{\"$sum\":1,},\n                        },\n                    },\n                    bson.M{\n                        \"$project\":bson.M{\n                        \"Type\":\"$_id\" , \"count\":\"$count\",\n                        },\n                    },\n                },\n            )\n\n        result := []Out{}\n        // err = c.Find(bson.M{\"Type\": \"GET\" }).One(&amp;result)\n            err = pipe.All(&amp;result)\n\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        fmt.Println(\"Type:\", result)\n}\n</code></pre>\n\n<p>Dataset in the mongoDB</p>\n\n<pre><code>/* 1 */\n{\n    \"_id\" : ObjectId(\"5a794efd49d755038cc60307\"),\n    \"Type\" : \"GET\",\n    \"Host\" : 1.0\n}\n\n/* 2 */\n{\n    \"_id\" : ObjectId(\"5a794efd49d755038cc60308\"),\n    \"Type\" : \"PUT\",\n    \"Host\" : 2.0\n}\n\n/* 3 */\n{\n    \"_id\" : ObjectId(\"5a794efd49d755038cc60309\"),\n    \"Type\" : \"POST\",\n    \"Host\" : 2.0\n}\n\n/* 4 */\n{\n    \"_id\" : ObjectId(\"5a794f3149d755038cc6031a\"),\n    \"Type\" : \"GET\",\n    \"Host\" : 1.0\n}\n\n/* 5 */\n{\n    \"_id\" : ObjectId(\"5a794f3149d755038cc6031b\"),\n    \"Type\" : \"PUT\",\n    \"Host\" : 2.0\n}\n\n/* 6 */\n{\n    \"_id\" : ObjectId(\"5a794f3149d755038cc6031c\"),\n    \"Type\" : \"POST\",\n    \"Host\" : 2.0\n}\n</code></pre>\n\n<p>Out put </p>\n\n<p>Type: [{POST 2} {PUT 2} {GET 2}]</p>\n"}], "owner": {"reputation": 47, "user_id": 3724497, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/K4NBO.jpg?s=128&g=1", "display_name": "SashaAlex", "link": "https://stackoverflow.com/users/3724497/sashaalex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 557, "favorite_count": 1, "accepted_answer_id": 48638099, "answer_count": 1, "score": 0, "last_activity_date": 1517904045, "creation_date": 1517892140, "question_id": 48635604, "link": "https://stackoverflow.com/questions/48635604/mongodb-aggregation-gives-error-in-golang", "title": "mongodb aggregation gives error in golang", "body": "<p>I want group methods types and count them according to their types.these methods are strings. I wrote below code.But it gives an error.</p>\n\n<pre><code>pipeline := []bson.D{\n        bson.D{\n            {\"$unwind\", \"$method\"},\n        },\n        bson.D{\n            {\"$group\", bson.M{\"_id\": \"$method\", \"count\": bson.M{\"$sum\": 1}}},\n        },\nquery := bson.D{\n        {\"aggregate\", \"API_ACCESS_LOGS\"}, // useragents is a collection name\n        {\"pipeline\", pipeline},\n    }\n  err = session.DB(\"vamps-logs\").Run(query, &amp;methods)\n</code></pre>\n\n<p>It gives below error.</p>\n\n<p>2018/02/06 09:58:33 http: panic serving 127.0.0.1:53973: runtime error: index out of range\ngoroutine 92 [running]:</p>\n\n<p>please help me to correct this</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 563, "user_id": 4539721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d6650d3a6a89e08bd747a07fd06989a?s=128&d=identicon&r=PG", "display_name": "Soham Kamani", "link": "https://stackoverflow.com/users/4539721/soham-kamani"}, "edited": false, "score": 0, "creation_date": 1517891209, "post_id": 48635254, "comment_id": 84267622, "body": "Have you imported the &quot;context&quot; package?"}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 563, "user_id": 4539721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d6650d3a6a89e08bd747a07fd06989a?s=128&d=identicon&r=PG", "display_name": "Soham Kamani", "link": "https://stackoverflow.com/users/4539721/soham-kamani"}, "edited": false, "score": 0, "creation_date": 1517891362, "post_id": 48635254, "comment_id": 84267651, "body": "@SohamKamani I did now, and it removed the last error but the others remain."}], "answers": [{"comments": [{"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1517923494, "post_id": 48635610, "comment_id": 84284798, "body": "Thanks.  Now if I try and wrap <code>userService.GetUsers</code> with <code>withAuth(us, userService.GetUsers)</code> I get an error saying: <code>cannot use WithAuth(userService.GetUsers) (type http.Handler) as type func(http.ResponseWriter, *http.Request) in argument to router.HandleFunc</code> ."}, {"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "reply_to_user": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1517928013, "post_id": 48635610, "comment_id": 84288058, "body": "use router.Handle to register the handler rather than router.HandleFunc"}], "tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": true, "score": 1, "last_activity_date": 1517892174, "creation_date": 1517892174, "answer_id": 48635610, "question_id": 48635254, "link": "https://stackoverflow.com/questions/48635254/trying-to-extract-a-api-request-token-and-wrap-my-handlers/48635610#48635610", "title": "Trying to extract a API request token and wrap my handlers", "body": "<p>You're mixing http.HandleFunc &amp; http.Handle<strong>r</strong>Func (note the r)</p>\n\n<pre><code>func WithAuth(us UserService, next http.Handler) http.Handler {\n      return http.HandleFunc(func(w http.ResponseWriter, r *http.Request) {\n</code></pre>\n\n<p>but you need to return a http.HandlerFunc instead</p>\n\n<pre><code> func WithAuth(us UserService, next http.Handler) http.Handler {\n      return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n</code></pre>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 48635610, "answer_count": 1, "score": 0, "last_activity_date": 1517892174, "creation_date": 1517889463, "question_id": 48635254, "link": "https://stackoverflow.com/questions/48635254/trying-to-extract-a-api-request-token-and-wrap-my-handlers", "title": "Trying to extract a API request token and wrap my handlers", "body": "<p>I want to use the new context to wrap my handlers so I can have a User struct available in all my handlers (or whatever else I need for the current request to tell me about who is making the request).</p>\n\n<p>I am getting an error with this:</p>\n\n<pre><code>func main() {\n\n\nrouter := mux.NewRouter()\n\n  router.HandleFunc(\"/api/v1/user/{id}\", userService.GetUsers).Methods(\"GET\")\n\n  log.Fatal(http.ListenAndServe(\":3001\", router))\n}\n\nfunc WithAuth(us UserService, next http.Handler) http.Handler {\n  return http.HandleFunc(func(w http.ResponseWriter, r *http.Request) {\n    auth := r.Header.Get(\"Authorization\")\n    if auth == \"\" {\n      next.ServeHTTP(w, r) // continue without token\n      return\n    }\n\n    // token, err := a.Authorize(auth)\n    // if err != nil {\n    //   http.Error(w, err.Error(), http.StatusUnauthorized)\n    //   return\n    // }\n\n    ctx := context.WithValue(r.Context(), \"hello\", \"world\")\n    next.ServeHTTP(w, r.WithContext(ctx))\n  })\n}\n</code></pre>\n\n<p>The error is:</p>\n\n<blockquote>\n  <p>not enough arguments in call to http.HandleFunc  have\n  (func(http.ResponseWriter, *http.Request))    want (string,\n  func(http.ResponseWriter, *http.Request)) ./main.go:65:25:\n  http.HandleFunc(func literal) used as value ./main.go:78:12:\n  undefined: context</p>\n</blockquote>\n\n<p>I tried to adapt the code I read from here: <a href=\"https://gist.github.com/peterbourgon/2d190ddbb8d2cbddb5bceaca80eef20e#file-ctx-go\" rel=\"nofollow noreferrer\">https://gist.github.com/peterbourgon/2d190ddbb8d2cbddb5bceaca80eef20e#file-ctx-go</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1517889524, "post_id": 48635129, "comment_id": 84267232, "body": "you just need to implement interface, so good idea would be to embedded the old lib add missing stuff and pass ur embedded object"}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1517889587, "post_id": 48635129, "comment_id": 84267253, "body": "here is a <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">doc</a> about it"}, {"owner": {"reputation": 772, "user_id": 2177445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70a2a5ad356c78484d79a3ad4b99209f?s=128&d=identicon&r=PG", "display_name": "likebike", "link": "https://stackoverflow.com/users/2177445/likebike"}, "reply_to_user": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1517891895, "post_id": 48635129, "comment_id": 84267784, "body": "@Vardius, I am asking about a package-level function, not an object method.  Therefore, it is impossible to use an <code>interface</code> for this."}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1517892149, "post_id": 48635129, "comment_id": 84267854, "body": "Then no, you can&#39;t override the function, unless it is exported as object func there is nothing you can do about it."}], "answers": [{"comments": [{"owner": {"reputation": 772, "user_id": 2177445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70a2a5ad356c78484d79a3ad4b99209f?s=128&d=identicon&r=PG", "display_name": "likebike", "link": "https://stackoverflow.com/users/2177445/likebike"}, "edited": false, "score": 0, "creation_date": 1517905400, "post_id": 48636674, "comment_id": 84273153, "body": "Fantastic answer!  Thank you."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1517987180, "last_edit_date": 1517987180, "creation_date": 1517898083, "answer_id": 48636674, "question_id": 48635129, "link": "https://stackoverflow.com/questions/48635129/go-how-to-handle-library-api-changes/48636674#48636674", "title": "Go: How to handle library API changes?", "body": "<p>Use build constraints. A build constraint is a line comment that begins</p>\n\n<pre><code>// +build\n</code></pre>\n\n<p>that lists the conditions under which a file should be included in the package. See Build Constraints in <a href=\"https://golang.org/pkg/go/build/\" rel=\"nofollow noreferrer\">Package build</a> for details.</p>\n\n<p>For example, for Go 1.5 and later (<code>// +build go1.5</code>), forward <code>LookupEnv</code> to <code>os.LookupEnv</code>. For Go 1.4 and earlier (<code>// +build !go1.5</code>), implement <code>LookupEnv</code>.</p>\n\n<p><code>src/lookup/lookup.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n)\n\nfunc main() {\n    fmt.Println(\"version:\", runtime.Version())\n    key := \"HOME\"\n    value, found := LookupEnv(key)\n    fmt.Printf(\"key: %q value %q found: %t\\n\", key, value, found)\n}\n</code></pre>\n\n<p><code>src/lookup/env.go</code>:</p>\n\n<pre><code>// +build go1.5\n\n// Forward LookupEnv to os.LookupEnv\n\npackage main\n\nimport \"os\"\n\n// LookupEnv retrieves the value of the environment variable named\n// by the key. If the variable is present in the environment the\n// value (which may be empty) is returned and the boolean is true.\n// Otherwise the returned value will be empty and the boolean will\n// be false.\nfunc LookupEnv(key string) (string, bool) {\n    return os.LookupEnv(key)\n}\n</code></pre>\n\n<p><code>src/lookup/env_1.4.go</code>:</p>\n\n<pre><code>// +build !go1.5\n\n// Implement LookupEnv\n\npackage main\n\nimport \"syscall\"\n\n// LookupEnv retrieves the value of the environment variable named\n// by the key. If the variable is present in the environment the\n// value (which may be empty) is returned and the boolean is true.\n// Otherwise the returned value will be empty and the boolean will\n// be false.\nfunc LookupEnv(key string) (string, bool) {\n    return syscall.Getenv(key)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go build &amp;&amp; ./lookup\nversion: devel +fd7331a821 Tue Feb 6 05:00:01 2018 +0000\nkey: \"HOME\" value \"/home/peter\" found: true\n$\n\n$ go1.4 build &amp;&amp; ./lookup\nversion: go1.4-bootstrap-20170531\nkey: \"HOME\" value \"/home/peter\" found: true\n$\n</code></pre>\n"}], "owner": {"reputation": 772, "user_id": 2177445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70a2a5ad356c78484d79a3ad4b99209f?s=128&d=identicon&r=PG", "display_name": "likebike", "link": "https://stackoverflow.com/users/2177445/likebike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 1, "accepted_answer_id": 48636674, "answer_count": 1, "score": 2, "last_activity_date": 1518529687, "creation_date": 1517888591, "last_edit_date": 1518529687, "question_id": 48635129, "link": "https://stackoverflow.com/questions/48635129/go-how-to-handle-library-api-changes", "title": "Go: How to handle library API changes?", "body": "<p>I originally wrote my project with Go v1.9, which includes the <code>os.LookupEnv</code> function.</p>\n\n<p>Now I need to build with Go v1.4, but that function is missing -- it only has <code>os.Getenv</code> which has slightly different behavior.</p>\n\n<p>In Python, I could provide a compatibility function, something like this:</p>\n\n<pre><code>if 'LookupEnv' not in os:\n    def myLookupEnv(k):\n        v = os.Getenv(k)\n        return v, v!=''\n    os.LookupEnv = myLookupEnv\n</code></pre>\n\n<p>How can I handle these kinds of API changes in Go?</p>\n"}, {"tags": ["go", "worker"], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517909381, "post_id": 48637584, "comment_id": 84275519, "body": "I think OP stated that <b>There is no way to hold everything in memory before they are printed</b>. So this does not work for the question."}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517909739, "post_id": 48637584, "comment_id": 84275773, "body": "I guess that depends on how workers handle what is passed in to them. I&#39;m also assuming that <code>Result</code> is tiny subset of the processing of larger <code>Job</code>. I&#39;m addressing the <code>Order</code> part of the question, which I though is primary."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517910039, "post_id": 48637584, "comment_id": 84275985, "body": "The order part has been answered and the OP even put a link to the answer. The problem OP is addressing, is about having large amount of worker where an in-memory and wait-untill-all solution would not be good enough or even possible."}], "tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": -1, "last_activity_date": 1517906118, "last_edit_date": 1517906118, "creation_date": 1517901921, "answer_id": 48637584, "question_id": 48635071, "link": "https://stackoverflow.com/questions/48635071/how-to-order-results-from-workers-as-if-there-are-no-workers-used/48637584#48637584", "title": "How to order results from workers as if there are no workers used?", "body": "<p>If workers know the initial order they are e.g. informed about line numbers for example, then let workers preserve that information (just the line numbers). Your workers then feed that information back to your results channel. Your results aggregating code that receives from results channel then orders results based on the initial ordering information before further processing (e.g. printing).</p>\n\n<p>Below is quick modification of one of the examples you show.</p>\n\n<p>\n    package main</p>\n\n<pre><code>import \"fmt\"\nimport \"time\"\n\ntype Result struct {\n    Data, Seq int\n}\n\ntype Job struct {\n    Data string\n    Seq  int\n}\n\nfunc worker(id int, jobs &lt;-chan Job, results chan&lt;- Result) {\n    for j := range jobs {\n        fmt.Println(\"worker\", id, \"started  job\", j)\n        time.Sleep(time.Second)\n        fmt.Println(\"worker\", id, \"finished job\", j)\n        results &lt;- Result{len(j.Data), j.Seq}\n    }\n}\n\nfunc main() {\n    workload := 5\n\n    jobs := make(chan Job, 100)\n    results := make(chan Result, 100)\n\n    output := make([]Result, workload)\n\n    for w := 1; w &lt;= 3; w++ {\n        go worker(w, jobs, results)\n    }\n\n    for j := 0; j &lt; workload; j++ {\n        jobs &lt;- Job{ // explicit to make it clear\n            Data: fmt.Sprintf(\"blah blah blah %d\", j),\n            Seq:  j,\n        }\n    }\n    close(jobs)\n\n    // receive results\n    for a := 1; a &lt;= workload; a++ {\n        res := &lt;-results\n        output[res.Seq] = res\n\n        // uncomment to see unordered\n        // fmt.Printf(\"received: %#v\", res)\n    }\n\n    for _, out := range output {\n        fmt.Printf(\"output %#v\\n\", out)\n    }\n}\n</code></pre>\n\n<p>BTW: this does not work well if you do not know your workload in advance... In which case your code that receives results needs to be a little smarter in processing part that is already received and ordered (homework) :). Essentially wait for line 0 then wait for next or print what is already received in sequence.</p>\n\n<p>Have fun!</p>\n"}], "owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1517906118, "creation_date": 1517888143, "question_id": 48635071, "link": "https://stackoverflow.com/questions/48635071/how-to-order-results-from-workers-as-if-there-are-no-workers-used", "title": "How to order results from workers as if there are no workers used?", "body": "<p>Suppose that I have the following code to read lines and multiple each line by 2 and print each line out one by one.</p>\n\n<p>I'd like to use N workers. Each worker takes M lines each time and processes them. More importantly, I'd like the output to be printed in the same order as the input. But the example here does not guarantee the output is printed in the same order as the input.</p>\n\n<p><a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\">https://gobyexample.com/worker-pools</a></p>\n\n<p>The following URL also shows some examples. But I don't think they fit my requirement. The problem is that the input can be arbitrarily long. There is no way to hold everything in memory before they are printed. There must be a way to get some output from the workers can determine if the output of a worker is ready to be printed and then it is print. It sounds like there should be a master goroutine to do this. But I am not sure how to implement it most efficiently, as this master gorountine can easily be a bottleneck when N is big.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/37856337/how-to-collect-values-from-n-goroutines-executed-in-a-specific-order\">How to collect values from N goroutines executed in a specific order?</a></p>\n\n<p>Could anybody show an example program that results from the workers in order and prints the results as early as they can be printed?</p>\n\n<pre><code>$ cat main.go\n#!/usr/bin/env gorun\n// vim: set noexpandtab tabstop=2:\n\npackage main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"strconv\"\n    \"io\"\n    \"os\"\n    \"log\"\n)\n\nfunc main() {\n    stdin := bufio.NewReader(os.Stdin)\n\n    for {\n        line, err := stdin.ReadString('\\n')\n\n        if err == io.EOF {\n            if len(line) != 0 {\n                i, _ := strconv.Atoi(line)\n                fmt.Println(i*2)\n            }\n            break\n        } else if err != nil {\n            log.Fatal(err)\n        }\n\n        i, _ := strconv.Atoi(line[:(len(line)-1)])\n        fmt.Println(i*2)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 5, "last_activity_date": 1517892609, "creation_date": 1517892609, "answer_id": 48635689, "question_id": 48635069, "link": "https://stackoverflow.com/questions/48635069/bufio-newscanner-as-a-function-argument/48635689#48635689", "title": "bufio.NewScanner as a function argument", "body": "<p><a href=\"https://golang.org/pkg/bufio/#NewScanner\" rel=\"noreferrer\"><code>bufio.NewScanner</code></a> is a function for creating a new scanner:</p>\n\n<blockquote>\n  <p><code>func NewScanner(r io.Reader) *Scanner</code><br>\n  NewScanner returns a new Scanner to read from r. The split function defaults to ScanLines.</p>\n</blockquote>\n\n<p>not a type that you can use in a function signature. However, <code>bufio.NewScanner</code> returns a <code>*bufio.Scanner</code> and <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"noreferrer\"><code>bufio.Scanner</code></a> is a type so you could say:</p>\n\n<pre><code>func readInt(scanner *bufio.Scanner) int {\n    //...\n}\n</code></pre>\n"}], "owner": {"reputation": 888, "user_id": 6087479, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-5I8NM_JIDkU/AAAAAAAAAAI/AAAAAAAAAAA/MAhvpTXecww/photo.jpg?sz=128", "display_name": "Eziz Durdyyev", "link": "https://stackoverflow.com/users/6087479/eziz-durdyyev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 706, "favorite_count": 0, "accepted_answer_id": 48635689, "answer_count": 1, "score": 2, "last_activity_date": 1517892609, "creation_date": 1517888135, "question_id": 48635069, "link": "https://stackoverflow.com/questions/48635069/bufio-newscanner-as-a-function-argument", "title": "bufio.NewScanner as a function argument", "body": "<p>I have this code:</p>\n\n<pre><code>var scanner = bufio.NewScanner(os.Stdin)\n\nfunc readInt() int {\n    scanner.Scan()\n    ans, _ := strconv.Atoi(scanner.Text())\n    return ans\n}\n\nfunc main() {\n    scanner.Split(bufio.ScanWords)\n\n    n := readInt()\n\n    fmt.Println(n)\n}\n</code></pre>\n\n<p>Now, the <code>scanner</code> variable is global. And I want to make it local and pass it to <code>readInt()</code> function as a parameter. When I tried this way it would not work:</p>\n\n<pre><code>func readInt(scanner bufio.NewScanner) int {\n    scanner.Scan()\n    ans, _ := strconv.Atoi(scanner.Text())\n    return ans\n}\n\nfunc main() {\n    var scanner = bufio.NewScanner(os.Stdin)\n    scanner.Split(bufio.ScanWords)\n\n    n := readInt(scanner)\n\n    fmt.Println(n)\n}\n</code></pre>\n\n<p>If someone could give a hand.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1517883748, "post_id": 48634354, "comment_id": 84265954, "body": "How are you building and running the code? <code>go run main.go</code>? Or <code>go build</code>?"}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1517884249, "post_id": 48634354, "comment_id": 84266049, "body": "I am running it using <code>go run main.go</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1517884325, "post_id": 48634354, "comment_id": 84266073, "body": "Start with <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1517901449, "post_id": 48634354, "comment_id": 84271145, "body": "It&#39;s <code>go build</code> not <code>go run</code>. go run is for helper scripts once you are confident with the language and the tooling."}], "answers": [{"comments": [{"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1517884542, "post_id": 48634592, "comment_id": 84266130, "body": "so how does the golang revel framework work the?  <a href=\"https://revel.github.io/manual/organization.html\" rel=\"nofollow noreferrer\">revel.github.io/manual/organization.html</a>   thanks!"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1517884966, "post_id": 48634592, "comment_id": 84266217, "body": "@Blankman They appear to be using their own tool to build their apps, not the <code>go</code> tool. You build the example &quot;booking&quot; app not with <code>go build</code> but with <code>revel run github.com&#47;revel&#47;examples&#47;booking</code>. You&#39;ll want to use a pre-existing framework and their tools. Note that <a href=\"https://github.com/revel/cmd/tree/master/revel\" rel=\"nofollow noreferrer\">the actual <code>revel</code> command</a> uses the flat layout because it must be buildable with <code>go get</code>."}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 1, "last_activity_date": 1517884377, "creation_date": 1517884377, "answer_id": 48634592, "question_id": 48634354, "link": "https://stackoverflow.com/questions/48634354/trying-to-understand-how-to-find-structs-in-my-project-and-packages/48634592#48634592", "title": "Trying to understand how to find structs in my project and packages", "body": "<blockquote>\n  <p><em>I am running it using <code>go run main.go</code>.</em></p>\n</blockquote>\n\n<p>That's a problem. <code>go run main.go</code> will only build <code>main.go</code>. For a project that is more than one file, use <code>go build</code>. It will then find your source files and build them. But that isn't going to work either because you're not following the Go conventions for source layout.</p>\n\n<p>The <code>go</code> tool enforces a very particular way of structuring your project. You can read about this in <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How To Write Go Code</a>. In general, the source code tree is flat. <code>go build</code> is simply not finding <code>services/user_service.go</code>. You can see this with <code>go build -x</code>.</p>\n\n<pre><code>$ tree\n.\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 service\n    \u2514\u2500\u2500 user_service.go\n\n1 directory, 2 files\n\n$ go build -x\nWORK=/var/folders/0b/7xp2lxbd7yl0tcpms06fr3d40000gn/T/go-build148902279\nmkdir -p $WORK/soq/_obj/\nmkdir -p $WORK/soq/_obj/exe/\ncd /Users/schwern/go/src/soq\n/opt/local/lib/go/pkg/tool/darwin_amd64/compile -o $WORK/soq.a -trimpath $WORK -goversion go1.9.3 -p main -complete -buildid 08f76ca23c0110836288d4a2c698c2692588f909 -D _/Users/schwern/go/src/soq -I $WORK -pack ./main.go\n# soq\n./main.go:8:21: undefined: UserService\n</code></pre>\n\n<p>Note that <code>compile</code> is only working on <code>main.go</code>.</p>\n\n<p>The simple solution is to flatten your source tree.</p>\n\n<pre><code>$ tree\n.\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 user_service.go\n\n0 directories, 2 files\n\n$ go build -x\nWORK=/var/folders/0b/7xp2lxbd7yl0tcpms06fr3d40000gn/T/go-build117658131\nmkdir -p $WORK/soq/_obj/\nmkdir -p $WORK/soq/_obj/exe/\ncd /Users/schwern/go/src/soq\n/opt/local/lib/go/pkg/tool/darwin_amd64/compile -o $WORK/soq.a -trimpath $WORK -goversion go1.9.3 -p main -complete -buildid 8dfd03a3d0d09267ebc5ff9d1b8dd630d7465e9c -D _/Users/schwern/go/src/soq -I $WORK -pack ./main.go ./user_service.go\ncd .\n/opt/local/lib/go/pkg/tool/darwin_amd64/link -o $WORK/soq/_obj/exe/a.out -L $WORK -extld=/usr/bin/clang -buildmode=exe -buildid=8dfd03a3d0d09267ebc5ff9d1b8dd630d7465e9c $WORK/soq.a\nmv $WORK/soq/_obj/exe/a.out soq\n</code></pre>\n\n<p>And now it works fine.</p>\n\n<hr>\n\n<p>You might be thinking \"<em>but what if I want to do more complicated things?</em>\"</p>\n\n<p>You <em>could</em> write your own build tool that walked sub-directories to find all the Go files and feed them to <code>go build</code>. But that goes against the nature of Go, and you'll find yourself having to subvert more and more tools as time goes on.</p>\n\n<p>Go is deliberately designed to discourage complexity. Large source trees with subdirectories encourage complexity and allow entangled subsystems, so the <code>go</code> tool does not help you with them. (The Go language does not care about your file structure, just the <code>go</code> build tool).</p>\n\n<p>Instead, the Go way to deal with this is to split your <code>services</code> off into a new package. Develop it with clear boundaries, and without the temptation to couple it to other systems, and <code>import</code> it into your main package.</p>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1517884377, "creation_date": 1517882358, "question_id": 48634354, "link": "https://stackoverflow.com/questions/48634354/trying-to-understand-how-to-find-structs-in-my-project-and-packages", "title": "Trying to understand how to find structs in my project and packages", "body": "<p>In my main.go I am trying to reference a struct, I'm getting a error:</p>\n\n<blockquote>\n  <p>undefined: UserService</p>\n</blockquote>\n\n<p>/main.go with package main</p>\n\n<pre><code>userService := &amp;UserService{}\n</code></pre>\n\n<p>/services/user_service.go with package main</p>\n\n<pre><code>type UserService struct {\n  // ..\n}\n</code></pre>\n\n<p>Why can't it find my struct?\nCan I put my /services files in a different package?  If so, then how would I reference them in my main.go file?</p>\n"}, {"tags": ["git", "go", "github"], "comments": [{"owner": {"reputation": 18922, "user_id": 3633742, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/thyJX.jpg?s=128&g=1", "display_name": "n00dl3", "link": "https://stackoverflow.com/users/3633742/n00dl3"}, "edited": false, "score": 4, "creation_date": 1517878459, "post_id": 48633765, "comment_id": 84264730, "body": "I see two solutions (at least) use the vendor directory to version your custom crypto package inside your project, otherwise make a fork ang <code>go get</code> it."}], "answers": [{"comments": [{"owner": {"reputation": 3721, "user_id": 3936578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfeaef1a08060ac6454b0aabef263aab?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/3936578/anton"}, "edited": false, "score": 0, "creation_date": 1517914400, "post_id": 48636389, "comment_id": 84278977, "body": "But OP wants to maintain a modified version of the upstream package. Using <code>dep</code> in this way would imply modifying the vendored package and that doesn&#39;t seem optimal. I think a straight fork with the modifications would be clearer."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 2, "last_activity_date": 1517907517, "last_edit_date": 1517907517, "creation_date": 1517896746, "answer_id": 48636389, "question_id": 48633765, "link": "https://stackoverflow.com/questions/48633765/commit-on-top-of-a-custom-go-package/48636389#48636389", "title": "Commit on top of a custom GO package", "body": "<p>Have a look at <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\"><code>dep</code></a>:</p>\n\n<ul>\n<li>Remove your golang.org folder, and go to your project folder.</li>\n<li>Then try <code>dep ensure</code>.  </li>\n</ul>\n\n<p>If you don't have go dep installed, type first:</p>\n\n<pre><code>go get -u github.com/golang/dep/cmd/dep\n</code></pre>\n\n<p>That will vendor your dependency: see \"<a href=\"https://blog.gopheracademy.com/advent-2015/vendor-folder/\" rel=\"nofollow noreferrer\">Understanding and using the vendor folder</a>\".</p>\n"}, {"tags": [], "owner": {"reputation": 18922, "user_id": 3633742, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/thyJX.jpg?s=128&g=1", "display_name": "n00dl3", "link": "https://stackoverflow.com/users/3633742/n00dl3"}, "is_accepted": true, "score": 1, "last_activity_date": 1517907642, "creation_date": 1517907642, "answer_id": 48639058, "question_id": 48633765, "link": "https://stackoverflow.com/questions/48633765/commit-on-top-of-a-custom-go-package/48639058#48639058", "title": "Commit on top of a custom GO package", "body": "<p>Since go 1.5, you can put a <a href=\"https://blog.gopheracademy.com/advent-2015/vendor-folder/\" rel=\"nofollow noreferrer\"><code>vendor</code> folder</a> at the root of your project (<code>workspace/src/github.com/myproject/vendor</code>). This folder is an import path. When building, <code>go build</code> will first look for packages inside your vendor folder and if not found, will look inside your <code>$GOPATH</code>.</p>\n\n<p>You can copy your custom <code>golang.org/x/crypto</code> package inside your vendor folder and add it to your favorite VCS.</p>\n\n<p>The other solution would be to make a fork of the <a href=\"https://github.com/golang/crypto\" rel=\"nofollow noreferrer\">golang.org/x/crypto</a> repository like <code>github.com/user/mycrypto</code> and use the <code>go get</code> command to get the code like this:</p>\n\n<pre><code>go get github.com/user/mycrypto\n</code></pre>\n\n<p>That being said, VonC is right, it's a good practice to use a dependency manager as it will keep track of what version of libraries you have installed, and it allows better portability.</p>\n"}], "owner": {"reputation": 1752, "user_id": 1597059, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/AEZlG.png?s=128&g=1", "display_name": "A23149577", "link": "https://stackoverflow.com/users/1597059/a23149577"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 1, "accepted_answer_id": 48639058, "answer_count": 2, "score": 2, "last_activity_date": 1517907642, "creation_date": 1517877729, "question_id": 48633765, "link": "https://stackoverflow.com/questions/48633765/commit-on-top-of-a-custom-go-package", "title": "Commit on top of a custom GO package", "body": "<p>I am using <code>sha3</code> package inside a forked <code>go</code> project. I am using a special feature that does not exist in that package and I had to download a  file from <code>gist</code>, insert it into the <code>sha3</code> package and compile it.<br>\nEverything is working fine. However, anyone who wants to run my code, they have to get that file and insert it into standard <code>sha3</code> package first, install the package and run my project. \nWhat is the best way that I can include the <code>gist</code> file and <code>sha3</code> into my commit, so anyone can just clone and run it? Here is the file path:</p>\n\n<pre><code>workspace-\n         |_src__\n                |_github.com\n                |          |_myproject\n                |                     |_codes\n                |                     |_.git\n                |_golang.org\n                           |_x\n                             |_crypto\n                                    |_sha3\n                                         |_custom.go\n</code></pre>\n"}, {"tags": ["go", "certificate", "ssl-certificate", "x509certificate", "x509"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517875637, "post_id": 48633418, "comment_id": 84264051, "body": "What do you mean by &quot;human readable&quot;? Do you want to re-encode it in PEM format?"}, {"owner": {"reputation": 9123, "user_id": 1040718, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/u0SVy.jpg?s=128&g=1", "display_name": "cybertextron", "link": "https://stackoverflow.com/users/1040718/cybertextron"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517875979, "post_id": 48633418, "comment_id": 84264132, "body": "@JimB do you see how the output from the <code>fmt.Println(string(cert.Raw))</code> looks like? I want to have a human-readable format ... instead of <code>&quot;im?A*?;?N???^??o???&lt;?\u02c6???X0M?uv?F?k?X?N??V???w0?f\u7ef6#b?2 ?????C8?P)m?????O??RK?\u04f6~??#??#?\u03e0??m&lt;3[?u!?b#?]?1?d&quot;</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517880407, "post_id": 48633418, "comment_id": 84265181, "body": "But you&#39;re printing the &quot;Raw&quot; field, which is the original ASN.1 DER bytes. You already parsed the ASN.1 into the <code>Certificate</code>, which contains many human readable fields."}], "answers": [{"tags": [], "owner": {"reputation": 6997, "user_id": 834839, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/3846bd89a1d8366cd1b6b1cc40fd69d9?s=128&d=identicon&r=PG", "display_name": "canadadry", "link": "https://stackoverflow.com/users/834839/canadadry"}, "is_accepted": false, "score": 1, "last_activity_date": 1517890784, "creation_date": 1517890784, "answer_id": 48635424, "question_id": 48633418, "link": "https://stackoverflow.com/questions/48633418/decoding-a-x509-certificate-in-human-readable-format-golang/48635424#48635424", "title": "Decoding a X509 Certificate in Human readable format - Golang", "body": "<p>There is no <code>String() string</code> member function in <code>x509.Certificate</code> so you will need to write one yourself.</p>\n\n<p>e.g. </p>\n\n<pre><code>fmt.Println(cert.Subject)\nfmt.Println(cert.Issuer)\nfmt.Println(decodeAlgorithm(cert.PublicKeyAlgorithm))\n\n\nfunc decodeAlgorithm(code x509.PublicKeyAlgorithm) string {\n    var s string\n    switch code {\n    case x509.RSA:\n            s = \"RSA\"\n    case x509.DSA:\n            s = \"DSA\"\n    case x509.ECDSA:\n            s = \"ECDSA\"\n    default:\n            s = \"oops\"\n    }\n    return s\n}\n</code></pre>\n\n<p>When I ran this on *.google.com PEM, I get</p>\n\n<pre><code>{[US] [Google Inc] [] [] [] [] []  Google Internet Authority G2 [{2.5.4.6 US} {2.5.4.10 Google Inc} {2.5.4.3 Google Internet Authority G2}] []}\n{[US] [GeoTrust Inc.] [] [] [] [] []  GeoTrust Global CA [{2.5.4.6 US} {2.5.4.10 GeoTrust Inc.} {2.5.4.3 GeoTrust Global CA}] []}\nRSA\n</code></pre>\n"}], "owner": {"reputation": 9123, "user_id": 1040718, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/u0SVy.jpg?s=128&g=1", "display_name": "cybertextron", "link": "https://stackoverflow.com/users/1040718/cybertextron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2705, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1517890784, "creation_date": 1517874917, "question_id": 48633418, "link": "https://stackoverflow.com/questions/48633418/decoding-a-x509-certificate-in-human-readable-format-golang", "title": "Decoding a X509 Certificate in Human readable format - Golang", "body": "<p>I have the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/dsa\"\n    \"crypto/ecdsa\"\n    \"crypto/rsa\"\n    \"crypto/x509\"\n    \"encoding/pem\"\n    \"fmt\"\n)\n\nfunc main() {\n    // Verifying with a custom list of root certificates.\n\n    const rootPEM = `\n-----BEGIN CERTIFICATE-----\nMIIEBDCCAuygAwIBAgIDAjppMA0GCSqGSIb3DQEBBQUAMEIxCzAJBgNVBAYTAlVT\nMRYwFAYDVQQKEw1HZW9UcnVzdCBJbmMuMRswGQYDVQQDExJHZW9UcnVzdCBHbG9i\nYWwgQ0EwHhcNMTMwNDA1MTUxNTU1WhcNMTUwNDA0MTUxNTU1WjBJMQswCQYDVQQG\nEwJVUzETMBEGA1UEChMKR29vZ2xlIEluYzElMCMGA1UEAxMcR29vZ2xlIEludGVy\nbmV0IEF1dGhvcml0eSBHMjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB\nAJwqBHdc2FCROgajguDYUEi8iT/xGXAaiEZ+4I/F8YnOIe5a/mENtzJEiaB0C1NP\nVaTOgmKV7utZX8bhBYASxF6UP7xbSDj0U/ck5vuR6RXEz/RTDfRK/J9U3n2+oGtv\nh8DQUB8oMANA2ghzUWx//zo8pzcGjr1LEQTrfSTe5vn8MXH7lNVg8y5Kr0LSy+rE\nahqyzFPdFUuLH8gZYR/Nnag+YyuENWllhMgZxUYi+FOVvuOAShDGKuy6lyARxzmZ\nEASg8GF6lSWMTlJ14rbtCMoU/M4iarNOz0YDl5cDfsCx3nuvRTPPuj5xt970JSXC\nDTWJnZ37DhF5iR43xa+OcmkCAwEAAaOB+zCB+DAfBgNVHSMEGDAWgBTAephojYn7\nqwVkDBF9qn1luMrMTjAdBgNVHQ4EFgQUSt0GFhu89mi1dvWBtrtiGrpagS8wEgYD\nVR0TAQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAQYwOgYDVR0fBDMwMTAvoC2g\nK4YpaHR0cDovL2NybC5nZW90cnVzdC5jb20vY3Jscy9ndGdsb2JhbC5jcmwwPQYI\nKwYBBQUHAQEEMTAvMC0GCCsGAQUFBzABhiFodHRwOi8vZ3RnbG9iYWwtb2NzcC5n\nZW90cnVzdC5jb20wFwYDVR0gBBAwDjAMBgorBgEEAdZ5AgUBMA0GCSqGSIb3DQEB\nBQUAA4IBAQA21waAESetKhSbOHezI6B1WLuxfoNCunLaHtiONgaX4PCVOzf9G0JY\n/iLIa704XtE7JW4S615ndkZAkNoUyHgN7ZVm2o6Gb4ChulYylYbc3GrKBIxbf/a/\nzG+FA1jDaFETzf3I93k9mTXwVqO94FntT0QJo544evZG0R0SnU++0ED8Vf4GXjza\nHFa9llF7b1cq26KqltyMdMKVvvBulRP/F/A8rLIQjcxz++iPAsbw+zOzlTvjwsto\nWHPbqCRiOwY1nQ2pM714A5AuTHhdUDqB1O6gyHA43LL5Z/qHQF1hwFGPa4NrzQU6\nyuGnBXj8ytqU0CwIPX4WecigUCAkVDNx\n-----END CERTIFICATE-----`\n\n    const certPEM = `\n-----BEGIN CERTIFICATE-----\nMIIDujCCAqKgAwIBAgIIE31FZVaPXTUwDQYJKoZIhvcNAQEFBQAwSTELMAkGA1UE\nBhMCVVMxEzARBgNVBAoTCkdvb2dsZSBJbmMxJTAjBgNVBAMTHEdvb2dsZSBJbnRl\ncm5ldCBBdXRob3JpdHkgRzIwHhcNMTQwMTI5MTMyNzQzWhcNMTQwNTI5MDAwMDAw\nWjBpMQswCQYDVQQGEwJVUzETMBEGA1UECAwKQ2FsaWZvcm5pYTEWMBQGA1UEBwwN\nTW91bnRhaW4gVmlldzETMBEGA1UECgwKR29vZ2xlIEluYzEYMBYGA1UEAwwPbWFp\nbC5nb29nbGUuY29tMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEfRrObuSW5T7q\n5CnSEqefEmtH4CCv6+5EckuriNr1CjfVvqzwfAhopXkLrq45EQm8vkmf7W96XJhC\n7ZM0dYi1/qOCAU8wggFLMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAa\nBgNVHREEEzARgg9tYWlsLmdvb2dsZS5jb20wCwYDVR0PBAQDAgeAMGgGCCsGAQUF\nBwEBBFwwWjArBggrBgEFBQcwAoYfaHR0cDovL3BraS5nb29nbGUuY29tL0dJQUcy\nLmNydDArBggrBgEFBQcwAYYfaHR0cDovL2NsaWVudHMxLmdvb2dsZS5jb20vb2Nz\ncDAdBgNVHQ4EFgQUiJxtimAuTfwb+aUtBn5UYKreKvMwDAYDVR0TAQH/BAIwADAf\nBgNVHSMEGDAWgBRK3QYWG7z2aLV29YG2u2IaulqBLzAXBgNVHSAEEDAOMAwGCisG\nAQQB1nkCBQEwMAYDVR0fBCkwJzAloCOgIYYfaHR0cDovL3BraS5nb29nbGUuY29t\nL0dJQUcyLmNybDANBgkqhkiG9w0BAQUFAAOCAQEAH6RYHxHdcGpMpFE3oxDoFnP+\ngtuBCHan2yE2GRbJ2Cw8Lw0MmuKqHlf9RSeYfd3BXeKkj1qO6TVKwCh+0HdZk283\nTZZyzmEOyclm3UGFYe82P/iDFt+CeQ3NpmBg+GoaVCuWAARJN/KfglbLyyYygcQq\n0SgeDh8dRKUiaW3HQSoYvTvdTuqzwK4CXsr3b5/dAOY8uMuG/IAR3FgwTbZ1dtoW\nRvOTa8hYiU6A475WuZKyEHcwnGYe57u2I2KbMgcKjPniocj4QzgYsVAVKW3IwaOh\nyE+vPxsiUkvQHdO2fojCkY8jg70jxM+gu59tPDNbw3Uh/2Ij310FgTHsnGQMyA==\n-----END CERTIFICATE-----`\n\n    // First, create the set of root certificates. For this example we only\n    // have one. It's also possible to omit this in order to use the\n    // default root set of the current operating system.\n    roots := x509.NewCertPool()\n    ok := roots.AppendCertsFromPEM([]byte(rootPEM))\n    if !ok {\n        panic(\"failed to parse root certificate\")\n    }\n\n    block, _ := pem.Decode([]byte(certPEM))\n    if block == nil {\n        panic(\"failed to parse certificate PEM\")\n    }\n    cert, err := x509.ParseCertificate(block.Bytes)\n    if err != nil {\n        panic(\"failed to parse certificate: \" + err.Error())\n    }\n\n    // I want to print cert.Raw in human readable format\n    fmt.Println(string(cert.Raw))\n}\n</code></pre>\n\n<p>However, I keep getting something like:</p>\n\n<pre><code>0I10??}E*?H??0\n   0    UUS10U\n\n140529000000Z0i1oogle Internet Authority G20\n                0   UUS10U\n\nCalifornia10U\nMountain View10U\n\n\nGoogle Inc10U\n             mail.google.com0Y0*?H?*?H?=B}?n??&gt;??)???kG? ???DrK????\n7\u057e??h?y\n       ??9  ??I??oz\\?B?4u?????O0?K0U%+0U0?mail.google.com0\n                                                              U?0+\\0Z0+0?http://pki.google.com/GIAG2.crt0+0?http://clients1.google.com/ocsp0U??m?`.M??-~T`??*?0\n                U?00U#0?J??h?v????b?Z?/0U 00\n\n??X?pjL?Q7??s??v??!6??,&lt;/i.google.com/GIAG2.crl0\n\u0366``?jT+?I7?V??&amp;2??*?(D?\"im?A*?;?N???^??o???&lt;?\u02c6???X0M?uv?F?k?X?N??V???w0?f\u7ef6#b?2\n?????C8?P)m?????O??RK?\u04f6~??#??#?\u03e0??m&lt;3[?u!?b#?]?1?d\n                                                   ?\n</code></pre>\n\n<p>How can I get the human readable format for the certificate?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1517872393, "post_id": 48632988, "comment_id": 84263095, "body": "What do you want to happen when there&#39;s no data? Can you just check if there&#39;s data before you decode it?"}, {"owner": {"reputation": 670, "user_id": 2526272, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7b985bcaf7276d85432c92bc28726b9c?s=128&d=identicon&r=PG", "display_name": "Sap", "link": "https://stackoverflow.com/users/2526272/sap"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517887334, "post_id": 48632988, "comment_id": 84266723, "body": "I have several of these fields to check, so I was hoping for something more elegant, but that&#39;s my fall back."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1517903563, "creation_date": 1517903563, "answer_id": 48637983, "question_id": 48632988, "link": "https://stackoverflow.com/questions/48632988/go-unexpected-end-of-json-input-error/48637983#48637983", "title": "Go &quot;unexpected end of JSON input&quot; error", "body": "<blockquote>\n  <p>How can I get it to work with data and without?</p>\n</blockquote>\n\n<p>Unfortunately, you can't, with the standard library <code>json</code> package. It validates the JSON input before (while) decoding it, and an empty string is not valid JSON, so it will err before you even have a chance to decode with a custom unmarshaler.</p>\n\n<p>In this particular case, the only real option is to check for valid input first.  Of course, you can do this with a wrapping function if you want:</p>\n\n<pre><code>func myUnmarshal(input []byte, target interface{}) error {\n    if len(input) == 0 {\n        return nil\n    }\n    return json.Unmarshal(input, target)\n}\n</code></pre>\n"}], "owner": {"reputation": 670, "user_id": 2526272, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7b985bcaf7276d85432c92bc28726b9c?s=128&d=identicon&r=PG", "display_name": "Sap", "link": "https://stackoverflow.com/users/2526272/sap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2627, "favorite_count": 1, "accepted_answer_id": 48637983, "answer_count": 1, "score": -1, "last_activity_date": 1517903563, "creation_date": 1517872210, "last_edit_date": 1517872762, "question_id": 48632988, "link": "https://stackoverflow.com/questions/48632988/go-unexpected-end-of-json-input-error", "title": "Go &quot;unexpected end of JSON input&quot; error", "body": "<p>I know this has been asked a few times, but I don't see one that matches my need to support NULL values. I have fields that are optional in a DB. I need to output data in JSON format that includes these potentially NULL fields, which I would like to omit from the JSON if they are still NULL. I can change to some other default value other than NULL, but I haven't found one that works. I'm storing JSON arrays in JSON format (longtext) in MariaDB. Here's my code that fails (Playground <a href=\"https://play.golang.org/p/hLRh0d5D_CA\" rel=\"nofollow noreferrer\">link</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nvar respBytes = []byte(\"\")\n// Example data [12345, 23456, 34567]\n\nfunc main() {\n    var jsonData []interface{}\n    err := json.Unmarshal(respBytes, &amp;jsonData)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(jsonData)\n}\n</code></pre>\n\n<p>Replace <code>respBytes</code> empty string with example data and it works. Example data is simple JSON number array such as: \"[12345, 23456, 34567]\". How can I get it to work with data and without?</p>\n"}, {"tags": ["postgresql", "go", "pq"], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 4, "last_activity_date": 1518057009, "last_edit_date": 1518057009, "creation_date": 1517879743, "answer_id": 48634020, "question_id": 48632981, "link": "https://stackoverflow.com/questions/48632981/how-to-insert-numeric-field-type-using-lib-pq-driver/48634020#48634020", "title": "How to insert NUMERIC field type using lib/pq driver?", "body": "<p>First of all, you should use numeric placeholders (<code>$1</code>, <code>$2</code>, ...) with PostgreSQL since that's what it uses natively. As far as getting a bignum into a <code>numeric</code> column in the database, a quick run through the documentation and source suggests that your best bet is to use a string (which PostgreSQL will treat as a value of type \"unknown\") and let PostgreSQL parse it and cast it based on the (known) type of the column.</p>\n\n<p>So something like this:</p>\n\n<pre><code>difficulty := \"1111111111111111111111111111111111111111111111111111111111111111111111\"\n_, err = db.Exec(\"INSERT INTO bigtable (difficulty) VALUES ($1)\", difficulty)\n</code></pre>\n\n<p>A similar approach would apply to any other PostgreSQL types that the driver doesn't natively understand; there will always be a string representation that you can use to make it go.</p>\n\n<hr>\n\n<p>You could also <code>type SQLBigInt big.Int</code> and implement the <code>driver.Valuer</code> interface from <code>database/sql/driver</code>:</p>\n\n<pre><code>type SQLBigInt big.Int\nfunc (i *SQLBigInt) Value() (driver.Value, error) {\n    return (*big.Int)(i).String(), nil\n}\n\n// Or\ntype SQLBigInt struct {\n    big.Int\n}\nfunc (i *SQLBigInt) Value() (driver.Value, error) {\n    return i.String(), nil\n}\n</code></pre>\n\n<p>and then probably <code>sql.Scanner</code> from <code>\"database/sql\"</code> for reading but that could get ugly and might not be worth the effort as you'd be wrapping and unwrapping all the time anyway.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 2209495, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mMwFz.jpg?s=128&g=1", "display_name": "Oto", "link": "https://stackoverflow.com/users/2209495/oto"}, "is_accepted": false, "score": 0, "last_activity_date": 1584714798, "creation_date": 1584714798, "answer_id": 60776167, "question_id": 48632981, "link": "https://stackoverflow.com/questions/48632981/how-to-insert-numeric-field-type-using-lib-pq-driver/60776167#60776167", "title": "How to insert NUMERIC field type using lib/pq driver?", "body": "<p>you can implement valuer and scanner interface</p>\n\n<pre><code>//BigInt big.Int alias\n   type BigInt struct {\n      big.Int\n   }\n\n// Value implements the Valuer interface for BigInt\nfunc (b *BigInt) Value() (driver.Value, error) {\n   if b != nil {\n      return b.String(), nil\n   }\n   return nil, nil\n}\n\n// Scan implements the Scanner interface for BigInt\nfunc (b *BigInt) Scan(value interface{}) error {\n    var i sql.NullString\n    if err := i.Scan(value); err != nil {\n        return err\n    }\n    if _, ok := b.SetString(i.String, 10); ok {\n       return nil\n    }\n    return fmt.Errorf(\"Could not scan type %T into BigInt\", value)\n}\n</code></pre>\n"}], "owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1259, "favorite_count": 1, "accepted_answer_id": 48634020, "answer_count": 2, "score": 3, "last_activity_date": 1584714798, "creation_date": 1517872162, "last_edit_date": 1543661533, "question_id": 48632981, "link": "https://stackoverflow.com/questions/48632981/how-to-insert-numeric-field-type-using-lib-pq-driver", "title": "How to insert NUMERIC field type using lib/pq driver?", "body": "<p>I have a table where I have a field which stores a really big number (math.big, which is bigger than uint64). I am storing it in a DECIMAL type:</p>\n\n<pre><code>difficulty          NUMERIC     NOT NULL,\n</code></pre>\n\n<p>So, how do I insert this field from <code>Go</code> code using <code>PQ</code> library (<code>github.com/lib/pq</code>) ? </p>\n\n<p>This code does not work:</p>\n\n<pre><code>me@desk:~/src/github.com/myapp/misc$ cat insertbig.go\npackage main\n\nimport (\n    \"database/sql\"\n    _ \"github.com/lib/pq\"\n    \"os\"\n    \"log\"\n    \"math/big\"\n)\nfunc main() {\n    var err error\n    var db *sql.DB\n    std_out:=log.New(os.Stdout,\"\",0)\n\n    conn_str:=\"user='testuser' dbname='testdb' password='testpasswd'\";\n    db,err=sql.Open(\"postgres\",conn_str);\n    if (err!=nil) {\n        log.Fatal(err);\n    }\n    _,err=db.Exec(\"CREATE TABLE bigtable(difficulty NUMERIC)\");\n\n    difficulty:=big.NewInt(0);\n    difficulty.SetString(\"1111111111111111111111111111111111111111111111111111111111111111111111\",10);\n    _,err=db.Exec(\"INSERT INTO bigtable(difficulty) VALUES(?)\",difficulty);\n    if (err!=nil) {\n        log.Fatal(err);\n    } else {\n        std_out.Println(\"record was inserted\");\n    }\n}\n\nme@desk:~/src/github.com/myapp/misc$ \n</code></pre>\n\n<p>It gives me this error:</p>\n\n<pre><code>2018/02/05 17:00:25 sql: converting argument $1 type: unsupported type big.Int, a struct\n</code></pre>\n"}, {"tags": ["go", "protocol-buffers", "grpc", "protoc"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517865425, "post_id": 48631477, "comment_id": 84260277, "body": "Are you sure that&#39;s the exact interface? All the methods usually have a variadic set of <code>CallOptions</code> at the end (<code>opts ...grpc.CallOption</code>)."}, {"owner": {"reputation": 722, "user_id": 3072751, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/8J58M.jpg?s=128&g=1", "display_name": "thurt", "link": "https://stackoverflow.com/users/3072751/thurt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517865602, "post_id": 48631477, "comment_id": 84260380, "body": "@JimB I do see <code>(opts ...grpc.CallOption)</code> on the client methods, but not on the server methods"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517865877, "post_id": 48631477, "comment_id": 84260494, "body": "Oh yes, sorry -- I had that backwards."}], "answers": [{"comments": [{"owner": {"reputation": 722, "user_id": 3072751, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/8J58M.jpg?s=128&g=1", "display_name": "thurt", "link": "https://stackoverflow.com/users/3072751/thurt"}, "edited": false, "score": 0, "creation_date": 1517870696, "post_id": 48631997, "comment_id": 84262572, "body": "Thank you! that makes perfect sense. from the source code of <code>grpc.SetHeader</code> i can see there is still a stream connection but it is &quot;secretly&quot; attached to context"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1517867076, "creation_date": 1517867076, "answer_id": 48631997, "question_id": 48631477, "link": "https://stackoverflow.com/questions/48631477/how-to-define-response-headers-for-unary-rpc/48631997#48631997", "title": "How to define response headers for unary rpc", "body": "<p>See <a href=\"https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-metadata.md#sending-and-receiving-metadata---server-side\" rel=\"nofollow noreferrer\">Sending and receiving metadata - server side\n</a></p>\n\n<p>The request Context has the information to match the request with the connection. You use the <a href=\"https://godoc.org/google.golang.org/grpc#SetHeader\" rel=\"nofollow noreferrer\"><code>grpc.SetHeader</code></a> or <a href=\"https://godoc.org/google.golang.org/grpc#SendHeader\" rel=\"nofollow noreferrer\"><code>grpc.SendHeader</code></a> to write extra metadata from the server</p>\n\n<pre><code>func (s *server) SomeRPC(ctx context.Context, in *pb.someRequest) (*pb.someResponse, error) {\n    // create and send header\n    header := metadata.Pairs(\"header-key\", \"val\")\n    grpc.SendHeader(ctx, header)\n    // create and set trailer\n    trailer := metadata.Pairs(\"trailer-key\", \"val\")\n    grpc.SetTrailer(ctx, trailer)\n}\n</code></pre>\n"}], "owner": {"reputation": 722, "user_id": 3072751, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/8J58M.jpg?s=128&g=1", "display_name": "thurt", "link": "https://stackoverflow.com/users/3072751/thurt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3147, "favorite_count": 0, "accepted_answer_id": 48631997, "answer_count": 1, "score": 1, "last_activity_date": 1517872049, "creation_date": 1517864804, "last_edit_date": 1517872049, "question_id": 48631477, "link": "https://stackoverflow.com/questions/48631477/how-to-define-response-headers-for-unary-rpc", "title": "How to define response headers for unary rpc", "body": "<p>In Go, I want to set some response headers from inside my rpc handler implementation. Specifically, I want to set some headers related to cache control. </p>\n\n<p>However, when the rpc is defined as unary response, the method signature generated by protoc only includes the request context and request message. This is in contrast to the code generated from a streaming response, which includes the request message and a <code>grpc.ServerStream</code>.</p>\n\n<p>Here's an example interface generated by protoc:</p>\n\n<pre><code>type CmsServer interface {\n  GetPost(context.Context, *PostRequest) (*Post, error)\n  GetPosts(*GetPostsOptions, Cms_GetPostsServer) error\n}\n</code></pre>\n\n<p>In the example, <code>GetPosts</code> includes <code>Cms_GetPostsServer</code> parameter which is a <code>grpc.ServerStream</code> that appears to include methods to set custom response headers <a href=\"https://godoc.org/google.golang.org/grpc#ServerStream\" rel=\"nofollow noreferrer\">https://godoc.org/google.golang.org/grpc#ServerStream</a> (i have not tried this yet so correct me if this is wrong).</p>\n\n<p>Meanwhile, <code>GetPost</code> doesn't appear to have any way to set response headers just by looking at the method signature (context.Context is only the request context, not the response context). So how do i set custom response headers for a unary response?</p>\n"}, {"tags": ["go", "routing", "gorilla"], "comments": [{"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 1, "creation_date": 1517944109, "post_id": 48630547, "comment_id": 84298124, "body": "The answer that this is the supposed duplicate[1] of, does not answer Teodor&#39;s question. He is already using PathPrefix in his original code. 1:  <a href=\"https://stackoverflow.com/questions/43943038/serving-static-content-with-golang-webserver\" title=\"serving static content with golang webserver\">stackoverflow.com/questions/43943038/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 728, "user_id": 4037954, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/--gILOWEaIZI/AAAAAAAAAAI/AAAAAAAAAOg/y2s0YF-kvFQ/photo.jpg?sz=128", "display_name": "It Assistors", "link": "https://stackoverflow.com/users/4037954/it-assistors"}, "edited": false, "score": 0, "creation_date": 1605586983, "post_id": 48631426, "comment_id": 114689257, "body": "been pulling my hair for hours trying to figure this out and this helped me solve the problem in seconds. Thanks"}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "reply_to_user": {"reputation": 728, "user_id": 4037954, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/--gILOWEaIZI/AAAAAAAAAAI/AAAAAAAAAOg/y2s0YF-kvFQ/photo.jpg?sz=128", "display_name": "It Assistors", "link": "https://stackoverflow.com/users/4037954/it-assistors"}, "edited": false, "score": 0, "creation_date": 1605648290, "post_id": 48631426, "comment_id": 114714714, "body": "Glad I could help"}], "tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": false, "score": 12, "last_activity_date": 1517864645, "creation_date": 1517864645, "answer_id": 48631426, "question_id": 48630547, "link": "https://stackoverflow.com/questions/48630547/static-file-server-in-golang-using-gorilla-mux/48631426#48631426", "title": "Static file server in Golang using gorilla/mux", "body": "<p>I've had this exact setup on multiple occasions.</p>\n\n<p>You will need a file server that serves all static assets. A file server to serve your index.html file on all unhandled routes. A (I assume) a sub router for all API calls to your server.</p>\n\n<p>Here is an example that should match your file structure.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc main() {\n    r := mux.NewRouter()\n\n    // Handle API routes\n    api := r.PathPrefix(\"/api/\").Subrouter()\n    api.HandleFunc(\"/student\", func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintln(w, \"From the API\")\n    })\n\n    // Serve static files\n    r.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"./build/static/\"))))\n\n    // Serve index page on all unhandled routes\n    r.PathPrefix(\"/\").HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        http.ServeFile(w, r, \"./build/index.html\")\n    })\n\n    fmt.Println(\"http://localhost:8888\")\n    log.Fatal(http.ListenAndServe(\":8888\", r))\n}\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 6442045, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GbwhB5Lnpk8/AAAAAAAAAAI/AAAAAAAAADs/9LhKuI5RdKM/photo.jpg?sz=128", "display_name": "Teodor", "link": "https://stackoverflow.com/users/6442045/teodor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4549, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1518685733, "creation_date": 1517860871, "question_id": 48630547, "link": "https://stackoverflow.com/questions/48630547/static-file-server-in-golang-using-gorilla-mux", "title": "Static file server in Golang using gorilla/mux", "body": "<p>I have made a app where I need to serve the same files to multiple routes because the front end  is a React app. I have been using gorilla mux for the router.\nThe file structure is as follows:</p>\n\n<pre><code>main.go\nbuild/\n  | index.html\n  | service-worker.js\n     static/\n       |  js/\n           | main.js\n       |  css/\n           | main.css\n</code></pre>\n\n<p>The files are refereed to assuming they are at the root of the file directory. So in the html file they are requested like '/static/js/main.js'.</p>\n\n<p>In main my routes are defined as follows:</p>\n\n<pre><code>r.PathPrefix(\"/student\").Handler(http.StripPrefix(\"/student\",http.FileServer(http.Dir(\"build/\")))).Methods(\"GET\")\nr.PathPrefix(\"/\").Handler(http.FileServer(http.Dir(\"build/\"))).Methods(\"GET\")\n</code></pre>\n\n<p>This way I get the index.html file served in both the '/' and '/student' route. If I have them the other way around the '/student' path gets a 404 error. So what I am asking is there another way to serve the same content for both of these routes in order for me not have to define a route for each view I will have in my web app.</p>\n"}, {"tags": ["sql", "database", "go", "parameters"], "comments": [{"owner": {"reputation": 7330, "user_id": 4830196, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xcatD.jpg?s=128&g=1", "display_name": "Ryan Wilson", "link": "https://stackoverflow.com/users/4830196/ryan-wilson"}, "edited": false, "score": 0, "creation_date": 1517859631, "post_id": 48630209, "comment_id": 84257380, "body": "You could use XML, as it can have multiple nodes with your parameters"}, {"owner": {"reputation": 75598, "user_id": 226897, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/02f02fcd0e0adfd6f5d5d1d594a8953c?s=128&d=identicon&r=PG", "display_name": "Abe Miessler", "link": "https://stackoverflow.com/users/226897/abe-miessler"}, "reply_to_user": {"reputation": 7330, "user_id": 4830196, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xcatD.jpg?s=128&g=1", "display_name": "Ryan Wilson", "link": "https://stackoverflow.com/users/4830196/ryan-wilson"}, "edited": false, "score": 0, "creation_date": 1517869994, "post_id": 48630209, "comment_id": 84262318, "body": "How would I use XML @RyanWilson?"}], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 1, "last_activity_date": 1517872028, "creation_date": 1517872028, "answer_id": 48632953, "question_id": 48630209, "link": "https://stackoverflow.com/questions/48630209/is-it-possible-to-pass-in-an-array-of-parameters-instead-of-each-parameter-indiv/48632953#48632953", "title": "Is it possible to pass in an array of parameters instead of each parameter individually when executing a query?", "body": "<p>You almost have it. You just need to have <code>params</code> as an <code>[]interface{}</code> instead of <code>[]string</code>. Something more like this:</p>\n\n<pre><code>var params []interface{}\nparams = append(params, strs[0], strs[1])\n</code></pre>\n\n<p>or perhaps:</p>\n\n<pre><code>params := make([]interface{}, len(strs))\nfor i, s := range strs {\n    params[i] = s\n}\n</code></pre>\n\n<p>if you don't know ahead of time how many strings you'll have. Then later you can unpack/splat your <code>params</code> slice:</p>\n\n<pre><code>g.DB.Query(query, params...)\n</code></pre>\n\n<p>and it'll work as this version of <code>params</code> will have the right type.</p>\n"}], "owner": {"reputation": 75598, "user_id": 226897, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/02f02fcd0e0adfd6f5d5d1d594a8953c?s=128&d=identicon&r=PG", "display_name": "Abe Miessler", "link": "https://stackoverflow.com/users/226897/abe-miessler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 48632953, "answer_count": 1, "score": 0, "last_activity_date": 1517872028, "creation_date": 1517859507, "last_edit_date": 1517869205, "question_id": 48630209, "link": "https://stackoverflow.com/questions/48630209/is-it-possible-to-pass-in-an-array-of-parameters-instead-of-each-parameter-indiv", "title": "Is it possible to pass in an array of parameters instead of each parameter individually when executing a query?", "body": "<p>Does anyone know if its possible to pass in an array of parameters when you are executing a query instead of each parameter individually? So instead of:</p>\n\n<pre><code>query = \u201cselect * from grid where test1 = ? AND test2 = ?\u201d\ng.DB.Query(query, params[0], params[1])\n</code></pre>\n\n<p>Something like:</p>\n\n<pre><code>query = \u201cselect * from grid where test1 = ? AND test2 = ?\u201d\ng.DB.Query(query, params)\n</code></pre>\n\n<p>I tried unpacking the slice like this:</p>\n\n<pre><code>g.DB.Query(query, params...)\n</code></pre>\n\n<p>But got the error: </p>\n\n<blockquote>\n  <p>cannot use parameters (type []string) as type []interface {} in\n  argument to g.DB.Query</p>\n</blockquote>\n"}, {"tags": ["go", "logging", "timestamp"], "answers": [{"comments": [{"owner": {"reputation": 337, "user_id": 5075147, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/1cc012826cd46b0fee58b7757dcea8d4?s=128&d=identicon&r=PG", "display_name": "btald1331", "link": "https://stackoverflow.com/users/5075147/btald1331"}, "edited": false, "score": 1, "creation_date": 1517859612, "post_id": 48630122, "comment_id": 84257370, "body": "Thank you, this is exactly what I was looking for!"}, {"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "edited": false, "score": 0, "creation_date": 1528105596, "post_id": 48630122, "comment_id": 88364822, "body": "Can you please explain how it removes the timestamp based on the parameters you sent to <code>log.SetFlags(int)</code>?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "edited": false, "score": 1, "creation_date": 1528129472, "post_id": 48630122, "comment_id": 88379545, "body": "@FanusduToit  The expression <code>log.Flags() &amp;^ (log.Ldate | log.Ltime)</code> clears the Ldata and Ltime flags from the  current flags using the bit clear operator."}, {"owner": {"reputation": 1070, "user_id": 3053361, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c8b5270e788cbc81ab229b0b47b0a35e?s=128&d=identicon&r=PG&f=1", "display_name": "pabombs", "link": "https://stackoverflow.com/users/3053361/pabombs"}, "edited": false, "score": 0, "creation_date": 1543129760, "post_id": 48630122, "comment_id": 93801632, "body": "It looks like you can also use <code>log.SetFlags(0)</code>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 28, "last_activity_date": 1543129929, "last_edit_date": 1543129929, "creation_date": 1517859138, "answer_id": 48630122, "question_id": 48629988, "link": "https://stackoverflow.com/questions/48629988/remove-timestamp-prefix-from-go-logger/48630122#48630122", "title": "Remove Timestamp Prefix from Go Logger", "body": "<p>Use <a href=\"https://godoc.org/log#SetFlags\" rel=\"noreferrer\">log.SetFlags</a> to remove the timestamp.</p>\n\n<pre><code>log.SetFlags(log.Flags() &amp;^ (log.Ldate | log.Ltime))\n</code></pre>\n\n<p>The above removes the timestamp from whatever flags might be set.  To remove all flags, including the timestamp, use the following:</p>\n\n<pre><code>log.SetFlags(0)\n</code></pre>\n"}], "owner": {"reputation": 337, "user_id": 5075147, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/1cc012826cd46b0fee58b7757dcea8d4?s=128&d=identicon&r=PG", "display_name": "btald1331", "link": "https://stackoverflow.com/users/5075147/btald1331"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4688, "favorite_count": 2, "accepted_answer_id": 48630122, "answer_count": 1, "score": 11, "last_activity_date": 1543129929, "creation_date": 1517858603, "question_id": 48629988, "link": "https://stackoverflow.com/questions/48629988/remove-timestamp-prefix-from-go-logger", "title": "Remove Timestamp Prefix from Go Logger", "body": "<p>I am utilizing Go Logger and a third party library called lumberjack for file rotation:</p>\n\n<ul>\n<li><a href=\"https://golang.org/pkg/log/\" rel=\"noreferrer\">https://golang.org/pkg/log/</a></li>\n<li><a href=\"https://github.com/natefinch/lumberjack\" rel=\"noreferrer\">https://github.com/natefinch/lumberjack</a></li>\n</ul>\n\n<p>Code Setting up the logger: </p>\n\n<pre><code>log.SetOutput(&amp;lumberjack.Logger{\n  Filename:   \"/var/log/proxy.log\",\n  MaxSize:    1000, // megabytes\n  MaxBackups: 3,\n  MaxAge:     1, // days\n  Compress:   true, // disabled by default\n})\n</code></pre>\n\n<p>The logs I have are sensitive, so here is a hypothetical example of the output of a log: </p>\n\n<pre><code> 2018/02/05 19:00:08 \"My log\" \n</code></pre>\n\n<p>The logging schema for my company does not comply with having a timestamp in the front. I am gathering a different timestamp from other resources. I would like to remove the prefixed timestamp so that it only logs: </p>\n\n<pre><code>\"My log\"\n</code></pre>\n\n<p>I've looked through both links above, and looked through the source of the third party library lumberjack, and have not discovered a way to remove this. I saw the <code>SetPrefix()</code> funtion in the go log documentation. I tried doing the following to try and cancel the timestamp prefix, but it failed: </p>\n\n<pre><code>log.SetPrefix(\"\")\n</code></pre>\n\n<p>Is there any obvious or not so obvious way to remove the timestamp? </p>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1517858827, "post_id": 48629976, "comment_id": 84256957, "body": "Those quotes you provided are not valid Go syntax, please provide code that&#39;s valid. <a href=\"https://play.golang.org/p/StkVcAWayPu\" rel=\"nofollow noreferrer\">play.golang.org/p/StkVcAWayPu</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1517859008, "post_id": 48629976, "comment_id": 84257046, "body": "Not sure what db driver you&#39;re using but a placeholder in postgres looks like this: <code>$1</code> for first param, <code>$2</code> for second, and so on. <code>?</code> placeholders are mysql syntax. Using <code>?</code> with the <code>lib&#47;pq</code>, if that&#39;s what you&#39;re using, driver is not gonna work."}, {"owner": {"reputation": 46, "user_id": 1700018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f699645122af8c46d0b9ebb09584c0?s=128&d=identicon&r=PG", "display_name": "Varp", "link": "https://stackoverflow.com/users/1700018/varp"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1517859098, "post_id": 48629976, "comment_id": 84257090, "body": "As a workaround I can achieve that by using <code>fmt..Sprintf</code>, but it\u2019s not SQL injection safe, because I got param from for the <code>some_func</code> from user. If I would have separate sql escaping function in addition to raw <code>fmt.Sprintf</code> then may be I could be statisfied by such workaround"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1517859115, "post_id": 48629976, "comment_id": 84257102, "body": "Finally, most db drivers evaluate your parameters and substitute the placeholders according the their type automatically, meaning that you don&#39;t have to worry about putting quotes around it yourself, that&#39;s the driver&#39;s job."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1517859389, "post_id": 48629976, "comment_id": 84257253, "body": "Given your update, and assuming you&#39;re using <code>lib&#47;pq</code>, you should do this <code>Db.QueryRow(&quot;select * from some_func($1)&quot;, p1)</code>."}, {"owner": {"reputation": 46, "user_id": 1700018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f699645122af8c46d0b9ebb09584c0?s=128&d=identicon&r=PG", "display_name": "Varp", "link": "https://stackoverflow.com/users/1700018/varp"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1517859444, "post_id": 48629976, "comment_id": 84257281, "body": "@mkopriva I&#39;ve also tried with $1 placeholders. It&#39;s also not work, I think the db driver not properly guess params for <code>some_func</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1517859521, "post_id": 48629976, "comment_id": 84257316, "body": "Please provide the error you get when you use <code>$1</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1517859601, "post_id": 48629976, "comment_id": 84257367, "body": "Please also provide what driver you are using."}, {"owner": {"reputation": 46, "user_id": 1700018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f699645122af8c46d0b9ebb09584c0?s=128&d=identicon&r=PG", "display_name": "Varp", "link": "https://stackoverflow.com/users/1700018/varp"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1517860291, "post_id": 48629976, "comment_id": 84257759, "body": "@mkopriva you were right about <code>$1</code> PostgresSQL placeholders. I carefully refactored the code and the problem is gone. Now params is properly quoted. I was getting error when just replacing <code>?</code> with <code>$</code>. THX!!!"}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 1, "creation_date": 1517860406, "post_id": 48629976, "comment_id": 84257838, "body": "Different error message than the duplicate but the same underlying problem: PostgreSQL uses numbered placeholders natively, not positional question marks."}, {"owner": {"reputation": 46, "user_id": 1700018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f699645122af8c46d0b9ebb09584c0?s=128&d=identicon&r=PG", "display_name": "Varp", "link": "https://stackoverflow.com/users/1700018/varp"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1518079125, "post_id": 48629976, "comment_id": 84359008, "body": "<code>res, err := DB.Exec(&quot;COPY spark_phones (inn, phone) FROM $1&quot;, csvName)</code>  @mkopriva what about that query?? I&#39;m getting error, <code>syntax error at $1</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1518079767, "post_id": 48629976, "comment_id": 84359353, "body": "@Varp try <code>DB.Exec(`EXECUTE &quot;COPY spark_phones (inn, phone) FROM &quot; || $1`, csvName)</code> use backtics for the execute string so that you don&#39;t have to escape the inner quotes."}], "owner": {"reputation": 46, "user_id": 1700018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f699645122af8c46d0b9ebb09584c0?s=128&d=identicon&r=PG", "display_name": "Varp", "link": "https://stackoverflow.com/users/1700018/varp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "closed_date": 1517860341, "answer_count": 0, "score": 0, "last_activity_date": 1517859313, "creation_date": 1517858558, "last_edit_date": 1517859313, "question_id": 48629976, "link": "https://stackoverflow.com/questions/48629976/replace-query-placeholder-with-single-quoted-value", "closed_reason": "Duplicate", "title": "Replace query placeholder with single-quoted value", "body": "<p>I have the simple query in Go:</p>\n\n<pre><code>import \"database/sql\"\n\nDb, err := sql.Open(...)\np1 := \"string param\"\nDb.QueryRow(\"select * from some_func(?)\", p1)\n</code></pre>\n\n<p>The <code>some_func</code> accepts string param. In terms of PGsql it is a single-quoted text: <code>'some val'</code>. </p>\n\n<p>To achieve passing single quoted param I did the following: <code>Db.QueryRow(\"select * from some_func('?')\", p1)</code>. I\u2019ve wrapped <code>?</code> with single quotes. But I\u2019m getting error: 1 parameter is passed when expecting 0</p>\n"}, {"tags": ["ios", "api", "google-app-engine", "go", "apple-push-notifications"], "answers": [{"tags": [], "owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "is_accepted": false, "score": 0, "last_activity_date": 1518023438, "creation_date": 1518023438, "answer_id": 48669551, "question_id": 48628340, "link": "https://stackoverflow.com/questions/48628340/why-is-apns-push-notification-not-working-for-all-iphones/48669551#48669551", "title": "Why is Apns Push Notification not working for all iPhones", "body": "<p>The library you're referencing has <a href=\"https://github.com/jayceecam/apns\" rel=\"nofollow noreferrer\">not been updated since Aug 2015</a>, and <a href=\"https://github.com/Coccodrillo/apns\" rel=\"nofollow noreferrer\">the library that it was forked from</a> (also not updated since 2015) has a github issue asking <a href=\"https://github.com/Coccodrillo/apns/issues/31\" rel=\"nofollow noreferrer\">how could it be used on App Engine</a>.</p>\n\n<p>I would suggest a more active and updated library to handle APNs (<a href=\"https://godoc.org/?q=apns\" rel=\"nofollow noreferrer\">here are some alternatives</a>), although some indicate <a href=\"https://github.com/sideshow/apns2/pull/31\" rel=\"nofollow noreferrer\">further issues</a> when using this from GAE.</p>\n\n<p>If you want to do this, dig into the library you're importing, check the open issues, and try to find a library that specifically claims to be supported in GAE.</p>\n"}], "owner": {"reputation": 3, "user_id": 6280219, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-XokAgSVgnRc/AAAAAAAAAAI/AAAAAAAAA5I/qAz0nDBEmKA/photo.jpg?sz=128", "display_name": "Yogesh Bhardwaj", "link": "https://stackoverflow.com/users/6280219/yogesh-bhardwaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1518023438, "creation_date": 1517852317, "last_edit_date": 1517853422, "question_id": 48628340, "link": "https://stackoverflow.com/questions/48628340/why-is-apns-push-notification-not-working-for-all-iphones", "title": "Why is Apns Push Notification not working for all iPhones", "body": "<p>I am using jayceecam/apns in app engine golang api for sending push notification for iOS device. It works fine for some devices. For others it results INVALID_TOKEN error. If the device token is saved by common  procedure for two different device, it works on one, but does not works for the other. Is there any iOS version related issue? library issue? or is anything wrong  with the certificate.</p>\n\n<p>Can anyone help me?</p>\n"}, {"tags": ["dictionary", "go", "struct"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 4, "creation_date": 1517851179, "post_id": 48627868, "comment_id": 84252876, "body": "Write <code>NewTop</code> and <code>NewMiddle</code> and <code>NewBase</code> respectively. What have you tried and what problem did you meet?"}, {"owner": {"reputation": 311, "user_id": 7827654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grT6b.jpg?s=128&g=1", "display_name": "Xeizzeth", "link": "https://stackoverflow.com/users/7827654/xeizzeth"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517935826, "post_id": 48627868, "comment_id": 84293560, "body": "Could you please write a simple example? I don&#39;t quite follow."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517935925, "post_id": 48627868, "comment_id": 84293624, "body": "What problem do you have? When trying what?"}, {"owner": {"reputation": 311, "user_id": 7827654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grT6b.jpg?s=128&g=1", "display_name": "Xeizzeth", "link": "https://stackoverflow.com/users/7827654/xeizzeth"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517936285, "post_id": 48627868, "comment_id": 84293865, "body": "I have a problem with not understanding of how to properly code that, frankly speaking.   I understand that I perhaps should create concrete objects of respective structs, but how to properly write that?"}], "answers": [{"comments": [{"owner": {"reputation": 311, "user_id": 7827654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grT6b.jpg?s=128&g=1", "display_name": "Xeizzeth", "link": "https://stackoverflow.com/users/7827654/xeizzeth"}, "edited": false, "score": 1, "creation_date": 1517935422, "post_id": 48633137, "comment_id": 84293279, "body": "Yes, but if I try to assign and integer like that: <code>top.middleObjects[5].baseObjects[3].base[0] = 10</code>  it will panic with <b>panic: assignment to entry in nil map</b>.  And if I try to make a map like that: <code>top.middleObjects[5].baseObjects[3].base = make(map[int8]uint64)</code>  It willl panic this way: <b>cannot assign to struct field top.middleObjects[5].baseObjects[3].base in map</b>"}, {"owner": {"reputation": 311, "user_id": 7827654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grT6b.jpg?s=128&g=1", "display_name": "Xeizzeth", "link": "https://stackoverflow.com/users/7827654/xeizzeth"}, "edited": false, "score": 1, "creation_date": 1517941550, "post_id": 48633137, "comment_id": 84296819, "body": "Thank you very much for your help. I&#39;ll take a look at the example you&#39;ve provided."}], "tags": [], "owner": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "is_accepted": false, "score": 1, "last_activity_date": 1517938690, "last_edit_date": 1517938690, "creation_date": 1517873128, "answer_id": 48633137, "question_id": 48627868, "link": "https://stackoverflow.com/questions/48627868/initialize-deep-map-nesting-in-go-structs/48633137#48633137", "title": "Initialize deep map nesting in go structs", "body": "<p>Simply initialize the topmost struct <code>Top</code> with an empty map as value for its <code>middleObjects</code> property, calling any index on an empty map returns a zero value for the type the map holds.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Base struct {\n    base map[int8]uint64\n}\n\ntype Middle struct {\n    baseObjects map[int8]Base\n}\n\ntype Top struct {\n    middleObjects map[int8]Middle\n}\n\nfunc main() {\n    top := Top{\n        middleObjects: make(map[int8]Middle),\n    }\n\n    // Outputs: \"Top: {map[]}\"\n    fmt.Printf(\"Top: %v\\n\", top)\n\n    // Outputs: \"Base element: 0\"\n    fmt.Printf(\"Base element: %v\\n\", top.middleObjects[5].baseObjects[3].base[0])\n}\n</code></pre>\n\n<p>Run the example <a href=\"https://play.golang.org/p/ldIpWtTjQ1M\" rel=\"nofollow noreferrer\">here</a></p>\n\n<hr>\n\n<p>Edit:</p>\n\n<p>You could also initialize the <code>Top</code> struct with a couple of elements, in any case it depends on how many elements you require each map to have at initialization:</p>\n\n<pre><code>func main() {\n    top := Top{\n        middleObjects: map[int8]Middle{\n            0: Middle{\n                baseObjects: map[int8]Base{\n                    0: Base{\n                        base: map[int8]uint64{\n                            0: 1234,\n                        },\n                    },\n                },\n            },\n        },\n    }\n\n    // After that you have to add one by one\n    top.middleObjects[5] = Middle{\n        baseObjects: map[int8]Base{\n            0: Base{\n                base: map[int8]uint64{\n                    0: 123456,\n                },\n            },\n        },\n    }\n    // If there's a middleObject with that index\n    top.middleObjects[0].baseObjects[1] = Base{\n        base: map[int8]uint64{\n            0: 1111,\n        },\n    }\n\n    // Outputs: \"Base element: 1234\"\n    fmt.Printf(\"Base element: %v\\n\", top.middleObjects[0].baseObjects[0].base[0])\n    // Outputs: \"Base element: 123456\"\n    fmt.Printf(\"Base element: %v\\n\", top.middleObjects[5].baseObjects[0].base[0])\n    // Outputs: \"Base element: 1111\"\n    fmt.Printf(\"Base element: %v\\n\", top.middleObjects[0].baseObjects[1].base[0])\n\n    top.middleObjects[0].baseObjects[0].base[0] = 2222\n    // Outputs: \"Base element: 2222\"\n    fmt.Printf(\"Base element: %v\\n\", top.middleObjects[0].baseObjects[0].base[0])\n}\n</code></pre>\n\n<p>Run example <a href=\"https://play.golang.org/p/zrZa-8JCSfH\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"comments": [{"owner": {"reputation": 311, "user_id": 7827654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grT6b.jpg?s=128&g=1", "display_name": "Xeizzeth", "link": "https://stackoverflow.com/users/7827654/xeizzeth"}, "edited": false, "score": 0, "creation_date": 1517941215, "post_id": 48649135, "comment_id": 84296678, "body": "I really grateful to you for that example. Will take that into consideration."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 2, "last_activity_date": 1517939717, "creation_date": 1517939717, "answer_id": 48649135, "question_id": 48627868, "link": "https://stackoverflow.com/questions/48627868/initialize-deep-map-nesting-in-go-structs/48649135#48649135", "title": "Initialize deep map nesting in go structs", "body": "<p>What you want is auctually a map with default value that is not zero value, but a value ready to use, in this case, a made map.</p>\n\n<p>Before going to the solution, there auctually is an issue about go here: <a href=\"https://github.com/golang/go/issues/3117\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/3117</a></p>\n\n<p>For reasons, Go now does not support to assign to a field of a struct if the struct is stored in a map.</p>\n\n<p>To solve the issue, you need to use a pointer to that struct, and store the pointer in the map instead. So your data structure needs to be changed like:</p>\n\n<pre><code>type Base struct {\n    base map[int8]uint64\n}\n\ntype Middle struct {\n    baseObjects map[int8]*Base\n}\n\ntype Top struct {\n    middleObjects map[int8]*Middle\n}\n</code></pre>\n\n<p>And to the core logic: a defualt value map. Go does not support that with plain maps, but we can extend it, using methods to wrap it around.</p>\n\n<pre><code>func (t Top) Get(i int8) *Middle {\n    x, ok := t.middleObjects[i]\n    if !ok {\n        v := NewMiddle()\n        t.middleObjects[i] = v\n        return v\n    }\n\n    return x\n}\n\nfunc (m Middle) Get(i int8) *Base {\n    x, ok := m.baseObjects[i]\n    if !ok {\n        v := NewBase()\n        m.baseObjects[i] = v\n        return v\n    }\n\n    return x\n}\n</code></pre>\n\n<p>When we are trying to get a value, we first check if it exists. If not, we return a new constructed one, and if it did exist, return the value.</p>\n\n<p>Usage:</p>\n\n<pre><code>t.Get(8).Get(9).base[10] = 14\n</code></pre>\n\n<p>Playground example: <a href=\"https://play.golang.org/p/0JSN0yjRPif\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0JSN0yjRPif</a></p>\n"}], "owner": {"reputation": 311, "user_id": 7827654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grT6b.jpg?s=128&g=1", "display_name": "Xeizzeth", "link": "https://stackoverflow.com/users/7827654/xeizzeth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 439, "favorite_count": 1, "accepted_answer_id": 48649135, "answer_count": 2, "score": 2, "last_activity_date": 1517939717, "creation_date": 1517850586, "question_id": 48627868, "link": "https://stackoverflow.com/questions/48627868/initialize-deep-map-nesting-in-go-structs", "title": "Initialize deep map nesting in go structs", "body": "<p>To initialize a map in a struct one should do the following:</p>\n\n<pre><code>someStruct.nestedMap = make(map[int8]int8)\n</code></pre>\n\n<p>But what should you do if you have a code structure like this:</p>\n\n<pre><code>type Base struct {\n    base map[int8]uint64\n}\n\ntype Middle struct {\n    baseObjects map[int8]Base\n}\n\ntype Top struct {\n    middleObjects map[int8]Middle\n}\n</code></pre>\n\n<p>There we have a total of 3 structs where each has a struct as a key.\nHow do you initialize this, and make it ready to go?</p>\n"}, {"tags": ["api", "go", "mux"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517851650, "post_id": 48627636, "comment_id": 84253117, "body": "Please clarify what <code>mux</code> package you are using."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517853452, "post_id": 48627636, "comment_id": 84254091, "body": "@leafbebop I&#39;m using the latest of <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\">github.com/gorilla/mux</a>"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1517855557, "post_id": 48627636, "comment_id": 84255250, "body": "Unrelated, but this is terrible practice: <code>router := router.NewRouter(&amp;context, routes, notFoundHandler)</code>.  You&#39;re shadowing the <code>router</code> package with the <code>router</code> variable.  Name them differently.  As a matter of practice, it&#39;s recommended to <i>not</i> name your packages after what someone would naturally name the type from that package.  Instead of router, use the <code>routing</code> name you specified in the OP.  Will make for less confusing code."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1517855796, "post_id": 48627636, "comment_id": 84255378, "body": "Thanks.  New to golang. That was unintentional and I&#39;ll rename it. The whole point of what I&#39;m trying to do is passing the database into the handlers.  Go is forcing me to separate everything into packages but fundamentally, the pieces are a single package so I&#39;m having a hard time finding a good structure."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1517856321, "post_id": 48627636, "comment_id": 84255638, "body": "You <i>can</i> put them all in the same package, if you want.  Separating them can be good practice, as it lets you isolate concerns better, but there&#39;s nothing in Go that <i>forces</i> you to separate code into packages, unless you want to have the documentation benefits of separate namespaces."}, {"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1517856878, "post_id": 48627636, "comment_id": 84255930, "body": "Yeah, I&#39;m trying to put them in separate packages but you need to have a very good understanding of application structure before you begin which is good but it&#39;s definitely a challenge.  I didn&#39;t image that sharing a db connection downstream to handlers would be this challenging.  One thing I miss from my background in Rails is a canonical structure."}], "answers": [{"comments": [{"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1517857546, "post_id": 48629593, "comment_id": 84256294, "body": "Ahh that makes so much sense!  Thanks for the example.  I will test this out later but based upon your playground I think this is absolutely right.  I&#39;m wondering if this pattern I have of setting a bunch of routes iteratively is actually a good approach."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1517857779, "post_id": 48629593, "comment_id": 84256433, "body": "I&#39;ve seen worse.  It allows you to specify your routes in <code>main</code> while actually handling attaching them to the router in your routing package.  That&#39;s good design, because there&#39;s no real reason your routing package should be the one managing your route associations."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 1, "creation_date": 1517857957, "post_id": 48629593, "comment_id": 84256510, "body": "This is also a pretty common problem in JavaScript when you&#39;re creating a bunch of callback function closures in a loop. Looks like the same solutions apply in Go: use another function (named or anonymous) to build the callback function and force the loop variables to be evaluated rather than closed over."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1517858080, "post_id": 48629593, "comment_id": 84256585, "body": "Yep, you could move the entire piece inside the loop into another named function that accepts the <code>router</code> (as a pointer) and the <code>route</code> (as a struct), and simply call that function inside the loop.  Since the <code>route</code> argument would be being passed as a value, it would automagically be copied and the reuse issues would disappear."}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 2, "last_activity_date": 1517856980, "creation_date": 1517856980, "answer_id": 48629593, "question_id": 48627636, "link": "https://stackoverflow.com/questions/48627636/golang-api-only-matches-last-route/48629593#48629593", "title": "Golang Api Only Matches Last Route", "body": "<p>Reading through your code and gorilla/mux, I think I know the issue.  You're using the for loop variable <code>route</code>, and specifically its field HanderFunc, in the function literal, but because of how function literals work, the <em>value</em> of that field is not evaluated until the that function literal is called.  In Go, the second variable in a range loop is <em>reused</em> on each iteration, rather than created anew, and so after the for loop, if it's still in scope of anything (like your function literal), it will contain the value of the <em>last</em> loop iteration.  Here's an example of what I mean:</p>\n\n<p><a href=\"https://play.golang.org/p/Xx62tuwhtgG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Xx62tuwhtgG</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var funcs []func()\n    ints := []int{1, 2, 3, 4, 5}\n\n    // How you're doing it\n    for i, a := range ints {\n        fmt.Printf(\"Loop i: %v, a: %v\\n\", i, a)\n        funcs = append(funcs, func() {\n            fmt.Printf(\"Lambda i: %v, a: %v\\n\", i, a)\n        })\n    }\n\n    for _, f := range funcs {\n        f()\n    }\n\n    fmt.Println(\"-------------\")\n\n    // How you *should* do it\n    funcs = nil\n    for i, a := range ints {\n        i := i\n        a := a\n        fmt.Printf(\"Loop i: %v, a: %v\\n\", i, a)\n        funcs = append(funcs, func() {\n            fmt.Printf(\"Lambda i: %v, a: %v\\n\", i, a)\n        })\n    }\n\n    for _, f := range funcs {\n        f()\n    }\n}\n</code></pre>\n\n<p>In the first example, <code>i</code> and <code>a</code> are being reused on each loop iteration, and aren't evaluated for their values in the lambda (function literal) until that lambda is actually <em>called</em> (by the <code>funcs</code> loop).  To fix that, you can shadow <code>a</code> and <code>i</code> by redeclaring them <em>inside</em> the scope of the loop iteration (but outside the lambda's scope).  This makes a separate copy for each iteration, to avoid issues with reuse of the same variable.</p>\n\n<p>Specifically for your code, if you change your code to the following, it should work:</p>\n\n<pre><code>for _, route := range routes {\n    route := route // make a copy of the route for use in the lambda\n    // or alternatively, make scoped vars for the name and handler func\n\n    router.\n        PathPrefix(\"/api\").\n        Methods(route.Method).\n        Path(route.Pattern).\n        Name(route.Name).\n        // TODO: fix HandlerFunc. Right now, it is overriding previous routes and setting a single handler for all\n        // this means that the last route is the only router with a handler\n        HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            logRoute(setJSONHeader(route.HandlerFunc), route.Name)(context, w, r)\n        })\n}\n</code></pre>\n"}], "owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 0, "accepted_answer_id": 48629593, "answer_count": 1, "score": 0, "last_activity_date": 1517856980, "creation_date": 1517849868, "last_edit_date": 1517853786, "question_id": 48627636, "link": "https://stackoverflow.com/questions/48627636/golang-api-only-matches-last-route", "title": "Golang Api Only Matches Last Route", "body": "<p>I have a golang api application. I've defined a set of routes and handlers. However, the mux router only ever returns the last route. </p>\n\n<p>When I request <code>/api/info</code> I get this in my logging: </p>\n\n<p><code>9:0:38 app | 2018/02/05 09:00:38 GET /api/info Users Create 308.132\u00b5s</code></p>\n\n<p>Why is that routing to the wrong route?</p>\n\n<p>routing package:</p>\n\n<pre><code>// NewRouter establishes the root application router\nfunc NewRouter(context *config.ApplicationContext, routes Routes, notFoundHandler http.HandlerFunc) *mux.Router {\n    router := mux.NewRouter()\n\n    router.NotFoundHandler = notFoundHandler\n\n    for _, route := range routes {\n        router.\n            PathPrefix(\"/api\").\n            Methods(route.Method).\n            Path(route.Pattern).\n            Name(route.Name).\n            // TODO: fix HandlerFunc. Right now, it is overriding previous routes and setting a single handler for all\n            // this means that the last route is the only router with a handler\n            HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n                logRoute(setJSONHeader(route.HandlerFunc), route.Name)(context, w, r)\n            })\n\n    }\n\n    return router\n}\n\nfunc logRoute(inner ContextHandlerFunc, name string) ContextHandlerFunc {\n    return func(c *config.ApplicationContext, w http.ResponseWriter, r *http.Request) {\n        start := time.Now()\n\n        inner(c, w, r)\n\n        log.Printf(\n            \"%s\\t%s\\t%s\\t%s\",\n            r.Method,\n            r.RequestURI,\n            name,\n            time.Since(start),\n        )\n    }\n}\n\nfunc setJSONHeader(inner ContextHandlerFunc) ContextHandlerFunc {\n    return func(c *config.ApplicationContext, w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        inner(c, w, r)\n    }\n}\n</code></pre>\n\n<p>main package:</p>\n\n<pre><code>var context = config.ApplicationContext{\n    Database: database.NewDatabase().Store,\n}\n\nvar routes = router.Routes{\n    router.Route{\"Info\", \"GET\", \"/info\", handlers.InfoShow},\n    router.Route{\"Users Create\", \"POST\", \"/users/create\", handlers.UsersCreate},\n}\n\nfunc main() {    \n    notFoundHandler := handlers.Errors404\n    router := router.NewRouter(&amp;context, routes, notFoundHandler)\n\n    port := os.Getenv(\"PORT\")\n\n    log.Fatal(http.ListenAndServe(\":\"+port, router))\n}\n</code></pre>\n\n<p>If I visit <code>/api/info</code> it will attempt to call a POST to <code>/users/create</code>.  However, if I remove the second route, it will correctly route to the <code>InfoShow</code> handler.  </p>\n\n<p>Why is mux overriding the first route?  I'm fairly certain there's something wrong with </p>\n\n<pre><code>HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    logRoute(setJSONHeader(route.HandlerFunc), route.Name)(context, w, r)\n}) \n</code></pre>\n\n<p>but I'm not sure why that would cause it to map over the first route.</p>\n\n<p>Ideas?  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 3, "creation_date": 1517850680, "post_id": 48627119, "comment_id": 84252595, "body": "Vet is yelling because it can&#39;t verify that the parent cancel occurs.  Realistically, there&#39;s no reason to discard the cancel rather than simply deferring it.  Just because the parent cancel is <i>currently</i> being called doesn&#39;t mean that will always be the case, or something else won&#39;t break it.  It&#39;s always good practice to defer your cancels, even if you know they&#39;ll always be canceled, because it doesn&#39;t really cost you anything, and it can save debugging and headache later.  Most memory leaks come from changes with unexpected side effects elsewhere."}, {"owner": {"reputation": 4072, "user_id": 2068077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b5610681612bdc756a85d009e399f33?s=128&d=identicon&r=PG", "display_name": "ivoszz", "link": "https://stackoverflow.com/users/2068077/ivoszz"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1517854016, "post_id": 48627119, "comment_id": 84254384, "body": "I cannot defer the cancel in the function Poo because it immediately quit the parent function Foo. I can save the cancel into a package variable and call it from the outside function later or do some other event syncing, but if it is not necessary I will prefer discarding the cancel function."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517854434, "post_id": 48627119, "comment_id": 84254619, "body": "You can do the same thing <code>WithTimeout</code> does and return the cancel function from <code>Poo</code>, and let <code>Poo</code>&#39;s caller defer it."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1517857645, "post_id": 48627119, "comment_id": 84256361, "body": "Canceling a child context does not cancel the parent context.  Cancelations propagate downward, not upward: <a href=\"https://play.golang.org/p/hiBFTT04yVJ\" rel=\"nofollow noreferrer\">play.golang.org/p/hiBFTT04yVJ</a>.  If you cancel in Foo, Poo will exit early.  If you cancel in Poo, Foo is unaffected."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1517857937, "post_id": 48627119, "comment_id": 84256497, "body": "Ahhh, you&#39;re directly <i>altering</i> the context in your <code>l</code> variable, rather than retaining a different copy.  Problematic design."}, {"owner": {"reputation": 4072, "user_id": 2068077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b5610681612bdc756a85d009e399f33?s=128&d=identicon&r=PG", "display_name": "ivoszz", "link": "https://stackoverflow.com/users/2068077/ivoszz"}, "edited": false, "score": 0, "creation_date": 1517869786, "post_id": 48627119, "comment_id": 84262232, "body": "Yes, it is problematic design, but otherwise gopher-lua is an outstanding package, so I have to deal with it. I need to modify timeout directly from lua script (probably not so common requirement)."}], "owner": {"reputation": 4072, "user_id": 2068077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b5610681612bdc756a85d009e399f33?s=128&d=identicon&r=PG", "display_name": "ivoszz", "link": "https://stackoverflow.com/users/2068077/ivoszz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 253, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1517848260, "creation_date": 1517848260, "question_id": 48627119, "link": "https://stackoverflow.com/questions/48627119/how-to-properly-shorten-deadline-in-context", "title": "How to properly shorten deadline in context", "body": "<p>I am aware that this is not the proper use of a context package, but I am using gopher-lua and I am not able to find better solution. </p>\n\n<p>I am calling a function with a context parameter (lua.NewState with the context set) and I am properly canceling the context.</p>\n\n<pre><code>ctx, cancel := context.WithDeadline(context.Background(), deadline)\ndefer cancel()\nFoo(ctx, parameters)\n</code></pre>\n\n<p>But somewhere <strong>inside</strong> the function <em>Foo</em> in another subfunction <em>Poo</em> I need to cut the deadline a little bit. I am using:</p>\n\n<pre><code>func Poo(l *lua.LState, timeout time.Duration) {\n    ctx, cancel := context.WithTimeout(l.Context(), timeout)\n    l.SetContext(ctx)\n}\n</code></pre>\n\n<p>However, I am not sure if I have to call the cancel function from function <em>Poo</em> to avoid a memory leak. In current code I am discarding the cancel, because the parent cancel is always called and propagated downwards. Go vet complains about discarding the cancel, but it probably misses the point.</p>\n\n<p>Is my idea good enough or should I find better solution?</p>\n"}, {"tags": ["go", "yocto", "abi", "mismatch", "recipe"], "answers": [{"comments": [{"owner": {"reputation": 2776, "user_id": 1987437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/508e14a7e9414311eff04b2fd8d20ed6?s=128&d=identicon&r=PG", "display_name": "Liam Kelly", "link": "https://stackoverflow.com/users/1987437/liam-kelly"}, "edited": false, "score": 1, "creation_date": 1520455681, "post_id": 48638433, "comment_id": 85327410, "body": "The values are hard coded in <code>goarch.bbclass</code>. I found the only way to get around this is to make a <code>go-runtime_%.bbappend</code> file and copy your version of the <code>do_compile</code> function."}, {"owner": {"reputation": 1722, "user_id": 5151792, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/463805ba3eae4866f5b40151249db4e4?s=128&d=identicon&r=PG&f=1", "display_name": "aicastell", "link": "https://stackoverflow.com/users/5151792/aicastell"}, "reply_to_user": {"reputation": 2776, "user_id": 1987437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/508e14a7e9414311eff04b2fd8d20ed6?s=128&d=identicon&r=PG", "display_name": "Liam Kelly", "link": "https://stackoverflow.com/users/1987437/liam-kelly"}, "edited": false, "score": 0, "creation_date": 1520511118, "post_id": 48638433, "comment_id": 85350464, "body": "It works as suggested. Thank you very much Mr. Liam Kelly! :-)"}], "tags": [], "owner": {"reputation": 1722, "user_id": 5151792, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/463805ba3eae4866f5b40151249db4e4?s=128&d=identicon&r=PG&f=1", "display_name": "aicastell", "link": "https://stackoverflow.com/users/5151792/aicastell"}, "is_accepted": false, "score": 1, "last_activity_date": 1517909231, "last_edit_date": 1517909231, "creation_date": 1517905355, "answer_id": 48638433, "question_id": 48626090, "link": "https://stackoverflow.com/questions/48626090/abi-mismatch-when-building-go-project-with-a-yocto-recipe/48638433#48638433", "title": "ABI mismatch when building go project with a yocto recipe", "body": "<p>I can provide more information regarding this issue:</p>\n\n<pre><code>$ ldd /usr/bin/mybin\n    linux-vdso.so.1 (0x00007ffe321d9000)\n    libstd.so =&gt; /usr/lib/go/pkg/linux_amd64_dynlink/libstd.so (0x00007f95463d7000)\n    libc.so.6 =&gt; /lib/libc.so.6 (0x0000003436200000)\n    libdl.so.2 =&gt; /lib/libdl.so.2 (0x0000003436a00000)\n    libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x0000003436600000)\n    /lib/ld-linux-x86-64.so.2 (0x0000003435e00000)\n\n$ file /usr/bin/mybin\n/usr/bin/mybin: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=0103acf63634df77e600eb114bf59977462ca51d, with debug_info, not stripped\n\n$ file /usr/lib/go/pkg/linux_amd64_dynlink/libstd.so\n/usr/lib/go/pkg/linux_amd64_dynlink/libstd.so: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, BuildID[sha1]=2d2f135b2f9eab19a7ceff1923820bf635e10eb1, with debug_info, not stripped\n</code></pre>\n\n<p>Problem seems related with the generation of dynamic library libstd.so (controlled by GO_DYNLINK). The generation of that library is managed by this fragment of source code defined on poky/meta/recipes-devtools/go/go-runtime.inc:</p>\n\n<pre><code>do_compile() {\n    export GOBIN=\"${B}/bin\"\n    export CC=\"${@d.getVar('BUILD_CC').strip()}\"\n    rm -rf ${GOBIN} ${B}/pkg\n    mkdir ${GOBIN}\n    cd src\n    ./make.bash --host-only\n    cp ${B}/pkg/tool/${BUILD_GOTUPLE}/go_bootstrap ${B}\n    rm -rf ${B}/pkg/${TARGET_GOTUPLE}\n    ./make.bash --target-only\n    if [ -n \"${GO_DYNLINK}\" ]; then\n        cp ${B}/go_bootstrap ${B}/pkg/tool/${BUILD_GOTUPLE}\n        GO_FLAGS=\"-buildmode=shared\" GO_LDFLAGS=\"-extldflags \\\"${LDFLAGS}\\\"\" ./make.bash --target-only\n    fi\n    cd ${B}\n}\n</code></pre>\n\n<p>I did a test, and after commenting this condition:</p>\n\n<pre><code>    # if [ -n \"${GO_DYNLINK}\" ]; then\n    #    cp ${B}/go_bootstrap ${B}/pkg/tool/${BUILD_GOTUPLE}\n    #    GO_FLAGS=\"-buildmode=shared\" GO_LDFLAGS=\"-extldflags \\\"${LDFLAGS}\\\"\" ./make.bash --target-only\n    # fi\n</code></pre>\n\n<p>My recipe generates a working <code>mybin</code> linked as static.</p>\n\n<p>So, after providing all this information, I have more questions: what is the proper way to set this variable GO_DYNLINK from my custom recipe? Because I have tried setting it in different ways:</p>\n\n<pre><code>GO_DYNLINK=\"\"\nunset GO_DYNLINK\nGO_DYNLINK=\"0\"\n</code></pre>\n\n<p>And none of them works (again the ABI mismatch problem). Thanks!! :)</p>\n"}, {"comments": [{"owner": {"reputation": 1722, "user_id": 5151792, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/463805ba3eae4866f5b40151249db4e4?s=128&d=identicon&r=PG&f=1", "display_name": "aicastell", "link": "https://stackoverflow.com/users/5151792/aicastell"}, "edited": false, "score": 0, "creation_date": 1520585135, "post_id": 49181205, "comment_id": 85384610, "body": "Very nice bugfix. Thanks a lot! I read the bug report and it contais really valuable information. Hopefully it will be fixed soon. Thanks a lot for your time investigating this issue, Mr Liam Kelly! :-)"}, {"owner": {"reputation": 183, "user_id": 1339731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/411e1b07a2a9e52fa89761abcf4ee8e2?s=128&d=identicon&r=PG", "display_name": "bvarner", "link": "https://stackoverflow.com/users/1339731/bvarner"}, "edited": false, "score": 0, "creation_date": 1538945185, "post_id": 49181205, "comment_id": 92312333, "body": "I was getting really strange SIGSEGV issues, using the sumo branch of poky with go 1.10.3 -- cross-compiling for armv6 (raspberrypi0-wifi target)  Setting <code>GO_LINKSHARED = &quot;&quot; </code> totally fixed the issue.  Thanks!"}], "tags": [], "owner": {"reputation": 2776, "user_id": 1987437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/508e14a7e9414311eff04b2fd8d20ed6?s=128&d=identicon&r=PG", "display_name": "Liam Kelly", "link": "https://stackoverflow.com/users/1987437/liam-kelly"}, "is_accepted": true, "score": 2, "last_activity_date": 1520538028, "creation_date": 1520538028, "answer_id": 49181205, "question_id": 48626090, "link": "https://stackoverflow.com/questions/48626090/abi-mismatch-when-building-go-project-with-a-yocto-recipe/49181205#49181205", "title": "ABI mismatch when building go project with a yocto recipe", "body": "<p>Ok, so I found the a better way of prevent this problem and also more information about the core problem.</p>\n\n<p><strong>Better Solution</strong></p>\n\n<p>In your recipe add the following line:</p>\n\n<p><code>GO_LINKSHARED = \"\"</code></p>\n\n<p>This will prevent <code>-builmdmode=shared</code> and do a normal go build instead of linking against a standard library. Funny thing, by removing the linking to the standard library I only added 100KB to my bianry size and <code>libstd.so</code> is 30MB.</p>\n\n<p><strong>Core Problem</strong></p>\n\n<p>The core problem is that when you are using the default <code>shared</code> buildmode, when you build a go binary you also build the go runtime <code>libstd.do</code> in another rpm package. In theory, if your target has the same runtime library version then you do not need to install the runtime again. This however does not appear to be the case. Go hashes all the package definitions it puts into <code>libstd</code> and then hashes those hashes in order to create the ABI hash. Two instances of <code>libstd.so</code> of the same go version should have the same hash, because the have the same functions, but that does not appear to be the case. I wrote a more technical bug report on yocto's bug tracker <a href=\"https://bugzilla.yoctoproject.org/show_bug.cgi?id=12592\" rel=\"nofollow noreferrer\">here</a>.    </p>\n"}], "owner": {"reputation": 1722, "user_id": 5151792, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/463805ba3eae4866f5b40151249db4e4?s=128&d=identicon&r=PG&f=1", "display_name": "aicastell", "link": "https://stackoverflow.com/users/5151792/aicastell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 1, "accepted_answer_id": 49181205, "answer_count": 2, "score": 1, "last_activity_date": 1520538028, "creation_date": 1517845022, "question_id": 48626090, "link": "https://stackoverflow.com/questions/48626090/abi-mismatch-when-building-go-project-with-a-yocto-recipe", "title": "ABI mismatch when building go project with a yocto recipe", "body": "<p>I'm trying to write a Yocto recipe to build a Go lang project for the x86_64 target platform (rocko branch). My yocto recipe builds the Go project fine, resolving dependencies with <code>dep</code> tool. But the binary built doesn't run on the target platform. When trying to execute it on the target, I get this error:</p>\n\n<pre><code>$ /usr/bin/mybin\nabi mismatch detected between the executable and libstd.so\nfatal error: abi mismatch\nruntime: panic before malloc heap initialized\n</code></pre>\n\n<p>This is my custom recipe to build the project:</p>\n\n<pre><code>GO_IMPORT = \"bitbucket.org/xxx/myproject\"\nSRC_URI = \"git://${GO_IMPORT}/protocol=http;user=${GIT_USER}:${GIT_PASS};destsuffix=${PN}-${PV}/src/${GO_IMPORT}\"\nSRCREV = \"7777ee7777777c9777774bb777780777759d777771777\"\n\nCGO_ENABLED = \"0\"\n\ninherit go\n\ndo_compile_prepend() {\n    rm -f ${WORKDIR}/build/src/${GO_IMPORT}/Gopkg.toml\n    rm -f ${WORKDIR}/build/src/${GO_IMPORT}/Gopkg.lock\n    cd ${WORKDIR}/build/src/${GO_IMPORT}\n    dep init\n    dep ensure\n}\n\ndo_install_append() {\n    rm -f ${D}/usr/bin/dep\n}\n\ndeltask do_compile_ptest_base\ndeltask do_compile_ptest\n\nDEPENDS = \"go-dep-native mercurial-native\"\n\nINHIBIT_PACKAGE_DEBUG_SPLIT = \"1\"\nINHIBIT_PACKAGE_STRIP = \"1\"\n\nRDEPENDS_${PN}-staticdev += \"bash\"\nRDEPENDS_${PN}-dev += \"bash\"\n</code></pre>\n\n<p>What should be the proper way to manage this issue?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517841377, "post_id": 48624684, "comment_id": 84246555, "body": "Make sure you always return an error as the <i>last</i> value from a function."}, {"owner": {"reputation": 260, "user_id": 5463706, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5ebdab96fb8d441839b55b7f5e70c583?s=128&d=identicon&r=PG&f=1", "display_name": "blits", "link": "https://stackoverflow.com/users/5463706/blits"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517841865, "post_id": 48624684, "comment_id": 84246862, "body": "@Flimzy does it matter which argument (last or first or second) is error?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1517841904, "post_id": 48624684, "comment_id": 84246895, "body": "Yes. Go convention is that error is always the last one.  And standard Go tools will complain otherwise."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517842396, "post_id": 48624684, "comment_id": 84247240, "body": "You should also use &#39;go fmt&#39;--it will provide for a more uniform coding convention, and remove unnecessary semicolons, etc."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1517848007, "post_id": 48624684, "comment_id": 84250873, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/45500836/close-multiple-goroutine-if-an-error-occurs-in-one-in-go/45502591#45502591\">Close multiple goroutine if an error occurs in one in go</a>."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1517858285, "post_id": 48624684, "comment_id": 84256686, "body": "You have a significant race condition with regards to the <code>counter</code> variable.  It is incremented and inspected by both goroutines, which can trample on each other if they occur at the same time.  Use a mutex, or better yet, use a channel (or a pair of them) or a waitgroup to indicate when the two goroutines are finished."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 10, "last_activity_date": 1517845018, "last_edit_date": 1517845018, "creation_date": 1517842239, "answer_id": 48625185, "question_id": 48624684, "link": "https://stackoverflow.com/questions/48624684/how-to-properly-parallelize-2-functions-and-catch-errors/48625185#48625185", "title": "How to properly parallelize 2 functions and catch errors?", "body": "<p>This is the perfect use-case for the <a href=\"https://golang.org/pkg/context/\" rel=\"noreferrer\"><code>context</code></a> package.  I have removed some of your boilerplate, and your second function; you'll want to add that back in for your actual code.</p>\n\n<pre><code>func FetchTickerData() (*gjson.Result, *gjson.Result, error) {\n    ctx, cancel := context.WithCancel(context.Background())\n    defer cancel()\n\n    var result1, result2 *gjson.Result\n    var err1, err2 error\n    var wg sync.WaitGroup\n\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        result1, err1 := fetchPriceTicket(ctx)\n        if err1 != nil {\n            cancel() // Abort the context, so the other function can abort early\n        }()\n    }\n\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        result2, err2 := fetchWhatToMine(ctx)\n        if err2 != nil {\n            cancel() // Abort the context, so the other function can abort early\n        }\n    }()\n\n    wg.Wait()\n\n    // if err1 == context.Canceled, that means the second goroutine had\n    // an error and aborted the first goroutine, so return err2.\n    // If err1 == nil, err2 may still be set, so return it in this case\n    // as well.\n    if err1 == context.Canceled || err1 == nil {\n        return result1, result2, err2\n    }\n    return result1, result2, err1\n}\n\nfunc fetchPriceTicket(ctx context.Context) (*gjson.Result, error) {\n    req, err := http.NewRequest(http.MethodGet, \"https://api.coinmarketcap.com/v1/ticker/\", nil)\n    if err != nil {\n        return nil, err\n    }\n\n    req = req.WithContext(ctx)\n    resp, err := client.Do(req)\n    if err != nil {\n        return nil, err\n    }\n    defer resp.Body.Close()\n\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        return nil, err\n    }\n    json := gjson.GetBytes(body, \"\")\n    return &amp;json, nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "is_accepted": true, "score": 4, "last_activity_date": 1517845144, "creation_date": 1517845144, "answer_id": 48626129, "question_id": 48624684, "link": "https://stackoverflow.com/questions/48624684/how-to-properly-parallelize-2-functions-and-catch-errors/48626129#48626129", "title": "How to properly parallelize 2 functions and catch errors?", "body": "<p>Since you aren't using channels any more, the main go routine finishes before the execution of the other two goroutines starts, hence exiting the program. you should use waitgroups to block the main goroutine until the other two finish their work.</p>\n\n<pre><code>package main\n\nimport \"net/http\"\nimport (\n    \"context\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"sync\"\n    \"time\"\n\n    \"github.com/tidwall/gjson\"\n)\n\nvar client = &amp;http.Client{Timeout: 10 * time.Second}\n\ntype Ticker struct {\n}\n\nfunc main() {\n    ticker, coins, err := FetchTickerData()\n\n    fmt.Print(\"Everything is null! \", ticker, coins, err)\n    if err != nil {\n        fmt.Print(err)\n        return\n    }\n    fmt.Print(\"Bitcoin price in usd: \", ticker.Array()[0].Get(\"price_usd\"))\n}\n\nfunc FetchTickerData() (*gjson.Result, *gjson.Result, error) {\n    var wg sync.WaitGroup\n    ctx, cancel := context.WithCancel(context.Background())\n    defer cancel()\n\n    var result1, result2 *gjson.Result\n    var err1, err2 error\n\n    wg.Add(2)\n    go func() {\n        defer wg.Done()\n        result1, err1 = fetchJson(ctx, \"https://api.coinmarketcap.com/v1/ticker/\")\n        if err1 != nil {\n            cancel() // Abort the context, so the other function can abort early\n        }\n    }()\n\n    go func() {\n        defer wg.Done()\n        result2, err2 = fetchJson(ctx, \"https://whattomine.com/coins.json\")\n        if err2 != nil {\n            cancel() // Abort the context, so the other function can abort early\n        }\n    }()\n\n    wg.Wait()\n\n    if err1 == context.Canceled || err1 == nil {\n        return result1, result2, err2\n    }\n    return result1, result2, err1\n}\n\nfunc fetchJson(ctx context.Context, url string) (*gjson.Result, error) {\n    req, err := http.NewRequest(http.MethodGet, url, nil)\n    if err != nil {\n        return nil, err\n    }\n\n    req = req.WithContext(ctx)\n    resp, err := client.Do(req)\n    if err != nil {\n        return nil, err\n    }\n    defer resp.Body.Close()\n\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        return nil, err\n    }\n    fmt.Print(\"I don't know why this body isn't printed \", string(body))\n    json := gjson.ParseBytes(body)\n    return &amp;json, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 260, "user_id": 5463706, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5ebdab96fb8d441839b55b7f5e70c583?s=128&d=identicon&r=PG&f=1", "display_name": "blits", "link": "https://stackoverflow.com/users/5463706/blits"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 1, "accepted_answer_id": 48626129, "answer_count": 2, "score": 7, "last_activity_date": 1517845144, "creation_date": 1517840623, "last_edit_date": 1517844503, "question_id": 48624684, "link": "https://stackoverflow.com/questions/48624684/how-to-properly-parallelize-2-functions-and-catch-errors", "title": "How to properly parallelize 2 functions and catch errors?", "body": "<p>I'm practising golang and I have no idea how to catch errors.</p>\n\n<p>What I expect:</p>\n\n<ol>\n<li><code>FetchTickerData</code> runs</li>\n<li>It calls 2 different functions at the same time: <code>fetchPriceTicket</code> and <code>fetchWhatToMine</code></li>\n<li>If one of functions returns an error then <code>FetchTickerData</code> returns that error</li>\n<li>If all is ok it process data from both sources and return it</li>\n</ol>\n\n<p>I can't figure how to catch errors. I wrote this code but I don't think it's correct solution and it doesn't work. What's better way to do that?</p>\n\n<pre><code>package main\n\nimport \"net/http\"\nimport (\n    \"github.com/tidwall/gjson\"\n    \"time\"\n    \"io/ioutil\"\n    \"fmt\"\n)\n\nvar client = &amp;http.Client{Timeout: 10 * time.Second}\n\ntype Ticker struct {\n}\n\nfunc FetchTickerData() (error, *gjson.Result, *gjson.Result) {\n    whatToMine := make(chan *gjson.Result)\n    currency := make(chan *gjson.Result)\n    err := make(chan error)\n    counter := 0 // This variable indicates if both data was fetched\n\n    go func() {\n        innerError, json := fetchWhatToMine()\n\n        fmt.Print(innerError)\n        if innerError != nil {\n            err &lt;- innerError\n            // Stop handler immediately\n            whatToMine &lt;- nil\n            currency &lt;- nil\n            return\n        }\n\n        whatToMine &lt;- json\n        counter = counter + 1\n\n        if counter == 2 {\n            fmt.Print(\"err pushed\")\n            err &lt;- nil\n        }\n    }()\n\n    go func() {\n        innerError, json := fetchPriceTicket()\n        fmt.Print(innerError)\n\n        if innerError != nil {\n            err &lt;- innerError\n            whatToMine &lt;- nil\n            currency &lt;- nil\n            return\n        }\n\n        currency &lt;- json\n        counter = counter + 1\n\n        if counter == 2 {\n            fmt.Print(\"err pushed\")\n            err &lt;- nil\n        }\n    }()\n\n    return &lt;-err, &lt;-whatToMine, &lt;-currency\n}\n\nfunc fetchPriceTicket() (error, *gjson.Result) {\n    resp, err := client.Get(\"https://api.coinmarketcap.com/v1/ticker/\")\n\n    if err != nil {\n        return err, nil\n    }\n    defer resp.Body.Close()\n\n    body, _ := ioutil.ReadAll(resp.Body)\n    json := gjson.GetBytes(body, \"\");\n    return nil, &amp;json;\n}\n\nfunc fetchWhatToMine() (error, *gjson.Result) {\n    resp, err := client.Get(\"https://whattomine.com/coins.json\")\n\n    if err != nil {\n        return err, nil\n    }\n    defer resp.Body.Close()\n\n    body, _ := ioutil.ReadAll(resp.Body)\n    json := gjson.GetBytes(body, \"\");\n    return nil, &amp;json;\n}\n</code></pre>\n\n<p>UPD: if I replace <code>return &lt;-err, &lt;-whatToMine, &lt;-currency</code> with <code>return nil, &lt;-whatToMine, &lt;-currency</code> it returns data that I expect but doesn't return error if there is.</p>\n\n<p>UPD: There's a second version of code:</p>\n\n<pre><code>package main\n\nimport \"net/http\"\nimport (\n    \"github.com/tidwall/gjson\"\n    \"time\"\n    \"io/ioutil\"\n    \"context\"\n    \"fmt\"\n)\n\nvar client = &amp;http.Client{Timeout: 10 * time.Second}\n\ntype Ticker struct {\n}\n\nfunc main() {\n    ticker, coins, err := FetchTickerData()\n\n    fmt.Print(\"Everything is null! \", ticker, coins, err)\n    if err != nil {\n        fmt.Print(err)\n        return\n    }\n    fmt.Print(\"Bitcoin price in usd: \", ticker.Array()[0].Get(\"price_usd\"))\n}\n\nfunc FetchTickerData() (*gjson.Result, *gjson.Result, error) {\n    ctx, cancel := context.WithCancel(context.Background())\n    defer cancel()\n\n    var result1, result2 *gjson.Result\n    var err1, err2 error\n\n    go func() {\n        result1, err1 = fetchJson(ctx, \"https://api.coinmarketcap.com/v1/ticker/\")\n        if err1 != nil {\n            cancel() // Abort the context, so the other function can abort early\n        }\n    }()\n\n    go func() {\n        result2, err2 = fetchJson(ctx, \"https://whattomine.com/coins.json\")\n        if err2 != nil {\n            cancel() // Abort the context, so the other function can abort early\n        }\n    }()\n\n    if err1 == context.Canceled || err1 == nil {\n        return result1, result2, err2\n    }\n    return result1, result2, err1\n}\n\nfunc fetchJson(ctx context.Context, url string) (*gjson.Result, error) {\n    req, err := http.NewRequest(http.MethodGet, url, nil)\n    if err != nil {\n        return nil, err\n    }\n\n    req = req.WithContext(ctx)\n    resp, err := client.Do(req)\n    if err != nil {\n        return nil, err\n    }\n    defer resp.Body.Close()\n\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        return nil, err\n    }\n    fmt.Print(\"I don't know why this body isn't printed \", string(body))\n    json := gjson.ParseBytes(body)\n    return &amp;json, nil\n}\n</code></pre>\n\n<p>For some reasons http requests are not working here and there is no error. Ideas?</p>\n\n<pre><code>Everything is null! &lt;nil&gt; &lt;nil&gt; &lt;nil&gt;panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x11f7843]\n\ngoroutine 1 [running]:\nmain.main()\n    /Users/andrey/go/src/tickerUpdater/fetchTicker.go:25 +0x183\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1517839420, "post_id": 48624286, "comment_id": 84245253, "body": "The reason your code does that is because you are dividing by days, so by 24 hour increments. Try dividing by the smallest unit you want measured, i.e. a minute or a second, and your result should change."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1517839551, "post_id": 48624286, "comment_id": 84245338, "body": "Do you need to start from unix timestamps? If you already have the exact times, why not compare the days directly?"}, {"owner": {"reputation": 363, "user_id": 8573115, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/acecb8da2690096c6f6c899111d0145b?s=128&d=identicon&r=PG&f=1", "display_name": "Trody", "link": "https://stackoverflow.com/users/8573115/trody"}, "edited": false, "score": 0, "creation_date": 1517840790, "post_id": 48624286, "comment_id": 84246177, "body": "I was doing it this way because if I use something like .Day() it won&#39;t work nicely if I have different months/years etc. I could change the time to 0 AM in both dates but I don&#39;t know a clean way of doing this."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517840966, "post_id": 48624286, "comment_id": 84246276, "body": "It also depends on what you mean by &quot;days&quot; - dividing by 24-hour periods is unlikely to be what you want, because it doesn&#39;t take into account daylight savings, leap seconds, etc. This is why there is no <code>Duration</code> constant in Go larger than <code>Hour</code> - longer durations are harder to work with using basic math and require consideration of calendars and time zones."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517841483, "post_id": 48624286, "comment_id": 84246635, "body": "@Trody: There&#39;s no such thing as an official &quot;day length&quot;, so you&#39;re always going to have to account for these things."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1517842987, "post_id": 48624286, "comment_id": 84247675, "body": "Use time.Year and time.YearDay and a bit of (ugly) leap year logic."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1517849158, "post_id": 48624286, "comment_id": 84251621, "body": "Aside: use Time.After or Time.Before to compare time values. This considers the monotonic parts of the values."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1517841060, "post_id": 48624776, "comment_id": 84246332, "body": "This may be off by one when the date range straddles a DST change."}, {"owner": {"reputation": 363, "user_id": 8573115, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/acecb8da2690096c6f6c899111d0145b?s=128&d=identicon&r=PG&f=1", "display_name": "Trody", "link": "https://stackoverflow.com/users/8573115/trody"}, "edited": false, "score": 2, "creation_date": 1517842874, "post_id": 48624776, "comment_id": 84247581, "body": "Isn&#39;t this the same? If I have 11:59PM 7 May, and 00:01AM 8 May it should count 1 day even I only have a couple of minutes in between. But at the same time it should return 0 if I&#39;m on the same date and small difference."}, {"owner": {"reputation": 363, "user_id": 8573115, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/acecb8da2690096c6f6c899111d0145b?s=128&d=identicon&r=PG&f=1", "display_name": "Trody", "link": "https://stackoverflow.com/users/8573115/trody"}, "edited": false, "score": 0, "creation_date": 1517844120, "post_id": 48624776, "comment_id": 84248366, "body": "If I remove the time out of the date and leave 00:00 then my original code works flawlessly in UTC. I thought this on the bigging by getting the .Date() and then getting the value with time.date but that looks a bit slow to me. Right? <a href=\"https://play.golang.org/p/GELyEMAmSaf\" rel=\"nofollow noreferrer\">play.golang.org/p/GELyEMAmSaf</a>"}, {"owner": {"reputation": 819, "user_id": 701268, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L1UoP.jpg?s=128&g=1", "display_name": "zouying", "link": "https://stackoverflow.com/users/701268/zouying"}, "reply_to_user": {"reputation": 363, "user_id": 8573115, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/acecb8da2690096c6f6c899111d0145b?s=128&d=identicon&r=PG&f=1", "display_name": "Trody", "link": "https://stackoverflow.com/users/8573115/trody"}, "edited": false, "score": 0, "creation_date": 1517910019, "post_id": 48624776, "comment_id": 84275969, "body": "@Trody I change the source code. After change code, the days calculate is correct."}], "tags": [], "owner": {"reputation": 819, "user_id": 701268, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L1UoP.jpg?s=128&g=1", "display_name": "zouying", "link": "https://stackoverflow.com/users/701268/zouying"}, "is_accepted": false, "score": 7, "last_activity_date": 1577339502, "last_edit_date": 1577339502, "creation_date": 1517840916, "answer_id": 48624776, "question_id": 48624286, "link": "https://stackoverflow.com/questions/48624286/get-real-calendar-days-between-two-dates/48624776#48624776", "title": "Get real calendar days between two dates", "body": "<ol>\n<li>Use <a href=\"https://godoc.org/time#Duration.Hours\" rel=\"nofollow noreferrer\"><code>Duration.Hours()</code></a> to get hours</li>\n<li>Use <a href=\"https://godoc.org/math#Ceil\" rel=\"nofollow noreferrer\"><code>math.Ceil()</code></a> to find calendar days</li>\n<li>Use <a href=\"https://godoc.org/time#Time.Truncate\" rel=\"nofollow noreferrer\"><code>Time.Truncate()</code></a> to truncate hour and minute, only save day</li>\n</ol>\n\n<p>The source code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"time\"\n)\n\nfunc main() {\n    d1, err := time.Parse(\"200601021504\", \"201801020001\")\n    if err != nil {\n        panic(err)\n    }\n    d2, err := time.Parse(\"200601021504\", \"201801020002\")\n    if err != nil {\n        panic(err)\n    }\n\n    newD1 := d1.Truncate(time.Hour * 24)\n    newD2 := d2.Truncate(time.Hour * 24)\n\n    fmt.Printf(\"days: %v\\n\", math.Ceil(newD2.Sub(newD1).Hours()/24))\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 1, "last_activity_date": 1517846371, "creation_date": 1517846371, "answer_id": 48626530, "question_id": 48624286, "link": "https://stackoverflow.com/questions/48624286/get-real-calendar-days-between-two-dates/48626530#48626530", "title": "Get real calendar days between two dates", "body": "<p>As performance is now an issue (which I doubt), I wrote some benchmarks with approaches I come around:</p>\n\n<pre><code>func TrimToDate(t time.Time) time.Time {\n    y, m, d := t.Date()\n    return time.Date(y, m, d, 0, 0, 0, 0, time.UTC)\n}\n\nfunc CountTrim(t1, t2 time.Time) int {\n    return int((t2.Unix() - TrimToDate(t1.Unix())) / 86400)\n}\n\nfunc CountUnixAdd(t1, t2 time.Time) int {\n    Days := (t1.Unix() - t2.Unix()) / 86400\n\n    if t1.Add(time.Duration(Days)*24*time.Hour).Day() != t2.Day() {\n        Days++\n    }\n\n    return int(Days)\n}\n\nfunc CountDivMul(t1, t2 time.Time) int {\n    d1 := t1.Unix() / 86400 * 86400\n    return int((t2.Unix() - d1) / 86400)\n}\n</code></pre>\n\n<p>Where <code>CountTrim</code> use the <code>time.Time.Date</code> method to trim the hours and minutes and so on. Note that only once <code>TrimToDate</code> needs to be called, as the remaining would be discarded by the integer division.</p>\n\n<p><code>CountUnixAdd</code> is a plain and simple way: Test if it is the same date, if not, adds one.</p>\n\n<p><code>CountDivMul</code> is almost the same idea of trimming to day, but use a more hack-y way: using integer division to get rid of the remainnings and then multiply back.</p>\n\n<p>The benchmark result on my laptop:</p>\n\n<pre><code>goos: windows\ngoarch: amd64\npkg: test/stackoverflow/dateprb\nBenchmarkCountTrim-8            20000000                62.7 ns/op\nBenchmarkCountDivMul-8          1000000000               2.12 ns/op\nBenchmarkCountUnixAdd-8         20000000                77.8 ns/op\nPASS\nok      test/stackoverflow/dateprb      5.367s\n</code></pre>\n\n<p>Unsurprisingly, the hack-y way is way faster than the other while the two usual way is almost the same.</p>\n\n<p>Full code (of benchmark and of functions) <a href=\"https://bitbucket.org/snippets/leafbebop/5e6zxL\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1517870797, "last_edit_date": 1517870797, "creation_date": 1517868135, "answer_id": 48632235, "question_id": 48624286, "link": "https://stackoverflow.com/questions/48624286/get-real-calendar-days-between-two-dates/48632235#48632235", "title": "Get real calendar days between two dates", "body": "<p>There are many things to worry about. For example, due to daylight saving time (DST), not all days are 24 hours. What if the times are in different time zones? And so on.</p>\n\n<p>Here's a solution that addresses these issues.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\n// CalendarDays returns the calendar difference between times (t2 - t1) as days.\nfunc CalendarDays(t2, t1 time.Time) int {\n    y, m, d := t2.Date()\n    u2 := time.Date(y, m, d, 0, 0, 0, 0, time.UTC)\n    y, m, d = t1.In(t2.Location()).Date()\n    u1 := time.Date(y, m, d, 0, 0, 0, 0, time.UTC)\n    days := u2.Sub(u1) / (24 * time.Hour)\n    return int(days)\n}\n\nfunc main() {\n    first := time.Now().Round(0)\n    end := first.Add(48 * time.Hour)\n    for last := first; last.Before(end); last = last.Add(6 * time.Hour) {\n        fmt.Println(\"Days:\", CalendarDays(last, first), \"Last:\", last, \"First:\", first)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/wKwQzgfKa8f\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wKwQzgfKa8f</a></p>\n\n<p>Output:</p>\n\n<pre><code>Days: 0 Last: 2018-02-05 17:38:15.623292254 -0500 EST First: 2018-02-05 17:38:15.623292254 -0500 EST\nDays: 0 Last: 2018-02-05 23:38:15.623292254 -0500 EST First: 2018-02-05 17:38:15.623292254 -0500 EST\nDays: 1 Last: 2018-02-06 05:38:15.623292254 -0500 EST First: 2018-02-05 17:38:15.623292254 -0500 EST\nDays: 1 Last: 2018-02-06 11:38:15.623292254 -0500 EST First: 2018-02-05 17:38:15.623292254 -0500 EST\nDays: 1 Last: 2018-02-06 17:38:15.623292254 -0500 EST First: 2018-02-05 17:38:15.623292254 -0500 EST\nDays: 1 Last: 2018-02-06 23:38:15.623292254 -0500 EST First: 2018-02-05 17:38:15.623292254 -0500 EST\nDays: 2 Last: 2018-02-07 05:38:15.623292254 -0500 EST First: 2018-02-05 17:38:15.623292254 -0500 EST\nDays: 2 Last: 2018-02-07 11:38:15.623292254 -0500 EST First: 2018-02-05 17:38:15.623292254 -0500 EST\n</code></pre>\n"}], "owner": {"reputation": 363, "user_id": 8573115, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/acecb8da2690096c6f6c899111d0145b?s=128&d=identicon&r=PG&f=1", "display_name": "Trody", "link": "https://stackoverflow.com/users/8573115/trody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1864, "favorite_count": 2, "answer_count": 3, "score": 5, "last_activity_date": 1577339502, "creation_date": 1517839257, "last_edit_date": 1517839333, "question_id": 48624286, "link": "https://stackoverflow.com/questions/48624286/get-real-calendar-days-between-two-dates", "title": "Get real calendar days between two dates", "body": "<p>I'm trying to get amount of days between two dates in Go but as I'm getting the difference in time (hours) and then divided by the amount of time per day, I have an issue.</p>\n\n<p><strong>Problem:</strong> if dates are different (7 of May and 8 of May) but the time between then is lower than 24h, my code counts as there are no days in between.</p>\n\n<p><strong>What I want:</strong> count real days in between.</p>\n\n<pre><code>// Days\nfirstDay := firstDate.Unix()\nlastDay := lastDate.Unix()\nfmt.Println(\"firstDay: \", firstDay)\nfmt.Println(\"lastDay: \", lastDay)\n\nif firstDay &gt; lastDay {\n        fmt.Println(\"IS TO SMALL\")\n    return\n}\n\n// businessDays = \nbusinessDays := (lastDay - firstDay) / 86400\nfmt.Println(\"businessDays: \", businessDays)\n</code></pre>\n\n<p>Thank you very much.</p>\n"}, {"tags": ["go", "httphandler"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1517836820, "post_id": 48623323, "comment_id": 84243557, "body": "Fragments are not sent to the server. So you cannot &quot;get&quot; them: An incoming request does not contain the fragment."}, {"owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1517836883, "post_id": 48623323, "comment_id": 84243595, "body": "@Volker ohh thanks for the information"}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "edited": false, "score": 0, "creation_date": 1517919509, "post_id": 48627772, "comment_id": 84282251, "body": "i cannot command server to send URL with parameter instead of fragments"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "reply_to_user": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "edited": false, "score": 0, "creation_date": 1517919757, "post_id": 48627772, "comment_id": 84282432, "body": "You mean the client. Client sends this"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "reply_to_user": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "edited": false, "score": 0, "creation_date": 1517920128, "post_id": 48627772, "comment_id": 84282674, "body": "So I can guess that for some reason you want to encode your parameters as a fragment id. But it has minimal chances to work. Fragment identifier has specific syntax allowed, for example.  I believe now it&#39;s the time to ask question - why such design? What are your limitations which prevent you from using a more common and straightforward way?"}, {"owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "edited": false, "score": 0, "creation_date": 1517922664, "post_id": 48627772, "comment_id": 84284247, "body": "its the way to get access token for microsoft onedrive, in which we will get accesstoken in fragment"}], "tags": [], "owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "is_accepted": false, "score": 2, "last_activity_date": 1517875985, "last_edit_date": 1517875985, "creation_date": 1517850307, "answer_id": 48627772, "question_id": 48623323, "link": "https://stackoverflow.com/questions/48623323/get-fragment-values-in-url/48627772#48627772", "title": "get fragment values in url", "body": "<p>As commenters pointed already, fragment is not part of your request. Fragment can be rather a subset of your HTML markup, identified by some ID - that'd be a thing returned by the server.</p>\n\n<p>I am wondering why wouldn't you use GET parameters?</p>\n\n<p>Then your URL could be</p>\n\n<pre><code>http://localhost:8080/handle?access_token=*1234$111&amp;token_type=bearer&amp;expires_in=3600&amp;scope=onedrive.readwrite&amp;user_id=hashed\n</code></pre>\n\n<p>that is, with <code>?</code> instead of <code>#</code> after the <code>/handle</code></p>\n\n<p>Then you will see your <code>access_token</code> GET parameter properly:</p>\n\n<pre><code>inside handle function, \n1 &lt;nil&gt;\n2 /handle?access_token=*1234$111&amp;token_type=bearer&amp;expires_in=3600&amp;scope=onedrive.readwrite&amp;user_id=hashed\n3 \n4 *1234$111\n</code></pre>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 874, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1517926867, "creation_date": 1517836033, "last_edit_date": 1517925991, "question_id": 48623323, "link": "https://stackoverflow.com/questions/48623323/get-fragment-values-in-url", "title": "get fragment values in url", "body": "<p>sample code </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>func main() {\r\n\tfmt.Print(\"starting box web server...\")\r\n\thttp.HandleFunc(\"/\", landing)\r\n\thttp.HandleFunc(\"/handle\", handler)\r\n\thttp.ListenAndServe(connector_port, nil)\r\n}\r\nfunc landing(w http.ResponseWriter, r *http.Request) {\r\n\tfmt.Println(\"redirecting to login for authentication...\")\r\n\thttp.Redirect(w, r, \"http://*****urlfortoken\", http.StatusFound)\r\n}\r\nfunc handler(w http.ResponseWriter, r *http.Request) {\r\n\tbodyresnew_folder, _ := ioutil.ReadAll(r.Body)\r\n\tfmt.Println(\"response Body:\", string(bodyresnew_folder))\r\n\tfmt.Println(\"1\", r.GetBody)\r\n\tfmt.Println(\"2\", r.URL.String())\r\n\tfmt.Println(\"3\", r.URL.Fragment)\r\n\tfmt.Println(\"4\", r.URL.Query().Get(\"access_token\"))\r\n\tfmt.Println(\"inside handle function,\", r.Form.Get(\"access_token\"))\r\n\tfmt.Println(\"finished processing all files please close this server manually\")\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>I tried the code above to get fragment from an URL but was unsuccessful.</p>\n\n<p>Example URL used is: <code>http://localhost:8080/handle#access_token=*1234$111&amp;token_type=bearer&amp;expires_in=3600&amp;scope=onedrive.readwrite&amp;user_id=hashed</code></p>\n\n<p>Now, for such URL, I want to get the value of fragment <code>access_token</code> in the <code>handler</code> function which is basically an http handler.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1517826248, "post_id": 48620326, "comment_id": 84237193, "body": "Do a <code>return</code> after each call of <code>util.RedirectWithMessage</code>."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517826269, "post_id": 48620326, "comment_id": 84237205, "body": "Where did you put the <code>return</code>?"}, {"owner": {"reputation": 5825, "user_id": 307157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a7dd31da12c648abf086921395a2101f?s=128&d=identicon&r=PG", "display_name": "slier", "link": "https://stackoverflow.com/users/307157/slier"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1517827150, "post_id": 48620326, "comment_id": 84237724, "body": "@Volker im fully aware of that..i just dont want to clutter my controller with <code>return</code> statement"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1517827253, "post_id": 48620326, "comment_id": 84237793, "body": "<code>return</code> only returns from the current function, this is just how go works. Most (if not all) of your error checks should have a return statement in them or you just keep executing the handler when problems are encountered (eg: you&#39;re still proceeding on invalid ID)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1517828460, "post_id": 48620326, "comment_id": 84238513, "body": "If you are fully aware of the only proper solution: What is the question?"}, {"owner": {"reputation": 5825, "user_id": 307157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a7dd31da12c648abf086921395a2101f?s=128&d=identicon&r=PG", "display_name": "slier", "link": "https://stackoverflow.com/users/307157/slier"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1517828736, "post_id": 48620326, "comment_id": 84238675, "body": "@Volker <code>i just dont want to clutter my controller with return statement</code>?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1517828959, "post_id": 48620326, "comment_id": 84238823, "body": "The alternative would be a giant mess of nested if/else statements. You won&#39;t find the equivalent of php&#39;s <code>exit</code>, as Go just keeps running, it&#39;s not a script that you can just exit out of. I would add that <code>if err != nil { handleError(); return err }</code> is idiomatic go."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1517830093, "post_id": 48620326, "comment_id": 84239497, "body": "There is no &quot;I want&quot; in Go."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1517832074, "post_id": 48620326, "comment_id": 84240631, "body": "<code>return</code> is not clutter. It&#39;s useful. It&#39;s readable. It&#39;s straight-forward. It&#39;s effectively essential. If you think writing good code is clutter, then there&#39;s not a lot we can do to help."}], "answers": [{"comments": [{"owner": {"reputation": 5825, "user_id": 307157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a7dd31da12c648abf086921395a2101f?s=128&d=identicon&r=PG", "display_name": "slier", "link": "https://stackoverflow.com/users/307157/slier"}, "edited": false, "score": 0, "creation_date": 1517832855, "post_id": 48621755, "comment_id": 84241063, "body": "Yes im thinking about panic and defer too..i try to ask here wether its plausible..i put the redirect inside function to make it easy for calling code..it can prevent calling code from forget to put <code>return</code> after call to redirect that lead to hard to trace bug..thx for ur input"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517835107, "post_id": 48621755, "comment_id": 84242418, "body": "Do you also want to redirect if <code>ParseInt</code> fails (which you&#39;re not checking) or you have an invalid id (on which you&#39;re not returning)? This solution works only if all error conditions should result in the same outcome."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517835224, "post_id": 48621755, "comment_id": 84242501, "body": "@Marc This only deals with that but with a type assertion (or select of value) to determine the error that returned, it can handle multiple types of errors."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517835323, "post_id": 48621755, "comment_id": 84242558, "body": "True, but then it&#39;s just as simple to return in the original error case. While your solution does work, I&#39;m not sure I would recommend it. Overall, it seems like trying to avoid the <code>if err {...; return err }</code> pattern for no good reason."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517835579, "post_id": 48621755, "comment_id": 84242728, "body": "@Marc I would say the problem of the orignal code is not avoiding <code>return err</code>, but being too verbose on error handling. While it is true <code>if err!=nil { ... } </code> patter is common, it does diverse the code in a way. Dealing all kinds of errors in a single place would make the logic more centered, and in my opinion, more idomatic."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517835664, "post_id": 48621755, "comment_id": 84242784, "body": "... If it is simply a <code>panic(err)</code> or <code>log.Info</code> or <code>fmt.Println</code>, I would surely recommend just adding return every use. But if there is some non-trivial logic there, I would consider to have a place dedicate to the error handling."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 0, "last_activity_date": 1517830613, "creation_date": 1517830613, "answer_id": 48621755, "question_id": 48620326, "link": "https://stackoverflow.com/questions/48620326/stop-code-execution-after-redirect/48621755#48621755", "title": "Stop code execution after redirect", "body": "<p>I was tempted to give you a <code>panic</code> <code>defer</code> way and warn you not to use it but then I realize it might be better to change the API.</p>\n\n<p>You can focus the main logic of the function and return the error to the caller, and ask the caller to handle the error the way you want, e.g. redirect, log and so on.</p>\n\n<pre><code>func (self *GoodsController) GoodsEditGet(w http.ResponseWriter, r *http.Request) {\n    err:=self.goodsEditGet(w,r)\n    if err!=nil { //Note 1\n        util.RedirectWithMessage(w, r, err.Error(), \"/system/inventory/goods\")\n    }\n}\n\nfunc (self *GoodsController) goodsEditGet(w http.ResponsWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    tmpID, ok := vars[\"id\"]\n    sess := session.Instance(w, r)\n\n    if !ok {\n        tpl.Error(\"Invalid goods id\")\n    }\n\n    id, _ := strconv.ParseInt(tmpID, 10, 64)\n\n    goods, err := service.NewGoodsService(w, r).GetGoodsDetail(id)\n\n    if err != nil {\n        //This utility function will not stop the rest of the code being executed\n        return err //Note 2\n    }\n\n    goodsUom, err := service.NewGoodsService(w, r).GetGoodsUom(id)\n\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>Note 1: You would possibly want to handle more specified errors, not just dealing with nil and non-nil. In that case, type assertion may be a good idea.</p>\n\n<p>Note 2: You would possibly want to wrap the error. You can try <a href=\"https://github.com/pkg/errors\" rel=\"nofollow noreferrer\"><code>github/pkg/errors</code></a>, a good package dealing with erros written by Dave Cheney.</p>\n\n<p>Note 3: It is adviced against to use <code>self</code> as receiver name, as it is pretty ambiguous.</p>\n"}], "owner": {"reputation": 5825, "user_id": 307157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a7dd31da12c648abf086921395a2101f?s=128&d=identicon&r=PG", "display_name": "slier", "link": "https://stackoverflow.com/users/307157/slier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 281, "favorite_count": 0, "answer_count": 1, "score": -6, "last_activity_date": 1517833271, "creation_date": 1517826135, "last_edit_date": 1517833271, "question_id": 48620326, "link": "https://stackoverflow.com/questions/48620326/stop-code-execution-after-redirect", "title": "Stop code execution after redirect", "body": "<pre><code>//main.go\nfunc (self *GoodsController) GoodsEditGet(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    tmpID, ok := vars[\"id\"]\n    sess := session.Instance(w, r)\n\n    if !ok {\n        tpl.Error(\"Invalid goods id\")\n    }\n\n    id, _ := strconv.ParseInt(tmpID, 10, 64)\n\n    goods, err := service.NewGoodsService(w, r).GetGoodsDetail(id)\n\n    if err != nil {\n        //This utility function will not stop the rest of the code being executed\n        util.RedirectWithMessage(w, r, err.Error(), \"/system/inventory/goods\")\n    }\n\n    //This line will be executed even though the above line producing error\n    goodsUom, err := service.NewGoodsService(w, r).GetGoodsUom(id)\n\n    if err != nil {\n        util.RedirectWithMessage(w, r, err.Error(), \"/system/inventory/goods\")\n    }\n\n}\n\n//package utility\nfunc RedirectWithMessage(w http.ResponseWriter, r *http.Request, errMsg string, redirect string) {\n    sess := session.Instance(w, r)\n    sess.FlashError(errMsg)\n    sess.FlashForm(r)\n    sess.Save(r, w)\n    http.Redirect(w, r, redirect, http.StatusFound)\n    return\n}\n</code></pre>\n\n<p>May i know how to stop execution rest of the code after called to function <code>RedirectWithMessage</code> ? </p>\n\n<p>Putting <code>return</code> at the end of that function didn't rest of the code being executed</p>\n\n<p>Im looking the equivalent of Php version of redirect in Golang:</p>\n\n<pre><code>fuunction foo($location){\n  header(\u201cLocation : $location\u201d);\n  exit();\n}\n\n foo(\"/bar\"):\n echo \"blah\"; //this will not be executed\n</code></pre>\n\n<p><strong>Edited</strong> cause of overzealous down-vote.</p>\n\n<p>Yes im fully aware that i can put <code>return</code> statement after a called to <code>RedirectWithMessage</code>. I just dont want to clutter my code with <code>return</code> statement all the place.Instead i just put once inside the function.\nI just wonder is there any better solution to that? Can i achieve the same behaviour like php code i show? </p>\n"}, {"tags": ["go", "delete-row", "go-gorm"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 3, "creation_date": 1517843095, "post_id": 48620241, "comment_id": 84247751, "body": "gorm does not do it due to spotty db support for this. You&#39;ll need to execute a raw sql statement such as <code>DELETE .... RETURNING ....</code> on postgres. I think mysql doesn&#39;t have that though, but you didn&#39;t specify which database it&#39;s for."}], "answers": [{"tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": false, "score": 1, "last_activity_date": 1567009029, "creation_date": 1567009029, "answer_id": 57696486, "question_id": 48620241, "link": "https://stackoverflow.com/questions/48620241/retrieve-deleted-rows-on-deletion/57696486#57696486", "title": "Retrieve deleted rows on deletion", "body": "<p>Your query should be this way instead. <code>db.Where</code> does not return the struct. It modifies the pointer passed as parameter.</p>\n\n<pre><code>var res MyModel{}\n\ndb.Where(\"updated_at &lt; ?\", expirationDate).\n    Delete(&amp;res)\n</code></pre>\n"}], "owner": {"reputation": 135, "user_id": 2813949, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/845e862049f42e45f2ecd0b25dfa365d?s=128&d=identicon&r=PG", "display_name": "lilorox", "link": "https://stackoverflow.com/users/2813949/lilorox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 841, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1567009029, "creation_date": 1517825864, "last_edit_date": 1517825916, "question_id": 48620241, "link": "https://stackoverflow.com/questions/48620241/retrieve-deleted-rows-on-deletion", "title": "Retrieve deleted rows on deletion", "body": "<p>Is there a way to retrieve the rows deleted when calling Delete()?</p>\n\n<p>I'd like to avoid using 'SELECT ... FOR UPDATE' to first get the list of rows I'm deleting.</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>type MyModel struct {\n  gorm.Model\n  ....\n}\n\nres := db.Where(\"updated_at &lt; ?\", expirationDate).\n    Set(\"gorm:save_associations\", false).\n    Delete(&amp;MyModel{})\n</code></pre>\n\n<p>I noticed there is a res.Value attribute but it seems to be the empty struct I pass as argument of Delete().</p>\n"}, {"tags": ["go", "aws-lambda"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1517829084, "post_id": 48619686, "comment_id": 84238885, "body": "This is very helpful and can be seen many internal Go tools (by Google I mean). And it has some semantics that tools understand, like if a package from another project tries to import from <code>internal</code>s of current project, compiler will fail. <a href=\"https://github.com/golang-standards/project-layout\" rel=\"nofollow noreferrer\">github.com/golang-standards/project-layout</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "is_accepted": false, "score": 5, "last_activity_date": 1517843432, "last_edit_date": 1517843432, "creation_date": 1517825857, "answer_id": 48620236, "question_id": 48619686, "link": "https://stackoverflow.com/questions/48619686/project-structure-for-go-program-to-run-on-aws-lambda/48620236#48620236", "title": "Project structure for Go program to run on AWS Lambda", "body": "<p>Your <code>handler</code> func is your entry point, but since you can call it with arbitrary json data, you can have multiple functions called from within your <code>handler</code> based on the data you send to handler.</p>\n\n<p><code>APIGatewayProxyRequest</code> has <code>Body</code> field. What you do based on that is up to you.</p>\n\n<p>The idea of lambda (AFAIU) is to have minimal binaries that do only one thing though. Implementing complex applications with request routing from within lambda seems like abusing the model to me, but it's doable.</p>\n"}, {"comments": [{"owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 0, "creation_date": 1517909237, "post_id": 48639325, "comment_id": 84275404, "body": "Seems to me that you are creating 2 separate lambdas here. Nothing wrong with that (it&#39;s actually not abusing the model), I just assumed you were interested with only 1 lambda resource based on OP."}, {"owner": {"reputation": 7457, "user_id": 1278541, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fcc6992a1917d59faa28517ebb028656?s=128&d=identicon&r=PG&f=1", "display_name": "Mr. 14", "link": "https://stackoverflow.com/users/1278541/mr-14"}, "reply_to_user": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 1, "creation_date": 1517909552, "post_id": 48639325, "comment_id": 84275644, "body": "@Nebril I probably didn&#39;t make myself clear in my question. I appreciate your input though"}, {"owner": {"reputation": 1157, "user_id": 294439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/jldP4.png?s=128&g=1", "display_name": "Serge Merzliakov", "link": "https://stackoverflow.com/users/294439/serge-merzliakov"}, "edited": false, "score": 0, "creation_date": 1531709625, "post_id": 48639325, "comment_id": 89680515, "body": "Where do external dependencies get imported from? E.g. other peoples code"}], "tags": [], "owner": {"reputation": 7457, "user_id": 1278541, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fcc6992a1917d59faa28517ebb028656?s=128&d=identicon&r=PG&f=1", "display_name": "Mr. 14", "link": "https://stackoverflow.com/users/1278541/mr-14"}, "is_accepted": false, "score": 5, "last_activity_date": 1517908545, "creation_date": 1517908545, "answer_id": 48639325, "question_id": 48619686, "link": "https://stackoverflow.com/questions/48619686/project-structure-for-go-program-to-run-on-aws-lambda/48639325#48639325", "title": "Project structure for Go program to run on AWS Lambda", "body": "<p>Here's what I have come up with so far</p>\n\n<p>Project folder structure:</p>\n\n<pre><code>project\n  folder1\n    main.go\n  folder2\n    main.go\n  buildspec.yml\n  template.yml\n</code></pre>\n\n<p>buildspec.yml:</p>\n\n<pre><code>...\n\nbuild:\n    commands:\n      - cd folder1\n      - go build -o main\n      - cd ../folder2\n      - go build -o main\n....\n</code></pre>\n\n<p>template.yml:</p>\n\n<pre><code>....\n\nResources:\n  GetTest1:\n    Type: AWS::Serverless::Function\n    Properties:\n      CodeUri: ./folder1\n      Handler: main\n      Runtime: go1.x\n      Role:\n        Fn::ImportValue:\n          !Join ['-', [!Ref 'ProjectId', !Ref 'AWS::Region', 'LambdaTrustRole']]\n      Events:\n        GetEvent:\n          Type: Api\n          Properties:\n            Path: /test1\n            Method: get\n  GetTest2:\n    Type: AWS::Serverless::Function\n    Properties:\n      CodeUri: ./folder2\n      Handler: main\n      Runtime: go1.x\n      Role:\n        Fn::ImportValue:\n          !Join ['-', [!Ref 'ProjectId', !Ref 'AWS::Region', 'LambdaTrustRole']]\n      Events:\n        GetEvent:\n          Type: Api\n          Properties:\n            Path: /test2\n            Method: get   \n....\n</code></pre>\n\n<p>It is important to note that all main.go files in the subdirectories namely, <code>folder1/main.go</code>, <code>folder2/main.go</code>, need to be in <code>package main</code>, otherwise it won't work.</p>\n"}], "owner": {"reputation": 7457, "user_id": 1278541, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fcc6992a1917d59faa28517ebb028656?s=128&d=identicon&r=PG&f=1", "display_name": "Mr. 14", "link": "https://stackoverflow.com/users/1278541/mr-14"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1710, "favorite_count": 2, "answer_count": 2, "score": 9, "last_activity_date": 1517908545, "creation_date": 1517824195, "last_edit_date": 1517845644, "question_id": 48619686, "link": "https://stackoverflow.com/questions/48619686/project-structure-for-go-program-to-run-on-aws-lambda", "title": "Project structure for Go program to run on AWS Lambda", "body": "<p>I found the following code sample from the <a href=\"https://aws.amazon.com/blogs/compute/announcing-go-support-for-aws-lambda/\" rel=\"noreferrer\">AWS Compute Blog</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n)\n\nfunc handler(request events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {\n    return events.APIGatewayProxyResponse{\n        StatusCode: 200,\n        Body:       \"Hello World\",\n    }, nil\n}\n\nfunc main() {\n    lambda.Start(handler)\n}\n</code></pre>\n\n<p>Since lambda.Start only takes in one handler and the entry point for a Go program is the main function, does that mean one CodeStar project can only consist of one handler?</p>\n\n<p>I understand that lambda functions should be small in size and preferably handle one functionality, but it seems that one would need to create a lot of projects and that would be hard to manage. Am I understanding this correctly?</p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517822520, "post_id": 48618528, "comment_id": 84234906, "body": "Can you show your imports? Also, is this the actual error or redacted? If the latter, it could be similar to <a href=\"https://stackoverflow.com/questions/45542071/setting-ports-for-container-in-docker-for-docker-golang-api\" title=\"setting ports for container in docker for docker golang api\">stackoverflow.com/questions/45542071/&hellip;</a>"}, {"owner": {"reputation": 1689, "user_id": 3186123, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1709e38fd6e076bdd779db050bb996b9?s=128&d=identicon&r=PG&f=1", "display_name": "Ofer Velich", "link": "https://stackoverflow.com/users/3186123/ofer-velich"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517831135, "post_id": 48618528, "comment_id": 84240102, "body": "Deleting the vendor didn&#39;t helped just like mention in the link, doesn&#39;t seems it got resolved also Added the related imports and the actual error Thanks @Marc"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517831419, "post_id": 48618528, "comment_id": 84240276, "body": "<a href=\"https://github.com/moby/moby/issues/28269\" rel=\"nofollow noreferrer\">this issue</a> has more details. Sorry, best I can do."}, {"owner": {"reputation": 1093, "user_id": 3968346, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Ksx6B.png?s=128&g=1", "display_name": "Musen", "link": "https://stackoverflow.com/users/3968346/musen"}, "edited": false, "score": 0, "creation_date": 1589025387, "post_id": 48618528, "comment_id": 109130535, "body": "not sure whether you have solved the problem. I got into the same trouble and fixed it by deleting the vendor under $GOPATH/src/..../docker (for go mod it&#39;s another location). I hope it helps."}], "owner": {"reputation": 1689, "user_id": 3186123, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1709e38fd6e076bdd779db050bb996b9?s=128&d=identicon&r=PG&f=1", "display_name": "Ofer Velich", "link": "https://stackoverflow.com/users/3186123/ofer-velich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 416, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1517830954, "creation_date": 1517819859, "last_edit_date": 1517830954, "question_id": 48618528, "link": "https://stackoverflow.com/questions/48618528/docker-go-api-cant-set-exposedports-on-the-container-config", "title": "Docker Go api: Cant set ExposedPorts on the container.Config", "body": "<p>I'm new on Go.</p>\n\n<p>Trying to use the docker api to manage containers.</p>\n\n<p>I have been trying to create the following setup:</p>\n\n<pre><code>import (\n    \"github.com/docker/docker/api/types/container\"\n    \"github.com/go-connections/nat\"\n)\n\nconfig := &amp;container.Config{\n    Image: \"nginx\",\n    ExposedPorts: nat.PortSet{\n        \"4140/tcp\": struct{}{},\n    },\n}\n</code></pre>\n\n<p>unfortunately, im getting error:</p>\n\n<pre><code>Cannot use nat.PortSet{\"4140/tcp\": struct{}{}, }(type PortSet) as type nat.PortSet\n\n./docker_test.go:15:15: cannot use \"github.com/docker/go-connections/nat\".PortSet literal (type \"github.com/docker/go-connections/nat\".PortSet) as type \"github.com/docker/docker/vendor/github.com/docker/go-connections/nat\".PortSet in field value\n</code></pre>\n\n<p>Cant understand what i'm doing wrong? Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517818856, "post_id": 48618201, "comment_id": 84233016, "body": "Nope, this isn&#39;t what I&#39;m looking for. I can get the slice emptied, but I need it to release the memory."}, {"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1517819779, "post_id": 48618201, "comment_id": 84233434, "body": "@Filmzy, thank you. I&#39;ve updated my question."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1517821171, "post_id": 48618201, "comment_id": 84234127, "body": "What do you mean by &quot;release the memory&quot;? If you mean hand the memory back to the operating system that&#39;s usually not done. If you mean make the memory available to other allocations in your program, then that&#39;s done."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1517824094, "post_id": 48618201, "comment_id": 84235893, "body": "I ran your program for like 5..10 minutes, and memory was released back to OS. When I inserted a <code>debug.FreeOSMemory()</code> call before the last <code>for</code> loop, memory again was released back to OS without waiting. So this is a duplicate of <a href=\"https://stackoverflow.com/questions/37382600/cannot-free-memory-once-occupied-by-bytes-buffer/37383604#37383604\">Cannot free memory once occupied by bytes.Buffer</a>."}], "answers": [{"comments": [{"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "edited": false, "score": 0, "creation_date": 1517819392, "post_id": 48618291, "comment_id": 84233254, "body": "Well, yes, It isn&#39;t actual program of course. This is part of actual code: <code>func(ctx *fasthttp.RequestCtx) { \turis = append(uris, string(ctx.RequestURI()[:])) }</code> and then in go routine <code>go func() { \t\tfor { \t\t\ttime.Sleep(10 * time.Second) \t\t\tif len(uris) &gt; 0 { \t\t\t\tmetrics &lt;- uris \t\t\t\turis = uris[:0] \t\t\t} \t\t} \t}()</code> And under benchmarking tests I always run out of memory quite fast."}, {"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "edited": false, "score": 0, "creation_date": 1517819798, "post_id": 48618291, "comment_id": 84233442, "body": "I&#39;ve updated my question, to make it more reality-based."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "reply_to_user": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "edited": false, "score": 1, "creation_date": 1517819887, "post_id": 48618291, "comment_id": 84233495, "body": "@AleksandrMakov And now the answer makes no sense. Please add another question."}, {"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "edited": false, "score": 0, "creation_date": 1517819984, "post_id": 48618291, "comment_id": 84233545, "body": "ok, thanks. Closing this."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 2, "last_activity_date": 1517818935, "last_edit_date": 1517818935, "creation_date": 1517818844, "answer_id": 48618291, "question_id": 48618201, "link": "https://stackoverflow.com/questions/48618201/how-to-release-memory-allocated-by-a-slice/48618291#48618291", "title": "How to release memory allocated by a slice?", "body": "<p>In the program you wrote, it makes no sense to release memory because no part of code is requesting it any more.</p>\n\n<p>To make a valid case, you have to request a new memory and release it inside the loop. Then you will observe that the memory consumption will stabilize at some point.</p>\n"}, {"comments": [{"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "edited": false, "score": 0, "creation_date": 1517832901, "post_id": 48618634, "comment_id": 84241095, "body": "This is incredible information, thank you."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "edited": false, "score": 0, "creation_date": 1517837161, "post_id": 48618634, "comment_id": 84243785, "body": "@AleksandrMakov, there was an error in preallocation example\u2014should have been <code>make([]T, 0, N)</code>, sorry. Added further pointers to the docs about how slices work."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 6, "last_activity_date": 1517837178, "last_edit_date": 1517837178, "creation_date": 1517820359, "answer_id": 48618634, "question_id": 48618201, "link": "https://stackoverflow.com/questions/48618201/how-to-release-memory-allocated-by-a-slice/48618634#48618634", "title": "How to release memory allocated by a slice?", "body": "<p>There are several things going on here.</p>\n\n<p>The first one which is needed to be absorbed is that Go is\na garbage-collected language; the actual algorithm of its GC\nis mostly irrelevant but one aspect of it is crucial to understand:\nit does not use reference counting, and hence there's no way to\nsomehow make the GC immediately reclaim the memory of any given\nvalue whose storage is allocated on the heap.\nTo recap it in more simple words, it's futile to do</p>\n\n<pre><code>s := make([]string, 10*100*100)\ns = nil\n</code></pre>\n\n<p>as the second statement will indeed remove the sole reference\nto the slice's underlying memory but won't make the GC go\nand \"mark\" that memory as available for reuse.</p>\n\n<p>This means two things:</p>\n\n<ul>\n<li>You should know how the GC works.\n<a href=\"https://golang.org/s/go15gcpacing\" rel=\"noreferrer\">This</a> explains how it works\nsince v1.5 and up until now (v1.10 these days).</li>\n<li>You should structure those of your algorythms which are\nmemory-intensive in a way that reduces memory pressure.</li>\n</ul>\n\n<p>The latter can be done in several ways:</p>\n\n<ul>\n<li><p>Preallocate, when you have a sensible idea about how much to.</p>\n\n<p>In your example, you start with a slice of length 0,\nand then append to it a lot. Now, almost all library code which deals\nwith growing memory buffers\u2014the Go runtime included\u2014deals with these\nallocations by 1) allocating <em>twice</em> the memory requested\u2014hoping to\nprevent several future allocations, and 2) <em>copies</em> the \"old\" contents\nover, when it had to reallocate. This one is important: when reallocation\nhappens, it means there's <em>two</em> memory regions now: the old one and the new\none.</p>\n\n<p>If you can estimate that you may need to hold <code>N</code> elements on\naverage, preallocate for them using <code>make([]T, 0, N)</code>\u2014\nmore info <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"noreferrer\">here</a>\nand <a href=\"https://blog.golang.org/slices\" rel=\"noreferrer\">here</a>.\nIf you'll need to hold less than <code>N</code> elements, the tail of that buffer\nwill be unused, and if you'll need to hold more than <code>N</code>, you'll need\nto reallocate, but on average, you won't need any reallocations.</p></li>\n<li><p>Re-use your slice(s). Say, in your case, you could \"reset\" the slice\nby reslicing it to the zero length and then use it again for the next\nrequest. This is called \"pooling\", and in the case of mass-parallel access\nto such a pool, you could use <code>sync.Pool</code> to hold your buffers.</p></li>\n<li><p><em>Limit the load on your system</em> to make the GC be able to cope with\nthe sustained load. A good overview of the two approaches to such\nlimiting is <a href=\"http://ferd.ca/queues-don-t-fix-overload.html\" rel=\"noreferrer\">this</a>.</p></li>\n</ul>\n"}], "owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3747, "favorite_count": 2, "closed_date": 1517824001, "accepted_answer_id": 48618634, "answer_count": 2, "score": 4, "last_activity_date": 1517837178, "creation_date": 1517818400, "last_edit_date": 1517819929, "question_id": 48618201, "link": "https://stackoverflow.com/questions/48618201/how-to-release-memory-allocated-by-a-slice", "closed_reason": "Duplicate", "title": "How to release memory allocated by a slice?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    storage := []string{}\n\n    for i := 0; i &lt; 50000000; i++ {\n        storage = append(storage, \"string string string string string string string string string string string string\")\n    }\n\n    fmt.Println(\"done allocating, emptying\")\n\n    storage = storage[:0]\n    storage = nil\n\n    for {\n        time.Sleep(1 * time.Second)\n    }\n}\n</code></pre>\n\n<p>The code above will allocate about ~30mb of memory, and then won't release it. Why is that? How can I force go to release memory used by this slice? I sliced that slice and then nilled it.</p>\n\n<p>The program I'm debugging is a simple HTTP input buffer: it appends all requests into large chunks, and sends these chunks over a channel to goroutine for processing. But problem is illustrated above - I can't get storage to release the memory and then eventually run out of memory.</p>\n\n<p>Edit: as some people pointed out to similar <a href=\"https://deferpanic.com/blog/manual-memory-management-in-go/\" rel=\"nofollow noreferrer\">question</a>, no, it first doesn't work, second isn't what I'm asking for. The slice gets emptied, the memory does not.</p>\n"}, {"tags": ["macos", "go", "macos-sierra"], "comments": [{"owner": {"reputation": 2955, "user_id": 3819007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6hvpZ.png?s=128&g=1", "display_name": "visibleman", "link": "https://stackoverflow.com/users/3819007/visibleman"}, "edited": false, "score": 0, "creation_date": 1517815905, "post_id": 48617574, "comment_id": 84231846, "body": "I think you just need to do a    <code>sudo go install</code>"}, {"owner": {"reputation": 9, "user_id": 7182719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/285e16ec1d7d67a9f8baa7a627aff31b?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh", "link": "https://stackoverflow.com/users/7182719/rakesh"}, "reply_to_user": {"reputation": 2955, "user_id": 3819007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6hvpZ.png?s=128&g=1", "display_name": "visibleman", "link": "https://stackoverflow.com/users/3819007/visibleman"}, "edited": false, "score": 0, "creation_date": 1517816381, "post_id": 48617574, "comment_id": 84232027, "body": "This resulted in sudo go install go install: no install location for directory /Users/username/gowork/src/palindrome outside GOPATH         For more details see: &#39;go help gopath&#39;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1517842255, "post_id": 48617574, "comment_id": 84247133, "body": "There&#39;s no reason they should need <code>sudo</code>. <code>go install</code> should install to the user&#39;s Go working directory which should be user-writable."}, {"owner": {"reputation": 2955, "user_id": 3819007, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6hvpZ.png?s=128&g=1", "display_name": "visibleman", "link": "https://stackoverflow.com/users/3819007/visibleman"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517875268, "post_id": 48617574, "comment_id": 84263958, "body": "@Adrian, in the normal case, yes. But he has actively set the GOBIN path to /bin so it seems OP wants to install system-wide."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517856962, "post_id": 48618668, "comment_id": 84255974, "body": "You don&#39;t need <code>mkdir bin pkg src</code>, since the <code>go</code> tool will do that for you. Why <code>mkdir Go</code> when you could just use the default <code>$HOME&#47;go</code>? Also, the env variables should be exported from a profile file rather than an rc file."}, {"owner": {"reputation": 1097, "user_id": 6678710, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/I8jiW.jpg?s=128&g=1", "display_name": "Shaon shaonty", "link": "https://stackoverflow.com/users/6678710/shaon-shaonty"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517901702, "post_id": 48618668, "comment_id": 84271254, "body": "check my 3rd point I have created those 3 folders. and I am sure these settings work properly."}], "tags": [], "owner": {"reputation": 1097, "user_id": 6678710, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/I8jiW.jpg?s=128&g=1", "display_name": "Shaon shaonty", "link": "https://stackoverflow.com/users/6678710/shaon-shaonty"}, "is_accepted": false, "score": 0, "last_activity_date": 1517820503, "creation_date": 1517820503, "answer_id": 48618668, "question_id": 48617574, "link": "https://stackoverflow.com/questions/48617574/go-install-command-results-in-open-bin-palindrome-operation-not-permitted-in-m/48618668#48618668", "title": "go install command results in open /bin/palindrome: operation not permitted in mac", "body": "<p>Try to install go using brew.</p>\n\n<ol>\n<li><code>brew install go</code></li>\n<li><code>mkdir Go</code></li>\n<li><code>cd Go &amp;&amp; mkdir bin pkg src</code></li>\n</ol>\n\n<p>for Oh My Zsh terminal shell: </p>\n\n<ol start=\"4\">\n<li><code>vi ~/.zshrc</code>\nIn order to edit this file, you\u2019ll need to press \u201ci\u201d to enter \u201cinsert mode\u201d.</li>\n</ol>\n\n<p>5 Add this line</p>\n\n<h1>Go</h1>\n\n<pre><code>export GOPATH=\"$HOME/Go\"\nexport PATH=$PATH:$GOPATH/bin\n</code></pre>\n\n<p>Go to src folder and create your go app</p>\n\n<p>That's it</p>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 0, "last_activity_date": 1517857653, "creation_date": 1517857653, "answer_id": 48629754, "question_id": 48617574, "link": "https://stackoverflow.com/questions/48617574/go-install-command-results-in-open-bin-palindrome-operation-not-permitted-in-m/48629754#48629754", "title": "go install command results in open /bin/palindrome: operation not permitted in mac", "body": "<p><code>GOBIN</code> defaults go <code>GOPATH/bin</code>, bit you have it set to <code>/bin</code> which you don't have write access to. </p>\n\n<p>Unset <code>GOBIN</code> and <code>go install</code> will work correctly. </p>\n"}, {"tags": [], "owner": {"reputation": 9, "user_id": 7182719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/285e16ec1d7d67a9f8baa7a627aff31b?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh", "link": "https://stackoverflow.com/users/7182719/rakesh"}, "is_accepted": false, "score": -1, "last_activity_date": 1517883388, "creation_date": 1517883388, "answer_id": 48634466, "question_id": 48617574, "link": "https://stackoverflow.com/questions/48617574/go-install-command-results-in-open-bin-palindrome-operation-not-permitted-in-m/48634466#48634466", "title": "go install command results in open /bin/palindrome: operation not permitted in mac", "body": "<p>Finally ran from default $HOME/go</p>\n\n<p>moved my source go file to GO/SRC/package folder and ran the go install command. </p>\n\n<p>Thanks all</p>\n"}], "owner": {"reputation": 9, "user_id": 7182719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/285e16ec1d7d67a9f8baa7a627aff31b?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh", "link": "https://stackoverflow.com/users/7182719/rakesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1725, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1517883388, "creation_date": 1517815427, "question_id": 48617574, "link": "https://stackoverflow.com/questions/48617574/go-install-command-results-in-open-bin-palindrome-operation-not-permitted-in-m", "title": "go install command results in open /bin/palindrome: operation not permitted in mac", "body": "<p>I have MacOS Sierra 10.12.6. I cannot install my go source file into the bin folder. I get '</p>\n\n<pre><code>go install _/Users/username/gowork/src/palindrome: open /bin/palindrome: operation not permitted\n</code></pre>\n\n<p>Please help me here.</p>\n\n<p>Below are my go env variables\ngo env</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"/bin\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/username/GOWORK\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nCC=\"clang\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/08/1d18bh856db95kk0k65_sfnc0000gn/T/go-build043087036=/tmp/go-build -gno-record-gcc-switches -fno-common\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "heroku", "dep"], "answers": [{"comments": [{"owner": {"reputation": 461, "user_id": 7359470, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3d7fb653bc3eb067f9dd9b2019e653bd?s=128&d=identicon&r=PG&f=1", "display_name": "mofury", "link": "https://stackoverflow.com/users/7359470/mofury"}, "edited": false, "score": 0, "creation_date": 1517823064, "post_id": 48618753, "comment_id": 84235247, "body": "Yep that worked. I actually only changed root-package to &quot;my-app&quot;. I didn&#39;t need to do install = [&quot;./...&quot;]. Now I am doing it just in case. Just want to say, thank you very much, your help is much appreciated."}], "tags": [], "owner": {"reputation": 106, "user_id": 8542382, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-89FCBULoAj0/AAAAAAAAAAI/AAAAAAAABxQ/HFmoRHVAefg/photo.jpg?sz=128", "display_name": "Frits", "link": "https://stackoverflow.com/users/8542382/frits"}, "is_accepted": true, "score": 4, "last_activity_date": 1517820900, "creation_date": 1517820900, "answer_id": 48618753, "question_id": 48617152, "link": "https://stackoverflow.com/questions/48617152/how-to-deploy-go-apps-with-internal-package-to-heroku-using-dep/48618753#48618753", "title": "How to deploy Go apps with internal package to Heroku using `dep`", "body": "<p>Try to set the root package to just the name of the project without the domain</p>\n\n<p><code>[metadata.heroku]\n  root-package = \"my-app\"\n  go-version = \"go1.9.2\"\n  install = [ \"./...\" ]</code></p>\n"}], "owner": {"reputation": 461, "user_id": 7359470, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3d7fb653bc3eb067f9dd9b2019e653bd?s=128&d=identicon&r=PG&f=1", "display_name": "mofury", "link": "https://stackoverflow.com/users/7359470/mofury"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1064, "favorite_count": 0, "accepted_answer_id": 48618753, "answer_count": 1, "score": 2, "last_activity_date": 1517820900, "creation_date": 1517813272, "question_id": 48617152, "link": "https://stackoverflow.com/questions/48617152/how-to-deploy-go-apps-with-internal-package-to-heroku-using-dep", "title": "How to deploy Go apps with internal package to Heroku using `dep`", "body": "<p>I am using Heroku's Golang buildpack to deploy a simple web app with the following structure</p>\n\n<pre><code>my-app/\n    handler/\n        user.go\n        session.go\n    vendor/\n        github.com/\n        golang.org/\n    main.go\n    Gopkg.toml\n    Gopkg.lock\n</code></pre>\n\n<p>Inside my main file, I imported my own <code>handler</code> package</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"net/http\"\n    \"my-app/handler\"\n)\n</code></pre>\n\n<p>Heroku was not able to run go install on my project due the following error:</p>\n\n<pre><code>----&gt; Using go1.9.3\n----&gt; Running: go install -v -tags heroku . \n----&gt; cannot find package \"my-app/handler\" in any of: ... \n</code></pre>\n\n<p>I can run <code>go install</code> and <code>my-app</code> without any problem locally. It seems to me that heroku does not recognize my internal project package. </p>\n\n<p>I am using dep and I have the following configurations in my Gopkg.toml:</p>\n\n<pre><code>[metadata.heroku]\nroot-package = \"github.com/mygithub/my-app\"\ngo-version = \"go1.9.3\"\ninstall = [\".\"]\nensure = \"false\"\n</code></pre>\n\n<p>What else do I need to do to deploy a Go app with internal package? Thanks.</p>\n"}, {"tags": ["go", "http2"], "answers": [{"tags": [], "owner": {"reputation": 661, "user_id": 995190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5f6e13aca62e7bbbf3821d221b826c3?s=128&d=identicon&r=PG", "display_name": "grungegurunge", "link": "https://stackoverflow.com/users/995190/grungegurunge"}, "is_accepted": false, "score": 0, "last_activity_date": 1610571276, "creation_date": 1610571276, "answer_id": 65709635, "question_id": 48615218, "link": "https://stackoverflow.com/questions/48615218/is-it-posssible-to-flush-trailer-header-to-the-client/65709635#65709635", "title": "Is it posssible to flush trailer header to the client?", "body": "<h3>If you just need to make sure trailers are flushed into the underlying socket:</h3>\n<p>Use <a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"nofollow noreferrer\">ConnState</a> hook to signal about trailers being written to connection. <a href=\"https://golang.org/src/net/http/server.go?s=78188:82485#L1937\" rel=\"nofollow noreferrer\">This</a> is the point when the trailers are written and connection changes its state to StateIdle.</p>\n<h3>If you want to make sure that trailers are sent in separate frames:</h3>\n<p><a href=\"https://golang.org/pkg/net/http/#Hijacker\" rel=\"nofollow noreferrer\">Hijack</a> TCP connection, write the terminating chunk and trailers into the connection manually, flush the connection, close the connection. This is (obviously) not compatible with keepalive.</p>\n"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 313, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1610571276, "creation_date": 1517798982, "last_edit_date": 1517816955, "question_id": 48615218, "link": "https://stackoverflow.com/questions/48615218/is-it-posssible-to-flush-trailer-header-to-the-client", "title": "Is it posssible to flush trailer header to the client?", "body": "<p>This results in 2 DATA frames being sent from a server:</p>\n\n<pre><code>func(w http.ResponseWriter, r *http.Request) {\n    w.Write(\"foo\")\n    w.(http.Flusher).Flush()\n    w.Write(\"bar\")\n    w.(http.Flusher).Flush()\n}\n</code></pre>\n\n<p>This results in 1 HEADERS frames being sent from a server:</p>\n\n<pre><code>func(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Trailer:X\", \"a\")\n    w.(http.Flusher).Flush()\n    w.Header().Set(\"Trailer:Y\", \"b\")\n    w.(http.Flusher).Flush()\n}\n</code></pre>\n\n<p><strong>Is there any way to get trailer frames sent as multiple HEADERS frames without using the framer api?</strong></p>\n"}, {"tags": ["go", "go-gorm"], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1517817765, "creation_date": 1517782194, "question_id": 48613499, "link": "https://stackoverflow.com/questions/48613499/can-associations-in-gorm-go-both-ways", "title": "Can associations in gorm go both ways?", "body": "<p>Can I make associations in gorm go both ways?</p>\n\n<p>i.e.</p>\n\n<pre><code>type Store struct {\n   ID int\n   Products []Product\n}\n\ntype Product struct {\n   ID int\n   StoreID int\n   Store Store\n}\n</code></pre>\n\n<p>So a Store has many Products, and a Product belongs to a Store.</p>\n\n<p>Is this correct?</p>\n"}, {"tags": ["http", "parsing", "go", "nested", "go-templates"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1517774757, "post_id": 48612442, "comment_id": 84221524, "body": "Probably you need to use <code>{{ template &quot;header&quot; . }}</code> (note the <code>.</code>)"}, {"owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517775039, "post_id": 48612442, "comment_id": 84221653, "body": "Wow, Thank you @leafbebop it worked. Could you please post it as an answer? I will accept it. On a separate note, was it mentioned in the documentation? I wanted to know where should I have been looking for it."}], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 6, "last_activity_date": 1565665076, "last_edit_date": 1565665076, "creation_date": 1517775885, "answer_id": 48612653, "question_id": 48612442, "link": "https://stackoverflow.com/questions/48612442/passing-data-to-a-nested-template-not-working-as-expected/48612653#48612653", "title": "Passing data to a nested template not working as expected", "body": "<p>You need to use <code>{{ template \"header\" . }}</code>. As the document in <a href=\"https://golang.org/pkg/text/template/#hdr-Actions\" rel=\"nofollow noreferrer\"><code>text/template</code></a> say:</p>\n\n<blockquote>\n  <p>{{template \"name\" pipeline}}</p>\n  \n  <p>The template with the specified name is executed with dot set\n      to the value of the pipeline.</p>\n</blockquote>\n\n<p>In this case, the pipeline you passed into is <code>.</code>, which reffers to the whole <code>data</code>.</p>\n\n<p>It is somehow unconvenient that documents of <code>html/template</code> is mostly in <code>text/template</code>.</p>\n"}], "owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1763, "favorite_count": 1, "accepted_answer_id": 48612653, "answer_count": 1, "score": 3, "last_activity_date": 1565665076, "creation_date": 1517774531, "last_edit_date": 1517839062, "question_id": 48612442, "link": "https://stackoverflow.com/questions/48612442/passing-data-to-a-nested-template-not-working-as-expected", "title": "Passing data to a nested template not working as expected", "body": "<p>I was trying to get a struct passed to a nested template in Go, using <code>html/template</code> and tried to achieve it using both <code>template.ParseFiles</code> and <code>template.ParseGlob</code>, but it is not working as per my expectation because my understanding is not clear.</p>\n\n<p>My template code for the file <code>header.html</code> is </p>\n\n<pre><code>{{define \"header\"}}\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;link href=\"https://use.fontawesome.com/releases/v5.0.6/css/all.css\" rel=\"stylesheet\"&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt;\n    &lt;title&gt; SiteAdmin - {{.User}}&lt;/title&gt;\n&lt;/head&gt;\n{{end}} \n</code></pre>\n\n<p>and for the file <code>admin.html</code> is</p>\n\n<pre><code>{{template \"header\"}}\n&lt;body&gt;\n\"User is {{.User}}\"\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>I am using the <code>Execute</code> method on the type *Template as</p>\n\n<pre><code>type Admin struct {\n    User string\n}\n\n\ndata := new(Admin)\ndata.User = \"Guest\"\ntpl, err := template.ParseGlob(\"views/templates/admin/*.html\")\nCheckForErr(err)\nerr = tpl.Execute(w, data)\nCheckForErr(err)\n</code></pre>\n\n<p>With the above code, I can pass around the struct data to <code>admin.html</code>, and it shows <code>User is Guest</code> in the browser. But if I try to pass it to any of the nested templates, it wouldn't. The title of the page still shows as <code>SiteAdmin -</code> and not <code>SiteAdmin - Guest</code>. The <code>User</code> data from the struct is visible only if I call it as <code>{{.User}}</code> inside the <code>admin.html</code> file, and any reference to it in the nested templates turns out to be not passed. Is this something achievable? </p>\n\n<p>Thank you all.</p>\n"}, {"tags": ["go", "routes", "gorilla", "mux"], "answers": [{"comments": [{"owner": {"reputation": 884, "user_id": 6651080, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-EY45JeKlPi8/AAAAAAAAAAI/AAAAAAAAG8I/5bwaHIx2IoQ/photo.jpg?sz=128", "display_name": "Dzintars", "link": "https://stackoverflow.com/users/6651080/dzintars"}, "edited": false, "score": 1, "creation_date": 1517778291, "post_id": 48612730, "comment_id": 84222595, "body": "Yaay!! Thank You! I was really close to this solution! Thank You so much. Unfortunately i cant up-vote this answer."}, {"owner": {"reputation": 73, "user_id": 7623003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GHbiw.jpg?s=128&g=1", "display_name": "Danniel Rolfe", "link": "https://stackoverflow.com/users/7623003/danniel-rolfe"}, "edited": false, "score": 0, "creation_date": 1573797097, "post_id": 48612730, "comment_id": 104010370, "body": "Awesome. Thank you for taking the time to respond."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 30, "last_activity_date": 1517776399, "creation_date": 1517776399, "answer_id": 48612730, "question_id": 48612319, "link": "https://stackoverflow.com/questions/48612319/how-to-split-go-gorilla-mux-routes-in-2-separate-files-of-the-same-package/48612730#48612730", "title": "How to split GO Gorilla Mux routes in 2 separate files of the same package", "body": "<p>You can use another function that modifies the router to do that.</p>\n\n<pre><code>//In another file\nfunc addSignHandler(r *mux.Router) {\n    r.HandleFunc(\"/signup\", signupGetHandler).Methods(\"GET\")\n    r.HandleFunc(\"/signup\", signupPostHandler).Methods(\"POST\")\n    r.HandleFunc(\"/signin\", signinGetHandler).Methods(\"GET\")\n    r.HandleFunc(\"/signin\", signinPostHandler).Methods(\"POST\")\n    r.HandleFunc(\"/signout\", signoutGetHandler).Methods(\"GET\")\n}\n</code></pre>\n\n<p>And to use it:</p>\n\n<pre><code>func NewRouter() *mux.Router {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", middleware.AuthRequired(indexGetHandler)).Methods(\"GET\")\n    r.HandleFunc(\"/\", middleware.AuthRequired(indexPostHandler)).Methods(\"POST\")\n\n    addSignHandler(r)\n\n    r.HandleFunc(\"/services\", middleware.AuthRequired(servicesHandler)).Methods(\"GET\")\n    fs := http.FileServer(http.Dir(\"./static/\"))\n    r.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", fs))\n    return r\n}\n</code></pre>\n\n<p>Or even better, you can refactor your code to make it more consistent:</p>\n\n<pre><code>func addMainHandler(r *mux.Router) {\n    r.HandleFunc(\"/\", middleware.AuthRequired(indexGetHandler)).Methods(\"GET\")\n    r.HandleFunc(\"/\", middleware.AuthRequired(indexPostHandler)).Methods(\"POST\")\n    r.HandleFunc(\"/services\", middleware.AuthRequired(servicesHandler)).Methods(\"GET\")\n    fs := http.FileServer(http.Dir(\"./static/\"))\n    r.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", fs))\n}\n</code></pre>\n\n<p>And simplify the <code>NewRouter</code> to:</p>\n\n<pre><code>func NewRouter() *mux.Router {\n    r := mux.NewRouter()\n    addMainHandler(r)\n    addSignHandler(r)\n    return r\n}\n</code></pre>\n"}], "owner": {"reputation": 884, "user_id": 6651080, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-EY45JeKlPi8/AAAAAAAAAAI/AAAAAAAAG8I/5bwaHIx2IoQ/photo.jpg?sz=128", "display_name": "Dzintars", "link": "https://stackoverflow.com/users/6651080/dzintars"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3982, "favorite_count": 2, "accepted_answer_id": 48612730, "answer_count": 1, "score": 6, "last_activity_date": 1517824619, "creation_date": 1517773752, "last_edit_date": 1517824619, "question_id": 48612319, "link": "https://stackoverflow.com/questions/48612319/how-to-split-go-gorilla-mux-routes-in-2-separate-files-of-the-same-package", "title": "How to split GO Gorilla Mux routes in 2 separate files of the same package", "body": "<p>I have separate file routes.go (package routes) where I store all my routes and handlers.\nBut I want to split this file in 2 files. I want to rename my routes.go to main.go and create new additional file moduleX.go (package routes).\nHow can I do that?\nI want to store all my routes in multiple files of the same \"package routes\".</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>package routes\r\n\r\nimport (\r\n\t\"github.com/gorilla/mux\"\r\n\t\"net/http\"\r\n\t\"github.com/---/001/models\"\r\n\t\"github.com/---/001/sessions\"\r\n\t\"github.com/---/001/utils\"\r\n\t\"github.com/---/001/middleware\"\r\n)\r\n\r\nfunc NewRouter() *mux.Router {\r\n\tr := mux.NewRouter()\r\n\tr.HandleFunc(\"/\", middleware.AuthRequired(indexGetHandler)).Methods(\"GET\")\r\n\tr.HandleFunc(\"/\", middleware.AuthRequired(indexPostHandler)).Methods(\"POST\")\r\n\tr.HandleFunc(\"/signup\", signupGetHandler).Methods(\"GET\")\r\n\tr.HandleFunc(\"/signup\", signupPostHandler).Methods(\"POST\")\r\n\tr.HandleFunc(\"/signin\", signinGetHandler).Methods(\"GET\")\r\n\tr.HandleFunc(\"/signin\", signinPostHandler).Methods(\"POST\")\r\n\tr.HandleFunc(\"/signout\", signoutGetHandler).Methods(\"GET\")\r\n\tr.HandleFunc(\"/services\", middleware.AuthRequired(servicesHandler)).Methods(\"GET\")\r\n\tfs := http.FileServer(http.Dir(\"./static/\"))\r\n\tr.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", fs))\r\n\treturn r\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>I want move all \"/signup\" and \"/signin\" routes and handlers outside of this main file. And then somehow to pass them back to this NewRouter function.\nYou can provide me just a book or some online example.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 4, "last_activity_date": 1517774167, "creation_date": 1517774167, "answer_id": 48612385, "question_id": 48612306, "link": "https://stackoverflow.com/questions/48612306/accessing-maps-interface-value-in-go/48612385#48612385", "title": "accessing maps interface value in Go", "body": "<pre><code>v.(AddStruct).Category\n</code></pre>\n\n<p>After a valid type assertion, you can access struct fields with a valid selector for the asserted type.  See, e.g., this runnable example:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n)\n\ntype AddStruct struct {\n    AdID         int\n    Category     int\n    Impression   int\n}\n\nfunc main() {\n    a := AddStruct{12234, 145, 1000}\n    var b interface{}\n    b = a\n    fmt.Printf(\"%v\\n\", b.(AddStruct).Category)\n}\n</code></pre>\n\n<p>prints <code>145</code></p>\n"}], "owner": {"reputation": 69, "user_id": 5741117, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/khs4P.jpg?s=128&g=1", "display_name": "kartik ", "link": "https://stackoverflow.com/users/5741117/kartik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1500, "favorite_count": 1, "accepted_answer_id": 48612385, "answer_count": 1, "score": 0, "last_activity_date": 1517839006, "creation_date": 1517773655, "last_edit_date": 1517839006, "question_id": 48612306, "link": "https://stackoverflow.com/questions/48612306/accessing-maps-interface-value-in-go", "title": "accessing maps interface value in Go", "body": "<p>I am using Maps in Go like\nMap[Key]interface{}</p>\n\n<p>so my key-value pair inside Map looks like -</p>\n\n<pre><code>map[\n 1:{12234 145 1000} \n    1234:{1234 15 1000} \n    12:{12 12345 1000}]\n</code></pre>\n\n<p>where <strong>1 is the key</strong> and {12234,145,1000} is the value corresponds to that key </p>\n\n<p>And this is struct which is a image of value inside the map </p>\n\n<pre><code> type AddStruct struct {\n    AdID         int\n    Category     int\n    Impression   int\n }\n\n    type Handler struct {\n    Conmap cmap.ConcurrentMap \n   }\n</code></pre>\n\n<p>I am using concurrent maps in Go This is how i am adding key-value pair to maps </p>\n\n<pre><code>   func  (h *Handler) Add(input AddStruct){\n       AdID := strconv.Itoa(input.AdID)\n       h.Conmap.Set(AdID,input)\n    }\n</code></pre>\n\n<p>But the problem that I am facing in accessing them is \nI need to return all the key value pairs from the map which are having same category specified in function argument</p>\n\n<pre><code>func(h *Handler) Fetch(category int) []int {\n    h.Conmap.IterCb(func(key string, v interface{}) {\n    fmt.Printf(\"%s\\n\", key) //1\n    fmt.Printf(\"%v\\n\",v.(AddStruct)) // {12234 145 1000}\n\n     I only need 145 to here to check! Or how do i access 145 here ?\n\n\n})\n}\n</code></pre>\n\n<p><strong>So how do i access each value inside the value interface??</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1517768011, "post_id": 48611185, "comment_id": 84219229, "body": "That&#39;s not from the standard like library as far as I can tell. Which html package are you referring to?"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 2, "creation_date": 1517773642, "post_id": 48611185, "comment_id": 84221127, "body": "I don&#39;t see how iterating through the tree is &quot;over complicated&quot;.  But if you&#39;re looking for an alternative, how about rendering to an io.Writer and getting your string from that?"}, {"owner": {"reputation": 750, "user_id": 2947756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qpCxL.png?s=128&g=1", "display_name": "xReprisal", "link": "https://stackoverflow.com/users/2947756/xreprisal"}, "edited": false, "score": 0, "creation_date": 1517774845, "post_id": 48611185, "comment_id": 84221570, "body": "I&#39;m go beginner, coming from PHP, JS background makes me think that iteration would be over complicated. Maybe <code>io.Writer</code> might do the job and be somewhat less complex. I&#39;ll try it out."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1517849780, "post_id": 48611185, "comment_id": 84252060, "body": "Doesn&#39;t html.Render do what you want? For instance, give it a *bytes.Buffer, then call *Buffer.String."}], "answers": [{"comments": [{"owner": {"reputation": 750, "user_id": 2947756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qpCxL.png?s=128&g=1", "display_name": "xReprisal", "link": "https://stackoverflow.com/users/2947756/xreprisal"}, "edited": false, "score": 1, "creation_date": 1517924085, "post_id": 48627954, "comment_id": 84285184, "body": "Thanks a lot for example!"}], "tags": [], "owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "is_accepted": true, "score": 4, "last_activity_date": 1591180559, "last_edit_date": 1591180559, "creation_date": 1517850885, "answer_id": 48627954, "question_id": 48611185, "link": "https://stackoverflow.com/questions/48611185/retrieve-raw-data-from-html-node/48627954#48627954", "title": "Retrieve raw data from html.Node", "body": "<p>I get what you mean, I use a lot of this in tests.</p>\n\n<p>What you need is already in the same <code>x/net/html</code> package - you can <a href=\"https://pkg.go.dev/golang.org/x/net/html#Render\" rel=\"nofollow noreferrer\"><code>Render</code></a> the <code>Node</code> to a <code>bytes.Buffer</code> then get a string out of it:</p>\n\n<pre><code>var b bytes.Buffer\nerr := html.Render(&amp;b, node)\nreturn b.String()\n</code></pre>\n\n<p>Please read \n<a href=\"https://pkg.go.dev/golang.org/x/net/html#Render\" rel=\"nofollow noreferrer\">the doc</a> \nhow rendering is done on the best effort basis - but it will probably fit you.</p>\n\n<p>PS. You can consult how it's used in a more real project of mine:\n<a href=\"https://github.com/wkhere/htmlx/blob/f22d01b/finder.go#L32-L39\" rel=\"nofollow noreferrer\">https://github.com/wkhere/htmlx/blob/f22d01b/finder.go#L32-L39</a>\n<a href=\"https://github.com/wkhere/htmlx/blob/f22d01b/finder_test.go#L71-L73\" rel=\"nofollow noreferrer\">https://github.com/wkhere/htmlx/blob/f22d01b/finder_test.go#L71-L73</a></p>\n"}], "owner": {"reputation": 750, "user_id": 2947756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qpCxL.png?s=128&g=1", "display_name": "xReprisal", "link": "https://stackoverflow.com/users/2947756/xreprisal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 806, "favorite_count": 0, "accepted_answer_id": 48627954, "answer_count": 1, "score": 1, "last_activity_date": 1591180559, "creation_date": 1517766508, "last_edit_date": 1517817028, "question_id": 48611185, "link": "https://stackoverflow.com/questions/48611185/retrieve-raw-data-from-html-node", "title": "Retrieve raw data from html.Node", "body": "<p>I want to get contents of <code>html.Node</code> as a string.</p>\n\n<p>Example:</p>\n\n<pre><code>&lt;div id=\"my-node\"&gt;\n  &lt;p&gt;First paragraph&lt;/p&gt;\n  &lt;p&gt;Second paragraph&lt;/p&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>Given <code>myNode := html.Node(\"#my-node\")</code> (pseudocode), I want to retrieve entire above html as a string. Indentation does not matter.</p>\n\n<p>I couldn't find anything on the internet except iterating over contents of node - <code>myNode.NextSibling</code> but its over complicated and I'm pretty sure there has to be easier way.</p>\n\n<p>Update:\nI'm reffering to <code>golang.org/x/net/html</code> package.</p>\n"}, {"tags": ["go", "stack-trace"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1517783274, "post_id": 48611031, "comment_id": 84224098, "body": "<a href=\"https://stackoverflow.com/questions/19094099/how-to-dump-goroutine-stacktraces\" title=\"how to dump goroutine stacktraces\">stackoverflow.com/questions/19094099/&hellip;</a>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517815181, "post_id": 48611031, "comment_id": 84231597, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/19094099/how-to-dump-goroutine-stacktraces\">How to dump goroutine stacktraces?</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1517838690, "post_id": 48611031, "comment_id": 84244769, "body": "Have to tried to see what signal your process is receiving? If you&#39;re asking about a process, a shell usually sends SIGHUP to end child processes."}, {"owner": {"reputation": 21, "user_id": 3881147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0bfcf915f71ecf25f19bcaa678d8602?s=128&d=identicon&r=PG&f=1", "display_name": "user3881147", "link": "https://stackoverflow.com/users/3881147/user3881147"}, "edited": false, "score": 0, "creation_date": 1522307139, "post_id": 48611031, "comment_id": 86106970, "body": "I was using telegraf (go process). In my case, when the session was closed, I tried SIGKILL, the dump was being redirected to journalctl which worked for me. It took a while for me to figure this out"}], "owner": {"reputation": 21, "user_id": 3881147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0bfcf915f71ecf25f19bcaa678d8602?s=128&d=identicon&r=PG&f=1", "display_name": "user3881147", "link": "https://stackoverflow.com/users/3881147/user3881147"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 178, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1517765649, "creation_date": 1517765649, "question_id": 48611031, "link": "https://stackoverflow.com/questions/48611031/generating-stack-trace-of-golang-process-when-the-session-is-closed", "title": "Generating stack trace of golang process when the session is closed", "body": "<p>How to generate stack trace in golang process when the session which started the process is closed.</p>\n\n<p>I have tried SIGQUIT. It generates the stack trace and prints it on stdout. However, its not helpful when the session which started the process is closed. Is there any other way of doing it?</p>\n"}, {"tags": ["c", "go", "porting"], "answers": [{"comments": [{"owner": {"reputation": 33459, "user_id": 928098, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/2761f0967c4a4b1839c1feee764c6dd7?s=128&d=identicon&r=PG", "display_name": "Kristian Glass", "link": "https://stackoverflow.com/users/928098/kristian-glass"}, "edited": false, "score": 0, "creation_date": 1517767131, "post_id": 48610952, "comment_id": 84218933, "body": "Good spot on the bug front, and good suggestion about explicitness, thank you!"}], "tags": [], "owner": {"reputation": 255961, "user_id": 464744, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3dfd6067f4c69986a652444f44bb6d7c?s=128&d=identicon&r=PG", "display_name": "Blender", "link": "https://stackoverflow.com/users/464744/blender"}, "is_accepted": true, "score": 5, "last_activity_date": 1517768651, "last_edit_date": 1517768651, "creation_date": 1517765123, "answer_id": 48610952, "question_id": 48610855, "link": "https://stackoverflow.com/questions/48610855/porting-c-to-go-that-modifies-a-variable-in-an-if-check/48610952#48610952", "title": "Porting C to Go that modifies a variable in an if check", "body": "<p>If <code>x--</code> is a typo and should be <code>--x</code>, then I would make the changes to <code>x</code> explicit:</p>\n\n<pre><code>if x == 0 || x == 1 {\n    x = 0\n\n    // Stuff\n} else {\n    x--\n}\n</code></pre>\n\n<p>Otherwise, your C code has a bug. If <code>x == 0</code> is false, then <code>x-- == 0</code> will also be false because you're using the post-increment operator. Therefore, the code would be equivalent to:</p>\n\n<pre><code>if (x == 0) {\n    // Stuff\n} else {\n    x--;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1517770516, "creation_date": 1517770516, "answer_id": 48611842, "question_id": 48610855, "link": "https://stackoverflow.com/questions/48610855/porting-c-to-go-that-modifies-a-variable-in-an-if-check/48611842#48611842", "title": "Porting C to Go that modifies a variable in an if check", "body": "<p>The Go code</p>\n\n<pre><code>    if x != 0 {\n        x--\n    } else {\n        // Stuff\n    }\n</code></pre>\n\n<p>is equivalent to the C code</p>\n\n<pre><code>    if (x == 0 || x-- == 0) {\n        // Stuff\n    }\n</code></pre>\n\n<hr>\n\n<p>For example, in Go,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    for _, x := range []int{-42, -2, -1, 0, 1, 2, 42} {\n        fmt.Printf(\"x %d:\", x)\n        if x != 0 {\n            x--\n        } else {\n            fmt.Printf(\" Stuff %d:\", x)\n        }\n        fmt.Printf(\" x %d:\\n\", x)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>x -42: x -43:\nx -2: x -3:\nx -1: x -2:\nx 0: Stuff 0: x 0:\nx 1: x 0:\nx 2: x 1:\nx 42: x 41:\n</code></pre>\n\n<hr>\n\n<p>For example, in C,</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    int a[] = {-42,-2,-1,0,1,2,42};\n    for (int i = 0; i &lt; (sizeof a)/sizeof a[0]; i++) {\n        int x = a[i];\n        printf(\"x %d:\", x);\n        if (x == 0 || x-- == 0) {\n            printf(\" Stuff %d:\", x);\n        }\n        printf(\" x %d:\\n\", x);\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>x -42: x -43:\nx -2: x -3:\nx -1: x -2:\nx 0: Stuff 0: x 0:\nx 1: x 0:\nx 2: x 1:\nx 42: x 41:\n</code></pre>\n"}], "owner": {"reputation": 33459, "user_id": 928098, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/2761f0967c4a4b1839c1feee764c6dd7?s=128&d=identicon&r=PG", "display_name": "Kristian Glass", "link": "https://stackoverflow.com/users/928098/kristian-glass"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 1, "accepted_answer_id": 48610952, "answer_count": 2, "score": 4, "last_activity_date": 1517770516, "creation_date": 1517764555, "question_id": 48610855, "link": "https://stackoverflow.com/questions/48610855/porting-c-to-go-that-modifies-a-variable-in-an-if-check", "title": "Porting C to Go that modifies a variable in an if check", "body": "<p>I'm trying to port the following C code to Go:</p>\n\n<pre><code>if (x == 0 || x-- == 0) {\n    // Stuff\n}\n</code></pre>\n\n<p>This isn't legal in Go because I can't modify <code>x</code> inside the check clause.</p>\n\n<p>What's a good way of representing this in Go without e.g. duplicating the contents of the block?</p>\n"}, {"tags": ["go", "struct", "interface"], "comments": [{"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 2, "creation_date": 1517763353, "post_id": 48610604, "comment_id": 84217626, "body": "Use interface. And <code>*sql.DB</code> and <code>*DummyDatabaseConnection</code> both need to implement that interface"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1517842399, "post_id": 48610604, "comment_id": 84247242, "body": "<a href=\"https://tour.golang.org/methods/9\" rel=\"nofollow noreferrer\">Interfaces are covered in the Go tour</a>."}], "answers": [{"tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": true, "score": 2, "last_activity_date": 1517765511, "last_edit_date": 1517765511, "creation_date": 1517765209, "answer_id": 48610965, "question_id": 48610604, "link": "https://stackoverflow.com/questions/48610604/how-to-make-a-struct-accept-one-of-two-types-as-an-argument/48610965#48610965", "title": "How to make a struct accept one of two types as an argument?", "body": "<p>Define an Interface with some methods you need to call for <code>*sql.DB</code> &amp; <code>*DummyDatabaseConnection</code> </p>\n\n<pre><code>type DBInterface interface {\n    Ping() error\n    Close() error\n    // Some other Methods that you need\n}\n</code></pre>\n\n<p>Now your DummyDatabaseConnection should satisfy your DBInterface.</p>\n\n<pre><code>type DummyDatabaseConnection struct {\n}\n\nfunc(d *DummyDatabaseConnection) Ping()error {\n    return nil\n}\n\n\nfunc(d *DummyDatabaseConnection) Close()error {\n    return nil\n}\n</code></pre>\n\n<p>Use your Interface as argument</p>\n\n<pre><code>func (d *DbConnector) Init(db DBInterface) {\n    db.Ping()\n    db.Close()\n}\n</code></pre>\n\n<p>Call with which one you need.</p>\n\n<pre><code>    dbConnector := &amp;DbConnector{}\n\n    // Call with *sql.DB\n    db := &amp;sql.DB{}\n    dbConnector.Init(db)\n\n    // Call with *DummyDatabaseConnection\n    db := &amp;DummyDatabaseConnection{}\n    dbConnector.Init(db)\n</code></pre>\n\n<p>From your <code>Init(db DBInterface)</code> method, you only can call methods those are in <em>DBInterface</em> interface</p>\n\n<p>Check <a href=\"https://medium.com/golangspec/interfaces-in-go-part-i-4ae53a97479c\" rel=\"nofollow noreferrer\">this post</a></p>\n\n<p>Hope this will help</p>\n"}], "owner": {"reputation": 42794, "user_id": 135829, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/zfWZK.jpg?s=128&g=1", "display_name": "Sergei Basharov", "link": "https://stackoverflow.com/users/135829/sergei-basharov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 48610965, "answer_count": 1, "score": -2, "last_activity_date": 1517771136, "creation_date": 1517763093, "last_edit_date": 1517771136, "question_id": 48610604, "link": "https://stackoverflow.com/questions/48610604/how-to-make-a-struct-accept-one-of-two-types-as-an-argument", "title": "How to make a struct accept one of two types as an argument?", "body": "<p>I have a struct <code>DbConnector</code> which I want to use as a proxy to communicate with a database.</p>\n\n<p>This struct has method <code>Init(db *sql.DB)</code>.</p>\n\n<p>Depending on conditions, I want to be able to initialise it with another struct, like <code>DummyDatabaseConnection</code> for testing.</p>\n\n<p>How do I define the signature of <code>Init()</code> so that it accepts either <code>*sql.DB</code> or <code>*DummyDatabaseConnection</code>?</p>\n"}, {"tags": ["xml", "go", "xml-namespaces"], "answers": [{"comments": [{"owner": {"reputation": 656, "user_id": 6793457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHWs1.jpg?s=128&g=1", "display_name": "Siddhanta Rath", "link": "https://stackoverflow.com/users/6793457/siddhanta-rath"}, "edited": false, "score": 0, "creation_date": 1517766047, "post_id": 48609902, "comment_id": 84218558, "body": "Thank you for your answer, but when CwmpInformUnmarshal will be a part of a parent struct and used to Unmarshal against below xml content  :          &lt;Body&gt; \t\t  &lt;cwmp:Inform&gt; \t\t      &lt;DeviceId&gt;                       &lt;Manufacturer&gt;&lt;/Manufacturer&gt;                        &lt;OUI&gt;48BF74&lt;/OUI&gt;                       &lt;ProductClass&gt;FAP&lt;/ProductClass&gt;                      &lt;SerialNumber&gt;1202000042177AP0008&lt;/SerialNumber&gt; \t            &lt;/DeviceId&gt; \t\t   &lt;/cwmp:Inform&gt; \t        &lt;Body&gt; give output as empty structs :("}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "reply_to_user": {"reputation": 656, "user_id": 6793457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHWs1.jpg?s=128&g=1", "display_name": "Siddhanta Rath", "link": "https://stackoverflow.com/users/6793457/siddhanta-rath"}, "edited": false, "score": 0, "creation_date": 1517773766, "post_id": 48609902, "comment_id": 84221166, "body": "Yeah it&#39;s seems that there is something wrong with tags, but when you add <code>Inform</code> to xml.Name it unmarsall it properly. But still you will need to create another BodyM/BodyU struct for this."}, {"owner": {"reputation": 656, "user_id": 6793457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHWs1.jpg?s=128&g=1", "display_name": "Siddhanta Rath", "link": "https://stackoverflow.com/users/6793457/siddhanta-rath"}, "edited": false, "score": 0, "creation_date": 1517804768, "post_id": 48609902, "comment_id": 84228589, "body": "Thanks a ton :) @ttomalak"}, {"owner": {"reputation": 120, "user_id": 8408533, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/rjcTy.png?s=128&g=1", "display_name": "hoos", "link": "https://stackoverflow.com/users/8408533/hoos"}, "edited": false, "score": 0, "creation_date": 1573051264, "post_id": 48609902, "comment_id": 103755448, "body": "Thanks for the workaround it does seem to work but I also ran into the empty structs problem. Can you please explain what you mean by <code>create another BodyM&#47;BodyU struct</code> @ttomalak"}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "reply_to_user": {"reputation": 120, "user_id": 8408533, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/rjcTy.png?s=128&g=1", "display_name": "hoos", "link": "https://stackoverflow.com/users/8408533/hoos"}, "edited": false, "score": 2, "creation_date": 1573053049, "post_id": 48609902, "comment_id": 103756512, "body": "hello @hoos, I&#39;m happy that this answer helped you to resolve issue. It was some time ago, but if I remember correctly by this I mean thatm for parent <code>struct</code> to properly handle Unmarshal/Marshal you also need to create seperate <code>structs</code>."}, {"owner": {"reputation": 120, "user_id": 8408533, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/rjcTy.png?s=128&g=1", "display_name": "hoos", "link": "https://stackoverflow.com/users/8408533/hoos"}, "edited": false, "score": 0, "creation_date": 1573054289, "post_id": 48609902, "comment_id": 103757337, "body": "Thanks @ttomalak for the swift response! You are right I needed entirely separate structures for marshalling and unmarshalling."}], "tags": [], "owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "is_accepted": true, "score": 12, "last_activity_date": 1541329118, "last_edit_date": 1541329118, "creation_date": 1517759189, "answer_id": 48609902, "question_id": 48609596, "link": "https://stackoverflow.com/questions/48609596/xml-namespace-prefix-issue-at-go/48609902#48609902", "title": "xml namespace prefix issue at go", "body": "<p>Is probably the same issue here </p>\n\n<p><a href=\"https://github.com/golang/go/issues/9519\" rel=\"noreferrer\">https://github.com/golang/go/issues/9519</a></p>\n\n<p>To fix that you need to use two structs, one for Unmarshalling and second to Marshalling data</p>\n\n<pre><code>type CwmpInformUnmarshal struct {\n    XMLName  xml.Name `xml:\"Inform\"`\n    DeviceId DeviceId\n}\n\ntype CwmpInformMarshall struct {\n    XMLName  xml.Name `xml:\"cwmp:Inform\"`\n    DeviceId DeviceId\n}\n</code></pre>\n"}], "owner": {"reputation": 656, "user_id": 6793457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHWs1.jpg?s=128&g=1", "display_name": "Siddhanta Rath", "link": "https://stackoverflow.com/users/6793457/siddhanta-rath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5173, "favorite_count": 6, "accepted_answer_id": 48609902, "answer_count": 1, "score": 11, "last_activity_date": 1541329118, "creation_date": 1517757402, "last_edit_date": 1517846321, "question_id": 48609596, "link": "https://stackoverflow.com/questions/48609596/xml-namespace-prefix-issue-at-go", "title": "xml namespace prefix issue at go", "body": "<h2>marshalling and unmarshalling are not working properly with xml namespace prefix</h2>\n\n<blockquote>\n  <p>go version 1.9.2\n  See below code:</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n\n    \"fmt\"\n    \"encoding/xml\")\n\ntype DeviceId struct {\n    XMLName      xml.Name `xml:\"DeviceId\"`\n    Manufacturer string   `xml:\"Manufacturer\"`\n    OUI          string   `xml:\"OUI\"`\n    ProductClass string   `xml:\"ProductClass\"`\n    SerialNumber string   `xml:\"SerialNumber\"`\n}\n\ntype CwmpInform struct {\n    XMLName xml.Name `xml:\"cwmp:Inform\"`\n    DeviceId     DeviceId      \n}\n\n\nfunc main() {\n    rq := new(CwmpInform)\n    data := `&lt;cwmp:Inform&gt;\n                &lt;DeviceId&gt;\n                &lt;Manufacturer&gt;&lt;/Manufacturer&gt;\n                &lt;OUI&gt;48BF74&lt;/OUI&gt;\n                &lt;ProductClass&gt;FAP&lt;/ProductClass&gt;\n                &lt;SerialNumber&gt;1202000042177AP0008&lt;/SerialNumber&gt;\n                &lt;/DeviceId&gt;\n              &lt;/cwmp:Inform&gt;`\n\n    xml.Unmarshal([]byte (data), rq)\n    fmt.Printf(\"Unmarshelled Content:%v\", rq)\n    output, err := xml.MarshalIndent(rq,\"  \", \"  \")\n    if err != nil{\n    fmt.Printf(\"error : %v\", err)\n    }\n    fmt.Printf(\"Marshelled Content: %s\\n\", string(output))\n}\n</code></pre>\n\n<p>Output of above program with proper marshalled Content and empty Marshelled content  :</p>\n\n<pre><code>Unmarshelled Content:&amp;{{ } {{ }    }}\n Marshelled Content: \n  &lt;cwmp:Inform&gt;\n    &lt;DeviceId&gt;\n      &lt;Manufacturer&gt;&lt;/Manufacturer&gt;\n      &lt;OUI&gt;&lt;/OUI&gt;\n      &lt;ProductClass&gt;&lt;/ProductClass&gt;\n      &lt;SerialNumber&gt;&lt;/SerialNumber&gt;\n    &lt;/DeviceId&gt;\n  &lt;/cwmp:Inform&gt;\n</code></pre>\n\n<p>but when i change the struct's xml tag from <code>xml:\"cwmp:Inform\"</code> to <code>xml:\"cwmp Inform\"</code>, then Unmarshelling happens properly, but i get below output for Marshelled content :</p>\n\n<pre><code>&lt;Inform xmlns=\"cwmp\"&gt;\n    &lt;DeviceId&gt;\n      &lt;Manufacturer&gt;&lt;/Manufacturer&gt;\n      &lt;OUI&gt;48BF74&lt;/OUI&gt;\n      &lt;ProductClass&gt;FAP&lt;/ProductClass&gt;\n      &lt;SerialNumber&gt;1202000042177AP0008&lt;/SerialNumber&gt;\n    &lt;/DeviceId&gt;\n  &lt;/Inform&gt;\n</code></pre>\n\n<p>Instead of getting <code>&lt;cwmp:Inform&gt;</code>, I am getting <code>&lt;Inform xmlns=\"cwmp\"&gt;</code></p>\n\n<ul>\n<li>Is there any work around to correct the <strong>marshelled content</strong> ? Is it a\n<strong>go language</strong> Issue ?</li>\n</ul>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1517742493, "creation_date": 1517742493, "answer_id": 48607421, "question_id": 48607328, "link": "https://stackoverflow.com/questions/48607328/how-to-pass-function-handle-with-arguments-to-another-function-in-go/48607421#48607421", "title": "How to pass function handle with arguments to another function in Go?", "body": "<p>Use an anonymous function which calls your underlying function:</p>\n\n<pre><code>func main() {\n    scheduler(func() {\n        ping(\"Hello\")\n    }, time.Second)\n}\n</code></pre>\n\n<p>This allows calling arbitrarily complex functions, or even using closures:</p>\n\n<pre><code>db := // connect to a DB\nscheduler(func() {\n    ping(db, \"Hello\") // Or any other arbitrary complexity\n}, time.Second)\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 4150729, "user_type": "registered", "accept_rate": 81, "profile_image": "https://graph.facebook.com/1492722699/picture?type=large", "display_name": "Nik Kunkel", "link": "https://stackoverflow.com/users/4150729/nik-kunkel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1401, "favorite_count": 0, "accepted_answer_id": 48607421, "answer_count": 1, "score": 0, "last_activity_date": 1517768258, "creation_date": 1517741793, "last_edit_date": 1517768258, "question_id": 48607328, "link": "https://stackoverflow.com/questions/48607328/how-to-pass-function-handle-with-arguments-to-another-function-in-go", "title": "How to pass function handle with arguments to another function in Go?", "body": "<p>I created a scheduler() function which will execute a passed function on an interval.</p>\n\n<pre><code>func scheduler(what func(), delay time.Duration) {\n   fmt.Printf(\"Starting scheduled process on interval %d\\n\", delay)\n   ticker := time.NewTicker(delay)\n   quit := make(chan bool, 1)\n   go func() {\n      for {\n         select {\n           case &lt;- ticker.C:\n               what()\n           case &lt;- quit:\n               ticker.Stop()\n               return\n         }\n      }\n   }()\n   &lt;-quit\n}\n</code></pre>\n\n<p>Scheduling the following ping function works perfectly.</p>\n\n<pre><code>func ping() {\n   fmt.Printf(\"Tick\\n\")\n}\n\nfunc main() {\n   scheduler(ping, time.Second)\n}\n</code></pre>\n\n<p>However if I change ping to include an argument as so:</p>\n\n<pre><code>func ping(msg string) {\n    fmt.Printf (\"%s\\n\", msg)\n} \nfunc main() {\n  scheduler(ping(\"Hello\"), time.Second)\n}\n</code></pre>\n\n<p>I get the compile error:</p>\n\n<pre><code>ping(\"Hi\") used as value\n</code></pre>\n\n<p>How do I pass this function with arguments without passing it as the return value? I would like to keep the <code>scheduler()</code> function generic enough that I can use other functions that have different argument signatures.</p>\n"}, {"tags": ["go", "environment-variables", "windows-subsystem-for-linux"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517746260, "post_id": 48607302, "comment_id": 84212034, "body": "Please clarify how the <code>.env</code> is loaded exactly. Go doesn&#39;t handle <code>.env</code> natively, you&#39;re probably using <a href=\"https://github.com/joho/godotenv\" rel=\"nofollow noreferrer\">godotenv</a>. It sets the env variables for the current process (if using it as a library) and might work on windows. If you&#39;re sourcing the <code>.env</code> before running the go program, then that&#39;s even more detached and has nothing to do with Go."}, {"owner": {"reputation": 517, "user_id": 1821594, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/aEQLq.jpg?s=128&g=1", "display_name": "PizzaTheHut", "link": "https://stackoverflow.com/users/1821594/pizzathehut"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517748151, "post_id": 48607302, "comment_id": 84212528, "body": "Sorry forgot that part. Typically in a linux/bash environment I just <code>source foo.env</code>, which loads the environment variables within the file. This isn&#39;t necessarily specific to Go, it&#39;s just that I am having to use this method with a Go app."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1517748781, "post_id": 48607302, "comment_id": 84212695, "body": "Ok, then Godotenv mentioned above week so all that for you, both in Linux and windows."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1517764838, "post_id": 48607302, "comment_id": 84218142, "body": "<a href=\"https://direnv.net\" rel=\"nofollow noreferrer\">direnv</a> does this, although it uses .envrc by default. Not sure if this can be changed."}], "answers": [{"comments": [{"owner": {"reputation": 517, "user_id": 1821594, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/aEQLq.jpg?s=128&g=1", "display_name": "PizzaTheHut", "link": "https://stackoverflow.com/users/1821594/pizzathehut"}, "edited": false, "score": 0, "creation_date": 1517748224, "post_id": 48607926, "comment_id": 84212557, "body": "Yep looks like I might have to go this way, was just hoping there was something kicking around already. Cheers for the hint."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 517, "user_id": 1821594, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/aEQLq.jpg?s=128&g=1", "display_name": "PizzaTheHut", "link": "https://stackoverflow.com/users/1821594/pizzathehut"}, "edited": false, "score": 0, "creation_date": 1517754340, "post_id": 48607926, "comment_id": 84214528, "body": "@PizzaTheHut: It doesn&#39;t look hard! For a proof-of-concept, see my revised answer. Tested on Windows 10 and Ubuntu 17.10."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1517754636, "last_edit_date": 1517754636, "creation_date": 1517746419, "answer_id": 48607926, "question_id": 48607302, "link": "https://stackoverflow.com/questions/48607302/using-env-files-to-set-environment-variables-in-windows/48607926#48607926", "title": "Using .env files to set environment variables in Windows", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/os/\" rel=\"nofollow noreferrer\">Package os</a></p>\n\n<pre><code>import \"os\"\n\nfunc Clearenv()\nfunc Environ() []string\nfunc Expand(s string, mapping func(string) string) string\nfunc ExpandEnv(s string) string\nfunc Getenv(key string) string\nfunc Setenv(key, value string) error\nfunc Unsetenv(key string) error\n</code></pre>\n</blockquote>\n\n<p>Read the env file lines using <code>bufio.Scanner</code>. Parse the lines using the <code>strings</code> package. Use the <code>os</code> package environment variable functions.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"strings\"\n)\n\nfunc parseLine(line string) (key, value string) {\n    line = strings.TrimSpace(line)\n    const export = `export `\n    if !strings.HasPrefix(line, export) {\n        return \"\", \"\"\n    }\n    line = strings.TrimPrefix(line, export)\n    fields := strings.SplitN(line, \"=\", 2)\n    if len(fields) &gt; 0 {\n        key = strings.TrimSpace(fields[0])\n        if len(fields) &gt; 1 {\n            value = strings.TrimSpace(fields[1])\n        }\n    }\n    return key, value\n}\n\nfunc setenv(r io.Reader) error {\n    s := bufio.NewScanner(r)\n    for s.Scan() {\n        line := s.Text()\n        key, value := parseLine(line)\n        if len(key) &lt; 1 {\n            continue\n        }\n        err := os.Setenv(key, value)\n        if err != nil {\n            return err\n        }\n    }\n    if err := s.Err(); err != nil {\n        return err\n    }\n    return nil\n}\n\nfunc main() {\n    envFile := bytes.NewBufferString(\n        \"export VARIABLE1=foo\\r\\nexport VARIABLE2=bar\\n\",\n    )\n    err := setenv(envFile)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    for _, key := range []string{`VARIABLE1`, `VARIABLE2`} {\n        env, found := os.LookupEnv(key)\n        fmt.Println(key, found, env)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/pZKQ0GW5eCu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pZKQ0GW5eCu</a></p>\n\n<p>Output:</p>\n\n<pre><code>VARIABLE1 true foo\nVARIABLE2 true bar\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": false, "score": 2, "last_activity_date": 1552011441, "creation_date": 1552011441, "answer_id": 55055790, "question_id": 48607302, "link": "https://stackoverflow.com/questions/48607302/using-env-files-to-set-environment-variables-in-windows/55055790#55055790", "title": "Using .env files to set environment variables in Windows", "body": "<p>i used godotenv library.</p>\n\n<p>Add configuration values to a <strong>.env</strong> file at the root of project:</p>\n\n<pre><code>PORT=8080\nNAME=FlowAPI\n</code></pre>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"github.com/joho/godotenv\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc init() {\n    // loads values from .env into the system\n    if err := godotenv.Load(); err != nil {\n        log.Print(\"No .env file found\")\n    }\n}\n\nfunc main() {\n    // Get the PORT environment variable\n    port, exists := os.LookupEnv(\"PORT\")\n    if exists {\n        fmt.Println(port)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9199, "user_id": 1215344, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nuA7S.jpg?s=128&g=1", "display_name": "jamescampbell", "link": "https://stackoverflow.com/users/1215344/jamescampbell"}, "edited": false, "score": 0, "creation_date": 1617380576, "post_id": 65756642, "comment_id": 118295127, "body": "Question was for golang specific answer."}], "tags": [], "owner": {"reputation": 1274, "user_id": 2215534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08450d75fec6fc5d1a245cc846a49a04?s=128&d=identicon&r=PG&f=1", "display_name": "SadSack963", "link": "https://stackoverflow.com/users/2215534/sadsack963"}, "is_accepted": false, "score": 0, "last_activity_date": 1610849155, "creation_date": 1610849155, "answer_id": 65756642, "question_id": 48607302, "link": "https://stackoverflow.com/questions/48607302/using-env-files-to-set-environment-variables-in-windows/65756642#65756642", "title": "Using .env files to set environment variables in Windows", "body": "<p>Create a text file called &quot;.env&quot; (you could actually call it anything I guess, but this makes it brief and descriptive). Put this file in any folder of your choice... well away from any Python code you might make public, e.g. GitHub, GitLab, etc. For example, mine is located at &quot;E:/Python/EnvironmentVariables/.env&quot;.</p>\n<p>Edit the file in your favourite text editor, and create your secrets. You can have all of your secrets for all of your projects in this one file if you wish, [Headings] are optional and for your benefit only. Make sure all the key names are different - add the project name to the beginning or end if you wish:</p>\n<pre><code>[MyProject]\nMyUsername=&quot;Fred Bloggs&quot;\nMyEmail=&quot;fred@example.com&quot;\nMyPassword=&quot;fvghtyu7i890ol&quot;\n\n[MyOtherProject]\nMyAPIKey_MyOtherProject=&quot;FMu4ejyK-qQLBasTs7iHx*SFN5fF&quot;\nemail_port=110\nDEBUG=True\n</code></pre>\n<p>Now in your python program do this to get access to any secret you want, in any project!</p>\n<pre><code>import os\nfrom dotenv import load_dotenv\n\nload_dotenv(&quot;E:/Python/EnvironmentVariables/.env&quot;)\nUSER_NAME = os.getenv(&quot;MyUsername&quot;)\nAPI_KEY = os.getenv(&quot;MyAPIKey_MyOtherProject&quot;)\n\nprint(USER_NAME, API_KEY)\n</code></pre>\n"}], "owner": {"reputation": 517, "user_id": 1821594, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/aEQLq.jpg?s=128&g=1", "display_name": "PizzaTheHut", "link": "https://stackoverflow.com/users/1821594/pizzathehut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7191, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1610849155, "creation_date": 1517741594, "question_id": 48607302, "link": "https://stackoverflow.com/questions/48607302/using-env-files-to-set-environment-variables-in-windows", "title": "Using .env files to set environment variables in Windows", "body": "<p>I am working on a set of projects that use .env files for configuration, where each .env file exports a number of environment variables. The files are setup like;</p>\n\n<p><code>export VARIABLE1=foo</code></p>\n\n<p>I use the Windows Linux subsystem a lot for this, but would like to also be able to run these projects on my windows machine. The projects in question are Golang.</p>\n\n<p>IS there any easy way to programatically set Windows environment variables (preferably termporarily) from these .env files? These is mostly so I can debug within VSCode. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 3, "creation_date": 1517732337, "post_id": 48606084, "comment_id": 84208477, "body": "<code>myFuncName</code> is called a <i>method</i> and you can find information about them here: <a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">tour.golang.org/methods/1</a>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 1, "creation_date": 1517732529, "post_id": 48606084, "comment_id": 84208523, "body": "<code>t *SomeType</code> is called the method receiver. This means that <code>myFuncName</code> is a method on <code>SomeType</code>. Please take the Go tour, this is covered in the section linked to by @RayToal"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1517732815, "post_id": 48606084, "comment_id": 84208585, "body": "If you&#39;re studying the language, it&#39;s worth (repeatedly) slogging through the official language specification, even though it&#39;s dense and takes a while."}, {"owner": {"reputation": 19, "user_id": 1614403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7833096f450ade3f6876fa6722dfcc2c?s=128&d=identicon&r=PG", "display_name": "Sergo Kalandadze", "link": "https://stackoverflow.com/users/1614403/sergo-kalandadze"}, "edited": false, "score": 1, "creation_date": 1517735342, "post_id": 48606084, "comment_id": 84209118, "body": "Ray Toal - Thank You! So they (golang creators) have scrambled all the definitions - &quot;methods&quot; in programming are belong to class - while functions to the scope. No wonder it&#39;s hard to find information."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1517736744, "post_id": 48606084, "comment_id": 84209494, "body": "Nobody scrambled anything. Methods do not belong to classes. That&#39;s just how some languages use them."}, {"owner": {"reputation": 19, "user_id": 1614403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7833096f450ade3f6876fa6722dfcc2c?s=128&d=identicon&r=PG", "display_name": "Sergo Kalandadze", "link": "https://stackoverflow.com/users/1614403/sergo-kalandadze"}, "edited": false, "score": 0, "creation_date": 1517737220, "post_id": 48606084, "comment_id": 84209629, "body": "Flimzy - even if &quot;special methods&quot; may be used in the language specific way - it&#39;s not make it easier to come to the proper definition - while writing something called &quot;func&quot; to the scope."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1517738608, "post_id": 48606084, "comment_id": 84210010, "body": "(t *SomeType) is a method receiver. Since it is of pointer to struct <code>SomeType</code>. You needs to call method <code>myFuncName</code> using receiver. We can use method receivers as pointer in case we wants to point to variable which is struct having values assigned like pointer to database connection."}, {"owner": {"reputation": 19, "user_id": 1614403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7833096f450ade3f6876fa6722dfcc2c?s=128&d=identicon&r=PG", "display_name": "Sergo Kalandadze", "link": "https://stackoverflow.com/users/1614403/sergo-kalandadze"}, "edited": false, "score": 0, "creation_date": 1517742848, "post_id": 48606084, "comment_id": 84211172, "body": "Marc, Himanshu - Thank You both very much - the matter is clear for me now."}, {"owner": {"reputation": 21272, "user_id": 52277, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/67498fd0e17d27cb9be0c107f306e378?s=128&d=identicon&r=PG", "display_name": "Michael Freidgeim", "link": "https://stackoverflow.com/users/52277/michael-freidgeim"}, "edited": false, "score": 0, "creation_date": 1615586515, "post_id": 48606084, "comment_id": 117746872, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/34031801/function-declaration-syntax-things-in-parenthesis-before-function-name\">Function declaration syntax: things in parenthesis before function name</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 0, "last_activity_date": 1517732640, "creation_date": 1517732640, "answer_id": 48606143, "question_id": 48606084, "link": "https://stackoverflow.com/questions/48606084/what-the-meaning-of-golang-func-t-sometype-myfuncnameparam1-param2-synta/48606143#48606143", "title": "What the meaning of Golang &quot;func (t *SomeType) myFuncName(param1, param2)&quot; syntax", "body": "<p>That's a type definition followed by a method function definition with a pointer receiver of the defined type.  See <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">the Go Language Specification on Method Sets</a>.</p>\n\n<p>So</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n)\n\ntype TD struct {\n    Foo     string\n}\n\nfunc (td *TD) Bar() {\n    td.Foo = `bar`\n}\n\nfunc main() {\n    a := new(TD)\n    a.Bar()\n    fmt.Println(a.Foo)\n}\n</code></pre>\n\n<p>prints <code>bar</code></p>\n\n<p>It's somewhat similar to a class definition followed by a method definition in some other languages.</p>\n"}], "owner": {"reputation": 19, "user_id": 1614403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7833096f450ade3f6876fa6722dfcc2c?s=128&d=identicon&r=PG", "display_name": "Sergo Kalandadze", "link": "https://stackoverflow.com/users/1614403/sergo-kalandadze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1038, "favorite_count": 1, "answer_count": 1, "score": -6, "last_activity_date": 1615673672, "creation_date": 1517732087, "question_id": 48606084, "link": "https://stackoverflow.com/questions/48606084/what-the-meaning-of-golang-func-t-sometype-myfuncnameparam1-param2-synta", "title": "What the meaning of Golang &quot;func (t *SomeType) myFuncName(param1, param2)&quot; syntax", "body": "<p>I am studying Golang - in tutorials I often see syntax like this:</p>\n\n<pre><code>type SomeType struct {\n\n      //struct entries\n\n}\n</code></pre>\n\n<p>Following by:</p>\n\n<pre><code>func (t *SomeType) myFuncName(param1, param2) typeToReturn {\n\n     //function body and return\n\n}\n</code></pre>\n\n<p>Please explain what pointer to the struct (t *SomeType) does there - why it is needed and what is the correct name for this syntax - for it was impossible to find explanation in the official documentation.</p>\n"}, {"tags": ["gcc", "go"], "comments": [{"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 1, "creation_date": 1517728646, "post_id": 48605683, "comment_id": 84207699, "body": "Have you tried running a simple Go &quot;hello world&quot; on your system to make sure there&#39;s no problem with your Go setup/installation? <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">tour.golang.org/welcome/1</a>"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1517729075, "post_id": 48605683, "comment_id": 84207791, "body": "It&#39;s also recommended to <code>build</code> instead of <code>run</code> for any non-trivial program; you could try build and then execute and confirm that you get the same error, and tell us whether the error occurs when you build or when you execute. <code>go build pixel.go</code>"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1517734386, "post_id": 48605683, "comment_id": 84208872, "body": "Have you tried to run gcc manually in the same console as go?"}], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 1, "last_activity_date": 1517731738, "last_edit_date": 1517731738, "creation_date": 1517730234, "answer_id": 48605876, "question_id": 48605683, "link": "https://stackoverflow.com/questions/48605683/gcc-not-found-in-path/48605876#48605876", "title": "GCC not found in %PATH%", "body": "<p>You're depending on cgo packages, so you'll need GCC.  I can't find a version of TDM-GCC that's been updated since 2015.  I suggest looking for an alternative MinGW-w64 installation that has been updated more recently, such as this one which I have recently used for OpenGL with Go (1.9.1) on Windows 10 x64:</p>\n\n<p><a href=\"http://mingw-w64.org/doku.php\" rel=\"nofollow noreferrer\">http://mingw-w64.org/doku.php</a></p>\n\n<p>You'll need to add the installed directory /bin to your path, as you did for TDM-GCC-64.  You can test by trying <code>g++</code> in PowerShell (or cmd) to see whether it's a known command.  You should be able to <code>go get</code> packages you need from PowerShell.</p>\n\n<p>If you're still having trouble, make sure you have a relatively recent version of Go installed.</p>\n\n<p>Also, it's always recommended to use <code>go build</code> and then run the executable it creates instead of <code>go run</code> for any non-trivial code.  If you haven't run any other Go code yet, you could also try <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">a hello world</a> to make sure there aren't any problems with your Go installation and setup.</p>\n\n<p><a href=\"http://www.glfw.org/docs/latest/compile_guide.html#compile_generate\" rel=\"nofollow noreferrer\">The GLFW installation docs</a> talk about generating build files with cmake, but I don't think you'll need to do that.</p>\n"}], "owner": {"reputation": 51, "user_id": 8491005, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12c7135f147cd3676212a40e2d3f01f6?s=128&d=identicon&r=PG&f=1", "display_name": "Sid", "link": "https://stackoverflow.com/users/8491005/sid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8715, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1517731738, "creation_date": 1517728181, "last_edit_date": 1517728206, "question_id": 48605683, "link": "https://stackoverflow.com/questions/48605683/gcc-not-found-in-path", "title": "GCC not found in %PATH%", "body": "<p>I am trying to run this code: </p>\n\n<pre><code>package main\n\nimport (\"github.com/faiface/pixel\"\n        \"github.com/faiface/pixel/pixelgl\")\n\nfunc run(){\n    cfg := pixelgl.WindowConfig{\n        Title:\"My First program\",\n        Bounds:pixelgl.R(0,0,800,600)\n    }\n    window,err := pixelgl.NewWindow(cfg)\n    if err != nil{\n        panic(err)\n    }\n    for !window.Closed(){\n        win.Update()\n    }\n}       \n\n\nfunc main(){\n    pixelgl.Run(run)\n}\n</code></pre>\n\n<p>but whenever I type</p>\n\n<pre><code>go run pixel.go\n</code></pre>\n\n<p>I get this error</p>\n\n<pre><code>exec: \"gcc\": executable file not found in %PATH%\n</code></pre>\n\n<p>I have C:\\TDM-GCC-64\\bin in both my user path and the system path and the system finds gcc easily whenever I type \"gcc\" into cmd. I have an x64 Windows 10 System </p>\n"}, {"tags": ["go", "ssh"], "comments": [{"owner": {"reputation": 1251, "user_id": 1198224, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/26e95d4a1d91bab4d79881e6ee53b84c?s=128&d=identicon&r=PG", "display_name": "KZcoding", "link": "https://stackoverflow.com/users/1198224/kzcoding"}, "edited": false, "score": 0, "creation_date": 1517728182, "post_id": 48605616, "comment_id": 84207611, "body": "What is the error you are seeing?"}], "answers": [{"comments": [{"owner": {"reputation": 468, "user_id": 10319719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f455493e522051dfc4bb755e03c408d?s=128&d=identicon&r=PG&f=1", "display_name": "workaround", "link": "https://stackoverflow.com/users/10319719/workaround"}, "edited": false, "score": 0, "creation_date": 1574247365, "post_id": 48605681, "comment_id": 104161319, "body": "Any updates on this one? I have tried the above to no avail."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 3, "last_activity_date": 1517746917, "last_edit_date": 1592644375, "creation_date": 1517728173, "answer_id": 48605681, "question_id": 48605616, "link": "https://stackoverflow.com/questions/48605616/start-ssh-agent-from-golang-docker-and-alpine/48605681#48605681", "title": "Start SSH Agent from golang, docker, and alpine", "body": "<p><code>ssh-add</code> (and <code>ssh</code> and others) need to know how to contact <code>ssh-agent</code>.</p>\n<p>This is done through the <code>SSH_AGENT_SOCK</code> environment variable.</p>\n<p>When you run <code>ssh-agent</code>, it will print something like the following which is usually evaluated:</p>\n<pre><code>SSH_AUTH_SOCK=/tmp/ssh-OLGZ7hANaDNH/agent.31224; export SSH_AUTH_SOCK;\nSSH_AGENT_PID=31225; export SSH_AGENT_PID;\necho Agent pid 31225;\n</code></pre>\n<p>You have two options here:</p>\n<h3>Parse the value of <code>SSH_AUTH_SOCK</code>:</h3>\n<p>Then set it as an environment variable (eg: using <a href=\"https://golang.org/pkg/os/#Setenv\" rel=\"nofollow noreferrer\">os.Setenv</a>) for the call to <code>ssh-add</code> and your further calls to <code>ssh</code>.</p>\n<h3>or Make your own temporary file name:</h3>\n<p>And specify it as a custom bind address using <code>ssh-agent -a /path/to/my/custom/unix-socket</code>, then set that as the <code>SSH_AUTH_SOCK</code> environment variable.</p>\n"}], "owner": {"reputation": 8655, "user_id": 500959, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/2c85484c7e19760334d44c29caba7823?s=128&d=identicon&r=PG", "display_name": "austinbv", "link": "https://stackoverflow.com/users/500959/austinbv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 917, "favorite_count": 0, "accepted_answer_id": 48605681, "answer_count": 1, "score": 2, "last_activity_date": 1517746917, "creation_date": 1517727656, "last_edit_date": 1517729736, "question_id": 48605616, "link": "https://stackoverflow.com/questions/48605616/start-ssh-agent-from-golang-docker-and-alpine", "title": "Start SSH Agent from golang, docker, and alpine", "body": "<p>I have a go program that I need to add a ssh key to. The SSH agent is not running when the container starts so I have been trying to figure out how to get it to start.</p>\n\n<p>No matter what I try get an error that ssh-add cannot connect to the agent</p>\n\n<pre><code>  os.Mkdir(\"/root/.ssh\", 0700)\n  privateKeyPath := \"/root/.ssh/id_rsa\"\n  err := ioutil.WriteFile(privateKeyPath, []byte(request.Source.GitPrivateKey), 0600)\n  if err != nil {\n    log.Panic(err)\n  }\n\n  err = exec.Command(\"ssh-agent\").Run()\n  if err != nil {\n    log.Panic(err)\n  }\n  err = exec.Command(\"ssh-add\", privateKeyPath).Run()\n  if err != nil {\n    log.Panic(err)\n  }\n</code></pre>\n"}, {"tags": ["go", "deadlock", "goroutine"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1517722867, "post_id": 48605001, "comment_id": 84206734, "body": "Not related to the error (for now) but you are trying to recieve the channel three times while you only try to send 2 messages. That seems pretty wrong."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1517725617, "post_id": 48605001, "comment_id": 84207213, "body": "The second part of code line 14 never gets a chance to execuate because when main func returns, the go program ends. You can add a simple <code>time.Sleep(time.Second)</code> (remember to <code>import &quot;time&quot;</code>) after line 16 to see the effect."}], "answers": [{"comments": [{"owner": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "edited": false, "score": 0, "creation_date": 1517724449, "post_id": 48605086, "comment_id": 84207006, "body": "msg := make(chan string, 2)    msg &lt;- &quot;hi whats up&quot;  fmt.Println(&quot;*****I am main go routine*****&quot;)  go func() {  fmt.Println(&quot;*****HI ABHI *****\\n&quot;)  temp := &lt;-msg  fmt.Println(temp)  //msg &lt;- &quot;Hello from a goroutine!&quot; //send a string through the channel  }()"}, {"owner": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "edited": false, "score": 0, "creation_date": 1517724797, "post_id": 48605086, "comment_id": 84207078, "body": "If look at my comment, I have edited the program, even now the &quot;fmt.Println(temp)&quot; doesn&#39;t print"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "edited": false, "score": 0, "creation_date": 1517724984, "post_id": 48605086, "comment_id": 84207108, "body": "@Invictus Please edit the code into the question and format it. It is mostly unreadable here."}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "reply_to_user": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "edited": false, "score": 0, "creation_date": 1517725126, "post_id": 48605086, "comment_id": 84207133, "body": "@Invictus: The program ends when the main goroutine ends."}], "tags": [], "owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "is_accepted": true, "score": 3, "last_activity_date": 1517722598, "creation_date": 1517722598, "answer_id": 48605086, "question_id": 48605001, "link": "https://stackoverflow.com/questions/48605001/goroutines-deadlock-need-some-explanation/48605086#48605086", "title": "goroutines deadlock, need some explanation", "body": "<p>You're trying to send messages two ways on the same channel, and you don't do anything to guarantee who reads which messages. It's entirely possible for the main goroutine to receive <strong>the message it sent</strong>, before the <code>func</code> goroutine attempts to read from the channel. If that happens, both goroutines get stuck waiting for messages that will never arrive.</p>\n\n<p>Use two channels.</p>\n"}, {"comments": [{"owner": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "edited": false, "score": 0, "creation_date": 1517724622, "post_id": 48605091, "comment_id": 84207043, "body": "For point #1, if the new go-routine doesn&#39;t inherit from main go-routine then how does the &quot;new go-routine&quot; get the msg channel????"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "edited": false, "score": 0, "creation_date": 1517724907, "post_id": 48605091, "comment_id": 84207097, "body": "@Invictus that is what we call &quot;closure&quot;. Google it."}, {"owner": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "edited": false, "score": 0, "creation_date": 1517725339, "post_id": 48605091, "comment_id": 84207161, "body": "But, I didn&#39;t pass the &quot;msg chan&quot; in the closure for the new go-routine, then how did the new go-routine get it???"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "edited": false, "score": 1, "creation_date": 1517725511, "post_id": 48605091, "comment_id": 84207195, "body": "@Invictus it is hard to explain the whole concpets of closure here, but simply put, the goroutine, as a function, can access variable of the otter scope, which is the main func."}], "tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": false, "score": 1, "last_activity_date": 1517722631, "creation_date": 1517722631, "answer_id": 48605091, "question_id": 48605001, "link": "https://stackoverflow.com/questions/48605001/goroutines-deadlock-need-some-explanation/48605091#48605091", "title": "goroutines deadlock, need some explanation", "body": "<p>The newly started goroutine can capture variables from the outer code via a closure, but otherwise don't inherit anything.</p>\n\n<p>There's a race between the channel receive on line 13 and the one on line 20. If the read on line 20 gets executed first, it'll consume the only value on the channel, and ultimately, both goroutines are blocked reading from a channel, hence the deadlock error. If you want to get a value out of the goroutine back, its better to have another channel rather than trying to sequence it all on the one.</p>\n"}, {"comments": [{"owner": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "edited": false, "score": 0, "creation_date": 1517723790, "post_id": 48605118, "comment_id": 84206896, "body": "Why would it not work if I write into the msg channel before calling the &quot;go routine&quot;???"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "edited": false, "score": 2, "creation_date": 1517725027, "post_id": 48605118, "comment_id": 84207118, "body": "@Invictus in this code, it is because it is unbuffered and nothing reads from it (the goroutine has not started yet)."}], "tags": [], "owner": {"reputation": 767, "user_id": 927514, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fb896eb76968f2cd5df57260ddb6193?s=128&d=identicon&r=PG", "display_name": "enocom", "link": "https://stackoverflow.com/users/927514/enocom"}, "is_accepted": false, "score": 1, "last_activity_date": 1517725537, "last_edit_date": 1517725537, "creation_date": 1517722933, "answer_id": 48605118, "question_id": 48605001, "link": "https://stackoverflow.com/questions/48605001/goroutines-deadlock-need-some-explanation/48605118#48605118", "title": "goroutines deadlock, need some explanation", "body": "<p>Here's a working example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    msg := make(chan string)\n    go func() {\n        temp := &lt;-msg\n        fmt.Println(temp)\n        msg &lt;- \"Hello from a goroutine!\"\n    }()\n\n    msg &lt;- \"hi whats up\"\n    fmt.Println(&lt;-msg)\n}\n</code></pre>\n\n<p>With an unbuffered channel, message passing is synchronous, so goroutines never receive messages from themselves (because the same goroutine would have to be sending and receiving at the same time for that to happen). Note that this design requires you to start the goroutine reading from the <code>msg</code> channel before writing anything into it, or you'd be stuck waiting for the reader and unable to start it.</p>\n"}], "owner": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 48605086, "answer_count": 3, "score": 1, "last_activity_date": 1517783620, "creation_date": 1517721703, "last_edit_date": 1517783620, "question_id": 48605001, "link": "https://stackoverflow.com/questions/48605001/goroutines-deadlock-need-some-explanation", "title": "goroutines deadlock, need some explanation", "body": "<p>I wanted to understand how does the Go-routine work here.</p>\n\n<p>Question 1:\nDoes the go-routine inherit anything from the main GO routine/func??</p>\n\n<p>Question 2:\nAlso wanted to know if I send \"hi whats up\" into the msg channel why is it not received by the go-routine at LINE:13????</p>\n\n<pre><code>  1 package main\n  2 \n  3 import \"fmt\"\n  4 \n  5 func main() {\n  6     msg := make(chan string, 2) //channel (bidirectional channel) of type string\n  7 \n  8     msg &lt;- \"hi whats up\"\n  9     fmt.Println(\"*****I am main go routine*****\")\n 10 \n 11     go func() {\n 12         fmt.Println(\"*****HI ABHI *****\\n\")\n 13         temp := &lt;-msg\n 14         fmt.Println(temp)\n 15         msg &lt;- \"Hello from a goroutine!\" //send a string through the channel\n 16     }()\n 17 \n 18     fmt.Println(\"Main routine waiting for message\")\n 19 \n 20     fmt.Println(&lt;-msg) //receive the string from the channel\n 21     fmt.Println(&lt;-msg)\n 22 }  \n</code></pre>\n\n<p>Getting following error:</p>\n\n<blockquote>\n  <p>*****I am main go routine*****</p>\n  \n  <p>Main routine waiting for message</p>\n  \n  <p>hi whats up</p>\n  \n  <p>*****HI ABHI *****</p>\n  \n  <p>fatal error: all goroutines are asleep - deadlock!</p>\n  \n  <p>goroutine 1 [chan receive]:</p>\n  \n  <p>main.main()</p>\n  \n  <p>/Users//work/go/src/github.com/Golang_play/goroutine/goroutine.go:21\n  +0x1e6</p>\n  \n  <p>goroutine 5 [chan receive]:</p>\n  \n  <p>main.main.func1(0xc420054060)</p>\n  \n  <p>/Users/work/go/src/github.com/Golang_play/goroutine/goroutine.go:13\n  +0x98 created by main.main    /Users/work/go/src/github.com/Golang_play/goroutine/goroutine.go:11\n  +0xe2 exit status 2</p>\n</blockquote>\n\n<p>Also in the following program LINE 14 never prints.</p>\n\n<pre><code> 5 func main() {\n  6     msg := make(chan string, 2) //channel (bidirectional channel) of type string\n  7 \n  8     msg &lt;- \"hi whats up\"\n  9     fmt.Println(\"*****I am main go routine*****\")\n 10 \n 11     go func() {\n 12         fmt.Println(\"*****HI ABHI *****\\n\")\n 13         temp := &lt;-msg\n 14         fmt.Println(temp)\n 15         //msg &lt;- \"Hello from a goroutine!\" //send a string through the channel\n 16     }()\n</code></pre>\n"}, {"tags": ["go", "concurrency", "timeout", "goroutine"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1517721483, "post_id": 48604783, "comment_id": 84206478, "body": "The &quot;not-duplicate&quot; code still block in playground, which is Go 1.9. I doubt it is the same reason after all."}, {"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 0, "creation_date": 1517722722, "post_id": 48604783, "comment_id": 84206706, "body": "Are you setting GOMAXPROCS ?"}, {"owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "reply_to_user": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 0, "creation_date": 1517723268, "post_id": 48604783, "comment_id": 84206812, "body": "@superfell Other code in the project sets <code>GOMAXPROCS(runtime.NumCPU())</code> which is <code>8</code> on my machine. So it should still work..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1517740177, "post_id": 48604783, "comment_id": 84210449, "body": "Do thread locking in <code>MyCodeWithTimeout()</code>, not in the goroutine it starts."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1517768137, "last_edit_date": 1517768137, "creation_date": 1517741730, "answer_id": 48607320, "question_id": 48604783, "link": "https://stackoverflow.com/questions/48604783/how-do-i-timeout-a-blocking-external-library-call/48607320#48607320", "title": "How do I timeout a blocking external library call?", "body": "<p>Your proposed solution to do thread locking in the goroutine started in <code>MyCodeWithTimeout()</code> does not give guarantee <code>MyCodeWithTimeout()</code> will return after 3 seconds, and the reason for this is that first: no guarantee that the started goroutine will get scheduled and reach the point to lock the thread to the goroutine, and second: because even if the external command or syscall gets called and returns within 3 seconds, there is no guarantee that the other goroutine running <code>MyCodeWithTimeout()</code> will get scheduled to receive the result.</p>\n\n<p>Instead do the thread locking in <code>MyCodeWithTimeout()</code>, not in the goroutine it starts:</p>\n\n<pre><code>func MyCodeWithTimeout() {\n    runtime.LockOSThread()\n    defer runtime.UnlockOSThread()\n\n    ch = make(chan somethingResult, 1);\n    defer close(ch)\n    go func() {\n        something, err := InvokeSomething() // blocks here for 60 seconds\n        ret := somethingResult{ something, err }\n        ch &lt;- ret\n    }()\n    select {\n    case result := &lt;-ch:\n        // etc\n    case &lt;-time.After(time.Second *3):\n        // report timeout\n    }\n}\n</code></pre>\n\n<p>Now if <code>MyCodeWithTimeout()</code> execution starts, it will lock the goroutine to the OS thread, and you can be sure that this goroutine will notice the value sent on the timers value.</p>\n\n<p><strong>NOTE:</strong> This is better if you want it to return within 3 seconds, but this sill will not give guarantee, as the timer that fires (sends a value on its channel) runs in its own goroutine, and this thread locking has no effect on the scheduling of that goroutine.</p>\n\n<p>If you want guarantee, you can't rely on other goroutines giving the \"exit\" signal, you can only rely on this happening in your goroutine running the <code>MyCodeWithTimeout()</code> function (because since you did thread locking, you can be sure it gets scheduled).</p>\n\n<p>An \"ugly\" solution which spins up CPU usage for a given CPU core would be:</p>\n\n<pre><code>for end := time.Now().Add(time.Second * 3); time.Now().Before(end); {\n    // Do non-blocking check:\n    select {\n    case result := &lt;-ch:\n        // Process result\n    default: // Must have default to be non-blocking\n    }\n}\n</code></pre>\n\n<p>Note that the \"urge\" of using <a href=\"https://golang.org/pkg/time/#Sleep\" rel=\"nofollow noreferrer\"><code>time.Sleep()</code></a> in this loop would take away the guarantee, as <code>time.Sleep()</code> may use goroutines in its implementation and certainly does not guarantee to return exactly after the given duration.</p>\n\n<p>Also note that if you have 8 CPU cores and <a href=\"https://golang.org/pkg/runtime/#GOMAXPROCS\" rel=\"nofollow noreferrer\"><code>runtime.GOMAXPROCS(0)</code></a> returns 8 for you, and your goroutines are still \"starving\", this may be a temporary solution, but you still have more serious problems using Go's concurrency primitives in your app (or a lack of using them), and you should investigate and \"fix\" those. Locking a thread to a goroutine may even make it worse for the rest of the goroutines.</p>\n"}], "owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1517768137, "creation_date": 1517719392, "last_edit_date": 1517746744, "question_id": 48604783, "link": "https://stackoverflow.com/questions/48604783/how-do-i-timeout-a-blocking-external-library-call", "title": "How do I timeout a blocking external library call?", "body": "<p>(I don't believe my issue is a duplicate of this QA:  <a href=\"https://stackoverflow.com/questions/17953269/go-routine-blocking-the-others-one\">go routine blocking the others one</a>, because I'm running Go 1.9 which has the preemptive scheduler whereas that question was asked for Go 1.2).</p>\n\n<p>My Go program calls into a C library wrapped by another Go-lang library that makes a blocking call that can last over 60 seconds. I want to add a timeout so it returns in 3 seconds:</p>\n\n<p>Old code with long block:</p>\n\n<pre><code>// InvokeSomething is part of a Go wrapper library that calls the C library read_something function. I cannot change this code.\n\nfunc InvokeSomething() ([]Something, error)  {\n    ret := clib.read_something(&amp;input) // this can block for 60 seconds\n    if ret.Code &gt; 1 {\n        return nil, CreateError(ret)\n    }\n    return ret.Something, nil\n}\n\n// This is my code I can change:\n\nfunc MyCode() {\n\n    something, err := InvokeSomething()\n    // etc\n}\n</code></pre>\n\n<p>My code with a go-routine, channel, and timeout, based on this Go example: <a href=\"https://gobyexample.com/timeouts\" rel=\"nofollow noreferrer\">https://gobyexample.com/timeouts</a></p>\n\n<pre><code>type somethingResult struct {\n    Something []Something\n    Err        error\n}\n\nfunc MyCodeWithTimeout() {\n    ch = make(chan somethingResult, 1);\n    go func() {\n        something, err := InvokeSomething() // blocks here for 60 seconds\n        ret := somethingResult{ something, err }\n        ch &lt;- ret\n    }()\n    select {\n    case result := &lt;-ch:\n        // etc\n    case &lt;-time.After(time.Second *3):\n        // report timeout\n    }\n}\n</code></pre>\n\n<p>However when I run <code>MyCodeWithTimeout</code> it still takes 60 seconds before it executes the <code>case &lt;-time.After(time.Second * 3)</code> block.</p>\n\n<p><a href=\"https://blog.sgmansfield.com/2016/06/how-to-block-forever-in-go/\" rel=\"nofollow noreferrer\">I know that attempting to read from an unbuffered channel with nothing in it</a> will block, but I created the channel with a buffered size of <code>1</code> so as far as I can tell I'm doing it correctly. I'm surprised the Go scheduler isn't preempting my goroutine, or does that depend on execution being in go-lang code and not an external native library?</p>\n\n<h2>Update:</h2>\n\n<p>I read that the Go-scheduler, at least in 2015, is actually \"semi-preemptive\" and it doesn't preempt OS threads that are in \"external code\": <a href=\"https://github.com/golang/go/issues/11462\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/11462</a></p>\n\n<blockquote>\n  <p>you can think of the Go scheduler as being partially preemptive. It's by no means fully cooperative, since user code generally has no control over scheduling points, but it's also not able to preempt at arbitrary points</p>\n</blockquote>\n\n<p>I heard that <code>runtime.LockOSThread()</code> might help, so I changed the function to this:</p>\n\n<pre><code>func MyCodeWithTimeout() {\n    ch = make(chan somethingResult, 1);\n    defer close(ch)\n    go func() {\n        runtime.LockOSThread()\n        defer runtime.UnlockOSThread()\n        something, err := InvokeSomething() // blocks here for 60 seconds\n        ret := somethingResult{ something, err }\n        ch &lt;- ret\n    }()\n    select {\n    case result := &lt;-ch:\n        // etc\n    case &lt;-time.After(time.Second *3):\n        // report timeout\n    }\n}\n</code></pre>\n\n<p>...however it didn't help at all and it still blocks for 60 seconds.</p>\n"}, {"tags": ["mysql", "database", "go", "amazon-rds"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1517753062, "post_id": 48603474, "comment_id": 84214120, "body": "Please, don&#39;t include <a href=\"https://meta.stackoverflow.com/q/303812/13860\">screen shots of text</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2855262"}, "edited": false, "score": 0, "creation_date": 1517736252, "post_id": 48605180, "comment_id": 84209360, "body": "Andrew thank you for your time is has been very much appreciated! I messed about until 1am and I did get everything working using the library you mentioned &#39;go-sql-driver&#39; which worked straight away with as you said the standard connection string format. I am going to take your valuable advice and use the &#39;go-sql-driver&#39; instead as it appears to just be a more standard solid solution. Many thanks again Andrew."}], "tags": [], "owner": {"reputation": 319196, "user_id": 34211, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/gfFlI.jpg?s=128&g=1", "display_name": "Andrew Hare", "link": "https://stackoverflow.com/users/34211/andrew-hare"}, "is_accepted": true, "score": 3, "last_activity_date": 1517723499, "creation_date": 1517723499, "answer_id": 48605180, "question_id": 48603474, "link": "https://stackoverflow.com/questions/48603474/i-need-some-help-getting-the-connection-string-correct-to-connect-golang-to-aws/48605180#48605180", "title": "I need some help getting the connection string correct to connect Golang to AWS RDS", "body": "<p>The mymysql package defines a non-standard URI format for accessing MySQL when using the <code>database/sql</code> package (from <a href=\"https://github.com/ziutek/mymysql#example-7---use-databasesql-with-mymysql-driver\" rel=\"nofollow noreferrer\">their readme</a>):</p>\n\n<pre><code>[PROTOCOL_SPECIFIC*]DBNAME/USER/PASSWD\n</code></pre>\n\n<p>So in your case you'd want to change your format string to this:</p>\n\n<pre><code>connectionStr := fmt.Sprintf(\"tcp:%s:3306,%s/%s/%s\", database, dbname, user, password)\n</code></pre>\n\n<p>The reason you are seeing the error you are seeing is that the <code>Open</code> function splits the URI into 3 parts based on <code>/</code> (see <a href=\"https://github.com/ziutek/mymysql/blob/master/godrv/driver.go#L359-L362\" rel=\"nofollow noreferrer\">this</a>) and fails if it finds less than three parts.</p>\n\n<p>On a side note, unless you have a strong reason for choosing <code>mymysql</code> you should consider using <a href=\"https://github.com/go-sql-driver/mysql\" rel=\"nofollow noreferrer\">go-sql-driver/mysql</a> as it is an excellent MySQL driver and supports standard MySQL DSNs like you already have defined.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2855262"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 479, "favorite_count": 0, "accepted_answer_id": 48605180, "answer_count": 1, "score": 1, "last_activity_date": 1517753039, "creation_date": 1517703539, "last_edit_date": 1517753039, "question_id": 48603474, "link": "https://stackoverflow.com/questions/48603474/i-need-some-help-getting-the-connection-string-correct-to-connect-golang-to-aws", "title": "I need some help getting the connection string correct to connect Golang to AWS RDS", "body": "<p>I have been looking and looking on how to connect a Golang application to a MySQL database (I am using the MyMySQL library with the database/sql interface). If I use the none native version not the database/sql interface I can get the connection to work perfectly and perform queries. If I try to connect using the database/sql go interface (which I think is the best way to interface to MySQL?) then I just cannot get the connection to work? The error I keep getting is 'Wrong database part of URI'?????</p>\n\n<p>Sorry for the variable names but I have been trying and trying to get various versions working so the names are a bit screwy sorry again.</p>\n\n<p>I am grateful for any help understanding my problem, thanks again for your time.</p>\n\n<p><a href=\"https://i.stack.imgur.com/CbcCh.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CbcCh.png\" alt=\"The go code which I am using to produce the connection string.\"></a></p>\n"}]