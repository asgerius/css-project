[{"tags": ["go", "amazon-dynamodb"], "comments": [{"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 1, "creation_date": 1531347916, "post_id": 51294877, "comment_id": 89567510, "body": "<code>dynamodbattribute.MarshalMap(*myStructInstance)</code> returns two values: <code>value</code> &amp; <code>error</code>. You can&#39;t use it like that there. Handle the error and get the value first, and then set that value as value of <code>M</code> in your map."}], "answers": [{"tags": [], "owner": {"reputation": 1187, "user_id": 943183, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f69a15a656e380944c177cc9801c1945?s=128&d=identicon&r=PG", "display_name": "onlywei", "link": "https://stackoverflow.com/users/943183/onlywei"}, "is_accepted": false, "score": 1, "last_activity_date": 1531347893, "creation_date": 1531347893, "answer_id": 51294990, "question_id": 51294877, "link": "https://stackoverflow.com/questions/51294877/using-the-go-sdk-how-do-i-set-a-dynamodb-table-item-field-to-a-map/51294990#51294990", "title": "Using the Go SDK, how do I set a DynamoDB table item field to a map?", "body": "<p>Ah, I forgot that the <code>MarshalMap</code> function has two return values, so I have to do this instead:</p>\n\n<pre><code>av, err := dynamodbattribute.MarshalMap(*myStructInstance)\n\n_, err = svc.UpdateItem(&amp;dynamodb.UpdateItemInput{\n  TableName: aws.String(\"MyTable\"),\n  Key: myKey,\n  ExpressionAttributeValues: map[string]*dynamodb.AttributeValue{\n    \":m\": {\n      M: av,\n    },\n  },\n  UpdateExpression: aws.String(\"SET myField = :m\"),\n})\n</code></pre>\n"}], "owner": {"reputation": 1187, "user_id": 943183, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f69a15a656e380944c177cc9801c1945?s=128&d=identicon&r=PG", "display_name": "onlywei", "link": "https://stackoverflow.com/users/943183/onlywei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 735, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1531347893, "creation_date": 1531347201, "question_id": 51294877, "link": "https://stackoverflow.com/questions/51294877/using-the-go-sdk-how-do-i-set-a-dynamodb-table-item-field-to-a-map", "title": "Using the Go SDK, how do I set a DynamoDB table item field to a map?", "body": "<p>I am trying to use the <code>UpdateItem</code> method to set the value of a table item field to a map. Here's what I have tried:</p>\n\n<pre><code>type myStruct {\n  name string\n}\n\nmyStructInstance := myStruct{name: \"foo\"}\n\n_, err := svc.UpdateItem(&amp;dynamodb.UpdateItemInput{\n  TableName: aws.String(\"MyTable\"),\n  Key: myKey,\n  ExpressionAttributeValues: map[string]*dynamodb.AttributeValue{\n    \":m\": {\n      M: dynamodbattribute.MarshalMap(*myStructInstance),\n    },\n  },\n  UpdateExpression: aws.String(\"SET myField = :m\"),\n})\n</code></pre>\n\n<p>With this, I keep getting the error:</p>\n\n<pre><code>multiple-value dynamodbattribute.MarshalMap() in single-value context\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1531341772, "post_id": 51293840, "comment_id": 89565255, "body": "What specifically do you mean by &quot;in the same spot&quot;?  Do you mean at the same byte offset, or something else?  An example input and output might help explain the problem. Also, the JSON package can unmarshal JSON objects to maps.  Structs are not required."}, {"owner": {"reputation": 77, "user_id": 7538020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82e5009845389e7fe6a62b48c7399cb8?s=128&d=identicon&r=PG&f=1", "display_name": "jmagi98", "link": "https://stackoverflow.com/users/7538020/jmagi98"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1531342092, "post_id": 51293840, "comment_id": 89565387, "body": "@ThunderCat my apologize, poor phrasing on my part.  I meant in the json there will always be the same array and within that array there will always be a name &quot;url&quot; and I need to change the value of that. I will see if I can find an appropriate example to upload to make the question more clear."}, {"owner": {"reputation": 77, "user_id": 7538020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82e5009845389e7fe6a62b48c7399cb8?s=128&d=identicon&r=PG&f=1", "display_name": "jmagi98", "link": "https://stackoverflow.com/users/7538020/jmagi98"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1531342727, "post_id": 51293840, "comment_id": 89565657, "body": "@ThunderCat I have added a brief code snippet to show what it is I am attempting to do. The url portion is what I am attempting to change"}], "answers": [{"comments": [{"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1531346763, "post_id": 51294213, "comment_id": 89567157, "body": "Although the solution works in this specific case, I want to add that it could have been written in a more generic way so the solution can be used in a more generic way. But the audience, reading it until here will surely be able to write that themselve. So for inspiration it is a good solution, and for this case also, but a more generic solution with recursive search would be more useful. So you deserve the plus point from me."}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "reply_to_user": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1531346882, "post_id": 51294213, "comment_id": 89567190, "body": "@BertVerhees yup, I would agree. I think ThunderCat&#39;s solution is better. I&#39;ll just leave mine here in case somebody finds it useful as well. Thanks for the feedback."}, {"owner": {"reputation": 77, "user_id": 7538020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82e5009845389e7fe6a62b48c7399cb8?s=128&d=identicon&r=PG&f=1", "display_name": "jmagi98", "link": "https://stackoverflow.com/users/7538020/jmagi98"}, "edited": false, "score": 0, "creation_date": 1531411609, "post_id": 51294213, "comment_id": 89596962, "body": "@Mihailo I ended up going with this solution because it does not require remarshalling, as the first solution did. The formatting of the json file is very important, and I was running into the issue of when unmarshalling, editing and then marshalling back, I was loosing the exact structure I needed (because I was using just generic interface instead of a proper struct) Thus, soley editing the file, while not as effiecient, maintained the exact structure I needed! Thanks!"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1531414347, "post_id": 51294213, "comment_id": 89598415, "body": "Oh nice! Glad I could be of help. ThunderCat&#39;s method is great."}], "tags": [], "owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "is_accepted": false, "score": 1, "last_activity_date": 1531343490, "creation_date": 1531343490, "answer_id": 51294213, "question_id": 51293840, "link": "https://stackoverflow.com/questions/51293840/editing-json-in-go-without-unmarshalling-into-structs-first/51294213#51294213", "title": "Editing Json in Go without Unmarshalling into Structs First", "body": "<p>One way you can solve this is by reading the file and changing it.</p>\n\n<p>Lets say you have the file as you mentioned:</p>\n\n<blockquote>\n  <p>example.json</p>\n</blockquote>\n\n<pre><code>{\n    \"paths\": {\n        \"/account\": {\n            \"post\": {\n                \"something\": \"body\",\n                \"api\": {\n                    \"uri\": \"http://thisiswhereineedtoedit.com\"\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>And we want to change the line with <code>\"uri\"</code> in it.<br>\n<strong><em>You should be more specific then I was in this example, make a placeholder or something - to avoid changing the wrong line.</em></strong></p>\n\n<p>You can use a small program that would look something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n    file := \"./example.json\"\n    url := \"\\\"uri\\\": \\\"supreme-uri\\\"\"\n\n    // Read the file\n    input, err := ioutil.ReadFile(file)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    // Split it into lines\n    lines := strings.Split(string(input), \"\\n\")\n\n    // Find the line that contains our \"placeholder\" / \"uri\"\n    for i, line := range lines {\n        if strings.Contains(line, \"\\\"uri\\\":\") {\n            // Replace the line\n            lines[i] = \"\\\"uri\\\": \" + url\n        }\n    }\n\n    // Join lines and write to file\n    output := strings.Join(lines, \"\\n\")\n    err = ioutil.WriteFile(file, []byte(output), 0644)\n    if err != nil {\n        log.Fatalln(err)\n    }\n}\n</code></pre>\n\n<p>And after running the program our <code>example.json</code> file now looks like this:</p>\n\n<pre><code>{\n    \"paths\": {\n        \"/account\": {\n            \"post\": {\n                \"something\": \"body\",\n                \"api\": {\n\"uri\": \"supreme-uri\"\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p><em>Hope you find this solution useful, Good luck! :]</em></p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1531378833, "post_id": 51294583, "comment_id": 89575126, "body": "The OP might also look at things like &lt;<a href=\"https://github.com/bcicen/jstream\" rel=\"nofollow noreferrer\">github.com/bcicen/jstream</a>&gt;. Another approach is to use the stock <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Token\" rel=\"nofollow noreferrer\">streaming decoder</a> and a simple state machine which remembers the names of the fields whose object values it descends into, and patches up the value of the &quot;uri&quot; field as it goes."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1531345373, "creation_date": 1531345373, "answer_id": 51294583, "question_id": 51293840, "link": "https://stackoverflow.com/questions/51293840/editing-json-in-go-without-unmarshalling-into-structs-first/51294583#51294583", "title": "Editing Json in Go without Unmarshalling into Structs First", "body": "<p>Unmarshal to <code>interface{}</code>.  Walk down nested objects to find the object with the value to set.  Set the value. Marshal back to JSON.</p>\n\n<pre><code>var root interface{}\nif err := json.Unmarshal(d, &amp;root); err != nil {\n    log.Fatal(err)\n}\n\n// Walk down path to target object.\nv := root\nvar path = []string{\"paths\", \"/account\", \"post\", \"api\"}\nfor i, k := range path {\n    m, ok := v.(map[string]interface{})\n    if !ok {\n        log.Fatalf(\"map not found at %s\", strings.Join(path[:i+1], \", \"))\n    }\n    v, ok = m[k]\n    if !ok {\n        log.Fatalf(\"value not found at %s\", strings.Join(path[:i+1], \", \"))\n    }\n}\n\n// Set value in the target object.\nm, ok := v.(map[string]interface{})\nif !ok {\n    log.Fatalf(\"map not found at %s\", strings.Join(path, \", \"))\n}\nm[\"uri\"] = \"the new URI\"\n\n// Marshal back to JSON. Variable d is []byte with the JSON\nd, err := json.Marshal(root)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>Replace calls to log.Fatal with whatever error handling is appropriate for your application.</p>\n\n<p><a href=\"https://play.golang.org/p/OL_UJVrrnTZ\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 77, "user_id": 7538020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82e5009845389e7fe6a62b48c7399cb8?s=128&d=identicon&r=PG&f=1", "display_name": "jmagi98", "link": "https://stackoverflow.com/users/7538020/jmagi98"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 0, "accepted_answer_id": 51294583, "answer_count": 2, "score": 3, "last_activity_date": 1531345373, "creation_date": 1531341504, "last_edit_date": 1531342668, "question_id": 51293840, "link": "https://stackoverflow.com/questions/51293840/editing-json-in-go-without-unmarshalling-into-structs-first", "title": "Editing Json in Go without Unmarshalling into Structs First", "body": "<p>I am having a bit of an issue. So I am writing a tool in go that works with some json files. \nThe way the tool works is the devops member who is using it is supposed to upload their json file into the specified folder within the project and then that json file is used from there to deploy an api in api-gateway (the json is actually a swagger with extensions but that isn't particularly important to my question)</p>\n\n<p>The issue I am having is I need to update ONE line in the json. Each file passed in will be different, but it is guaranteed to have a url in the same spot every time, just due to the nature of the project. I need to update this url in an automated fashion.</p>\n\n<p>Due to the fact the json files are different, setting up hard coded structs and unmarshalling in order to edit is out of the question. The objective is for the devops members to not even have to go into the code, but rather just to deploy their files, which is the reason I was hoping for this to be automated.</p>\n\n<p>So far my research has yielded nothing. It appears that Go only supports editing json if it is first unmarshaled into structs (see <a href=\"https://stackoverflow.com/questions/43713952/modifying-json-file-using-golang\">Modifying JSON file using Golang</a>). Is there a way to edit without the structs if i know for a fact what I am looking for will always be available within the json, despite each file being different?</p>\n\n<p>This is only my first month using go, so there may be a simple solution. I have seen some mention of scanners from the megajson library, but I cannot seem to get that to work either</p>\n\n<pre><code>{\n\"paths\": {\n    \"/account\": {\n        \"post\": {\n            \"something\": \"body\",\n            \"api\": {\n                \"uri\": \"http://thisiswhereineedtoedit.com\"\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["go", "struct", "interface"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 8, "creation_date": 1531337787, "post_id": 51292991, "comment_id": 89563631, "body": "The usual solution here is to rename your struct fields so they are unexported."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1531339907, "post_id": 51292991, "comment_id": 89564559, "body": "You can&#39;t have a field and a method with the same name. What you want to name your fields and methods, so long as they are syntactically valid, is entirely up to you."}, {"owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "edited": false, "score": 0, "creation_date": 1597315227, "post_id": 51292991, "comment_id": 112095398, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/38842457/interface-naming-convention-golang\">Interface naming convention Golang</a>"}], "answers": [{"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1531421702, "post_id": 51300796, "comment_id": 89602036, "body": "the former method (<code>foo.ip</code> unexported, using <code>foo.IP()</code> for data access) is what I ended up using. My brain doesn&#39;t twist that way naturally, as I more readily consider <code>func (f *foo) IP() string</code> to be a method on the interface, not a method on the struct -- which is nonsense of course."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 2, "last_activity_date": 1531384277, "creation_date": 1531384277, "answer_id": 51300796, "question_id": 51292991, "link": "https://stackoverflow.com/questions/51292991/synonymous-struct-field-and-method-name-for-interface/51300796#51300796", "title": "Synonymous struct field and method name for interface", "body": "<p>The general rule of thumb is that interfaces define behaviours and fields define data.</p>\n\n<p>The problem here is that you are using an interface to access data in fields. On it's own that's not necessarily a bad thing. But you might want to reconsider how to structure your code so that you don't get this collision.</p>\n\n<p><strong>The first question I would as is:</strong></p>\n\n<p>\"Why do you need to export the field <code>IP</code> if the <code>struct</code> defines an <code>IP()</code> method that has access to it?\"</p>\n\n<p>You could make the struct field unexported i.e. <code>ip</code> not <code>IP</code>, and then in the place you are using <code>struct.IP</code>, use <code>struct.IP()</code> instead.</p>\n\n<p><strong>The second question is:</strong></p>\n\n<p>\"If you have structs such as <code>foo</code>, <code>bar</code>, <code>spam</code> and they all share common fields, why not use composition to deduplicate the definition of those shared fields.\"</p>\n\n<p><em>This would probably only work if you are really only after the data that's inside the struct, I would generally advocate for using interfaces in all cases.</em></p>\n\n<p>If you have the following structs:</p>\n\n<pre><code>type Foo struct {\n    IP string\n    A string \n    B string\n}\n\ntype Bar struct {\n    IP string\n    A string \n    B string\n}\n\ntype Spam struct {\n    IP string\n    A string \n    B string\n}\n</code></pre>\n\n<p>You could use a new struct to represent the fields they have in common, and anonymously compose that inside:</p>\n\n<pre><code>type Inner struct {\n    IP string\n    A string \n    B string\n}\n\ntype Foo struct {\n    Inner\n}\n\ntype Bar struct {\n    Inner\n}\n\ntype Spam struct {\n    Inner\n}\n</code></pre>\n\n<p>In the function call where you were using <code>struct.IP()</code>, accept an <code>Inner</code> and call it with <code>struct.Inner</code>. You will still have access to <code>struct.IP</code> even though <code>IP</code> is defined inside <code>Inner</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 3, "creation_date": 1531414293, "post_id": 51302717, "comment_id": 89598390, "body": "In general in go you would not create <code>GetFoo()</code> methods, instead opting for the simpler form of just <code>Foo()</code>.  <a href=\"https://golang.org/doc/effective_go.html#Getters\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#Getters</a>"}, {"owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1531419153, "post_id": 51302717, "comment_id": 89600788, "body": "@Zak Updated my answer. Thank you!"}], "tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": false, "score": 0, "last_activity_date": 1531419117, "last_edit_date": 1531419117, "creation_date": 1531389788, "answer_id": 51302717, "question_id": 51292991, "link": "https://stackoverflow.com/questions/51292991/synonymous-struct-field-and-method-name-for-interface/51302717#51302717", "title": "Synonymous struct field and method name for interface", "body": "<p>You also may consider option to have <code>ip</code> field and <code>GetIP</code> &amp; <code>SetIP</code> methods (or <code>IP</code> &amp; <code>SetIP</code> accordingly to this <a href=\"https://golang.org/doc/effective_go.html#Getters\" rel=\"nofollow noreferrer\">doc</a>) - it's clear, concise and simple.</p>\n"}], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 868, "favorite_count": 1, "accepted_answer_id": 51300796, "answer_count": 2, "score": 1, "last_activity_date": 1597315219, "creation_date": 1531337509, "last_edit_date": 1597315219, "question_id": 51292991, "link": "https://stackoverflow.com/questions/51292991/synonymous-struct-field-and-method-name-for-interface", "title": "Synonymous struct field and method name for interface", "body": "<p>I'm building a type structure that represents some devices on my network. There are lots of types of these devices, such as:</p>\n\n<pre><code>type Foo struct  { ... }\ntype Bar struct  { ... }\ntype Spam struct { ... }\n</code></pre>\n\n<p>but they all share a few common fields, one of which is <code>IP</code>. I'd like to define <code>Device</code> as an interface so I can group these together logically</p>\n\n<pre><code>type Device interface {\n    IP() string\n    ...\n}\n\ntype LogicalGrouping struct {\n    Devices []Device\n    ...\n}\n</code></pre>\n\n<p>but I'm running into an error with overlapping names.</p>\n\n<pre><code>func (f *Foo) IP() string { return f.IP }  // same method name as field name\n</code></pre>\n\n<p>I can rename either the field or the method or both, but surely this must be a common use case -- grouping structs by the fields they have in common? Is there an idiomatic solution here?</p>\n"}, {"tags": ["http", "go", "memory"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531327719, "post_id": 51290415, "comment_id": 89558963, "body": "It seems to me that you can read it multiple times, each time read a piece into a buffer and then find the match in the buffer. Is it viable?"}, {"owner": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531328247, "post_id": 51290415, "comment_id": 89559190, "body": "If I wrap the body in a <code>bufio.Scanner</code> then absolutely I could read line-by-line. My difficulty now is leaving the body untouched for when I proxy it.  Most examples of &#39;resetting&#39; a body in this way use something like this:      body, _ := ioutil.ReadAll(req.Body)     req.Body = ioutil.NopCloser(bytes.NewBuffer(body))  which still allocates a bunch of the memory at once."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1531328355, "post_id": 51290415, "comment_id": 89559249, "body": "@JackBritton:  If you&#39;re low on memory, a temporary file will work as well."}, {"owner": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "edited": false, "score": 0, "creation_date": 1531328506, "post_id": 51290415, "comment_id": 89559318, "body": "That&#39;s an idea I hadn&#39;t considered. The idea would be to read the body, writing it out to a temporary file, and then copy the file contents back into the request so I can proxy it? I&#39;ll give that a go."}, {"owner": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "edited": false, "score": 0, "creation_date": 1531328603, "post_id": 51290415, "comment_id": 89559364, "body": "This will absolutely be a performance hit though, correct? Especially in the middle of a request..."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1531329060, "post_id": 51290415, "comment_id": 89559610, "body": "@JackBritton: Benchmark it and find out.  It should be noted that Go already uses temporary files for incoming HTTP requests when the request body is above a certain threshold."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1531329215, "post_id": 51290415, "comment_id": 89559687, "body": "@JackBritton Can&#39;t you obtain a copy of body with request.GetBody() and then wrap this copy in bufio.Scanner?"}, {"owner": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1531334365, "post_id": 51290415, "comment_id": 89562062, "body": "@Uvelichitel request.GetBody() returns nil in this context because I&#39;m receiving a client request.  @Tim Cooper The fact about temporary files being used internally is very interesting. I will take a look at this in a moment.  I&#39;m going to try using <code>io.Pipe</code> first to parse the body while streaming it to the next step in the code, I will post my findings after I explore that."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "edited": false, "score": 0, "creation_date": 1531403654, "post_id": 51292534, "comment_id": 89591643, "body": "Pretty good but the byte arrays passed to Finder.Write could only include part of the string we&#39;re looking for. I&#39;m posting my solution using pipes and scanners now."}, {"owner": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "edited": false, "score": 0, "creation_date": 1531404372, "post_id": 51292534, "comment_id": 89592165, "body": "To clarify, the reason I don&#39;t think this sould work is that Finder.Write can be called with byte slices of arbitrary length. For example: &quot;apsdiofadsf Titl&quot;, followed by &quot;e: (Jack Britton&#39;s 7 Pillars of Success) pasdfpajisdf&quot;."}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "reply_to_user": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "edited": false, "score": 0, "creation_date": 1531407806, "post_id": 51292534, "comment_id": 89594492, "body": "Guys, read my answer carefully. I pointed the author of the question to the right direction as he/she was asking. I also wrote that there are edge cases. And these are edge cases you&#39;re talking about."}, {"owner": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "edited": false, "score": 0, "creation_date": 1531409565, "post_id": 51292534, "comment_id": 89595610, "body": "How would you avoid this particular edge case, with the code you&#39;ve given here? Is there a way to force Finder.Write to be written to line-by-line, or in such a way that we don&#39;t split the string I&#39;m interested in down the middle?"}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "reply_to_user": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "edited": false, "score": 0, "creation_date": 1531418486, "post_id": 51292534, "comment_id": 89600463, "body": "In case there&#39;s no match you can keep last 7 bytes in the finder state (length of the &quot;Title: &quot;) and look for the match within last 7 bytes + next p. Similarly in case when you found a substring you can check if it is not a suffix of &quot;p&quot; if so you can keep the substring in the temp buffer inside the finder. This will be an easier solution without involving scanner, pipes and goroutines."}, {"owner": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "edited": false, "score": 0, "creation_date": 1531422307, "post_id": 51292534, "comment_id": 89602347, "body": "Buffering old input so that you can contextualize incoming data == building your own scanner. In general imo using a scanner is also more extensible.. you can scan by words, lines, or a custom split function, and you won&#39;t have to worry about maintaining a temporary buffer."}, {"owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "reply_to_user": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "edited": false, "score": 0, "creation_date": 1531426495, "post_id": 51292534, "comment_id": 89604162, "body": "I don&#39;t say that your solution won&#39;t work I just say that for your question my solution would be simpler/enough/faster"}, {"owner": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "edited": false, "score": 0, "creation_date": 1531493710, "post_id": 51292534, "comment_id": 89631070, "body": "We&#39;d have to run a benchmark, I&#39;m not sure which is faster. Either way thank you for the solution! Defining a custom writer isn&#39;t something I&#39;d considered, and I might use it in the future."}], "tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": false, "score": 1, "last_activity_date": 1531336064, "last_edit_date": 1531336064, "creation_date": 1531335716, "answer_id": 51292534, "question_id": 51290415, "link": "https://stackoverflow.com/questions/51290415/finding-a-string-in-an-io-readcloser-without-making-large-allocations/51292534#51292534", "title": "Finding a string in an io.ReadCloser without making large allocations", "body": "<p>I would use io.TeeReader for that and pass special writer to the TeeReader constructor. Consider following as a pseudocode because there are some edge cases that we don't handle here:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"regexp\"\n)\n\ntype Finder struct {\n    Regexp *regexp.Regexp\n    match  string\n}\n\n//Write implements io.Writer interface\nfunc (f *Finder) Write(p []byte) (int, error) {\n    if f.match == \"\" {\n        f.match = string(f.Regexp.Find(p))\n    }\n\n    return len(p), nil\n}\n\nfunc Handler(w http.ResponseWriter, r *http.Request) {\n    f := &amp;Finder{\n        Regexp: regexp.MustCompile(\"Title: ([a-zA-Z0-9]+)\"),\n    }\n\n    r.Body = ioutil.NopCloser(io.TeeReader(r.Body, f))\n\n    //pass request to another server\n\n    fmt.Println(f.match)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "is_accepted": true, "score": 0, "last_activity_date": 1531415486, "last_edit_date": 1531415486, "creation_date": 1531404212, "answer_id": 51307702, "question_id": 51290415, "link": "https://stackoverflow.com/questions/51290415/finding-a-string-in-an-io-readcloser-without-making-large-allocations/51307702#51307702", "title": "Finding a string in an io.ReadCloser without making large allocations", "body": "<p>Here's my solution. I placed a pipe between the response body and its reader, and wrapped the reader with an <code>io.TeeReader</code> so it would write to the pipe as I read from it. I wrapped that in a <code>bufio.Scanner</code> and scanned lines. After I was done scanning lines, I was sure to consume the remainder of the body (with <code>io.Copy(ioutil.Discard, body)</code>) so that the rest of the body would be written to the pipe.</p>\n\n<pre><code>if request.Body == nil {\n    proxy(request)\n    return\n}\n\n// The body is *not* nil,\n// so we're going to process it line-by-line.\n\nbodySrc := request.Body             // Original io source of the request body.\npr, pw := io.Pipe()                 // Pipe between bodySrc and request.Body.\nbody := io.TeeReader(bodySrc, pw)   // When you read from body, it will read from bodySrc and writes to the pipe.\nrequest.Body = ioutil.NopCloser(pr) // The other end of the pipe is request.Body. That's what proxy() will read.\n\ngo func() {\n\n    scanner = bufio.NewScanner(body)\n    for scanner.Scan() {\n        x := scanner.Bytes()\n        if processLine(x) {\n            break\n        }\n    }\n\n    // We're done with the body,\n    // so consume the rest of it and close the source and the pipe.\n    io.Copy(ioutil.Discard, body)\n    bodySrc.Close()\n    pw.Close()\n\n}()\n\n// As proxy reads request.Body, it's actually keeping up\n// with the scanning done in the above goroutine.\nproxy(request)\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 7089702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645e57d7bd3c31485c6a2d320728ae69?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Britton", "link": "https://stackoverflow.com/users/7089702/jack-britton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 823, "favorite_count": 0, "accepted_answer_id": 51307702, "answer_count": 2, "score": 1, "last_activity_date": 1531415486, "creation_date": 1531326853, "question_id": 51290415, "link": "https://stackoverflow.com/questions/51290415/finding-a-string-in-an-io-readcloser-without-making-large-allocations", "title": "Finding a string in an io.ReadCloser without making large allocations", "body": "<p>I have a large <code>io.ReadCloser</code> that I got from an <code>http.Request</code> in my HTTP handler func. I need to proxy the request to another server, but first I want to find a string in the body matching a regex like <code>Title: (\\w+)</code>. This is hard -- copying the whole body into a new buffer to operate on takes up way too much memory, and I've tried using <a href=\"https://golang.org/pkg/regexp/#Regexp.FindReaderSubmatchIndex\" rel=\"nofollow noreferrer\">regexp.FindReaderSubmatchIndex</a> but it only gives me the index of the result, not the actual string.</p>\n\n<p>What's the best way to do this? Tokenizers and JSON decoders and such seem to work on io streams, and this is a really simple use case for that. Can someone please point me in the right direction?</p>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 896, "user_id": 9996322, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-CKb7ymEsXic/AAAAAAAAAAI/AAAAAAAAAUE/PhlIctjmhPI/photo.jpg?sz=128", "display_name": "Jacob Boertjes", "link": "https://stackoverflow.com/users/9996322/jacob-boertjes"}, "edited": false, "score": 3, "creation_date": 1531340922, "post_id": 51290273, "comment_id": 89564954, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/6996704/how-to-check-variable-type-at-runtime-in-go-language\">How to check variable type at runtime in Go language</a>"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1531339942, "last_edit_date": 1531339942, "creation_date": 1531326603, "answer_id": 51290341, "question_id": 51290273, "link": "https://stackoverflow.com/questions/51290273/how-to-check-if-value-is-a-float/51290341#51290341", "title": "How to check if value is a float", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/strconv/\" rel=\"nofollow noreferrer\">Package strconv</a></p>\n\n<pre><code>import \"strconv\" \n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/strconv/#ParseFloat\" rel=\"nofollow noreferrer\">func ParseFloat</a></p>\n\n<pre><code>func ParseFloat(s string, bitSize int) (float64, error)\n</code></pre>\n  \n  <p>ParseFloat converts the string s to a floating-point number with the\n  precision specified by bitSize: 32 for float32, or 64 for float64.\n  When bitSize=32, the result still has type float64, but it will be\n  convertible to float32 without changing its value.</p>\n  \n  <p>If s is well-formed and near a valid floating point number, ParseFloat\n  returns the nearest floating point number rounded using IEEE754\n  unbiased rounding.</p>\n  \n  <p>The errors that ParseFloat returns have concrete type *NumError and\n  include err.Num = s.</p>\n  \n  <p>If s is not syntactically well-formed, ParseFloat returns err.Err =\n  ErrSyntax.</p>\n  \n  <p>If s is syntactically well-formed but is more than 1/2 ULP away from\n  the largest floating point number of the given size, ParseFloat\n  returns f = \u00b1Inf, err.Err = ErrRange.</p>\n</blockquote>\n\n<hr>\n\n<p>Check the error from <a href=\"https://golang.org/pkg/strconv/#ParseFloat\" rel=\"nofollow noreferrer\">strconv.ParseFloat</a> and check for an empty <code>string</code>. </p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    for _, latitude := range []string{\"40.7128\", \"gps\", \"neither\", \"\"} {\n        fmt.Printf(\"Latitude: %q\\n\", latitude)\n        if latitude != \"gps\" {\n            if _, err := strconv.ParseFloat(latitude, 10); err != nil || latitude == \"\" {\n                fmt.Printf(\"Incorrect option: %q\\n\", latitude)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/4dNsMgRunFp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4dNsMgRunFp</a></p>\n\n<p>Output:</p>\n\n<pre><code>Latitude: \"40.7128\"\nLatitude: \"gps\"\nLatitude: \"neither\"\nIncorrect option: \"neither\"\nLatitude: \"\"\nIncorrect option: \"\"\n</code></pre>\n"}], "owner": {"reputation": 347, "user_id": 4206183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/896dd7976b1309d64c083c238d8fb710?s=128&d=identicon&r=PG&f=1", "display_name": "Melissa", "link": "https://stackoverflow.com/users/4206183/melissa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2625, "favorite_count": 1, "closed_date": 1531382326, "accepted_answer_id": 51290341, "answer_count": 1, "score": -4, "last_activity_date": 1531339942, "creation_date": 1531326387, "last_edit_date": 1531329755, "question_id": 51290273, "link": "https://stackoverflow.com/questions/51290273/how-to-check-if-value-is-a-float", "closed_reason": "Not suitable for this site", "title": "How to check if value is a float", "body": "<p>I want to check whether a value that I get passed is a float number. I have a piece of code that checks whether it is a certain string, or a float number. If neither, then give an error. Here is the code: </p>\n\n<pre><code>if sensorData.Passport.Geolocation.Latitude != \"gps\" &amp;&amp; sensorData.Passport.Geolocation.Latitude != \"internet\" &amp;&amp; sensorData.Passport.Geolocation.Latitude != \"unknown\" &amp;&amp; sensorData.Passport.Geolocation.Latitude != //a float nmber{\n            fmt.Println(\"Incorrect option\")\n        }\n</code></pre>\n\n<p>How do I check whether the data is a float number? </p>\n"}, {"tags": ["go", "serialization", "marshalling", "unmarshalling", "gob"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1531325905, "post_id": 51290056, "comment_id": 89558010, "body": "Possible duplicate: <a href=\"https://stackoverflow.com/questions/47071276/decode-gob-output-without-knowing-concrete-types/47071891#47071891\">Decode gob output without knowing concrete types</a>. Because decoding may happen in a different running app (on a different computer), and to automate all this would require to transmit the whole type definition which is far from optimal and is prone to type identity errors."}], "owner": {"reputation": 288, "user_id": 345597, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/69eae97399d65a1e9882a80168152be9?s=128&d=identicon&r=PG", "display_name": "Robert Jakubowicz", "link": "https://stackoverflow.com/users/345597/robert-jakubowicz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1531325610, "creation_date": 1531325610, "question_id": 51290056, "link": "https://stackoverflow.com/questions/51290056/when-using-gob-to-serialiaze-structs-over-the-wire-why-do-we-need-to-register", "title": "When using gob to serialiaze structs over the wire, why do we need to Register() any fields that are interfaces inside the transmitted struct?", "body": "<p>If we were to send </p>\n\n<pre><code>type ABC struct{\n      i interface{}\n\n   }\n</code></pre>\n\n<p>gob requires us to register the concrete type hidden behind our interface{}.\nWhy can't gob use reflection to identify the underlying concrete class in the field by itself. </p>\n\n<p>That is, we need to use the Register method to tell gob what the concrete type is.</p>\n\n<p>Given the method signature looks like this <code>Register(value interface{})</code>, gob already uses reflection to fully identify the type passed to the method.</p>\n\n<p>Why doesn't gob iterate through the instantiated ABC struct at runtime and perform Register automatically?</p>\n"}, {"tags": ["user-interface", "go"], "comments": [{"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1531387050, "post_id": 51289739, "comment_id": 89580251, "body": "If you&#39;re looking for simple/short code then a toolkit like nuklear may not be your best choice - are you able to pick a different API for simple UI elements, or has someone chosen for you?"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1531387187, "post_id": 51289739, "comment_id": 89580342, "body": "Which package do you recommend for simple GUI creation in golang?"}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1531388630, "post_id": 51289739, "comment_id": 89581350, "body": "Well, I am not completely unbiased as I&#39;m building Fyne - <a href=\"https://github.com/fyne-io/fyne\" rel=\"nofollow noreferrer\">github.com/fyne-io/fyne</a>  The window with a button can be done in 13 lines total (see the README)"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1531389589, "post_id": 51289739, "comment_id": 89581976, "body": "Looks really fine! Congratulations on creating it. The syntax looks really simple. I will certainly try it."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1566717307, "post_id": 51289739, "comment_id": 101739078, "body": "@ajwillia.ms : Pl see my new question on Fyne: <a href=\"https://stackoverflow.com/questions/57643992/how-to-install-opengl-for-this-to-run\" title=\"how to install opengl for this to run\">stackoverflow.com/questions/57643992/&hellip;</a>"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1121, "favorite_count": 2, "answer_count": 0, "score": 4, "last_activity_date": 1531384206, "creation_date": 1531324453, "last_edit_date": 1531384206, "question_id": 51289739, "link": "https://stackoverflow.com/questions/51289739/minimum-code-to-create-a-gui-with-button-using-nuklear-package", "title": "Minimum code to create a GUI with button using nuklear package", "body": "<p>I am trying to trim demo file from <a href=\"https://github.com/golang-ui/nuklear/blob/master/cmd/nk-example/main.go\" rel=\"nofollow noreferrer\">nuklear package</a> to get minimum code for just creating a GUI window with one button. Following is my attempt:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"runtime\"\n    \"time\"\n\n    \"github.com/go-gl/gl/v3.2-core/gl\"\n    \"github.com/go-gl/glfw/v3.2/glfw\"\n    \"github.com/golang-ui/nuklear/nk\"\n    \"github.com/xlab/closer\"\n)\n\nconst (\n    winWidth         = 400\n    winHeight        = 500\n    maxVertexBuffer  = 512 * 1024\n    maxElementBuffer = 128 * 1024\n)\n\nfunc init() {\n    runtime.LockOSThread()\n}\nfunc main() {\n    if err := glfw.Init(); err != nil {\n        closer.Fatalln(err)\n    }\n    glfw.WindowHint(glfw.ContextVersionMajor, 3)\n    glfw.WindowHint(glfw.ContextVersionMinor, 2)\n    glfw.WindowHint(glfw.OpenGLProfile, glfw.OpenGLCoreProfile)\n    glfw.WindowHint(glfw.OpenGLForwardCompatible, glfw.True)\n    win, err := glfw.CreateWindow(winWidth, winHeight, \"Nuklear Demo\", nil, nil)\n    if err != nil {\n        closer.Fatalln(err)\n    }\n    win.MakeContextCurrent()\n\n    width, height := win.GetSize()\n    log.Printf(\"glfw: created window %dx%d\", width, height)\n\n    if err := gl.Init(); err != nil {\n        closer.Fatalln(\"opengl: init failed:\", err)\n    }\n    gl.Viewport(0, 0, int32(width), int32(height))\n\n    ctx := nk.NkPlatformInit(win, nk.PlatformInstallCallbacks)\n\n    atlas := nk.NewFontAtlas()\n    nk.NkFontStashBegin(&amp;atlas)\n    //sansFont := nk.NkFontAtlasAddFromBytes(atlas, MustAsset(\"assets/FreeSans.ttf\"), 16, nil)\n    sansFont := nk.NkFontAtlasAddDefault(atlas, 16, nil)\n    nk.NkFontStashEnd()\n    if sansFont != nil {\n        nk.NkStyleSetFont(ctx, sansFont.Handle())\n    }\n\n    exitC := make(chan struct{}, 1)\n    doneC := make(chan struct{}, 1)\n    closer.Bind(func() {\n        close(exitC)\n        &lt;-doneC\n    })\n\n    state := &amp;State{\n        bgColor: nk.NkRgba(28, 48, 62, 255),\n    }\n    fpsTicker := time.NewTicker(time.Second / 30)\n    for {\n        select {\n        case &lt;-exitC:\n            nk.NkPlatformShutdown()\n            glfw.Terminate()\n            fpsTicker.Stop()\n            close(doneC)\n            return\n        case &lt;-fpsTicker.C:\n            if win.ShouldClose() {\n                close(exitC)\n                continue\n            }\n            glfw.PollEvents()\n            gfxMain(win, ctx, state)\n        }\n    }\n}\n\nfunc gfxMain(win *glfw.Window, ctx *nk.Context, state *State) {\n    nk.NkPlatformNewFrame()\n    // Layout\n    bounds := nk.NkRect(50, 50, 230, 250)\n    update := nk.NkBegin(ctx, \"Demo\", bounds,\n        nk.WindowBorder|nk.WindowMovable|nk.WindowScalable|nk.WindowMinimizable|nk.WindowTitle)\n    if update &gt; 0 {\n        nk.NkLayoutRowStatic(ctx, 30, 80, 1)\n        {\n            if nk.NkButtonLabel(ctx, \"A_Button\") &gt; 0 {\n                log.Println(\"[INFO] button pressed!\")\n            }\n        }\n    }\n    nk.NkEnd(ctx)\n    // Render\n    bg := make([]float32, 4)\n    nk.NkColorFv(bg, state.bgColor)\n    width, height := win.GetSize()\n    gl.Viewport(0, 0, int32(width), int32(height))\n    gl.Clear(gl.COLOR_BUFFER_BIT)\n    gl.ClearColor(bg[0], bg[1], bg[2], bg[3])\n    nk.NkPlatformRender(nk.AntiAliasingOn, maxVertexBuffer, maxElementBuffer)\n    win.SwapBuffers()\n}\n\ntype Option uint8\ntype State struct {\n    bgColor nk.Color\n    prop    int32\n    opt     Option\n}\n</code></pre>\n\n<p>It seems a lot of code to just create a window with a button. I am sure more code can be removed but I can't seem to find it. What further unneeded code can I remove from above to trim it further?</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 834856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f99c509a50c1e1f9a2ff7ff1d61f214?s=128&d=identicon&r=PG", "display_name": "baltazar", "link": "https://stackoverflow.com/users/834856/baltazar"}, "edited": false, "score": 0, "creation_date": 1531334848, "post_id": 51291465, "comment_id": 89562296, "body": "Thanks fo the answer, what about &quot;api server&quot;? What is that? It&#39;s not configured anywhere it&#39;s like it&#39;s there by default too"}, {"owner": {"reputation": 877, "user_id": 2049273, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/794735d9719e9edace9699928c9a45a0?s=128&d=identicon&r=PG", "display_name": "swigganicks", "link": "https://stackoverflow.com/users/2049273/swigganicks"}, "reply_to_user": {"reputation": 47, "user_id": 834856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f99c509a50c1e1f9a2ff7ff1d61f214?s=128&d=identicon&r=PG", "display_name": "baltazar", "link": "https://stackoverflow.com/users/834856/baltazar"}, "edited": false, "score": 0, "creation_date": 1531335696, "post_id": 51291465, "comment_id": 89562702, "body": "That&#39;s the App Engine server, you don&#39;t need to configure it. It&#39;s just there when you deploy locally to emulate the environment. When you deploy to GCP, it&#39;s already there by default."}], "tags": [], "owner": {"reputation": 877, "user_id": 2049273, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/794735d9719e9edace9699928c9a45a0?s=128&d=identicon&r=PG", "display_name": "swigganicks", "link": "https://stackoverflow.com/users/2049273/swigganicks"}, "is_accepted": false, "score": 1, "last_activity_date": 1531331018, "creation_date": 1531331018, "answer_id": 51291465, "question_id": 51289398, "link": "https://stackoverflow.com/questions/51289398/google-app-engine-api-server-vs-module/51291465#51291465", "title": "google app engine api_server vs module", "body": "<p>The default module is the default route into your application. You can check the behavior of your routes in your <code>app.yaml</code> file to see/alter how requests get routed as well in the \"handlers\" section.</p>\n\n<p>Check out the documentation on <a href=\"https://cloud.google.com/appengine/docs/standard/go/how-requests-are-routed\" rel=\"nofollow noreferrer\">how requests are routed</a> for more detailed information. </p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1531380027, "last_edit_date": 1531380027, "creation_date": 1531334880, "answer_id": 51292343, "question_id": 51289398, "link": "https://stackoverflow.com/questions/51289398/google-app-engine-api-server-vs-module/51292343#51292343", "title": "google app engine api_server vs module", "body": "<p>Those 2 \"endpoints\"\u2013or rather servers\u2013serve different purposes.</p>\n\n<p>First some background:</p>\n\n<p><em>\"An App Engine app is made up of a single application resource that consists of one or more services.\"</em> (<a href=\"https://cloud.google.com/appengine/docs/standard/go/an-overview-of-app-engine\" rel=\"nofollow noreferrer\">source</a>) Note: Services were previously called \"modules\".</p>\n\n<p>So an app consists of one or multiple services (or modules). If you don't specify services in your app configuration, there is a default service.</p>\n\n<p>This line:</p>\n\n<pre><code>Starting module \"default\" running at: http://localhost:38629\n</code></pre>\n\n<p>tells a web server has been started that will serve the default service (or module), which is the web server you register your handlers to (<code>\"/signup\"</code>, <code>\"/whitelist\"</code>, etc.).</p>\n\n<p>The other server:</p>\n\n<pre><code>Starting API server at: http://localhost:38628\n</code></pre>\n\n<p>Starts an API server which is not directly used by you. It is an App Engine specific server that acts as a proxy so the local app engine environment can access remote App Engine services (such as Memcache, Datastore) over HTTP. This API server uses the Remote API protocol for communication, and the local dev environment connects to it using HTTP.</p>\n\n<p>You do not need to worry about this API server, and you do not need to configure it or interact with it. It is part of the App Engine local dev environment which aids to access your remote services, those used by your production environment (should you need it).</p>\n"}], "owner": {"reputation": 47, "user_id": 834856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f99c509a50c1e1f9a2ff7ff1d61f214?s=128&d=identicon&r=PG", "display_name": "baltazar", "link": "https://stackoverflow.com/users/834856/baltazar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 51292343, "answer_count": 2, "score": 3, "last_activity_date": 1531380027, "creation_date": 1531323356, "question_id": 51289398, "link": "https://stackoverflow.com/questions/51289398/google-app-engine-api-server-vs-module", "title": "google app engine api_server vs module", "body": "<p>I am developing go api backend using google appengine. When i run the project locally the output says:</p>\n\n<p><em>INFO     2018-07-11 12:31:17,502 devappserver2.py:120] Skipping SDK update check.<br>\nINFO     2018-07-11 12:31:17,576 api_server.py:274] Starting API server at: <a href=\"http://localhost:38628\" rel=\"nofollow noreferrer\">http://localhost:38628</a><br>\nINFO     2018-07-11 12:31:17,588 dispatcher.py:270] Starting module \"default\" running at: <a href=\"http://localhost:38629\" rel=\"nofollow noreferrer\">http://localhost:38629</a></em>  </p>\n\n<p>What is the purpose of two endpoints \"API Server\" and \"module default\"?\nMy init is just like this:</p>\n\n<pre><code>http.HandleFunc(\"/signup\", signUp)\nhttp.HandleFunc(\"/whitelist\", whitelist)\nhttp.HandleFunc(\"/signin\", signIn)\nhttp.HandleFunc(\"/signout\", signOut)\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1531318804, "post_id": 51287810, "comment_id": 89553401, "body": "Unsynchronized access to a variable from multiple goroutines where at least one of them is a write is undefined behavior. Do not try to find logic in how this code works, instead use proper synchronization."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1531318805, "post_id": 51287810, "comment_id": 89553404, "body": "You have data races, so the behavior is not defined. The busy loop with no function calls in the second goroutine is also going to cause problems."}, {"owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "edited": false, "score": 0, "creation_date": 1531318958, "post_id": 51287810, "comment_id": 89553527, "body": "I wrote this program to illustrate data race, but faced with problem of always zero variable."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1531319205, "post_id": 51287810, "comment_id": 89553704, "body": "So it\u2019s sounds like it nicely illustrates why you need synchronization."}], "answers": [{"comments": [{"owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "edited": false, "score": 0, "creation_date": 1531400820, "post_id": 51289371, "comment_id": 89589574, "body": "I know that there is data race. The only purpose of this example was to somehow illustrate data race, but point was incremental routine should increment somehow, but in this example does nothing."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "edited": false, "score": 0, "creation_date": 1531407821, "post_id": 51289371, "comment_id": 89594498, "body": "@abonec: When you have a data race the results are undefined. Therefore, your example is not going to illustrate anything. There is no &quot;should&quot; with undefined results."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1531323729, "last_edit_date": 1531323729, "creation_date": 1531323286, "answer_id": 51289371, "question_id": 51287810, "link": "https://stackoverflow.com/questions/51287810/change-variable-from-goroutine/51289371#51289371", "title": "change variable from goroutine", "body": "<p>You have data races: <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">Go Data Race Detector</a>. Therefore, your results are undefined.</p>\n\n<hr>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    x := 0\n\n    go func() {\n        for {\n            if x%2 == 0 {\n                //fmt.Println(x)\n            }\n        }\n    }()\n\n    go func() {\n        for {\n            x = x + 1\n        }\n    }()\n\n    &lt;-time.After(1 * time.Second)\n    fmt.Println(\"final\", x)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run -race racer.go &gt; /dev/null\n==================\nWARNING: DATA RACE\nWrite at 0x00c000088010 by goroutine 7:\n  main.main.func2()\n      /home/peter/gopath/src/racer.go:21 +0x4e\n\nPrevious read at 0x00c000088010 by goroutine 6:\n  main.main.func1()\n      /home/peter/gopath/src/racer.go:13 +0x38\n\nGoroutine 7 (running) created at:\n  main.main()\n      /home/peter/gopath/src/racer.go:19 +0x9c\n\nGoroutine 6 (running) created at:\n  main.main()\n      /home/peter/gopath/src/racer.go:11 +0x7a\n==================\nFound 1 data race(s)\nexit status 66\n$ \n</code></pre>\n\n<hr>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    x := 0\n\n    go func() {\n        for {\n            if x%2 == 0 {\n                fmt.Println(x)\n            }\n        }\n    }()\n\n    go func() {\n        for {\n            x = x + 1\n        }\n    }()\n\n    &lt;-time.After(1 * time.Second)\n    fmt.Println(\"final\", x)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run -race racer.go &gt; /dev/null\n==================\nWARNING: DATA RACE\nRead at 0x00c00008c010 by goroutine 6:\n  main.main.func1()\n      /home/peter/gopath/src/racer.go:13 +0x3c\n\nPrevious write at 0x00c00008c010 by goroutine 7:\n  main.main.func2()\n      /home/peter/gopath/src/racer.go:21 +0x4e\n\nGoroutine 6 (running) created at:\n  main.main()\n      /home/peter/gopath/src/racer.go:11 +0x7a\n\nGoroutine 7 (running) created at:\n  main.main()\n      /home/peter/gopath/src/racer.go:19 +0x9c\n==================\n==================\nWARNING: DATA RACE\nWrite at 0x00c00008c010 by goroutine 7:\n  main.main.func2()\n      /home/peter/gopath/src/racer.go:21 +0x4e\n\nPrevious read at 0x00c00008c010 by goroutine 6:\n  main.main.func1()\n      /home/peter/gopath/src/racer.go:13 +0x3c\n\nGoroutine 7 (running) created at:\n  main.main()\n      /home/peter/gopath/src/racer.go:19 +0x9c\n\nGoroutine 6 (running) created at:\n  main.main()\n      /home/peter/gopath/src/racer.go:11 +0x7a\n==================\n^Csignal: interrupt\n$ \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "edited": false, "score": 0, "creation_date": 1531401016, "post_id": 51291928, "comment_id": 89589706, "body": "Why is it not &quot;truly&quot; read anywhere? It reads in another goroutine and at the bottom. I know, it reads with datarace but anyway."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "edited": false, "score": 0, "creation_date": 1531404717, "post_id": 51291928, "comment_id": 89592386, "body": "@abonec, the other reads are not synchronized. That is undefined behavior and therefor the compiler can do whatever it wants."}, {"owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "edited": false, "score": 0, "creation_date": 1531495684, "post_id": 51291928, "comment_id": 89632295, "body": "It is a strange decision - if you have undefined behavior(unsynchronized access), I add another undefined behavior (cut off part of the program with no explaining)"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 0, "last_activity_date": 1531332944, "creation_date": 1531332944, "answer_id": 51291928, "question_id": 51287810, "link": "https://stackoverflow.com/questions/51287810/change-variable-from-goroutine/51291928#51291928", "title": "change variable from goroutine", "body": "<p>You don't see anything happen because the compiler is smart and optimizes the increment away. Because there is no synchronization, the compiler is effectively presented with this code:</p>\n\n<pre><code>x := 0\nfor { x = x + 1 }\n</code></pre>\n\n<p>Since <code>x</code> is never truly read anywhere (only as part of the increment) the compiler is allowed to coalesce multiple increments into one. For instance:</p>\n\n<pre><code>x := 0\nfor { x += 10 }\n</code></pre>\n\n<p>Or perhaps:</p>\n\n<pre><code>x := 0\nfor { x += 1&lt;&lt;64 }\n</code></pre>\n\n<p>Which is the same as:</p>\n\n<pre><code>x := 0\nfor { x = 0 }\n</code></pre>\n\n<p>This is obviously pointless and so the compiler optimizes the whole loop away.</p>\n"}], "owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 850, "favorite_count": 1, "answer_count": 2, "score": -3, "last_activity_date": 1531495408, "creation_date": 1531318509, "last_edit_date": 1531495408, "question_id": 51287810, "link": "https://stackoverflow.com/questions/51287810/change-variable-from-goroutine", "title": "change variable from goroutine", "body": "<p>I tried to write sample program with 2 goroutines to illustrate race condition. One print <code>x</code>, another increment <code>x</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    x := 0\n\n    go func() {\n        for {\n            if x%2 == 0 {\n                fmt.Println(x)\n            }\n        }\n    }()\n\n    go func() {\n        for {\n            x = x + 1\n        }\n    }()\n\n    &lt;-time.After(1 * time.Second)\n    fmt.Println(\"final\", x)\n}\n</code></pre>\n\n<p>But incremental routine do nothing and finally in <code>x</code> stays zero. But if incremental routine add <code>fmt.Println(x)</code> it starts to increment <code>x</code> and program working as expected.</p>\n\n<p><strong>UPDATE #1:</strong></p>\n\n<p>Purpose of this simple example is only to illustrate data race issue. I know that reading a shared variable between two goroutines without synchronization is a bad idea. Please stop to point me out to that. My question is why incremental goroutine do nothing here? In my picture of the world is should steadily increment, but the issue should appear in the reading goroutine where result may be not determined, because when reading <code>x</code> is one, but when printing <code>x</code> may be other.</p>\n\n<p><strong>UPDATE #2:</strong></p>\n\n<p>I have another example:</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"fmt\"\n)\n\nfunc main() {\n    x := 0\n\n    go func() {\n        last := x\n        for {\n            current := x\n            if last != current {\n                last = current\n                fmt.Println(last)\n            }\n        }\n    }()\n\n    go func() {\n        for {\n            //&lt;-time.After(1 * time.Second) // if uncomment this row program start do \"something\"\n            x = x + 1\n        }\n    }()\n\n    &lt;-time.After(10 * time.Second)\n    fmt.Println(\"final\", x)\n}\n</code></pre>\n\n<p>The example is pretty straightforward. One routine increment counter, other print if changed. This program has undefined behaviour only in the case when writing <code>x = x+1</code> and read <code>current := x</code>  it is not atomic operation and one thread start read the variable in the middle of writing in the other thread and reading operations will read corrupted value.\nBut why in this case when uncomment sleep in incremental routine program starts to do something?</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1531317649, "post_id": 51287335, "comment_id": 89552476, "body": "What is the data returned from database. which you are unmarshalling"}, {"owner": {"reputation": 167, "user_id": 6192650, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/d68aad69c2e02a58ab010098c88009b3?s=128&d=identicon&r=PG&f=1", "display_name": "Udayakumar", "link": "https://stackoverflow.com/users/6192650/udayakumar"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1531317839, "post_id": 51287335, "comment_id": 89552626, "body": "Database return is   {      &quot;ID&quot;:1,     &quot;EmpId&quot;:&quot;001&quot;,     &quot;EmpName&quot;:&quot;samsung&quot;,     &quot;DepartmentID&quot;:0,      &quot;EmployeeContact&quot;:{ //It will be return empty         &quot;ID&quot;:0,         &quot;CreatedAt&quot;:&quot;0001-01-01T00:00:00Z&quot;,         &quot;UpdatedAt&quot;:&quot;0001-01-01T00:00:00Z&quot;,         &quot;DeletedAt&quot;:null,         &quot;ContactType&quot;:&quot;&quot;,         &quot;ContacText&quot;:&quot;&quot;,         &quot;EmployeeID&quot;:0     }  } @Himanshu"}], "answers": [{"tags": [], "owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "is_accepted": true, "score": 1, "last_activity_date": 1531328079, "creation_date": 1531328079, "answer_id": 51290723, "question_id": 51287335, "link": "https://stackoverflow.com/questions/51287335/how-to-get-the-struct-inside-struct-values-in-gorm/51290723#51290723", "title": "How to get the struct (inside struct) values in gorm", "body": "<p>First of all you probably want your employee model to like this</p>\n\n<pre><code>type Employee struct {\n    gorm.Model\n    EmpId           string\n    EmpName         string\n    Department      Department\n    DepartmentID    uint //Department id\n    EmployeeContact []EmployeeContact //Array of Employee contact\n}\n</code></pre>\n\n<p>And then this preload should do the trick</p>\n\n<pre><code>var employee []model.Employee\n\nerr := db.Preload(\"Department\").Preload(\"EmployeeContact\").Find(&amp;employee).Error\n</code></pre>\n\n<p>and them employee parameter should have list of all employees in your system with preloaded relations</p>\n"}], "owner": {"reputation": 167, "user_id": 6192650, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/d68aad69c2e02a58ab010098c88009b3?s=128&d=identicon&r=PG&f=1", "display_name": "Udayakumar", "link": "https://stackoverflow.com/users/6192650/udayakumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2185, "favorite_count": 2, "accepted_answer_id": 51290723, "answer_count": 1, "score": 3, "last_activity_date": 1531389884, "creation_date": 1531317269, "last_edit_date": 1531389884, "question_id": 51287335, "link": "https://stackoverflow.com/questions/51287335/how-to-get-the-struct-inside-struct-values-in-gorm", "title": "How to get the struct (inside struct) values in gorm", "body": "<p>I'm newbie of Golang and GORM. I get some issues on it. How can I get the inside struct value? (Like a nested struct in golang), I tried but, i didn't get actual result.</p>\n\n<p>I have three structs</p>\n\n<p><strong>Department Struct</strong></p>\n\n<pre><code>type Department struct {\n    gorm.Model\n    DepartmentName string\n    DeptCode       string\n    Employee       Employee //Employee struct\n}\n</code></pre>\n\n<p><strong>Employee struct</strong></p>\n\n<pre><code>type Employee struct {\n    gorm.Model\n    EmpId           string\n    EmpName         string\n    DepartmentID    uint //Department id\n    EmployeeContact []EmployeeContact //Array of Employee contact\n}\n</code></pre>\n\n<p><strong>Employee Contact</strong></p>\n\n<pre><code>type EmployeeContact struct {\n    gorm.Model\n    ContactType string\n    ContacText  string\n    EmployeeID  uint //Employee Id\n}\n</code></pre>\n\n<p><strong>Relationship</strong></p>\n\n<p># Department is a Parent of Employee.</p>\n\n<p># Employee is a Parent of Employee contacts.</p>\n\n<p>I used GORM (Joins)</p>\n\n<pre><code>var departmentStruct model.Department\nvar employeeStruct model.Employee\n\n    db.Debug().Model(&amp;departmentStruct).Joins(\"JOIN employees ON employees.department_id = departments.id\").Joins(\"JOIN employee_contacts ON employee_contacts.employee_id = employees.id\").Select(\"employees.id,departments.department_name,departments.dept_code,employees.emp_id,employees.emp_name,employee_contacts.contact_type\").Scan(&amp;employeeStruct)\n    res1B, _ := json.Marshal(employeeStruct)\n    fmt.Fprintln(w, string(res1B))\n</code></pre>\n\n<p>It will be return the <code>output</code> is</p>\n\n<pre><code>{\n\n    \"ID\":1,\n    \"EmpId\":\"001\",\n    \"EmpName\":\"samsung\",\n    \"DepartmentID\":0, \n    \"EmployeeContact\":{ //It will be return empty\n        \"ID\":0,\n        \"CreatedAt\":\"0001-01-01T00:00:00Z\",\n        \"UpdatedAt\":\"0001-01-01T00:00:00Z\",\n        \"DeletedAt\":null,\n        \"ContactType\":\"\",\n        \"ContacText\":\"\",\n        \"EmployeeID\":0\n    }\n\n}\n</code></pre>\n\n<p>I need, When I pass Employee <code>id</code> it will be return like given below format</p>\n\n<pre><code>{\n\n    \"ID\":1,\n    \"EmpId\":\"001\",\n    \"EmpName\":\"samsung\",\n    \"Department\":{\n        \"ID\":1,\n        \"CreatedAt\":\"0001-01-01T00:00:00Z\",\n        \"UpdatedAt\":\"0001-01-01T00:00:00Z\",\n        \"DeletedAt\":null,\n        \"DepartmentName\":\"Software Analyst\",\n        \"deptCode\":\"SA\"\n    },\n    \"EmployeeContact\":[\n        {\n            \"ID\":1,\n            \"CreatedAt\":\"0001-01-01T00:00:00Z\",\n            \"UpdatedAt\":\"0001-01-01T00:00:00Z\",\n            \"DeletedAt\":null,\n            \"ContactType\":\"Home\",\n            \"ContacText\":\"1234567890\",\n            \"EmployeeID\":1\n        },\n        {\n            \"ID\":2,\n            \"CreatedAt\":\"0001-01-01T00:00:00Z\",\n            \"UpdatedAt\":\"0001-01-01T00:00:00Z\",\n            \"DeletedAt\":null,\n            \"ContactType\":\"Office\",\n            \"ContacText\":\"0123456789\",\n            \"EmployeeID\":1\n        }\n    ]\n}\n</code></pre>\n\n<p>Any one can teach me?. How can I achieve it.\nThanks. </p>\n"}, {"tags": ["go", "protocol-buffers"], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 9943872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b42924ac55175f5c7943a23259c0f19?s=128&d=identicon&r=PG&f=1", "display_name": "Hank Moody", "link": "https://stackoverflow.com/users/9943872/hank-moody"}, "edited": false, "score": 1, "creation_date": 1555833877, "post_id": 51289434, "comment_id": 98233034, "body": "&quot;it&#39;s harder than you think&quot; ---- Of course they are funny! I burst into laughter when I read it the first time myself."}, {"owner": {"reputation": 51, "user_id": 9943872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b42924ac55175f5c7943a23259c0f19?s=128&d=identicon&r=PG&f=1", "display_name": "Hank Moody", "link": "https://stackoverflow.com/users/9943872/hank-moody"}, "edited": false, "score": 0, "creation_date": 1555833994, "post_id": 51289434, "comment_id": 98233054, "body": "@Popmedic BTW thanks for the answer which helped me today greatly. I was stuck with it for hours straight since I woke up. Thanks a lot."}, {"owner": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "edited": false, "score": 0, "creation_date": 1606235472, "post_id": 51289434, "comment_id": 114899462, "body": "It&#39;s confusing because the phrasing is very odd, uses the passive voice and the word &quot;encompasses&quot; actually means <i>any</i> directory above the file itself. Shorter and clearer would simply be &quot;B.proto not found. Provide the path to .proto files using --proto_path&quot;"}], "tags": [], "owner": {"reputation": 1509, "user_id": 4815767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc24bfa1708763d1853a48c6290fbcaa?s=128&d=identicon&r=PG", "display_name": "Popmedic", "link": "https://stackoverflow.com/users/4815767/popmedic"}, "is_accepted": true, "score": 19, "last_activity_date": 1573420351, "last_edit_date": 1573420351, "creation_date": 1531323470, "answer_id": 51289434, "question_id": 51287288, "link": "https://stackoverflow.com/questions/51287288/file-does-not-reside-within-any-path-specified-using-proto-path/51289434#51289434", "title": "File does not reside within any path specified using proto_path", "body": "<p>Error seems clear enough to me, it is saying that you need to specify the exact directory that B.proto is in </p>\n\n<pre><code>protoc B.proto --go_out=. --proto_path=$GOPATH/src/B \n</code></pre>\n\n<p>or if you are in folder B already, </p>\n\n<pre><code>protoc B.proto --go_out=.\n</code></pre>\n"}], "owner": {"reputation": 435, "user_id": 10061533, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fv61VUShbCs/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rTOnJlSCJr_asOOUez6u2WFiAdCQ/mo/photo.jpg?sz=128", "display_name": "Cubey Mew", "link": "https://stackoverflow.com/users/10061533/cubey-mew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12194, "favorite_count": 1, "accepted_answer_id": 51289434, "answer_count": 1, "score": 12, "last_activity_date": 1573420351, "creation_date": 1531317145, "last_edit_date": 1531322436, "question_id": 51287288, "link": "https://stackoverflow.com/questions/51287288/file-does-not-reside-within-any-path-specified-using-proto-path", "title": "File does not reside within any path specified using proto_path", "body": "<p>I am testing out importing .proto file from another directory.</p>\n\n<p><strong>$GOPATH/src/A/A.proto</strong></p>\n\n<pre><code>syntax = \"proto3\"; \npackage A;\n message SomeMsg {\n     string  msg = 2;\n     int64   id  = 3;\n }\n</code></pre>\n\n<p><strong>$GOPATH/src/B/B.proto</strong></p>\n\n<pre><code>syntax = \"proto3\"; \npackage B; import \"A/A.proto\";\n message Msg {\n     SomeMsg s = 1;\n }\n</code></pre>\n\n<p>I'm doing this:\nin folder A:</p>\n\n<pre><code>protoc A.proto --go_out=.\n</code></pre>\n\n<p>and then in folder B:</p>\n\n<pre><code>protoc B.proto --go_out=. --proto_path=$GOPATH/\n</code></pre>\n\n<p>But I will get this error:</p>\n\n<blockquote>\n  <p>B.proto: File does not reside within any path specified using --proto_path (or -I).  You must specify a --proto_path which encompasses this file.  Note that the proto_path must be an exact prefix of the .proto file names -- protoc is too dumb to figure out when two paths (e.g. absolute and relative) are equivalent (it's harder than you think).</p>\n</blockquote>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 638, "user_id": 2657830, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d509ab1246e8e6fa5f39b03d1ebe0706?s=128&d=identicon&r=PG", "display_name": "akskap", "link": "https://stackoverflow.com/users/2657830/akskap"}, "edited": false, "score": 2, "creation_date": 1531310366, "post_id": 51284616, "comment_id": 89547046, "body": "AWS SDK for go does expose a \u2018Prefix\u2019 parameter, you can define that in ListObjectsInput struct. Please check this link <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#ListObjectsInput\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/sdk-for-go/api/service/s3/#ListObjectsIn&zwnj;&#8203;put</a>"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1531314733, "creation_date": 1531314733, "answer_id": 51286386, "question_id": 51284616, "link": "https://stackoverflow.com/questions/51284616/can-s3-prefix-be-deleted-on-go-sdk/51286386#51286386", "title": "Can s3 prefix be deleted on go-sdk?", "body": "<p>No. The CLI provides added conveniences around the SDK; the SDK just provides what the API exposes. When you do <code>aws s3 rm s3://mybucket/prefix/ --recursive</code> in the CLI, the CLI's code does exactly what you described using the SDK: list all the objects with that prefix, then delete them. Don't expect all functionality in the CLI to be available in the SDK, just the functionality in the API.</p>\n"}], "owner": {"reputation": 902, "user_id": 2746089, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Bjuob.png?s=128&g=1", "display_name": "RNA", "link": "https://stackoverflow.com/users/2746089/rna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 0, "accepted_answer_id": 51286386, "answer_count": 1, "score": -1, "last_activity_date": 1531314733, "creation_date": 1531309259, "question_id": 51284616, "link": "https://stackoverflow.com/questions/51284616/can-s3-prefix-be-deleted-on-go-sdk", "title": "Can s3 prefix be deleted on go-sdk?", "body": "<p>In AWS cli, you can delete all items under prefix:</p>\n\n<pre><code>aws s3 rm s3://mybucket/prefix/ --recursive\n</code></pre>\n\n<p>I would like to delete all items under prefix just by giving prefix name.\nCan this be done in go sdk? Closest answer I found was:</p>\n\n<pre><code>get keys from the `listobject`\ndeleteObjects(keys)\n</code></pre>\n"}, {"tags": ["c++", "go", "grpc"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1531309288, "post_id": 51284460, "comment_id": 89546321, "body": "They are supposed to be long living. Reconnecting themselves if the connection drops in the meantime."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1531313267, "post_id": 51284460, "comment_id": 89549120, "body": "One channel is generally exactly one HTTP/2 connection (and each call is one stream in that connection). With a loadbalancer it may be several connections. In any case, you&#39;re supposed to reuse that channel as much as possible."}], "owner": {"reputation": 3204, "user_id": 2228338, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh3.googleusercontent.com/-b3jn9hCpWYU/AAAAAAAAAAI/AAAAAAAAAAs/-1U-aoxnBOc/photo.jpg?sz=128", "display_name": "Yuki", "link": "https://stackoverflow.com/users/2228338/yuki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 507, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1531309294, "creation_date": 1531308813, "last_edit_date": 1531309294, "question_id": 51284460, "link": "https://stackoverflow.com/questions/51284460/go-c-grpc-client-channel-and-stub-lifecycle", "title": "Go/C++ gRPC client channel and stub lifecycle", "body": "<p>I have several Go and C++ services, that act as servers and clients, i.e. those are long-living services, that from time-to-time talk to other services.</p>\n\n<p>I cannot find anywhere in gRPC docs whether the client channels and stubs should be long-lasting reusable objects or they should be created on every call. Or, maybe, I should create some kind of a channel/stub pool, where a pair of a channel and a stub exists, for example, for each thread and gets updated, refreshed on some interval or condition.</p>\n"}, {"tags": ["go", "gcc", "cgo"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1531378912, "post_id": 51283102, "comment_id": 89575168, "body": "Try running <code>go build</code> with the <code>-x</code> flag and see whether the calls to the C compiler indeed use the value you&#39;d expect."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1531379249, "post_id": 51283102, "comment_id": 89575369, "body": "Also, you might just have found a bug. <a href=\"https://github.com/golang/go/issues?utf8=%E2%9C%93&amp;q=is%3Aissue+in%3Atitle+label%3AOS-Darwin+cmd%2Fcgo\" rel=\"nofollow noreferrer\">This search</a> does not bring anything matching so you may just try filing an issue."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 3201174, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c01dd64de3f38f2b083e8e284793201a?s=128&d=identicon&r=PG&f=1", "display_name": "momo0853", "link": "https://stackoverflow.com/users/3201174/momo0853"}, "is_accepted": false, "score": 2, "last_activity_date": 1545883027, "creation_date": 1545883027, "answer_id": 53939576, "question_id": 51283102, "link": "https://stackoverflow.com/questions/51283102/cgo-ignores-the-ldflags-l-option-on-macos/53939576#53939576", "title": "CGO ignores the LDFLAGS -L option on MacOS", "body": "<p>Set the dynamic library load path.For mac setting <code>DYLD_LIBRARY_PATH</code> for linux <code>LD_LIBRARY_PATH</code></p>\n"}], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1448, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1545883027, "creation_date": 1531304757, "last_edit_date": 1531360347, "question_id": 51283102, "link": "https://stackoverflow.com/questions/51283102/cgo-ignores-the-ldflags-l-option-on-macos", "title": "CGO ignores the LDFLAGS -L option on MacOS", "body": "<p>I'm trying to compile the following code on a MacOS machine</p>\n\n<pre><code>// #cgo darwin LDFLAGS: -L${SRCDIR}/build/darwin -lprocessing_lib\n// #cgo linux LDFLAGS: -L${SRCDIR}/build/linux -lprocessing_lib\n// #include \"Processing-bridge.h\"\n// #include &lt;stdlib.h&gt;\nimport \"C\"\nimport \"unsafe\"\n\ntype ProcessorWrapper struct {\n    ptr unsafe.Pointer\n}\n\nfunc init() {\n    pr.ptr = C.NewProcessor()\n}\n\nfunc GetDefault() (id int, name string) {\n    var default = C.GetDefault(pr.ptr)\n    id = int(default.materialId)\n    name = C.GoString(default.name)\n    return\n}\n</code></pre>\n\n<p>I have the libprocessing_lib.so file in the correct location defined in the LDFLAGS. However the compiler still throws an error saying</p>\n\n<pre><code>dyld: Library not loaded: build/lib_processing_lib.so\n  Referenced from: /Users/ag/workspace/src/github.com/apremalal/pq-processor/./pq-processor\n  Reason: image not found\n</code></pre>\n\n<p>Once I copy build/lib_processing_lib.so to the root of the project it works.</p>\n\n<p>It seems that the library directory provided by the LDFLAGS is somehow getting overridden.</p>\n\n<p>I've noticed that setting DYLD_LIBRARY_PATH variable before compilation also override this value.(I ran above scenarios without setting this parameter)</p>\n\n<p>Interestingly though the same code works in Linux environment  by picking up the correct path.</p>\n\n<p>Is there anything special that I need to do in MacOS to get the desirable LDFLAGS behavior?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 681, "user_id": 1894292, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/24bbb0e9731796478c7307061bfd1a84?s=128&d=identicon&r=PG", "display_name": "user1894292", "link": "https://stackoverflow.com/users/1894292/user1894292"}, "edited": false, "score": 0, "creation_date": 1531308462, "post_id": 51283875, "comment_id": 89545781, "body": "Perfect.  Thank you"}, {"owner": {"reputation": 681, "user_id": 1894292, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/24bbb0e9731796478c7307061bfd1a84?s=128&d=identicon&r=PG", "display_name": "user1894292", "link": "https://stackoverflow.com/users/1894292/user1894292"}, "edited": false, "score": 0, "creation_date": 1531308544, "post_id": 51283875, "comment_id": 89545837, "body": "Why does this work?  I would assume that model interface{} would need a star, as so: model *interface{}, to explicitly state that it will accept a pointer"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 681, "user_id": 1894292, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/24bbb0e9731796478c7307061bfd1a84?s=128&d=identicon&r=PG", "display_name": "user1894292", "link": "https://stackoverflow.com/users/1894292/user1894292"}, "edited": false, "score": 0, "creation_date": 1531308951, "post_id": 51283875, "comment_id": 89546095, "body": "json.Unmarshal accept argument of any type since interface{}. Semantically it must be a pointer to some struct to be filled by umarshaler. You pass reference to postData struct and things work and you can use postData."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 3, "last_activity_date": 1531307006, "creation_date": 1531307006, "answer_id": 51283875, "question_id": 51282894, "link": "https://stackoverflow.com/questions/51282894/pass-a-generic-struct-interface-into-a-function-and-return-it/51283875#51283875", "title": "Pass a generic struct/interface into a function and return it", "body": "<pre><code>func EmailHandler(writer http.ResponseWriter, request *http.Request) {\n    var postData = EmailPostData{}\n    ConvertRequestJsonToJson(request, &amp;postData)\n    //Use postData, it should be filled\n}\nfunc ConvertRequestJsonToJson(request *http.Request, model interface{}) {\n    postContent, _ := ioutil.ReadAll(request.Body)\n    json.Unmarshal([]byte(postContent), model)//json.Unmarshal stores the result in the value pointed to by model\n}\n</code></pre>\n"}], "owner": {"reputation": 681, "user_id": 1894292, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/24bbb0e9731796478c7307061bfd1a84?s=128&d=identicon&r=PG", "display_name": "user1894292", "link": "https://stackoverflow.com/users/1894292/user1894292"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1162, "favorite_count": 0, "accepted_answer_id": 51283875, "answer_count": 1, "score": -1, "last_activity_date": 1531307006, "creation_date": 1531304197, "question_id": 51282894, "link": "https://stackoverflow.com/questions/51282894/pass-a-generic-struct-interface-into-a-function-and-return-it", "title": "Pass a generic struct/interface into a function and return it", "body": "<p>Can I pass a generic struct or interface into a function, and then return it?  I've tried using pointers in the example below, and I've also tried using struct as a return type but I can't seem to do it.</p>\n\n<p>If I use interface{} instead, I seem to be able to pass postData in but getting it back seems to be impossible by returning or updating a pointer.  Can anyone tell me where I'm going wrong?</p>\n\n<pre><code>func EmailHandler(writer http.ResponseWriter, request *http.Request) {\n    var postData = EmailPostData{}\n    ConvertRequestJsonToJson(request, &amp;postData)\n}\n\nfunc ConvertRequestJsonToJson(request *http.Request, model *struct{}) {\n    postContent, _ := ioutil.ReadAll(request.Body)\n    json.Unmarshal([]byte(postContent), &amp;model)\n}\n</code></pre>\n"}, {"tags": ["java", "go", "nsq"], "owner": {"reputation": 21, "user_id": 6587296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dda6582fae9dbf6ca8af0c44ce2f6188?s=128&d=identicon&r=PG&f=1", "display_name": "Siyong Xiao", "link": "https://stackoverflow.com/users/6587296/siyong-xiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 224, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1531303648, "creation_date": 1531301857, "last_edit_date": 1531303648, "question_id": 51282086, "link": "https://stackoverflow.com/questions/51282086/why-were-the-messages-delayed-in-nsq-its-unexpected", "title": "Why were the messages delayed in NSQ? It&#39;s unexpected\u2026\u2026", "body": "<p>I used the NSQ as the mq in my project\uff0cjava producer produce the message to NSQ and go consumer consume it.But the strange things is that the consumer always get the message after few seconds.There is just a few messages,I really don't know how to explain why it's happened.\nHere is the test result\uff0cplease pay attention to the time.They both consume the same topic.You can see in the second time,Go is slower than java for 7s. \nJava result:</p>\n\n<blockquote>\n  <p>INFO   | jvm 1    | <strong>2018/07/11 17:22:01</strong> | Msg\n  receive\uff1a{\"did\":\"XSQ000200000005\",\"msg\":{\"id\":\"5560\",\"type\":1,\"content\":\"ZBINh6CBsLw7k2xjr1wslSjY+5QavEgYU6AzzLZn0lOgON9ZYHnNP4UJVUGB+/SpsxZQnrWR9PlULzpSP/p9l9t8wiAwj8qhznRaT8jeyx1/EUrDE0oXJB8GxWaLJUICCbC92j4BMA2HU8vgcfDOp9nSy1KFafi9zgFiCf9Igqo=\"}}</p>\n  \n  <p>INFO   | jvm 1    | <strong>2018/07/11 17:22:11</strong> | Msg\n  receive\uff1a{\"did\":\"XSQ000200000005\",\"msg\":{\"id\":\"5560\",\"type\":1,\"content\":\"ZBINh6CBsLw7k2xjr1wslSjY+5QavEgYU6AzzLZn0lOgON9ZYHnNP4UJVUGB+/SpsxZQnrWR9PlULzpSP/p9l9t8wiAwj8qhznRaT8jeyx1/EUrDE0oXJB8GxWaLJUICCbC92j4BMA2HU8vgcfDOp9nSy1KFafi9zgFiCf9Igqo=\"}}</p>\n  \n  <p>INFO   | jvm 1    | <strong>2018/07/11 17:23:21</strong> | Msg\n  receive\uff1a{\"did\":\"XSQ000200000005\",\"msg\":{\"id\":\"5560\",\"type\":1,\"content\":\"ZBINh6CBsLw7k2xjr1wslSjY+5QavEgYU6AzzLZn0lOgON9ZYHnNP4UJVUGB+/SpsxZQnrWR9PlULzpSP/p9l9t8wiAwj8qhznRaT8jeyx1/EUrDE0oXJB8GxWaLJUICCbC92j4BMA2HU8vgcfDOp9nSy1KFafi9zgFiCf9Igqo=\"}}</p>\n  \n  <p>INFO   | jvm 1    | <strong>2018/07/11 17:25:31</strong> | Msg\n  receive\uff1a{\"did\":\"XSQ000200000005\",\"msg\":{\"id\":\"5560\",\"type\":1,\"content\":\"ZBINh6CBsLw7k2xjr1wslSjY+5QavEgYU6AzzLZn0lOgON9ZYHnNP4UJVUGB+/SpsxZQnrWR9PlULzpSP/p9l9t8wiAwj8qhznRaT8jeyx1/EUrDE0oXJB8GxWaLJUICCbC92j4BMA2HU8vgcfDOp9nSy1KFafi9zgFiCf9Igqo=\"}}</p>\n</blockquote>\n\n<p>Go  result:</p>\n\n<p><strong>2018-07-11 17:22:03</strong> broker.go   DEBUG   Ready to send msg 5560 with type 1 to XSQ000200000005</p>\n\n<p><strong>2018-07-11 17:22:28</strong> broker.go   DEBUG   Ready to send msg 5560 with type 1 to XSQ000200000005</p>\n\n<p><strong>2018-07-11 17:23:21</strong> broker.go   DEBUG   Ready to send msg 5560 with type 1 to XSQ000200000005</p>\n\n<p><strong>2018-07-11 17:25:38</strong> broker.go   DEBUG   Ready to send msg 5560 with type 1 to XSQ000200000005</p>\n\n<p>please ignore the other errors,just because of the business.</p>\n\n<p>Here is my go consumer:</p>\n\n<pre><code>func (b *Broker) createConsumer(topic string, vendor int32) error {\n    config := nsq.NewConfig()\n    laddr := \"127.0.0.1\"\n    // so that the test can simulate binding consumer to specified address\n    config.LocalAddr, _ = net.ResolveTCPAddr(\"tcp\", laddr+\":0\")\n    // so that the test can simulate reaching max requeues and a call to LogFailedMessage\n    config.DefaultRequeueDelay = 0\n    // so that the test wont timeout from backing off\n    config.MaxBackoffDuration = time.Millisecond * 50\n\n\n\n\n    c, err := nsq.NewConsumer(topic, \"channel_box_\" + util.String(vendor), config)\n    if err != nil {\n        return log.Error(\"Failed to new nsq consumers.\")\n    }\n\n    c.AddConcurrentHandlers(nsq.HandlerFunc(func(message *nsq.Message) error {\n        if err := b.handle(message, vendor); err != nil {\n            log.Errorf(\"Handle message %v for vendor %d from mq failed.\", message.ID, vendor)\n        }\n        return nil\n    }), 5)\n    if err = c.ConnectToNSQLookupds(b.Opts.Nsq.Lookup); err != nil {\n        return log.Error(\"Failed to connect to nsq lookup server.\")\n    }\n    b.consumers = append(b.consumers, c)\n\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1531302847, "post_id": 51281787, "comment_id": 89542216, "body": "See <a href=\"https://stackoverflow.com/questions/49936530/read-config-in-a-custom-format-from-yaml-file/49937921\" title=\"read config in a custom format from yaml file\">stackoverflow.com/questions/49936530/&hellip;</a>"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1531308320, "post_id": 51281787, "comment_id": 89545698, "body": "why do you need to convert it to json, you could unmarshal the YAML into a struct and then print the required fields of that struct"}, {"owner": {"reputation": 235, "user_id": 6160175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca0f9156f6530e315631edce5b41f74?s=128&d=identicon&r=PG&f=1", "display_name": "MelDev", "link": "https://stackoverflow.com/users/6160175/meldev"}, "edited": false, "score": 0, "creation_date": 1531310030, "post_id": 51281787, "comment_id": 89546845, "body": "how could you please show an example because my yaml change it&#39;s dynamic"}], "answers": [{"tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": 0, "last_activity_date": 1531319194, "creation_date": 1531319194, "answer_id": 51288054, "question_id": 51281787, "link": "https://stackoverflow.com/questions/51281787/get-json-paths-to-value-from-json/51288054#51288054", "title": "Get JSON paths to value from JSON", "body": "<p>This is an example of how you could do it: <a href=\"https://play.golang.org/p/7yLq_PDLdXF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7yLq_PDLdXF</a></p>\n\n<p>It is pretty naive and definitely could be improved, but it may give you an idea about how to parse the <code>yaml</code> file and then print the output in your desired format:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"strings\"\n\n    \"github.com/go-yaml/yaml\"\n)\n\nvar data = `\nsentinel:\n  number: 3\nserver:\n  number: 7\nconfig:\n  fere_size: 5\nlcmea:\n  eza_ze: all\n`\n\nfunc main() {\n    m := make(map[string]map[string]interface{})\n\n    err := yaml.Unmarshal([]byte(data), &amp;m)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n\n    out := []string{}\n    for k, v := range m {\n        for j, i := range v {\n            out = append(out, fmt.Sprintf(\"%s.%v=%v\", k, j, i))\n        }\n    }\n\n    fmt.Println(strings.Join(out, \", \"))\n}\n</code></pre>\n\n<p>It will return:</p>\n\n<pre><code>$ go run main.go\nsentinel.number=3, server.number=7, config.fere_size=5, lcmea.eza_ze=all\n</code></pre>\n\n<p>It is using <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">https://github.com/go-yaml/yaml</a>, check more  examples on the <code>README.md</code> </p>\n"}], "owner": {"reputation": 235, "user_id": 6160175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca0f9156f6530e315631edce5b41f74?s=128&d=identicon&r=PG&f=1", "display_name": "MelDev", "link": "https://stackoverflow.com/users/6160175/meldev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 385, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1531319194, "creation_date": 1531300962, "last_edit_date": 1531313682, "question_id": 51281787, "link": "https://stackoverflow.com/questions/51281787/get-json-paths-to-value-from-json", "title": "Get JSON paths to value from JSON", "body": "<p>I'm trying to write a func to get all paths to values from a yaml file and I don't know know how that possible, here is my code:</p>\n\n<pre><code>func getpath(fileyaml) string {\n\n   if _, err := os.Stat(fileyaml); err == nil {\n   bfile, err := ioutil.ReadFile(fileyaml)\n   bjson, err := yaml.YAMLToJSON(bfile)\n   if err != nil {\n      fmt.Printf(\"YAMLToJSON err: %v\\n\", err)\n   }\n\n   json := string(bjson)\n\n   println json\n   paths := ? // don't know \n    return path \n</code></pre>\n\n<p>here my yaml file : </p>\n\n<pre><code>sentinel:\n  number: 3\nserver:\n  number: 7\nconfig:\n  fere_size: 5\nlcmea:\n  eza_ze: all\n</code></pre>\n\n<p>my function will convert it to a json: <code>{\"config\":{\"fere_size\":5},\"lcmea\":{\"eza_hooks\":\"all\"},\"sentinel\":{\"number\":3},\"server\":{\"number\":7}}</code></p>\n\n<p>the output that i want : </p>\n\n<pre><code>sentinel.number=3, server.number=3,config.fere_size=5,lcmea.eza_ze=all\n</code></pre>\n\n<p>how to parse this json in order to get this desired output?</p>\n\n<p>I'm using \"github.com/tidwall/gjson\" to read the yaml and convert it to json</p>\n"}, {"tags": ["go", "struct", "protocol-buffers"], "answers": [{"comments": [{"owner": {"reputation": 15031, "user_id": 1256496, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/hlmB0.jpg?s=128&g=1", "display_name": "zemirco", "link": "https://stackoverflow.com/users/1256496/zemirco"}, "edited": false, "score": 0, "creation_date": 1531305788, "post_id": 51280563, "comment_id": 89544071, "body": "Of course! That makes totally sense. Thanks a lot :)"}, {"owner": {"reputation": 3111, "user_id": 3879440, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/2WgoV.jpg?s=128&g=1", "display_name": "Puneet Singh", "link": "https://stackoverflow.com/users/3879440/puneet-singh"}, "edited": false, "score": 0, "creation_date": 1579767448, "post_id": 51280563, "comment_id": 105878520, "body": "is there still a way to make it possible?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1531303870, "last_edit_date": 1531303870, "creation_date": 1531297299, "answer_id": 51280563, "question_id": 51280221, "link": "https://stackoverflow.com/questions/51280221/protobuf-go-and-private-fields/51280563#51280563", "title": "Protobuf, Go and private fields", "body": "<p>Protobuf is for <em>communication</em>, not for database modeling. You should use protobuf to describe the data structures you intend to send over / receive from your clients.</p>\n\n<p>If you don't intend to send the user ID to the clients, don't include that in your protobuf <code>Player</code> definition.</p>\n\n<p>The <code>Player</code> you send to the clients and the <code>Player</code> you store in your database does not have to be the same. More often they are not the same, you usually store other fields such as creation time, database ID etc. which are not for the clients.</p>\n\n<p>So you should have 2 separate structures for a <code>Player</code>, one that the server uses (stores), and one that clients see. Of course when defining those 2 structs, you may utilize one in the other to prevent repetition, e.g. the server player may embed the client player, e.g.:</p>\n\n<p>New proto <code>Player</code>:</p>\n\n<pre><code>message Player {\n  string first_name = 1;\n  string last_name = 2;\n}\n</code></pre>\n\n<p>Client <code>Player</code>:</p>\n\n<pre><code>type Player struct {\n    FirstName string\n    LastName string\n}\n</code></pre>\n\n<p>Server <code>Player</code>:</p>\n\n<pre><code>type DBPlayer struct {\n    Player // Embed Player\n\n    UserId int32\n}\n</code></pre>\n\n<p>And when you load a <code>DBPlayer</code> in your server, you would only send the <code>DBPlayer.Player</code> field to the client, the rest is \"private\".</p>\n"}], "owner": {"reputation": 15031, "user_id": 1256496, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/hlmB0.jpg?s=128&g=1", "display_name": "zemirco", "link": "https://stackoverflow.com/users/1256496/zemirco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 761, "favorite_count": 0, "accepted_answer_id": 51280563, "answer_count": 1, "score": 3, "last_activity_date": 1531303870, "creation_date": 1531296152, "last_edit_date": 1531298089, "question_id": 51280221, "link": "https://stackoverflow.com/questions/51280221/protobuf-go-and-private-fields", "title": "Protobuf, Go and private fields", "body": "<p>Let's say I've got a <code>Player</code> defined in my <code>.proto</code> file.</p>\n\n<pre><code>message Player {\n  string first_name = 1;\n  string last_name = 2;\n  int32 user_id = 3;\n}\n</code></pre>\n\n<p>I'm using <a href=\"https://github.com/twitchtv/twirp\" rel=\"nofollow noreferrer\">https://github.com/twitchtv/twirp</a> to communicate between my Go backend and my JavaScript frontend. If you don't know Twirp it's simply JSON RPC over HTTP 1.1.</p>\n\n<p>The <code>Player</code> message is converted into a Go struct</p>\n\n<pre><code>type Player struct {\n  FirstName string\n  LastName string\n  UserId int32\n}\n</code></pre>\n\n<p>As we all know uppercase fields are public. However I'd like to keep the <code>UserId</code> private, i.e. make it lowercase. My users in the frontend should not be able to see the <code>UserId</code> of a player. In my backend I need this information so I cannot simply remove the field.</p>\n\n<p>Any ideas how to handle such a situation? Is it possible to have private fields in my <code>.proto</code> files?</p>\n"}, {"tags": ["go"], "owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 296, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1531308262, "creation_date": 1531293802, "last_edit_date": 1531308262, "question_id": 51279520, "link": "https://stackoverflow.com/questions/51279520/bip32-keys-encryption-in-golang-nacl-secretbox", "title": "Bip32 Keys encryption in Golang Nacl Secretbox", "body": "<p>I have created the <code>Assymetric</code> struct which generates a BIP39 and BIP32 Master public and private key. Now I want to use these keys and their derived children to encrypt files or strings depending upon the use case. Please correct me if I am wrong &mdash; the keys generated from Mnemonics BIP32 are Elliptic curve keys(secp256k1). I am trying to use the NACL Go implementation to encrypt text with these keys, but it only accepts keys which are 32 bytes but the keys that are being generated from Mnemonics are 256 Bytes. Please help. The bip32 implementation can be found here <a href=\"https://github.com/tyler-smith/go-bip32/blob/master/bip32.go#L59\" rel=\"nofollow noreferrer\">https://github.com/tyler-smith/go-bip32/blob/master/bip32.go#L59</a>\nAfter going through the implementation, I have found out that the resulting key is a combination of Key and chaincode, key.Key is a 32byte key that must be used for encryption. Just wanted to check if this is the right way to do it and guarantees security. </p>\n\n<pre><code>package encryption\n\n\nimport (\n   \"github.com/tyler-smith/go-bip39\"\n   \"github.com/tyler-smith/go-bip32\"\n   \"crypto/ecdsa\"\n   \"crypto/elliptic\"\n   \"golang.org/x/crypto/nacl/secretbox\"\n   \"crypto/rand\"\n   \"encoding/hex\"\n   \"io\"\n   \"log\"\n )\n\n\ntype Encryption interface {\n     GenerateMnemonic() ( *bip32.Key, *bip32.Key)\n}\n\ntype Assymetric struct{\n   RootPrivateKey *bip32.Key\n   RootPublicKeyKey *bip32.Key\n   RootMnemonic string\n   RootPassphrase string\n}\n\nfunc (c *Assymetric) GenerateMnemonic() (*bip32.Key, *bip32.Key){\n\n  entropy, _ := bip39.NewEntropy(256)\n  mnemonic, _ := bip39.NewMnemonic(entropy)\n\n  seed := bip39.NewSeed(mnemonic, c.RootPassphrase)\n\n  rootPrivateKey, _ := bip32.NewMasterKey(seed)\n  rootPublicKey := rootPrivateKey.PublicKey()\n\n  // Display mnemonic and keys\n  //c.RootMnemonic = mnemonic\n  c.RootPrivateKey = rootPrivateKey\n  c.RootPublicKeyKey = rootPublicKey\n\n\n  key, _ := rootPrivateKey.NewChildKey(0)\n  log.Printf(\"Private key 0 is %s\", key)\n  log.Printf(\"Public key 0 is %s\", key.PublicKey())\n\n\n    // You must use a different nonce for each message you encrypt with the\n    // same key. Since the nonce here is 192 bits long, a random value\n    // provides a sufficiently small probability of repeats.\n\n  log.Printf(\"This is the secret key %s\", secretKey)\n\n  var nonce [24]byte\n    if _, err := io.ReadFull(rand.Reader, nonce[:]); err != nil {\n        panic(err)\n    }\n\n  log.Printf(\"This is the nonce %s\", nonce)\n\n   var a [32]byte\n  copy(a[:], key.Key)\n\n  log.Printf(\"\\nlen=%d cap=%d %v\\n\", len(a), cap(a), a)\n\n\n  encrypted := secretbox.Seal(nonce[:], []byte(\"hello world\"), &amp;nonce, &amp;a)\n\n  log.Println(encrypted)\n  return rootPrivateKey, rootPublicKey\n</code></pre>\n"}, {"tags": ["testing", "go", "main"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1531288597, "post_id": 51277222, "comment_id": 89533813, "body": "<code>TestMain</code> has nothing to do with testing <code>main()</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1531288781, "post_id": 51277222, "comment_id": 89533895, "body": "And if you have real functionality in main(), move it elsewhere to be easier to test, then have main call it."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 1, "last_activity_date": 1531283494, "creation_date": 1531283494, "answer_id": 51277293, "question_id": 51277222, "link": "https://stackoverflow.com/questions/51277222/which-methodology-i-should-use-to-test-func-main-in-golang/51277293#51277293", "title": "Which methodology i should use to test func main() in golang?", "body": "<p>You can check out \"<a href=\"https://blog.cloudflare.com/go-coverage-with-external-tests/\" rel=\"nofollow noreferrer\">Go coverage with external tests</a>\", by <strong>Filippo Valsorda</strong>:</p>\n\n<blockquote>\n  <p>We create a dummy test that executes <code>main()</code>, we put it behind a build tag, compile a binary with <code>go test -c -cover</code> and then run only that test instead of running the regular binary.</p>\n  \n  <p>Here's what the <code>rrdns_test.go</code> file looks like:</p>\n</blockquote>\n\n<p>Note the empty line between the build tag and <code>package</code>:</p>\n\n<blockquote>\n<pre><code>// +build testrunmain\n\npackage main\n\nimport \"testing\"\n\nfunc TestRunMain(t *testing.T) {\n    main()\n}\n</code></pre>\n  \n  <p>We compile the binary like this:</p>\n\n<pre><code>$ go test -coverpkg=\"rrdns/...\" -c -tags testrunmain rrdns\n</code></pre>\n  \n  <p>And then when we want to collect coverage information, we execute this instead of <code>./rrdns</code> (and run our test battery as usual):</p>\n\n<pre><code>$ ./rrdns.test -test.run \"^TestRunMain$\" -test.coverprofile=system.out\n</code></pre>\n  \n  <p>You must return from <code>main()</code> cleanly for the profile to be written to disk; in <code>RRDNS</code> we do that by catching <code>SIGINT</code>. You can still use command line arguments and standard input normally, just note that you will get two lines of extra output from the test framework. </p>\n</blockquote>\n\n<p>This is similar to <a href=\"https://stackoverflow.com/a/39891957/6309\">this answer</a> which proposes:</p>\n\n<blockquote>\n<pre><code>func main() {\n    os.Exit(doFunc());\n}\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 83, "user_id": 3953646, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ec8fc67aabddcfb4fda8b24adc957c9f?s=128&d=identicon&r=PG&f=1", "display_name": "Anatoliy Fedorenko", "link": "https://stackoverflow.com/users/3953646/anatoliy-fedorenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1551, "favorite_count": 2, "accepted_answer_id": 51277293, "answer_count": 1, "score": -4, "last_activity_date": 1531890297, "creation_date": 1531282906, "last_edit_date": 1531890297, "question_id": 51277222, "link": "https://stackoverflow.com/questions/51277222/which-methodology-i-should-use-to-test-func-main-in-golang", "title": "Which methodology i should use to test func main() in golang?", "body": "<p>I have a function <code>main()</code> in main.go that does the job and all other functions are below it (I did not include them here). So, when I write tests for all <code>funcs</code> that are included in <code>main</code>, I can test them. But the code coverage is low because it shows that I did not cover code from my <code>main</code> func. </p>\n\n<p>I know that there is a <code>TestMain</code> func in the testing library that should do the job, but I just cannot get how to get it to work so that the tests cover func <code>main()</code>. </p>\n\n<p>Below is my <code>main()</code> func which is not covered by tests... </p>\n\n<pre><code>func main() {\nc, err := getConfig()\nif err != nil {\n    log.Fatal(err)\n}\nslideshows, err := getSlideshows(c)\nif err != nil {\n    log.Fatal(err)\n}\n\ndisplaySlideshows(slideshows)\n</code></pre>\n\n<p>}</p>\n\n<p>Also, I did not find much about it on the internet, so, if this is a stupid question, please, explain to me why this is such a dum problem and where I should search for solutions! </p>\n\n<p>I will appreciate any help! </p>\n"}, {"tags": ["go", "p2p", "tcp-ip"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1531283120, "post_id": 51277199, "comment_id": 89532048, "body": "One issue is that the loop in StartServer creates and discards a bufio.Reader along with any data buffered by that reader.  Create the bufio.Readers once per connection."}, {"owner": {"reputation": 79, "user_id": 8154176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cadd51410f478f32f5ebfdb322eb703?s=128&d=identicon&r=PG&f=1", "display_name": "auenal", "link": "https://stackoverflow.com/users/8154176/auenal"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1531284596, "post_id": 51277199, "comment_id": 89532405, "body": "Thanks, but it is in the loop to create a bidrectional channel, so that sending endless messages between the nodes is provided. Not just sending a &quot;ping&quot;"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1531285044, "post_id": 51277199, "comment_id": 89532533, "body": "The program discards buffered data. That is probably not what you want. Also, the value returned by ReadString includes the traiing \\n.  Another \\n is added on write.  If you are not intending to send a blank line with every message, then don&#39;t add the extra \\n."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1531286161, "post_id": 51277199, "comment_id": 89532906, "body": "Don&#39;t ignore errors. You cannot have both servers listen on the same host:port."}, {"owner": {"reputation": 79, "user_id": 8154176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cadd51410f478f32f5ebfdb322eb703?s=128&d=identicon&r=PG&f=1", "display_name": "auenal", "link": "https://stackoverflow.com/users/8154176/auenal"}, "edited": false, "score": 0, "creation_date": 1531306368, "post_id": 51277199, "comment_id": 89544468, "body": "You mean for sending messages a port and receiving messages a port?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1531315422, "post_id": 51277199, "comment_id": 89550726, "body": "No, you can&#39;t listen on the same port twice. If you were checking errors, you&#39;d see an error stating that the port is already in use when you try to <code>net.Listen</code> on 8081 when something is already listening on that port."}, {"owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "edited": false, "score": 0, "creation_date": 1531881292, "post_id": 51277199, "comment_id": 89757288, "body": "I am not sure what exactly you are trying to achieve but <a href=\"https://talks.golang.org/2012/chat.slide#18\" rel=\"nofollow noreferrer\">this talk</a> by Andrew Gerrand helped me to start with simple networking in Go. It probably gives you an idea how to implement your server, too."}], "answers": [{"tags": [], "owner": {"reputation": 496, "user_id": 1310766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb332400d6bfcda911b524b122aeb34?s=128&d=identicon&r=PG", "display_name": "Francisco1844", "link": "https://stackoverflow.com/users/1310766/francisco1844"}, "is_accepted": false, "score": 3, "last_activity_date": 1531315989, "last_edit_date": 1592644375, "creation_date": 1531315989, "answer_id": 51286825, "question_id": 51277199, "link": "https://stackoverflow.com/questions/51277199/a-receiving-and-sending-tcp-client-with-go/51286825#51286825", "title": "A receiving and sending TCP client with Go", "body": "<p>Newbie Go developer here, but there is one issue I can think off right off the bat. You can not have multiple processes listening in the same IP and port.</p>\n<p>You are likely having an issue with that,  but because you are not checking for errors you are not catching it. If you had code to check for errors you likely would notice you are getting an error like this:</p>\n<blockquote>\n<p>2018/07/11 09:21:06 listen tcp 127.0.0.1:8081: bind: address already</p>\n<p>in use exit status 1</p>\n</blockquote>\n<p>Even if somehow that is not your issue, it is still a good idea to have the error checks.</p>\n<p>I recommend you add checks. For example</p>\n<p><strong>Server side</strong></p>\n<pre><code>ln, err := net.Listen(&quot;tcp&quot;, &quot;127.0.0.1:8081&quot;)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n<p><strong>Client side</strong></p>\n<pre><code>  conn, err := net.Dial(&quot;tcp&quot;, &quot;127.0.0.1:8081&quot;)\n    if err != nil {\n        fmt.Println(&quot;error:&quot;, err)\n    }\n</code></pre>\n<blockquote>\n<p>I think I need to implement a channel somehow</p>\n</blockquote>\n<p>As stated, I am new to Go myself, but my understanding is that channels are an interprocess communication tool within the same program. Not related to multiple programs. If you search for go channels in your favorite search tool you can find more info, but don't believe it is what you are looking for.</p>\n"}, {"tags": [], "owner": {"reputation": 1772, "user_id": 4706119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e597fc1530bb59898a572f5625417851?s=128&d=identicon&r=PG&f=1", "display_name": "hutabalian", "link": "https://stackoverflow.com/users/4706119/hutabalian"}, "is_accepted": false, "score": 0, "last_activity_date": 1550051150, "creation_date": 1550051150, "answer_id": 54667034, "question_id": 51277199, "link": "https://stackoverflow.com/questions/51277199/a-receiving-and-sending-tcp-client-with-go/54667034#54667034", "title": "A receiving and sending TCP client with Go", "body": "<p>Try to use two different processes as server and client. </p>\n\n<p>For example, at the main function:</p>\n\n<pre><code>func main() {\n    connType := os.Getenv(\"TYPE\")\n\n    if connType == \"server\" {\n        startServer()\n    } else if connType == \"client\" {\n        startClient()\n    } else {\n        log.Println(\"please provide the TYPE arg (TYPE=server or TYPE=client)\")\n    }\n}\n</code></pre>\n\n<p>Then you can run <code>TYPE=server go run yourapp</code> and <code>TYPE=client go run yourapp</code>.\nYou can look at this GitHub repo <a href=\"https://github.com/johannesridho/protobuf-over-tcp\" rel=\"nofollow noreferrer\">https://github.com/johannesridho/protobuf-over-tcp</a>.</p>\n"}], "owner": {"reputation": 79, "user_id": 8154176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cadd51410f478f32f5ebfdb322eb703?s=128&d=identicon&r=PG&f=1", "display_name": "auenal", "link": "https://stackoverflow.com/users/8154176/auenal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4044, "favorite_count": 2, "answer_count": 2, "score": 2, "last_activity_date": 1550051150, "creation_date": 1531282756, "last_edit_date": 1531283401, "question_id": 51277199, "link": "https://stackoverflow.com/questions/51277199/a-receiving-and-sending-tcp-client-with-go", "title": "A receiving and sending TCP client with Go", "body": "<p>I am trying to implement my own P2P network without using any library. I want to build a TCP Client which sends and receives messages from other nodes. So all nodes should be able to send and receive messages over tcp/ip. </p>\n\n<p>My current Problem is that the when I start both clients: One Node is able to receive and send messages, but the other node just sends messages and cannot receive messages. </p>\n\n<p>I think I need to implement a channel somehow, but I am really new into Go and don't know how to implement it. Any suggestions? </p>\n\n<p>Code below:</p>\n\n<p>Main.go:</p>\n\n<pre><code>package main\n\n func main() {\n\n  address := \"127.0.0.1:8081\" // IP of the other node; hardcoded for now\n  go startServer()\n  startClient(address)\n\n} \n</code></pre>\n\n<p>helpler.go :</p>\n\n<pre><code>package main\n\nimport (\n \"bufio\"\n \"fmt\"\n \"net\"\n \"os\"\n) \n\nfunc startClient(address string) {\n //connect to this socket\n connClient, _ := net.Dial(\"tcp\", address)\n\nfor {\n\n    //read in input from stdin\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Text to send: \")\n    text, _ := reader.ReadString('\\n')\n\n    //send to socket\n    fmt.Fprint(connClient, text+\"\\n\")\n\n    //listen for reply\n    //message, _ := bufio.NewReader(connClient).ReadString('\\n')\n    //fmt.Print(\"Message from server: \" + message)\n  }\n }\nfunc startServer() {\n fmt.Println(\"Starting...\")\n\n//listen on all interfaces\nln, _ := net.Listen(\"tcp\", \":8081\")\n\n//accept connection on port\nconnServer, _ := ln.Accept()\n\n//run loop forever\nfor {\n    //will listen for message to process ending in newline(\\n)\n    message, _ := bufio.NewReader(connServer).ReadString('\\n')\n\n    //fmt.Print(\"Message Received:\" + string(message))\n\n    //sample process for string received\n    //newmessage := strings.ToUpper(message)\n\n    connServer.Write([]byte(message + \"\\n\"))\n  }\n }\n</code></pre>\n"}, {"tags": ["angular", "go"], "answers": [{"comments": [{"owner": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "edited": false, "score": 0, "creation_date": 1531293142, "post_id": 51279235, "comment_id": 89536029, "body": "That was correct, all relative paths are from my main function for some reason... Any way to work around this? Will I have to move things around for production?"}, {"owner": {"reputation": 766, "user_id": 235521, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/818c46d7f6ebecfaf8f2c910fb3a1f2f?s=128&d=identicon&r=PG", "display_name": "kars7e", "link": "https://stackoverflow.com/users/235521/kars7e"}, "reply_to_user": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "edited": false, "score": 0, "creation_date": 1531293714, "post_id": 51279235, "comment_id": 89536334, "body": "You can provide whatever path you want to FileServer. If you don&#39;t know the path upfront, you could make your Go application to accept a command line argument that would be the absolute path, and just pass it to the FileServer. Can you give more context to what you want to achieve?"}, {"owner": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "edited": false, "score": 0, "creation_date": 1531293860, "post_id": 51279235, "comment_id": 89536411, "body": "I have a sqlite db file, a text file and a dist folder for an angular app all located in an assets folder in the root directory. It would be find if I just copied the asset folder into the same folder as the binary, however I want the paths to work in development and production."}, {"owner": {"reputation": 766, "user_id": 235521, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/818c46d7f6ebecfaf8f2c910fb3a1f2f?s=128&d=identicon&r=PG", "display_name": "kars7e", "link": "https://stackoverflow.com/users/235521/kars7e"}, "reply_to_user": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "edited": false, "score": 0, "creation_date": 1531294314, "post_id": 51279235, "comment_id": 89536616, "body": "I see, so your working directory is being set to where your go binary is stored. In that case I would go with the command line argument approach. In your go application, get the first argument passed to it (<a href=\"https://gobyexample.com/command-line-arguments\" rel=\"nofollow noreferrer\">look here</a>) and pass it to FileServer. Then when you run your go application, pass the <b>absolute</b> path to your <code>dist</code> folder as the first command line argument. This will work everywhere, just pass different path in development and production."}], "tags": [], "owner": {"reputation": 766, "user_id": 235521, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/818c46d7f6ebecfaf8f2c910fb3a1f2f?s=128&d=identicon&r=PG", "display_name": "kars7e", "link": "https://stackoverflow.com/users/235521/kars7e"}, "is_accepted": true, "score": 3, "last_activity_date": 1531292800, "creation_date": 1531292800, "answer_id": 51279235, "question_id": 51277121, "link": "https://stackoverflow.com/questions/51277121/serving-an-angular-dist-folder-with-go/51279235#51279235", "title": "Serving an angular dist folder with go", "body": "<p>When using relative paths you have to be extra cautious about the working directory of your application. Try printing the value returned by <a href=\"https://golang.org/pkg/os/#Getwd\" rel=\"nofollow noreferrer\"><code>os.Getwd</code></a> and see if it makes sense when combined with \"path/to/dist\".</p>\n\n<p>Also, since <code>http.FileServer</code> checks if path starts with <code>/</code>, and if it doesn't it <a href=\"https://golang.org/src/net/http/fs.go?#L710\" rel=\"nofollow noreferrer\">adds it back</a>, using <code>http.StripPrefix</code> with \"/\" is not needed.</p>\n"}], "owner": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 0, "accepted_answer_id": 51279235, "answer_count": 1, "score": 2, "last_activity_date": 1531292800, "creation_date": 1531282178, "question_id": 51277121, "link": "https://stackoverflow.com/questions/51277121/serving-an-angular-dist-folder-with-go", "title": "Serving an angular dist folder with go", "body": "<p>I'm simply trying to serve an angular application's dist folder using go. I tried an approach which worked well for me with react. e.g.</p>\n\n<pre><code>spa := http.StripPrefix(\"/\", http.FileServer(http.Dir(\"path/to/dist\")))\n// m is a gorilla mux router.\nm.PathPrefix(\"/\").Handler(spa)\n</code></pre>\n\n<p>However when I navigate to the port I'm serving on I receive a 404 error.</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 135, "user_id": 3166675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd006059601f87609ddd05933966fb7d?s=128&d=identicon&r=PG&f=1", "display_name": "caszi", "link": "https://stackoverflow.com/users/3166675/caszi"}, "is_accepted": false, "score": 1, "last_activity_date": 1531285905, "last_edit_date": 1531285905, "creation_date": 1531285523, "answer_id": 51277601, "question_id": 51276602, "link": "https://stackoverflow.com/questions/51276602/dynamically-pickup-the-correct-os-and-processor-architecture-using-cgo/51277601#51277601", "title": "Dynamically pickup the correct OS and processor architecture using CGO", "body": "<p>Could you have:</p>\n\n<p><code>library_darwin.go</code></p>\n\n<p><code>library_linux.go</code></p>\n\n<p>And in each file, have the correct <code>#cgo</code>flags (but the same code)?  </p>\n\n<p>Depending on the target OS, go will build only the correct file (see <a href=\"https://golang.org/pkg/go/build/\" rel=\"nofollow noreferrer\">here</a>)</p>\n"}, {"tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": true, "score": 1, "last_activity_date": 1531286068, "creation_date": 1531286068, "answer_id": 51277690, "question_id": 51276602, "link": "https://stackoverflow.com/questions/51276602/dynamically-pickup-the-correct-os-and-processor-architecture-using-cgo/51277690#51277690", "title": "Dynamically pickup the correct OS and processor architecture using CGO", "body": "<p>Found an easy way to achive this without creating multiple files by looking at the go source code it self <a href=\"https://github.com/golang/go/blob/f595848e9a1e1d0f64a7018d847167d85f6e83a4/src/runtime/cgo/cgo.go\" rel=\"nofollow noreferrer\">cgo</a></p>\n\n<pre><code>// #cgo darwin LDFLAGS: -L${SRCDIR}/build/darwin -lprocessing_lib\n// #cgo linux LDFLAGS: -L${SRCDIR}/build/darwin -lprocessing_lib\n</code></pre>\n\n<p>we can also pass the Architecture if needed like below</p>\n\n<pre><code>// #cgo darwin,arm64 LDFLAGS: -L${SRCDIR}/build/darwin -lprocessing_lib\n</code></pre>\n"}], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 1, "accepted_answer_id": 51277690, "answer_count": 2, "score": 3, "last_activity_date": 1531286068, "creation_date": 1531277848, "question_id": 51276602, "link": "https://stackoverflow.com/questions/51276602/dynamically-pickup-the-correct-os-and-processor-architecture-using-cgo", "title": "Dynamically pickup the correct OS and processor architecture using CGO", "body": "<p>I have access only to a linux and darwin distributions of dynamically linked shared libraries.</p>\n\n<p>Following is how I've integrated the library with Golang</p>\n\n<pre><code>// #cgo LDFLAGS: -L${SRCDIR}/build -lprocessing_lib\n// #include \"Processing-bridge.h\"\n// #include &lt;stdlib.h&gt;\nimport \"C\"\nimport \"unsafe\"\n\ntype ProcessorWrapper struct {\n    ptr unsafe.Pointer\n}\n\nfunc init() {\n    pr.ptr = C.NewProcessor()\n}\n\nfunc GetDefault() (id int, name string) {\n    var default = C.GetDefault(pr.ptr)\n    id = int(default.materialId)\n    name = C.GoString(default.name)\n    return\n}\n</code></pre>\n\n<p>This works perfectly fine when I copy the matching library under the build/ folder.</p>\n\n<p>I'm trying to make this as a go gettable library , where it could work on both linux and darwing architectures.</p>\n\n<p>Problem I'm having is to tell go compiler to pick the right library for the matching GOOS and GOARCH.</p>\n\n<p>I tried having a folder structure like below </p>\n\n<pre><code>build/darwing/libprocessing_lib.so\nbuild/linux/libprocessing_lib.so\n</code></pre>\n\n<p>And modified the LDFLAGS as below</p>\n\n<pre><code>// #cgo LDFLAGS: -L${SRCDIR}/build/${GOOS} -lprocessing_lib\n</code></pre>\n\n<p>However it doesn't recognise ${GOOS} and replace it with the correct value.</p>\n\n<p>Is there a way to achieve this dynamic library pickup feature?</p>\n"}, {"tags": ["go", "web"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 8998370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PpYtV.jpg?s=128&g=1", "display_name": "Person Person", "link": "https://stackoverflow.com/users/8998370/person-person"}, "edited": false, "score": 0, "creation_date": 1531273885, "post_id": 51276010, "comment_id": 89530136, "body": "would I replace the handler I currently have for the /lvlione path or do I need to change more than that? (thanks for the help)"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 35, "user_id": 8998370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PpYtV.jpg?s=128&g=1", "display_name": "Person Person", "link": "https://stackoverflow.com/users/8998370/person-person"}, "edited": false, "score": 0, "creation_date": 1531310061, "post_id": 51276010, "comment_id": 89546865, "body": "@PersonPerson You should be able to make only the change specified. If any other change was necessary, I should have mentioned it."}], "tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": true, "score": 1, "last_activity_date": 1531272735, "creation_date": 1531272735, "answer_id": 51276010, "question_id": 51275875, "link": "https://stackoverflow.com/questions/51275875/how-to-serve-a-file-to-a-specific-url-path-with-the-fileserver-function-in-go-go/51276010#51276010", "title": "How to serve a file to a specific url path with the FileServer function in go/golang", "body": "<p>You need to call <a href=\"https://golang.org/pkg/net/http/#StripPrefix\" rel=\"nofollow noreferrer\"><code>http.StripPrefix</code></a> to remove the extra <code>lvlone</code> from the directory path.</p>\n\n<pre><code>      server.Handle(\"/lvlone/\", http.StripPrefix(\"/lvlone/\", os))\n</code></pre>\n\n<p>By default the <code>http.FileServer</code> assumes the path given to it is the root path, and appends the URL to it. If it is to serve a subdirectory of the virtual path, then that needs to be stripped from the path.</p>\n\n<p>And note that you need to have the trailing slashes in both places.</p>\n"}], "owner": {"reputation": 35, "user_id": 8998370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PpYtV.jpg?s=128&g=1", "display_name": "Person Person", "link": "https://stackoverflow.com/users/8998370/person-person"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 667, "favorite_count": 0, "accepted_answer_id": 51276010, "answer_count": 1, "score": 0, "last_activity_date": 1552021941, "creation_date": 1531271429, "last_edit_date": 1531290168, "question_id": 51275875, "link": "https://stackoverflow.com/questions/51275875/how-to-serve-a-file-to-a-specific-url-path-with-the-fileserver-function-in-go-go", "title": "How to serve a file to a specific url path with the FileServer function in go/golang", "body": "<p>I need to serve an html file to <code>localhost:8080/lvlione</code> but the <code>FileServer</code> function in golang doesn't seem to work.</p>\n\n<p>Here is main.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"      //logging that the server is running and other stuff\n    \"net/http\" //serving files and stuff\n)\n\nfunc main() {\n    //servemux\n    server := http.NewServeMux()\n\n    //handlers that serve the home html file when called\n    fs := http.FileServer(http.Dir(\"./home\"))\n    os := http.FileServer(http.Dir(\"./lvlone\")) //!!this is what is broken!!\n\n    //handles paths by serving correct files\n    //there will be if statements down here that check if someone has won or not soon\n    server.Handle(\"/\", fs)\n    server.Handle(\"/lvlione\", os)\n\n    //logs that server is Listening\n    log.Println(\"Listening...\")\n    //starts server\n    http.ListenAndServe(\":8080\", server)\n}\n</code></pre>\n\n<p>There is a folder in this directory called lvlone with one file in it (index.html). When I point my browser to <code>localhost:8080/lvlione</code> it returns <code>404</code>, but when it is pointed to <code>localhost:8080</code> it returns the correct file. </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "is_accepted": false, "score": 1, "last_activity_date": 1531269934, "last_edit_date": 1531269934, "creation_date": 1531264930, "answer_id": 51275169, "question_id": 51275036, "link": "https://stackoverflow.com/questions/51275036/split-a-string-of-one-side-letters-one-side-numbers/51275169#51275169", "title": "Split a string of one side letters, one side numbers", "body": "<p>It looks like Go's regex syntax does not support lookahead, so you will have to match the two parts and extract them manually, rather than using a split method.</p>\n\n<pre><code>package main\n\nimport (\n    \"regexp\"\n    \"fmt\"\n)\n\nvar reFlightNumbers = regexp.MustCompile(\"([A-Z]+)([0-9]+)\")\n\nfunc main() {\n    matches := reFlightNumbers.FindStringSubmatch(\"ABC123\")\n    fmt.Println(matches[1])\n    fmt.Println(matches[2])\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 303, "user_id": 8459186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcebb797a054839c8217b44d0f7868a9?s=128&d=identicon&r=PG&f=1", "display_name": "NickS", "link": "https://stackoverflow.com/users/8459186/nicks"}, "edited": false, "score": 0, "creation_date": 1531290638, "post_id": 51276072, "comment_id": 89534737, "body": "Thanks this looks perfect!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1531273774, "last_edit_date": 1531273774, "creation_date": 1531273388, "answer_id": 51276072, "question_id": 51275036, "link": "https://stackoverflow.com/questions/51275036/split-a-string-of-one-side-letters-one-side-numbers/51276072#51276072", "title": "Split a string of one side letters, one side numbers", "body": "<p>You could take advantage of the fact that Go is a programming language and write a simple Go function. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc parseFlight(s string) (letters, numbers string) {\n    var l, n []rune\n    for _, r := range s {\n        switch {\n        case r &gt;= 'A' &amp;&amp; r &lt;= 'Z':\n            l = append(l, r)\n        case r &gt;= 'a' &amp;&amp; r &lt;= 'z':\n            l = append(l, r)\n        case r &gt;= '0' &amp;&amp; r &lt;= '9':\n            n = append(n, r)\n        }\n    }\n    return string(l), string(n)\n}\n\nfunc main() {\n    flights := []string{\"AB1234\", \"ABC1234\", \"ABC123\", \"AB12\"}\n    for _, flight := range flights {\n        letters, numbers := parseFlight(flight)\n        fmt.Printf(\"%q: %q %q\\n\", flight, letters, numbers)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/pDrsqntAP6E\" rel=\"noreferrer\">https://play.golang.org/p/pDrsqntAP6E</a></p>\n\n<p>Output:</p>\n\n<pre><code>\"AB1234\": \"AB\" \"1234\"\n\"ABC1234\": \"ABC\" \"1234\"\n\"ABC123\": \"ABC\" \"123\"\n\"AB12\": \"AB\" \"12\"\n</code></pre>\n"}], "owner": {"reputation": 303, "user_id": 8459186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcebb797a054839c8217b44d0f7868a9?s=128&d=identicon&r=PG&f=1", "display_name": "NickS", "link": "https://stackoverflow.com/users/8459186/nicks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1111, "favorite_count": 4, "accepted_answer_id": 51276072, "answer_count": 2, "score": 5, "last_activity_date": 1531295769, "creation_date": 1531263730, "last_edit_date": 1531295769, "question_id": 51275036, "link": "https://stackoverflow.com/questions/51275036/split-a-string-of-one-side-letters-one-side-numbers", "title": "Split a string of one side letters, one side numbers", "body": "<p>I\u2019m having a mind blank on this one. I am receiving strings of the format..\nAB1234\nABC1234\nABC123\nAB12\netc etc. Essentially, flight numbers</p>\n\n<p>They could have one or two letters and anything from 1 to 5 numbers. I want to split the string so that I end up with two strings, one with the numbers and one with the letters. </p>\n\n<p>Any ideas? I\u2019ve looked through these but can\u2019t see one that would do the job\n<a href=\"https://www.dotnetperls.com/split-go\" rel=\"nofollow noreferrer\">https://www.dotnetperls.com/split-go</a></p>\n\n<p>Update:</p>\n\n<p>Just found and will use this unless there\u2019s a better option. Delete all letters / numbers to create the strings needed <a href=\"https://golangcode.com/how-to-remove-all-non-alphanumerical-characters-from-a-string/\" rel=\"nofollow noreferrer\">https://golangcode.com/how-to-remove-all-non-alphanumerical-characters-from-a-string/</a></p>\n"}, {"tags": ["arrays", "list", "go", "interface", "micro-optimization"], "comments": [{"owner": {"reputation": 21557, "user_id": 1122270, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1ab0e19086582d27abe75b0635f57f43?s=128&d=identicon&r=PG", "display_name": "cnst", "link": "https://stackoverflow.com/users/1122270/cnst"}, "edited": false, "score": 0, "creation_date": 1531272950, "post_id": 51274990, "comment_id": 89529933, "body": "Also tried the <code>[:]</code> trick \u2014 getting back <code>Line 38: invalid operation e.Value.([2]int)[:] (slice of unaddressable value)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1531313675, "post_id": 51276294, "comment_id": 89549431, "body": "Note that once you use <code>*[2]int</code> there is no gain over using a pointer struct: <code>*struct { key, value int }</code>, and the struct will make the code clearer."}, {"owner": {"reputation": 21557, "user_id": 1122270, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1ab0e19086582d27abe75b0635f57f43?s=128&d=identicon&r=PG", "display_name": "cnst", "link": "https://stackoverflow.com/users/1122270/cnst"}, "edited": false, "score": 0, "creation_date": 1531361508, "post_id": 51276294, "comment_id": 89570196, "body": "The problem here is efficiency.  I guess a pointer to the array would be slightly faster than a slice, but, conceptually at least, it does sound to be a bit slower than an embedded array within list.Element, esp. because of the extra garbage collection involved, imho.  Does this answer suggest that there is really no way to modify an embedded array within list.Element itself?  That would seem like a rather arbitrary restriction without any good rationale that I can think of."}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 21557, "user_id": 1122270, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1ab0e19086582d27abe75b0635f57f43?s=128&d=identicon&r=PG", "display_name": "cnst", "link": "https://stackoverflow.com/users/1122270/cnst"}, "edited": false, "score": 0, "creation_date": 1531365573, "post_id": 51276294, "comment_id": 89570980, "body": "@cnst: I edited my answer to expand on why it does not work when using non-reference values."}, {"owner": {"reputation": 21557, "user_id": 1122270, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1ab0e19086582d27abe75b0635f57f43?s=128&d=identicon&r=PG", "display_name": "cnst", "link": "https://stackoverflow.com/users/1122270/cnst"}, "edited": false, "score": 0, "creation_date": 1531408525, "post_id": 51276294, "comment_id": 89594934, "body": "@eugenioy, oh, i see \u2014 the assertion creating a copy, now that starts to make at least some sense why no combination of dereferencing would work.  Now the only part left is whether there&#39;s a way to access any of this without an assertion, or to modify values in any other way (apart from making your own list implementation, of course)?  Otherwise, this still seems like a major performance limitation without any good rationale behind it."}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 21557, "user_id": 1122270, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1ab0e19086582d27abe75b0635f57f43?s=128&d=identicon&r=PG", "display_name": "cnst", "link": "https://stackoverflow.com/users/1122270/cnst"}, "edited": false, "score": 0, "creation_date": 1531415416, "post_id": 51276294, "comment_id": 89598895, "body": "@cnst, since it is stored as an &quot;interface{}&quot; there is no way to treat it as an array other than by type asserting. You could investigate around reflection and/or using functionality on the &quot;unsafe&quot; package, but all that might be more complex (and perhaps even less efficient) than just implementing your own list."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 2, "last_activity_date": 1531365491, "last_edit_date": 1531365491, "creation_date": 1531275248, "answer_id": 51276294, "question_id": 51274990, "link": "https://stackoverflow.com/questions/51274990/modify-fixed-size-array-within-list-element/51276294#51276294", "title": "Modify fixed-size array within List Element", "body": "<p>As you already noted:</p>\n\n<blockquote>\n  <p>I guess makes perfect sense, since slices are based on references, whereas fixed-size arrays are based on copied values</p>\n</blockquote>\n\n<p>So if you want to make this work, you'll need to use references to your fixed-size arrays by storing <strong>pointers</strong> to the arrays instead of array values.</p>\n\n<p>That way, you'll be able to modify the underlying array through the list element.</p>\n\n<p>See here for a simple example:</p>\n\n<pre><code>package main\n\nimport (\n    \"container/list\"\n    \"fmt\"\n)\n\nfunc main() {\n\n    l := list.New()\n\n    // create a fixed size array and initialize it\n    var arr [2]int\n    arr[0] = 1\n    arr[1] = 2\n    // push a pointer to the array into the list\n    elem := l.PushFront(&amp;arr)\n    // modify the stored array\n    elem.Value.(*[2]int)[0] = 3\n    // print the element from iterating the list\n    for e := l.Front(); e != nil; e = e.Next() {\n        fmt.Println(e.Value)\n    }\n    // print the underlying array, both are modified\n    fmt.Println(arr)\n\n}\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>Note that this behaviour is not something specific to this list implementation, but rather related how type assertions work in the language itself.</p>\n\n<p>See here:</p>\n\n<p><a href=\"https://golang.org/doc/effective_go.html#interface_conversions\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#interface_conversions</a></p>\n\n<p>Quoting from that section (and adding emphasis of my own):</p>\n\n<blockquote>\n  <p>The syntax borrows from the clause opening a type switch, but with an explicit type rather than the type keyword: <code>value.(typeName)</code> and <strong>the result is a new value</strong> with the static type typeName.</p>\n</blockquote>\n\n<p>When using reference types, copying the value does not affect you cause copying a pointer value ends up allowing you to change the same underlying reference.</p>\n\n<p>But when the array is a value itself, it does not make sense to assign to the copy. When you try to modify the array directly (without assigning the type assertion to a variable) Go would even catch this at compile time so that you don't assign to this \"temporary\" copy which would obviously be a mistake. That's how you got all your syntax errors when trying to do this.</p>\n\n<p>To overcome this (if you don't want to use pointers) one possibility might be for you to implement your own <code>list</code>, borrowing from the implementation you are using but making your <code>Element</code>'s value an explicit <code>[2]int</code> instead of an interface.</p>\n\n<p>That would remove the need to make the type assertion and you'll be able to modify the underlying array.</p>\n"}], "owner": {"reputation": 21557, "user_id": 1122270, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1ab0e19086582d27abe75b0635f57f43?s=128&d=identicon&r=PG", "display_name": "cnst", "link": "https://stackoverflow.com/users/1122270/cnst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1531365491, "creation_date": 1531263354, "last_edit_date": 1531295784, "question_id": 51274990, "link": "https://stackoverflow.com/questions/51274990/modify-fixed-size-array-within-list-element", "title": "Modify fixed-size array within List Element", "body": "<p>I'm doing a micro-optimisation of my LRU cache solution in Golang where I'm using <a href=\"https://golang.org/pkg/container/list/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/container/list/</a>.  My solution works by having a <code>map[int]*list.Element</code>, where each <code>list.List</code> <code>list.Element</code> is <code>[]int</code>, with <code>[0]</code> being key, and <code>[1]</code> being value.</p>\n\n<p>I'm trying to move from <code>[]int</code> to <code>[2]int</code> for my optimisation, but I'm then running into the issue that modifying the fixed-size array, after <code>ee := e.Value.([2]int)</code> (note the <code>[2]int</code> type for fixed-size array), is no longer modifying the underlying values in the <code>list.Element</code>, unlike was the case w/ <code>ee := e.Value.([]int)</code> (note the <code>[]int</code> type), which I guess makes perfect sense, since slices are based on references, whereas fixed-size arrays are based on copied values.</p>\n\n<p>I've tried stuff like <code>e.Value.([2]int)[1] = \u2026</code>, as well as various combinations with <code>:= &amp;e.Value\u2026</code>, and casting from <code>[2]int</code> to <code>[]int</code>, but it all results in complier errors.</p>\n\n<p>Q: <strong><em>Is there no way to use the <code>container/list</code> with an embedded array, and perform modifications of said fixed-size array in-place?</em></strong></p>\n"}, {"tags": ["go", "google-analytics-firebase"], "comments": [{"owner": {"reputation": 594, "user_id": 3689818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P159Y.jpg?s=128&g=1", "display_name": "Kevin Ard", "link": "https://stackoverflow.com/users/3689818/kevin-ard"}, "edited": false, "score": 0, "creation_date": 1531261446, "post_id": 51274525, "comment_id": 89527572, "body": "Also worth noting: I&#39;m nowhere remotely close to the rate limit. I do see a pretty consistent trend in the console of a successful call to compute (also authorized), but no subsequent calls to analytics, and no errors from either (these, from the console dashboard)"}], "answers": [{"tags": [], "owner": {"reputation": 594, "user_id": 3689818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P159Y.jpg?s=128&g=1", "display_name": "Kevin Ard", "link": "https://stackoverflow.com/users/3689818/kevin-ard"}, "is_accepted": false, "score": 0, "last_activity_date": 1531305705, "creation_date": 1531305705, "answer_id": 51283420, "question_id": 51274525, "link": "https://stackoverflow.com/questions/51274525/can-any-other-factors-cause-google-apis-to-respond-with-403-api-hasnt-been-us/51283420#51283420", "title": "Can any other factors cause google apis to respond with &quot;403: API hasn&#39;t been used&quot;", "body": "<p>I think I found it, and it <em>sort of</em> comes down to a version mismatch: I found a new API in the console named \"Google Analytics Reporting API\" for v4, which is <em>not</em> \"Analytics API\" that I'd been using. </p>\n\n<p>It's a little confusing because I was trusting the auth link in the error message, which took me to the already-authorized v3 API. At the same time, I feel like this would have been a non-issue if I'd read the migration docs more closely. </p>\n"}], "owner": {"reputation": 594, "user_id": 3689818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P159Y.jpg?s=128&g=1", "display_name": "Kevin Ard", "link": "https://stackoverflow.com/users/3689818/kevin-ard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 21, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1531305705, "creation_date": 1531260273, "last_edit_date": 1531260758, "question_id": 51274525, "link": "https://stackoverflow.com/questions/51274525/can-any-other-factors-cause-google-apis-to-respond-with-403-api-hasnt-been-us", "title": "Can any other factors cause google apis to respond with &quot;403: API hasn&#39;t been used&quot;", "body": "<p>I'm building a Go client service for google analytics reporting v4, but my report calls respond with the 403 error re: unused API, with a link in the err to auth the api. </p>\n\n<p>I'm using the precise same service json, view id, etc in a redash data source though with no problem. </p>\n\n<p>Clearly, the API is authorized. \nAre there any other factors at play, perhaps in the go client or a version mismatch (redash using v3, vs go using v4)?</p>\n\n<p>Worth noting: </p>\n\n<ul>\n<li><p>when I go through the motions to authorize the api, even if i try to auth-cycle it (turn it off and on), console.google gives me a ui error re: blank referrals are ignored. </p></li>\n<li><p>the acct and project are definitely linked correctly (per the auth link taking me to right project id)</p></li>\n</ul>\n"}, {"tags": ["json", "go", "yaml"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1531256534, "post_id": 51273806, "comment_id": 89525851, "body": "So you are trying to parse YAML with a JSON parser, right?"}, {"owner": {"reputation": 1106, "user_id": 3929933, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dBdMB.jpg?s=128&g=1", "display_name": "Moshe Shmukler", "link": "https://stackoverflow.com/users/3929933/moshe-shmukler"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1531256666, "post_id": 51273806, "comment_id": 89525906, "body": "I use a library, if you will, converting <code>yaml</code> into <code>JSON</code>. This is not the problem. Is everything correct as far as my structures?"}, {"owner": {"reputation": 408, "user_id": 2234099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/678915aaa580bada8ed32e01000274c2?s=128&d=identicon&r=PG", "display_name": "gngchrs", "link": "https://stackoverflow.com/users/2234099/gngchrs"}, "edited": false, "score": 3, "creation_date": 1531256956, "post_id": 51273806, "comment_id": 89526029, "body": "Which library are you using, it would be more helpful to paste in the converted json, or use a yaml parser directly such as <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">github.com/go-yaml/yaml</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1531257658, "post_id": 51273806, "comment_id": 89526307, "body": "Show the JSON, the full error returned from parsing the JSON and the code used to parse the JSON."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1531259162, "post_id": 51273806, "comment_id": 89526858, "body": "In ExampleSpec Command, Image, and Name should not be <code>[]string</code> but <code>string</code>. <a href=\"https://play.golang.org/p/J8yfhP5tJ3O\" rel=\"nofollow noreferrer\">play.golang.org/p/J8yfhP5tJ3O</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1106, "user_id": 3929933, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dBdMB.jpg?s=128&g=1", "display_name": "Moshe Shmukler", "link": "https://stackoverflow.com/users/3929933/moshe-shmukler"}, "edited": false, "score": 0, "creation_date": 1531260190, "post_id": 51274252, "comment_id": 89527214, "body": "You are correct about the Kubernetes. Neither <code>[&quot;..&quot;]</code>, nor <code>&quot;&quot;</code> helped. Still getting the same error: <code>panic: failed to decode json data with gvk(backend.example.com&#47;v1alpha1, Kind=Example): v1alpha1.Example.Spec: v1alpha1.ExampleSpec.Pods: []v1alpha1.ExamplePod: v1alpha1.ExamplePod.Command: []string: decode slice: expect [ or n, but found &quot;, error found in #10 byte of ...|command&quot;:&quot;npm run st|..., bigger context ...|mos&quot;,&quot;singular&quot;:&quot;solar-demo&quot;},&quot;pods&quot;:[{&quot;command&quot;:&quot;npm run start-api&quot;,&quot;image&quot;:&quot;shmukler&#47;docker_solar-|... [recovered]</code>"}, {"owner": {"reputation": 1589, "user_id": 2983542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4840fe7bdf44e6d7dea4ceb828ac70b5?s=128&d=identicon&r=PG&f=1", "display_name": "PhilipGough", "link": "https://stackoverflow.com/users/2983542/philipgough"}, "reply_to_user": {"reputation": 1106, "user_id": 3929933, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dBdMB.jpg?s=128&g=1", "display_name": "Moshe Shmukler", "link": "https://stackoverflow.com/users/3929933/moshe-shmukler"}, "edited": false, "score": 1, "creation_date": 1531286167, "post_id": 51274252, "comment_id": 89532910, "body": "Can you edit your question and update the yaml and go code to exactly what you have now?"}], "tags": [], "owner": {"reputation": 1589, "user_id": 2983542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4840fe7bdf44e6d7dea4ceb828ac70b5?s=128&d=identicon&r=PG&f=1", "display_name": "PhilipGough", "link": "https://stackoverflow.com/users/2983542/philipgough"}, "is_accepted": false, "score": 2, "last_activity_date": 1531298850, "last_edit_date": 1531298850, "creation_date": 1531258684, "answer_id": 51274252, "question_id": 51273806, "link": "https://stackoverflow.com/questions/51273806/go-json-parsing-error/51274252#51274252", "title": "Go JSON parsing error", "body": "<p>Assuming your yaml file is a definition for a Kubernetes object, which it looks like it is, your command is a slice of string so should, in the yaml  template be <code>command: [\"some string\"]</code>. This should parse correctly.</p>\n\n<p>However if you are attempting to produce a Pod specification. Then this looks incorrect regardless. Command and Args should probably be different properties. <a href=\"https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/\" rel=\"nofollow noreferrer\">See K8 doc</a>.</p>\n\n<p>Given what I have just said, I have expanded on and modified your example slightly and you can see that here <a href=\"https://play.golang.org/p/usS06f_H3NN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/usS06f_H3NN</a>. Even if it is not exactly what you need you should be able to modify it now accordingly.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 3, "last_activity_date": 1531279412, "last_edit_date": 1531279412, "creation_date": 1531259278, "answer_id": 51274346, "question_id": 51273806, "link": "https://stackoverflow.com/questions/51273806/go-json-parsing-error/51274346#51274346", "title": "Go JSON parsing error", "body": "<p>The JSON is invalid.  Replace <code>\u201d</code> with <code>\"</code> and add surrounding <code>{}</code>.</p>\n\n<p>Change type of ExamplePod fields to string:</p>\n\n<pre><code>type ExamplePod struct {\n    Name    string `json:\"name\"`\n    Image   string `json:\"image\"`\n    Port    int32    `json:\"port\"`\n    Command string `json:\"command\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/pgHY8Lx_bZQ\" rel=\"nofollow noreferrer\">Playground Example</a></p>\n"}, {"tags": [], "owner": {"reputation": 1106, "user_id": 3929933, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dBdMB.jpg?s=128&g=1", "display_name": "Moshe Shmukler", "link": "https://stackoverflow.com/users/3929933/moshe-shmukler"}, "is_accepted": true, "score": 0, "last_activity_date": 1531387585, "creation_date": 1531387585, "answer_id": 51301922, "question_id": 51273806, "link": "https://stackoverflow.com/questions/51273806/go-json-parsing-error/51301922#51301922", "title": "Go JSON parsing error", "body": "<p>Using the suggestions from both offered answers changed the YAML to:</p>\n\n<pre><code>containers:\n- name: api\n  image: \"shmukler/docker_solar-api\"\n  port: 3000\n  command: [\"npm\", \"run\", \"start-api\"]\n- name: service\n  image: \"shmukler/docker_solar-svc\"\n  port: 3001\n  command: [\"npm\", \"run\", \"start-solar-svc\"]\n</code></pre>\n\n<p>Then, updated definitions to:</p>\n\n<pre><code>type Spec struct {\n    Size       int32               `json:\"size\"`\n    Containers []Container `json:\"containers\"`\n}\ntype Status struct {\n    Nodes []string `json:\"nodes\"`\n}\ntype Container struct {\n    Name    string   `json:\"name\"`\n    Image   string   `json:\"image\"`\n    Port    int32    `json:\"port\"`\n    Command []string `json:\"command\"`\n}\n</code></pre>\n\n<p>That finally worked fine.</p>\n\n<p>Thank you for the answers, helped me to understand how Golang type definitions work.</p>\n"}], "owner": {"reputation": 1106, "user_id": 3929933, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/dBdMB.jpg?s=128&g=1", "display_name": "Moshe Shmukler", "link": "https://stackoverflow.com/users/3929933/moshe-shmukler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1797, "favorite_count": 0, "accepted_answer_id": 51301922, "answer_count": 3, "score": 1, "last_activity_date": 1531387585, "creation_date": 1531256300, "last_edit_date": 1531258594, "question_id": 51273806, "link": "https://stackoverflow.com/questions/51273806/go-json-parsing-error", "title": "Go JSON parsing error", "body": "<p>I am writing my first program in Golang, or rather modifying a template, if you will. Want to parse values from a yaml file.</p>\n\n<pre><code>apiVersion: \"backend.example.com/v1alpha1\"\nkind: \"Example\"\nmetadata:\n  name: \"solar-demo\"\nspec:\n  size: 2\n  group: backend.example.com\n  names:\n    kind: Example\n    listKind: ExampleList\n    plural: solar-demos\n    singular: solar-demo\n  scope: Namespaced\n  version: v1alpha1\n  pods:\n    - name: api\n      image: \"shmukler/docker_solar-api\"\n      port: 3000\n      command: '{\"npm\", \"run\", \"start-api\"}'\n    - name: service\n      image: \"shmukler/docker_solar-svc\"\n      port: 3001\n      command: '{\"npm\", \"run\", \"start-solar-svc\"}'\n</code></pre>\n\n<p>To parse-out variables, I do:</p>\n\n<pre><code>type Example struct {\n    metav1.TypeMeta   `json:\",inline\"`\n    metav1.ObjectMeta `json:\"metadata\"`\n    Spec              ExampleSpec   `json:\"spec\"`\n    Status            ExampleStatus `json:\"status,omitempty\"`\n}\ntype ExampleSpec struct {\n    Size int32 `json:\"size\"`\n    //  Pods []ExamplePod `json:\"pods\"`\n}\ntype ExampleStatus struct {\n    Nodes []string `json:\"nodes\"`\n}\ntype ExamplePod struct {\n    Name    []string `json:\"name\"`\n    Image   []string `json:\"image\"`\n    Port    int32    `json:\"port\"`\n    Command []string `json:\"command\"`\n}\n</code></pre>\n\n<p>If I comment out the <code>Pods []ExamplePod</code> line, the code works albeit without parsing the Pods array. If I leave it in, there is an error, as soon as I pass the <code>yaml</code> document - <code>Observed a panic: &amp;errors.errorString{s:\"failed to decode json data with gvk...</code></p>\n\n<p>I want to stick <code>pods</code> into an array of structures of the type <code>ExamplePod</code>. </p>\n\n<p>Today is my first day working with Go language. Sorry for a stupid question. My yaml, the relevant fragment in <code>JSON</code> representation.</p>\n\n<pre><code>spec\":{  \n   \"group\":\"backend.example.com\",\n   \"names\":{  \n      \"kind\u201d:\u201dExample\u201d,\n      \"listKind\u201d:\u201dExampleList\",\n      \"plural\":\"solar-demos\",\n      \"singular\":\"solar-demo\"\n   },\n   \"pods\":[  \n      {  \n         \"command\":\"{\\\"npm\\\", \\\"run\\\", \\\"start-api\\\"}\",\n         \"image\":\"shmukler/docker_solar-api\",\n         \"name\":\"api\",\n         \"port\":3000\n      },\n      {  \n         \"command\":\"{\\\"npm\\\", \\\"run\\\", \\\"start-solar-svc\\\"}\",\n         \"image\":\"shmukler/docker_solar-svc\",\n         \"name\":\"service\",\n         \"port\":3001\n      }\n   ],\n   \"scope\":\"Namespaced\",\n   \"size\":2,\n   \"version\":\"v1alpha1\"\n}\n</code></pre>\n\n<p>I am able to get <code>example.Spec.Size</code> just fine. What I am missing is the <code>pods</code> array.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1531252626, "post_id": 51272978, "comment_id": 89524226, "body": "You don&#39;t, you can only call <code>m.Run()</code>. You have to log it yourself."}], "answers": [{"tags": [], "owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "is_accepted": false, "score": 1, "last_activity_date": 1531604272, "creation_date": 1531604272, "answer_id": 51343574, "question_id": 51272978, "link": "https://stackoverflow.com/questions/51272978/logging-a-line-in-testing-m/51343574#51343574", "title": "Logging a Line in *testing.M", "body": "<p>A look at the documentation of <a href=\"https://golang.org/pkg/testing/#M\" rel=\"nofollow noreferrer\">package testing</a> shows that type <code>testing.M</code> has no logging method associated with it. You should do logging using <a href=\"https://golang.org/pkg/log/\" rel=\"nofollow noreferrer\">package log</a> (as already mentioned in the comments).</p>\n"}], "owner": {"reputation": 3465, "user_id": 1342445, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/7ZNEn.jpg?s=128&g=1", "display_name": "pnovotnak", "link": "https://stackoverflow.com/users/1342445/pnovotnak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1557384508, "creation_date": 1531252088, "question_id": 51272978, "link": "https://stackoverflow.com/questions/51272978/logging-a-line-in-testing-m", "title": "Logging a Line in *testing.M", "body": "<p>In test functions that take *testing.T or *testing.B as a parameter, it's easy to log a line:</p>\n\n<pre><code>func TestMyFunc(t *testing.T) {\n    t.Log(\"hello testing\"\n    ...\n}\n</code></pre>\n\n<p>How do you do this in a setup function that takes *testing.M as a parameter?</p>\n\n<pre><code>func TestMain(m *testing.M) {\n    ???\n}\n</code></pre>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1531252147, "post_id": 51272973, "comment_id": 89524028, "body": "where is <code>users</code> define?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1531255610, "post_id": 51272973, "comment_id": 89525481, "body": "Don&#39;t use a database for your tests. Use a mock. <a href=\"https://github.com/DATA-DOG/go-sqlmock\" rel=\"nofollow noreferrer\">go-sqlmock</a> is the one I use. Anything else isn&#39;t actually a unit test."}, {"owner": {"reputation": 224, "user_id": 3385334, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/98c536002b18fee5a9df9f079e743f09?s=128&d=identicon&r=PG", "display_name": "macintoshPrime", "link": "https://stackoverflow.com/users/3385334/macintoshprime"}, "edited": false, "score": 0, "creation_date": 1531321553, "post_id": 51272973, "comment_id": 89555467, "body": "Thanks Flimzy I will take a look at sqlmock. Appreciate the advice."}], "answers": [{"comments": [{"owner": {"reputation": 224, "user_id": 3385334, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/98c536002b18fee5a9df9f079e743f09?s=128&d=identicon&r=PG", "display_name": "macintoshPrime", "link": "https://stackoverflow.com/users/3385334/macintoshprime"}, "edited": false, "score": 0, "creation_date": 1531253217, "post_id": 51273074, "comment_id": 89524478, "body": "I will give that a try tomorrow. Sounds like a good way to go. As the dB is just spun up in a container whenever the tests are run so the data is unimportant. Thanks! I\u2019ll let you know how it goes."}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": true, "score": 1, "last_activity_date": 1531269042, "last_edit_date": 1531269042, "creation_date": 1531252512, "answer_id": 51273074, "question_id": 51272973, "link": "https://stackoverflow.com/questions/51272973/database-unit-test/51273074#51273074", "title": "Database unit test", "body": "<p>It really depends, there are so many ways of addressing this based on your risk level and the amount of time you want to invest to mitigate those risks.</p>\n\n<ul>\n<li>You could write a unit test that asserts your able to detect and act on users logic (ie seeding when empty and ignoring when full) without any database.</li>\n<li>If you would like to test the logic as well as your programs ability to speak to mysql correctly through the <code>gorm</code> library you could:\n\n<ul>\n<li>Have a test where you call <code>Seed</code> with no users in the DB, after calling it your test could select from <code>Users</code> and make sure there are the expected entries created from <code>len(users) == 0</code> conditional</li>\n<li>Have a test where the test creates a single entry and calls <code>Seed</code>, after which asserting that underlying tables are empty.</li>\n</ul></li>\n</ul>\n\n<hr>\n\n<p>It can get more complicated.  If <code>Seed</code> is selecting a subset of data than your test could insert 2 users, one that qualifies and one that doesnt', and make sure that no new users are <code>Seed</code>ed.  </p>\n"}], "owner": {"reputation": 224, "user_id": 3385334, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/98c536002b18fee5a9df9f079e743f09?s=128&d=identicon&r=PG", "display_name": "macintoshPrime", "link": "https://stackoverflow.com/users/3385334/macintoshprime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1111, "favorite_count": 0, "accepted_answer_id": 51273074, "answer_count": 1, "score": 0, "last_activity_date": 1562621599, "creation_date": 1531252042, "last_edit_date": 1562621599, "question_id": 51272973, "link": "https://stackoverflow.com/questions/51272973/database-unit-test", "title": "Database unit test", "body": "<p>I am hoping to get some advice on a unit test I am writing for to test some db entries.</p>\n\n<p>The function I am testing seeds the database if no records are found.</p>\n\n<pre><code>func Seed(db *gorm.DB) {\n    var data []Data\n    db.Find(&amp;data)\n\n    if len(data) == 0 {\n      // do seed default data\n    }\n\n}\n</code></pre>\n\n<p>What I can't quite seem to get going is the test for that if len test. I am using a test db so I can nuke it whenever so it is not an issue if I just need to force an empty DB on the function. </p>\n\n<p>The function itself works and I just want to make sure I get that covered.</p>\n\n<p>Any advice would be great.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "swagger", "swagger-2.0"], "comments": [{"owner": {"reputation": 766, "user_id": 235521, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/818c46d7f6ebecfaf8f2c910fb3a1f2f?s=128&d=identicon&r=PG", "display_name": "kars7e", "link": "https://stackoverflow.com/users/235521/kars7e"}, "edited": false, "score": 0, "creation_date": 1531293801, "post_id": 51272474, "comment_id": 89536376, "body": "Is your <code>&#47;PATH_TO_PROJECT&#47;foo&#47;bar.go</code> in the <code>$GOPATH</code>?"}, {"owner": {"reputation": 911, "user_id": 4067157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h1XC6.png?s=128&g=1", "display_name": "Yogi", "link": "https://stackoverflow.com/users/4067157/yogi"}, "reply_to_user": {"reputation": 766, "user_id": 235521, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/818c46d7f6ebecfaf8f2c910fb3a1f2f?s=128&d=identicon&r=PG", "display_name": "kars7e", "link": "https://stackoverflow.com/users/235521/kars7e"}, "edited": false, "score": 0, "creation_date": 1531313152, "post_id": 51272474, "comment_id": 89549048, "body": "yeah @kars7e!! Added all paths in gopath!! For an example, <code>&#47;PATH_TO_PROJECT&#47;</code> is in <code>$GOPATH</code> and <code>&#47;PATH_TO_PROJECT&#47;foo&#47;</code> is in <code>$GOPATH</code>. But not that particular file -&gt; <code>&#47;PATH_TO_PROJECT&#47;foo&#47;bar.go</code>."}], "answers": [{"comments": [{"owner": {"reputation": 911, "user_id": 4067157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h1XC6.png?s=128&g=1", "display_name": "Yogi", "link": "https://stackoverflow.com/users/4067157/yogi"}, "edited": false, "score": 0, "creation_date": 1531321506, "post_id": 51287999, "comment_id": 89555431, "body": "Function is executing as u described. But i want to use goswagger within that!! That&#39;s my issue."}], "tags": [], "owner": {"reputation": 369, "user_id": 4444629, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/wZfiH.png?s=128&g=1", "display_name": "musale", "link": "https://stackoverflow.com/users/4444629/musale"}, "is_accepted": false, "score": 0, "last_activity_date": 1531319032, "creation_date": 1531319032, "answer_id": 51287999, "question_id": 51272474, "link": "https://stackoverflow.com/questions/51272474/goswagger-implementation-for-imported-packages/51287999#51287999", "title": "GOSwagger implementation for imported packages", "body": "<p>Ensure in <code>foo/bar.go</code> the package declared is <code>package foo</code>. Then the function you want to access in the <code>main.go</code> file should start with a capital letter. i.e.</p>\n\n<p><code>foo/bar.go</code></p>\n\n<pre><code>package foo\n\n// PrintBar with extra txt\nfunc PrintBar(txt string) string {\n    return \"bar with txt \" + txt\n}\n</code></pre>\n\n<p>Then in <code>main.go</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/username/project/foo\"\n)\n\nfunc main() {\n    fmt.Println(\"in main.go\")\n    fmt.Println(foo.PrintBar(\"from main.go\"))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 766, "user_id": 235521, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/818c46d7f6ebecfaf8f2c910fb3a1f2f?s=128&d=identicon&r=PG", "display_name": "kars7e", "link": "https://stackoverflow.com/users/235521/kars7e"}, "is_accepted": false, "score": 0, "last_activity_date": 1531343202, "creation_date": 1531343202, "answer_id": 51294161, "question_id": 51272474, "link": "https://stackoverflow.com/questions/51272474/goswagger-implementation-for-imported-packages/51294161#51294161", "title": "GOSwagger implementation for imported packages", "body": "<p>Try enabling Debug mode for swagger by adding <code>DEBUG=1</code> in front of your swagger command. This should print you what are the paths considered.</p>\n\n<p>If you look at the <a href=\"https://github.com/go-swagger/go-swagger/blob/df3d7a3b7f108ca7e36b90e75466acb3165eec51/scan/schema.go#L882:20\" rel=\"nofollow noreferrer\">source code where this error is thrown</a>, you will see this error only happens when file is not in the <code>$GOPATH</code>. Double check that you have the program under <code>$GOPATH/src</code>.  </p>\n"}], "owner": {"reputation": 911, "user_id": 4067157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h1XC6.png?s=128&g=1", "display_name": "Yogi", "link": "https://stackoverflow.com/users/4067157/yogi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1531343202, "creation_date": 1531249671, "question_id": 51272474, "link": "https://stackoverflow.com/questions/51272474/goswagger-implementation-for-imported-packages", "title": "GOSwagger implementation for imported packages", "body": "<p>I'm created a project structure like,</p>\n\n<p><code>main.go</code> and <code>foo/bar.go</code></p>\n\n<p>In main.go, imported foo package and used as foo.functionName(). Now i need to write swagger document in bar.go. When i did, ended with the following error message,</p>\n\n<pre><code>unable to determine package for /PATH_TO_PROJECT/foo/bar.go\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-platform"], "comments": [{"owner": {"reputation": 877, "user_id": 2049273, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/794735d9719e9edace9699928c9a45a0?s=128&d=identicon&r=PG", "display_name": "swigganicks", "link": "https://stackoverflow.com/users/2049273/swigganicks"}, "edited": false, "score": 2, "creation_date": 1531251748, "post_id": 51272392, "comment_id": 89523888, "body": "App Engine Standard scales down to 0 instances by default. If you remove the <code>automatic_scaling</code> from your <code>app.yaml</code> file and redeploy, do you still get instances spawning (like a couple of minutes after initial deployment)?"}, {"owner": {"reputation": 642, "user_id": 3932734, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MiRyl.png?s=128&g=1", "display_name": "Justin Tamblyn", "link": "https://stackoverflow.com/users/3932734/justin-tamblyn"}, "reply_to_user": {"reputation": 877, "user_id": 2049273, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/794735d9719e9edace9699928c9a45a0?s=128&d=identicon&r=PG", "display_name": "swigganicks", "link": "https://stackoverflow.com/users/2049273/swigganicks"}, "edited": false, "score": 0, "creation_date": 1531252660, "post_id": 51272392, "comment_id": 89524238, "body": "Afraid no luck. Remove &quot;automatic_scaling:&quot; and everything below it. Redeployed and the config now reads:  ` automatic_scaling:   min_idle_instances: automatic   max_idle_instances: automatic   min_pending_latency: automatic   max_pending_latency: automatic `  It seems to default it back to automatic"}, {"owner": {"reputation": 642, "user_id": 3932734, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MiRyl.png?s=128&g=1", "display_name": "Justin Tamblyn", "link": "https://stackoverflow.com/users/3932734/justin-tamblyn"}, "reply_to_user": {"reputation": 877, "user_id": 2049273, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/794735d9719e9edace9699928c9a45a0?s=128&d=identicon&r=PG", "display_name": "swigganicks", "link": "https://stackoverflow.com/users/2049273/swigganicks"}, "edited": false, "score": 0, "creation_date": 1531253760, "post_id": 51272392, "comment_id": 89524694, "body": "I threw 1000 requests at the service an the cloud console confirms that there is one instance running. I&#39;ll wait an hour (or a few) and see if it scales to 0"}, {"owner": {"reputation": 642, "user_id": 3932734, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MiRyl.png?s=128&g=1", "display_name": "Justin Tamblyn", "link": "https://stackoverflow.com/users/3932734/justin-tamblyn"}, "reply_to_user": {"reputation": 877, "user_id": 2049273, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/794735d9719e9edace9699928c9a45a0?s=128&d=identicon&r=PG", "display_name": "swigganicks", "link": "https://stackoverflow.com/users/2049273/swigganicks"}, "edited": false, "score": 0, "creation_date": 1531255500, "post_id": 51272392, "comment_id": 89525420, "body": "It looks like there is still an instance up. However, the &quot;Billed Instance Estimate&quot; is currently 0. I&#39;m hoping that this means what I think it means.  Thanks for the help @swigganicks"}, {"owner": {"reputation": 642, "user_id": 3932734, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MiRyl.png?s=128&g=1", "display_name": "Justin Tamblyn", "link": "https://stackoverflow.com/users/3932734/justin-tamblyn"}, "reply_to_user": {"reputation": 877, "user_id": 2049273, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/794735d9719e9edace9699928c9a45a0?s=128&d=identicon&r=PG", "display_name": "swigganicks", "link": "https://stackoverflow.com/users/2049273/swigganicks"}, "edited": false, "score": 0, "creation_date": 1531291231, "post_id": 51272392, "comment_id": 89535005, "body": "@swigganicks could you create that as an answer so that I can &#39;tick it&#39;"}], "answers": [{"comments": [{"owner": {"reputation": 5026, "user_id": 815742, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c155243169db74a7787bab9d57a1c3d6?s=128&d=identicon&r=PG", "display_name": "fumoboy007", "link": "https://stackoverflow.com/users/815742/fumoboy007"}, "edited": false, "score": 0, "creation_date": 1553214867, "post_id": 51291372, "comment_id": 97311481, "body": "There is no default value specified for <code>min_idle_instances</code>."}, {"owner": {"reputation": 623, "user_id": 7299245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2370b2102321fe7fc9d42e540bad7f71?s=128&d=identicon&r=PG&f=1", "display_name": "ozo", "link": "https://stackoverflow.com/users/7299245/ozo"}, "edited": false, "score": 0, "creation_date": 1555111067, "post_id": 51291372, "comment_id": 98009279, "body": "@swigganicks Shouldn&#39;t you see two instances? because it&#39;s the default value."}, {"owner": {"reputation": 2127, "user_id": 3754871, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100000313411140/picture?type=large", "display_name": "zardilior", "link": "https://stackoverflow.com/users/3754871/zardilior"}, "reply_to_user": {"reputation": 623, "user_id": 7299245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2370b2102321fe7fc9d42e540bad7f71?s=128&d=identicon&r=PG&f=1", "display_name": "ozo", "link": "https://stackoverflow.com/users/7299245/ozo"}, "edited": false, "score": 0, "creation_date": 1562171466, "post_id": 51291372, "comment_id": 100297440, "body": "@Ale default for flex env not standard"}, {"owner": {"reputation": 6746, "user_id": 1690078, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/34cd353216b1a04b89853c96ab22eab2?s=128&d=identicon&r=PG", "display_name": "Clyde", "link": "https://stackoverflow.com/users/1690078/clyde"}, "edited": false, "score": 0, "creation_date": 1581979312, "post_id": 51291372, "comment_id": 106611077, "body": "_  After deploying, you should only have at most 1 instances showing up, but you will be billed for usage which is 0. _ That&#39;s not the case if you are running an instance class other than F1. Anything larger than that will still result in instance hours being billed since the 28 hours free is only for an F1 instance."}], "tags": [], "owner": {"reputation": 877, "user_id": 2049273, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/794735d9719e9edace9699928c9a45a0?s=128&d=identicon&r=PG", "display_name": "swigganicks", "link": "https://stackoverflow.com/users/2049273/swigganicks"}, "is_accepted": true, "score": 7, "last_activity_date": 1537343470, "last_edit_date": 1537343470, "creation_date": 1531330671, "answer_id": 51291372, "question_id": 51272392, "link": "https://stackoverflow.com/questions/51272392/how-to-scale-down-to-0-instances-in-gae-standard-go/51291372#51291372", "title": "How to scale down to 0 instances in GAE Standard Go", "body": "<p>App Engine <em>standard environment</em> scales down to 0 instance by default so you shouldn't have to specify it in your app.yaml. You only need to specify the values you want to change in the automatic scaling. Refer to the <a href=\"https://cloud.google.com/appengine/docs/standard/go/config/appref\" rel=\"nofollow noreferrer\">documentation</a> for a list of default scaling values under <code>automatic_scaling</code>. </p>\n\n<p>After deploying, you should only have at most 1 instances showing up, but you will be billed for usage which is 0. </p>\n\n<p>(Also note that this does <em>not</em> apply to a App Engine Flexible environment)</p>\n"}], "owner": {"reputation": 642, "user_id": 3932734, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MiRyl.png?s=128&g=1", "display_name": "Justin Tamblyn", "link": "https://stackoverflow.com/users/3932734/justin-tamblyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3180, "favorite_count": 2, "accepted_answer_id": 51291372, "answer_count": 1, "score": 8, "last_activity_date": 1537343470, "creation_date": 1531249318, "question_id": 51272392, "link": "https://stackoverflow.com/questions/51272392/how-to-scale-down-to-0-instances-in-gae-standard-go", "title": "How to scale down to 0 instances in GAE Standard Go", "body": "<p>I have a deployed a Golang app to Google Cloud Platform's App Engine Standard environment.</p>\n\n<p>My app.yaml included the following lines:</p>\n\n<pre><code>  automatic_scaling:\n  min_idle_instances: 0\n  max_idle_instances: 0\n  min_pending_latency: automatic\n  max_pending_latency: automatic\n  min_instances: 0\n  max_instances: 2\n</code></pre>\n\n<p>My intention was that the app should scale down to 0 instances when idle and spawn up to 2 instances to handle incoming requests.</p>\n\n<p>After calling the service I noticed that it never scales down to 0 instances.</p>\n\n<p>I opened the service configuration in the web console and found the following:</p>\n\n<pre><code>runtime: go\napi_version: go1\nenv: standard\nthreadsafe: true\ninstance_class: F1\nhandlers:\n  - url: /penguin\n    script: _go_app\nautomatic_scaling:\n  min_idle_instances: automatic\n  max_idle_instances: automatic\n  min_pending_latency: automatic\n  max_pending_latency: automatic\n  max_instances: 2\n</code></pre>\n\n<p>Is it possible to scale App Engine Standard services down to 0 instances? What should that look like in the yaml?</p>\n"}, {"tags": ["go", "hash"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1531249310, "post_id": 51272353, "comment_id": 89522834, "body": "You have a variable named <code>hash</code> which is shadowing the package named <code>hash</code>. Also, try to avoid relative package imports."}], "answers": [{"tags": [], "owner": {"reputation": 129, "user_id": 10055037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8508b3a084f60d0277b328e0e5fc7ec?s=128&d=identicon&r=PG&f=1", "display_name": "lab0", "link": "https://stackoverflow.com/users/10055037/lab0"}, "is_accepted": false, "score": 0, "last_activity_date": 1531249870, "creation_date": 1531249870, "answer_id": 51272511, "question_id": 51272353, "link": "https://stackoverflow.com/questions/51272353/error-with-golang-undefined-type-string-has-no-field-or-method/51272511#51272511", "title": "Error with golang &quot;undefined (type string has no field or method)&quot;", "body": "<p>In main.go file Change hash variable to other name (Do not use variable with the same package name)</p>\n\n<p>thanks \"Adrian\"</p>\n"}, {"tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": true, "score": 5, "last_activity_date": 1531249881, "creation_date": 1531249881, "answer_id": 51272514, "question_id": 51272353, "link": "https://stackoverflow.com/questions/51272353/error-with-golang-undefined-type-string-has-no-field-or-method/51272514#51272514", "title": "Error with golang &quot;undefined (type string has no field or method)&quot;", "body": "<p>In <code>main</code>, your variable name <code>hash</code> contains a long string. So it shadows the package name <code>hash</code>. You should rename one or the other.</p>\n"}], "owner": {"reputation": 129, "user_id": 10055037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8508b3a084f60d0277b328e0e5fc7ec?s=128&d=identicon&r=PG&f=1", "display_name": "lab0", "link": "https://stackoverflow.com/users/10055037/lab0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10165, "favorite_count": 1, "accepted_answer_id": 51272514, "answer_count": 2, "score": 2, "last_activity_date": 1531249881, "creation_date": 1531249142, "question_id": 51272353, "link": "https://stackoverflow.com/questions/51272353/error-with-golang-undefined-type-string-has-no-field-or-method", "title": "Error with golang &quot;undefined (type string has no field or method)&quot;", "body": "<p>i use this library <a href=\"http://golang.org/x/crypto/bcrypt\" rel=\"nofollow noreferrer\">golang.org/x/crypto/bcrypt</a> to hash password and compare hash with password but I having problem see below:</p>\n\n<p>main.go file</p>\n\n<pre><code>package main\n\nimport (\n        \"./hash\"\n)\n\nfunc main() {\n        password := \"passwd\"\n        hash := \"hhhhhhhhaaaaaaaaaassssssssssshhhhhhhhhhh\"\n\n        check := hash.CheckPasswordHash(password, hash)\n}\n</code></pre>\n\n<p>hash/hash.go file</p>\n\n<pre><code>package hash\n\nimport \"golang.org/x/crypto/bcrypt\"\n\nfunc HashPassword(password string) (string, error) {\n        bytes, err := bcrypt.GenerateFromPassword([]byte(password), 14)\n\n        return string(bytes), err\n}\n\nfunc CheckPasswordHash(password, hash string) bool {\n        err := bcrypt.CompareHashAndPassword([]byte(hash), []byte(password))\n\n        return err == nil\n}\n</code></pre>\n\n<p>if you run this:</p>\n\n<pre><code>$ go run main.go\n</code></pre>\n\n<p>It will show this error:</p>\n\n<blockquote>\n  <p>./main.go:11:15: hash.CheckPasswordHash undefined (type string has no\n  field or method CheckPasswordHash)</p>\n</blockquote>\n\n<p>why this error?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 3, "creation_date": 1531247226, "post_id": 51271886, "comment_id": 89521905, "body": "How do you compile/run the program?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1531247239, "post_id": 51271886, "comment_id": 89521911, "body": "Please read through intro documentation: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">&quot;How to Write Go Code&quot;</a>, it steps through all the basics."}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 1, "creation_date": 1531247476, "post_id": 51271886, "comment_id": 89522009, "body": "<a href=\"https://stackoverflow.com/questions/28081486/golang-multiple-files-in-main-package/28081554\" title=\"golang multiple files in main package\">stackoverflow.com/questions/28081486/&hellip;</a>"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 3, "creation_date": 1531247617, "post_id": 51271886, "comment_id": 89522071, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28081486/how-can-i-go-run-a-project-with-multiple-files-in-the-main-package\">How can I &quot;go run&quot; a project with multiple files in the main package?</a>"}, {"owner": {"reputation": 412, "user_id": 6498438, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/OFuAw.png?s=128&g=1", "display_name": "trashgenerator", "link": "https://stackoverflow.com/users/6498438/trashgenerator"}, "edited": false, "score": 0, "creation_date": 1531247669, "post_id": 51271886, "comment_id": 89522094, "body": "Thanks. I run it from Goland with &quot;Run kind: file&quot;. This is the mistake"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1531252080, "post_id": 51271886, "comment_id": 89524009, "body": "You are referencing the object as <code>dto.NodeDTO</code>, but it should just be <code>NodeDTO</code>. The prefix is used to specify an item from another package, but all of your code is in <code>package main</code>. As the others already have, I would suggest you brush up on the basics of Go."}, {"owner": {"reputation": 412, "user_id": 6498438, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/OFuAw.png?s=128&g=1", "display_name": "trashgenerator", "link": "https://stackoverflow.com/users/6498438/trashgenerator"}, "edited": false, "score": 0, "creation_date": 1531281093, "post_id": 51271886, "comment_id": 89531538, "body": "Man, I&#39;m sorry - it is copy&#39;n&#39;paste bug - of course I don&#39;t use &quot;dto.&quot; when they are both in package main"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1531316534, "last_edit_date": 1531316534, "creation_date": 1531312057, "answer_id": 51285489, "question_id": 51271886, "link": "https://stackoverflow.com/questions/51271886/go-public-struct-in-another-file/51285489#51285489", "title": "Go public struct in another file", "body": "<p>You appear to have:</p>\n\n<pre><code>$ ls\ndto.go  main.go\n$ cat main.go\npackage main\n\nvar (\n    node * NodeDTO\n)\n\nfunc main() {\n    node = &amp;NodeDTO{ID: 1}\n}\n$ cat dto.go\npackage main\n\ntype NodeDTO struct {\n    ID int\n}\n$ \n</code></pre>\n\n<p>and you appear to run:</p>\n\n<pre><code>$ go run main.go\n# command-line-arguments\n./main.go:4:12: undefined: NodeDTO\n./main.go:8:13: undefined: NodeDTO\n$\n</code></pre>\n\n<p>The help for <code>go run</code> says, amongst other things:</p>\n\n<pre><code>$ go help run\nusage: go run [build flags] [-exec xprog] package [arguments...]\n\nRun compiles and runs the named main Go package.\nTypically the package is specified as a list of .go source files,\nbut it may also be an import path, file system path, or pattern\nmatching a single known package, as in 'go run .' or 'go run my/cmd'.\n</code></pre>\n\n<p>You used a list of .go source files: <code>go run main.go</code>. You listed one file. You have two files: <code>main.go</code> and <code>dto.go</code>.</p>\n\n<p>Use a complete list of .go source files:</p>\n\n<pre><code>$ go run main.go dto.go\n$ \n</code></pre>\n"}], "owner": {"reputation": 412, "user_id": 6498438, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/OFuAw.png?s=128&g=1", "display_name": "trashgenerator", "link": "https://stackoverflow.com/users/6498438/trashgenerator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 1, "accepted_answer_id": 51285489, "answer_count": 1, "score": -2, "last_activity_date": 1531316534, "creation_date": 1531247102, "last_edit_date": 1531281046, "question_id": 51271886, "link": "https://stackoverflow.com/questions/51271886/go-public-struct-in-another-file", "title": "Go public struct in another file", "body": "<p>I'm very new with GO and don't understand some basics - so I'm really don't know how to ask ask google about it. So\nI have a project with 2 files, both in package main - the root of src. One file is main.go</p>\n\n<pre><code>package main\n\nvar (\n    node * NodeDTO\n)\n\nfunc main() {\n    node = &amp;NodeDTO{ID: 1}\n}\n</code></pre>\n\n<p>And another is dto.go with</p>\n\n<pre><code>package main\n\ntype NodeDTO struct {\n    ID int\n}\n</code></pre>\n\n<p>So main.go tells me - \"undefined: NodeDTO\".\nBut if I create a dir dto near of main.go and use my NodeDTO from there like</p>\n\n<pre><code>package main\n\nimport \"another_tcp_server/dto\"\n\nvar (\n    node * dto.NodeDTO\n)\n\nfunc main() {\n    node = &amp;dto.NodeDTO{ID: 1}\n}\n</code></pre>\n\n<p>It's ok. Please tell me why this happen?</p>\n"}, {"tags": ["dictionary", "go", "configuration"], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 0, "last_activity_date": 1531297910, "creation_date": 1531297910, "answer_id": 51280768, "question_id": 51270780, "link": "https://stackoverflow.com/questions/51270780/golang-map-yaml-objects/51280768#51280768", "title": "Golang Map YAML Objects", "body": "<p>You can combine them after the loop of constructing <code>cmdMap</code>.</p>\n\n<pre><code>for vendor := range cmdMap {\n\n    // get the base name of the vendor\n    s := strings.SplitN(vender, \".\", 2)\n\n    // if vendor is a basic one, skip it.\n    if len(s) == 1 {\n        continue\n    }\n\n    // add basic cmd into the specified ones.\n    base = s[0]\n    cmdMap[vendor] = append(cmdMap[vendor], cmdMap[base]...)\n}\n</code></pre>\n\n<p>Note that <code>cmdMap[base]...</code> is a use of variadic parmaters of append. You can see more here: <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Passing_arguments_to_..._parameters</a></p>\n"}, {"tags": [], "owner": {"reputation": 766, "user_id": 235521, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/818c46d7f6ebecfaf8f2c910fb3a1f2f?s=128&d=identicon&r=PG", "display_name": "kars7e", "link": "https://stackoverflow.com/users/235521/kars7e"}, "is_accepted": true, "score": 2, "last_activity_date": 1531297992, "creation_date": 1531297992, "answer_id": 51280792, "question_id": 51270780, "link": "https://stackoverflow.com/questions/51270780/golang-map-yaml-objects/51280792#51280792", "title": "Golang Map YAML Objects", "body": "<p>I think viper is not helping you here, in the sense that viper does a lot of things you don't need, but it doesn't do one thing you could use here - clear mapping of the data. If you use the <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">yaml library</a> directly, you could declare a structure that corresponds to your data and makes it easier to understand it.</p>\n\n<p>There are several possible approaches to your problem, here is my attempt at solving it (you might need to tweak few things as I wrote it in the editor, without compiling it):</p>\n\n<pre><code>    type Data struct {\n       Cmds struct {\n         Setup map[string]interface{} `yaml:\"setup\"`\n         Config map[string][]map[string]string `yaml:\"config\"`\n         Cleanup map[string][]string `yaml:\"cleanup\"`\n       } `yaml:\"cmds\"`\n\n    }   \n\n    data := Data{}\n    err := yaml.Unmarshal([]byte(input), &amp;data)\n    if err != nil {\n            log.Fatalf(\"error: %v\", err)\n    }\n\n    setupCmds := make(map[string][]string)\n    cleanupCmds := make(map[string][]string)\n\n    result := make(map[string][]string)\n\n\n    // Prepare setup commands, grouped by vendor\n    for vendor, setupCmd := range data.Cmds.Setup {\n        setupCmds[vendor] = append(setupCmds[vendor], setupCmd)\n    }\n\n    // Prepare cleanup commands, grouped by vendor\n     for vendor, commands := range data.Cmds.Cleanup {\n        cleanupCmds[vendor] = append(cleanupCmds[vendor], commands...)\n    }\n\n    // iterate over vendors and models, combine with setup &amp; cleanup commands and store in result\n    for vendor, configCmds := range data.Cmds.Config { // vendor = string (e.g. \"cisco\"), configCmds = []map[string][string] (e.g. - basic: \"show version\")\n        // we now how many config commands there will be\n        result[vendor] = make([]string, len(configCmds))\n\n        // variantsCache will store all variants we've seen so far\n        variantsCache := make(map[string]struct{})\n        for i, model := range models { // i = int (number of command) model = map[string]string\n            // we assume \"basic\" is available for each command\n            result[vendor][i] = model[\"basic\"]\n            for variant, command := range model { // variant = string (e.g. \"basic\"), command = string (e.g. \"show version\")\n                if variant == \"basic\" {\n                    // we already covered that\n                    continue\n                }\n                variantKey := vendor + \".\" + variant\n                variantsCache[variantKey]\n                if _, ok := result[variantKey]; !ok {\n                    // first command for this model, create a slice\n                    result[variantKey] = make([]string, len(configCmds))\n                }\n                result[variantKey][i] = command\n            }\n        }\n        // We need to iterate over all commands for all variants and copy \"basic\" command if there is none\n        for variant, _ := range variantsCache {\n            for i, command := range result[variant] {\n                if command == \"\" {\n                    // copy the \"basic\" command, since there was no variant specific command\n                    result[variant][i] = result[vendor][i]\n                }\n            } \n        }\n    }\n\n    // combine setup and cleanup with config\n    for variant, _ := result {\n        // will return \"cisco\" for both \"cisco\" and \"cisco.x3650\"\n        vendor := strings.Split(variant, \".\")[0] \n        result[variant] = append(setupCmds[vendor], result[variant]...)\n        result[variant] = append(result[variant], cleanupCmds[vendor]...)\n    }\n\n    return result\n</code></pre>\n"}], "owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2901, "favorite_count": 0, "accepted_answer_id": 51280792, "answer_count": 2, "score": 3, "last_activity_date": 1531297992, "creation_date": 1531242349, "question_id": 51270780, "link": "https://stackoverflow.com/questions/51270780/golang-map-yaml-objects", "title": "Golang Map YAML Objects", "body": "<p>I have a yaml configuration file that contains sets of configuration commands to send to network devices. Inside of each set, there are vendor-specific keys and the values for each vendor key can be either a configuration command string, a list of configuration command strings, or a list of key-value pairs mapping a vendor-specific model string to a configuration command string. Below is an example:</p>\n\n<pre><code># example.yml\n---\ncmds:\n  setup:\n    cisco: \"terminal length 0\"\n  config:\n    cisco:\n      - basic  : \"show version\"\n      - basic  : \"show boot\"\n        \"3560\" : \"3560 boot command\"\n        \"2960x\": \"2960x boot command\"\n      - basic  : \"dir flash:\"\n        \"3560\" : \"3560 dir command\"\n  cleanup:\n    cisco: [\"terminal no length\", \"quit\"]\n</code></pre>\n\n<p>I want to combine these commands into a map like so:</p>\n\n<pre><code>var cmdMap = map[string][]string{\n    \"cisco\": []string{\n        \"terminal length 0\",\n        \"show version\",\n        \"show boot\",\n        \"dir flash:\",\n        \"terminal no length\",\n        \"quit\",\n    },\n    \"cisco.3560\": []string{\n        \"terminal length 0\",\n        \"show version\",\n        \"3560 boot command\",\n        \"3560 dir command\",\n        \"terminal no length\",\n        \"quit\",\n    },\n    \"cisco.2960x\": []string{\n        \"terminal length 0\",\n        \"show version\",\n        \"2960x boot command\",\n        \"dir flash:\",\n        \"terminal no length\",\n        \"quit\",\n    }\n}\n</code></pre>\n\n<p>I am using <a href=\"https://github.com/spf13/viper\" rel=\"nofollow noreferrer\">spf13/viper</a> to handle parsing the yaml file and have been able to add the specific commands to each vendor and model, but adding the commands that apply to both vendor <em>and</em> specific model is where I am stuck. This is the actual output of my program followed by my code:</p>\n\n<pre><code>$ go run main.go example.yml \ncmdMap[\"cisco\"]\nterminal length 0\nshow version\nshow boot\ndir flash:\nterminal no length\nquit\n\n# missing terminal length 0, show version, etc.\ncmdMap[\"cisco.3560\"]\n3560 boot command\n3560 dir command\n\n# missing terminal length 0, show version, etc.\ncmdMap[\"cisco.2960x\"]\n2960x boot command\n</code></pre>\n\n<p>My code:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/spf13/viper\"\n    \"fmt\"\n    \"flag\"\n    \"log\"\n)\n\nfunc main() {\n    flag.Parse()\n    cfgFile := flag.Arg(0)\n\n    v := viper.New()\n    v.SetConfigType(\"yaml\")\n    v.SetConfigFile(cfgFile)\n\n    if err := v.ReadInConfig(); err != nil {\n        log.Fatal(err)\n    }\n\n    for k, v := range MapCfgCmds(v.GetStringMap(\"cmds\")) {\n        fmt.Printf(\"cmdMap[\\\"%s\\\"]\\n\", k)\n        for _, cmd := range v {\n            fmt.Println(cmd)\n        }\n        fmt.Println()\n    }\n}\n\nfunc MapCfgCmds(cfgCmds map[string]interface{}) map[string][]string {\n    cmdMap := make(map[string][]string)\n    for _, cmdSet := range cfgCmds {\n        cmdSet, _ := cmdSet.(map[string]interface{})\n        for vendor, cmdList := range cmdSet {\n            switch cmds := cmdList.(type) {\n            case string:\n                // single string command (i.e., vendor: cmd)\n                cmdMap[vendor] = append(cmdMap[vendor], cmds)\n            case []interface{}:\n                for _, cmd := range cmds {\n                    switch c := cmd.(type) {\n                    case string:\n                        // list of strings (i.e., vendor: [cmd1,cmd2,...,cmdN])\n                        cmdMap[vendor] = append(cmdMap[vendor], c)\n                    case map[interface{}]interface{}:\n                        // This is where I am stuck\n                        //\n                        // list of key-value pairs (i.e., vendor: {model: modelCmd})\n                        for model, modelCmd := range c {\n                            modelCmd, _ := modelCmd.(string)\n                            if model == \"basic\" {\n                                cmdMap[vendor] = append(cmdMap[vendor], modelCmd)\n                                continue\n                            }\n                            modelKey := fmt.Sprintf(\"%s.%s\", vendor, model)\n                            cmdMap[modelKey] = append(cmdMap[modelKey], modelCmd)\n                        }\n                    }\n                }\n            }\n        }\n    }\n    return cmdMap\n}\n</code></pre>\n\n<p><strong>How can I combine the \"universal\" and model-specific commands to get the expected <code>cmdMap</code> value from above?</strong></p>\n"}, {"tags": ["arrays", "go", "data-structures", "set"], "comments": [{"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1531241378, "post_id": 51270432, "comment_id": 89519138, "body": "@Himanshu please see it is in the code as var jsonBlob :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1531241541, "post_id": 51270432, "comment_id": 89519227, "body": "The <code>mapset.Set</code> type doesn&#39;t have an <code>UnmarshalJSON</code> method, and there&#39;s no real reason for it to have one, since there&#39;s is no &quot;set&quot; type in json."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1531241792, "post_id": 51270432, "comment_id": 89519338, "body": "Also note that <code>mapset.Set</code> is an interface, and you can&#39;t unmarshal into an interface without providing a concrete value to use."}, {"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1531242149, "post_id": 51270432, "comment_id": 89519526, "body": "@JimB Thanks for the suggestion.I am struggling with converting that.Do you have a suggestion how can i achieve the array to set conversion in go lang?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1531242233, "post_id": 51270432, "comment_id": 89519561, "body": "As @JimB stated already there are no sets in Golang why you need to convert a value into a set like python set. If it is related to any particular requirement then you can think of any other data structure given by Go"}, {"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1531242396, "post_id": 51270432, "comment_id": 89519641, "body": "@Himanshu because array will keep growing exponentially and doing intersection and search operation on array would become inefficient , that&#39;s why i thought of using Set or map might be good idea."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1531242451, "post_id": 51270432, "comment_id": 89519662, "body": "So you can use <code>map</code>. In Golang there are no sets"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1531242453, "post_id": 51270432, "comment_id": 89519663, "body": "@immrsteel: Looking at the docs for the package you linked, you can convert a slice to a that Set type using the provided constructors, e.g. <a href=\"https://godoc.org/github.com/deckarep/golang-set#NewSet\" rel=\"nofollow noreferrer\"><code>NewSet</code></a>, or just add the items individually."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1531242577, "post_id": 51270432, "comment_id": 89519736, "body": "@Himanshu: I can&#39;t speak for the quality of the referenced package, but there&#39;s nothing wrong with using a &quot;set&quot; type if you need convenient &quot;set&quot; operations (and whether they are needed or not here, I also can&#39;t say)"}, {"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1531242694, "post_id": 51270432, "comment_id": 89519785, "body": "@JimB yeah i read that in docs but are you suggesting i should unmarshall givev json into array instead of set and then type cast array into set?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1531243136, "post_id": 51270432, "comment_id": 89520002, "body": "@immrsteel: Yes, you need to start by unmarshaling the values into a <i>slice</i> (not an array), because that is the native type that a json array unmarshals into."}], "answers": [{"comments": [{"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "edited": false, "score": 0, "creation_date": 1531243505, "post_id": 51270986, "comment_id": 89520194, "body": "thanks for the example but wouldn&#39;t that will going to unmarshall the whole json into a set instead of unmarshalling only array"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "edited": false, "score": 0, "creation_date": 1531243570, "post_id": 51270986, "comment_id": 89520224, "body": "No. That method will only get the JSON fragment specific to the specific entity. i.e. if you&#39;re unmarshaling <code>{&quot;foo&quot;:1, &quot;bar&quot;: [1,2,3]}</code> into <code>struct{Foo int, Bar *MySet}</code>, the above function will be called with the input <code>[1,2,3]</code>."}, {"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "edited": false, "score": 0, "creation_date": 1531248913, "post_id": 51270986, "comment_id": 89522646, "body": "I tried to use the custom marshaller(edited in question) but it throws  runtime error: hash of unhashable type []interface {}"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "edited": false, "score": 0, "creation_date": 1531254338, "post_id": 51270986, "comment_id": 89524911, "body": "It would seem you need to use a hashable type, then, rather than []interface{}. But since I don&#39;t know your input data, I cannot tell you which type to use."}, {"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "edited": false, "score": 0, "creation_date": 1531258308, "post_id": 51270986, "comment_id": 89526543, "body": "This is my jsonBlob := <code>{ &quot;test&quot; : {&quot;thing&quot;:[&quot;team1&quot;, &quot;team2&quot;]}}</code> and i edited the code on how i am using the customer marshaller. can you please take a look?"}, {"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "edited": false, "score": 0, "creation_date": 1531259449, "post_id": 51270986, "comment_id": 89526968, "body": "It was from mapset.NewSet(a) changing it to mapset.NewSetFromSlice(a) fixed it.Thanks"}, {"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "edited": false, "score": 0, "creation_date": 1531260113, "post_id": 51270986, "comment_id": 89527183, "body": "Flimzy It prints out &amp;map[test:map[thing:{nil} ] .It never writes down actual value. I beleive this might not be the right way of assigning the value .   &quot;type other map[string]Myset&quot;"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1531243212, "creation_date": 1531243212, "answer_id": 51270986, "question_id": 51270432, "link": "https://stackoverflow.com/questions/51270432/unmarshall-list-into-set/51270986#51270986", "title": "Unmarshall list into set", "body": "<p>Given that the data type you wish to use is an interface, and does not satisfy the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">json.Unmarshaler</a> interface, you have two options:</p>\n\n<ol>\n<li><p>Unmarshal to an array, then convert to your preferred type.</p></li>\n<li><p>Create a custom type, that wraps your preferred type, and provides an <code>UnmarshalJSON</code> method. This is functionally the same as #1, but may be easier to use.  Example:</p>\n\n<pre><code>type MySet struct {\n    set mapset.Set\n}\n\nfunc (s *MySet) UnmarshalJSON(p []byte) error {\n    var a []interface{}\n    if err := json.Unmarshal(p, &amp;a); err != nil {\n        return err\n    }\n    s.set = mapset.NewSet(a)\n    return nil\n}\n</code></pre>\n\n<p>(Note, this code is untested; it is not meant to be a complete solution, but a guide in the right direction.)</p></li>\n</ol>\n"}], "owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 1, "accepted_answer_id": 51270986, "answer_count": 1, "score": 1, "last_activity_date": 1531248684, "creation_date": 1531241008, "last_edit_date": 1531248684, "question_id": 51270432, "link": "https://stackoverflow.com/questions/51270432/unmarshall-list-into-set", "title": "Unmarshall list into set", "body": "<p>Moved from python to golang:  </p>\n\n<pre><code>jsonBlob := `{ \"test\" : {\"thing\":[\"team1\", \"team2\"]}}`\n\ntype other map[string]Myset\ntype stuff map[string]other\ntype MySet struct {\n    set mapset.Set\n}\n\n//Custom unmarshaller\nfunc (s *MySet) UnmarshalJSON(p []byte) error {\n    var a []interface{}\n    if err := json.Unmarshal(p, &amp;a); err != nil {\n        return err\n    }\n    s.set = mapset.NewSet(a)\n    return nil\n}\n\n // Unmarshall it\n var s stuff\n err := json.Unmarshall(jsonBlob, &amp;s)\n if err != nil {\n  return err   \n}\n</code></pre>\n\n<p><strong>but it throws: runtime error: hash of unhashable type []interface {}</strong></p>\n"}, {"tags": ["reactjs", "typescript", "go", "fetch", "go-iris"], "comments": [{"owner": {"reputation": 81718, "user_id": 3617886, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y26OT.jpg?s=128&g=1", "display_name": "Tholle", "link": "https://stackoverflow.com/users/3617886/tholle"}, "edited": false, "score": 1, "creation_date": 1531238517, "post_id": 51269613, "comment_id": 89517675, "body": "Have you tried <code>AllowedOrigins: []string{&quot;*&quot;},</code>, i.e. it will let all origins have access to the API?"}, {"owner": {"reputation": 133, "user_id": 6571554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y7lTr.jpg?s=128&g=1", "display_name": "Sreyas", "link": "https://stackoverflow.com/users/6571554/sreyas"}, "reply_to_user": {"reputation": 81718, "user_id": 3617886, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y26OT.jpg?s=128&g=1", "display_name": "Tholle", "link": "https://stackoverflow.com/users/3617886/tholle"}, "edited": false, "score": 0, "creation_date": 1531238569, "post_id": 51269613, "comment_id": 89517709, "body": "@Tholle yes i have.It didn&#39;t work :("}, {"owner": {"reputation": 81718, "user_id": 3617886, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y26OT.jpg?s=128&g=1", "display_name": "Tholle", "link": "https://stackoverflow.com/users/3617886/tholle"}, "edited": false, "score": 0, "creation_date": 1531238801, "post_id": 51269613, "comment_id": 89517850, "body": "Alright, that&#39;s frustrating. Have you tried removing <code>AllowedOrigins</code> entirely? <a href=\"https://github.com/iris-contrib/middleware/blob/8b2080bf3bf80ce86666bdb629931b172f74544e/cors/cors.go#L93-L97\" rel=\"nofollow noreferrer\">Looking at the source, it seems that would allow all origins as well</a>."}, {"owner": {"reputation": 133, "user_id": 6571554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y7lTr.jpg?s=128&g=1", "display_name": "Sreyas", "link": "https://stackoverflow.com/users/6571554/sreyas"}, "reply_to_user": {"reputation": 81718, "user_id": 3617886, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y26OT.jpg?s=128&g=1", "display_name": "Tholle", "link": "https://stackoverflow.com/users/3617886/tholle"}, "edited": false, "score": 0, "creation_date": 1531238917, "post_id": 51269613, "comment_id": 89517911, "body": "@Tholle Still not working :("}, {"owner": {"reputation": 81718, "user_id": 3617886, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y26OT.jpg?s=128&g=1", "display_name": "Tholle", "link": "https://stackoverflow.com/users/3617886/tholle"}, "edited": false, "score": 0, "creation_date": 1531239028, "post_id": 51269613, "comment_id": 89517962, "body": "Are you using create-react-app? Try adding <code>&quot;proxy&quot;: &quot;http:&#47;&#47;localhost:5000&quot;</code> in your <code>package.json</code>, as <a href=\"https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#proxying-api-requests-in-development\" rel=\"nofollow noreferrer\">outlined here</a>."}, {"owner": {"reputation": 133, "user_id": 6571554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y7lTr.jpg?s=128&g=1", "display_name": "Sreyas", "link": "https://stackoverflow.com/users/6571554/sreyas"}, "reply_to_user": {"reputation": 81718, "user_id": 3617886, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/y26OT.jpg?s=128&g=1", "display_name": "Tholle", "link": "https://stackoverflow.com/users/3617886/tholle"}, "edited": false, "score": 0, "creation_date": 1531239376, "post_id": 51269613, "comment_id": 89518149, "body": "Yes i&#39;m using create-react-app and adding proxy didn&#39;t work :("}, {"owner": {"reputation": 700, "user_id": 6940117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/us57e.png?s=128&g=1", "display_name": "Slotheroo", "link": "https://stackoverflow.com/users/6940117/slotheroo"}, "edited": false, "score": 1, "creation_date": 1531286839, "post_id": 51269613, "comment_id": 89533112, "body": "I&#39;ve personally found CORS to be pretty frustrating to solve. Have you considered running NGINX and routing your back-end and front-end to run on the same port (e.g. running your back-end on 5000, your front-end on 3000, and routing them through NGINX to both run on 4000)? This would let you leave all the CORS rules in place."}, {"owner": {"reputation": 133, "user_id": 6571554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y7lTr.jpg?s=128&g=1", "display_name": "Sreyas", "link": "https://stackoverflow.com/users/6571554/sreyas"}, "reply_to_user": {"reputation": 700, "user_id": 6940117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/us57e.png?s=128&g=1", "display_name": "Slotheroo", "link": "https://stackoverflow.com/users/6940117/slotheroo"}, "edited": false, "score": 1, "creation_date": 1531319686, "post_id": 51269613, "comment_id": 89554108, "body": "@Slotheroo Thanks a lot!!! I used ngnix to proxy and it worked charm."}], "answers": [{"tags": [], "owner": {"reputation": 133, "user_id": 6571554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y7lTr.jpg?s=128&g=1", "display_name": "Sreyas", "link": "https://stackoverflow.com/users/6571554/sreyas"}, "is_accepted": true, "score": 1, "last_activity_date": 1531883858, "last_edit_date": 1531883858, "creation_date": 1531319959, "answer_id": 51288314, "question_id": 51269613, "link": "https://stackoverflow.com/questions/51269613/cross-origin-request-blocked-header-access-control-allow-origin-missing/51288314#51288314", "title": "Cross-Origin Request Blocked, header Access-Control-Allow-Origin missing", "body": "<p>Thanks to Slotheroo for his suggestion to use nginx and that was the only possible way i could over come this problem.I used nginx to proxy the requests and route both front end and back end to 8000 port. I will leave a sample of my nginx server configuration and changes made to code here so that it helps anyone in future :)</p>\n\n<p><em>(Please note that using loop back ip like \"localhost\" can affect performance on loading and sending request therefore use exact ip of the machine to overcome such performance issue)</em></p>\n\n<p><strong>nginx.conf</strong></p>\n\n<pre><code>server {\n        listen       8000;\n        server_name  localhost;\n\n        location / {\n            proxy_pass http://localhost:3000;\n        }\n        location /getposts {\n            proxy_pass http://localhost:5000/getposts;\n        }\n\n    }\n</code></pre>\n\n<p>Added localhost:8000 to Allowed Orgins in backend</p>\n\n<pre><code>AllowedOrigins:   []string{\"http://localhost:8000\"},\n</code></pre>\n\n<p>request is now send to 8000 port</p>\n\n<pre><code>fetch('http://localhost:8000/getposts',{\n                    method: 'get',\n                    credentials: \"include\",\n                    mode: \"cors\",\n                    headers: [\n                        [\"Content-Type\", \"application/json\"], \n                        [\"Authorization\",\"Basic \"+btoa('Sreyas:password')],\n                    ]     \n            }).then((response) =&gt; {\n                if(response.ok){\n                    response.json().then(rawdata =&gt;{\n                        this.setState({blogdata:rawdata})\n                    })\n                }else{\n                    console.log(\"No posts\")\n                    this.setState({blogdata:null})\n                }\n            }).catch(error =&gt; {\n                console.log(\"Server Error\")\n                this.setState({blogdata:null})\n              })\n    }\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 6571554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y7lTr.jpg?s=128&g=1", "display_name": "Sreyas", "link": "https://stackoverflow.com/users/6571554/sreyas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1902, "favorite_count": 0, "accepted_answer_id": 51288314, "answer_count": 1, "score": 0, "last_activity_date": 1531883858, "creation_date": 1531237967, "last_edit_date": 1531246107, "question_id": 51269613, "link": "https://stackoverflow.com/questions/51269613/cross-origin-request-blocked-header-access-control-allow-origin-missing", "title": "Cross-Origin Request Blocked, header Access-Control-Allow-Origin missing", "body": "<p>I was writing a blog application which has front end in react + typescript and backend in go iris. I'm doing a get request to fetch blog content. Backend runs at localhost:5000 and node at localhost:3000.But it fails with the error</p>\n\n<blockquote>\n  <p>Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at <a href=\"http://localhost:5000/getposts\" rel=\"nofollow noreferrer\">http://localhost:5000/getposts</a>. (Reason: CORS header \u2018Access-Control-Allow-Origin\u2019 missing).</p>\n</blockquote>\n\n<p>I have already configured CORS in the backend</p>\n\n<pre><code>Cors := cors.New(cors.Options{\n        AllowedOrigins:   []string{\"http://localhost:3000\"},\n        AllowCredentials: true,\n        AllowedMethods:   []string{\"GET\", \"POST\", \"PUT\", \"DELETE\", \"HEAD\", \"OPTIONS\"},\n        AllowedHeaders:   []string{\"Cache-Control\", \"X-File-Name\", \"X-Requested-With\", \"X-File-Name\", \"Content-Type\", \"Authorization\", \"Set-Cookie\", \"Cookie\"},\n        Debug:            true,\n    })\nauthConfig := basicauth.Config{\n        Users:   map[string]string{USER_NAME: PASSWORD},\n        Realm:   \"Authorization Required\", // defaults to \"Authorization Required\"\n        Expires: time.Duration(30) * time.Minute,\n    }\n\nauthentication := basicauth.New(authConfig)\napp := iris.New()\napp.Use(Cors)\napp.Get(\"/getposts\", authentication, GetPostsHandler)\n</code></pre>\n\n<p>This is how I send request</p>\n\n<pre><code>fetch(\"http://localhost:5000/getposts\", {\n  method: \"get\",\n  credentials: \"include\",\n  mode: \"cors\",\n  headers: [\n    [\"Content-Type\", \"application/json\"],\n    [\"Authorization\", \"Basic \" + btoa(\"Sreyas:password\")]\n  ]\n})\n  .then(response =&gt; {\n    if (response.ok) {\n      response.json().then(rawdata =&gt; {\n        this.setState({ blogdata: rawdata });\n      });\n    } else {\n      console.log(\"No posts\");\n      this.setState({ blogdata: null });\n    }\n  })\n  .catch(error =&gt; {\n    console.log(\"Server Error\");\n    this.setState({ blogdata: null });\n  });\n</code></pre>\n\n<p>I searched and tried for hours to fix this problem but no luck.</p>\n"}, {"tags": ["validation", "go", "import"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1531235437, "post_id": 51268597, "comment_id": 89515645, "body": "How are you using that package? It has no init function, so there are no side effects to importing it."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1531235571, "post_id": 51268597, "comment_id": 89515760, "body": "Why do you think you need to import this package? As far as I can see, that&#39;s not needed?"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 6, "last_activity_date": 1531235383, "creation_date": 1531235383, "answer_id": 51268712, "question_id": 51268597, "link": "https://stackoverflow.com/questions/51268597/golang-imported-and-not-used-error-but-package-is-needed-just-not-called-in/51268712#51268712", "title": "Golang &quot;imported and not used&quot; error, but package is needed, just not called in code", "body": "<p>To import a library only for its side effects (i.e. to run a package <code>init</code> function), use an empty import:</p>\n\n<pre><code>import ( \n    _ \"gopkg.in/validator.v2\"\n)\n</code></pre>\n\n<p><strong>However, this package does <em>not</em> have a package <code>init</code> function, so there is no point in importing it.</strong> You do not need to import a package just to use the struct tags - struct tags are arbitrary and not compile-time checked, nor do they have to be defined before use. They're purely for use in reflection.</p>\n"}], "owner": {"reputation": 31, "user_id": 10060029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cff1f6c9ef04cf1fe8d31d90218dfbf7?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/10060029/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 916, "favorite_count": 0, "closed_date": 1531245316, "answer_count": 1, "score": 1, "last_activity_date": 1531235383, "creation_date": 1531235045, "question_id": 51268597, "link": "https://stackoverflow.com/questions/51268597/golang-imported-and-not-used-error-but-package-is-needed-just-not-called-in", "closed_reason": "Duplicate", "title": "Golang &quot;imported and not used&quot; error, but package is needed, just not called in code", "body": "<p>I'm using the <a href=\"https://gopkg.in/go-playground/validator.v2\" rel=\"nofollow noreferrer\">validator2</a> library to validate struct fields in my Go application. The result looks something like this: </p>\n\n<pre><code>type data struct {\n    Event string `json:\"event\" validate:\"nonzero\"`\n}\n</code></pre>\n\n<p>However, when I try importing the library with </p>\n\n<pre><code>import ( \n    \"gopkg.in/validator.v2\"\n)\n</code></pre>\n\n<p>it returns an error, <code>imported and not used: \"flight-recorder/vendor/gopkg.in/validator.v2\" as validator</code>. This is because the library isn't directly called in the code. How can I indicate that to Go? </p>\n"}, {"tags": ["sql-server", "database", "go", "go-gorm"], "comments": [{"owner": {"reputation": 596, "user_id": 5240559, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/7f3e629e8218ac26b2534deea627af27?s=128&d=identicon&r=PG&f=1", "display_name": "facumedica", "link": "https://stackoverflow.com/users/5240559/facumedica"}, "edited": false, "score": 1, "creation_date": 1531226202, "post_id": 51265096, "comment_id": 89508663, "body": "Could you provide code? This <code>time.Time gets me datetime2 which is a different dataType</code> is not clear. Thanks!"}, {"owner": {"reputation": 363, "user_id": 8573115, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/acecb8da2690096c6f6c899111d0145b?s=128&d=identicon&r=PG&f=1", "display_name": "Trody", "link": "https://stackoverflow.com/users/8573115/trody"}, "reply_to_user": {"reputation": 596, "user_id": 5240559, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/7f3e629e8218ac26b2534deea627af27?s=128&d=identicon&r=PG&f=1", "display_name": "facumedica", "link": "https://stackoverflow.com/users/5240559/facumedica"}, "edited": false, "score": 0, "creation_date": 1531229082, "post_id": 51265096, "comment_id": 89510923, "body": "Code updated. Also, if I try to create an entry I get: The conversion of a datetimeoffset data type to a datetime data type resulted in an out-of-range value."}, {"owner": {"reputation": 596, "user_id": 5240559, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/7f3e629e8218ac26b2534deea627af27?s=128&d=identicon&r=PG&f=1", "display_name": "facumedica", "link": "https://stackoverflow.com/users/5240559/facumedica"}, "edited": false, "score": 1, "creation_date": 1531250118, "post_id": 51265096, "comment_id": 89523146, "body": "What about using the type tag in the gorm tag of the field? <code>Email   string  &#39;gorm:&quot;type:varchar(100);unique_index&quot;&#39;</code> (<a href=\"http://doc.gorm.io/models.html\" rel=\"nofollow noreferrer\">doc.gorm.io/models.html</a>) Also check this issue: <a href=\"https://github.com/jinzhu/gorm/issues/18\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm/issues/18</a>"}, {"owner": {"reputation": 363, "user_id": 8573115, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/acecb8da2690096c6f6c899111d0145b?s=128&d=identicon&r=PG&f=1", "display_name": "Trody", "link": "https://stackoverflow.com/users/8573115/trody"}, "reply_to_user": {"reputation": 596, "user_id": 5240559, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/7f3e629e8218ac26b2534deea627af27?s=128&d=identicon&r=PG&f=1", "display_name": "facumedica", "link": "https://stackoverflow.com/users/5240559/facumedica"}, "edited": false, "score": 0, "creation_date": 1531255001, "post_id": 51265096, "comment_id": 89525198, "body": "You mean like: DeleteTime time.Time <code>gorm:&quot;type:datetime(23);&quot;</code> It doesnt work. Same issue"}, {"owner": {"reputation": 596, "user_id": 5240559, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/7f3e629e8218ac26b2534deea627af27?s=128&d=identicon&r=PG&f=1", "display_name": "facumedica", "link": "https://stackoverflow.com/users/5240559/facumedica"}, "edited": false, "score": 1, "creation_date": 1531255612, "post_id": 51265096, "comment_id": 89525483, "body": "Without the &quot;(23)&quot; I meant. That must indicate the length of the field, which iirc is not needed for datetime fields"}, {"owner": {"reputation": 363, "user_id": 8573115, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/acecb8da2690096c6f6c899111d0145b?s=128&d=identicon&r=PG&f=1", "display_name": "Trody", "link": "https://stackoverflow.com/users/8573115/trody"}, "reply_to_user": {"reputation": 596, "user_id": 5240559, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/7f3e629e8218ac26b2534deea627af27?s=128&d=identicon&r=PG&f=1", "display_name": "facumedica", "link": "https://stackoverflow.com/users/5240559/facumedica"}, "edited": false, "score": 0, "creation_date": 1531293328, "post_id": 51265096, "comment_id": 89536119, "body": "It does work but I still get the error when I try to save data to the table because is type is different. Basically I need to use something different than time.Time"}], "owner": {"reputation": 363, "user_id": 8573115, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/acecb8da2690096c6f6c899111d0145b?s=128&d=identicon&r=PG&f=1", "display_name": "Trody", "link": "https://stackoverflow.com/users/8573115/trody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 899, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1531226841, "creation_date": 1531225379, "last_edit_date": 1531226841, "question_id": 51265096, "link": "https://stackoverflow.com/questions/51265096/ms-sql-datetime-representation-in-go-gorm", "title": "MS SQL datetime representation in go-gorm", "body": "<p>Title says it all. I'm using gorm (golang orm) to connect to a MS SQL db.</p>\n\n<p>time.Time gets me datetime2 which is a different dataType. Any suggestions?</p>\n\n<p><strong>Structure:</strong></p>\n\n<pre><code>type (\n    ACDepartements struct {\n        DEPTID              int         `gorm:\"column:DEPTID;primary_key;not null;\"`\n        DEPTNAME            string      `gorm:\"column:DEPTNAME;size:30;\"`\n        SUPDEPTID           int         `gorm:\"column:SUPDEPTID;not null;\"`\n        InheritParentSch    int16       `gorm:\"column:InheritParentSch;size:5;\"`\n        InheritDeptSch      int16       `gorm:\"column:InheritDeptSch;\"`\n        InheritDeptSchClass int16       `gorm:\"column:InheritDeptSchClass;\"`\n        AutoSchPlan         int16       `gorm:\"column:AutoSchPlan;\"`\n        InLate              int16       `gorm:\"column:InLate;\"`\n        OutEarly            int16       `gorm:\"column:OutEarly;\"`\n        InheritDeptRule     int16       `gorm:\"column:InheritDeptRule;\"`\n        MinAutoSchInterval  int         `gorm:\"column:MinAutoSchInterval;\"`\n        RegisterOT          int16       `gorm:\"column:RegisterOT;\"`\n        DefaultSchId        int         `gorm:\"column:DefaultSchId;not null;\"`\n        ATT                 int16       `gorm:\"column:ATT;\"`\n        Holiday             int16       `gorm:\"column:Holiday;\"`\n        OverTime            int16       `gorm:\"column:OverTime;\"`\n        ChangeOperator      string      `gorm:\"size:50;\"`\n        ChangeTime          time.Time\n        CreateOperator      string      `gorm:\"size:50;\"`\n        CreateTime          time.Time\n        DeleteOperator      string      `gorm:\"size:50;\"`\n        DeleteTime          time.Time\n        Status              int     \n        Code                string      `gorm:\"size:50;\"`\n        Type                string      `gorm:\"size:50;\"`\n        Invalidate          time.Time\n    }\n)\n</code></pre>\n\n<p><strong>Connection:</strong></p>\n\n<pre><code>func buildAcDB() *gorm.DB {\n    connectionString  := os.Getenv(\"MS_SQL\")\n\n    acDB, err := gorm.Open(\"mssql\", connectionString)\n\n    if err != nil {\n        panic(\"Failed to create connection pool. Error: \" + err.Error())\n    }\n    gorm.DefaultCallback.Create().Remove(\"mssql:set_identity_insert\")\n\n    return acDB\n}\n</code></pre>\n\n<p><strong>Server:</strong></p>\n\n<pre><code>func Start(db *gorm.DB, acDB *gorm.DB) {\n\nOther stuff......\n\ndefer acDB.Close()\n\nacDB.AutoMigrate(microlab.ACDepartements{})\n\n}\n</code></pre>\n\n<p><strong>Problem:</strong></p>\n\n<p>If I check the data structure of my created table, time variables have datetime2 instead of datetime as I want. Also int16 are int instead of smallint but I guess that doesn't matter that much.</p>\n"}, {"tags": ["go", "pointers", "data-structures", "pass-by-value", "pass-by-pointer"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 14, "last_activity_date": 1550071945, "last_edit_date": 1550071945, "creation_date": 1531225064, "answer_id": 51265000, "question_id": 51264339, "link": "https://stackoverflow.com/questions/51264339/what-do-value-semantics-and-pointer-semantics-mean-in-go/51265000#51265000", "title": "What do &quot;value semantics\u2019&quot; and &quot;pointer semantics&quot; mean in Go?", "body": "<p>When you call a function or a method and you pass parameters to it, a copy is made from the values, and the function can only access these copies.</p>\n\n<p>This means if the function attempts to modify / change the copies, it will not change the original value.</p>\n\n<p>For example:</p>\n\n<pre><code>func main() {\n    i := 1\n    fmt.Println(\"double:\", double(i))\n    fmt.Println(\"original i:\", i)\n}\n\nfunc double(i int) int {\n    i *= 2\n    return i\n}\n</code></pre>\n\n<p>This outputs (try it on the <a href=\"https://play.golang.org/p/lnsybgnm10-\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>double: 2\noriginal i: 1\n</code></pre>\n\n<p>Even though <code>double()</code> modifies its <code>i</code> parameter, the variable (whose value was passed) at the caller did not change.</p>\n\n<p>For it to change, we would need to change the signature to expect a pointer, pass a pointer, and modify the pointed value:</p>\n\n<pre><code>func main() {\n    i := 1\n    fmt.Println(\"double:\", doublep(&amp;i))\n    fmt.Println(\"original i:\", i)\n}\n\nfunc doublep(i *int) int {\n    *i *= 2\n    return *i\n}\n</code></pre>\n\n<p>This outputs (try it on the <a href=\"https://play.golang.org/p/agbAcaELd4U\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>double: 2\noriginal i: 2\n</code></pre>\n\n<p>So if we pass something, we're expecting the original value not to change if the passed value is modified, unless we pass a pointer to it.</p>\n\n<p><strong>Pointer semantics</strong> means that even though we pass something \"by value\", the callee can still modify the \"original\" value, just as if we would have passed a pointer to it.</p>\n\n<p>For example:</p>\n\n<pre><code>func main() {\n    is := []int{1, 2}\n    fmt.Println(\"double:\", doubles(is))\n    fmt.Println(\"original is:\", is)\n}\n\nfunc doubles(is []int) []int {\n    for i := range is {\n        is[i] *= 2\n    }\n    return is\n}\n</code></pre>\n\n<p>This outputs (try it on the <a href=\"https://play.golang.org/p/-7HReqHT_LS\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>double: [2 4]\noriginal is: [2 4]\n</code></pre>\n\n<p>Even though we did not pass a pointer (<code>is</code> is not a pointer), the calle modified its elements, and the value of the original slice also changed.</p>\n\n<p>We say that even though in Go everything is passed by value, passing slices have pointer semantics, because if the callee modifies the elements, it will be reflected in the original.</p>\n\n<h2>Reasoning</h2>\n\n<p>Everything in Go is passed by value, slices too. But slices are\u2013under the hood\u2013struct-like data structures that hold a pointer to an underlying array that holds the actual elements. And when you pass a slice, a copy is made, but only this slice header will be copied (this is the slice value). The copy will hold the same pointer, pointing to the same backing array. The backing array is not copied. So when the callee modifies the elements of the slice, the elements of the backing array are modified, which is the same as the backing array of the original slice.</p>\n\n<p>Read more about it here: <a href=\"https://stackoverflow.com/questions/39993688/are-golang-slices-pass-by-value/39993797#39993797\">Are golang slices pass by value?</a></p>\n\n<p>There are many types that have pass by pointer semantics, such as slices, maps, channels.</p>\n\n<p>It is worth noting that\u2013unlike slices\u2013arrays are not in the line, an array value means all its values, and passing an array makes a copy of all its elements.</p>\n"}], "owner": {"reputation": 2667, "user_id": 1508147, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nueRO.jpg?s=128&g=1", "display_name": "Sathishkumar Rakkiasamy", "link": "https://stackoverflow.com/users/1508147/sathishkumar-rakkiasamy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1287, "favorite_count": 2, "accepted_answer_id": 51265000, "answer_count": 1, "score": 7, "last_activity_date": 1606075723, "creation_date": 1531223085, "last_edit_date": 1606075723, "question_id": 51264339, "link": "https://stackoverflow.com/questions/51264339/what-do-value-semantics-and-pointer-semantics-mean-in-go", "title": "What do &quot;value semantics\u2019&quot; and &quot;pointer semantics&quot; mean in Go?", "body": "<p>What is the meaning of <strong>Value semantics</strong> and <strong>Pointer semantics</strong> in Go? In <a href=\"https://www.safaribooksonline.com/videos/ultimate-go-programming/9780134757476\" rel=\"noreferrer\">this course</a>, the author used to mention many times about above terms when explaining internals of arrays and slices which I couldn't understand it completely.</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 20968, "user_id": 2564301, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a6b5734cdcb5ce19598ccf9a7d8cc1ff?s=128&d=identicon&r=PG&f=1", "display_name": "Jongware", "link": "https://stackoverflow.com/users/2564301/jongware"}, "reply_to_user": {"reputation": 1742, "user_id": 9810480, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/82mm4.jpg?s=128&g=1", "display_name": "Jignesh Mistry", "link": "https://stackoverflow.com/users/9810480/jignesh-mistry"}, "edited": false, "score": 0, "creation_date": 1531224008, "post_id": 51263897, "comment_id": 89507134, "body": "@JigneshMistry: as long as your edits need reviewing, make sure to fix as much as possible. That single capital in the title was by far not the only thing that needs to be corrected."}], "answers": [{"tags": [], "owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "is_accepted": false, "score": 1, "last_activity_date": 1531222360, "last_edit_date": 1531222360, "creation_date": 1531222246, "answer_id": 51264087, "question_id": 51263897, "link": "https://stackoverflow.com/questions/51263897/how-to-pass-conditional-argument-in-postgresql-using-go/51264087#51264087", "title": "How to pass Conditional argument in PostgreSQL using go?", "body": "<p>Change the condition by using else condition to skip the third column when creating query string. </p>\n\n<pre><code>strQry := `UPDATE core_channel SET title = $1, description = $2, `\n\nif updateChannelReq.FeaturedVideo != 0 {\n    strQry += `default_video_id = $3, original_keywords = $4, banner_link = $5 WHERE create_user_id = $6 `\n} else {\n    strQry += ` original_keywords = $3, banner_link = $4 WHERE create_user_id = $5`\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 9902349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46f8b2aad0ad325d02ca5e9e6050be12?s=128&d=identicon&r=PG&f=1", "display_name": "SUNIL PRASAD", "link": "https://stackoverflow.com/users/9902349/sunil-prasad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1531222965, "creation_date": 1531221678, "last_edit_date": 1531222965, "question_id": 51263897, "link": "https://stackoverflow.com/questions/51263897/how-to-pass-conditional-argument-in-postgresql-using-go", "title": "How to pass Conditional argument in PostgreSQL using go?", "body": "<p>I'm stuck over to pass argument to the <code>Exec</code> function on the basis of some conditions. I googled for this but found the solution with MySQL to use <code>args := []interface{}{var1, var2, ... varN}</code>.</p>\n\n<p>But my problem with PostgreSQL below is my conditional query:</p>\n\n<pre><code>strQry := `UPDATE core_channel SET title = $1, description = $2, `\n\nif updateChannelReq.FeaturedVideo != 0 {\n    strQry += `default_video_id = $3, `\n}\n\nstrQry += ` original_keywords = $4, banner_link = $5 WHERE create_user_id = $6`\n</code></pre>\n\n<p>And here how I'm passing argument to execute this query:</p>\n\n<pre><code>args := []interface{}{\n        updateChannelReq.Title,\n        updateChannelReq.Description,\n    }\n\nif updateChannelReq.FeaturedVideo != 0 {\n    args = append(args, updateChannelReq.FeaturedVideo)\n}\n\nargs = []interface{}{\n    updateChannelReq.OriginalKeyWords,\n    updateChannelReq.BannerLink,\n    AuthUserID,\n}\n\n_, err = stmt.Exec(args...)\n</code></pre>\n\n<p>But I'm getting the error:</p>\n\n<pre><code>pq: could not determine data type of parameter $3\n</code></pre>\n\n<p>please help me that how to manage these things.\nThanks.</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1531216235, "post_id": 51261705, "comment_id": 89502238, "body": "What actually happened and what did you expect to happen? Please add these infos to your question."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1531219520, "post_id": 51261705, "comment_id": 89504266, "body": "Why are you nesting the loop of employee inside loop of department?"}, {"owner": {"reputation": 3759, "user_id": 1481716, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l18HH.jpg?s=128&g=1", "display_name": "noelyahan", "link": "https://stackoverflow.com/users/1481716/noelyahan"}, "edited": false, "score": 0, "creation_date": 1531223757, "post_id": 51261705, "comment_id": 89506952, "body": "Make sure that you are setting the ID or whatever the model.Department level attribute, Is that ID type an interface{}"}, {"owner": {"reputation": 105, "user_id": 7324602, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3f3cfaaef5f110bbf4d2d9140e905b5?s=128&d=identicon&r=PG&f=1", "display_name": "Udayakumar", "link": "https://stackoverflow.com/users/7324602/udayakumar"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531227467, "post_id": 51261705, "comment_id": 89509630, "body": "Because , I need Department Id so, employee used inside the loop @leafbebop"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531228301, "post_id": 51261705, "comment_id": 89510300, "body": "I can&#39;t understand you correctly. Can you provide some desired output?"}, {"owner": {"reputation": 105, "user_id": 7324602, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3f3cfaaef5f110bbf4d2d9140e905b5?s=128&d=identicon&r=PG&f=1", "display_name": "Udayakumar", "link": "https://stackoverflow.com/users/7324602/udayakumar"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531232991, "post_id": 51261705, "comment_id": 89514000, "body": "The department table length is two, So the loop exec. two times mean while employee insert the record at four time (duplicates), So how can I solve the issue? @leafbebop"}], "answers": [{"tags": [], "owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "is_accepted": true, "score": 1, "last_activity_date": 1571520663, "last_edit_date": 1571520663, "creation_date": 1531221146, "answer_id": 51263704, "question_id": 51261705, "link": "https://stackoverflow.com/questions/51261705/how-to-insert-the-array-of-records-inside-the-range/51263704#51263704", "title": "How to insert the array of records inside the range", "body": "<p>If I understand correctly your question , you have two variables and both of them are slice.You want to append one of them to another another :</p>\n\n<p>this is your code and result :</p>\n\n<pre><code>func main() {\nvar depValues = []Department{\n    {DepartmentName: \"Software Analyst\", DeptCode: \"SA\"},\n    {DepartmentName: \"Business Analyst\", DeptCode: \"BA\"},\n}\n\nfor _, dep := range depValues {\n    fmt.Println(dep)\n    var empValues = []Employee{\n        {EmpId: \"001\", EmpName: \"samsung\", DepRefer: 1},\n        {EmpId: \"002\", EmpName: \"Nokia\", DepRefer: 2},\n    }\n\n    for _, empv := range empValues {\n        fmt.Println(empv)\n    }\n}\n}\n</code></pre>\n\n<p>your result </p>\n\n<pre><code> {Software Analyst SA []}\n {001 samsung 1}\n {002 Nokia 2}\n {Business Analyst BA []}\n {001 samsung 1}\n {002 Nokia 2} \n</code></pre>\n\n<p>And this my code and result </p>\n\n<pre><code>type Department struct {\nDepartmentName string\nDeptCode string\nEmployee []Employee\n}\n\ntype Employee struct {\n EmpId string\n EmpName string\n DepRefer  int\n\n}\n\n func main() {\n\n     var depValues  = []Department{\n        {DepartmentName: \"Software Analyst\", DeptCode: \"SA\"},\n        {DepartmentName: \"Business Analyst\", DeptCode: \"BA\"},\n    }\n\n    var empValues  = []Employee{\n        {EmpId: \"001\", EmpName: \"samsung\", DepRefer: 1},\n        {EmpId: \"002\", EmpName: \"Nokia\", DepRefer: 2},\n    }\n\n    for _, dep := range depValues {\n        dep.Employee = empValues\n        fmt.Println(dep)\n    }\n }\n</code></pre>\n\n<p>and result :</p>\n\n<pre><code>{Software Analyst SA [{001 samsung 1} {002 Nokia 2}]}\n{Business Analyst BA [{001 samsung 1} {002 Nokia 2}]}\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 7324602, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3f3cfaaef5f110bbf4d2d9140e905b5?s=128&d=identicon&r=PG&f=1", "display_name": "Udayakumar", "link": "https://stackoverflow.com/users/7324602/udayakumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 51263704, "answer_count": 1, "score": 2, "last_activity_date": 1571520672, "creation_date": 1531214925, "last_edit_date": 1571520672, "question_id": 51261705, "link": "https://stackoverflow.com/questions/51261705/how-to-insert-the-array-of-records-inside-the-range", "title": "How to insert the array of records inside the range", "body": "<p>How do I insert the struct inside the range?</p>\n\n<pre><code>    //Department array (department table)\n    var depValues []model.Department = []model.Department{\n            model.Department{DepartmentName: \"Software Analyst\", DeptCode: \"SA\"},\n            model.Department{DepartmentName: \"Business Analyst\", DeptCode: \"BA\"},\n    }\n\n    for _, dep := range depValues {\n            db.Create(&amp;dep) //It's working fine\n        }\n</code></pre>\n\n<p>Here, <code>dep.ID</code> return the both records <code>id</code></p>\n\n<pre><code>    //Another array (employee table)\n    var empValues []model.Employee = []model.Employee{\n            model.Employee{EmpId: \"001\", EmpName: \"samsung\", departmentRef: dep.ID},\n            model.Employee{EmpId: \"002\", EmpName: \"Nokia\", departmentRef: dep.ID},\n        }\n</code></pre>\n\n<p>Now, I want to insert the <code>departmentId</code> into <code>employee</code> table, How can I do it, Any one can teach me.</p>\n\n<p><strong>Already Tried</strong> </p>\n\n<p>It will be return duplicate values </p>\n\n<pre><code>var depValues []model.Department = []model.Department{\n        model.Department{DepartmentName: \"Software Analyst\", DeptCode: \"SA\"},\n        model.Department{DepartmentName: \"Business Analyst\", DeptCode: \"BA\"},\n    }\n\n        for _, dep := range depValues {\n            db.Create(&amp;dep)\n            //Insert into Employee\n            var empValues []model.Employee = []model.Employee{\n                model.Employee{EmpId: \"001\", EmpName: \"samsung\", DepRefer: dep.ID},\n                model.Employee{EmpId: \"002\", EmpName: \"Nokia\", DepRefer: dep.ID},\n            }\n\n            for _, empv := range empValues {\n                db.Create(&amp;empv)\n            }\n        }\n</code></pre>\n\n<p>Database duplicate records</p>\n\n<pre><code>    '1', '2018-07-10 15:12:27', '2018-07-10 15:12:27', NULL, '001', 'samsung', '1'\n    '2', '2018-07-10 15:12:28', '2018-07-10 15:12:28', NULL, '002', 'Nokia', '2'\n    '3', '2018-07-10 15:12:29', '2018-07-10 15:12:29', NULL, '001', 'samsung', '1'\n    '4', '2018-07-10 15:12:29', '2018-07-10 15:12:29', NULL, '002', 'Nokia', '2'\n</code></pre>\n"}, {"tags": ["user-interface", "go", "packages"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531219049, "post_id": 51261644, "comment_id": 89504024, "body": "How did you run the code?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531219697, "post_id": 51261644, "comment_id": 89504378, "body": "If you are using <code>go run main.go</code> this is expected. <code>MustAsset</code> is defined in <code>bindata.go</code> (which is commonly generated by go-bindata). You should try run <code>go build</code> and then run the executable built."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531221587, "post_id": 51261644, "comment_id": 89505510, "body": "Above errors come with both <code>go build</code> and <code>go run</code> commands."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531221927, "post_id": 51261644, "comment_id": 89505716, "body": "run <code>go build</code> without any training arguments."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531222460, "post_id": 51261644, "comment_id": 89506075, "body": "<code>go build</code> command without any arguments (file name or anything else) also give same error. I installed <code>go-bindata</code> but the error is persisting."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531222741, "post_id": 51261644, "comment_id": 89506280, "body": "I doubt your repo is compromised. Can you find <code>MustAsset</code> in <code>bindata.go</code>?"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531223083, "post_id": 51261644, "comment_id": 89506501, "body": "The function is there in this file: <code>func MustAsset(name string) []byte { \ta, err := Asset(name) \tif err != nil { \t\tpanic(&quot;asset: Asset(&quot; + name + &quot;): &quot; + err.Error()) \t}  \treturn a } </code>"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531235724, "post_id": 51261644, "comment_id": 89515879, "body": "I cannot understand this down vote."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531298149, "post_id": 51261644, "comment_id": 89538959, "body": "run <code>go clean; go build</code> and if that shows the same error, I would like to see you directory structure (run <code>dir</code> or <code>ls</code> or <code>tree</code>)"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531298470, "post_id": 51261644, "comment_id": 89539152, "body": "<code>go clean</code> does not work. It completed without any msg. Same error with <code>go build</code> after <code>go clean</code>. I just have this main.go file in a general folder named <code>~&#47;0-golang</code>. I have not made any directory structure for this file. Are you asking about <code>go</code> directory structure where <code>golang-ui&#47;nuklear</code> package is installed?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531298862, "post_id": 51261644, "comment_id": 89539409, "body": "@mso This seems to be the problem. You need to copy all files, sub-directorries and anything else into your directory, not just <code>main.go</code>."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531298984, "post_id": 51261644, "comment_id": 89539493, "body": "Pl see the directory structure of my <code>go</code> folder in my question above."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531299351, "post_id": 51261644, "comment_id": 89539758, "body": "No, you need to keep everything where you run the <code>go build</code>. Everything, from <code>main.go</code> to <code>bindata.go</code> and <code>asset</code> sub-directory. Better if you run it in its orignal directory."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531299614, "post_id": 51261644, "comment_id": 89539946, "body": "I downloaded <code>bindata.go</code> and <code>util.go</code> from website example page to the <code>~&#47;0-golang&#47;nuk-demo</code> folder along with <code>main.go</code> and now it works. It created an executable named <code>nuk-demo</code>. I did not touch <code>go</code> folder (tree shown in question) where <code>nuklear</code> package is installed. Is that OK? Thanks for your help. You may enter these comments as an answer and I will accept it with an upvote!"}], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1531300186, "creation_date": 1531300186, "answer_id": 51281528, "question_id": 51261644, "link": "https://stackoverflow.com/questions/51261644/nuklear-gui-demo-not-running/51281528#51281528", "title": "Nuklear GUI demo not running", "body": "<p>In Go, programs (and package) are based on directory. So very often, multiple source files complement each other. In this case, the <code>MustAsset</code> is defined in <code>bindata.go</code>. Therefore isolating <code>main.go</code> raises an error. You can read more about Go's source file organization here: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html</a></p>\n"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 458, "favorite_count": 0, "accepted_answer_id": 51281528, "answer_count": 1, "score": -1, "last_activity_date": 1531300186, "creation_date": 1531214734, "last_edit_date": 1531298921, "question_id": 51261644, "link": "https://stackoverflow.com/questions/51261644/nuklear-gui-demo-not-running", "title": "Nuklear GUI demo not running", "body": "<p>I am trying to run demo file at <a href=\"https://github.com/golang-ui/nuklear/blob/master/cmd/nk-example-sdl2/main.go\" rel=\"nofollow noreferrer\">https://github.com/golang-ui/nuklear/blob/master/cmd/nk-example-sdl2/main.go</a> but I am getting following error: </p>\n\n<pre><code># command-line-arguments\n./nk_nuclear_gui.go:72: undefined: MustAsset\n./nk_nuclear_gui.go:126: undefined: flag\n./nk_nuclear_gui.go:129: undefined: flag\n</code></pre>\n\n<p>I believe MustAsset is part of <a href=\"https://godoc.org/github.com/zulily/reckon#MustAsset\" rel=\"nofollow noreferrer\">Reckon package</a> which I installed, but error persists. Where is the problem and how can I solve it?</p>\n\n<p>Edit: Both commands <code>go build main.go</code> and <code>go run main.go</code> give this error. Even <code>go build</code> without any filename is also giving this error as discussed in comments.</p>\n\n<p>I had encountered <a href=\"https://stackoverflow.com/questions/51260895/not-able-to-install-nuklear-library\">this problem</a> while installing nuklear package.</p>\n\n<p>I am running following version on Debian Stable Linux: </p>\n\n<pre><code>go version go1.7.4 linux/amd64\n</code></pre>\n\n<p>I installed latest version (<code>go version go1.10.3 linux/amd64</code>) from <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">https://golang.org/doc/install</a> but the error persists. </p>\n\n<p>Edit: The directory structure of <code>go</code> directory is as follows: </p>\n\n<pre><code>$ tree -d\n.\n\u251c\u2500\u2500 pkg\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 linux_amd64\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 github.com\n\u2502\u00a0\u00a0         \u251c\u2500\u2500 golang-ui\n\u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2514\u2500\u2500 nuklear\n\u2502\u00a0\u00a0         \u2514\u2500\u2500 xlab\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 github.com\n        \u251c\u2500\u2500 go-gl\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 all-core\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v2.1\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v3.1\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gles2\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v3.2-compatibility\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v3.2-core\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v3.3-compatibility\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v3.3-core\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v4.1-compatibility\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v4.1-core\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v4.2-compatibility\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v4.2-core\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v4.3-compatibility\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v4.3-core\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v4.4-compatibility\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v4.4-core\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v4.5-compatibility\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v4.5-core\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 v4.6-compatibility\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 v4.6-core\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 gl\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 glfw\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 scripts\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 v3.0\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 glfw\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 v3.1\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 glfw\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2514\u2500\u2500 glfw\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u251c\u2500\u2500 deps\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u251c\u2500\u2500 EGL\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u251c\u2500\u2500 GL\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u251c\u2500\u2500 glad\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2514\u2500\u2500 KHR\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u251c\u2500\u2500 include\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u2502\u00a0\u00a0 \u2514\u2500\u2500 GLFW\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0         \u2514\u2500\u2500 src\n        \u2502\u00a0\u00a0     \u2514\u2500\u2500 v3.2\n        \u2502\u00a0\u00a0         \u2514\u2500\u2500 glfw\n        \u2502\u00a0\u00a0             \u2514\u2500\u2500 glfw\n        \u2502\u00a0\u00a0                 \u251c\u2500\u2500 deps\n        \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u251c\u2500\u2500 glad\n        \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u251c\u2500\u2500 KHR\n        \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u251c\u2500\u2500 mingw\n        \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2514\u2500\u2500 vulkan\n        \u2502\u00a0\u00a0                 \u251c\u2500\u2500 include\n        \u2502\u00a0\u00a0                 \u2502\u00a0\u00a0 \u2514\u2500\u2500 GLFW\n        \u2502\u00a0\u00a0                 \u2514\u2500\u2500 src\n        \u251c\u2500\u2500 golang-ui\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 nuklear\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 assets\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 cmd\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 nk-android\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 android\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 jni\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 assets\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u251c\u2500\u2500 nk-example\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 assets\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 nk-example-sdl2\n        \u2502\u00a0\u00a0     \u2502\u00a0\u00a0     \u2514\u2500\u2500 assets\n        \u2502\u00a0\u00a0     \u2514\u2500\u2500 nk\n        \u2514\u2500\u2500 xlab\n            \u2514\u2500\u2500 closer\n                \u2514\u2500\u2500 cmd\n                    \u251c\u2500\u2500 example\n                    \u251c\u2500\u2500 example-error\n                    \u251c\u2500\u2500 example-fatalln\n                    \u2514\u2500\u2500 example-panic\n</code></pre>\n"}, {"tags": ["go", "garbage-collection"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1531214653, "post_id": 51261162, "comment_id": 89501152, "body": "Golang is garbage collected language it take cares of unreachable objects. But you should still close your file descriptor."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 3, "last_activity_date": 1531315520, "last_edit_date": 1531315520, "creation_date": 1531214032, "answer_id": 51261395, "question_id": 51261162, "link": "https://stackoverflow.com/questions/51261162/does-zip-newreaderbytes-newreader-len-need-to-be-closed-or-garbage-collecte/51261395#51261395", "title": "Does zip.NewReader(bytes.NewReader(), len) need to be closed or garbage collected automatically?", "body": "<p>Golang compiler takes care for <a href=\"https://golang.org/doc/faq#stack_or_heap\" rel=\"nofollow noreferrer\">unreachable variables</a>:-</p>\n\n<blockquote>\n  <p>The storage location does have an effect on writing efficient\n  programs. When possible, the Go compilers will allocate variables that\n  are local to a function in that function's stack frame. However, if\n  the compiler cannot prove that the variable is not referenced after\n  the function returns, then the compiler must allocate the variable on\n  the garbage-collected heap to avoid dangling pointer errors. Also, if\n  a local variable is very large, it might make more sense to store it\n  on the heap rather than the stack.</p>\n</blockquote>\n\n<p>Although Golang contains garbage collection. It would be better to use clean up functions. You can use defer function to close the file at the end of function.</p>\n\n<pre><code>defer f.close()\n</code></pre>\n\n<p>Check Documentation for <a href=\"https://golang.org/pkg/runtime/#SetFinalizer\" rel=\"nofollow noreferrer\">SetFinalizer</a> to get more understanding on these concepts:</p>\n\n<pre><code>func SetFinalizer(obj interface{}, finalizer interface{})\n</code></pre>\n\n<blockquote>\n  <p>SetFinalizer sets the finalizer associated with obj to the provided\n  finalizer function. When the garbage collector finds an unreachable\n  block with an associated finalizer, it clears the association and runs\n  finalizer(obj) in a separate goroutine. This makes obj reachable\n  again, but now without an associated finalizer. Assuming that\n  SetFinalizer is not called again, the next time the garbage collector\n  sees that obj is unreachable, it will free obj.</p>\n</blockquote>\n\n<p>The finalizer runs for an object to check if it is unreachable from the source. It can be used for file descriptors but it would be a mistake to depend on a finalizer to flush an in-memory I/O buffer such as a bufio.Writer, because the buffer would not be flushed at program exit.</p>\n"}], "owner": {"reputation": 3645, "user_id": 306036, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4c1dfd4d4e83c6cdec5ea7045b32bc05?s=128&d=identicon&r=PG", "display_name": "Ryan The Leach", "link": "https://stackoverflow.com/users/306036/ryan-the-leach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1103, "favorite_count": 0, "accepted_answer_id": 51261395, "answer_count": 1, "score": 6, "last_activity_date": 1531402909, "creation_date": 1531213341, "last_edit_date": 1531402909, "question_id": 51261162, "link": "https://stackoverflow.com/questions/51261162/does-zip-newreaderbytes-newreader-len-need-to-be-closed-or-garbage-collecte", "title": "Does zip.NewReader(bytes.NewReader(), len) need to be closed or garbage collected automatically?", "body": "<p>I'm having an argument with a friend, over possible wasted resources in Go.</p>\n\n<p>Does a Reader have to be closed, if it's operating over an in-memory byte array?</p>\n\n<pre><code>func readJar(zipBytes []byte, readMeta bool) (m jar.Manifest, err error) {\n    reader, err := zip.NewReader(bytes.NewReader(zipBytes), int64(len(zipBytes)))\n    if err != nil {\n        return\n    }\n\n    for _, file := range reader.File {\n        switch file.Name {\n        case jar.ManifestPath:\n            m, err = readManifest(file)\n            if err != nil {\n                return\n            }\n        }\n    }\n    return\n}\n\nfunc readManifest(file *zip.File) (jar.Manifest, error) {\n    reader, err := file.Open()\n    if err != nil {\n        return nil, err\n    }\n\n    defer reader.Close()\n    return jar.ReadManifest(reader)\n}\n</code></pre>\n\n<p>Whilst originally it was thought to be a source of File Handle Leaks, something else got the blame.</p>\n\n<p>Will this leak memory, or does Go have sufficient escape analysis / garbage collection that it will be fine?</p>\n"}, {"tags": ["opengl", "go", "packages"], "comments": [{"owner": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1531217764, "post_id": 51260895, "comment_id": 89503232, "body": "You probably don&#39;t have to choose, just install all of them. EGL is low level, GL is what you want, gles1/2 you can skip because that&#39;s for ES, u is util and w is (I think) for windowing. Depending on your GPU, though, there might be an official driver for linux you can install instead."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 36513, "user_id": 752976, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/j7Uis.jpg?s=128&g=1", "display_name": "Bartek Banachewicz", "link": "https://stackoverflow.com/users/752976/bartek-banachewicz"}, "edited": false, "score": 0, "creation_date": 1531221663, "post_id": 51260895, "comment_id": 89505557, "body": "Above error got corrected after creation of a link: <code>sudo ln -s &#47;usr&#47;lib&#47;x86_64-linux-gnu&#47;libGL.so.1.2.0  &#47;usr&#47;lib&#47;libGL.so</code>"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 255, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1531221692, "creation_date": 1531212476, "last_edit_date": 1531221692, "question_id": 51260895, "link": "https://stackoverflow.com/questions/51260895/not-able-to-install-nuklear-library", "title": "Not able to install nuklear library", "body": "<p>I am trying to install <code>nuklear</code> library on <code>Debian Stable Linux</code> with instructions from <a href=\"https://github.com/golang-ui/nuklear\" rel=\"nofollow noreferrer\">https://github.com/golang-ui/nuklear</a></p>\n\n<p>However, I am getting following error:</p>\n\n<pre><code>$ go get github.com/golang-ui/nuklear/nk\n\n# github.com/go-gl/glfw/v3.2/glfw\n/usr/bin/ld: cannot find -lGL\ncollect2: error: ld returned 1 exit status\n# github.com/go-gl/gl/v3.2-core/gl\n/usr/bin/ld: cannot find -lGL\n/usr/bin/ld: cannot find -lGL\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>I have following libGL files on my system: </p>\n\n<pre><code>me@mycomp:/usr/lib$ find | grep libGL\\.so \n\n./i386-linux-gnu/libGL.so.1.2.0\n./i386-linux-gnu/libGL.so.1\n./x86_64-linux-gnu/libGL.so.1.2.0\n./x86_64-linux-gnu/libGL.so.1\n</code></pre>\n\n<p>At one page, it was suggested to install mesa-dev, but I cannot make out how to choose between following which are available:</p>\n\n<pre><code>Package                 Installed       Previous        Now             State\n=======================-===============-===============-===============-=====\nlibegl1-mesa-dev        N/A             13.0.6-1+b2     13.0.6-1+b2    \nlibgl1-mesa-dev         N/A             13.0.6-1+b2     13.0.6-1+b2    \nlibgles1-mesa-dev       N/A             13.0.6-1+b2     13.0.6-1+b2    \nlibgles2-mesa-dev       N/A             13.0.6-1+b2     13.0.6-1+b2    \nlibglu1-mesa-dev        N/A             9.0.0-2.1       9.0.0-2.1      \nlibglw1-mesa-dev        N/A             8.0.0-1.1       8.0.0-1.1      \n</code></pre>\n\n<p>How can this problem be corrected?</p>\n\n<p>Edit: \nThe problem got corrected with following command: </p>\n\n<pre><code>sudo ln -s /usr/lib/x86_64-linux-gnu/libGL.so.1.2.0  /usr/lib/libGL.so\n</code></pre>\n"}, {"tags": ["java", "go", "hmac"], "comments": [{"owner": {"reputation": 67717, "user_id": 2541560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7H9TF.png?s=128&g=1", "display_name": "Kayaman", "link": "https://stackoverflow.com/users/2541560/kayaman"}, "edited": false, "score": 0, "creation_date": 1531207924, "post_id": 51259453, "comment_id": 89497324, "body": "Did you mean to parse <code>signKey</code> as hex? Now you&#39;re converting the individual characters to bytes which doesn&#39;t sound like something you want to do."}, {"owner": {"reputation": 23, "user_id": 10057694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbc74202761782117296c15e3ff9c82f?s=128&d=identicon&r=PG&f=1", "display_name": "Jose", "link": "https://stackoverflow.com/users/10057694/jose"}, "reply_to_user": {"reputation": 67717, "user_id": 2541560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7H9TF.png?s=128&g=1", "display_name": "Kayaman", "link": "https://stackoverflow.com/users/2541560/kayaman"}, "edited": false, "score": 0, "creation_date": 1531209068, "post_id": 51259453, "comment_id": 89497901, "body": "As I understand Go it is converted straight from String to byte[] without base64. see ` []byte(signKey)`  .I understand that signKey looks like Hex, but I believe this is not Hex."}, {"owner": {"reputation": 67717, "user_id": 2541560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7H9TF.png?s=128&g=1", "display_name": "Kayaman", "link": "https://stackoverflow.com/users/2541560/kayaman"}, "edited": false, "score": 0, "creation_date": 1531209466, "post_id": 51259453, "comment_id": 89498097, "body": "Why would you believe that&#39;s not hexadecimal? I can&#39;t imagine any programmer looking at the value and not thinking &quot;that&#39;s binary data encoded in hexadecimal&quot;. I&#39;m not familiar with Go, but you could have the same bug in both codes."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1531212035, "post_id": 51259453, "comment_id": 89499550, "body": "Any chance that the error is due to calling <code>hmacSha1</code> in Java? I mean, look at how much shorter the generated string is - it looks like it&#39;s probably half the length of the go one. You&#39;re probably not doing sha256."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1531215413, "post_id": 51259453, "comment_id": 89501701, "body": "What is the <code>UTF_8</code> value you&#39;re passing to <code>putString()</code> in Java?"}, {"owner": {"reputation": 23, "user_id": 10057694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbc74202761782117296c15e3ff9c82f?s=128&d=identicon&r=PG&f=1", "display_name": "Jose", "link": "https://stackoverflow.com/users/10057694/jose"}, "edited": false, "score": 0, "creation_date": 1531218891, "post_id": 51259453, "comment_id": 89503948, "body": "public static final Charset UTF_8 = Charset.forName(&quot;UTF-8&quot;);"}, {"owner": {"reputation": 23625, "user_id": 2868801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ec5567811049b7ce8192be0bc0246d1?s=128&d=identicon&r=PG&f=1", "display_name": "dave_thompson_085", "link": "https://stackoverflow.com/users/2868801/dave-thompson-085"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1531219042, "post_id": 51259453, "comment_id": 89504021, "body": "@icza: the strings here contain only ASCII chars and their encoding on any JavaSE platform is not affected by the charset -- although <i>other</i> strings could be."}, {"owner": {"reputation": 991, "user_id": 1061927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc0ad4a66f66d793ea39a35ddacbcb45?s=128&d=identicon&r=PG", "display_name": "Dynom", "link": "https://stackoverflow.com/users/1061927/dynom"}, "reply_to_user": {"reputation": 67717, "user_id": 2541560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7H9TF.png?s=128&g=1", "display_name": "Kayaman", "link": "https://stackoverflow.com/users/2541560/kayaman"}, "edited": false, "score": 0, "creation_date": 1531311462, "post_id": 51259453, "comment_id": 89547794, "body": "@Kayaman <code>signKey</code> is a string, it&#39;s not a base16 number. I&#39;m not sure what your (in)familiarity with Go has to do with that. In Go strings are (basically) immutable  byte slices, so type-casting a string to a byte slice works quite well."}, {"owner": {"reputation": 67717, "user_id": 2541560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7H9TF.png?s=128&g=1", "display_name": "Kayaman", "link": "https://stackoverflow.com/users/2541560/kayaman"}, "reply_to_user": {"reputation": 991, "user_id": 1061927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc0ad4a66f66d793ea39a35ddacbcb45?s=128&d=identicon&r=PG", "display_name": "Dynom", "link": "https://stackoverflow.com/users/1061927/dynom"}, "edited": false, "score": 0, "creation_date": 1531312323, "post_id": 51259453, "comment_id": 89548456, "body": "@Dynom I know the <b>type</b> is String, but the contents are hexadecimal. That usually means the String will be <i>parsed</i> into bytes, not converted into bytes. Especially if you&#39;re working with cryptographic keys. Now each byte can have 16 values instead of the normal 256. That&#39;s not something you want to see in cryptographic code."}], "answers": [{"tags": [], "owner": {"reputation": 23625, "user_id": 2868801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ec5567811049b7ce8192be0bc0246d1?s=128&d=identicon&r=PG&f=1", "display_name": "dave_thompson_085", "link": "https://stackoverflow.com/users/2868801/dave-thompson-085"}, "is_accepted": true, "score": 1, "last_activity_date": 1531218920, "creation_date": 1531218920, "answer_id": 51263044, "question_id": 51259453, "link": "https://stackoverflow.com/questions/51259453/hmacsha256-signature-generated-is-different-in-java-than-in-go/51263044#51263044", "title": "HmacSha256 signature generated is different in Java than in Go", "body": "<p>I don't know what <code>Hashing</code> class you are using in Java, because it isn't standard, but if I use the standard class <code>javax.crypto.Mac</code> to do HmacSHA256 (NOT HmacSHA1) with that key and data -- and encode with the 'unpadded URLsafe' variant of Base64 promoted by JSON, not the traditional one Java defaults to -- I do get <code>ruEWRoFO-ic-L38vTsjqIYE6DLZ532CTaZXOh1gwuVo</code>.</p>\n\n<p>However, it is very poor practice to sign the path and query without some delimiting -- this may allow a signature to be 'moved' to different data. It is also weird, though not directly dangerous, to use a key that is characters but only hex digit characters. I wouldn't use a scheme designed like this for anything important without extensive investigation. </p>\n"}, {"comments": [{"owner": {"reputation": 67717, "user_id": 2541560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7H9TF.png?s=128&g=1", "display_name": "Kayaman", "link": "https://stackoverflow.com/users/2541560/kayaman"}, "edited": false, "score": 1, "creation_date": 1531313735, "post_id": 51263317, "comment_id": 89549465, "body": "Note that the <i>effective</i> size of <code>signKey</code> is 128 bits since each character is limited to 4 bits (<code>0-f</code>). This is what we call a security flaw."}], "tags": [], "owner": {"reputation": 23, "user_id": 10057694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbc74202761782117296c15e3ff9c82f?s=128&d=identicon&r=PG&f=1", "display_name": "Jose", "link": "https://stackoverflow.com/users/10057694/jose"}, "is_accepted": false, "score": 0, "last_activity_date": 1531219790, "creation_date": 1531219790, "answer_id": 51263317, "question_id": 51259453, "link": "https://stackoverflow.com/questions/51259453/hmacsha256-signature-generated-is-different-in-java-than-in-go/51263317#51263317", "title": "HmacSha256 signature generated is different in Java than in Go", "body": "<p>For future reference, here is the final WORKING solution</p>\n\n<pre><code>package hashingImaginary;\n\nimport org.apache.commons.codec.binary.Base64;\nimport org.junit.Assert;\nimport org.junit.Test;\n\nimport javax.crypto.Mac;\nimport javax.crypto.spec.SecretKeySpec;\n\npublic class apacheHashingTest {\n\n@Test\npublic void testWithJavaHmacApacheBase64() throws Exception {\n    String urlPath = \"/resize\";\n    String urlQuery = \"file=image.jpg&amp;height=200&amp;type=jpeg&amp;width=300\";\n\n    String signKey = \"4f46feebafc4b5e988f131c4ff8b5997\";\n    String message = urlPath + urlQuery;\n\n    Mac sha256_HMAC = Mac.getInstance(\"HmacSHA256\");\n    SecretKeySpec secret_key = new SecretKeySpec(signKey.getBytes(), \"HmacSHA256\");\n    sha256_HMAC.init(secret_key);\n\n    String hash = Base64.encodeBase64URLSafeString(sha256_HMAC.doFinal(message.getBytes()));\n    System.out.println(hash);\n\n    Assert.assertEquals(\"ruEWRoFO-ic-L38vTsjqIYE6DLZ532CTaZXOh1gwuVo\", hash);\n}\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 10057694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbc74202761782117296c15e3ff9c82f?s=128&d=identicon&r=PG&f=1", "display_name": "Jose", "link": "https://stackoverflow.com/users/10057694/jose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2501, "favorite_count": 0, "accepted_answer_id": 51263044, "answer_count": 2, "score": 2, "last_activity_date": 1531226565, "creation_date": 1531207735, "last_edit_date": 1531226565, "question_id": 51259453, "link": "https://stackoverflow.com/questions/51259453/hmacsha256-signature-generated-is-different-in-java-than-in-go", "title": "HmacSha256 signature generated is different in Java than in Go", "body": "<p>I'm converting code from Go to Java. The source to convert is at <a href=\"https://github.com/h2non/imaginary#url-signature\" rel=\"nofollow noreferrer\">https://github.com/h2non/imaginary#url-signature</a> and this is my current code converted to Java.</p>\n\n<p>The problem is that I'm missing something, since the signature generated in Java is different than the one in Go.</p>\n\n<p>Expected result (as in source in Go):</p>\n\n<blockquote>\n  <p>ruEWRoFO-ic-L38vTsjqIYE6DLZ532CTaZXOh1gwuVo</p>\n</blockquote>\n\n<p>Actual result in Java:   </p>\n\n<blockquote>\n  <p>x2clz4ynSxcFPNc6h3W832vyrIQ=</p>\n</blockquote>\n\n<p>My code in Java:</p>\n\n<pre><code>@Test\npublic void testSomeString() throws Exception {\n    String signKey = \"4f46feebafc4b5e988f131c4ff8b5997\";\n    String urlPath = \"/resize\";\n    String urlQuery = \"file=image.jpg&amp;height=200&amp;type=jpeg&amp;width=300\";\n\n    byte[] signKeyAsBytes = signKey.getBytes(\"UTF-8\");\n    SecretKey SHA256_KEY = new SecretKeySpec(signKeyAsBytes, \"HmacSHA256\");\n\n    byte[] hashAsBytes=Hashing.hmacSha1(SHA256_KEY)\n            .newHasher()\n            .putString(urlPath, UTF_8)\n            .putString(urlQuery, UTF_8)\n            .hash().asBytes();\n    String hash = Base64.getUrlEncoder().encodeToString(hashAsBytes);\n\n    //correct value in GoLang is: \"ruEWRoFO-ic-L38vTsjqIYE6DLZ532CTaZXOh1gwuVo\"\n    Assert.assertEquals(\"ruEWRoFO-ic-L38vTsjqIYE6DLZ532CTaZXOh1gwuVo\", hash);\n\n    /*\n    Junit test fails with:\n    Expected :ruEWRoFO-ic-L38vTsjqIYE6DLZ532CTaZXOh1gwuVo\n    Actual   :x2clz4ynSxcFPNc6h3W832vyrIQ=\n    */\n}\n</code></pre>\n\n<p>And this is the original in Go:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/hmac\"\n    \"crypto/sha256\"\n    \"encoding/base64\"\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    signKey := \"4f46feebafc4b5e988f131c4ff8b5997\"\n    urlPath := \"/resize\"\n    urlQuery := \"file=image.jpg&amp;height=200&amp;type=jpeg&amp;width=300\"\n\n    h := hmac.New(sha256.New, []byte(signKey))\n    h.Write([]byte(urlPath))\n    h.Write([]byte(urlQuery))\n    buf := h.Sum(nil)\n\n    fmt.Println(\"sign=\" + base64.RawURLEncoding.EncodeToString(buf))\n}\n</code></pre>\n"}, {"tags": ["go", "xml-parsing", "html-parsing"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1531228511, "post_id": 51259335, "comment_id": 89510471, "body": "The first results I get in Google for golang xml/html parser are <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/xml</a> (<code>encoding&#47;xml</code> in the standard library) and <a href=\"https://godoc.org/golang.org/x/net/html\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/net/html</a> (<code>net&#47;html</code> subrepo) respectively."}], "answers": [{"tags": [], "owner": {"reputation": 1966, "user_id": 1392312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/WTTkb.png?s=128&g=1", "display_name": "Rossiar", "link": "https://stackoverflow.com/users/1392312/rossiar"}, "is_accepted": false, "score": 2, "last_activity_date": 1531217008, "creation_date": 1531217008, "answer_id": 51262411, "question_id": 51259335, "link": "https://stackoverflow.com/questions/51259335/unable-to-parse-values-in-go-code/51262411#51262411", "title": "Unable to parse values in Go code", "body": "<p>GO has an xml parsing library <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/xml/</a></p>\n\n<p>I have a runnable example here: <a href=\"https://play.golang.org/p/kVG3w4iu3Kl\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kVG3w4iu3Kl</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/xml\"\n)\n\nvar rawXml = \"&lt;metrics coveredelements=\\\"45\\\" complexity=\\\"37\\\" loc=\\\"459\\\" methods=\\\"33\\\"/&gt;\"\n\ntype Metrics struct {\n    CoveredElements string `xml:\"coveredelements,attr\"`\n    Complexity      string `xml:\"complexity,attr\"`\n    Loc             string `xml:\"loc,attr\"`\n    Methods         string `xml:\"methods,attr\"`\n}\n\nfunc main() {\n    data := &amp;Metrics{}\n    xml.Unmarshal([]byte(rawXml), data)\n    fmt.Printf(\"%+v\", data)\n}\n</code></pre>\n\n<p>I think that you will find it much easier to work with structs.</p>\n"}, {"tags": [], "owner": {"reputation": 804, "user_id": 6875688, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e46e6b2da3f3fc933ea112f88e4a3a1d?s=128&d=identicon&r=PG", "display_name": "Hugo L.M", "link": "https://stackoverflow.com/users/6875688/hugo-l-m"}, "is_accepted": false, "score": 0, "last_activity_date": 1534763663, "creation_date": 1534763663, "answer_id": 51929556, "question_id": 51259335, "link": "https://stackoverflow.com/questions/51259335/unable-to-parse-values-in-go-code/51929556#51929556", "title": "Unable to parse values in Go code", "body": "<p>I have found this utility to allow me to implement the necessary structures to parse the JSON answers (you can use a converter ). I hope you find it useful too:</p>\n\n<p><a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a></p>\n\n<p>You can use a JSON/XML converter online like this: <a href=\"http://www.utilities-online.info/xmltojson/#.W1cSCNIzZPY\" rel=\"nofollow noreferrer\">http://www.utilities-online.info/xmltojson/#.W1cSCNIzZPY</a>.</p>\n\n<p>For the rest I use the same what @Rossiar said in his comment.</p>\n"}], "owner": {"reputation": 804, "user_id": 6875688, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e46e6b2da3f3fc933ea112f88e4a3a1d?s=128&d=identicon&r=PG", "display_name": "Hugo L.M", "link": "https://stackoverflow.com/users/6875688/hugo-l-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1534763663, "creation_date": 1531207257, "last_edit_date": 1531209296, "question_id": 51259335, "link": "https://stackoverflow.com/questions/51259335/unable-to-parse-values-in-go-code", "title": "Unable to parse values in Go code", "body": "<p>I am starting to use Go and have found that to parse an html or xml document does not have a powerful tool by itself (excuse my ignorance if not).</p>\n\n<p>The fact is that I have the following map (I converted the xml to a map using github.com/clbanning/mxj). It's a XML and HTML Clover report.</p>\n\n<p>What I want is access to the different values: <a href=\"https://pastebin.com/46cZNwGC\" rel=\"nofollow noreferrer\">XML pastebin</a></p>\n\n<p>My code:</p>\n\n<pre><code>    xmlFile, err := os.Open(dir + \"\\\\clover.xml\")\n    if err != nil {\n        fmt.Println(\"Error opening file:\", err)\n        return\n    }\n    b, _ := ioutil.ReadAll(xmlFile)\n    defer xmlFile.Close()\n                fmt.Println(\"xmldata:\", string(b))\n\n    // get all image tag values - []interface{}\n    mapvalue, merr := mxj.NewMapXml(b)\n    if merr != nil {\n        fmt.Println(\"merr:\", merr.Error())\n        return\n    }\n</code></pre>\n\n<p>Even in the following way I can subdivide it:</p>\n\n<pre><code>    sources, err := mapvalue.ValuesForKey(\"metrics\")\n    if err != nil {\n        fmt.Println(\"err:\", err.Error())\n        return\n    }\n\n    for i, src := range sources {\n        fmt.Println(i, src)\n    }\n\n\n    fmt.Println(sources[0])\n</code></pre>\n\n<p>It's that particular one I need. But now I can't access every one of the inner values. </p>\n\n<blockquote>\n  <p>map[-loc:459 -statements:71 -coveredmethods:14 -ncloc:307 -files:12\n  -conditionals:6 -coveredelements:45 -packages:8 -elements:110 -complexity:37 -classes:12 -coveredconditionals:1 -coveredstatements:30 -methods:33]</p>\n</blockquote>\n\n<p>Is there an easier way to work with the XML and html I have in local?</p>\n\n<p>I added the XML to map result: <a href=\"https://pastebin.com/7QNH0TFA\" rel=\"nofollow noreferrer\">pastebin</a> </p>\n"}, {"tags": ["go", "gorequest"], "answers": [{"tags": [], "owner": {"reputation": 1024, "user_id": 2702306, "user_type": "registered", "accept_rate": 32, "profile_image": "https://i.stack.imgur.com/FlJhs.jpg?s=128&g=1", "display_name": "IhtkaS", "link": "https://stackoverflow.com/users/2702306/ihtkas"}, "is_accepted": false, "score": 0, "last_activity_date": 1531214827, "creation_date": 1531214827, "answer_id": 51261677, "question_id": 51259285, "link": "https://stackoverflow.com/questions/51259285/append-raw-goreq-body-response-to-file/51261677#51261677", "title": "Append raw Goreq.body response to file", "body": "<p>You can use fileObj.WriteAt(content, offSet) to append content to the file. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    fmt.Println(\"test\")\n    f, err := os.Create(\"/Users/sakthi-2528/test/test213123.txt\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    n, err := f.WriteAt([]byte(\"Foo\"), 0)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    off := n\n    n, err = f.WriteAt([]byte(\"Bar\"), int64(off))\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    off += n\n    _, err = f.WriteAt([]byte(\"FooBar\"), int64(off))\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer f.Close()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1928, "user_id": 4364847, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/pcepW.png?s=128&g=1", "display_name": "MadzQuestioning", "link": "https://stackoverflow.com/users/4364847/madzquestioning"}, "is_accepted": true, "score": 0, "last_activity_date": 1531463852, "creation_date": 1531463852, "answer_id": 51319014, "question_id": 51259285, "link": "https://stackoverflow.com/questions/51259285/append-raw-goreq-body-response-to-file/51319014#51319014", "title": "Append raw Goreq.body response to file", "body": "<p>Ok found the answer it seems that I don't need to do anything fancy. I just have to use io.copy and that's it. Just for reference for others having the same issue below is my code</p>\n\n<pre><code>newFile := \"./newfile.gz\"\nout, err := os.Create(newFile)\ndefer out.close()   \n\nif err != nil {\n   fmt.Println(\"Failed to download file\")\n   return\n}\n\nfor i := 0; i &lt; 10; i++ {\n    // This will return the items in part of 100mb/part. \n    // GetRawDataFromEbay returns a goreq.body(raw) as its response\n    response, _ = GetRawDataFromEbay(10485760) \n    io.Copy(file, response) // Where file is an instance of *os.File\n}\n</code></pre>\n\n<p>So basically if the Goreq.body response is in by part when you copy the different response (in part) in the same file it will append it automatically</p>\n"}], "owner": {"reputation": 1928, "user_id": 4364847, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/pcepW.png?s=128&g=1", "display_name": "MadzQuestioning", "link": "https://stackoverflow.com/users/4364847/madzquestioning"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 51319014, "answer_count": 2, "score": 1, "last_activity_date": 1531463852, "creation_date": 1531207057, "question_id": 51259285, "link": "https://stackoverflow.com/questions/51259285/append-raw-goreq-body-response-to-file", "title": "Append raw Goreq.body response to file", "body": "<p>Hi I would like to append a downloaded file raw response to a file. Supposed that I'm trying to download a 1GB file and download process will be done in multiple request. Let say 100mb per request. Now this all the 10 parts should be put into one single file to be read. I don't know how to achieve this. I'm using GOREQ to request this resource and the raw data is in Goreq.body format. Below is my sample code</p>\n\n<pre><code>newFile := \"./newfile.gz\"\nout, err := os.Create(newFile)\ndefer out.close()  \n\nif err != nil {\n    fmt.Println(\"Failed to download file\")\n    return\n}\n\nfor i := 0; i &lt; 10; i++ {\n    // This will return the items in part of 100mb/part. \n    // GetRawDataFromEbay returns a goreq.body(raw) as its response\n    response, _ = GetRawDataFromEbay(10485760) \n\n    out.Write(response) // This does not work\n}\n</code></pre>\n\n<p>I know <strong>Write</strong> accept []byte as parameter. But how can I append the retrieve goreq.body raw data to a file?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1531209669, "post_id": 51258952, "comment_id": 89498203, "body": "These two are completely unrelated. So you may use both."}, {"owner": {"reputation": 163, "user_id": 4213218, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ifd1s.png?s=128&g=1", "display_name": "mi&#225;o", "link": "https://stackoverflow.com/users/4213218/mi%c3%a1o"}, "edited": false, "score": 0, "creation_date": 1573383499, "post_id": 51258952, "comment_id": 103858010, "body": "Also see: <a href=\"https://stackoverflow.com/q/53051253/4213218\">stackoverflow.com/q/53051253/4213218</a>"}], "answers": [{"comments": [{"owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1531209797, "post_id": 51259258, "comment_id": 89498275, "body": "Thanks for your comment. Judging by @Zak&#39;s comment and graph, <code>http.TimeoutHandler</code> should be covered by the the <code>http.Server.WriteTimeout</code>. Does that make sense?"}, {"owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "reply_to_user": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 1, "creation_date": 1531210897, "post_id": 51259258, "comment_id": 89498890, "body": "@mattes, No, <code>TimeoutHandler</code> handles the case where your handler (code block that handles http request) need to be complete in set amount of time, while <code>WriteTimeout</code> is used when you dont want to wait for network write indefinitely."}, {"owner": {"reputation": 125, "user_id": 7973864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01b086a0c6af41aecf13d612617fc21c?s=128&d=identicon&r=PG&f=1", "display_name": "Souji Tendo", "link": "https://stackoverflow.com/users/7973864/souji-tendo"}, "edited": false, "score": 0, "creation_date": 1582960664, "post_id": 51259258, "comment_id": 106963441, "body": "@desaiparth hi, I&#39;m using <code>http.TimeoutHandler</code> and after it return status <code>503</code>, the handler (code block that handles http request) still executing. How can I terminate the execution of handler?"}], "tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": true, "score": 8, "last_activity_date": 1531211106, "last_edit_date": 1531211106, "creation_date": 1531206965, "answer_id": 51259258, "question_id": 51258952, "link": "https://stackoverflow.com/questions/51258952/use-http-timeouthandler-or-readtimeout-writetimeout/51259258#51259258", "title": "Use http.TimeoutHandler or ReadTimeout/WriteTimeout?", "body": "<p><strong>These two deal with different aspects of http request/response lifecycle.</strong></p>\n\n<p><code>http.TimeoutHandler</code> is used to limit execution time of the http.Handler. it will return <code>503</code> status code <em>to the client</em>, if <code>http.Handler</code> doesn't finish in stipulated time.  </p>\n\n<p>While, <code>ReadTimeout</code> and <code>WriteTimeout</code> deals with network I/O timeout, i.e time required to read/write request/response body <em>to your client</em> respectively. </p>\n\n<p>So, <code>http.TimeoutHandler</code> handles the case where your handler (code block that handles http request) need to be complete in set amount of time, by wrapping your original handler. while <code>http.WriteTimeout</code> or <code>http.ReadTimeout</code> is used when you dont want to wait for network read/write of request/response indefinitely.</p>\n"}, {"comments": [{"owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1531210146, "post_id": 51259260, "comment_id": 89498452, "body": "Thanks @Zak! The use case is to limit the time a <code>http.Handler</code> can run. It seems as if I don&#39;t have to set <code>http.TimeoutHandler</code> if I set <code>http.Server.ReadTimeout</code> and <code>http.Server.WriteTimeout</code> instead. Do you agree?"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 1, "creation_date": 1531211022, "post_id": 51259260, "comment_id": 89498962, "body": "Yes, I agree that setting read and write timeouts on the server is important. If the code is easy to include, I can see an argument for the added flexibility and control that you could have by using <code>http.TimeoutHandler</code> to enforce this case. But as already discussed, I think it&#39;s not strictly necessary if you have timeouts in other places. I think that the server timeouts are to defend against unresponsive clients, and the <code>httpTimeoutHandler</code> is to defend against slow handlers. In your case, I think you are worried about the slow handler?"}, {"owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1531212176, "post_id": 51259260, "comment_id": 89499629, "body": "That makes a lot of sense now. Thanks for clearing up the confusion."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 5, "last_activity_date": 1531206970, "creation_date": 1531206970, "answer_id": 51259260, "question_id": 51258952, "link": "https://stackoverflow.com/questions/51258952/use-http-timeouthandler-or-readtimeout-writetimeout/51259260#51259260", "title": "Use http.TimeoutHandler or ReadTimeout/WriteTimeout?", "body": "<p>This blog article does a good job of explaining, but essentially they fulfil slightly different roles, as demonstrated here:</p>\n\n<p><a href=\"https://i.stack.imgur.com/9CLAE.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/9CLAE.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://blog.cloudflare.com/the-complete-guide-to-golang-net-http-timeouts/\" rel=\"noreferrer\">Link to blog article</a></p>\n\n<p>You've not included what your usecase is, but hopefully this is enough information to be able to make a decision.</p>\n"}, {"comments": [{"owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1531209915, "post_id": 51259272, "comment_id": 89498340, "body": "Thanks. I read this blog post. I want to add that it seems important to eventually provide a custom <code>TCPListener</code> as well to override the 3 minutes default KeepAlive Timeout to something shorter. Source: <a href=\"https://blog.gopheracademy.com/advent-2016/exposing-go-on-the-internet/\" rel=\"nofollow noreferrer\">blog.gopheracademy.com/advent-2016/exposing-go-on-the-intern&zwnj;&#8203;et</a>"}, {"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 1, "creation_date": 1543147089, "post_id": 51259272, "comment_id": 93805028, "body": "If you sed <code>ReadTimeout</code> = 5s, how you can upload large file to the server? For example you need to upload 10mb image file, it takes 30s. So it would failed to serve?"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "reply_to_user": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 1, "creation_date": 1543163729, "post_id": 51259272, "comment_id": 93809686, "body": "@TomSawyer check this post/gist <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/NBhJqZe25EA\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/NBhJqZe25EA</a>, <a href=\"https://gist.github.com/jbardin/9663312\" rel=\"nofollow noreferrer\">gist.github.com/jbardin/9663312</a> it could give you some ideas"}], "tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": 1, "last_activity_date": 1531207009, "creation_date": 1531207009, "answer_id": 51259272, "question_id": 51258952, "link": "https://stackoverflow.com/questions/51258952/use-http-timeouthandler-or-readtimeout-writetimeout/51259272#51259272", "title": "Use http.TimeoutHandler or ReadTimeout/WriteTimeout?", "body": "<p>If you are going to expose your app naked (directly) no HAproxy/Nginx in front, changing the defaults may help, for example (fine-tune them based on your requirements):</p>\n\n<pre><code>// configure server\nsrv := &amp;http.Server{\n    Addr:           \":8080\",\n    Handler:        router,\n    ReadTimeout:    5 * time.Second,\n    WriteTimeout:   7 * time.Second,\n    MaxHeaderBytes: 1 &lt;&lt; 20,\n}\nlog.Fatal(srv.ListenAndServe())\n</code></pre>\n\n<p>Here is a very nice article explaining more about the topic: <a href=\"https://blog.cloudflare.com/the-complete-guide-to-golang-net-http-timeouts/\" rel=\"nofollow noreferrer\">https://blog.cloudflare.com/the-complete-guide-to-golang-net-http-timeouts/</a></p>\n"}], "owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3556, "favorite_count": 3, "accepted_answer_id": 51259258, "answer_count": 3, "score": 4, "last_activity_date": 1531211106, "creation_date": 1531205866, "last_edit_date": 1531209513, "question_id": 51258952, "link": "https://stackoverflow.com/questions/51258952/use-http-timeouthandler-or-readtimeout-writetimeout", "title": "Use http.TimeoutHandler or ReadTimeout/WriteTimeout?", "body": "<p>Does it make sense to additionally use <a href=\"https://golang.org/pkg/net/http/#TimeoutHandler\" rel=\"nofollow noreferrer\">http.TimeoutHandler</a> if I already set the <a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"nofollow noreferrer\">server's</a> ReadTimeout and WriteTimeout? It seems as if this scenario is mutually exclusive?</p>\n"}, {"tags": ["go", "code-duplication"], "comments": [{"owner": {"reputation": 216, "user_id": 5039386, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y1c-Clsbdkw/AAAAAAAAAAI/AAAAAAAAAKA/WFHwWVc3h_I/photo.jpg?sz=128", "display_name": "Hau Ma", "link": "https://stackoverflow.com/users/5039386/hau-ma"}, "edited": false, "score": 0, "creation_date": 1531201241, "post_id": 51257861, "comment_id": 89494415, "body": "Why dont you just pass <code>time.Time</code> to CheckBirthday Function?"}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "reply_to_user": {"reputation": 216, "user_id": 5039386, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y1c-Clsbdkw/AAAAAAAAAAI/AAAAAAAAAKA/WFHwWVc3h_I/photo.jpg?sz=128", "display_name": "Hau Ma", "link": "https://stackoverflow.com/users/5039386/hau-ma"}, "edited": false, "score": 0, "creation_date": 1531201322, "post_id": 51257861, "comment_id": 89494450, "body": "@Hau Ma The above codes have been simplified to illustrate the problem. This can also happen for more complex code."}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1531201575, "post_id": 51257861, "comment_id": 89494531, "body": "How about using a single person and not gendered code. Makes more sense."}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "reply_to_user": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1531201660, "post_id": 51257861, "comment_id": 89494554, "body": "@Derek Hmm... I may need to revise my code samples to better illustrate the problem. Sorry for the confusion. Will update the samples in a few minutes."}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1531201715, "post_id": 51257861, "comment_id": 89494574, "body": "Yeah, I suggest providing an example that is as close to the problem as you can"}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 0, "creation_date": 1531202515, "post_id": 51257861, "comment_id": 89494834, "body": "Done! Hopefully the updated codes can better illustrate my situation. Thanks!"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1531203075, "post_id": 51257861, "comment_id": 89495026, "body": "Use a function to abstract common code:  <code>func CheckBirthday(date time.Time, name string, birthday time.Time, thing string) int</code>.   Call it from <code>CheckBirthDayGirl</code> and <code>CheckBirthDayBoy</code> with appropriate arguments."}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1531203621, "post_id": 51257861, "comment_id": 89495218, "body": "@ThunderCat Looks like this is the only option in Go, huh?  I just thought of a similar scenario, this time involving struct slices.  Instead of creating 2 or more functions for something that prints the Name for each element in a Boy/Girl slice, I should just create 1 function that accepts a string slice which can be supplied from a Boy/Girl slice. Sounds good?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1531204317, "post_id": 51257861, "comment_id": 89495509, "body": "Another option is to use interfaces, but that&#39;s ruled out in the question for reasons that I don&#39;t understand."}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1531204517, "post_id": 51257861, "comment_id": 89495614, "body": "@ThunderCat I ruled out Interfaces because I do not think that the structs needed them, but looking at it again, they are indeed another valid solution. Let me add this note to the question. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 0, "creation_date": 1531203877, "post_id": 51258416, "comment_id": 89495323, "body": "I thought about this as well, but didn&#39;t plan on using it as it can get pretty unmanageable in the long run. Thanks for suggesting, though!"}], "tags": [], "owner": {"reputation": 823, "user_id": 3807226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/968fa2c7813b5007f1099a0d1d23e75f?s=128&d=identicon&r=PG&f=1", "display_name": "Chun Liu", "link": "https://stackoverflow.com/users/3807226/chun-liu"}, "is_accepted": false, "score": 2, "last_activity_date": 1531203762, "creation_date": 1531203762, "answer_id": 51258416, "question_id": 51257861, "link": "https://stackoverflow.com/questions/51257861/prevent-duplicate-functions-in-go-for-field-only-structs/51258416#51258416", "title": "Prevent Duplicate Functions in Go for Field-Only Structs", "body": "<p>Would type switch work for you? </p>\n\n<pre><code>func CheckBirthDay(date time.Time, i interface{}) int {\n    switch v := i.(type) {\n    case Boy:\n      CheckBirthDay(date, v.Birthday)\n    case Girl:\n      CheckBirthDay(date, v.Birthday)\n    default:\n      DoSomething()\n    }\n}\n\nfunc CheckBirthDay(date time.Time, bday time.Time) int {\n    ...\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1531203936, "post_id": 51258421, "comment_id": 89495348, "body": "Note that some of the text doesn&#39;t read well anymore, since &quot;Here is a Purple to cheer you up&quot; is nonsense, but the technique is sound."}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 0, "creation_date": 1531203983, "post_id": 51258421, "comment_id": 89495364, "body": "Yeah, looks like this is the best option we&#39;ve got (since type switching and assertion can get pretty crazy when your types increase) until the Go developers add generics to the language (which may never happen since it does tend to add abstraction/complexity). Thanks to you and @ThunderCat for the answer!"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 0, "creation_date": 1531204046, "post_id": 51258421, "comment_id": 89495388, "body": "@FloatingSunfish coming from Python and Haskell I agree. Generics are massively powerful, but also remove a lot of type safety you can guarantee in Go (at least without Haskell&#39;s overpowered type system!)"}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 5, "last_activity_date": 1531203776, "creation_date": 1531203776, "answer_id": 51258421, "question_id": 51257861, "link": "https://stackoverflow.com/questions/51257861/prevent-duplicate-functions-in-go-for-field-only-structs/51258421#51258421", "title": "Prevent Duplicate Functions in Go for Field-Only Structs", "body": "<p>As ThunderCat mentions in the comments: pull common code into a separate function and call.</p>\n\n<pre><code>func CheckBirthday(date, birthdate time.Time, name, gift string) (numDays int) {\n    if date.Before(birthdate) {\n        // Greet how many days before birthday\n        numDays = int(birthdate.Sub(date).Hours() / 24)\n        fmt.Printf(\"Hi, %s! Only %d days until your birthday! I hear your favorite is %s!\\n\", name, numDays, gift)\n    } else if date.Equal(birthdate) {\n        // Greet happy birthday\n        fmt.Printf(\"Happy birthday, %s! I brought you a %s as a present!\\n\", name, gift)\n    } else {\n        // Greet belated birthday\n        numDays = int(date.Sub(girl.birthday).Hours() / 24)\n        fmt.Printf(\"Sorry I'm %d days late, %s! Here is a %s to cheer you up!\\n\", numDays, name, gift)\n    }\n\n    return\n}\n\nfunc CheckBirthdayBoy(date time.Time, boy Boy) int {\n    return CheckBirthday(date, boy.BirthDay, boy.Name, boy.FavoriteColor)\n}\n\nfunc CheckBirthdayGirl(date time.Time, girl Girl) int {\n    return CheckBirthday(date, girl.BirthDay, girl.Name, girl.FavoriteFlower)\n}\n</code></pre>\n"}], "owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "accepted_answer_id": 51258421, "answer_count": 2, "score": 3, "last_activity_date": 1531204634, "creation_date": 1531200967, "last_edit_date": 1531204634, "question_id": 51257861, "link": "https://stackoverflow.com/questions/51257861/prevent-duplicate-functions-in-go-for-field-only-structs", "title": "Prevent Duplicate Functions in Go for Field-Only Structs", "body": "<p>EDIT: I have updated the below code samples to better illustrate the problem.</p>\n\n<p>Let's say I have 2 field-only structs that do not need any functionality.</p>\n\n<p>Assume that they represent 2 types of similar data from a Database:</p>\n\n<pre><code>type Boy struct {\n    Name          string\n    FavoriteColor string\n    BirthDay      time.Time\n}\n\ntype Girl struct {\n    Name           string\n    FavoriteFlower string\n    BirthDay       time.Time\n}\n</code></pre>\n\n<p>I write a function for the <code>Boy</code> struct that prints a greeting based on the given date and the boy's information.</p>\n\n<p>Assume that this is a placeholder for a much more complicated function that does something based on a <code>time.Time</code> field, and returns an <code>int</code> that will be used elsewhere in the application:</p>\n\n<pre><code>func CheckBirthDayBoy(date time.Time, boy Boy) int {\n    numDays := 0\n\n    if date.Before(boy.BirthDay) {\n        // Greet how many days before birthday\n        numDays = int(boy.BirthDay.Sub(date).Hours() / 24)\n        fmt.Println(\"Hi, \" + boy.Name + \"! Only \" + strconv.Itoa(numDays) + \" days until your birthday! I hear your favorite color is \" + boy.FavoriteColor + \"!\")\n    } else if date.Equal(boy.BirthDay) {\n        // Greet happy birthday\n        fmt.Println(\"Happy birthday, \" + boy.Name + \"! I brought you something \" + boy.FavoriteColor + \" as a present!\")\n    } else {\n        // Greet belated birthday\n        numDays = int(date.Sub(boy.BirthDay).Hours() / 24)\n        fmt.Println(\"Sorry I'm \" + strconv.Itoa(numDays) + \" days late, \" + boy.Name + \"! Here is something \" + boy.FavoriteColor + \" to cheer you up!\")\n    }\n\n    return numDays\n}\n</code></pre>\n\n<p>Now, since Go is a strongly-typed language, and does not have Generics, I end up having to write a duplicate function just for the <code>Girl</code> struct:</p>\n\n<pre><code>func CheckBirthDayGirl(date time.Time, girl Girl) int {\n    numDays := 0\n\n    if date.Before(girl.BirthDay) {\n        // Greet how many days before birthday\n        numDays = int(girl.BirthDay.Sub(date).Hours() / 24)\n        fmt.Println(\"Hi, \" + girl.Name + \"! Only \" + strconv.Itoa(numDays) + \" days until your birthday! I hear your favorite flower is a \" + girl.FavoriteFlower + \"!\")\n    } else if date.Equal(girl.BirthDay) {\n        // Greet happy birthday\n        fmt.Println(\"Happy birthday, \" + girl.Name + \"! I brought you a \" + girl.FavoriteFlower + \" as a present!\")\n    } else {\n        // Greet belated birthday\n        numDays = int(date.Sub(girl.BirthDay).Hours() / 24)\n        fmt.Println(\"Sorry I'm \" + strconv.Itoa(numDays) + \" days late, \" + girl.Name + \"! Here is a \" + girl.FavoriteFlower + \" to cheer you up!\")\n    }\n\n    return numDays\n}\n</code></pre>\n\n<p>Is there a way to avoid code duplication for simple structs like the ones above? I do not want to duplicate my function for each new struct that I want to implement it for.</p>\n\n<p><s>Interfaces are not an option here because both structs do not have any Functionality to speak of (and adding dummy functionality for the sake of satisfying an Interface sounds like a backwards solution to me).</s></p>\n\n<p>EDIT: After considering the solution I accepted, I now believe that Interfaces are also a valid solution to this problem. Thanks to @ThunderCat for bringing it up!</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": true, "score": 2, "last_activity_date": 1531205819, "creation_date": 1531205819, "answer_id": 51258939, "question_id": 51257837, "link": "https://stackoverflow.com/questions/51257837/fatal-error-all-goroutines-are-asleep-deadlock/51258939#51258939", "title": "fatal error: all goroutines are asleep - deadlock", "body": "<p>In this simplified example:</p>\n\n<pre><code>func Cheat(guess chan Choice) chan Choice {\n        new_guess := make(chan Choice)\n        new_guess &lt;- Choice{}\n        &lt;-guess\n        return new_guess\n}\n</code></pre>\n\n<p>When the write to the newly allocated channel happens, nobody else can possibly have the channel yet and so that write will block forever.  Since that write blocks, the read from <code>guess</code> never happens.  But, in the code you quoted, the <code>Cheat()</code> function is the only thing that reads from the <code>guess</code> channel; so the things that are writing to it are blocked on that read happening, that read won't happen until the write to <code>new_guess</code> happens, and that write can't happen until the containing function returns.</p>\n\n<p>If you move the channel I/O into a goroutine, then the containing function can return before things progress, and so the write in <code>Cheat()</code> gets paired with the reads at the end of <code>Game()</code> and things can move forward.</p>\n"}], "owner": {"reputation": 587, "user_id": 2976657, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/3451ecaa5f55b0cb3debc4251cad0f0e?s=128&d=identicon&r=PG&f=1", "display_name": "shubham003", "link": "https://stackoverflow.com/users/2976657/shubham003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 51258939, "answer_count": 1, "score": 0, "last_activity_date": 1531208515, "creation_date": 1531200806, "last_edit_date": 1531208515, "question_id": 51257837, "link": "https://stackoverflow.com/questions/51257837/fatal-error-all-goroutines-are-asleep-deadlock", "title": "fatal error: all goroutines are asleep - deadlock", "body": "<p>I've the following Go code </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n)\n\nconst (\n    ROCK int = iota\n    PAPER\n    SCISSORS\n)\n\ntype Choice struct {\n    Who   int //0 you 1 your opponent\n    Guess int\n}\n\n//Win returns true if you win.\nfunc Win(you, he int) bool {\n    ...\n}\n\nfunc Opponent(guess chan Choice, please chan struct{}) {\n    for i := 0; i &lt; 3; i++ {\n        &lt;-please\n        choice := rand.Intn(3)\n        who := 1\n        guess &lt;- Choice{who, choice}\n        please &lt;- struct{}{}\n    }\n}\n\nfunc GetChoice(you, he int) int {\n    ...\n}\n\nvar Cheat func(guess chan Choice) chan Choice = func(guess chan Choice) chan Choice {\n    new_guess := make(chan Choice)\n    // go func() {\n    for i := 0; i &lt; 3; i++ {\n        g1 := &lt;-guess\n        g2 := &lt;-guess\n        if g1.Who == 0 {\n            choice := GetChoice(g1.Guess, g2.Guess)\n            new_guess &lt;- g2\n            new_guess &lt;- Choice{g1.Who, choice}\n        } else {\n            choice := GetChoice(g2.Guess, g1.Guess)\n            new_guess &lt;- g1\n            new_guess &lt;- Choice{g2.Who, choice}\n        }\n    }\n    // }()\n    fmt.Println(\"...\")\n    return new_guess\n}\n\nfunc Me(guess chan Choice, please chan struct{}) {\n\n    for i := 0; i &lt; 3; i++ {\n        &lt;-please\n        choice := rand.Intn(3)\n        who := 0\n        guess &lt;- Choice{who, choice}\n        please &lt;- struct{}{}\n    }\n}\n\nfunc Game() []bool {\n    guess := make(chan Choice)\n    //please sync 2 goroutines.\n    please := make(chan struct{})\n    go func() { please &lt;- struct{}{} }()\n    go Opponent(guess, please)\n    go Me(guess, please)\n    guess = Cheat(guess)\n    var wins []bool\n\n    for i := 0; i &lt; 3; i++ {\n        g1 := &lt;-guess\n        g2 := &lt;-guess\n        win := false\n        if g1.Who == 0 {\n            win = Win(g1.Guess, g2.Guess)\n        } else {\n            win = Win(g2.Guess, g1.Guess)\n        }\n        wins = append(wins, win)\n    }\n\n    return wins\n}\n\nfunc main() {\n    win := Game()\n    fmt.Println(win)\n}\n</code></pre>\n\n<p>When I run this code I get the error <strong>fatal error: all goroutines are asleep - deadlock!</strong>. But when I uncomment the <strong>go func()</strong> line in <strong>Cheat</strong> function above the error disappear. I couldn't understand why the error appears in the first case and why it disappears when using goroutine. So if someone could please explain this?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1966, "user_id": 1392312, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/WTTkb.png?s=128&g=1", "display_name": "Rossiar", "link": "https://stackoverflow.com/users/1392312/rossiar"}, "is_accepted": false, "score": 4, "last_activity_date": 1531218512, "creation_date": 1531218512, "answer_id": 51262903, "question_id": 51256080, "link": "https://stackoverflow.com/questions/51256080/serve-multiple-handlers-with-httptest-to-mock-multiple-requests/51262903#51262903", "title": "Serve multiple handlers with httptest to mock multiple requests", "body": "<p><a href=\"https://golang.org/pkg/net/http/#ServeMux.Handle\" rel=\"nofollow noreferrer\">ServeMux.Handle</a> can be used to setup a server to handle multiple requests like <a href=\"https://gist.github.com/cespare/4992458#file-main-go\" rel=\"nofollow noreferrer\">in this example</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nconst addr = \"localhost:12345\"\n\nfunc main() {\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/hello\", HandleHello)\n    // other handlers can be assigned to separate paths\n    log.Printf(\"Now listening on %s...\\n\", addr)\n    server := http.Server{Handler: mux, Addr: addr}\n    log.Fatal(server.ListenAndServe())\n}\n\nfunc HandleHello(w http.ResponseWriter, r *http.Request) {\n    log.Printf(\"Hello!\")\n}\n</code></pre>\n\n<p>But to be honest you probably just want to abstract the <code>http.Client</code> behind an interface that you've created, and then stub that with a test implementation that returns exactly what you want. By doing this you avoid the overhead of http communication in your tests.</p>\n"}, {"tags": [], "owner": {"reputation": 241, "user_id": 1574968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3e992ed925194c7372e010c8bb4eee?s=128&d=identicon&r=PG", "display_name": "jonasl", "link": "https://stackoverflow.com/users/1574968/jonasl"}, "is_accepted": false, "score": 5, "last_activity_date": 1565862531, "creation_date": 1565862531, "answer_id": 57507834, "question_id": 51256080, "link": "https://stackoverflow.com/questions/51256080/serve-multiple-handlers-with-httptest-to-mock-multiple-requests/57507834#57507834", "title": "Serve multiple handlers with httptest to mock multiple requests", "body": "<p>Since the original question uses httptest.NewServer - you can register a ServeMux on the httptest.Server function, and then you can add several routes to that mux:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>mux := http.NewServeMux()\n\nmux.HandleFunc(\"/someroute/\", func(res http.ResponseWriter, req *http.Request) {\n    ...do some stuff...\n})\nmux.HandleFunc(\"/someotherroute/\", func(res http.ResponseWriter, req *http.Request) {\n    ...do other stuff...\n})\n\nts := httptest.NewServer(mux)\ndefer ts.Close()\n</code></pre>\n"}], "owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2147, "favorite_count": 0, "answer_count": 2, "score": 7, "last_activity_date": 1565862531, "creation_date": 1531186092, "question_id": 51256080, "link": "https://stackoverflow.com/questions/51256080/serve-multiple-handlers-with-httptest-to-mock-multiple-requests", "title": "Serve multiple handlers with httptest to mock multiple requests", "body": "<p>I've googled all over for this but can't find anything.</p>\n\n<p>I have a struct that takes in a <code>http.Client</code> and it sends several GET requests. In my tests I want to mock the responses so it's not sending real requests.</p>\n\n<p>Currently I've figured out how to only serve 1 request, like this:</p>\n\n<pre><code>     ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.WriteHeader(http.StatusOK)\n        file, err := os.Open(\"./testdata/1.html\")\n        if err != nil {\n            t.Error(err)\n        }\n        bytes, err := ioutil.ReadAll(file)\n        if err != nil {\n            t.Error(err)\n        }\n        w.Write(bytes)\n    }))\n\n   ts.Client() // Now I can inject this client into my struct.\n</code></pre>\n\n<p>So once that response is mocked out and the http client is performs a new request, my tests are sending out real requests after that.</p>\n\n<p>How do I allow for several handlers so I can mock several responses upon calling <code>http.Client.Get(...)</code>?</p>\n"}, {"tags": ["go", "path"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1531224915, "last_edit_date": 1531224915, "creation_date": 1531174690, "answer_id": 51254768, "question_id": 51254746, "link": "https://stackoverflow.com/questions/51254746/how-to-go-1-level-back-for-a-directory-path-stored-in-a-variable/51254768#51254768", "title": "How to go 1 level back for a directory path stored in a variable", "body": "<p>The parent directory can always be referred to by <code>..</code>, so you can append that to your path.</p>\n\n<p>For example:</p>\n\n<pre><code>p := \"/root/path/\"\np = filepath.Clean(filepath.Join(p, \"..\"))\nfmt.Println(p)\n// \"/root\"\n</code></pre>\n\n<p>If <code>path</code> is not a directory itself (or you are certain that it will not end in a path separator), then you can use the <code>Dir</code> function to get the containing directory. <a href=\"https://golang.org/pkg/path/filepath/#Dir\" rel=\"nofollow noreferrer\">Dir</a> <em>returns all but the last element of path, typically the path's directory</em>:</p>\n\n<pre><code>p := \"/root/path\"\np = filepath.Dir(p)\nfmt.Println(p)\n// \"/root\"\n</code></pre>\n"}], "owner": {"reputation": 870, "user_id": 4522501, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/929253393772654/picture?type=large", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/4522501/javier-salas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 1, "accepted_answer_id": 51254768, "answer_count": 1, "score": 4, "last_activity_date": 1531224915, "creation_date": 1531174472, "last_edit_date": 1531174664, "question_id": 51254746, "link": "https://stackoverflow.com/questions/51254746/how-to-go-1-level-back-for-a-directory-path-stored-in-a-variable", "title": "How to go 1 level back for a directory path stored in a variable", "body": "<p>I'm trying to go back 1 level back in a stored variable in Go Lang, how could I do this?</p>\n\n<pre><code>Origin:\n\"/root/path\"\n\nExpected:\n\"/root/\"\n</code></pre>\n\n<p>There's a function that could do that automatically? or I have to do it manually?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "tcp", "concurrency"], "answers": [{"tags": [], "owner": {"reputation": 3609, "user_id": 3763102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2439148d94bddcda4415797c8f6afefa?s=128&d=identicon&r=PG", "display_name": "gipsy", "link": "https://stackoverflow.com/users/3763102/gipsy"}, "is_accepted": false, "score": 4, "last_activity_date": 1572972656, "last_edit_date": 1572972656, "creation_date": 1531173579, "answer_id": 51254607, "question_id": 51254367, "link": "https://stackoverflow.com/questions/51254367/making-golang-tcp-server-concurrent/51254607#51254607", "title": "Making Golang TCP server concurrent", "body": "<p>The reason you see this behavior is the fact that your main method exits even though your go routine is still running. Make sure to block the main method to achieve what you are trying to achieve.</p>\n\n<p>May be add something like this in the main:</p>\n\n<pre><code>c := make(chan os.Signal)\nsignal.Notify(c, os.Interrupt, syscall.SIGTERM)\n&lt;-c // This will block until you manually exists with CRl-C\n</code></pre>\n\n<p>Also you can bring back your defer</p>\n"}, {"comments": [{"owner": {"reputation": 496, "user_id": 1310766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb332400d6bfcda911b524b122aeb34?s=128&d=identicon&r=PG", "display_name": "Francisco1844", "link": "https://stackoverflow.com/users/1310766/francisco1844"}, "edited": false, "score": 0, "creation_date": 1531198696, "post_id": 51254630, "comment_id": 89493671, "body": "Thanks. Solution is exactly what I was looking for.   Follow up.  Message Received: client1-line1  Message Received:   Calling handleConnection  Message Received: client2-line1  Message Received:   Message Received: client1-line2  Message Received:  The server seems to be adding extra, empty, message. Any idea why?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 496, "user_id": 1310766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb332400d6bfcda911b524b122aeb34?s=128&d=identicon&r=PG", "display_name": "Francisco1844", "link": "https://stackoverflow.com/users/1310766/francisco1844"}, "edited": false, "score": 0, "creation_date": 1531226941, "post_id": 51254630, "comment_id": 89509222, "body": "@Francisco1844: the server code is very simple, there&#39;s no place for it to be adding extra messages. You are probably sending empty lines from the client you are using to test."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1531180710, "last_edit_date": 1531180710, "creation_date": 1531173723, "answer_id": 51254630, "question_id": 51254367, "link": "https://stackoverflow.com/questions/51254367/making-golang-tcp-server-concurrent/51254630#51254630", "title": "Making Golang TCP server concurrent", "body": "<p>Your <code>main</code> function is returning immediately after accepting a new connection, so your program exits before the connection can be handled. Since you probably also want to receive more than one single connection (or else there would be no concurrency), you should put this in a for loop.</p>\n\n<p>You are also creating a new buffered reader in each iteration of the for loop, which would discard any buffered data. You need to do that outside the for loop, which I demonstrate here by creating a new <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"noreferrer\"><code>bufio.Scanner</code></a> which is a simpler way to read newline delimited text.</p>\n\n<pre><code>import (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"net\"\n    \"strings\"\n)\n\nfunc handleConnection(conn net.Conn) {\n    defer conn.Close()\n    scanner := bufio.NewScanner(conn)\n    for scanner.Scan() {\n        message := scanner.Text()\n        fmt.Println(\"Message Received:\", message)\n        newMessage := strings.ToUpper(message)\n        conn.Write([]byte(newMessage + \"\\n\"))\n    }\n\n    if err := scanner.Err(); err != nil {\n        fmt.Println(\"error:\", err)\n    }\n}\n\nfunc main() {\n    ln, err := net.Listen(\"tcp\", \"127.0.0.1:8081\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"Accept connection on port\")\n\n    for {\n        conn, err := ln.Accept()\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Println(\"Calling handleConnection\")\n        go handleConnection(conn)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 766, "user_id": 235521, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/818c46d7f6ebecfaf8f2c910fb3a1f2f?s=128&d=identicon&r=PG", "display_name": "kars7e", "link": "https://stackoverflow.com/users/235521/kars7e"}, "is_accepted": false, "score": 2, "last_activity_date": 1531183383, "creation_date": 1531183383, "answer_id": 51255783, "question_id": 51254367, "link": "https://stackoverflow.com/questions/51254367/making-golang-tcp-server-concurrent/51255783#51255783", "title": "Making Golang TCP server concurrent", "body": "<p>When you run function using <code>go func()</code> syntax, you are executing a new goroutine without blocking the main one. However, the program will exit when the main goroutine finishes, so in short, you need to block the main goroutine for as long as you want your child goroutines to execute. </p>\n\n<p>I often find myself checking how similar problems are solved in go standard library. For example, <a href=\"https://golang.org/src/net/http/server.go?s=85045:85091#L2753\" rel=\"nofollow noreferrer\">Server.Serve()</a> from <code>http</code> package does something similar. Here is the extracted version (shortened, follow the link to see full version):</p>\n\n<pre><code>func (srv *Server) Serve(l net.Listener) error {\n   defer l.Close()\n\n   ctx := context.Background() \n   for {\n      rw, e := l.Accept()\n      if e != nil {\n        select {\n        case &lt;-srv.getDoneChan():\n            return ErrServerClosed\n        default:\n        }\n        if ne, ok := e.(net.Error); ok &amp;&amp; ne.Temporary() {\n            // handle the error\n        }\n        return e\n      }\n      c := srv.newConn(rw)\n      c.setState(c.rwc, StateNew) // before Serve can return\n      go c.serve(ctx)\n   }\n}\n</code></pre>\n\n<p>To stop the above function, we could close the listener (e.g. via interrupt signal), which in turn would generate an error on <code>Accept()</code>. The above implementation checks whether <code>serv.GetDoneChan()</code> channel returns a value as an indicator that the error is expected and the server is closed. </p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 11219481, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1e62caf4fe4833276ac9d7db80cecfe?s=128&d=identicon&r=PG&f=1", "display_name": "Toundey", "link": "https://stackoverflow.com/users/11219481/toundey"}, "is_accepted": false, "score": 0, "last_activity_date": 1573528325, "creation_date": 1573528325, "answer_id": 58811462, "question_id": 51254367, "link": "https://stackoverflow.com/questions/51254367/making-golang-tcp-server-concurrent/58811462#58811462", "title": "Making Golang TCP server concurrent", "body": "<p>This is what you want</p>\n\n<p>Server</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n)\nimport \"fmt\"\nimport \"log\"\nimport \"net\"\nimport \"strings\" // only needed below for sample processing\n\nfunc handleConnection(conn net.Conn) {\n    fmt.Println(\"Inside function\")\n    // will listen for message to process ending in newline (\\n)\n    message, _ := bufio.NewReader(conn).ReadString('\\n')\n    // output message received\n    fmt.Print(\"Message Received:\", string(message))\n    // sample process for string received\n    newmessage := strings.ToUpper(message)\n    // send new string back to client\n    conn.Write([]byte(newmessage + \"\\n\"))\n    conn.Close()\n\n}\n\nfunc main() {\n    fmt.Println(\"Launching server...\")\n    fmt.Println(\"Listen on port\")\n    ln, err := net.Listen(\"tcp\", \"127.0.0.1:8081\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"Accept connection on port\")\n    for {\n        conn, err := ln.Accept()\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Println(\"Calling handleConnection\")\n        go handleConnection(conn)\n    }\n\n\n}\n</code></pre>\n\n<p>Client</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"net\"\n)\n\nfunc main() {\n    addr, _ := net.ResolveTCPAddr(\"tcp\", \":8081\")\n    conn, err := net.DialTCP(\"tcp\", nil, addr)\n    if err != nil {\n        panic(err.Error())\n    }\n    fmt.Fprintf(conn, \"From the client\\n\")\n    message, _ := bufio.NewReader(conn).ReadString('\\n')\n    fmt.Print(message)\n    conn.Close()\n}\n</code></pre>\n"}], "owner": {"reputation": 496, "user_id": 1310766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb332400d6bfcda911b524b122aeb34?s=128&d=identicon&r=PG", "display_name": "Francisco1844", "link": "https://stackoverflow.com/users/1310766/francisco1844"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6961, "favorite_count": 2, "accepted_answer_id": 51254630, "answer_count": 4, "score": 6, "last_activity_date": 1573528325, "creation_date": 1531172236, "last_edit_date": 1531172637, "question_id": 51254367, "link": "https://stackoverflow.com/questions/51254367/making-golang-tcp-server-concurrent", "title": "Making Golang TCP server concurrent", "body": "<p>New to Go and trying to make a TCP server concurrent. I found multiple examples of this, including <a href=\"https://codereview.stackexchange.com/questions/181415/golang-concurrent-tcp-server\">this one</a>, but what I am trying to figure out is why some changes I made to a non concurrent version are not working.</p>\n\n<p>This is the original sample code I started from</p>\n\n<pre><code>package main\nimport \"bufio\"\nimport \"fmt\"\nimport \"log\"\nimport \"net\"\nimport \"strings\" // only needed below for sample processing\n\nfunc main() {\n  fmt.Println(\"Launching server...\")\n  fmt.Println(\"Listen on port\")\n  ln, err := net.Listen(\"tcp\", \"127.0.0.1:8081\")\n  if err != nil {\n      log.Fatal(err)\n  }\n  defer ln.Close()\n\n  fmt.Println(\"Accept connection on port\")\n  conn, err := ln.Accept()\n  if err != nil {\n      log.Fatal(err)\n  }\n\n  fmt.Println(\"Entering loop\")\n  // run loop forever (or until ctrl-c)\n  for {\n    // will listen for message to process ending in newline (\\n)\n    message, _ := bufio.NewReader(conn).ReadString('\\n')\n    // output message received\n    fmt.Print(\"Message Received:\", string(message))\n    // sample process for string received\n    newmessage := strings.ToUpper(message)\n    // send new string back to client\n    conn.Write([]byte(newmessage + \"\\n\"))\n  }\n}\n</code></pre>\n\n<p>The above works, but it is not concurrent.</p>\n\n<p>This is the code after I modified it</p>\n\n<pre><code>package main\nimport \"bufio\"\nimport \"fmt\"\nimport \"log\"\nimport \"net\"\nimport \"strings\" // only needed below for sample processing\n\nfunc handleConnection(conn net.Conn) {\n  fmt.Println(\"Inside function\")\n  // run loop forever (or until ctrl-c)\n  for {\n    fmt.Println(\"Inside loop\")\n    // will listen for message to process ending in newline (\\n)\n    message, _ := bufio.NewReader(conn).ReadString('\\n')\n    // output message received\n    fmt.Print(\"Message Received:\", string(message))\n    // sample process for string received\n    newmessage := strings.ToUpper(message)\n    // send new string back to client\n    conn.Write([]byte(newmessage + \"\\n\"))\n  }\n\n}\n\nfunc main() {\n  fmt.Println(\"Launching server...\")\n  fmt.Println(\"Listen on port\")\n  ln, err := net.Listen(\"tcp\", \"127.0.0.1:8081\")\n  if err != nil {\n      log.Fatal(err)\n  }\n  //defer ln.Close()\n\n  fmt.Println(\"Accept connection on port\")\n  conn, err := ln.Accept()\n  if err != nil {\n      log.Fatal(err)\n  }\n  fmt.Println(\"Calling handleConnection\")\n  go handleConnection(conn)\n\n}\n</code></pre>\n\n<p>I based my code on several other examples I found of concurrent servers, but yet when I run the above the server seems to exit instead of running the handleConnection function</p>\n\n<blockquote>\n  <p>Launching server...</p>\n  \n  <p>Listen on port </p>\n  \n  <p>Accept connection on port </p>\n  \n  <p>Calling handleConnection</p>\n</blockquote>\n\n<p>Would appreciate any feedback as similar code examples I found and tested using the same approach, concurrently calling function to handle connections, worked; so, would like to know what is different with my modified code from the other samples I saw since they seem to be the same to me.</p>\n\n<p>I was not sure if it was the issue, but I tried commenting the defer call to close. That did not help.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "edited": false, "score": 0, "creation_date": 1531169863, "post_id": 51253863, "comment_id": 89486776, "body": "That&#39;s true, I&#39;ve known that is how middleware is implemented but felt this was a bit different since it didn&#39;t involve higher order functions. The actual program flow is the same which is the most substantial aspect. Thanks for pointing that out."}], "tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": true, "score": 5, "last_activity_date": 1531171643, "last_edit_date": 1531171643, "creation_date": 1531169643, "answer_id": 51253863, "question_id": 51253659, "link": "https://stackoverflow.com/questions/51253659/using-intermediate-handler-function-to-route-requests/51253863#51253863", "title": "Using intermediate handler function to route requests", "body": "<p>Yes, this is perfectly valid; handlers are just functions so there is no reason it shouldn't be. In fact, this is how <a href=\"https://stackoverflow.com/a/40649419/660921\">middleware is usually implemented</a>.</p>\n\n<p>There is nothing \"magic\" about handler functions at all. As long as you're writing to the correct file descriptor (<code>w http.ResponseWriter</code>) anything goes.</p>\n\n<p>That doesn't mean that using this pattern is necessarily a good idea for all applications \u2013 routing libraries exist for a reason \u2013 but for smaller programs it will work just fine.</p>\n"}, {"comments": [{"owner": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "edited": false, "score": 0, "creation_date": 1531169952, "post_id": 51253903, "comment_id": 89486813, "body": "I&#39;ve used both httprouter (and gorilla mux AND fasthttp). I think there is some value in using the standard library especially on smaller projects. However the other points are useful, thanks for the resources."}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "reply_to_user": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "edited": false, "score": 0, "creation_date": 1531170400, "post_id": 51253903, "comment_id": 89486985, "body": "I have not done the benchmarks, but using the standard router would probably make your app a tiny bit faster. But the difference should be negligible, but i found some of the libraries much easier to reason about and write. Code readability is pretty important, and I find standard lib a bit harder to read then some other solutions."}, {"owner": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "edited": false, "score": 0, "creation_date": 1531170490, "post_id": 51253903, "comment_id": 89487014, "body": "Actually the standard library is slower than most of those routers (according to what I&#39;ve read). I&#39;ve just been fascinated with the standard library and &quot;idiomatic go&quot; lately."}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "reply_to_user": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "edited": false, "score": 0, "creation_date": 1531170836, "post_id": 51253903, "comment_id": 89487151, "body": "Hmm I&#39;m surprised to hear that. It&#39;s not easy to find the golden middle ground between <b>idiomatic go</b> and <b>practical go</b>. Depends from case to case but sometimes idiomatic solution is not that practical. But I find frameworks like <a href=\"https://beego.me/\" rel=\"nofollow noreferrer\">beego</a> a serious overkill."}], "tags": [], "owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "is_accepted": false, "score": 3, "last_activity_date": 1531169824, "creation_date": 1531169824, "answer_id": 51253903, "question_id": 51253659, "link": "https://stackoverflow.com/questions/51253659/using-intermediate-handler-function-to-route-requests/51253903#51253903", "title": "Using intermediate handler function to route requests", "body": "<blockquote>\n  <p>It's completely valid to have a <code>HandlerFunc</code> call another <code>HandlerFunc</code>.</p>\n</blockquote>\n\n<p>In fact that's how you would implement <strong>middleware</strong> using the standard lib.</p>\n\n<p>Here's a <a href=\"https://medium.com/@matryer/the-http-handler-wrapper-technique-in-golang-updated-bc7fbcffa702\" rel=\"nofollow noreferrer\"><strong>Post</strong></a> by <em>Mat Ryer</em> (amazing guy btw) that explains in some further detail what he calls <br> <strong>\"http.Handler wrapper technique\"</strong></p>\n\n<p>The way you want to use <code>HandlerFunc</code>s reminds me of <a href=\"https://laravel.com/docs/5.6/controllers#resource-controllers\" rel=\"nofollow noreferrer\">Laravel's Resource Controllers</a>, which I think are pretty neat. But using them carelessly could become an unnecessary overhead.</p>\n\n<p>I would suggest you perhaps give <a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow noreferrer\"><strong>julienschmidt/httprouter</strong></a> library a try.<br>\nIt's pretty fast and easy to use.</p>\n"}, {"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 2, "last_activity_date": 1531171789, "last_edit_date": 1531171789, "creation_date": 1531170004, "answer_id": 51253938, "question_id": 51253659, "link": "https://stackoverflow.com/questions/51253659/using-intermediate-handler-function-to-route-requests/51253938#51253938", "title": "Using intermediate handler function to route requests", "body": "<p>This is valid, as mentioned in the other answers handlers are just functions.</p>\n\n<p>The thing that changes is the request method; it might worth considering an implementation with a map. This could be more extensible as the number of handlers you need change.</p>\n\n<pre><code>type BookController struct {\n    routes map[string]http.HandlerFunc\n}\n\nfunc (b BookController) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    // beware this very basic example will panic if there's not a registered handler for r.Method\n    // but I assume you'd have to do handling of missing method logic in your default switch anyway\n    b.routes[r.Method].ServeHTTP(w, r)\n}\n</code></pre>\n\n<p>And to register them:</p>\n\n<pre><code>m := http.NewServeMux()\nb := BookController{}\nb.routes = map[string]http.HandlerFunc{\n    \"GET\": getBooks,\n    \"POST\": createBooks,\n}\nm.Handle(\"/books\", b)\n</code></pre>\n\n<p>Slightly more boiler plate, but might allow for easier adding / removing of handlers later.</p>\n"}], "owner": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 51253863, "answer_count": 3, "score": 5, "last_activity_date": 1531171789, "creation_date": 1531168704, "last_edit_date": 1531170038, "question_id": 51253659, "link": "https://stackoverflow.com/questions/51253659/using-intermediate-handler-function-to-route-requests", "title": "Using intermediate handler function to route requests", "body": "<p>I was thinking of ways to do routing with the standard library. Is it valid to have a handler function that will call other handler functions depending on the request type? e.g.</p>\n\n<pre><code>func main() {\n    m := http.NewServeMux()\n    m.HandleFunc(\"/books\", books)\n    // ...\n}\n\nfunc books(w http.ResponseWriter, r *http.Request) {\n    switch r.Method {\n        case \"GET\":\n            getBooks(w, r)\n        case \"POST\":\n            createBook(w, r)\n    }\n}\n</code></pre>\n\n<p>Is this good practice? I didn't want to declare a custom handler since I find functions to be a bit cleaner.</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 5, "creation_date": 1531157817, "post_id": 51251076, "comment_id": 89481198, "body": "you need to point from where type <code>DB</code> is imported. In your case it will be <code>*sql.DB</code>"}, {"owner": {"reputation": 164, "user_id": 4373976, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100000293348468/picture?type=large", "display_name": "Hulii Borys", "link": "https://stackoverflow.com/users/4373976/hulii-borys"}, "edited": false, "score": 2, "creation_date": 1531212145, "post_id": 51251076, "comment_id": 89499612, "body": "Do not do <code>defer db.Close()</code> inside <code>func opendb</code>. It will be executed right after return, and you will get a closed connection."}], "answers": [{"tags": [], "owner": {"reputation": 1358, "user_id": 5275376, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a8bbb1e2df58ceebc9bbb5596bf823f3?s=128&d=identicon&r=PG&f=1", "display_name": "Shiva Kishore", "link": "https://stackoverflow.com/users/5275376/shiva-kishore"}, "is_accepted": true, "score": 7, "last_activity_date": 1531157911, "creation_date": 1531157911, "answer_id": 51251193, "question_id": 51251076, "link": "https://stackoverflow.com/questions/51251076/how-to-return-db-database-sql-type-in-golang/51251193#51251193", "title": "how to return DB (database/sql) type in golang?", "body": "<p>the return datatype should be <code>*sql.DB</code> <br>\nchanging<br>\n<code>func opendb() (*DB) {</code></p>\n\n<p>to</p>\n\n<p><code>func opendb() (*sql.DB) {</code><br></p>\n\n<p>should work</p>\n"}], "owner": {"reputation": 129, "user_id": 10055037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8508b3a084f60d0277b328e0e5fc7ec?s=128&d=identicon&r=PG&f=1", "display_name": "lab0", "link": "https://stackoverflow.com/users/10055037/lab0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1807, "favorite_count": 0, "accepted_answer_id": 51251193, "answer_count": 1, "score": 5, "last_activity_date": 1531157911, "creation_date": 1531157462, "last_edit_date": 1531157852, "question_id": 51251076, "link": "https://stackoverflow.com/questions/51251076/how-to-return-db-database-sql-type-in-golang", "title": "how to return DB (database/sql) type in golang?", "body": "<p>I use Go with PostgreSQL using <a href=\"http://github.com/lib/pq\" rel=\"noreferrer\">github.com/lib/pq</a>. </p>\n\n<p>I want to call this <code>opendb()</code> function in other functions but I'm having problem with the return value.</p>\n\n<pre><code> package database\n\n    import (\n            \"fmt\"\n            \"database/sql\"\n            _ \"github.com/lib/pq\"\n    )\n\n    const (\n            host = \"localhost\"\n            port = 5432\n            user = \"postgres\"\n            password = \"pgpassword\"\n            dbname = \"postgres\"\n    )\n\n    func opendb() (*DB) {\n            psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s password=%s dbname=%s \" +\n              \"sslmode=disable\", host, port, user, password, dbname)\n\n            db, err := sql.Open(\"postgres\", psqlInfo)\n\n            if err != nil {\n                    panic(err)\n            }\n\n            defer db.Close()\n\n            return db\n    }\n</code></pre>\n\n<p>If you run this:</p>\n\n<pre><code>$ go run main.go\n</code></pre>\n\n<p>It will show this error:</p>\n\n<pre><code>error:\n\n    undefined: DB\n</code></pre>\n"}, {"tags": ["testing", "go", "rabbitmq"], "answers": [{"tags": [], "owner": {"reputation": 6400, "user_id": 1466825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b420d86764ffe237a2fdc52e28b73f4?s=128&d=identicon&r=PG", "display_name": "Luke Bakken", "link": "https://stackoverflow.com/users/1466825/luke-bakken"}, "is_accepted": false, "score": 1, "last_activity_date": 1531320080, "creation_date": 1531320080, "answer_id": 51288356, "question_id": 51250471, "link": "https://stackoverflow.com/questions/51250471/testing-rabbitmq-ack-nack-response/51288356#51288356", "title": "Testing Rabbitmq ack/nack response", "body": "<p>You should try out the <a href=\"https://www.rabbitmq.com/firehose.html\" rel=\"nofollow noreferrer\">tracing plugin</a>. Note that this plugin should <strong>never</strong> be used in production due to the performance overhead it incurs.</p>\n\n<hr>\n\n<p><sub><b>NOTE:</b> the RabbitMQ team monitors <a href=\"https://groups.google.com/forum/#!forum/rabbitmq-users\" rel=\"nofollow noreferrer\">the <code>rabbitmq-users</code> mailing list</a> and only sometimes answers questions on StackOverflow.</sub></p>\n"}], "owner": {"reputation": 361, "user_id": 3990979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13a9a388d68d9ac363855f8def3b8004?s=128&d=identicon&r=PG&f=1", "display_name": "Jorgese", "link": "https://stackoverflow.com/users/3990979/jorgese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1531320080, "creation_date": 1531155066, "question_id": 51250471, "link": "https://stackoverflow.com/questions/51250471/testing-rabbitmq-ack-nack-response", "title": "Testing Rabbitmq ack/nack response", "body": "<p>I would like to test my Rabbitmq implementation. I have a queue and consumer, and I would like to have a third element which listens/sniffs the queue response, so the test will fail in case of queue responds nack or pass in case of it is ack.</p>\n\n<p>Do you know how I could do it?</p>\n\n<p>Many thanks</p>\n"}, {"tags": ["ssl", "go", "websocket", "sni"], "comments": [{"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1531156023, "post_id": 51250164, "comment_id": 89480230, "body": "If you don&#39;t need the SNI extension then the hostname in URL must be the server you are connecting to. So there&#39;s no additional information in the SNI extension and thus no security reason to suppress it."}, {"owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "reply_to_user": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1531156959, "post_id": 51250164, "comment_id": 89480719, "body": "@JamesKPolk: The reason for replacing the hostname with its IP is exactly to cheat <code>crypto&#47;tls</code> into not adding SNI; ideally, <code>tls.Config</code> would have something amounting to a <code>UseSNI</code> option."}, {"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1531169668, "post_id": 51250164, "comment_id": 89486681, "body": "But I don&#39;t see why you are avoiding SNI since it reveals no additional information."}, {"owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "reply_to_user": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1531170802, "post_id": 51250164, "comment_id": 89487139, "body": "It reveals the hostname, which is what is explicitly removed here, and which is what is used for SNI based firewall filters."}, {"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1531172128, "post_id": 51250164, "comment_id": 89487606, "body": "Ok, that makes sense, sorry for my confusion. I don&#39;t think there is any simpler approach than providing a custom verifier, other than totally ignoring the hostname and leaving yourself open to man-in-the-middle attacks."}, {"owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "reply_to_user": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1531174830, "post_id": 51250164, "comment_id": 89488506, "body": "No worries, I&#39;m sure it could have been worded more clearly. And I suspect you&#39;re right; too bad."}], "owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 552, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1531154818, "creation_date": 1531153807, "last_edit_date": 1531154818, "question_id": 51250164, "link": "https://stackoverflow.com/questions/51250164/stripping-sni-information-from-tls-websocket-connections", "title": "Stripping SNI information from TLS WebSocket connections", "body": "<p>I find myself needing to set up a WebSocket connection in a hostile environment in which a firewall sniffs SNI information from TLS which I'd rather it didn't. In my particular case, the WebSocket server does not use SNI for request handling, so as such, the SNI part of the handshake could be safely removed.</p>\n\n<p>My question then becomes: In the golang.org WebSocket package, <code>golang.org/x/net/websocket</code>, what is the simplest way to strip SNI information while retaining validation of the provided chain?</p>\n\n<p>The best I have been able to come up with is to simply replace the hostname of the URL to be dialled with its corresponding IP. This causes <code>crypto/tls</code> to never add the problematic SNI information, but, in the solution I was able to come up with, a custom validator ends up having to be provided to validate the chain:</p>\n\n<pre><code>func dial(url string, origin string) (*websocket.Conn, error) {\n    // Use system resolver to get IP of host\n    hostRegExp := regexp.MustCompile(\"//([^/]+)/\")\n    host := hostRegExp.FindStringSubmatch(url)[1]\n    addrs, err := net.LookupHost(host)\n    if err != nil {\n        return fmt.Errorf(\"Could not resolve address of %s: %v\", host, err)\n    }\n    ip := addrs[0]\n\n    // Replace the hostname in the given URL with its IP instead\n    newURL := strings.Replace(url, host, ip, 1)\n    config, _ := websocket.NewConfig(newURL, origin)\n\n    // As we have removed the hostname, the Go TLS package will not know what to\n    // validate the certificate DNS names against, so we have to provide a custom\n    // verifier based on the hostname we threw away.\n    config.TlsConfig = &amp;tls.Config{\n        InsecureSkipVerify:    true,\n        VerifyPeerCertificate: verifier(host),\n    }\n    return websocket.DialConfig(config)\n}\n\nfunc verifier(host string) func(rawCerts [][]byte, verifiedChains [][]*x509.Certificate) error {\n    return func(rawCerts [][]byte, verifiedChains [][]*x509.Certificate) error {\n        // For simplicity, let us only consider the case in which the first certificate is the one\n        // to validate, and in which it is signed directly by a CA, with no parsing of\n        // intermediate certificates required.\n        opts := x509.VerifyOptions{\n            DNSName: host,\n        }\n        rawCert := rawCerts[0]\n        cert, err := x509.ParseCertificate(rawCert)\n        if err != nil {\n            return err\n        }\n        _, err = cert.Verify(opts)\n        return err\n    }\n}\n</code></pre>\n\n<p>This totally works but seems rather clunky. Is there a simpler approach? (Ideally one that is not specific to WebSocket applications but works for TLS in general; the exact same idea as above could be applied to HTTPS.)</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1531153824, "post_id": 51250143, "comment_id": 89479131, "body": "You can use <code>bson.M</code>, it&#39;s just a <code>map[string]interface{}</code>: <a href=\"https://godoc.org/labix.org/v2/mgo/bson#M\" rel=\"nofollow noreferrer\">godoc.org/labix.org/v2/mgo/bson#M</a>"}, {"owner": {"reputation": 137, "user_id": 8094185, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5MtO.jpg?s=128&g=1", "display_name": "nobrac", "link": "https://stackoverflow.com/users/8094185/nobrac"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1531156606, "post_id": 51250143, "comment_id": 89480539, "body": "What&#39;s the correct syntax to parse a value out? I can&#39;t really find good documentation/examples on the matter-- I&#39;ve tried <code>value.numClientConnections</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1531157320, "post_id": 51250143, "comment_id": 89480911, "body": "It&#39;s already been parsed, and you access it like any other <code>map</code>: <a href=\"https://tour.golang.org/moretypes/19\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/19</a> e.g. <code>value[&quot;numClientConnections&quot;]</code>"}, {"owner": {"reputation": 137, "user_id": 8094185, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5MtO.jpg?s=128&g=1", "display_name": "nobrac", "link": "https://stackoverflow.com/users/8094185/nobrac"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1531157796, "post_id": 51250143, "comment_id": 89481189, "body": "Tried that as well, but I get an error such as <code>invalid operation: value[&quot;numClientConnections&quot;] (type interface {} does not support indexing)</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1531159360, "post_id": 51250143, "comment_id": 89481945, "body": "Sorry, I was basing that comment on your comment, not on the code in your question. It would be <code>connResult[&quot;numClientConnections&quot;]</code>."}], "owner": {"reputation": 137, "user_id": 8094185, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5MtO.jpg?s=128&g=1", "display_name": "nobrac", "link": "https://stackoverflow.com/users/8094185/nobrac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1391, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1531153744, "creation_date": 1531153744, "question_id": 51250143, "link": "https://stackoverflow.com/questions/51250143/parsing-bson-m-with-mgo-in-golang", "title": "Parsing bson.M with mgo in Golang", "body": "<p>I am looking to parse specific values out of MongoDB diagnostic commands using the mgo connector. I can loop through the bson.M{} response, but I'm unsure how to actually pull out specific nested values within the map and store them as a value. Here is the code I have thus far:</p>\n\n<pre><code>    //Connect to mongo shell\nsession, err := mgo.Dial(\"localhost\")\nif err != nil {\n    panic(err)\n}\ndefer session.Close()\nsession.SetMode(mgo.Monotonic, true)\n\n//Get connPoolStats\nconnResult := bson.M{}\nif err := session.DB(\"admin\").Run(\"connPoolStats\", &amp;connResult); err != nil {\n    panic(err)\n} else {\n    for key, value := range connResult {\n        fmt.Println(key, value)\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>totalRefreshing 0\nhosts map[]\nreplicaSets map[]\nnumClientConnections 0\ntotalInUse 0\ntotalAvailable 0\ntotalCreated 0\nnumAScopedConnections 0\npools map[]\nok 1\n</code></pre>\n\n<p>I would like to pull out numClientConnections, totalInUse, available, etc and store them in variables-- as well as pull out values from the nested maps within <code>pools map[]</code> Do I need to convert to json to do this or use something other than bson.M?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1909, "user_id": 2112418, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ihY9L.jpg?s=128&g=1", "display_name": "James Jenkins", "link": "https://stackoverflow.com/users/2112418/james-jenkins"}, "edited": false, "score": 1, "creation_date": 1531155811, "post_id": 51249999, "comment_id": 89480129, "body": "You can ask and answer your own questions here, but first post just the question. Then post the answer.  BUT even before that check to see if the question already exists."}, {"owner": {"reputation": 21, "user_id": 9115704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24b1df6979b163821327e4d5f0bfde7c?s=128&d=identicon&r=PG&f=1", "display_name": "Cynoktyx", "link": "https://stackoverflow.com/users/9115704/cynoktyx"}, "reply_to_user": {"reputation": 1909, "user_id": 2112418, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ihY9L.jpg?s=128&g=1", "display_name": "James Jenkins", "link": "https://stackoverflow.com/users/2112418/james-jenkins"}, "edited": false, "score": 1, "creation_date": 1531399222, "post_id": 51249999, "comment_id": 89588415, "body": "Do you think it would be better to now extract the answer of the question into a seperate question? I&#39;m wondering because it&#39;s partially based on another question on SO"}, {"owner": {"reputation": 5375, "user_id": 4566599, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/26d2b732a0b6c39b2fcb40cb7954b9c1?s=128&d=identicon&r=PG&f=1", "display_name": "Roi Danton", "link": "https://stackoverflow.com/users/4566599/roi-danton"}, "edited": false, "score": 1, "creation_date": 1531511614, "post_id": 51249999, "comment_id": 89639568, "body": "Yes, it would be better to extract the answer and better elaborate on what the actual problem of the question was."}], "owner": {"reputation": 21, "user_id": 9115704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24b1df6979b163821327e4d5f0bfde7c?s=128&d=identicon&r=PG&f=1", "display_name": "Cynoktyx", "link": "https://stackoverflow.com/users/9115704/cynoktyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 166, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1531153167, "creation_date": 1531153167, "question_id": 51249999, "link": "https://stackoverflow.com/questions/51249999/unable-to-handle-custom-dll-returning-char-on-windows-imagesearch-dll", "title": "Unable to handle custom dll returning char* on windows (ImageSearch.dll)", "body": "<p><strong><em>Info:</em></strong>\nAfter writing this whole text, I came across <a href=\"https://stackoverflow.com/questions/47979699/using-dll-in-windows-go\">some other SO post</a>, tried it one more time and it just worked. However, as the solution (or rather the problem) to me was not obvious at all (and writing this question was a lot of work), I decided to still post this text along with the solution. Hopefully, this might help <a href=\"https://xkcd.com/979/\" rel=\"nofollow noreferrer\">some developer coming across this post in the future</a>.</p>\n\n<p>As I'm still rather new to SO, I don't really know if this will be appreciated so feel free to let me know to remove it.</p>\n\n<p><strong>TLDR:</strong></p>\n\n<p>I was trying to call a DLL which required a string argument and returned a string. I tried several solutions and approaches that didn't help. In the end - by chance - I found out the problem was the way I passed the string.</p>\n\n<p>My solution is the following:</p>\n\n<pre><code>imagePath := \"*30 C:\\\\absolute\\\\path\\\\to\\\\test.png\"\nbytePath := []byte(imagePath + \"\\x00\") // Make string null-terminated (required by C)\n\ndll := syscall.NewLazyDLL(\"ImageSearchDLL.dll\")\nimageSearch := dll.NewProc(\"ImageSearch\")\n\nr1, _, _ := imageSearch.Call(\n    0,\n    0,\n    1920,\n    1080,\n    uintptr(unsafe.Pointer(&amp;bytePath[0]))) // Make sure to pass index 0\n\n// DLL returned char*, parse that to a GoString\nvar s string\nhdr := (*reflect.StringHeader)(unsafe.Pointer(&amp;s))\nhdr.Data = uintptr(unsafe.Pointer(r1))\nhdr.Len = 32 // Adjust length as needed!\n\nfmt.Println(s)\n</code></pre>\n\n<p>The parsing of the <code>char*</code> to a string and reverse could perhaps somehow be done with <code>C.CString</code> and <code>C.GoString</code>, I could not get that working in a short enough time so I decided to keep it this way. </p>\n\n<p>What should also be done is checking the length of the string (is \"terminated\" by \\x00).</p>\n\n<hr>\n\n<h2>Original question</h2>\n\n<p>I'm quite new to go but want to use it in my next desktop automation project. To do this, I'm trying to find an image present in the display.\nAs I could not find any go library capable of doing this, I decided to try to use a DLL I know from my Autoit-experience years ago: <a href=\"https://www.autoitscript.com/forum/topic/148005-imagesearch-usage-explanation/\" rel=\"nofollow noreferrer\">DLL Download</a> <a href=\"https://github.com/narfman0/ImageSearchDLL\" rel=\"nofollow noreferrer\">Source Code</a></p>\n\n<p>However, after several hours of trying to find a solution (including <a href=\"https://github.com/golang/go/wiki/WindowsDLLs\" rel=\"nofollow noreferrer\">the wiki</a>), I could not get it working.</p>\n\n<p>The library/function itself itself has this signature:\n<code>char* WINAPI ImageSearch(int aLeft, int aTop, int aRight, int aBottom, char *aImageFile)</code></p>\n\n<p>As I'm not familiar with C at all, I tried both other solutions presented:</p>\n\n<pre><code>path := \"*30 C:\\\\absolute\\\\path\\\\to\\\\test.png\"\ndll := syscall.NewLazyDLL(\"ImageSearchDLL.dll\")\nimageSearch := dll.NewProc(\"ImageSearch\")\nr1, r2, r3 := imageSearch.Call(0, 0, 1920, 1080, uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(imagePath))))\nfmt.Println(r1, r2, r3)\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>path := \"*30 C:\\\\absolute\\\\path\\\\to\\\\test.png\"\ndll2, _ := syscall.LoadLibrary(\"ImageSearchDLL.dll\")\nimageSearch2, _ := syscall.GetProcAddress(dll2, \"ImageSearch\")\n\nr1, r2, r3 = syscall.Syscall6(imageSearch2,\n    5,\n    uintptr(0),\n    uintptr(0),\n    uintptr(1920),\n    uintptr(1920),\n    uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(imagePath))),\n    0)\n\nfmt.Println(r1, r2, r3)\n</code></pre>\n\n<p>Note that the path variable is set according to <a href=\"https://stackoverflow.com/questions/43708350/c-sharp-imagesearch-dll\">this solution using C#</a>.</p>\n\n<p>The output of both is as followed:</p>\n\n<pre><code>6442522512 0 Der Vorgang wurde erfolgreich beendet.\n</code></pre>\n\n<p>Meaning: \"The process has been completed successfully\".</p>\n\n<p>As the DLL is supposed to return a <code>char*</code>, I opened up the <a href=\"https://godoc.org/unsafe#Pointer\" rel=\"nofollow noreferrer\">documentation of unsafe</a> and found Pointer > (6). Using a guessed length for the string, I came up with this attempt:</p>\n\n<pre><code>imagePath := \"*30 C:\\\\absolute\\\\path\\\\to\\\\test.png\"\ndll := syscall.NewLazyDLL(\"ImageSearchDLL.dll\")\nimageSearch := dll.NewProc(\"ImageSearch\")\nr1, r2, r3 := imageSearch.Call(0, 0, 1920, 1080, uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(imagePath))))\nfmt.Println(r1, r2, r3)\n\nvar s string\nhdr := (*reflect.StringHeader)(unsafe.Pointer(&amp;s))\nhdr.Data = uintptr(unsafe.Pointer(r1))\nhdr.Len = 64\n\nfmt.Println(s)\n</code></pre>\n\n<p>This did at least print some kind of string:</p>\n\n<pre><code>6442522512 0 Der Vorgang wurde erfolgreich beendet.\n0   0   0   0   0       1|%d|%d|%d|%d   0       c:\\pic.bmp      \n</code></pre>\n\n<p>From my understanding, the problem might arise from 3 possible problems:</p>\n\n<ol>\n<li>I'm using ImageSearch wrong</li>\n<li>Passing the String to a custom dll does not work as expected in Go</li>\n<li>The parsing of the \"returned\" <code>char*</code> is not working</li>\n</ol>\n\n<p>As I have to clue on how to approach 2 &amp; 3, I at least wanted to make sure 1 is not the case. Therefore, I did a quick test in Autoit returning the expected result:</p>\n\n<pre><code>#include \"array.au3\"\n$res = DllCall(\"ImageSearchDLL.dll\", \"str\", \"ImageSearch\", \"int\", 0, \"int\", 0, \"int\", 1920, \"int\", 1080, \"str\", \"*30 C:\\\\absolute\\\\path\\\\to\\\\test.png\")\n\n_ArrayDisplay($res)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Row|Col 0\n[0]|1|505|1051|21|20\n[1]|0\n[2]|0\n[3]|1920\n[4]|1080\n[5]|*30 C:\\\\absolute\\\\path\\\\to\\\\test.png\n</code></pre>\n\n<p>This gave me the confidence, that I'm at least using the dll correctly. However, this also led to the point where I'm really out of clues on what else to try. Having a look on cgo, I did not really get how I would be doing what I want to achieve, especially without much knowledge of C.</p>\n\n<p>Do you have any suggestion on my further approach and what else to try?</p>\n"}, {"tags": ["string", "go", "concurrency", "immutability", "atomic"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1531153340, "post_id": 51249918, "comment_id": 89478889, "body": "Strings are immutable, but pointers aren&#39;t. If you aren&#39;t using pointers to strings, you&#39;re not sharing data between threads anyway, so immutability is irrelevant; if you are using pointers, then you will need to synchronize on them."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1531209613, "last_edit_date": 1531209613, "creation_date": 1531153301, "answer_id": 51250031, "question_id": 51249918, "link": "https://stackoverflow.com/questions/51249918/immutability-of-string-and-concurrency/51250031#51250031", "title": "Immutability of string and concurrency", "body": "<p><code>string</code> values are immutable, but variables are not. Variables are\u2013what their name say\u2013<em>variable</em>, their values can be changed.</p>\n\n<p>You don't need synchronization for accessing a <code>string</code> value, that can't change. If a <code>string</code> value is handed to you, that (the content of the <code>string</code>) will always remain the same (usage of package <code>unsafe</code> does not count).</p>\n\n<p>You need synchronization when you want to access a variable of <code>string</code> type from multiple goroutines concurrently, if at least one of the accesses is a write (a write that changes the value of the <code>string</code> variable). This is true for variables of any type in Go, the <code>string</code> type is not special in any way.</p>\n\n<p>What does this mean in practice?</p>\n\n<p>If you have a function that receives a <code>string</code> value <code>\"hello\"</code>, you can be sure the <code>string</code> value will stay <code>\"hello\"</code> no matter what. Consequently if you don't change the argument yourself (e.g. you don't assign a new value to it), it will always hold the <code>string</code> value <code>\"hello\"</code>.</p>\n\n<p>As a counter-example, if your function receives a slice value <code>[]byte{1, 2, 3}</code>, you don't have the same guarantee, because slices are mutable. The caller also has the slice value (the slice header), else it couldn't pass it in the first place. And if the caller modifies the <em>elements</em> of the slice concurrently, since they share the same backing array, the slice that was handed to you will also see the changed data... with proper synchronization; because without synchronization this would be a data race (and hence undefined behavior).</p>\n\n<p>See this example:</p>\n\n<pre><code>var sig = make(chan int)\n\nfunc main() {\n    s := []byte{1, 2, 3}\n    go func() {\n        &lt;-sig\n        s[0] = 100\n        sig &lt;- 0\n    }()\n    sliceTest(s)\n}\n\nfunc sliceTest(s []byte) {\n    fmt.Println(\"First  s =\", s)\n\n    sig &lt;- 0 // send signal to modify now\n    &lt;-sig    // Wait for modification to complete\n\n    fmt.Println(\"Second s =\", s)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/o-vHoga7Swh\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>First  s = [1 2 3]\nSecond s = [100 2 3]\n</code></pre>\n\n<p>Focus on <code>sliceTest()</code>: it receives a slice, and it prints it. Then waits a little (gives a \"go\" to a concurrent goroutine to modify it, and waits for this modification to complete), and prints it again, and it has changed, yet <code>sliceTest()</code> itself did not modify it.</p>\n\n<p>Now if <code>sliceTest()</code> would receive a <code>string</code> argument instead, this could not happen.</p>\n\n<p>See related / possible duplicate: <a href=\"https://stackoverflow.com/questions/47352449/immutable-string-and-pointer-address/47352588#47352588\">Immutable string and pointer address</a></p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1531168008, "last_edit_date": 1531168008, "creation_date": 1531153344, "answer_id": 51250042, "question_id": 51249918, "link": "https://stackoverflow.com/questions/51249918/immutability-of-string-and-concurrency/51250042#51250042", "title": "Immutability of string and concurrency", "body": "<blockquote>\n  <p>Should we synchronize on writing strings? Since string is immutable we\n  will never get inconsistent state between write and read from the 2\n  different threads, right?</p>\n</blockquote>\n\n<p>That's the question. The answer is: synchronize on writing strings. It's clear that <code>string</code> variables are mutable and <code>string</code> contents are immutable, as I already explained earlier. To reiterate:</p>\n\n<hr>\n\n<p>The Go compiler will enforce the immutability of <code>string</code> contents. For example,</p>\n\n<pre><code>package main\n\nfunc main() {\n    var s string = \"abc\"\n    s[0] = '0'\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>5:7: cannot assign to s[0]\n</code></pre>\n\n<hr>\n\n<p>The Go runtime <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">Data Race Detector</a> flags the inconsistent state of mutable <code>string</code> variables updated from different goroutines. For example, writing to a <code>string</code> variable,</p>\n\n<pre><code>package main\n\nimport \"time\"\n\nvar s string = \"abc\"\n\nfunc main() {\n    go func() {\n        for {\n            s = \"abc\"\n        }\n    }()\n    go func() {\n        for {\n            s = \"abc\"\n        }\n    }()\n    time.Sleep(1 * time.Second)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run -race racer.go\n==================\nWARNING: DATA RACE\nWrite at 0x00000050d360 by goroutine 6:\n  main.main.func2()\n      /home/peter/src/racer.go:15 +0x3a\n\nPrevious write at 0x00000050d360 by goroutine 5:\n  main.main.func1()\n      /home/peter/src/racer.go:10 +0x3a\n\nGoroutine 6 (running) created at:\n  main.main()\n      /home/peter/src/racer.go:13 +0x5a\n\nGoroutine 5 (running) created at:\n  main.main()\n      /home/peter/src/racer.go:8 +0x42\n==================\nFound 1 data race(s)\nexit status 66\n$\n</code></pre>\n\n<hr>\n\n<p>Original Post:</p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#String_types\" rel=\"nofollow noreferrer\">String types</a></p>\n  \n  <p>A string type represents the set of string values. A string value is a\n  (possibly empty) sequence of bytes. Strings are immutable: once\n  created, it is impossible to change the contents of a string.</p>\n</blockquote>\n\n<hr>\n\n<p>A <code>string</code> variable is not immutable. It contains a string descriptor, a <code>struct</code>.</p>\n\n<pre><code>type stringStruct struct {\n    str unsafe.Pointer\n    len int\n}\n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s := \"abc\"\n    fmt.Println(s)\n    s = \"xyz\"\n    fmt.Println(s)\n\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>abc\nxyz\n</code></pre>\n\n<p>The <code>string</code> contents are immutable. For example,</p>\n\n<pre><code>// error: cannot assign to s[0]\ns[0] = '0'\n</code></pre>\n\n<p>You need synchronization for access to string variables.</p>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 3, "last_activity_date": 1531154225, "creation_date": 1531154225, "answer_id": 51250266, "question_id": 51249918, "link": "https://stackoverflow.com/questions/51249918/immutability-of-string-and-concurrency/51250266#51250266", "title": "Immutability of string and concurrency", "body": "<p>All functions defined on String type at language syntax level or in standard library return a new string instance. No one function mutate string in-place. Just follow this practice and you will be concurrently-safe.  </p>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1057, "favorite_count": 1, "accepted_answer_id": 51250031, "answer_count": 3, "score": 9, "last_activity_date": 1531209613, "creation_date": 1531152900, "question_id": 51249918, "link": "https://stackoverflow.com/questions/51249918/immutability-of-string-and-concurrency", "title": "Immutability of string and concurrency", "body": "<p>Should we synchronize on writing strings? Since string is immutable we will never get inconsistent state between write and read from the 2 different threads, right?</p>\n\n<p>On other words, why we don't have <a href=\"https://golang.org/pkg/sync/atomic/\" rel=\"noreferrer\">atomic</a> for string type? </p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1531153175, "post_id": 51248479, "comment_id": 89478810, "body": "Looks like you want generic HandlerFunc parameterized with URL path. Personally, I don&#39;t think it&#39;s a good idea. For me this make code more verbose and fragile."}], "answers": [{"comments": [{"owner": {"reputation": 884, "user_id": 6651080, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-EY45JeKlPi8/AAAAAAAAAAI/AAAAAAAAG8I/5bwaHIx2IoQ/photo.jpg?sz=128", "display_name": "Dzintars", "link": "https://stackoverflow.com/users/6651080/dzintars"}, "edited": false, "score": 0, "creation_date": 1531204183, "post_id": 51254698, "comment_id": 89495445, "body": "My initial idea was about implementing &quot;Tab&quot; panel in those pages. In case of one URL i load Profile tab content and in case of other - Projects tab content. This way i could minimize amount of template files for every tab because currently already i have 10 tabs JUST for Customer page. And in your example this means 10 additional template files. But i will think about it. Mby it is not good idea i had to append all {{ define ... }} fragments in one file. Thank you for idea about Blocks."}], "tags": [], "owner": {"reputation": 91, "user_id": 9911189, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FpQ1Ants5QU/AAAAAAAAAAI/AAAAAAAAAAc/E4smqVInW44/photo.jpg?sz=128", "display_name": "Arthur Ruckman", "link": "https://stackoverflow.com/users/9911189/arthur-ruckman"}, "is_accepted": true, "score": 4, "last_activity_date": 1531174132, "creation_date": 1531174132, "answer_id": 51254698, "question_id": 51248479, "link": "https://stackoverflow.com/questions/51248479/execute-template-fragment-in-main-template-based-on-requested-url/51254698#51254698", "title": "Execute template fragment in main template based on requested URL", "body": "<p>You may use template blocks for this. </p>\n\n<p><code>templates/customers-base.html</code>:</p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;{{.title}}&lt;/title&gt;\n    &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"static/styles.css\"&gt;\n    &lt;!-- You can include common scripts and stylesheets in the base template --&gt;\n&lt;/head&gt;\n&lt;body&gt;\n{{block \"BODY\" .}}\n\n{{end}}\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p><code>templates/customers-projects.html</code>:</p>\n\n<pre><code>{{define \"BODY\"}}\n\n&lt;h1&gt;Your Projects&lt;/h1&gt;\n&lt;p&gt;Normal template goes here&lt;/p&gt;\n&lt;p&gt;{{.myvar}}&lt;p&gt;\n\n{{end}}\n</code></pre>\n\n<p>You can copy this format for <code>templates/customers-profile.html</code>.</p>\n\n<p>Your project code:</p>\n\n<pre><code>data := map[string]interface{}{\n    \"title\": \"Base template example\",\n    \"myvar\": \"Variable example\",\n}\n\nlayoutCustomersBase     := template.Must(template.ParseFiles(\"templates/customers-base.html\"))\nlayoutCustomersProjects := template.Must(layoutCustomersBase.ParseFiles(\"templates/customers-projects.html\"))\n// Or layoutCustomersProfile, if you are parsing in the '/customers/profile' handler. \n\nerr := layoutError.Execute(w, data)\n</code></pre>\n\n<p>Notice that you can define the \"title\" variable when you execute the <code>customers-projects</code> template; it will be used in the base template.</p>\n"}], "owner": {"reputation": 884, "user_id": 6651080, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-EY45JeKlPi8/AAAAAAAAAAI/AAAAAAAAG8I/5bwaHIx2IoQ/photo.jpg?sz=128", "display_name": "Dzintars", "link": "https://stackoverflow.com/users/6651080/dzintars"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 51254698, "answer_count": 1, "score": 2, "last_activity_date": 1531216562, "creation_date": 1531148171, "last_edit_date": 1531216562, "question_id": 51248479, "link": "https://stackoverflow.com/questions/51248479/execute-template-fragment-in-main-template-based-on-requested-url", "title": "Execute template fragment in main template based on requested URL", "body": "<p>Not sure how to name this correctly.</p>\n\n<p>Is there any way to write one main template and many fragments and inject required fragment based on URL user requests.\nLet's say i have <strong>/customers/profile</strong> and <strong>/customers/projects</strong>. I want to write one main <strong>customer.html</strong> template file and one <strong>customer-includes.html</strong> file with 2 <strong>{{ define \"profile\" }}</strong> and <strong>{{ define \"projects\" }}</strong> fragments.\nThen i want have 2 handlers to handle <strong>/customers/profile</strong> and <strong>/customers/projects</strong> and to execute <strong>customer.html</strong> template.\nBut, when user go to the URL <strong>/customers/profile</strong> i want to inject in main template <strong>{{ template \"profile\" . }}</strong> and if he goes to <strong>/customers/projects</strong> i want to inject <strong>{{ template \"projects\" . }}</strong>.\nWhat is the best way to do this?\nI assume i need to use some kind of {{ if / else }} there. As example below. But mby there is better way.</p>\n\n<pre><code>        {{ if ( eq .Section \"customer-profile\") }} // Could be replaced with Page ID\n            {{ template \"profile\" . }}\n            {{ else }}\n            {{ template \"projects\" . }}\n        {{ end}}\n</code></pre>\n"}, {"tags": ["windows", "go", "user32"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1531144455, "post_id": 51246509, "comment_id": 89473183, "body": "Is there a specific reason you&#39;re not using the <a href=\"https://golang.org/pkg/unicode/utf16/\" rel=\"nofollow noreferrer\"><code>unicode&#47;utf16</code></a> package? Unless I am mistaken, I think that will do what you want?"}, {"owner": {"reputation": 83, "user_id": 8927786, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-BdMJ09pDlmI/AAAAAAAAAAI/AAAAAAAACqo/X6LE-QOP3ds/photo.jpg?sz=128", "display_name": "Pavlo Blazhchuk", "link": "https://stackoverflow.com/users/8927786/pavlo-blazhchuk"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1531145405, "post_id": 51246509, "comment_id": 89473843, "body": "@MartinTournoij You are right, there is a specific reason why I use ToUnicodeEx instead of unicode/utf16. I need to transform virtualKey according to keyboard state. For example, if my language is Ukrainian I want to get Ukrainian character."}], "answers": [{"tags": [], "owner": {"reputation": 83, "user_id": 8927786, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-BdMJ09pDlmI/AAAAAAAAAAI/AAAAAAAACqo/X6LE-QOP3ds/photo.jpg?sz=128", "display_name": "Pavlo Blazhchuk", "link": "https://stackoverflow.com/users/8927786/pavlo-blazhchuk"}, "is_accepted": true, "score": 0, "last_activity_date": 1531651472, "creation_date": 1531651472, "answer_id": 51347611, "question_id": 51246509, "link": "https://stackoverflow.com/questions/51246509/cant-transform-virtualkey-into-unicode/51347611#51347611", "title": "Can&#39;t transform virtualKey into unicode", "body": "<p>I have found the solution. You should call ToUnicode function instead of ToUnicodeEx.</p>\n\n<pre><code>procToUnicode              = user32.NewProc(\"ToUnicode\")\n</code></pre>\n\n<p>...</p>\n\n<pre><code>func toUnicode(virtKey syscall.Handle, scanCode syscall.Handle, keyState *uint16, pwszBuff *uint16) (value syscall.Handle) {\nr0, _, _ := syscall.Syscall6(\n    procToUnicode.Addr(),\n    6,\n    uintptr(virtKey),\n    uintptr(scanCode),\n    uintptr(unsafe.Pointer(keyState)),\n    uintptr(unsafe.Pointer(pwszBuff)),\n    1,\n    0,\n)\n\nvalue = syscall.Handle(r0)\nreturn\n}\n</code></pre>\n\n<p>...</p>\n\n<pre><code>state := toUnicode(virtualCode, scanCode, &amp;keyboardBuf[0], &amp;unicodeBuf[0])\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 8927786, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-BdMJ09pDlmI/AAAAAAAAAAI/AAAAAAAACqo/X6LE-QOP3ds/photo.jpg?sz=128", "display_name": "Pavlo Blazhchuk", "link": "https://stackoverflow.com/users/8927786/pavlo-blazhchuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 1, "accepted_answer_id": 51347611, "answer_count": 1, "score": 2, "last_activity_date": 1531651472, "creation_date": 1531142160, "question_id": 51246509, "link": "https://stackoverflow.com/questions/51246509/cant-transform-virtualkey-into-unicode", "title": "Can&#39;t transform virtualKey into unicode", "body": "<p>I am trying to transform virtualKey to unicode using ToUnicodeEx function from user32.dll. According to the documentation, this method should return 1 or more if success. In my case, it always returns 0.</p>\n\n<pre><code>procGetKeyboardState         = user32.NewProc(\"GetKeyboardState\")\nprocMapVirtualKey            = user32.NewProc(\"MapVirtualKeyA\")\nprocToUnicodeEx              = user32.NewProc(\"ToUnicodeEx\")\n</code></pre>\n\n<p>...</p>\n\n<pre><code>func getKeyboardState(keyboardState *uint16) (len int32, err error) {\nr0, _, e1 := syscall.Syscall(procGetKeyboardState.Addr(), 1, uintptr(unsafe.Pointer(keyboardState)), 0, 0)\nlen = int32(r0)\n\nif len == 0 {\n    if e1 != 0 {\n        err = error(e1)\n    } else {\n        err = syscall.EINVAL\n    }\n}\nreturn\n</code></pre>\n\n<p>}</p>\n\n<p>...</p>\n\n<pre><code>func mapVirtualKey(uCode syscall.Handle) (scanCode syscall.Handle, err error) {\nr0, _, e1 := syscall.Syscall(procMapVirtualKey.Addr(), 2, uintptr(uCode), 0, 0)\n\nif e1 != 0 {\n    err = error(e1)\n    return\n}\nscanCode = syscall.Handle(r0)\nreturn\n</code></pre>\n\n<p>}</p>\n\n<p>...</p>\n\n<pre><code>func toUnicodeEx(virtKey syscall.Handle, scanCode syscall.Handle, keyState *uint16, pwszBuff *uint16) (value syscall.Handle) {\nr0, _, _ := syscall.Syscall6(\n    procToUnicodeEx.Addr(),\n    6,\n    uintptr(virtKey),\n    uintptr(scanCode),\n    uintptr(unsafe.Pointer(keyState)),\n    uintptr(unsafe.Pointer(pwszBuff)),\n    1,\n    0,\n)\n\nvalue = syscall.Handle(r0)\nreturn\n</code></pre>\n\n<p>}</p>\n\n<p>...</p>\n\n<pre><code>keyboardBuf := make([]uint16, 200)\n_, getKeyboardStateErr := getKeyboardState(&amp;keyboardBuf[0])\nif getKeyboardStateErr != nil {\n    log.Fatalf(\"getKeyboardState -&gt; %v\", getKeyboardStateErr)\n}\n\nscanCode, mapVirtualKeyErr := mapVirtualKey(virtualCode)\nif mapVirtualKeyErr != nil {\n    log.Fatalf(\"mapVirtualKey -&gt; %v\", mapVirtualKeyErr)\n}\n\nunicodeBuf := make([]uint16, 200)\nstate := toUnicodeEx(virtualCode, scanCode, &amp;keyboardBuf[0], &amp;unicodeBuf[0])\nfmt.Println(\"KEY BUFF \", keyboardBuf)\nfmt.Println(\"SCAN CODE \", scanCode)\nfmt.Println(\"UNICODE \", state, unicodeBuf)\n</code></pre>\n"}, {"tags": ["go", "viper-go", "go-cobra"], "comments": [{"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1531159700, "post_id": 51246424, "comment_id": 89482097, "body": "Maybe I miss something or you unmarshaling something that is already unmarshalled? Or what is the reason to make it because values are already properly binded to struct"}, {"owner": {"reputation": 3016, "user_id": 476917, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/09e7f8896d4a5104c2058128a03a30b0?s=128&d=identicon&r=PG", "display_name": "Agung Pratama", "link": "https://stackoverflow.com/users/476917/agung-pratama"}, "reply_to_user": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1531178604, "post_id": 51246424, "comment_id": 89489437, "body": "@ttomalak this is because the value coming from (viper) co fig file only binds to the viper instance, not to struct.  I want to decouple my app logic from viper, that is why i want to unmarshall viper values to the struct"}], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 4, "last_activity_date": 1531494662, "creation_date": 1531494662, "answer_id": 51328167, "question_id": 51246424, "link": "https://stackoverflow.com/questions/51246424/how-to-unmarshall-viper-config-value-to-struct-containing-array-of-string-proper/51328167#51328167", "title": "How to Unmarshall Viper config value to struct containing array of string properly?", "body": "<p>After digging into codes of <code>github.com/spf13/{cobra,viper,pflag}</code>for quite a while, I finally find the problem.</p>\n\n<p>When you call <code>pFlags.StringArrayVar(&amp;submitBugOpts.ReasonTags, \"tag\", nil, ...)</code>, the <code>ReasonTags</code>, of course, binds to a wrapper of <code>pflag.stringArrayValue</code>. <a href=\"https://github.com/spf13/viper/blob/d493c32b69b8c6f2377bf30bc4d70267ffbc0793/viper.go#L831\" rel=\"nofollow noreferrer\">source</a>.</p>\n\n<p>And when you call <code>viper.Unmarshall</code>, viper uses <code>v.Get</code> to get the value binds to <code>ReasonTags</code> and then it calls <code>v.find</code>.</p>\n\n<p>In <code>v.find</code>, after the value is found, it uses the wrapper's <code>ValueType()</code> method to determine its type, the wrapper then calls the <code>Type</code> method of the wrapped type, <code>pflag.stringArrayValue</code>, and returns <code>\"stringArray\"</code>. <a href=\"https://github.com/spf13/pflag/blob/3ebe029320b2676d667ae88da602a5f854788a8a/string_array.go#L27\" rel=\"nofollow noreferrer\">source</a></p>\n\n<p>But viper only handle <code>\"stringSlice\"</code> as a special case, so the value gets to <code>default</code> part of type switch, which uses its <code>ValueString()</code> method - making it into a string, with <code>\"[\"</code> and <code>\"]\"</code> on both side. <a href=\"https://github.com/spf13/viper/blob/d493c32b69b8c6f2377bf30bc4d70267ffbc0793/viper.go#L921\" rel=\"nofollow noreferrer\">source</a></p>\n\n<p>And when finally unmarshalling, as your output param, <code>ReasonTags</code> is of <code>[]string</code>, the program simply splitted the string and set it into the field.</p>\n\n<p>As for solution, if you are ok with prohibitting <code>tag</code> to contain <code>,</code>, simply change <code>StringArrayVar</code> to <code>StringSliceVar</code>, but this will results in <code>--tag \"Yet, the problem re-occurs\"</code> into <code>[]string{\"Yet\",\" the problem re-occrus\"}</code>.</p>\n\n<p>If that is critical, you'll need to ask the developers of viper to create a case for <code>stringArray</code>.</p>\n"}], "owner": {"reputation": 3016, "user_id": 476917, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/09e7f8896d4a5104c2058128a03a30b0?s=128&d=identicon&r=PG", "display_name": "Agung Pratama", "link": "https://stackoverflow.com/users/476917/agung-pratama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1576, "favorite_count": 3, "accepted_answer_id": 51328167, "answer_count": 1, "score": 3, "last_activity_date": 1531494662, "creation_date": 1531141886, "last_edit_date": 1531143979, "question_id": 51246424, "link": "https://stackoverflow.com/questions/51246424/how-to-unmarshall-viper-config-value-to-struct-containing-array-of-string-proper", "title": "How to Unmarshall Viper config value to struct containing array of string properly?", "body": "<p>I noticed that this is perhaps a bug when viper tries to unmarshall to struct. To explain it better, consider this:</p>\n\n<p><strong>I have a cli command like below</strong>\n<code>\ndd-cli submit-bug --name \"Bug 1\" --tag reason1 --tag reason2\n</code></p>\n\n<p>Here is my command line source code</p>\n\n<pre><code>package cmd\n\nimport (\n    \"fmt\"\n\n    \"github.com/spf13/viper\"\n\n    \"github.com/spf13/cobra\"\n)\n\n// SubmitBugOpts is a set of flags being exposed by this Deploy command\ntype SubmitBugOpts struct {\n    Name string `mapstructure:\"bug-name\"`\n\n    ReasonTags []string `mapstructure:\"tags\"`\n}\n\nvar (\n    submitBugOpts = SubmitBugOpts{}\n)\n\nfunc submitBugRun(cmd *cobra.Command, args []string) {\n    fmt.Printf(\"Bug Name is %+v\\n\", submitBugOpts.Name)\n    fmt.Printf(\"List of tags is %+v\\n\", submitBugOpts.ReasonTags)\n    fmt.Printf(\"Length of tags is %d\\n\", len(submitBugOpts.ReasonTags))\n    for index, el := range submitBugOpts.ReasonTags {\n        fmt.Printf(\"tag[%d] = %s\\n\", index, el)\n    }\n}\n\nvar submitBugCmd = &amp;cobra.Command{\n    Use:   \"submit-bug\",\n    Short: \"Deploy/Install a helm chart to Kubernetes cluster\",\n    Run:   submitBugRun,\n    PreRun: func(cmd *cobra.Command, args []string) {\n        pFlags := cmd.PersistentFlags()\n        viper.BindPFlag(\"bug-name\", pFlags.Lookup(\"name\"))\n        viper.BindPFlag(\"tags\", pFlags.Lookup(\"tag\"))\n\n        fmt.Printf(\"Viper all setting value: %+v\\n\", viper.AllSettings())\n        fmt.Printf(\"Before unmarshall: %+v\\n\", submitBugOpts)\n        viper.Unmarshal(&amp;submitBugOpts)\n        fmt.Printf(\"After unmarshall: %+v\\n\", submitBugOpts)\n    },\n}\n\nfunc init() {\n    rootCmd.AddCommand(submitBugCmd)\n\n    pFlags := submitBugCmd.PersistentFlags()\n    pFlags.StringVar(&amp;submitBugOpts.Name, \"name\", \"\", \"the bug name\")\n    pFlags.StringArrayVar(&amp;submitBugOpts.ReasonTags, \"tag\", nil, \"the bug's reason tag. You can define it multiple times\")\n\n    submitBugCmd.MarkPersistentFlagRequired(\"name\")\n    submitBugCmd.MarkPersistentFlagRequired(\"tag\")\n}\n</code></pre>\n\n<p><strong>I run this command:</strong></p>\n\n<pre><code>dd-cli submit-bug --name \"Bug 1\" --tag reason1 --tag reason2\n</code></pre>\n\n<p><strong>And the output is below</strong></p>\n\n<pre><code>Viper all setting value: map[bug-name:Bug 1 tags:[reason1,reason2]]\nBefore unmarshall: {Name:Bug 1 ReasonTags:[reason1 reason2]}\nAfter unmarshall: {Name:Bug 1 ReasonTags:[[reason1 reason2]]}\nBug Name is Bug 1\nList of tags is [[reason1 reason2]]\nLength of tags is 2\ntag[0] = [reason1\ntag[1] = reason2]\n</code></pre>\n\n<p>I expect the <code>viper.Unmarshall()</code> will correctly omit the <code>[</code> for  <code>submitBugOpts.ReasonTags [0]</code> and omit the <code>]</code> for <code>submitBugOpts.ReasonTags[1]</code>. So the expected value of submitBugOpts.ReasonTags doesn't contains any <code>[</code> and <code>]</code> .</p>\n\n<p>Any pointer how to fix this? I've submitted this issue on viper repo: <a href=\"https://github.com/spf13/viper/issues/527\" rel=\"nofollow noreferrer\">https://github.com/spf13/viper/issues/527</a>. However I am asking on SO just in case you guys know how to handle this too.</p>\n"}, {"tags": ["go", "jetbrains-ide", "goland"], "answers": [{"comments": [{"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 0, "creation_date": 1531152819, "post_id": 51248237, "comment_id": 89478618, "body": "Yes, first time you have to do it manually, please feel free to create a ticket if you want this changed somehow: <a href=\"https://youtrack.jetbrains.com/issues/Go\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issues/Go</a>"}, {"owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 0, "creation_date": 1531223064, "post_id": 51248237, "comment_id": 89506487, "body": "thank you for your response. maybe I just used to Intellij IDEA java behaviour"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 0, "creation_date": 1531237106, "post_id": 51248237, "comment_id": 89516813, "body": "I looked a bit more on our tracker and found this issue: <a href=\"https://youtrack.jetbrains.com/issue/GO-4770\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/GO-4770</a> Unfortunately, it doesn&#39;t look like a popular request but it doesn&#39;t have to be in order to be implemented. I&#39;ll add a note about this question there."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 3, "last_activity_date": 1531147475, "creation_date": 1531147475, "answer_id": 51248237, "question_id": 51246417, "link": "https://stackoverflow.com/questions/51246417/goland-ide-doesnt-put-project-into-workspace-during-checkout-from-vcs/51248237#51248237", "title": "GoLand IDE doesn&#39;t put project into workspace during checkout from VCS", "body": "<p>You can specify the directory where the checkout is done right in the checkout dialog, see below.<a href=\"https://i.stack.imgur.com/Ouhgo.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Ouhgo.png\" alt=\"vsc checkout dialog\"></a></p>\n\n<p>After the first checkout, the IDE will remember where to do the next one, as it's shown in my case and it will suggest something similar.</p>\n\n<p>However, with the rise of vgo as a dependency management tool, this will not be required anymore as the GOPATH will stop being mandatory.</p>\n"}], "owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 1, "accepted_answer_id": 51248237, "answer_count": 1, "score": 2, "last_activity_date": 1531147475, "creation_date": 1531141864, "last_edit_date": 1531145539, "question_id": 51246417, "link": "https://stackoverflow.com/questions/51246417/goland-ide-doesnt-put-project-into-workspace-during-checkout-from-vcs", "title": "GoLand IDE doesn&#39;t put project into workspace during checkout from VCS", "body": "<p>If I create project from scratch, GoLand pay attention to my workspace and put project correct according to $GOPATH.</p>\n\n<p>For example I have GOPATH: <em>$HOME/{user}/go</em>, so GoLand put it into :</p>\n\n<pre><code>$HOME/{user}/go/src/{myproject}\n</code></pre>\n\n<p>But if I try to checkout from VCS it puts into <strong>GoLandProjects</strong> directory:</p>\n\n<pre><code>$HOME/GoLandProjects/{myproject}\n</code></pre>\n\n<p>Is it possible to change that behavior?</p>\n"}, {"tags": ["go", "github"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 3, "creation_date": 1531140433, "post_id": 51245504, "comment_id": 89470400, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/14323872/using-forked-package-import-in-go\">Using forked package import in Go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 169, "user_id": 4308995, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Y67yP_ssGp4/AAAAAAAAAAI/AAAAAAAAAA8/R9-airLP3iU/photo.jpg?sz=128", "display_name": "Bruce", "link": "https://stackoverflow.com/users/4308995/bruce"}, "edited": false, "score": 0, "creation_date": 1531141065, "post_id": 51246034, "comment_id": 89470832, "body": "Thanks. You are of great help!"}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 4, "last_activity_date": 1531140650, "creation_date": 1531140650, "answer_id": 51246034, "question_id": 51245504, "link": "https://stackoverflow.com/questions/51245504/what-to-do-if-i-want-to-make-changes-to-a-forked-repository-only-to-find-that-i/51246034#51246034", "title": "What to do if I want to make changes to a forked repository only to find that I can not because the forked package import itself", "body": "<p>When working with golang forks of a repo, try and work in the import path of the original repo, and update the tooling to use your forked repo.</p>\n\n<p>What I mean is, if you have forked the project <code>github.com/rylio/ytdl/</code> to your own github account <code>github.com/brucewangno1/ytdl</code></p>\n\n<p>Then you might have a gopath such as:</p>\n\n<pre><code>$GOPATH/src/github.com\n\u251c\u2500\u2500 rylio\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 ytdl\n\u2514\u2500\u2500 brucewangno1\n    \u2514\u2500\u2500 ytdl\n</code></pre>\n\n<p>You should make changes in the directory <code>$GOPATH/src/github.com/rylio/ytdl</code>.</p>\n\n<p>To add the changes to your forked repo, you can set another origin in git, inside your local clone of <code>rylio/ytdl</code></p>\n\n<pre><code>git remote add fork git@github.brucewangno1/tydl.git\n</code></pre>\n\n<p>If you do not plan on merging changes back into the upstream repo, you can use tools such as <code>dep</code> to ensure that you pull your own fork of that project instead of the upstream one. Something like:</p>\n\n<pre><code>[[constraint]]\nname = \"github.com/c/d\nsource = \"https://github.com/myusername/d.git\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 169, "user_id": 4308995, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Y67yP_ssGp4/AAAAAAAAAAI/AAAAAAAAAA8/R9-airLP3iU/photo.jpg?sz=128", "display_name": "Bruce", "link": "https://stackoverflow.com/users/4308995/bruce"}, "edited": false, "score": 0, "creation_date": 1531141130, "post_id": 51246056, "comment_id": 89470883, "body": "How interesting! Thanks"}], "tags": [], "owner": {"reputation": 157, "user_id": 2853674, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001786755227/picture?type=large", "display_name": "Satyam Zode", "link": "https://stackoverflow.com/users/2853674/satyam-zode"}, "is_accepted": false, "score": 3, "last_activity_date": 1531140684, "creation_date": 1531140684, "answer_id": 51246056, "question_id": 51245504, "link": "https://stackoverflow.com/questions/51245504/what-to-do-if-i-want-to-make-changes-to-a-forked-repository-only-to-find-that-i/51246056#51246056", "title": "What to do if I want to make changes to a forked repository only to find that I can not because the forked package import itself", "body": "<blockquote>\n  <p>This answer assumes that you forked repository\n  <a href=\"https://github.com/rylio/ytdl/\" rel=\"nofollow noreferrer\">https://github.com/rylio/ytdl/</a> to <a href=\"https://github.com/brucewangno1/ytdl\" rel=\"nofollow noreferrer\">https://github.com/brucewangno1/ytdl</a></p>\n</blockquote>\n\n<p>You need to create directory named <code>rylio</code> in your <code>$GOPATH</code> and clone your fork into that directory. </p>\n\n<pre><code>mkdir $GOPATH/src/github.com/rylio\n\ncd $GOPATH/src/github.com/rylio\n\ngit clone https://github.com/brucewangno1/ytdl \n</code></pre>\n\n<p>Now, you will not face any issues related to the imports.</p>\n"}, {"tags": [], "owner": {"reputation": 13358, "user_id": 3878940, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/v1J2L.jpg?s=128&g=1", "display_name": "Aditya Singh", "link": "https://stackoverflow.com/users/3878940/aditya-singh"}, "is_accepted": false, "score": 5, "last_activity_date": 1531171238, "creation_date": 1531171238, "answer_id": 51254188, "question_id": 51245504, "link": "https://stackoverflow.com/questions/51245504/what-to-do-if-i-want-to-make-changes-to-a-forked-repository-only-to-find-that-i/51254188#51254188", "title": "What to do if I want to make changes to a forked repository only to find that I can not because the forked package import itself", "body": "<p>Another easy way is to use <code>go get</code> instead:</p>\n\n<pre><code>$ go get github.com/original/a_library\n$ cd $GOPATH/src/github.com/original/a_library\n$ git remote add my_origin https://github.com/myaccount/a_library\n</code></pre>\n\n<p>In your case it will be </p>\n\n<pre><code>$ go get github.com/rylio/ytdl\n$ cd $GOPATH/src/github.com/rylio/ytdl\n$ git remote add my_origin https://github.com/brucewangno1/ytdl\n</code></pre>\n\n<p>Once you are done with changes, commit them and push using below:</p>\n\n<pre><code>$ git push my_origin my_branch\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 4308995, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Y67yP_ssGp4/AAAAAAAAAAI/AAAAAAAAAA8/R9-airLP3iU/photo.jpg?sz=128", "display_name": "Bruce", "link": "https://stackoverflow.com/users/4308995/bruce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 1, "accepted_answer_id": 51246034, "answer_count": 3, "score": 3, "last_activity_date": 1531171238, "creation_date": 1531138881, "question_id": 51245504, "link": "https://stackoverflow.com/questions/51245504/what-to-do-if-i-want-to-make-changes-to-a-forked-repository-only-to-find-that-i", "title": "What to do if I want to make changes to a forked repository only to find that I can not because the forked package import itself", "body": "<p>Like <a href=\"https://github.com/rylio/ytdl/\" rel=\"nofollow noreferrer\">this github repository</a>, I forked the repository and made some changes to the code. When I run it, my changes are not in effect because the original code imports itself. I could simply just change the import library to mine like \"import github.com/brucewangno1/ytdl\". But is there any other clean way to avoid this? </p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 1358, "user_id": 5275376, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a8bbb1e2df58ceebc9bbb5596bf823f3?s=128&d=identicon&r=PG&f=1", "display_name": "Shiva Kishore", "link": "https://stackoverflow.com/users/5275376/shiva-kishore"}, "edited": false, "score": 0, "creation_date": 1531139103, "post_id": 51245431, "comment_id": 89469543, "body": "first of all your json is not valid, There are two <code>id</code> in the same object. and according to the data you have <code>type JsonObject map[string]interface{}</code> might suit you."}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 4916541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5feb487de3a812a9e96c1c25d0e6aee?s=128&d=identicon&r=PG&f=1", "display_name": "FutureDroid", "link": "https://stackoverflow.com/users/4916541/futuredroid"}, "edited": false, "score": 0, "creation_date": 1531157699, "post_id": 51246309, "comment_id": 89481144, "body": "That is exactly what I used.  What I am trying to do next is pass it in a func as such:  <code>profile := JsonObject{173000,&quot;VLSuEE5m1kmIhgE7ZhHDFe&quot;,&quot;&quot;,&quot;en&quot;,0,&quot;http:&#47;&zwnj;&#8203;&#47;video&#47;playlist.m3u8&zwnj;&#8203;&quot;,&quot;m3u8&quot;,&quot;h264&quot;,&quot;PAN&zwnj;&#8203;-EN&quot;,&quot;&quot;,&quot;2016-09-29T&zwnj;&#8203;00:00:00&quot;}    body, _ := json.Marshal(profile)</code> . I am not sure how to handle the DATASTRUCTURE portion."}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1531159685, "post_id": 51246309, "comment_id": 89482090, "body": "The <code>DATASTRUCTURE</code> part is an empty object. No need set anything in the Go code."}, {"owner": {"reputation": 57, "user_id": 4916541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5feb487de3a812a9e96c1c25d0e6aee?s=128&d=identicon&r=PG&f=1", "display_name": "FutureDroid", "link": "https://stackoverflow.com/users/4916541/futuredroid"}, "edited": false, "score": 0, "creation_date": 1531166894, "post_id": 51246309, "comment_id": 89485475, "body": "but I have to pass someting otherwise the JsonObject complains that I am not passing the same amount of fields.  I can&#39;t just pass &quot;&quot; for it."}, {"owner": {"reputation": 157, "user_id": 2853674, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001786755227/picture?type=large", "display_name": "Satyam Zode", "link": "https://stackoverflow.com/users/2853674/satyam-zode"}, "reply_to_user": {"reputation": 57, "user_id": 4916541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5feb487de3a812a9e96c1c25d0e6aee?s=128&d=identicon&r=PG&f=1", "display_name": "FutureDroid", "link": "https://stackoverflow.com/users/4916541/futuredroid"}, "edited": false, "score": 0, "creation_date": 1531201320, "post_id": 51246309, "comment_id": 89494449, "body": "@FutureDroid You can skip <code>DATASTRUCTURE</code> field in the Go code."}], "tags": [], "owner": {"reputation": 157, "user_id": 2853674, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001786755227/picture?type=large", "display_name": "Satyam Zode", "link": "https://stackoverflow.com/users/2853674/satyam-zode"}, "is_accepted": false, "score": 1, "last_activity_date": 1531141543, "creation_date": 1531141543, "answer_id": 51246309, "question_id": 51245431, "link": "https://stackoverflow.com/questions/51245431/json-object-with-nested-structures-in-golang/51246309#51246309", "title": "json object with nested structures in golang", "body": "<p>You can use <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a>  to generate struct for the given json schema.\nFor example, json given in the question can be represented like:</p>\n\n<pre><code>type AutoGenerated []struct {\nTime          int    `json:\"time\"`\nID            string `json:\"id\"`\nHeight        string `json:\"height\"`\nDATASTRUCTURE struct {\n} `json:\"DATASTRUCTURE\"`\nLanguage     string `json:\"language\"`\nSize         int    `json:\"size\"`\nURL          string `json:\"url\"`\nType         string `json:\"type\"`\nDefinitionid string `json:\"definitionid\"`\nReference    string `json:\"reference\"`\nContent      string `json:\"content\"`\nRevisiondate string `json:\"revisiondate\"`\nData         struct {\n} `json:\"data\"`\nThumbs struct {\n    Num32 string `json:\"32\"`\n    Num64 string `json:\"64\"`\n} `json:\"thumbs\"`\nTitle string `json:\"title\"`\nHash  string `json:\"hash\"`}\n</code></pre>\n\n<p>Hope this helps!</p>\n"}], "owner": {"reputation": 57, "user_id": 4916541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5feb487de3a812a9e96c1c25d0e6aee?s=128&d=identicon&r=PG&f=1", "display_name": "FutureDroid", "link": "https://stackoverflow.com/users/4916541/futuredroid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1531141883, "creation_date": 1531138618, "last_edit_date": 1531141883, "question_id": 51245431, "link": "https://stackoverflow.com/questions/51245431/json-object-with-nested-structures-in-golang", "title": "json object with nested structures in golang", "body": "<p>I have the following json object that I am trying to represent with Go as a <code>type JsonObject struct</code> \nand pass it back in its original json so that I can return the json as an api endpoint.  Any advice/example?</p>\n\n<pre><code>[{\n    \"time\": 173000,\n    \"id\": \"VLSuEE5m1kmIhgE7ZhHDFe\",\n    \"height\": \"\",\n    \"DATASTRUCTURE\": {\n\n    },\n    \"language\": \"en\",\n    \"size\": 0,\n    \"url\": \"http://www.gstatic.com/play.m3u8\",\n    \"type\": \"vid\",\n    \"definitionid\": \"h264\",\n    \"reference\": \"PAN-EN\",\n    \"content\": \"This is some content\",\n    \"revisiondate\": \"2017-11-29T00:00:00\",\n    \"data\": {\n\n    },\n    \"id\": \"BBBB3424-153E-49DE-4786-013B6611BBBB\",\n    \"thumbs\": {\n        \"32\": \"https://www.gstatic.com/images?q=tbn:ANd9GcRj\",\n        \"64\": \"https://www.gstatic.com/images?q=tbn:DPd3GcRj\"\n    },\n    \"title\": \"Cafeteria\",\n    \"hash\": \"BBBB5d39bea20edf76c94133be61BBBB\"\n}]\n</code></pre>\n"}, {"tags": ["testing", "go", "continuous-integration", "tdd", "goconvey"], "comments": [{"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1531139387, "post_id": 51245181, "comment_id": 89469728, "body": "GoConvey supports Go&#39;s native testing package. Neither the web UI nor the DSL are required; you can use either one independently."}, {"owner": {"reputation": 2725, "user_id": 303114, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/kBVST.jpg?s=128&g=1", "display_name": "danfromisrael", "link": "https://stackoverflow.com/users/303114/danfromisrael"}, "reply_to_user": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 0, "creation_date": 1531139712, "post_id": 51245181, "comment_id": 89469929, "body": "@Bert Verhees i run go test, see a failing test but get exit code 0..."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1531166759, "post_id": 51245181, "comment_id": 89485404, "body": "<code>go test</code> should exit with code 1 on test failures, <a href=\"https://github.com/golang/go/blob/master/src/testing/testing.go#L1040-L1046\" rel=\"nofollow noreferrer\">see this</a>, and that value is used <a href=\"https://github.com/golang/go/blob/master/src/cmd/go/go_test.go#L212-L218\" rel=\"nofollow noreferrer\">here</a>. For various initialisation errors it seems to use exit code 2. It would be helpful if you could provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> which demonstrates the problem."}], "answers": [{"comments": [{"owner": {"reputation": 2725, "user_id": 303114, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/kBVST.jpg?s=128&g=1", "display_name": "danfromisrael", "link": "https://stackoverflow.com/users/303114/danfromisrael"}, "edited": false, "score": 0, "creation_date": 1531142300, "post_id": 51245967, "comment_id": 89471722, "body": "i ran your example and got exit code 0 for that failing test"}, {"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "reply_to_user": {"reputation": 2725, "user_id": 303114, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/kBVST.jpg?s=128&g=1", "display_name": "danfromisrael", "link": "https://stackoverflow.com/users/303114/danfromisrael"}, "edited": false, "score": 0, "creation_date": 1531144712, "post_id": 51245967, "comment_id": 89473366, "body": "No, you did not run my example, you wrapped it in some other code and then ran it. That is a completely other story, which caused me and you headaches. Don&#39;t do that again."}], "tags": [], "owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "is_accepted": false, "score": 1, "last_activity_date": 1531172275, "last_edit_date": 1531172275, "creation_date": 1531140457, "answer_id": 51245967, "question_id": 51245181, "link": "https://stackoverflow.com/questions/51245181/why-goconvey-tests-fail-with-error-code-0/51245967#51245967", "title": "Why GoConvey Tests fail with error code 0?", "body": "<p>You can run goconvey as a normal test, you can test this very simply by writing a small test which gives a predictable result, like this</p>\n\n<pre><code>package c\n\nimport (\n    \"testing\"\n    . \"github.com/smartystreets/goconvey/convey\"\n)\n\nfunc TestConvey(t *testing.T){\n    Convey(\"TestConvey\", t, func() {\n        So(false, ShouldBeTrue)\n    })\n}\n</code></pre>\n\n<p>This should be the result\n    xxx 14:44:03 ~/GO/src/c/c > go test\n    x\n    Failures:</p>\n\n<pre><code>* /home/xxx/GO/src/c/c/a_test.go \nLine 10:\nExpected: true\nActual:   false\n\n\n1 total assertion\n\n--- FAIL: TestConvey (0.00s)\nFAIL\nexit status 1\nFAIL    c/c     0.006s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2725, "user_id": 303114, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/kBVST.jpg?s=128&g=1", "display_name": "danfromisrael", "link": "https://stackoverflow.com/users/303114/danfromisrael"}, "is_accepted": true, "score": 2, "last_activity_date": 1531142886, "creation_date": 1531142886, "answer_id": 51246762, "question_id": 51245181, "link": "https://stackoverflow.com/questions/51245181/why-goconvey-tests-fail-with-error-code-0/51246762#51246762", "title": "Why GoConvey Tests fail with error code 0?", "body": "<p>Ok found the bug:</p>\n\n<p>I have TestMain in my code that runs before the tests:</p>\n\n<pre><code>func TestMain(m *testing.M) {\n    log.SetOutput(ioutil.Discard) // Disable logs.\n    m.Run()\n}\n</code></pre>\n\n<p><code>m.Run</code> should be wrapped with <code>os.Exit</code> so it can be used with error status codes:</p>\n\n<pre><code>func TestMain(m *testing.M) {\n    log.SetOutput(ioutil.Discard) // Disable logs.\n    os.Exit(m.Run())\n}\n</code></pre>\n\n<p>that fixed the problem</p>\n"}], "owner": {"reputation": 2725, "user_id": 303114, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/kBVST.jpg?s=128&g=1", "display_name": "danfromisrael", "link": "https://stackoverflow.com/users/303114/danfromisrael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 0, "closed_date": 1531196155, "accepted_answer_id": 51246762, "answer_count": 2, "score": 0, "last_activity_date": 1531172275, "creation_date": 1531137913, "last_edit_date": 1531151072, "question_id": 51245181, "link": "https://stackoverflow.com/questions/51245181/why-goconvey-tests-fail-with-error-code-0", "closed_reason": "Not suitable for this site", "title": "Why GoConvey Tests fail with error code 0?", "body": "<p>I need to run my GoConvey tests as part of my build\nhow do i make sure <code>go test</code> exits with error exit code (not 0)?</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 3975, "user_id": 1509834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hJ9Fe.jpg?s=128&g=1", "display_name": "Simon Bennetts", "link": "https://stackoverflow.com/users/1509834/simon-bennetts"}, "edited": false, "score": 0, "creation_date": 1531138215, "post_id": 51244871, "comment_id": 89468965, "body": "I&#39;m confused - that doesnt look like anything that ZAP logs. Whats actually logging those messages?"}, {"owner": {"reputation": 329, "user_id": 5919955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8cabb9c86566b6e34d9c62213f2708ce?s=128&d=identicon&r=PG&f=1", "display_name": "kbenda", "link": "https://stackoverflow.com/users/5919955/kbenda"}, "reply_to_user": {"reputation": 3975, "user_id": 1509834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hJ9Fe.jpg?s=128&g=1", "display_name": "Simon Bennetts", "link": "https://stackoverflow.com/users/1509834/simon-bennetts"}, "edited": false, "score": 0, "creation_date": 1531138785, "post_id": 51244871, "comment_id": 89469311, "body": "I create a logger <code>logger, _ := zap.NewDevelopment()</code>. Then I add two field (<i>pid</i> and <i>process</i>) to the logger (like above). When I want to log some messages I use the following line: <code>logger.Info(&quot;Logging message 1&quot;)</code> And I get the following log line in terminal: <code>[STDERR] 2018-07-09 11:06:16.003    INFO    some_pkg&#47;main.go:232    Logging message 1   {&quot;pid&quot;: 8842, &quot;process&quot;: &quot;some_process&quot;}</code>"}, {"owner": {"reputation": 3975, "user_id": 1509834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hJ9Fe.jpg?s=128&g=1", "display_name": "Simon Bennetts", "link": "https://stackoverflow.com/users/1509834/simon-bennetts"}, "edited": false, "score": 0, "creation_date": 1531230298, "post_id": 51244871, "comment_id": 89511803, "body": "What are you adding the logger to? ZAP is written in Java..."}, {"owner": {"reputation": 329, "user_id": 5919955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8cabb9c86566b6e34d9c62213f2708ce?s=128&d=identicon&r=PG&f=1", "display_name": "kbenda", "link": "https://stackoverflow.com/users/5919955/kbenda"}, "reply_to_user": {"reputation": 3975, "user_id": 1509834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hJ9Fe.jpg?s=128&g=1", "display_name": "Simon Bennetts", "link": "https://stackoverflow.com/users/1509834/simon-bennetts"}, "edited": false, "score": 1, "creation_date": 1531294823, "post_id": 51244871, "comment_id": 89536905, "body": "I thought about a different library. <a href=\"https://github.com/uber-go/zap\" rel=\"nofollow noreferrer\">github.com/uber-go/zap</a> This is a golang library which helps to create a fast, structured logging system."}, {"owner": {"reputation": 3975, "user_id": 1509834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hJ9Fe.jpg?s=128&g=1", "display_name": "Simon Bennetts", "link": "https://stackoverflow.com/users/1509834/simon-bennetts"}, "edited": false, "score": 0, "creation_date": 1531384178, "post_id": 51244871, "comment_id": 89578361, "body": "Ah, wrong tag then  - the &#39;zap&#39; tag on stackoverflow is for the OWASP Zed Attack Proxy, aka ZAP. I&#39;ll remove that tag..."}], "owner": {"reputation": 329, "user_id": 5919955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8cabb9c86566b6e34d9c62213f2708ce?s=128&d=identicon&r=PG&f=1", "display_name": "kbenda", "link": "https://stackoverflow.com/users/5919955/kbenda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2136, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1531384211, "creation_date": 1531136915, "last_edit_date": 1531384211, "question_id": 51244871, "link": "https://stackoverflow.com/questions/51244871/how-to-add-new-column-field-to-zap-logging-structure", "title": "How to add new column/field to ZAP logging structure?", "body": "<p>I have the following logging structure:\n<code>\n[STDERR] 2018-07-09 11:06:16.003    INFO    some_pkg/main.go:232    Logging message 1   {\"pid\": 8842, \"process\": \"some_process\"}\n[STDERR] 2018-07-09 11:06:16.006    DEBUG   some_pkg/main.go:291    Logging message 2   {\"pid\": 8842, \"process\": \"other_process\"}\n[STDERR] 2018-07-09 11:06:16.009    INFO    some_pkg/main.go:345    Logging message 3   {\"pid\": 8842, \"process\": \"some_process\"}\n</code>\nYou can see there are five types of information in this logging snippet. There are date/time, log-level, occurrence, message and a JSON fields (except [STDERR] field). Which means I have five columns in my logging structure. I would like to add a new columns with key <em>pid</em> and <em>process</em> (from the JSON). How should I do this with ZAP encoders and configs? I didn't find a solution for that in the ZAP documentation.\nI use the following code to add fields to the logging: </p>\n\n<p><code>logger = logger.With(zap.Field{Key: \"pid\", Type: zapcore.Int64Type, Integer: int64(os.Getpid())})</code>\nBut the pid field's value goes to a JSON (what you can see above) and I would like to see it in a new column. There is an easy way in ZAP to do this?</p>\n\n<p>My desired structure would be the following with the previous example:\n<code>\n[STDERR] 2018-07-09 11:06:16.003    INFO    some_pkg/main.go:232    Logging message 1   8842    some_process\n[STDERR] 2018-07-09 11:06:16.006    DEBUG   some_pkg/main.go:291    Logging message 2   8836    other_process\n[STDERR] 2018-07-09 11:06:16.009    INFO    some_pkg/main.go:345    Logging message 3   8842    some_process\n</code></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 6335, "user_id": 816449, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1dad5941fe69ec5107e2a214316447a9?s=128&d=identicon&r=PG", "display_name": "Bunyk", "link": "https://stackoverflow.com/users/816449/bunyk"}, "is_accepted": true, "score": 2, "last_activity_date": 1531214525, "last_edit_date": 1531214525, "creation_date": 1531141232, "answer_id": 51246222, "question_id": 51244695, "link": "https://stackoverflow.com/questions/51244695/editing-play-code-sections-inside-golang-present-presentation/51246222#51246222", "title": "Editing .play code sections inside Golang present presentation", "body": "<p>As usual, RTFM, in <a href=\"https://godoc.org/golang.org/x/tools/present\" rel=\"nofollow noreferrer\">present documentation</a>:</p>\n\n<blockquote>\n  <p>The .code function may take one or more flags immediately preceding\n  the filename. This command shows test.go in an editable text area:</p>\n  \n  <p>.code -edit test.go</p>\n</blockquote>\n\n<p>Same works for the <code>.play</code> command, because as documentation tells us \"The function \"play\" is the same as \"code\"\":</p>\n\n<pre><code>.play -edit hello.go\n</code></pre>\n"}], "owner": {"reputation": 6335, "user_id": 816449, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1dad5941fe69ec5107e2a214316447a9?s=128&d=identicon&r=PG", "display_name": "Bunyk", "link": "https://stackoverflow.com/users/816449/bunyk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "accepted_answer_id": 51246222, "answer_count": 1, "score": 2, "last_activity_date": 1531214525, "creation_date": 1531136331, "question_id": 51244695, "link": "https://stackoverflow.com/questions/51244695/editing-play-code-sections-inside-golang-present-presentation", "title": "Editing .play code sections inside Golang present presentation", "body": "<p>I'm working on introductory Golang course, and wanted to insert something like <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">https://play.golang.org/</a> embeddings into my slides. I found out about golang.org/x/tools/present package, and decided to use it for my slides. I insert examples into my in <code>.slide</code> file using:</p>\n\n<pre><code>.play hello.go\n</code></pre>\n\n<p>which works almost as expected. I'm just not able to edit example from browser.</p>\n\n<p>In <code>GOPATH/src/golang.org/x/tools/cmd/present/templates/action.tmpl</code> I see following code:</p>\n\n<pre><code>{{define \"code\"}}\n  &lt;div class=\"code{{if playable .}} playground{{end}}\" {{if .Edit}}contenteditable=\"true\" spellcheck=\"false\"{{end}}&gt;{{.Text}}&lt;/div&gt;\n{{end}}\n</code></pre>\n\n<p>Which suggests that it is possibly editable. But how to enable it?</p>\n"}, {"tags": ["testing", "go", "visual-studio-code", "code-coverage", "delve"], "owner": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 487, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1531135411, "creation_date": 1531135411, "question_id": 51244385, "link": "https://stackoverflow.com/questions/51244385/vscode-or-delve-issue-unable-to-test-at-all", "title": "VSCode or Delve issue - Unable to test at all", "body": "<p>I have two projects on GitHub (<a href=\"https://github.com/NlaakStudios\" rel=\"nofollow noreferrer\">https://github.com/NlaakStudios</a>) (gowaf and ezgo). Debugging and Testing with VSCode and Delve work perfectly with the gowaf repo using the default launch.json. It does not work with ezgo which is just the config from gowaf moved into a different repo.\nWith gowaf I get the \"Run Packed test\" and \"Run file Test\" options above the package and test functions. With ezgo I do not. gowaf was created and was being debugged and tested pre-last VSCode update and ezgo after update.\nBoth are frameworks with no main package, so I need test enabled for non-main binaries (as I have been doing). Below is the output from the config package in gowaf (working) and ezgo (not working)</p>\n\n<p><em>gowaf/config/</em></p>\n\n<blockquote>\n  <p>Running tool: D:\\Go\\bin\\go.exe test\n  -coverprofile=C:\\Users\\Nlaak\\AppData\\Local\\Temp\\go-code-cover -timeout 30s</p>\n  \n  <p>PASS coverage: 91.8% of statements ok \n    <em>/d</em>/GO_Projects/src/github.com/NlaakStudios/gowaf/config   0.059s\n  Success: Tests passed.</p>\n</blockquote>\n\n<p><em>ezgo/config/</em></p>\n\n<blockquote>\n  <p>API server listening at: 127.0.0.1:27828 not an executable file could\n  not remove\n  d:\\GO_Projects\\src\\github.com\\NlaakStudios\\ezgo\\config\\debug.test:\n  remove\n  d:\\GO_Projects\\src\\github.com\\NlaakStudios\\ezgo\\config\\debug.test: The\n  system cannot find the file specified. Process exiting with code: 1</p>\n</blockquote>\n\n<p>My current focus is on code coverage and this is just killing me. Complete stop and I cannot figure it out for the life of me. Any help would be appreciated. I have TeamViewer if you want to actually get your hands dirty with it as i monitor.\nThanks in advance...</p>\n\n<pre><code>Environment Information &amp; Versions\n------------------------------------------------------------\nWindows 10 Home (all updates)\n------------------------------------------------------------\nDelve Debugger\nVersion: 1.0.0\nBuild: $Id: c98a142125d0b17bb11ec0513bde346229b5f533 $\n------------------------------------------------------------\ngo version go1.10.3 windows/amd64\n------------------------------------------------------------\nVSCode Version Info\nVersion: 1.25.0\nCommit: 0f080e5267e829de46638128001aeb7ca2d6d50e\nDate: 2018-07-05T13:11:58.697Z\nElectron: 1.7.12\nChrome: 58.0.3029.110\nNode.js: 7.9.0\nV8: 5.8.283.38\nArchitecture: x64\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1531140564, "post_id": 51244274, "comment_id": 89470498, "body": "db.Joins() can be used for performing joins in gorm. Check if it solves your problem."}, {"owner": {"reputation": 105, "user_id": 7324602, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3f3cfaaef5f110bbf4d2d9140e905b5?s=128&d=identicon&r=PG&f=1", "display_name": "Udayakumar", "link": "https://stackoverflow.com/users/7324602/udayakumar"}, "reply_to_user": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1531143631, "post_id": 51244274, "comment_id": 89472593, "body": "Yeah, I tried that, But how can I used multiple tables? @AnkitDeshpande"}], "answers": [{"comments": [{"owner": {"reputation": 1021, "user_id": 5160688, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e91397eeb44ebbcdb5db2bc679df067e?s=128&d=identicon&r=PG", "display_name": "kiran malvi", "link": "https://stackoverflow.com/users/5160688/kiran-malvi"}, "edited": false, "score": 2, "creation_date": 1540374812, "post_id": 52949659, "comment_id": 92838368, "body": "Can&#39;t we use PreLoad()?"}], "tags": [], "owner": {"reputation": 171, "user_id": 3416332, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000295097055/picture?type=large", "display_name": "Kirikami", "link": "https://stackoverflow.com/users/3416332/kirikami"}, "is_accepted": false, "score": 3, "last_activity_date": 1540299346, "creation_date": 1540299346, "answer_id": 52949659, "question_id": 51244274, "link": "https://stackoverflow.com/questions/51244274/how-to-multiple-table-joins-in-gorm/52949659#52949659", "title": "How to multiple table joins in GORM", "body": "<p>I was looking for the solution here but since I already figured it out by myself, I would like to post it here also. My query was a bit different and I was joining only 2 tables but I think this one should work, too.</p>\n\n<pre><code>if err := db.Table(\"employee\").Select(\"department.id, employee.department_id, employeeContact.employee_id\").Joins(\"JOIN department on department.id = employee.department_id\").Joins(\"JOIN employeeContact on employeeContact.id = employee.id\").Find(&amp;results).Error; err != nil {\n    return err, \"\"\n}\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 7324602, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3f3cfaaef5f110bbf4d2d9140e905b5?s=128&d=identicon&r=PG&f=1", "display_name": "Udayakumar", "link": "https://stackoverflow.com/users/7324602/udayakumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4723, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1540299346, "creation_date": 1531135028, "last_edit_date": 1539070626, "question_id": 51244274, "link": "https://stackoverflow.com/questions/51244274/how-to-multiple-table-joins-in-gorm", "title": "How to multiple table joins in GORM", "body": "<p>I'm a newbie for GOlang and GORM, I have some confusion how to multiple table join using GORM.</p>\n\n<p>Example:</p>\n\n<p>Tables:</p>\n\n<pre><code>Department - Fields (gorm.Modal, dep_name)\nEmployee - Fields (gorm.Modal, emp_id, emp_name, department_id) //employee is department table child \nEmployeeContact - Fields (gorm.Modal, employee_id, emp_contact_no)//Employee contact table is employee table child\n</code></pre>\n\n<p>Query</p>\n\n<pre><code>SELECT * FROM department d, employee e, employeeContact ec WHERE d.id = e.department_id and e.id = ec.employee_id\n</code></pre>\n\n<p>How to make the above query using GORM?</p>\n"}, {"tags": ["json", "go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 9455524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bc28321813d15a4689401383fd11ba7?s=128&d=identicon&r=PG&f=1", "display_name": "B. Delor", "link": "https://stackoverflow.com/users/9455524/b-delor"}, "is_accepted": false, "score": 0, "last_activity_date": 1531135023, "creation_date": 1531135023, "answer_id": 51244271, "question_id": 51244176, "link": "https://stackoverflow.com/questions/51244176/error-while-unmarshalling-json-data-using-interface/51244271#51244271", "title": "error while Unmarshalling json data using interface?", "body": "<p>Because you are trying to unmarshall an array into a map.</p>\n\n<p>The easiest fix is to unmarshall into an array of maps</p>\n\n<pre><code>var dat []map[string]interface{}\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "edited": false, "score": 0, "creation_date": 1531135661, "post_id": 51244283, "comment_id": 89467332, "body": "Can you tell me that how to bind that mapped data with the struct?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1531136263, "post_id": 51244283, "comment_id": 89467755, "body": "@puneet55667788 check my edited answer on using struct"}, {"owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "edited": false, "score": 0, "creation_date": 1531137257, "post_id": 51244283, "comment_id": 89468399, "body": "Yo you do it well!! Thanks"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1531195491, "post_id": 51244283, "comment_id": 89492832, "body": "downvoters please post a comment to help me out to understand my mistakes so that I can correct them in future else please don&#39;t downvote without any reason"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 0, "last_activity_date": 1531135950, "last_edit_date": 1531135950, "creation_date": 1531135057, "answer_id": 51244283, "question_id": 51244176, "link": "https://stackoverflow.com/questions/51244176/error-while-unmarshalling-json-data-using-interface/51244283#51244283", "title": "error while Unmarshalling json data using interface?", "body": "<p>From Golang spec for <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">Json unmarshal to interface{}</a>:</p>\n\n<blockquote>\n  <p>To unmarshal JSON into an interface value, Unmarshal stores one of\n  these in the interface value:</p>\n</blockquote>\n\n<pre><code>bool, for JSON booleans\nfloat64, for JSON numbers\nstring, for JSON strings\n[]interface{}, for JSON arrays // slice of interface{}\nmap[string]interface{}, for JSON objects\nnil for JSON null\n</code></pre>\n\n<p>Because the json that you are trying to unmarshal is an array so either use slice of <code>interface{}</code> as mentioned in Golang spec or slice of <code>map[string]interface{}</code> not <code>map[string]interface{}</code>. That's why returning an error. Change your variable declaration as </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    bytes := []byte(`[{\"day\":\"Sunday\",\"time_slug\":1,\"timing\":\"8:00 am - 9:00 am\",\"count\":\"1\"},\n  {\"day\":\"Sunday\",\"time_slug\":2,\"timing\":\"10:00 am - 11:00 am\",\"count\":\"1\"}]`)  \n    var result []interface{}\n    if err := json.Unmarshal(bytes, &amp;result); err != nil{\n        fmt.Println(err)\n    }\n    fmt.Println(result)\n}\n</code></pre>\n\n<p>Working code on <a href=\"https://play.golang.org/p/nmnAEUyWyhu\" rel=\"nofollow noreferrer\">Go playground</a></p>\n\n<p><strong>Edited</strong>: you can also go for using structs if you know your json structure. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype ResultData []struct {\n    Day      string `json:\"day\"`\n    TimeSlug int    `json:\"time_slug\"`\n    Timing   string `json:\"timing\"`\n    Count    string `json:\"count\"`\n}\n\nfunc main() {\n    bytes := []byte(`[{\"day\":\"Sunday\",\"time_slug\":1,\"timing\":\"8:00 am - 9:00 am\",\"count\":\"1\"},\n  {\"day\":\"Sunday\",\"time_slug\":2,\"timing\":\"10:00 am - 11:00 am\",\"count\":\"1\"}]`)  \n    var result ResultData\n    if err := json.Unmarshal(bytes, &amp;result); err != nil{\n        fmt.Println(err)\n    }\n    fmt.Println(result)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/7jnpH8I2aLj\" rel=\"nofollow noreferrer\">Playground Example</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 51244283, "answer_count": 2, "score": 0, "last_activity_date": 1531144085, "creation_date": 1531134687, "last_edit_date": 1531144085, "question_id": 51244176, "link": "https://stackoverflow.com/questions/51244176/error-while-unmarshalling-json-data-using-interface", "title": "error while Unmarshalling json data using interface?", "body": "<p>I'm retrieving the data from database and using Jquery stringify the same data. Now I want to unmarshall that data. Data is as below:</p>\n\n<pre><code>values = [{\"day\":\"Sunday\",\"time_slug\":1,\"timing\":\"8:00 am - 9:00 am\",\"count\":\"1\"},\n  {\"day\":\"Sunday\",\"time_slug\":2,\"timing\":\"10:00 am - 11:00 am\",\"count\":\"1\"}]\n</code></pre>\n\n<p>Code I'm using:</p>\n\n<pre><code>func SaveProviderSpot(c *gin.Context) {\n //values := c.PostForm(\"array\")\n byt := []byte(values)\n var dat map[string]interface{}\n if err := json.Unmarshal(byt, &amp;dat); err != nil {\n     panic(err)\n  }\n  fmt.Println(dat)\n}\n</code></pre>\n"}, {"tags": ["go", "types", "interface", "slice"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1531144978, "post_id": 51243359, "comment_id": 89473532, "body": "The second and third cases are extremely unidiomatic Go. If a function might return a value or an error, it should have two return values, like every other such function in Go - e.g. <code>func ReturnArrayAsInterface() (interface{},error)</code>."}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1531160160, "post_id": 51243359, "comment_id": 89482306, "body": "<code>return []int{4, 6, 8, 10}</code>"}, {"owner": {"reputation": 377, "user_id": 5953626, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-dDwLTM1rSaQ/AAAAAAAAAAI/AAAAAAAAEkM/XVdkrI4-qxk/photo.jpg?sz=128", "display_name": "Nannan AV", "link": "https://stackoverflow.com/users/5953626/nannan-av"}, "reply_to_user": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1531162653, "post_id": 51243359, "comment_id": 89483545, "body": "Hahaha, @dolmen. It was just an example I gave. The actual values are not as simple as []int{4, 6, 8, 10} :) Also my question is not to return that array, but to understand the working of the code!"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1531133752, "last_edit_date": 1531133752, "creation_date": 1531132224, "answer_id": 51243411, "question_id": 51243359, "link": "https://stackoverflow.com/questions/51243359/return-array-as-interface/51243411#51243411", "title": "Return array as interface", "body": "<p>Because Go is a statically typed language. Your first example works because type of <code>retval</code> is <code>[]int</code>, and so you can append <code>int</code> values to it. You used <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">short variable declaration</a>, so the type of <code>retval</code> is inferred from the right-hand side expression, which clearly is of type <code>[]int</code>. When you return this <code>[]int</code> value, it will be automatically wrapped in an <code>interface{}</code> value.</p>\n\n<p>In your second case you use a named result type, where you explicitly specify its type to be <code>interface{}</code>, and you can't append values to a value of type <code>interface{}</code> (a non-slice type). It doesn't matter that the dynamic type of the value stored in the <code>retval</code> interface value is a slice, its static type is <code>interface{}</code>.</p>\n\n<p>It would work with a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>:</p>\n\n<pre><code>retval = append(retval.([]int), 4, 6, 8, 10)\n</code></pre>\n\n<p>But the first solution is much cleaner and more efficient.</p>\n\n<p>Your third case is almost like the second: you use <a href=\"https://golang.org/ref/spec#Variable_declarations\" rel=\"nofollow noreferrer\">variable declaration</a> where you explicitly state you want the <code>retval</code> variable to be of type <code>interface{}</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "is_accepted": false, "score": 1, "last_activity_date": 1531170616, "creation_date": 1531170616, "answer_id": 51254079, "question_id": 51243359, "link": "https://stackoverflow.com/questions/51243359/return-array-as-interface/51254079#51254079", "title": "Return array as interface", "body": "<p>Case 3 will not work as in Case 2 in case of panic: in case of <code>panic</code> the <code>return retval</code> will not run, so <code>nil</code> will be returned by <code>ReturnArrayAsInterface3</code>. </p>\n\n<p>To fix Case 2, use a variable with a static type as long as possible because it is safer (catches bugs) and more efficient.</p>\n\n<pre><code>func ReturnArrayAsInterface2() (retval interface{}) {\n    defer func() {\n        if r := recover(); r != nil {\n            retval = r\n        }\n    }()\n    r := make([]int, 0)\n    retval = append(r, 4, 6, 8, 10)\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 377, "user_id": 5953626, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-dDwLTM1rSaQ/AAAAAAAAAAI/AAAAAAAAEkM/XVdkrI4-qxk/photo.jpg?sz=128", "display_name": "Nannan AV", "link": "https://stackoverflow.com/users/5953626/nannan-av"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1729, "favorite_count": 0, "accepted_answer_id": 51243411, "answer_count": 2, "score": 3, "last_activity_date": 1531170616, "creation_date": 1531132071, "last_edit_date": 1531133556, "question_id": 51243359, "link": "https://stackoverflow.com/questions/51243359/return-array-as-interface", "title": "Return array as interface", "body": "<h2>Case 1</h2>\n\n<p>I have the following method which works perfectly fine. Here I am returning an array as an interface.</p>\n\n<pre><code>func ReturnArrayAsInterface1() interface{} {\n    retval := make([]int, 0)\n    retval = append(retval, 4, 6, 8, 10)\n    return retval\n}\n</code></pre>\n\n<h2>Case 2</h2>\n\n<p>Consider the following method. Here I want to return the error in case of a panic, so I define the <code>retval</code> at the beginning and change its value in <code>defer</code>. But this shows an error \"Cannot use 'retval' (type interface{}) as type []Type\"</p>\n\n<pre><code>func ReturnArrayAsInterface2() (retval interface{}) {\n    defer func() {\n        if r := recover(); r != nil {\n            retval = r\n        }\n    }()\n    retval = make([]int, 0)\n    retval = append(retval, 4, 6, 8, 10) .  // error here : Cannot use 'retval' (type interface{}) as type []Type\n    return retval\n}\n</code></pre>\n\n<p>So what I would like to know is, why is it that the first function works fine whereas the second does not? Are there any ways to overcome this?</p>\n\n<h2>Case 3</h2>\n\n<p>This also works similarly to <strong>Case 2</strong>:</p>\n\n<pre><code>func ReturnArrayAsInterface3() interface{} {\n    var retval interface{}\n    defer func() {\n        if r := recover(); r != nil {\n            retval = r\n        }\n    }()\n    retval = make([]int, 0)\n    retval = append(retval, 4, 6, 8, 10) .  // error here : Cannot use 'retval' (type interface{}) as type []Type\n    return retval\n}\n</code></pre>\n"}, {"tags": ["testing", "go", "go-graceful"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "edited": false, "score": 0, "creation_date": 1531143105, "post_id": 51244097, "comment_id": 89472284, "body": "Thank you for answer but I think I cannot tell correctly. I enter a new post with code now."}, {"owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "edited": false, "score": 0, "creation_date": 1531148260, "post_id": 51244097, "comment_id": 89475863, "body": "You&#39;re great. Thank you so much. Config variable changed on the fly :). I already use fsnotify to watch file. Thanks."}], "tags": [], "owner": {"reputation": 1589, "user_id": 2983542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4840fe7bdf44e6d7dea4ceb828ac70b5?s=128&d=identicon&r=PG&f=1", "display_name": "PhilipGough", "link": "https://stackoverflow.com/users/2983542/philipgough"}, "is_accepted": true, "score": 0, "last_activity_date": 1531146702, "last_edit_date": 1531146702, "creation_date": 1531134439, "answer_id": 51244097, "question_id": 51243260, "link": "https://stackoverflow.com/questions/51243260/how-can-i-see-or-test-graceful-restarts-in-go/51244097#51244097", "title": "How can I see or test graceful restarts in Go?", "body": "<p>Updating answer based on the changes to your question. The endless library can allow you to handle that signal by default. You will need to register a hook. I've expanded on your example code below:</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"fmt\"\n    \"syscall\"\n\n    \"github.com/gin-gonic/gin\"\n    \"github.com/fvbock/endless\"\n    \"github.com/BurntSushi/toml\"\n)\n\ntype Config struct {\n    Age  int\n    Cats []string\n}\n\nvar cfg Config\n\nfunc restart(c *gin.Context) {\n    syscall.Kill(os.Getpid(), syscall.SIGUSR1)\n}\n\nfunc readConfig() {\n    toml.DecodeFile(\"config.toml\", &amp;cfg)\n    fmt.Println(\"Testing\", cfg)\n}\n\nfunc main() {\n        readConfig()\n    router := gin.New()\n\n    router.GET(\"/restart\", restart)\n\n    srv  := endless.NewServer(\"localhost:7777\", router)\n\n        srv.SignalHooks[endless.PRE_SIGNAL][syscall.SIGUSR1] = append(\n                srv.SignalHooks[endless.PRE_SIGNAL][syscall.SIGUSR1],\n                readConfig)\n\n        if err := srv.ListenAndServe(); err != nil {\n                panic(err)\n        }\n\n}\n</code></pre>\n\n<p>Now when you call the restart endpoint, you should see the changes to config file refelcted in stdout. However in order to watch the file for changes you would need to use something like <a href=\"https://github.com/fsnotify/fsnotify\" rel=\"nofollow noreferrer\">fsnotify</a></p>\n"}], "owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 1, "accepted_answer_id": 51244097, "answer_count": 1, "score": 0, "last_activity_date": 1531146806, "creation_date": 1531131769, "last_edit_date": 1531146806, "question_id": 51243260, "link": "https://stackoverflow.com/questions/51243260/how-can-i-see-or-test-graceful-restarts-in-go", "title": "How can I see or test graceful restarts in Go?", "body": "<p>I serve HTTP over <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">gin's</a> <a href=\"https://github.com/fvbock/endless\" rel=\"nofollow noreferrer\">https://github.com/fvbock/endless</a>. I would like to see the differences from the basic HTTP server.</p>\n\n<p>I've sent <code>syscall.SIGUSR1</code> signal with:</p>\n\n<pre><code>syscall.Kill(getPid(), syscall.SIGUSR1)\n</code></pre>\n\n<p>The app doesn't exit, but I cannot detect the restart.</p>\n\n<p>What I have to do is initialise new configurations to the app when the toml config file changes.</p>\n\n<p>My code is as follows: </p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"fmt\"\n    \"syscall\"\n\n    \"github.com/gin-gonic/gin\"\n    \"github.com/fvbock/endless\"\n    \"github.com/BurntSushi/toml\"\n)\n\ntype Config struct {\n    Age  int\n    Cats []string\n}\n\nvar cfg Config\n\nfunc restart(c *gin.Context) {\n    syscall.Kill(os.Getpid(), syscall.SIGUSR1)\n}\n\nfunc init() {\n    toml.DecodeFile(\"config.toml\", &amp;cfg)\n    fmt.Println(\"Testing\", cfg)\n}\n\nfunc main() {\n    router := gin.New()\n\n    router.GET(\"/restart\", restart)\n\n    if err := endless.ListenAndServe(\"localhost:7777\", router); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>When I hit the restart endpoint, I want the toml config printed out.</p>\n"}, {"tags": ["go", "profiling", "allocation", "memory-profiling"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1531150165, "post_id": 51242564, "comment_id": 89477023, "body": "<code>pprof</code> is a sampling profiler. Allocating 16 bytes is not going to get sampled when the default threshold is 512Kb."}], "answers": [{"comments": [{"owner": {"reputation": 361, "user_id": 7229120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5af5b05b1499d40493fb6ed087bf12b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron", "link": "https://stackoverflow.com/users/7229120/aaron"}, "edited": false, "score": 0, "creation_date": 1531146802, "post_id": 51244986, "comment_id": 89474822, "body": "Thank you for your answer. But the allocation still remains unseen using the steps you provided."}], "tags": [], "owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "is_accepted": false, "score": 0, "last_activity_date": 1531137284, "creation_date": 1531137284, "answer_id": 51244986, "question_id": 51242564, "link": "https://stackoverflow.com/questions/51242564/why-does-using-new-on-an-object-not-get-included-in-the-memory-profiling-file/51244986#51244986", "title": "Why does using new() on an object not get included in the memory profiling file in Go?", "body": "<p>First of all is better if you split your test and core function into two file.\nBy that I mean in your <code>main.go</code> file should have</p>\n\n<pre><code>package main\n\ntype T struct {\n    a int\n    b int\n}\n\nfunc (t *T) Add() int {\n    return t.a + t.b\n}\n\nfunc Add(a, b int) *T {\n    t := new(T)\n    t.a = a\n    t.b = b\n    return t\n}\n</code></pre>\n\n<p>and <code>main_test.go</code></p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc TestA(t *testing.T) {\n    Add(1, 2)\n}\n</code></pre>\n\n<p>Then to resolve your anserw. Memprofiling is build into <code>bench</code> tool <a href=\"https://golang.org/pkg/runtime/pprof/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/runtime/pprof/</a> so you need to run your pprof profiling by using</p>\n\n<p><code>go test -memprofile mem.prof -bench .</code></p>\n\n<p>As you can see there was <code>-bench</code> flag missing in your command</p>\n"}], "owner": {"reputation": 361, "user_id": 7229120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5af5b05b1499d40493fb6ed087bf12b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron", "link": "https://stackoverflow.com/users/7229120/aaron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1531137284, "creation_date": 1531129591, "last_edit_date": 1531135748, "question_id": 51242564, "link": "https://stackoverflow.com/questions/51242564/why-does-using-new-on-an-object-not-get-included-in-the-memory-profiling-file", "title": "Why does using new() on an object not get included in the memory profiling file in Go?", "body": "<p>This is the code I am profiling:</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n)\n\ntype T struct {\n    a int\n    b int\n}\n\nfunc TestA(t *testing.T) {\n    Add(1, 2)\n}\n\nfunc (t *T) Add() int {\n    return t.a + t.b\n}\n\nfunc Add(a, b int) *T {\n    t := new(T)\n    t.a = a\n    t.b = b\n    return t\n}\n</code></pre>\n\n<p>I ran the test using:</p>\n\n<pre><code>go test -memprofile mem.prof abc_test.go\n</code></pre>\n\n<p>But I can't find any allocation in the profiling file:</p>\n\n<pre><code>$ go tool pprof --alloc_objects main.test mem.prof\nFile: main.test\nType: alloc_objects\nTime: Jul 9, 2018 at 9:40am (UTC)\nEntering interactive mode (type \"help\" for commands, \"o\" for options)\n(pprof) top\nShowing nodes accounting for 0, 0% of 0 total\n  flat  flat%   sum%        cum   cum%\n</code></pre>\n\n<p>Is there something wrong? To my understanding, the line <code>t:= new(T)</code> will cause an allocation.</p>\n"}, {"tags": ["ajax", "go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "edited": false, "score": 0, "creation_date": 1531130915, "post_id": 51242823, "comment_id": 89464629, "body": "you want to say that I have to convert my array into string or int??"}, {"owner": {"reputation": 6622, "user_id": 3176419, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3e847cffa08386a9f91307038942161a?s=128&d=identicon&r=PG", "display_name": "lucumt", "link": "https://stackoverflow.com/users/3176419/lucumt"}, "edited": false, "score": 0, "creation_date": 1531131064, "post_id": 51242823, "comment_id": 89464726, "body": "@puneet55667788 yeah,convert to pure string or convert to <code>json</code>"}, {"owner": {"reputation": 6622, "user_id": 3176419, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3e847cffa08386a9f91307038942161a?s=128&d=identicon&r=PG", "display_name": "lucumt", "link": "https://stackoverflow.com/users/3176419/lucumt"}, "edited": false, "score": 0, "creation_date": 1531131205, "post_id": 51242823, "comment_id": 89464797, "body": "@puneet55667788 convert to json is more suitable for you"}, {"owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "edited": false, "score": 0, "creation_date": 1531131242, "post_id": 51242823, "comment_id": 89464809, "body": "can you give example for it"}, {"owner": {"reputation": 6622, "user_id": 3176419, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3e847cffa08386a9f91307038942161a?s=128&d=identicon&r=PG", "display_name": "lucumt", "link": "https://stackoverflow.com/users/3176419/lucumt"}, "edited": false, "score": 1, "creation_date": 1531131484, "post_id": 51242823, "comment_id": 89464938, "body": "@puneet55667788 this link <a href=\"https://stackoverflow.com/questions/12693947/how-to-send-json-instead-of-a-query-string-with-ajax\" title=\"how to send json instead of a query string with ajax\">stackoverflow.com/questions/12693947/&hellip;</a> is about how to send <code>json</code> via <code>ajax</code>,and in server side,you can use parse <code>json</code> with the built in library"}], "tags": [], "owner": {"reputation": 6622, "user_id": 3176419, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3e847cffa08386a9f91307038942161a?s=128&d=identicon&r=PG", "display_name": "lucumt", "link": "https://stackoverflow.com/users/3176419/lucumt"}, "is_accepted": true, "score": 1, "last_activity_date": 1531130936, "last_edit_date": 1531130936, "creation_date": 1531130492, "answer_id": 51242823, "question_id": 51242404, "link": "https://stackoverflow.com/questions/51242404/why-the-array-will-not-send-through-the-ajax-call/51242823#51242823", "title": "Why the array will not send through the ajax call?", "body": "<p>You can not send an array directly from client to server,due to the array definition may not be the same in both sides.</p>\n\n<p>Two ways to solve it:</p>\n\n<p>a. You can convert the array into a json string in the clinet,then send it to server as a string parameter,in the server side,you can parse it and convert it to array </p>\n\n<p>b. Iterate the array,and convert it to a string using some special characters,also pass to server as string parameter,an example is as below: </p>\n\n<pre><code>var dataStr = \"\";\nfor (var i = 1; i &lt;= optionsArr; i++) {\n    //each array element split with 3 semicolons,and each property in element split with 2 semicolons\n    dataStr += valueSelected + \";;\" + i + \";;\" + $(\"#\"+i).text() \n           + \";;\" + $('#select_count'+i).val() + \";;;\";\n}\n$.ajax({\n    url:\"/api/v1/provider_spot\",\n    type:\"POST\",\n    data:{dataStr:dataStr},\n    dataType:\"json\",\n    success:function(response){\n        console.log(response);\n    }\n});\n//now it is correct\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 51242823, "answer_count": 1, "score": 1, "last_activity_date": 1531130936, "creation_date": 1531129074, "question_id": 51242404, "link": "https://stackoverflow.com/questions/51242404/why-the-array-will-not-send-through-the-ajax-call", "title": "Why the array will not send through the ajax call?", "body": "<p>In my ajax code I'm sending an associative array to the go lang api but go lang would not receiving any array. Why?</p>\n\n<pre><code>for (var i = 1; i &lt;= optionsArr; i++) {\n    span_arr.push({\n        day       : valueSelected,\n        time_slug : i,\n        timing    : $(\"#\"+i).text(),\n        count     : $('#select_count'+i).val()\n    });\n}\nconsole.log(span_arr[1].time_slug);\n$.ajax({\n    url:\"/api/v1/provider_spot\",\n    type:\"POST\",\n    data:{span_arr:span_arr},\n    dataType:\"json\",\n    success:function(response){\n        console.log(response);\n    }\n});\n</code></pre>\n\n<p>Why this ajax will not sending the array to the go api?\nHere in go lang following mvc structure I want to receiving this data:</p>\n\n<pre><code> Route{\"SaveProviderSpot\", \"POST\", \"/provider_spot\", controller.SaveProviderSpot},\n\n func SaveProviderSpot(c *gin.Context) {\n   fmt.Println(c.PostForm(\"span_arr\"))\n }\n</code></pre>\n"}, {"tags": ["mysql", "go"], "answers": [{"tags": [], "owner": {"reputation": 556, "user_id": 3581874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a2073bb9adeaf4226234f85ff4c1b69?s=128&d=identicon&r=PG&f=1", "display_name": "MichalG", "link": "https://stackoverflow.com/users/3581874/michalg"}, "is_accepted": false, "score": 6, "last_activity_date": 1531127404, "last_edit_date": 1531127404, "creation_date": 1531127017, "answer_id": 51241738, "question_id": 51241616, "link": "https://stackoverflow.com/questions/51241616/while-reading-sql-rows-next-performing-another-query-returns-error-1046-no-da/51241738#51241738", "title": "While reading sql.Rows.Next() performing another query returns error: 1046 no database selected", "body": "<p>sql.DB is not a single connection to the database but a pool of connections, therefore there is no guarantee that the same connection will be used in subsequent queries (unless you do them within a transaction).</p>\n\n<p>From <a href=\"https://golang.org/pkg/database/sql/#DB\" rel=\"noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>DB is a database handle representing a pool of zero or more underlying\n  connections. It's safe for concurrent use by multiple goroutines.</p>\n  \n  <p>The sql package creates and frees connections automatically; it also\n  maintains a free pool of idle connections. If the database has >a\n  concept of per-connection state, such state can only be reliably\n  observed within a transaction</p>\n</blockquote>\n\n<p>Another word of warning - a connection on which you run queries that change the state of the connection (eg. running directly SQL statements such as <code>USE &lt;db_name&gt;</code>, <code>BEGIN</code>, etc.) will return to the pool of connections used to connect to the DB, and this state may corrupt other queries (where you expect the state to be clean).</p>\n"}], "owner": {"reputation": 382, "user_id": 6684824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be60ef65f35a846db65522b36ddc5d7b?s=128&d=identicon&r=PG&f=1", "display_name": "NF Lee", "link": "https://stackoverflow.com/users/6684824/nf-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1531135833, "creation_date": 1531126624, "last_edit_date": 1531135833, "question_id": 51241616, "link": "https://stackoverflow.com/questions/51241616/while-reading-sql-rows-next-performing-another-query-returns-error-1046-no-da", "title": "While reading sql.Rows.Next() performing another query returns error: 1046 no database selected", "body": "<p>(errcheck and some details omitted) </p>\n\n<h2>Setup</h2>\n\n<p>I opened the database like this:</p>\n\n<pre><code>d, err = sql.Open(\"mysql\", \"user:passwd@tcp(127.0.0.1:3306)/\")\n_, err = d.Exec(\"CREATE DATABASE IF NOT EXISTS myblog\")\n_, err = d.Exec(\"USE myblog\")\n</code></pre>\n\n<p>But if I change it to this, everything is fine:</p>\n\n<pre><code>d, err = sql.Open(\"mysql\", \"user:passwd@tcp(127.0.0.1:3306)/myblog\")\n</code></pre>\n\n<h2>Execution</h2>\n\n<p>I have two tables:</p>\n\n<pre><code>articles\nID, ArticleID, Title, CreateDate, PreviewContent, Content, PRIMARY KEY (ID)\n\ncategories\nArticleID, CategoryName, PRIMARY KEY (ArticleID, CategoryName)\n</code></pre>\n\n<p>In one function, I select 10 rows from <code>articles</code>:</p>\n\n<pre><code>selectAtcs := `\n    SELECT ArticleID, Title, CreateDate, PreviewContent\n    FROM articles \n    ORDER BY ID DESC\n    LIMIT ?\n    OFFSET ?`\n\nvar rows *sql.Rows\nrows, err = db.DB.Query(selectAtcs, 10, 0)\n</code></pre>\n\n<p>While reading each one of them, I performed another query to get the category related to <code>ArticleID</code>:</p>\n\n<pre><code>for rows.Next() {\n    var a Article\n    err = rows.Scan(&amp;a.ArticleID, &amp;a.Title, &amp;a.CreateDate, &amp;a.PreviewContent)\n\n    selectCtg := `\n        SELECT CategoryName\n        FROM categories \n        WHERE ArticleID = ?`\n\n    var ctgRows *sql.Rows\n    ctgRows, err = db.DB.Query(selectCtg, a.ArticleID)\n}\n</code></pre>\n\n<p>The last line in the above code returns an error: <code>1046 no database selected</code></p>\n"}, {"tags": ["go", "twitter"], "answers": [{"comments": [{"owner": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1531126450, "post_id": 51241490, "comment_id": 89461809, "body": "So what are the MediaIds in the struct for?"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "reply_to_user": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1531126486, "post_id": 51241490, "comment_id": 89461835, "body": "If you have ids of the medias you able to use it."}, {"owner": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1531126544, "post_id": 51241490, "comment_id": 89461869, "body": "How? Can you give an example please?"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "reply_to_user": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 1, "creation_date": 1531126629, "post_id": 51241490, "comment_id": 89461934, "body": "Also you can use <a href=\"https://github.com/twitter/twurl\" rel=\"nofollow noreferrer\">github.com/twitter/twurl</a> in order to upload media and get an id. Here is an example of struct with media <code>StatusUpdateParams{MediaIds: []int64{123456789, 987654321}</code>"}, {"owner": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1531126997, "post_id": 51241490, "comment_id": 89462153, "body": "Not sure <code>twurl</code> would be useful for my use case, as it <code>... will return an URL that you should open up in your browser.</code> . The bot has no browser."}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "reply_to_user": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 1, "creation_date": 1531127057, "post_id": 51241490, "comment_id": 89462185, "body": "Read at the bottom of page <a href=\"https://developer.twitter.com/en/docs/media/upload-media/uploading-media/media-best-practices\" rel=\"nofollow noreferrer\">developer.twitter.com/en/docs/media/upload-media/&hellip;</a>"}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 3, "last_activity_date": 1531126259, "creation_date": 1531126259, "answer_id": 51241490, "question_id": 51241135, "link": "https://stackoverflow.com/questions/51241135/how-can-i-upload-media-using-go-twitter-bot/51241490#51241490", "title": "How can I upload media using go-twitter bot?", "body": "<p>There is no such <a href=\"https://github.com/dghubble/go-twitter/issues/76\" rel=\"nofollow noreferrer\">functionality</a>. </p>\n"}], "owner": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 51241490, "answer_count": 1, "score": 1, "last_activity_date": 1531126259, "creation_date": 1531125158, "question_id": 51241135, "link": "https://stackoverflow.com/questions/51241135/how-can-i-upload-media-using-go-twitter-bot", "title": "How can I upload media using go-twitter bot?", "body": "<p>I'm new to go, and have made this simple bot using <code>go-twitter</code> package. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/dghubble/go-twitter/twitter\"\n    \"github.com/dghubble/oauth1\"\n)\n\nfunc main() {\n    consumerKey := \"SECRET\"\n    consumerSecret := \"SECRET\"\n    accessToken := \"SECRET\"\n    accessSecret := \"SECRET\"\n\n    config := oauth1.NewConfig(consumerKey, consumerSecret)\n    token := oauth1.NewToken(accessToken, accessSecret)\n\n    // OAuth1 http.Client will automatically authorize Requests\n    httpClient := config.Client(oauth1.NoContext, token)\n\n    // Twitter client\n    client := twitter.NewClient(httpClient)\n\n    tweet, resp, err := client.Statuses.Update(\"Hi baby, I'm just a bot!\", nil)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Printf(\"TWEETED: %+v , %v\\n\", tweet.Text, resp)\n}\n</code></pre>\n\n<p>I'm wondering how can I upload media using this bot?</p>\n\n<p>I see there is a <code>MediaIds</code> in <a href=\"https://github.com/dghubble/go-twitter/blob/master/twitter/statuses.go#L168\" rel=\"nofollow noreferrer\">the source code</a>, but have not clue how to use that and there is no explanation in the docs.</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1531127155, "post_id": 51240909, "comment_id": 89462251, "body": "Neither S3 nor CloudFront should have any problem whatsoever with 100 req/s, and if by chance you were pushing one of them too hard, you would get <code>5xx</code> HTTP errors, not a performance slowdown.  You should add more logging and benchmarking, don&#39;t pass up any opportunity to log an event as it occurs, so that you have better visibility of what is happening over time.  Also, you don&#39;t appear to actually be using CloudFront, here."}, {"owner": {"reputation": 382, "user_id": 4120230, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/x2tsI.jpg?s=128&g=1", "display_name": "NightOwl19", "link": "https://stackoverflow.com/users/4120230/nightowl19"}, "edited": false, "score": 0, "creation_date": 1531129076, "post_id": 51240909, "comment_id": 89463518, "body": "I haven&#39;t experienced any such thing yet after 4 months of heavy use. Hopefully AWS has needed load balancers running to keep up the performance. worry not!"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1531129584, "post_id": 51240909, "comment_id": 89463816, "body": "see this answer and associated q&amp;a and linked aws docs <a href=\"https://stackoverflow.com/questions/47089159/aws-serving-static-files-with-performance-in-mind/47095520#47095520\" title=\"aws serving static files with performance in mind\">stackoverflow.com/questions/47089159/&hellip;</a>"}, {"owner": {"reputation": 45, "user_id": 9833158, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Sainath", "link": "https://stackoverflow.com/users/9833158/sainath"}, "edited": false, "score": 0, "creation_date": 1531132872, "post_id": 51240909, "comment_id": 89465642, "body": "Downloads echo &quot;GET <a href=\"http://darkroom-integration-internal.golabs.io/uploads/07ff33ae-7bdb-4d14-9534-64s675aca.jpg\" rel=\"nofollow noreferrer\">darkroom-integration-internal.golabs.io/uploads/&hellip;</a>&quot; | vegeta attack -rate=50 -duration=120s | vegeta report Requests      [total, rate]            6000, 50.01 Duration      [total, attack, wait]    2m1.636014735s, 1m59.979663146s, 1.656351589s Latencies     [mean, 50, 95, 99, max]  5.004324553s, 4.716245926s, 9.644331835s, 11.154205027s, 19.202948033s Bytes In      [total, mean]            1229802000, 204967.00"}, {"owner": {"reputation": 45, "user_id": 9833158, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Sainath", "link": "https://stackoverflow.com/users/9833158/sainath"}, "edited": false, "score": 0, "creation_date": 1531132968, "post_id": 51240909, "comment_id": 89465704, "body": "These are the results which i get when i use cloudfront!! Where could be the problem?The above code is using direct S3 bucket"}], "owner": {"reputation": 45, "user_id": 9833158, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Sainath", "link": "https://stackoverflow.com/users/9833158/sainath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1531124344, "creation_date": 1531124298, "last_edit_date": 1531124344, "question_id": 51240909, "link": "https://stackoverflow.com/questions/51240909/do-we-get-a-degraded-performance-from-s3-cloudfront-after-certain-limit-of-reque", "title": "Do we get a degraded performance from S3/cloudfront after certain limit of requests?", "body": "<p>I am building an application to read images (400kb on average) from the S3 bucket. The time taken to read them is gradually increasing to minutes. So I used a CloudFront to increase the performance. But even with the CloudFront enabled the time taken has increased after a certain number of requests.\nNote: I am trying for a performance of 100rps for a minute.</p>\n\n<pre><code>buff := &amp;aws.WriteAtBuffer{}\nparams := &amp;s3.GetObjectInput{\n    Bucket: aws.String(app.BucketName),\n    Key:    aws.String(path),\n}\nresponseChannel := make(chan s3GetImageResult, 1)\ncommandName := \"get_image_s3\"\ndownloader := s3manager.NewDownloaderWithClient(svc)\ncurrentRetryCount := 0\ndefer food_utils_library_go.StartExternalSegment(newrelicTxn, \"http://\"+commandName).End()\nfood_utils_library_go.MakeHttpCall(commandName, config.GetS3HystrixConfig(), func() error {\n    downloadStartTime := time.Now()\n    numBytes, err := downloader.Download(buff, params)\n    if err != nil || numBytes == 0 {\n        logger.Log.Error(\"Unable to download item %q, %v\", path, err)\n        food_utils_library_go.IncrementInStatsD(constants.MetricsKeyS3ImageNotFound)\n    } else {\n        food_utils_library_go.GaugeKeyInStatsD(metricImageOriginalSize, numBytes)\n    }\n    food_utils_library_go.TimingKeyInStatsD(constants.MetricsKeyImageDownloadS3, time.Since(downloadStartTime))\n    result := s3GetImageResult{\n        err: err,\n    }\n    responseChannel &lt;- result\n    return nil\n}, func(e error) error {\n    currentRetryCount = currentRetryCount + 1\n    if currentRetryCount &gt; config.GetS3MaxDownloadRetryCount() {\n        result := s3GetImageResult{\n            err: e,\n        }\n        responseChannel &lt;- result\n    }\n    return e\n})\ns3Response := &lt;-responseChannel\nclose(responseChannel)\nimage.Data = buff.Bytes()\nreturn nil`\n</code></pre>\n"}, {"tags": ["go", "dynamic", "struct"], "answers": [{"comments": [{"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1531127567, "post_id": 51240828, "comment_id": 89462479, "body": "I think there&#39;s also the option of don&#39;t. Always pretty dangerous to just directly transpile code"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1531128666, "post_id": 51240828, "comment_id": 89463233, "body": "@Zak: I don&#39;t understand your comment. Who&#39;s transpiling code?"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1531128861, "post_id": 51240828, "comment_id": 89463382, "body": "Sorry, that wasn&#39;t super clear; I read this part of the question &quot;and migrating from php to golang.&quot; as if it were a copy paste job. I was just suggesting that sometimes the &quot;way things are done&quot; is different in different langauges, and there&#39;s no &quot;golang way to do&quot; a specific PHP pattern. (potentially unhelpful comment ^^). Maybe the root of the problem would suggest a different solution; rather than, how do I do this in go?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 1, "creation_date": 1531129095, "post_id": 51240828, "comment_id": 89463526, "body": "@Zak: I think I understand. There are still times in Go, when you want to update a struct based on a string value, so I don&#39;t think it&#39;s fair to say &quot;never do this&quot;--although perhaps in the OP&#39;s specific situation, there is a useful alternative."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 7, "last_activity_date": 1531124165, "last_edit_date": 1531124165, "creation_date": 1531124026, "answer_id": 51240828, "question_id": 51240758, "link": "https://stackoverflow.com/questions/51240758/how-to-assign-field-name-of-struct-from-variable/51240828#51240828", "title": "How to assign field name of struct from variable", "body": "<p>You have three options, in rough order of preference:</p>\n\n<p>1) An if/switch statement:</p>\n\n<pre><code>var p = &amp;person{}\nif key == \"age\" {\n    p.age = value\n}\n</code></pre>\n\n<p>2) Use a map instead of a struct:</p>\n\n<pre><code>var p = map[string]interface{}\np[key] = value\n</code></pre>\n\n<p>3) Use reflection. See <a href=\"https://stackoverflow.com/q/6395076/13860\">this question</a> for details, but generally you should avoid reflection. It's slow, and non-idiomatic, and it only works with exported fields (your example uses un-exported fields, so as written, is not a candidate for reflection anyway).</p>\n"}], "owner": {"reputation": 510, "user_id": 9149597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f041b176fdf55b7af8b6786c162d8d35?s=128&d=identicon&r=PG&f=1", "display_name": "RKP", "link": "https://stackoverflow.com/users/9149597/rkp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3868, "favorite_count": 0, "accepted_answer_id": 51240828, "answer_count": 1, "score": 3, "last_activity_date": 1538399757, "creation_date": 1531123726, "last_edit_date": 1538399757, "question_id": 51240758, "link": "https://stackoverflow.com/questions/51240758/how-to-assign-field-name-of-struct-from-variable", "title": "How to assign field name of struct from variable", "body": "<p>I am new to golang and migrating from php to golang.</p>\n\n<p>I am trying to do something like below stuff, where I want field name <code>age</code> to get assigned from variable test. Is this possible in golang?</p>\n\n<p>In php, we have provision like $$test, looking something similar in golang as well.</p>\n\n<pre><code> package main\n import \"fmt\"\n // This `person` struct type has `name` and `age` fields.\n type person struct {\n   name string\n   age  int\n }\n\n func main() {\n\n   var test = \"age\"     \n   fmt.Println(person{name: \"Alice\",test: 30})\n\n } \n</code></pre>\n\n<p>This is just sample code replicating my use case. </p>\n"}, {"tags": ["go", "stripe-payments", "hyperledger-fabric", "blockchain"], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 8726226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acb333841b410f89acd227bce28535a7?s=128&d=identicon&r=PG&f=1", "display_name": "Aditi", "link": "https://stackoverflow.com/users/8726226/aditi"}, "edited": false, "score": 0, "creation_date": 1531128314, "post_id": 51241465, "comment_id": 89462994, "body": "Hi Munin , Thank you for your reply . It looks that I am missing out on a few basic things , Can you please tell me from which location did you run the govendor thing and did you make any changes to the go env variables after that. Any document if you followed, will be helpful. Thanks again."}, {"owner": {"reputation": 516, "user_id": 5309279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ecccce6facf73c0879720e73391fc9b?s=128&d=identicon&r=PG&f=1", "display_name": "Vladyslav Munin", "link": "https://stackoverflow.com/users/5309279/vladyslav-munin"}, "reply_to_user": {"reputation": 85, "user_id": 8726226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acb333841b410f89acd227bce28535a7?s=128&d=identicon&r=PG&f=1", "display_name": "Aditi", "link": "https://stackoverflow.com/users/8726226/aditi"}, "edited": false, "score": 0, "creation_date": 1531219027, "post_id": 51241465, "comment_id": 89504016, "body": "I just created folder vendor in project root directory with empty valid json file (vendor.json). Then ran command <code>govendor  add +external</code> from root directory and all went well. If you need you can also update all dependencies with update command. I didn&#39;t setup any additional go env. And build project with tags --nopksc11 because of Windows."}, {"owner": {"reputation": 77, "user_id": 10137046, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-f3lEk8R1ckI/AAAAAAAAAAI/AAAAAAAAACw/KWSwHekQHVE/photo.jpg?sz=128", "display_name": "Tapu Das", "link": "https://stackoverflow.com/users/10137046/tapu-das"}, "edited": false, "score": 0, "creation_date": 1587899843, "post_id": 51241465, "comment_id": 108685217, "body": "You both are life saver to me. Thank you very much for this question and answer.I was stuck in this problem for like two months :D. God bless you both"}], "tags": [], "owner": {"reputation": 516, "user_id": 5309279, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ecccce6facf73c0879720e73391fc9b?s=128&d=identicon&r=PG&f=1", "display_name": "Vladyslav Munin", "link": "https://stackoverflow.com/users/5309279/vladyslav-munin"}, "is_accepted": false, "score": 2, "last_activity_date": 1532346151, "last_edit_date": 1532346151, "creation_date": 1531126191, "answer_id": 51241465, "question_id": 51240379, "link": "https://stackoverflow.com/questions/51240379/adding-external-packages-to-hyperledger-fabric-go-smartcontract/51241465#51241465", "title": "Adding external packages to Hyperledger fabric -go smartcontract", "body": "<p>I had the similar issue.\nGovendor worked for me:</p>\n\n<blockquote>\n  <p>error getting chaincode package bytes: Error obtaining dependencies for github.com/go-ozzo/ozzo-validation/is</p>\n</blockquote>\n\n<pre><code>govendor add github.com/go-ozzo/ozzo-validation/is\ngovendor update +v\ngo build\n</code></pre>\n\n<p>And result was good:</p>\n\n<blockquote>\n  <p>Chaincode is installed on remote peer PEER2</p>\n</blockquote>\n\n<p>UPDATE:</p>\n\n<p>If you have a problem with vendor packages setup, here you go:</p>\n\n<ol>\n<li>create folder vendor in project root directory with empty valid json file (vendor.json)</li>\n<li>run command <code>govendor add +external</code> from root directory</li>\n<li>you can also update all dependencies with update command.</li>\n</ol>\n"}], "owner": {"reputation": 85, "user_id": 8726226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acb333841b410f89acd227bce28535a7?s=128&d=identicon&r=PG&f=1", "display_name": "Aditi", "link": "https://stackoverflow.com/users/8726226/aditi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 704, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1592800991, "creation_date": 1531122248, "question_id": 51240379, "link": "https://stackoverflow.com/questions/51240379/adding-external-packages-to-hyperledger-fabric-go-smartcontract", "title": "Adding external packages to Hyperledger fabric -go smartcontract", "body": "<p>I am trying to add an external package to my go smartcontract (for installation , I ran : go get github.com/stripe/stripe-go)  . I then imported files stripe \"github.com/stripe/stripe-go\" and  charge \"github.com/stripe/stripe-go/charge\" , in my smartcontract (<a href=\"https://github.com/stripe/stripe-go\" rel=\"nofollow noreferrer\">https://github.com/stripe/stripe-go</a>). However, when I try to bring up my chaincode , I am getting the error : </p>\n\n<p>Error: Error getting chaincode code chaincode: Error getting chaincode package bytes: Error obtaining dependencies for github.com/stripe/stripe-go: : failed with error: \"exit status 1\"\ncan't load package: package github.com/stripe/stripe-go: cannot find package \"github.com/stripe/stripe-go\" in any of:\n                /opt/go/src/github.com/stripe/stripe-go (from $GOROOT)\n                /opt/gopath/src/github.com/stripe/stripe-go (from $GOPATH)</p>\n\n<p>I tried adding the package through govendor  (<a href=\"http://hyperledger-fabric.readthedocs.io/en/release-1.0/Style-guides/go-style.html\" rel=\"nofollow noreferrer\">http://hyperledger-fabric.readthedocs.io/en/release-1.0/Style-guides/go-style.html</a>)  , but that also is not working .</p>\n\n<p>Request you all to please hep me on this . Thanks in advance.</p>\n"}, {"tags": ["go", "yaml"], "answers": [{"comments": [{"owner": {"reputation": 1876, "user_id": 4340793, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6c078df4144343cdad824bb4637b807d?s=128&d=identicon&r=PG&f=1", "display_name": "JeyJ", "link": "https://stackoverflow.com/users/4340793/jeyj"}, "edited": false, "score": 0, "creation_date": 1531122470, "post_id": 51240425, "comment_id": 89459622, "body": "go get tries to acess the internet. I dont have access to the internet from the server.."}, {"owner": {"reputation": 1358, "user_id": 5275376, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a8bbb1e2df58ceebc9bbb5596bf823f3?s=128&d=identicon&r=PG&f=1", "display_name": "Shiva Kishore", "link": "https://stackoverflow.com/users/5275376/shiva-kishore"}, "reply_to_user": {"reputation": 1876, "user_id": 4340793, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6c078df4144343cdad824bb4637b807d?s=128&d=identicon&r=PG&f=1", "display_name": "JeyJ", "link": "https://stackoverflow.com/users/4340793/jeyj"}, "edited": false, "score": 1, "creation_date": 1531122726, "post_id": 51240425, "comment_id": 89459757, "body": "first make sure you have <code>GOPATH</code> set. you can check via <code>echo $GOPATH</code>. then extract the contents of yaml-2.2.1.zip to <code>GOPATH&#47;src&#47;gopkg.in&#47;yaml.v2</code>"}], "tags": [], "owner": {"reputation": 1358, "user_id": 5275376, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a8bbb1e2df58ceebc9bbb5596bf823f3?s=128&d=identicon&r=PG&f=1", "display_name": "Shiva Kishore", "link": "https://stackoverflow.com/users/5275376/shiva-kishore"}, "is_accepted": false, "score": 1, "last_activity_date": 1531126355, "last_edit_date": 1531126355, "creation_date": 1531122425, "answer_id": 51240425, "question_id": 51240268, "link": "https://stackoverflow.com/questions/51240268/installing-gopkg-in-yaml-v2-from-local-file-go/51240425#51240425", "title": "Installing gopkg.in/yaml.v2 from local file (Go)", "body": "<p>If you dont want your server to be accessible from the internet, then you can add a new instance which is on public subnet and then create a nat server in that instance and connect your server to that nat instance so that the server can download from the internet, but it wont be accessible from the internet via a public ip.</p>\n\n<p>Install via go get</p>\n\n<pre><code>go get gopkg.in/yaml.v2\n</code></pre>\n\n<p>and make sure you have GOPATH set, if not </p>\n\n<p>make modifications in .bashrc(linux) to add the following line. </p>\n\n<pre><code>export GOPATH=&lt;path&gt;\n</code></pre>\n\n<h1>Update</h1>\n\n<p>If you dont want to try out the above method you can try this.</p>\n\n<p>Extract the contents of <code>yaml-2.2.1.zip</code> to <code>GOPATH/src/gopkg.in/yaml.v2</code>.<br>\nThis should work, but this can be tiring if you have lots of packages. </p>\n"}], "owner": {"reputation": 1876, "user_id": 4340793, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6c078df4144343cdad824bb4637b807d?s=128&d=identicon&r=PG&f=1", "display_name": "JeyJ", "link": "https://stackoverflow.com/users/4340793/jeyj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 692, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1531126355, "creation_date": 1531121805, "last_edit_date": 1531122310, "question_id": 51240268, "link": "https://stackoverflow.com/questions/51240268/installing-gopkg-in-yaml-v2-from-local-file-go", "title": "Installing gopkg.in/yaml.v2 from local file (Go)", "body": "<p>I am trying to build a Go file for a tool that I want to install but I am getting the following error : </p>\n\n<pre><code>pgwatch2.go:26:2: cannot find package \"gopkg.in/yaml.v2\" in any of:\n    /usr/local/go/src/gopkg.in/yaml.v2 (from $GOROOT)\n    /home/postgres/go/src/gopkg.in/yaml.v2 (from $GOPATH)\"gopkg.in/yaml.v2\" in any of:\n</code></pre>\n\n<p>I realized that I need to get the Go module gopkg.in/yaml.v2 but my server lacks internet access. Therefore, I tried 2 solution that did not help me : </p>\n\n<p>1) Yum install golang-gopkg-yaml-devel-v2.noarch</p>\n\n<p>2) I downloaded the source files (yaml-2.2.1.zip) and put them in the server but I do not know how to continue from here. How I install the yaml? I tried to unzip and use go install into my desired directory.\nHere is the error I received. </p>\n\n<pre><code>go install: no install location for directory /PostgreSQL/pgwatch2/pgwatch2-master/pgwatch2/yaml-2.2.1 outside GOPATH\n    For more details see: 'go help gopath'\n</code></pre>\n\n<p>Can somebody give me some advice?</p>\n"}, {"tags": ["macos", "go", "gcc", "linker", "linker-warning"], "comments": [{"owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "edited": false, "score": 1, "creation_date": 1531602878, "post_id": 51239913, "comment_id": 89660165, "body": "What about this solution: <a href=\"https://forums.developer.apple.com/thread/97850\" rel=\"nofollow noreferrer\">apple developer forum</a>? That worked for me."}, {"owner": {"reputation": 965, "user_id": 6709663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ec5f45f8412916ca4e0ddaa08e432b16?s=128&d=identicon&r=PG&f=1", "display_name": "qantik", "link": "https://stackoverflow.com/users/6709663/qantik"}, "reply_to_user": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "edited": false, "score": 2, "creation_date": 1532417615, "post_id": 51239913, "comment_id": 89954487, "body": "This helps for <code>gcc</code> but for <code>go</code> the issue persists. Actually, it gets worse by the day. Now if I run a simple <code>go</code> program dozens of the above warning are thrown."}, {"owner": {"reputation": 554, "user_id": 1834009, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/5IkSw.jpg?s=128&g=1", "display_name": "raisa_", "link": "https://stackoverflow.com/users/1834009/raisa"}, "reply_to_user": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "edited": false, "score": 0, "creation_date": 1540978910, "post_id": 51239913, "comment_id": 93057931, "body": "@DanielSchuette Hi, i&#39;m facing the same issue. And the Apple Developer Link you provided doesn&#39;t exist anymore. Would you please let me know what was the solution ? Thanks"}, {"owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "reply_to_user": {"reputation": 554, "user_id": 1834009, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/5IkSw.jpg?s=128&g=1", "display_name": "raisa_", "link": "https://stackoverflow.com/users/1834009/raisa"}, "edited": false, "score": 0, "creation_date": 1541007709, "post_id": 51239913, "comment_id": 93075359, "body": "@raisa_ The link still works for me <a href=\"https://forums.developer.apple.com/thread/97850\" rel=\"nofollow noreferrer\">https://forums.developer.apple.com/thread/97850</a>. Let me know if that solved your problem. There are several other things you might want to try (e.g. a fresh installation of <code>go</code> and upgrading to MacOS 10.14)."}, {"owner": {"reputation": 554, "user_id": 1834009, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/5IkSw.jpg?s=128&g=1", "display_name": "raisa_", "link": "https://stackoverflow.com/users/1834009/raisa"}, "reply_to_user": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "edited": false, "score": 0, "creation_date": 1541052840, "post_id": 51239913, "comment_id": 93088216, "body": "@DanielSchuette Hi, thanks for replying. The link works but unfortunately the solution doesn&#39;t work on me. When I try to install Xcode, I get the warning &quot;Can&#39;t install the software because it is not currently available form the Software Update Server&quot;. So I&#39;m still having the same ld error. I&#39;m already on Mojave, and have installed the latest Xcode command for terminal (in Beta). Currently I&#39;m having so many terminal issues after upgrade to Mojave, I posted my question here <a href=\"https://stackoverflow.com/questions/53079732/opengl-black-screen-and-gamma-correction-after-update-to-macos-mojave-10-14\" title=\"opengl black screen and gamma correction after update to macos mojave 10 14\">stackoverflow.com/questions/53079732/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 583, "user_id": 1709894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/467697c96edf8bb12fd7ab8d84c14cbf?s=128&d=identicon&r=PG", "display_name": "HeroCC", "link": "https://stackoverflow.com/users/1709894/herocc"}, "edited": false, "score": 2, "creation_date": 1565791478, "post_id": 54951512, "comment_id": 101462386, "body": "LPT: Drop this in your .bashrc <code>export SDKROOT=&quot;$(xcrun --show-sdk-path)&quot;</code>. It will automatically set the correct path."}, {"owner": {"reputation": 126, "user_id": 3597824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c221178d5cfd1379c8a735f174e7b8ef?s=128&d=identicon&r=PG&f=1", "display_name": "Gui Lima", "link": "https://stackoverflow.com/users/3597824/gui-lima"}, "edited": false, "score": 0, "creation_date": 1565902652, "post_id": 54951512, "comment_id": 101500203, "body": "This worked well for me.  As suggested by HeroCC, I added it to my .bashrc. Thanks for the answer!"}], "tags": [], "owner": {"reputation": 536, "user_id": 2203321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e486b95b8ea9c6e5323e548f23173f8e?s=128&d=identicon&r=PG", "display_name": "pauln", "link": "https://stackoverflow.com/users/2203321/pauln"}, "is_accepted": false, "score": 1, "last_activity_date": 1551470419, "creation_date": 1551470419, "answer_id": 54951512, "question_id": 51239913, "link": "https://stackoverflow.com/questions/51239913/linker-stub-file-warning/54951512#54951512", "title": "Linker Stub File Warning", "body": "<p>I had been seeing those warnings spewing from my <code>make</code> process for a few weeks. I recently made a Xcode project to build using <code>make</code> (via an <em>External Build System</em> project) and noticed those warnings weren't present when <code>make</code> was being run from Xcode. The only difference is that Xcode exports a series of build setting environment variables prior to running <code>make</code>.</p>\n\n<p>After some experimentation it turned out to be the <code>SDKROOT</code> variable which, in hindsight, makes perfect sense. I added this variable to my makefile and the warnings disappeared:</p>\n\n<pre><code>export SDKROOT = /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.14.sdk\n</code></pre>\n\n<p>Note: That path can change with different versions of Xcode. It may be wise to reference the current SDK version instead:</p>\n\n<pre><code>export SDKROOT = /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk\n</code></pre>\n\n<p>Of course, assumes you have Xcode installed.</p>\n"}], "owner": {"reputation": 965, "user_id": 6709663, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ec5f45f8412916ca4e0ddaa08e432b16?s=128&d=identicon&r=PG&f=1", "display_name": "qantik", "link": "https://stackoverflow.com/users/6709663/qantik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1081, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1551470419, "creation_date": 1531120352, "question_id": 51239913, "link": "https://stackoverflow.com/questions/51239913/linker-stub-file-warning", "title": "Linker Stub File Warning", "body": "<p>For a few days now whenever <code>gcc</code> or <code>go</code> are invoked the following warning is thrown by the system (macOS High Sierra 10.13.5):</p>\n\n<p><code>ld: warning: text-based stub file /System/Library/Frameworks//Security.framework/Security.tbd and library file /System/Library/Frameworks//Security.framework/Security are out of sync. Falling back to library file for linking</code></p>\n\n<p>I have the feeling that the installation of some <code>go</code> packages via\n<code>go get</code> may have changed some files in the above directory but I have no means to verify this.</p>\n\n<p>Is there a way to properly determine the cause of the message?</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 3191, "user_id": 798042, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4cd3f267885c0ed5ee510e5204762598?s=128&d=identicon&r=PG&f=1", "display_name": "dotslashlu", "link": "https://stackoverflow.com/users/798042/dotslashlu"}, "edited": false, "score": 0, "creation_date": 1531118184, "post_id": 51239363, "comment_id": 89457636, "body": "It&#39;s up to you. If the test data are useless, why not delete them? And doing it after the test with defer is a good idea."}, {"owner": {"reputation": 8269, "user_id": 588734, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/o3CVI.jpg?s=128&g=1", "display_name": "Eamonn McEvoy", "link": "https://stackoverflow.com/users/588734/eamonn-mcevoy"}, "edited": false, "score": 0, "creation_date": 1531123381, "post_id": 51239363, "comment_id": 89460147, "body": "Dockerize your database with a set of test data. When the tests are finished you can just delete the container."}], "answers": [{"comments": [{"owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "edited": false, "score": 0, "creation_date": 1531118360, "post_id": 51239411, "comment_id": 89457722, "body": "what about files? For example I create file, write to this file data and then compress it. What I have to do with file?"}, {"owner": {"reputation": 1170, "user_id": 4732633, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh6.googleusercontent.com/-3EqkwkKBaTo/AAAAAAAAAAI/AAAAAAAAAAA/hhuYb3A-0qo/photo.jpg?sz=128", "display_name": "Rahul Ganguly", "link": "https://stackoverflow.com/users/4732633/rahul-ganguly"}, "reply_to_user": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "edited": false, "score": 0, "creation_date": 1531118945, "post_id": 51239411, "comment_id": 89457993, "body": "I would create an interface to write data to a file. So that I can stub this as well and make sure my overall functionality is working. I will then write a unit test for testing if the file is being written and compressed."}], "tags": [], "owner": {"reputation": 1170, "user_id": 4732633, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh6.googleusercontent.com/-3EqkwkKBaTo/AAAAAAAAAAI/AAAAAAAAAAA/hhuYb3A-0qo/photo.jpg?sz=128", "display_name": "Rahul Ganguly", "link": "https://stackoverflow.com/users/4732633/rahul-ganguly"}, "is_accepted": false, "score": -1, "last_activity_date": 1531118137, "creation_date": 1531118137, "answer_id": 51239411, "question_id": 51239363, "link": "https://stackoverflow.com/questions/51239363/clean-data-after-testing/51239411#51239411", "title": "Clean data after testing", "body": "<p>If you are talking about unit testing your code, then there should be no call to the db. You should be using an interface that you can stub or mock.</p>\n"}, {"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 0, "last_activity_date": 1531123389, "creation_date": 1531123389, "answer_id": 51240682, "question_id": 51239363, "link": "https://stackoverflow.com/questions/51239363/clean-data-after-testing/51240682#51240682", "title": "Clean data after testing", "body": "<p>So that we are all on the same page, there are a number of different forms of testing. Here we will consider unit testing and integration testing.</p>\n\n<p>If you are unit testing, I would expect the use of mocks only, and no interaction with files. So I assume this is for some kind of integration testing.</p>\n\n<p><a href=\"https://speakerdeck.com/mitchellh/advanced-testing-with-go?slide=28\" rel=\"nofollow noreferrer\">This is a link</a> to a bunch of slides, from a talk in testing by mitchellh the founder and CTO of hashicorp</p>\n\n<p>One of the methods described in this talk is returning a <code>func()</code> closure that's responsible for cleaning up afterwards.</p>\n\n<p>You can encapsulate all your setup logic into a function that returns a cleanup closure.</p>\n\n<pre><code>func SetupIntegrationDB(t *testing.T, addr string) (*sql.DB, func()) {\n    // setup the connection, use t.Fatal for all errors.\n\n    cleanup := func() {\n        // here you have access to both t, and *sql.DB\n        // you can do all the clean up required, \n        // and return this anonymous function to be called later\n    }\n\n    return db, cleanup\n}\n\n\n// inside your test\ndb, cleanup := SetupIntegrationDB(t, addr)\ndefer cleanup()\n</code></pre>\n\n<p>This is very similar to what you suggested in your question, but allows for slightly improved encapsulation of the cleanup logic. All your tests just need to execute the cleanup function they are given, and not care about how it's done.</p>\n\n<p>This same pattern can be used for files, returning the file (or an <code>io.Writer</code>), and a function that knows where that file exists and can delete that file later on.</p>\n"}], "owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1165, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1531123389, "creation_date": 1531117808, "last_edit_date": 1531119855, "question_id": 51239363, "link": "https://stackoverflow.com/questions/51239363/clean-data-after-testing", "title": "Clean data after testing", "body": "<p>I write tests and in this tests I work with some saved data files, DB records etc.</p>\n\n<p>Should I remove this data before test ends? </p>\n\n<p>For example, I check <code>user</code> finder</p>\n\n<pre><code>func (ID int) User (*User) {\n  // my finder here\n}\n</code></pre>\n\n<p>before test I have to create <code>User</code> to DB. So, should I do something like</p>\n\n<pre><code>defer db.Clean()\n</code></pre>\n\n<p>???</p>\n\n<p>same with files <code>*os.File</code></p>\n"}, {"tags": ["c++", "c", "go", "search", "tree"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1531118282, "post_id": 51239137, "comment_id": 89457686, "body": "you should use a prefix tree but reverse the strings, then it becomes a simple prefix search. you basically search for <code>moc.elgoog</code> and get all the sub domains and their tags."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1531118517, "post_id": 51239137, "comment_id": 89457809, "body": "re implementations, for C you can use this which I wrote <a href=\"https://github.com/RedisLabs/triemap\" rel=\"nofollow noreferrer\">github.com/RedisLabs/triemap</a> or a similar one from antirez <a href=\"https://github.com/antirez/rax\" rel=\"nofollow noreferrer\">github.com/antirez/rax</a>. Both are used heavily in production and are stable and good, and roughly the same speed. Mine has the advantage of having a collision callback when inserting, that you can use to append more &quot;tags&quot; to the value field."}, {"owner": {"reputation": 21, "user_id": 10051718, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4WYoppbXsrY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7o-aTB9ynbUAHckaHjHfqn1SPFlkw/mo/photo.jpg?sz=128", "display_name": "John Weller", "link": "https://stackoverflow.com/users/10051718/john-weller"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1531151199, "post_id": 51239137, "comment_id": 89477683, "body": "I don&#39;t follow how <code>moc.elgoog.www</code> will match <code>moc.elgoog</code>, this is different than match <code>moc.elgoog</code> with <code>moc.elgoog.www</code>, so this is partially suffix match."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1531155529, "post_id": 51239137, "comment_id": 89479979, "body": "you want the other way, no? in any case you can index both ways and query however you want."}], "owner": {"reputation": 21, "user_id": 10051718, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4WYoppbXsrY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7o-aTB9ynbUAHckaHjHfqn1SPFlkw/mo/photo.jpg?sz=128", "display_name": "John Weller", "link": "https://stackoverflow.com/users/10051718/john-weller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1531116638, "creation_date": 1531116638, "question_id": 51239137, "link": "https://stackoverflow.com/questions/51239137/subdomains-tree-implementation", "title": "Subdomains tree implementation", "body": "<p>I am working on golang implementation of subdomains tags storage (looks like multimap). Not so clear for me what type of tree should I use for implement following logic:</p>\n\n<pre><code>    tree := NewTree()\n    tree.AddTag(\"com\", 1)\n    tree.AddTag(\"google.com\", 2)\n    tree.AddTag(\"google.com\", 3)\n    tree.AddTag(\"www.google.com\", 4)\n\n    var ret []int\n    ret = tree.GetTags(\"msn.com\") // ret = [1]\n    ret = tree.GetTags(\"www.msn.com\") // ret = [1]\n    ret = tree.GetTags(\"google.com\") // ret = [1,2,3]\n    ret = tree.GetTags(\"www.google.com\") // ret = [1,2,3,4]\n    ret = tree.GetTags(\"mail.google.com\") // ret = [1,2,3]\n    ret = tree.GetTags(\"debug.www.google.com\") // ret = [1,2,3,4]\n</code></pre>\n\n<p>This task is different than suffix search, for example \"msn.com\" belongs to \"com\" and \"www.google.com\" belongs to \"google.com\" and \"www.google.com\".</p>\n\n<p>If someone could to point me to c/c++/golang sources I would also appreciate.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "edited": false, "score": 0, "creation_date": 1531114846, "post_id": 51238314, "comment_id": 89456404, "body": "minor typo but printName is not exported yet appears to be called as PrintName further down."}, {"owner": {"reputation": 31, "user_id": 9932695, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-l9Md9kA4S8k/AAAAAAAAAAI/AAAAAAAAAAs/de1rmzcRbpI/photo.jpg?sz=128", "display_name": "Pradyumna Kaushik", "link": "https://stackoverflow.com/users/9932695/pradyumna-kaushik"}, "reply_to_user": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "edited": false, "score": 0, "creation_date": 1531116656, "post_id": 51238314, "comment_id": 89457001, "body": "Oops! My bad. Thanks for pointing it out."}], "answers": [{"tags": [], "owner": {"reputation": 216, "user_id": 5039386, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y1c-Clsbdkw/AAAAAAAAAAI/AAAAAAAAAKA/WFHwWVc3h_I/photo.jpg?sz=128", "display_name": "Hau Ma", "link": "https://stackoverflow.com/users/5039386/hau-ma"}, "is_accepted": false, "score": 0, "last_activity_date": 1531113176, "creation_date": 1531113176, "answer_id": 51238560, "question_id": 51238314, "link": "https://stackoverflow.com/questions/51238314/why-can-i-assign-struct-functions-to-members-of-other-structs/51238560#51238560", "title": "Why can I assign struct functions to members of other structs?", "body": "<p>function in Golang is also a value, it can be passed as parameter or assigned by other function too, method in Golang is also a function, with one different, it has receiver in it's value, so when use assign a method to a function (which have same signature) it's refer to the receiver and executing code in that method to destination function</p>\n"}, {"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 2, "last_activity_date": 1531113338, "creation_date": 1531113338, "answer_id": 51238586, "question_id": 51238314, "link": "https://stackoverflow.com/questions/51238314/why-can-i-assign-struct-functions-to-members-of-other-structs/51238586#51238586", "title": "Why can I assign struct functions to members of other structs?", "body": "<p>A method, in Go, is basically a function with a <code>receiver</code>. That receiver is wraped by the compiler, and beyond that, there is nothing more different from a normal function. That means, at anywhere, the method always gets the receiver which it is bound to, no matter how you call it, assign it to another variable or anythiing else.</p>\n\n<p>In your code, <code>f</code> is <strong>not</strong> a method of type <code>Man</code>. It is merely a field of type <code>func()</code>. You can set to anything that match the signature, and the function will know nothing about <code>Man</code> or its instance. That means, <code>m.f</code> has no knowledge of <code>m</code> and no access to <code>m.name</code> or any other field of <code>m</code>.</p>\n\n<p>And a note, you can call methods like: <code>Person.PrintName(p)</code> where p is of type <code>Person</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 9932695, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-l9Md9kA4S8k/AAAAAAAAAAI/AAAAAAAAAAs/de1rmzcRbpI/photo.jpg?sz=128", "display_name": "Pradyumna Kaushik", "link": "https://stackoverflow.com/users/9932695/pradyumna-kaushik"}, "edited": false, "score": 0, "creation_date": 1531117247, "post_id": 51238715, "comment_id": 89457237, "body": "Thanks for the detailed answer :)"}, {"owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "reply_to_user": {"reputation": 31, "user_id": 9932695, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-l9Md9kA4S8k/AAAAAAAAAAI/AAAAAAAAAAs/de1rmzcRbpI/photo.jpg?sz=128", "display_name": "Pradyumna Kaushik", "link": "https://stackoverflow.com/users/9932695/pradyumna-kaushik"}, "edited": false, "score": 0, "creation_date": 1531117560, "post_id": 51238715, "comment_id": 89457365, "body": "no worries! here are two more docs to help you with tricky aspects of golang from the effective go series: a) <a href=\"https://golang.org/doc/effective_go.html#pointers_vs_values\" rel=\"nofollow noreferrer\">ponter vs value receivers</a> b) <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">struct embedding</a>"}, {"owner": {"reputation": 31, "user_id": 9932695, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-l9Md9kA4S8k/AAAAAAAAAAI/AAAAAAAAAAs/de1rmzcRbpI/photo.jpg?sz=128", "display_name": "Pradyumna Kaushik", "link": "https://stackoverflow.com/users/9932695/pradyumna-kaushik"}, "edited": false, "score": 0, "creation_date": 1531117682, "post_id": 51238715, "comment_id": 89457405, "body": "Thanks for the detailed answer :)  I understand why Man.f can be assigned Person.printName.      When you say &quot;So the moment you assigned the f field on the Man struct to a function that has captured the Person instance with name &quot;John&quot; and reads the name from that, therefore you get effect of the second &quot;John&quot; being printed.&quot;, do you mean that the Man.f basically points to the Method-table of person?"}, {"owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "reply_to_user": {"reputation": 31, "user_id": 9932695, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-l9Md9kA4S8k/AAAAAAAAAAI/AAAAAAAAAAs/de1rmzcRbpI/photo.jpg?sz=128", "display_name": "Pradyumna Kaushik", "link": "https://stackoverflow.com/users/9932695/pradyumna-kaushik"}, "edited": false, "score": 1, "creation_date": 1531118253, "post_id": 51238715, "comment_id": 89457671, "body": "yes, and not of any Person, but of a copy of the p Person which has name as &quot;john&quot; . <a href=\"https://play.golang.com/p/Sagb-edSBP3\" rel=\"nofollow noreferrer\">here is another playground example</a> that demonstrates the pass by value / pass by reference aspect of that first argument that is the struct where the method acts upon."}, {"owner": {"reputation": 31, "user_id": 9932695, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-l9Md9kA4S8k/AAAAAAAAAAI/AAAAAAAAAAs/de1rmzcRbpI/photo.jpg?sz=128", "display_name": "Pradyumna Kaushik", "link": "https://stackoverflow.com/users/9932695/pradyumna-kaushik"}, "edited": false, "score": 0, "creation_date": 1531124811, "post_id": 51238715, "comment_id": 89460874, "body": "Interesting. This can lead to some weird behavior, where functions of nullified struct object pointer can still be accessed as the underlying object is not going to be garbage collected -- <a href=\"https://play.golang.org/p/E7CIulvgYEg\" rel=\"nofollow noreferrer\">see this code sample</a>  I can&#39;t think of a reason that this was an intended feature of the language, rather I guess this is just a side effect."}, {"owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "reply_to_user": {"reputation": 31, "user_id": 9932695, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-l9Md9kA4S8k/AAAAAAAAAAI/AAAAAAAAAAs/de1rmzcRbpI/photo.jpg?sz=128", "display_name": "Pradyumna Kaushik", "link": "https://stackoverflow.com/users/9932695/pradyumna-kaushik"}, "edited": false, "score": 0, "creation_date": 1531154932, "post_id": 51238715, "comment_id": 89479690, "body": "it is very ill advised to try and outsmart the golang garbage collector. You should never equate structs to nil hoping that you trigger a collect. In the case you showed it correctly does not collect it cause it&#39;s smart enough to keep the correct reference count (you have that pointer being used by m.f which is still in scope. The correct approach is to keep the scope of your variables as small as possible and to have short lived goroutines."}], "tags": [], "owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "is_accepted": true, "score": 3, "last_activity_date": 1531115756, "last_edit_date": 1531115756, "creation_date": 1531114172, "answer_id": 51238715, "question_id": 51238314, "link": "https://stackoverflow.com/questions/51238314/why-can-i-assign-struct-functions-to-members-of-other-structs/51238715#51238715", "title": "Why can I assign struct functions to members of other structs?", "body": "<p>This question deals mostly with receivers and may extend a bit to embedding.\nFrom the <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow noreferrer\">relevant section of the spec</a>:</p>\n\n<blockquote>\n  <p>A method is a function with a receiver. A method declaration binds an\n  identifier, the method name, to a method, and associates the method\n  with the receiver's base type.</p>\n  \n  <p>MethodDecl = \"func\" Receiver MethodName Signature [ FunctionBody ] .</p>\n  \n  <p>Receiver   = Parameters .</p>\n  \n  <p>The receiver is specified via an extra parameter section preceding the\n  method name. That parameter section must declare a single non-variadic\n  parameter, the receiver. Its type must be of the form T or *T\n  (possibly using parentheses) where T is a type name. The type denoted\n  by T is called the receiver base type; it must not be a pointer or\n  interface type and it must be defined in the same package as the\n  method. The method is said to be bound to the base type and the method\n  name is visible only within selectors for type T or *T.</p>\n  \n  <p>A non-blank receiver identifier must be unique in the method\n  signature. If the receiver's value is not referenced inside the body\n  of the method, its identifier may be omitted in the declaration. The\n  same applies in general to parameters of functions and methods.</p>\n  \n  <p>For a base type, the non-blank names of methods bound to it must be\n  unique. If the base type is a struct type, the non-blank method and\n  field names must be distinct.</p>\n  \n  <p>Given type Point, the declarations</p>\n\n<pre><code>func (p *Point) Length() float64 {    \n   return math.Sqrt(p.x * p.x + p.y *p.y) \n}\n\nfunc (p *Point) Scale(factor float64) {   \n   p.x *= factor  \n   p.y *= factor\n}\n</code></pre>\n  \n  <p>bind the methods Length and Scale, with receiver type *Point, to the\n  base type Point.</p>\n  \n  <p><b>The type of a method is the type of a function with the receiver as\n  first argument.</b> </p>\n  \n  <p>For instance, the method Scale has type</p>\n  \n  <p>func(p *Point, factor float64)</p>\n  \n  <p>However, a function declared this way is not a method.</p>\n</blockquote>\n\n<p>Man has a field named f that is a function that takes no arguments and returns nothing. \nAs we saw above golang internally treats </p>\n\n<pre><code>func (p Person) printName()\n</code></pre>\n\n<p>as </p>\n\n<pre><code>func printName(p Person)\n</code></pre>\n\n<p>and this can be considered as a function of no arguments when it acts on a Person struct (and it does because p is a Person and p.printName acts on p). Therefore it is allowed to be assigned to Man.f</p>\n\n<p>So the moment you assigned the f field on the Man struct to a function that has captured the Person instance with name \"John\" and reads the name from that, therefore you get effect of the second \"John\" being printed. \nThe Man.name field has never come into play on that one.</p>\n\n<p>I suspect that what you would expect as normal behaviour can be achieved with struct embedding of Person into a Man.</p>\n\n<p><a href=\"https://play.golang.com/p/tW77WCMY6iZ\" rel=\"nofollow noreferrer\">here is a playground link to demonstrate that</a></p>\n"}], "owner": {"reputation": 31, "user_id": 9932695, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-l9Md9kA4S8k/AAAAAAAAAAI/AAAAAAAAAAs/de1rmzcRbpI/photo.jpg?sz=128", "display_name": "Pradyumna Kaushik", "link": "https://stackoverflow.com/users/9932695/pradyumna-kaushik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 1, "accepted_answer_id": 51238715, "answer_count": 3, "score": 2, "last_activity_date": 1531116636, "creation_date": 1531111273, "last_edit_date": 1531116636, "question_id": 51238314, "link": "https://stackoverflow.com/questions/51238314/why-can-i-assign-struct-functions-to-members-of-other-structs", "title": "Why can I assign struct functions to members of other structs?", "body": "<p>I was just messing around and wrote the below piece of code,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Person struct {\n    name string\n}\n\nfunc (p Person) printName() {\n    fmt.Println(p.name)\n}\n\ntype Man struct {\n    name string\n    f func()\n}\n\nfunc main() {\n    p := Person{name: \"John\"}\n    m := Man{name: \"Adam\"}\n    m.f = p.printName\n    p.printName()\n    m.f()\n}\n</code></pre>\n\n<p>The above code results in the following output. This works across packages too.</p>\n\n<pre><code>John\nJohn\n</code></pre>\n\n<p>So, here are my questions.</p>\n\n<ol>\n<li>Why does this work?</li>\n<li>Struct methods require receivers of the same type. How is the function still able to access members of the Person struct?</li>\n<li>What happens when <code>m.f = p.printName</code> is executed in the above example?</li>\n</ol>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 1728, "user_id": 1589165, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/g0kW4.jpg?s=128&g=1", "display_name": "Harshil Sharma", "link": "https://stackoverflow.com/users/1589165/harshil-sharma"}, "edited": false, "score": 0, "creation_date": 1531115231, "post_id": 51238179, "comment_id": 89456517, "body": "Is the field <code>search_values</code> part of an existing struct?"}, {"owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "edited": false, "score": 0, "creation_date": 1531446565, "post_id": 51238179, "comment_id": 89609512, "body": "What is the error that you encounter? What output do you get with your code and what output do you expect instead?"}], "owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 126, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1531109981, "creation_date": 1531109981, "question_id": 51238179, "link": "https://stackoverflow.com/questions/51238179/how-to-bind-the-data-of-mongodb-in-golang", "title": "how to bind the data of mongodb in golang?", "body": "<p>I'm retrieving the data from mongodb record of the logs. Below is the example of the data like data I'm retrieving:</p>\n\n<pre><code>{\n \"_id\": ObjectId(\"5b3d970398e9d099427896c3\"),\n \"role\": \"New Booking is there by abc\",\n \"date\": \"07/04/2018\",\n \"idaddress\": \"213.123.123.213\",\n \"booking\": {\n   \"bedroom\": 4,\n   \"bathroom\": 6,\n   \"customer\": \"abc\",\n   \"email\": \"abc@gmail.com\",\n   \"provider\": \"provider1\",\n   \"address\": \"brazil\",\n   \"appt\": \"123456\",\n   \"phone\": \"987654321\"\n },\n \"adding\":{\n   \"user\": \"abcUser\",\n   \"sell\": \"Seller\"\n }\n}\n</code></pre>\n\n<p>I want to bind this whole data into a one field name called <code>search_values</code>. And when I want to search any data from it then it will search all fields also see the <code>booking</code> and <code>adding</code> object too. Below is my code that I'using for searching:</p>\n\n<pre><code>values := c.Query(\"value\")\nfmt.Println(\"value\", values)\nresult := []bson.M{}\nmongoSession := config.ConnectDb()\ngetCollection := mongoSession.DB(config.Database).C(config.LogCollection)\npipe := getCollection.Pipe([]bson.M{ \n            bson.M{\"$project\": bson.M{\n            \"role\":1,\n            \"date\":1,\n            \"idaddress\":1,\n            \"booking\":1,\n            \"booking_values\":bson.M{\"$objectToArray\":\"$booking\"},\n        } },\n    bson.M{\"$match\": bson.M{\"$or\": []bson.M{\n        bson.M{\"booking_values.v\": bson.RegEx{\"(?i).*\" + values + \".*\", \"i\"}},\n        bson.M{\"role\": bson.RegEx{\"(?i).*\" + values + \".*\", \"i\"}},\n        bson.M{\"date\": bson.RegEx{\"(?i).*\" + values + \".*\", \"i\"}},\n        bson.M{\"idaddress\": bson.RegEx{\"(?i).*\" + values + \".*\", \"i\"}},\n    }}})\nfmt.Println(pipe)\nerr := pipe.All(&amp;result)\nfmt.Println(result)\n</code></pre>\n\n<p>Please help me to solve this problem. Thank you for helping me in advanced.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "edited": false, "score": 0, "creation_date": 1531116813, "post_id": 51238163, "comment_id": 89457057, "body": "I can get the response body in Python: <a href=\"https://repl.it/repls/FeistyMinorAccess\" rel=\"nofollow noreferrer\">repl.it/repls/FeistyMinorAccess</a>  It must be something stupid that I&#39;m missing in this Go code..."}], "answers": [{"comments": [{"owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "edited": false, "score": 0, "creation_date": 1531116980, "post_id": 51239183, "comment_id": 89457127, "body": "Oh my goodness, thanks so much!   I knew it was something dumb ...  So does Python&#39;s requests library automatically include the cookie header? <a href=\"https://repl.it/repls/FeistyMinorAccess\" rel=\"nofollow noreferrer\">repl.it/repls/FeistyMinorAccess</a>"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "reply_to_user": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "edited": false, "score": 0, "creation_date": 1531117084, "post_id": 51239183, "comment_id": 89457177, "body": "I dont know about <code>python</code>, all I know what with <code>go</code> you must be literal."}, {"owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "edited": false, "score": 0, "creation_date": 1531119361, "post_id": 51239183, "comment_id": 89458188, "body": "How did you generate the cookie? Did you just copy and paste from your browser?"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "reply_to_user": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "edited": false, "score": 0, "creation_date": 1531119506, "post_id": 51239183, "comment_id": 89458260, "body": "First time, I&#39;ve used chrome developer console, there is an option <code>copy as cURL command</code>. You can pass any arbitrary string, I&#39;ve used <code>PHPSESSID=XXXXXXXX</code> and it&#39;s worked."}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 2, "last_activity_date": 1531116866, "creation_date": 1531116866, "answer_id": 51239183, "question_id": 51238163, "link": "https://stackoverflow.com/questions/51238163/response-body-returning-an-empty-body/51239183#51239183", "title": "Response.Body returning an &quot;empty&quot; body", "body": "<p>The problem is not in the go program, you need provide additional header in this case it's a <code>Cookie</code> header:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nconst url = \"http://comicbookdb.com/search.php\"\n\nfunc main() {\n    request, err := http.NewRequest(http.MethodGet, url, nil)\n    if err != nil {\n        fmt.Println(err.Error())\n        return\n    }\n    // Here is requeired header\n    request.Header.Add(\"Cookie\", \"PHPSESSID=jmujtqjctuk1bv1g02ni88q9u5'\") \n    q := request.URL.Query()\n    q.Add(\"form_search\", \"Captain America\")\n    q.Add(\"form_searchtype\", \"Character\")\n    request.URL.RawQuery = q.Encode()\n    client := &amp;http.Client{}\n    response, err := client.Do(request)\n    if err != nil {\n        fmt.Println(err.Error())\n        return\n    }\n    fmt.Println(response.Header.Get(\"Date\"))\n    fmt.Println(response.StatusCode)\n    fmt.Println(response.Header.Get(\"Server\"))\n    fmt.Println(response.Body)\n\n    r, err := ioutil.ReadAll(response.Body)\n    if err != nil {\n        fmt.Println(err.Error())\n    }\n    fmt.Println(string(r))\n}\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>Mon, 09 Jul 2018 06:13:35 GMT\n200\nApache\n&amp;{0xc420060040 {0 0} false &lt;nil&gt; 0x5e2200 0x5e2190}\n&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org ...\n..... omitted ....\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3335, "user_id": 3824876, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rFDWl.png?s=128&g=1", "display_name": "vishnu narayanan", "link": "https://stackoverflow.com/users/3824876/vishnu-narayanan"}, "is_accepted": false, "score": 0, "last_activity_date": 1531125655, "creation_date": 1531125655, "answer_id": 51241285, "question_id": 51238163, "link": "https://stackoverflow.com/questions/51238163/response-body-returning-an-empty-body/51241285#51241285", "title": "Response.Body returning an &quot;empty&quot; body", "body": "<p>It is something related to the page. You can get away with setting an additional header. In this case, <code>Connection</code> header.</p>\n\n<pre><code>...\nrequest.Header.Set(\"Connection\", \"keep-alive\")\nclient := http.DefaultClient\nresponse, err := client.Do(request)\n...\n</code></pre>\n"}], "owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "accepted_answer_id": 51239183, "answer_count": 2, "score": 2, "last_activity_date": 1531125655, "creation_date": 1531109873, "question_id": 51238163, "link": "https://stackoverflow.com/questions/51238163/response-body-returning-an-empty-body", "title": "Response.Body returning an &quot;empty&quot; body", "body": "<p>I am getting a response back as well as header responses and everything, but for some reason the body is empty:</p>\n\n<p><a href=\"https://repl.it/repls/HastyAggravatingArchitect\" rel=\"nofollow noreferrer\">https://repl.it/repls/HastyAggravatingArchitect</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"io/ioutil\"\n)\n\n\nconst url = \"http://comicbookdb.com/search.php\"\n\nfunc main() {\n    request, err := http.NewRequest(http.MethodGet, url, nil)\n    if err != nil {\n        fmt.Println(err.Error())\n        return\n    }\n    q := request.URL.Query()\n    q.Add(\"form_search\", \"Captain America\")\n    q.Add(\"form_searchtype\", \"Character\")\n  // http://comicbookdb.com/search.php?form_search=captain%20america&amp;form_searchtype=Character\n    request.URL.RawQuery = q.Encode()\n    client := http.DefaultClient\n    response, err := client.Do(request)\n    fmt.Println(response.Header.Get(\"Date\"))\n    fmt.Println(response.StatusCode)\n    fmt.Println(response.Header.Get(\"Server\"))\n    fmt.Println(response.Body)  \n\n    r, err := ioutil.ReadAll(response.Body)\n    if err != nil {\n        fmt.Println(err.Error())\n    }\n    fmt.Println(string(r))\n}\n</code></pre>\n\n<p>I commented in the full URL so that you can check it out yourself and see that the response body should not be empty.</p>\n"}, {"tags": ["go", "io"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1531109203, "post_id": 51237913, "comment_id": 89455043, "body": "It&#39;s the expected behavior. What are you trying to accomplish? The XY problem is asking about your attempted solution rather than your actual problem: <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">The XY Problem</a>"}, {"owner": {"reputation": 327, "user_id": 6878109, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/0203bee52f4e9266945f07732403a43a?s=128&d=identicon&r=PG&f=1", "display_name": "billyzaelani", "link": "https://stackoverflow.com/users/6878109/billyzaelani"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1531109887, "post_id": 51237913, "comment_id": 89455188, "body": "Scanner scan r and split it using newline, I want used that fact to read specific line from file like this <a href=\"https://stackoverflow.com/questions/30693421/how-to-read-specific-line-of-file\" title=\"how to read specific line of file\">stackoverflow.com/questions/30693421/&hellip;</a>, and then benchmark it with io.ReederAt and io.Seeker."}, {"owner": {"reputation": 327, "user_id": 6878109, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/0203bee52f4e9266945f07732403a43a?s=128&d=identicon&r=PG&f=1", "display_name": "billyzaelani", "link": "https://stackoverflow.com/users/6878109/billyzaelani"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1531110316, "post_id": 51237913, "comment_id": 89455292, "body": "r.Seek(0, 0) do the trick, thanks."}], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 0, "last_activity_date": 1531165572, "creation_date": 1531165572, "answer_id": 51252993, "question_id": 51237913, "link": "https://stackoverflow.com/questions/51237913/bufio-newscannerr-calling-scan-drain-buffer-from-r/51252993#51252993", "title": "bufio.NewScanner(r) calling Scan() drain buffer from r", "body": "<p>Reading a reader is in general a destructive action; particularly with http request bodies.</p>\n\n<p>Instead you can create a tee reader, which is modelled on the unix <code>tee</code> command.</p>\n\n<p><a href=\"https://golang.org/pkg/io/#example_TeeReader\" rel=\"nofollow noreferrer\">Link to the docs</a></p>\n\n<p>Modifying the example you've given:</p>\n\n<pre><code>r := bytes.NewReader([]byte(\"ninebytes\"))\n\nvar buf bytes.Buffer\ntee := io.TeeReader(r, &amp;buf)\n\nsc1 := bufio.NewScanner(tee)\nsc1.Scan()\nfmt.Printf(\"scanner1: %s\\n\", sc1.Text())\n\nsc2 := bufio.NewScanner(&amp;buf)\nsc2.Scan()\nfmt.Printf(\"scanner2: %s\\n\", sc2.Text())\n</code></pre>\n\n<p>Using a tee reader, as you read from <code>r</code> it will write a copy of those bytes to <code>buf</code>, which you can use again in the second scanner.</p>\n"}], "owner": {"reputation": 327, "user_id": 6878109, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/0203bee52f4e9266945f07732403a43a?s=128&d=identicon&r=PG&f=1", "display_name": "billyzaelani", "link": "https://stackoverflow.com/users/6878109/billyzaelani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1531540260, "creation_date": 1531107346, "last_edit_date": 1531540260, "question_id": 51237913, "link": "https://stackoverflow.com/questions/51237913/bufio-newscannerr-calling-scan-drain-buffer-from-r", "title": "bufio.NewScanner(r) calling Scan() drain buffer from r", "body": "<p>I want to create 2 scanners from the same reader <code>r</code>. But when calling <code>Scan()</code> from the first scanner, it drains the buffer from <code>r</code>, so the second scanner is reading a zero buffer. Is that a common behavior? How to fix it so that the second scanner properly reads from the original <code>r</code>?</p>\n\n<pre><code>r := bytes.NewReader([]byte(\"ninebytes\"))\nfmt.Println(r.Len()) // 9\nsc1 := bufio.NewScanner(r)\nsc1.Scan()\nfmt.Printf(\"scanner1: %s\\n\", sc1.Text()) // scanner1: ninebytes\n\n// i want create new scanner from r too\nfmt.Println(r.Len()) // 0\nsc2 := bufio.NewScanner(r)\nsc1.Scan()\nfmt.Printf(\"scanner2: %s\\n\", sc2.Text()) // scanner2: \n</code></pre>\n\n<p>Here's an example at <a href=\"https://play.golang.org/p/v0g7C4qA8Nh\" rel=\"nofollow noreferrer\">play golang</a></p>\n\n<p>This is what I'm trying to do: read a specific line from a file, but when calling the function a second time, <code>r</code> is drained.</p>\n\n<pre><code>func readLineScanner(r io.Reader, lineNum int) ([]byte, error) {\n    sc := bufio.NewScanner(r)\n    lastLine := 0\n    for sc.Scan() {\n        lastLine++\n        if lastLine == lineNum {\n            break\n        }\n    }\n    return sc.Bytes(), sc.Err()\n}\n</code></pre>\n"}, {"tags": ["go", "cassandra", "gocql"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 2, "creation_date": 1531108668, "post_id": 51237867, "comment_id": 89454936, "body": "In general, if you want to handle objects of different types with common code, you need to define an interface. The interface encapsulates the common operations you want to perform on the objects. See <a href=\"https://golang.org/doc/effective_go.html#interfaces_and_types\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#interfaces_and_types</a> for more information."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1531123386, "post_id": 51237867, "comment_id": 89460150, "body": "You cannot do exactly what you want. This seems like an XY Problem. What is the larger goal you&#39;re trying to accomplish? There&#39;s probably a better way."}, {"owner": {"reputation": 377, "user_id": 5953626, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-dDwLTM1rSaQ/AAAAAAAAAAI/AAAAAAAAEkM/XVdkrI4-qxk/photo.jpg?sz=128", "display_name": "Nannan AV", "link": "https://stackoverflow.com/users/5953626/nannan-av"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1531126794, "post_id": 51237867, "comment_id": 89462030, "body": "@AndySchweig Please refer to this comment <a href=\"https://stackoverflow.com/questions/51237867/create-type-inside-if-condition#comment89461872_51238483\" title=\"create type inside if condition%23comment89461872_51238483\">stackoverflow.com/questions/51237867/&hellip;</a>."}, {"owner": {"reputation": 377, "user_id": 5953626, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-dDwLTM1rSaQ/AAAAAAAAAAI/AAAAAAAAEkM/XVdkrI4-qxk/photo.jpg?sz=128", "display_name": "Nannan AV", "link": "https://stackoverflow.com/users/5953626/nannan-av"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1531126852, "post_id": 51237867, "comment_id": 89462068, "body": "@Flimzy Added an edit to the question :)"}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1531122502, "post_id": 51238483, "comment_id": 89459645, "body": "This looks a lot more complex than necessary. Why not just <a href=\"https://gist.github.com/flimzy/d6594065cd57704be286fef384733524\" rel=\"nofollow noreferrer\">this</a>?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1531122828, "post_id": 51238483, "comment_id": 89459825, "body": "@Flimzy This will check the condition multiple times, and lacks extendability. If the condition in <code>if</code> statement is trivial, it is not a bad idea. But in most cases, where the condition might be complex or separate from usage code, it is inefficient or unviable."}, {"owner": {"reputation": 377, "user_id": 5953626, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-dDwLTM1rSaQ/AAAAAAAAAAI/AAAAAAAAEkM/XVdkrI4-qxk/photo.jpg?sz=128", "display_name": "Nannan AV", "link": "https://stackoverflow.com/users/5953626/nannan-av"}, "edited": false, "score": 0, "creation_date": 1531126545, "post_id": 51238483, "comment_id": 89461872, "body": "I tried using myObject := new(proto.Message). (Since proto.Unmarshal needs the second argument to be of type proto.Message and not just an empty interface). I have added this in the question as &quot;Alternate way&quot;."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 377, "user_id": 5953626, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-dDwLTM1rSaQ/AAAAAAAAAAI/AAAAAAAAEkM/XVdkrI4-qxk/photo.jpg?sz=128", "display_name": "Nannan AV", "link": "https://stackoverflow.com/users/5953626/nannan-av"}, "edited": false, "score": 0, "creation_date": 1531127582, "post_id": 51238483, "comment_id": 89462485, "body": "@NannanAV I edited the answer. Can you please tell us what <code>proto</code> is? which package are you using?"}, {"owner": {"reputation": 377, "user_id": 5953626, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-dDwLTM1rSaQ/AAAAAAAAAAI/AAAAAAAAEkM/XVdkrI4-qxk/photo.jpg?sz=128", "display_name": "Nannan AV", "link": "https://stackoverflow.com/users/5953626/nannan-av"}, "edited": false, "score": 0, "creation_date": 1531128263, "post_id": 51238483, "comment_id": 89462958, "body": "@leafbebop Added details about proto in the question. Also, As per your answer, the newC func will be executed in each iteration in the for loop, which is what I want to avoid (since it returns the same thing every time)"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 377, "user_id": 5953626, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-dDwLTM1rSaQ/AAAAAAAAAAI/AAAAAAAAEkM/XVdkrI4-qxk/photo.jpg?sz=128", "display_name": "Nannan AV", "link": "https://stackoverflow.com/users/5953626/nannan-av"}, "edited": false, "score": 0, "creation_date": 1531130553, "post_id": 51238483, "comment_id": 89464434, "body": "@NannanAV You would have to execuate some code every loop, either this function, or <code>new(C)</code>. It is unavoidable since using the same variable will not make things better. Edited my answer according to the updated info."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1531130598, "post_id": 51238483, "comment_id": 89464454, "body": "Also, a single function call is very cheap in Go."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 2, "last_activity_date": 1531130541, "last_edit_date": 1531130541, "creation_date": 1531112681, "answer_id": 51238483, "question_id": 51237867, "link": "https://stackoverflow.com/questions/51237867/create-type-inside-if-condition/51238483#51238483", "title": "Create type inside if condition", "body": "<p>In Go's type system, what you want to achieve can not be done directly.</p>\n\n<p>However, with help of <code>interface{}</code> and first-class function value, we can get it done, and rather gracefully.</p>\n\n<p>To do this, instead of declaring a new <code>type C</code>, we declare a new constructer :</p>\n\n<pre><code>var newC func() interface{}\nif true {\n    newC = func() interface{} {\n        c := new(A)\n        return c\n    }\n} else {\n    newC = func() interface{} {\n        c := new(B)\n        return c\n    }\n}\n</code></pre>\n\n<p>And then, in the loop, change <code>myObject := new(C)</code> to <code>myObject := newC()</code>. It is done.</p>\n\n<p>Example: <a href=\"https://play.golang.org/p/dBKBYrLqi_P\" rel=\"nofollow noreferrer\">https://play.golang.org/p/dBKBYrLqi_P</a></p>\n\n<p>Edit:</p>\n\n<p>As you need the param being a <code>proto.Message</code>, which I guess is an <code>interface</code>, you can cast it into <code>proto.Message</code>.</p>\n\n<p>So basically you can re-write you code into:</p>\n\n<pre><code>type A struct {//some code}\ntype B struct {//some code}\n\nfunc getData(db string) interface{} {\nvar newC func() interface{}\nif true {\n    newC = func() proto.Message {\n        c := new(A)\n        return c\n    }\n} else {\n    newC = func() proto.Message {\n        c := new(B)\n        return c\n    }\n}\nvar byteData []byte\n    query := //cassandra query object\n    iter := query.Iter()\n    for iter.Scan(&amp;byteData) {\n        myObject := newC()\n        err := proto.Unmarshal(byteData, myObject)\n        objects = append(objects, myObject)\n    }\n    return objects\n}\n</code></pre>\n"}], "owner": {"reputation": 377, "user_id": 5953626, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-dDwLTM1rSaQ/AAAAAAAAAAI/AAAAAAAAEkM/XVdkrI4-qxk/photo.jpg?sz=128", "display_name": "Nannan AV", "link": "https://stackoverflow.com/users/5953626/nannan-av"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1531130541, "creation_date": 1531106697, "last_edit_date": 1531127982, "question_id": 51237867, "link": "https://stackoverflow.com/questions/51237867/create-type-inside-if-condition", "title": "Create type inside if condition", "body": "<p>Requirement:</p>\n\n<pre><code>type A struct {//some code}\ntype B struct {//some code}\n\nfunc getData(db string) interface{} {\n    if db == \"dbA\" {     // problem with this if condition\n        type C A\n    } else {\n        type C B\n    }\n    var byteData []byte\n    query := //cassandra query object\n    iter := query.Iter()\n    for iter.Scan(&amp;byteData) {\n        myObject := new(C)\n        err := proto.Unmarshal(byteData, myObject)\n        objects = append(objects, myObject)\n    }\n    return objects\n}\n</code></pre>\n\n<p>Basically, I don't want to write the if condition inside the loop. But myObject is declared outside the scope of C. </p>\n\n<p>Alternate way:\nI have tried having the type of myObject as proto.Message, but that gives me error \"invalid memory address or nil pointer dereference\"</p>\n\n<pre><code>myObject := new(proto.Message)\nerr := proto.Unmarshal(byteData, myObject)\nobjects = append(objects, myObject)\n</code></pre>\n\n<p>Another alternate:\nI am also not sure if using the same variable will work (and hence i am trying to create a new variable each time inside the loop)</p>\n\n<p>PS: This does not require much Cassandra knowledge</p>\n\n<p>Help appreciated. Thanks !</p>\n\n<p>Edit 1:\nWhat I'm trying to accomplish is fetch a few rows from the database. But since I have multiple tables which contain very much similar data, I want to do it in one function in a very much optimised manner. And the values I want to fetch are stored in bytes, which I am using proto to convert into Golang objects.</p>\n\n<p>Edit 2:\nproto.Unmarshal needs the second argument to be of type proto.Message. Hence I cant use an empty interface. (Both types A and B implement proto.Message)</p>\n\n<p>Edit 3:\nYou can find proto at \"github.com/golang/protobuf\". I use it to convert objects into bytes and also back into objects.!</p>\n"}, {"tags": ["linux", "go", "zfs"], "comments": [{"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1531103356, "post_id": 51237512, "comment_id": 89454035, "body": "&gt; Is this as simple as reading and parsing the contents of the virtual file I am interested in? As far as I know: yes.  But you might try looking at <a href=\"https://github.com/c9s/goprocinfo\" rel=\"nofollow noreferrer\">github.com/c9s/goprocinfo</a> to see what they do there, or if you can use that package instead."}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "reply_to_user": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1531160687, "post_id": 51237512, "comment_id": 89482567, "body": "@jrefior You should transform your comment in a full answer."}], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 0, "last_activity_date": 1531186079, "creation_date": 1531186079, "answer_id": 51256078, "question_id": 51237512, "link": "https://stackoverflow.com/questions/51237512/retrieve-information-from-linux-kernel-virtual-filesystem/51256078#51256078", "title": "Retrieve information from Linux kernel virtual filesystem", "body": "<blockquote>\n  <p>Is this as simple as reading and parsing the contents of the virtual file I am interested in?</p>\n</blockquote>\n\n<p>As far as I know: yes.</p>\n\n<p>But you might try looking at <a href=\"https://github.com/c9s/goprocinfo\" rel=\"nofollow noreferrer\">github.com/c9s/goprocinfo</a> to see what they do there, or if you can use that package instead.</p>\n\n<p>See also <a href=\"https://stackoverflow.com/a/20033735/1964690\">this SO question and answer</a>.</p>\n"}], "owner": {"reputation": 343, "user_id": 869930, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/67029d22fb69291ac7338b9efc4b032c?s=128&d=identicon&r=PG", "display_name": "Joenarr Bronarsson", "link": "https://stackoverflow.com/users/869930/joenarr-bronarsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1531186079, "creation_date": 1531102690, "last_edit_date": 1531120832, "question_id": 51237512, "link": "https://stackoverflow.com/questions/51237512/retrieve-information-from-linux-kernel-virtual-filesystem", "title": "Retrieve information from Linux kernel virtual filesystem", "body": "<p>I am wanting to write a utility that does some reporting based on data available in the /proc directory.</p>\n\n<p>Is this as simple as reading and parsing the contents of the virtual file I am interested in?  I have seen this approach implemented in Python when doing similar things.</p>\n\n<p>Is there a superior way to do this in Go?</p>\n\n<p>For backstory, I am using ZFS on Linux and want to retrieve data from this virtual file: /proc/spl/kstat/zfs/arcstats</p>\n\n<p>This is a Python program that operates directly on that file.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 731, "user_id": 1137142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78afc3d3f69e007c5d548a75f865a497?s=128&d=identicon&r=PG", "display_name": "matb", "link": "https://stackoverflow.com/users/1137142/matb"}, "edited": false, "score": 2, "creation_date": 1531077575, "post_id": 51235131, "comment_id": 89449456, "body": "This particular goroutine is stuck waiting for available HTTP2 stream to send a request over. When a Go program crashes and dumps the state of all goroutines - it&#39;s probably a very long list in your case. After 30h you might have hundred of thousand of goroutines opened and you might be running out of file descriptors for all the connections that you have opened. Might be useful to use something like <a href=\"https://github.com/google/pprof\" rel=\"nofollow noreferrer\">github.com/google/pprof</a> to investigate a bit more."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1531095960, "post_id": 51235131, "comment_id": 89452913, "body": "@ohe, are you certain that\u2019s all that is printed out? Its not showing the panic or fatal error, and there\u2019s no situation where go runtime just prints out a random waiting goroutine stack."}], "answers": [{"comments": [{"owner": {"reputation": 78, "user_id": 10567252, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sZyTZ.jpg?s=128&g=1", "display_name": "Praveen Raj", "link": "https://stackoverflow.com/users/10567252/praveen-raj"}, "edited": false, "score": 0, "creation_date": 1559889233, "post_id": 51235234, "comment_id": 99567180, "body": "can you suggest a solution?"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "reply_to_user": {"reputation": 78, "user_id": 10567252, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sZyTZ.jpg?s=128&g=1", "display_name": "Praveen Raj", "link": "https://stackoverflow.com/users/10567252/praveen-raj"}, "edited": false, "score": 0, "creation_date": 1559913555, "post_id": 51235234, "comment_id": 99579098, "body": "@PraveenRaj: I might use a buffered channel to process requests one at a time. Once it reaches the buffer limit it cannot push more into the channel. Or I might use an unbuffered channel and create <code>N</code> goroutines reading it, where <code>N</code> is however many I want to run at the same time."}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 1, "last_activity_date": 1531077098, "creation_date": 1531077098, "answer_id": 51235234, "question_id": 51235131, "link": "https://stackoverflow.com/questions/51235131/go-program-systematically-crashing-on-semacquire-issue-after-hours-of-execution/51235234#51235234", "title": "go program systematically crashing on semacquire issue after hours of execution", "body": "<p>It does not seem to have an actual error displayed in there. Just a stack trace. I'm not sure why.</p>\n\n<p>What I do see is that you appear to just launch goroutines without any limit. What does your program do if it cannot forward and complete <code>sendTo</code> requests faster than they arrive?</p>\n\n<p>I think that at some point Go will run out of memory for goroutine stacks, or something else will overflow. I'd expect some sort of \"out of memory\" error, but I don't see one there. </p>\n\n<p>Nevertheless, that is my best guess: some sort of resource exhaustion caused by creating more goroutines than are finishing.</p>\n"}], "owner": {"reputation": 3019, "user_id": 335247, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7187b773d9a794b827d74b9e65d25b73?s=128&d=identicon&r=PG", "display_name": "ohe", "link": "https://stackoverflow.com/users/335247/ohe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 587, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1531077098, "creation_date": 1531076116, "question_id": 51235131, "link": "https://stackoverflow.com/questions/51235131/go-program-systematically-crashing-on-semacquire-issue-after-hours-of-execution", "title": "go program systematically crashing on semacquire issue after hours of execution", "body": "<p>Here is an extract of my code:</p>\n\n<pre><code>func sendTo(url string, someDataPoints [] DataPoint) {\n  ro := &amp;grequests.RequestOptions{JSON: someDataPoints, InsecureSkipVerify: false}\n  grequests.Post(url, ro)\n  return\n}\n\nfunc forward(someDataPoints []DataPoint) int {\n    endpoint := \"https://example.org\"\n    go sendTo(endpoint, someDataPoints)\n}\n</code></pre>\n\n<p>The function forward is called something like 100 times per second. The program works for thirty hour or so and ends up failing with the following error:</p>\n\n<pre><code>goroutine 265125012 [semacquire, 41 minutes]:\nsync.runtime_notifyListWait(0xc4204be2d0, 0x1bb56b6)\n    /usr/local/go/src/runtime/sema.go:510 +0x10b\nsync.(*Cond).Wait(0xc4204be2c0)\n    /usr/local/go/src/sync/cond.go:56 +0x80\nnet/http.(*http2ClientConn).awaitOpenSlotForRequest(0xc420d5e000, 0xc42c167000, 0x0, 0x0)\n    /usr/local/go/src/net/http/h2_bundle.go:7528 +0x11d\nnet/http.(*http2ClientConn).roundTrip(0xc420d5e000, 0xc42c167000, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/http/h2_bundle.go:7336 +0x110\nnet/http.(*http2Transport).RoundTripOpt(0xc4200100f0, 0xc42c167000, 0xffffffffffffff00, 0x0, 0x40bac0, 0x705e50)\n    /usr/local/go/src/net/http/h2_bundle.go:6929 +0x150\nnet/http.(*http2Transport).RoundTrip(0xc4200100f0, 0xc42c167000, 0xc42c1a04c0, 0x0, 0xc42c1a0438)\n    /usr/local/go/src/net/http/h2_bundle.go:6891 +0x3a\nnet/http.http2noDialH2RoundTripper.RoundTrip(0xc4200100f0, 0xc42c167000, 0x7fff668abf02, 0x5, 0xc42016a088)\n    /usr/local/go/src/net/http/h2_bundle.go:991 +0x39\nnet/http.(*Transport).RoundTrip(0x8aa800, 0xc42c167000, 0x8aa800, 0x0, 0x0)\n    /usr/local/go/src/net/http/transport.go:380 +0xc36\nnet/http.send(0xc42c167000, 0x745660, 0x8aa800, 0x0, 0x0, 0x0, 0xc44002b628, 0xb000000000411729, 0xc420d52b50, 0x1)\n    /usr/local/go/src/net/http/client.go:252 +0x185\nnet/http.(*Client).send(0x8afa20, 0xc42c167000, 0x0, 0x0, 0x0, 0xc44002b628, 0x0, 0x1, 0x698620)\n    /usr/local/go/src/net/http/client.go:176 +0xfa\nnet/http.(*Client).Do(0x8afa20, 0xc42c167000, 0x7fff668abf02, 0x3a, 0xc42bcc5b80)\n    /usr/local/go/src/net/http/client.go:615 +0x28d\ngithub.com/levigross/grequests.buildRequest(0x705a0f, 0x4, 0x7fff668abf02, 0x3a, 0xc42bcc5b80, 0x8afa20, 0x8, 0x18, 0xc431e455a0)\n    /go/src/github.com/levigross/grequests/request.go:194 +0x189\ngithub.com/levigross/grequests.doRegularRequest(0x705a0f, 0x4, 0x7fff668abf02, 0x3a, 0xc42bcc5b80, 0x690380, 0x1, 0xc431e455a0)\n    /go/src/github.com/levigross/grequests/request.go:136 +0x6f\ngithub.com/levigross/grequests.Post(0x7fff668abf02, 0x3a, 0xc42bcc5b80, 0xc431e455a0, 0x4, 0xc42c1703c0)\n    /go/src/github.com/levigross/grequests/base.go:41 +0x54\nmain.sendTo(0x7fff668abf02, 0x3a, 0xc42bcd33b0, 0x1, 0x1, 0x0, 0x0)\n    /go/src/github.com/SomeCompany/SomeProduct/cmd/SomeCli/main.go:66 +0xdd\ncreated by main.forward\n    /go/src/github.com/SomeCompany/SomeProduct/cmd/SomeCli/main.go:80 +0xc8\n</code></pre>\n\n<p>What could explain this issue?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1531075172, "post_id": 51234951, "comment_id": 89448902, "body": "I don&#39;t see how this would lock anything."}, {"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1531075440, "post_id": 51234951, "comment_id": 89448956, "body": "are you referring to the buffer count (4100) being larger than the no. of goroutines spawned (4000)?"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 1, "creation_date": 1531075821, "post_id": 51234951, "comment_id": 89449035, "body": "variable reap doesn&#39;t guarded anyhow for concurrent usage. Code looks unsafe. Simultaneous use of *reap by two or more goroutines can lead to unpredictable state."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1531097797, "post_id": 51234951, "comment_id": 89453160, "body": "@struggling_learner: &quot;Is this the right way?&quot; No. When you have a data race your results are undefined."}], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 1, "last_activity_date": 1531075411, "creation_date": 1531075411, "answer_id": 51235039, "question_id": 51234951, "link": "https://stackoverflow.com/questions/51234951/simple-locking-with-buffered-channels-spinning/51235039#51235039", "title": "Simple locking with buffered channels spinning", "body": "<p>There's no conditional logic present in your code whether to change <code>*reap</code> based on the status of <code>lock</code>, or whether to wait for the status of <code>lock</code> to change before proceeding with the update to <code>*reap</code>.  Therefore you're getting multiple goroutines increasing <code>*reap</code> with no synchronization between them.</p>\n\n<p>Compare your implementation to the documented behavior of <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"nofollow noreferrer\"><code>sync.Mutex</code></a>, especially the block and wait behavior:</p>\n\n<blockquote>\n  <p>Lock locks m. If the lock is already in use, the calling goroutine\n  blocks until the mutex is available.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "edited": false, "score": 0, "creation_date": 1531079151, "post_id": 51235157, "comment_id": 89449838, "body": "thanks @peterSO, could you please advise on <b>update : 1</b>  made to the question"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "edited": false, "score": 0, "creation_date": 1531085032, "post_id": 51235157, "comment_id": 89451127, "body": "@struggling_learner:  update-1  has a data race. See my revised answer."}, {"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "edited": false, "score": 0, "creation_date": 1531110669, "post_id": 51235157, "comment_id": 89455370, "body": "yep, i noticed that too. How would you refactor that update-1 code to avoid the race condition?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1531084958, "last_edit_date": 1531084958, "creation_date": 1531076336, "answer_id": 51235157, "question_id": 51234951, "link": "https://stackoverflow.com/questions/51234951/simple-locking-with-buffered-channels-spinning/51235157#51235157", "title": "Simple locking with buffered channels spinning", "body": "<p>Your code has data races (see <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">Go Data Race Detector</a>). Therefore, your results are undefined.</p>\n\n<pre><code>$ go run -race racer.go &gt; /dev/null\n==================\nWARNING: DATA RACE\nRead at 0x00c000086010 by goroutine 7:\n  main.worker()\n      /home/peter/gopath/src/so/racer.go:29 +0x1c9\n\nPrevious write at 0x00c000086010 by goroutine 661:\n  main.worker()\n      /home/peter/gopath/src/so/racer.go:29 +0x1e2\n\nGoroutine 7 (running) created at:\n  main.main()\n      /home/peter/gopath/src/so/racer.go:13 +0xb0\n\nGoroutine 661 (finished) created at:\n  main.main()\n      /home/peter/gopath/src/so/racer.go:13 +0xb0\n==================\n==================\nWARNING: DATA RACE\nRead at 0x00c000086010 by goroutine 688:\n  main.worker()\n      /home/peter/gopath/src/so/racer.go:29 +0x1c9\n\nPrevious write at 0x00c000086010 by goroutine 661:\n  main.worker()\n      /home/peter/gopath/src/so/racer.go:29 +0x1e2\n\nGoroutine 688 (running) created at:\n  main.main()\n      /home/peter/gopath/src/so/racer.go:13 +0xb0\n\nGoroutine 661 (finished) created at:\n  main.main()\n      /home/peter/gopath/src/so/racer.go:13 +0xb0\n==================\nFound 2 data race(s)\nexit status 66\n$ \n</code></pre>\n\n<hr>\n\n<p>Your code for update-1 has data races. Therefore, your results are undefined.</p>\n\n<pre><code>$ go run -race racer.go &gt;/dev/null\n==================\nWARNING: DATA RACE\nRead at 0x00c000088010 by main goroutine:\n  main.main()\n      /home/peter/src/so/racer.go:20 +0x136\n\nPrevious write at 0x00c000088010 by goroutine 397:\n  main.worker()\n      /home/peter/src/so/racer.go:34 +0x1f2\n\nGoroutine 397 (finished) created at:\n  main.main()\n      /home/peter/src/so/racer.go:16 +0xb0\n==================\nFound 1 data race(s)\nexit status 66\n$ \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "is_accepted": true, "score": 2, "last_activity_date": 1531188462, "last_edit_date": 1531188462, "creation_date": 1531168526, "answer_id": 51253628, "question_id": 51234951, "link": "https://stackoverflow.com/questions/51234951/simple-locking-with-buffered-channels-spinning/51253628#51253628", "title": "Simple locking with buffered channels spinning", "body": "<p>thanks for the tutelage, I learned that merely reading a variable that's being written elsewhere into, can make <code>--race</code> complain of <code>WARNING: DATA RACE</code>.  So here, I wrapped my call in a function call which uses mutex to read, and it clears the <code>--race</code> test.  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nvar mutex sync.Mutex\n\nfunc main() {\n    sow := 0\n    reap := 0\n\n    lock := make(chan bool, 40)\n    for i := 0; i &lt; 38; i++ {\n        go worker(i, lock, &amp;reap)\n        sow += 1\n    }\n    time.Sleep(100 * time.Millisecond)\n\n    //for  get_counter(&amp;reap) != get_counter(&amp;sow) {\n    for get_counter(&amp;reap, &amp;sow) {\n        fmt.Println(\"*yawn*\")\n        time.Sleep(100 * time.Millisecond)\n    }\n}\n\nfunc worker(i int, lock chan bool, reap *int) {\n    fmt.Printf(\"%d wants the lock\\n\", i)\n    lock &lt;- true\n    fmt.Printf(\"%d has the lock\\n\", i)\n    time.Sleep(500 * time.Millisecond)\n    fmt.Printf(\"%d is releasing the lock\\n\", i)\n    mutex.Lock()\n    defer mutex.Unlock()\n    *reap += 1\n    &lt;-lock\n}\n\nfunc get_counter(reap *int, sow *int) bool {\n    mutex.Lock()\n    defer mutex.Unlock()\n    return *reap == *sow\n}\n</code></pre>\n"}], "owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 1, "accepted_answer_id": 51253628, "answer_count": 3, "score": 2, "last_activity_date": 1531188462, "creation_date": 1531074771, "last_edit_date": 1531164162, "question_id": 51234951, "link": "https://stackoverflow.com/questions/51234951/simple-locking-with-buffered-channels-spinning", "title": "Simple locking with buffered channels spinning", "body": "<p>The following is loosely based on Go in Practice (page 81):</p>\n\n<pre><code>$ cat simple_locking_with_buffered_channels.go \npackage main\n\nimport(\n    \"fmt\"\n    \"time\"\n)\n\nfunc main(){\n    reap := 0; sow := 0\n    lock := make(chan bool,4100)\n    for i:=0; i&lt;4001; i++{\n        go worker(i, lock, &amp;reap)\n        sow += 1\n    }\n    for reap != sow {\n        fmt.Println(\"*yawn*\")\n        time.Sleep(100 * time.Millisecond)\n    }\n    close(lock)\n}\n\n\nfunc worker(i int, lock chan bool, reap *int){\n    fmt.Printf(\"%d wants the lock\\n\", i)\n    lock &lt;-true // we acquire the lock thusly.\n    fmt.Printf(\"%d has the lock\\n\", i)\n    time.Sleep(500 * time.Millisecond) \n    fmt.Printf(\"%d is releasing the lock\\n\", i)\n    *reap += 1\n    &lt;-lock // release\n}\n</code></pre>\n\n<p>When I run it, most of the time it finishes, but occasionally I see that it spins on yawn - perpetually so, until it is killed. Yes, I can add a timeout logic, but I want to know why is this happening.</p>\n\n<pre><code>$ ps -p `pgrep  simple_locking` -o lstart,etime\n                 STARTED     ELAPSED\nSun Jul  8 11:34:59 2018       02:41\n$ ps -p `pgrep  simple_locking` -o lstart,etime\n                 STARTED     ELAPSED\nSun Jul  8 11:34:59 2018       03:24\n</code></pre>\n\n<p>It is supposed to work, then why is the odd behavior happening. in those cases, why is my reap != sow ? </p>\n\n<pre><code>~/golearn $ go version\ngo version go1.10.3 linux/amd64\n</code></pre>\n\n<p>I am running this on an busy old-ish linux laptop, I am baffled why does it spin intermittently? Thanks in advance! </p>\n\n<p><a href=\"https://play.golang.org/p/BJwAmRf1OXB\" rel=\"nofollow noreferrer\">https://play.golang.org/p/BJwAmRf1OXB</a></p>\n\n<p><strong>update : 1</strong> </p>\n\n<p>I changed the code to use mutex (or so I think..) as: </p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"time\"\n    \"sync\"\n)\n\nvar mutex sync.Mutex\n\nfunc main(){\n    reap := 0; sow := 0\n    lock := make(chan bool,400)\n    for i:=0; i&lt;389; i++{\n        go worker(i, lock, &amp;reap)\n        sow += 1\n    }\n    time.Sleep(100 * time.Millisecond)\n    for reap != sow {\n        fmt.Println(\"*yawn*\")\n        time.Sleep(100 * time.Millisecond)\n    }\n    close(lock)\n}\n\n\nfunc worker(i int, lock chan bool, reap *int){\n    fmt.Printf(\"%d wants the lock\\n\", i)\n    lock &lt;-true // we acquire the lock thusly.\n    fmt.Printf(\"%d has the lock\\n\", i)\n    time.Sleep(500 * time.Millisecond) \n    fmt.Printf(\"%d is releasing the lock\\n\", i)\n    mutex.Lock()\n    *reap += 1\n    mutex.Unlock()\n    &lt;-lock // release\n}\n</code></pre>\n\n<p>Is this the right way, since <code>go run --race</code> still says <code>WARNING: DATA RACE</code> ?</p>\n\n<p><strong>*update 3: *</strong></p>\n\n<p>After trying go's atomic counters, which require delays between increments, I ended up using mutex. What I learned was : even reading (as opposed to writing) can make it complain of race conditions. So here, I wrapped my call in a function call which uses mutex to read, and it clears the --race tests: </p>\n\n<pre><code>$ cat improv.go\npackage main\n\nimport(\n        \"fmt\"\n        \"time\"\n        \"sync\"\n)\n\nvar mutex sync.Mutex\n\nfunc main(){\n        sow := 0\n        reap := 0\n\n        lock := make(chan bool,40)\n        for i:=0; i&lt;38; i++{\n                go worker(i, lock, &amp;reap)\n                sow += 1\n        }\n        time.Sleep(100 * time.Millisecond)\n\n\n        //for  get_counter(&amp;reap) != get_counter(&amp;sow) {\n        for  get_counter(&amp;reap) != sow {\n                fmt.Println(\"*yawn*\")\n                time.Sleep(100 * time.Millisecond)\n        }\n}\n\nfunc worker(i int, lock chan bool, reap *int){\n        fmt.Printf(\"%d wants the lock\\n\", i)\n        lock &lt;-true // we acquire the lock thusly.\n        fmt.Printf(\"%d has the lock\\n\", i)\n        time.Sleep(500 * time.Millisecond)\n        fmt.Printf(\"%d is releasing the lock\\n\", i)\n        mutex.Lock()\n        defer mutex.Unlock()\n        *reap += 1\n        &lt;-lock // release\n}\n\nfunc get_counter(counter *int) int {\n        mutex.Lock()\n        defer mutex.Unlock()\n        return *counter\n}\n\n $ go run --race improv.go &gt;/dev/null\n</code></pre>\n"}, {"tags": ["go", "tcp", "connection", "stateful"], "comments": [{"owner": {"reputation": 1132, "user_id": 1754827, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/GGorI.png?s=128&g=1", "display_name": "Aurelia", "link": "https://stackoverflow.com/users/1754827/aurelia"}, "edited": false, "score": 0, "creation_date": 1531073581, "post_id": 51234703, "comment_id": 89448521, "body": "Goroutines are not threads, they don&#39;t require context switching on the CPU and they&#39;re aware of IO blocking. I&#39;ve had servers with more than 24k goroutines perform fine on commodity hardware."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1531085581, "post_id": 51234703, "comment_id": 89451228, "body": "That is the idiomatic pattern in Go, it&#39;s fine"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1531099475, "post_id": 51234703, "comment_id": 89453416, "body": "You&#39;re meant to use goroutines for this sort of purpose."}, {"owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "edited": false, "score": 0, "creation_date": 1531446951, "post_id": 51234703, "comment_id": 89609572, "body": "And if you want to have control over the number of goroutines running, you can use a buffered channel that blocks as soon as a certain number of workers are &quot;spawned&quot;."}], "owner": {"reputation": 103, "user_id": 9215075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WbQUu.jpg?s=128&g=1", "display_name": "Onelio", "link": "https://stackoverflow.com/users/9215075/onelio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 250, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1531087107, "creation_date": 1531072780, "last_edit_date": 1531087107, "question_id": 51234703, "link": "https://stackoverflow.com/questions/51234703/correct-way-implementing-tcp-stateful-server-in-golang", "title": "Correct way implementing tcp stateful server in Golang", "body": "<p>I believe this has been asked before but never found anything related to stateful connections, So here it goes. </p>\n\n<p>I'm writting a server in golang where users connect and login to ask for specific date later on. My problem here is that doing my research I came up with a method of archiving this over a tcp connection (lets remember it's stateful) creating a goroutine every connection and keeping it listening to the user income like this example: <a href=\"https://github.com/firstrow/tcp_server/blob/master/tcp_server.go\" rel=\"nofollow noreferrer\">https://github.com/firstrow/tcp_server/blob/master/tcp_server.go</a>\nMy doubts with this method are related with the idea of keeping a goroutine openned for every connected user.</p>\n\n<p>I would like to know if this is the correct approach or if there is another method to archieve that like keeping a less amount of routines listning for new incomes.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1531074630, "post_id": 51234697, "comment_id": 89448781, "body": "Thank you for your answer Zan.  I will try this out and see how it works."}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 0, "last_activity_date": 1531072712, "creation_date": 1531072712, "answer_id": 51234697, "question_id": 51234650, "link": "https://stackoverflow.com/questions/51234650/managing-circular-dependencies-in-golang/51234697#51234697", "title": "Managing circular dependencies in golang", "body": "<p>One thing that I did once, although I consider it kind of hackish, is to use an interface or function pointer. In your case, it would be in your model.</p>\n\n<p>Then in code higher up in the application, which can use the model and the DAO without circular reference, have that code set the interface or function pointer.</p>\n\n<p>The model can call that method without needing its code.</p>\n\n<p>I suppose it is a form of dependency injection. I wasn't that happy with it when I did it myself, but it happened to be the easiest way at the time.</p>\n"}, {"comments": [{"owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "edited": false, "score": 0, "creation_date": 1531090443, "post_id": 51235763, "comment_id": 89452109, "body": "This is the approach I went this.  I created an AccountService object that handles interfacing with handlers and the DAO. I only use the model for designing the struct. Thanks"}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 4, "last_activity_date": 1531081840, "creation_date": 1531081840, "answer_id": 51235763, "question_id": 51234650, "link": "https://stackoverflow.com/questions/51234650/managing-circular-dependencies-in-golang/51235763#51235763", "title": "Managing circular dependencies in golang", "body": "<p>Following a three-tier architecture could help to allieviate some of the problems you are seeing.</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Multitier_architecture#Three-tier_architecture\" rel=\"nofollow noreferrer\">Wikipedia link</a></p>\n\n<p>The reason that you are running into problems is because there's no single place that owns the validation of your models. There's no single place that can pull in all the information that's needed to perform that validation.</p>\n\n<p>Validation is (almost always) based on a set of business-rules (or logic-rules). These rules are nothing to do with the structure of the data (owned by the models package), or the data storage (owned by the dao layer).</p>\n\n<p>Adding a service layer to all code layers, to consume both the model and repo packages will given you a single place to encapsulate the logic rules that are required for validating a model. It will also give you a single logic place for this validation.</p>\n\n<p>In general, I would advocate for <em>always</em> adding a service layer. Even if it does nothing. This rule of thumb gives a more flexible design that allows for requirements to change.</p>\n"}], "owner": {"reputation": 2103, "user_id": 3162553, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/5a4b9cec47f016074898f79d29293d9b?s=128&d=identicon&r=PG&f=1", "display_name": "user3162553", "link": "https://stackoverflow.com/users/3162553/user3162553"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1502, "favorite_count": 0, "accepted_answer_id": 51235763, "answer_count": 2, "score": 2, "last_activity_date": 1531081840, "creation_date": 1531072400, "question_id": 51234650, "link": "https://stackoverflow.com/questions/51234650/managing-circular-dependencies-in-golang", "title": "Managing circular dependencies in golang", "body": "<p>I'm having trouble understanding the best way to organize an application dependency structure in golang.</p>\n\n<p>Essentially, my application is structured like this:</p>\n\n<pre><code>accounts\n  ...\n  handlers\n    accounts.go\n  models\n    account.go\n  repos\n    account.go\n</code></pre>\n\n<p>Now I have a database access object (DAO) setup for accounts and I would like to avoid putting validation logic in there because that fits the model domain better. Repos are designed to only handle interaction with the database.</p>\n\n<p>Inside of models, I believe it makes sense to put validations. However, one validation such as the uniqueness of the email, requires using the DAO which throws an error about circular deps.</p>\n\n<p>I'm curious what is the best way to organize validations in this paradigm?  Should I really include a service layer for any interaction at all? That is, should I have a model that is just the struct for the Account and then have validations and before save hooks in the service?</p>\n"}, {"tags": ["go", "httprequest", "telegram-bot"], "comments": [{"owner": {"reputation": 159, "user_id": 1183632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qs8EG.jpg?s=128&g=1", "display_name": "Danilo", "link": "https://stackoverflow.com/users/1183632/danilo"}, "edited": false, "score": 0, "creation_date": 1531085189, "post_id": 51234464, "comment_id": 89451155, "body": "Hope this help: <a href=\"https://gist.github.com/ebraminio/576fdfdff425bf3335b51a191a65dbdb\" rel=\"nofollow noreferrer\">GIST</a>"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1531099307, "post_id": 51234464, "comment_id": 89453386, "body": "The docs say to upload the file with multipart/form-data."}, {"owner": {"reputation": 269, "user_id": 6490593, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d41b5b585cae455a4f61d91c76ecbf0f?s=128&d=identicon&r=PG&f=1", "display_name": "NicoNex", "link": "https://stackoverflow.com/users/6490593/niconex"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1531147248, "post_id": 51234464, "comment_id": 89475188, "body": "@MichaelHampton I&#39;ve tried putting &quot;multipart/form-data&quot; instead of &quot;binary/octet-stream&quot;, but it won&#39;t work anyway with no error message from telegram also."}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1531168423, "post_id": 51234464, "comment_id": 89486142, "body": "The problem is that you are not setting photo parameter name in request. Also instead of creating integration I would recomend to use this package <a href=\"https://github.com/go-telegram-bot-api/telegram-bot-api\" rel=\"nofollow noreferrer\">github.com/go-telegram-bot-api/telegram-bot-api</a> . There is <code>UploadFile</code> method which probably easly will solve your problem"}, {"owner": {"reputation": 269, "user_id": 6490593, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d41b5b585cae455a4f61d91c76ecbf0f?s=128&d=identicon&r=PG&f=1", "display_name": "NicoNex", "link": "https://stackoverflow.com/users/6490593/niconex"}, "reply_to_user": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1531323393, "post_id": 51234464, "comment_id": 89556624, "body": "@ttomalak could you please explain me how to set the photo parameter name in the request?"}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1531327311, "post_id": 51234464, "comment_id": 89558773, "body": "at that line <a href=\"https://github.com/go-telegram-bot-api/telegram-bot-api/blob/4c16a90966d12d963e19e4df99e7744c191d0e79/bot.go#L139\" rel=\"nofollow noreferrer\">github.com/go-telegram-bot-api/telegram-bot-api/blob/&hellip;</a> there are paramas array where you could set other custom params but you need to set <code>fieldname</code>. So your func call will look something like that <code>tgbotapi.UploadFile(endpoint, customparams, &#39;photo&#39;, yourFile)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 269, "user_id": 6490593, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d41b5b585cae455a4f61d91c76ecbf0f?s=128&d=identicon&r=PG&f=1", "display_name": "NicoNex", "link": "https://stackoverflow.com/users/6490593/niconex"}, "is_accepted": false, "score": 8, "last_activity_date": 1532174476, "creation_date": 1532174476, "answer_id": 51455855, "question_id": 51234464, "link": "https://stackoverflow.com/questions/51234464/upload-a-file-with-post-request-golang/51455855#51455855", "title": "Upload a file with POST request golang", "body": "<p>After some digging I figured it out with this</p>\n\n<pre><code>func SendPostRequest (url string, filename string, filetype string) []byte {\n    file, err := os.Open(filename)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n\n    body := &amp;bytes.Buffer{}\n    writer := multipart.NewWriter(body)\n    part, err := writer.CreateFormFile(filetype, filepath.Base(file.Name()))\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    io.Copy(part, file)\n    writer.Close()\n    request, err := http.NewRequest(\"POST\", url, body)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    request.Header.Add(\"Content-Type\", writer.FormDataContentType())\n    client := &amp;http.Client{}\n\n    response, err := client.Do(request)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer response.Body.Close()\n\n    content, err := ioutil.ReadAll(response.Body)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return content\n}\n</code></pre>\n"}], "owner": {"reputation": 269, "user_id": 6490593, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d41b5b585cae455a4f61d91c76ecbf0f?s=128&d=identicon&r=PG&f=1", "display_name": "NicoNex", "link": "https://stackoverflow.com/users/6490593/niconex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13979, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1532174476, "creation_date": 1531071126, "last_edit_date": 1531074178, "question_id": 51234464, "link": "https://stackoverflow.com/questions/51234464/upload-a-file-with-post-request-golang", "title": "Upload a file with POST request golang", "body": "<p>I'm new to golang and I'm trying to write a function that uploads a file with a post request to telegram for a bot I'm writing.</p>\n\n<p>I've tried with this code but the error I'm getting from telegram is \n<code>Bad Request: there is no photo in the request</code>.</p>\n\n<p>I've searched on the net for how to do that, but none of what I found helped me through the problem.</p>\n\n<pre><code>func SendPostRequest (url string, filename string) []byte {\n    file, err := os.Open(filename)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    response, err := http.Post(url, \"binary/octet-stream\", file)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer response.Body.Close()\n\n    content, err := ioutil.ReadAll(response.Body)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return content\n}\n</code></pre>\n\n<p>The function I'm calling the SendPostRequest from is</p>\n\n<pre><code>func (e Engine) SendPhoto (filename string, chatId int64) APIResponse {\n    var url = fmt.Sprintf(\"%ssendPhoto?chat_id=%d\", e.baseUrl, chatId)\n\n    var content []byte = SendPostRequest(url, filename)\n    var response APIResponse\n\n    json.Unmarshal(content, &amp;response)\n    return response\n}\n</code></pre>\n\n<p>EDIT:\nThe link to the Telegram bot api I'm using in the code is <a href=\"https://core.telegram.org/bots/api\" rel=\"noreferrer\">https://core.telegram.org/bots/api</a></p>\n\n<p>And the api method is <a href=\"https://core.telegram.org/bots/api#sendphoto\" rel=\"noreferrer\">https://core.telegram.org/bots/api#sendphoto</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2063, "user_id": 3188445, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/456b429580f304e24b652ca52363b603?s=128&d=identicon&r=PG&f=1", "display_name": "user3188445", "link": "https://stackoverflow.com/users/3188445/user3188445"}, "edited": false, "score": 0, "creation_date": 1531071773, "post_id": 51234402, "comment_id": 89448094, "body": "Why int64 and not uint64?  And does your answer do something slow on 32-bit platforms, or is the compiler smart enough to output one instruction?"}, {"owner": {"reputation": 2063, "user_id": 3188445, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/456b429580f304e24b652ca52363b603?s=128&d=identicon&r=PG&f=1", "display_name": "user3188445", "link": "https://stackoverflow.com/users/3188445/user3188445"}, "edited": false, "score": 0, "creation_date": 1531073014, "post_id": 51234402, "comment_id": 89448381, "body": "I&#39;m confused.  Those two comparisons have different semantics, but both are correct by the go lang spec which precisely defines the behavior of conversions between numeric types.  If you are checking for overflow, the second one is what you want."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 2063, "user_id": 3188445, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/456b429580f304e24b652ca52363b603?s=128&d=identicon&r=PG&f=1", "display_name": "user3188445", "link": "https://stackoverflow.com/users/3188445/user3188445"}, "edited": false, "score": 0, "creation_date": 1531074918, "post_id": 51234402, "comment_id": 89448840, "body": "@user3188445: &quot;Those two comparisons have different semantics, but both are correct by the go lang spec which precisely defines the behavior of conversions between numeric types. &quot; Explain the discrepancy: <a href=\"https://play.golang.org/p/OceveAiuvZs\" rel=\"nofollow noreferrer\">play.golang.org/p/OceveAiuvZs</a>"}, {"owner": {"reputation": 2063, "user_id": 3188445, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/456b429580f304e24b652ca52363b603?s=128&d=identicon&r=PG&f=1", "display_name": "user3188445", "link": "https://stackoverflow.com/users/3188445/user3188445"}, "edited": false, "score": 0, "creation_date": 1531078634, "post_id": 51234402, "comment_id": 89449726, "body": "First one test if numeric less equal. Second tests if numeric less equal and not negative, which is often what you want. In the case of my original question len can&#39;t be negative so doesn&#39;t matter."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 2063, "user_id": 3188445, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/456b429580f304e24b652ca52363b603?s=128&d=identicon&r=PG&f=1", "display_name": "user3188445", "link": "https://stackoverflow.com/users/3188445/user3188445"}, "edited": false, "score": 1, "creation_date": 1531098657, "post_id": 51234402, "comment_id": 89453288, "body": "It&#39;s easy to see that <code>int64</code> works in all cases. That does matter."}, {"owner": {"reputation": 2063, "user_id": 3188445, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/456b429580f304e24b652ca52363b603?s=128&d=identicon&r=PG&f=1", "display_name": "user3188445", "link": "https://stackoverflow.com/users/3188445/user3188445"}, "edited": false, "score": 0, "creation_date": 1531114429, "post_id": 51234402, "comment_id": 89456264, "body": "I think my minimal example unfortunately does not do justice to the complexity of the issues I&#39;m facing in parsing data.  So for my actual question, <code>int64</code>, <code>uint64</code>, and <code>uint</code> will all work, with <code>uint</code> possibly generating slightly better code.  But I have other situations where instead of just <code>len</code> there has been a computation that could overflow and lead to a negative number, like I&#39;m actually calling <code>sizeok(len(v)+1)</code>.  So for my real use case, <code>int64</code> and <code>uint</code> don&#39;t work, and casting to <code>uint64</code> may be the best option."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1531101896, "last_edit_date": 1531101896, "creation_date": 1531070638, "answer_id": 51234402, "question_id": 51234371, "link": "https://stackoverflow.com/questions/51234371/best-way-to-compare-slice-length-to-uint32-in-go-for-adversarial-context/51234402#51234402", "title": "Best way to compare slice length to uint32 in go (for adversarial context)", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Length_and_capacity\" rel=\"nofollow noreferrer\">Length and capacity</a></p>\n  \n  <p>The built-in functions len and cap take arguments of various types and\n  return a result of type int. The implementation guarantees that the\n  result always fits into an int.</p>\n\n<pre><code>Call      Argument type    Result\n\nlen(s)    string type      string length in bytes\n          [n]T, *[n]T      array length (== n)\n          []T              slice length\n          map[K]T          map length (number of defined keys)\n          chan T           number of elements queued in channel buffer\n</code></pre>\n  \n  <p><a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"nofollow noreferrer\">Numeric types</a></p>\n\n<pre><code>uint32  all unsigned 32-bit integers (0 to 4294967295)\n\nint64   all signed 64-bit integers (-9223372036854775808 to 9223372036854775807)\n</code></pre>\n  \n  <p>There is also a set of predeclared numeric types with\n  implementation-specific sizes:</p>\n\n<pre><code>uint     either 32 or 64 bits\nint      same size as uint\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p><code>len(buf)</code> is type <code>int</code> which is 32 or 64 bits depending on the implementation. For example, for any Go type with a built-in <code>len</code> function,</p>\n\n<pre><code>// Safely check if len(buf) &lt;= size for all possible values of each\nvar size uint32\nif int64(len(buf)) &lt;= int64(size) {\n    // handle len(buf) &lt;= size\n}\n</code></pre>\n"}], "owner": {"reputation": 2063, "user_id": 3188445, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/456b429580f304e24b652ca52363b603?s=128&d=identicon&r=PG&f=1", "display_name": "user3188445", "link": "https://stackoverflow.com/users/3188445/user3188445"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 663, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1531101896, "creation_date": 1531070350, "question_id": 51234371, "link": "https://stackoverflow.com/questions/51234371/best-way-to-compare-slice-length-to-uint32-in-go-for-adversarial-context", "title": "Best way to compare slice length to uint32 in go (for adversarial context)", "body": "<p>I'm writing some inner-loop type input parsing code, and need to compare the length of a buffer to a <code>uint32</code>.  The ideal solution would be fast, concise, dumb (easy to see the correctness of), and work for all possible inputs including those in which an attacker maliciously manipulates the values.  Integer overflow is a big deal in this context if it can be exploited to crash the program.  This is what I have so far:</p>\n\n<pre><code>// Safely check if len(buf) &lt;= size for all possible values of each\nfunc sizeok(buf []MyType, size uint32) bool {\n    var n int = len(buf)\n    return n == int(uint32(n)) &amp;&amp; uint32(n) &lt;= size\n}\n</code></pre>\n\n<p>That's a pain, and can't be abstracted over other slice types.</p>\n\n<p>My questions:  First, is this actually correct?  (You can never be too careful defending against exploitable integer overflows.)  Second, is there a simpler way to do it with a single comparison?  Maybe <code>uint(len(buf)) &lt;= uint(size)</code> if that could be guaranteed to work securely on all platforms and inputs?  Or <code>uint64(len(buf)) &lt;= uint64(size)</code> if that won't generate suboptimal code on 32-bit platforms?</p>\n"}, {"tags": ["go", "gorilla", "httprouter"], "answers": [{"comments": [{"owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "edited": false, "score": 0, "creation_date": 1531076949, "post_id": 51233863, "comment_id": 89449307, "body": "I have edited the code, I have removed the package names from the function so most of it was a typo. Still getting the same error."}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "reply_to_user": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "edited": false, "score": 0, "creation_date": 1531085538, "post_id": 51233863, "comment_id": 89451220, "body": "Is <code>gitlab.com&#47;mesha&#47;Gofeynmen&#47;appsettings&#47;appsettings.go:115</code> this line <code>h.ServeHTTP( w, r)</code>?"}, {"owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "edited": false, "score": 0, "creation_date": 1531086289, "post_id": 51233863, "comment_id": 89451352, "body": "I couldnt understand, If the token validation is successful the control will be passed on to ServeHTTP method."}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "reply_to_user": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "edited": false, "score": 0, "creation_date": 1531101888, "post_id": 51233863, "comment_id": 89453802, "body": "Yes I was trying to find out which lines of the code you shared were implicated in the stack trace, since I don&#39;t have the file names and line numbers.  Clearly <code>CheckAuth</code> and <code>ServeHTTP</code> are involved.  You could add some debugging code to validate that objects are non-nil and contain the data you expect.  It looks like it may ultimately fail on a Session issue, but there&#39;s probably something wrong with the setup before it gets there."}, {"owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "edited": false, "score": 0, "creation_date": 1531128880, "post_id": 51233863, "comment_id": 89463393, "body": "I was missing return statements from the CheckAuth middleware, so when the error happens, It wasnt returning http.Handle type. Thank you @jrefior for the help.Thanks a lot. The final working code is now updated."}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 1, "last_activity_date": 1531068909, "last_edit_date": 1531068909, "creation_date": 1531066375, "answer_id": 51233863, "question_id": 51233477, "link": "https://stackoverflow.com/questions/51233477/chaining-middleware-in-net-http-golang/51233863#51233863", "title": "Chaining middleware in net/http golang", "body": "<p>It's likely an attempt to dereference <code>ah</code> from <code>(ah *ContextedHandler)</code>, when <code>ah</code> is not a pointer to a <code>ContextedHandler</code>.</p>\n\n<p>The types in this assignment don't match up:</p>\n\n<pre><code>var FileUploadContextHandler *ContextedHandler =\n    ContextedHandler{&amp;context, filesystem.FileUpload}\n</code></pre>\n\n<p>On the left side you have type <code>*ContextedHandler</code>.  On the right side you have type <code>ContextedHandler</code>.</p>\n\n<p>Did you mean</p>\n\n<pre><code>var FileUploadContextHandler *ContextedHandler =\n    &amp;ContextedHandler{&amp;context, filesystem.FileUpload} \n</code></pre>\n\n<p>Or did you mean</p>\n\n<pre><code>var FileUploadContextHandler ContextedHandler =\n    ContextedHandler{&amp;context, filesystem.FileUpload}\n</code></pre>\n\n<p>?</p>\n\n<hr>\n\n<p>The argument passed to the CheckAuth function appears to not match the function signature either:</p>\n\n<pre><code>CheckAuth(FileUploadContextHandler)\n</code></pre>\n\n<p><code>FileUploadContextHandler</code> is type <code>*ContextedHandler</code>.  The function signature is:</p>\n\n<pre><code>func CheckAuth(h contextHandlerFunc) contextHandlerFunc\n</code></pre>\n\n<p>The type definition of <code>contextHandlerFunc</code> does not appear to be part of the code you shared.</p>\n\n<hr>\n\n<p>A problem with this line:</p>\n\n<pre><code>router.Methods(\"POST\").Path(\"/decentralizefilesystem/fileupload\").Name(\"FileUpload\").Handler(CheckAuth(FileUploadContextHandler))\n</code></pre>\n\n<p>...would be easier to track down if you broke it up into variable assignments on several lines and then figured out which line the panic pointed to.</p>\n"}], "owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1114, "favorite_count": 0, "accepted_answer_id": 51233863, "answer_count": 1, "score": 0, "last_activity_date": 1531128995, "creation_date": 1531063657, "last_edit_date": 1531128995, "question_id": 51233477, "link": "https://stackoverflow.com/questions/51233477/chaining-middleware-in-net-http-golang", "title": "Chaining middleware in net/http golang", "body": "<p>I am trying to add context to Authorization middleware. The ContextHandler is a handler which will be passed to api handlers to take care of connections and config variables. A struct Method ServeHTTP also has been added to the ContextHandler so that it satisfies the net/Http interface for handling requests properly.</p>\n\n<p>CheckAuth is the middle ware which takes in the request to check token validation etc, If token is valid, executes the ServeHTTP method and if not, Returns the appropriate error in the response.</p>\n\n<p>Code compiles, but i am getting error in the ServeHTTP method.</p>\n\n<pre><code>type ContextHandler struct {\n    *AppContext\n     Handler func(*AppContext, http.ResponseWriter, *http.Request)(int, error)\n</code></pre>\n\n<p>}</p>\n\n<pre><code>type AppContext struct {\n   Db    *mgo.Session\n   Config *simplejson.Json\n}\n\n\nfunc (ah *ContextedHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n\nstatus, err := ah.handler(ah.AppContext, w, r)\nif err != nil {\n     switch status {\n    case http.StatusNotFound:\n        http.NotFound(w, r)\n      case http.StatusInternalServerError:\n          http.Error(w, http.StatusText(status), status)\n    default:\n        http.Error(w, http.StatusText(405), 405)\n    }}}\n\n\n\n\n\nfunc CheckAuth(h http.Handler) http.Handler {\n    log.Println(\"Entered in CheckAuth\")\n    f := func( w http.ResponseWriter, r *http.Request) {\n    authorizationToken := r.Header.Get(\"Authorization\")\n    if authorizationToken != \"\"{\n        secret := []byte(\"somejunk\")\n        var credentials authorization\n        token, err := jwt.ParseWithClaims(authorizationToken, &amp;credentials, func(t *jwt.Token) (interface{}, error) {\n        return []byte(secret), nil\n        })\n\n        if err == nil &amp;&amp; token.Valid {\n            //If everything is fine serve the Http request\n            h.ServeHTTP( w, r)\n            return \n\n            } else {\n                  //Some response returned\n                  json.NewEncoder(w).Encode(response)\n                  return \n                  }\n        //Check if user exists in the database \n        if dberr != nil {\n           //SOmeresponse to be returned\n          json.NewEncoder(w).Encode(response)\n          return \n        }\n      }else{\n          response := simplejson.New()\n          //response authorization header is missing\n          json.NewEncoder(w).Encode(response)\n          return \n\n        }\n}\n        return http.HandlerFunc(f)\n</code></pre>\n\n<p>}</p>\n\n<pre><code>func Initdb(configfile  *simplejson.Json) *mgo.Session {\n   //return mongodbsession, copy and close while using it\n}\n\nIn main.go file in the parent package \nfunc main() {\n      var FileUploadContextHandler *ContextedHandler = &amp;ContextedHandler{&amp;context, filesystem.FileUpload}\n     router.Methods(\"POST\").Path(\"/decentralizefilesystem/fileupload\").Name(\"FileUpload\").Handler(CheckAuth(FileUploadContextHandler))\n  }\n\nI am getting this error\n    2018/07/08 20:45:38 http: panic serving 127.0.0.1:52732: runtime error: invalid memory address or nil pointer dereference\ngoroutine 35 [running]:\nnet/http.(*conn).serve.func1(0xc4202ce140)\n    /usr/local/go/src/net/http/server.go:1726 +0xd0\npanic(0x6fe680, 0x92cb10)\n    /usr/local/go/src/runtime/panic.go:502 +0x229\ngitlab.com/mesha/Gofeynmen/vendor/gopkg.in/mgo%2ev2.(*Session).Copy(0x0, 0x7ff9485fb060)\n    /home/feynman/goworkspace/src/gitlab.com/mesha/Gofeynmen/vendor/gopkg.in/mgo.v2/session.go:1589 +0x22\ngitlab.com/mesha/Gofeynmen/appsettings.CheckAuth.func1(0x7ff9485fb060, 0xc420276300, 0xc4202e4200)\n    /home/feynman/goworkspace/src/gitlab.com/mesha/Gofeynmen/appsettings/appsettings.go:115 +0x361\nnet/http.HandlerFunc.ServeHTTP(0xc420290180, 0x7ff9485fb060, 0xc420276300, 0xc4202e4200)\n    /usr/local/go/src/net/http/server.go:1947 +0x44\ngithub.com/gorilla/mux.(*Router).ServeHTTP(0xc42024a310, 0x7ff9485fb060, 0xc420276300, 0xc4202e4200)\n    /home/feynman/goworkspace/src/github.com/gorilla/mux/mux.go:162 +0xed\ngithub.com/gorilla/handlers.loggingHandler.ServeHTTP(0x7a8120, 0xc42000e018, 0x7a7b20, 0xc42024a310, 0x7aad60, 0xc4202f0000, 0xc4202e4000)\n    /home/feynman/goworkspace/src/github.com/gorilla/handlers/handlers.go:69 +0x123\ngithub.com/gorilla/handlers.(*cors).ServeHTTP(0xc4202c4090, 0x7aad60, 0xc4202f0000, 0xc4202e4000)\n    /home/feynman/goworkspace/src/github.com/gorilla/handlers/cors.go:52 +0xa3b\nnet/http.serverHandler.ServeHTTP(0xc4202da0d0, 0x7aad60, 0xc4202f0000, 0xc4202e4000)\n    /usr/local/go/src/net/http/server.go:2694 +0xbc\nnet/http.(*conn).serve(0xc4202ce140, 0x7ab120, 0xc42025e100)\n    /usr/local/go/src/net/http/server.go:1830 +0x651\ncreated by net/http.(*Server).Serve\n    /usr/local/go/src/net/http/server.go:2795 +0x27b\n</code></pre>\n"}, {"tags": ["curl", "go", "net-http"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1531068838, "post_id": 51233437, "comment_id": 89447332, "body": "Why do you think that what you&#39;ve tried is not already what you are looking for? For me it does exactly the same as the curl cmdline you show: add the given payload without additional processing and also request a compressed response."}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1531160870, "post_id": 51233437, "comment_id": 89482656, "body": "@SteffenUllrich The missing bits are <code>--compressed</code>"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1531161577, "post_id": 51233437, "comment_id": 89483032, "body": "@dolmen: to cite myself: <i>&quot;... and also request a compressed response&quot;</i>. So, nothing is missing since this is exactly what <code>--compressed</code> does."}, {"owner": {"reputation": 431, "user_id": 2766818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CRGvb.jpg?s=128&g=1", "display_name": "oohcode", "link": "https://stackoverflow.com/users/2766818/oohcode"}, "edited": false, "score": 0, "creation_date": 1532169287, "post_id": 51233437, "comment_id": 89879760, "body": "I have solved this problem by this tool <a href=\"https://github.com/two/curl-to-go\" rel=\"nofollow noreferrer\">github.com/two/curl-to-go</a>, fork from  <a href=\"https://github.com/mholt/curl-to-go\" rel=\"nofollow noreferrer\">github.com/mholt/curl-to-go</a>"}], "owner": {"reputation": 431, "user_id": 2766818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CRGvb.jpg?s=128&g=1", "display_name": "oohcode", "link": "https://stackoverflow.com/users/2766818/oohcode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "closed_date": 1532169183, "answer_count": 0, "score": 0, "last_activity_date": 1531064675, "creation_date": 1531063336, "last_edit_date": 1531064675, "question_id": 51233437, "link": "https://stackoverflow.com/questions/51233437/what-is-the-equivalent-of-http-request-using-curl-data-binary-string-in-go", "closed_reason": "Duplicate", "title": "What is the equivalent of HTTP request using \u201ccurl \u2026 --data-binary string\u201d in Go?", "body": "<p>for example the curl code:</p>\n\n<pre><code>curl \"http://example.com\" --data-binary $'abc\\r\\ndef' --compressed\n</code></pre>\n\n<p>how to translate it to Go code?</p>\n\n<p>What I have try is:</p>\n\n<pre><code>body := []byte(\"abc\\r\\ndef\")\nreq, _ := http.NewRequest(\"POST\", \"http://example.com\", bytes.NewBuffer(body))\nresp, _ := http.DefaultClient.Do(req)\n</code></pre>\n"}]