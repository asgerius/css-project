[{"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 14632, "user_id": 428260, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/Jr7uO.png?s=128&g=1", "display_name": "iltempo", "link": "https://stackoverflow.com/users/428260/iltempo"}, "is_accepted": false, "score": 4, "last_activity_date": 1451511737, "creation_date": 1451511737, "answer_id": 34537684, "question_id": 34537588, "link": "https://stackoverflow.com/questions/34537588/json-unmarshall-not-working-as-expected-with-structs/34537684#34537684", "title": "JSON Unmarshall not working as expected with structs", "body": "<p><code>num</code> is by convention not exported as it is lower case. Change it to <code>Num</code> and you are able to inspect the result.</p>\n\n<pre><code>type SuperNum struct {\n    Num string\n}                                                                                   \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 2, "last_activity_date": 1451511784, "creation_date": 1451511784, "answer_id": 34537696, "question_id": 34537588, "link": "https://stackoverflow.com/questions/34537588/json-unmarshall-not-working-as-expected-with-structs/34537696#34537696", "title": "JSON Unmarshall not working as expected with structs", "body": "<p>Just change <code>num</code> to <code>Num</code>. The lowercase properties of the structures are not visible.</p>\n\n<p><kbd><a href=\"https://play.golang.org/p/2g4aYZXoqo\" rel=\"nofollow\">Go playground</a></kbd></p>\n"}, {"comments": [{"owner": {"reputation": 4404, "user_id": 2684055, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/12d7b42352806d7d85ec8746ca018d97?s=128&d=identicon&r=PG", "display_name": "Jorge Silva", "link": "https://stackoverflow.com/users/2684055/jorge-silva"}, "edited": false, "score": 0, "creation_date": 1451512230, "post_id": 34537699, "comment_id": 56817666, "body": "So is there a moment where I would set the property in the <code>SuperNum</code> struct to <code>num</code>? Why?"}], "tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": false, "score": 1, "last_activity_date": 1451511797, "creation_date": 1451511797, "answer_id": 34537699, "question_id": 34537588, "link": "https://stackoverflow.com/questions/34537588/json-unmarshall-not-working-as-expected-with-structs/34537699#34537699", "title": "JSON Unmarshall not working as expected with structs", "body": "<p>When unmarhalling JSON structures, the properties that you're mapping on must be public (remember that in Go, public and private visibility of struct and module members is denoted by the member's name being upper or lower camel case.</p>\n\n<p>So, first of all, your struct must be defined like this:</p>\n\n<pre><code>type SuperNum struct {\n    Num string  // &lt;- note the capital \"N\"\n}\n</code></pre>\n\n<p>With this struct, the JSON marshaller will expect the JSON property to be also named <code>Num</code>. In order to configure a different property name (like the lowercased <code>num</code> in your example), use the <code>json</code> annotation for that struct member:</p>\n\n<pre><code>type SuperNum struct {\n    Num string `json:\"num\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 4404, "user_id": 2684055, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/12d7b42352806d7d85ec8746ca018d97?s=128&d=identicon&r=PG", "display_name": "Jorge Silva", "link": "https://stackoverflow.com/users/2684055/jorge-silva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "closed_date": 1451512029, "answer_count": 3, "score": 0, "last_activity_date": 1451511797, "creation_date": 1451511264, "last_edit_date": 1451511688, "question_id": 34537588, "link": "https://stackoverflow.com/questions/34537588/json-unmarshall-not-working-as-expected-with-structs", "closed_reason": "Duplicate", "title": "JSON Unmarshall not working as expected with structs", "body": "<p>I have the following code: </p>\n\n<pre><code>package main\n\nimport \"encoding/json\"\nimport \"fmt\"\n\ntype SuperNum struct {\n    num string\n}\n\nfunc main() {\n    byt := []byte(`{\"num\":\"6.13\"}`)\n\n    var dat SuperNum\n\n    if err := json.Unmarshal(byt, &amp;dat); err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%+v\", dat) // I expect this to have a `num` attribute\n}\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>{num:}\nProgram exited.\n</code></pre>\n\n<p>You can run this code <a href=\"http://play.golang.org/p/lU9qNrdB-Y\" rel=\"nofollow\">in the golang playground</a>.</p>\n\n<p>Because I'm setting a <code>num</code> property in the struct and in the JSON and they're both strings, I would have expected the <code>dat</code> struct to have a <code>num</code> property, with <code>'hello'</code>, but it doesn't. </p>\n\n<p>What am I doing wrong? What in my mental model of how this should work is incorrect?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I tried adding the <code>json</code> signature to the struct, but it makes no difference (no idea what that actually does). </p>\n\n<pre><code>type SuperNum struct {\n    num string `json:\"num\"`\n}\n</code></pre>\n"}, {"tags": ["go", "code-coverage"], "answers": [{"tags": [], "owner": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "is_accepted": false, "score": 5, "last_activity_date": 1451505650, "last_edit_date": 1451505650, "creation_date": 1451505338, "answer_id": 34536333, "question_id": 34535704, "link": "https://stackoverflow.com/questions/34535704/how-to-detect-code-coverage-of-separated-folders-in-go/34536333#34536333", "title": "How to detect code-coverage of separated folders in GO?", "body": "<p>Conventional Go program structure keeps the tests with the package.  Like this:</p>\n\n<pre><code>project\n|-stuff\n|--stuff.go\n|--stuff_test.go\n</code></pre>\n\n<p>At the top of your testing files you still declare <code>package stuff</code>, and it is required that your test methods take the form <code>TestMethodX</code> if you want <code>go test</code> to automatically run them.</p>\n\n<p>See Go docs for details: <a href=\"https://golang.org/pkg/testing/\" rel=\"noreferrer\">https://golang.org/pkg/testing/</a></p>\n"}, {"comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1451558321, "post_id": 34537104, "comment_id": 56831802, "body": "Can you publish a link for your tool, Rob?"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "reply_to_user": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1451571521, "post_id": 34537104, "comment_id": 56836973, "body": "@Rick-777 Mine is an internal tool that&#39;s integrated with our build system (with hardcoded paths and logic). I&#39;ve considered making it generic and publishing it; it wouldn&#39;t be that much work. But there are already other good tools in this space, so there really isn&#39;t much need for yet another one."}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 4, "last_activity_date": 1451508897, "creation_date": 1451508897, "answer_id": 34537104, "question_id": 34535704, "link": "https://stackoverflow.com/questions/34535704/how-to-detect-code-coverage-of-separated-folders-in-go/34537104#34537104", "title": "How to detect code-coverage of separated folders in GO?", "body": "<p>Cross-package test coverage is not directly supported, but several people have built wrappers to merge individual coverage profiles.</p>\n\n<p>See <a href=\"https://github.com/golang/go/issues/6909\" rel=\"nofollow noreferrer\">Issue #6909</a> for the long history on this. And see <a href=\"https://github.com/pierrre/gotestcover\" rel=\"nofollow noreferrer\">gotestcover</a> for an example tool to do the merging. There's also <a href=\"https://github.com/wadey/gocovmerge\" rel=\"nofollow noreferrer\">gocovmerge</a>. I built my own version, so I haven't tried any of these, but I'm sure they all work like mine, and mine works fine.</p>\n\n<p>My sense is that this is just an issue that no one has written a really compelling changelist for, and hasn't been that important to the core maintainers, so it hasn't been addressed. It does raise little corner cases that might break existing tests, so the quick hacks that work for most of us haven't been accepted as-is. But I haven't seen any discussion suggesting the core maintainers actively object to this feature.</p>\n"}], "owner": {"reputation": 330, "user_id": 2525886, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/xv7KS.png?s=128&g=1", "display_name": "johannes.schmidt.delaunay", "link": "https://stackoverflow.com/users/2525886/johannes-schmidt-delaunay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1035, "favorite_count": 0, "accepted_answer_id": 34537104, "answer_count": 2, "score": 9, "last_activity_date": 1451508897, "creation_date": 1451502802, "question_id": 34535704, "link": "https://stackoverflow.com/questions/34535704/how-to-detect-code-coverage-of-separated-folders-in-go", "title": "How to detect code-coverage of separated folders in GO?", "body": "<p>My project-structure<br>\n<code>stuff/stuff.go -&gt; package: stuff</code><br>\n<code>test/stuff/stuff_test.go -&gt; package: test</code><br>\nAlthough stuff_test executes code from stuff.go it shows<br>\n<code>coverage: 0.0% of statements</code><br>\n<br>\nI used\n<code>go test -cover</code><br>\nIf I move my *_test.go to the stuff-folder of the program it is working fine.<br>\nOr perhaps my approach of the project-structure is not well designed/go-conform?</p>\n"}, {"tags": ["multithreading", "go", "concurrency", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 10, "last_activity_date": 1451490033, "last_edit_date": 1451490033, "creation_date": 1451489549, "answer_id": 34532411, "question_id": 34531971, "link": "https://stackoverflow.com/questions/34531971/multithreading-in-go-can-somebody-explain-these-answers-to-me/34532411#34532411", "title": "Multithreading in Go. Can somebody explain these answers to me?", "body": "<p>It is best not to think of this as \"multi-threading.\" Go provides direct facilities for concurrency, not for threading. It happens to implement its concurrency with threading, but that is an implementation detail. See Rob Pike's talk, <a href=\"http://blog.golang.org/concurrency-is-not-parallelism\">Concurrency is not parallelism</a> for a much deeper discussion.</p>\n\n<p>The key to your questions is that channels are synchronous by default (if they are not made buffered during their construction). When one goroutine writes to a channel, it will block until some other goroutine reads from that channel. So when this line executes:</p>\n\n<pre><code>z := &lt;- d\n</code></pre>\n\n<p>It cannot proceed until this line executes:</p>\n\n<pre><code>d &lt;- 0\n</code></pre>\n\n<p>Without some value being available on the <code>d</code> channel, <code>fact</code> will never proceed. That is likely obvious to you. <em>But the reverse is also true</em>. Until something reads from the <code>d</code> channel, the main goroutine cannot proceed. In this way unbuffered channels provide a synchronization point across concurrent goroutines.</p>\n\n<p>Similarly, the main loop cannot proceed until some value appears on <code>c</code>. I find it useful to use two fingers and point to the current line of code in each goroutine. Advance one finger until you get to a channel operation. Then advance the other until it reaches a channel operation. If your fingers are pointing to a read and a write on the same channel, then you may proceed. If they are not, then you're in deadlock.</p>\n\n<p>If you think this through, you'll discover a problem. This program leaks a goroutine.</p>\n\n<pre><code>func fact(n int, c chan int, d chan int) {\n    k := /* code to compute factorial of n */\n    z := &lt;- d // (1)\n    c &lt;- k + z\n    d &lt;- z + 1 // (2)\n}\n</code></pre>\n\n<p>At (2) we try to write to <code>d</code>. What will allow that to proceed? Another goroutine reading from <code>d</code>. Remember, we started <code>N</code> goroutines, and all of them tried to read from <code>d</code>. Only one of them will be successful. The others will block at (1), waiting for something to show up on <code>d</code>. That happens when the first one gets to (2). Then that goroutine exits and a random goroutine will proceed.</p>\n\n<p>But there will be a final goroutine that will never be able to write to <code>d</code> and it will leak. In order to resolve that, the following would need to be added before the final <code>Printf</code>:</p>\n\n<pre><code>&lt;-d\n</code></pre>\n\n<p>This would allow the last goroutine to exit.</p>\n"}, {"tags": [], "owner": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "is_accepted": false, "score": 4, "last_activity_date": 1451489844, "creation_date": 1451489844, "answer_id": 34532472, "question_id": 34531971, "link": "https://stackoverflow.com/questions/34531971/multithreading-in-go-can-somebody-explain-these-answers-to-me/34532472#34532472", "title": "Multithreading in Go. Can somebody explain these answers to me?", "body": "<blockquote>\n  <p>How does the program behave if we omit the line \"d &lt;- 0\" in the main procedure, and why?</p>\n</blockquote>\n\n<p>Withough that line, each goroutine started by <code>go fact(...)</code> will be waiting for something from the channel, blocked at the statement <code>z := &lt;- d</code>.</p>\n\n<p>The <code>fact()</code> function has no net effect on the contents of the <code>d</code> channel -it removes something and adds something.  So if there is nothing in the channel there will be no progress and the program will deadlock.</p>\n\n<p>A goroutine which reads and writes from the same channel is asking for a deadlock - avoid in real life!</p>\n\n<blockquote>\n  <p>How would the efficiency of the whole program be affected if we swapped the first two lines of the fact procedure?</p>\n</blockquote>\n\n<p>The <code>fact()</code> routine will wait until it gets a token from the <code>d</code> channel before doing its lengthy factorial calculation.</p>\n\n<p>Because there is only one token in play in the <code>d</code> channel at once, that means that each go routine will only do the expensive calculation when it receives the token, effectively serializing them.</p>\n\n<p>As it was originally, the expensive factorial calculations are done in parallel before waiting for the token.</p>\n\n<p>In practice this would work less well than you might have hoped for since goroutines aren't pre-emptively scheduled, only on blocking operations and function calls.</p>\n"}], "owner": {"reputation": 91, "user_id": 2399525, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/0729ce681a96c33c35af0451638145b0?s=128&d=identicon&r=PG", "display_name": "user2399525", "link": "https://stackoverflow.com/users/2399525/user2399525"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 34532411, "answer_count": 2, "score": 3, "last_activity_date": 1451490033, "creation_date": 1451487924, "last_edit_date": 1451488246, "question_id": 34531971, "link": "https://stackoverflow.com/questions/34531971/multithreading-in-go-can-somebody-explain-these-answers-to-me", "title": "Multithreading in Go. Can somebody explain these answers to me?", "body": "<p>I got two questions on a mock-exam. I was given the answers but cannot figure out the rationale behind them.</p>\n\n<p>I will first post the code and then the questions and answers. Maybe somebody would be so kind to explain the answers to me? </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc fact(n int, c chan int, d chan int) {\n\n    k := /* code to compute factorial of n */\n\n    z := &lt;- d\n\n    c &lt;- k + z\n\n    d &lt;- z + 1\n\n}\n\nfunc main() {\n\n    r := 0\n\n    c := make(chan int)\n    d := make(chan int)\n\n    for i = 0 ; i &lt; N ; i++ {\n        go fact(i,c,d)\n    }\n\n    d &lt;- 0\n\n    for j = 0 ; j &lt; N ; j++ {\n        r = r + &lt;-c\n    }\n\n    fmt.Printf(\"result = %d\\n\",r)\n\n}\n</code></pre>\n\n<p>The first question is: </p>\n\n<p>How does the program behave if we omit the line \"d &lt;- 0\" in the main procedure, and why?</p>\n\n<p>The answer from the teacher is: </p>\n\n<p>The state of all the threads are blocked and also the main thread. </p>\n\n<p>The second question is: </p>\n\n<p>How would the efficiency of the whole program be affected if we swapped the first two lines of the fact procedure?</p>\n\n<p>The answer is: </p>\n\n<p>All threads are going to run sequentially. Each thread would trigger another thread only when it is finished. </p>\n"}, {"tags": ["linux", "http", "go", "tcp", "http-proxy"], "comments": [{"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 3, "creation_date": 1451483047, "post_id": 34530628, "comment_id": 56802669, "body": "The main problem is that a TCP connection doesn&#39;t knows about HTTP.  You should probably use the <code>net&#47;http.ReadRequest</code> method to parse the HTTP request, which should give you access to the HTTP headers. See <a href=\"https://golang.org/pkg/net/http/#ReadRequest\" rel=\"nofollow noreferrer\">the doc</a>."}, {"owner": {"reputation": 2636, "user_id": 4635560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iv67d.jpg?s=128&g=1", "display_name": "Manthan Tilva", "link": "https://stackoverflow.com/users/4635560/manthan-tilva"}, "edited": false, "score": 0, "creation_date": 1451483131, "post_id": 34530628, "comment_id": 56802727, "body": "I don&#39;t know much about golang, but in c/c++ i can read socket fd using read() system call and i get head/content of http request."}, {"owner": {"reputation": 147, "user_id": 3844741, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/xiKAz.png?s=128&g=1", "display_name": "Love_for_CODE", "link": "https://stackoverflow.com/users/3844741/love-for-code"}, "edited": false, "score": 0, "creation_date": 1451483598, "post_id": 34530628, "comment_id": 56802942, "body": "Thanks... But when I passed it <code>malformed HTTP request</code>..... It is not the way I think"}, {"owner": {"reputation": 147, "user_id": 3844741, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/xiKAz.png?s=128&g=1", "display_name": "Love_for_CODE", "link": "https://stackoverflow.com/users/3844741/love-for-code"}, "reply_to_user": {"reputation": 2636, "user_id": 4635560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iv67d.jpg?s=128&g=1", "display_name": "Manthan Tilva", "link": "https://stackoverflow.com/users/4635560/manthan-tilva"}, "edited": false, "score": 0, "creation_date": 1451483757, "post_id": 34530628, "comment_id": 56803029, "body": "@ManthanTilva - Actually a TCP Connection Bytes contain TCP headers like IP version , Source, Destination...... My question is at which index is the http headers or the request is found in that byte array ??"}, {"owner": {"reputation": 2636, "user_id": 4635560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iv67d.jpg?s=128&g=1", "display_name": "Manthan Tilva", "link": "https://stackoverflow.com/users/4635560/manthan-tilva"}, "edited": false, "score": 1, "creation_date": 1451483999, "post_id": 34530628, "comment_id": 56803188, "body": "@Love_for_CODE. As i say ,what&#39;s with golang i haven&#39;t idea. But in c/c++ when you use read system call on socket fd return by accept system call it will return payload of tcp layer in this case it is http header+content. I think same should be case with golang."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451484232, "post_id": 34530628, "comment_id": 56803333, "body": "When you read a TCP connection, you don&#39;t get TCP headers. I don&#39;t know what you think you see, but without an example we can only guess."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451557912, "post_id": 34530628, "comment_id": 56831599, "body": "Further, you can potentially avoid this by using <a href=\"https://golang.org/pkg/net/http/httputil\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/httputil</a> and its *Proxy types."}], "answers": [{"tags": [], "owner": {"reputation": 2636, "user_id": 4635560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iv67d.jpg?s=128&g=1", "display_name": "Manthan Tilva", "link": "https://stackoverflow.com/users/4635560/manthan-tilva"}, "is_accepted": false, "score": 1, "last_activity_date": 1451541990, "creation_date": 1451541990, "answer_id": 34541918, "question_id": 34530628, "link": "https://stackoverflow.com/questions/34530628/getting-http-headers-from-tcp-connections/34541918#34541918", "title": "Getting HTTP headers from TCP Connections", "body": "<p>I am also new to golang but below code works for me as far as getting HTTP data from tcp socket is consern.</p>\n\n<pre><code>package main\n\nimport \"net\" \nimport \"fmt\" \nimport \"io\"\n\nfunc main() {   \n    fmt.Println(\"Launching server...\")\n    ln, _ := net.Listen(\"tcp\", \":8081\")\n    conn, _ := ln.Accept()\n    tmp := make([]byte,256)\n        for {\n            n,err := conn.Read(tmp)\n            if err != nil {\n                if err != io.EOF {\n                    fmt.Println(\"read error:\", err)\n                }\n                break\n            }\n            fmt.Println(\"rx:\", string(tmp[:n]))\n        } \n}\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 3844741, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/xiKAz.png?s=128&g=1", "display_name": "Love_for_CODE", "link": "https://stackoverflow.com/users/3844741/love-for-code"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1235, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1451541990, "creation_date": 1451482647, "question_id": 34530628, "link": "https://stackoverflow.com/questions/34530628/getting-http-headers-from-tcp-connections", "title": "Getting HTTP headers from TCP Connections", "body": "<p>I was writing a proxifier like app for Linux in golang. The app when executed will listen for all the TCP connections and redirect them to the proxy server address. In between the app also adds a \"Proxy-Authorisation : Basic ...\" header to the HTTP Headers. When I saw the TCP headers I was unable to get the HTTP Headers. Where am I going wrong or How can I extract the HTTP Data? Is there any other way to achieve this?</p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1451482057, "post_id": 34529871, "comment_id": 56802149, "body": "Do you have an error returned by the <code>http.ListenAndServe</code> function ?"}], "answers": [{"tags": [], "owner": {"reputation": 623, "user_id": 5615224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7bea88308ec27975167f216eb8f998e?s=128&d=identicon&r=PG&f=1", "display_name": "sfault", "link": "https://stackoverflow.com/users/5615224/sfault"}, "is_accepted": false, "score": 1, "last_activity_date": 1451482119, "creation_date": 1451482119, "answer_id": 34530498, "question_id": 34529871, "link": "https://stackoverflow.com/questions/34529871/why-does-the-establishment-of-a-websocket-connection-fail-for-this-go-program/34530498#34530498", "title": "Why does the establishment of a websocket connection fail for this Go program?", "body": "<p>The path given for handling is wrong. You have to define the route on which the websocket should connect.</p>\n\n<pre><code>func main() {\n    http.Handle(\"http://192.168.1.137\", websocket.Handler(Echo))\n    http.ListenAndServe(\":4242\", nil)\n}\n</code></pre>\n\n<p>should be</p>\n\n<pre><code>func main() {\n    http.Handle(\"/\", websocket.Handler(Echo))\n    http.ListenAndServe(\":4242\", nil)\n}\n</code></pre>\n\n<p>You can use <a href=\"http://www.websocket.org/echo.html\" rel=\"nofollow\">Websocket.org</a> to test your code.</p>\n"}, {"tags": [], "owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1465240676, "creation_date": 1465240676, "answer_id": 37665242, "question_id": 34529871, "link": "https://stackoverflow.com/questions/34529871/why-does-the-establishment-of-a-websocket-connection-fail-for-this-go-program/37665242#37665242", "title": "Why does the establishment of a websocket connection fail for this Go program?", "body": "<p>He wants to connect to, not to listen.</p>\n\n<pre><code>// you need to make sure this values are correct. and server is listening on \"192.168.1.137:4242\"\norigin := \"http://192.168.1.55/\"\nurl := \"ws://192.168.1.137:4242\"\n\nws, err := websocket.Dial(url, \"\", origin)\nif err != nil {\n    log.Fatal(err)\n}\n\nfor n := 0; n &lt; 10; n++ {\n    msg := \"Hello  \" + strconv.Itoa(n)\n    fmt.Println(\"Sending to client: \" + msg)\n    err := ws.Write([]byte(msg))\n    if err != nil {\n        fmt.Println(\"Can't send\")\n        break\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 818, "user_id": 4238326, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/5j2E9.jpg?s=128&g=1", "display_name": "vanarajcs", "link": "https://stackoverflow.com/users/4238326/vanarajcs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1465240676, "creation_date": 1451479701, "last_edit_date": 1451479953, "question_id": 34529871, "link": "https://stackoverflow.com/questions/34529871/why-does-the-establishment-of-a-websocket-connection-fail-for-this-go-program", "title": "Why does the establishment of a websocket connection fail for this Go program?", "body": "<p>I am using this ip 192.168.1.55. I need to send some data to 192.168.1.137. I am using this code </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n    \"code.google.com/p/go.net/websocket\"\n)\n\nfunc Echo(ws *websocket.Conn) {\n    fmt.Println(\"Echoing\")\n\n    for n := 0; n &lt; 10; n++ {\n        msg := \"Hello  \" + string(n+48)\n        fmt.Println(\"Sending to client: \" + msg)\n        err := websocket.Message.Send(ws, msg)\n        if err != nil {\n            fmt.Println(\"Can't send\")\n            break\n        }\n    }\n}\n\nfunc main() {\n\n    http.Handle(\"http://192.168.1.137\", websocket.Handler(Echo))\n    http.ListenAndServe(\":4242\", nil)\n}\n\nfunc checkError(err error) {\n    if err != nil {\n        fmt.Println(\"Fatal error \", err.Error())\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>But my ip is not connecting to the other ip which i have mentioned above(192.168.1.137). How to fix this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1451477519, "post_id": 34529191, "comment_id": 56799649, "body": "You can create your own marshalable/unmarshalable  UUID type by wrapping the UUID, as seen in this example: <a href=\"http://stackoverflow.com/questions/23695479/format-timestamp-in-outgoing-json-in-golang\" title=\"format timestamp in outgoing json in golang\">stackoverflow.com/questions/23695479/&hellip;</a>"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1451480559, "post_id": 34529191, "comment_id": 56801332, "body": "Which package are you using? If <a href=\"https://godoc.org/code.google.com/p/go-uuid/uuid\" rel=\"nofollow noreferrer\">this one</a> then it already implements <code>json.Marshaler</code> and <code>json.Unmarshaler</code>."}], "answers": [{"tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": false, "score": 0, "last_activity_date": 1451478998, "last_edit_date": 1451478998, "creation_date": 1451478621, "answer_id": 34529609, "question_id": 34529191, "link": "https://stackoverflow.com/questions/34529191/mutating-a-string-on-unmarshal/34529609#34529609", "title": "Mutating a string on Unmarshal", "body": "<p>I'd suggest storing <code>Id</code> as string instead of <code>uuid.UUID</code>. Of course there are workarounds, but if you're not going to hold thousands of <code>Profile</code>s in memory, you shouldn't notice any difference, and you'd be saving time dealing with serialization issues.</p>\n\n<p>If you don't want that, check out the <code>uuid</code> package you're using. Is the underlying type of <code>UUID</code> really a string? If it's something else, like <code>[]byte</code>, just convert your string to <code>[]byte</code> before unmarshaling.</p>\n\n<p>The idiomatic workaround would be what Not_a_Golfer commented under your question.</p>\n"}], "owner": {"reputation": 289, "user_id": 4768715, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/55e2ba38b11b464ad4146a33abbb391d?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Reck", "link": "https://stackoverflow.com/users/4768715/patrick-reck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451478998, "creation_date": 1451476932, "question_id": 34529191, "link": "https://stackoverflow.com/questions/34529191/mutating-a-string-on-unmarshal", "title": "Mutating a string on Unmarshal", "body": "<p>I have a <code>Profile{}</code> struct with an <code>ID</code> property of the type <code>uuid.UUID</code>. When I marshal this, I am converting the <code>UUID</code> to a <code>string</code>, like this:</p>\n\n<pre><code>type Profile struct {\n    Id      uuid.UUID\n}\n\nfunc (profile *Profile) MarshalJSON() ([]byte, error) {\n    type Alias Profile\n    return json.Marshal(&amp;struct {\n        Id string\n        *Alias\n    }{\n        Id:    profile.Id.String(),\n        Alias: (*Alias)(profile),\n    })\n}\n</code></pre>\n\n<p>However, when I want to unmarshal this JSON, it complains that the <code>id</code> is a string. So I need to initialise a <code>UUID</code> struct when unmarshalling, like this: <code>uuid.New([]byte(jsonId))</code></p>\n\n<p>Is this possible to do without altering the <code>UUID</code> implementation, and if so, how?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1102, "user_id": 6336042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/054ea2f04b5592b91f8223796cc53979?s=128&d=identicon&r=PG", "display_name": "Brendon Whateley", "link": "https://stackoverflow.com/users/6336042/brendon-whateley"}, "edited": false, "score": 0, "creation_date": 1588690811, "post_id": 34527672, "comment_id": 108992260, "body": "The &quot;strange number&quot; is the location of the Last &quot;/&quot; in the string. LastIndex returns the *index&quot; in the string of the last occurence of the requested substring."}], "answers": [{"comments": [{"owner": {"reputation": 614, "user_id": 5646242, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-bh4NKS3xkvs/AAAAAAAAAAI/AAAAAAAACAg/kFfVJ0M_MKU/photo.jpg?sz=128", "display_name": "Polinux", "link": "https://stackoverflow.com/users/5646242/polinux"}, "edited": false, "score": 1, "creation_date": 1451471769, "post_id": 34527720, "comment_id": 56796734, "body": "Excellent thanks. Just found it :) Was going to post it here but you were quicker :)"}, {"owner": {"reputation": 554, "user_id": 959690, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ee49b660d509b673056d960779061d17?s=128&d=identicon&r=PG", "display_name": "user959690", "link": "https://stackoverflow.com/users/959690/user959690"}, "edited": false, "score": 1, "creation_date": 1544576599, "post_id": 34527720, "comment_id": 94322811, "body": "Found this doesn&#39;t work if your Go server is on Linux and your browser is Edge on Windows. It won&#39;t strip Windows paths when the server is on Linux :("}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 86, "last_activity_date": 1451471586, "creation_date": 1451471586, "answer_id": 34527720, "question_id": 34527672, "link": "https://stackoverflow.com/questions/34527672/remove-path-from-filename/34527720#34527720", "title": "Remove path from filename", "body": "<p>The number is the index of the last slash in the string. If you want to get the file's base name, use <a href=\"https://golang.org/pkg/path/filepath/#Base\" rel=\"noreferrer\"><code>filepath.Base</code></a>:</p>\n\n<pre><code>path := \"/some/path/to/remove/file.name\"\nfile := filepath.Base(path)\nfmt.Println(file)\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/DzlCV-HC-r\" rel=\"noreferrer\">http://play.golang.org/p/DzlCV-HC-r</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 161, "user_id": 1475184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f4fa7b506ab7c0188be7bca0956ec1c?s=128&d=identicon&r=PG", "display_name": "user1475184", "link": "https://stackoverflow.com/users/1475184/user1475184"}, "edited": false, "score": 1, "creation_date": 1529034291, "post_id": 50868812, "comment_id": 88739435, "body": "Playground: <a href=\"https://play.golang.org/p/uUthOtpkSAz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uUthOtpkSAz</a>"}, {"owner": {"reputation": 3934, "user_id": 916440, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c3f3495133a7d9411b0b4c04189ecf91?s=128&d=identicon&r=PG", "display_name": "Kamil Dziedzic", "link": "https://stackoverflow.com/users/916440/kamil-dziedzic"}, "edited": false, "score": 1, "creation_date": 1531493690, "post_id": 50868812, "comment_id": 89631059, "body": "This is actually a proper answer as filepath.Base(&quot;/&quot;) will give you &quot;/&quot; (root path) and filepath.Base(&quot;&quot;) will give you &quot;.&quot; so current directory. Returned file in filepath.Split() for both cases will be empty string."}, {"owner": {"reputation": 554, "user_id": 959690, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ee49b660d509b673056d960779061d17?s=128&d=identicon&r=PG", "display_name": "user959690", "link": "https://stackoverflow.com/users/959690/user959690"}, "edited": false, "score": 1, "creation_date": 1544576819, "post_id": 50868812, "comment_id": 94322858, "body": "This also fails if your browser is on a different OS than your server. If the browser sends Windows directory and your server is on Linux this fails. :("}], "tags": [], "owner": {"reputation": 161, "user_id": 1475184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f4fa7b506ab7c0188be7bca0956ec1c?s=128&d=identicon&r=PG", "display_name": "user1475184", "link": "https://stackoverflow.com/users/1475184/user1475184"}, "is_accepted": false, "score": 16, "last_activity_date": 1586610843, "last_edit_date": 1586610843, "creation_date": 1529034242, "answer_id": 50868812, "question_id": 34527672, "link": "https://stackoverflow.com/questions/34527672/remove-path-from-filename/50868812#50868812", "title": "Remove path from filename", "body": "<p><b>You can try it in the <a href=\"https://play.golang.org/p/G0kJUazYNH9\" rel=\"noreferrer\">playground</a>!</b><br/></p>\n\n<pre><code>dir, file := filepath.Split(\"/some/path/to/remove/file.name\")\nfmt.Println(\"Dir:\", dir)   //Dir: /some/path/to/remove/\nfmt.Println(\"File:\", file) //File: file.name\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3439, "user_id": 1887281, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/xV9qF.jpg?s=128&g=1", "display_name": "devinbost", "link": "https://stackoverflow.com/users/1887281/devinbost"}, "is_accepted": false, "score": 2, "last_activity_date": 1567537801, "creation_date": 1567537801, "answer_id": 57777485, "question_id": 34527672, "link": "https://stackoverflow.com/questions/34527672/remove-path-from-filename/57777485#57777485", "title": "Remove path from filename", "body": "<p>If you want the base path without the fileName, you can use Dir, which is documented here: <a href=\"https://golang.org/pkg/path/filepath/#Dir\" rel=\"nofollow noreferrer\">https://golang.org/pkg/path/filepath/#Dir</a></p>\n\n<p>Quoting part of their documentation:</p>\n\n<blockquote>\n  <p>Dir returns all but the last element of path, typically the path's directory. After dropping the final element, Dir calls Clean on the path and trailing slashes are removed.</p>\n</blockquote>\n\n<p>Also from their documentation, running this code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"path/filepath\"\n)\n\nfunc main() {\n    fmt.Println(\"On Unix:\")\n    fmt.Println(filepath.Dir(\"/foo/bar/baz.js\"))\n    fmt.Println(filepath.Dir(\"/foo/bar/baz\"))\n    fmt.Println(filepath.Dir(\"/foo/bar/baz/\"))\n    fmt.Println(filepath.Dir(\"/dirty//path///\"))\n    fmt.Println(filepath.Dir(\"dev.txt\"))\n    fmt.Println(filepath.Dir(\"../todo.txt\"))\n    fmt.Println(filepath.Dir(\"..\"))\n    fmt.Println(filepath.Dir(\".\"))\n    fmt.Println(filepath.Dir(\"/\"))\n    fmt.Println(filepath.Dir(\"\"))\n\n}\n</code></pre>\n\n<p>will give you this output:</p>\n\n<blockquote>\n  <p>On Unix:\n  /foo/bar\n  /foo/bar\n  /foo/bar/baz\n  /dirty/path\n  .\n  ..\n  .\n  .\n  /\n  .</p>\n</blockquote>\n\n<p>Try it yourself here:</p>\n\n<p><a href=\"https://play.golang.org/p/huk3EmORFw5\" rel=\"nofollow noreferrer\">https://play.golang.org/p/huk3EmORFw5</a></p>\n\n<p>If you instead want to get the fileName without the base path, @Ainar-G has sufficiently answered that. </p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1617321892, "creation_date": 1617321892, "answer_id": 66912941, "question_id": 34527672, "link": "https://stackoverflow.com/questions/34527672/remove-path-from-filename/66912941#66912941", "title": "Remove path from filename", "body": "<p>Another option:</p>\n<pre><code>package main\nimport &quot;path&quot;\n\nfunc main() {\n   line := &quot;/some/path/to/remove/file.name&quot;\n   line = path.Base(line)\n   println(line == &quot;file.name&quot;)\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/path#Base\" rel=\"nofollow noreferrer\">https://golang.org/pkg/path#Base</a></p>\n"}], "owner": {"reputation": 614, "user_id": 5646242, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-bh4NKS3xkvs/AAAAAAAAAAI/AAAAAAAACAg/kFfVJ0M_MKU/photo.jpg?sz=128", "display_name": "Polinux", "link": "https://stackoverflow.com/users/5646242/polinux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38726, "favorite_count": 4, "answer_count": 4, "score": 41, "last_activity_date": 1617321892, "creation_date": 1451471381, "question_id": 34527672, "link": "https://stackoverflow.com/questions/34527672/remove-path-from-filename", "title": "Remove path from filename", "body": "<p>I have trivial question. </p>\n\n<p>I have string which contains a filename and it's path. How can i remove whole path? I have tried those:</p>\n\n<pre><code>line = \"/some/path/to/remove/file.name\"\nline := strings.LastIndex(line, \"/\")\nfmt.Println(line)\n</code></pre>\n\n<p>It prints some strange number:</p>\n\n<pre><code>38\n</code></pre>\n\n<p>I need it without last slash</p>\n\n<p>Thanks a lot</p>\n"}, {"tags": ["javascript", "cordova", "go"], "comments": [{"owner": {"reputation": 4558, "user_id": 1156668, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/6a0298cea3c87abbcd39833825e273f9?s=128&d=identicon&r=PG", "display_name": "ED-209", "link": "https://stackoverflow.com/users/1156668/ed-209"}, "edited": false, "score": 1, "creation_date": 1451473050, "post_id": 34527646, "comment_id": 56797365, "body": "I think if you&#39;ve only got the www folder then you&#39;re stuck with having to manually go through the code and see what plugins it requires."}, {"owner": {"reputation": 45440, "user_id": 1351469, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d0a659b0aa7c7dfc45ab9cff52f3c140?s=128&d=identicon&r=PG", "display_name": "jcesarmobile", "link": "https://stackoverflow.com/users/1351469/jcesarmobile"}, "edited": false, "score": 0, "creation_date": 1452250670, "post_id": 34527646, "comment_id": 57095606, "body": "they should have provided the config.xml too, and have the plugins there"}, {"owner": {"reputation": 421, "user_id": 2873262, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f8b8419c1469cda8acef2c3a8546d4e?s=128&d=identicon&r=PG&f=1", "display_name": "Sunil", "link": "https://stackoverflow.com/users/2873262/sunil"}, "edited": false, "score": 0, "creation_date": 1453370431, "post_id": 34527646, "comment_id": 57574928, "body": "Well, I was unaware of node-webkit. Building was easy and I didn&#39;t have to worry about adding plugins. This could have been a great suggestion back then."}], "owner": {"reputation": 421, "user_id": 2873262, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f8b8419c1469cda8acef2c3a8546d4e?s=128&d=identicon&r=PG&f=1", "display_name": "Sunil", "link": "https://stackoverflow.com/users/2873262/sunil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1451471292, "creation_date": 1451471292, "question_id": 34527646, "link": "https://stackoverflow.com/questions/34527646/fetching-all-cordova-plugins-used-in-the-project", "title": "Fetching all Cordova plugins used in the project", "body": "<p>I recently had to build legacy code in cordova and they provided only www folder. Is there a way to add all the plugins used in the project like \"go get\" command in Go? It would be a lot easier to build the code if some tools were available.</p>\n"}, {"tags": ["heroku", "go"], "answers": [{"comments": [{"owner": {"reputation": 713, "user_id": 1440666, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OKlp9.jpg?s=128&g=1", "display_name": "Kevin LE GOFF", "link": "https://stackoverflow.com/users/1440666/kevin-le-goff"}, "edited": false, "score": 0, "creation_date": 1451509024, "post_id": 34536539, "comment_id": 56816176, "body": "If I use godep save -r  then the Godeps.json become { \t&quot;ImportPath&quot;: &quot;.&quot;, \t&quot;GoVersion&quot;: &quot;go1.5&quot;, \t&quot;Deps&quot;: [] }   And deployement to heroku does not work anymore. I am a bit in the flu regarding the godep behavior"}, {"owner": {"reputation": 1351, "user_id": 879047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee933b5bf986de605ee48c1ae3e3f7ee?s=128&d=identicon&r=PG", "display_name": "Duru Can Celasun", "link": "https://stackoverflow.com/users/879047/duru-can-celasun"}, "reply_to_user": {"reputation": 713, "user_id": 1440666, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OKlp9.jpg?s=128&g=1", "display_name": "Kevin LE GOFF", "link": "https://stackoverflow.com/users/1440666/kevin-le-goff"}, "edited": false, "score": 0, "creation_date": 1451593077, "post_id": 34536539, "comment_id": 56844825, "body": "Where is your <code>main.go</code> located? In which directory are you running <code>godep save</code>?"}, {"owner": {"reputation": 713, "user_id": 1440666, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OKlp9.jpg?s=128&g=1", "display_name": "Kevin LE GOFF", "link": "https://stackoverflow.com/users/1440666/kevin-le-goff"}, "edited": false, "score": 0, "creation_date": 1451645293, "post_id": 34536539, "comment_id": 56853646, "body": "My main.go is located in the trendee/api/src/github.com/kevinlg/trendee-api/ I run godep save from trendee-api (GOPATH) the root of my workspace."}, {"owner": {"reputation": 1351, "user_id": 879047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee933b5bf986de605ee48c1ae3e3f7ee?s=128&d=identicon&r=PG", "display_name": "Duru Can Celasun", "link": "https://stackoverflow.com/users/879047/duru-can-celasun"}, "reply_to_user": {"reputation": 713, "user_id": 1440666, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OKlp9.jpg?s=128&g=1", "display_name": "Kevin LE GOFF", "link": "https://stackoverflow.com/users/1440666/kevin-le-goff"}, "edited": false, "score": 1, "creation_date": 1451652987, "post_id": 34536539, "comment_id": 56855378, "body": "That&#39;s your problem. You need to run it from inside <code>trendee&#47;api&#47;src&#47;github.com&#47;kevinlg&#47;trendee-api&#47;</code>."}, {"owner": {"reputation": 713, "user_id": 1440666, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OKlp9.jpg?s=128&g=1", "display_name": "Kevin LE GOFF", "link": "https://stackoverflow.com/users/1440666/kevin-le-goff"}, "edited": false, "score": 0, "creation_date": 1451658763, "post_id": 34536539, "comment_id": 56856920, "body": "Yes I am going to try it I have checked the herkou example again. I forgot the ./.... in the go get command. So I did not see the full structure of the example before. Now that I see it it appear clear to me. But I am not a really big fan of having the Godeps file member of the /src/."}, {"owner": {"reputation": 713, "user_id": 1440666, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OKlp9.jpg?s=128&g=1", "display_name": "Kevin LE GOFF", "link": "https://stackoverflow.com/users/1440666/kevin-le-goff"}, "edited": false, "score": 0, "creation_date": 1451687648, "post_id": 34536539, "comment_id": 56864982, "body": "Thanks for putting me on the good path. I had one problems I was not executing the godep save command from the good folder you need to execute in the $GOPATH/src/github.com/username/your_project Second one I forgot to add  the ./... go get command when I tried the heroku tutorial. I will put a medium post together about how to use godep with heroku. I will insist on where to execute each commande and why."}], "tags": [], "owner": {"reputation": 1351, "user_id": 879047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee933b5bf986de605ee48c1ae3e3f7ee?s=128&d=identicon&r=PG", "display_name": "Duru Can Celasun", "link": "https://stackoverflow.com/users/879047/duru-can-celasun"}, "is_accepted": true, "score": 1, "last_activity_date": 1451506192, "creation_date": 1451506192, "answer_id": 34536539, "question_id": 34526431, "link": "https://stackoverflow.com/questions/34526431/is-my-godeps-json-correctly-generated/34536539#34536539", "title": "Is my Godeps.json correctly generated?", "body": "<p>When you use <code>godep save -r ./...</code> you are saving <a href=\"https://github.com/tools/godep#multiple-packages\" rel=\"nofollow\">multiple packages</a>, which is why your <code>Godeps.json</code> looks like that.</p>\n\n<p>For a single binary, you could also use <code>godep save -r</code> in the <code>$GOPATH/src/github.com/kevinlg/trendee-api</code> directory, given the following structure:</p>\n\n<p><code>trendee-api /(GOPATH)\n   bin/\n   Godeps/\n   pkg/\n   src/\n     github.com/\n      kevinlg/\n        trendee-api/\n            main.go\n</code></p>\n"}, {"comments": [{"owner": {"reputation": 15, "user_id": 5073502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc35b22b38c6dd3e12d49a78ded8ccd7?s=128&d=identicon&r=PG&f=1", "display_name": "Mehran", "link": "https://stackoverflow.com/users/5073502/mehran"}, "edited": false, "score": 0, "creation_date": 1451550781, "post_id": 34542854, "comment_id": 56828599, "body": "I checked my own &quot;Godeps.json&quot; file  and the diff between mine and yours is just at the &#39; &quot;ImportPath&quot;: &#39; at the top of the file. I can suggest you to try the heroku&#39;s support ."}], "tags": [], "owner": {"reputation": 15, "user_id": 5073502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc35b22b38c6dd3e12d49a78ded8ccd7?s=128&d=identicon&r=PG&f=1", "display_name": "Mehran", "link": "https://stackoverflow.com/users/5073502/mehran"}, "is_accepted": false, "score": 1, "last_activity_date": 1451549980, "last_edit_date": 1451549980, "creation_date": 1451547131, "answer_id": 34542854, "question_id": 34526431, "link": "https://stackoverflow.com/questions/34526431/is-my-godeps-json-correctly-generated/34542854#34542854", "title": "Is my Godeps.json correctly generated?", "body": "<p>I'm new to go and I had problem with Godeps too.\nwhy you are using \"go install \".\ntry using this link,\n<a href=\"https://devcenter.heroku.com/articles/go-dependencies-via-godep\" rel=\"nofollow\">this is the heroku's website teaching about Godeps</a></p>\n\n<p>and actually you can use <code>godep help save\n</code> in command line to learn more about \"godep save\" </p>\n"}], "owner": {"reputation": 713, "user_id": 1440666, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OKlp9.jpg?s=128&g=1", "display_name": "Kevin LE GOFF", "link": "https://stackoverflow.com/users/1440666/kevin-le-goff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 34536539, "answer_count": 2, "score": 0, "last_activity_date": 1451549980, "creation_date": 1451467049, "last_edit_date": 1451491664, "question_id": 34526431, "link": "https://stackoverflow.com/questions/34526431/is-my-godeps-json-correctly-generated", "title": "Is my Godeps.json correctly generated?", "body": "<p>I am trying to deploy a simple go lang server on heroku.I have managed to get it running. But I am wondering if my utilisation of godep is proper.</p>\n\n<p>Here is the Godeps.json I have produced.</p>\n\n<pre><code>{\n    \"ImportPath\": \".\",\n    \"GoVersion\": \"go1.5\",\n    \"Packages\": [\n        \"./...\"\n    ],\n    \"Deps\": [\n        {\n            \"ImportPath\": \"github.com/kevinlg/trendee-api\",\n            \"Rev\": \"6acde53081a273d4caedf113688e1ab83854c877\"\n        }\n    ]\n}\n</code></pre>\n\n<p>I am wondering why \"ImportPath\":\".\" and not github.com/kevinlg/trendee-api instead of having it as a dependency ?</p>\n\n<p>When I check the Heroku example or the Godeps.json for godep I can see</p>\n\n<p>\"ImportPath\": \"github.com/heroku/go-getting-started\",</p>\n\n<p>or </p>\n\n<p>\"ImportPath\": \"github.com/tools/godep</p>\n\n<p>I have been able to get the server running and deployed on heroku.</p>\n\n<p>Here is my project folder structure</p>\n\n<pre><code>trendee-api /(GOPATH)\n   bin/\n   Godeps/\n   pkg/\n   src/\n     github.com/\n      kevinlg/\n        trendee-api/\n</code></pre>\n\n<p>I have used the following commands. </p>\n\n<pre><code>godep save -r ./...\ngo install github.com/kevinlg/trendee-api\n</code></pre>\n\n<p>Thanks in advance for the help</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": true, "score": 1, "last_activity_date": 1451464472, "last_edit_date": 1451464472, "creation_date": 1451458516, "answer_id": 34524488, "question_id": 34523745, "link": "https://stackoverflow.com/questions/34523745/how-can-i-add-funcmaps-to-already-parsed-templates-in-golang/34524488#34524488", "title": "How can I add FuncMaps to already parsed templates in golang", "body": "<p>So I figured it out, but I'll leave this answer here as it seems to not be answered anywhere, basically I can define a redundant <code>FuncMap</code> that mimics the one I will be using with the sessions, and just return them blank, I can then overwrite them with the <code>FuncMap</code> from my <code>view</code> function (visible in the question post) like this:</p>\n\n<pre><code>var templates = template.New(\"template\").Funcs(template.FuncMap{\n    \"authenticated\": func() bool {\n        log.Println(\"Was I called?\")\n        return false\n    },\n    \"username\": func() string {\n        return \"\"\n    },\n})\n</code></pre>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 574, "favorite_count": 0, "accepted_answer_id": 34524488, "answer_count": 1, "score": 1, "last_activity_date": 1451464472, "creation_date": 1451454929, "question_id": 34523745, "link": "https://stackoverflow.com/questions/34523745/how-can-i-add-funcmaps-to-already-parsed-templates-in-golang", "title": "How can I add FuncMaps to already parsed templates in golang", "body": "<p>I have my templates which are initially parsed on the app launch (obviously for speed reasons like this)</p>\n\n<pre><code>var templates = template.New(\"template\")\n\nfilepath.Walk(\"views\", func(path string, info os.FileInfo, err error) error {\n        if strings.HasSuffix(path, \".html\") {\n            templates.ParseFiles(path)\n        }\n\n        return nil\n})\nlog.Println(\"Templates Parsed\")\n</code></pre>\n\n<p>Then I have my funcmaps which get added in their own function (because I need the request object so I can get their session data like so)</p>\n\n<pre><code>func View(w http.ResponseWriter, r *http.Request, tmplN string, data interface{}) {\n\n    tmpl := templates.Funcs(template.FuncMap{\n        \"username\": func() string {\n            session := Sesh(r)\n            username := \"\"\n            if session.Values[\"username\"] != nil {\n                username = session.Values[\"username\"].(string)\n            }\n            return username\n        },\n        \"authenticated\": func() bool {\n            session := Sesh(r)\n            authenticated := false\n            if session.Values[\"authenticated\"] != nil {\n                authenticated = session.Values[\"authenticated\"].(bool)\n            }\n            return authenticated\n        },\n    })\n\n    err := tmpl.ExecuteTemplate(w, tmplN, data)\n    if err != nil {\n        log.Println(\"Error \" + err.Error())\n    }\n}\n</code></pre>\n\n<p>But it seems like if I don't put the <code>Funcs</code> call before the parsing of the templates it doesn't work, e.g. if I try to use in my <code>register</code> template like so:</p>\n\n<pre><code>{{ define \"register\" }}\n    {{ template \"_header\" .}}\n\n       {{ if authenticated }}\n           // Call FuncMap function\n       {{ end }}\n&lt;br/&gt;\n&lt;br/&gt;\n&lt;br/&gt;\n&lt;div class=\"row align-center\"&gt;\n    &lt;div class=\"large-4 columns text-center\"&gt;\n        &lt;div id=\"RegistrationFormComponent\"&gt;&lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n    {{ template \"_footer\" .}}\n{{ end }}\n</code></pre>\n\n<p>I get an error that \"register\" does not exist because the function <code>authenticated</code> throws an error when it's trying to parse it. Any information on how I can get this to work as intended would be great thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1451455610, "post_id": 34523627, "comment_id": 56789265, "body": "What do you mean &quot;fmt.Printf() prints nothing&quot;?"}, {"owner": {"reputation": 13, "user_id": 3860160, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000986080895/picture?type=large", "display_name": "Sitaram Shelke", "link": "https://stackoverflow.com/users/3860160/sitaram-shelke"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1451622303, "post_id": 34523627, "comment_id": 56849815, "body": "I am sorry everyone but I just found out that I have a different issue going on. When I make changes in handlers/users.go or any files in handlers/ those changes are not being reflected when I run main.go ($&gt; go run main.go). [ For example I just removed a bracket and left a function open,&#39; go run main.go &#39; doesn&#39;t show any error. ]  and That&#39;s why when I added a print statement, it is not printing anything. Any idea what is going on? Your help is really appreciated."}, {"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1451641267, "post_id": 34523627, "comment_id": 56852814, "body": "In general don&#39;t use <code>go run</code>. Use <code>go build</code> and then run the resulting binary. <code>go run</code> does not typically follow the principal of least astonishment."}, {"owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "edited": false, "score": 0, "creation_date": 1533960234, "post_id": 34523627, "comment_id": 90549891, "body": "Either editing the wrong file, or the request didn&#39;t trigger the <code>Printf()</code> at all (e.g due to http method used). And, <code>go run</code> and <code>go build</code> make no difference in such case I guess."}], "answers": [{"tags": [], "owner": {"reputation": 9371, "user_id": 196964, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/df6zG.jpg?s=128&g=1", "display_name": "Doug Richardson", "link": "https://stackoverflow.com/users/196964/doug-richardson"}, "is_accepted": false, "score": 4, "last_activity_date": 1451455591, "creation_date": 1451455591, "answer_id": 34523858, "question_id": 34523627, "link": "https://stackoverflow.com/questions/34523627/printf-not-working-in-http-handler-in-golang/34523858#34523858", "title": "Printf not working in http handler in golang", "body": "<p>I just tested your code and I saw the following printed to the console:</p>\n\n<pre><code>In AppPostSignup\n</code></pre>\n\n<p>My guess is that you tried to test your <code>/app/signup</code> endpoint using a <strong>GET</strong> request, when you have it marked only as a <strong>POST</strong> request.</p>\n\n<p>If you really want it to be a <strong>POST</strong> request, then you can test it with curl like so:</p>\n\n<pre><code>curl -X POST localhost:8888/app/signup\n</code></pre>\n\n<p>Note, that request is missing a valid body, but you will be able to see your message printed.</p>\n"}], "owner": {"reputation": 13, "user_id": 3860160, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000986080895/picture?type=large", "display_name": "Sitaram Shelke", "link": "https://stackoverflow.com/users/3860160/sitaram-shelke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1423, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451455732, "creation_date": 1451454315, "last_edit_date": 1592644375, "question_id": 34523627, "link": "https://stackoverflow.com/questions/34523627/printf-not-working-in-http-handler-in-golang", "title": "Printf not working in http handler in golang", "body": "<p>I am trying to write a web server using <a href=\"https://github.com/go-bootstrap/go-bootstrap\" rel=\"nofollow noreferrer\">Go-bootstrap library</a> and I have written my own handler in handler/users which is called on a post request on\nlocalhost/app/signup. I am trying to print the json data to the terminal but fmt.Printf() prints nothing. The files are as follows:</p>\n<h3>In handler/users</h3>\n<pre><code>func AppPostSignup(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;)\n    fmt.Println(&quot;In AppPostSignup&quot;)\n    data := map[string]interface{}{}\n    body, _ := ioutil.ReadAll(r.Body)\n    json.Unmarshal(body, &amp;data)\n    db := context.Get(r, &quot;db&quot;).(*sqlx.DB)\n    email := data[&quot;Email&quot;]\n    password := data[&quot;Password&quot;]\n    passwordAgain := data[&quot;PasswordAgain&quot;]\n    fmt.Printf(&quot;\\ntype : %T\\nData: %v&quot;, email, email)\n    _, err := dal.NewUser(db).Signup(nil, email.(string), password.(string), passwordAgain.(string))\n    if err != nil {\n        libhttp.HandleErrorJson(w, err)\n        return\n    }\n}\n</code></pre>\n<h3>In main.go</h3>\n<pre><code>router.Handle(&quot;/&quot;, MustLogin(http.HandlerFunc(handlers.GetHome))).Methods(&quot;GET&quot;)\n\nrouter.HandleFunc(&quot;/signup&quot;, handlers.GetSignup).Methods(&quot;GET&quot;)\nrouter.HandleFunc(&quot;/signup&quot;, handlers.PostSignup).Methods(&quot;POST&quot;)\nrouter.HandleFunc(&quot;/login&quot;, handlers.GetLogin).Methods(&quot;GET&quot;)\nrouter.HandleFunc(&quot;/login&quot;, handlers.PostLogin).Methods(&quot;POST&quot;)\nrouter.HandleFunc(&quot;/app/signup&quot;, handlers.AppPostSignup).Methods(&quot;POST&quot;)\nrouter.HandleFunc(&quot;/authenticate&quot;, handlers.Authenticate).Methods(&quot;POST&quot;)\nrouter.HandleFunc(&quot;/logout&quot;, handlers.GetLogout).Methods(&quot;GET&quot;)\n</code></pre>\n<p>What did I do wrong?</p>\n"}, {"tags": ["pointers", "struct", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 12, "last_activity_date": 1451442178, "last_edit_date": 1451442178, "creation_date": 1451435375, "answer_id": 34521276, "question_id": 34521255, "link": "https://stackoverflow.com/questions/34521255/getting-different-values-by-passing-pointers-to-a-function-in-go/34521276#34521276", "title": "Getting different values by passing Pointers to a function in Go", "body": "<p>Because this line:</p>\n\n<pre><code>p = &amp;Test{4}\n</code></pre>\n\n<p>Just assigns a new pointer value to the <code>p</code> variable. Inside the <code>f()</code> function, <code>p</code> is just a local variable. By assigning any new value to <code>p</code>, you are just changing the value of the local variable and <strong>not</strong> the pointed value.</p>\n\n<p>The <code>p</code> local variable in <code>f()</code> has nothing to do with the <code>p</code> local variable in <code>main()</code>. If you change <code>p</code> in <code>f()</code>, it will not change <code>p</code> in <code>main()</code> (and it won't change the pointed struct value either).</p>\n\n<p>In your second example:</p>\n\n<pre><code>p.Value = 4\n</code></pre>\n\n<p>It is a shorthand for:</p>\n\n<pre><code>(*p).Value = 4\n</code></pre>\n\n<p>This changes the <em>pointed</em> value, hence you will observe the change when <code>f()</code> returns.</p>\n\n<p><strong>Note:</strong></p>\n\n<p>Just as a side note, if in your <code>main()</code> function you would pass the address of <code>p</code> (the local variable in <code>main()</code> which is a pointer) to function <code>f()</code>, you could modify the address stored in main's <code>p</code>:</p>\n\n<pre><code>func f(p **Test) {\n    *p = &amp;Test{4}\n}\n</code></pre>\n\n<p>And from <code>main()</code>, call it like:</p>\n\n<pre><code>var i Test = Test{2}\nvar p *Test = &amp;i\nf(&amp;p)\nprintln(i.Value) // 2 - Note that 'i' won't change!\nprintln(p.Value) // 4 - Only the address in 'p' to the new struct value created in f()\n</code></pre>\n\n<p>But obviously passing a single pointer <code>*Test</code> and modifying the pointed value (<code>p.Value = 4</code>) is more efficient, much more convenient and much cleaner.</p>\n"}], "owner": {"reputation": 5634, "user_id": 2517730, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Xojng.jpg?s=128&g=1", "display_name": "Yar", "link": "https://stackoverflow.com/users/2517730/yar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 1, "accepted_answer_id": 34521276, "answer_count": 1, "score": 6, "last_activity_date": 1451442178, "creation_date": 1451435196, "question_id": 34521255, "link": "https://stackoverflow.com/questions/34521255/getting-different-values-by-passing-pointers-to-a-function-in-go", "title": "Getting different values by passing Pointers to a function in Go", "body": "<p>Say I want to pass a pointer to a function and change the value of a struct which that pointer points to by doing so. I would normally do this by dereferencing the pointer: </p>\n\n<pre><code>type Test struct { Value int}\nfunc main() {\n   var i Test = Test {2}\n   var p *Test = &amp;i\n   f(p)\n   println(i.Value)  // 4\n}\nfunc f(p *Test) {\n   *p = Test{4}\n}\n</code></pre>\n\n<p>My question is, why this code doesn't change the value</p>\n\n<pre><code>type Test struct { Value int}\nfunc main() {\n   var i Test = Test {2}\n   var p *Test = &amp;i\n   f(p)\n   println(i.Value)  // 2\n}\nfunc f(p *Test) {\n   // ?\n   p = &amp;Test{4}\n}\n</code></pre>\n\n<p>while this one does:</p>\n\n<pre><code>type Test struct { Value int}\nfunc main() {\n   var i Test = Test {2}\n   var p *Test = &amp;i\n   f(p)\n   println(i.Value)  // 4\n}\nfunc f(p *Test) {\n   p.Value = 4\n}\n</code></pre>\n"}, {"tags": ["go", "irc"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1451434812, "post_id": 34521095, "comment_id": 56783903, "body": "You need to unquote the input.  The function <a href=\"https://godoc.org/strconv#Unquote\" rel=\"nofollow noreferrer\">godoc.org/strconv#Unquote</a> might be helpful."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1451435834, "post_id": 34521095, "comment_id": 56784165, "body": "Related / possible duplicate of <a href=\"http://stackoverflow.com/questions/34126749/convert-unicode-code-point-to-literal-character-in-go\">Convert unicode code point to literal character in Go</a>"}], "answers": [{"tags": [], "owner": {"reputation": 467, "user_id": 5554217, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YgP56FPsPcs/AAAAAAAAAAI/AAAAAAAAANU/0r8m2DSz-to/photo.jpg?sz=128", "display_name": "James Wallen-Jones", "link": "https://stackoverflow.com/users/5554217/james-wallen-jones"}, "is_accepted": true, "score": 0, "last_activity_date": 1451795692, "last_edit_date": 1451795692, "creation_date": 1451472758, "answer_id": 34528039, "question_id": 34521095, "link": "https://stackoverflow.com/questions/34521095/unicode-being-output-literally-instead-of-as-unicode/34528039#34528039", "title": "unicode being output literally instead of as unicode", "body": "<p>I needed to use <code>strconv.Unquote()</code> on my return in the function.</p>\n\n<p>The new generateString function now outputs the correct string and looks like this</p>\n\n<pre><code>func generateString(show Show) string {\n  str := os.Getenv(\"SHOWSTRING\")\n  r := strings.NewReplacer(\n    \"#ID#\", string(show.ID),\n    \"#showname#\", show.Name,\n    \"#status#\", show.Status,\n    \"#network.name#\", show.Network.Name,\n  )\n  result := r.Replace(str)\n  ret, err := strconv.Unquote(`\"` + result + `\"`)\n  if err != nil {\n    fmt.Println(\"Error unquoting the string\")\n  }\n  return ret\n}\n</code></pre>\n"}], "owner": {"reputation": 467, "user_id": 5554217, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YgP56FPsPcs/AAAAAAAAAAI/AAAAAAAAANU/0r8m2DSz-to/photo.jpg?sz=128", "display_name": "James Wallen-Jones", "link": "https://stackoverflow.com/users/5554217/james-wallen-jones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 34528039, "answer_count": 1, "score": 0, "last_activity_date": 1451795692, "creation_date": 1451433989, "last_edit_date": 1451795028, "question_id": 34521095, "link": "https://stackoverflow.com/questions/34521095/unicode-being-output-literally-instead-of-as-unicode", "title": "unicode being output literally instead of as unicode", "body": "<p>I am creating an IRC bot using Go as a first project to get to grips with the language.  One of the bot functions is to grab data from the TVmaze API and display in the channel.</p>\n\n<p>I have imported an env package which allows the bot admin to define how the output is displayed.</p>\n\n<p>For example <code>SHOWSTRING=\"#showname# - #status# \u2013 #network.name#\"</code></p>\n\n<p>I am trying to add functionality to it so that the admin can use IRC formatting functionality which is accessed with <code>\\u0002 this is bold \\u0002</code> for example.</p>\n\n<p>I have a function which generates the string that is being returned and displayed in the channel.</p>\n\n<pre><code>func generateString(show Show) string {\n  str := os.Getenv(\"SHOWSTRING\")\n  r := strings.NewReplacer(\n    \"#ID#\", string(show.ID),\n    \"#showname#\", show.Name,\n    \"#status#\", show.Status,\n    \"#network.name#\", show.Network.Name,\n  )\n  result := r.Replace(str)\n  return result\n}\n</code></pre>\n\n<p>From what i have read i think that i need to use the <code>rune</code> datatype instead of string and then converting the runes into a string before being output. </p>\n\n<p>I am using the <a href=\"https://github.com/thoj/go-irceven\" rel=\"nofollow\">https://github.com/thoj/go-irceven</a> package for interacting with IRC.</p>\n\n<p>Although i think that using <code>rune</code> is the correct way to go, i have tried a few things that have confused me.</p>\n\n<p>If i add <code>\\u0002</code> to the SHOWSTRING from the env, it returns <code>\\u0002House\\u0002 - Ended - Fox</code>. I am doing this by <code>con.Privmsg(roomName, tvmaze.ShowLookup('house'))</code></p>\n\n<p>However if i try <code>con.Privmsg(roomName, \"\\u0002This should be bold\\u0002\")</code> it outputs bold text.</p>\n\n<p>What is the best option here? If it is converting the string into runes and then back to a string, how do i go about doing that?</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1451425659, "creation_date": 1451425659, "answer_id": 34519592, "question_id": 34519546, "link": "https://stackoverflow.com/questions/34519546/all-go-routines-are-asleep-deadlock/34519592#34519592", "title": "all go routines are asleep - deadlock", "body": "<p>You never close the \"truck\" channel <code>ch</code>, so <code>UnloadTrucks</code> never returns.</p>\n\n<p>You can close the channel after all workers are done, by using a WaitGroup:</p>\n\n<pre><code>go func() {\n    wg.Wait()\n    close(ch)\n}()\nUnloadTrucks(ch)\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/1V7UbYpsQr\" rel=\"noreferrer\">http://play.golang.org/p/1V7UbYpsQr</a></p>\n"}], "owner": {"reputation": 1768, "user_id": 899671, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/EPYny.jpg?s=128&g=1", "display_name": "Michael Draper", "link": "https://stackoverflow.com/users/899671/michael-draper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 34519592, "answer_count": 1, "score": 2, "last_activity_date": 1451608023, "creation_date": 1451425394, "last_edit_date": 1451608023, "question_id": 34519546, "link": "https://stackoverflow.com/questions/34519546/all-go-routines-are-asleep-deadlock", "title": "all go routines are asleep - deadlock", "body": "<p>I don't understand why the deadlock is occurring in this code. I've tried several different things to get the deadlock to stop (several different versions using WorkGroup). This is my first day in Go, and I am pretty disappointed so far with the complexity of fairly simple and straightforward operations. I feel like I'm missing something big and obvious, but all of the docs I have found on this are seemingly very different from what, to me, is a very basic mode of operation. All of the docs use primitive types for channels (int, string) not more complex types, all with very basic for loops OR on they are on the other end of the spectrum where the functions are fairly complicated orchestrations.</p>\n\n<p>I guess I'm really looking for a middle of the road sample of \"this is how it's usually done\" with goroutines.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n//import \"sync\"\nimport \"time\"\n\ntype Item struct {\n    name string\n}\n\ntype Truck struct {\n    Cargo []Item\n    name  string\n}\n\nfunc UnloadTrucks(c chan Truck) {\n\n    for t := range c {\n        fmt.Printf(\"%s has %d items in cargo: %s\\n\", t.name, len(t.Cargo), t.Cargo[0].name)\n    }\n\n}\n\nfunc main() {\n    trucks := make([]Truck, 2)\n\n    ch := make(chan Truck)\n\n    for i, _ := range trucks {\n\n        trucks[i].name = fmt.Sprintf(\"Truck %d\", i+1)\n\n        fmt.Printf(\"Building %s\\n\", trucks[i].name)\n    }\n\n    for t := range trucks {\n        go func(tr Truck) {\n\n            itm := Item{}\n            itm.name = \"Groceries\"\n\n            fmt.Printf(\"Loading %s\\n\", tr.name)\n            tr.Cargo = append(tr.Cargo, itm)\n            ch &lt;- tr\n\n        }(trucks[t])\n    }\n\n    time.Sleep(50 * time.Millisecond)\n    fmt.Println(\"Unloading Trucks\")\n    UnloadTrucks(ch)\n\n    fmt.Println(\"Done\")\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 3, "creation_date": 1451417463, "post_id": 34517713, "comment_id": 56776679, "body": "Condition is an array and I think using <code>[]interface{}</code> as you are is the most reasonable approach. It will be a pain to unwrap but since they have 2 types in the array and Go has a strict type system, there aren&#39;t a lot of options other than what you got or implementing UnmarshalJSON yourself to handle the special case in some other way."}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 5728210, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/addde50e68dce92f3b817a4a131bd941?s=128&d=identicon&r=PG&f=1", "display_name": "mjhd", "link": "https://stackoverflow.com/users/5728210/mjhd"}, "edited": false, "score": 0, "creation_date": 1451434611, "post_id": 34519565, "comment_id": 56783842, "body": "Simply awesome! This does precisely what I need. Thanks a ton for taking the time."}], "tags": [], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "is_accepted": true, "score": 2, "last_activity_date": 1451425506, "creation_date": 1451425506, "answer_id": 34519565, "question_id": 34517713, "link": "https://stackoverflow.com/questions/34517713/create-struct-for-complex-json-array-in-golang/34519565#34519565", "title": "Create struct for complex JSON array in Golang", "body": "<p>Assuming that there can be only a single condition per item in the root array, you can try a struct below. This could make using <code>Condition</code> clear.</p>\n\n<p><a href=\"https://play.golang.org/p/WxFhBjJmEN\" rel=\"nofollow\">https://play.golang.org/p/WxFhBjJmEN</a></p>\n\n<pre><code>type Trigger struct {\n    Event     string     `json:\"event\"`\n    Pair      string     `json:\"pair\"`\n    Actions   [][]string `json:\"actions\"`\n    Condition Condition  `json:\"condition\"`\n}\n\ntype Condition []interface{}\n\nfunc (c *Condition) Typ() string {\n    return (*c)[0].(string)\n}\n\nfunc (c *Condition) Val() []string {\n    xs := (*c)[1].([]interface{})\n    ys := make([]string, len(xs))\n    for i, x := range xs {\n        ys[i] = x.(string)\n    }\n    return ys\n}\n\ntype Triggers struct {\n    Collection []Trigger\n}\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 5728210, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/addde50e68dce92f3b817a4a131bd941?s=128&d=identicon&r=PG&f=1", "display_name": "mjhd", "link": "https://stackoverflow.com/users/5728210/mjhd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 653, "favorite_count": 1, "accepted_answer_id": 34519565, "answer_count": 1, "score": 3, "last_activity_date": 1451425506, "creation_date": 1451417289, "last_edit_date": 1451417784, "question_id": 34517713, "link": "https://stackoverflow.com/questions/34517713/create-struct-for-complex-json-array-in-golang", "title": "Create struct for complex JSON array in Golang", "body": "<p>I have the following JSON array that I'm trying to convert to a struct.</p>\n\n<pre><code>[\n    {\n        \"titel\": \"test 1\",\n        \"event\": \"some value\",\n        \"pair\": \"some value\",\n        \"condition\": [\n            \"or\",\n            [\n                \"contains\",\n                \"url\",\n                \"/\"\n            ]\n        ],\n        \"actions\": [\n            [\n                \"option1\",\n                \"12\",\n                \"1\"\n            ],\n            [\n                \"option2\",\n                \"3\",\n                \"1\"\n            ]\n        ]\n    }, {\n        \"titel\": \"test 2\",\n        \"event\": \"some value\",\n        \"pair\": \"some value\",\n        \"condition\": [\n            \"or\",\n            [\n                \"contains\",\n                \"url\",\n                \"/\"\n            ]\n        ],\n        \"actions\": [\n            [\n                \"option1\",\n                \"12\",\n                \"1\"\n            ],\n            [\n                \"option2\",\n                \"3\",\n                \"1\"\n            ]\n        ]\n    }\n]\n</code></pre>\n\n<p>This is the struct I've got so far:</p>\n\n<pre><code>type Trigger struct {\n    Event     string        `json:\"event\"`  \n    Pair      string        `json:\"pair\"`   \n    Actions   [][]string    `json:\"actions\"`\n    Condition []interface{} `json:\"condition\"`\n}\n\ntype Triggers struct {\n    Collection []Trigger\n}\n</code></pre>\n\n<p>However, this does not really cover the \"Condition\" part. Ideally id like to have a structure for that as well. </p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1451416733, "post_id": 34517289, "comment_id": 56776327, "body": "You&#39;re correct; it is a common problem. See: <a href=\"https://godoc.org/sync#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a>"}], "answers": [{"tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": false, "score": 6, "last_activity_date": 1508982000, "last_edit_date": 1508982000, "creation_date": 1451416794, "answer_id": 34517607, "question_id": 34517289, "link": "https://stackoverflow.com/questions/34517289/how-to-wait-for-a-group-of-goroutines/34517607#34517607", "title": "How to wait for a group of goroutines?", "body": "<p>Yes; you want a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>*sync.WaitGroup</code></a>, which you can use by calling <code>waitGroup.Add(1)</code> before starting each task, <code>waitGroup.Done()</code> when it finishes, and <code>waitGroup.Wait()</code> once you have started everything and want to wait for it all to finish, <a href=\"http://play.golang.org/p/P44vnUIYZo\" rel=\"nofollow noreferrer\">like this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    wg := new(sync.WaitGroup)\n    for i := 1; i &lt; 3; i++ {\n        wg.Add(1)\n        go func(i int) { // ensures each run gets distinct i\n            fmt.Println(\"Sleeping\", i, \"seconds\")\n            time.Sleep(time.Duration(i) * time.Second)\n            fmt.Println(\"Slept\", i, \"seconds\")\n            wg.Done()\n        }(i)\n    }\n    wg.Wait()\n    fmt.Println(\"All done\")\n}\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 5653566, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a57b23e789f4344a7ca37d2a6fc48a34?s=128&d=identicon&r=PG&f=1", "display_name": "Strickland Joseph", "link": "https://stackoverflow.com/users/5653566/strickland-joseph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2834, "favorite_count": 0, "closed_date": 1451416813, "answer_count": 1, "score": 3, "last_activity_date": 1508982000, "creation_date": 1451415554, "question_id": 34517289, "link": "https://stackoverflow.com/questions/34517289/how-to-wait-for-a-group-of-goroutines", "closed_reason": "Duplicate", "title": "How to wait for a group of goroutines?", "body": "<p>let's say I want to start a group of goroutines and than wait for all of them to finish (e.g. return).\nI can think of some channel-based solution (e.g. create a channel and listen to it counting received messages which shall be sent by each of goroutines and quiting after receive corresponding number of msgs) but maybe there's a more elegant/efficient solution because this case seems very common.</p>\n"}, {"tags": ["c#", "pointers", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1451415363, "post_id": 34517179, "comment_id": 56775591, "body": "That&#39;s a statement not a question. Reference vs value is just more abstracted in C# and Java. I don&#39;t personally find it to be a good thing. In your example you don&#39;t need a reference to do assignment, you have to pass by reference to <code>Scan</code> because that&#39;s how it&#39;s designed. It couldn&#39;t be be by value in any language so in C# since types like int are always value types, it would probably return the value or use an out param."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1451425633, "post_id": 34517179, "comment_id": 56780427, "body": "Huh, the stuff in answers about how objects are born references in C#/Java but not in Go is true, but this example doesn&#39;t really involve it, necessarily. You can read a string with <code>(*bufio.Reader).ReadString</code>, convert it to an int with <code>strconv.Atoi</code>, and assign it to a variable in Go too, though <code>Scan</code> is shorter."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 5, "creation_date": 1451417493, "post_id": 34517426, "comment_id": 56776696, "body": "Go has garbage collection as well as C# and Java. The crucial point of difference between Go and those oher languages is that the designers of Go strive hard to make it have as little <i>magic</i> as possible. One reason for this is enabling the programmer to easily estimate the runtime costs just by looking at the code. Another one is lowering the &quot;WTF factor&quot;: say, no braindead &quot;value types vs refernce types&quot; distinction -- everything is a value and passed by value, so what you pass is what you get ;-) Pointers are values, too, and you use them when you need them."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1451425183, "post_id": 34517426, "comment_id": 56780229, "body": "In Java and C#, you use object references most of the time, which contain a pointer even you don&#39;t know it. In C#, you can use a <code>struct</code> if you don&#39;t want your type to implicitly get object-passed-by-reference semantics. In Go, you <i>always</i> start with a <code>struct</code> or other non-pointer type, and only get pointers when they&#39;re asked for using <code>*</code>/<code>&amp;</code>/<code>new</code> or implied by something else you do (e.g., slices, strings, maps and <code>func</code> and <code>interface</code> values are implemented with pointers)."}], "tags": [], "owner": {"reputation": 2571, "user_id": 2716578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ofPGo.png?s=128&g=1", "display_name": "F&#225;bio Junqueira", "link": "https://stackoverflow.com/users/2716578/f%c3%a1bio-junqueira"}, "is_accepted": true, "score": 2, "last_activity_date": 1451418497, "last_edit_date": 1451418497, "creation_date": 1451416028, "answer_id": 34517426, "question_id": 34517179, "link": "https://stackoverflow.com/questions/34517179/why-we-need-pointers-for-assigning-a-value-to-a-variable-in-go-c-but-not-c-java/34517426#34517426", "title": "Why we need Pointers for assigning a value to a variable in Go/C but not C#/Java", "body": "<p>Java and C# are higher level languages which abstract most of the memory management and other particular things required in lower level languages like C.</p>\n\n<p>In this case, the <code>Console.ReadLine()</code> function allocates memory to store the console input and copies it to the <code>input</code> variable.</p>\n\n<p>Since these languages have garbage collection, allocating and deallocating memory is done automatically, so the framework don't require you to explicitly pass a memory address to write to, and doesn't expect you to free the memory when you are done using it.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>See @kostix comment for a great improvement to this answer.</p>\n"}, {"comments": [{"owner": {"reputation": 3373, "user_id": 659466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/97ual.jpg?s=128&g=1", "display_name": "Motes", "link": "https://stackoverflow.com/users/659466/motes"}, "edited": false, "score": 0, "creation_date": 1451417867, "post_id": 34517813, "comment_id": 56776841, "body": "Also, C# has IntPtr and Marshal namespace."}, {"owner": {"reputation": 1563, "user_id": 1311571, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b39a1d543cc5e64adfcebc9301850df2?s=128&d=identicon&r=PG", "display_name": "Peter Schneider", "link": "https://stackoverflow.com/users/1311571/peter-schneider"}, "edited": false, "score": 0, "creation_date": 1451418723, "post_id": 34517813, "comment_id": 56777277, "body": "Java also have boxing and unboxing. (int vs Integer if I remember correctly)"}], "tags": [], "owner": {"reputation": 126, "user_id": 277853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05b2cd554926140a655d2a5131a0eba4?s=128&d=identicon&r=PG", "display_name": "dsluis", "link": "https://stackoverflow.com/users/277853/dsluis"}, "is_accepted": false, "score": 1, "last_activity_date": 1451417872, "last_edit_date": 1451417872, "creation_date": 1451417657, "answer_id": 34517813, "question_id": 34517179, "link": "https://stackoverflow.com/questions/34517179/why-we-need-pointers-for-assigning-a-value-to-a-variable-in-go-c-but-not-c-java/34517813#34517813", "title": "Why we need Pointers for assigning a value to a variable in Go/C but not C#/Java", "body": "<p>In Go, like C/C++, pointer variables are how types can be passed by reference.</p>\n\n<p>Languages like Java and C# discourage the use of pointer variables. C# has the \"ref\" keyword and \"boxing\" for passing value types by reference.</p>\n\n<p>See here for more on \"ref\": <a href=\"https://msdn.microsoft.com/en-us/library/14akc2c7.aspx\" rel=\"nofollow\">https://msdn.microsoft.com/en-us/library/14akc2c7.aspx</a>\nSee here for more on \"boxing: <a href=\"https://msdn.microsoft.com/en-us/library/yz2be5wk.aspx\" rel=\"nofollow\">https://msdn.microsoft.com/en-us/library/yz2be5wk.aspx</a></p>\n"}], "owner": {"reputation": 5634, "user_id": 2517730, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Xojng.jpg?s=128&g=1", "display_name": "Yar", "link": "https://stackoverflow.com/users/2517730/yar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 34517426, "answer_count": 2, "score": 3, "last_activity_date": 1451418497, "creation_date": 1451415094, "last_edit_date": 1451416525, "question_id": 34517179, "link": "https://stackoverflow.com/questions/34517179/why-we-need-pointers-for-assigning-a-value-to-a-variable-in-go-c-but-not-c-java", "title": "Why we need Pointers for assigning a value to a variable in Go/C but not C#/Java", "body": "<p>It's a actually a general question, but it occurred now that I'm working with Go and C#.\nSay we want to assign a variable from user's input in Go:</p>\n\n<pre><code>func main() {\n    var input float64\n    fmt.Scan(&amp;input)\n}\n</code></pre>\n\n<p>It's pretty much clear why we need a memory location to put our new value in. But why in languages like Java or C#, we are not following the same logic:</p>\n\n<pre><code>var input = Convert.ToInt32(Console.ReadLine());\n// and not &amp;input ...\n</code></pre>\n"}, {"tags": ["time", "go"], "comments": [{"owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "edited": false, "score": 0, "creation_date": 1451415585, "post_id": 34516952, "comment_id": 56775700, "body": "looks like in go 1.5 these features are now implemented in go (runtime/proc.go and runtime/timer.go). patch: <a href=\"https://github.com/golang/playground/blob/master/sandbox/enable-fake-time.patch\" rel=\"nofollow noreferrer\">github.com/golang/playground/blob/master/sandbox/&hellip;</a> this means to get this I need to recompile the go runtime?"}, {"owner": {"reputation": 5205, "user_id": 118201, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3332136bbcc2736f3d2118dfd7d98a15?s=128&d=identicon&r=PG", "display_name": "eSniff", "link": "https://stackoverflow.com/users/118201/esniff"}, "edited": false, "score": 2, "creation_date": 1451417369, "post_id": 34516952, "comment_id": 56776626, "body": "checkout <a href=\"https://github.com/benbjohnson/clock\" rel=\"nofollow noreferrer\">github.com/benbjohnson/clock</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1451418059, "post_id": 34516952, "comment_id": 56776938, "body": "yes, you need to recompile the runtime to subvert time. Using the nacl build also comes with other drawbacks, unless you intend to patch this into the standard runtime build. It&#39;s usually easier to make your code more testable, rather than bending the runtime to test your code."}, {"owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "edited": false, "score": 0, "creation_date": 1451420432, "post_id": 34516952, "comment_id": 56778116, "body": "Another fake time package: <a href=\"https://github.com/jonboulle/clockwork\" rel=\"nofollow noreferrer\">github.com/jonboulle/clockwork</a>"}, {"owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "edited": false, "score": 0, "creation_date": 1451422659, "post_id": 34516952, "comment_id": 56779108, "body": "I am still convinced that the implementation used in playground is the correct solution to this problem. The clocks in the comments (by the way there are more) all share the same property: They fail to implement the deadlock trick described in the blog post referenced in my question."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1451463263, "post_id": 34516952, "comment_id": 56792274, "body": "That&#39;s the right way to make <i>examples that rely on sleep</i> work <i>unmodified</i>. But in production you may want to limit how much you rely on sleeps, and as JimB says, modify your code (to include fake clocks and maybe test code to drive them) rather than your Go installation."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 2, "last_activity_date": 1567631145, "creation_date": 1567631145, "answer_id": 57795633, "question_id": 34516952, "link": "https://stackoverflow.com/questions/34516952/use-golang-playground-features-to-fake-time-during-testing/57795633#57795633", "title": "use golang playground features to fake time during testing", "body": "<blockquote>\n  <p>My question is based on the assumption that google won't accept a pull request for runtime/time.go to turn faketime into Faketime or to add \"func Faketime(f int64) {faketime = f}\".</p>\n</blockquote>\n\n<p>4 years later (Sept. 2019), that assumption might be challenged.</p>\n\n<p>Brad Fitzpatrick <a href=\"https://twitter.com/bradfitz/status/1169298386236784642\" rel=\"nofollow noreferrer\">just announced</a>:</p>\n\n<blockquote>\n  <p>So we're moving the #golang playground from Native Client to linux/amd64 binaries with runtime faketime support under gvisor. e.g.</p>\n</blockquote>\n\n<p>And (<a href=\"https://twitter.com/bradfitz/status/1169321506247069696\" rel=\"nofollow noreferrer\">tweet</a>):</p>\n\n<blockquote>\n  <p>Austin's faketime #golang support is in master (1.14?).<br>\n  See <a href=\"https://github.com/golang/go/commit/5ff38e476177ce9e67375bd010bea2e030f2fe19\" rel=\"nofollow noreferrer\"><code>golang/go</code> commit 5ff38e4</a> &amp; its prior two commits.</p>\n  \n  <p>Note that the sleep is simulated and instead all writes are prefixed by a binary header containing the fake time, starting from usual Go epoch (<a href=\"https://play.golang.org/p/Z35Vf8gIg4Z\" rel=\"nofollow noreferrer\">play.golang.org</a>).</p>\n</blockquote>\n\n<p>See <a href=\"https://github.com/golang/go/issues/30439\" rel=\"nofollow noreferrer\">issue 30439</a> and <a href=\"https://github.com/golang/go/issues/30324\" rel=\"nofollow noreferrer\">issue 30324</a>.</p>\n\n<p><a href=\"https://i.stack.imgur.com/Wvmcx.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Wvmcx.jpg\" alt=\"https://pbs.twimg.com/media/EDpDthtU8AAXXd2?format=jpg&amp;name=large\"></a></p>\n\n<blockquote>\n  <p>The context is the playground.<br>\n  This is for use by the playground and might not even be documented or supported (kept compatible).<br>\n  This is so we can replay sleeps in JavaScript but execute quickly server side.</p>\n</blockquote>\n"}], "owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 653, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1567631145, "creation_date": 1451414080, "last_edit_date": 1451518131, "question_id": 34516952, "link": "https://stackoverflow.com/questions/34516952/use-golang-playground-features-to-fake-time-during-testing", "title": "use golang playground features to fake time during testing", "body": "<p>The golang blog mentions two Go features faketime and timejump:\n<a href=\"https://blog.golang.org/playground\" rel=\"nofollow\">https://blog.golang.org/playground</a></p>\n\n<p>The part that interests me is:</p>\n\n<pre><code>modify scheduler condition to wait for deadlock, then:\n- check if timers are pending\n- advance clock to trigger-time of first timer\n</code></pre>\n\n<p>I would like to know how I can leverage this implementation to run unittests with faketime. By this I mean many unitests that use time.Sleep. Testing in realtime is prohibitive since execution time adds up to hours. In faketime the tests run within split-seconds.</p>\n\n<p>To be clear: I do not plan or want to mess up the runtime. I want to build a fake clock that works.</p>\n\n<p>I am pretty convinced that the above referenced implementation works correctly in the concurrent case. If you have a idea, a tip or two on how to borrow this implementation and build a fake clock from it would be great.</p>\n\n<p>My question is based on the assumption that google won't accept a pull request for runtime/time.go to turn faketime into Faketime or to add \"func Faketime(f int64) {faketime = f}\".</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1451412658, "post_id": 34516483, "comment_id": 56774199, "body": "It&#39;s not impossible, but it might be needlessly complex. Is there a reason that <code>thisfunc</code> can&#39;t be a function that takes a struct pointer, rather than a method whose receiver is that struct pointer? e.g. <code>func thisfunc(a *A, i, j int)</code>"}, {"owner": {"reputation": 1, "user_id": 4480261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9777aaf4c7a36ac44606b37906085285?s=128&d=identicon&r=PG&f=1", "display_name": "user281190", "link": "https://stackoverflow.com/users/4480261/user281190"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1451502519, "post_id": 34516483, "comment_id": 56812940, "body": "That indeed was what I did.  Much easier.  It might have been good to know what the signature was, but getting on with life is more important"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 3, "last_activity_date": 1451920572, "last_edit_date": 1451920572, "creation_date": 1451412721, "answer_id": 34516587, "question_id": 34516483, "link": "https://stackoverflow.com/questions/34516483/variable-containing-struct-method/34516587#34516587", "title": "variable containing struct method", "body": "<p>I think what you're looking for are <a href=\"https://golang.org/ref/spec#Method_values\" rel=\"nofollow\">\"Method Values\"</a></p>\n\n<p>Given type <code>A</code>:</p>\n\n<pre><code>type A struct {\n    total int\n}\n\nfunc (a *A) add(i int, j int) int {\n    a.total += i + j\n    return i + j\n}\n</code></pre>\n\n<p>While the <a href=\"https://golang.org/ref/spec#Method_expressions\" rel=\"nofollow\">method expression</a> for <code>(*A).add</code> technically has a signature of</p>\n\n<pre><code>func(*A, int, int)\n</code></pre>\n\n<p>You can use the value of the <code>add</code> method as a function with the signature </p>\n\n<pre><code>func(int int)\n</code></pre>\n\n<p>Which can be assigned like so:</p>\n\n<pre><code>var thisfunc func(int, int) int\n\na := A{}\nthisfunc = a.add\nthisfunc(3, 4)\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/_3WztPbL__\" rel=\"nofollow\">http://play.golang.org/p/_3WztPbL__</a></p>\n"}], "owner": {"reputation": 1, "user_id": 4480261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9777aaf4c7a36ac44606b37906085285?s=128&d=identicon&r=PG&f=1", "display_name": "user281190", "link": "https://stackoverflow.com/users/4480261/user281190"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451920572, "creation_date": 1451412283, "question_id": 34516483, "link": "https://stackoverflow.com/questions/34516483/variable-containing-struct-method", "title": "variable containing struct method", "body": "<p>Given the struct:</p>\n\n<pre><code>type A struct {\n    total int\n}\n</code></pre>\n\n<p>and the func</p>\n\n<pre><code>(a *A) add func (i int, j int) (int x) {\n    a.total += i+j\n    return i+j\n  }\n</code></pre>\n\n<p>I would like to create a variable pointing to the func and invoke it via that variable.  I'm having trouble defining the signature for the variable that includes the instance of the struct.  </p>\n\n<p>Why do this?  Because I want to create an array of func pointers and iterate through it it calling them in sequence.  I can have different arrays to accomplish different tasks using my func building blocks.</p>\n\n<p>These two don't compile:</p>\n\n<pre><code>thisfunc func (a *A) (i int, b int) (x int)\nthisfunc (a *A) func (i int, b int) (x int)\n</code></pre>\n\n<p>This one compiles but doesn't include the struct instance and when invoking thisfunc, a is missing - no struct instance, i.e null pointer dereference.</p>\n\n<pre><code>thisfunc func (i int, b int) (x int)\n</code></pre>\n\n<p>I would like to do something like this:</p>\n\n<pre><code>thisfunc = a.add\nb := thisfunc(1,2)\n</code></pre>\n\n<p>Please help me define a variable thisfunc whose signature matches a.add.</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 1768, "user_id": 899671, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/EPYny.jpg?s=128&g=1", "display_name": "Michael Draper", "link": "https://stackoverflow.com/users/899671/michael-draper"}, "edited": false, "score": 0, "creation_date": 1451414420, "post_id": 34516528, "comment_id": 56775102, "body": "Thank you, that helped!  I&#39;ve updated the code a bit, now it just fails with a deadlock.  <a href=\"https://play.golang.org/p/opogH_TxPt\" rel=\"nofollow noreferrer\">play.golang.org/p/opogH_TxPt</a>"}, {"owner": {"reputation": 1768, "user_id": 899671, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/EPYny.jpg?s=128&g=1", "display_name": "Michael Draper", "link": "https://stackoverflow.com/users/899671/michael-draper"}, "edited": false, "score": 0, "creation_date": 1451415033, "post_id": 34516528, "comment_id": 56775432, "body": "Specifically:  fatal error: all goroutines are asleep - deadlock!  goroutine 1 [chan receive]: main.UnloadTrucks(0x104360c0, 0x193ce8) \t/tmp/sandbox736348381/main.go:17 +0x80 main.main() \t/tmp/sandbox736348381/main.go:52 +0x3c0"}, {"owner": {"reputation": 1768, "user_id": 899671, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/EPYny.jpg?s=128&g=1", "display_name": "Michael Draper", "link": "https://stackoverflow.com/users/899671/michael-draper"}, "edited": false, "score": 0, "creation_date": 1451419283, "post_id": 34516528, "comment_id": 56777544, "body": "Ugh, having a bugger of a time getting around the deadlock. The updated playground:   <a href=\"https://play.golang.org/p/tbRnoWvOCP\" rel=\"nofollow noreferrer\">play.golang.org/p/tbRnoWvOCP</a>  Trying to understand why range is hitting the channel cursor even after the loop has terminated."}, {"owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "reply_to_user": {"reputation": 1768, "user_id": 899671, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/EPYny.jpg?s=128&g=1", "display_name": "Michael Draper", "link": "https://stackoverflow.com/users/899671/michael-draper"}, "edited": false, "score": 0, "creation_date": 1451419887, "post_id": 34516528, "comment_id": 56777871, "body": "You have a deadlock because you&#39;re reading from a channel in which no goroutine can write anymore (because all your goroutines apart from the main thread have already finished). You could add a timer for implementing a timeout or something similar; that might be an issue for a separate question, though."}], "tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": true, "score": 1, "last_activity_date": 1451412455, "creation_date": 1451412455, "answer_id": 34516528, "question_id": 34516342, "link": "https://stackoverflow.com/questions/34516342/goroutine-to-populate-struct-instance-slice/34516528#34516528", "title": "Goroutine to populate struct instance slice", "body": "<p>Your issue is not that the truck's properties are \"lost\", but they're never set in the first place. This loop is your problem:</p>\n\n<pre><code>for i, t := range trucks {\n    t.name = fmt.Sprintf(\"Truck %d\", i + 1)\n    fmt.Printf(\"Building %s\\n\", t.name)\n}\n</code></pre>\n\n<p>Within this loop, <code>t</code> is a <em>copy</em> of the Truck object in the <code>trucks</code> slice. Any modification on this object will not affect the original truck. Instead, you can reference the original Truck object by using the index variable <code>i</code> to directly access the object in the <code>trucks</code> slice:</p>\n\n<pre><code>for i, _ := range trucks {\n    trucks[i].name = fmt.Sprintf(\"Truck %d\", i + 1)\n    fmt.Printf(\"Building %s\\n\", trucks[i].name)\n}\n</code></pre>\n"}], "owner": {"reputation": 1768, "user_id": 899671, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/EPYny.jpg?s=128&g=1", "display_name": "Michael Draper", "link": "https://stackoverflow.com/users/899671/michael-draper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 34516528, "answer_count": 1, "score": 0, "last_activity_date": 1451412455, "creation_date": 1451411712, "question_id": 34516342, "link": "https://stackoverflow.com/questions/34516342/goroutine-to-populate-struct-instance-slice", "title": "Goroutine to populate struct instance slice", "body": "<p>This is my first day using Go and I had a question about goroutines and appending to an instance's slice.</p>\n\n<p>The idea is that each Truck would have a Cargo of length 1 containing an Item with name \"Groceries\". I almost have it, but for some reason it's losing the properties of the truck, and it seems to be terminating prematurely.</p>\n\n<p><a href=\"https://play.golang.org/p/f0uIy5qg8d\" rel=\"nofollow\">https://play.golang.org/p/f0uIy5qg8d</a></p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>package main\r\n\r\nimport \"fmt\"\r\nimport \"time\"\r\n\r\ntype Item struct {\r\n   name string\r\n}\r\n\r\ntype Truck struct{\r\n   Cargo []Item\r\n   name  string\r\n}\r\n\r\nfunc UnloadTrucks(ch chan *Truck){\r\n    t := &lt;- ch\r\n\r\n    fmt.Printf(\"%s has %d items in cargo: %s\\n\", t.name, len(t.Cargo), t.Cargo[0].name)\r\n    time.Sleep(1 * time.Second)\r\n    return \r\n}\r\n\r\nfunc main() {\r\n     trucks := make([]Truck, 2)\r\n\r\n     ch := make(chan *Truck)\r\n\r\n     for i, t := range trucks{\r\n         t.name = fmt.Sprintf(\"Truck %d\", i + 1)\r\n\r\n\t fmt.Printf(\"Building %s\\n\", t.name)\r\n     }\r\n\r\n\r\n\r\n     for _, t := range trucks {\r\n            go func(tr *Truck){\r\n\t\t  itm := Item {}\r\n                  itm.name = \"Groceries\"\r\n\r\n\r\n     \t          fmt.Printf(\"Loading %s\", tr.name)\r\n                  tr.Cargo = append(tr.Cargo, itm)\r\n                  ch &lt;- tr\r\n\r\n            }(&amp;t)\r\n     }\r\n\r\n     UnloadTrucks(ch)\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "edited": false, "score": 0, "creation_date": 1451427061, "post_id": 34513944, "comment_id": 56781119, "body": "Even when I provide an example <code>n</code> of 3, I&#39;m getting less or more (sometimes 2, sometimes 4). Is this just provided as an advisory value?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "edited": false, "score": 0, "creation_date": 1451428185, "post_id": 34513944, "comment_id": 56781634, "body": "@DustinOprea: the <code>Readdir*</code> docs say you they should return &quot;at most n ...&quot;. Fewer results are possible, but more than n would be a bug if you can reproduce that."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1451405583, "last_edit_date": 1451405583, "creation_date": 1451402417, "answer_id": 34513944, "question_id": 34513460, "link": "https://stackoverflow.com/questions/34513460/efficiently-listing-files-in-a-directory-having-very-many-entries/34513944#34513944", "title": "Efficiently listing files in a directory having very many entries", "body": "<p><code>ioutil.ReadDir</code> and <code>filepath.Glob</code> are just convenience functions around reading directory entries.</p>\n\n<p>You can read directory entries in batches by directly using the <a href=\"https://golang.org/pkg/os/#File.Readdir\" rel=\"nofollow\"><code>Readdir</code></a> or <a href=\"https://golang.org/pkg/os/#File.Readdirnames\" rel=\"nofollow\"><code>Readdirnames</code></a> methods, if you supply an <code>n</code> argument > 0.</p>\n\n<p>For something as basic as reading directory entries, there's no need to add the overhead of a goroutine and channel, and also provide an alternate way to return the error. You can always wrap the batched calls with your own goroutine and channel pattern if you wish.</p>\n"}], "owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1507, "favorite_count": 1, "accepted_answer_id": 34513944, "answer_count": 1, "score": 2, "last_activity_date": 1451405583, "creation_date": 1451400687, "question_id": 34513460, "link": "https://stackoverflow.com/questions/34513460/efficiently-listing-files-in-a-directory-having-very-many-entries", "title": "Efficiently listing files in a directory having very many entries", "body": "<p>I need to recursively read a directory structure, but I also need to perform an additional step once I have read through all entries for each directory. Therefore, I need to write my own recursion logic (and can't use the simplistic <code>filepath.Walk</code> routine). However, the <code>ioutil.ReadDir</code> and <code>filepath.Glob</code> routines only return slices. What if I'm pushing the limits of <em>ext4</em> or <em>xfs</em> and have a directory with files numbering into the billions? I would expect <em>golang</em> to have a function that returns an unsorted series of <code>os.FileInfo</code> (or, even better, raw strings) over a channel rather than a sorted slice. How do we efficiently read file entries in this case?</p>\n\n<p>All of the functions cited above seem to rely on <code>readdirnames</code> in <em>os/dir_unix.go</em>, and, for some reason, it just makes an array when it seems like it would've been easy to spawn a <em>gothread</em> and and push the values into a channel. There might have been sound logic to do this, but it's not clear what it is. I'm new to Go, so I also could've easy missed some principle that's obvious to everyone else.</p>\n\n<p>This is the sourcecode, for convenience:</p>\n\n<pre><code>func (f *File) readdirnames(n int) (names []string, err error) {\n    // If this file has no dirinfo, create one.\n    if f.dirinfo == nil {\n        f.dirinfo = new(dirInfo)\n        // The buffer must be at least a block long.\n        f.dirinfo.buf = make([]byte, blockSize)\n    }\n    d := f.dirinfo\n\n    size := n\n    if size &lt;= 0 {\n        size = 100\n        n = -1\n    }\n\n    names = make([]string, 0, size) // Empty with room to grow.\n    for n != 0 {\n        // Refill the buffer if necessary\n        if d.bufp &gt;= d.nbuf {\n            d.bufp = 0\n            var errno error\n            d.nbuf, errno = fixCount(syscall.ReadDirent(f.fd, d.buf))\n            if errno != nil {\n                return names, NewSyscallError(\"readdirent\", errno)\n            }\n            if d.nbuf &lt;= 0 {\n                break // EOF\n            }\n        }\n\n        // Drain the buffer\n        var nb, nc int\n        nb, nc, names = syscall.ParseDirent(d.buf[d.bufp:d.nbuf], n, names)\n        d.bufp += nb\n        n -= nc\n    }\n    if n &gt;= 0 &amp;&amp; len(names) == 0 {\n        return names, io.EOF\n    }\n    return names, nil\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 2, "last_activity_date": 1451393795, "creation_date": 1451393795, "answer_id": 34511551, "question_id": 34510055, "link": "https://stackoverflow.com/questions/34510055/split-function-into-2-function-for-test-coverage/34511551#34511551", "title": "Split function into 2 function for test coverage", "body": "<p>Basically yes, unless you're using <a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"nofollow\"><code>net/http/httptest</code></a> or a similar way to mock your HTTP server when testing.</p>\n\n<p>But the question is: what would you really be testing? That <code>ioutil.ReadAll()</code> detects errors? But I'm sure this was already covered by the test suite of the Go's stdlib.</p>\n\n<p>Hence I'd say that in this particular case you're about to test for the testing's sake. IMO for such trivial cases it's better to concentrate on how the fetched result is further processed.</p>\n"}, {"tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": true, "score": 2, "last_activity_date": 1451398991, "creation_date": 1451398991, "answer_id": 34512984, "question_id": 34510055, "link": "https://stackoverflow.com/questions/34510055/split-function-into-2-function-for-test-coverage/34512984#34512984", "title": "Split function into 2 function for test coverage", "body": "<blockquote>\n  <p>Do I need to split my function in two, one which will make the request, and another one which will read the body and return the bytes and error?</p>\n</blockquote>\n\n<p>The first one is called <code>http.Get</code> and the other one <code>ioutil.ReadAll</code>, so I don't think there's anything to split. You just created a function that uses two other functions together which you should assume are working correctly. You could even simplify your function to make it more obvious:</p>\n\n<pre><code>func fetchURL(URL string) ([]byte, error) {\n    resp, err := http.Get(URL)\n    if err != nil {\n        return nil, err\n    }\n    defer resp.Body.Close()\n    return ioutil.ReadAll(resp.Body)\n}\n</code></pre>\n\n<p>If you want to test anything is your <code>fetchURL</code> function using <code>http.Get</code> and <code>ioutil.ReadAll</code> together. I wouldn't personally bother to test it directly, but if you insist on it, you can overwrite <code>http.DefaultTransport</code> for a single test and provide your own, which returns <code>http.Response</code> with body implementing some error scenarios (e.g. and error during body read).</p>\n\n<p>Here is the sketch idea:</p>\n\n<pre><code>type BrokenTransport struct {\n}\n\nfunc (*BrokenTransport) RoundTrip(*http.Request) (*http.Response, error) {\n    // Return Response with Body implementing specific error behaviour\n}\n\nhttp.DefaultTransport = &amp;BrokenTransport{}\n\n// http.Get will now use your RoundTripper.\n// You should probably restore http.DefaultTransport after the test.\n</code></pre>\n"}], "owner": {"reputation": 1689, "user_id": 3791027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a240d8bb3d536a1ecc16adf28f7b1feb?s=128&d=identicon&r=PG&f=1", "display_name": "RockNinja", "link": "https://stackoverflow.com/users/3791027/rockninja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 34512984, "answer_count": 2, "score": 1, "last_activity_date": 1451398991, "creation_date": 1451388535, "question_id": 34510055, "link": "https://stackoverflow.com/questions/34510055/split-function-into-2-function-for-test-coverage", "title": "Split function into 2 function for test coverage", "body": "<p>How can I test the error for <code>ioutil.ReadAll(rep.Body)</code>? Do I need to split my function in two, one which will make the request, and another one which will read the body and return the bytes and error?</p>\n\n<pre><code>func fetchUrl(URL string) ([]bytes, error) {\n  resp, err := http.Get(URL)\n  if err != nil {\n    return nil, err\n  }\n  body, err := ioutil.ReadAll(resp.Body)\n  resp.Body.Close()\n  if err != nil {\n    return nil, err\n  }\n  return body, nil\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "is_accepted": true, "score": 2, "last_activity_date": 1451379461, "creation_date": 1451379461, "answer_id": 34507713, "question_id": 34507283, "link": "https://stackoverflow.com/questions/34507283/construct-array-from-slices-in-go/34507713#34507713", "title": "Construct Array from Slices in Go", "body": "<p>You can create a type that would hold all the pieces and iterate over the slices such that</p>\n\n<pre><code>type Position struct {\n    Title, Relationship, Institution string\n}\n\npositions := make([]Position, len(positionTitles))\nfor i, title := range positionTitles {\n    positions[i] = Position{\n        Title:        title,\n        Relationship: positionRelationships[i],\n        Institution:  positionInstitutions[i],\n    }\n}\n</code></pre>\n\n<p>However, if you need it only to iterate, you don't need to create a type. See body of the <code>for</code>.</p>\n\n<p><a href=\"https://play.golang.org/p/1P604WWRGd\" rel=\"nofollow\">https://play.golang.org/p/1P604WWRGd</a></p>\n"}, {"tags": [], "owner": {"reputation": 1280, "user_id": 4932403, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uLzID.jpg?s=128&g=1", "display_name": "KeylorSanchez", "link": "https://stackoverflow.com/users/4932403/keylorsanchez"}, "is_accepted": false, "score": 0, "last_activity_date": 1451379836, "creation_date": 1451379836, "answer_id": 34507793, "question_id": 34507283, "link": "https://stackoverflow.com/questions/34507283/construct-array-from-slices-in-go/34507793#34507793", "title": "Construct Array from Slices in Go", "body": "<p>I would create a Position struct containing the informations you need : </p>\n\n<pre><code>type Position struct {\nPositionTitle         string\nPositionRelationships string\nPositionInstitution   string\n}\n</code></pre>\n\n<p>and create an array (or slice) of those structs to iterate over them. Here is a working example : <a href=\"http://play.golang.org/p/s02zfeNJ63\" rel=\"nofollow\">http://play.golang.org/p/s02zfeNJ63</a></p>\n"}], "owner": {"reputation": 1079, "user_id": 583910, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/734253eac643b58dcc0f65a0b0f400d5?s=128&d=identicon&r=PG", "display_name": "webbydevy", "link": "https://stackoverflow.com/users/583910/webbydevy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 34507713, "answer_count": 2, "score": 1, "last_activity_date": 1451379836, "creation_date": 1451377659, "last_edit_date": 1451378817, "question_id": 34507283, "link": "https://stackoverflow.com/questions/34507283/construct-array-from-slices-in-go", "title": "Construct Array from Slices in Go", "body": "<p>Given the following:</p>\n\n<pre><code>var positionTitles []string\nvar positionRelationships []string\nvar positionInstitutions []string\n\npositionTitles = [\"Director\" \"Provost\" \"Assistant Provost\"]\npositionRelationships = [\"Tenured Professor\" \"Lecturer\" \"Adjunct Professor\"]\npositionInstitutions = [\"UCSC\" \"UCB\" \"USC\"]\n</code></pre>\n\n<p>How would I construct an array that looks like such:</p>\n\n<pre><code>Positions :=\n [{\n   PositionTitle: \"Director\",\n   PositionRelationships: \"Tenured Professor\",\n   PositionInstitution: \"UCSC\",\n  },\n  {\n   PositionTitle: \"Provost\",\n   PositionRelationships: \"Lecturer\",\n   PositionInstitution: \"UCB\",\n  },\n  {\n   PositionTitle: \"Assistant Provost\",\n   PositionRelationships: \"Adjunct Professor\",\n   PositionInstitution: \"USC\",\n  }]\n</code></pre>\n\n<p>The goal is to iterate over the Positions.</p>\n\n<p>Go Playground I've started:\n<a href=\"http://play.golang.org/p/za_9U7eHHT\" rel=\"nofollow\">http://play.golang.org/p/za_9U7eHHT</a></p>\n"}, {"tags": ["go", "supervisord"], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 3, "creation_date": 1451377443, "post_id": 34506252, "comment_id": 56755687, "body": "You shouldn&#39;t use <code>go run</code>. Use <code>go build</code> to build a static binary and then run that via supervisord. Your program won&#39;t be recompiled (which is what &#39;go run&#39; does) on each restart and won&#39;t require its dependencies to be available each time. Go programs are designed to be compiled into standalone binaries."}, {"owner": {"reputation": 627, "user_id": 4689430, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/SJU8y.png?s=128&g=1", "display_name": "elixir", "link": "https://stackoverflow.com/users/4689430/elixir"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451380997, "post_id": 34506252, "comment_id": 56757318, "body": "Oh yeah. I missed that. Thanks a lot."}, {"owner": {"reputation": 158, "user_id": 10245760, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RNQ3BJ-mSGQ/AAAAAAAAAAI/AAAAAAAAAAw/B-wcw98aIqQ/photo.jpg?sz=128", "display_name": "Karl Anthony Baluyot", "link": "https://stackoverflow.com/users/10245760/karl-anthony-baluyot"}, "edited": false, "score": 0, "creation_date": 1583880793, "post_id": 34506252, "comment_id": 107260667, "body": "how to run go build and run the binary?"}], "tags": [], "owner": {"reputation": 627, "user_id": 4689430, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/SJU8y.png?s=128&g=1", "display_name": "elixir", "link": "https://stackoverflow.com/users/4689430/elixir"}, "is_accepted": false, "score": 4, "last_activity_date": 1451373223, "creation_date": 1451373223, "answer_id": 34506252, "question_id": 34506251, "link": "https://stackoverflow.com/questions/34506251/unrecognised-gopath-when-running-golang-program-using-supervisord/34506252#34506252", "title": "Unrecognised GOPATH when running Golang program using supervisord", "body": "<p>One important property of <code>supervisord</code> as stated <a href=\"http://supervisord.org/subprocess.html#subprocess-environment\" rel=\"nofollow\" title=\"here\">here</a>, that I had been missing out is:</p>\n\n<blockquote>\n  <p>Subprocesses will inherit the environment of the shell used to start\n  the <code>supervisord</code> program. Several environment variables will be set by\n  supervisord itself in the child\u2019s environment also, including\n  <code>SUPERVISOR_ENABLED</code> (a flag indicating the process is under supervisor\n  control), <code>SUPERVISOR_PROCESS_NAME</code> (the config-file-specified process\n  name for this process) and <code>SUPERVISOR_GROUP_NAME</code> (the\n  config-file-specified process group name for the child process).</p>\n  \n  <p>These environment variables may be overridden within the [supervisord]\n  section config option named <code>environment</code> (applies to all subprocesses)\n  or within the per- <code>[program:x]</code> section environment config option\n  (applies only to the subprocess specified within the <code>[program:x]</code>\n  section).</p>\n</blockquote>\n\n<p>Therefore, adding the <code>GOPATH</code> in the <code>environment</code> variable solved the issue.</p>\n\n<pre><code>[program:web_server]\ncommand=go run web_server.go\ndirectory=/home/ubuntu\nautostart=true\nautorestart=true\nstartretries=5\nstderr_logfile=/home/ubuntu/err_logs/web_server.err.log\nstderr_logfile_maxbytes=1MB\nstderr_logfile_backups=10\nenvironment=GOPATH=\"/home/ubuntu\"\n</code></pre>\n"}], "owner": {"reputation": 627, "user_id": 4689430, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/SJU8y.png?s=128&g=1", "display_name": "elixir", "link": "https://stackoverflow.com/users/4689430/elixir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 795, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1451373223, "creation_date": 1451373223, "question_id": 34506251, "link": "https://stackoverflow.com/questions/34506251/unrecognised-gopath-when-running-golang-program-using-supervisord", "title": "Unrecognised GOPATH when running Golang program using supervisord", "body": "<p>I have a Golang program implementing a web server. It is expected to be running continuously, and incase of any unexpected failure or crash, to restart itself. For that, I am trying to configure it as a UNIX-process using <code>supervisord</code>. However, the issue I am facing is that the external go libraries included in the code aren't getting recognised as <code>supervisord</code> is unable to recognise the <code>GOPATH</code>. This is leading to errors such as: </p>\n\n<pre><code>web_server.go:11:2: cannot find package \"github.com/gorilla/mux\" in any of:\n    /usr/lib/go/src/github.com/gorilla/mux (from $GOROOT)\n    ($GOPATH not set)\n</code></pre>\n\n<p>when running the web server using supervisord. The supervisord configuration for my web server is:</p>\n\n<pre><code>[program:web_server]\ncommand=go run web_server.go\ndirectory=/home/ubuntu\nautostart=true\nautorestart=true\nstartretries=5\nstderr_logfile=/home/ubuntu/err_logs/web_server.err.log\nstderr_logfile_maxbytes=1MB\nstderr_logfile_backups=10\n</code></pre>\n\n<p>What is the workaround for this?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 164, "user_id": 1002491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/782893d244994a125bc355705ab4ae6b?s=128&d=identicon&r=PG", "display_name": "H P", "link": "https://stackoverflow.com/users/1002491/h-p"}, "edited": false, "score": 0, "creation_date": 1451396378, "post_id": 34506407, "comment_id": 56765291, "body": "So, basically, &quot;,string&quot; is unusable (or at least badly implemented) on anything other than basic types (strings, floats, integers, and booleans). I am concluding that all code should just avoid it?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 164, "user_id": 1002491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/782893d244994a125bc355705ab4ae6b?s=128&d=identicon&r=PG", "display_name": "H P", "link": "https://stackoverflow.com/users/1002491/h-p"}, "edited": false, "score": 0, "creation_date": 1451420433, "post_id": 34506407, "comment_id": 56778118, "body": "Not all code, just the code that should support prior versions. This is unfortunate, but this is a bug, and <a href=\"https://golang.org/doc/go1compat#expectations\" rel=\"nofollow noreferrer\">bugs will be fixed even if they break code expecting the wrong behaviour</a>."}, {"owner": {"reputation": 164, "user_id": 1002491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/782893d244994a125bc355705ab4ae6b?s=128&d=identicon&r=PG", "display_name": "H P", "link": "https://stackoverflow.com/users/1002491/h-p"}, "edited": false, "score": 0, "creation_date": 1451452344, "post_id": 34506407, "comment_id": 56788126, "body": "Sure. The only point I was making was that if the annotation does nothing on complex types in newer versions, there is not much point in continuing to use it only to target older versions. Anyway, I am largely on the same page as you I think. And I now understand what I need to do thanks to your explanation. Thanks!"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1451373850, "creation_date": 1451373850, "answer_id": 34506407, "question_id": 34506102, "link": "https://stackoverflow.com/questions/34506102/differences-in-parsing-json-with-a-custom-unmarshaller-between-golang-versions/34506407#34506407", "title": "Differences in parsing json with a custom unmarshaller between golang versions", "body": "<p>There was <a href=\"https://github.com/golang/go/issues/9812\" rel=\"nofollow\">a bug</a> concerning <code>json:\",string\"</code> tag that was fixed in 1.5. If there isn't a particular reason you need it, you can remove it and simply adjust your format:</p>\n\n<pre><code>// N.B. time is in quotes.\nparsedTime, err := time.Parse(`\"2006-01-02T15:04:05\"`, string(b))\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/LgWuKcPEuI\" rel=\"nofollow\">http://play.golang.org/p/LgWuKcPEuI</a>.</p>\n\n<p>This should work in 1.3 as well as 1.5.</p>\n"}], "owner": {"reputation": 164, "user_id": 1002491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/782893d244994a125bc355705ab4ae6b?s=128&d=identicon&r=PG", "display_name": "H P", "link": "https://stackoverflow.com/users/1002491/h-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 1, "accepted_answer_id": 34506407, "answer_count": 1, "score": 2, "last_activity_date": 1464143353, "creation_date": 1451372503, "last_edit_date": 1464143353, "question_id": 34506102, "link": "https://stackoverflow.com/questions/34506102/differences-in-parsing-json-with-a-custom-unmarshaller-between-golang-versions", "title": "Differences in parsing json with a custom unmarshaller between golang versions", "body": "<p>I am trying to port some code written against go1.3 to current versions and ran into a case where the json parsing behavior is different between versions. We are using a custom unmarshaller for parsing some specific date format. It looks like recent versions pass in the string with additional quotes which 1.3 did not.</p>\n\n<p>Is this a bug or an intentional change? And whats the best way of writing code which is compatible with different versions in this situation. Just go looking for all places where a custom unmarshaller is in use always strip out extra quotes if any? It would be a pity to have to do that - so I am hoping there is a better way. </p>\n\n<pre><code>package main\n\nimport \"encoding/json\"\nimport \"fmt\"\nimport \"time\"\n\ntype Timestamp1 time.Time\n\nfunc (t *Timestamp1) UnmarshalJSON(b []byte) (err error) {\n    fmt.Println(\"String to parse as timestamp:\", string(b))\n    parsedTime, err := time.Parse(\"2006-01-02T15:04:05\", string(b))\n    if err == nil {\n        *t = Timestamp1(parsedTime)\n        return nil\n    } else {\n        return err\n    }\n}\n\ntype S struct {\n    LastUpdatedDate Timestamp1 `json:\"last_updated_date,string\"`\n}\n\nfunc main() {\n    s := `{\"last_updated_date\" : \"2015-11-03T10:00:00\"}`\n    var s1 S\n    err := json.Unmarshal([]byte(s), &amp;s1)\n    fmt.Println(err)\n    fmt.Println(s1)\n}\n</code></pre>\n"}, {"tags": ["pointers", "struct", "go"], "answers": [{"comments": [{"owner": {"reputation": 479, "user_id": 241660, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/QaBiE.jpg?s=128&g=1", "display_name": "dakaiju", "link": "https://stackoverflow.com/users/241660/dakaiju"}, "edited": false, "score": 0, "creation_date": 1451354409, "post_id": 34503316, "comment_id": 56748802, "body": "Yes! &quot;auto-dereferencing of pointers&quot; is exactly the keyword that I wanted to search for but did not know.  Your answer is very helpful and clear.   Thank you."}, {"owner": {"reputation": 9641, "user_id": 311901, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/ae735b7993ad5c05647c98c509a2a765?s=128&d=identicon&r=PG", "display_name": "Jordan Feldstein", "link": "https://stackoverflow.com/users/311901/jordan-feldstein"}, "edited": false, "score": 1, "creation_date": 1458511327, "post_id": 34503316, "comment_id": 59880431, "body": "For someone who is less familiar with Go, and pointers/refs in general, can this be explained in layman&#39;s terms? What are the practical implications?"}], "tags": [], "owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "is_accepted": true, "score": 9, "last_activity_date": 1451354384, "last_edit_date": 1451354384, "creation_date": 1451353621, "answer_id": 34503316, "question_id": 34503284, "link": "https://stackoverflow.com/questions/34503284/difference-between-golang-struct-literals-pointers-when-accessing-struct-field/34503316#34503316", "title": "Difference between Golang struct literals &amp; pointers when accessing struct fields", "body": "<p><code>u</code> is a variable of type <code>Person</code>. <code>p</code> is a variable of type \"pointer to <code>Person</code>\", and it is initialized with the address of an anonymous (\"temporary\") object. The expression <code>p.Name</code> uses auto-dereferencing of pointers and is equivalent to <code>(*p).Name</code>. The object that <code>p</code> points to lives as long as <code>p</code> points to it and may thereafter be destroyed by Go's non-deterministic memory manager.</p>\n\n<p>Both <code>p.Name</code> and <code>u.Name</code> are expressions of type <code>string</code>, and they're not \"passed by pointer\" since their address is not taken in the call. In the case of <code>fmt.Println</code>, the value is actually passed \"by interface\" using Go's structural subtyping form of ad-hoc polymorphism.</p>\n"}], "owner": {"reputation": 479, "user_id": 241660, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/QaBiE.jpg?s=128&g=1", "display_name": "dakaiju", "link": "https://stackoverflow.com/users/241660/dakaiju"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1024, "favorite_count": 1, "accepted_answer_id": 34503316, "answer_count": 1, "score": 2, "last_activity_date": 1451354384, "creation_date": 1451353382, "question_id": 34503284, "link": "https://stackoverflow.com/questions/34503284/difference-between-golang-struct-literals-pointers-when-accessing-struct-field", "title": "Difference between Golang struct literals &amp; pointers when accessing struct fields", "body": "<p>I don't understand the difference between a struct literal and a struct pointer <strong>when accessing struct fields</strong>. Is there any different internal behavior ?</p>\n\n<pre><code>type Person struct {\n    Name string\n}\n\np := &amp;Person{Name: \"Alice\"}\nu := Person{Name: \"Bob\"}\n\nfmt.Println(p.Name)  // any difference ?\nfmt.Println(u.Name)  // any difference ?\n</code></pre>\n\n<p>I searched for this but posts I found all explain about difference between value &amp; pointer, or \"passing a value\" vs \"passing a pointer\" to a method. They are not what I want to know.</p>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1451352724, "last_edit_date": 1451352724, "creation_date": 1451352225, "answer_id": 34503167, "question_id": 34502933, "link": "https://stackoverflow.com/questions/34502933/go-routine-not-receiving-all-data-sent-through-channel-toy-example-program/34503167#34503167", "title": "Go routine not receiving all data sent through channel -- toy example program", "body": "<p>There are a couple of issues with this code:</p>\n\n<ul>\n<li>The program terminates when main returns. It does not wait for the <code>run</code> and <code>receive</code> goroutines to complete.</li>\n<li>There's a race on closing the channels. There's no guarantee that the sender will top sending before the timeout. </li>\n<li>If main does not exit, then the <code>for { select { } }</code> loops will spin forever printing zero values. Receive on a closed channel returns the zero value. </li>\n</ul>\n"}], "owner": {"reputation": 677, "user_id": 764384, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/7792c766c5034f2d1322b38d9ed1bad0?s=128&d=identicon&r=PG", "display_name": "slmyers", "link": "https://stackoverflow.com/users/764384/slmyers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 34503167, "answer_count": 1, "score": 0, "last_activity_date": 1451352724, "creation_date": 1451350240, "question_id": 34502933, "link": "https://stackoverflow.com/questions/34502933/go-routine-not-receiving-all-data-sent-through-channel-toy-example-program", "title": "Go routine not receiving all data sent through channel -- toy example program", "body": "<p>I'm just playing around with <code>Go</code>, taking it for a test drive so to speak. I'm having a problem where a go routine that is mean to receive <code>3</code> integers only seems to receive one.  </p>\n\n<pre><code>type simpleFunction func() int\n\nfunc run(fChan chan simpleFunction, result chan int) {\n  for{\n    select {\n    case fn := &lt;-fChan:\n      fmt.Printf(\"sending: %d down result chan\\n\", fn())\n      result &lt;- fn()\n    case &lt;-time.After(time.Second * 2):\n      close(fChan)\n    }\n  }\n}\n\nfunc recieve(result chan int){\n  for {\n    select {\n    case x := &lt;-result:\n      fmt.Printf(\"recieved: %d from result chan\\n\", x)\n    case &lt;-time.After(time.Second * 2):\n      close(result)\n    }\n  }\n}\n</code></pre>\n\n<p>So, as you can see the <code>run</code> routine receives functions, evaluates them, and then sends the result down the <code>result</code> channel.</p>\n\n<p>Here's my <code>main</code>/<code>test</code>:</p>\n\n<pre><code>func main() {\n  fns := []simpleFunction{\n    func() int {return 1},\n    func() int {return 2},\n    func() int {return 3},\n  }\n\n  fChan := make(chan simpleFunction)\n  result := make(chan int)\n\n  go run(fChan, result)\n  go recieve(result)\n  for _, fn := range fns {\n    fmt.Printf(\"sending a function that returns: %d down function chan\\n\", fn())\n    fChan &lt;- fn\n  }\n} \n</code></pre>\n\n<p>And here's my output: </p>\n\n<pre><code>sending a function that returns: 1 down function chan\nsending: 1 down result chan\nrecieved: 1 from result chan\nsending a function that returns: 2 down function chan\nsending a function that returns: 3 down function chan\nsending: 2 down result chan\nsending: 3 down result chan\n</code></pre>\n\n<p>So, as you can see, everything seems to go swimmingly for the first function, but it's not so hot afterwards. Any tips or suggestions? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1451362595, "post_id": 34502647, "comment_id": 56750621, "body": "The only way that &quot;first&quot; can be in scope in mypackage is if it&#39;s imported as a package called first or defined in the mypackage package. So if you have your heart set on first.Invalid then you either need to have a first package or define first as a struct in mypackage."}, {"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1451364421, "post_id": 34502647, "comment_id": 56751052, "body": "You <i>could</i> nest all your const packages within a super package and run the tests on that one. What is the use case though?"}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1451366531, "post_id": 34502647, "comment_id": 56751639, "body": "Is picking a unique prefix for each group of constants that big a dea?  If you were using C++11 enum classes, you&#39;d also need to come up with names for each of those classes."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1451368454, "post_id": 34502647, "comment_id": 56752291, "body": "What&#39;s wrong with the obvious: use <code>First_Invalid</code> instead of <code>First.Invalid</code>?"}, {"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "reply_to_user": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1451396694, "post_id": 34502647, "comment_id": 56765465, "body": "@voutasaurus The use case is an implementation of HL7 FHIR in Go. The XML Schema definition has about 100 simple types with enums that are most naturally implemented as consts in Go. Because instances of the classes built on top of these enums need to be parsed from both XML and JSON, I need to recognize them as strings as well   How would that nesting work? It sounds promising."}, {"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1451421585, "post_id": 34502647, "comment_id": 56778638, "body": "From what I&#39;ve just read all codes in HL7 FHIR come with namespaces. So it&#39;s probably worth matching that here in some fashion. For nesting it&#39;s worth considering making two interfaces, one containing a method <code>Code() string</code> and another containing <code>Val() int</code> and then making first.Code and first.Val types with methods matching those interfaces (Code for Val and Val for Code). Then in the super package where you define the interface type you can write functions manipulating objects of Coder and Valer type, in particular testing functions."}, {"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "reply_to_user": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1451434544, "post_id": 34502647, "comment_id": 56783820, "body": "@voutasaurus Would you care to put some of these thoughts into an answer, so that I can give you credit for it?"}], "answers": [{"tags": [], "owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "is_accepted": true, "score": 0, "last_activity_date": 1451442768, "last_edit_date": 1451442768, "creation_date": 1451441251, "answer_id": 34521980, "question_id": 34502647, "link": "https://stackoverflow.com/questions/34502647/multiple-sets-of-const-names-with-scope-in-go/34521980#34521980", "title": "Multiple sets of const names with scope in Go", "body": "<p>You could have separate packages for your separate code sets and a single package for defining the higher level functionality associated with codes and write tests for that higher level package.</p>\n\n<p>I haven't compiled or tested any of this:</p>\n\n<p>E.g. for a code set:</p>\n\n<pre><code>package product // or whatever namespace is associated with the codeset\n\ntype Const int\n\nconst (\n    ONE Const = iota\n    TWO\n    ...\n    INVALID = -1\n)\n\nfunc (c Const) Code() string {\n    return intToCode(int(c)) // internal implementation\n}\n\ntype Code string\n\nconst (\n     STR_ONE Code = \"ONE\"\n     ...\n)\n\nfunc (c Code) Const() int {\n    return codeToInt(string(c)) // internal implementation\n}\n</code></pre>\n\n<p>E.g. for the higher level functions package:</p>\n\n<pre><code>// codes.go\npackage codes\n\ntype Coder interface{\n    Code() string\n}\n\ntype Conster interface{\n    Const() int\n}\n\nfunc DoSomething(c Coder) string {\n    return \"The code is: \" + c.Code()\n}    \n\n// codes_product_test.go\npackage codes\n\nimport \"product\"\n\nfunc TestProductCodes(t *testing.T) {\n    got := DoSomething(product.ONE) // you can pass a product.Const as a Coder\n    want := \"The code is: ONE\"\n    if got != want {\n        t.Error(\"got:\", got, \"want:\", want)\n    }\n}\n</code></pre>\n\n<p><strong>Edit:</strong></p>\n\n<p>To retrieve the const for a particular code you could do something like</p>\n\n<pre><code>product.Code(\"STRCODE\").Const()\n</code></pre>\n\n<p>Maybe it's better if <code>Const()</code> returns a <code>Coder</code> so that <code>product.Code(\"ONE\").Const()</code> can be a <code>product.Const</code>. I think if you play around with it there are a few options and there will be a good one in there somewhere.</p>\n"}], "owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1623, "favorite_count": 0, "accepted_answer_id": 34521980, "answer_count": 1, "score": 0, "last_activity_date": 1451442768, "creation_date": 1451347904, "last_edit_date": 1451396847, "question_id": 34502647, "link": "https://stackoverflow.com/questions/34502647/multiple-sets-of-const-names-with-scope-in-go", "title": "Multiple sets of const names with scope in Go", "body": "<p>I have a Go application that requires an unbounded number of sets of constants. The application also requires that I be able to map strings to (integer) consts, and vice versa at runtime. The names of the constants are guaranteed only to be valid identifiers, so it's a near certainty that there will be duplicate const names. In particular, each set of constants has an element called \"Invalid\". In C++11, I'd use enum classes to achieve scope. In Python, I'd probably use class variables. I'm struggling to find an idiomatic way to express this in Go. Options that I've looked at include:</p>\n\n<ul>\n<li>Using a separate package for every set of consts. This has lots of disadvantages, because I'd rather the whole set be in the same package so that I can build support for these sets at the package level, and so that I can test the whole lot without overly complicating the test code to do multi-package testing at once.</li>\n</ul>\n\n<p><code>first.go</code>:</p>\n\n<pre><code>package first\ntype First int\nconst (\n    ConstOne First = iota\n    ConstTwo\n    Invalid = -1\n)\n\nfunc IntToCode(fi First)string { ... }\nfunc CodeToInt(code string)First { ... }\n</code></pre>\n\n<p><code>second.go</code>:</p>\n\n<pre><code>package second\ntype Second int\nconst (\n    ConstOne Second = iota\n    ConstTwo\n    Invalid = -1\n)\n\nfunc IntToCode(se Second)string { ... }\nfunc CodeToInt(code string)Second { ... }\n</code></pre>\n\n<p><code>example.go</code>:</p>\n\n<pre><code>import (\n    \"first\"\n    \"second\"\n)\n\nFirst fi = first.CodeToInt(\"ConstOne\")\nSecond se = second.Invalid\n</code></pre>\n\n<ul>\n<li>Using the tried-and-true technique of a globally unique prefix for each const. Given, though, that the number of sets is really big, having to essentially invent and manage a bunch of namespaces using a coding convention is awkward at best. This option also forces me to modify the names of the consts (which is the whole point of using them).</li>\n</ul>\n\n<p><code>first.go</code>:</p>\n\n<pre><code>package mypackage\n\ntype First int\n\nconst (\n    FI_CONSTONE First = iota\n    FI_CONSTTWO\n    FI_INVALID = -1\n)\n\nfunc IntToCode(fi First)string { ... }\nfunc CodeToInt(code string)First { ... }\n</code></pre>\n\n<p><code>second.go</code>:</p>\n\n<pre><code>package mypackage\n\ntype Second int\n\nconst (\n    SE_CONSTONE Second = iota\n    SE_CONSTTWO\n    SE_INVALID = -1\n)\n\nfunc IntToCode(se Second)string { ... }\nfunc CodeToInt(code string)Second { ... }\n</code></pre>\n\n<p><code>example.go</code>:</p>\n\n<pre><code>package mypackage\n\nimport (\n    \"first\"\n    \"second\"\n)\n\nFirst fi = first.CodeToInt(\"ConstOne\")\nSecond se = SE_INVALID\n</code></pre>\n\n<p>What's a better, more idiomatic solution? I'd love to be able to say things like:</p>\n\n<pre><code>First fi = First.Invalid\n</code></pre>\n\n<p>but I haven't been successful in coming up with an approach that allows this.</p>\n"}, {"tags": ["multithreading", "go", "pthreads", "cpu", "goroutine"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1451339710, "post_id": 34501210, "comment_id": 56744386, "body": "The scheduler runs when your goroutine is blocked from working (like when waiting for I/O or on a channel/<code>sync</code> operation), and occasionally when you call a function. Some scheduling choices are pseudorandom (it&#39;s explicit in the spec for the <code>select</code> statement) so no, you&#39;re not guaranteed the same results for repeat runs if running with <code>GOMAXPROCS=1</code>."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1451339944, "post_id": 34501210, "comment_id": 56744489, "body": "You also don&#39;t want to rely on any of that; how the scheduler works now isn&#39;t necessarily how it&#39;ll work in the future. You might find <a href=\"http://stackoverflow.com/questions/34192352/are-channel-sends-preemption-points-for-goroutine-scheduling/34192397#34192397\">this recent question</a> relevant on that front."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451339991, "post_id": 34501210, "comment_id": 56744516, "body": "Goroutines themselves aren&#39;t deterministic, if that&#39;s what you&#39;re asking. They also have nothing to do with os threads, pthreads or cpus . Unless you have a specific question, asking for a full rundown of the current gc scheduler implementation isn&#39;t really a valid SO question."}, {"owner": {"reputation": 19270, "user_id": 5501675, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9ea71bcc6b5c512a7d15da82db05f2ab?s=128&d=identicon&r=PG&f=1", "display_name": "Curious", "link": "https://stackoverflow.com/users/5501675/curious"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451340533, "post_id": 34501210, "comment_id": 56744760, "body": "@JimB Since I asked an implementation question I think Goroutines do have a lot to do with pthreads in that on most systems a CPU in Go is implemented as a pthread and different Goroutines are multiplexed on that cpu. I am in the process of implementing a weird (because I made all the design decisions) thread library and I was looking for a really high level explanation of how Go does this for inspiration."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1451342459, "post_id": 34501210, "comment_id": 56745475, "body": "You seem to understand that M goroutines are cooperatively scheduled over N os threads. Are you looking for the actual implementation details? Does something like this help? <a href=\"http://www.cs.columbia.edu/~aho/cs6998/reports/12-12-11_DeshpandeSponslerWeiss_GO.pdf\" rel=\"nofollow noreferrer\">cs.columbia.edu/~aho/cs6998/reports/&hellip;</a> (the overview is the same, but as with all implementation details, the implementation changes and this is out of date)"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1451362144, "post_id": 34501210, "comment_id": 56750542, "body": "You might also be interested in the source of <a href=\"https://github.com/sustrik/libmill\" rel=\"nofollow noreferrer\">libmill</a>, which aims for Go-like concurrency in C, or <a href=\"https://github.com/golang/go/tree/master/src/runtime\" rel=\"nofollow noreferrer\">Go&#39;s runtime</a>. &quot;How exactly are goroutines scheduled?&quot; is the sort of prompt that one could likely write a fascinating series of blog posts or a solid conference talk about, but in looking into that general question or working on your library, you might have specific questions that are a good size for Stack Overflow."}, {"owner": {"reputation": 19270, "user_id": 5501675, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9ea71bcc6b5c512a7d15da82db05f2ab?s=128&d=identicon&r=PG&f=1", "display_name": "Curious", "link": "https://stackoverflow.com/users/5501675/curious"}, "edited": false, "score": 0, "creation_date": 1451369342, "post_id": 34501210, "comment_id": 56752561, "body": "Thank you! I will look into these things! I have been since yesterday :) I will close the question soon. Just want to wait to see if someone else has something to say"}], "owner": {"reputation": 19270, "user_id": 5501675, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9ea71bcc6b5c512a7d15da82db05f2ab?s=128&d=identicon&r=PG&f=1", "display_name": "Curious", "link": "https://stackoverflow.com/users/5501675/curious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 621, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1451339017, "creation_date": 1451339017, "question_id": 34501210, "link": "https://stackoverflow.com/questions/34501210/how-goroutine-scheduling-works", "title": "How goroutine scheduling works", "body": "<p>How exactly are goroutines scheduled? Is it some sort of function interception mechanism? Also if I run the program on one CPU will the results be the same if I run the program twice?</p>\n"}, {"tags": ["dictionary", "data-structures", "struct", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1451335975, "post_id": 34500527, "comment_id": 56742715, "body": "I might work on an answer if I have a bit more time later but a few things that might help... Firstly there is no dictionary type in Go, it&#39;s a map, secondly the data you have in plain text is not consistent with the map type. You said you have a dictionary with a single key with a collection of dictionaries? No you don&#39;t. The <code>foobar_openx</code> has an object for the value and that object contains two unnamed objects. You don&#39;t have keys, so you certainly don&#39;t have a map. The nearest structure to what you posted is an array or slice."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1451336183, "post_id": 34500527, "comment_id": 56742790, "body": "Sorry you are correct, I&#39;m away Go uses maps, my think dictionary when I&#39;m playing with maps (key: value).  In python my values would be a collection of dictionaries, where each dictionary has a key that is the hour and value of impressions.  So i&#39;ll fix the structure right now, I see my mistake.  Even so, that was a typing error i&#39;m my part, the go code doesn&#39;t reflect that."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1451336190, "post_id": 34500527, "comment_id": 56742794, "body": "The inner most objects should just be <code>type Views struct { hours, impressions int }</code> and <code>foobar_openx</code> should just be a slice or array of that type; <code>[]Views</code>. Are you trying to parse the data you posted? Is there a reason you&#39;re not just using json? Why that format? It is similar to json but I don&#39;t believe that is valid json (neither a dictionary nor an array therefor you&#39;re missing keys for values)."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1451336324, "post_id": 34500527, "comment_id": 56742854, "body": "I suppose i&#39;m not using a Json because Python dictionaries and Json are near identical in structure.  The format is important because the end result will be to interact with a python created mongo collection."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1451336335, "post_id": 34500527, "comment_id": 56742857, "body": "Python collections follow very loose conventions, collections in Go do not. You&#39;re never going to store that data in a map because you do not have keys for the inner most objects. The inner objects could be represented as a map, but why? All that does is make it so you have to add error checking every where you do access or risk a runtime error when data is absent."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1451336491, "post_id": 34500527, "comment_id": 56742926, "body": "There is a mongo package for Go. JSON is just a format for representing data, it has no connection to dictionaries in Python. The Python type is accepting of just about anything, it would benefit you to understand the json&#39;s structure specifically because once again, even in json it is not a dictionary. They have arrays and dictionaries and objects, and what you have in json and in Go is never a dictionary."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1451336497, "post_id": 34500527, "comment_id": 56742931, "body": "The structure I portrayed above is exactly how it looks in the python version of the script, I suppose then that I need help creating the equivocalancy in Go.. or as close to that as possible"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1451336719, "post_id": 34500527, "comment_id": 56743036, "body": "No offense but you simply need to learn about data structures because the thing you&#39;re referring to in Python again, is very fast and loose with it&#39;s conventions and clearly you don&#39;t actually understand the structure of your data which is going to be necessary in Go because it&#39;s conventions are strict, as are json&#39;s. The structure you portrays above is a text representation of data and in no way corresponds to how that data is represented in a program. The collection you&#39;re using in Python is super abstracted, there&#39;s a lot more to it than what you posted above, that&#39;s what it prints for you."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1451336865, "post_id": 34500527, "comment_id": 56743096, "body": "No offense taken, I work with data structures all day in python and javascript.  I just moved to go, so it&#39;s more of a syntactical thing then my knowledge.  I updated the data structure above, to reflect what i&#39;m trying to get done.  I assume the closest thing in go is something like this var data = make(map[string]map[string]int)...which i&#39;ve tried...but i can&#39;t seem to get right"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1451337539, "post_id": 34500527, "comment_id": 56743393, "body": "Taking this out with you, I think I see what I did wrong. I&#39;m going to try it  hour := m \t\t\t\tdata[taghash] = make(map[string]int) \t\t\t\tdata[taghash][hour]++"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1451337601, "post_id": 34500527, "comment_id": 56743421, "body": "No sorry you&#39;re not getting it... JavaScript and Python are dynamically typed languages and the collections you work with are ubiquitous and work for everything, this is not the case in Go. It&#39;s not just syntax. The collection in Python has features of arrays, linked lists, and dictionaries all in one and you can store pretty much anything in it. In Go things are explicit. You need to know the structure of the data in a more descriptive manner in order to represent it in code, you can&#39;t just declare the end all be all of types and say &quot;Read data&quot; and have it work."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1451338657, "post_id": 34500527, "comment_id": 56743916, "body": "Okay I made some updates to my code, I&#39;m going to post them in a second...hopefully something can help with that."}], "answers": [{"comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1451339598, "post_id": 34501292, "comment_id": 56744341, "body": "I&#39;ve changed the structure of the code.  I also, don&#39;t know the cap, so the code would have to go to handle an unknown amount of data (grow on it&#39;s own.)"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1451339641, "post_id": 34501292, "comment_id": 56744359, "body": "@msanti it does, <code>cap</code> is just an efficiency issue with slices. There&#39;s a cost to growing the slice (since it has to allocate a new backing array)"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1451339876, "post_id": 34501292, "comment_id": 56744456, "body": "also, each hour should be it&#39;s own key. so that it can be accessed like data[taghash][hour] -&gt; impression #,  the code i&#39;ve posted above provides the structure I just need to figure out why its not adding values correctly."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1451341228, "post_id": 34501292, "comment_id": 56745005, "body": "Note that I agree completely with @evanmcdonnal in the question comments that your data structure could use work. This should do lookups to <code>hash+hour -&gt; views</code> very quickly, but only if you already have a hash and hour. Actually pulling data out of this map will be very difficult compared to Python."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1451404247, "post_id": 34501292, "comment_id": 56769521, "body": "Thank for you&#39;re help. Could you explain this line to me if _, ok := data[taghash]; !ok, logically it makes sense, but i&#39;m new to go and i&#39;ve no come across this syntax before."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 1, "creation_date": 1451407038, "post_id": 34501292, "comment_id": 56771157, "body": "@msanti there&#39;s a couple things going on there. There&#39;s the <code>if &lt;initialization statement&gt;; &lt;condition&gt; {...}</code> syntax and there&#39;s the <code>value, ok := mapping[key]</code> syntax. The former allows you to write a statement to initialize the <code>if</code> block (not unlike the first statement in a <code>for i:=0; i &lt; 10; i++</code> block. The latter lets you pull the value from a mapping and ensure that it exists by checking <code>ok</code>. We don&#39;t actually care about the value here, so we use the empty variable to blank it."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1451407527, "post_id": 34501292, "comment_id": 56771460, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/99229/discussion-between-adam-smith-and-msanti\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 1, "last_activity_date": 1451348876, "last_edit_date": 1451348876, "creation_date": 1451339425, "answer_id": 34501292, "question_id": 34500527, "link": "https://stackoverflow.com/questions/34500527/nested-dictionaries-golang-trouble/34501292#34501292", "title": "Nested Dictionaries Golang Trouble", "body": "<p>The error comes from</p>\n\n<pre><code>data[taghash] = make(map[string]int)\n</code></pre>\n\n<p>This sets <code>data[taghash]</code> to a newly allocated map every time through. That's definitely not what you're trying to do. Instead:</p>\n\n<pre><code>if _, ok := data[taghash]; !ok {\n    // data[taghash] does not exist -- create it!\n    data[taghash] := make(map[string]int)\n}\ndata[taghash][hour]++\n</code></pre>\n\n<p>This is equivalent to:</p>\n\n<pre><code># Python\ndata.setdefault(taghash, {}).setdefault(hour, 0) += 1\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>if taghash not in data:\n    data[taghash] = {}\nif hour not in data[taghash]:\n    data[taghash][hour] = 1\nelse:\n    data[taghash][hour] += 1\n</code></pre>\n"}], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1371, "favorite_count": 0, "accepted_answer_id": 34501292, "answer_count": 1, "score": -1, "last_activity_date": 1451348876, "creation_date": 1451335565, "last_edit_date": 1451339372, "question_id": 34500527, "link": "https://stackoverflow.com/questions/34500527/nested-dictionaries-golang-trouble", "title": "Nested Dictionaries Golang Trouble", "body": "<p>Go Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    _ \"bytes\"\n    \"fmt\"\n    _ \"io\"\n    \"log\"\n    \"os\"\n    \"os/user\"\n    \"path/filepath\"\n    _ \"reflect\"\n    \"regexp\"\n    \"runtime\"\n    \"strconv\"\n    \"strings\"\n    \"sync\"\n    \"time\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/s3\"\n    \"github.com/aws/aws-sdk-go/service/s3/s3manager\"\n)\n\nvar (\n    LocalDirectory   = \"s3logs\" // Into this directory\n    Lock             sync.Mutex\n    totalImpressions int\n)\n\nvar data = make(map[string]map[string]int)\n\nfunc main() {\n    start := time.Now()\n    // by adding this line i'm telling the program to run the threads on 4 different cores at the same time, Parallelism!!\n    //REMEMBER TO ADD BLOCKS TO STOP RACE CONDITIONS\n    runtime.GOMAXPROCS(4)\n    var wg sync.WaitGroup\n\n    var year, month, day = time.Now().Date()\n    str_year := strconv.Itoa(year)\n    str_month := strconv.Itoa(int(month))\n    str_day := strconv.Itoa(day)\n\n    if int(month) &lt; 10 {\n        str_month = \"0\" + strconv.Itoa(int(month))\n    }\n    if day &lt; 10 {\n        str_day = \"0\" + strconv.Itoa(day)\n    }\n\n    regBuckets := map[string]string{\n        \"us-west-1\": \"pubgears-ca\",\n        \"test\":      \"test\",\n    }\n\n    for region, bucket := range regBuckets {\n        prefix := fmt.Sprintf(\"tagserver/logs/AWSLogs/978380792767/elasticloadbalancing/%s/%s/%s/%s/\", region, str_year, str_month, str_day)\n        wg.Add(1)\n        go getLogs(region, bucket, LocalDirectory+bucket, &amp;prefix, &amp;wg)\n    }\n    wg.Wait()\n\n    //salon/t1/728x90/index\n    //totalImpressions := 0\n    // var provider = make(map[string]int)\n    // for key, value := range data {\n    //   key = strings.TrimSpace(key)\n    //   pro := strings.Split(key, \"_\")[3]\n    //\n    //   if strings.Contains(pro, \"pp\") == true || (pro == \"pulsepoint\") || (pro == \"cweb\") {\n    //     provider[\"pulsepoint\"] += value\n    //   } else if (pro == \"openx\") || (pro == \"openx3\") {\n    //     provider[\"openx\"] += value\n    //   } else if key == \" \" {\n    //     continue\n    //   } else {\n    //     provider[pro] += value\n    //   }\n    //   totalImpressions += value\n    // }\n\n    for tag, value := range data {\n        for hour, imp := range value {\n            fmt.Printf(\"tag: %s  \\n hour: %s impression %s\\n\", tag, hour, imp)\n        }\n    }\n\n    //sl = sl[:len(sl)-1]\n\n    elapsed := time.Since(start)\n    fmt.Printf(\"\\nTime took %s\\n\", elapsed)\n\n}\n\nfunc getLogs(region string, bucket string, directory string, prefix *string, wg *sync.WaitGroup) {\n    sess := session.New()\n    client := s3.New(sess, &amp;aws.Config{Region: aws.String(region)})\n\n    params := &amp;s3.ListObjectsInput{Bucket: &amp;bucket, Prefix: prefix}\n    manager := s3manager.NewDownloaderWithClient(client, func(d *s3manager.Downloader) {\n        d.PartSize = 5 * 1024 * 1024 // 6MB per part\n        d.Concurrency = 4\n    })\n    d := downloader{bucket: bucket, dir: directory, Downloader: manager}\n    client.ListObjectsPages(params, d.eachPage)\n    wg.Done()\n}\n\n// downloader object and methods\ntype downloader struct {\n    *s3manager.Downloader\n    bucket, dir string\n}\n\nfunc (d *downloader) eachPage(page *s3.ListObjectsOutput, more bool) bool {\n    for _, obj := range page.Contents {\n        // fmt.Println(obj)\n        //     return true\n        d.downloadToFile(*obj.Key)\n    }\n    return true\n}\n\nfunc (d *downloader) downloadToFile(key string) {\n    // Create the directories in the path\n    // desktop path\n    user, errs := user.Current()\n    if errs != nil {\n        panic(errs)\n    }\n    homedir := user.HomeDir\n    desktop := homedir + \"/Desktop/\" + d.dir\n    file := filepath.Join(desktop, key)\n    if err := os.MkdirAll(filepath.Dir(file), 0775); err != nil {\n        panic(err)\n    }\n\n    // Setup the local file\n    fd, err := os.Create(file)\n    if err != nil {\n        panic(err)\n    }\n    defer fd.Close()\n\n    // Download the file using the AWS SDK\n    //fmt.Printf(\"Downloading s3://%s/%s to %s...\\n\", d.bucket, key, file)\n    params := &amp;s3.GetObjectInput{Bucket: &amp;d.bucket, Key: &amp;key}\n    d.Download(fd, params)\n    _, e := d.Download(fd, params)\n    if e != nil {\n        panic(e)\n    }\n\n    f, err := os.Open(file)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer f.Close()\n\n    tag := regexp.MustCompile(\"/([a-zA-Z0-9_]+/{1}[a-zA-Z0-9_]+/{1}[a-zA-Z0-9_]+/{1}[a-zA-Z0-9_]+)\")\n    date := regexp.MustCompile(\"T([^:]+)\")\n    scanner := bufio.NewScanner(f)\n\n    // HAVING TROUBLE HERE\n    for scanner.Scan() {\n        //dateCollection := make(map[string]int)\n        m := tag.FindString(scanner.Text())\n        if m != \"\" {\n            // stop races\n            Lock.Lock()\n            arr := strings.Split(m, \"/\")\n            taghash := strings.Join(arr, \"_\")\n            taghash = strings.TrimLeft(taghash, \"_\")\n            //data[taghash]++\n            m = date.FindString(scanner.Text())\n            if m != \"\" {\n                hour := m\n                data[taghash] = make(map[string]int)\n                data[taghash][hour]++\n            }\n            Lock.Unlock()\n        }\n    }\n    fmt.Println(file)\n    os.Remove(file)\n    if err := scanner.Err(); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>The area i'm having trouble at starts on line 167 section below:</p>\n\n<pre><code>for scanner.Scan() {\n        //dateCollection := make(map[string]int)\n        m := tag.FindString(scanner.Text())\n        if m != \"\" {\n            // stop races\n            Lock.Lock()\n            arr := strings.Split(m, \"/\")\n            taghash := strings.Join(arr, \"_\")\n            taghash = strings.TrimLeft(taghash, \"_\")\n            //data[taghash]++\n            m = date.FindString(scanner.Text())\n            if m != \"\" {\n                hour := m\n                data[taghash] = make(map[string]int)\n                data[taghash][hour]++\n            }\n            Lock.Unlock()\n        }\n    }\n    fmt.Println(file)\n    os.Remove(file)\n    if err := scanner.Err(); err != nil {\n        log.Fatal(err)\n    }\n</code></pre>\n\n<p>The output i'm getting when I print the values in the main func</p>\n\n<pre><code>fstvt1_ros_300x600_pp8_1 T07 1\n</code></pre>\n\n<p>I'm expecting an output that looks something like this:</p>\n\n<pre><code>fstvt1_ros_300x600_pp8_1\nT00 213434\nT01 23432\nT02 3324\nT03 324\nT04 324\nT05 0 ...\n(this isn't real data)\n</code></pre>\n\n<p><strong>What I'm trying to do:</strong>\nI have a map of data <code>var data = make(map[string]map[string]int)</code> whose key is equal to a taghash, e.g. <code>fstvt1_ros_300x600_pp8_1</code>. The value is a map of data.  The key value of that map is expected to be a string and an integer. I want multiple maps.  One for each key... T01, T02..  What is currently outputted is the last item in the last of items i'm iterating on instead of a collection of keys and values for each taghash.  How do i make is so that instead of overwriting the data, it adds the new key Value T01, T02.. and if the taghash and hour are the some to increment that particular object.</p>\n\n<p>Line of code i'm currently using:</p>\n\n<p>T01, T02..</p>\n\n<pre><code>data[taghash][hour]++\n</code></pre>\n\n<p>Where the if the taghash and hour exist then it should increment.  If the taghash and hour doesn't exist then create the taghash and add the new key and increment.</p>\n"}, {"tags": ["go", "architecture", "restful-architecture"], "answers": [{"tags": [], "owner": {"reputation": 599, "user_id": 4327041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ZbnQ.jpg?s=128&g=1", "display_name": "abm", "link": "https://stackoverflow.com/users/4327041/abm"}, "is_accepted": false, "score": 4, "last_activity_date": 1451346212, "creation_date": 1451346212, "answer_id": 34502434, "question_id": 34499144, "link": "https://stackoverflow.com/questions/34499144/clean-and-generic-project-structure-for-go-applications-and-mongodb/34502434#34502434", "title": "Clean and generic project structure for GO applications and mongodb", "body": "<p>I've also struggled about how to structure my Go web APIs in the past and don't know any web resources that tell you exactly how to write a Go web API. </p>\n\n<p>What I did was just check out other projects on Github and try out how they structured their code, for example, the <a href=\"https://github.com/docker/docker\" rel=\"nofollow\">Docker</a> repo has very idomatic Go code on it's API. </p>\n\n<p>Also, <a href=\"http://beego.me/docs/intro/#the-project-structure-of-beego\" rel=\"nofollow\">Beego</a> is a RESTful framework that generates the project structure for you in a MVC way and according to their <a href=\"http://beego.me/docs/intro/#what-is-beego%3F\" rel=\"nofollow\">docs</a>, it can also be used for APIs.</p>\n"}, {"tags": [], "owner": {"reputation": 438, "user_id": 5378868, "user_type": "registered", "profile_image": "https://graph.facebook.com/135713123447192/picture?type=large", "display_name": "Ozzadar", "link": "https://stackoverflow.com/users/5378868/ozzadar"}, "is_accepted": false, "score": 4, "last_activity_date": 1452008575, "creation_date": 1452008575, "answer_id": 34615598, "question_id": 34499144, "link": "https://stackoverflow.com/questions/34499144/clean-and-generic-project-structure-for-go-applications-and-mongodb/34615598#34615598", "title": "Clean and generic project structure for GO applications and mongodb", "body": "<p>I've been building a web APIs in golang for a little while now. </p>\n\n<p>You'll have to do some research but I can give you some starting points:</p>\n\n<ol>\n<li><a href=\"https://www.gitbook.com/book/codegangsta/building-web-apps-with-go/details\" rel=\"nofollow\">Building Web Apps with Go</a> -- ebook</li>\n<li>github.com/julienschmidt/httprouter -- for routing addresses</li>\n<li>github.com/unrolled/render/ -- for rendering various forms of responses(JSON, HTML, etc..)</li>\n<li>github.com/dgrijalva/jwt-go -- JSON Web Tokens</li>\n<li>www.gorillatoolkit.org/pkg/sessions -- Session Management</li>\n</ol>\n\n<p>And for reference on how some things work together in the end:</p>\n\n<p><a href=\"http://github.com/superordinate/kDaemon\" rel=\"nofollow\">Go Web API Repo</a> -- personal project</p>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 3, "last_activity_date": 1452037235, "creation_date": 1452037235, "answer_id": 34623245, "question_id": 34499144, "link": "https://stackoverflow.com/questions/34499144/clean-and-generic-project-structure-for-go-applications-and-mongodb/34623245#34623245", "title": "Clean and generic project structure for GO applications and mongodb", "body": "<p>To my mind Go webapp project folder on production server can looks like on your picture just much simpler. Nothing special in assets structure - Static, Templates, Content, Styles, Img, JSlibs, DBscripts etc. usual folders. Nothing special in WebAPI - as usual you design which URI will respond required functionality and route requests to handlers accordingly. Some specifics - many gophers don't believe in MVC architecture, it's up to you surely. And you deploy one staticaly linked executable without dependencies. In your development environment you structure yours and imported/vendored sorce files in $GOPATH as in stdlib  done but deploy only one executable in production environment, sure with static assets needed. You can see how to orginize Go source packages just in stdlib. Having just one executable what would you structure on production?</p>\n"}, {"tags": [], "owner": {"reputation": 624, "user_id": 1887309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8ba562230112c5953454a7b7ec7acb6?s=128&d=identicon&r=PG", "display_name": "Cedmundo", "link": "https://stackoverflow.com/users/1887309/cedmundo"}, "is_accepted": true, "score": 11, "last_activity_date": 1452195321, "creation_date": 1452195321, "answer_id": 34663665, "question_id": 34499144, "link": "https://stackoverflow.com/questions/34499144/clean-and-generic-project-structure-for-go-applications-and-mongodb/34663665#34663665", "title": "Clean and generic project structure for GO applications and mongodb", "body": "<p>It depends on your own style and rules, in my company, we develop our projects this way:</p>\n\n<ul>\n<li>Configuration is determined by environment variables, so we have a <code>company/envs/project.sh</code> file which has to be evaluated <strong>before</strong> service (outside the project in the image).</li>\n<li>We add a <code>zscripts</code> folder that contains all extra scripts, like adding users or publishing a post. Intended to be used only for debug proposes.</li>\n<li>Data models (entities) are in a package called <code>project/models</code>.</li>\n<li>All controllers and views (HTML templates) are categorized into \"apps\" or \"modules\". We use the REST path as main group delimiter, so path <code>/dogs</code> goes to package <code>project/apps/dogs</code> and <code>/cats</code> to <code>project/apps/cats</code>.</li>\n<li>Managers are in their separated package at project's root <code>project/manager</code>.</li>\n<li>Static files (.css, .png, .js, etc.) are located at <code>project/static/[app/]</code>. Sometimes is required to have the optional <code>[app/]</code> folder, but it only happens when two apps have dashboards or conflicting file names. Most of cases you won't need to use <code>[app/]</code> for static resources.</li>\n</ul>\n\n<p><strong>Managers</strong></p>\n\n<p>We call a manager, a package that contains pure functions which helps apps to perform its task, for example, databases, cache, S3 storage, etc. We initialize each manager calling <code>package.Startup()</code> before we start to listen, and finalize calling <code>package.Finalize()</code> when program is interrupted.</p>\n\n<p>An example of a manager could be <code>project/cache/cache.go</code>:</p>\n\n<pre><code>type Config struct {\n    RedisURL string `envconfig:\"redis_url\"`\n}\n\nvar config Config\nvar client *redis.Client\n\nfunc Startup(c Config) error {\n   config = c\n   client, err := redis.Dial(c.RedisURL)\n   return err\n}\n\nfunc Set(k,v string) error {\n   return client.Set(k, v)\n}\n</code></pre>\n\n<p>in main.go (or your_thing_test.go):</p>\n\n<pre><code>var spec cache.Config\nenvconfig.Process(\"project\", &amp;spec)\n\ncache.Startup(spec)\n</code></pre>\n\n<p>And in a app (or module):</p>\n\n<pre><code>func SetCacheHandler(_ http.ResponseWriter, _ *http.Request){\n   cache.Set(\"this\", \"rocks\")\n}\n</code></pre>\n\n<p><strong>Modules</strong></p>\n\n<p>A module is a container of views and controllers that are isolated from other modules, using our configuration I would recommend to not create dependencies between modules. Modules are also called apps.</p>\n\n<p>Each module configures its routes using a router, sub-router or what your framework provides, for example (file <code>project/apps/dogs/configure.go</code>):</p>\n\n<pre><code>func Configure(e *echo.Echo) {\n    e.Get(\"/dogs\", List)\n}\n</code></pre>\n\n<p>Then, all handlers live in <code>project/apps/dogs/handlers.go</code>:</p>\n\n<pre><code>// List outputs a dog list of all stored specimen.\nfunc List(c *echo.Context) error {\n    // Note the use of models.Xyz\n    var res := make([]models.Dog, 0) // A little trick to not return nil.\n    err := store.FindAll(\"dogs\", nil, &amp;res) // Call manager to find all dogs.\n    // handle error ...\n\n    return c.JSON(200, res) // Output the dogs.\n}\n</code></pre>\n\n<p>Finally you configure the app in main (or in a test):</p>\n\n<pre><code>e := echo.New()\ndogs.Configure(e)\n// more apps\n\ne.Run(\":8080\")\n</code></pre>\n\n<p>Note: for views, you can add them to <code>project/apps/&lt;name&gt;/views</code> folder and configure them the using the same function. </p>\n\n<p><strong>Other</strong></p>\n\n<p>Sometimes we also add a <code>project/constants</code> and a <code>project/utils</code> package.</p>\n\n<p>Here is what it looks like: </p>\n\n<p><a href=\"https://i.stack.imgur.com/55P1p.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/55P1p.png\" alt=\"Example of project structure\"></a></p>\n\n<p>Note that in above sample, <code>templates</code> are separated from apps, thats because its a placeholder, directory is empty.</p>\n\n<p>Hope it was useful. Greetings from M\u00e9xico :D.</p>\n"}, {"tags": [], "owner": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "is_accepted": false, "score": 3, "last_activity_date": 1452477039, "creation_date": 1452477039, "answer_id": 34713038, "question_id": 34499144, "link": "https://stackoverflow.com/questions/34499144/clean-and-generic-project-structure-for-go-applications-and-mongodb/34713038#34713038", "title": "Clean and generic project structure for GO applications and mongodb", "body": "<h1>1. Separation of concerns (SoC)</h1>\n\n<p>I haven't worked with SoC directly, but I have my own pattern. You can adapt to whatever pattern (MVC, your own, etc.).</p>\n\n<p>In my code, I separate my code into different packages:</p>\n\n<pre><code>myprojectname (package main)      \u2014 Holds the very basic setup and configuration/project consts\n  * handlers   (package handlers) \u2014 Holds the code that does the raw HTTP work\n  * models     (package models)   \u2014 Holds the models\n  * apis       (NOT a package)\n    - redis    (package redis)    \u2014 Holds the code that wraps a `sync.Pool`\n    - twilio   (package twilio)   \u2014 Example of layer to deal with external API\n</code></pre>\n\n<p><strong>Notes:</strong></p>\n\n<ol>\n<li>In each package other than main, I have a <code>Setup()</code> function (with relevant arguments) that is called by the main package.</li>\n<li>For the packages under the <code>apis</code> folder, they are often just to initialize external Go libraries. You also can directly import existing libraries into the handlers/models without an <code>apis</code> package.</li>\n<li><p>I setup my mux as an exported global in the <code>handlers</code> package like this...</p>\n\n<pre><code>Router := mux.NewRouter()\n</code></pre>\n\n<p>...and then create a file for each URL (different methods with the same URL are in the same file). In each file, I use Go's <code>init()</code> function, which is ran after global variables are initialized (so it's safe to use the router) but before <code>main()</code> is ran (so it's safe for main to assume everything has been setup). The great thing about <code>init()</code> is that you can have as many of those methods as you want in a single package, so they automatically get ran when the package is imported.</p>\n\n<p>Main then imports <code>myprojectname/handlers</code> and then serves the <code>handlers.Router</code> in main.</p></li>\n</ol>\n\n<h1>2. Dependency Injection and Unity of Work</h1>\n\n<p>I haven't worked with Unity of Work, so I have no idea of possible Go implementations.</p>\n\n<p>For DI, I build an interface that both the real object and the mock objects will implement.</p>\n\n<p>In the package, I add this to the root:</p>\n\n<pre><code>var DatabaseController DatabaseControllerInterface = DefaultController\n</code></pre>\n\n<p>Then, the first line of each test I can change <code>DatabaseController</code> to whatever that test needs. When not testing, the unit tests should not be ran, and it defaults to <code>DefaultController</code>.</p>\n\n<h1>3. Unit Testing</h1>\n\n<p>Go provides a built in testing with the <code>go test package</code> command. You can use <code>go test --cover</code> to also emit a coverage percent. You can even <strong><a href=\"https://blog.golang.org/cover\" rel=\"nofollow\">have coverage displayed in your browser, highlighting the parts that are/aren't covered</a>.</strong></p>\n\n<p>I use the <strong><a href=\"https://github.com/stretchr/testify\" rel=\"nofollow\">testify/assert</a></strong> package to help me with testing where the standard library falls short:</p>\n\n<pre><code>// something_test.go\n//\n// The _test signifies it should only be compiled into a test\n// Name the file whatever you want, but if it's testing code\n// in a single file, I like to do filename_test.go.\n\npackage main\n\nimport (\n    \"testing\"\n\n    \"github.com/stretchr/testify/assert\"\n)\n\nfunc TestMath(t *testing.T) {\n    assert.Equal(t, 3+1, 4)\n}\n</code></pre>\n\n<h1>4. Integration with UI frameworks</h1>\n\n<p>I haven't seen any for Angular. Although I haven't used it, Go has a good <strong><a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow\">template engine built into the standard lib</a>.</strong></p>\n\n<h1>5. RESTful URLs that enables SEO</h1>\n\n<p>Again, I can't help you here. It's up to you: send proper status codes (don't send a 200 with a 404 page as you'll get docked for duplicate pages), don't duplicate pages (pay attention to <code>google.com/something</code> vs <code>google.com/something/</code>; hopefully your framework will not mess this up), don't try to trick the search engine, and so on.</p>\n"}], "owner": {"reputation": 755, "user_id": 1901005, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/ZWY6X.png?s=128&g=1", "display_name": "Chandu", "link": "https://stackoverflow.com/users/1901005/chandu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4758, "favorite_count": 3, "closed_date": 1542602467, "accepted_answer_id": 34663665, "answer_count": 5, "score": 14, "last_activity_date": 1452477039, "creation_date": 1451329238, "question_id": 34499144, "link": "https://stackoverflow.com/questions/34499144/clean-and-generic-project-structure-for-go-applications-and-mongodb", "closed_reason": "Not suitable for this site", "title": "Clean and generic project structure for GO applications and mongodb", "body": "<p>I want to build an API based application using GO and MongoDB. I'm from Asp.net MVC background. Probably if I make an architecture with MVC web application things to be consider are</p>\n\n<ol>\n<li><p>Separation of concerns(SoC)</p>\n\n<ul>\n<li>DataModel</li>\n<li>BusinessEntities</li>\n<li>BusinessServices</li>\n<li>Controllers</li>\n</ul></li>\n<li><p>Dependeny Injection and Unity of Work</p></li>\n<li>Unit Testing\n\n<ul>\n<li>MoQ or nUnit</li>\n</ul></li>\n<li>Integration with UI frameworks\n\n<ul>\n<li>Angularjs or others</li>\n</ul></li>\n<li>RESTful urls that enables SEO</li>\n</ol>\n\n<p>Below architecture could be a solution for my need in MVC based appications</p>\n\n<p><a href=\"https://i.stack.imgur.com/v7Sqo.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/v7Sqo.png\" alt=\"enter image description here\"></a></p>\n\n<p>There are resources around the web to build Asp.Net or Java based applications, but I have not find solution to Golang application architecture.</p>\n\n<p>Yes GO is different to C# or Java, but still there are Structs, Interfaces to create reusable code and a generic application architecture.\nConsider above points in mind, how we can make a clean and reusable project structure in GO applications and a generic repositories for DB(Mongodb) transactions. Any web resources also a great point to start.</p>\n"}, {"tags": ["testing", "go", "deadlock", "channel"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451330755, "post_id": 34498981, "comment_id": 56740447, "body": "What are you imports here? What are <code>channel</code> and <code>api</code> in this code?"}, {"owner": {"reputation": 3627, "user_id": 979784, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce4aa9f914ee797e1c8ae6546b86d5e8?s=128&d=identicon&r=PG", "display_name": "wuliwong", "link": "https://stackoverflow.com/users/979784/wuliwong"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451331743, "post_id": 34498981, "comment_id": 56740902, "body": "@JimB I added some details about those packages."}], "answers": [{"comments": [{"owner": {"reputation": 3627, "user_id": 979784, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce4aa9f914ee797e1c8ae6546b86d5e8?s=128&d=identicon&r=PG", "display_name": "wuliwong", "link": "https://stackoverflow.com/users/979784/wuliwong"}, "edited": false, "score": 0, "creation_date": 1451334138, "post_id": 34499731, "comment_id": 56741894, "body": "Thanks for the response. If you see my &quot;Edit #2&quot; I added back some code which I originally had removed while debugging. I believe this addresses the first problem you pointed out?"}], "tags": [], "owner": {"reputation": 40934, "user_id": 121687, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/359b919642638c5b67555a1bc89dfd3e?s=128&d=identicon&r=PG", "display_name": "fabrizioM", "link": "https://stackoverflow.com/users/121687/fabriziom"}, "is_accepted": false, "score": 1, "last_activity_date": 1451331907, "creation_date": 1451331907, "answer_id": 34499731, "question_id": 34498981, "link": "https://stackoverflow.com/questions/34498981/golang-test-with-channels-does-not-exit/34499731#34499731", "title": "Golang test with channels does not exit", "body": "<p>I think the two problems are in </p>\n\n<pre><code>     output &lt;- &amp;implementation.Output{Data: user}\n</code></pre>\n\n<p>the channel does not have a buffer. It will block until some other goroutine reads from it. But in your code is the same goroutine so it will block.</p>\n\n<p>and second:</p>\n\n<pre><code>    // Close output channels once we're done\n    defer func() {\n        go func() {\n            // wg.Wait()\n\n            close(errors)\n            close(output)\n        }()\n    }()\n</code></pre>\n\n<p>you launch a go routine when the routine exits. The goroutine is scheduled, the function returns but it never calls the goroutine.</p>\n\n<p>I would suggest to unify all that logic in one:</p>\n\n<pre><code> func (g *github) Synchronize(state implementation.MutableState, ctx context.Context) (&lt;-chan *implementation.Output, &lt;-chan error) {\n    output := make(chan *implementation.Output)\n    errors := make(chan error, 1) // buffer allows preflight errors\n\n    go func() {\n      defer close(output)\n      defer close(errors)\n      err := g.fetchUser(state, output, ctx)\n      if err != nil {\n        errors &lt;- err\n      }\n   }()        \n   return output, errors\n  }\n</code></pre>\n"}], "owner": {"reputation": 3627, "user_id": 979784, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce4aa9f914ee797e1c8ae6546b86d5e8?s=128&d=identicon&r=PG", "display_name": "wuliwong", "link": "https://stackoverflow.com/users/979784/wuliwong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1476, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451334044, "creation_date": 1451328477, "last_edit_date": 1451334044, "question_id": 34498981, "link": "https://stackoverflow.com/questions/34498981/golang-test-with-channels-does-not-exit", "title": "Golang test with channels does not exit", "body": "<p>The following Golang test never exits. I suspect it has something to do with a channel deadlock but being a go-noob, I am not very certain.</p>\n\n<pre><code>const userName = \"xxxxxxxxxxxx\"\n\nfunc TestSynchroninze(t *testing.T) {\n    c, err := channel.New(github.ChannelName, authToken)\n    if err != nil {\n        t.Fatalf(\"Could not create channel: %s\", err)\n        return\n    }\n\n    state := channel.NewState(nil)\n    ctx := context.Background()\n    ctx = context.WithValue(ctx, \"userId\", userName)\n    user := api.User{}\n\n    output, errs := c.Synchronize(state, ctx)\n\n    if err = &lt;-errs; err != nil {\n        t.Fatalf(\"Error performing synchronize: %s\", err)\n        return\n    }\n\n    for o := range output {\n        switch oo := o.Data.(type) {\n        case api.User:\n            user = oo\n            glog.Infof(\"we have a USER %s\\n\", user)\n        default:\n            t.Errorf(\"Encountered unexpected data type: %T\", oo)\n        }\n    }\n}\n</code></pre>\n\n<p>Here are the methods being tested.</p>\n\n<pre><code>type github struct {\n    client *api.Client\n}\n\nfunc newImplementation(t auth.UserToken) implementation.Implementation {\n    return &amp;github{client: api.NewClient(t)}\n}\n\n// -------------------------------------------------------------------------------------\n\nconst (\n    kLastUserFetch = \"lastUserFetch\"\n)\n\ntype synchronizeFunc func(implementation.MutableState, chan *implementation.Output, context.Context) error\n\n// -------------------------------------------------------------------------------------\n\n    func (g *github) Synchronize(state implementation.MutableState, ctx context.Context) (&lt;-chan *implementation.Output, &lt;-chan error) {\n        output := make(chan *implementation.Output)\n        errors := make(chan error, 1) // buffer allows preflight errors\n\n        // Close output channels once we're done\n        defer func() {\n            go func() {\n                // wg.Wait()\n\n                close(errors)\n                close(output)\n            }()\n        }()\n\n        err := g.fetchUser(state, output, ctx)\n        if err != nil {\n            errors &lt;- err\n        }\n\n        return output, errors\n    }\n\nfunc (g *github) fetchUser(state implementation.MutableState, output chan *implementation.Output, ctx context.Context) error {\n    var err error\n\n    var user = api.User{}\n    userId, _ := ctx.Value(\"userId\").(string)\n    user, err = g.client.GetUser(userId, ctx.Done())\n\n    if err == nil {\n        glog.Info(\"No error in fetchUser\")\n        output &lt;- &amp;implementation.Output{Data: user}\n        state.SetTime(kLastUserFetch, time.Now())\n    }\n\n    return err\n}\n\nfunc (c *Client) GetUser(id string, quit &lt;-chan struct{}) (user User, err error) {\n    // Execute request\n    var data []byte\n    data, err = c.get(\"users/\"+id, nil, quit)\n    glog.Infof(\"USER DATA %s\", data)\n\n    // Parse response\n    if err == nil &amp;&amp; len(data) &gt; 0 {\n        err = json.Unmarshal(data, &amp;user)\n\n        data, _ = json.Marshal(user)\n    }\n\n    return\n}\n</code></pre>\n\n<p>Here is what I see in the console (most of the user details removed)</p>\n\n<pre><code>I1228 13:25:05.291010   21313 client.go:177] GET https://api.github.com/users/xxxxxxxx\nI1228 13:25:06.010085   21313 client.go:36] USER DATA {\"login\":\"xxxxxxxx\",\"id\":00000000,\"avatar_url\":\"https://avatars.githubusercontent.com/u/0000000?v=3\",...}\nI1228 13:25:06.010357   21313 github.go:90] No error in fetchUser\n</code></pre>\n\n<p>==========EDIT=============</p>\n\n<p>Here is the relevant portion of the <code>api</code> package.</p>\n\n<pre><code>package api\n\ntype Client struct {\n    authToken auth.UserToken\n    http      *http.Client\n}\n\nfunc NewClient(authToken auth.UserToken) *Client {\n    return &amp;Client{\n        authToken: authToken,\n        http:      auth.NewClient(authToken),\n    }\n}\n\n\n\n\n// -------------------------------------------------------------------------------------\ntype User struct {\n    Id             int    `json:\"id,omitempty\"`\n    Username       string `json:\"login,omitempty\"`\n    Email          string `json:\"email,omitempty\"`\n    FullName       string `json:\"name,omitempty\"`\n    ProfilePicture string `json:\"avatar_url,omitempty\"`\n    Bio            string `json:\"bio,omitempty\"`\n    Website        string `json:\"blog,omitempty\"`\n    Company        string `json:\"company,omitempty\"`\n}\n</code></pre>\n\n<p>And the <code>channel</code> package</p>\n\n<pre><code>package channel\n\ntype Channel struct {\n    implementation.Descriptor\n    imp implementation.Implementation\n}\n\n// New returns a channel implementation with a given name and auth token.\nfunc New(name string, token auth.UserToken) (*Channel, error) {\n    if desc, ok := implementation.Lookup(name); ok {\n        if imp := implementation.New(name, token); imp != nil {\n            return &amp;Channel{Descriptor: desc, imp: imp}, nil\n        }\n    }\n\n    return nil, ErrInvalidChannel\n}\n</code></pre>\n\n<p>and the <code>implementation</code> package...</p>\n\n<pre><code>package implementation\n\nimport \"golang.org/x/net/context\"\n\n// -------------------------------------------------------------------------------------\n\n// Implementation is the interface implemented by subpackages.\ntype Implementation interface {\n    // Synchronize performs a synchronization using the given state. A context parameters\n    // is provided to provide cancellation as well as implementation-specific behaviors.\n    //\n    // If a fatal error occurs (see package error definitions), the state can be discarded\n    // to prevent the persistence of an invalid state.\n    Synchronize(state MutableState, ctx context.Context) (&lt;-chan *Output, &lt;-chan error)\n\n    // FetchDetails gets details for a given timeline item. Any changes to the TimelineItem\n    // (including the Meta value) will be persisted.\n    FetchDetails(item *TimelineItem, ctx context.Context) (interface{}, error)\n}\n</code></pre>\n\n<p>======Edit #2=======</p>\n\n<p>This is the original <code>Synchronize</code> method. I removed some details in my testing to try and simplify the problem. By removing a <code>go func</code> call, I believe I introduced a new problem which could be confusing things.</p>\n\n<p>Here is the original Synchronize method. There are some things with <code>Wait Groups</code> and a function array containing a single function because this method will eventually be synchronizing multiple functions.</p>\n\n<pre><code>func (g *github) Synchronize(state implementation.MutableState, ctx context.Context) (&lt;-chan *implementation.Output, &lt;-chan error) {\n    wg := sync.WaitGroup{}\n    output := make(chan *implementation.Output)\n    errors := make(chan error, 1) // buffer allows preflight errors\n\n    // Close output channels once we're done\n    defer func() {\n        go func() {\n            wg.Wait()\n\n            close(errors)\n            close(output)\n        }()\n    }()\n\n    // Perform fetch functions in separate routines\n    funcs := []synchronizeFunc{\n        g.fetchUser,\n    }\n\n    for _, f := range funcs {\n        wg.Add(1)\n\n        go func(f synchronizeFunc) {\n            defer wg.Done()\n\n            if err := f(state, output, ctx); err != nil {\n                errors &lt;- err\n            }\n        }(f)\n    }\n\n    glog.Info(\"after go sync...\")\n\n    return output, errors\n}\n</code></pre>\n"}, {"tags": ["intellij-idea", "go", "intellij-14"], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 2, "last_activity_date": 1451748374, "creation_date": 1451748374, "answer_id": 34567502, "question_id": 34498566, "link": "https://stackoverflow.com/questions/34498566/intellij-auto-optimize-imports-for-go/34567502#34567502", "title": "Intellij auto optimize imports for Go", "body": "<p>This functionality is not yet available for the Go plugin, that's why you don't see any options there / it doesn't work automatically.</p>\n\n<p>You might want to watch <a href=\"https://github.com/go-lang-plugin-org/go-lang-idea-plugin/issues/1268\" rel=\"nofollow\">this issue</a> or maybe <a href=\"https://github.com/go-lang-plugin-org/go-lang-idea-plugin/pull/1807\" rel=\"nofollow\">this PR</a> to get notified when they will be fixed.</p>\n\n<p>Meanwhile, you can use the <strong>Code</strong> -> <strong>Goimports file</strong> functionality and maybe assign it a shortcut of your own preference as it doesn't have one by default. For this to work you will need to have <a href=\"http://golang.org/x/tools/cmd/goimports\" rel=\"nofollow\">goimports</a> installed and in your system's PATH.</p>\n"}], "owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 900, "favorite_count": 0, "accepted_answer_id": 34567502, "answer_count": 1, "score": 0, "last_activity_date": 1451748374, "creation_date": 1451326391, "last_edit_date": 1451748140, "question_id": 34498566, "link": "https://stackoverflow.com/questions/34498566/intellij-auto-optimize-imports-for-go", "title": "Intellij auto optimize imports for Go", "body": "<p>I have Intellij ultimate version <strong>14.1.4</strong>. How do I enable optimizing imports automatically with each save for <strong>\"Go\"</strong>? <br>In <strong>Settings->Editor->General->Auto Imports</strong>, I see options for <strong>Java/python/scala</strong> but not for <strong>Go</strong>. I have the Go plugin installed already. But this unused import compile error is a noise. I want to enable automatic optimizing of imports to avoid <code>CTRL+ALT+O</code> combination</p>\n"}, {"tags": ["parsing", "variables", "go", "interface"], "answers": [{"comments": [{"owner": {"reputation": 442, "user_id": 3158232, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ol4CR.jpg?s=128&g=1", "display_name": "deankarn", "link": "https://stackoverflow.com/users/3158232/deankarn"}, "edited": false, "score": 0, "creation_date": 1451339882, "post_id": 34498855, "comment_id": 56744457, "body": "I understand what you are saying, I am familiar with pointers and go&#39;s type system, I guess I was just getting hung up on the go/types package as I thought that the Object aka *types.Struct is not the struct User itself but a definition of it.  anyways the real question now is how do I deal with it; I think I may have solved my own issue by using <a href=\"https://godoc.org/golang.org/x/tools/go/types#NewPointer\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/tools/go/types#NewPointer</a> and then should be able to use that from there to compare... will post answer when I get a chance to try it."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 442, "user_id": 3158232, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ol4CR.jpg?s=128&g=1", "display_name": "deankarn", "link": "https://stackoverflow.com/users/3158232/deankarn"}, "edited": false, "score": 0, "creation_date": 1451340367, "post_id": 34498855, "comment_id": 56744701, "body": "@joeybloggs I&#39;ll look over your code more and perhaps provide some sample code specific to that. But in general, you just have to be conscious of whether you have a pointer or value. You can get either easily enough with the address of operate - <code>&amp;</code> to get the address of a value. So like if you have a value of type <code>T</code> you can get <code>*T</code> by doing <code>ptr := &amp;T</code>. And if you have the pointer type <code>*T</code> then you can &#39;dereference&#39; it which returns the value at the address and it will be of type <code>T</code>. It would be like <code>value := *T</code>"}, {"owner": {"reputation": 442, "user_id": 3158232, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ol4CR.jpg?s=128&g=1", "display_name": "deankarn", "link": "https://stackoverflow.com/users/3158232/deankarn"}, "edited": false, "score": 0, "creation_date": 1451355777, "post_id": 34498855, "comment_id": 56749111, "body": "ok to solve my own issue changing final portion of code to      scope := pkg.Scope()      for _, name := range scope.Names() {          obj := scope.Lookup(name)          _, ok := obj.Type().Underlying().(*types.Struct)         ptr := types.NewPointer(obj.Type()) \timp := types.Implements(ptr.Underlying(), vIface)          fmt.Println(obj.Name(), ok, imp)     }  which works with both Pointer and non-pointer recievers"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 1, "last_activity_date": 1451329233, "last_edit_date": 1451329233, "creation_date": 1451327802, "answer_id": 34498855, "question_id": 34497840, "link": "https://stackoverflow.com/questions/34497840/go-types-finding-if-struct-implements-interface/34498855#34498855", "title": "go/types finding if struct implements interface", "body": "<p>What your compiler is telling you is true. *Type != Type in Go. If you want <code>*User</code> to implement your interface then the methods receiver has to be <code>*User</code> and if you want it to be <code>User</code> then it needs to be <code>User</code>. I don't really know how else to explain it... Go's type system is strict and those aren't the same. You can see this more practically if you have <code>(u *User) MyFunction()</code> defined for the pointer type do <code>ptr := &amp;MyUser</code> then check if <code>MyUser</code> and <code>ptr</code> implement the interface, <code>ptr</code> will, <code>MyUser</code> will not. </p>\n"}], "owner": {"reputation": 442, "user_id": 3158232, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ol4CR.jpg?s=128&g=1", "display_name": "deankarn", "link": "https://stackoverflow.com/users/3158232/deankarn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1110, "favorite_count": 3, "answer_count": 1, "score": 4, "last_activity_date": 1451356009, "creation_date": 1451323236, "last_edit_date": 1451356009, "question_id": 34497840, "link": "https://stackoverflow.com/questions/34497840/go-types-finding-if-struct-implements-interface", "title": "go/types finding if struct implements interface", "body": "<p>OK so looking at using go/types, go/parser... an so forth to generate some code; but need to identify all structs that implement a specific interface which I have figured out, however, if the struct definition on the struct function it does not match using types.Implements.</p>\n\n<p>OK the code examples:</p>\n\n<p><strong>Getting the interface</strong></p>\n\n<pre><code>package ifacepkg\n\nconst interfacePkg = `package ifacepkg\n\ntype MyInterface interface {\n    MyFunction() error\n}\n`\n\nfunc getIface() *types.Interface {\n\nfset := token.NewFileSet()\n\nf, err := parser.ParseFile(fset, \"iface.go\", interfacePkg, 0)\nif err != nil {\n    panic(err)\n}\n\nconfig := &amp;types.Config{\n    Error: func(e error) {\n        fmt.Println(e)\n    },\n    Importer: importer.Default(),\n}\n\ninfo := types.Info{\n    Types: make(map[ast.Expr]types.TypeAndValue),\n    Defs:  make(map[*ast.Ident]types.Object),\n    Uses:  make(map[*ast.Ident]types.Object),\n}\n\npkg, e := config.Check(\"genval\", fset, []*ast.File{f}, &amp;info)\nif e != nil {\n    fmt.Println(e)\n}\n\nreturn pkg.Scope().Lookup(\"MyInterface\").Type().Underlying().(*types.Interface)\n}\n</code></pre>\n\n<p><strong>Test File</strong></p>\n\n<pre><code>package test\n\nimport \"ifacepkg\"\n\n// User struct\ntype User struct {\n    FirstName string\n    LastName  string\n}\n\nfunc (u User) MyFunction() error {\n    return nil\n}\n\nvar _ ifacepkg.MyInterface = &amp;User{}\n</code></pre>\n\n<p><strong>Loading Test File &amp; trying to see if User implements MyInterface</strong></p>\n\n<pre><code>fset := token.NewFileSet()\n\npkgs, e := parser.ParseDir(fset, \"./test\", nil, 0)\nif e != nil {\n    log.Fatal(e)\n    // return\n}\n\nvar astf []*ast.File\n\nfor _, pkg := range pkgs {\n    fmt.Printf(\"package %v\\n\", pkg.Name)\n    for fn, f := range pkg.Files {\n        fmt.Printf(\"file %v\\n\", fn)\n        astf = append(astf, f)\n    }\n}\n\nconfig := &amp;types.Config{\n    Error: func(e error) {\n        fmt.Println(e)\n    },\n    Importer: importer.Default(),\n}\n\ninfo := types.Info{\n    Types: make(map[ast.Expr]types.TypeAndValue),\n    Defs:  make(map[*ast.Ident]types.Object),\n    Uses:  make(map[*ast.Ident]types.Object),\n}\n\npkg, e := config.Check(path, fset, astf, &amp;info)\nif e != nil {\n    fmt.Println(e)\n}\n\nvIface := getIface()\nfmt.Println(vIface)\n\nscope := pkg.Scope()\n\n    for _, name := range scope.Names() {\n\n        obj := scope.Lookup(name)\n\n        _, ok := obj.Type().Underlying().(*types.Struct)\n        imp := types.Implements(obj.Type(), vIface)\n\n        fmt.Println(obj.Name(), ok, imp)\n    }\n</code></pre>\n\n<p>OK so fmt.Println(obj.Name(), ok, imp) prints User true true all good! however if I change the source file function from</p>\n\n<pre><code>func (u User) MyFunction() error {\n</code></pre>\n\n<p>to</p>\n\n<pre><code>func (u *User) MyFunction() error {\n</code></pre>\n\n<p>it now prints User true false</p>\n\n<p>so the function types.Implements is reporting that User does not implement MyInterface, which is not true.</p>\n\n<p>So my question is: Is there an issue with the type.Implements method or is there something I have to do to my object prior to calling that function.</p>\n\n<p><strong>Answer</strong></p>\n\n<p>ok to solve my own issue changing final portion of code to</p>\n\n<pre><code>scope := pkg.Scope()\n\nfor _, name := range scope.Names() {\n\n    obj := scope.Lookup(name)\n\n    _, ok := obj.Type().Underlying().(*types.Struct)\n    ptr := types.NewPointer(obj.Type())\n    imp := types.Implements(ptr.Underlying(), vIface)\n\n    fmt.Println(obj.Name(), ok, imp)\n}\n</code></pre>\n\n<p>which works with both Pointer and non-pointer recievers</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "comments": [{"owner": {"reputation": 1749, "user_id": 3243380, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrCc3.jpg?s=128&g=1", "display_name": "nussjustin", "link": "https://stackoverflow.com/users/3243380/nussjustin"}, "edited": false, "score": 0, "creation_date": 1451316924, "post_id": 34496149, "comment_id": 56734057, "body": "You have a data race in your code, please run your code with the &#39;-race&#39; flag (go run/build -race). This will print out information about data races as they occure."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451317688, "post_id": 34496149, "comment_id": 56734441, "body": "You can&#39;t tell if the &quot;hive&quot; loop has processed all values from <code>c</code> without closing <code>c</code>, or inserting another counter and synchronization primitive. If all goroutines are done, then what&#39;s the point of not closing the channel?"}, {"owner": {"reputation": 1749, "user_id": 3243380, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrCc3.jpg?s=128&g=1", "display_name": "nussjustin", "link": "https://stackoverflow.com/users/3243380/nussjustin"}, "edited": false, "score": 1, "creation_date": 1451323739, "post_id": 34496149, "comment_id": 56737472, "body": "The -race flag must be after run but before the filename. Anything after the filename gets passed to your process, but -race is a compiler flag."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1451316807, "creation_date": 1451316807, "answer_id": 34496303, "question_id": 34496149, "link": "https://stackoverflow.com/questions/34496149/golang-concurrency-sync-issue/34496303#34496303", "title": "golang concurrency sync issue", "body": "<p>You're never waiting for the \"hive\" loop to finish, so sometimes you print the <code>count</code> value before it's complete. </p>\n\n<p>It's easiest to use the WaitGroup to signal when to close the channel, and block <code>main</code> on the for range loop:</p>\n\n<pre><code>go func() {\n    wg.Wait()\n    close(c)\n}()\n\nfor out := range c {\n    count += out\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/jK24dtG2je\" rel=\"nofollow\">http://play.golang.org/p/jK24dtG2je</a></p>\n"}], "owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 34496303, "answer_count": 1, "score": 0, "last_activity_date": 1451336002, "creation_date": 1451316124, "last_edit_date": 1451336002, "question_id": 34496149, "link": "https://stackoverflow.com/questions/34496149/golang-concurrency-sync-issue", "title": "golang concurrency sync issue", "body": "<p>I am facing a synchronization issue when using goroutines. My program outputs unpredictable results. I checked the docu and for unbuffered channels there is no way to check if all msgs have been processed. I simplified the issue to this little demo code that still demonstrates the problem. Clearly this is not an issue with Golang but with my code. Obviously I am not using the right concurrency pattern. </p>\n\n<p>Question is how to resolve this. If possible I would neither want to close the channel nor stop the hive goroutine. It think it would be great if I could assume that once all bee goroutines are finished that hive is done for now, too (that is what I tried by using wg.Wait()).</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\n\n\nfunc main() {\n    count := int64(0)\n    c := make(chan int64)\n    var wg sync.WaitGroup\n\n    // bees\n    for i:=0; i&lt;5000;i++{\n        wg.Add(1)\n        go func(in chan int64) {\n            defer wg.Done()\n            time.Sleep(100)\n            in &lt;- 2\n        }(c)\n    }\n\n    // hive\n    go func() {\n        for out := range c {\n            count += out\n        }\n    }()\n\n    wg.Wait()\n    // bang! but why?\n    fmt.Println(count)  \n}\n\n// every now and again the program prints out before it is finished\n// $ go run pattern1.go\n// 10000\n// $ go run pattern1.go\n// 9998\n// $ go run pattern1.go\n// 9998\n// $ go run pattern1.go\n// 10000\n// $ go run pattern1.go\n// 10000\n// $ go run pattern1.go\n// 9998\n</code></pre>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1451314406, "post_id": 34495465, "comment_id": 56732727, "body": "<a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow noreferrer\">golang.org/doc/faq#closures_and_goroutines</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 3375274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6a2de3b11ee1d4fa12ec72e9e9d7c57?s=128&d=identicon&r=PG&f=1", "display_name": "user3375274", "link": "https://stackoverflow.com/users/3375274/user3375274"}, "edited": false, "score": 0, "creation_date": 1451315331, "post_id": 34495735, "comment_id": 56733215, "body": "Thank you for the fix and especially for the explanation. It works properly now."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1451332220, "last_edit_date": 1451332220, "creation_date": 1451314449, "answer_id": 34495735, "question_id": 34495465, "link": "https://stackoverflow.com/questions/34495465/3-different-funcs-launched-as-goroutines-produce-the-same-goroutine-apparently/34495735#34495735", "title": "3 different funcs launched as goroutines produce the same goroutine (apparently ignore arguments)", "body": "<p>The call to <code>c.Listen()</code> is closing around the value of c, which is passed via a pointer to <code>Listen</code>, and each iteration changes that value. It's easier to visualize if you look at the method call as a method expression</p>\n\n<pre><code>go (*component).Listen(&amp;c)\n</code></pre>\n\n<p><a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow\">https://golang.org/doc/faq#closures_and_goroutines</a></p>\n\n<p>Create a new value for c on each iteration to prevent the previous from being overwritten:</p>\n\n<pre><code>for _, c := range u.components { // u.components has 3 members\n    c := c\n    fmt.Printf(\"%v %v\", c.name, c.channel) // prints 3 distinct name/channel pairs \n    go c.Listen(); // a method of c that listens on channel c.channel\n}\n</code></pre>\n\n<p>Or use the value contained in the slice directly:</p>\n\n<pre><code>for i := range u.components {\n    go u.components[i].Listen()\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 3375274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6a2de3b11ee1d4fa12ec72e9e9d7c57?s=128&d=identicon&r=PG&f=1", "display_name": "user3375274", "link": "https://stackoverflow.com/users/3375274/user3375274"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 34495735, "answer_count": 1, "score": 1, "last_activity_date": 1451332220, "creation_date": 1451313339, "question_id": 34495465, "link": "https://stackoverflow.com/questions/34495465/3-different-funcs-launched-as-goroutines-produce-the-same-goroutine-apparently", "title": "3 different funcs launched as goroutines produce the same goroutine (apparently ignore arguments)", "body": "<p>For 3 different and distinct \"c\"</p>\n\n<pre><code>for _, c := range u.components { // u.components has 3 members\n    fmt.Printf(\"%v %v\", c.name, c.channel) // prints 3 distinct name/channel pairs \n    go c.Listen(); // a method of c that listens on channel c.channel\n}\n</code></pre>\n\n<p>...launches 3 identical goroutines in which c.name and c.channel are identical.</p>\n\n<p>The long version (commented, short code):\n<a href=\"https://play.golang.org/p/mMQb_5jLjm\" rel=\"nofollow\">https://play.golang.org/p/mMQb_5jLjm</a></p>\n\n<p>This is my first Go program, I'm sure I'm missing something obvious. Any ideas?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "go-reflect"], "comments": [{"owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "edited": false, "score": 0, "creation_date": 1451308313, "post_id": 34493062, "comment_id": 56729830, "body": "Check this link for soluton: <a href=\"http://stackoverflow.com/questions/25047424/pass-by-reference-nested-structures-through-reflection\" title=\"pass by reference nested structures through reflection\">stackoverflow.com/questions/25047424/&hellip;</a>"}, {"owner": {"reputation": 3829, "user_id": 1146334, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/cL3do.png?s=128&g=1", "display_name": "FuriousGeorge", "link": "https://stackoverflow.com/users/1146334/furiousgeorge"}, "edited": false, "score": 0, "creation_date": 1451314869, "post_id": 34493062, "comment_id": 56732963, "body": "If don&#39;t care to do this on your own, or want to see how others do it, check out this really good pretty printer for Go <a href=\"https://github.com/davecgh/go-spew\" rel=\"nofollow noreferrer\">github.com/davecgh/go-spew</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1682, "user_id": 1977535, "user_type": "registered", "accept_rate": 8, "profile_image": "https://i.stack.imgur.com/NK9Et.jpg?s=128&g=1", "display_name": "firelyu", "link": "https://stackoverflow.com/users/1977535/firelyu"}, "edited": false, "score": 0, "creation_date": 1451368284, "post_id": 34494185, "comment_id": 56752219, "body": "@It is perfect right. I am very confused by the reflect, there are reflect.TypeOf, reflect.ValueOf and so many methods. I need more time to investigate them. :)"}, {"owner": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "edited": false, "score": 0, "creation_date": 1522477674, "post_id": 34494185, "comment_id": 86177806, "body": "is it possible to modify struct value inside &quot;display&quot; function? @James Henstridge"}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": false, "score": 6, "last_activity_date": 1451308358, "creation_date": 1451308358, "answer_id": 34494185, "question_id": 34493062, "link": "https://stackoverflow.com/questions/34493062/how-to-reflect-struct-recursive-in-golang/34494185#34494185", "title": "How to reflect struct recursive in golang", "body": "<p>Inside your <code>display</code> function, you declare <code>valueValue</code> as:</p>\n\n<pre><code>valueValue := reflectValue.Field(i).Interface()\n</code></pre>\n\n<p>So <code>valueValue</code> is of type <code>interface{}</code>.  Inside the for loop, you have a recursive call to <code>display</code>:</p>\n\n<pre><code>display(&amp;valueValue)\n</code></pre>\n\n<p>So it is being called with an argument of type <code>*interface{}</code>.  Inside the recursive call, <code>reflectType</code> will represent <code>interface{}</code> rather than the type that happens to be stored within the value.  Since <code>NumField</code> can only be called on <code>reflect.Type</code>'s representing structs, you get a panic.</p>\n\n<p>If you want to call display with a pointer to the struct instead, you could do so with something like this:</p>\n\n<pre><code>v := valueValue := reflectValue.Field(i).Addr()\ndisplay(v.Interface())\n</code></pre>\n"}], "owner": {"reputation": 1682, "user_id": 1977535, "user_type": "registered", "accept_rate": 8, "profile_image": "https://i.stack.imgur.com/NK9Et.jpg?s=128&g=1", "display_name": "firelyu", "link": "https://stackoverflow.com/users/1977535/firelyu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5077, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1471843010, "creation_date": 1451303646, "last_edit_date": 1471843010, "question_id": 34493062, "link": "https://stackoverflow.com/questions/34493062/how-to-reflect-struct-recursive-in-golang", "title": "How to reflect struct recursive in golang", "body": "<p>I want to reflect the struct type and value recursively, but it fails. I don't know how to pass the sub struct recursively.</p>\n\n<p>It error the following.</p>\n\n<pre><code>panic: reflect: NumField of non-struct type\n\ngoroutine 1 [running]:\nreflect.(*rtype).NumField(0xc0b20, 0xc82000a360)\n    /usr/local/go/src/reflect/type.go:660 +0x7b\n</code></pre>\n\n<p>I have two struct <code>Person</code> and <code>Name</code></p>\n\n<pre><code>type Person struct {\n    Fullname NameType\n    Sex      string\n}\n\ntype Name struct {\n    Firstname string\n    Lastname  string\n}\n</code></pre>\n\n<p>I define the <code>Person</code> in main, and display the struct with recursive function.</p>\n\n<pre><code>person := Person{\n    Name{\"James\", \"Bound\"},\n    \"Male\",\n}\n\ndisplay(&amp;person)\n</code></pre>\n\n<p>The <code>display</code> function recursive display the struct.</p>\n\n<pre><code>func display(s interface{}) {\n    reflectType := reflect.TypeOf(s).Elem()\n    reflectValue := reflect.ValueOf(s).Elem()\n\n    for i := 0; i &lt; reflectType.NumField(); i++ {\n        typeName := reflectType.Field(i).Name\n\n        valueType := reflectValue.Field(i).Type()\n        valueValue := reflectValue.Field(i).Interface()\n\n        switch reflectValue.Field(i).Kind() {\n        case reflect.String:\n            fmt.Printf(\"%s : %s(%s)\\n\", typeName, valueValue, valueType)\n        case reflect.Int32:\n            fmt.Printf(\"%s : %i(%s)\\n\", typeName, valueValue, valueType)\n        case reflect.Struct:\n            fmt.Printf(\"%s : it is %s\\n\", typeName, valueType)\n            display(&amp;valueValue)\n        }\n\n    }\n}\n</code></pre>\n"}, {"tags": ["function", "pointers", "go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1451321282, "post_id": 34493586, "comment_id": 56736310, "body": "Please consider unlearning this &quot;by reference&quot; misnomer. In some languages, there <i>is</i> the distinction: say, in Python and PHP, values of integer type are passed by value and objects of class types are passed by reference. In contrast, in Go, all values are passed by value, just you can <i>explicitly</i> pass pointers to values -- if you want the callee to modify the value pointed to, or want to avoid copying overhead."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1451321607, "post_id": 34493586, "comment_id": 56736469, "body": "Consider reading <a href=\"http://stackoverflow.com/a/25354231/720999\">this</a> and <a href=\"http://stackoverflow.com/a/23551970/720999\">this</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "is_accepted": false, "score": 0, "last_activity_date": 1451306264, "creation_date": 1451306264, "answer_id": 34493689, "question_id": 34493586, "link": "https://stackoverflow.com/questions/34493586/why-struct-i-pass-does-not-change/34493689#34493689", "title": "Why struct I pass does not change", "body": "<p>In our code, you are  creating new object of ttt in function change and assigning  it to t which is passed as parameter to function. In go parameters are passed by value, so when at the end of function change you assign value to t is only for the scope of the function. In order to propagate change to calling function return value from change and assign it back. </p>\n\n<p>Have made the changes to your code, please check play ground link\n<a href=\"https://play.golang.org/p/S3GK0JLDHn\" rel=\"nofollow\">https://play.golang.org/p/S3GK0JLDHn</a></p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1451321088, "post_id": 34494182, "comment_id": 56736224, "body": "Regarding &#171;in general, you should be guarding against nil values and returning errors.&#187; -- please don&#39;t! <a href=\"http://stackoverflow.com/a/22865084/720999\">Here&#39;s</a> why."}], "tags": [], "owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "is_accepted": false, "score": 2, "last_activity_date": 1451372277, "last_edit_date": 1451372277, "creation_date": 1451308340, "answer_id": 34494182, "question_id": 34493586, "link": "https://stackoverflow.com/questions/34493586/why-struct-i-pass-does-not-change/34494182#34494182", "title": "Why struct I pass does not change", "body": "<p>You are not changing the struct inside the function, you are changing the value by setting it to a different memory address.  In other words, you're not changing the object stored at the address referenced by <code>t</code>, you're changing the pointer value of <code>t</code> itself, which will not change the pointer value of the <code>t</code> variable outside the function (because Golang is pass by value).</p>\n\n<p>In order to do what you want, the code should look similar to what you're doing for <code>intbyRef</code>, namely:</p>\n\n<pre><code>func change(t *ttt) {\n    var p ttt = ttt{7}\n    fmt.Println(p)\n    *t = p\n}\n</code></pre>\n\n<p>however, this will panic with a nil-pointer dereference.  Your main function should also do what you're doing with the int:</p>\n\n<pre><code>func main() {\n\n    i := 1\n    // var t *ttt\n    t := new(ttt)\n\n    ...\n}\n</code></pre>\n\n<p>Full code below (playground link <a href=\"https://play.golang.org/p/_e1cCuMmmp\" rel=\"nofollow\">here</a>):</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc intbyRef(i *int) {\n    *i = 10\n}\n\ntype ttt struct {\n    a int\n}\n\nfunc change(t *ttt) {\n    var p ttt = ttt{7}\n    fmt.Println(p)\n    // t = &amp;p\n    *t = p\n\n}\n\nfunc main() {\n\n    i := 1\n    // var t *ttt\n    t := new(ttt)\n\n    fmt.Println(i)\n    fmt.Println(t)\n\n    change(t)\n    intbyRef(&amp;i)\n\n    fmt.Println(i)\n    fmt.Println(t)\n}\n</code></pre>\n\n<p>Also, you may want to be guarding against nil values and returning errors, especially for functions internal to your package.</p>\n"}, {"tags": [], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "is_accepted": false, "score": 0, "last_activity_date": 1451328687, "creation_date": 1451328687, "answer_id": 34499022, "question_id": 34493586, "link": "https://stackoverflow.com/questions/34493586/why-struct-i-pass-does-not-change/34499022#34499022", "title": "Why struct I pass does not change", "body": "<p>You are passing <strong>initialized</strong> pointer value to <code>intByRef</code> and change the dereferenced value.</p>\n\n<p>In the <code>change</code> you are passing not initialized pointer value (aka nil) and assigning another pointer to it.</p>\n\n<p>So you are doing two different things.</p>\n\n<p>You should know that when you pass a pointer to a function you pass a copy of that pointer (pointing to the same value). That's why <code>main</code>'s <code>t</code> is unchanged after passing it to <code>change</code>. It points to the \"old\" memory address.</p>\n\n<p>If you want to change a value of <code>ttt</code> pointer passed to the function you can do it like you do it in <code>intByRef</code>, but the pointer <strong>must</strong> be initialized (aka. allocated). Otherwise you'd try to dereference nil.</p>\n\n<p><a href=\"https://play.golang.org/p/ho08shnGpv\" rel=\"nofollow\">playground</a></p>\n\n<pre><code>func change(t *ttt) {\n    var p ttt = ttt{7}\n    fmt.Println(p)\n    *t = p\n}\n\nfunc main() {\n    t := new(ttt)\n    fmt.Println(t)\n    change(t)\n    fmt.Println(t)\n}\n</code></pre>\n"}], "migrated_from": {"other_site": {"aliases": ["http://programmer.stackexchange.com", "http://programmers.stackexchange.com"], "markdown_extensions": ["Prettify"], "launch_date": 1292524346, "open_beta_date": 1283972400, "closed_beta_date": 1283367600, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/softwareengineering/Img/apple-touch-icon@2.png", "twitter_account": "StackSoftEng", "favicon_url": "https://cdn.sstatic.net/Sites/softwareengineering/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/softwareengineering/Img/apple-touch-icon.png", "audience": "professionals, academics, and students working within the systems development life cycle", "site_url": "https://softwareengineering.stackexchange.com", "api_site_parameter": "softwareengineering", "logo_url": "https://cdn.sstatic.net/Sites/softwareengineering/Img/logo.png", "name": "Software Engineering", "site_type": "main_site"}, "on_date": 1451305804, "question_id": 305991}, "owner": {"reputation": 11, "user_id": 5723122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345b26bb459ca083221a7ecce1f9ef18?s=128&d=identicon&r=PG&f=1", "display_name": "Ikomi Kara", "link": "https://stackoverflow.com/users/5723122/ikomi-kara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1528, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1451372277, "creation_date": 1451301629, "question_id": 34493586, "link": "https://stackoverflow.com/questions/34493586/why-struct-i-pass-does-not-change", "title": "Why struct I pass does not change", "body": "<p>I am passing a struct to a function by reference.</p>\n\n<p>I was expecting if I define and change the struct inside the function I can get the new value outside.</p>\n\n<p>But it is not happening.</p>\n\n<p>Can anyone explain why?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc intbyRef(i *int) {\n    *i = 10\n}\n\ntype ttt struct {\n    a int\n}\n\nfunc change(t *ttt) {\n    var p ttt = ttt{7}\n    fmt.Println(p)\n    t = &amp;p\n\n}\n\nfunc main() {\n\n    i := 1\n    var t *ttt\n\n    fmt.Println(i)\n    fmt.Println(t)\n\n    change(t)\n    intbyRef(&amp;i)\n\n    fmt.Println(i)\n    fmt.Println(t)\n}\n</code></pre>\n\n<p>You can try the code in here: <a href=\"https://play.golang.org/p/I-GIdIZ9c6\" rel=\"nofollow\">https://play.golang.org/p/I-GIdIZ9c6</a></p>\n"}, {"tags": ["go", "server", "client"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1451299708, "post_id": 34491011, "comment_id": 56725806, "body": "so the question is how to make a network connection with golang?"}, {"owner": {"reputation": 4341, "user_id": 4572536, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/91d825b498c552b821ccc3314ddd8929?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndArtist", "link": "https://stackoverflow.com/users/4572536/devandartist"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1451299920, "post_id": 34491011, "comment_id": 56725920, "body": "No the question is how to wait for a message before decoding the connection buffer. A TCP server is easy to set up in golang, but I have no idea how to block the message receiving process on one side so the for loop from above won&#39;t print thousands of errors until it finds a new message on <code>net.Conn</code>."}, {"owner": {"reputation": 4341, "user_id": 4572536, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/91d825b498c552b821ccc3314ddd8929?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndArtist", "link": "https://stackoverflow.com/users/4572536/devandartist"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1451300093, "post_id": 34491011, "comment_id": 56726002, "body": "Lets say it is unknown when the message from a client will arrive, so the server will block and wait inside a goroutine for a new message, but I have no clue how to achieve this."}], "answers": [{"comments": [{"owner": {"reputation": 4341, "user_id": 4572536, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/91d825b498c552b821ccc3314ddd8929?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndArtist", "link": "https://stackoverflow.com/users/4572536/devandartist"}, "edited": false, "score": 0, "creation_date": 1451300594, "post_id": 34492234, "comment_id": 56726278, "body": "How is this waiting for a future message? I want something like this: <a href=\"http://stackoverflow.com/a/23529698/4572536\">stackoverflow.com/a/23529698/4572536</a> but with raw tcp connection and <code>gob</code> as en-/decoder. And again, <code>Go</code> is new to me, so I need some working example I can study."}, {"owner": {"reputation": 4341, "user_id": 4572536, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/91d825b498c552b821ccc3314ddd8929?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndArtist", "link": "https://stackoverflow.com/users/4572536/devandartist"}, "edited": false, "score": 0, "creation_date": 1451301166, "post_id": 34492234, "comment_id": 56726573, "body": "Does <code>conn.Read</code> wait until it can fill the buffer?"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 4341, "user_id": 4572536, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/91d825b498c552b821ccc3314ddd8929?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndArtist", "link": "https://stackoverflow.com/users/4572536/devandartist"}, "edited": false, "score": 0, "creation_date": 1451301342, "post_id": 34492234, "comment_id": 56726655, "body": "no, but in real word you may not receive less than 4 bytes if client not send less than 4 bytes. strictly let&#39;s use <code>ReadFull</code> for first 4 bytes too."}, {"owner": {"reputation": 4341, "user_id": 4572536, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/91d825b498c552b821ccc3314ddd8929?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndArtist", "link": "https://stackoverflow.com/users/4572536/devandartist"}, "edited": false, "score": 0, "creation_date": 1451302008, "post_id": 34492234, "comment_id": 56726957, "body": "So I assume I should stick this code (parts of it) inside a for loop inside a goroutine for a specific connection and use continue instead of return. Is this a good mechanism to wait for a message?"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 4341, "user_id": 4572536, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/91d825b498c552b821ccc3314ddd8929?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndArtist", "link": "https://stackoverflow.com/users/4572536/devandartist"}, "edited": false, "score": 0, "creation_date": 1451302124, "post_id": 34492234, "comment_id": 56726997, "body": "it works in our products:) but add a deadline timeout. like 20 seconds <code>conn.SetReadDeadline(time.Now().Add(time.Second * 20))</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1451313673, "post_id": 34492234, "comment_id": 56732386, "body": "You don&#39;t need to length-prefix when using gob. There&#39;s &quot;encoding/binary&quot; if you did want to prefix a binary integer. (and network byte order is generally defined as BigEndian)."}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 0, "last_activity_date": 1451301371, "last_edit_date": 1451301371, "creation_date": 1451300252, "answer_id": 34492234, "question_id": 34491011, "link": "https://stackoverflow.com/questions/34491011/go-server-should-block-until-a-message-from-the-client-is-received/34492234#34492234", "title": "Go: Server should block until a message from the client is received", "body": "<p>add a length header to the raw tcp stream. </p>\n\n<p>that means, send a 4-bytes-length-header information to server before send the real load. and in server side read 4 bytes, allocate buffer, full read total message, and finally decode.</p>\n\n<p>assume you have a tcp connection conn, in server side we could have:</p>\n\n<pre><code>func getInt(v []byte) int {\n    var r uint\n    r = 0\n    r |= uint(v[0]) &lt;&lt; 24\n    r |= uint(v[1]) &lt;&lt; 16\n    r |= uint(v[2]) &lt;&lt; 8\n    r |= uint(v[3]) &lt;&lt; 0\n    return int(r)\n}\n\nbuf := make([]byte, 4)\n_, err := io.ReadFull(conn, buf)\nif err != nil {\n    return\n}\n\nlength := getInt(buf)\nbuf = make([]byte, length)\n_, err = io.ReadFull(conn, buf)\nif err != nil {\n    return\n}\n//do gob decode from `buf` here\n</code></pre>\n\n<p>you may know client side refer the the server side source I think.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1451313487, "last_edit_date": 1451313487, "creation_date": 1451311792, "answer_id": 34495094, "question_id": 34491011, "link": "https://stackoverflow.com/questions/34491011/go-server-should-block-until-a-message-from-the-client-is-received/34495094#34495094", "title": "Go: Server should block until a message from the client is received", "body": "<p>The gob decoder blocks until it has read a full message or there's an error.  The read loop in the question works as is.</p>\n\n<p><a href=\"http://play.golang.org/p/UwMBOYvuw8\" rel=\"nofollow\">working example on the playground</a></p>\n"}], "owner": {"reputation": 4341, "user_id": 4572536, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/91d825b498c552b821ccc3314ddd8929?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndArtist", "link": "https://stackoverflow.com/users/4572536/devandartist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 576, "favorite_count": 0, "accepted_answer_id": 34495094, "answer_count": 2, "score": 0, "last_activity_date": 1451313487, "creation_date": 1451295497, "question_id": 34491011, "link": "https://stackoverflow.com/questions/34491011/go-server-should-block-until-a-message-from-the-client-is-received", "title": "Go: Server should block until a message from the client is received", "body": "<p>I'm building some server/client application in <code>Go</code> (the language is new to me). I searched a lot and read a whole bunch of different examples but there is still one thing I can't find. Lets say I have a single server client up and running. The client will send some kind of a message to the server and vice versa. Encoding and decoding is done by the package <code>gob</code>.</p>\n\n<p>This example is <em>not</em> my application, it is only a quick example:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/gob\"\n    \"fmt\"\n    \"log\"\n)\n\ntype Message struct {\n    Sender   string\n    Receiver string\n    Command  uint8\n    Value    int64\n}\n\nfunc (message *Message) Set(sender string, receiver string, command uint8, value int64) *Message {\n\n    message.Sender = sender\n    message.Receiver = receiver\n    message.Command = command\n    message.Value = value\n\n    return message\n}\n\nfunc main() {\n\n    var network bytes.Buffer // Stand-in for a network connection\n\n    enc := gob.NewEncoder(&amp;network) // Will write to network.\n    dec := gob.NewDecoder(&amp;network) // Will read from network.\n\n    message := new(Message).Set(\"first\", \"second\", 10, -1)\n\n    err := enc.Encode(*message) // send message\n    if err != nil {\n        log.Fatal(\"encode error:\", err)\n    }\n\n    var m Message\n    err = dec.Decode(&amp;m) // receice message\n\n    if err != nil {\n        log.Fatal(\"decode error:\", err)\n    }\n\n    fmt.Printf(\"%q %q %d %d\\n\", m.Sender, m.Receiver, m.Command, m.Value)\n}\n</code></pre>\n\n<p>This works fine, but I want the server to block until a new message is received so I can put the receiving process inside a <code>infinite for loop</code> inside a <code>goroutine</code>.</p>\n\n<p>Something like that:</p>\n\n<pre><code>for {\n    // The server blocks HERE until a message from the client is received\n\n    fmt.Println(\"Received message:\")\n\n    // Decode the new message\n    var m Message\n    err = dec.Decode(&amp;m) // receice message\n\n    if err != nil {\n        log.Fatal(\"decode error:\", err)\n    }\n\n    fmt.Printf(\"%q %q %d %d\\n\", m.Sender, m.Receiver, m.Command, m.Value)\n}\n</code></pre>\n"}, {"tags": ["json", "go", "mapreduce"], "answers": [{"tags": [], "owner": {"reputation": 627, "user_id": 4689430, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/SJU8y.png?s=128&g=1", "display_name": "elixir", "link": "https://stackoverflow.com/users/4689430/elixir"}, "is_accepted": true, "score": 1, "last_activity_date": 1451294005, "creation_date": 1451294005, "answer_id": 34490661, "question_id": 34489925, "link": "https://stackoverflow.com/questions/34489925/new-a-array-or-map-of-json-encoder-type-in-golang/34490661#34490661", "title": "New a array or map of json encoder type in Golang", "body": "<p><code>json.NewEncoder(file)</code> returns an object of type <code>*Encoder</code>. Therefore, try editing the line:</p>\n\n<pre><code>enc_map := make(map[int]*Encode)\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>enc_map := make(map[int]* json.Encoder)\n</code></pre>\n\n<p>to eliminate the error:</p>\n\n<pre><code>../mapreduce/mapreduce.go:228: undefined: Encode\n</code></pre>\n\n<p>To get rid of the other 2 errors, i.e., </p>\n\n<pre><code>../mapreduce/mapreduce.go:230: file.err undefined (type *os.File has no field or method err)\n../mapreduce/mapreduce.go:230: multiple-value os.Create() in single-value context\n</code></pre>\n\n<p>just edit <code>file .err</code> in line:</p>\n\n<pre><code>file. err = os.Create(ReduceName(fileName, JobNumber, r))\n</code></pre>\n\n<p>to <code>file, err</code> in your code.</p>\n\n<p>I hope this solves the issue you're facing.</p>\n"}], "owner": {"reputation": 619, "user_id": 1222783, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/OSGjU.jpg?s=128&g=1", "display_name": "Nothing More", "link": "https://stackoverflow.com/users/1222783/nothing-more"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 34490661, "answer_count": 1, "score": 0, "last_activity_date": 1451294005, "creation_date": 1451290499, "question_id": 34489925, "link": "https://stackoverflow.com/questions/34489925/new-a-array-or-map-of-json-encoder-type-in-golang", "title": "New a array or map of json encoder type in Golang", "body": "<p>I am pretty new in Golang and encountered the following problem. </p>\n\n<pre><code>// XXX a bit inefficient. could open r files and run over list once\nfor r := 0; r &lt; nreduce; r++ {\n    file, err = os.Create(ReduceName(fileName, JobNumber, r))\n    if err != nil {\n        log.Fatal(\"DoMap: create \", err)\n    }\n    enc := json.NewEncoder(file)\n    for e := res.Front(); e != nil; e = e.Next() {\n        kv := e.Value.(KeyValue)\n        if ihash(kv.Key)%uint32(nreduce) == uint32(r) {\n            err := enc.Encode(&amp;kv)\n            if err != nil {\n                log.Fatal(\"DoMap: marshall \", err)\n            }\n        }\n    }\n    file.Close()\n}\n</code></pre>\n\n<p>Basically this code snippet creates a file in each for-loop iteration and then open a file to encode the stuff which belongs to this file, according to a (key, value) pair. However, this code is inefficient since it scan this file for too many times. The more efficient way to do so is to open r files and run over this list file once. So I would like to write like this (but I don't know how to do so):</p>\n\n<pre><code>enc_map := make(map[int]*Encode)\nfor r := 0; r &lt; nreduce; r++ {\nfile. err = os.Create(ReduceName(fileName, JobNumber, r))\nif err != nil {\n    log.Fatal(\"DoMap: create \", err)\n}\nenc := json.NewEncoder(file)\nenc_map[r] = enc\nfor e := res.Front(); e != nil; e = e.Next() {\n    kv := e.Value.(KeyValue)\n    r := ihash(kv.Key)&amp;uint32(nreduce) \n    err := enc_map[r].Encode(&amp;kv)\n    if err != nil {\n        log.Fatal(\"DoMap: marshall \", err)\n    }\n}\n</code></pre>\n\n<p>This code snippets first creates a map that saves the json.Encoder objects and then iterate over this file once. I looked up the go documentation and it says the type name of json.Encoder is *Encode. But the line </p>\n\n<pre><code>enc_map := make(map[int]*Encode)\n</code></pre>\n\n<p>is wrong and the compiler gives me the following error:</p>\n\n<pre><code>../mapreduce/mapreduce.go:228: undefined: Encode\n../mapreduce/mapreduce.go:230: file.err undefined (type *os.File has no field or method err)\n../mapreduce/mapreduce.go:230: multiple-value os.Create() in single-value context\n</code></pre>\n\n<p>So what's the right way to do things? </p>\n"}, {"tags": ["json", "go", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "edited": false, "score": 0, "creation_date": 1451323589, "post_id": 34490794, "comment_id": 56737406, "body": "Your version definitely works, so I thought it might be a matter of the JSON response overrunning the memory allocation, but I added the same number of results as the response, and it still worked. I can&#39;t use my actual code on the playground because it doesn&#39;t allow HTTP requests. Still confused!"}, {"owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "edited": false, "score": 0, "creation_date": 1451324514, "post_id": 34490794, "comment_id": 56737809, "body": "For reference, <a href=\"https://gist.github.com/thenickcox/5dfa738767ca5b3b4d59\" rel=\"nofollow noreferrer\">here</a> is the raw JSON response. I&#39;ll try to fit this"}, {"owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "reply_to_user": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "edited": false, "score": 1, "creation_date": 1451327479, "post_id": 34490794, "comment_id": 56739108, "body": "Found the issue, it happening because, in 2 of the results multimedia is string i.e. &quot;multimedia&quot;:&quot;&quot; check line 975 and 1319. Since array is expected, json is failing because string is found convert this to &quot;multimedia&quot;:[]."}, {"owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "edited": false, "score": 0, "creation_date": 1451336127, "post_id": 34490794, "comment_id": 56742769, "body": "Good eye. Upvoted that comment and marked your answer correct and upvoted. Thanks!"}], "tags": [], "owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "is_accepted": true, "score": 4, "last_activity_date": 1451347204, "last_edit_date": 1451347204, "creation_date": 1451294552, "answer_id": 34490794, "question_id": 34489887, "link": "https://stackoverflow.com/questions/34489887/go-unmarshal-json-nested-array-of-objects/34490794#34490794", "title": "Go: Unmarshal JSON nested array of objects", "body": "<p>Tried using your PoliticsJson and Sample Json string was able to parse to get Title and URL.</p>\n\n<p>I tried adding one more entry for multi media by changing URL to static02 and able to get both the URL's printed.</p>\n\n<p>Here is the link to PlayGround for the same:\n<a href=\"http://play.golang.org/p/rAJfkD1i7n\" rel=\"nofollow\">http://play.golang.org/p/rAJfkD1i7n</a></p>\n\n<h3>Edit</h3>\n\n<p>Found the issue, it happening because, in 2 of the results multimedia is string i.e. <code>\"multimedia\":\"\"</code> check line 975 and 1319. Since array is expected, json is failing because string is found convert this to <code>\"multimedia\":[]</code>.</p>\n"}], "owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9506, "favorite_count": 0, "accepted_answer_id": 34490794, "answer_count": 1, "score": 4, "last_activity_date": 1451347204, "creation_date": 1451290323, "last_edit_date": 1495535418, "question_id": 34489887, "link": "https://stackoverflow.com/questions/34489887/go-unmarshal-json-nested-array-of-objects", "title": "Go: Unmarshal JSON nested array of objects", "body": "<p>I'm aware that you can <a href=\"https://stackoverflow.com/questions/26831151/go-unmarshal-json-with-a-field-that-is-an-array-of-objects-or-strings\">unmarshal arbitrary JSON into a <code>map[string]interface{}</code> value</a>, and while that works, my JSON response is always defined and consistent, and for simplicity's sake, I'd prefer to unmarshal it as nested structs.</p>\n\n<p>Here's a sample of the JSON response, abbreviated:</p>\n\n<pre><code>{\n  (...)\n  \"results\": [\n    {\n      \"section\": \"N.Y. / Region\",\n      \"subsection\": \"\",\n      \"title\": \"Christie Spins His Version of Security Record on Trail\",\n      \"abstract\": \"An examination of Gov. Chris Christie\u2019s record as New Jersey\u2019s top federal prosecutor shows that he has, at times, overstated the significance of the terrorism prosecutions he oversaw.\",\n      \"url\": \"http://www.nytimes.com/2015/12/27/nyregion/Christie-markets-himself-as-protector-to-gain-in-polls.html\",\n      \"byline\": \"By ALEXANDER BURNS and CHARLIE SAVAGE\",\n      \"item_type\": \"Article\",\n      \"updated_date\": \"2015-12-26T18:04:19-5:00\",\n      (...)\n      \"multimedia\": [\n        {\n          \"url\": \"http://static01.nyt.com/images/2015/12/27/nyregion/27CHRISTIE1/27CHRISTIE1-thumbStandard.jpg\",\n          \"format\": \"Standard Thumbnail\",\n          \"height\": 75,\n          \"width\": 75,\n          \"type\": \"image\",\n          \"subtype\": \"photo\",\n          \"caption\": \"Gov. Chris Christie of New Jersey spoke about the Sept. 11, 2001, attacks at a Republican conference last month.\",\n          \"copyright\": \"Stephen Crowley/The New York Times\"\n        }\n        (...)\n      ]\n    }\n  ]\n}\n</code></pre>\n\n<h3>What I've tried</h3>\n\n<p>I tried using <a href=\"https://github.com/bashtian/jsonutils\" rel=\"nofollow noreferrer\">JSONutils</a> to automate the struct creation and ended up with this (after deleting the fields I didn't want):</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\ntype PoliticsJson struct {\n    Results []struct {\n        Multimedia []struct {\n            URL string `json:\"url\"`\n        } `json:\"multimedia\"`\n        Title string `json:\"title\"`\n    } `json:\"results\"`\n}\n\nfunc retrieveData() []byte {\n    url := \"http://api.nytimes.com/svc/topstories/v1/politics.json?MYAPIKEY\"\n    resp, err := http.Get(url)\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer resp.Body.Close()\n    body, err2 := ioutil.ReadAll(resp.Body)\n    if err2 != nil {\n        fmt.Println(err2)\n    }\n    return body\n}\n\n\nfunc main() {\n    var p PoliticsJson\n\n    err := json.Unmarshal(retrieveData(), &amp;p)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(p.Results[0].Title)\n}\n</code></pre>\n\n<p>I basically just want to print out the title and the URL of the last object in the multimedia array. (I'm just trying to get it to work, so please pardon the error handling.)</p>\n\n<p>Here's the error I get: <code>panic: json: cannot unmarshal string into Go value of type []struct { URL string \"json:\\\"url\\\"\" }</code></p>\n\n<p>The problem is with the <code>Multimedia</code> struct, apparently. What's confusing me is that this error seems to suggest that it's being interpreted as a string, but I changed the struct to this to make sure:</p>\n\n<pre><code>type PoliticsJson struct {\n    Results []struct {\n        Multimedia string `json:\"multimedia\"`\n        Title      string `json:\"title\"`\n    } `json:\"results\"`\n}\n</code></pre>\n\n<p>And I got <code>panic: json: cannot unmarshal array into Go value of type string</code>, which suggests it <em>is</em> being interpreted as an array in the JSON.</p>\n\n<p>Again, I basically just want to print out the title and the URL of the last object in the multimedia array.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 72977, "user_id": 95944, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/SprKq.jpg?s=128&g=1", "display_name": "Richard Knop", "link": "https://stackoverflow.com/users/95944/richard-knop"}, "edited": false, "score": 1, "creation_date": 1451285158, "post_id": 34488816, "comment_id": 56719622, "body": "Thank you. I have a slow morning. I thought perhaps it was possible to pass data in the same way as with POST requests."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1451284916, "creation_date": 1451284916, "answer_id": 34488816, "question_id": 34488687, "link": "https://stackoverflow.com/questions/34488687/golang-make-get-request-with-data/34488816#34488816", "title": "Golang Make GET Request With Data", "body": "<p>The curl command passes the API key to the server in the URL query string. Here's how to do the same in Go:</p>\n\n<pre><code>payload := url.Values{}\npayload.Add(\"api_key\", \"myapikey\")\nreq, err := http.NewRequest(\"GET\", \"https://someendpoint?\" + payload.Encode(), nil)\n</code></pre>\n"}], "owner": {"reputation": 72977, "user_id": 95944, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/SprKq.jpg?s=128&g=1", "display_name": "Richard Knop", "link": "https://stackoverflow.com/users/95944/richard-knop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3091, "favorite_count": 1, "accepted_answer_id": 34488816, "answer_count": 1, "score": 4, "last_activity_date": 1451284916, "creation_date": 1451284187, "question_id": 34488687, "link": "https://stackoverflow.com/questions/34488687/golang-make-get-request-with-data", "title": "Golang Make GET Request With Data", "body": "<p>Is it possible to do a GET request with data such as:</p>\n\n<pre><code>curl -G -v https://someendpoint \\\n  -d \"api_key=myapikey\"\n</code></pre>\n\n<p>Which works. In Golang I tried:</p>\n\n<pre><code>payload := url.Values{}\npayload.Add(\"api_key\", \"myapikey\")\nreq, err := http.NewRequest(\n    \"GET\",\n    \"https://someendpoint\",\n    bytes.NewBufferString(payload.Encode()),\n)\n</code></pre>\n\n<p>But the api key is not being recognised.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "edited": false, "score": 1, "creation_date": 1451277533, "post_id": 34487648, "comment_id": 56717434, "body": "for dealing with money in Go - i have found this package to be quite useful <a href=\"https://github.com/shopspring/decimal\" rel=\"nofollow noreferrer\">github.com/shopspring/decimal</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3472921"}, "reply_to_user": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "edited": false, "score": 0, "creation_date": 1451277950, "post_id": 34487648, "comment_id": 56717524, "body": "@syllabix Thank you. I will check that also."}, {"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 5, "creation_date": 1451279644, "post_id": 34487648, "comment_id": 56717955, "body": "I would hazard you against using floats for money ever. Especially if transactions are involved. Use integers."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1451288472, "post_id": 34487648, "comment_id": 56720928, "body": "Floats don&#39;t precisely represent decimal amounts because decimal is base 10 and floats are base 2. You can try 0.1+0.2 or your examples in Python or JavaScript, for example. You could start with <code>type Cents int</code> -- <a href=\"http://play.golang.org/p/ZKQipDT-gM\" rel=\"nofollow noreferrer\">here&#39;s an example</a> with (as the code says) no promise of correctness."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451300711, "post_id": 34487648, "comment_id": 56726344, "body": "What is the reason you &quot;have&quot; to use floats? You shouldn&#39;t seek to be the one responsible for implementing currency handling in floats."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3472921"}, "edited": false, "score": 0, "creation_date": 1451294013, "post_id": 34490512, "comment_id": 56722963, "body": "I know that.. I edited my question. Hope you answer my questions."}], "tags": [], "owner": {"reputation": 49169, "user_id": 13744, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ed60d3cd033224d3ea343433ccf6e62?s=128&d=identicon&r=PG", "display_name": "gbjbaanb", "link": "https://stackoverflow.com/users/13744/gbjbaanb"}, "is_accepted": false, "score": 8, "last_activity_date": 1451293371, "creation_date": 1451293371, "answer_id": 34490512, "question_id": 34487648, "link": "https://stackoverflow.com/questions/34487648/go-monetary-calculations/34490512#34490512", "title": "Go - monetary calculations", "body": "<p>Never, ever, never use float for currency. Its an imprecise type, so you end up having to round calculations off and you end up losing (or gaining) a penny here and there. You may think that's ok but your accountant will be able to tell you its not. You <em>have</em> to be perfectly accurate.</p>\n\n<p>So either use an specialised arbitrary-precision decimal type, or use an integer and hold pennies (or fractions of a penny) and display it appropriately. (just like how you hold dates as seconds since 1970, yet display them as dd-mm-yyyy).</p>\n\n<p>PS. Never use floats for currency. Really.</p>\n\n<p>PPS. Do not use floats for currency, not ever never ever.</p>\n"}, {"tags": [], "owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "is_accepted": false, "score": 2, "last_activity_date": 1451427541, "last_edit_date": 1451427541, "creation_date": 1451424777, "answer_id": 34519422, "question_id": 34487648, "link": "https://stackoverflow.com/questions/34487648/go-monetary-calculations/34519422#34519422", "title": "Go - monetary calculations", "body": "<p>Use <code>big.Int</code> values representing 1000ths or 10000ths of a cent. Floating point values are not appropriate for money, especially when transacting. If somebody is demanding that you use floating point values, try to convince them it's a bad idea. If that doesn't work, reconsider your decision to work with them. Consider that you may inadvertently be involving yourself with something illegal: <a href=\"https://en.wikipedia.org/wiki/Salami_slicing\" rel=\"nofollow\">https://en.wikipedia.org/wiki/Salami_slicing</a></p>\n\n<p>In answer to your technical question:</p>\n\n<p><code>big.Float</code> values are not arbitrary precision like <code>big.Int</code> values.</p>\n\n<p><code>SetFloat64</code> sets the precision of the float to that of a <code>float64</code> while <code>SetString</code> sets it based on what the contents of the string are.</p>\n\n<p>Either way you want to be very deliberate about what precision you are setting on a big.Float value. You can control this with <code>SetPrec</code> <a href=\"https://golang.org/pkg/math/big/#Float.SetPrec\" rel=\"nofollow\">https://golang.org/pkg/math/big/#Float.SetPrec</a></p>\n\n<p><strong>Edit:</strong></p>\n\n<p>As for pitfalls, consider that 0.10 in base 10 does not have a finite representation in base 2. Since <code>big.Float</code> doesn't have a <code>base</code> field or anything corresponding to that it can't actually store 0.10 exactly. </p>\n\n<p>Basically as soon as you use the Float as a floating point number instead of as an integer you will leave exact values behind.</p>\n"}, {"tags": [], "owner": {"reputation": 1967, "user_id": 1031871, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7g8bJ.jpg?s=128&g=1", "display_name": "Arun Gopalpuri", "link": "https://stackoverflow.com/users/1031871/arun-gopalpuri"}, "is_accepted": false, "score": 0, "last_activity_date": 1502488850, "creation_date": 1502488850, "answer_id": 45644350, "question_id": 34487648, "link": "https://stackoverflow.com/questions/34487648/go-monetary-calculations/45644350#45644350", "title": "Go - monetary calculations", "body": "<p>You can use <strong>gopkg.in/inf.v0</strong> which implements \"infinite-precision\" decimal arithmetic.</p>\n\n<p>For your specified amounts above, here's an e.g.:</p>\n\n<p><code>func main() {\n    var amt inf.Dec\n    amt.SetUnscaled(1890)\n    amt.SetScale(2)\n    fmt.Println(amt.String())\n    var amt1 inf.Dec\n    amt1.SetUnscaled(165)\n    amt1.SetScale(2)\n    fmt.Println(amt1.String())\n    var total = inf.NewDec(5, 2)\n    total = total.Add(&amp;amt, &amp;amt1)\n    fmt.Println(total.String())\n}\n</code>\nIt should print out 20.55 as expected.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3472921"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1864, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1502488850, "creation_date": 1451276608, "last_edit_date": 1451293011, "question_id": 34487648, "link": "https://stackoverflow.com/questions/34487648/go-monetary-calculations", "title": "Go - monetary calculations", "body": "<p>I am trying to do monetary calculations with Go.</p>\n\n<p>Looking around the standard library, <code>big/math</code> seems to be the one I can make use of.<br>\nAnd I ran some codes to check how it works.</p>\n\n<p>First I used <code>Float.SetFloat64()</code></p>\n\n<pre><code>var f = 18.9\nvar f2 = 1.65\nbf := new(big.Float)\nbf.Add(bf, new(big.Float).SetFloat64(f))\nbf.Add(bf, new(big.Float).SetFloat64(f2))\nresult, _ := bf.Float64()\nfmt.Println(result)\n</code></pre>\n\n<p>This gives me the result: <code>20.549999999999997</code><br>\nJust like the calculation with <code>float64</code> type.<br>\nSince I'm dealing with money, the result must be <code>20.55</code>. </p>\n\n<p>Instead, when using <code>Float.SetString()</code></p>\n\n<pre><code>var s = fmt.Sprintf(\"%f\", 18.9)\nvar s2 = fmt.Sprintf(\"%f\", 1.65)\nbf := new(big.Float)\nbf2, _ := new(big.Float).SetString(s)\nbf3, _ := new(big.Float).SetString(s2)\nbf.Add(bf, bf2)\nbf.Add(bf, bf3)\nresult, _ := bf.Float64()\nfmt.Println(result)\n</code></pre>\n\n<p>This gives me the result: <code>20.55</code><br>\nIt SEEMs I can use this for my purpose (but I am not sure..). </p>\n\n<p>My questions are</p>\n\n<ol>\n<li><p>Why the difference beteween using <code>Float.SetFloat64()</code> and <code>Float.SetString()</code>?</p></li>\n<li><p>Are there any pitfalls when using <code>Float.SetString()</code> for monetary calculations?</p></li>\n</ol>\n\n<p>Thanks in advance, and forgive my English.</p>\n\n<p>[EDIT]</p>\n\n<p>I know float types should be avoided for representing money value.<br>\nbut the choice of the type is not really under my control..  </p>\n\n<p>I want to know the answers to either(or both) of the above two questions.</p>\n\n<p>Or the reason why <code>Float.SetString()</code> gives me the seemingly correct results is also helpful.</p>\n"}, {"tags": ["java", "go"], "comments": [{"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1451301060, "post_id": 34486547, "comment_id": 56726522, "body": "Note that the <code>Output</code> method will only capture stdout.  Output sent to stderr (like what <code>java -version</code> does) will end up going to <code>&#47;dev&#47;null</code>.  Using <code>CombinedOutput</code> instead might help a little, but probably doesn&#39;t solve the problem entirely."}, {"owner": {"reputation": 127, "user_id": 1813037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f59f62a9c930c1f642a50558654abdac?s=128&d=identicon&r=PG", "display_name": "user1813037", "link": "https://stackoverflow.com/users/1813037/user1813037"}, "edited": false, "score": 0, "creation_date": 1451333997, "post_id": 34486547, "comment_id": 56741847, "body": "&gt; What is the exact error?  When I try to use &gt;&gt; cmd_prep := &quot;java -version&quot; &lt;&lt; there is no output . I have tried to add &#39;2&gt;&amp;1&#39; to cmd_prep to re-route all but nothing happened . The sam thing happened with python code ... but with python I was able to fix with some time.sleep() function .  &gt; Is there a requirement for using bash not stated i the question? Yes and no. The Java application we are using was triggered by shell one line syntax, that is idea behind to do same from golang . &gt; If not, then run Java directly. No clue how to do that"}, {"owner": {"reputation": 127, "user_id": 1813037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f59f62a9c930c1f642a50558654abdac?s=128&d=identicon&r=PG", "display_name": "user1813037", "link": "https://stackoverflow.com/users/1813037/user1813037"}, "reply_to_user": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1451334009, "post_id": 34486547, "comment_id": 56741854, "body": "@James, I will give a try to use CombinedOutput. Actually need to get somehow output to a string and from that I can parse, regexp"}], "answers": [{"comments": [{"owner": {"reputation": 2855, "user_id": 5105305, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh4.googleusercontent.com/-i8lMihc1yYc/AAAAAAAAAAI/AAAAAAAAAJE/ooPD4M12q8I/photo.jpg?sz=128", "display_name": "Kasun Siyambalapitiya", "link": "https://stackoverflow.com/users/5105305/kasun-siyambalapitiya"}, "edited": false, "score": 0, "creation_date": 1499677358, "post_id": 34508954, "comment_id": 76989053, "body": "for this to run, we need to have <code>JRE</code> in the system , am I right"}], "tags": [], "owner": {"reputation": 127, "user_id": 1813037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f59f62a9c930c1f642a50558654abdac?s=128&d=identicon&r=PG", "display_name": "user1813037", "link": "https://stackoverflow.com/users/1813037/user1813037"}, "is_accepted": false, "score": 0, "last_activity_date": 1451384341, "creation_date": 1451384341, "answer_id": 34508954, "question_id": 34486547, "link": "https://stackoverflow.com/questions/34486547/how-to-trigger-java-aplication-java-jar-app-name-from-google-go-golang-sub/34508954#34508954", "title": "how to trigger java aplication (java -jar &lt;app_name&gt; from Google GO / golang sub_process", "body": "<p>It works very well with 'CombinedOutput'  :)</p>\n\n<pre><code>$ go run TestCombinedOutput.go \njava version \"1.8.0_65\"\nJava(TM) SE Runtime Environment (build 1.8.0_65-b17)\nJava HotSpot(TM) 64-Bit Server VM (build 25.65-b01, mixed mode)\n</code></pre>\n\n<p>Thanks a lot.</p>\n\n<p>Cheers,</p>\n\n<p>.C</p>\n"}], "owner": {"reputation": 127, "user_id": 1813037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f59f62a9c930c1f642a50558654abdac?s=128&d=identicon&r=PG", "display_name": "user1813037", "link": "https://stackoverflow.com/users/1813037/user1813037"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1767, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451384341, "creation_date": 1451264681, "question_id": 34486547, "link": "https://stackoverflow.com/questions/34486547/how-to-trigger-java-aplication-java-jar-app-name-from-google-go-golang-sub", "title": "how to trigger java aplication (java -jar &lt;app_name&gt; from Google GO / golang sub_process", "body": "<p>I'm trying to trigger java command line application as a sub process from golang.\nFor some reason it failed and actually I do not get java APP interface when I start it from GO. It wait for few sec and terminate with error code \"can not connect ... \"\nHere is a code I tried to use:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"os/exec\"\n)\nfunc main() {\n    start_java_app_test()\n}\nfunc start_java_app_test() {\n    cmd_prep := \"java -Xmx2g -jar test_app.jar\"\n    cmd_output, err := exec.Command(\"bash\", \"-c\", cmd_prep).Output()\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(vba_ssh_cmd_output)\n}\n</code></pre>\n\n<p>If we try just to use -->  <code>cmd_prep := \"java -version\"</code>  &lt;--\nit  will fail again.\nIt should give me output like\n&lt;&lt; snip >>\n$ java -version\njava version \"1.8.0_65\"\nJava(TM) SE Runtime Environment (build 1.8.0_65-b17)\nJava HotSpot(TM) 64-Bit Server VM (build 25.65-b01, mixed mode)\n&lt;&lt; /snip >></p>\n\n<p>The normal syntax like -->  <code>cmd_prep := \"ls -l\"</code>  &lt;--    works fine.\nAny clue ? \nWhat might be the reason here ?\nThanks in advance,\n.C</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1451224367, "post_id": 34481065, "comment_id": 56703699, "body": "<i>What I want to do is get rid of the if-clause</i> Why is this an issue?"}, {"owner": {"reputation": 435, "user_id": 3162261, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/06813697a52abdc3b82be98f99d479ba?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/3162261/chris"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1451224503, "post_id": 34481065, "comment_id": 56703736, "body": "If I remove the if-clause, and just press Return, the program is not leaving the loop. On the console it just puts me on the next line. The code after the loop is not getting executed."}], "answers": [{"comments": [{"owner": {"reputation": 3206, "user_id": 818766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/684198cd272837e4651b9770dbe21ae4?s=128&d=identicon&r=PG", "display_name": "manyways", "link": "https://stackoverflow.com/users/818766/manyways"}, "edited": false, "score": 6, "creation_date": 1501179393, "post_id": 34481857, "comment_id": 77677910, "body": "On windows use Ctrl-Z."}], "tags": [], "owner": {"reputation": 8752, "user_id": 559289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8183a67842b916b7d7dfd99f5ce7759d?s=128&d=identicon&r=PG", "display_name": "Micka&#235;l R&#233;mond", "link": "https://stackoverflow.com/users/559289/micka%c3%abl-r%c3%a9mond"}, "is_accepted": true, "score": 36, "last_activity_date": 1451230021, "creation_date": 1451230021, "answer_id": 34481857, "question_id": 34481065, "link": "https://stackoverflow.com/questions/34481065/break-out-of-input-scan/34481857#34481857", "title": "Break out of input.Scan()", "body": "<p>I think you misread the documentation. The default scanner is ScanLines function.</p>\n\n<p>Documentation says:</p>\n\n<blockquote>\n  <p>ScanLines is a split function for a Scanner that returns each line of\n  text, stripped of any trailing end-of-line marker. The returned line\n  may be empty. The end-of-line marker is one optional carriage return\n  followed by one mandatory newline. In regular expression notation, it\n  is <code>\\r?\\n</code>. The last non-empty line of input will be returned even if\n  it has no newline.</p>\n</blockquote>\n\n<p>Two important points here:</p>\n\n<ul>\n<li><em>The return line may be empty</em>: It means it returns empty lines.</li>\n<li><em>The last non-empty line of input will be returned even if it has no newline</em>: It means the last line of a file is always returned if it is non empty. It does not mean however an empty line end the stream.</li>\n</ul>\n\n<p>The scanner will stop on EOF (End Of File). Typing Ctrl-D for example will send end of file and stop the scanner.</p>\n"}, {"comments": [{"owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "reply_to_user": {"reputation": 435, "user_id": 3162261, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/06813697a52abdc3b82be98f99d479ba?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/3162261/chris"}, "edited": false, "score": 0, "creation_date": 1451233036, "post_id": 34481908, "comment_id": 56706350, "body": "@Chris I saw Micka&#235;l R&#233;mond&#39;s technically accurate answer before posting mine, so I decided to focus on simply making the code perform as you seemed to want it to. Thanks for the up vote ;)"}], "tags": [], "owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "is_accepted": false, "score": 6, "last_activity_date": 1460466313, "last_edit_date": 1460466313, "creation_date": 1451230372, "answer_id": 34481908, "question_id": 34481065, "link": "https://stackoverflow.com/questions/34481065/break-out-of-input-scan/34481908#34481908", "title": "Break out of input.Scan()", "body": "<p>Typing a blank new line will not automatically stop the scanner.</p>\n\n<p>If it ain't broke, don't fix it--but you can make it behave as you require. This doesn't get rid of your <code>if</code> block but functions as you expected scanner to, i.e. hitting enter with no input will stop the scanner:</p>\n\n<pre><code>    input := bufio.NewScanner(os.Stdin) //Creating a Scanner that will read the input from the console\n\n    for input.Scan() {\n        if input.Text() == \"\" {\n            break\n        } \n        fmt.Println(input.Text())\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 432, "user_id": 6340231, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mHxBsfkZqiQ/AAAAAAAAAAI/AAAAAAAAAtU/ToLwyfBT1HM/photo.jpg?sz=128", "display_name": "Abhay Kumar", "link": "https://stackoverflow.com/users/6340231/abhay-kumar"}, "is_accepted": false, "score": 1, "last_activity_date": 1539700449, "creation_date": 1539700449, "answer_id": 52837926, "question_id": 34481065, "link": "https://stackoverflow.com/questions/34481065/break-out-of-input-scan/52837926#52837926", "title": "Break out of input.Scan()", "body": "<p>You are not misinterpreting the documentation. </p>\n\n<blockquote>\n  <p>It returns false when the scan stops, either <strong>by reaching the end of the input</strong> or an error.</p>\n</blockquote>\n\n<p>What documentation states is correct. But you are missing that you need a way to provide end of the input i.e. EOF from the console. </p>\n\n<p>In linux you can press \"CTRL+D\", which signals EOF from terminal. </p>\n\n<p>Though there is a small catch here, that \"CTRL+D\" works only at the beginning of the line. Thus to terminate the input from terminal you need to go to a new line and press \"CTRL+D\" as first input on the line. </p>\n"}, {"tags": [], "owner": {"reputation": 3868, "user_id": 2295484, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BAohf.png?s=128&g=1", "display_name": "Krishnadas PC", "link": "https://stackoverflow.com/users/2295484/krishnadas-pc"}, "is_accepted": false, "score": 0, "last_activity_date": 1549534880, "creation_date": 1549534880, "answer_id": 54571108, "question_id": 34481065, "link": "https://stackoverflow.com/questions/34481065/break-out-of-input-scan/54571108#54571108", "title": "Break out of input.Scan()", "body": "<p>For Mac systems, you can try <code>Ctrl + D</code> to break by default. If you are at the end of the line you will have to hit <code>Ctrl + D</code> <strong>2 times</strong>.</p>\n"}, {"tags": [], "owner": {"reputation": 116, "user_id": 7140332, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZuSR6_YQxSs/AAAAAAAAAAI/AAAAAAAAACc/uAhk0CrT4Vc/photo.jpg?sz=128", "display_name": "\u738b\u4e07\u9e4f", "link": "https://stackoverflow.com/users/7140332/%e7%8e%8b%e4%b8%87%e9%b9%8f"}, "is_accepted": false, "score": 5, "last_activity_date": 1555954841, "creation_date": 1555954841, "answer_id": 55798562, "question_id": 34481065, "link": "https://stackoverflow.com/questions/34481065/break-out-of-input-scan/55798562#55798562", "title": "Break out of input.Scan()", "body": "<p><code>CTRL+D</code> to break,\nif you want to input data easily, you can use <code>cat input.txt | go run script.go</code> or <code>go run script.go &lt; input.txt</code>.</p>\n"}], "owner": {"reputation": 435, "user_id": 3162261, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/06813697a52abdc3b82be98f99d479ba?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/3162261/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8333, "favorite_count": 7, "accepted_answer_id": 34481857, "answer_count": 5, "score": 19, "last_activity_date": 1555954841, "creation_date": 1451224318, "last_edit_date": 1470223154, "question_id": 34481065, "link": "https://stackoverflow.com/questions/34481065/break-out-of-input-scan", "title": "Break out of input.Scan()", "body": "<p>I have this simple code to read all input from the console:</p>\n\n<pre><code>input := bufio.NewScanner(os.Stdin) //Creating a Scanner that will read the input from the console\n\nfor input.Scan() {\n    if input.Text() == \"end\" { break } //Break out of input loop when the user types the word \"end\"\n    fmt.Println(input.Text())\n}\n</code></pre>\n\n<p>The code as it is works. What I want to do is get rid of the if-clause. In my understanding of the documentation if a line is empty <code>input.Scan()</code> should return false and therefore break out of the loop.</p>\n\n<blockquote>\n  <p>Scan advances the Scanner to the next token, which will then be available through the Bytes or Text method. It returns false when the scan stops, either by reaching the end of the input or an error. After Scan returns false, the Err method will return any error that occurred during scanning, except that if it was <code>io.EOF</code>, Err will return nil. Scan panics if the split function returns 100 empty tokens without advancing the input. This is a common error mode for scanners.</p>\n</blockquote>\n\n<p>Am I misinterpreting the documentation and it is actually necessary to have such a if-clause to break out? (I'm using Go 1.5.2 running the program using \"go run\".)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 1, "creation_date": 1451220270, "post_id": 34480387, "comment_id": 56702504, "body": "How do you call <code>waitForMessage</code>? In your posted code, you don&#39;t call it at all."}, {"owner": {"reputation": 35121, "user_id": 577455, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/2f5b02182d3fa5ca4afeb39c32f09953?s=128&d=identicon&r=PG", "display_name": "Leahcim", "link": "https://stackoverflow.com/users/577455/leahcim"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1451221418, "post_id": 34480387, "comment_id": 56702816, "body": "@PaulHankin I updated the OP to show how <code>waitForMessage</code> is called (i.e it&#39;s websocket handler). Note, I changed the name of the func in the edited code"}], "answers": [{"tags": [], "owner": {"reputation": 8752, "user_id": 559289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8183a67842b916b7d7dfd99f5ce7759d?s=128&d=identicon&r=PG", "display_name": "Micka&#235;l R&#233;mond", "link": "https://stackoverflow.com/users/559289/micka%c3%abl-r%c3%a9mond"}, "is_accepted": true, "score": 2, "last_activity_date": 1451228917, "creation_date": 1451228917, "answer_id": 34481712, "question_id": 34480387, "link": "https://stackoverflow.com/questions/34480387/can-only-receive-one-message-on-a-channel/34481712#34481712", "title": "can only receive one message on a channel", "body": "<p>Your WebSock function need to include a receive loop to receive more than one message. Otherwise, your function will terminate and the websocket connection will be closed.</p>\n"}, {"tags": [], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "is_accepted": false, "score": 0, "last_activity_date": 1451250041, "creation_date": 1451250041, "answer_id": 34484772, "question_id": 34480387, "link": "https://stackoverflow.com/questions/34480387/can-only-receive-one-message-on-a-channel/34484772#34484772", "title": "can only receive one message on a channel", "body": "<p>@Micka\u00ebl R\u00e9mond is right. Modify your <code>Websock</code> function to something like:</p>\n\n<pre><code>func Websock(ws *websocket.Conn) {\n    for {\n        msg := &lt;-messages\n        log.Println(\"only one message arrives, even if I create for two events\", msg)\n        if err := websocket.Message.Send(ws, msg); err != nil {\n            log.Fatal(err)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 35121, "user_id": 577455, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/2f5b02182d3fa5ca4afeb39c32f09953?s=128&d=identicon&r=PG", "display_name": "Leahcim", "link": "https://stackoverflow.com/users/577455/leahcim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 34481712, "answer_count": 2, "score": 0, "last_activity_date": 1451250041, "creation_date": 1451219313, "last_edit_date": 1451221379, "question_id": 34480387, "link": "https://stackoverflow.com/questions/34480387/can-only-receive-one-message-on-a-channel", "title": "can only receive one message on a channel", "body": "<p>I've created a global channel, and am sending messages to it whenever a new event occurs inside of ExampleNewWatcher. The first time an event occurs, the message is getting received in the receiving end of the channel. However, the second time an event occurs, I am not receiving a message in the receiving end of the channel.</p>\n\n<pre><code>var messages = make(chan string)\nfunc ExampleNewWatcher(){\n  watcher, err := fsnotify.NewWatcher()\n  if err != nil{\n    log.Fatal(err)\n  }\n  defer watcher.Close(0\n  done := make(chan bool)\n  go func(){\n     for {\n        select{\n           case event := &lt;- watcher.Events:\n              if event.Op&amp;fsnotify.Write == fsnotify.Write{\n                 log.Println(\"this logs twice if I create two write events\")\n                 messages &lt;- \"this message only gets sent once even if I create two events\"\n              }\n           case err := &lt;- watcher.Errors:\n               log.Println(\"error\", err)\n        }\n\n     }\n  }()\n  err = watcher.Add(\"/tmp/watchedfile\")\n  &lt;-done\n}\nfunc Websock(ws *websocket.Conn){\n   msg := &lt;-messages\n   log.Println(\"only one message arrives, even if I create for two events\", msg)\n   err := websocket.Message.Send(ws, msg)\n\n}\nfunc main(){\n go ExampleNewWatcher() //for some reason, the server doesn't run unless I prefix a go routine to this watcher function, but that's another issue ...\n\n  http.Handle(\"/websock\", websocket.Handler(Websock))\n log.Fatal(http.ListenAndServe(\":8000\", nil))\n\n}\n</code></pre>\n"}, {"tags": ["file", "templates", "variables", "go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1451219071, "post_id": 34480242, "comment_id": 56702257, "body": "you mean go&#39;s template engine? <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template</a>"}, {"owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1451220123, "post_id": 34480242, "comment_id": 56702469, "body": "@Not_a_Golfer Could you post this as an answer?"}], "answers": [{"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 3, "last_activity_date": 1451220301, "creation_date": 1451220301, "answer_id": 34480510, "question_id": 34480242, "link": "https://stackoverflow.com/questions/34480242/does-go-feature-a-template-language/34480510#34480510", "title": "Does Go feature a template language?", "body": "<p>The question is a bit unclear, but Go has a very powerful template engine built in: <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow\">https://golang.org/pkg/text/template/</a></p>\n\n<p>There's even a special HTML extension package of it that does automatic escaping based on context (attributes, tags, text, etc) - <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow\">https://golang.org/pkg/html/template/</a></p>\n\n<p>The above example would look something like:</p>\n\n<pre><code>{{ range .Values }}\n    Some stuff with {{ . }}\n{{ end }}\n</code></pre>\n"}], "owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 34480510, "answer_count": 1, "score": -1, "last_activity_date": 1451239260, "creation_date": 1451218140, "last_edit_date": 1451239260, "question_id": 34480242, "link": "https://stackoverflow.com/questions/34480242/does-go-feature-a-template-language", "title": "Does Go feature a template language?", "body": "<p><a href=\"https://docs.puppetlabs.com/puppet/latest/reference/lang_template_erb.html\" rel=\"nofollow\">In Puppet it is possible to lookup variables in files using ERBs</a>, e.g.:</p>\n\n<blockquote>\n<pre><code>&lt;% @values.each do |val| -%&gt;\nSome stuff with &lt;%= val %&gt;\n&lt;% end -%&gt;\n</code></pre>\n</blockquote>\n\n<p>How to do the same using Go?</p>\n"}, {"tags": ["go", "dereference", "string-literals"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1451215247, "post_id": 34479891, "comment_id": 56701466, "body": "You cannot because literals are not addressable by the language spec."}, {"owner": {"reputation": 8775, "user_id": 821110, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/fa6fca5f613944238a91d2daeba67b9d?s=128&d=identicon&r=PG", "display_name": "W.K.S", "link": "https://stackoverflow.com/users/821110/w-k-s"}, "edited": false, "score": 1, "creation_date": 1451215454, "post_id": 34479891, "comment_id": 56701508, "body": "If my understanding is correct, literals are hard-coded into the executable binary and therefore can not be referenced."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1451218120, "post_id": 34479891, "comment_id": 56702069, "body": "Related: <a href=\"http://stackoverflow.com/questions/30716354/how-do-i-do-a-literal-int64-in-go\">How do I do a literal *int64 in Go?</a> Same applies here just with <code>string</code> instead of <code>int64</code>."}], "owner": {"reputation": 4754, "user_id": 1209628, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa17169df5962bb7d05e661c3b6ba4f1?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/1209628/mark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 156, "favorite_count": 0, "closed_date": 1451221326, "answer_count": 0, "score": 2, "last_activity_date": 1451220744, "creation_date": 1451215092, "question_id": 34479891, "link": "https://stackoverflow.com/questions/34479891/dereferencing-string-literal-in-go", "closed_reason": "Duplicate", "title": "dereferencing string literal in Go", "body": "<p>I am playing with Go and facing the following question:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var arr [2]*string\n    var s1 string = \"hello\"\n    arr[0] = &amp;s1\n    arr[1] = &amp;\"world\"   // can't compile\n    fmt.Println(arr[0], arr[1])\n    fmt.Println(arr)\n}\n</code></pre>\n\n<p>After compiling the above code I got the next error:</p>\n\n<pre><code>prog.go:10: cannot take the address of \"world\"\n</code></pre>\n\n<p>What is the reason I cannot obtain the address of the string literal?\nAnd if it is possible how can I do that?</p>\n\n<p>Note: I obtained the address of <code>s1</code>. Should I always introduce variables for literals to get back their addresses?</p>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1451214706, "post_id": 34479595, "comment_id": 56701339, "body": "You have to export the fields (capitalize them) to be able to marshal data. Use struct tags to map Mongo column names to Go field names."}], "answers": [{"tags": [], "owner": {"reputation": 1366, "user_id": 4931643, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/702807200eaef92e4d1c6896893d7888?s=128&d=identicon&r=PG&f=1", "display_name": "Mbded", "link": "https://stackoverflow.com/users/4931643/mbded"}, "is_accepted": false, "score": 2, "last_activity_date": 1451224022, "last_edit_date": 1451224022, "creation_date": 1451223682, "answer_id": 34480977, "question_id": 34479595, "link": "https://stackoverflow.com/questions/34479595/go-nested-object-with-mgo-adapter/34480977#34480977", "title": "Go nested object with mgo adapter", "body": "<p>I wrote this jus from hand. But You must remember about capitalize name field, and property <code>json</code> form inside structure.</p>\n\n<pre><code>type User struct {\n    Id           bson.ObjectId `bson:\"_id,omitempty\"`\n    Username         string\n    Type         string\n    Data struct { // Data nor data\n        Full struct { // Full nor full\n            Xx   string   `json:\"xx\"`  // Xx nor xx\n            Xx string   `json:\"xx\"`    \n            Xxx      struct{} `json:\"xx\"`\n            Yy    struct {   // Yy nor yy\n\n            }`json:\"yy\"` \n        } `json:\"full\"`\n    } `json:\"data\"`\n}\n</code></pre>\n\n<p><strong>EDIT</strong>:</p>\n\n<p>Another works example</p>\n\n<p>Structure in go</p>\n\n<pre><code>type Event struct{\n\n    EvL []struct {\n        BaV int     `json:\"basicV\"`\n        ChI int     `json:\"chann\"`\n        DaU int     `json:\"dataU\"`\n\n    } `json:\"eventL\"`\n\n    ST int `json:\"send.dat_ts\"`\n}\n</code></pre>\n\n<p>Below how to looks above structure wrote to DB</p>\n\n<pre><code>{ \"_id\" :\n\n    ObjectId(\"560d422e65f47eef8a118cbd\"),\n    \"evl\" :\n [\n    {\n        \"bav\" : 255,\n        \"chi\" : 14,\n        \"dau\" : 0,\n  ],\n  \"st\" : 5\n}\n</code></pre>\n"}], "owner": {"reputation": 635, "user_id": 2329355, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/quUmq.jpg?s=128&g=1", "display_name": "Daniel Chernenkov", "link": "https://stackoverflow.com/users/2329355/daniel-chernenkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 638, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451224022, "creation_date": 1451212545, "question_id": 34479595, "link": "https://stackoverflow.com/questions/34479595/go-nested-object-with-mgo-adapter", "title": "Go nested object with mgo adapter", "body": "<p>I'm working on a project that based on MongoDB data structure. Our objects that stored inside the database looks like this:</p>\n\n<pre><code>{\n\"_id\" : ObjectId(\"567a877df1c7720bea7c2f51\"),\n\"username\" : \"dog\",\n\"type\" : \"regular\",\n\"data\" : {\n    \"full\" : {\n        \"xx\" : \"xx\",\n        \"xx\" : \"xx\",\n        \"yy\" : {\n            \"xx\" : \"test\"\n        },\n        \"yy\" : {\n            \"xx\" : {\n\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>And the struct that we working on with Golang looks like this:</p>\n\n<pre><code>type User struct {\n    Id           bson.ObjectId `bson:\"_id,omitempty\"`\n    username         string\n    Type         string\n    data struct {\n        full struct {\n            xx   string   `json:\"xx\"`\n            xx string   `json:\"xx\"`\n            xxx      struct{} `json:\"xx\"`\n            yy    struct {\n\n            } \n        } \n    } \n}\n</code></pre>\n\n<p>The thing is that the first properties gets fill with data without any problem but the objects inside the object are not working.</p>\n\n<p>Our code to pull data is the regular code as we saw in the MGO documentation. </p>\n\n<pre><code>err = collection.Find(bson.M{\"username\": username}).One(&amp;user)\n</code></pre>\n\n<p>Is there any specific way to fetch the data in that way?</p>\n"}, {"tags": ["api", "url", "redirect", "go", "medium.com"], "answers": [{"comments": [{"owner": {"reputation": 189, "user_id": 2128746, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/lQXxz.jpg?s=128&g=1", "display_name": "Hasit Mistry", "link": "https://stackoverflow.com/users/2128746/hasit-mistry"}, "edited": false, "score": 0, "creation_date": 1451208079, "post_id": 34476752, "comment_id": 56699901, "body": "Thank you. I will be taking the &#39;Self-Issued Access Tokens&#39; route."}], "tags": [], "owner": {"reputation": 1739, "user_id": 91449, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/279929b6e31ee2eda28479f7829e6bb0?s=128&d=identicon&r=PG", "display_name": "Guildencrantz", "link": "https://stackoverflow.com/users/91449/guildencrantz"}, "is_accepted": true, "score": 2, "last_activity_date": 1451178491, "creation_date": 1451178491, "answer_id": 34476752, "question_id": 34474664, "link": "https://stackoverflow.com/questions/34474664/open-a-url-in-golang-and-read-the-redirected-url/34476752#34476752", "title": "Open a url in golang and read the redirected url", "body": "<p>The important shift that needs to happen is around your question <code>how can I fetch the redirected url</code>, because the answer is: You don't. Medium is going to post to this URL. You need to have a webserver somewhere that listens on this URL and parses the response.</p>\n\n<p>Since you're writing a CLI tool and not a web service, this is probably the inappropriate way to do authentication: Medium provides <a href=\"https://github.com/Medium/medium-api-docs#22-self-issued-access-tokens\" rel=\"nofollow\">Self-Issued Access Tokens</a> for use in desktop applications.</p>\n"}], "owner": {"reputation": 189, "user_id": 2128746, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/lQXxz.jpg?s=128&g=1", "display_name": "Hasit Mistry", "link": "https://stackoverflow.com/users/2128746/hasit-mistry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1285, "favorite_count": 0, "accepted_answer_id": 34476752, "answer_count": 1, "score": 0, "last_activity_date": 1451178491, "creation_date": 1451159253, "last_edit_date": 1451159691, "question_id": 34474664, "link": "https://stackoverflow.com/questions/34474664/open-a-url-in-golang-and-read-the-redirected-url", "title": "Open a url in golang and read the redirected url", "body": "<p>I am writing a command line tool for accessing <a href=\"https://github.com/Medium/medium-api-docs\" rel=\"nofollow\">Medium.com's API</a> using Go. They have released this <a href=\"https://github.com/Medium/medium-sdk-go\" rel=\"nofollow\">SDK for golang</a> too.</p>\n\n<p>I have followed the instructions until the point where I can build a url using secret state, redirect url, and scopes. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/Medium/medium-sdk-go\"\n)\n\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n\nfunc mediumAuth() {\n    m := medium.NewClient(\"clientIDString\", \"clientSecretString\")\n\n    url := m.GetAuthorizationURL(\"supersecretstring\", \"http://hasit.me/callback/medium\", medium.ScopeBasicProfile, medium.ScopePublishPost)\n\n    //next step\n}\n\n\nfunc main() {\n    mediumAuth()\n}\n</code></pre>\n\n<p>The next step is to open the url to let user give permission for accessing his/her profile. I can successfully open the url.</p>\n\n<pre><code>exec.Command(\"open\", url).Start()\n</code></pre>\n\n<p>Now, once the user clicks on the url, how can I fetch the redirected url? I even tried using http GET but the response is not the one that I want.</p>\n\n<pre><code>resp, err := http.Get(url)\n</code></pre>\n\n<p>I am sorry if the answer is obvious but this will be my first program where I use some API in any language. Help will be appreciated. </p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 2963, "user_id": 1855442, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/61b99c64abe73180373944232b0c734f?s=128&d=identicon&r=PG", "display_name": "Pradheep", "link": "https://stackoverflow.com/users/1855442/pradheep"}, "edited": false, "score": 0, "creation_date": 1451152538, "post_id": 34473690, "comment_id": 56688993, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/26281366/jsonify-map-of-structs-in-go\" title=\"jsonify map of structs in go\">stackoverflow.com/questions/26281366/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1451152663, "creation_date": 1451152663, "answer_id": 34473789, "question_id": 34473690, "link": "https://stackoverflow.com/questions/34473690/return-entire-struct-from-go-function/34473789#34473789", "title": "Return Entire Struct from Go function", "body": "<p>Because the JSON decoder ignores unexported field names, you must \n<a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow\">export</a> the field names:</p>\n\n<pre><code>type content struct {\n  Field1 string `json:\"Language\"`\n  Field2  int `json:\"Runtime\"`\n  Field3 time.Time `json:\"StartTime\"`\n  Field4 time.Time `json:\"EndTime\"`\n  Field5 int64 `json:\"ProgramId`\n  Field6 string `json:\"ProviderId\"`\n  Field7 string `json:\"Title:`\n}\n</code></pre>\n\n<p>To show the fields, print the decoded value <code>content</code> using \"%+v\":</p>\n\n<pre><code>fmt.Printf(\"%+v\\n\", content)\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 2502053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5c7476fd88b34ca2dbf898f5056e337d?s=128&d=identicon&r=PG", "display_name": "user2502053", "link": "https://stackoverflow.com/users/2502053/user2502053"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 34473789, "answer_count": 1, "score": -2, "last_activity_date": 1451158386, "creation_date": 1451151960, "last_edit_date": 1451158386, "question_id": 34473690, "link": "https://stackoverflow.com/questions/34473690/return-entire-struct-from-go-function", "title": "Return Entire Struct from Go function", "body": "<p>I have a lengthy struct of json key value pairs returned from a GET function. Similiar to:</p>\n\n<pre><code>type content struct {\nfield1 string `json:\"Language\"`\nfield2  int `json:\"Runtime\"`\nfield3 time.Time `json:\"StartTime\"`\nfield4 time.Time `json:\"EndTime\"`\nfield5 int64 `json:\"ProgramId`\nfield6 string `json:\"ProviderId\"`\nfield7 string `json:\"Title:`\n}\n</code></pre>\n\n<p>I know how to return a single field value using:</p>\n\n<pre><code>println(content.field1)\n</code></pre>\n\n<p>but how do I return every field name and value without listing out every element?  How would I return something like this?</p>\n\n<pre><code>field1:value\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3913, "user_id": 1274815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfa80d65597d3e43664c762cbb715e38?s=128&d=identicon&r=PG", "display_name": "gbulmer", "link": "https://stackoverflow.com/users/1274815/gbulmer"}, "edited": false, "score": 0, "creation_date": 1451140691, "post_id": 34472070, "comment_id": 56685770, "body": "What are the characteristics of the use of the data structure? You say its small and performance isn&#39;t interesting. If it&#39;s small, whatever structure is used will likely mostly fit in cache, so simplicity and robustness likely dominate. However, what are the common operations? Does search dominate? Are there many inserts and deletes, even if it remains small? The only awkward operations on slices is delete and insert, and they are still pretty straightforward to write in Go. If the only value is a string, then a slice of strings is probably the simplest. Adding sort is easy too."}], "answers": [{"comments": [{"owner": {"reputation": 33459, "user_id": 928098, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/2761f0967c4a4b1839c1feee764c6dd7?s=128&d=identicon&r=PG", "display_name": "Kristian Glass", "link": "https://stackoverflow.com/users/928098/kristian-glass"}, "edited": false, "score": 0, "creation_date": 1451139684, "post_id": 34472175, "comment_id": 56685515, "body": "Haha it&#39;s a small internet! Thanks very much :D"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1451140679, "post_id": 34472175, "comment_id": 56685764, "body": "Please note that if the searched element is not in the slice, your <code>foo</code> variable will hold the last element of the slice, certainly not what you want."}, {"owner": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1451214747, "post_id": 34472175, "comment_id": 56701347, "body": "@icza yes you are right! (I followed the OPs code too closely!)  I&#39;ve fixed that now."}], "tags": [], "owner": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "is_accepted": true, "score": 6, "last_activity_date": 1451214650, "last_edit_date": 1451214650, "creation_date": 1451139612, "answer_id": 34472175, "question_id": 34472070, "link": "https://stackoverflow.com/questions/34472070/finding-an-item-by-iterating-through-a-go-list/34472175#34472175", "title": "Finding an item by iterating through a Go list", "body": "<p>For idiomatic Go you want a slice of pointers to <code>Foo</code> (though if Foo is very small you might choose just a slice of <code>Foo</code>), so</p>\n\n<pre><code>var foos []*Foo\n</code></pre>\n\n<p>And then for searching</p>\n\n<pre><code>var found *Foo\nfor _, foo := range foos {\n    if foo.name == \"bar\" {\n        found = foo\n        break\n    }\n}\n\nif found != nil {\n    // stuff\n}\n</code></pre>\n\n<p>If you do this a lot you'll wrap it up with some types something like this</p>\n\n<pre><code>type Foos []*Foo\n\nfunc (fs Foos) find(what string) (foo *Foo) {\n    for _, foo = range foos {\n        if foo.name == what {\n            return foo\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>Then you can do</p>\n\n<pre><code>var foos Foos\nfoo := foos.find(\"bar\")\nif foo != nil {\n    // something\n}\n</code></pre>\n\n<p>PS Nice to answer a question for someone I've actually met!</p>\n"}], "owner": {"reputation": 33459, "user_id": 928098, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/2761f0967c4a4b1839c1feee764c6dd7?s=128&d=identicon&r=PG", "display_name": "Kristian Glass", "link": "https://stackoverflow.com/users/928098/kristian-glass"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 34472175, "answer_count": 1, "score": 2, "last_activity_date": 1451214650, "creation_date": 1451138764, "question_id": 34472070, "link": "https://stackoverflow.com/questions/34472070/finding-an-item-by-iterating-through-a-go-list", "title": "Finding an item by iterating through a Go list", "body": "<p>I'm attempting to port some C to Go.</p>\n\n<p>I'm essentially looking for something in Go akin to Haskell's <code>find :: (a -&gt; Bool) -&gt; [a] -&gt; Maybe a</code></p>\n\n<p>I have (roughly) this C for finding an item in a \"list\" by iterating through it:</p>\n\n<pre><code>struct foo {\n    struct foo *next;\n    char *name;\n}\n\nstruct foo *foo_list;\n\n// Snip\n\nstruct foo *foo = NULL;\nfor (f = foo_list; f; f = f-&gt;next) {\n    if (!strcmp(\"bar\", f-&gt;name) {\n        foo = f;\n    }\n}\n\nif (foo)\n    // Stuff\n</code></pre>\n\n<p>How can I do this nicely and idiomatically in Go?</p>\n\n<p>The \"list\" is likely to be small; performance characteristics aren't particularly interesting.</p>\n\n<p>Am I likely to want a <code>slice</code>, or a <code>list</code>? A \"list\" of <code>Foo</code>s or <code>*Foo</code>s?</p>\n\n<p>I currently have the following, but I suspect it's not particularly \"idiomatic Go\"!</p>\n\n<pre><code>var FooTable *list.List\n\n// Snip\n\nvar foo *Foo = nil\n\nfor e := FooTable.Front(); e != nil; e = e.Next() {\n    if e.Value.(*Foo).name == \"bar\" {\n        foo = e.Value.(*Foo)\n        break\n    }\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 3087531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8b2ecc75e2c9483eee7dbfd423be72f?s=128&d=identicon&r=PG&f=1", "display_name": "bernays", "link": "https://stackoverflow.com/users/3087531/bernays"}, "edited": false, "score": 0, "creation_date": 1482416431, "post_id": 34469414, "comment_id": 69772196, "body": "1) There are few storage options as highly available, scalable and performant as S3 2) It&#39;s easy enough to switch backends all the signed url code does is tell the client where to grab the resource from. It doesn&#39;t matter if its in S3 or some other storage server 3) The AWS credentials aren&#39;t ever exposed to the client. The server grabs a signed URL which is only valid for a certain amount of time (default 15 minutes). If you use IAM roles for your server you never even have to put your credentials onto your server further reducing the risk of leaking credentials"}], "tags": [], "owner": {"reputation": 4764, "user_id": 1517410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d0f3c5b683ae64c738cf1af18796e1e?s=128&d=identicon&r=PG", "display_name": "ketan vijayvargiya", "link": "https://stackoverflow.com/users/1517410/ketan-vijayvargiya"}, "is_accepted": false, "score": 0, "last_activity_date": 1451115126, "creation_date": 1451115126, "answer_id": 34469414, "question_id": 34469309, "link": "https://stackoverflow.com/questions/34469309/serving-content-from-s3-securely/34469414#34469414", "title": "Serving content from S3 securely", "body": "<p>This is a good solution for following reasons:</p>\n\n<ul>\n<li><p>The fact that you are using S3 is transparent to the client. In other words, the client doesn't need to or should know that you are using S3 in backend, unless there is a good reason for this.</p></li>\n<li><p>Tomorrow if you want to move your data from S3 to some other data store, you only need to change your server code. The client doesn't need to update.</p></li>\n<li><p>AWS credentials aren't exposed to client, hence more security.</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1451118712, "post_id": 34469657, "comment_id": 56681052, "body": "But wouldn&#39;t this allow content to be downloaded by unauthenticated users if the url gets compromised, even if just for a small period of time?"}, {"owner": {"reputation": 18303, "user_id": 790224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/auulQ.jpg?s=128&g=1", "display_name": "datasage", "link": "https://stackoverflow.com/users/790224/datasage"}, "reply_to_user": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1451119224, "post_id": 34469657, "comment_id": 56681131, "body": "Yes, it&#39;s possible. If you stick to SSL you would significantly limit the risk. Short of man in the middle attacks anyway."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1451120399, "post_id": 34469657, "comment_id": 56681358, "body": "And what are the downsides of proxying the requests through my web service? Apart from the obvious of using more resources on the server."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 4, "creation_date": 1451120762, "post_id": 34469657, "comment_id": 56681444, "body": "Using more resources on the server (and network bandwidth) is probably the biggest downside by far. Reading files from S3 into memory, across multiple simultaneous clients, has a non-negligible impact on your server."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451135945, "post_id": 34469657, "comment_id": 56684623, "body": "@elithrar I agree with this, but the impact on the server will be the same as if I hosted everything locally, right?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1451136161, "post_id": 34469657, "comment_id": 56684684, "body": "Not quite. Locally your file-system cache might cache regularly accessed files; pulling from S3 requires a network request out (adds latency), processing, and then a copy to the ResponseWriter.  I suggest testing, but using S3&#39;s signed URLs is nearly always the way to go."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451172490, "post_id": 34469657, "comment_id": 56694198, "body": "@elithrar Thanks. Currently the official go library for AWS <code>github.com&#47;aws&#47;aws-sdk-go&#47;service&#47;s3</code> doesn&#39;t support signed URLs at this point but I can always use the web API or the goamz library by canonical."}], "tags": [], "owner": {"reputation": 18303, "user_id": 790224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/auulQ.jpg?s=128&g=1", "display_name": "datasage", "link": "https://stackoverflow.com/users/790224/datasage"}, "is_accepted": true, "score": 6, "last_activity_date": 1451117834, "creation_date": 1451117834, "answer_id": 34469657, "question_id": 34469309, "link": "https://stackoverflow.com/questions/34469309/serving-content-from-s3-securely/34469657#34469657", "title": "Serving content from S3 securely", "body": "<p>This method can work. But it relies on requests being proxied through your client. </p>\n\n<p>The recommend way is to use signed urls. This creates a url that is valid for a time period that you specify that allows the end user to download a file directly from S3.</p>\n\n<p>Your key is not exposed as the url contains just a signature. </p>\n"}], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 34469657, "answer_count": 2, "score": 1, "last_activity_date": 1451172548, "creation_date": 1451113939, "last_edit_date": 1451172548, "question_id": 34469309, "link": "https://stackoverflow.com/questions/34469309/serving-content-from-s3-securely", "title": "Serving content from S3 securely", "body": "<p>I'm writing a web application in go and I'm using amazon s3 to store all the user files, this include the profile pics and text and audio files.</p>\n\n<p>However I'm struggling to understand what will be the correct way to do this securely. What I was thinking is after making sure the request comes from an authenticated user with access to the requested file, just use the aws go library to fetch the file and write it to the http request.</p>\n\n<p>Something like this:</p>\n\n<pre><code>import (\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/s3\"\n    \"io\"\n)\n\nfunc serveFile(file string, w http.ResponseWriter) {\n    svc := s3.New(session.New(), aws.NewConfig().WithRegion(config.AWS.Region))\n\n    params := &amp;s3.GetObjectInput{\n    Bucket: aws.String(\"Bucket name\"),\n    Key:    aws.String(file),\n    }\n\n    resp, err := svc.GetObject(params)\n    n, err := io.Copy(w, resp.Body)\n\n}\n</code></pre>\n\n<p>I don't have much experience working with AWS so I'm not sure this is even a good approach, but it works. Is this a good way to do it, for a production server? Is there a better, more reliable way?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1451234076, "post_id": 34469500, "comment_id": 56706680, "body": "Actually, your <code>g</code> is a deadlock, you&#39;re locking in side the loop and outside."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1451261806, "post_id": 34469500, "comment_id": 56714530, "body": "@OneOfOne I don&#39;t think so: inside the loop the mutex is unlocked first and locked second."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": false, "score": 1, "last_activity_date": 1451120588, "last_edit_date": 1451120588, "creation_date": 1451116156, "answer_id": 34469500, "question_id": 34469080, "link": "https://stackoverflow.com/questions/34469080/how-can-i-get-rid-of-this-data-race/34469500#34469500", "title": "How can I get rid of this data race", "body": "<p>You've got a lot of code in your question, but it looks like you're trying to delete elements from a map (<code>party.Members</code>) in one goroutine, while looping over it in another. This sounds like an unmaintainable, error-ridden disaster in the making, but it's possible to do without memory races.</p>\n\n<p>You need a mutex to protect access (both read and write) to the map, and the hard part is to make sure the lock is held during the <code>for/range</code> iteration. Here's one way to do it, by having the lock held before the <code>for</code> loop starts, and unlocking it inside the body of the loop.</p>\n\n<pre><code>var mut sync.Mutex\nvar m = map[string]int{}\n\nfunc f(key string) {\n    mut.Lock()\n    defer mut.Unlock()\n    delete(m, key)\n}\n\nfunc g() {\n    mut.Lock()\n    defer mut.Unlock()\n    for k, v := range m {\n        mut.Unlock()\n        fmt.Println(k, v)\n        mut.Lock()\n    }\n}\n</code></pre>\n\n<p>Here, any combination of <code>f</code>s and <code>g</code>s can be called concurrently without memory races.</p>\n\n<p>Drastically simpler to understand would be to not Unlock/Lock the mutex inside the loop, which would mean a deletion in <code>f</code> would wait for any running loop in <code>g</code> to complete (or vice-versa).</p>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1451120588, "creation_date": 1451111307, "question_id": 34469080, "link": "https://stackoverflow.com/questions/34469080/how-can-i-get-rid-of-this-data-race", "title": "How can I get rid of this data race", "body": "<p>I have these 2 functions:</p>\n\n<pre><code>// PartyHub struct contains all data for the party\ntype PartyHub struct {\n    FullPartys    map[string]Party\n    PartialPartys map[string]Party\n    Enter         chan Member\n    Leave         chan Member\n    sync.Mutex\n}\n\n\n// RemoveFromQueue will remove the member from party\nfunc (p *PartyHub) RemoveFromQueue(memberLeaving Member, inQueue bool) {\n    if !inQueue {\n        return\n    }\n    for _, party := range p.PartialPartys {\n        go func(party Party) {\n            if _, ok := party.Members[memberLeaving.Identifier]; ok {\n                p.Lock()\n-&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;       delete(party.Members, memberLeaving.Identifier)\n                p.Unlock()\n            }\n        }(party)\n    }\n    log.Println(\"Removing\")\n}\n\n// SortIntoParty will sort the member into party\nfunc (p *PartyHub) SortIntoParty(newMember Member, inQueue bool) {\n    log.Println(inQueue)\n    if inQueue {\n        return\n    }\n    log.Println(\"Adding\")\n    foundParty := false\n-&gt;&gt; for partyid, party := range p.PartialPartys {\n        if !party.Accepting {\n            continue\n        }\n\n        goodFitForParty := true\n        for _, partyMember := range party.Members {\n            if newMember.Type == partyMember.Type &amp;&amp; newMember.Rank &gt;= partyMember.Rank-partyMember.RankTol &amp;&amp; newMember.Rank &lt;= partyMember.Rank+partyMember.RankTol {\n                goodFitForParty = true\n                continue\n            } else {\n                goodFitForParty = false\n                break\n            }\n        }\n\n        if !goodFitForParty {\n            continue\n        } else {\n            foundParty = true\n            newMember.Conn.CurrentParty = partyid\n            p.Lock()\n            p.PartialPartys[partyid].Members[newMember.Conn.Identifier] = newMember\n            p.Unlock()\n            if len(party.Members) == 2 {\n                p.Lock()\n                party.Accepting = false\n                p.Unlock()\n                // Start Go Routine\n            }\n            break\n        }\n    }\n    if !foundParty {\n        uuid := feeds.NewUUID().String()\n        newMember.Conn.CurrentParty = uuid\n        p.Lock()\n        p.PartialPartys[uuid] = Party{Accepting: true, Members: make(map[string]Member), Ready: make(chan *Connection), Decline: make(chan *Connection)}\n        p.PartialPartys[uuid].Members[newMember.Conn.Identifier] = newMember\n        p.Unlock()\n    }\n}\n</code></pre>\n\n<p>I put <code>-&gt;&gt;&gt;&gt;&gt;&gt;</code> next to where the 2 pieces of code are being accessed, I'm not sure how I can keep these 2 up to date without being in a data race, fairly new to go and wondering how I should be reading and writing this variable without a data-race.</p>\n"}, {"tags": ["go", "http2"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 8, "last_activity_date": 1451101033, "creation_date": 1451101033, "answer_id": 34468277, "question_id": 34468231, "link": "https://stackoverflow.com/questions/34468231/how-do-i-make-a-http2-only-request-over-http-in-go/34468277#34468277", "title": "How do I make a HTTP2-only request over http:// in Go?", "body": "<p>You need to use <code>https</code>, not <code>http</code>. The http2 transport doesn't recognize the <code>http</code> scheme.</p>\n"}, {"tags": [], "owner": {"reputation": 709, "user_id": 3494590, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4f84aa8fd828d0d8d5306bd577f2d94f?s=128&d=identicon&r=PG&f=1", "display_name": "Dhumil Agarwal", "link": "https://stackoverflow.com/users/3494590/dhumil-agarwal"}, "is_accepted": false, "score": 0, "last_activity_date": 1456901186, "creation_date": 1456901186, "answer_id": 35740291, "question_id": 34468231, "link": "https://stackoverflow.com/questions/34468231/how-do-i-make-a-http2-only-request-over-http-in-go/35740291#35740291", "title": "How do I make a HTTP2-only request over http:// in Go?", "body": "<p>The HTTP/2.0 by default works on highly secured connections. It uses high quality ciphers. So it can only run on HTTPS connections. Moreover, to make HTTPS connections, you also need to have your SSL enabled and have the required certificates installed. </p>\n"}], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1895, "favorite_count": 1, "accepted_answer_id": 34468277, "answer_count": 2, "score": 3, "last_activity_date": 1456901186, "creation_date": 1451100201, "question_id": 34468231, "link": "https://stackoverflow.com/questions/34468231/how-do-i-make-a-http2-only-request-over-http-in-go", "title": "How do I make a HTTP2-only request over http:// in Go?", "body": "<p>I'm using Go 1.6 and want to make a HTTP2-only request over <code>http://</code>.</p>\n\n<p>Attempting to do this currently results in:</p>\n\n<blockquote>\n  <p>Head <a href=\"http://localhost:2076/completed/764c1b6bc55548707507a2dd25570483a7216bf4\" rel=\"nofollow\">http://localhost:2076/completed/764c1b6bc55548707507a2dd25570483a7216bf4</a>: http2: unsupported scheme</p>\n</blockquote>\n\n<p>To force http2, I believe I need <code>http.Client.Transport.TLSConfig.NextProtos</code> set to <code>[]string{\"h2\"}</code>.</p>\n\n<p>What else is required?</p>\n"}, {"tags": ["html", "go", "directory"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451094782, "post_id": 34467647, "comment_id": 56677701, "body": "You are calling <code>template.Must</code> - which panics on an error - and the app is generating an error because it cannot find <code>about.html</code>. If you&#39;re calling <code>go run</code> then your application is likely run from temporary directory. You should either call <code>go build</code> or instead provide an absolute path to your template files (better). Try to avoid using <code>go run</code> outside of a small, single-file programs."}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451095167, "post_id": 34467647, "comment_id": 56677760, "body": "@elithrar - I am building the app using go build ./... and go install ./... under test-proj folder. And running the project by ./test-proj. Should I change this approach?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451096744, "post_id": 34467647, "comment_id": 56677979, "body": "Your question says you are using <code>go run server.go</code>? Is that not the case?"}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451096869, "post_id": 34467647, "comment_id": 56677994, "body": "I used just to make sure it is working. It works when I use go run server.go. But I am getting error when I use the top level binary ./test-proj"}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451097179, "post_id": 34467647, "comment_id": 56678026, "body": "You were right. I used the absolute path of the html files. It worked. But I am not sure why it failed in the previously. Thanks elithrar. I will add that answer."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451097479, "post_id": 34467647, "comment_id": 56678071, "body": "It failed because (as per my first comment) <code>go run</code> builds and runs the program in a temporary directory. That temporary directory doesn&#39;t contain your template files, but your program was referring to <code>about.html</code> as if it did contain them. It is nearly always better to use absolute paths or provide an option to do so via a flag or environmental variable."}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451111321, "post_id": 34467647, "comment_id": 56679932, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/99002/discussion-between-dinesh-appavoo-and-elithrar\">continue this discussion in chat</a>."}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451111534, "post_id": 34467647, "comment_id": 56679964, "body": "css is not loading :(.  Could someone help me with that? [The same folder structure as you can see in the question]"}], "owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 670, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1516092670, "creation_date": 1451091071, "last_edit_date": 1451111686, "question_id": 34467647, "link": "https://stackoverflow.com/questions/34467647/how-to-maintain-folder-structure-for-html-and-other-resources-for-golang-webapp", "title": "How to maintain folder structure for html and other resources for golang webapp?", "body": "<p>In my web application, I am maintaining the following folder structure for the web resources,</p>\n\n<pre><code>/Users/Dinesh/go/src/github.com/dineshappavoo/test-proj/\n                                                      main.go\n                                                      README.md\n                                                      app/\n                                                          about.html\n                                                          home.html\n                                                          server.go\n                                                          resources/\n                                                                   css/\n                                                                   js/\n                                                                   fonts/\n                                                      mypack/\n                                                            abc/\n</code></pre>\n\n<p>In server.go under app folder I am starting the web server and rendering the html etc. In main.go [under top level folder] I am trying to call the server.go function. I am doing this because I can maintain the go dependencies and easily build the project.</p>\n\n<p>Here is my main.go content,</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/dineshappavoo/test-proj/app\"\n)\n\nfunc main() {\n    app.Main()\n}\n</code></pre>\n\n<p>and server.go code snippet is here,</p>\n\n<pre><code>package app\n\nimport (\n    \"html/template\"\n    \"io/ioutil\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n    \"regexp\"\n    \"strconv\"\n    ....\n    ....\n)\n\n\n//Home page handler\nfunc homeHandler(\n    w http.ResponseWriter,\n    r *http.Request,\n) {\n    renderTemplate(w, \"home\", nil)\n}\n\n//About page handler\nfunc aboutHandler(\n    w http.ResponseWriter,\n    r *http.Request,\n) {\n\n    renderTemplate(w, \"about\", nil)\n}\n\nvar templates = template.Must(template.ParseFiles(\"about.html\", \"home.html\"))\n\nfunc renderTemplate(\n    w http.ResponseWriter,\n    tmpl string,\n    p interface{},\n) {\n    //If you use variables other than the struct u r passing as p, then \"multiple response.WriteHeader calls\" error may occur. Make sure you pass\n    //all variables in the struct even they are in the header.html embedded\n    if err := templates.ExecuteTemplate(w, tmpl+\".html\", p); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n    }\n}\n\n//URL validation for basic web services\nvar validPath = regexp.MustCompile(\"^/$|/(home|about)/(|[a-zA-Z0-9]+)$\")\n\nfunc validate(\n    fn func(\n        http.ResponseWriter,\n        *http.Request,\n    )) http.HandlerFunc {\n    return func(\n        w http.ResponseWriter,\n        r *http.Request,\n    ) {\n        //log.Printf(\"Request URL Path %s \", r.URL.Path)\n        m := validPath.FindStringSubmatch(r.URL.Path)\n        if m == nil {\n            http.NotFound(w, r)\n            return\n        }\n        fn(w, r)\n    }\n}\n\n//Main method to install\nfunc Main() {\n    log.Printf(\"TEST APP SERVER STARTED\")\n\n    http.HandleFunc(\"/\", validate(homeHandler))\n    http.HandleFunc(\"/home/\", validate(homeHandler))\n    http.HandleFunc(\"/about/\", validate(aboutHandler))\n\n    http.Handle(\"/resources/\", http.StripPrefix(\"/resources/\", http.FileServer(http.Dir(\"resources\"))))\n    //http.Handle(\"/templ/\", http.StripPrefix(\"/templ/\", http.FileServer(http.Dir(\"templ\"))))\n    if *addr {\n        l, err := net.Listen(\"tcp\", \"127.0.0.1:0\")\n        if err != nil {\n            log.Fatal(err)\n        }\n        err = ioutil.WriteFile(\"final-port.txt\", []byte(l.Addr().String()), 0644)\n        if err != nil {\n            log.Fatal(err)\n        }\n        s := &amp;http.Server{}\n        s.Serve(l)\n        return\n    }\n\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>When I start the server.go directly it works [by making Main() in server.go as main() and go run server.go]. But when I use the above structure it fails.</p>\n\n<p><strong>Error:</strong></p>\n\n<pre><code>panic: open about.html: no such file or directory\n\ngoroutine 1 [running]:\nhtml/template.Must(0x0, 0x81a568, 0x11980f20, 0x0)\n    /usr/local/go/src/html/template/template.go:304 +0x40\ngithub.com/dineshappavoo/test-proj/app.init()\n    /Users/Dinesh/go/src/github.com/dineshappavoo/test-proj/app/server.go:625 +0x1ec\nmain.init()\n    /Users/Dinesh/go/src/github.com/dineshappavoo/test-proj/main.go:9 +0x39\n</code></pre>\n\n<p><strong>EDIT-I</strong>\nI gave the absolute path for html templates. It worked. But css is not loading. I changed the following line.</p>\n\n<pre><code>http.Handle(\"/resources/\", http.StripPrefix(\"/resources/\", http.FileServer(http.Dir(\"/app/\"))))\n</code></pre>\n\n<p>I am new to go language. Could anyone help me on this?</p>\n"}, {"tags": ["recursion", "go", "generator", "yield"], "comments": [{"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 1, "creation_date": 1451073090, "post_id": 34464146, "comment_id": 56673817, "body": "I&#39;m not sure how idiomatic channels &amp; goroutines really are for this purpose; I find that especially people who are new to Go are often a bit <i>too</i> enamoured with them and use them where they&#39;re not all that useful. For generators I typically use simple, hassle-free closures."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 2, "creation_date": 1451082726, "post_id": 34464146, "comment_id": 56675941, "body": "@Aedolon note that simple closures don&#39;t work the same way generators do. Generators only do Work and produce one more value each time they&#39;re called, keeping state in the meantime. I don&#39;t know of any way to get a closure (without using channels and a goroutine) to block until called again."}, {"owner": {"reputation": 15587, "user_id": 263998, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/f39c51ab7728df9d23cdd3e0c72495e0?s=128&d=identicon&r=PG", "display_name": "cdunn2001", "link": "https://stackoverflow.com/users/263998/cdunn2001"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1488828838, "post_id": 34464146, "comment_id": 72395784, "body": "I agree with @AdamSmith. Also, an important use-case for a generator is asynchronous processing with blocking I/O. For that, a closure is not enough; you need a goroutine. So I like your pattern a lot. And when the caller is willing to run to completion, your pattern is even better, since the caller can simply iterate over the channel."}, {"owner": {"reputation": 2410, "user_id": 1574637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b30da618a502d63ba0ae4736799ad0ef?s=128&d=identicon&r=PG", "display_name": "Corey Scott", "link": "https://stackoverflow.com/users/1574637/corey-scott"}, "edited": false, "score": 0, "creation_date": 1562484813, "post_id": 34464146, "comment_id": 100382931, "body": "Please consider that channels do not need to be closed to be cleaned up and not leak.  As such, you could generate all the values and store them in a buffered channel.  When there were no more references, then it would be cleaned up.  (note: you could also close the channel after inserting all the values, this would allow for the use of range on the reader&#39;s side)"}, {"owner": {"reputation": 6845, "user_id": 142239, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/aff0365957ec55e4e4cb904f20ce2a14?s=128&d=identicon&r=PG", "display_name": "Siu Ching Pong -Asuka Kenji-", "link": "https://stackoverflow.com/users/142239/siu-ching-pong-asuka-kenji"}, "reply_to_user": {"reputation": 2410, "user_id": 1574637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b30da618a502d63ba0ae4736799ad0ef?s=128&d=identicon&r=PG", "display_name": "Corey Scott", "link": "https://stackoverflow.com/users/1574637/corey-scott"}, "edited": false, "score": 0, "creation_date": 1562492350, "post_id": 34464146, "comment_id": 100384445, "body": "@CoreyScott Goroutines do leak, though."}, {"owner": {"reputation": 2410, "user_id": 1574637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b30da618a502d63ba0ae4736799ad0ef?s=128&d=identicon&r=PG", "display_name": "Corey Scott", "link": "https://stackoverflow.com/users/1574637/corey-scott"}, "edited": false, "score": 0, "creation_date": 1562639459, "post_id": 34464146, "comment_id": 100429004, "body": "@SiuChingPong-AsukaKenji- absolutely and we definitely should be spending a good amount of time to avoid that.  My comments were only about channels and not needing to close them"}], "answers": [{"comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1451114345, "post_id": 34466755, "comment_id": 56680367, "body": "In the channel-based solution, I think items 4, 5, 6... can be processed even after <code>abort</code> is closed, although this requires very unlucky timing."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1451118733, "post_id": 34466755, "comment_id": 56681055, "body": "@PaulHankin You&#39;re right, thanks. Fixed it by adding a <code>break</code> in the consumer after the <code>close()</code> (it wasn&#39;t noticeable with current goroutine scheduling because unbuffered channel was used in <code>generate()</code>).  Using <code>break</code> ensures no further elements will be processed, and the <code>close(abort)</code> will ensure the other goroutine can terminate as well."}, {"owner": {"reputation": 6845, "user_id": 142239, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/aff0365957ec55e4e4cb904f20ce2a14?s=128&d=identicon&r=PG", "display_name": "Siu Ching Pong -Asuka Kenji-", "link": "https://stackoverflow.com/users/142239/siu-ching-pong-asuka-kenji"}, "edited": false, "score": 0, "creation_date": 1451348055, "post_id": 34466755, "comment_id": 56747243, "body": "My question is different from <a href=\"http://stackoverflow.com/q/11385556/142239\">stackoverflow.com/q/11385556/142239</a>. The key-point is the recursive function, which is not handled in your answer. I will make another post later to address the problems."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 28, "last_activity_date": 1507364498, "last_edit_date": 1507364498, "creation_date": 1451080443, "answer_id": 34466755, "question_id": 34464146, "link": "https://stackoverflow.com/questions/34464146/the-idiomatic-way-to-implement-generators-yield-in-golang-for-recursive-functi/34466755#34466755", "title": "The idiomatic way to implement generators (yield) in Golang for recursive functions", "body": "<h2>I. Alternatives</h2>\n\n<p><strong>Foreword:</strong> I will use a much simpler generator, because the problem does not concern the generator complexity but rather the signals between the generator and consumer, and the call of the consumer itself. This simple generator just generates the integer numbers from <code>0</code> to <code>9</code>.</p>\n\n<h3>1. With a function value</h3>\n\n<p>A generate-consumer pattern is much cleaner with a simple <em>consumer</em> function passed, which also has the advantage that it can return a value signalling if abortion or any other action is required.</p>\n\n<p>And since in the example only one event is to be signaled (\"abort\"), the consumer function will have <code>bool</code> return type, signalling if abort is required.</p>\n\n<p>So see this simple example with a consumer function value passed to the generator:</p>\n\n<pre><code>func generate(process func(x int) bool) {\n    for i := 0; i &lt; 10; i++ {\n        if process(i) {\n            break\n        }\n    }\n}\n\nfunc main() {\n    process := func(x int) bool {\n        fmt.Println(\"Processing\", x)\n        return x == 3 // Terminate if x == 3\n    }\n    generate(process)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/AiSKwLOTaj\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Processing 0\nProcessing 1\nProcessing 2\nProcessing 3\n</code></pre>\n\n<p>Note that the consumer (<code>process</code>) does not need to be a \"local\" function, it can be declared outside of <code>main()</code>, e.g. it can be a global function or a function from another package.</p>\n\n<p>The potential downside of this solution is that it uses only 1 goroutine both for generating and consuming values. </p>\n\n<h3>2. With channels</h3>\n\n<p>If you still want to do it with channels, you can. Note that since the channel is created by the generator, and since the consumer loops over the values received from the channel (ideally with a <code>for ... range</code> construct), it is the generator's responsibility to close the channel. Settling with this also allows you to return a receive-only channel.</p>\n\n<p>And yes, closing the returned channel in the generator is best done as a deferred statement, so even if the generator panics, the consumer will not get blocked. But note that this deferred close is not in the <code>generate()</code> function but in the anonymous function started from <code>generate()</code> and executed as a new goroutine; else the channel would be closed before it is returned from <code>generate()</code> - not useful at all...</p>\n\n<p>And if you want to signal the generator from the consumer (e.g. to abort and not generate further values), you can use e.g. another channel, which is passed to the generator. Since the generator will only \"listen\" to this channel, it can also be declared as a receive-only channel to the generator. If you only need to signal one event (abort in our case), no need to send any values on this channel, a simple close will do it. If you need to signal multiple events, it can be done by actually sending a value on this channel, the event / action to be carried out (where abort may be one from multiple events).</p>\n\n<p>And you can use the <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"noreferrer\"><code>select</code> statement</a> as the idiomatic way to handle sending values on the returned channel and watching the channel passed to the generator.</p>\n\n<p>Here is a solution with an <code>abort</code> channel:</p>\n\n<pre><code>func generate(abort &lt;-chan struct{}) &lt;-chan int {\n    ch := make(chan int)\n    go func() {\n        defer close(ch)\n        for i := 0; i &lt; 10; i++ {\n            select {\n            case ch &lt;- i:\n                fmt.Println(\"Sent\", i)\n            case &lt;-abort: // receive on closed channel can proceed immediately\n                fmt.Println(\"Aborting\")\n                return\n            }\n        }\n    }()\n    return ch\n}\n\nfunc main() {\n    abort := make(chan struct{})\n    ch := generate(abort)\n    for v := range ch {\n        fmt.Println(\"Processing\", v)\n        if v == 3 { // Terminate if v == 3\n            close(abort)\n            break\n        }\n    }\n    // Sleep to prevent termination so we see if other goroutine panics\n    time.Sleep(time.Second)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/eUIXKFVLKk\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Sent 0\nProcessing 0\nProcessing 1\nSent 1\nSent 2\nProcessing 2\nProcessing 3\nSent 3\nAborting\n</code></pre>\n\n<p>The obvious advantage of this solution is that it already uses 2 goroutines (1 that generates values, 1 that consumes/processes them), and it is very easy to extend it to process the generated values with any number of goroutines as the channel returned by the generator can be used from multiple goroutines concurrently - channels are safe to be receiving from concurrently, data races cannot occur, by design; for more read: <a href=\"https://stackoverflow.com/questions/34039229/if-i-am-using-channels-properly-should-i-need-to-use-mutexes\">If I am using channels properly should I need to use mutexes?</a></p>\n\n<h2>II. Answers to unaddressed questions</h2>\n\n<p>An \"uncaught\" panic on a goroutine will end the execution of the goroutine but will not cause a problem in regards to resource leak. But if the function executed as a separate goroutine would free resources (in non-deferred statements) allocated by it in case of non-panic, that code will obviously not run and will cause resource leak for example.</p>\n\n<p>You haven't observed this because the program terminates when the main goroutine terminates (and it does not wait for other non-main goroutines to finish - so your other goroutines did not get a chance to panic). See <a href=\"https://golang.org/ref/spec#Program_execution\" rel=\"noreferrer\">Spec: Program execution</a>.</p>\n\n<p>But know that <code>panic()</code> and <code>recover()</code> are for exceptional cases, they are not intended for such general use cases like the Exceptions and <code>try-catch</code> blocks in Java. Panics should be avoided, by returning errors (and handling them!) for example, and panics should definitely not leave the \"borders\" of packages (e.g. <code>panic()</code> and <code>recover()</code> may be justified to be used in a package implementation, but panicking state should be \"caught\" inside the package and not let out of it).</p>\n"}, {"comments": [{"owner": {"reputation": 6845, "user_id": 142239, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/aff0365957ec55e4e4cb904f20ce2a14?s=128&d=identicon&r=PG", "display_name": "Siu Ching Pong -Asuka Kenji-", "link": "https://stackoverflow.com/users/142239/siu-ching-pong-asuka-kenji"}, "edited": false, "score": 0, "creation_date": 1451348375, "post_id": 34485237, "comment_id": 56747337, "body": "My question is different from <a href=\"http://stackoverflow.com/q/11385556/142239\">stackoverflow.com/q/11385556/142239</a>. The key-point is the recursive function, which is not handled in your answer. I will make another post later to address the problems. In your answer, you assume that the function <code>permutation</code> can return one <code>int</code> at a time given an <code>int</code>. To demonstrate your assumption, here are several runs: <code>permutation(1)</code> returns, say, <code>20</code>, then you feed <code>20</code> to the next call; <code>permutation(20)</code> returns, say, <code>15</code>, then you feed <code>15</code> to the next call. Unfortunately, this is not how &quot;recursive function&quot; works."}, {"owner": {"reputation": 6845, "user_id": 142239, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/aff0365957ec55e4e4cb904f20ce2a14?s=128&d=identicon&r=PG", "display_name": "Siu Ching Pong -Asuka Kenji-", "link": "https://stackoverflow.com/users/142239/siu-ching-pong-asuka-kenji"}, "edited": false, "score": 0, "creation_date": 1451348757, "post_id": 34485237, "comment_id": 56747432, "body": "A recursive function has a base case and a recursive case. In the recursive case, it calls itself with parameters different from those supplied to it. In most cases, the parameters are &quot;smaller&quot; to the previous ones in order to &quot;reduce&quot; the problem. In the base case, the solution / answer is known and could not / need not be reduced further, the known solution is applied / the known answer is returned."}, {"owner": {"reputation": 6845, "user_id": 142239, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/aff0365957ec55e4e4cb904f20ce2a14?s=128&d=identicon&r=PG", "display_name": "Siu Ching Pong -Asuka Kenji-", "link": "https://stackoverflow.com/users/142239/siu-ching-pong-asuka-kenji"}, "edited": false, "score": 1, "creation_date": 1451349015, "post_id": 34485237, "comment_id": 56747490, "body": "The problem of without using a channel is that, once the answer is returned in the base case, the calling stack is destroyed, and the information is lost if they are not backed-up (in the closure, for example). Backing them up does not make sense, since it is essentially the same effort as making the algorithm iterative (non-recursive). If I still didn&#39;t make it clear, please try to write a function that generates <code>abcd</code>, <code>abdc</code>, <code>acbd</code>, <code>acdb</code>, ..., <code>dcba</code> when it is called as <code>permutation([]string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;})</code>. Thanks!"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 6, "last_activity_date": 1470639874, "last_edit_date": 1470639874, "creation_date": 1451253373, "answer_id": 34485237, "question_id": 34464146, "link": "https://stackoverflow.com/questions/34464146/the-idiomatic-way-to-implement-generators-yield-in-golang-for-recursive-functi/34485237#34485237", "title": "The idiomatic way to implement generators (yield) in Golang for recursive functions", "body": "<p>To my mind usually generators are just wrappers around closure internally. Something like this</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\n// This function `generator` returns another function, which\n// we define anonymously in the body of `generator`. The\n// returned function _closes over_ the variable `data` to\n// form a closure.\nfunc generator(data int, permutation func(int) int, bound int) func() (int, bool) {\n    return func() (int, bool) {\n        data = permutation(data)\n        return data, data &lt; bound\n    }\n}\n\n// permutation function\nfunc increment(j int) int {\n    j += 1\n    return j\n}\n\nfunc main() {\n    // We call `generator`, assigning the result (a function)\n    // to `next`. This function value captures its\n    // own `data` value, which will be updated each time\n    // we call `next`.\n    next := generator(1, increment, 7)\n    // See the effect of the closure by calling `next`\n    // a few times.\n    fmt.Println(next())\n    fmt.Println(next())\n    fmt.Println(next())\n    // To confirm that the state is unique to that\n    // particular function, create and test a new one.\n    for next, generation, ok := generator(11, increment, 17), 0, true; ok; {\n        generation, ok = next()\n        fmt.Println(generation)\n    }\n}\n</code></pre>\n\n<p>It looks not as elegant as 'for range' but quite clear semantically and syntactically for me. And it works <a href=\"http://play.golang.org/p/fz8xs0RYz9\" rel=\"noreferrer\">http://play.golang.org/p/fz8xs0RYz9</a></p>\n"}, {"tags": [], "owner": {"reputation": 2176, "user_id": 82816, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e42f6c21cb1b7d45ec30570df35cbee9?s=128&d=identicon&r=PG", "display_name": "gonzojive", "link": "https://stackoverflow.com/users/82816/gonzojive"}, "is_accepted": false, "score": 3, "last_activity_date": 1508614561, "creation_date": 1508614561, "answer_id": 46867268, "question_id": 34464146, "link": "https://stackoverflow.com/questions/34464146/the-idiomatic-way-to-implement-generators-yield-in-golang-for-recursive-functi/46867268#46867268", "title": "The idiomatic way to implement generators (yield) in Golang for recursive functions", "body": "<p>I agree with icza's answer. To summarize, there are are two alternatives:</p>\n\n<ol>\n<li><strong>mapping function</strong>: Use a callback to iterate over a collection. <code>func myIterationFn(</code><strong><code>yield</code></strong><code>func (myType)) (stopIterating bool)</code>. This has the disadvantage of ceding the control flow to <code>myGenerator</code> function. <code>myIterationFn</code> is not a Pythonic generator because it doesn't return an iterable sequence.</li>\n<li><strong>channels</strong>: Use a channel and be wary of leaking goroutines. It's possible to transform <code>myIterationFn</code> into a function that returns an iterable sequence. The following code provides an example of such a transformation.</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>myMapper := func(yield func(int) bool) {\n    for i := 0; i &lt; 5; i++ {\n        if done := yield(i); done {\n            return\n        }\n    }\n}\niter, cancel := mapperToIterator(myMapper)\ndefer cancel() // This line is very important - it prevents goroutine leaks.\nfor value, ok := iter(); ok; value, ok = iter() {\n    fmt.Printf(\"value: %d\\n\", value)\n}\n</code></pre>\n\n<p>Here's a complete program as an example. <code>mapperToIterator</code> does the transformation from a <strong>mapping function</strong> to a <strong>generator</strong>. Go's lack of generics requires casting from <code>interface{}</code> to <code>int</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\n// yieldFn reports true if an iteration should continue. It is called on values\n// of a collection.\ntype yieldFn func(interface{}) (stopIterating bool)\n\n// mapperFn calls yieldFn for each member of a collection.\ntype mapperFn func(yieldFn)\n\n// iteratorFn returns the next item in an iteration or the zero value. The\n// second return value is true when iteration is complete.\ntype iteratorFn func() (value interface{}, done bool)\n\n// cancelFn should be called to clean up the goroutine that would otherwise leak.\ntype cancelFn func()\n\n// mapperToIterator returns an iteratorFn version of a mappingFn. The second\n// return value must be called at the end of iteration, or the underlying\n// goroutine will leak.\nfunc mapperToIterator(m mapperFn) (iteratorFn, cancelFn) {\n    generatedValues := make(chan interface{}, 1)\n    stopCh := make(chan interface{}, 1)\n    go func() {\n        m(func(obj interface{}) bool {\n            select {\n            case &lt;-stopCh:\n                return false\n            case generatedValues &lt;- obj:\n                return true\n            }\n        })\n        close(generatedValues)\n    }()\n    iter := func() (value interface{}, notDone bool) {\n        value, notDone = &lt;-generatedValues\n        return\n    }\n    return iter, func() {\n        stopCh &lt;- nil\n    }\n}\n\nfunc main() {\n    myMapper := func(yield yieldFn) {\n        for i := 0; i &lt; 5; i++ {\n            if keepGoing := yield(i); !keepGoing {\n                return\n            }\n        }\n    }\n    iter, cancel := mapperToIterator(myMapper)\n    defer cancel()\n    for value, notDone := iter(); notDone; value, notDone = iter() {\n        fmt.Printf(\"value: %d\\n\", value.(int))\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 6845, "user_id": 142239, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/aff0365957ec55e4e4cb904f20ce2a14?s=128&d=identicon&r=PG", "display_name": "Siu Ching Pong -Asuka Kenji-", "link": "https://stackoverflow.com/users/142239/siu-ching-pong-asuka-kenji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 22318, "favorite_count": 13, "answer_count": 3, "score": 26, "last_activity_date": 1508614561, "creation_date": 1451057882, "last_edit_date": 1495540958, "question_id": 34464146, "link": "https://stackoverflow.com/questions/34464146/the-idiomatic-way-to-implement-generators-yield-in-golang-for-recursive-functi", "title": "The idiomatic way to implement generators (yield) in Golang for recursive functions", "body": "<p>[ Note: I read <a href=\"https://stackoverflow.com/q/11385556/142239\">Python-style generators in Go</a>, this is not a duplicate of it. ]</p>\n\n<p>In Python / Ruby / JavaScript / ECMAScript 6, generator functions could be written using the <code>yield</code> keyword provided by the language. In Go, it could be simulated using a goroutine and a channel.</p>\n\n<h1>The Code</h1>\n\n<p>The following code shows how a permutation function (abcd, abdc, acbd, acdb, ..., dcba) could be implemented:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// $src/lib/lib.go\n\npackage lib\n\n// private, starts with lowercase \"p\"\nfunc permutateWithChannel(channel chan&lt;- []string, strings, prefix []string) {\n    length := len(strings)\n    if length == 0 {\n        // Base case\n        channel &lt;- prefix\n        return\n    }\n    // Recursive case\n    newStrings := make([]string, 0, length-1)\n    for i, s := range strings {\n        // Remove strings[i] and assign the result to newStringI\n        // Append strings[i] to newPrefixI\n        // Call the recursive case\n        newStringsI := append(newStrings, strings[:i]...)\n        newStringsI = append(newStringsI, strings[i+1:]...)\n        newPrefixI := append(prefix, s)\n        permutateWithChannel(channel, newStringsI, newPrefixI)\n    }\n}\n\n// public, starts with uppercase \"P\"\nfunc PermutateWithChannel(strings []string) chan []string {\n    channel := make(chan []string)\n    prefix := make([]string, 0, len(strings))\n    go func() {\n        permutateWithChannel(channel, strings, prefix)\n        close(channel)\n    }()\n    return channel\n}\n</code></pre>\n\n<p>Here is how it could be used:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// $src/main.go\n\npackage main\n\nimport (\n    \"./lib\"\n    \"fmt\"\n)\n\nvar (\n    fruits  = []string{\"apple\", \"banana\", \"cherry\", \"durian\"}\n    banned = \"durian\"\n)\n\nfunc main() {\n    channel := lib.PermutateWithChannel(fruits)\n    for myFruits := range channel {\n        fmt.Println(myFruits)\n        if myFruits[0] == banned {\n            close(channel)\n            //break\n        }\n    }\n}\n</code></pre>\n\n<p>Note:</p>\n\n<p>The <code>break</code> statement (commented above) is not needed, as <code>close(channel)</code> causes <code>range</code> to return <code>false</code> in the next iteration, the loop will terminate.</p>\n\n<h1>The Problem</h1>\n\n<p>If the caller doesn't need all the permutations, it needs to <code>close()</code> the channel explicitly, or the channel will not be closed until the program terminates (resource leakage occurs). On the other hand, if the caller needs all the permutations (i.e. the <code>range</code> loops until the end), the caller MUST NOT <code>close()</code> the channel. It is because <code>close()</code>-ing an already closed channel causes a runtime panic (see <a href=\"https://golang.org/ref/spec#Close\" rel=\"noreferrer\">here in the spec</a>). However, if the logic to determine whether it should stop or not is not as simple as shown above, I think it is better to use <code>defer close(channel)</code>.</p>\n\n<h1>The Questions</h1>\n\n<ol>\n<li>What is the idiomatic way to implement generators like this?</li>\n<li>Idiomatically, who should be responsible to <code>close()</code> the channel - the library function or the caller?</li>\n<li>Is it a good idea to modify my code like below, so that the caller is responsible to <code>defer close()</code> the channel no matter what?</li>\n</ol>\n\n<p>In the library, modify this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    go func() {\n        permutateWithChannel(channel, strings, prefix)\n        close(channel)\n    }()\n</code></pre>\n\n<p>to this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    go permutateWithChannel(channel, strings, prefix)\n</code></pre>\n\n<p>In the caller, modify this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    channel := lib.PermutateWithChannel(fruits)\n    for myFruits := range channel {\n        fmt.Println(myFruits)\n        if myFruits[0] == banned {\n            close(channel)\n        }\n    }\n}\n</code></pre>\n\n<p>to this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    channel := lib.PermutateWithChannel(fruits)\n    defer close(channel)    // &lt;- Added\n    for myFruits := range channel {\n        fmt.Println(myFruits)\n        if myFruits[0] == banned {\n            break           // &lt;- Changed\n        }\n    }\n}\n</code></pre>\n\n<ol start=\"4\">\n<li>Despite it is not observable by executing the code above, and the correctness of the algorithm is not affected, after the caller <code>close()</code>s the channel, the goroutine running the library code should <code>panic</code> when it tries to send to the closed channel in the next iteration, as documented <a href=\"https://golang.org/ref/spec#Send_statements\" rel=\"noreferrer\">here in the spec</a>, causing it to terminate. Does this cause any negative side-effect?</li>\n<li>The signature of the library function is <code>func(strings []string) chan []string</code>. Ideally, the return type should be <code>&lt;-chan []string</code> to restrict it to be receive-only. However, if it is the caller who is responsible to <code>close()</code> the channel, it could not be marked as \"receive-only\", as the <code>close()</code> built-in function does not work on receive-only channels. What is the idiomatic way to deal with this?</li>\n</ol>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 3223, "user_id": 702912, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/b9e25ee94fc81a18d3207befd8aa7837?s=128&d=identicon&r=PG", "display_name": "Charles Holbrow", "link": "https://stackoverflow.com/users/702912/charles-holbrow"}, "edited": false, "score": 0, "creation_date": 1492029157, "post_id": 34463793, "comment_id": 73820388, "body": "Is your program exiting while there are active goroutines still processing data? That could make it appear that the messages you sent got lost."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 2, "last_activity_date": 1582022966, "last_edit_date": 1582022966, "creation_date": 1451057836, "answer_id": 34464139, "question_id": 34463793, "link": "https://stackoverflow.com/questions/34463793/can-a-message-sent-to-channel-be-lost/34464139#34464139", "title": "can a message sent to channel be lost?", "body": "<p>No, they can't be lost.</p>\n\n<p>While the language spec does not in any way impose any particular implementation on channels, you can think of them as <a href=\"https://en.wikipedia.org/wiki/Semaphore_(programming)\" rel=\"nofollow noreferrer\">semaphores</a> protecting either a single value (for the single message) or an array/list of them (for buffered channels).</p>\n\n<p>The semantics are then enforced in such a way that as soon as a goroutine wants to send a message to a channel, it tries to acquire a free data slot using that semaphore, and then either succeds at sending&mdash;there's a free slot for its message&mdash;or blocks&mdash;when there isn't.  As soon as such a slot appears&mdash;someone has received an existing message&mdash;the sending succeeds and the sending goroutine gets unblocked.</p>\n\n<p>This is a simplified explanation but I hope it gets you the correct idea. In other words, channels in Go is not like message queues which usually are happy with losing messages.</p>\n\n<p>On a side note, I'm not really sure what happens if the receiver panics in some specific state when it's about to receive your message. IOW I'm not sure whether Go guarantees that the message is either sent or not in the presence of a receiver panicking in an unfortunate moment.</p>\n\n<p>Oh, and there's that grey area of the main goroutine exiting (that one running the <code>main.main()</code> function): the spec states clear than the main goroutine does not wait for any other goroutines to complete when it exits. So unless you somehow arrange for the synchronized controlled shutdown of all your spawned goroutines, I beleive they may lose messages.  On the other hand, in this case the world is collapsing anyway&hellip;</p>\n"}, {"tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": false, "score": 2, "last_activity_date": 1451066386, "creation_date": 1451066386, "answer_id": 34465135, "question_id": 34463793, "link": "https://stackoverflow.com/questions/34463793/can-a-message-sent-to-channel-be-lost/34465135#34465135", "title": "can a message sent to channel be lost?", "body": "<p>If something has been successfully sent into the channel then no, it can't be lost in correctly working environment (I mean if you're tampering with your memory or you have bit flips due to cosmic rays then don't expect anything of course).</p>\n\n<p>Message is successfully sent when <code>ch &lt;- x</code> returns. Otherwise, if it panics, it's not really being sent and if you don't recover than you could claim it's lost (however, it would be lost due to application logic). Panic can happen if channel is closed or, say, you're out of memory.</p>\n\n<p>Similarly if sender is putting into the channel in non-blocking mode (by using select), you should have a sufficient buffer in your channel, because messages can be \"lost\" (although somehow intentionally). For example <a href=\"https://golang.org/pkg/os/signal/#Notify\" rel=\"nofollow\"><code>signal.Notify</code></a> is working this way:</p>\n\n<blockquote>\n  <p>Package signal will not block sending to c: the caller must ensure that c has sufficient buffer space to keep up with the expected signal rate.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1451217266, "creation_date": 1451217266, "answer_id": 34480141, "question_id": 34463793, "link": "https://stackoverflow.com/questions/34463793/can-a-message-sent-to-channel-be-lost/34480141#34480141", "title": "can a message sent to channel be lost?", "body": "<p>Message can not be lost. It can be not sent.Order of goroutines execution not defined. So your endless for loop can receive from only one worker all time, and even can sleep if it isn't in main thread. To be sure your queue works in regular fashion you better explicitly in 'main' receive messages for each worker.</p>\n"}], "owner": {"reputation": 67, "user_id": 5653566, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a57b23e789f4344a7ca37d2a6fc48a34?s=128&d=identicon&r=PG&f=1", "display_name": "Strickland Joseph", "link": "https://stackoverflow.com/users/5653566/strickland-joseph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1122, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1582022966, "creation_date": 1451054825, "question_id": 34463793, "link": "https://stackoverflow.com/questions/34463793/can-a-message-sent-to-channel-be-lost", "title": "can a message sent to channel be lost?", "body": "<p>The question is in the title. Let's say I have several goroutines (more than 100) all of which eventually send data to one chan (name it <code>mychan := make(chan int)</code>) One another goroutine does <code>&lt;- mychan</code> in an endless for loop Is it okay or the chan can happen to lose some data? Should I use buffered chan instead? Or perhaps I am to create a chan and a \"demon\" goroutine that will extract message for each worker goroutine?</p>\n"}, {"tags": ["email", "go", "imap"], "comments": [{"owner": {"reputation": 63, "user_id": 5714506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/588464a7494bf810e0cfe7cc3f8b20e2?s=128&d=identicon&r=PG&f=1", "display_name": "Zippelin", "link": "https://stackoverflow.com/users/5714506/zippelin"}, "edited": false, "score": 0, "creation_date": 1451053135, "post_id": 34463290, "comment_id": 56668947, "body": "ok , so ive made a telnet connect to mail server and looks like info about c.Mailbox.Unseen show only the 1st unseen msg in folder. So now i understand why it work as it work. But  i need to look on all unread msgs, any clue how to do it?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1451053847, "post_id": 34463290, "comment_id": 56669123, "body": "First, the Go standard library does not have anything to work with IMAP (except for <code>net&#47;textproto</code> which is not IMAP-specific), so start with telling us which package are you using. Second, quick googling for <code>imap+get+all+unread+messages</code> turns up a <a href=\"http://stackoverflow.com/a/22857102/720999\">&quot;use search, not status&quot; suggestion</a> among gazillions of other links. How about exploring that idea?"}, {"owner": {"reputation": 63, "user_id": 5714506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/588464a7494bf810e0cfe7cc3f8b20e2?s=128&d=identicon&r=PG&f=1", "display_name": "Zippelin", "link": "https://stackoverflow.com/users/5714506/zippelin"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1451055109, "post_id": 34463290, "comment_id": 56669436, "body": "iam using <code>&quot;github.com&#47;mxk&#47;go-imap&#47;imap&quot;</code> and looks like i found what i need with <code>imap.LabelFilter(&quot;UNSEEN&quot;)</code> em i right that it show amount of unread mails?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1451056169, "post_id": 34463290, "comment_id": 56669689, "body": "No idea, but fro what I read while reseaching on your question the answer appears to be &quot;yes&quot;. Do try yourself, really."}], "owner": {"reputation": 63, "user_id": 5714506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/588464a7494bf810e0cfe7cc3f8b20e2?s=128&d=identicon&r=PG&f=1", "display_name": "Zippelin", "link": "https://stackoverflow.com/users/5714506/zippelin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 636, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1451053586, "creation_date": 1451050247, "last_edit_date": 1451053586, "question_id": 34463290, "link": "https://stackoverflow.com/questions/34463290/get-unseen-messages-via-imap", "title": "Get unseen messages via IMAP", "body": "<p>I need to extract some data from new (unseen) messages; I'm trying to make range of that data:</p>\n\n<pre><code>c, _ = imap.Dial(\"someserverr\")\n\n\ndefer c.Logout(30 * time.Second)\n\n\nfmt.Println(\"Server says hello:\", c.Data[0].Info)\nc.Data = nil\n\nif c.State() == imap.Login {\n    c.Login(\"somedata\", \"somedata\")\n}\n\nc.Select(\"INBOX\", false)\n\nset, _ := imap.NewSeqSet(\"\")\nfmt.Println(\"unseen\", c.Mailbox.Unseen)\nfmt.Println(c.Mailbox)\nif c.Mailbox.Unseen &gt;= 1 {\n    set.AddRange(1, c.Mailbox.Unseen)\n} else {\n    set.Add(\"0:0\")\n}\n</code></pre>\n\n<p>The main problem here is command <code>c.Mailbox</code> showing wrong number of unseen messages.</p>\n\n<p>For example, if I have 5 unread messages in INBOX it shows 1. If I mark that one as read, it will show 4, and so on.</p>\n"}, {"tags": ["networking", "go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 0, "last_activity_date": 1451081066, "creation_date": 1451081066, "answer_id": 34466820, "question_id": 34462704, "link": "https://stackoverflow.com/questions/34462704/trying-to-implement-a-port-scanner-in-go/34466820#34466820", "title": "Trying to implement a port scanner in go", "body": "<p>Here is a slightly reworked version that is more idiomatic go.</p>\n\n<p>There are shorter ways to write it, but this is probably more clear.</p>\n\n<p>Logic is basically the same.  I just ran it and it worked fine, printed out several ips it connected to.   This version also prints why it fails, which is more for troubleshooting.  </p>\n\n<p>Do you still have issues running this version?  If so, what error are you getting?</p>\n\n<p>My version, <a href=\"http://play.golang.org/p/mkq7DhtmUl\" rel=\"nofollow\">on Play</a>.  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"regexp\"\n    \"strconv\"\n    \"sync\"\n    \"time\"\n)\n\n// next two functions are shamelessly copied from somewhere\n\nfunc ip2long(ipstr string) (uint32, error) {\n    r := `^(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})`\n    reg, err := regexp.Compile(r)\n    if err != nil {\n        return 0, err\n    }\n    ips := reg.FindStringSubmatch(ipstr)\n    if ips == nil {\n        return 0, fmt.Errorf(\"Invalid ip address\")\n    }\n    var ip1, ip2, ip3, ip4 int\n    if ip1, err = strconv.Atoi(ips[1]); err != nil {\n        return 0, err\n    }\n    if ip2, err = strconv.Atoi(ips[2]); err != nil {\n        return 0, err\n    }\n    if ip3, err = strconv.Atoi(ips[3]); err != nil {\n        return 0, err\n    }\n    if ip4, err = strconv.Atoi(ips[4]); err != nil {\n        return 0, err\n    }\n    if ip1 &gt; 255 || ip2 &gt; 255 || ip3 &gt; 255 || ip4 &gt; 255 {\n        return 0, fmt.Errorf(\"Invalid ip address\")\n    }\n    ip := uint32(ip1 * 0x1000000)\n    ip += uint32(ip2 * 0x10000)\n    ip += uint32(ip3 * 0x100)\n    ip += uint32(ip4)\n    return ip, nil\n}\nfunc long2ip(ip uint32) string {\n    return fmt.Sprintf(\"%d.%d.%d.%d\", ip&gt;&gt;24, ip&lt;&lt;8&gt;&gt;24, ip&lt;&lt;16&gt;&gt;24, ip&lt;&lt;24&gt;&gt;24)\n}\n\n// the actual code\nfunc main() {\n    timeOut := 10 * time.Second // time out to pass to the DialTimeout\n    fmt.Println(\"Timeout is:\", timeOut)\n    req := func(ip string) { // parallelized function to do requests\n        c, err := net.DialTimeout(\"tcp\", ip+\":80\", timeOut) // connect to ip with given timeout\n        if err == nil {                                     // if we're connected\n            fmt.Println(ip) // output the successful ip\n            c.Close()       // close connection\n        } else {\n            fmt.Println(\"Error is:\", err)\n        }\n    }\n\n    startIp, err := ip2long(\"50.97.99.0\") // starting ip\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    endIp, err := ip2long(\"50.97.102.0\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    var wg sync.WaitGroup    // synchronizer for main routine to wait for spawned workers\n    ips := make(chan uint32) // channel to feed ip addrs\n\n    //spawn 100 workers\n    for idx := 0; idx &lt; 100; idx++ {\n        wg.Add(1)\n        go func() {\n            for ip := range ips {\n                req(long2ip(ip)) // perform check of ip\n            }\n            wg.Done()\n        }()\n    }\n\n    // send ip addrs to workers to process\n    for curIp := startIp; curIp &lt;= endIp; curIp++ {\n        ips &lt;- curIp\n    }\n    close(ips) // signal goroutines to end\n    wg.Wait()  //wait for all goroutines to complete\n}\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 5653566, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a57b23e789f4344a7ca37d2a6fc48a34?s=128&d=identicon&r=PG&f=1", "display_name": "Strickland Joseph", "link": "https://stackoverflow.com/users/5653566/strickland-joseph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 450, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1451081066, "creation_date": 1451045327, "question_id": 34462704, "link": "https://stackoverflow.com/questions/34462704/trying-to-implement-a-port-scanner-in-go", "title": "Trying to implement a port scanner in go", "body": "<p>I recently started to learn go. The only reson for that is the goroutine thing which seem to exist only in this language (I have java background and, to be honest, won't ever completely switch to go).\nI wanted to implement a simple port scanner which is to find every http server (host with opened port 80) in the given network range. Here's how I am doing this:</p>\n\n<pre><code>package main\n\nimport (\n    \"net\"\n    \"fmt\"\n    \"regexp\"\n    \"strconv\"\n    \"time\"\n)\n\n// next two functions are shamelessly copied from somewhere \n\nfunc ip2long(ipstr string) (ip uint32) {\n    r := `^(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})`\n    reg, err := regexp.Compile(r)\n    if err != nil {\n        return\n    }\n    ips := reg.FindStringSubmatch(ipstr)\n    if ips == nil {\n        return\n    }\n    ip1, _ := strconv.Atoi(ips[1])\n    ip2, _ := strconv.Atoi(ips[2])\n    ip3, _ := strconv.Atoi(ips[3])\n    ip4, _ := strconv.Atoi(ips[4])\n    if ip1 &gt; 255 || ip2 &gt; 255 || ip3 &gt; 255 || ip4 &gt; 255 {\n        return\n}\n    ip += uint32(ip1 * 0x1000000)\n    ip += uint32(ip2 * 0x10000)\n    ip += uint32(ip3 * 0x100)\n    ip += uint32(ip4)\n    return\n}\nfunc long2ip(ip uint32) string {\n    return fmt.Sprintf(\"%d.%d.%d.%d\", ip&gt;&gt;24, ip&lt;&lt;8&gt;&gt;24, ip&lt;&lt;16&gt;&gt;24, ip&lt;&lt;24&gt;&gt;24)\n}\n\n// the actual code\nfunc main() {\n    seconds := 10 // timeout\n    fmt.Println(seconds) // just to see it\n    timeOut := time.Duration(seconds) * time.Second // time out to pass to the DialTimeout \n    can := make(chan int) // a chan\n    req := func (ip string){ // parallelized function to do requests \n    c, err := net.DialTimeout(\"tcp\", ip+\":80\",timeOut) // connect to ip with given timeout\n    if err == nil { // if we're connected\n        fmt.Println(ip) // output the successful ip\n        c.Close() // close connection\n    }\n    can &lt;- 0 // tell that we're done\n\n}\n\n    startIp := ip2long(\"50.97.99.0\") // starting ip\n    endIp := ip2long(\"50.97.102.0\")\n    curIp := startIp // current ip\n\n    go func(){ // a demon function ran as goroutine which listens to the chan\n        count := 0 // how many ips we processed\n        looper: // label to break\n        for{\n            &lt;- can // wait for some goroutine to finish\n            curIp++ // next ip\n            count++\n            go req(long2ip(curIp)) // start new goroutine\n            if (curIp &gt; endIp) { // if we've walked through the range\n                fmt.Println(\"final\")\n                break looper;\n            }\n        }\n    }()\n    numGoes := 100 // number of goroutines ran at one time\n    for i := 0; i &lt; numGoes; i++{\n        can &lt;- 0 // start 100 goroutines\n    }\n    // standard way to make the program hung\n    var input string\n    fmt.Scanln(&amp;input)\n}\n</code></pre>\n\n<p>I hope the code is well-commented so you can see what I'm trying to do.\nThe ip range is the range of some hosting company and I know for sure that the IP 50.97.99.189 runs http server, but the problem is that this IP never shows up in console, when I run my given code, although the host is up and ping time is around 156 ms so 10 secs is more than enough.\nSo the question - what am I doing wrong?</p>\n"}, {"tags": ["testing", "go", "mocking"], "answers": [{"comments": [{"owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "edited": false, "score": 0, "creation_date": 1451053996, "post_id": 34463474, "comment_id": 56669169, "body": "wow, I did not know that Pike wrote a book. Could you please state the title or a reference to the book. I like your advice. I am about to refactor my code like that and report back. Thank you so much!"}, {"owner": {"reputation": 314, "user_id": 5716193, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v9QW0.jpg?s=128&g=1", "display_name": "Amnon", "link": "https://stackoverflow.com/users/5716193/amnon"}, "reply_to_user": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "edited": false, "score": 1, "creation_date": 1451055648, "post_id": 34463474, "comment_id": 56669578, "body": "The Go Programming Language  <a href=\"http://www.gopl.io/\" rel=\"nofollow noreferrer\">gopl.io</a> Alan A. A. Donovan &#183; Brian W. Kernighan Published Oct 26, 2015 in paperback and Nov 20 in e-book Addison-Wesley; 380pp; ISBN: 978-0134190440"}, {"owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "edited": false, "score": 0, "creation_date": 1451055675, "post_id": 34463474, "comment_id": 56669582, "body": "I refactored the code following your advice. I hope that you do not mind that I added what I came up to your answer to make it explicit. If I misunderstood something please change it. By the way there seems to be a problem with the os.Exit."}, {"owner": {"reputation": 314, "user_id": 5716193, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v9QW0.jpg?s=128&g=1", "display_name": "Amnon", "link": "https://stackoverflow.com/users/5716193/amnon"}, "reply_to_user": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "edited": false, "score": 1, "creation_date": 1451056215, "post_id": 34463474, "comment_id": 56669699, "body": "Looks good. And as you say, there is a problem with os.Exit. It is hard to unit-test a function which calls exit, as this will abort the Unit Test. Better to return some sort of error code."}, {"owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "edited": false, "score": 0, "creation_date": 1451064660, "post_id": 34463474, "comment_id": 56671760, "body": "got it. I updated your answer to reflect that. Thanks for your help!"}, {"owner": {"reputation": 314, "user_id": 5716193, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v9QW0.jpg?s=128&g=1", "display_name": "Amnon", "link": "https://stackoverflow.com/users/5716193/amnon"}, "reply_to_user": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "edited": false, "score": 1, "creation_date": 1451197877, "post_id": 34463474, "comment_id": 56697880, "body": "That works. But best to avoid calling Exit, and instead have useful return an error (which would be nil in the usual case). See <a href=\"https://golang.org/doc/effective_go.html#errors\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#errors</a>"}, {"owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "edited": false, "score": 0, "creation_date": 1451206885, "post_id": 34463474, "comment_id": 56699655, "body": "you are absolutely right! I hoped I would get away with using exit() calls and I almost did. It bit me in the end and now I am going to read up Chapter 5.4 on error handling strategies. So far I like the book you recommend. Again thank you for the tip."}], "tags": [], "owner": {"reputation": 314, "user_id": 5716193, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v9QW0.jpg?s=128&g=1", "display_name": "Amnon", "link": "https://stackoverflow.com/users/5716193/amnon"}, "is_accepted": true, "score": 10, "last_activity_date": 1451070538, "last_edit_date": 1451070538, "creation_date": 1451051812, "answer_id": 34463474, "question_id": 34462355, "link": "https://stackoverflow.com/questions/34462355/how-to-deal-with-the-fmt-golang-library-package-for-cli-testing/34463474#34463474", "title": "how to deal with the &quot;fmt&quot; golang library package for CLI testing", "body": "<p>Chapter 11 of Kerningham's Book gives a good solution to this question.\nThe trick is to change the calls to fmt.Printline() to calls to \n fmt.Fprint(out, ...) where out is initialised to os.Stdout</p>\n\n<p>This can be overwritten in the test harness to new(bytes.Buffer) allowing the \ntest to capture the output.</p>\n\n<p>See <a href=\"https://github.com/adonovan/gopl.io/blob/master/ch11/echo/echo.go\" rel=\"noreferrer\">https://github.com/adonovan/gopl.io/blob/master/ch11/echo/echo.go</a> and\n<a href=\"https://github.com/adonovan/gopl.io/blob/master/ch11/echo/echo_test.go\" rel=\"noreferrer\">https://github.com/adonovan/gopl.io/blob/master/ch11/echo/echo_test.go</a></p>\n\n<p>edited by OP...\nsample.go:</p>\n\n<pre><code>package main\n\n\nimport(\n    \"fmt\"\n    \"os\"\n    \"io\"\n)\n\n\nvar out io.Writer = os.Stdout // modified during testing\nvar exit func(code int) = os.Exit\n\ntype sample struct {\n    value int64\n}\n\n\nfunc (s sample) useful() {\n    if s.value == 0 {\n        fmt.Fprint(out, \"Error: something is wrong!\\n\")\n        exit(1)\n    } else {\n        fmt.Fprint(out, \"May the force be with you!\\n\")\n    }\n}\n\n\nfunc main() {\n    s := sample{42}\n    s.useful()\n\n    s.value = 0\n    s.useful()\n}\n\n// output:\n// May the force be with you!\n// Error: this is broken and not useful!\n// exit status 1\n</code></pre>\n\n<p>cli_test.go:</p>\n\n<pre><code>package main\n\nimport(\n    \"bytes\"\n    \"testing\"\n)\n\n\nfunc TestUsefulPositive(t *testing.T) {\n    bak := out\n    out = new(bytes.Buffer)\n    defer func() { out = bak }()\n\n    s := sample{42}\n    s.useful()\n    if out.(*bytes.Buffer).String() != \"May the force be with you!\\n\" {\n        t.Fatal(\"There is something wrong with the CLI\")\n    }\n\n}\n\n\nfunc TestUsefulNegative(t *testing.T) {\n    bak := out\n    out = new(bytes.Buffer)\n    defer func() { out = bak }()\n    code := 0\n    osexit := exit\n    exit = func(c int) { code = c }\n    defer func() { exit = osexit }()\n\n    s := sample{0}\n    s.useful()\n    if out.(*bytes.Buffer).String() != \"Error: something is wrong!\\n\" {\n        t.Fatal(\"There is something wrong with the CLI\")\n    }\n    if code != 1 {\n        t.Fatal(\"Wrong exit code!\")\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 2, "last_activity_date": 1451078434, "creation_date": 1451078434, "answer_id": 34466521, "question_id": 34462355, "link": "https://stackoverflow.com/questions/34462355/how-to-deal-with-the-fmt-golang-library-package-for-cli-testing/34466521#34466521", "title": "how to deal with the &quot;fmt&quot; golang library package for CLI testing", "body": "<p>Am I missing something here or are you talking of <a href=\"https://blog.golang.org/examples\" rel=\"nofollow\">testable examples</a>?</p>\n\n<p>Basically, it works like this: In a <code>*_test.go</code> file, you need to adhere to the convention <code>Example[[T][_M]]</code> where <code>T</code> is a placeholder for the type and <code>M</code> a placeholder for the method you want to display the testable example as example code in the Godoc. If the function is just called <code>Example()</code>, the code will be shown as a package example.</p>\n\n<p>Below the last line of the code of your example, you can put a comment like this</p>\n\n<pre><code>// Output:\n// Foo\n</code></pre>\n\n<p>Now <code>go test</code> will make sure that the testable example function either <strong><em>exactly</em></strong> puts out everything below <code>// Output:</code> (including whitespace) or it will make the test fail.</p>\n\n<p>Here is an actual example for an testable example</p>\n\n<pre><code>func ExampleMongoStore_Get() {\n\n  sessionId := \"ExampleGetSession\"\n\n  data, err := ms.Get(sessionId)\n\n  if err == sessionmw.ErrSessionNotFound {\n\n    fmt.Printf(\"Session '%s' not found\\n\", sessionId)\n\n    data = make(map[string]interface{})\n    data[\"foo\"] = \"bar\"\n\n    ms.Save(sessionId, data)\n  }\n\n  loaded, _ := ms.Get(sessionId)\n  fmt.Printf(\"Loaded value '%s' for key '%s' in session '%s'\",\n    loaded[\"foo\"],\n    \"foo\", sessionId)\n  // Output:\n  // Session 'ExampleGetSession' not found\n  // Loaded value 'bar' for key 'foo' in session 'ExampleGetSession'\n}\n</code></pre>\n\n<p>Edit: Have a look at <a href=\"https://godoc.org/github.com/mwmahlberg/mongostore#example-MongoStore-Get\" rel=\"nofollow\">the output of above example at godoc.org</a></p>\n"}], "owner": {"reputation": 1753, "user_id": 570293, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/DuOBG.png?s=128&g=1", "display_name": "moin moin", "link": "https://stackoverflow.com/users/570293/moin-moin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1113, "favorite_count": 2, "accepted_answer_id": 34463474, "answer_count": 2, "score": 7, "last_activity_date": 1451078434, "creation_date": 1451041982, "question_id": 34462355, "link": "https://stackoverflow.com/questions/34462355/how-to-deal-with-the-fmt-golang-library-package-for-cli-testing", "title": "how to deal with the &quot;fmt&quot; golang library package for CLI testing", "body": "<p>Disclaimer: I wish you a merry XMas and I hope my question does not disturb you!</p>\n\n<p>sample.go:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"os\"\n)\n\n\ntype sample struct {\n    value int64\n}\n\nfunc (s sample) useful() {\n    if s.value == 0 {\n        fmt.Println(\"Error: something is wrong!\")\n        os.Exit(1)\n    } else {\n        fmt.Println(\"May the force be with you!\")\n    }\n}\n\nfunc main() {\n    s := sample{42}\n    s.useful()\n\n    s.value = 0\n    s.useful()\n}\n\n// output:\n// May the force be with you!\n// Error: something is wrong!\n// exit status 1\n</code></pre>\n\n<p>I did a lot of research on how to use interfaces in golang testing. But so far I was not able to wrap my head around this completely. At least I can not see how interfaces help me when I need to \"mock\" (apologies for using this word) golang std. library packages like \"fmt\".</p>\n\n<p>I came up with <strong>two scenarios:</strong></p>\n\n<ol>\n<li><strong>use os/exec</strong> to test the command line interface</li>\n<li><strong>wrap fmt</strong> package so I have control and am able to check the output strings</li>\n</ol>\n\n<p>I do not like both scenarios:</p>\n\n<ol>\n<li>I experience going through the actual command line a convoluted and not-performant (see below). Might have portability issues, too.</li>\n<li>I believe this is the way to go but I fear that wrapping the fmt package might be a lot of work (at least wrapping the time package for testing turned out a non-trivial task (<a href=\"https://github.com/finklabs/ttime\" rel=\"noreferrer\">https://github.com/finklabs/ttime</a>)).</li>\n</ol>\n\n<p><strong>Actual Question here: Is there another (better/simpler/idiomatic) way?</strong>\nNote: I want to do this in pure golang, I am not interested in the next testing framework.</p>\n\n<p>cli_test.go:</p>\n\n<pre><code>package main\n\nimport(\n    \"os/exec\"\n    \"testing\"\n)\n\n\nfunc TestCli(t *testing.T) {\n    out, err := exec.Command(\"go run sample.go\").Output()\n    if err != nil {\n        t.Fatal(err)\n    }\n    if string(out) != \"May the force be with you!\\nError: this is broken and not useful!\\nexit status 1\" {\n        t.Fatal(\"There is something wrong with the CLI\")\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "edited": false, "score": 0, "creation_date": 1451135912, "post_id": 34462118, "comment_id": 56684614, "body": "Hi.. I don&#39;t understand the problem. Can you add some more info?"}], "answers": [{"tags": [], "owner": {"reputation": 1739, "user_id": 91449, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/279929b6e31ee2eda28479f7829e6bb0?s=128&d=identicon&r=PG", "display_name": "Guildencrantz", "link": "https://stackoverflow.com/users/91449/guildencrantz"}, "is_accepted": false, "score": 0, "last_activity_date": 1451183798, "creation_date": 1451183798, "answer_id": 34477118, "question_id": 34462118, "link": "https://stackoverflow.com/questions/34462118/embedding-model-structs-with-same-attribute-names-in-golang/34477118#34477118", "title": "Embedding model structs with same attribute names in golang", "body": "<p>The problem is that you're embedding both <code>CreatedBy</code> and <code>UpdatedBy</code> into <code>Event</code>, so calls to <code>Event.By</code> are ambiguous and not allowed (you'd have to be able to specify <code>Event.CreatedBy.By</code> and <code>Event.UpdatedBy.By</code> explicitly to disambiguate the two fields).</p>\n\n<p>The solution, most likely, would be to <em>not embed</em> the types, but actually create a struct with explicit fields:</p>\n\n<pre><code>type Event struct {\n    CreatedBy CreatedBy\n    UpdatedBy UpdatedBy\n}\n</code></pre>\n\n<p><code>gorm</code> should now know how to disambiguate the two columns.</p>\n\n<p>Of course if you're only going to embed <code>By</code> into <code>CreatedBy</code> and <code>UpdatedBy</code> for the purposes of column mapping then you shouldn't need to declare new <code>struct</code>s:</p>\n\n<pre><code>type By struct {\n    ByID sql.NullInt64\n    By *User\n}\n\ntype Event struct {\n    CreatedBy By\n    UpdatedBy By\n}\n</code></pre>\n"}], "owner": {"reputation": 10776, "user_id": 749477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6845c6b2318e02258cc1dc56fe620482?s=128&d=identicon&r=PG", "display_name": "Derek", "link": "https://stackoverflow.com/users/749477/derek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 529, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451183798, "creation_date": 1451040075, "question_id": 34462118, "link": "https://stackoverflow.com/questions/34462118/embedding-model-structs-with-same-attribute-names-in-golang", "title": "Embedding model structs with same attribute names in golang", "body": "<p>Using <code>go 1.5</code>, and <code>gorm</code>.</p>\n\n<p>Say I want to make an <code>events</code> table that has a <code>created_by_id</code> and an <code>updated_by_id</code> columns.</p>\n\n<p>I write my models like</p>\n\n<pre><code>type By struct {\n    ByID sql.NullInt64\n    By *User\n}\n\ntype CreatedBy struct {\n    By\n}\n\ntype UpdatedBy struct {\n    By\n}\n\ntype Event struct {\n    CreatedBy\n    UpdatedBy\n}\n</code></pre>\n\n<p>When I try to save an <code>event</code> object, the value for the column <code>by_id</code> will try to be saved rather than the values for <code>created_by_id</code> and <code>updated_by_id</code>.  What do I need to do to make sure the column names of <code>ByID</code> attribute are different for <code>CreatedBy</code> and <code>UpdatedBy</code>? </p>\n"}, {"tags": ["video", "go", "oauth", "youtube", "authorization"], "owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 194, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1451034232, "creation_date": 1451034232, "question_id": 34461498, "link": "https://stackoverflow.com/questions/34461498/how-to-upload-video-to-youtube-without-authorizing-every-time", "title": "How to upload video to youtube without authorizing every time?", "body": "<p>In my use case, I would like to upload video to my youtube channel in Golang. I am referring to this <a href=\"https://github.com/youtube/api-samples/blob/master/go/upload_video.go\" rel=\"nofollow\">api</a> sample. When I upload the video, youtube asks for authorization[authorization window opens and asks for manual approval]. Most of the time code sample uses cache. But I am afraid that oauth authorization may affect video upload through application. Could anyone give some suggestion how can I handle this?</p>\n"}, {"tags": ["go", "tcp"], "comments": [{"owner": {"reputation": 49960, "user_id": 32453, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/bec38d63650c8912b6ba9b557fb953b9?s=128&d=identicon&r=PG", "display_name": "rogerdpack", "link": "https://stackoverflow.com/users/32453/rogerdpack"}, "edited": false, "score": 0, "creation_date": 1451027290, "post_id": 34460761, "comment_id": 56663543, "body": "<a href=\"https://golang.org/pkg/syscall/#GetsockoptInt\" rel=\"nofollow noreferrer\">golang.org/pkg/syscall/#GetsockoptInt</a> may be useful"}, {"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "reply_to_user": {"reputation": 49960, "user_id": 32453, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/bec38d63650c8912b6ba9b557fb953b9?s=128&d=identicon&r=PG", "display_name": "rogerdpack", "link": "https://stackoverflow.com/users/32453/rogerdpack"}, "edited": false, "score": 0, "creation_date": 1451027745, "post_id": 34460761, "comment_id": 56663633, "body": "@rogerdpack thank you, Is there any example for how to use this function?"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1451034068, "post_id": 34460761, "comment_id": 56664845, "body": "<code>TCPConn.File()</code>,<code>File.Fd()</code> and <code>syscall.GetsockoptInt</code>"}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 1, "creation_date": 1451034675, "post_id": 34460761, "comment_id": 56664970, "body": "Note that calling File() on a TCP connection will also switch it to blocking mode, such that reading from or writing to the socket will monopolise an OS thread from that point on.  Keep that in mind if your program will be dealing with a lot of concurrent connections."}, {"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 0, "creation_date": 1451044895, "post_id": 34460761, "comment_id": 56666964, "body": "How to call this func? <code>syscall.GetsockoptInt(fd, syscall.IPPROTO_TCP, syscall.IP_RECVRETOPTS)</code> report err: <code>protocol not available</code>"}, {"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "reply_to_user": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1451045010, "post_id": 34460761, "comment_id": 56666994, "body": "@JamesHenstridge Is there any way to avoid this problem?"}], "owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 583, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1451026994, "creation_date": 1451026994, "question_id": 34460761, "link": "https://stackoverflow.com/questions/34460761/how-to-read-the-tcp-option-with-golang-on-tcp-layer", "title": "How to read the tcp option with golang on tcp layer?", "body": "<p>I try to get tcp option from tcp connection on server with golang. Is there any way to do this?</p>\n"}, {"tags": ["go", "bit-manipulation"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1451009908, "post_id": 34459450, "comment_id": 56661139, "body": "In what context? <code>&amp;^</code> isn&#39;t an operator on its own, but it might be something like <code>7 BITWISE-AND BITWISE-NEGATION(1)</code>"}, {"owner": {"reputation": 321, "user_id": 5390350, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c8b06cc918ec6d69bdced77e9408e218?s=128&d=identicon&r=PG&f=1", "display_name": "mosmo", "link": "https://stackoverflow.com/users/5390350/mosmo"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1451010007, "post_id": 34459450, "comment_id": 56661153, "body": "I saw it in there code <a href=\"https://github.com/golang/go/blob/b39329bff56abf35edc91537252782814a7a4f84/src/unicode/utf8/utf8.go#L213\" rel=\"nofollow noreferrer\">here</a>, they use it for a utf8 decode thing"}], "answers": [{"comments": [{"owner": {"reputation": 2851, "user_id": 243089, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c504339686fb2092eba997ee8899131?s=128&d=identicon&r=PG", "display_name": "Victor Zamanian", "link": "https://stackoverflow.com/users/243089/victor-zamanian"}, "edited": false, "score": 0, "creation_date": 1493918291, "post_id": 34459527, "comment_id": 74618749, "body": "This was a very clear explanation, especially with the use case."}, {"owner": {"reputation": 432, "user_id": 6340231, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mHxBsfkZqiQ/AAAAAAAAAAI/AAAAAAAAAtU/ToLwyfBT1HM/photo.jpg?sz=128", "display_name": "Abhay Kumar", "link": "https://stackoverflow.com/users/6340231/abhay-kumar"}, "edited": false, "score": 0, "creation_date": 1541082132, "post_id": 34459527, "comment_id": 93101737, "body": "Very well explained. Thanks. Specially its comparison with | (OR) operator."}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": true, "score": 41, "last_activity_date": 1451010300, "creation_date": 1451010300, "answer_id": 34459527, "question_id": 34459450, "link": "https://stackoverflow.com/questions/34459450/what-is-the-operator-in-golang/34459527#34459527", "title": "What is the &quot;&amp;^&quot; operator in golang?", "body": "<p>The C equivalent of the Go expression <code>x &amp;^ y</code> is just <code>x &amp; ~y</code>.  That is literally \"<code>x</code> AND (bitwise NOT of <code>y</code>)\".</p>\n\n<p>In the <a href=\"https://golang.org/ref/spec#Arithmetic_operators\">arithmetic operators section of the spec</a> describes <code>&amp;^</code> as a \"bit clear\" operation, which gives an idea of what you'd want to use it for.  As two separate operations, <code>~y</code> will convert each one bit to a zero, which will then clear the corresponding bit in <code>x</code>.  Each zero bit will be converted to a one, which will preserve the corresponding bit in <code>x</code>.</p>\n\n<p>So if you think of <code>x | y</code> as a way to turn on certain bits of <code>x</code> based on a mask constant <code>y</code>, then <code>x &amp;^ y</code> is doing the opposite and turns those same bits off.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 11334063, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xd1JvnhEVGA/AAAAAAAAAAI/AAAAAAAAADU/tRPSF5nc08M/photo.jpg?sz=128", "display_name": "Sheila Wendler", "link": "https://stackoverflow.com/users/11334063/sheila-wendler"}, "is_accepted": false, "score": 2, "last_activity_date": 1554808877, "creation_date": 1554808877, "answer_id": 55591669, "question_id": 34459450, "link": "https://stackoverflow.com/questions/34459450/what-is-the-operator-in-golang/55591669#55591669", "title": "What is the &quot;&amp;^&quot; operator in golang?", "body": "<blockquote>\n  <p>The &amp;^ operator is bit clear (AND NOT): in the expression z = x &amp;^ y,\n  each bit of z is 0 if the corresponding bit of y is 1; otherwise it\n  equals the corresponding bit of x.</p>\n</blockquote>\n\n<p>From <a href=\"http://www.gopl.io/\" rel=\"nofollow noreferrer\">The Go Programming Language</a></p>\n\n<p><strong>Example:</strong></p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc main(){\n    var x uint8 = 1\n    var y uint8 = 1 &lt;&lt; 2\n\n    fmt.Printf(\"%08b\\n\", x &amp;^ y);\n\n}  \n</code></pre>\n\n<p><strong>Result:</strong></p>\n\n<blockquote>\n  <p>00000001</p>\n</blockquote>\n"}], "owner": {"reputation": 321, "user_id": 5390350, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c8b06cc918ec6d69bdced77e9408e218?s=128&d=identicon&r=PG&f=1", "display_name": "mosmo", "link": "https://stackoverflow.com/users/5390350/mosmo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7454, "favorite_count": 10, "accepted_answer_id": 34459527, "answer_count": 2, "score": 21, "last_activity_date": 1554808877, "creation_date": 1451009423, "last_edit_date": 1522487565, "question_id": 34459450, "link": "https://stackoverflow.com/questions/34459450/what-is-the-operator-in-golang", "title": "What is the &quot;&amp;^&quot; operator in golang?", "body": "<p>I can't really google the name AND NOT and get any useful results, what exactly is this operator, and how could I do this in a language like C? I checked the specification, and there is nothing helpful in there but a list that says it's <code>&amp;^</code> (AND NOT).</p>\n"}, {"tags": ["string", "file", "go", "permissions", "int"], "comments": [{"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 3, "creation_date": 1451010945, "post_id": 34459390, "comment_id": 56661253, "body": "Is the problem that you&#39;re expecting <code>&quot;0777&quot;</code> to be interpreted as octal?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1451014078, "post_id": 34459390, "comment_id": 56661610, "body": "The only context in which <code>0777</code> is different than <code>777</code> is as a string. If you&#39;re converting it to <code>int</code> then of course it loses its leading digit. As @JamesHenstridge asked: do you expect <code>0777</code> to be <code>777 base 8</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "is_accepted": true, "score": 0, "last_activity_date": 1451058536, "creation_date": 1451058536, "answer_id": 34464212, "question_id": 34459390, "link": "https://stackoverflow.com/questions/34459390/why-are-the-file-permissions-that-are-set-using-golang-different-than-expected/34464212#34464212", "title": "Why are the file permissions that are set using Golang different than expected?", "body": "<p>Based on the comments of @AdamSmith and @JamesHenstridge the following solves the issue:</p>\n\n<pre><code>mode, _ := strconv.ParseInt(fileAttributes[\"mode\"], 8, 32)\n\n0777\n511\n-rwxrwxrwx\n0753\n491\n-r-xr-x-wx\n0500\n320\n-r-x------\n</code></pre>\n\n<p>However when the leading zeros have been removed the outcome is exactly the same:</p>\n\n<pre><code>777\n511\n-rwxrwxrwx\n753\n491\n-r-xr-x-wx\n500\n320\n-r-x------\n</code></pre>\n\n<p>In conclusion, the leading zeros are not required at all. It was the incorrect type that was causing the issue.</p>\n"}], "owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 839, "favorite_count": 0, "accepted_answer_id": 34464212, "answer_count": 1, "score": -3, "last_activity_date": 1451059967, "creation_date": 1451008438, "last_edit_date": 1451059967, "question_id": 34459390, "link": "https://stackoverflow.com/questions/34459390/why-are-the-file-permissions-that-are-set-using-golang-different-than-expected", "title": "Why are the file permissions that are set using Golang different than expected?", "body": "<pre><code>func stringToInt(s string) int {\n    i, err := strconv.Atoi(s)\n    check(err)\n    return i\n}\n\nos.FileMode(stringToInt(\"0777\"))\n</code></pre>\n\n<p>when no conversion to int is required (leading zero is not removed) by setting the permission directly:</p>\n\n<pre><code>os.FileMode(0777)\n</code></pre>\n\n<p>the file permissions are correct</p>\n\n<p><strong>Current outcome</strong></p>\n\n<pre><code>777\n777\n-r----x--x\n753\n753\n--wxrw---x\n500\n500\n-rwxrw-r--\n</code></pre>\n\n<p><strong>Expected outcome</strong></p>\n\n<pre><code>777\n-rwxrwxrwx\n753\n-r-xr-x-wx\n500\n-r-x------\n</code></pre>\n"}, {"tags": ["shell", "command-line", "go", "exec"], "answers": [{"comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1451002983, "post_id": 34459037, "comment_id": 56660198, "body": "Thank you for your answer.  I especially appreciate your first suggestion.  I stumbled on your second suggestion and currently using it."}, {"owner": {"reputation": 643, "user_id": 5046220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d6703018e7d190e03c461a2ea5c162b6?s=128&d=identicon&r=PG&f=1", "display_name": "supriya", "link": "https://stackoverflow.com/users/5046220/supriya"}, "edited": false, "score": 0, "creation_date": 1494413296, "post_id": 34459037, "comment_id": 74814339, "body": "@James I tried the way you suggested. command := exec.Command(&quot;echo *tar.gz | xargs -n1 tar zxf&quot;) command.Dir = pathFinal cmdErr := command.Run() This is not working for me on the otherhand,  command := &quot;cd &quot;+pathFinal+&quot;; &quot;+&quot;echo *tar.gz | xargs -n1 tar zxf&quot; cmd := exec.Command(&quot;/bin/sh&quot;, &quot;-c&quot;, command) This is working. I want to implement it the first way. I don&#39;t know why it is not working."}, {"owner": {"reputation": 643, "user_id": 5046220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d6703018e7d190e03c461a2ea5c162b6?s=128&d=identicon&r=PG&f=1", "display_name": "supriya", "link": "https://stackoverflow.com/users/5046220/supriya"}, "edited": false, "score": 0, "creation_date": 1494413965, "post_id": 34459037, "comment_id": 74814841, "body": "It throws error: Failed to untar file: exec: &quot;echo *tar.gz | xargs -n1 tar zxf&quot;: executable file not found in $PATH"}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "reply_to_user": {"reputation": 643, "user_id": 5046220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d6703018e7d190e03c461a2ea5c162b6?s=128&d=identicon&r=PG&f=1", "display_name": "supriya", "link": "https://stackoverflow.com/users/5046220/supriya"}, "edited": false, "score": 1, "creation_date": 1494577070, "post_id": 34459037, "comment_id": 74897847, "body": "@supriya: globs and pipes are shell features rather than things interpreted by the kernel.  You&#39;ll either need to do those parts from Go, or explicitly call the shell and let it interpret things for you.  You can pipe together commands by the <code>StdoutPipe()</code> of the first command to <code>Stdin</code> of the second command."}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": true, "score": 31, "last_activity_date": 1451002830, "creation_date": 1451002830, "answer_id": 34459037, "question_id": 34458625, "link": "https://stackoverflow.com/questions/34458625/run-multiple-exec-commands-in-the-same-shell-golang/34459037#34459037", "title": "Run Multiple Exec Commands in the same shell golang", "body": "<p>If you want to run multiple commands within a single shell instance, you will need to invoke the shell with something like this:</p>\n\n<pre><code>cmd := exec.Command(\"/bin/sh\", \"-c\", \"command1; command2; command3; ...\")\nerr := cmd.Run()\n</code></pre>\n\n<p>This will get the shell to interpret the given commands.  It will also let you execute shell builtins like <code>cd</code>.  Note that this can be non-trivial to substitute in user data to these commands in a safe way.</p>\n\n<p>If instead you just want to run a command in a particular directory, you can do that without the shell.  You can set the current working directory to execute the command like so:</p>\n\n<pre><code>config := exec.Command(\"./configure\", \"--disable-yasm\")\nconfig.Dir = folderPath\nbuild := exec.Command(\"make\")\nbuild.Dir = folderPath\n</code></pre>\n\n<p>... and continue on like you were before.</p>\n"}], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15845, "favorite_count": 1, "accepted_answer_id": 34459037, "answer_count": 1, "score": 8, "last_activity_date": 1497602649, "creation_date": 1450998073, "last_edit_date": 1451002589, "question_id": 34458625, "link": "https://stackoverflow.com/questions/34458625/run-multiple-exec-commands-in-the-same-shell-golang", "title": "Run Multiple Exec Commands in the same shell golang", "body": "<p>I'm having trouble figuring out how to run multiple commands using the os/exec package. I've trolled the net and stackoverflow and haven't found anything that works for me case. Here's my source:</p>\n\n<pre><code>package main\n\nimport (\n    _ \"bufio\"\n    _ \"bytes\"\n    _ \"errors\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n    \"path/filepath\"\n)\n\nfunc main() {\n    ffmpegFolderName := \"ffmpeg-2.8.4\"\n    path, err := filepath.Abs(\"\")\n    if err != nil {\n        fmt.Println(\"Error locating absulte file paths\")\n        os.Exit(1)\n    }\n\n    folderPath := filepath.Join(path, ffmpegFolderName)\n\n    _, err2 := folderExists(folderPath)\n    if err2 != nil {\n        fmt.Println(\"The folder: %s either does not exist or is not in the same directory as make.go\", folderPath)\n        os.Exit(1)\n    }\n    cd := exec.Command(\"cd\", folderPath)\n    config := exec.Command(\"./configure\", \"--disable-yasm\")\n    build := exec.Command(\"make\")\n\n    cd_err := cd.Start()\n    if cd_err != nil {\n        log.Fatal(cd_err)\n    }\n    log.Printf(\"Waiting for command to finish...\")\n    cd_err = cd.Wait()\n    log.Printf(\"Command finished with error: %v\", cd_err)\n\n    start_err := config.Start()\n    if start_err != nil {\n        log.Fatal(start_err)\n    }\n    log.Printf(\"Waiting for command to finish...\")\n    start_err = config.Wait()\n    log.Printf(\"Command finished with error: %v\", start_err)\n\n    build_err := build.Start()\n    if build_err != nil {\n        log.Fatal(build_err)\n    }\n    log.Printf(\"Waiting for command to finish...\")\n    build_err = build.Wait()\n    log.Printf(\"Command finished with error: %v\", build_err)\n\n}\n\nfunc folderExists(path string) (bool, error) {\n    _, err := os.Stat(path)\n    if err == nil {\n        return true, nil\n    }\n    if os.IsNotExist(err) {\n        return false, nil\n    }\n    return true, err\n}\n</code></pre>\n\n<p>I want to the command like I would from terminal.  <code>cd path; ./configure; make</code>\nSo I need run each command in order and wait for the last command to finish before moving on.  With my current version of the code it currently says that <code>./configure: no such file or directory</code> I assume that is because cd path executes and in a new shell ./configure executes, instead of being in the same directory from the previous command.  Any ideas? \n<strong>UPDATE</strong> I solved the issue by changing the working directory and then executing the ./configure and make command</p>\n\n<pre><code>err = os.Chdir(folderPath)\n    if err != nil {\n        fmt.Println(\"File Path Could not be changed\")\n        os.Exit(1)\n    }\n</code></pre>\n\n<p>Still now i'm curious to know if there is a way to execute commands in the same shell.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1450993836, "creation_date": 1450993836, "answer_id": 34458197, "question_id": 34458176, "link": "https://stackoverflow.com/questions/34458176/pass-variable-in-url-golang/34458197#34458197", "title": "Pass variable in URL golang", "body": "<p>Using <code>fmt.Sprintf</code></p>\n\n<pre><code>getContent(fmt.Sprintf(\"http://foo.foo2.foo3=%d\", variableInteger), &amp;resp)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314, "user_id": 5716193, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v9QW0.jpg?s=128&g=1", "display_name": "Amnon", "link": "https://stackoverflow.com/users/5716193/amnon"}, "is_accepted": false, "score": 3, "last_activity_date": 1451294353, "creation_date": 1451294353, "answer_id": 34490751, "question_id": 34458176, "link": "https://stackoverflow.com/questions/34458176/pass-variable-in-url-golang/34490751#34490751", "title": "Pass variable in URL golang", "body": "<p>I would use the net/url package to build your URL.</p>\n\n<pre><code>    package main\n\n    import (\"fmt\"\n        \"net/url\"\n        )\n\n\n    func main() {\n        query := make(url.Values)\n        query.Add(\"foo3\", \"123\")\n        url := &amp;url.URL{RawQuery: query.Encode(), Host: \"foo\", Scheme: \"http\"}\n        fmt.Println(url.String())\n\n    }\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 2502053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5c7476fd88b34ca2dbf898f5056e337d?s=128&d=identicon&r=PG", "display_name": "user2502053", "link": "https://stackoverflow.com/users/2502053/user2502053"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2636, "favorite_count": 0, "accepted_answer_id": 34458197, "answer_count": 2, "score": 2, "last_activity_date": 1451294353, "creation_date": 1450993590, "question_id": 34458176, "link": "https://stackoverflow.com/questions/34458176/pass-variable-in-url-golang", "title": "Pass variable in URL golang", "body": "<p>I am new to go so this probably elementary. I have a function to retrieve json from a URL and need to pass a variable integer within the URL. How do append a variable onto the end of another variable?  Here is my code:</p>\n\n<pre><code>    type content struct {\n\nStationTitle string `json:\"StationTitle\"`\n}\n\nfunc main() {\n\nresp := content{}\ngetContent(\"http://foo.foo2.foo3=variableInteger\", &amp;resp)\nprintln(resp.StationTitle)\n}\n\n// fetch json\n\nfunc getContent(url string, target interface{}) error {\nr, err := http.Get(url)\nif err != nil {\nreturn err\n}\ndefer r.Body.Close()\n\nreturn json.NewDecoder(r.Body).Decode(target)\n}\n</code></pre>\n"}, {"tags": ["pointers", "struct", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1450980882, "post_id": 34456429, "comment_id": 56654829, "body": "That&#39;s basically it -- I&#39;m not sure if you&#39;re asking more than a yes or no question. Re: #2, it&#39;s good to remember that <i>everything</i> in Go is passed by value, and in this case you would be passing a pointer by value."}, {"owner": {"reputation": 2570, "user_id": 1186550, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1ceaf7f9879ffccedb58c51c7680ca12?s=128&d=identicon&r=PG", "display_name": "Jim Pedid", "link": "https://stackoverflow.com/users/1186550/jim-pedid"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1450980952, "post_id": 34456429, "comment_id": 56654862, "body": "It is essentially a Yes/No question, but if it were a no then I would have wanted to know what was wrong. Thanks for your input.  For 2, is it correct to say that the pointer is passed by value, but we use that pointer to modify the object that it points to, but if we pass in a struct (instead of a pointer to that struct), then we will only ever be able to modify the copy?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1450988351, "post_id": 34456429, "comment_id": 56657041, "body": "yes, for number two your comment is correct. The pointer is passed by value but allows you access to the thing it points to. If your receiver is a struct rather than a struct pointer, the method will be operating on a copy."}], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 30, "last_activity_date": 1450988839, "creation_date": 1450988839, "answer_id": 34457632, "question_id": 34456429, "link": "https://stackoverflow.com/questions/34456429/when-to-use-pointers/34457632#34457632", "title": "When to use pointers", "body": "<p>Your assumptions are correct. About #3, Go is concurrent language and passing by reference in goroutines make them all read same structure which is safe, but also make them modify same structure which is dangerous.</p>\n"}], "owner": {"reputation": 2570, "user_id": 1186550, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1ceaf7f9879ffccedb58c51c7680ca12?s=128&d=identicon&r=PG", "display_name": "Jim Pedid", "link": "https://stackoverflow.com/users/1186550/jim-pedid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19260, "favorite_count": 18, "closed_date": 1450990801, "accepted_answer_id": 34457632, "answer_count": 1, "score": 63, "last_activity_date": 1569320500, "creation_date": 1450980471, "last_edit_date": 1569320500, "question_id": 34456429, "link": "https://stackoverflow.com/questions/34456429/when-to-use-pointers", "closed_reason": "Duplicate", "title": "When to use pointers", "body": "<p>I'm new to the Go Language, and have only minimal background in C/C++, so naturally I'm struggling with the idea of when to use pointers and when not to use pointers. Although this question might be considered open-ended, I'm wondering what some guidelines on when to return structs and when to return pointers, (and equivalently when to accept structs / pointers as arguments).</p>\n\n<p>From what I can guess, the following statements hold true:</p>\n\n<ol>\n<li>structs are passed into functions by value. That is, a copy of a structure is made when passing it into a function.</li>\n<li>if I want to pass a structure by reference, then I would instead use a pointer argument in the function definition, and use the addressof operator when calling the function.</li>\n<li>The reason why I would want to pass in a structure by reference is because either the structure I'm passing in is large, and it would be taxing on memory to pass it by value (unlikely) or if I want to make changes to the copy that I'm passing in (more likely).</li>\n<li>As a corollary to 3.), I should pass by value unless I have one of the reasons above to pass by reference.</li>\n</ol>\n\n<p>Are my assumptions correct? Or am I missing the mark on pointers?</p>\n"}, {"tags": ["opengl", "go"], "comments": [{"owner": {"reputation": 1225, "user_id": 472179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dfd8e3df139f5e4bcd23e5fae15c512?s=128&d=identicon&r=PG", "display_name": "sixFingers", "link": "https://stackoverflow.com/users/472179/sixfingers"}, "edited": false, "score": 0, "creation_date": 1451237175, "post_id": 34455925, "comment_id": 56707767, "body": "Have you taken a look at <a href=\"https://github.com/golang/freetype/blob/master/example/freetype/main.go\" rel=\"nofollow noreferrer\">github.com/golang/freetype/blob/master/example/freetype/main&zwnj;&#8203;.go</a>? I&#39;m currently working on the same thing, same language."}, {"owner": {"reputation": 159, "user_id": 4135957, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/100003307910037/picture?type=large", "display_name": "Guilherme Nemeth", "link": "https://stackoverflow.com/users/4135957/guilherme-nemeth"}, "reply_to_user": {"reputation": 1225, "user_id": 472179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dfd8e3df139f5e4bcd23e5fae15c512?s=128&d=identicon&r=PG", "display_name": "sixFingers", "link": "https://stackoverflow.com/users/472179/sixfingers"}, "edited": false, "score": 0, "creation_date": 1451284463, "post_id": 34455925, "comment_id": 56719396, "body": "@sixFingers yes, I&#39;ve actually used the &quot;drawer&quot; example. Anyways, the problem was in my rendering code, and I&#39;ve been able to solve it. It is working now, let me know if you need any help."}, {"owner": {"reputation": 1225, "user_id": 472179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3dfd8e3df139f5e4bcd23e5fae15c512?s=128&d=identicon&r=PG", "display_name": "sixFingers", "link": "https://stackoverflow.com/users/472179/sixfingers"}, "edited": false, "score": 0, "creation_date": 1451309496, "post_id": 34455925, "comment_id": 56730377, "body": "happy to hear you solved it. I did, too. In the end, i used a list of triangles with corresponding uvs. One single draw for an entire textBox."}], "owner": {"reputation": 159, "user_id": 4135957, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/100003307910037/picture?type=large", "display_name": "Guilherme Nemeth", "link": "https://stackoverflow.com/users/4135957/guilherme-nemeth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1711, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1450976974, "creation_date": 1450976974, "question_id": 34455925, "link": "https://stackoverflow.com/questions/34455925/render-truetype-fonts-with-opengl", "title": "Render Truetype fonts with OpenGL", "body": "<p>I am starting to learn OpenGL now, using the <strong>Go programming language</strong> (I just couldn't get working with C/C++ on my Windows machine), and so far I've managed to display some rotating cubes in the screen with textures mainly copying and pasting code from tutorials. I've learned a lot, though, but I just can't get some text on the screen with this code that I wrote on my own. I've looked up many tutorials and questions but nothing seems to work, and I suspect there is something wrong with the vertices because I'm pretty sure the textures coordinates are correct and still there's nothing showing up in the screen. Here's the code:</p>\n\n<pre><code>package game\n\nimport (\n  \"fmt\"\n  \"io/ioutil\"\n  \"image\"\n  \"image/draw\"\n  \"github.com/go-gl/gl/v3.3-core/gl\"\n  mgl \"github.com/go-gl/mathgl/mgl32\"\n  \"github.com/golang/freetype/truetype\"\n  \"golang.org/x/image/font\"\n  \"golang.org/x/image/math/fixed\"\n)\n\ntype GameFont struct {\n  loaded bool\n  vao uint32\n  vbo VBOData\n  pix float32\n  Texture *Texture\n  Shader ShaderProgram\n}\n\n\n// Load a TrueType font from a file and generate a texture \n// with all important characters.\nfunc (f *GameFont) Load(path string, pix float32) {\n  contents, err := ioutil.ReadFile(path)\n  if err != nil {\n    fmt.Println(\"Could not read font file: \" + path)\n    panic(err)\n  }\n  fontFace, err := truetype.Parse(contents)\n  if err != nil {\n    fmt.Println(\"Could not parse font file: \" + path)\n    panic(err)\n  }\n\n  // Create a texture for the characters\n  // Find the next power of 2 for the texture size\n  size := nextP2(int(pix * 16))\n  fg, bg := image.White, image.Black\n  rgba := image.NewRGBA(image.Rect(0, 0, size, size))\n\n  draw.Draw(rgba, rgba.Bounds(), bg, image.ZP, draw.Src)\n  d := &amp;font.Drawer{\n    Dst: rgba,\n    Src: fg,\n    Face: truetype.NewFace(fontFace, &amp;truetype.Options{\n      Size: float64(pix),\n      DPI: 72,\n      Hinting: font.HintingNone,\n    }),\n  }\n\n  // Some GL preps\n  gl.GenVertexArrays(1, &amp;f.vao)\n  gl.BindVertexArray(f.vao)\n  f.vbo.Create()\n  f.vbo.Bind()\n\n  f.Shader = newShaderProgram(\"data/shaders/font.vert\", \"data/shaders/font.frag\")\n  f.Shader.Use()\n  f.Shader.SetUniform(\"tex\", 0)\n\n  // Create vertex data (and coordinates in the texture) for each character\n  // All characters below 32 are useless\n  for i := 32; i &lt; 128; i++ {\n    c := string(rune(i))\n    x, y := i % 16, i / 16\n\n    // Draw the character on the texture\n    d.Dot = fixed.P(x * int(pix), y * int(pix))\n    d.DrawString(c)\n\n    // Vertices\n    quads := []float32{\n      0,    0,\n      0,    pix,\n      pix,  0,\n      pix,  pix,\n    }\n\n    norm := func(n int) float32 {\n      return float32(n) / 16.0\n    }\n\n    // Texture coordinates (normalized)\n    texQuads := []float32{\n      norm(x),      1.0 - norm(y + 1),\n      norm(x),      1.0 - norm(y),\n      norm(x + 1),  1.0 - norm(y + 1),\n      norm(x + 1),  1.0 - norm(y),\n    }\n\n    for v := 0; v &lt; 8; v += 2 {\n      vQuads, vTexQuads := quads[v:(v+2)], texQuads[v:(v+2)]\n\n      // Data is like (X, Y, U, V)\n      f.vbo.AppendData(vQuads, 2)\n      f.vbo.AppendData(vTexQuads, 2)\n    }\n  }\n\n  // Upload data to GPU and we're done\n  f.Texture = newTextureFromRGBA(rgba)\n  f.Texture.Bind()\n  f.Texture.SetGLParam(gl.TEXTURE_MIN_FILTER, gl.LINEAR)\n  f.Texture.SetGLParam(gl.TEXTURE_MAG_FILTER, gl.LINEAR)\n  f.Texture.Upload()\n\n  f.vbo.UploadData(gl.STATIC_DRAW)\n\n  gl.EnableVertexAttribArray(0)\n  gl.VertexAttribPointer(0, 2, gl.FLOAT, false, 4*4, gl.PtrOffset(0))\n  gl.EnableVertexAttribArray(1)\n  gl.VertexAttribPointer(1, 2, gl.FLOAT, false, 4*4, gl.PtrOffset(2*4))\n\n  f.loaded = true\n}\n\n// Render a text using the font\nfunc (f *GameFont) Render(text string, x, y int, pix float32, color mgl.Vec4) {\n  if !f.loaded {\n    return\n  }\n\n  gl.Disable(gl.DEPTH_TEST)\n  gl.Enable(gl.BLEND)\n  gl.BlendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n  gl.BindVertexArray(f.vao)\n\n  f.Shader.Use()\n  f.Shader.SetUniform(\"projection\", mgl.Ortho2D(0, _screen.Width, 0, _screen.Height))\n  f.Shader.SetUniform(\"color\", color)\n\n  f.Texture.Bind()\n\n  scale := pix / f.pix\n  for i := 0; i &lt; len(text); i++ {\n    index := rune(text[i])\n    model := mgl.Ident4().Mul4(mgl.Scale3D(scale, scale, 0))\n    model = model.Add(mgl.Translate3D(float32(x) + float32(i) * pix, float32(y), 0))\n    f.Shader.SetUniform(\"model\", model)\n    gl.DrawArrays(gl.TRIANGLE_STRIP, (32-index)*4, 4)\n  }\n\n  gl.Enable(gl.DEPTH_TEST)\n  gl.Disable(gl.BLEND)\n}\n</code></pre>\n\n<p>Here's the shaders:</p>\n\n<p><strong>Vertex shader</strong></p>\n\n<pre><code>#version 330\nuniform mat4 projection;\nuniform mat4 model;\n\nlayout (location = 0) in vec2 vert;\nlayout (location = 1) in vec2 vertTexCoord;\n\nout vec2 fragTexCoord;\n\nvoid main() {\n  fragTexCoord = vertTexCoord;\n  gl_Position = projection * model * vec4(vert, 0, 1);\n}\n</code></pre>\n\n<p><strong>Fragment shader</strong></p>\n\n<pre><code>#version 330\n\nuniform sampler2D tex;\nuniform vec4 color;\n\nin vec2 fragTexCoord;\nout vec4 outputColor;\n\nvoid main() {\n  outputColor = color * texture(tex, fragTexCoord);\n}\n</code></pre>\n\n<p>Every \"component\" of the GameFont struct is working properly (I've used them with the rotating cubes), so every function calls the GL corresponding one.</p>\n\n<p>Also the texture is being drawed correctly, I've saved it to the disk and it looks like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/VyOWw.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/VyOWw.png\" alt=\"enter image description here\"></a></p>\n\n<p>And still, there's no text on the screen.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1450975101, "post_id": 34455390, "comment_id": 56652932, "body": "Go types are invariant: <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>"}], "answers": [{"comments": [{"owner": {"reputation": 691, "user_id": 5266452, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8ea07a3ee8a8f9a3f997377e06edd689?s=128&d=identicon&r=PG&f=1", "display_name": "Maiko Ohkawa", "link": "https://stackoverflow.com/users/5266452/maiko-ohkawa"}, "edited": false, "score": 0, "creation_date": 1451001825, "post_id": 34455424, "comment_id": 56659972, "body": "Oh, I see. I have to make a new slice. Thank you for the advice. I learned a lot."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 3, "last_activity_date": 1450974141, "creation_date": 1450974141, "answer_id": 34455424, "question_id": 34455390, "link": "https://stackoverflow.com/questions/34455390/how-can-i-cast-from-interface-to-int/34455424#34455424", "title": "How can I cast from []interface{} to []int?", "body": "<p>There is no automatic way to do that. You need to create an int slice and copy into it:</p>\n\n<pre><code>selected := set.ToSlice()\n\n// create a secondary slice of ints, same length as selected\nret := make([]int, len(selected))\n\n// copy one by one\nfor i, x := range selected {\n   ret[i] = x.(int) //provided it's indeed int. you can add a check here\n}\n\nreturn ret\n</code></pre>\n"}], "owner": {"reputation": 691, "user_id": 5266452, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8ea07a3ee8a8f9a3f997377e06edd689?s=128&d=identicon&r=PG&f=1", "display_name": "Maiko Ohkawa", "link": "https://stackoverflow.com/users/5266452/maiko-ohkawa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 422, "favorite_count": 0, "closed_date": 1450975146, "accepted_answer_id": 34455424, "answer_count": 1, "score": 0, "last_activity_date": 1450974141, "creation_date": 1450973917, "question_id": 34455390, "link": "https://stackoverflow.com/questions/34455390/how-can-i-cast-from-interface-to-int", "closed_reason": "Duplicate", "title": "How can I cast from []interface{} to []int?", "body": "<p>I would like to get non duplicated []int.\nI'm using <code>set</code>, but I don't know how to get <code>[]int</code> from <code>set</code>.\nHow can I do that?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n\n    \"github.com/deckarep/golang-set\"\n)\n\nfunc pickup(max int, num int) []int {\n    set := mapset.NewSet()\n\n    rand.Seed(time.Now().UnixNano())\n    for set.Cardinality() &lt; num {\n        n := rand.Intn(max)\n        set.Add(n)\n    }\n    selected := set.ToSlice()\n    // Do I need to cast from []interface{} to []int around here?\n    // selected.([]int) is error.\n    return selected\n}\n\nfunc main() {\n    results := pickup(100, 10)\n    fmt.Println(results)\n    // some processing using []int...\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1450967974, "post_id": 34453894, "comment_id": 56650254, "body": "It&#39;s only polite to link between your cross-posts so people don&#39;t waste their time: <a href=\"https://groups.google.com/forum/?fromgroups#!topic/golang-nuts/yayvQLhR4Bk\" rel=\"nofollow noreferrer\">groups.google.com/forum/?fromgroups#!topic/golang-nuts/&hellip;</a>"}, {"owner": {"reputation": 595, "user_id": 5443590, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/8c3c26c54f6d700cd85d73e1f0cc4b5f?s=128&d=identicon&r=PG&f=1", "display_name": "GKV", "link": "https://stackoverflow.com/users/5443590/gkv"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451044776, "post_id": 34453894, "comment_id": 56666932, "body": "i am sorry sir ,i will keep this in mind"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 7, "last_activity_date": 1450992552, "last_edit_date": 1450992552, "creation_date": 1450966845, "answer_id": 34454176, "question_id": 34453894, "link": "https://stackoverflow.com/questions/34453894/cron-job-in-golang/34454176#34454176", "title": "CRON JOB in GOLANG", "body": "<p>First, you're creating a new scheduler, and waiting on it, but using the default scheduler to run your jobs. </p>\n\n<p>Next, you're blocking on the channel returned by the <code>Start()</code> method. Close that channel to unblock the receive operation. This will also exit the main loop in the cron program if you aren't immediately exiting from <code>main</code>. </p>\n\n<pre><code>func main() {\n    ch := gocron.Start()\n    go test(ch)\n    gocron.Every(5).Seconds().Do(task)\n    gocron.Every(10).Seconds().Do(vijay)\n\n    &lt;-ch\n}\nfunc test(stop chan bool) {\n    time.Sleep(20 * time.Second)\n    gocron.Clear()\n    fmt.Println(\"All task removed\")\n    close(stop)\n}\n</code></pre>\n\n<p>which effectively is the same as </p>\n\n<pre><code>func main() {\n    gocron.Start()\n    gocron.Every(5).Seconds().Do(task)\n    gocron.Every(10).Seconds().Do(vijay)\n\n    time.Sleep(20 * time.Second)\n\n    gocron.Clear()\n    fmt.Println(\"All task removed\")\n}\n</code></pre>\n\n<p>If you're exiting immediately, it doesn't really matter if you call <code>Clear()</code> first and then stop the scheduler, you can simply exit the program. </p>\n"}, {"tags": [], "owner": {"reputation": 3949, "user_id": 1816872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1V08e.jpg?s=128&g=1", "display_name": "Ivan Black", "link": "https://stackoverflow.com/users/1816872/ivan-black"}, "is_accepted": false, "score": 1, "last_activity_date": 1450969036, "last_edit_date": 1495541798, "creation_date": 1450968635, "answer_id": 34454505, "question_id": 34453894, "link": "https://stackoverflow.com/questions/34453894/cron-job-in-golang/34454505#34454505", "title": "CRON JOB in GOLANG", "body": "<p><a href=\"https://stackoverflow.com/a/34454176/1816872\">JimB rights</a>. But I don't know why do you use <code>gocron</code> methods and the <code>s</code> methods. This example works fine:\n</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"github.com/claudiu/gocron\"\n)\n\nfunc task() {\n    fmt.Println(\"I am runnning task.\", time.Now())\n}\nfunc vijay() {\n    fmt.Println(\"I am runnning vijay.\", time.Now())\n}\n\nfunc main() {\n    s := gocron.NewScheduler()\n    s.Every(2).Seconds().Do(task)\n    s.Every(4).Seconds().Do(vijay)\n\n    sc := s.Start() // keep the channel\n    go test(s, sc)  // wait\n    &lt;-sc            // it will happens if the channel is closed\n}\nfunc test(s *gocron.Scheduler, sc chan bool) {\n    time.Sleep(8 * time.Second)\n    s.Clear()\n    fmt.Println(\"All task removed\")\n    close(sc) // close the channel\n}\n</code></pre>\n"}], "owner": {"reputation": 595, "user_id": 5443590, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/8c3c26c54f6d700cd85d73e1f0cc4b5f?s=128&d=identicon&r=PG&f=1", "display_name": "GKV", "link": "https://stackoverflow.com/users/5443590/gkv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9677, "favorite_count": 3, "answer_count": 2, "score": 2, "last_activity_date": 1450992552, "creation_date": 1450965387, "last_edit_date": 1450966657, "question_id": 34453894, "link": "https://stackoverflow.com/questions/34453894/cron-job-in-golang", "title": "CRON JOB in GOLANG", "body": "<p>I AM USING IN CRON  PKG  <a href=\"https://github.com/jasonlvhit/gocron/blob/master/gocron.go\" rel=\"nofollow\">https://github.com/jasonlvhit/gocron/blob/master/gocron.go</a></p>\n\n<pre><code>import (\n    \"fmt\"\n    \"time\"\n\n    \"github.com/claudiu/gocron\"\n)\n\nfunc task() {\n    fmt.Println(\"I am runnning task.\", time.Now())\n}\nfunc vijay() {\n    fmt.Println(\"I am runnning vijay.\", time.Now())\n}\n\nfunc main() {\n    go test()\n\n    gocron.Start()\n    s := gocron.NewScheduler()\n    gocron.Every(5).Seconds().Do(task)\n    gocron.Every(10).Seconds().Do(vijay)\n\n    &lt;-s.Start()\n\n}\nfunc test() {\n    time.Sleep(20 * time.Second)\n    gocron.Clear()\n    fmt.Println(\"All task removed\")\n}\n</code></pre>\n\n<p>My problem is after removing all job, my program is still executing </p>\n\n<p>i want to break the exection after removing all jobs </p>\n\n<p>please help me out ,i am not able to find out how to do it ,\ni tried to change the PKG source code also but not able to find out the way to do it </p>\n\n<p>thank you all </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1450967033, "post_id": 34454016, "comment_id": 56649857, "body": "@xie-jinke, to recap, the whole point of buffered reader is buffering the data it reads. Imagine you wrap an <code>os.File</code>, not <code>strings.Reader</code> into a <code>bufio.Reader</code> and then read byte-by-byte. Without buffering, reading each byte would require performing a syscall asking the kernel to reach for the file&#39;s data -- to get only a single data back. Sure, the kernel buffers filesystem operations in itself but making a syscall is a costly operation. By using buffering, you allow the reader ask the kernel for several kilobytes of data at once and then serve your byte-sized reads from the buffer."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1450967198, "post_id": 34454016, "comment_id": 56649931, "body": "@xie-jinkie, for that matter, once you&#39;ve wrapped a reader into a <code>bufio.Reader</code> instance, you must not make any assumptions about what data have already been read from the underlying reader. From this point on, you must use only the buffered reader to do all the reads from the underlying reader. The same applies to buffered writers: you can&#39;t know what data was already sent to the underlying writer -- until you call the buffered writer&#39;s <code>Flush()</code> method, and it will complete w/o returning an error."}, {"owner": {"reputation": 113, "user_id": 5714642, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-OuEqbhklsiQ/AAAAAAAAAAI/AAAAAAAAABQ/shZ76dy2rd4/photo.jpg?sz=128", "display_name": "Xie Jinke", "link": "https://stackoverflow.com/users/5714642/xie-jinke"}, "edited": false, "score": 0, "creation_date": 1451008095, "post_id": 34454016, "comment_id": 56660887, "body": "Thanks about the detailed explanation . I got the bufio design point ."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1450966073, "creation_date": 1450966073, "answer_id": 34454016, "question_id": 34453727, "link": "https://stackoverflow.com/questions/34453727/golang-why-bufio-reader-change-the-strings-reader/34454016#34454016", "title": "[Golang ]why bufio reader change the strings reader?", "body": "<p>The point of a buffered reader is to read the data stream more efficiently, no matter what size reads are requested.</p>\n\n<p>When you call <code>ReadByte</code>, if the internal buffer is empty, it calls its internal <code>fill()</code> method to refill the buffer, which in this case consumes the entire <code>strings.Reader</code>. The single byte is then returned from this internal buffer.</p>\n"}], "owner": {"reputation": 113, "user_id": 5714642, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-OuEqbhklsiQ/AAAAAAAAAAI/AAAAAAAAABQ/shZ76dy2rd4/photo.jpg?sz=128", "display_name": "Xie Jinke", "link": "https://stackoverflow.com/users/5714642/xie-jinke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1450966073, "creation_date": 1450964529, "question_id": 34453727, "link": "https://stackoverflow.com/questions/34453727/golang-why-bufio-reader-change-the-strings-reader", "title": "[Golang ]why bufio reader change the strings reader?", "body": "<p>The code follows ==</p>\n\n<pre><code>s := strings.NewReader(\"ABCDEFGJHIJK\")\nfmt.Printf(\"pa is %d\\n \", s.GetValueI()) //GetValueI() returns the value of r.i\n\nbr := bufio.NewReader(s)\nfmt.Printf(\"papa is %d\\n \", s.GetValueI())\n\ncc, _ := br.ReadByte()\nfmt.Printf(\"%c\\n\", cc)\nfmt.Printf(\"papapa is %d\\n \", s.GetValueI())\n</code></pre>\n\n<p>The prints shows:\npa is 0\npapa is 0\nA\npapapa is 12</p>\n\n<p>So weired Results.. \nwhy papapa is 12 when bufio call ReadByte() ?\nIt really confuse me a lot ..</p>\n"}, {"tags": ["email", "parsing", "go"], "answers": [{"tags": [], "owner": {"reputation": 63, "user_id": 5714506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/588464a7494bf810e0cfe7cc3f8b20e2?s=128&d=identicon&r=PG&f=1", "display_name": "Zippelin", "link": "https://stackoverflow.com/users/5714506/zippelin"}, "is_accepted": true, "score": 0, "last_activity_date": 1450982890, "creation_date": 1450982890, "answer_id": 34456790, "question_id": 34453104, "link": "https://stackoverflow.com/questions/34453104/parse-email-fields-with-golang/34456790#34456790", "title": "Parse email fields with Golang", "body": "<p>Ok, so i figured it out by my self. But anyway, maybe someone else interested in that. You can have access to varios fields of mail by </p>\n\n<pre><code>msg.Header.Get(\"Content-type\")\n</code></pre>\n\n<p>and instead of <code>Content-type</code> you can put any header part name.</p>\n\n<pre><code>fmt.println(msg)\n</code></pre>\n\n<p>to know what name fields it have</p>\n"}], "owner": {"reputation": 63, "user_id": 5714506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/588464a7494bf810e0cfe7cc3f8b20e2?s=128&d=identicon&r=PG&f=1", "display_name": "Zippelin", "link": "https://stackoverflow.com/users/5714506/zippelin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 742, "favorite_count": 0, "accepted_answer_id": 34456790, "answer_count": 1, "score": 1, "last_activity_date": 1450982890, "creation_date": 1450961484, "last_edit_date": 1450962474, "question_id": 34453104, "link": "https://stackoverflow.com/questions/34453104/parse-email-fields-with-golang", "title": "Parse email fields with Golang", "body": "<p>I am trying to parse my emails in Go and I need help.</p>\n\n<p>How to get access to Content-type field of mail?</p>\n\n<pre><code>    cmd, _ = c.Fetch(set, \"BODY[HEADER]\", \"BODY[1]\")\n    for cmd.InProgress() {\n    for _, rsp = range cmd.Data {\n        header := imap.AsBytes(rsp.MessageInfo().Attrs[\"BODY[HEADER]\"])\n        body := imap.AsString(rsp.MessageInfo().Attrs[\"BODY[1]\"])\n        if msg, _ := mail.ReadMessage(bytes.NewReader(header)); msg != nil {\n</code></pre>\n\n<p>with this I can gain access to Body and Header, but when email contain included file then with <code>BODY[1]</code> I have all meta-data, not only pure text. To avoid that I can use <code>BODY[1.1]</code>, but I need condition by <code>Content-Type:[multipart/alternative]</code> and I can't gain access ot that field.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 5167557, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-16YuRRKBHW8/AAAAAAAAAAI/AAAAAAAAFBA/r9GYoQy3A_Y/photo.jpg?sz=128", "display_name": "Sachin Agarwal", "link": "https://stackoverflow.com/users/5167557/sachin-agarwal"}, "edited": false, "score": 0, "creation_date": 1451131338, "post_id": 34453269, "comment_id": 56683686, "body": "Thanks Mickael. I had created folder name as img and inside that keep one image named test.jpg and used above code but still its not working? Any other changes I need to do?"}, {"owner": {"reputation": 8752, "user_id": 559289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8183a67842b916b7d7dfd99f5ce7759d?s=128&d=identicon&r=PG", "display_name": "Micka&#235;l R&#233;mond", "link": "https://stackoverflow.com/users/559289/micka%c3%abl-r%c3%a9mond"}, "reply_to_user": {"reputation": 13, "user_id": 5167557, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-16YuRRKBHW8/AAAAAAAAAAI/AAAAAAAAFBA/r9GYoQy3A_Y/photo.jpg?sz=128", "display_name": "Sachin Agarwal", "link": "https://stackoverflow.com/users/5167557/sachin-agarwal"}, "edited": false, "score": 0, "creation_date": 1451131465, "post_id": 34453269, "comment_id": 56683709, "body": "My code is referring to &quot;/img/MR.png&quot;. You likely got the naming wrong."}, {"owner": {"reputation": 13, "user_id": 5167557, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-16YuRRKBHW8/AAAAAAAAAAI/AAAAAAAAFBA/r9GYoQy3A_Y/photo.jpg?sz=128", "display_name": "Sachin Agarwal", "link": "https://stackoverflow.com/users/5167557/sachin-agarwal"}, "edited": false, "score": 0, "creation_date": 1451133330, "post_id": 34453269, "comment_id": 56684057, "body": "I had used the below line  fmt.Fprintf(w, &quot;&lt;h1&gt;Hello&lt;/h1&gt;&lt;img src=&#39;/img/test.jpg&#39;/&gt;&quot;)  in place of  fmt.Fprintf(w, &quot;&lt;h1&gt;Hello&lt;/h1&gt;&lt;img src=&#39;/img/MR.png&#39;/&gt;&quot;)"}, {"owner": {"reputation": 8752, "user_id": 559289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8183a67842b916b7d7dfd99f5ce7759d?s=128&d=identicon&r=PG", "display_name": "Micka&#235;l R&#233;mond", "link": "https://stackoverflow.com/users/559289/micka%c3%abl-r%c3%a9mond"}, "reply_to_user": {"reputation": 13, "user_id": 5167557, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-16YuRRKBHW8/AAAAAAAAAAI/AAAAAAAAFBA/r9GYoQy3A_Y/photo.jpg?sz=128", "display_name": "Sachin Agarwal", "link": "https://stackoverflow.com/users/5167557/sachin-agarwal"}, "edited": false, "score": 0, "creation_date": 1451133460, "post_id": 34453269, "comment_id": 56684090, "body": "The code is right, it work for me. Please detail what does not work if you expect more insight."}, {"owner": {"reputation": 8752, "user_id": 559289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8183a67842b916b7d7dfd99f5ce7759d?s=128&d=identicon&r=PG", "display_name": "Micka&#235;l R&#233;mond", "link": "https://stackoverflow.com/users/559289/micka%c3%abl-r%c3%a9mond"}, "reply_to_user": {"reputation": 13, "user_id": 5167557, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-16YuRRKBHW8/AAAAAAAAAAI/AAAAAAAAFBA/r9GYoQy3A_Y/photo.jpg?sz=128", "display_name": "Sachin Agarwal", "link": "https://stackoverflow.com/users/5167557/sachin-agarwal"}, "edited": false, "score": 0, "creation_date": 1451134732, "post_id": 34453269, "comment_id": 56684365, "body": "works for me, I see the image, so I do not think there is a problem in code."}, {"owner": {"reputation": 13, "user_id": 5167557, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-16YuRRKBHW8/AAAAAAAAAAI/AAAAAAAAFBA/r9GYoQy3A_Y/photo.jpg?sz=128", "display_name": "Sachin Agarwal", "link": "https://stackoverflow.com/users/5167557/sachin-agarwal"}, "edited": false, "score": 0, "creation_date": 1451211452, "post_id": 34453269, "comment_id": 56700606, "body": "When I tried to give URl localhost:8080 then Hello world is coming but not image.. when I go to url localhost:8080/img/ then image link is coming on clicking that image is loading.. Is there o way that image can load in home page itself?"}, {"owner": {"reputation": 8752, "user_id": 559289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8183a67842b916b7d7dfd99f5ce7759d?s=128&d=identicon&r=PG", "display_name": "Micka&#235;l R&#233;mond", "link": "https://stackoverflow.com/users/559289/micka%c3%abl-r%c3%a9mond"}, "reply_to_user": {"reputation": 13, "user_id": 5167557, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-16YuRRKBHW8/AAAAAAAAAAI/AAAAAAAAFBA/r9GYoQy3A_Y/photo.jpg?sz=128", "display_name": "Sachin Agarwal", "link": "https://stackoverflow.com/users/5167557/sachin-agarwal"}, "edited": false, "score": 0, "creation_date": 1451212657, "post_id": 34453269, "comment_id": 56700891, "body": "Force reload the page in your browser."}], "tags": [], "owner": {"reputation": 8752, "user_id": 559289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8183a67842b916b7d7dfd99f5ce7759d?s=128&d=identicon&r=PG", "display_name": "Micka&#235;l R&#233;mond", "link": "https://stackoverflow.com/users/559289/micka%c3%abl-r%c3%a9mond"}, "is_accepted": true, "score": 1, "last_activity_date": 1450962342, "creation_date": 1450962342, "answer_id": 34453269, "question_id": 34452128, "link": "https://stackoverflow.com/questions/34452128/how-to-add-image-in-html-file-in-go/34453269#34453269", "title": "How to add Image in HTML file in Go", "body": "<p>You can add an handler for dealing with function in an img directory, for example.</p>\n\n<p>Here is one possible way to do it:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc RootHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"&lt;h1&gt;Hello&lt;/h1&gt;&lt;img src='/img/MR.png'/&gt;\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", RootHandler) // homepage\n\n    http.HandleFunc(\"/img/\", func(w http.ResponseWriter, r *http.Request) {\n        http.ServeFile(w, r, r.URL.Path[1:])\n    })\n\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 5167557, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-16YuRRKBHW8/AAAAAAAAAAI/AAAAAAAAFBA/r9GYoQy3A_Y/photo.jpg?sz=128", "display_name": "Sachin Agarwal", "link": "https://stackoverflow.com/users/5167557/sachin-agarwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 1, "accepted_answer_id": 34453269, "answer_count": 1, "score": -3, "last_activity_date": 1451229016, "creation_date": 1450956616, "last_edit_date": 1451229016, "question_id": 34452128, "link": "https://stackoverflow.com/questions/34452128/how-to-add-image-in-html-file-in-go", "title": "How to add Image in HTML file in Go", "body": "<p>First of all, I created an HTML file using Notepad ++ with this code:</p>\n\n<pre><code>&lt;body&gt;\n    &lt;table&gt;\n        &lt;tr&gt;\n            &lt;td&gt;Jill&lt;/td&gt;\n            &lt;td&gt;Smith&lt;/td&gt;\n            &lt;td&gt;&lt;img src=\"test.jpg\" border=3 height=100 width=300 /&gt;&lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr&gt;\n            &lt;td&gt;Eve&lt;/td&gt;\n            &lt;td&gt;Jackson&lt;/td&gt;\n            &lt;td&gt;94&lt;/td&gt;\n        &lt;/tr&gt;\n    &lt;/table&gt;\n&lt;/body&gt;\n</code></pre>\n\n<p>Below is the Go language Code for this :-</p>\n\n<pre><code>// * /\nfunc rootHandler(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path == \"/\" {\n        homeHandler(w, r)\n    } else {\n        log.Printf(\"rootHandler: Could not forward request for %s any further.\", r.RequestURI)\n\n        errNotFound(w, r)\n    }\n}\n</code></pre>\n\n<p>I want test.png should be loaded in browser but its not working.</p>\n"}, {"tags": ["go", "travis-ci", "godeps"], "comments": [{"owner": {"reputation": 4642, "user_id": 972121, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0562ca04e265894460832fcdccfedbf4?s=128&d=identicon&r=PG", "display_name": "mclaassen", "link": "https://stackoverflow.com/users/972121/mclaassen"}, "edited": false, "score": 0, "creation_date": 1459998729, "post_id": 34450483, "comment_id": 60543397, "body": "I am still getting this issue. Travis does <code>go get github.com&#47;tools&#47;godep</code> before running <code>godep restore</code> but it fails with &quot;godep: Error comparing go1.4 to devel&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 2146, "user_id": 1972313, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/E5SGl.png?s=128&g=1", "display_name": "Sebastian-Lauren\u0163iu Plesciuc", "link": "https://stackoverflow.com/users/1972313/sebastian-lauren%c5%a3iu-plesciuc"}, "is_accepted": false, "score": 1, "last_activity_date": 1452237867, "creation_date": 1452237867, "answer_id": 34671549, "question_id": 34450483, "link": "https://stackoverflow.com/questions/34450483/error-using-godep-on-travis-ci-automated-build-for-tip-version-of-go/34671549#34671549", "title": "Error using Godep on Travis CI automated build for tip version of Go", "body": "<p>So I asked this question on December 24 2015.</p>\n\n<p>On December 29 2015, github user <em>zchee</em> opened a <a href=\"https://github.com/tools/godep/pull/387\" rel=\"nofollow\">pull request</a> that fixed the issue mentioned in my question.</p>\n\n<p>On January 4 2016, the pull request was merged into the <code>master</code> branch of <code>godep</code>. So essentially the issue is now fixed and in order for <code>Travis CI</code> to use <code>godep restore</code> and test your project against the <code>tip</code> version of <code>Go</code>, your <code>.travis.yml</code> file should look like it does in the question, i.e.:</p>\n\n<pre><code>language: go\n\ngo: \n - 1.3.3\n - 1.4.2\n - 1.5.1\n - release\n - tip\n\nbefore_install:\n - go get github.com/my_project_path\n - go get github.com/tools/godep\n\ninstall:\n - godep restore\n\nscript:\n - go test -v ./...\n</code></pre>\n"}], "owner": {"reputation": 2146, "user_id": 1972313, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/E5SGl.png?s=128&g=1", "display_name": "Sebastian-Lauren\u0163iu Plesciuc", "link": "https://stackoverflow.com/users/1972313/sebastian-lauren%c5%a3iu-plesciuc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1452237867, "creation_date": 1450949513, "last_edit_date": 1452236607, "question_id": 34450483, "link": "https://stackoverflow.com/questions/34450483/error-using-godep-on-travis-ci-automated-build-for-tip-version-of-go", "title": "Error using Godep on Travis CI automated build for tip version of Go", "body": "<p>I'm using Travis CI to automate builds and tests on my Go project.</p>\n\n<p>The <code>./Godeps/Godeps.json</code> looks like this :</p>\n\n<pre><code>{\n    \"ImportPath\": \"github.com/my_project_path\",\n    \"GoVersion\": \"go1.5\",\n    \"Packages\": [\n        \"./...\"\n    ],\n    \"Deps\": [\n        {\n            \"ImportPath\": \"github.com/Sirupsen/logrus\",\n            \"Comment\": \"v0.8.7-53-g446d1c1\",\n            \"Rev\": \"446d1c146faa8ed3f4218f056fcd165f6bcfda81\"\n        }\n    ]\n}\n</code></pre>\n\n<p>The <code>.travis.yml</code> file looks like this :</p>\n\n<pre><code>language: go\n\ngo: \n - 1.3.3\n - 1.4.2\n - 1.5.1\n - release\n - tip\n\nbefore_install:\n - go get github.com/my_project_path\n - go get github.com/tools/godep\n\ninstall:\n - godep restore\n\nscript:\n - go test -v ./...\n</code></pre>\n\n<p>All other builds work except for <code>tip</code> because of <code>go version</code>.</p>\n\n<p>The last few lines of the Travis CI log for <code>tip</code> are :</p>\n\n<pre><code>$ go version\n\ngo version devel +e4dcf5c Thu Dec 24 06:55:33 2015 +0000 linux/amd64\ngo.env\n\n$ go env\n\nGOARCH=\"amd64\"\n\nGOBIN=\"\"\n\nGOEXE=\"\"\n\nGOHOSTARCH=\"amd64\"\n\nGOHOSTOS=\"linux\"\n\nGOOS=\"linux\"\n\nGOPATH=\"/home/travis/gopath\"\n\nGORACE=\"\"\n\nGOROOT=\"/home/travis/.gimme/versions/go\"\n\nGOTOOLDIR=\"/home/travis/.gimme/versions/go/pkg/tool/linux_amd64\"\n\nGO15VENDOREXPERIMENT=\"1\"\n\nCC=\"gcc\"\n\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\n\nCXX=\"g++\"\n\nCGO_ENABLED=\"1\"\nbefore_install.1\n\n3.52s$ go get github.com/my_project_path\nbefore_install.2\n\n3.34s$ go get github.com/tools/godep\n\n0.02s$ godep restore\n\ngodep: Error determing major go version from: \"devel\"\n\nThe command \"godep restore\" failed and exited with 1 during .\n\nYour build has been stopped.\n</code></pre>\n\n<p>How can I fix this? Am I just stuck with using <code>go get ./...</code>?</p>\n\n<p><strong>EDIT:</strong> It seems someone made a <a href=\"https://github.com/tools/godep/pull/387\" rel=\"nofollow\">pull request</a> to fix this.</p>\n\n<p><strong>EDIT2:</strong> Seems the pull request <a href=\"https://github.com/tools/godep/pull/387\" rel=\"nofollow\">was merged</a>. Will test if it's fixed soonish.</p>\n"}, {"tags": ["web-applications", "go", "websocket", "webserver", "real-time"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1450944478, "post_id": 34449225, "comment_id": 56640475, "body": "That could either be implemented via <a href=\"https://godoc.org/golang.org/x/net/websocket#example-Handler\" rel=\"nofollow noreferrer\">websocket</a> or GOA (Good ol&#39; AJAX). Either way, you simply append the new data to the old."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 1, "creation_date": 1450951010, "post_id": 34449225, "comment_id": 56643157, "body": "stream can over http, but js with browser can not process http partly-received response, so websocket or make http request again and again."}], "answers": [{"tags": [], "owner": {"reputation": 1749, "user_id": 3243380, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrCc3.jpg?s=128&g=1", "display_name": "nussjustin", "link": "https://stackoverflow.com/users/3243380/nussjustin"}, "is_accepted": true, "score": 3, "last_activity_date": 1450954352, "creation_date": 1450954352, "answer_id": 34451618, "question_id": 34449225, "link": "https://stackoverflow.com/questions/34449225/go-realtime-application-heavy-writes-on-responsewriter/34451618#34451618", "title": "Go realtime application heavy writes on ResponseWriter", "body": "<p>The default <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow\">http.ResponseWriter</a> uses a <a href=\"https://golang.org/pkg/bufio/#ReadWriter\" rel=\"nofollow\">bufio.ReadWriter</a> for the underlying connection, which buffers all writes. You have to flush the buffer after every write, if you want your data to be sent as fast as possible. </p>\n\n<p>There is a <a href=\"https://golang.org/pkg/net/http/#Flusher\" rel=\"nofollow\">http.Flusher</a> interface for this in the <a href=\"https://golang.org/pkg/net/http\" rel=\"nofollow\">net/http</a> package, that is implemented by the default <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow\">http.ResponseWriter</a>.</p>\n\n<p>With this you could rewrite your example as follows:</p>\n\n<pre><code>func handler(w http.ResponseWriter, req *http.Request) {\n     switch req.Method {\n     case \"GET\":\n          for {\n              fmt.Fprintln(w, \"repeating...\")\n\n              if f, ok := w.(http.Flusher); ok {\n                  f.Flush()\n              }\n          }\n     }\n}\n</code></pre>\n\n<p>This will flush the internal buffer after every write.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 34451618, "answer_count": 1, "score": 0, "last_activity_date": 1450954352, "creation_date": 1450943490, "question_id": 34449225, "link": "https://stackoverflow.com/questions/34449225/go-realtime-application-heavy-writes-on-responsewriter", "title": "Go realtime application heavy writes on ResponseWriter", "body": "<p>I have a web application that needs to keep writing (possibly never ending) to<code>http.ResponseWriter</code>, and to display those output to html page. It's something like: </p>\n\n<pre><code>func handler(w http.ResponseWriter, req *http.Request) {\n     switch req.Method {\n         case \"GET\":\n              for {\n                  fmt.Fprintln(w, \"repeating...\")\n              }\n     }\n}\n</code></pre>\n\n<p>I feel like the HTML output does not catch up fast enough. </p>\n\n<p>If I want to keep writing on <code>http.ResponseWriter</code> and display those on HTML as fast as possible in realtime, what would be the best way to achieve this?</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1450939515, "post_id": 34448102, "comment_id": 56638790, "body": "Well, what have you tried so far? You must have at least some code. However bad it may be - we were all beginners once."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 9, "last_activity_date": 1451022343, "last_edit_date": 1451022343, "creation_date": 1450977761, "answer_id": 34456043, "question_id": 34448102, "link": "https://stackoverflow.com/questions/34448102/how-to-insert-a-json-object-array-to-mongodb-in-golang/34456043#34456043", "title": "How to insert a json object array to mongodb in golang", "body": "<p><a href=\"https://godoc.org/encoding/json#Unmarshal\" rel=\"noreferrer\">Unmarshal</a> the JSON to []interface{} and <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Insert\" rel=\"noreferrer\">insert</a> the result in the database. Assuming that <code>c</code> is an <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection\" rel=\"noreferrer\">mgo.Collection</a> and <code>data</code> is a []byte containing the JSON value, use the following code:</p>\n\n<pre><code>var v []interface{}\nif err := json.Unmarshal(data, &amp;v); err != nil {\n   // handle error\n}\nif err := c.Insert(v...); err != nil {\n   // handle error\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 11760849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4278e8e75a2ce394a85988fd72871d9?s=128&d=identicon&r=PG&f=1", "display_name": "Srikanth Reddy", "link": "https://stackoverflow.com/users/11760849/srikanth-reddy"}, "is_accepted": false, "score": 1, "last_activity_date": 1563905842, "last_edit_date": 1563905842, "creation_date": 1563905375, "answer_id": 57169961, "question_id": 34448102, "link": "https://stackoverflow.com/questions/34448102/how-to-insert-a-json-object-array-to-mongodb-in-golang/57169961#57169961", "title": "How to insert a json object array to mongodb in golang", "body": "<p>If you have json data already please follow from step 2.</p>\n\n<p>If you have Xml data first you need to convert to the json format by using this package(\"github.com/basgys/goxml2json\")</p>\n\n<pre><code> type JsonFileResponse struct {\n    JsonData string        `bson:\"JsonData \" json:\"JsonData\"`\n}\n\nstep 1: jsonData, err := xml2json.Convert(xml)\n        if err != nil {\n            panic(\"getting error while converting xml to json\",err)\n        }\n\nstep 2: session need to open by using your mongodb credentials.\n\n    collection := session.DB(\"database name\").C(\"Collection Name\")\n    err = collection.Insert(JsonFileResponse{JsonData :json.String()})\n    if err != nil {\n        log.Fatal(err)\n    } \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 47, "user_id": 8821437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cc46aa9952ed8530c6df592955204be?s=128&d=identicon&r=PG&f=1", "display_name": "quine9997", "link": "https://stackoverflow.com/users/8821437/quine9997"}, "is_accepted": false, "score": 1, "last_activity_date": 1614534857, "creation_date": 1614534857, "answer_id": 66412181, "question_id": 34448102, "link": "https://stackoverflow.com/questions/34448102/how-to-insert-a-json-object-array-to-mongodb-in-golang/66412181#66412181", "title": "How to insert a json object array to mongodb in golang", "body": "<p>In this example I will store the mixed array</p>\n<p>test_string := <code>'[[1,&quot;a&quot;,&quot;b&quot;,2,&quot;000000&quot;,[[1,2,3],[1,2,3]],&quot;\\&quot;x&quot;,&quot;[y&quot;,&quot;'z&quot;,[[1,2,3],[1,2,3]]]]'</code></p>\n<p>into the mongodb as the json:</p>\n<p><code>{datum: [[1,&quot;a&quot;,&quot;b&quot;,2,&quot;000000&quot;,[[1,2,3],[1,2,3]],&quot;\\&quot;x&quot;,&quot;[y&quot;,&quot;'z&quot;,[[1,2,3],[1,2,3]]]]}</code></p>\n<pre><code>package main\n\nimport (\n    &quot;strings&quot;\n    &quot;context&quot;\n    &quot;encoding/json&quot;\n    &quot;fmt&quot;\n    &quot;log&quot;\n    &quot;net/http&quot;\n    \n    &quot;go.mongodb.org/mongo-driver/bson&quot;\n    &quot;go.mongodb.org/mongo-driver/bson/primitive&quot;\n)\n\n\n\ntype datum2 struct {\n    Datum interface{} `json:datum`\n}\n\n\n\n\n\nvar userCollection = db().Database(&quot;goTest&quot;).Collection(&quot;users&quot;) // get collection &quot;users&quot; from db() which returns *mongo.Client\n\nfunc typeinterface2mongo() {\n    \n    \n    var datum2 datum2_instance\n    var interfacevalue []interface{}\n    \n    test_string := `[[1,&quot;a&quot;,&quot;b&quot;,2,&quot;000000&quot;,[[1,2,3],[1,2,3]],&quot;\\&quot;x&quot;,&quot;[y&quot;,&quot;'z&quot;,[[1,2,3],[1,2,3]]]]`\n    if err := json.Unmarshal([]byte(test_string), &amp;interfacevalue); err != nil {\n        fmt.Println(err)\n        return\n    }\n    \n    fmt.Println(test_string)\n    fmt.Println(interfacevalue)\n    datum2_instance.Datum=interfacevalue\n    userCollection.InsertOne(context.TODO(), datum2_instance)\n    fmt.Println(datum2_instance)\n    fmt.Println(datum2_instance.Datum)  \n}\n\n\n</code></pre>\n"}], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5511, "favorite_count": 2, "accepted_answer_id": 34456043, "answer_count": 3, "score": 1, "last_activity_date": 1614534857, "creation_date": 1450937225, "last_edit_date": 1450937777, "question_id": 34448102, "link": "https://stackoverflow.com/questions/34448102/how-to-insert-a-json-object-array-to-mongodb-in-golang", "title": "How to insert a json object array to mongodb in golang", "body": "<p>My json looks like the following,</p>\n\n<pre><code>[\n  {\n    \"key1\": 1,\n    \"key2\": \"val2\"\n  },\n  {\n    \"key1\": 2,\n    \"key2\": \"val2\"\n  }\n]\n</code></pre>\n\n<p>This json comes in string format and I want the objects in the json array to be inserted as individual records in mongodb. I referred to <a href=\"https://labix.org/mgo\" rel=\"nofollow\">https://labix.org/mgo</a> but wasn't able to find enough examples on the above use-case. Appreciate your thoughts in finding a solution.</p>\n"}, {"tags": ["go", "smtp"], "comments": [{"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 1, "creation_date": 1450934443, "post_id": 34447276, "comment_id": 56637221, "body": "The first link you&#39;ve given says that you need to set up SPF records to use the aspmx mail server.  It might be better to use your company or ISP&#39;s local mail server as a relay for your messages rather than sending to Google directly."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 3, "creation_date": 1450935440, "post_id": 34447276, "comment_id": 56637495, "body": "The IP in your error indicates you&#39;re sending from Amazon EC2. Since anyone, anywhere can get an EC2 instance, many automated filters are suspicious that messages they send might be spam. Amazon&#39;s approach to this is to offer <a href=\"https://aws.amazon.com/ses/\" rel=\"nofollow noreferrer\">Simple E-mail Service</a>, though there are other e-mail sending providers as well."}], "owner": {"reputation": 1, "user_id": 4698681, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-NcSs_LYcTeo/AAAAAAAAAAI/AAAAAAAAACM/x4M1Ycnn1JI/photo.jpg?sz=128", "display_name": "Troubler", "link": "https://stackoverflow.com/users/4698681/troubler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 347, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1450931568, "creation_date": 1450931568, "question_id": 34447276, "link": "https://stackoverflow.com/questions/34447276/golang-sending-email-without-authority", "title": "Golang sending email without authority", "body": "<p>I am writing a golang program to send a email to my gmail account to report some problem. \nHere is my code:</p>\n\n<pre><code>c, err := smtp.Dial(\"aspmx.l.google.com:25\")\nif err != nil {\n    log.Fatal(\"dial err \", err)\n}\n\nif err := c.Mail(\"report@mbytetech.com\"); err != nil {\n    log.Fatal(\"Mail err \", err)\n}\nif err := c.Rcpt(\"zing.luke@gmail.com\"); err != nil {\n    log.Fatal(\"Rcpt err \", err)\n}\nwc, err := c.Data()\nif err != nil {\n    log.Fatal(\"Data err \", err)\n}\n_, err = fmt.Fprintln(wc, \"In your face, Neil Armstrong\")\nif err != nil {\n    log.Fatal(\"writer err \", err)\n}\nerr = wc.Close()\nif err != nil {\n    // log.Fatal(err)\n    fmt.Print(err)\n    return\n}\nerr = c.Quit()\nif err != nil {\n    log.Fatal(\"quit err \", err)\n}\n</code></pre>\n\n<p>I don't actually have a email account as \"report@mbytetech.com\"(But I do have a gmail account \"zing.luke@gmail.com\"). I just want it to be shown as \"sender\" in the email. And my boss told me that he doesn't want to really create a email account to do the \"send\" work.</p>\n\n<p>Evertime I run this program, it always give me an error said \"421 4.7.0 [54.176.117.9      15] Our system has detected an unusual rate of...\". And I never got a email in my inbox. </p>\n\n<p>I look up the <a href=\"https://support.google.com/a/answer/176600?hl=en\" rel=\"nofollow\">Google smtp server</a> and <a href=\"https://support.google.com/mail/answer/81126\" rel=\"nofollow\">Google bulk mail</a>. But I just can't find any solution.</p>\n\n<p>Please someone help me out, I really appreciate that!</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-storage"], "answers": [{"comments": [{"owner": {"reputation": 3730, "user_id": 464064, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5b106b3ab0dfec1dcc591dd7b8d309fb?s=128&d=identicon&r=PG", "display_name": "John F.", "link": "https://stackoverflow.com/users/464064/john-f"}, "edited": false, "score": 0, "creation_date": 1450970320, "post_id": 34449320, "comment_id": 56651202, "body": "Thanks Todd! I&#39;ve been going through your material and I see that the cloud/storage lib has been updated. In your examples, you&#39;re using storage.NewWriter() which now doesn&#39;t exist. Have you been able to store objects locally? I recall with the Python runtime, objects were stored in the blobstore to simulate uploading to GCS. Does the Go runtime have this? Ideally, I&#39;d like to not store test data to a real bucket."}, {"owner": {"reputation": 152, "user_id": 5660064, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Q0D4N3-5iEE/AAAAAAAAAAI/AAAAAAAALB4/Lv6t4v1ANRg/photo.jpg?sz=128", "display_name": "Todd McLeod", "link": "https://stackoverflow.com/users/5660064/todd-mcleod"}, "reply_to_user": {"reputation": 3730, "user_id": 464064, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5b106b3ab0dfec1dcc591dd7b8d309fb?s=128&d=identicon&r=PG", "display_name": "John F.", "link": "https://stackoverflow.com/users/464064/john-f"}, "edited": false, "score": 0, "creation_date": 1450996226, "post_id": 34449320, "comment_id": 56658857, "body": "Storing test data to a real bucket was the only way I found to do it. I&#39;m disappointed to here NewWriter is deprecated!"}], "tags": [], "owner": {"reputation": 152, "user_id": 5660064, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Q0D4N3-5iEE/AAAAAAAAAAI/AAAAAAAALB4/Lv6t4v1ANRg/photo.jpg?sz=128", "display_name": "Todd McLeod", "link": "https://stackoverflow.com/users/5660064/todd-mcleod"}, "is_accepted": true, "score": 2, "last_activity_date": 1450944010, "creation_date": 1450944010, "answer_id": 34449320, "question_id": 34447124, "link": "https://stackoverflow.com/questions/34447124/using-google-cloud-storage-with-golang-on-appengine/34449320#34449320", "title": "Using Google Cloud Storage with Golang on Appengine", "body": "<p>I struggled getting GCS to work with app engine also. I encountered conflicting documentation between using PEM and JSON keys. I put <a href=\"https://docs.google.com/presentation/d/14NA_G-Wv5aTrRYqti5HIt3oie-wXLBSkkAt3ljEO2y0/edit?usp=sharing\" rel=\"nofollow\">this presentation</a> together to discuss this issue and teach people how to use GCS with app engine.</p>\n\n<p>I was able to get GCS working with app engine. Here is <a href=\"https://github.com/GoesToEleven/GolangTraining/tree/master/59_appengine-GCS-storage\" rel=\"nofollow\">working GCS app engine code</a>.</p>\n\n<p>I also gave a talk detailing all of this - there are two or three videos in <a href=\"https://www.youtube.com/playlist?list=PLSak_q1UXfPp2VwUQ4ZdUVJdMO6pfi5v_\" rel=\"nofollow\">this playlist</a> detailing GCS and app engine.</p>\n"}], "owner": {"reputation": 3730, "user_id": 464064, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5b106b3ab0dfec1dcc591dd7b8d309fb?s=128&d=identicon&r=PG", "display_name": "John F.", "link": "https://stackoverflow.com/users/464064/john-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 861, "favorite_count": 1, "accepted_answer_id": 34449320, "answer_count": 1, "score": 3, "last_activity_date": 1450944010, "creation_date": 1450930150, "question_id": 34447124, "link": "https://stackoverflow.com/questions/34447124/using-google-cloud-storage-with-golang-on-appengine", "title": "Using Google Cloud Storage with Golang on Appengine", "body": "<p>I have been struggling with understanding how to properly use GCS on the App Engine using Go. I've read a few stack posts mentioning that the Go App Engine Development Server does not emulate the GCS. <strong>Is this still the case?</strong> I have been able to store objects to my actual default GCS when I construct my client using this code:</p>\n\n<pre><code>ctx := appengine.NewContext(r)\n    jsonKey, err := ioutil.ReadFile(\"path/to/json.json\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    conf, err := google.JWTConfigFromJSON(\n        jsonKey,\n        storage.ScopeFullControl,\n    )\n    if err != nil {\n        log.Fatal(err)\n    }\n    client, err := storage.NewClient(ctx, cloud.WithTokenSource(conf.TokenSource(ctx)))\n</code></pre>\n\n<p>Is this the preferred way of working with cloud storage on the App Engine?</p>\n\n<p>I ask because I'm confused why some of the sample app engine code does not work properly. For instance, I was attempting to follow the code in this example (<a href=\"https://github.com/GoogleCloudPlatform/gcloud-golang/blob/master/examples/storage/appengine/app.go#L73\" rel=\"nofollow\">https://github.com/GoogleCloudPlatform/gcloud-golang/blob/master/examples/storage/appengine/app.go#L73</a>). You'll notice that building the storage client simply uses</p>\n\n<pre><code>client, err := storage.NewClient(ctx)\n</code></pre>\n\n<p>Using this sample code I get a <code>googleapi: Error 401: Invalid Credentials, authError</code> error. Is this an error or am I doing something wrong? Which way should I be accessing cloud storage from a Go app engine application?</p>\n"}]