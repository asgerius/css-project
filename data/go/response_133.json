[{"tags": ["http", "go", "dynamic", "go-html-template"], "comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501113063, "post_id": 45338830, "comment_id": 77640320, "body": "I think the best you can do is serve a redirect page with a &quot;please wait&quot; message, but I&#39;m not a HTTP expert..."}], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 2, "last_activity_date": 1501117345, "creation_date": 1501117345, "answer_id": 45339705, "question_id": 45338830, "link": "https://stackoverflow.com/questions/45338830/golang-display-static-html-template-while-waiting-for-data-to-load/45339705#45339705", "title": "Golang display static HTML template while waiting for data to load", "body": "<p>No, the best way is to serve the template then populate it using ajax calls to an endpoint that returns json with the data you want to use.</p>\n"}], "owner": {"reputation": 229, "user_id": 7577639, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/83742b0839d8c143ff46a32dbda80909?s=128&d=identicon&r=PG&f=1", "display_name": "Evan Hessler", "link": "https://stackoverflow.com/users/7577639/evan-hessler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 567, "favorite_count": 0, "accepted_answer_id": 45339705, "answer_count": 1, "score": 0, "last_activity_date": 1501196792, "creation_date": 1501110397, "last_edit_date": 1501196792, "question_id": 45338830, "link": "https://stackoverflow.com/questions/45338830/golang-display-static-html-template-while-waiting-for-data-to-load", "title": "Golang display static HTML template while waiting for data to load", "body": "<p>I have a route set up which responds with a dynamic HTML template.</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"html/template\"\n)\n\nfunc index(w http.ResponseWriter, r *http.Request) {\n    showWwResult, _ := GetWw()\n    showHoursResult, _ := GetHours()\n\n    type Data struct {\n        ShowWwResult   []IssueResult\n        ShowHoursResult Page\n    }\n\n    data := Data{showWwResult, showHoursResult}\n\n    var templates = template.Must(template.ParseFiles(\"templates/index.html\", \"templates/ww.html\", \"templates/hours.html\"))\n    templates.ExecuteTemplate(w, \"indexPage\", data)\n}\n</code></pre>\n\n<p>My problem is, it takes a very long time to gather the data and the page waits for this to return before rendering the HTML. </p>\n\n<p>How can I get it to return <em>something</em>, anything, while I wait for <code>GetWw()</code> and <code>GetHours()</code> to finish? Is there any way to display the static part of my HTML template and then populate the page with <code>ShowWwResult</code> and <code>ShowHoursResult</code> when they're ready?</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501105203, "post_id": 45337881, "comment_id": 77637760, "body": "You are using an unbuffered channel. Make your chan with <code>make(chan string, 10)</code> or however many you want to buffer."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501105533, "post_id": 45337881, "comment_id": 77637901, "body": "Actually, that isn&#39;t the problem. In your loop you are calling <code>go sendUser</code>, but then immediately waiting for it in the loop after it. <code>for</code> loop all the <code>go sendUser</code> calls first, then loop again for the rest of your logic there."}, {"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501105788, "post_id": 45337881, "comment_id": 77638002, "body": "@RayfenWindspear But wouldn&#39;t that cause deadlocks because channel is is only of 1 buffer and if I am putting the &quot;select&quot; statement outside the loop then How one buffer will going to hold all the responses from the requests?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501106207, "post_id": 45337881, "comment_id": 77638166, "body": "That&#39;s the beauty of it, the channel doesn&#39;t need to hold any. An unbuffered channel essentially holds nothing, it passes it directly to the routine waiting to receive it. You don&#39;t care if all 100 or 1000 goroutines block on <code>ch &lt;- resp</code>. They have already done the io portion (<code>http.get</code>) that takes the most time. Now you can use the responses one at a time. Or you could use more goroutines to use the responses faster if you want."}, {"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501106634, "post_id": 45337881, "comment_id": 77638369, "body": "@RayfenWindspear&quot;or you could use more goroutines to use the responses faster if you want&quot;. Can you explain it little more?How can I achieve it ?  Is there a better way  rather than  doing if len(responses) == len(users)"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501106828, "post_id": 45337881, "comment_id": 77638458, "body": "and there you go, a perfect example by reticentroot"}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1501107149, "post_id": 45338208, "comment_id": 77638600, "body": "Nice. Just one more comment about running concurrent io. Be aware of how much memory is involved with a single request. It&#39;s easy to get carried away with how easy it is to run thousands of goroutines, but if each request object ends up taking 1MB of memory, you are in the GB range with thousands. You can rate limit by using buffered channels."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1501107233, "post_id": 45338208, "comment_id": 77638632, "body": "@rayfenwindspear I total agree I think in production I&#39;d be running this with a semaphore to limit requests and even memory checking."}, {"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "edited": false, "score": 0, "creation_date": 1501108264, "post_id": 45338208, "comment_id": 77639037, "body": "@reticentroot @ RayfenWindspear Thanks guys.How does buffered channels helps in rate limiting? If i understand it correctly then, this loop  for _, user = range users {         wg.Add(1)         go sendUser(user, ch, &amp;wg)     }     is spinning number of goroutines=range of  users.How does buffering would help in this case?How can I  Iimit that only sane number of workers spun up and return it to channel and then take over rest of the jobs?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1501108843, "post_id": 45338208, "comment_id": 77639224, "body": "A buffer channel acts like a bucket with a queue, where it would block if that bucket become full. So for example if the limit were ten only ten goroutines would spin up, one item is consumed from the bucket another channel is sent. First in first out. Let&#39;s say that you have 100 urls. At most only 10 could be processed at the same time VS spinning up 100 goroutines"}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 8, "last_activity_date": 1501106707, "creation_date": 1501106707, "answer_id": 45338208, "question_id": 45337881, "link": "https://stackoverflow.com/questions/45337881/go-routinemaking-concurrent-api-requests/45338208#45338208", "title": "Go routine:Making concurrent API requests", "body": "<p>I might do something like this..</p>\n\n<pre><code>func sendUser(user string, ch chan&lt;- string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    resp, err := http.Get(\"URL/\" + user)\n    if err != nil {\n        log.Println(\"err handle it\")\n    }\n    defer resp.Body.Close()\n    b, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Println(\"err handle it\")\n    }\n    ch &lt;- string(b)\n}\n\nfunc AsyncHTTP(users []string) ([]string, error) {\n    ch := make(chan string)\n    var responses []string\n    var user string\n    var wg sync.WaitGroup\n    for _, user = range users {\n        wg.Add(1)\n        go sendUser(user, ch, &amp;wg)\n    }\n\n    // close the channel in the background\n    go func() {\n        wg.Wait()\n        close(ch)\n    }()\n    // read from channel as they come in until its closed\n    for res := range ch {\n        responses = append(responses, res)\n    }\n\n    return responses, nil\n}\n</code></pre>\n\n<p>It allows to read from the channel as they are sent.  By using a waitgroup I'll know when to close the channel. By putting the waitgroup and close in a goroutine I can read from the channel in \"realtime\" without blocking.</p>\n"}], "owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6725, "favorite_count": 1, "accepted_answer_id": 45338208, "answer_count": 1, "score": 2, "last_activity_date": 1501106707, "creation_date": 1501105114, "last_edit_date": 1501106690, "question_id": 45337881, "link": "https://stackoverflow.com/questions/45337881/go-routinemaking-concurrent-api-requests", "title": "Go routine:Making concurrent API requests", "body": "<p>I am trying to understand channels and goroutines and tried to write a goroutine for making concurrent API requests to the server</p>\n\n<p>But when I am running the code using a goroutine, it seems like it is taking the same time as it does without a goroutine.</p>\n\n<pre><code>func sendUser(user string, ch chan&lt;- string)  {\n    resp,err := http.get(\"URL\"/user)\n    //do the processing and get resp=string\n    ch &lt;- resp\n}\n\n\nfunc AsyncHTTP(users []string) ([]string, error) {\n    ch := make(chan string)\n    var responses []string\n    var user string\n\n    for _ , user = range users {\n        go sendUser(user, ch)\n\n        for {\n            select {\n            case r := &lt;-ch:\n                if r.err != nil {\n                    fmt.Println(r.err)\n                }\n                responses = append(responses, r)\n                **//Is there a better way to show that the processing of response is complete**?\n                if len(responses) == len(users) { \n                    return responses, nil\n                }\n            case &lt;-time.After(50 * time.Millisecond):\n                fmt.Printf(\".\")\n            }\n        }\n    }\n    return responses, nil\n}\n</code></pre>\n\n<p>Questions:</p>\n\n<ol>\n<li><p>Even though I am using a goroutine, request completion time is same as it is without goroutines? Is there anything I am doing wrong with goroutines?</p></li>\n<li><p>For telling the job not to wait anymore here I am using:</p>\n\n<pre><code>if len(responses) == len(users)\n</code></pre>\n\n<p>Is there a better way to show that the processing of response is complete and tell ch not to wait anymore?</p></li>\n<li><p>What is wait.Syncgroup? How can I use it in my goroutine?</p></li>\n</ol>\n"}, {"tags": ["go", "amazon-s3", "character-encoding"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 3, "creation_date": 1501103508, "post_id": 45337471, "comment_id": 77637027, "body": "Correct me if I&#39;m wrong, but aren&#39;t S3 keys supposed to be URL encoded? Perhaps try <a href=\"https://godoc.org/net/url#QueryEscape\" rel=\"nofollow noreferrer\">godoc.org/net/url#QueryEscape</a>  This is a non-go document, but here is a resource. <a href=\"https://forums.aws.amazon.com/thread.jspa?threadID=215813\" rel=\"nofollow noreferrer\">forums.aws.amazon.com/thread.jspa?threadID=215813</a>  And yes, I googled that and it was the first result...."}, {"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501105152, "post_id": 45337471, "comment_id": 77637749, "body": "Good to know. I don&#39;t have control over the original key names. How can I use QueryEscape to help me?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1501105309, "post_id": 45337471, "comment_id": 77637804, "body": "I may have jumped the gun, you might need to <code>QueryUnescape</code> the strings to get the keys, as they are already escaped. Had it backwards. My bad."}, {"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501105458, "post_id": 45337471, "comment_id": 77637870, "body": "<code>QueryUnescape</code> gives me the key with space in place of <code>+</code>, but I still get the error <code>NoSuchKey: The specified key does not exist.</code>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501106968, "post_id": 45337471, "comment_id": 77638518, "body": "Strange... one of them should work."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1501684102, "post_id": 45337471, "comment_id": 77887892, "body": "Interesting: you can post an asnwer and accept it (with more details than just the list to the issue)"}], "answers": [{"comments": [{"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "edited": false, "score": 0, "creation_date": 1501307880, "post_id": 45385641, "comment_id": 77732660, "body": "I will try <code>:</code> and let you know."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1501306101, "creation_date": 1501306101, "answer_id": 45385641, "question_id": 45337471, "link": "https://stackoverflow.com/questions/45337471/how-to-list-and-copy-s3-keys-with-non-alphanumeric-characters/45385641#45385641", "title": "How to list and copy s3 keys with non alphanumeric characters?", "body": "<p>The <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingMetadata.html\" rel=\"nofollow noreferrer\">object key and metadata document</a> is clear:</p>\n\n<blockquote>\n  <p>The following character sets are generally safe for use in key names:</p>\n  \n  <ul>\n  <li>Alphanumeric characters <code>[0-9a-zA-Z]</code></li>\n  <li>Special characters <code>!</code>, <code>-</code>, <code>_</code>, <code>.</code>, <code>*</code>, <code>'</code>, <code>(</code>, and <code>)</code></li>\n  </ul>\n</blockquote>\n\n<p>Not only + would be converted into space with, but, from the section \"Characters That Might Require Special Handling\" of the same page, '<code>:</code>' should also be converted back from space, which <a href=\"https://golang.org/pkg/net/url/#QueryEscape\" rel=\"nofollow noreferrer\"><code>QueryUnescape</code></a> does not do (it only convert space back to <code>+</code>).</p>\n\n<p>Check if your keys include other special characters to be handled with care, like <code>:</code> (also replaced by space), <code>@</code> or <code>=</code> (replaced by <code>;</code>), or <code>,</code> and <code>?</code>.</p>\n\n<p>Check in particular if the key obtained from <code>QueryUnescape</code> has a + instead of a '<code>:</code>' in the original key: that could be a space incorrectly \"unescaped\".</p>\n"}, {"tags": [], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "is_accepted": true, "score": 0, "last_activity_date": 1501686600, "creation_date": 1501686600, "answer_id": 45464607, "question_id": 45337471, "link": "https://stackoverflow.com/questions/45337471/how-to-list-and-copy-s3-keys-with-non-alphanumeric-characters/45464607#45464607", "title": "How to list and copy s3 keys with non alphanumeric characters?", "body": "<p>This details what was happening: <a href=\"https://github.com/aws/aws-sdk-go/issues/1438\" rel=\"nofollow noreferrer\">https://github.com/aws/aws-sdk-go/issues/1438</a></p>\n\n<ol>\n<li>The main issue was that <code>CopySource</code> needs to be url-encoded and <em>not</em> the <code>Key</code> field, which was surprising to me. (I was url-encoding both.)</li>\n<li>The other issue was that I was using <code>path.Join</code> which strips out trailing <code>\\</code>. This is a problem because s3 keys can have trailing <code>\\</code> - which represents a sort of folder.</li>\n</ol>\n"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 427, "favorite_count": 2, "accepted_answer_id": 45464607, "answer_count": 2, "score": 4, "last_activity_date": 1501686600, "creation_date": 1501103310, "last_edit_date": 1501683124, "question_id": 45337471, "link": "https://stackoverflow.com/questions/45337471/how-to-list-and-copy-s3-keys-with-non-alphanumeric-characters", "title": "How to list and copy s3 keys with non alphanumeric characters?", "body": "<p>I have code which lists keys using <code>ListObjectsPages</code>-><code>Contents</code>-><code>Key</code> and copies those keys using <code>CopyObject</code>. This works in general but for some keys it's complaining <code>NoSuchKey: The specified key does not exist.</code> The set of keys it's complaining about include keys with <code>+</code>.</p>\n\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.ListObjectsPages\" rel=\"nofollow noreferrer\"><code>ListObjectsPages</code></a> returns key \"foo+bar\".</li>\n<li><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.CopyObject\" rel=\"nofollow noreferrer\"><code>CopyObject</code></a> on \"foo+bar\" gives the <code>NoSuchKey</code> error.</li>\n<li><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.CopyObject\" rel=\"nofollow noreferrer\"><code>CopyObject</code></a> on \"foo bar\" (unescaped) gives the <code>NoSuchKey</code> error.</li>\n</ul>\n\n<p>Oddly, if I use the CLI: <code>aws s3 cp</code> on \"foo+bar\", the copy works. But I can't use the CLI. I need to use the sdk.</p>\n\n<p>I'm using <a href=\"https://github.com/aws/aws-sdk-go/releases/tag/v1.8.11\" rel=\"nofollow noreferrer\">v1.8.11</a></p>\n\n<p>As Rayfen mentioned, the plus characters could be the result of space replacement.</p>\n\n<p>Update:\nEverything was hashed out here <a href=\"https://github.com/aws/aws-sdk-go/issues/1438\" rel=\"nofollow noreferrer\">https://github.com/aws/aws-sdk-go/issues/1438</a>. Rayfen was right about needing to <code>QueryEscape</code>. I'm going to award the only current answer with the bounty since it adds useful information, but not select it as correct.</p>\n"}, {"tags": ["go", "code-coverage"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1501102763, "post_id": 45337291, "comment_id": 77636629, "body": "Test coverage is only for one package."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1501103093, "post_id": 45337291, "comment_id": 77636811, "body": "Though there is <a href=\"https://github.com/wadey/gocovmerge\" rel=\"nofollow noreferrer\">gocovmerge</a> to help with that."}, {"owner": {"reputation": 1609, "user_id": 1307284, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a26e95e08a4dc11c43be0002b4991bca?s=128&d=identicon&r=PG", "display_name": "Amir Keibi", "link": "https://stackoverflow.com/users/1307284/amir-keibi"}, "edited": false, "score": 0, "creation_date": 1501103319, "post_id": 45337291, "comment_id": 77636931, "body": "&quot;Test coverage is only for one package&quot;.. How that package is chosen? Why in my case it&#39;s the &quot;impl&quot; and not &quot;api&quot;?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501103447, "post_id": 45337291, "comment_id": 77636998, "body": "@AmirKeibi: the package is chosen by the one you&#39;re testing. You can only run <code>go test</code> on a single package at a time, and only one package&#39;s <code>_test.go</code> files are compiled at a time."}, {"owner": {"reputation": 1609, "user_id": 1307284, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a26e95e08a4dc11c43be0002b4991bca?s=128&d=identicon&r=PG", "display_name": "Amir Keibi", "link": "https://stackoverflow.com/users/1307284/amir-keibi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501104578, "post_id": 45337291, "comment_id": 77637521, "body": "@JimB I understand, but the test code is neither in &quot;impl&quot; package nor &quot;api&quot;. Are you saying that the test functions in &quot;impl_test&quot; package are treated as part of &quot;impl&quot; package?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501105351, "post_id": 45337291, "comment_id": 77637823, "body": "@AmirKeibi: I&#39;m not sure what you&#39;re seeing without an example and how you&#39;re invoking the command. Exactly what command are you running on which package?"}, {"owner": {"reputation": 1609, "user_id": 1307284, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a26e95e08a4dc11c43be0002b4991bca?s=128&d=identicon&r=PG", "display_name": "Amir Keibi", "link": "https://stackoverflow.com/users/1307284/amir-keibi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501106527, "post_id": 45337291, "comment_id": 77638320, "body": "@JimB I&#39;m using &quot;goconvey&quot; which runs the tests in every package and spit out a HTML report."}, {"owner": {"reputation": 1609, "user_id": 1307284, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a26e95e08a4dc11c43be0002b4991bca?s=128&d=identicon&r=PG", "display_name": "Amir Keibi", "link": "https://stackoverflow.com/users/1307284/amir-keibi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501107747, "post_id": 45337291, "comment_id": 77638840, "body": "@JimB this looks like a tooling issue. Apparently I need to explicitly tell goconvey to measure both &quot;api&quot; and &quot;impl&quot; packages with that test."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501158795, "post_id": 45337291, "comment_id": 77662730, "body": "Yes, it would help if you mention that you are using a different tool to get test coverage."}, {"owner": {"reputation": 1609, "user_id": 1307284, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a26e95e08a4dc11c43be0002b4991bca?s=128&d=identicon&r=PG", "display_name": "Amir Keibi", "link": "https://stackoverflow.com/users/1307284/amir-keibi"}, "edited": false, "score": 0, "creation_date": 1501186437, "post_id": 45337291, "comment_id": 77681728, "body": "Right, that&#39;s my bad. I assumed certain things about the tool which I shouldn&#39;t have."}], "answers": [{"tags": [], "owner": {"reputation": 1609, "user_id": 1307284, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a26e95e08a4dc11c43be0002b4991bca?s=128&d=identicon&r=PG", "display_name": "Amir Keibi", "link": "https://stackoverflow.com/users/1307284/amir-keibi"}, "is_accepted": false, "score": 0, "last_activity_date": 1501186542, "creation_date": 1501186542, "answer_id": 45360263, "question_id": 45337291, "link": "https://stackoverflow.com/questions/45337291/go-test-misses-coverage-along-the-execution-path/45360263#45360263", "title": "go test misses coverage along the execution path", "body": "<p>In case someone using goconvey land in this question, this is an issue with the tool:</p>\n\n<p><a href=\"https://github.com/smartystreets/goconvey/issues/491\" rel=\"nofollow noreferrer\">https://github.com/smartystreets/goconvey/issues/491</a></p>\n"}], "owner": {"reputation": 1609, "user_id": 1307284, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a26e95e08a4dc11c43be0002b4991bca?s=128&d=identicon&r=PG", "display_name": "Amir Keibi", "link": "https://stackoverflow.com/users/1307284/amir-keibi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1501186542, "creation_date": 1501102660, "question_id": 45337291, "link": "https://stackoverflow.com/questions/45337291/go-test-misses-coverage-along-the-execution-path", "title": "go test misses coverage along the execution path", "body": "<p>Consider a file structure like this:</p>\n\n<pre><code>api --\n     |_ routes.go\n     |_ handler.go\nimpl--\n     |_ impl.go\n     |_ impl_test.go\n</code></pre>\n\n<p>The \"impl\" file contains internal implementation of REST APIs for which the handlers and routes are in \"handler.go\" and \"route.go\" files respectively.</p>\n\n<p>As far as packaging goes, everything under \"api\" folder is in the \"api\" package. The code in \"impl.go\" is in \"impl\" package and the code in \"impl_test\" package is in \"impl_test\" package.</p>\n\n<pre><code>api -------\n           |_ routes\n           |_ handler functions\nimpl-------\n           |_ impl functions\nimpl_test--\n           |_ test functions\n</code></pre>\n\n<p>The test function starts a HTTP server listening to a local open port using the routes and handlers in the \"api\" package and then call the APIs.</p>\n\n<p>However, the coverage report shows 0% coverage for the code in the \"api\" package and non-zero% for \"impl\".</p>\n\n<p>Can someone please explain why the coverage is measured for one package and not the other? And whether there is way to fix this?</p>\n"}, {"tags": ["go", "command-line-interface"], "comments": [{"owner": {"reputation": 1592, "user_id": 703061, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7db295545ff40053c8d7f062167395ef?s=128&d=identicon&r=PG&f=1", "display_name": "wayfare", "link": "https://stackoverflow.com/users/703061/wayfare"}, "edited": false, "score": 0, "creation_date": 1501095513, "post_id": 45335327, "comment_id": 77632604, "body": "to run this you will need to install termui go get -u github.com/gizak/termui"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501095604, "post_id": 45335327, "comment_id": 77632654, "body": "if they didn&#39;t have termui it wouldn&#39;t have compiled at all. That&#39;s not the issue they&#39;re describing."}, {"owner": {"reputation": 1592, "user_id": 703061, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7db295545ff40053c8d7f062167395ef?s=128&d=identicon&r=PG&f=1", "display_name": "wayfare", "link": "https://stackoverflow.com/users/703061/wayfare"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501096082, "post_id": 45335327, "comment_id": 77632904, "body": "my bad, I commented on my question itself. I should have written it in the description."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1501096233, "post_id": 45335327, "comment_id": 77632986, "body": "My own fault for not comparing usernames - you don&#39;t need to specify that anyway, it&#39;s already indicated by <code>github.com&#47;gizak&#47;termui</code> being in the imports."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501101823, "post_id": 45335327, "comment_id": 77636117, "body": "First off, you aren&#39;t using <code>termui</code> correctly. You aren&#39;t even calling <code>termui.Loop</code> which is supposed to do the looping, not you. Because the event loop is never started, of course the event handler will never fire."}], "answers": [{"comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1501114907, "post_id": 45337334, "comment_id": 77640746, "body": "select is no ordered, FYI.  Also, I would suggest using context.Context.WithCancel instead of a chan struct[} since you may want to propagate stops to child goroutines."}, {"owner": {"reputation": 1592, "user_id": 703061, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7db295545ff40053c8d7f062167395ef?s=128&d=identicon&r=PG&f=1", "display_name": "wayfare", "link": "https://stackoverflow.com/users/703061/wayfare"}, "edited": false, "score": 0, "creation_date": 1501168641, "post_id": 45337334, "comment_id": 77671096, "body": "Thanks @RayfenWindspear. It worked as you suggested."}, {"owner": {"reputation": 1592, "user_id": 703061, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7db295545ff40053c8d7f062167395ef?s=128&d=identicon&r=PG&f=1", "display_name": "wayfare", "link": "https://stackoverflow.com/users/703061/wayfare"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1501168705, "post_id": 45337334, "comment_id": 77671131, "body": "@sberry can you please point to me some example how to use context.Context ? I am new to golang and would love to do my thing in a proper way."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1501169604, "post_id": 45337334, "comment_id": 77671739, "body": "The new context stuff is new as of 1.8, so I haven&#39;t used it other than when I&#39;ve seen it used in libraries."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 1, "last_activity_date": 1501102797, "creation_date": 1501102797, "answer_id": 45337334, "question_id": 45335327, "link": "https://stackoverflow.com/questions/45335327/how-to-exit-from-my-go-code-using-go-routines-and-term-ui/45337334#45337334", "title": "How to exit from my go code using go routines and term ui", "body": "<p>This is possibly the answer you are looking for. First off, you aren't using <code>termui</code> correctly. You need to call it's <code>Loop</code> function to start the <code>Event</code> loop so that it can actually start listening for the <code>q</code> key. <code>Loop</code> is called last because it essentially takes control of the main goroutine from then on until <code>StopLoop</code> is called and it quits.</p>\n\n<p>In order to stop the goroutines, it is common to have a \"stop\" channel. Usually it is a <code>chan struct{}</code> to save memory because you don't ever have to put anything in it. Wherever you want the goroutine to possibly stop and shutoff (or do something else perhaps), you use a <code>select</code> statement with the <code>channel</code>s you are using. This <code>select</code> is ordered, so it will take from them in order unless they block, in which case it tries the next one, so the <code>stop</code> <code>channel</code> usually goes first. The <code>stop</code> channel normally blocks, but to get it to take this path, simply <code>close()</code>ing it will cause this path to be chosen in the <code>select</code>. So we <code>close()</code> it in the <code>q</code> keyboard handler.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gizak/termui\"\n    \"strconv\"\n    \"time\"\n)\n\nfunc getData(ch chan string, stop chan struct{}) {\n    i := 0\n    for {\n        select {\n        case &lt;-stop:\n            break\n        case ch &lt;- strconv.Itoa(i):\n        }\n        i++\n        time.Sleep(time.Second)\n        if i == 20 {\n            break\n        }\n    }\n}\n\nfunc Display(ch chan string, stop chan struct{}) {\n\n    for {\n        var elem string\n        select {\n        case &lt;-stop:\n            break\n        case elem = &lt;-ch:\n        }\n        par := termui.NewPar(elem)\n        par.Height = 5\n        par.Width = 37\n        par.Y = 4\n        par.BorderLabel = \"term ui example with chan\"\n        par.BorderFg = termui.ColorYellow\n        termui.Render(par)\n    }\n}\n\nfunc main() {\n    ch := make(chan string)\n    stop := make(chan struct{})\n    err := termui.Init()\n    if err != nil {\n        panic(err)\n    }\n    defer termui.Close()\n    termui.Handle(\"/sys/kbd/q\", func(termui.Event) {\n        fmt.Println(\"q captured\")\n        close(stop)\n        termui.StopLoop()\n    })\n    go getData(ch, stop)\n    go Display(ch, stop)\n    termui.Loop()\n}\n</code></pre>\n"}], "owner": {"reputation": 1592, "user_id": 703061, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7db295545ff40053c8d7f062167395ef?s=128&d=identicon&r=PG&f=1", "display_name": "wayfare", "link": "https://stackoverflow.com/users/703061/wayfare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 45337334, "answer_count": 1, "score": 0, "last_activity_date": 1501102797, "creation_date": 1501095473, "question_id": 45335327, "link": "https://stackoverflow.com/questions/45335327/how-to-exit-from-my-go-code-using-go-routines-and-term-ui", "title": "How to exit from my go code using go routines and term ui", "body": "<p>I recently started learning go and I am really impressed with all the features. I been playing with go routines and <a href=\"https://github.com/gizak/termui\" rel=\"nofollow noreferrer\">term-ui</a> and facing some trouble. I am trying to exit this code from console after I run it but it just doesn't respond. If I run it without go-routine it does respond to my <code>q</code> key press event. </p>\n\n<p>Any help is appreciated. </p>\n\n<p>My code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gizak/termui\"\n    \"time\"\n    \"strconv\"\n)\n\nfunc getData(ch chan string) {\n  i := 0\n  for {\n    ch &lt;- strconv.Itoa(i)\n    i++\n    time.Sleep(time.Second)\n    if i == 20 {\n        break\n    }\n  }\n}\n\nfunc Display(ch chan string) {\n  err := termui.Init()\n  if err != nil {\n    panic(err)\n  }\n  defer termui.Close()\n  termui.Handle(\"/sys/kbd/q\", func(termui.Event) {\n    fmt.Println(\"q captured\")\n    termui.Close()\n    termui.StopLoop()\n  })\n\n  for elem := range ch {\n    par := termui.NewPar(elem)\n    par.Height = 5\n    par.Width = 37\n    par.Y = 4\n    par.BorderLabel = \"term ui example with chan\"\n    par.BorderFg = termui.ColorYellow\n    termui.Render(par)\n  }\n}\n\nfunc main() {\n  ch := make(chan string)\n  go getData(ch)\n  Display(ch)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 553, "user_id": 5483488, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/4ZHg7.jpg?s=128&g=1", "display_name": "Jake Lacey", "link": "https://stackoverflow.com/users/5483488/jake-lacey"}, "edited": false, "score": 0, "creation_date": 1501106896, "post_id": 45335515, "comment_id": 77638490, "body": "Okay I think I&#39;m following what you are saying, which is if I&#39;m going to be specific I need to do it in the middlware also. and if I am then I need to create a different logger middleware for every different interface I will have?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 553, "user_id": 5483488, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/4ZHg7.jpg?s=128&g=1", "display_name": "Jake Lacey", "link": "https://stackoverflow.com/users/5483488/jake-lacey"}, "edited": false, "score": 0, "creation_date": 1501109709, "post_id": 45335515, "comment_id": 77639493, "body": "Yes, that or make it generic all the way through."}, {"owner": {"reputation": 553, "user_id": 5483488, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/4ZHg7.jpg?s=128&g=1", "display_name": "Jake Lacey", "link": "https://stackoverflow.com/users/5483488/jake-lacey"}, "edited": false, "score": 0, "creation_date": 1501110107, "post_id": 45335515, "comment_id": 77639595, "body": "What would you do?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 553, "user_id": 5483488, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/4ZHg7.jpg?s=128&g=1", "display_name": "Jake Lacey", "link": "https://stackoverflow.com/users/5483488/jake-lacey"}, "edited": false, "score": 0, "creation_date": 1501110509, "post_id": 45335515, "comment_id": 77639685, "body": "That&#39;s really hard to say without knowing what you&#39;re doing, but my gut says if you&#39;re in this situation, middleware isn&#39;t the best approach. Middleware works in situations like an HTTP server where every handler is identical."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1501096149, "creation_date": 1501096149, "answer_id": 45335515, "question_id": 45334968, "link": "https://stackoverflow.com/questions/45334968/golang-microservice-middleware-allow-any-type-but-be-strict-on-endpoint/45335515#45335515", "title": "Golang microservice middleware allow any type but be strict on endpoint", "body": "<p>What's going to be calling these? At some point there is an actual consumer, and that consumer will (presumably, based on your code) be using an interface (either <code>layer</code> or an identical interface). If there's middleware, that interface will <em>necessarily be as generic as the middleware</em> - i.e., taking a <code>interface{}</code> as a parameter to <code>Run</code>. So making something downstream more specific (besides not compiling as you've seen) doesn't make any sense: the actual consumer won't see the more-specific interface, it will see <code>Run(Context,interface{}) (interface{},error)</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 553, "user_id": 5483488, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/4ZHg7.jpg?s=128&g=1", "display_name": "Jake Lacey", "link": "https://stackoverflow.com/users/5483488/jake-lacey"}, "edited": false, "score": 0, "creation_date": 1501106660, "post_id": 45335566, "comment_id": 77638375, "body": "What you are saying makes sense I&#39;m just trying to avoid writing logger functions which will effectively be the same code (in my head) thanks for answering :)"}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 1, "last_activity_date": 1501096333, "creation_date": 1501096333, "answer_id": 45335566, "question_id": 45334968, "link": "https://stackoverflow.com/questions/45334968/golang-microservice-middleware-allow-any-type-but-be-strict-on-endpoint/45335566#45335566", "title": "Golang microservice middleware allow any type but be strict on endpoint", "body": "<p>The error message says it all, for a type to implement an interface its methods must <em>exactly match</em> the methods the interface defines.</p>\n\n<p>Sadly, this means that your system won't work as designed. You will either need to use <code>interface{}</code> and assert to the actual type at the end point, or you will need a separate interface (and logger function) for each type.</p>\n"}], "owner": {"reputation": 553, "user_id": 5483488, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/4ZHg7.jpg?s=128&g=1", "display_name": "Jake Lacey", "link": "https://stackoverflow.com/users/5483488/jake-lacey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 45335515, "answer_count": 2, "score": 0, "last_activity_date": 1501096333, "creation_date": 1501094176, "question_id": 45334968, "link": "https://stackoverflow.com/questions/45334968/golang-microservice-middleware-allow-any-type-but-be-strict-on-endpoint", "title": "Golang microservice middleware allow any type but be strict on endpoint", "body": "<p>New to golang but what I'm trying to do is make my logging middleware generic e.g. allow any type and then call the method for the next layer.</p>\n\n<p>So below us the loggingmiddleware package, where I want to be able to accept any type and print it out.</p>\n\n<pre><code>package loggingmiddleware\n\nimport (\n    \"context\"\n    \"time\"\n\n    gokitlogger \"github.com/go-kit/kit/log\"\n)\n\ntype layer interface {\n    Run(context.Context, interface{}) (interface{}, error)\n}\n\ntype LoggingMiddleware struct {\n    Logger gokitlogger.Logger\n    Layer  layer\n}\n\nfunc (mw LoggingMiddleware) Run(ctx context.Context, i interface{}) (output interface{}, err error) {\n\n    defer func(begin time.Time) {\n\n        mw.Logger.Log(\n            \"method\", \"name of method\",\n            \"input\", i,\n            \"output\", output,\n            \"err\", err,\n            \"took\", time.Since(begin),\n        )\n\n    }(time.Now())\n\n    output, err = mw.Layer.Run(ctx, i)\n    return\n\n}\n</code></pre>\n\n<p>However I want to be strict when calling the next method, if it needs to be string I want to set the type to be string rather than <code>interface{}</code></p>\n\n<p>In my example I want to make sure only a float64 type will be used as an argument </p>\n\n<pre><code>type mathServiceInterface interface {\n    Run(context.Context, float64) (float64, error)\n}\n\ntype mathService struct{}\n\nfunc (mathService) Run(_ context.Context, f float64) (float64, error) {\n    return f * f, nil\n}\n</code></pre>\n\n<p>However with my current implementation I'm getting this error...</p>\n\n<pre><code># github.com/jakelacey2012/blankit/blankit-ms/sqaure\n\n./main.go:92: cannot use ms (type mathServiceInterface) as type loggingmiddleware.layer in field value:\n        mathServiceInterface does not implement loggingmiddleware.layer (wrong type for Run method)\n                have Run(context.Context, float64) (float64, error)\n                want Run(context.Context, interface {}) (interface {}, error)\n\n./main.go:92: cannot use loggingmiddleware.LoggingMiddleware literal (type loggingmiddleware.LoggingMiddleware) as type mathServiceInterface in assignment:\n        loggingmiddleware.LoggingMiddleware does not implement mathServiceInterface (wrong type for Run method)\n                have Run(context.Context, interface {}) (interface {}, error)\n                want Run(context.Context, float64) (float64, error)\n</code></pre>\n\n<p>I understand the error, however I don't know whether my implementation is over complicating things because I don't know go.</p>\n\n<p>I hope what I'm saying makes sense, I was unsure what to title this as so please feel free to edit it.</p>\n\n<p>Also if you need more code to better explain please do let me know.</p>\n"}, {"tags": ["dictionary", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1501096755, "post_id": 45334649, "comment_id": 77633261, "body": "Take a look at how encoding/json does it."}], "answers": [{"tags": [], "owner": {"reputation": 529, "user_id": 1061579, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e80a2c0170d152133bfd5f691b5e2ccf?s=128&d=identicon&r=PG", "display_name": "R3v4n", "link": "https://stackoverflow.com/users/1061579/r3v4n"}, "is_accepted": false, "score": 0, "last_activity_date": 1501105437, "creation_date": 1501105437, "answer_id": 45337960, "question_id": 45334649, "link": "https://stackoverflow.com/questions/45334649/how-to-convert-complex-json-string-with-nested-objects-to-map-in-golang/45337960#45337960", "title": "How to convert complex json string with nested objects to map in golang?", "body": "<p>You can use a map[string]interface{}, for example:</p>\n\n<pre><code>species := make(map[string]interface{})\nif err := json.Unmarshal([]byte(jsonStr), &amp;species); err != nil {\n   // deal with error\n}\n</code></pre>\n"}], "owner": {"reputation": 155, "user_id": 1851006, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ef2638964d83d7357ab3d089b409279d?s=128&d=identicon&r=PG", "display_name": "user1851006", "link": "https://stackoverflow.com/users/1851006/user1851006"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 271, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1501105437, "creation_date": 1501093101, "question_id": 45334649, "link": "https://stackoverflow.com/questions/45334649/how-to-convert-complex-json-string-with-nested-objects-to-map-in-golang", "title": "How to convert complex json string with nested objects to map in golang?", "body": "<p>I have a complex string in json format which i want to convert to a map in golang. Let's say the string is</p>\n\n<pre><code>      species :{\n               \"type\" : \"human\"\n               \"age\" : \"23\"\n               \"attributes\" : {\n                              \"height\" : \"182\"\n                              \"weight\" : \"160\"\n                              \"contact\" : {\n                                          \"address\" : ########\n                                          \"phone\" : #########\n                              }\n               }\n      }\n</code></pre>\n\n<p>how do i parse it such that map[attributes] is a again a map[string]interface and so on ?</p>\n"}, {"tags": ["file", "sockets", "go", "tcp", "protocols"], "comments": [{"owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "edited": false, "score": 0, "creation_date": 1501094887, "post_id": 45334625, "comment_id": 77632247, "body": "I remember having trouble with something similar to this as well in the past. For me, I was forgetting to <a href=\"https://golang.org/pkg/bufio/#Writer.Flush\" rel=\"nofollow noreferrer\">flush the buffer</a> - could that perhaps be related to the trouble you&#39;re experiencing here?"}, {"owner": {"reputation": 21, "user_id": 4446630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ced8fe610f86a3f0b5b6b3bbb40b81da?s=128&d=identicon&r=PG&f=1", "display_name": "damekr", "link": "https://stackoverflow.com/users/4446630/damekr"}, "reply_to_user": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "edited": false, "score": 0, "creation_date": 1501095204, "post_id": 45334625, "comment_id": 77632444, "body": "Good idea, but I&#39;m using different buffers for delimiters and on dedicated for file receiving. And also instead of bufio I have implemented on io.CopyN file receiver."}], "owner": {"reputation": 21, "user_id": 4446630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ced8fe610f86a3f0b5b6b3bbb40b81da?s=128&d=identicon&r=PG&f=1", "display_name": "damekr", "link": "https://stackoverflow.com/users/4446630/damekr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 379, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1501093467, "creation_date": 1501093011, "last_edit_date": 1501093467, "question_id": 45334625, "link": "https://stackoverflow.com/questions/45334625/sending-multiple-files-over-tcp-golang-simple-protocol", "title": "Sending multiple files over tcp golang - simple protocol", "body": "<p>I'm trying to build a simple protocol to send files over TCP in golang. After reading some stuff I decided to use GOB package to send a header with information about file being sent and then file in using raw socket. Between messages I'm using a delimiter (\"/r/n\")\nSo the sendflow looks like that:\nClient(sends a file)(C)\nServer(S)</p>\n\n<ul>\n<li>(C)Reading file metadata(filesize, filename, etc)</li>\n<li>(C)Encoding file metadata into struct </li>\n<li>(C)Intialize connection with server</li>\n<li>(C)Send encoded gob</li>\n<li>(S)Receive a gob and decode</li>\n<li>(C)Send a delimiter</li>\n<li>(S)Receive a delimiter</li>\n<li>(C)Start sending file using buffer (1024)</li>\n<li>(S)Start receiving file and saving to created file until size from header message will be exceeded.</li>\n<li>(C)Send a delimiter</li>\n<li>(S)Receive a delimiter</li>\n<li>(C)Close connection</li>\n</ul>\n\n<p>Hopefully I explained it well. A problem is that in my unittests when I'm checking checksums of file being transfered sometimes I have wrong files it looks like sometimes the delimiter is added also. My question is if my simple protocol does make sense, if not could someone give my some advices how to build it to be robust and reliable.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["ssl", "go", "tls1.2", "lets-encrypt", "caddy"], "comments": [{"owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "edited": false, "score": 0, "creation_date": 1501092897, "post_id": 45334531, "comment_id": 77631217, "body": "The signer certainly has no impact on the available cipher suites, so insofar that the error message is accurate, whether you use Let&#39;s Encrypt or another CA plays no role."}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "edited": false, "score": 0, "creation_date": 1501093011, "post_id": 45334531, "comment_id": 77631282, "body": "@fuglede ok, what would be the cause of the error? I found it <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/neu_jKq9pYk\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/neu_jKq9pYk</a>"}, {"owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "edited": false, "score": 1, "creation_date": 1501093143, "post_id": 45334531, "comment_id": 77631361, "body": "Caddy allows only a very limited set of cipher suites by default, but they can be modified (<a href=\"https://caddyserver.com/docs/tls\" rel=\"nofollow noreferrer\">caddyserver.com/docs/tls</a>). Which library are you using for the client?"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "edited": false, "score": 0, "creation_date": 1501093381, "post_id": 45334531, "comment_id": 77631469, "body": "@fuglede I am using github.com/ory-am/hydra/sdk ...The client app, indeed is this one <a href=\"https://github.com/ory/hydra-consent-app-go\" rel=\"nofollow noreferrer\">github.com/ory/hydra-consent-app-go</a>"}, {"owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "edited": false, "score": 0, "creation_date": 1501101011, "post_id": 45334531, "comment_id": 77635666, "body": "That looks like it&#39;s a webserver itself; can you provide the code you use to communicate with the Caddy instance, as well as the output of <code>openssl s_client -connect caddy-host:443</code> (to get an idea of which ciphers it wants to use)?"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 934, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1501152208, "creation_date": 1501092689, "last_edit_date": 1501152208, "question_id": 45334531, "link": "https://stackoverflow.com/questions/45334531/handshake-failed-when-using-builtin-tls-package", "title": "Handshake failed when using builtin TLS package", "body": "<p>I am having a problem/misunderstanding with SSL-TLS. My situation is the next: I have 2 backends application developed in Golang, they should communicate ech other over HTTPS, http is not allowed. Every application is running on a separate server.</p>\n\n<p>Currently I am using Caddy as HTTP server and to make proxy redirections, also with it I get the SSL certificate from Let's Encrypt. Now, when I try to communicate from the ApplicationA to the ApplicationB I cannot connect, I checked the logs of the ApplicationB and this is the error:</p>\n\n<pre><code>Handshake failed when using builtin TLS package: no cipher suite supported by both client and server\n</code></pre>\n\n<p>I also read that this error is common when using LetsEncrypt certificates, is it true? some people recommends to buy a certificate instead, in that case, where is the problem? with the ApplicationA, ApplicationB, or boths?\nI am not skilled in TLS area so looking for help.</p>\n\n<p>I am using Go 1.8</p>\n"}, {"tags": ["pointers", "go", "interface"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1501091945, "post_id": 45334244, "comment_id": 77630631, "body": "Do you really need reflect here, or are you just looking for a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> or <a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"nofollow noreferrer\">type switch</a>?"}, {"owner": {"reputation": 176, "user_id": 3775467, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/610b2c05c5be7a3a62c6862dab222997?s=128&d=identicon&r=PG&f=1", "display_name": "SokIsKedu", "link": "https://stackoverflow.com/users/3775467/sokiskedu"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501136480, "post_id": 45334244, "comment_id": 77646911, "body": "Actually yes, because here is just a sample of actual program, I need to access the field names and values later. Of course I might be missing something, I just started using Go."}], "answers": [{"tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": true, "score": 3, "last_activity_date": 1501093495, "last_edit_date": 1501093495, "creation_date": 1501092226, "answer_id": 45334395, "question_id": 45334244, "link": "https://stackoverflow.com/questions/45334244/go-access-pointer-value-if-its-passed-as-interface/45334395#45334395", "title": "Go access pointer value if its passed as interface{}", "body": "<p>If you need to support arbitrary levels of pointers then you can use reflection to get the value object:</p>\n\n<pre><code>v:=reflect.ValueOf(obj)\nfor v.Kind() == reflect.Ptr {\n    v = v.Elem()\n}\nv.Interface()\n</code></pre>\n\n<p>However, this is quite unusual to actually need to do in practice. </p>\n\n<p>For your function, this could work as something like:</p>\n\n<pre><code>func TestFunc(obj interface{}){\n    rv := reflect.ValueOf(obj)\n    switch rv.Kind() {\n        case reflect.Struct:\n            // code here\n            return\n        case reflect.Ptr:\n            TestFunc(rv.Elm().Interface()) \n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 176, "user_id": 3775467, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/610b2c05c5be7a3a62c6862dab222997?s=128&d=identicon&r=PG&f=1", "display_name": "SokIsKedu", "link": "https://stackoverflow.com/users/3775467/sokiskedu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "accepted_answer_id": 45334395, "answer_count": 1, "score": 1, "last_activity_date": 1501093495, "creation_date": 1501091696, "last_edit_date": 1501091770, "question_id": 45334244, "link": "https://stackoverflow.com/questions/45334244/go-access-pointer-value-if-its-passed-as-interface", "title": "Go access pointer value if its passed as interface{}", "body": "<p>I'm writing a program where I need to access a value of a pointer which is passed as an <code>interface{}</code>. </p>\n\n<p><a href=\"https://play.golang.org/p/Ufpwtc7kMe\" rel=\"nofollow noreferrer\">playground</a>   </p>\n\n<pre><code>package main\n\nimport (\n    \"reflect\"\n)\n\ntype Test struct {\n    Names []string\n}\n\nfunc main() {\n    arr := []string{\"a\", \"a\", \"a\", \"a\", \"a\", \"a\"}\n    obj := new(Test)\n    obj.Names = arr\n    TestFunc(obj)   \n}\n\nfunc TestFunc(obj interface{}){\n    rt := reflect.TypeOf(obj)\n    switch rt.Kind() {\n        case reflect.Struct:\n            return\n        case reflect.Ptr:\n            TestFunc(*obj)  //&lt;&lt;--- There is the problem, cannot figure out how to access \n//value of obj and *obj is not allowed here because of interface{} type.\n    }\n}\n</code></pre>\n\n<p>This is just a sample from a much bigger program, but it is enough to explain my problem.</p>\n\n<p>So the problem is, when I pass a pointer to <code>TestFunc()</code> I do not know how to reach its value inside function. Is it possible at all? </p>\n\n<p>I need to do some stuff based on wether it is a pointer or not, so if I keep passing pointer recursively the program will fail. I need to get the value from the passed pointer(and pass forward value instead of pointer) but I am not sure if it is possible because I am dealing with a type <code>interface{}</code> and not a pointer and compiler does not know if it is going to be a pointer passed so it does not allow something like \"*obj\" to reach the value of it. </p>\n"}, {"tags": ["xml", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501092412, "post_id": 45333364, "comment_id": 77630932, "body": "Please include your Go code in the question itself rather than linking to it."}], "answers": [{"tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 4, "last_activity_date": 1501093821, "last_edit_date": 1501093821, "creation_date": 1501089787, "answer_id": 45333669, "question_id": 45333364, "link": "https://stackoverflow.com/questions/45333364/golang-unmarshal-xml-attribute-into-interface/45333669#45333669", "title": "Golang unmarshal XML attribute into interface", "body": "<p>Its important to check the returned error always. </p>\n\n<pre><code>if err := xml.Unmarshal([]byte(xmlRawData), &amp;xmlData); err != nil {\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>The error you're getting is</p>\n\n<pre><code>cannot unmarshal into interface {}\n</code></pre>\n\n<p>Empty interface cannot be unmarshalled since the empty interface doesn't have any exported fields to map the xml keys/values to.</p>\n\n<p>However there is way to get around. Implementing <a href=\"https://golang.org/pkg/encoding/xml/#Unmarshaler\" rel=\"nofollow noreferrer\">xml.Unmarshaler</a> interface on your <code>VendorMapInfo</code> struct.</p>\n\n<p>Example: Your updated code</p>\n\n<pre><code>type VendorMapInfo struct {\n    MapHierarchyString string      `xml:\"mapHierarchyString,attr\"`\n    FloorRefID         interface{} `xml:\"floorRefId,attr\"`\n    Image              Image       `xml:\"Image\"`\n    FloorDimension     VendorFloorDimension\n}\n\ntype Image struct {\n    Name string `xml:\"imageName,attr\"`\n}\n\nfunc (mf *VendorMapInfo) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    // Attributes\n    for _, attr := range start.Attr {\n        switch attr.Name.Local {\n        case \"mapHierarchyString\":\n            mf.MapHierarchyString = attr.Value\n        case \"floorRefId\":\n            mf.FloorRefID = findFloorRefIDType(attr.Value)\n        }\n    }\n\n    for {\n        token, err := d.Token()\n        if err != nil {\n            return err\n        }\n\n        switch el := token.(type) {\n        case xml.StartElement:\n            if el.Name.Local == \"Image\" {\n                item := new(Image)\n                if err = d.DecodeElement(item, &amp;el); err != nil {\n                    return err\n                }\n                mf.Image = *item\n            }\n        case xml.EndElement:\n            if el == start.End() {\n                return nil\n            }\n        }\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>Complete code, play link: <a href=\"https://play.golang.org/p/wZQOsQv0Nq\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wZQOsQv0Nq</a></p>\n\n<p>Output:</p>\n\n<pre><code>{Locations:{Space: Local:} WirelessClientLocation:[{MacAddress:00:00:00:00:00:00 MapInfo:{MapHierarchyString:Head office&gt;Ground floor&gt;Store FloorRefID:-1122334455667789 Image:{Name:floorPlan1.png} FloorDimension:{Length:0 Width:0 Height:0 OffsetX:0 OffsetY:0 Unit:}}} {MacAddress:11:11:11:11:11:11 MapInfo:{MapHierarchyString:Head office&gt;Ground floor&gt;Store FloorRefID:-1122334455667789 Image:{Name:floorPlan1.png} FloorDimension:{Length:0 Width:0 Height:0 OffsetX:0 OffsetY:0 Unit:}}} {MacAddress:26:cd:96:46:0b:2b MapInfo:{MapHierarchyString: FloorRefID:0 Image:{Name:} FloorDimension:{Length:0 Width:0 Height:0 OffsetX:0 OffsetY:0 Unit:}}}]}\n</code></pre>\n"}], "owner": {"reputation": 102, "user_id": 3886935, "user_type": "registered", "profile_image": "https://graph.facebook.com/734980351/picture?type=large", "display_name": "Raymond Jones", "link": "https://stackoverflow.com/users/3886935/raymond-jones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1929, "favorite_count": 0, "accepted_answer_id": 45333669, "answer_count": 1, "score": 2, "last_activity_date": 1501093821, "creation_date": 1501088907, "question_id": 45333364, "link": "https://stackoverflow.com/questions/45333364/golang-unmarshal-xml-attribute-into-interface", "title": "Golang unmarshal XML attribute into interface", "body": "<p>I'm trying to unmarshal some XML into a structure with an interface{} type. However whenever I try to run it, the code doesn't pick up anything at all. All of the other elements appear to work fine, and if I set the type to string or []byte it will work, however I need it to be more flexible than that.</p>\n\n<p>The element I am interested in is on <b>line 32</b> - <b>FloorRefID</b></p>\n\n<p><a href=\"https://play.golang.org/p/Ehr8qx1aWf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Ehr8qx1aWf</a></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n    &lt;Locations totalPages=\"1\" currentPage=\"1\" pageSize=\"25\"&gt;\n       &lt;WirelessClientLocation macAddress=\"00:00:00:00:00:00\"&gt;\n          &lt;MapInfo mapHierarchyString=\"Head office&amp;gt;Ground floor&amp;gt;Store\" floorRefId=\"-1122334455667789\"&gt;\n             &lt;Image imageName=\"floorPlan1.png\" /&gt;\n          &lt;/MapInfo&gt;\n          &lt;MapCoordinate x=\"2850\" y=\"3000\" unit=\"FEET\" /&gt;\n       &lt;/WirelessClientLocation&gt;\n       &lt;WirelessClientLocation macAddress=\"11:11:11:11:11:11\"&gt;\n          &lt;MapInfo mapHierarchyString=\"Head office&amp;gt;Ground floor&amp;gt;Store\" floorRefId=\"-1122334455667789\"&gt;\n            &lt;Image imageName=\"floorPlan1.png\" /&gt;\n          &lt;/MapInfo&gt;\n          &lt;MapCoordinate x=\"10.72\" y=\"76.49\" unit=\"FEET\" /&gt;\n       &lt;/WirelessClientLocation&gt;\n       &lt;WirelessClientLocation macAddress=\"26:cd:96:46:0b:2b\"&gt;\n          &lt;MapInfo floorRefId=\"0\" /&gt;\n          &lt;MapCoordinate x=\"51.52\" y=\"4.2\" unit=\"FEET\" /&gt;\n       &lt;/WirelessClientLocation&gt;\n    &lt;/Locations&gt;\n</code></pre>\n\n<p>To give some context; I am working on a project integrating with a vendor in which sometimes we receive the data as XML and sometimes as JSON. I wanted to build something that could unmarshal the structure for both, rather than duplicating the structure set. It has many substructures which means that its a lot more work to keep 2 structures which are almost identical except for this one attribute.</p>\n\n<p>When we receive the JSON data, the field can be given as a string or a number.</p>\n\n<p>I have read that you cannot unmarshal into an interface, but does anyone know of a way around this issue for my scenario?</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1501087034, "post_id": 45332625, "comment_id": 77627515, "body": "Redirect after the POST? Return a URL for your application to GET a websocket, or even just poll for completion?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1501087239, "post_id": 45332625, "comment_id": 77627628, "body": "This isn&#39;t really a Go question: you have the Go parts down, this is effectively a general-purpose web dev question, i.e., &quot;how do you present the result of a long-running back-end process to the user&quot;. There are many options for doing so, and which to use will depend mostly on your particular UX decisions."}, {"owner": {"reputation": 43, "user_id": 3004431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec4a5b3f8e656858100d4c821baac6aa?s=128&d=identicon&r=PG&f=1", "display_name": "nicomo", "link": "https://stackoverflow.com/users/3004431/nicomo"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501134621, "post_id": 45332625, "comment_id": 77646054, "body": "@Adrian: you&#39;re probably right, but then could you point to 1 or 2 of those options? That&#39;d be helpful."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501158839, "post_id": 45332625, "comment_id": 77662765, "body": "JimB listed 3 already, but I&#39;ll post some more info shortly."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 3004431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec4a5b3f8e656858100d4c821baac6aa?s=128&d=identicon&r=PG&f=1", "display_name": "nicomo", "link": "https://stackoverflow.com/users/3004431/nicomo"}, "edited": false, "score": 0, "creation_date": 1501223863, "post_id": 45352445, "comment_id": 77693570, "body": "just the type of broad answer I needed to make sense of the issue. Thanks a lot."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1501162611, "creation_date": 1501162611, "answer_id": 45352445, "question_id": 45332625, "link": "https://stackoverflow.com/questions/45332625/how-to-manage-a-long-processes-in-web-app/45352445#45352445", "title": "How to manage a long processes in web app", "body": "<p>You've stumbled onto a non-trivial problem. There are a lot of possible solutions, with different user experiences, implementation complexities, and side effects. This is a pretty big topic so this answer is intended mostly as a starting point for further research.</p>\n\n<h1>The Simplest Option</h1>\n\n<p>First, pretty much regardless of solution, you're going to have to give each long-running task a unique ID that the browser can use to get status updates later. The task runner itself can just flag jobs as complete, or it can periodically issue progress updates if you want to present progress to the user.</p>\n\n<p>The easiest to implement is likely to have your form submission immediately respond with a page, with the task ID included in the URL, whose handler checks the task status and either a) returns a page with \"still working\" or something to that effect and auto-refreshes after a few seconds, or b) returns a page saying \"completed\" and does not refresh. This isn't terribly difficult to implement, but it's not particularly smooth, either. If this is a simple internal-use project with simple UX and operational requirements, I'd just do this. Otherwise, further down the rabbit hole we go!</p>\n\n<h1>Live Updates</h1>\n\n<p>You could do live updates without reloading the page by a few different methods:</p>\n\n<ul>\n<li>Regular AJAX requests to check the status of the task, updating the UI based on the response. This would have a REST-style handler on the back end.</li>\n<li>You can use <a href=\"https://godoc.org/golang.org/x/net/websocket\" rel=\"nofollow noreferrer\">WebSockets</a> to do the same thing over a single connection.</li>\n<li>You can use HTTP long-polling to simulate WebSocket-like behavior, but this has generally been supplanted by WebSockets.</li>\n</ul>\n\n<p>Either option will require both a handler to serve the status update information and some JavaScript wizardry on the front-end to call the handler, parse the response, and update the page.</p>\n\n<h1>Side-Effects</h1>\n\n<p>Depending on the scale and requirements of this service, there are some side-effects to consider; mainly that a long-running task is effectively a kind of application state, making your application stateful, which has some severe operational downsides when it comes to availability, scaling, and deployment. If you're running multiple load-balanced instances you'll have to use sticky sessions or share task status between instances somehow.</p>\n\n<p>The most common way to handle long-running tasks at scale is to separate the worker from the web application, using some kind of work queue (either in a database or a dedicated message broker like Rabbit or Kafka) to manage the tasks. This makes it a little more complicated to get status updates because you're working across processes, but it gives you a lot more flexibility operationally.</p>\n\n<p>I'm guessing this is a more complicated answer than you expected to \"requests are timing out\", but this is a case of a trivial issue with a non-trivial solution. You're certainly not alone in tackling this issue; researching handling long-running tasks in web applications will yield a ton of information you can leverage.</p>\n"}], "owner": {"reputation": 43, "user_id": 3004431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec4a5b3f8e656858100d4c821baac6aa?s=128&d=identicon&r=PG&f=1", "display_name": "nicomo", "link": "https://stackoverflow.com/users/3004431/nicomo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1124, "favorite_count": 0, "accepted_answer_id": 45352445, "answer_count": 1, "score": 2, "last_activity_date": 1611062497, "creation_date": 1501086385, "last_edit_date": 1611062497, "question_id": 45332625, "link": "https://stackoverflow.com/questions/45332625/how-to-manage-a-long-processes-in-web-app", "title": "How to manage a long processes in web app", "body": "<p>I'm trying to implement the following functionality in Go.</p>\n<p>I have a web page with a form, used to upload a .csv file.\nGorilla mux is used to route to a handler which takes the file and parses it, does a bunch of operations on the data and at the end produces a report with number of lines parsed, # of rejected lines, etc.</p>\n<p>My problem is that even though it works on my machine, on a server Apache will time out before I can get to the end of it all: the file upload itself isn't the issue, but I have to wait for transformations on the data to complete.</p>\n<p>I've tried to use Gorilla websocket to get feedback from the process (incrementing number of lines parsed and treated, for instance) and keep the connection open, but this is a POST request, and Gorilla websocket won't upgrade from http to websocket unless one has a GET request.</p>\n<p>I'm not even sure I'm on the right track with websockets for doing this type of thing.</p>\n<p>I can have a goroutine for the processing itself and return the handler before the goroutine completes, but then how do I show the result of the process in the UI?</p>\n<p>So at this stage my question boils down to: what would be the best way, in Go, when you need to:</p>\n<ul>\n<li>upload a file,</li>\n<li>wait for a long process to complete</li>\n<li>and display the result in a web page?</li>\n</ul>\n<p>A clue as to the right direction to go in would be much appreciated.</p>\n"}, {"tags": ["git", "go", "centos"], "comments": [{"owner": {"reputation": 8027, "user_id": 3282436, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e17caa3e07899b69539433130de1d420?s=128&d=identicon&r=PG&f=1", "display_name": "0x5453", "link": "https://stackoverflow.com/users/3282436/0x5453"}, "edited": false, "score": 0, "creation_date": 1501085231, "post_id": 45332175, "comment_id": 77626243, "body": "Is it possible that it is trying to execute that command from a directory that is not a git repository?"}, {"owner": {"reputation": 2639, "user_id": 3072566, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jaZNV.png?s=128&g=1", "display_name": "litelite", "link": "https://stackoverflow.com/users/3072566/litelite"}, "edited": false, "score": 0, "creation_date": 1501085252, "post_id": 45332175, "comment_id": 77626256, "body": "If you try from the command line, does it work?"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 2639, "user_id": 3072566, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jaZNV.png?s=128&g=1", "display_name": "litelite", "link": "https://stackoverflow.com/users/3072566/litelite"}, "edited": false, "score": 0, "creation_date": 1501085368, "post_id": 45332175, "comment_id": 77626343, "body": "@litelite I am making that from the command line"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 8027, "user_id": 3282436, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/e17caa3e07899b69539433130de1d420?s=128&d=identicon&r=PG&f=1", "display_name": "0x5453", "link": "https://stackoverflow.com/users/3282436/0x5453"}, "edited": false, "score": 0, "creation_date": 1501085414, "post_id": 45332175, "comment_id": 77626376, "body": "@0x5453 the thing is that I dont execute git directly, &quot;Go get&quot; do that automatically"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501086021, "post_id": 45332175, "comment_id": 77626817, "body": "If you can&#39;t execute git directly, this isn&#39;t really a programming question. Do you have any <code>GIT_*</code> environment variables set incorrectly? Have you tried a new login shell after reinstalling git?"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501086522, "post_id": 45332175, "comment_id": 77627190, "body": "@JimB I tested cloning a repo and it worked correctly"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1501086843, "post_id": 45332175, "comment_id": 77627389, "body": "@SrednyMCasanova: you said you ran <code>git pull --ff-only</code> from the command line and got that same error. Regardless, this is a git error, so I would be looking at things related to that installation, like the relevant env variables, git config for the repo in question, etc."}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501088146, "post_id": 45332175, "comment_id": 77628211, "body": "@JimB The OP clearly stated he is using <code>get get [PACKAGE]</code> and receiving the error message that includes <code>git pull --ff-only</code>, and he also cloned a repo with git directly and was successful."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1501088191, "post_id": 45332175, "comment_id": 77628244, "body": "@Gavin: the second and third comment suggest otherwise."}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "edited": false, "score": 0, "creation_date": 1501091727, "post_id": 45332175, "comment_id": 77630495, "body": "also in git submodule command gives me error"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 214, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1501131607, "creation_date": 1501085151, "last_edit_date": 1501131607, "question_id": 45332175, "link": "https://stackoverflow.com/questions/45332175/go-get-package-fails-with-git-pull-is-broken", "title": "&quot;go get package&quot; fails with &quot;git-pull is broken&quot;", "body": "<p>I am having trouble with git and golang. I just installed go version <code>go1.8 linux/amd64</code> now and when I execute any <code>go get package</code> commands, I receive this message:</p>\n\n<pre><code>git pull --ff-only\nfatal: 'pull' appears to be a git command, but we were not\nable to execute it. Maybe git-pull is broken?\n</code></pre>\n\n<p>So, I reinstalled git twice by doing:</p>\n\n<ul>\n<li><code>yum reinstall git</code></li>\n<li><code>yum remove git, yum clean all, yum install git</code></li>\n</ul>\n\n<p>But, I am still getting the same error message. </p>\n\n<p>What else can be giving me problems? </p>\n\n<p>The current version of git is <code>git version 1.8.3.1</code> and my OS is CentOS7.</p>\n"}, {"tags": ["http", "go", "http-get", "task-queue", "flooding"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501087452, "post_id": 45332494, "comment_id": 77627757, "body": "Killing the pool is easy: close the channel you&#39;re passing jobs into."}, {"owner": {"reputation": 6398, "user_id": 761288, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/dcde0598aea083061f3b142d14a52736?s=128&d=identicon&r=PG", "display_name": "AG1", "link": "https://stackoverflow.com/users/761288/ag1"}, "edited": false, "score": 0, "creation_date": 1501109661, "post_id": 45332494, "comment_id": 77639482, "body": "Do you have any sample code or links that shows how to do this?"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1501112703, "post_id": 45332494, "comment_id": 77640245, "body": "Take a look at <a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\">this article about worker pools</a> it explains everything in far more detail than you could ever need :)"}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 2, "last_activity_date": 1501085993, "creation_date": 1501085993, "answer_id": 45332494, "question_id": 45332170, "link": "https://stackoverflow.com/questions/45332170/golang-strategies-to-prevent-connection-reset-by-peer-errors/45332494#45332494", "title": "golang: strategies to prevent connection reset by peer errors", "body": "<p>Instead of spinning up new goroutines for every request, create a fixed pool when your program starts and pass in orders over a shared channel. Each order would be a struct corresponding to the parameters currently passed to <code>getStock</code>. Things get more complicated if you need to be able to kill the pool, but it still isn't that hard...</p>\n\n<p>Basically your new handler would be a loop, reading an order from a channel shared by all handlers, executing it, then sending the result on the order's response channel.</p>\n"}, {"tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": false, "score": 0, "last_activity_date": 1501107001, "creation_date": 1501107001, "answer_id": 45338264, "question_id": 45332170, "link": "https://stackoverflow.com/questions/45332170/golang-strategies-to-prevent-connection-reset-by-peer-errors/45338264#45338264", "title": "golang: strategies to prevent connection reset by peer errors", "body": "<p>You need to use a buffered channel to limit amount of parallel operations. Before starting a new goroutine in the loop you need to send into this channel and receive from it after call done, so it will release one place and new request will be able to start. Check out yours modified code <a href=\"https://play.golang.org/p/WJdrYa-A4C\" rel=\"nofollow noreferrer\">on playground</a></p>\n"}], "owner": {"reputation": 6398, "user_id": 761288, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/dcde0598aea083061f3b142d14a52736?s=128&d=identicon&r=PG", "display_name": "AG1", "link": "https://stackoverflow.com/users/761288/ag1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2984, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1501107001, "creation_date": 1501085130, "question_id": 45332170, "link": "https://stackoverflow.com/questions/45332170/golang-strategies-to-prevent-connection-reset-by-peer-errors", "title": "golang: strategies to prevent connection reset by peer errors", "body": "<p>The program is spawning many goroutines (getStock) simultaneously which, I believe, is resulting in the remote server immediately dropping the connection.  I am not trying to create a DOS, but I still want to aggressively get data without getting 'connection reset' errors.</p>\n\n<p>What are some strategies to only have at most N (eg. 20) simultaneous connections?  Is there a built-in queue for GET requests in the golang Http client?  I'm still learning go it would be great to understand if there are better design patterns for this type of code.</p>\n\n<p><strong>Output</strong></p>\n\n<pre><code>$ go run s1w.go \nsl(size): 1280\nbody: \"AAPL\",17.92\nbody: \"GOOG\",32.13\nbody: \"FB\",42.02\nbody: \"AMZN\",195.83\nbody: \"GOOG\",32.13\nbody: \"AMZN\",195.83\nbody: \"GOOG\",32.13\nbody: \"FB\",42.02\nbody: \"AAPL\",17.92\n2017/07/26 00:01:23 NFLX: Get http://goanuj.freeshell.org/go/NFLX.txt: read tcp 192.168.86.28:56674-&gt;205.166.94.30:80: read: connection reset by peer\n2017/07/26 00:01:23 AAPL: Get http://goanuj.freeshell.org/go/AAPL.txt: read tcp 192.168.86.28:56574-&gt;205.166.94.30:80: read: connection reset by peer\n2017/07/26 00:01:23 NFLX: Get http://goanuj.freeshell.org/go/NFLX.txt: read tcp 192.168.86.28:56760-&gt;205.166.94.30:80: read: connection reset by peer\n2017/07/26 00:01:23 FB: Get http://goanuj.freeshell.org/go/FB.txt: read tcp 192.168.86.28:56688-&gt;205.166.94.30:80: read: connection reset by peer\n2017/07/26 00:01:23 AMZN: Get http://goanuj.freeshell.org/go/AMZN.txt: read tcp 192.168.86.28:56689-&gt;205.166.94.30:80: read: connection reset by peer\n2017/07/26 00:01:23 AAPL: Get http://goanuj.freeshell.org/go/AAPL.txt: read tcp 192.168.86.28:56702-&gt;205.166.94.30:80: read: connection reset by peer\n</code></pre>\n\n<p><strong>s1.go</strong></p>\n\n<pre><code>package main\nimport (\n        \"fmt\"\n        \"io/ioutil\"\n        \"log\"\n        \"net/http\"\n        \"time\"\n)\n\n// https://www.youtube.com/watch?v=f6kdp27TYZs (15m)\n// Generator: function that returns a channel\nfunc getStocks(sl []string) &lt;-chan string {\n        c := make(chan string)\n        for _, s := range sl {\n                go getStock(s, c)\n        }\n        return c\n}\n\nfunc getStock(s string, c chan string) {\n        resp, err := http.Get(\"http://goanuj.freeshell.org/go/\" + s + \".txt\")\n        if err != nil {\n                log.Printf(s + \": \" + err.Error())\n                c &lt;- err.Error() // channel send\n                return\n        }\n        body, _ := ioutil.ReadAll(resp.Body)\n        resp.Body.Close() // close ASAP to prevent too many open file desriptors\n        val := string(body)\n        //fmt.Printf(\"body: %s\", val)\n        c &lt;- val // channel send\n        return\n}\n\nfunc main() {\n        start := time.Now()\n        var sl = []string{\"AAPL\", \"AMZN\", \"GOOG\", \"FB\", \"NFLX\"}\n        // creates slice of 1280 elements\n        for i := 0; i &lt; 8; i++ {\n                sl = append(sl, sl...)\n        }\n        fmt.Printf(\"sl(size): %d\\n\", len(sl))\n\n        // get channel that returns only strings\n        c := getStocks(sl)\n        for i := 0; i &lt; len(sl); i++ {\n                fmt.Printf(\"%s\", &lt;-c) // channel recv\n        }\n\n        fmt.Printf(\"main: %.2fs elapsed.\\n\", time.Since(start).Seconds())\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1501083969, "post_id": 45331743, "comment_id": 77625283, "body": "Perhaps just clone it manually into the appropriate directory?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1501084036, "post_id": 45331743, "comment_id": 77625331, "body": "<code>-insecure</code> can&#39;t force connections to use insecure transports, it just allows insecure connections."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501084111, "post_id": 45331743, "comment_id": 77625381, "body": "Github does not support insecure HTTP checkouts."}, {"owner": {"reputation": 978, "user_id": 3212967, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/K14XW.png?s=128&g=1", "display_name": "Omortis", "link": "https://stackoverflow.com/users/3212967/omortis"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501084248, "post_id": 45331743, "comment_id": 77625478, "body": "@JimB - ok, I misunderstood."}, {"owner": {"reputation": 978, "user_id": 3212967, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/K14XW.png?s=128&g=1", "display_name": "Omortis", "link": "https://stackoverflow.com/users/3212967/omortis"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1501084252, "post_id": 45331743, "comment_id": 77625482, "body": "@captncraig: yeah I could do that but atom.io/go-plus is very useful. I&#39;ll have to simply take my laptop home to install go packages on it. I do the same thing to keep npm up to date...."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1501084446, "post_id": 45331743, "comment_id": 77625638, "body": "What are they doing in your network? https interception? Can&#39;t you install their cert to trust it?"}, {"owner": {"reputation": 978, "user_id": 3212967, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/K14XW.png?s=128&g=1", "display_name": "Omortis", "link": "https://stackoverflow.com/users/3212967/omortis"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1501084698, "post_id": 45331743, "comment_id": 77625852, "body": "@captncraig: I fought that battle and lost with npm and nearly lost my mind. Not going there again. However I think I found my answer (see edit above)."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1501084767, "post_id": 45331743, "comment_id": 77625897, "body": "Sounds like your employer doesn&#39;t value you getting your job done then. I&#39;m sorry."}, {"owner": {"reputation": 978, "user_id": 3212967, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/K14XW.png?s=128&g=1", "display_name": "Omortis", "link": "https://stackoverflow.com/users/3212967/omortis"}, "edited": false, "score": 0, "creation_date": 1501084913, "post_id": 45331743, "comment_id": 77626009, "body": "Like so many other large IT departments in the world this one would be considered fully modern if it was 1998 :-(. In their defense new tools like npm, node, go and git are only now starting to enter their network.   We have a back-burner project in flight to sort out https internally as it effects other projects as well..."}], "owner": {"reputation": 978, "user_id": 3212967, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/K14XW.png?s=128&g=1", "display_name": "Omortis", "link": "https://stackoverflow.com/users/3212967/omortis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3788, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1501084794, "creation_date": 1501083937, "last_edit_date": 1501084794, "question_id": 45331743, "link": "https://stackoverflow.com/questions/45331743/go-get-insecure-on-a-corporate-network", "title": "go get -insecure on a corporate network", "body": "<pre><code>C:\\Users\\me\n&gt; go get -insecure github.com/denisenkom/go-mssqldb\n# cd .; git clone https://github.com/denisenkom/go-mssqldb C:\\Users\\me\\Projects\\Go\\src\\github.com\\denisenkom\\go-mssqldb\nCloning into 'C:\\Users\\me\\Projects\\Go\\src\\github.com\\denisenkom\\go-mssqldb'...\nfatal: unable to access 'https://github.com/denisenkom/go-mssqldb/': SSL certificate problem: unable to get local issuer certificate\npackage github.com/denisenkom/go-mssqldb: exit status 128\n</code></pre>\n\n<p>According to <code>go help get</code> this connection should drop down to http? Yes? Do I misunderstand? How do I get this to work w/o https?</p>\n\n<p>PS: I'm not interested in trying to fix https (which on this Win10 image I have no control over anyway) - I already fought that battle with <code>npm</code> and lost...</p>\n\n<p>Edit: I found a passable answer by fixing the global git config. I hate to do it, but needs must... atom.io/go-plus does not seem to pick up this config change, I will ping the author.</p>\n\n<pre><code>C:\\Users\\me\n&gt; git config --global http.sslVerify false\n</code></pre>\n"}, {"tags": ["c", "debugging", "go", "cgo", "gccgo"], "comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501076014, "post_id": 45328414, "comment_id": 77618608, "body": "If you know how to use GDB, can&#39;t you debug the go program with that? Before delve was a thing that was the accepted solution,. I think go even comes with some GDB support scripts..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1501076173, "post_id": 45328414, "comment_id": 77618743, "body": "The simplest solution is often a liberal application of <code>printf</code>"}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 2, "last_activity_date": 1501087040, "last_edit_date": 1501087040, "creation_date": 1501086624, "answer_id": 45332701, "question_id": 45328414, "link": "https://stackoverflow.com/questions/45328414/how-can-i-debug-c-code-called-with-cgo/45332701#45332701", "title": "How can I debug C code called with cgo?", "body": "<p>Some investigation shows your only real options are as follows:</p>\n\n<ol>\n<li>GDB. Go programs should work with GDB just fine, but GDB and cgo may not get along. I think this will work on *NIX systems, but Windows may or may not cooperate. Try it and see?</li>\n<li>Liberal application of good ol <code>printf</code> or other logging.</li>\n</ol>\n\n<p>Neither of these options is very good...</p>\n\n<p><a href=\"https://gist.github.com/dwbuiten/c9865c4afb38f482702e\" rel=\"nofollow noreferrer\">This document has a section on cgo debugging</a> seems to indicate that it works ok.</p>\n"}], "owner": {"reputation": 151, "user_id": 5919841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/186c25db62190f816cd7195c8b5dff2b?s=128&d=identicon&r=PG&f=1", "display_name": "aedcv", "link": "https://stackoverflow.com/users/5919841/aedcv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2684, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1501087040, "creation_date": 1501075679, "question_id": 45328414, "link": "https://stackoverflow.com/questions/45328414/how-can-i-debug-c-code-called-with-cgo", "title": "How can I debug C code called with cgo?", "body": "<p><strong>Background</strong></p>\n\n<p>I'm currently in the process of writing a Go interface for this <a href=\"https://github.com/relic-toolkit/relic\" rel=\"nofollow noreferrer\">library</a>. </p>\n\n<p>As a first step, I'm trying to run the tests in <code>/test/test_pc.c</code> by calling them through Go wrappers. It is important to note that the tests are successful when compiled by GCC.</p>\n\n<p><em>Important Additional Details</em>: It is worth mentioning that currently I have all the C code that I want to run above <code>import \"C\"</code>. The reason for this is that the <code>relic_test.h</code> doesn't provide function prototypes, thus cgo does not recognize the functions through calls like <code>C.foo()</code>. Therefore, I put all the <code>test_pc.c</code> code in the following format:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n// #include&lt;&gt;\n/*\nvoid test1(){}\nvoid test2(){}\n.\n.\nvoid testN(){}\n*/\nimport \"C\"\nfunc main(){\n  C.test1()\n  C.testN()\n}\n</code></pre>\n\n<p><strong>Problem</strong></p>\n\n<p>Whenn I try running them from go, the execution gets \"stuck\" (i.e. the code is in execution but it just simply doesn't go to the next instruction) in one particular test. \nHow can I find out why the code gets stuck? How can I observe the execution flow of the program?</p>\n\n<p><strong>Thing I've Tried</strong></p>\n\n<p>Again, if I try using C directly (i.e. if I compile it with GCC and run it), the code works. Thus, GDB will also work.\nI've also tried  using <code>go tools cgo -debug-gcc</code>, but this only prints preprocessing directives. <code>go tools cgo -gccgo</code> doesn't output anything. finally, the Go debugger, Delve, is not able to debug the C calls.</p>\n"}, {"tags": ["go", "struct", "type-conversion", "embedding"], "comments": [{"owner": {"reputation": 26894, "user_id": 19020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpVEj.jpg?s=128&g=1", "display_name": "Dan Esparza", "link": "https://stackoverflow.com/users/19020/dan-esparza"}, "edited": false, "score": 1, "creation_date": 1501075432, "post_id": 45328119, "comment_id": 77618168, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/24613271/golang-is-conversion-between-different-struct-types-possible\">Golang : Is conversion between different struct types possible?</a>"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 1, "creation_date": 1501075476, "post_id": 45328119, "comment_id": 77618194, "body": "Can&#39;t you use. box := rated.Box ??"}, {"owner": {"reputation": 26894, "user_id": 19020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpVEj.jpg?s=128&g=1", "display_name": "Dan Esparza", "link": "https://stackoverflow.com/users/19020/dan-esparza"}, "edited": false, "score": 0, "creation_date": 1501075604, "post_id": 45328119, "comment_id": 77618295, "body": "Also related: <a href=\"https://stackoverflow.com/a/37725577/19020\">stackoverflow.com/a/37725577/19020</a>"}, {"owner": {"reputation": 1950, "user_id": 1405130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/irv7D.jpg?s=128&g=1", "display_name": "Paradiesstaub", "link": "https://stackoverflow.com/users/1405130/paradiesstaub"}, "reply_to_user": {"reputation": 26894, "user_id": 19020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpVEj.jpg?s=128&g=1", "display_name": "Dan Esparza", "link": "https://stackoverflow.com/users/19020/dan-esparza"}, "edited": false, "score": 0, "creation_date": 1501079437, "post_id": 45328119, "comment_id": 77621535, "body": "@DanEsparza I fail to see how my question could be a duplicate"}], "answers": [{"comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 3, "creation_date": 1501075203, "post_id": 45328195, "comment_id": 77617985, "body": "Go isn&#39;t object oriented in the same way C++ or Java is. For cases where you need polymorphism you should use interfaces. This answer is the best you can do without them."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1501075538, "last_edit_date": 1501075538, "creation_date": 1501075062, "answer_id": 45328195, "question_id": 45328119, "link": "https://stackoverflow.com/questions/45328119/downcast-higher-type-to-lower/45328195#45328195", "title": "downcast higher-type to lower", "body": "<p><a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"noreferrer\">Embedding</a> a type in a struct adds a field to the struct, and you can use the unqualified type name to refer to it (unqualified means omit the package name and the optional pointer sign).</p>\n\n<p>For example:</p>\n\n<pre><code>box := rated.Box\nfmt.Printf(\"%T %+v\", box, box)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/JCd4XNt2rC\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>main.Box {Name:foo}\n</code></pre>\n\n<p>Note that <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"noreferrer\">assignment</a> copies the value, so the <code>box</code> local variable will hold a copy of the value of the <code>RatedBox.Box</code> field. If you want them to be the \"same\" (to point to the same <code>Box</code> value), use a pointer, e.g.:</p>\n\n<pre><code>box := &amp;rated.Box\nfmt.Printf(\"%T %+v\", box, box)\n</code></pre>\n\n<p>But here of course type of <code>box</code> will be <code>*Box</code>.</p>\n\n<p>Or you may choose to embed the pointer type:</p>\n\n<pre><code>type RatedBox struct {\n    *Box\n    Points int\n}\n</code></pre>\n\n<p>And then (try it on the <a href=\"https://play.golang.org/p/HkVjCyb3e4\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>rated := RatedBox{Box: &amp;Box{Name: \"foo\"}, Points: 10}\n\nbox := rated.Box\nfmt.Printf(\"%T %+v\", box, box)\n</code></pre>\n\n<p>Output of the last 2:</p>\n\n<pre><code>*main.Box &amp;{Name:foo}\n</code></pre>\n"}], "owner": {"reputation": 1950, "user_id": 1405130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/irv7D.jpg?s=128&g=1", "display_name": "Paradiesstaub", "link": "https://stackoverflow.com/users/1405130/paradiesstaub"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1509, "favorite_count": 0, "accepted_answer_id": 45328195, "answer_count": 1, "score": 2, "last_activity_date": 1501075634, "creation_date": 1501074862, "last_edit_date": 1501075634, "question_id": 45328119, "link": "https://stackoverflow.com/questions/45328119/downcast-higher-type-to-lower", "title": "downcast higher-type to lower", "body": "<p>Is there beside copying the inner <code>Box</code> value by hand a language feature to down-cast <code>RatedBox</code> into a <code>Box</code>?</p>\n\n<pre><code>type Box struct {\n    Name string\n}\n\ntype RatedBox struct {\n    Box\n    Points int\n}\n\nfunc main() {\n    rated := RatedBox{Box: Box{Name: \"foo\"}, Points: 10}\n\n    box := Box(rated) // does not work\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iNpPgiIWqv\" rel=\"nofollow noreferrer\">go-playground</a></p>\n\n<pre><code>// works, but is quite verbose for structs with more members\nbox := Box{Name: rated.Name}\n</code></pre>\n"}, {"tags": ["arrays", "go", "variadic-functions"], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 1, "last_activity_date": 1501073704, "creation_date": 1501073704, "answer_id": 45327654, "question_id": 45327361, "link": "https://stackoverflow.com/questions/45327361/howto-fill-variant-args-from-a-loop/45327654#45327654", "title": "Howto fill variant args from a loop", "body": "<p>From the page you linked:</p>\n\n<pre><code>Note: You can also add data points one by one.\n</code></pre>\n\n<p>Therefore you need:</p>\n\n<pre><code>for i := 1; i &lt;= 4; i++ {\n   r.Train(regression.DataPoint(i*i, []float64{i, i, i}))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1501075711, "creation_date": 1501075711, "answer_id": 45328422, "question_id": 45327361, "link": "https://stackoverflow.com/questions/45327361/howto-fill-variant-args-from-a-loop/45328422#45328422", "title": "Howto fill variant args from a loop", "body": "<p>@Milo's answer is probably best for your particular case, but for the general case with variadic functions, you can append elements to a slice, then use the slice as the variadic argument list:</p>\n\n<pre><code>r.Train(points...)\n</code></pre>\n\n<p>Unfortunately the regression library is not very well-designed, as it has publicly-exposed functions that receive and return unexposed types, leaving you no way to work with them.</p>\n"}], "owner": {"reputation": 1133, "user_id": 102674, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/zNUye.jpg?s=128&g=1", "display_name": "Maciej A. Bednarz", "link": "https://stackoverflow.com/users/102674/maciej-a-bednarz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1501075711, "creation_date": 1501073026, "question_id": 45327361, "link": "https://stackoverflow.com/questions/45327361/howto-fill-variant-args-from-a-loop", "title": "Howto fill variant args from a loop", "body": "<p>for the following example I need to read values from a file (no problem) and put it into the method \"func (r *Regression) Train(d ...*dataPoint)\" as datapoints. This works:</p>\n\n<pre><code>r.Train(\n    regression.DataPoint(1, []float64{1, 1, 1}),\n    regression.DataPoint(4, []float64{2, 2, 2}),\n    regression.DataPoint(9, []float64{3, 3, 3}),\n)\n</code></pre>\n\n<p>but I would like to put it from a loop like this:</p>\n\n<pre><code>for i := 1; i &lt;= 4; i++ {\n   ??? regression.DataPoint(i*i, []float64{i, i, i}), ???\n}\n</code></pre>\n\n<p>I can not use an array of dataPoint as it is only visible in that package. Here is the full source code:</p>\n\n<p><a href=\"https://github.com/sajari/regression\" rel=\"nofollow noreferrer\">https://github.com/sajari/regression</a> (see example usage)</p>\n\n<p>Thank you very much,</p>\n\n<p>Maciej</p>\n"}, {"tags": ["elasticsearch", "go", "elasticsearch-bulk-api"], "answers": [{"tags": [], "owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "is_accepted": true, "score": 2, "last_activity_date": 1501070193, "creation_date": 1501070193, "answer_id": 45326273, "question_id": 45326078, "link": "https://stackoverflow.com/questions/45326078/usage-of-bulkindexrequest-from-golang-package-elastic/45326273#45326273", "title": "usage of BulkIndexRequest from golang package &#39;elastic&#39;", "body": "<p>You can find a few examples in the <a href=\"https://github.com/olivere/elastic/blob/504b3df94cbedf3cd45dc543e93fd33f603d1809/bulk_test.go\" rel=\"nofollow noreferrer\">test classes</a> and is pretty well <a href=\"https://github.com/olivere/elastic/wiki/BulkIndex\" rel=\"nofollow noreferrer\">explained in the wiki</a>. It goes like this:</p>\n\n<pre><code>indexName := \"someindex\"\ntypeName  := \"sometype\"\nindex1Req := NewBulkIndexRequest().Index(indexName).Type(typeName).Id(\"existing_id\").Doc({...})\nindex2Req := NewBulkIndexRequest().Index(indexName).Type(typeName).Id(\"existing_id2\").Doc({...})\n\nbulkRequest := client.Bulk()\nbulkRequest = bulkRequest.Add(index1Req)\nbulkRequest = bulkRequest.Add(index2Req)\n\nbulkResponse, err := bulkRequest.Do(context.TODO())\nif err != nil {\n    t.Fatal(err)\n}\n...\n</code></pre>\n"}], "owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1451, "favorite_count": 0, "accepted_answer_id": 45326273, "answer_count": 1, "score": 0, "last_activity_date": 1501070193, "creation_date": 1501069709, "question_id": 45326078, "link": "https://stackoverflow.com/questions/45326078/usage-of-bulkindexrequest-from-golang-package-elastic", "title": "usage of BulkIndexRequest from golang package &#39;elastic&#39;", "body": "<p>I want to use <code>BulkIndexRequest</code> from Go package <code>elastic</code>. I try to find examples but it seems that they don't exist. So if anybody has used it, could you please help me to use it for creating request something like below?</p>\n\n<pre><code>curl -s -H \"Content-Type: application/json\" -XPOST localhost:9200/someindex/sometype/_bulk -d'\n{ \"index\": {\"_id\": \"existing_id\"}}\n{ \"field1\": \"test1\"}\n{ \"index\": {\"_id\": \"existing_id2\"}}\n{ \"field2\": \"test2\"}\n'\n</code></pre>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1501065508, "post_id": 45324473, "comment_id": 77610644, "body": "I believe you actually want to use <code>^</code> to anchor the match at the start of the string, too: <code>^(0|\\+62|062|62)[0-9]+$</code>. What do you mean by it does not work?"}, {"owner": {"reputation": 13, "user_id": 8036075, "user_type": "registered", "profile_image": "https://graph.facebook.com/209686499544012/picture?type=large", "display_name": "Firman Firdaus", "link": "https://stackoverflow.com/users/8036075/firman-firdaus"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1501066133, "post_id": 45324473, "comment_id": 77611059, "body": "I have tried using ^ too, but still the same. I have using ^ for the first time until I get online tester link for validate my regex. It&#39;s does&#39;nt work properly on my golang code. It&#39;s like skip all the validations, but if I delete the regex validation, all validation (nonzero validation) working properly."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 8036075, "user_type": "registered", "profile_image": "https://graph.facebook.com/209686499544012/picture?type=large", "display_name": "Firman Firdaus", "link": "https://stackoverflow.com/users/8036075/firman-firdaus"}, "edited": false, "score": 0, "creation_date": 1501574656, "post_id": 45413716, "comment_id": 77825352, "body": "Great.. Thanks. It&#39;s working now.  It&#39;s all about symbol escaping in struct tags. I am using <code>(0|\\\\+62|062|62)[0-9]+$</code> and also with nonzero validate too.  <code>type ParamRequest struct { \tPhoneNumber string </code>validate:&quot;nonzero,regexp=^(0|\\\\+62|062|62)[0-9]+$&quot;` \tItemCode    string <code>validate:&quot;nonzero&quot;</code> }`   Thanks"}], "tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": true, "score": 0, "last_activity_date": 1501567031, "last_edit_date": 1501567031, "creation_date": 1501497796, "answer_id": 45413716, "question_id": 45324473, "link": "https://stackoverflow.com/questions/45324473/regex-phone-number-using-validation-v2-golang-package-not-working/45413716#45413716", "title": "Regex Phone Number Using Validation V2 Golang Package Not Working", "body": "<p>Because you are using regexp to check <code>PhoneNumber</code> that won't be matching if the value is empty it is better to remove <code>nonzero</code> from the validation.<br>\nI have checked out documentation and haven't found examples where you can use both: <code>nonzero</code> and <code>regexp</code>.<br>\nAlso you need to make your regex symbol-escaped, otherwise it won't be detected by reflection. It means you should use <code>(0|\\\\+62|062|62)[0-9]+$</code> in your code. Here is example where problem is: <a href=\"https://play.golang.org/p/h0xIzZiXpP\" rel=\"nofollow noreferrer\">symbol escaping in struct tags</a><br>\nAnd also, please try to use this regexp: <code>^\\\\+{0,1}0{0,1}62[0-9]+$</code></p>\n"}], "owner": {"reputation": 13, "user_id": 8036075, "user_type": "registered", "profile_image": "https://graph.facebook.com/209686499544012/picture?type=large", "display_name": "Firman Firdaus", "link": "https://stackoverflow.com/users/8036075/firman-firdaus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2942, "favorite_count": 1, "accepted_answer_id": 45413716, "answer_count": 1, "score": 1, "last_activity_date": 1501567031, "creation_date": 1501065314, "last_edit_date": 1501458660, "question_id": 45324473, "link": "https://stackoverflow.com/questions/45324473/regex-phone-number-using-validation-v2-golang-package-not-working", "title": "Regex Phone Number Using Validation V2 Golang Package Not Working", "body": "<p>I am having some trouble when using <code>github.com/go-validator/validator</code> to validate regex some phone numbers with this prefix +62, 62, 0, for instance number e.g. +628112blabla, 0822blablabla, 628796blablabla.</p>\n\n<p>I have try my regex on <a href=\"https://regex101.com/r/qtEg6H/9\" rel=\"nofollow noreferrer\">online regex tester</a> and no issue with the regex on that. Here the regex is : </p>\n\n<pre><code>(0|\\+62|062|62)[0-9]+$\n</code></pre>\n\n<p>But when I try with my go implement with it, the regex not working. This is my code for implement the purpose : </p>\n\n<pre><code>type ParamRequest struct {\n    PhoneNumber string `validate:\"nonzero,regexp=(0|\\+62|062|62)[0-9]+$\"`\n    ItemCode    string `validate:\"nonzero\"`\n    CallbackUrl string `validate:\"nonzero\"`\n}\n\nfunc (c *TopupAlloperatorApiController) Post() {\n    var v models.TopupAlloperatorApi\n\n    interf := make(map[string]interface{})\n\n    json.Unmarshal(c.Ctx.Input.RequestBody, &amp;interf)\n\n    logs.Debug(\" Json Input Request \", interf)\n    var phone, item, callback string\n\n    if _, a := interf[\"PhoneNumber\"].(string); a {\n        phone = interf[\"PhoneNumber\"].(string)\n    }\n    if _, b := interf[\"ItemCode\"].(string); b {\n        item = interf[\"ItemCode\"].(string)\n    }\n\n    if _, c := interf[\"CallbackUrl\"].(string); c {\n        callback = interf[\"CallbackUrl\"].(string)\n    }\n\n    ve := ParamRequest{\n        PhoneNumber: phone,\n        ItemCode:    item,\n        CallbackUrl: callback,\n    }\n\n    logs.Debug(\" Param Request \", ve)\n\n\n\n    err := validator.Validate(ve)\n    if err == nil {\n       //success\n    }else{\n      // not success\n    }\n</code></pre>\n\n<p>Many thanks for anything help. Thank you.</p>\n"}, {"tags": ["windows", "go", "import"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1501074238, "last_edit_date": 1501074238, "creation_date": 1501063669, "answer_id": 45323824, "question_id": 45323772, "link": "https://stackoverflow.com/questions/45323772/invalid-import-path-go-windows/45323824#45323824", "title": "Invalid import path - Go + windows", "body": "<p>You have to use forward slashes <code>/</code> in import paths (of import declarations), even if you're on Windows.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Import_declarations\" rel=\"nofollow noreferrer\">Spec: Import declarations:</a></p>\n\n<blockquote>\n  <p>Implementation restriction: A compiler may restrict ImportPaths to non-empty strings using only characters belonging to <a href=\"http://www.unicode.org/versions/Unicode6.3.0/\" rel=\"nofollow noreferrer\">Unicode's</a> L, M, N, P, and S general categories (the Graphic characters without spaces) and <strong>may also exclude the characters <code>!\"#$%&amp;'()*,:;&lt;=&gt;?[\\]^</code>{|}` and the Unicode replacement character U+FFFD</strong>.</p>\n</blockquote>\n\n<p>Any compiler may exclude the backslash <code>\\</code> character among others. Even if you would use one that doesn't, your code would not be portable.</p>\n\n<p>So instead try:</p>\n\n<pre><code>import (\n    pb \"github.com/sewelol/sgx-decryption-service/decryptionservice\"\n    dev \"github.com/sewelol/sgx-decryption-service/device\"\n    \"google.golang.org/rpc\"\n)\n</code></pre>\n"}], "owner": {"reputation": 320, "user_id": 7819897, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/addfe8428942813ac4ea7c40ac498ea3?s=128&d=identicon&r=PG&f=1", "display_name": "Dom Fraise", "link": "https://stackoverflow.com/users/7819897/dom-fraise"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1302, "favorite_count": 0, "accepted_answer_id": 45323824, "answer_count": 1, "score": 0, "last_activity_date": 1501074238, "creation_date": 1501063547, "last_edit_date": 1501064034, "question_id": 45323772, "link": "https://stackoverflow.com/questions/45323772/invalid-import-path-go-windows", "title": "Invalid import path - Go + windows", "body": "<p>When attempting to import to files from the windows file system:</p>\n\n<pre><code>import (\n    pb \"github.com\\\\sewelol\\\\sgx-decryption-service\\\\decryptionservice\"\n    dev \"github.com\\\\sewelol\\\\sgx-decryption-service\\\\device\"\n    \"google.golang.org\\\\rpc\"`\n)\n</code></pre>\n\n<p>I get this error</p>\n\n<p><code>server\\main.go:10:5: invalid import path: \"github.com\\\\sewelol\\\\sgx-decryption-service\\\\decryptionservice\"</code></p>\n\n<p>I have checked <code>$PATH</code> enviroment variable includes the directory that has <code>github.com</code>, and <code>$GOROOT</code> also is set up to point to the Go installation.</p>\n\n<p>I assume it is something to do with the file paths themselves, but I can't find any information on how to do filepaths in the windows environment.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["arrays", "go", "io", "stdout", "stdin"], "comments": [{"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "edited": false, "score": 0, "creation_date": 1501059998, "post_id": 45321981, "comment_id": 77606421, "body": "What is the input you need to take? Is it a series of integers in their base 10 string representation. Are they signed or unsigned only? If you could post a sample that would be helpful."}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "reply_to_user": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "edited": false, "score": 0, "creation_date": 1501061333, "post_id": 45321981, "comment_id": 77607452, "body": "Normal integers with base 10"}], "answers": [{"tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": false, "score": 1, "last_activity_date": 1501061323, "creation_date": 1501061323, "answer_id": 45322853, "question_id": 45321981, "link": "https://stackoverflow.com/questions/45321981/best-practices-to-take-input/45322853#45322853", "title": "Best practices to take input", "body": "<p>On the assumption that your input is space separated signed integers (in base 10), try the following:</p>\n\n<pre><code>s := bufio.NewScanner(os.StdIn)\ns.Split(bufio.ScanWords)\ni := 0\nfor s.Scan() &amp;&amp; i &lt; n {\n    dest[i], _ = strconv.ParseInt(s.Text(), 10, 64)\n    i++\n}\n</code></pre>\n\n<p>This shows with a quick benchmark to be about 5 times faster than using <code>fmt.Scanf</code>. It could probably be further optimised by writing a custom split function that did not worry about parsing UTF-8 runes and simply split on <code>' '</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "is_accepted": true, "score": 0, "last_activity_date": 1523983714, "creation_date": 1523983714, "answer_id": 49883492, "question_id": 45321981, "link": "https://stackoverflow.com/questions/45321981/best-practices-to-take-input/49883492#49883492", "title": "Best practices to take input", "body": "<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"os\"\n)\n// inp is a variable in which we store our whole input\nvar inp []byte\n// loc is used as index and remember till where we have seen our input\nvar loc int\n\nfunc main() {\n    // we read whole input and store it in inp and then append '\\n', so\n    // that we don't get any type index out of bound error, while \n    // scanning the last digit.\n    inp, _ = ioutil.ReadAll(os.Stdin)\n    inp = append(inp, '\\n')\n    // when ever scanInt is called, it will return single value of type int\n    // usage:\n    // n := scanInt()\n\n}\n\nfunc scanInt() (res int) {\n    // skip if byte value doesn't belong to integer and break when it is\n    // an integer\n    for ; inp[loc] &lt; 48 || inp[loc] &gt; 57; loc++ {\n    }\n    // If it is an integer parse it completely else break return the result\n\n    for ; inp[loc] &gt; 47 &amp;&amp; inp[loc] &lt; 58 ; loc++ {\n        res = (res &lt;&lt; 1  ) + (res &lt;&lt; 3) + int(inp[loc]-48)\n    }\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 49883492, "answer_count": 2, "score": -2, "last_activity_date": 1523983714, "creation_date": 1501059136, "last_edit_date": 1501068304, "question_id": 45321981, "link": "https://stackoverflow.com/questions/45321981/best-practices-to-take-input", "title": "Best practices to take input", "body": "<p>I have written a <code>mergeSort</code> function, which sorted 1 million integers in 750ms, but it takes 9 seconds to take input.</p>\n\n<p>This is how I have taken input to my slice, which is to be sorted.</p>\n\n<p>code snippet:</p>\n\n<pre><code>array := make([]int,n)\nfor i := 0; i &lt; n; i++ {\n    fmt.Scanf(\"%d\",&amp;array[i])\n}\n</code></pre>\n\n<p>What I need is, an efficient way to take integers as input into a slice.\nInput contains only integers, seperated by space or each integer in new-line.</p>\n\n<p>Sample Input 1:</p>\n\n<pre><code>3\n9\n1\n13\n</code></pre>\n\n<p>Sample Input 2:</p>\n\n<p><code>3    9    1    13</code></p>\n\n<p>If efficient solution is available for any one type of Input, it would suffice</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 107, "user_id": 4566048, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-vFaQTCQaz9k/AAAAAAAAAAI/AAAAAAAAACA/z6k7NsmafK0/photo.jpg?sz=128", "display_name": "xuefeng huang", "link": "https://stackoverflow.com/users/4566048/xuefeng-huang"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1501126262, "post_id": 45321539, "comment_id": 77643385, "body": "thanks to @icza for pointing to another post already has answers."}, {"owner": {"reputation": 107, "user_id": 4566048, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-vFaQTCQaz9k/AAAAAAAAAAI/AAAAAAAAACA/z6k7NsmafK0/photo.jpg?sz=128", "display_name": "xuefeng huang", "link": "https://stackoverflow.com/users/4566048/xuefeng-huang"}, "edited": false, "score": 0, "creation_date": 1501126668, "post_id": 45321539, "comment_id": 77643499, "body": "This code snippet shows that the memory is not garbage collected if another pointer is used to store the address <a href=\"https://play.golang.org/p/YC4ax6k6dm\" rel=\"nofollow noreferrer\">play.golang.org/p/YC4ax6k6dm</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": false, "score": 0, "last_activity_date": 1501060093, "last_edit_date": 1501060093, "creation_date": 1501058284, "answer_id": 45321621, "question_id": 45321539, "link": "https://stackoverflow.com/questions/45321539/golang-map-value-returned-by-value-or-reference/45321621#45321621", "title": "golang map value returned by value or reference?", "body": "<p>Go's current implementation is a <a href=\"https://blog.golang.org/go15gc\" rel=\"nofollow noreferrer\">parallel mark-and-sweep</a> garbage collector. </p>\n\n<p>To be precise on the scope where <code>entity</code> is declared, this object won't be garbaged collected, by the same reason you mentioned - after the deletion from the map there still is a reference to the object. </p>\n\n<p>The state of the map is internal, and it will only be removed from there after the deletion operation.</p>\n"}], "owner": {"reputation": 107, "user_id": 4566048, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-vFaQTCQaz9k/AAAAAAAAAAI/AAAAAAAAACA/z6k7NsmafK0/photo.jpg?sz=128", "display_name": "xuefeng huang", "link": "https://stackoverflow.com/users/4566048/xuefeng-huang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1024, "favorite_count": 0, "closed_date": 1501061634, "answer_count": 1, "score": -1, "last_activity_date": 1501060093, "creation_date": 1501058054, "question_id": 45321539, "link": "https://stackoverflow.com/questions/45321539/golang-map-value-returned-by-value-or-reference", "closed_reason": "Duplicate", "title": "golang map value returned by value or reference?", "body": "<p>let's I have a map with key of string and value of pointer to a struct </p>\n\n<pre><code>type Entity struct{}\nentity := &amp;Entity{}\nm := map[string]*Entity{\"foo\":entity}\n</code></pre>\n\n<p>I get the value and delete the entry later</p>\n\n<pre><code>en := m[\"foo\"]\ndelete(m, \"foo\")\n</code></pre>\n\n<p>my question is that will the memory be garbage collected since the pointer to it is removed from the map? On the other note, I have the new pointer <strong>en</strong> before I delete the entry, it's a copy of the pointer also points to the same memory location, so the memory will not be garbage collected even the map entry is deleted? I am confused, help appreciated.</p>\n"}, {"tags": ["json", "dictionary", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501058601, "post_id": 45320313, "comment_id": 77605373, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/25465566/golang-parse-json-array-into-data-structure\">Golang parse JSON array into data structure</a>"}], "answers": [{"tags": [], "owner": {"reputation": 303, "user_id": 8008395, "user_type": "registered", "profile_image": "https://graph.facebook.com/1019408758194319/picture?type=large", "display_name": "Bohdan Kostko", "link": "https://stackoverflow.com/users/8008395/bohdan-kostko"}, "is_accepted": false, "score": 1, "last_activity_date": 1501055996, "creation_date": 1501055996, "answer_id": 45320828, "question_id": 45320313, "link": "https://stackoverflow.com/questions/45320313/how-to-decode-json-in-go/45320828#45320828", "title": "How to decode json in Go", "body": "<p>By definition <code>map</code> is a data structure that keeps a reference to specific values using some predefined keys. </p>\n\n<p>In your case, you're having a data structure called collection (array of maps). If you want to keep your collection items as another map values the easiest way to achieve this is to transform your collection into map using indexes of the array (collection) as keys. </p>\n\n<p>However I'm not sure you would be able to do it straight-head during your <code>json.Unmarshal</code> without applying some additional transformations</p>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 2, "last_activity_date": 1501056776, "creation_date": 1501056776, "answer_id": 45321079, "question_id": 45320313, "link": "https://stackoverflow.com/questions/45320313/how-to-decode-json-in-go/45321079#45321079", "title": "How to decode json in Go", "body": "<p>A target data structure for unmarshaling can be defined as <code>val := []map[string]interface{}{}</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    input := []byte(`[{\"name\":\"Name1\",\"age\":20},{\"name\":\"Name2\",\"age\":29}]`)\n    val := []map[string]interface{}{}\n    if err := json.Unmarshal(input, &amp;val); err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%v\\n\", val)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/usZqVUAhso\" rel=\"nofollow noreferrer\">Go Playgroung</a></p>\n\n<p>This gives us a slice of maps. If you want to put those maps inside another map, there should be a key for elements of that map (like their indexes in the slice).</p>\n"}, {"tags": [], "owner": {"reputation": 614, "user_id": 6424168, "user_type": "registered", "accept_rate": 30, "profile_image": "https://lh6.googleusercontent.com/-Ma90L9K1ny8/AAAAAAAAAAI/AAAAAAAAABI/9ZMB4GR_z0M/photo.jpg?sz=128", "display_name": "Yur Gasparyan", "link": "https://stackoverflow.com/users/6424168/yur-gasparyan"}, "is_accepted": false, "score": 0, "last_activity_date": 1501057579, "creation_date": 1501057579, "answer_id": 45321354, "question_id": 45320313, "link": "https://stackoverflow.com/questions/45320313/how-to-decode-json-in-go/45321354#45321354", "title": "How to decode json in Go", "body": "<p>I have already fix this problem, Here is my logic</p>\n\n<pre><code>type Meta struct {\n    Name string `json:\"name\"`\n    Age int `json:\"age\"`\n}\n\ntype Metadata struct {\n    Collection []Meta\n}\n\n\nbt:= []byte(metadatas[0])\ndat := make([]Meta, 0)\nif err := json.Unmarshal(bt, &amp;dat); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>And as a response I am getting array with objects</p>\n"}], "owner": {"reputation": 614, "user_id": 6424168, "user_type": "registered", "accept_rate": 30, "profile_image": "https://lh6.googleusercontent.com/-Ma90L9K1ny8/AAAAAAAAAAI/AAAAAAAAABI/9ZMB4GR_z0M/photo.jpg?sz=128", "display_name": "Yur Gasparyan", "link": "https://stackoverflow.com/users/6424168/yur-gasparyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 3, "score": -2, "last_activity_date": 1501057579, "creation_date": 1501054378, "question_id": 45320313, "link": "https://stackoverflow.com/questions/45320313/how-to-decode-json-in-go", "title": "How to decode json in Go", "body": "<p>I have a json look like this</p>\n\n<pre><code>[{\"name\":\"Name1\",\"age\":20},{\"name\":\"Name2\",\"age\":29}]\n</code></pre>\n\n<p>And I want to decode it to map look like this</p>\n\n<p>map[map[\"name\":\"Name1\" ....] ,map[\"name\":\"Name2\",....]]</p>\n\n<p>In my case I have a logic look like this</p>\n\n<pre><code>bt:= []byte(metadatas[0])\nvar dat interface{}\nif err := json.Unmarshal(bt, dat); err != nil {\n    panic(err)\n}\nfmt.Println(dat)\n</code></pre>\n\n<p>and as a response I am getting </p>\n\n<pre><code>[map[\"name\":\"Name1\" ....] ,map[\"name\":\"Name2\",....]]\n</code></pre>\n\n<p>How can I get a map instead of</p>\n"}, {"tags": ["string", "go", "formatting", "string-formatting"], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "edited": false, "score": 0, "creation_date": 1501060798, "post_id": 45320241, "comment_id": 77607066, "body": "Thanks @icza, i just found one more way, what is your view?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1501055454, "last_edit_date": 1501055454, "creation_date": 1501054182, "answer_id": 45320241, "question_id": 45319427, "link": "https://stackoverflow.com/questions/45319427/is-there-any-way-to-show-the-output-in-pretty-way-without-7-48-etc-in-pri/45320241#45320241", "title": "Is there any way to show the output in pretty way without 7, -48 .... etc in print statements?", "body": "<p>No, there is not.</p>\n\n<p>But you can write a utility function which automates all these, and all you need to do is pass the key-value pairs you want to pretty-print.</p>\n\n<p>Let's model the key-values with this type:</p>\n\n<pre><code>type KeyValue struct {\n    Key   string\n    Value interface{}\n}\n</code></pre>\n\n<p>Note the value may be of any type, not just a <code>string</code> value. We'll use the default formatting when printing it. If you want a format other than the default, you can always convert it to <code>string</code> to your liking, and set that as the value.</p>\n\n<p>The pretty-print utility function (explanation follows below):</p>\n\n<pre><code>var aligns = map[bool]string{true: \"-\"}\n\nfunc printKeyValues(keyRight, valueRight bool, kvs ...KeyValue) {\n    // First convert values to string and find max key and max value lengths:\n    values := make([]string, len(kvs))\n    maxKey, maxValue := 0, 0\n    for i, kv := range kvs {\n        if length := utf8.RuneCountInString(kv.Key); length &gt; maxKey {\n            maxKey = length\n        }\n        values[i] = fmt.Sprint(kv.Value)\n        if length := utf8.RuneCountInString(values[i]); length &gt; maxValue {\n            maxValue = length\n        }\n    }\n\n    // Generate format string:\n    fs := fmt.Sprintf(\"%%%s%ds: %%%s%ds|\\n\",\n        aligns[keyRight], maxKey+1, aligns[valueRight], maxValue+1)\n\n    // And now print the key-values:\n    for i, kv := range kvs {\n        fmt.Printf(fs, kv.Key, values[i])\n    }\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>printKeyValues(false, true, []KeyValue{\n    {\"IQN\", \"asdfl;kj\"},\n    {\"Volume\", \"asdf;lkjasdf\"},\n    {\"Portal\", \"asdf\"},\n    {\"Size\", 12345678},\n}...)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>    IQN: asdfl;kj     |\n Volume: asdf;lkjasdf |\n Portal: asdf         |\n   Size: 12345678     |\n</code></pre>\n\n<p>Another test:</p>\n\n<pre><code>printKeyValues(true, false, []KeyValue{\n    {\"IQN\", \"asdfl;kj\"},\n    {\"Volume\", \"asdf;lkjasdf\"},\n    {\"Portal\", \"asdf\"},\n    {\"Size\", 12345678},\n}...)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>IQN    :      asdfl;kj|\nVolume :  asdf;lkjasdf|\nPortal :          asdf|\nSize   :      12345678|\n</code></pre>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/wvZ6Y1Q6tV\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h2>Explanation</h2>\n\n<p>The <code>printKeyValues()</code> first ranges over the key-value pairs, and converts values to <code>string</code> values, using the default formatting by calling <a href=\"https://golang.org/pkg/fmt/#Sprint\" rel=\"nofollow noreferrer\"><code>fmt.Sprint()</code></a>. Now we can find the max key length and the max value length. Note that length of a <code>string</code> is not <code>len(s)</code>, as that returns the byte-length in UTF-8 encoding (which is how Go stores strings in memory). Instead to get the number of characters (or more precisely the number of <code>rune</code>s), we used <a href=\"https://golang.org/pkg/unicode/utf8/#RuneCountInString\" rel=\"nofollow noreferrer\"><code>utf8.RuneCountInString()</code></a>.</p>\n\n<p>Once we have this, we can generate the format string where the max key length and max value length is used. We will also give the possibility to control whether we want to align keys and values to the left or right, in the format string this means a <code>-</code> sign in case of right alignment. To get an empty string <code>\"\"</code> in case of left and a <code>\"-\"</code> in case of right, for compact code I used a simple map:</p>\n\n<pre><code>var aligns = map[bool]string{true: \"-\"}\n</code></pre>\n\n<p>Indexing this map with <code>false</code> gives the zero value of the value type of the map which is <code>\"\"</code>, and indexing it with <code>true</code> will give the associated value which is <code>\"-\"</code>. And since this map is always the same, I moved it outside of the function (small optimization).</p>\n\n<p>To generate the format string we used <a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"nofollow noreferrer\"><code>fmt.Sprintf()</code></a>:</p>\n\n<pre><code>fs := fmt.Sprintf(\"%%%s%ds: %%%s%ds|\\n\",\n    aligns[keyRight], maxKey+1, aligns[valueRight], maxValue+1)\n</code></pre>\n\n<p>Note that <code>%</code> signs need to be doubled as that is special in format strings.</p>\n\n<p>One final task remained: to use the generated format string to print all key-value pairs.</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1501061003, "post_id": 45322582, "comment_id": 77607223, "body": "This solution is still not &quot;dynamic&quot;, you have to &quot;precalculate&quot; and apply preformatting (in the form of certain amount of spaces). To achieve this, you don&#39;t need any templates, you can do the same with <code>fmt.Printf()</code>. My solution works on any input, and it calculates and applies dynamic indentation."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501075842, "post_id": 45322582, "comment_id": 77618476, "body": "Also for simple cases like this, <code>Printf</code> is likely to perform far better than templates due to the simpler implementation."}, {"owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1501134341, "post_id": 45322582, "comment_id": 77645944, "body": "@icza i agree with you and your solution is also excellent, i have tried this but in my organisation, they say that use templates they are very simple to use and easy to understand."}], "tags": [], "owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "is_accepted": false, "score": -2, "last_activity_date": 1501060667, "creation_date": 1501060667, "answer_id": 45322582, "question_id": 45319427, "link": "https://stackoverflow.com/questions/45319427/is-there-any-way-to-show-the-output-in-pretty-way-without-7-48-etc-in-pri/45322582#45322582", "title": "Is there any way to show the output in pretty way without 7, -48 .... etc in print statements?", "body": "<p>Thanks @icza, i found one more way, have a look on this :-)</p>\n\n<pre><code>package main\n\nimport (\n  \"text/template\"\n  \"os\"\n)\n\nfunc main() {\n   type Annotations struct {\n     IQN    string\n     Volume string\n     Portal string\n     Size   string\n   }\n   annotation := Annotations{\n\n     IQN: \"openebs.io\",\n     Volume: \"vol\",\n     Portal: \"10.29.1.1:3260\",\n     Size: \"1G\",\n\n   }\n   tmpl, err := template.New(\"test\").Parse(\"IQN     : \n{{.IQN}}\\nVolume  : {{.Volume}}\\nPortal  : {{.Portal}}\\nSize    : \n{{.Size}}\")\n   if err != nil {\n        panic(err)\n    }\n  err = tmpl.Execute(os.Stdout, annotation)\n  if err != nil {\n        panic(err)\n  }\n}\n</code></pre>\n\n<p>Output :</p>\n\n<pre><code>IQN     : openebs.io\nVolume  : vol\nPortal  : 10.29.1.1:3260\nSize    : 1G\n</code></pre>\n\n<p>Here is the link <a href=\"https://play.golang.org/p/v310RXD6Gv\" rel=\"nofollow noreferrer\">The Go Playground</a></p>\n"}], "owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 45320241, "answer_count": 2, "score": 0, "last_activity_date": 1501060667, "creation_date": 1501051670, "last_edit_date": 1501055510, "question_id": 45319427, "link": "https://stackoverflow.com/questions/45319427/is-there-any-way-to-show-the-output-in-pretty-way-without-7-48-etc-in-pri", "title": "Is there any way to show the output in pretty way without 7, -48 .... etc in print statements?", "body": "<p>The code is given below</p>\n\n<pre><code>fmt.Printf(\"%7s: %-48s\\n\", \"IQN\", annotations.Iqn)\nfmt.Printf(\"%7s: %-16s\\n\", \"Volume\", args[0])\nfmt.Printf(\"%7s: %-15s\\n\", \"Portal\", annotations.TargetPortal)\nfmt.Printf(\"%7s: %-6s\\n\\n\", \"Size\", annotations.VolSize)\n</code></pre>\n"}, {"tags": ["c", "unix", "go"], "answers": [{"comments": [{"owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "edited": false, "score": 0, "creation_date": 1501062082, "post_id": 45321654, "comment_id": 77608044, "body": "I know this repo and I have read it. I just want to try out. Thanks for your answer. I got <code>undefined: utmp.ReadUtmp</code>, <code>undefined: utmp.UtmpxFile</code>."}, {"owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "edited": false, "score": 0, "creation_date": 1501062289, "post_id": 45321654, "comment_id": 77608203, "body": "I want to wait to see is there other answer."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 1, "creation_date": 1501062339, "post_id": 45321654, "comment_id": 77608239, "body": "GZ Xue, did you run <code>go get github.com&#47;ericlagergren&#47;go-gnulib&#47;utmp</code> to install the utmp library?"}, {"owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1501062480, "post_id": 45321654, "comment_id": 77608354, "body": "yes, but I got <code>package github.com&#47;ericlagergren&#47;go-gnulib: no buildable Go source files in &#47;Users&#47;xxx&#47;code&#47;src&#47;github.com&#47;ericlagergren&#47;go-gnulib</code> @Mark"}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "edited": false, "score": 1, "creation_date": 1501062747, "post_id": 45321654, "comment_id": 77608571, "body": "As Mark says, you need to run <code>go get github.com&#47;ericlagergren&#47;go-gnulib&#47;utmp</code>. You need the <code>utmp</code> at the end. Alternatively, if easier, install the <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">dep</a> tool and run <code>dep init</code> in your project to automatically install the package."}], "tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": true, "score": 2, "last_activity_date": 1501060191, "last_edit_date": 1501060191, "creation_date": 1501058364, "answer_id": 45321654, "question_id": 45318603, "link": "https://stackoverflow.com/questions/45318603/how-to-cast-bytes-to-structc-struct-in-go/45321654#45321654", "title": "How to cast bytes to struct(c struct) in go?", "body": "<p>I think you're going about this the wrong way. If you were wanting to use the C library, you would use the C library to read the file.</p>\n\n<p>Don't use cgo purely to have struct definitions, you should create these in Go yourself. You could then write the appropriate marshal / unmarshal code to read from the raw bytes. </p>\n\n<p>A quick Google shows that someone has already done the work required to convert a look of the relevant C library to Go. See the <a href=\"https://github.com/ericlagergren/go-gnulib/tree/master/utmp\" rel=\"nofollow noreferrer\">utmp repository</a>.</p>\n\n<p>A short example of how this could be used is:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"log\"\n\n    \"github.com/ericlagergren/go-gnulib/utmp\"\n)\n\nfunc handleError(err error) {\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc byteToStr(b []byte) string {\n    i := bytes.IndexByte(b, 0)\n    if i == -1 {\n        i = len(b)\n    }\n    return string(b[:i])\n}\n\nfunc main() {\n    list, err := utmp.ReadUtmp(utmp.UtmpxFile, 0)\n    handleError(err)\n    for _, u := range list {\n        fmt.Println(byteToStr(u.User[:]))\n    }\n} \n</code></pre>\n\n<p>You can view the <a href=\"https://godoc.org/github.com/ericlagergren/go-gnulib/utmp\" rel=\"nofollow noreferrer\">GoDoc</a> for the <code>utmp</code> package for more information.</p>\n"}], "owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 45321654, "answer_count": 1, "score": 0, "last_activity_date": 1501060191, "creation_date": 1501048995, "question_id": 45318603, "link": "https://stackoverflow.com/questions/45318603/how-to-cast-bytes-to-structc-struct-in-go", "title": "How to cast bytes to struct(c struct) in go?", "body": "<pre><code>package main\n\n/*\n#define _GNU_SOURCE 1\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;utmpx.h&gt;\n#include &lt;fcntl.h&gt;\n#include &lt;unistd.h&gt;\n\nchar *path_utmpx = _PATH_UTMPX;\n\ntypedef struct utmpx utmpx;\n*/\nimport \"C\"\nimport (\n  \"fmt\"\n  \"io/ioutil\"\n)\n\ntype Record C.utmpx\n\nfunc main() {\n\n  path := C.GoString(C.path_utmpx)\n\n  content, err := ioutil.ReadFile(path)\n  handleError(err)\n\n  var records []Record\n\n  // now we have the bytes(content), the struct(Record/C.utmpx)\n  // how can I cast bytes to struct ?\n}\n\nfunc handleError(err error) {\n  if err != nil {\n    panic(\"bad\")\n  }\n}\n</code></pre>\n\n<p>I'm trying to read <code>content</code> into <code>Record</code> \nI have asked a few related questions.</p>\n\n<p><a href=\"https://stackoverflow.com/q/44036358/5819540\">Cannot access c variables in cgo</a></p>\n\n<p><a href=\"https://stackoverflow.com/q/45300938/5819540\">Can not read utmpx file in go</a></p>\n\n<p>I have read some articles and posts but still cannot figure out a way to do this. </p>\n"}, {"tags": ["go", "hugo"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1501043688, "post_id": 45317487, "comment_id": 77597040, "body": "Maybe read <a href=\"https://github.com/gohugoio/hugo/blob/master/hugolib/site.go#L61\" rel=\"nofollow noreferrer\">the source</a>?"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501044226, "post_id": 45317487, "comment_id": 77597213, "body": "Ruby and Python are <i>much</i> slower than their proponents would like you to believe."}, {"owner": {"reputation": 11544, "user_id": 26196, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/ceb4ec169153ed2cdc5a6fb93c5829a6?s=128&d=identicon&r=PG", "display_name": "anonymous coward", "link": "https://stackoverflow.com/users/26196/anonymous-coward"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1501087779, "post_id": 45317487, "comment_id": 77627950, "body": "@captncraig <i>Maybe</i> I&#39;m still new to Go, and wouldn&#39;t have known exactly where to look, after having spent no less than 30 minutes digging around the Hugo project files already. Given you are probably a nice, helpful person, the phrasing and short length of your comment doesn&#39;t come across that way. Please be gentle with potential noobs in the future."}], "answers": [{"comments": [{"owner": {"reputation": 11544, "user_id": 26196, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/ceb4ec169153ed2cdc5a6fb93c5829a6?s=128&d=identicon&r=PG", "display_name": "anonymous coward", "link": "https://stackoverflow.com/users/26196/anonymous-coward"}, "edited": false, "score": 0, "creation_date": 1501088114, "post_id": 45317631, "comment_id": 77628184, "body": "Thanks so much for taking the time to answer with details, and clarity, pointing out where things are, etc. Very helpful way to answer."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1501044154, "creation_date": 1501044154, "answer_id": 45317631, "question_id": 45317487, "link": "https://stackoverflow.com/questions/45317487/how-does-hugo-maintain-site-wide-data-like-site-allpages/45317631#45317631", "title": "How does Hugo maintain site-wide data, like .Site.AllPages?", "body": "<p>You can see <a href=\"https://github.com/gohugoio/hugo/blob/873a6f18851bcda79d562ff6c02e1109e8e31a88/hugolib/page_collections.go#L28-L30\" rel=\"nofollow noreferrer\"><code>AllPages</code> in <code>hugolib/page_collections.go</code></a>.  </p>\n\n<p>A <code>git blame</code> shows that it was modified in <a href=\"https://github.com/gohugoio/hugo/commit/698b994f714174449fd1ea37c39058ea14f6deee\" rel=\"nofollow noreferrer\">Sept. 2016 for Hugo v0.18 in commit 698b994</a>, in order to fix <a href=\"https://github.com/gohugoio/hugo/issues/2297\" rel=\"nofollow noreferrer\">PR 2297 Fix Node vs Page</a>.</p>\n\n<p>That PR references the <a href=\"https://discourse.gohugo.io/t/node-improvements/1593\" rel=\"nofollow noreferrer\">discussion/improvement proposal \"Node improvements\"</a> </p>\n\n<blockquote>\n  <p>Most of the \"problems\" with this gets much easier once we agree that a page is just a page that is just a ... page...</p>\n  \n  <p>And that a Node is just a Page with a discriminator.</p>\n  \n  <p>So:</p>\n  \n  <ul>\n  <li>Today's pages are Page with discriminator \"page\"</li>\n  <li>Homepage is Page with discriminator \"home\" or whatever</li>\n  <li>Taxonomies are Pages with discriminator \"taxonomy\"</li>\n  <li>...</li>\n  </ul>\n  \n  <p>They have some structural differences (pagination etc.), but they are basically just pages.</p>\n  \n  <p>With that in mind we can put them all in one collection and add query filters on discriminator:</p>\n  \n  <ul>\n  <li><code>.Site.Pages</code>: filtered by discriminator = 'page'<br>\n  <code>*.Site.All</code>: No filter</li>\n  <li><code>where</code>: when the sequence is Pages add discriminator = 'page', but let user override</li>\n  </ul>\n</blockquote>\n\n<p>That key (the discriminator) allows to retrieve quickly all 'pages'.</p>\n"}, {"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1501069959, "post_id": 45322910, "comment_id": 77613919, "body": "Great answer. +1. I was trying to get back to the origin of Site.page with my answer, but yours is more specific."}, {"owner": {"reputation": 11544, "user_id": 26196, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/ceb4ec169153ed2cdc5a6fb93c5829a6?s=128&d=identicon&r=PG", "display_name": "anonymous coward", "link": "https://stackoverflow.com/users/26196/anonymous-coward"}, "edited": false, "score": 0, "creation_date": 1501088001, "post_id": 45322910, "comment_id": 77628113, "body": "@bep Thanks so much for taking the time to answer. I&#39;m still relatively new to Go, and was intensely curious about the internals of Hugo. So, is it not an oversimplification that all content/meta is read into some kind of structure and (held in memory?) and then concurrent tasks start building pages?"}, {"owner": {"reputation": 1386, "user_id": 3973292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71393bd67bd84015884ff6127afc5ed1?s=128&d=identicon&r=PG&f=1", "display_name": "bep", "link": "https://stackoverflow.com/users/3973292/bep"}, "edited": false, "score": 0, "creation_date": 1501108416, "post_id": 45322910, "comment_id": 77639089, "body": "Most of the data is in memory when the rendering starts (we do a fair amount of lazy loading/lazy generating of stuff accessed from templates -- i.e. we don&#39;t need to calculate reading time of every content file if that value is never used in the templates), but simplified, you could look at it as:  file reading and processing (concurrent) -- site assembly etc. (serial, i.e. one Go routine) -- rendering (concurrent)"}], "tags": [], "owner": {"reputation": 1386, "user_id": 3973292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71393bd67bd84015884ff6127afc5ed1?s=128&d=identicon&r=PG&f=1", "display_name": "bep", "link": "https://stackoverflow.com/users/3973292/bep"}, "is_accepted": true, "score": 4, "last_activity_date": 1501061476, "creation_date": 1501061476, "answer_id": 45322910, "question_id": 45317487, "link": "https://stackoverflow.com/questions/45317487/how-does-hugo-maintain-site-wide-data-like-site-allpages/45322910#45322910", "title": "How does Hugo maintain site-wide data, like .Site.AllPages?", "body": "<p>There is no magic, and Hugo does not start any rendering until the <code>.Site.Pages</code> etc. collections are filled and ready.</p>\n\n<p>Some key points here:</p>\n\n<ul>\n<li>We have a processing pipeline where we do concurrent processing whenever we can, so your CPUs should be pretty busy.</li>\n<li>Whenever we do content manipulation (shortcodes, emojis etc.), you will most likely see a hand crafted parser or replacement function that is built for speed.</li>\n<li>We really care about the \"being fast\" part, so we have a solid set of benchmarks to reveal any performance regressions.</li>\n<li>Hugo is built with <code>Go</code> -- which is really fast, and have a really great set of tools for this (<code>pprof</code>, benchmark support etc.)</li>\n</ul>\n\n<p>Some other points that makes the <code>hugo server</code> variant even faster than the regular <code>hugo</code> build:</p>\n\n<ul>\n<li>Hugo uses a virtual file system, and we render directly to memory when in server/development mode.</li>\n<li>We have some partial reloading logic in there. So, even if we render everything every time, we try to reload and rebuild only the content files that have changed and we don't reload/rebuild templates if it is a content change etc.</li>\n</ul>\n\n<p>I'm bep on GitHub, the main developer on Hugo.</p>\n"}], "owner": {"reputation": 11544, "user_id": 26196, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/ceb4ec169153ed2cdc5a6fb93c5829a6?s=128&d=identicon&r=PG", "display_name": "anonymous coward", "link": "https://stackoverflow.com/users/26196/anonymous-coward"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 1, "accepted_answer_id": 45322910, "answer_count": 2, "score": 2, "last_activity_date": 1501061476, "creation_date": 1501043288, "question_id": 45317487, "link": "https://stackoverflow.com/questions/45317487/how-does-hugo-maintain-site-wide-data-like-site-allpages", "title": "How does Hugo maintain site-wide data, like .Site.AllPages?", "body": "<p>I'm looking for some bite-sized examples on how Hugo <em>might</em> be managing site-wide data, like <code>Site.AllPages</code>. </p>\n\n<p>Specifically, Hugo seems <em>too fast</em> to be reading in <em>every</em> file and it's metadata, before beginning to generate pages and making things like <code>.Site.AllPages</code> available -- but obviously that has to be the case. </p>\n\n<p>Are Ruby (Jekyll) and Python (Pelican) really just that slow, <strong>or is there some specific (algorithmic) method that Hugo employs to generate pages before everything is ready?</strong> </p>\n"}, {"tags": ["go", "initialization"], "comments": [{"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1501048305, "post_id": 45317074, "comment_id": 77598805, "body": "The third slice myArr3 may be the most readable representation which just about anyone (including those who have little idea about GO) can understand. Arrays are different in Golang - array of a given size is &quot;almost&quot; like a type by itself, you can&#39;t equate/assign it with/to arrays of other sizes. It&#39;s better to get a good understanding of arrays - if you are new to Go &quot;The Go Programming Language&quot; by Donovan and Kernighan is also a good read."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1501048863, "post_id": 45317074, "comment_id": 77599071, "body": "Also unless there&#39;s a reason it&#39;s good to initialize the slice to the desired size, otherwise it&#39;s an additional cost (to allocate) when appending items."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1501051272, "post_id": 45317074, "comment_id": 77600381, "body": "Read it from the official wiki of Go <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#declaring-empty-slices\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 7796, "user_id": 2334254, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-6e2XuTZAjgM/AAAAAAAAAAI/AAAAAAAAABU/JpF2-AkHsH4/photo.jpg?sz=128", "display_name": "kpie", "link": "https://stackoverflow.com/users/2334254/kpie"}, "edited": false, "score": 0, "creation_date": 1501042044, "post_id": 45317241, "comment_id": 77596545, "body": "Ok so if I use <code>var arr [0]int</code> I have an array with 0 capacity, same with <code>arr:=[0]int{}</code> however if I do <code>arr := make([]int,0,0)</code> I get a slice. Seems wild. Am I correct to assume that you can only <code>make</code> slices and you cannot <code>make</code> arrays? What is the second argument to make?"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 7796, "user_id": 2334254, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-6e2XuTZAjgM/AAAAAAAAAAI/AAAAAAAAABU/JpF2-AkHsH4/photo.jpg?sz=128", "display_name": "kpie", "link": "https://stackoverflow.com/users/2334254/kpie"}, "edited": false, "score": 1, "creation_date": 1501042272, "post_id": 45317241, "comment_id": 77596598, "body": "Yup. Coming from C I found it really weird at first myself... Arrays in go code are actually really rare, slices are almost always better. (I&#39;m not sure you can declare an array with size 0, never tried it) Take some time to read the go spec, it&#39;s nice and short and has tons of useful information! <code>make</code> only produces slices (and channels, but that is totally different). The second argument is the starting length of the slice, the third is it&#39;s maximum capacity before it need to reallocate itself. The third argument is optional."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 1, "creation_date": 1501043808, "post_id": 45317241, "comment_id": 77597066, "body": "Yes, you can declare an array with <code>count == 0</code>, which is weird to me since an array in C must have <code>count &gt;= 1</code>. Arrays have their uses too, primarily in your own code. The <code>golang.org&#47;x&#47;text&#47;encoding&#47;unicode</code> package uses it in <a href=\"https://github.com/golang/text/blob/master/encoding/unicode/unicode.go#L160\" rel=\"nofollow noreferrer\">its unexported <code>mibValue</code> global variable</a>. Note that many APIs require slices, so you likely want to use a slice for an exported identifier, but an array is fine if your identifier is unexported (nobody should be using it anyway, right? :)"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 2, "creation_date": 1501044086, "post_id": 45317241, "comment_id": 77597162, "body": "A good example of an array in action is <code>crypto&#47;md5</code>. A md5 checksum is always 16 bytes, so it makes perfect sense to use <code>[16]byte</code> to store one."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1604412466, "post_id": 45317241, "comment_id": 114335728, "body": "It is worth adding that <code>myArr3 == nil</code> is true, whereas it&#39;s false for <code>myArr1</code> and <code>myArr2</code>."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 5, "last_activity_date": 1501041786, "creation_date": 1501041786, "answer_id": 45317241, "question_id": 45317074, "link": "https://stackoverflow.com/questions/45317074/best-practices-constructing-an-empty-array/45317241#45317241", "title": "Best practices constructing an empty array", "body": "<p>First, it's a slice not an array. Arrays and slices in Go are very different, arrays have a fixed size that is part of the type. I had trouble with this at first too :)</p>\n\n<ol>\n<li>Not really. Any if the three is correct, and any difference should be too small to worry about. In my own code I generally use whatever is easiest in a particular case.</li>\n<li>0</li>\n<li>Nothing, until you need to add an item, then whatever it costs to allocate the storage needed.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "is_accepted": false, "score": 2, "last_activity_date": 1501047291, "creation_date": 1501047291, "answer_id": 45318222, "question_id": 45317074, "link": "https://stackoverflow.com/questions/45317074/best-practices-constructing-an-empty-array/45318222#45318222", "title": "Best practices constructing an empty array", "body": "<blockquote>\n  <p>Is there any difference between the 3 ways to make an empty array?</p>\n</blockquote>\n\n<p>if <code>empty array</code> means <code>len(array)==0</code>, the answer is no, but actually only <code>myArr3==nil</code> is <code>true</code>.</p>\n\n<blockquote>\n  <p>What is the default capacity of an array when unspecified?</p>\n</blockquote>\n\n<p>the default capacity will be same with the len you specify.</p>\n\n<blockquote>\n  <p>What is the performance cost of using arrays with unspecified capacity?</p>\n</blockquote>\n\n<p>none</p>\n"}, {"comments": [{"owner": {"reputation": 7796, "user_id": 2334254, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-6e2XuTZAjgM/AAAAAAAAAAI/AAAAAAAAABU/JpF2-AkHsH4/photo.jpg?sz=128", "display_name": "kpie", "link": "https://stackoverflow.com/users/2334254/kpie"}, "edited": false, "score": 0, "creation_date": 1501084665, "post_id": 45331396, "comment_id": 77625823, "body": "Thanks for running the example!"}], "tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": false, "score": 5, "last_activity_date": 1501082980, "creation_date": 1501082980, "answer_id": 45331396, "question_id": 45317074, "link": "https://stackoverflow.com/questions/45317074/best-practices-constructing-an-empty-array/45331396#45331396", "title": "Best practices constructing an empty array", "body": "<blockquote>\n  <p>What is the performance cost of using arrays with unspecified capacity?</p>\n</blockquote>\n\n<p>There is certainly a cost when you start populating the slice. If you know how big the slice should grow, you can allocate capacity of the underlying array from the very begging as opposed to reallocating every time the underlying array fills up.</p>\n\n<p>Here is a simple example with timing:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n\n    limit := 500 * 1000 * 1000\n    mySlice := make([]int, 0, limit) //vs mySlice := make([]int, 0)\n\n    for i := 0; i &lt; limit; i++ {\n        mySlice = append(mySlice, i)\n    }\n\n    fmt.Println(len(mySlice))\n}\n</code></pre>\n\n<p>On my machine:</p>\n\n<pre><code>time go run my_file.go\n</code></pre>\n\n<p>With preallocation:</p>\n\n<pre><code>real    0m2.129s\nuser    0m2.073s\nsys     0m1.357s\n</code></pre>\n\n<p>Without preallocation</p>\n\n<pre><code>real    0m7.673s\nuser    0m9.095s\nsys     0m3.462s\n</code></pre>\n"}], "owner": {"reputation": 7796, "user_id": 2334254, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-6e2XuTZAjgM/AAAAAAAAAAI/AAAAAAAAABU/JpF2-AkHsH4/photo.jpg?sz=128", "display_name": "kpie", "link": "https://stackoverflow.com/users/2334254/kpie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12999, "favorite_count": 0, "accepted_answer_id": 45317241, "answer_count": 3, "score": 9, "last_activity_date": 1604412271, "creation_date": 1501040768, "last_edit_date": 1604412271, "question_id": 45317074, "link": "https://stackoverflow.com/questions/45317074/best-practices-constructing-an-empty-array", "title": "Best practices constructing an empty array", "body": "<p>I'm wondering about best practices when initializing empty arrays.</p>\n<p>i.e.  Is there any difference here between arr1, arr2, and arr3?</p>\n<pre><code>myArr1 := []int{}\nmyArr2 := make([]int,0)\nvar myArr3 []int\n</code></pre>\n<p>I know that they make empty <code>[]int</code> but I wonder, is one syntax preferable to the others? Personally I find the first to be most readable but that's beside the point here. One key point of contention may be the array capacity, presumably the default capacity is the same between the three as it is unspecified. Is declaring arrays of unspecified capacity &quot;bad&quot;? I can assume it comes with some performance cost but how &quot;bad&quot; is it really?</p>\n<p>/tldr:</p>\n<ol>\n<li>Is there any difference between the 3 ways to make an empty\narray?</li>\n<li>What is the default capacity of an array when unspecified?</li>\n<li>What is the performance cost of using arrays with unspecified capacity?</li>\n</ol>\n"}, {"tags": ["mysql", "dictionary", "go"], "comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501039337, "post_id": 45316699, "comment_id": 77595932, "body": "You are missing critical information in the question, namely how you are creating the slice. I would guess you are making it too small for the amount of data you want to store."}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 2865988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac2971bffcd0699e57dec5e74a7e8b7c?s=128&d=identicon&r=PG", "display_name": "Adam", "link": "https://stackoverflow.com/users/2865988/adam"}, "is_accepted": false, "score": 0, "last_activity_date": 1501044287, "last_edit_date": 1501044287, "creation_date": 1501040145, "answer_id": 45316993, "question_id": 45316699, "link": "https://stackoverflow.com/questions/45316699/go-lang-map-multi-result/45316993#45316993", "title": "Go lang map multi result", "body": "<p>Use append to add a new element and initialize a not yet allocated slice.</p>\n\n<pre><code>newElement := struct {\n    id string\n    eventid string\n    excel_id string\n    userid string\n    hallid string\n} {\n    id: id,\n    eventid: eventid,\n    excel_id: excel_id,\n    userid: userid,\n    hallid: hallid,\n}\nnewR = append(newR, newElement)\n</code></pre>\n\n<p>...</p>\n\n<p>Sorry for not fmt or test it out but I typed this from my mobile.</p>\n"}, {"tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": true, "score": 0, "last_activity_date": 1501051812, "creation_date": 1501051812, "answer_id": 45319489, "question_id": 45316699, "link": "https://stackoverflow.com/questions/45316699/go-lang-map-multi-result/45319489#45319489", "title": "Go lang map multi result", "body": "<p>You do not need to create a local variables for each field, just create a struct and use it to read data into and use a slice to accumulate results:</p>\n\n<pre><code>// struct definition must be out of functions body\ntype newR struct {\n    id string\n    eventid string\n    excel_id string\n    userid string\n    hallid string\n}\n\nvar newRs []newR\nfor rows.Next() {\n    var current newR\n    err = rows.Scan(&amp;current.id, &amp;current.eventid, &amp;current.excel_id, &amp;current.userid, &amp;current.hallid)\n    newRs = append(newRs, r)\n}\n</code></pre>\n\n<p>And also it is better to check for errors after <code>rows.Next()</code> and <code>rows.Scan(...)</code>.</p>\n"}], "owner": {"reputation": 17, "user_id": 8362528, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9f912bf4957525ee6253cf18d46b138?s=128&d=identicon&r=PG&f=1", "display_name": "Weiwei", "link": "https://stackoverflow.com/users/8362528/weiwei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 45319489, "answer_count": 2, "score": 0, "last_activity_date": 1501051812, "creation_date": 1501038103, "question_id": 45316699, "link": "https://stackoverflow.com/questions/45316699/go-lang-map-multi-result", "title": "Go lang map multi result", "body": "<pre><code>var newR[] struct {\n        id string\n        eventid string\n        excel_id string\n        userid string\n        hallid string\n}\n\ni := 0\nfor rows.Next() {\n    var id, eventid, excel_id, userid, hallid string\n    err = rows.Scan(&amp;id, &amp;eventid, &amp;excel_id, &amp;userid, &amp;hallid)\n\n    // Here is what I want to do\n    newR[i].id = id\n    newR[i].eventid = eventid\n    newR[i].excel_id = excel_id\n    newR[i].userid = userid\n    newR[i].hallid = hallid\n    i++\n}\n</code></pre>\n\n<p>Eventually I got an error msg \"runtime error: index out of range\"\nIn /myapp/app/controllers/app.go (around line 122)</p>\n\n<pre><code>newR[i].id = id\n</code></pre>\n\n<p>Any suggestions or tips will helps. Thanks.</p>\n"}, {"tags": ["mongodb", "go", "database"], "comments": [{"owner": {"reputation": 57591, "user_id": 1388319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/258babf29502a002296bc415851e2395?s=128&d=identicon&r=PG", "display_name": "Stennie", "link": "https://stackoverflow.com/users/1388319/stennie"}, "edited": false, "score": 1, "creation_date": 1501027353, "post_id": 45314871, "comment_id": 77593068, "body": "What is the data type of your <code>pro</code> field? Can you include some example output where the sorting is incorrect? If the results aren&#39;t predictable it&#39;s likely you have mixed data types which sort according to <a href=\"https://docs.mongodb.com/manual/reference/bson-type-comparison-order/#bson-types-comparison-order\" rel=\"nofollow noreferrer\">BSON Comparison/Sort Order</a>."}, {"owner": {"reputation": 37, "user_id": 8284507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c572bf39c229f59af67b318dc8f369e6?s=128&d=identicon&r=PG&f=1", "display_name": "world of simpsons", "link": "https://stackoverflow.com/users/8284507/world-of-simpsons"}, "reply_to_user": {"reputation": 57591, "user_id": 1388319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/258babf29502a002296bc415851e2395?s=128&d=identicon&r=PG", "display_name": "Stennie", "link": "https://stackoverflow.com/users/1388319/stennie"}, "edited": false, "score": 0, "creation_date": 1501062641, "post_id": 45314871, "comment_id": 77608501, "body": "@Stennie I edited my question and added the output. Also the check and pro fields are both int32. And also keep in find that the first query using cursor.sort() works fine."}, {"owner": {"reputation": 57591, "user_id": 1388319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/258babf29502a002296bc415851e2395?s=128&d=identicon&r=PG", "display_name": "Stennie", "link": "https://stackoverflow.com/users/1388319/stennie"}, "edited": false, "score": 0, "creation_date": 1501071247, "post_id": 45314871, "comment_id": 77614818, "body": "Have you altered the output? Unless I&#39;m missing something it seems like the current result documents don&#39;t have the <code>pro</code> and <code>check</code> fields you are sorting on."}, {"owner": {"reputation": 37, "user_id": 8284507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c572bf39c229f59af67b318dc8f369e6?s=128&d=identicon&r=PG&f=1", "display_name": "world of simpsons", "link": "https://stackoverflow.com/users/8284507/world-of-simpsons"}, "reply_to_user": {"reputation": 57591, "user_id": 1388319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/258babf29502a002296bc415851e2395?s=128&d=identicon&r=PG", "display_name": "Stennie", "link": "https://stackoverflow.com/users/1388319/stennie"}, "edited": false, "score": 0, "creation_date": 1501074361, "post_id": 45314871, "comment_id": 77617281, "body": "I just didn&#39;t put them in the project this time."}, {"owner": {"reputation": 37, "user_id": 8284507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c572bf39c229f59af67b318dc8f369e6?s=128&d=identicon&r=PG&f=1", "display_name": "world of simpsons", "link": "https://stackoverflow.com/users/8284507/world-of-simpsons"}, "reply_to_user": {"reputation": 57591, "user_id": 1388319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/258babf29502a002296bc415851e2395?s=128&d=identicon&r=PG", "display_name": "Stennie", "link": "https://stackoverflow.com/users/1388319/stennie"}, "edited": false, "score": 0, "creation_date": 1501074552, "post_id": 45314871, "comment_id": 77617417, "body": "You can see here <a href=\"http://2message.com:8080/search/business?q=e\" rel=\"nofollow noreferrer\">2message.com:8080/search/business?q=e</a> if you refresh many times the page, the results are inconsistent.  One document has pro:1 and check: 0 and the other has pro:0 and check:1"}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 8284507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c572bf39c229f59af67b318dc8f369e6?s=128&d=identicon&r=PG&f=1", "display_name": "world of simpsons", "link": "https://stackoverflow.com/users/8284507/world-of-simpsons"}, "edited": false, "score": 0, "creation_date": 1501074247, "post_id": 45324345, "comment_id": 77617191, "body": "Yes I am doing the sort before the skip and limit."}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "reply_to_user": {"reputation": 37, "user_id": 8284507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c572bf39c229f59af67b318dc8f369e6?s=128&d=identicon&r=PG&f=1", "display_name": "world of simpsons", "link": "https://stackoverflow.com/users/8284507/world-of-simpsons"}, "edited": false, "score": 0, "creation_date": 1501074472, "post_id": 45324345, "comment_id": 77617362, "body": "Sorry, you are indeed. I just read the declaration order, not the order they were passed to <code>c.Pipe</code>. As an aside, the recommendation is for limit before skip (see <a href=\"https://stackoverflow.com/questions/24160037/skip-and-limit-in-aggregation-framework\">this previous question</a>). Don&#39;t think that will be your issue though."}, {"owner": {"reputation": 37, "user_id": 8284507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c572bf39c229f59af67b318dc8f369e6?s=128&d=identicon&r=PG&f=1", "display_name": "world of simpsons", "link": "https://stackoverflow.com/users/8284507/world-of-simpsons"}, "edited": false, "score": 0, "creation_date": 1501074721, "post_id": 45324345, "comment_id": 77617576, "body": "I tried now, but it didn&#39;t change anything.   One document has pro:1 and check: 0 and the other has pro:0 and check:1  you can see here: 2message.com:8080/search/business?q=e  if you refresh many times the page"}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "reply_to_user": {"reputation": 37, "user_id": 8284507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c572bf39c229f59af67b318dc8f369e6?s=128&d=identicon&r=PG&f=1", "display_name": "world of simpsons", "link": "https://stackoverflow.com/users/8284507/world-of-simpsons"}, "edited": false, "score": 0, "creation_date": 1501075025, "post_id": 45324345, "comment_id": 77617842, "body": "Updated my answer, see if that helps"}, {"owner": {"reputation": 37, "user_id": 8284507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c572bf39c229f59af67b318dc8f369e6?s=128&d=identicon&r=PG&f=1", "display_name": "world of simpsons", "link": "https://stackoverflow.com/users/8284507/world-of-simpsons"}, "edited": false, "score": 0, "creation_date": 1501076212, "post_id": 45324345, "comment_id": 77618782, "body": "I never used bson.D, how should I write the above lines? I tried:  \t<code>or := bson.D{         &quot;$sort&quot; : []bson.D{ \t\t{Name: &quot;pro&quot;, Value: -1}, \t\t{Name: &quot;check&quot;, Value: -1} \t}</code> but didn&#39;t compile"}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "reply_to_user": {"reputation": 37, "user_id": 8284507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c572bf39c229f59af67b318dc8f369e6?s=128&d=identicon&r=PG&f=1", "display_name": "world of simpsons", "link": "https://stackoverflow.com/users/8284507/world-of-simpsons"}, "edited": false, "score": 0, "creation_date": 1501076552, "post_id": 45324345, "comment_id": 77619077, "body": "Updated my answer with an example"}, {"owner": {"reputation": 533, "user_id": 3867151, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/iFfmo.png?s=128&g=1", "display_name": "Rachael Dawn", "link": "https://stackoverflow.com/users/3867151/rachael-dawn"}, "edited": false, "score": 0, "creation_date": 1561509439, "post_id": 45324345, "comment_id": 100084168, "body": "Something that may be important to note: If you are sorting, make sure <i>at least one</i> of your fields you are sorting by are <i>unique</i>, or you&#39;ll end up like me debugging for 3 hours trying to figure out why you have repeated results."}], "tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": true, "score": 1, "last_activity_date": 1501076390, "last_edit_date": 1501076390, "creation_date": 1501064954, "answer_id": 45324345, "question_id": 45314871, "link": "https://stackoverflow.com/questions/45314871/mongodb-sort-inconsistent-results/45324345#45324345", "title": "mongoDB $sort inconsistent results", "body": "<p>Make sure you have your sort pipeline stage <em>before</em> your limit &amp; skip stages. You can only reliably obtain the same results with limit/skip on sorted input. </p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Realised that you are using <code>bson.M {\"pro\": -1, \"check\": -1}</code> to define your sort order. The iteration order of a map is unspecified in Go and can change. Hence this is probably why you are getting inconsistent results.</p>\n\n<p>Try changing this to a <code>bson.D</code> so that the order of columns to sort by is maintained.</p>\n\n<p>It make help to see how the query <a href=\"http://bazaar.launchpad.net/+branch/mgo/v2/view/head:/session.go#L2130\" rel=\"nofollow noreferrer\">Sort</a> method constructs this from the strings you provide.</p>\n\n<p>For your use case, you would change the <code>or</code> variable to:</p>\n\n<pre><code>or := bson.M{\n    \"$sort\": bson.D{\n        bson.DocElem{Name: \"pro\", Value: -1},\n        bson.DocElem{Name: \"check\", Value: -1},\n     },\n}\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 8284507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c572bf39c229f59af67b318dc8f369e6?s=128&d=identicon&r=PG&f=1", "display_name": "world of simpsons", "link": "https://stackoverflow.com/users/8284507/world-of-simpsons"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 366, "favorite_count": 0, "accepted_answer_id": 45324345, "answer_count": 1, "score": 1, "last_activity_date": 1501076390, "creation_date": 1501024134, "last_edit_date": 1506103077, "question_id": 45314871, "link": "https://stackoverflow.com/questions/45314871/mongodb-sort-inconsistent-results", "title": "mongoDB $sort inconsistent results", "body": "<p>I have the following query in go lang which works fine:</p>\n\n<pre><code>query[\"name\"] = bson.M{\"$regex\": searchStr, \"$options\": \"i\"}\nquery[\"likes\"] = userSession.Id\nc.Find(query).Skip(0).Limit(2).Select(bson.M{\"name\":1, \"profile\":1, \"description\":1, \"user_id\":1, \"likes\":1}).Sort(\"-pro\", \"-check\").All(&amp;business);\n</code></pre>\n\n<p>Then I tried to write the same query using the aggregation framework:</p>\n\n<pre><code>query[\"name\"] = bson.M{\"$regex\": searchStr, \"$options\": \"i\"}\nquery[\"likes\"] = userSession.Id\noe := bson.M{\n    \"$match\" :query,\n}\noa := bson.M{\n    \"$project\": bson.M {\"pro\": 1, \"check\": 1, \"name\":1, \"profile\":1, \"description\":1, \"user_id\":1, \"likes\":1, \"nrLikes\": bson.M{ \"$size\": \"$likes\" }, \"city\": 1, \"country\": 1, \"industry\": 1},\n}\nol := bson.M{\n    \"$limit\" :pageSize,\n}\nos := bson.M{\n    \"$skip\" :skips,\n}\nor := bson.M{\n    \"$sort\" : bson.M {\"pro\": -1, \"check\": -1},\n}\n\npipe := c.Pipe([]bson.M{oe, oa, or, os, ol  })\n\npipe.All(&amp;business)\n</code></pre>\n\n<p>The second query works fine 90% of the time, but 10% of the times it returns a different order for results. </p>\n\n<p>Any thoughts?</p>\n\n<p>Later edit: Here are the resuls</p>\n\n<pre><code>[]bson.M{\n{\n    \"description\": \"&lt;p&gt;sasdfdasf&lt;/p&gt;\",\n    \"profile\":     []interface {}{\n        \"rKwMmXPWheGczwvGn2TzSRU7jRorhorKwMmXPWheGczwvGn2TzSRU7jRorho=0.jpg\",\n    },\n    \"likes\": []interface {}{\n        \"Yo\\xc7;\\x1a\\xa9Qy\\b\\xb8\\xa2\\xf9\",\n    },\n    \"nrLikes\":  int(1),\n    \"name\":     \"ediloc.com2\",\n    \"city\":     \"Calimanesti\",\n    \"industry\": \"Automotive\",\n    \"_id\":      \"Yo\\xd4f\\x1a\\xa9Q|w\\tG^\",\n    \"user_id\":  \"Yo\\xc7;\\x1a\\xa9Qy\\b\\xb8\\xa2\\xf9\",\n    \"country\":  \"Romania\",\n},\n{\n    \"_id\":         \"Yo\\xc7\\xd7\\x1a\\xa9Qy1['\\xea\",\n    \"user_id\":     \"Yo\\xc7;\\x1a\\xa9Qy\\b\\xb8\\xa2\\xf9\",\n    \"name\":        \"ediloc.com\",\n    \"country\":     \"Romania\",\n    \"description\": \"&lt;p&gt;a&lt;/p&gt;\",\n    \"profile\":     []interface {}{\n        \"1ssSySNRZwGJJwqzXghL6qzAVfWZis1ssSySNRZwGJJwqzXghL6qzAVfWZis=1.jpg\",\n    },\n    \"likes\": []interface {}{\n        \"Yo\\xc7;\\x1a\\xa9Qy\\b\\xb8\\xa2\\xf9\",\n    },\n    \"nrLikes\":  int(1),\n    \"city\":     \"Calimanesti\",\n    \"industry\": \"Accounting\",\n},\n}\n\n\n[]bson.M{\n{\n    \"likes\": []interface {}{\n        \"Yo\\xc7;\\x1a\\xa9Qy\\b\\xb8\\xa2\\xf9\",\n    },\n    \"_id\":     \"Yo\\xd4f\\x1a\\xa9Q|w\\tG^\",\n    \"name\":    \"ediloc.com2\",\n    \"city\":    \"Calimanesti\",\n    \"country\": \"Romania\",\n    \"profile\": []interface {}{\n        \"rKwMmXPWheGczwvGn2TzSRU7jRorhorKwMmXPWheGczwvGn2TzSRU7jRorho=0.jpg\",\n    },\n    \"user_id\":     \"Yo\\xc7;\\x1a\\xa9Qy\\b\\xb8\\xa2\\xf9\",\n    \"industry\":    \"Automotive\",,\n    \"nrLikes\":     int(1),\n},\n{\n    \"_id\":      \"Yo\\xc7\\xd7\\x1a\\xa9Qy1['\\xea\",\n    \"user_id\":  \"Yo\\xc7;\\x1a\\xa9Qy\\b\\xb8\\xa2\\xf9\",\n    \"industry\": \"Accounting\",\n    \"profile\":  []interface {}{\n        \"1ssSySNRZwGJJwqzXghL6qzAVfWZis1ssSySNRZwGJJwqzXghL6qzAVfWZis=1.jpg\",\n    },\n    \"likes\": []interface {}{\n        \"Yo\\xc7;\\x1a\\xa9Qy\\b\\xb8\\xa2\\xf9\",\n    },\n    \"nrLikes\":     int(1),\n    \"name\":        \"ediloc.com\",\n    \"city\":        \"Calimanesti\",\n    \"country\":     \"Romania\",\n    \"description\": \"&lt;p&gt;a&lt;/p&gt;\",\n},\n}\n\n\n[]bson.M{\n{\n    \"nrLikes\":     int(1),\n    \"user_id\":     \"Yo\\xc7;\\x1a\\xa9Qy\\b\\xb8\\xa2\\xf9\",\n    \"description\": \"&lt;p&gt;a&lt;/p&gt;\",\n    \"profile\":     []interface {}{\n        \"1ssSySNRZwGJJwqzXghL6qzAVfWZis1ssSySNRZwGJJwqzXghL6qzAVfWZis=1.jpg\",\n    },\n    \"country\":  \"Romania\",\n    \"industry\": \"Accounting\",\n    \"likes\":    []interface {}{\n        \"Yo\\xc7;\\x1a\\xa9Qy\\b\\xb8\\xa2\\xf9\",\n    },\n    \"_id\":  \"Yo\\xc7\\xd7\\x1a\\xa9Qy1['\\xea\",\n    \"name\": \"ediloc.com\",\n    \"city\": \"Calimanesti\",\n},\n{\n    \"name\":        \"ediloc.com2\",\n    \"industry\":    \"Automotive\",\n    \"description\": \"&lt;p&gt;sasdfdasf&lt;/p&gt;\",\n    \"likes\":       []interface {}{\n        \"Yo\\xc7;\\x1a\\xa9Qy\\b\\xb8\\xa2\\xf9\",\n    },\n    \"user_id\": \"Yo\\xc7;\\x1a\\xa9Qy\\b\\xb8\\xa2\\xf9\",\n    \"city\":    \"Calimanesti\",\n    \"country\": \"Romania\",\n    \"profile\": []interface {}{\n        \"rKwMmXPWheGczwvGn2TzSRU7jRorhorKwMmXPWheGczwvGn2TzSRU7jRorho=0.jpg\",\n    },\n    \"nrLikes\": int(1),\n    \"_id\":     \"Yo\\xd4f\\x1a\\xa9Q|w\\tG^\",\n},\n}\n</code></pre>\n\n<p>Pro and check fields are in32, the documents with higher pro field number should have priority over the documents that have higher check fields.</p>\n"}, {"tags": ["algorithm", "go", "data-structures", "tree"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 4008343, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05ce75e0c48cd769feeb7a297534e643?s=128&d=identicon&r=PG", "display_name": "Pascal Riesinger", "link": "https://stackoverflow.com/users/4008343/pascal-riesinger"}, "edited": false, "score": 0, "creation_date": 1501055398, "post_id": 45315112, "comment_id": 77603181, "body": "That&#39;s already a good starting point, however using the following code: <code>root := NewTree(nil, nil, false);NewTree(root, []string{&quot;jooy&quot;, &quot;bluwhale&quot;, &quot;files&quot;}, true);NewTree(root, []string{&quot;jooy&quot;, &quot;bluwhale&quot;, &quot;users&quot;}, true);NewTree(root, []string{&quot;jooy&quot;, &quot;dexter&quot;, &quot;registrations&quot;}, true)</code>, results in the following (wrong) JSON: <code>{&quot;children&quot;:{&quot;jooy&quot;:{&quot;children&quot;:{&quot;dexter&quot;:{&quot;children&quot;:{&quot;regi&zwnj;&#8203;strations&quot;:{&quot;childre&zwnj;&#8203;n&quot;:{},&quot;data&quot;:true}},&zwnj;&#8203;&quot;data&quot;:false}},&quot;data&zwnj;&#8203;&quot;:false}},&quot;data&quot;:fal&zwnj;&#8203;se}</code>"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 43, "user_id": 4008343, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05ce75e0c48cd769feeb7a297534e643?s=128&d=identicon&r=PG", "display_name": "Pascal Riesinger", "link": "https://stackoverflow.com/users/4008343/pascal-riesinger"}, "edited": false, "score": 0, "creation_date": 1501071958, "post_id": 45315112, "comment_id": 77615367, "body": "Oops! Trying to type code on a tablet is not conducive to good results! I can&#39;t believe I made a goof that stupid! I&#39;ll fix it right now. Thank you for pointing it out!"}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 0, "last_activity_date": 1501072467, "last_edit_date": 1501072467, "creation_date": 1501025867, "answer_id": 45315112, "question_id": 45314812, "link": "https://stackoverflow.com/questions/45314812/convert-map-to-tree-in-go/45315112#45315112", "title": "Convert map to tree in Go", "body": "<p>Change <code>Children</code> to <code>map[string]*IndexNode</code> and you are halfway there. If you don't mind it being a lot slower to look stuff up, you can use a slice, but this means you need to search the slice to find the child you want every time you traverse the tree. A map is faster and easier in this case.</p>\n\n<p>Now you just need to write a recursive function that steps down the tree, making nodes as needed for each element in the path until it reaches the end.</p>\n\n<p>Unfortunately I don't have ready access to an example, all my code in on my other computer :(</p>\n\n<p>A quick and dirty example:</p>\n\n<pre><code>type Tree struct {\n    Parent *Tree\n    Children map[string]*Tree\n    Payload bool // Your data here\n}\n\nfunc NewTree(parent *Tree, path []string, payload bool) *Tree {\n    if parent == nil {\n        parent = &amp;Tree{nil, map[string]*Tree{}, false}\n    }\n    if len(path) == 0 {\n        parent.Payload = payload\n        return parent\n    }\n\n    child := parent.Children[path[0]]\n    if child == nil {\n        child = &amp;Tree{parent, map[string]*Tree{}, false}\n        parent.Children[path[0]] = child\n    }\n    return NewTree(child, path[1:], payload)\n}\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>root := NewTree(nil, nil, false)\nnewnode := NewTree(root, []string{\"A\", \"B\", \"C\"}, true)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Gf2-Hx6Ejz\" rel=\"nofollow noreferrer\">Try it on the Go Playground!</a></p>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 0, "last_activity_date": 1501157432, "creation_date": 1501157432, "answer_id": 45350453, "question_id": 45314812, "link": "https://stackoverflow.com/questions/45314812/convert-map-to-tree-in-go/45350453#45350453", "title": "Convert map to tree in Go", "body": "<p>Here's a solution using a map, traversing it can help you populate the data structure. Can create the nodes where it says \"Parent xxx Child xxx\" in the tree navigation <a href=\"https://play.golang.org/p/sVqBCVgiBG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/sVqBCVgiBG</a></p>\n"}], "owner": {"reputation": 43, "user_id": 4008343, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05ce75e0c48cd769feeb7a297534e643?s=128&d=identicon&r=PG", "display_name": "Pascal Riesinger", "link": "https://stackoverflow.com/users/4008343/pascal-riesinger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1012, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1501157432, "creation_date": 1501023685, "question_id": 45314812, "link": "https://stackoverflow.com/questions/45314812/convert-map-to-tree-in-go", "title": "Convert map to tree in Go", "body": "<p>I have a very specific problem, I cannot figure out a solution for.</p>\n\n<p>I have a <code>map[string]Metric</code>, which I want to convert into a tree for using in a frontend. The <code>Metric</code> interface looks has a <code>Path()</code> and a <code>Name()</code> Method, the name method returns the last part of a period-separated path (so a path of 'my.awesome.metric' will mean that this metric has the name 'metric')\nThe tree should be sorted by the path and should contain <code>IndexNode</code>s. This struct looks like this:</p>\n\n<pre><code>type IndexNode struct {\n    Name string\n    Path string\n    Children []*IndexNode\n}\n</code></pre>\n\n<p>So a map like this:</p>\n\n<pre><code>{\n    my.awesome.metric.downloads\n    my.awesome.othermetric.downloads\n    my.awesome.othermetric.uploads\n    my.other.cool.metric\n}\n</code></pre>\n\n<p>Should lead to a tree like this: (sorry for the crude ascii art)</p>\n\n<pre><code>     +-- other -- cool -- metric\n     |\nmy --+             +-- metric -- downloads\n     |             |\n     +-- awesome --+                 +-- downloads\n                   |                 |\n                   +-- othermetric --+\n                                     |\n                                     +-- uploads\n</code></pre>\n\n<p>Note that I only ever have one root node (my in this case). The order inside of the tree does not matter to me.</p>\n\n<p>I tried my best and cannot figure it out... After lots of googleing (which only showed me how to create binary search trees and the GoDS library), I resigned and decided to ask my very first question here \ud83d\ude0a</p>\n\n<p>Thanks for your help!</p>\n"}, {"tags": ["go", "io"], "comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501022444, "post_id": 45314609, "comment_id": 77591663, "body": "Do you have write permissions for that directory?"}, {"owner": {"reputation": 134, "user_id": 5272101, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/78abf4411e1233db492dc6e169911bb4?s=128&d=identicon&r=PG&f=1", "display_name": "TimSatke", "link": "https://stackoverflow.com/users/5272101/timsatke"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501022521, "post_id": 45314609, "comment_id": 77591687, "body": "I am working on windows, so I thought this should not be a problem. I assumed this also because it worked when I was not yet writing into the <code>data</code> directory."}, {"owner": {"reputation": 134, "user_id": 5272101, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/78abf4411e1233db492dc6e169911bb4?s=128&d=identicon&r=PG&f=1", "display_name": "TimSatke", "link": "https://stackoverflow.com/users/5272101/timsatke"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501022558, "post_id": 45314609, "comment_id": 77591698, "body": "I just checked the permissions, I have permission to read and write files in the <code>data</code> directory"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501022587, "post_id": 45314609, "comment_id": 77591709, "body": "What about using &quot;./data/&quot; instead of &quot;data/&quot;? Assuming that the &quot;data&quot; directory is in the current working directory of course."}, {"owner": {"reputation": 134, "user_id": 5272101, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/78abf4411e1233db492dc6e169911bb4?s=128&d=identicon&r=PG&f=1", "display_name": "TimSatke", "link": "https://stackoverflow.com/users/5272101/timsatke"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501022626, "post_id": 45314609, "comment_id": 77591727, "body": "Produces the same error, but with <code>.&#47;data&#47;Testpage.json</code>"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501023505, "post_id": 45314609, "comment_id": 77591997, "body": "<i>shrug</i> I cant see anything wrong with it... Two things to try: A) Write directly to the current working directory, just to see what happens B) use <code>0666</code> as the permissions (shouldn&#39;t make any difference on Windows)."}, {"owner": {"reputation": 134, "user_id": 5272101, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/78abf4411e1233db492dc6e169911bb4?s=128&d=identicon&r=PG&f=1", "display_name": "TimSatke", "link": "https://stackoverflow.com/users/5272101/timsatke"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501023772, "post_id": 45314609, "comment_id": 77592082, "body": "Doesn&#39;t change anything (0666), sorry :/"}, {"owner": {"reputation": 134, "user_id": 5272101, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/78abf4411e1233db492dc6e169911bb4?s=128&d=identicon&r=PG&f=1", "display_name": "TimSatke", "link": "https://stackoverflow.com/users/5272101/timsatke"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501023901, "post_id": 45314609, "comment_id": 77592131, "body": "Writing it into the working directory creates the file in <code>src&#47;page&#47;</code>, but that&#39;s just not the directory I need it to be in"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501024052, "post_id": 45314609, "comment_id": 77592172, "body": "There&#39;s your problem. Your working directory is not where you expected it. You need to use &quot;../../data/&quot; while testing, and possibly something similar normally. If this works I&#39;ll write it up as an answer."}, {"owner": {"reputation": 134, "user_id": 5272101, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/78abf4411e1233db492dc6e169911bb4?s=128&d=identicon&r=PG&f=1", "display_name": "TimSatke", "link": "https://stackoverflow.com/users/5272101/timsatke"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501024711, "post_id": 45314609, "comment_id": 77592365, "body": "fixed as of 3095e1b277d7e3175d0d1f4cb72a23291ced9e74"}, {"owner": {"reputation": 134, "user_id": 5272101, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/78abf4411e1233db492dc6e169911bb4?s=128&d=identicon&r=PG&f=1", "display_name": "TimSatke", "link": "https://stackoverflow.com/users/5272101/timsatke"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1501024722, "post_id": 45314609, "comment_id": 77592370, "body": "you can add it as an answer, thank you for your help!!!"}], "answers": [{"comments": [{"owner": {"reputation": 134, "user_id": 5272101, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/78abf4411e1233db492dc6e169911bb4?s=128&d=identicon&r=PG&f=1", "display_name": "TimSatke", "link": "https://stackoverflow.com/users/5272101/timsatke"}, "edited": false, "score": 0, "creation_date": 1501025322, "post_id": 45314992, "comment_id": 77592496, "body": "I fixed by creating the data directory in the tests and deleting it afterwards. I will change this sometime."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 2, "last_activity_date": 1501025072, "creation_date": 1501025072, "answer_id": 45314992, "question_id": 45314609, "link": "https://stackoverflow.com/questions/45314609/golang-cannot-write-file-into-directory/45314992#45314992", "title": "Golang cannot write file into directory", "body": "<p>Your problem here is that the test engine is not running your executable with the working directory you expect. Instead of using the working directory defined by your shell or IDE, it is setting it to the source directory of the code being tested. (I had this bite me too once, long ago :) I had almost forgotten about that...)</p>\n\n<p>The simple solution is to change <code>DerivePath</code> so that you can set the prefix externally, then change it to a the path you need at the beginning of your tests. There are other (possibly better?) solutions of course.</p>\n"}], "owner": {"reputation": 134, "user_id": 5272101, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/78abf4411e1233db492dc6e169911bb4?s=128&d=identicon&r=PG&f=1", "display_name": "TimSatke", "link": "https://stackoverflow.com/users/5272101/timsatke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2739, "favorite_count": 1, "accepted_answer_id": 45314992, "answer_count": 1, "score": 1, "last_activity_date": 1542469213, "creation_date": 1501022213, "last_edit_date": 1542469213, "question_id": 45314609, "link": "https://stackoverflow.com/questions/45314609/golang-cannot-write-file-into-directory", "title": "Golang cannot write file into directory", "body": "<p><strong>Situation:</strong></p>\n\n<p>I'm trying to write a file into a directory, like shown as follows:</p>\n\n<pre><code>func (p *Page) Save() error {\n    filepath := DerivePath(p.Title)\n    fmt.Println(filepath)\n    content, _ := json.MarshalIndent(p, \"\", \"    \")\n    err := ioutil.WriteFile(filepath, content, 0600)\n    return err\n}\n</code></pre>\n\n<p><strong>Problem:</strong></p>\n\n<p>The following error occurs in line 5:</p>\n\n<blockquote>\n  <p>open data/Testpage.json: The system cannot find the path specified.</p>\n</blockquote>\n\n<ul>\n<li>I already tried to create the file before writing with <code>os.Create</code>, but it doesn't work either.</li>\n<li>Loading from the <code>data</code> directory works just fine. Only writing <em>new</em> files into the directory fails.</li>\n</ul>\n\n<p><strong><em>Additional information:</em></strong></p>\n\n<p>My project structure is as follows:</p>\n\n<pre><code>\u2502   .gitignore\n\u2502   .project\n\u2502\n\u251c\u2500\u2500\u2500bin\n\u2502       main.exe\n\u2502\n\u251c\u2500\u2500\u2500data\n\u2502       Welcome.json\n\u2502\n\u251c\u2500\u2500\u2500pkg\n\u2502   \u2514\u2500\u2500\u2500windows_amd64\n\u2502           page.a\n\u2502\n\u251c\u2500\u2500\u2500src\n\u2502   \u251c\u2500\u2500\u2500main\n\u2502   \u2502       main.go\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500\u2500page\n\u2502           page.go\n\u2502           page_test.go\n\u2502\n\u2514\u2500\u2500\u2500templates\n        view.html\n</code></pre>\n\n<p>As mentioned above, <em>reading</em> <code>data/Welcome.json</code> works just fine (by using <code>io/ioutils.ReadFile</code>).\nThe source is available on <a href=\"https://gitlab.com/thyaris/Wiki\" rel=\"nofollow noreferrer\">https://gitlab.com/thyaris/Wiki</a>.</p>\n\n<p>Executing <code>D:\\GitWorkspaces\\Wiki\\wiki&gt;go test -v page</code> writes the following output:</p>\n\n<pre><code>=== RUN   TestSave\ndata/Testpage.json\n--- FAIL: TestSave (0.00s)\n        page_test.go:15: open data/Testpage.json: The system cannot find the path specified.\n        page_test.go:19: 'Testpage.json' was not created\n=== RUN   TestLoadPage\n--- FAIL: TestLoadPage (0.00s)\n        page_test.go:26: Error while loading\n        page_test.go:32: File content did not match\n=== RUN   TestDelete\n--- PASS: TestDelete (0.00s)\nFAIL\nexit status 1\nFAIL    page    0.094s\n</code></pre>\n"}, {"tags": ["dictionary", "go"], "comments": [{"owner": {"reputation": 1739, "user_id": 91449, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/279929b6e31ee2eda28479f7829e6bb0?s=128&d=identicon&r=PG", "display_name": "Guildencrantz", "link": "https://stackoverflow.com/users/91449/guildencrantz"}, "edited": false, "score": 5, "creation_date": 1501015848, "post_id": 45313231, "comment_id": 77589077, "body": "What have you tried? What&#39;s not working? If you can show us the code you&#39;re using to try and walk the structure that&#39;ll help us guide you."}, {"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1501016789, "post_id": 45313231, "comment_id": 77589576, "body": "There&#39;re either <code>range</code> or <code>for</code>. You don&#39;t have other options."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1501017760, "post_id": 45313231, "comment_id": 77589994, "body": "<code>fmt.Printf()</code> expects a string and formatting, you passed in your defined struct <code>Server</code> instead of the type <code>string</code>...  Try <code>fmt.Println()</code> instead."}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 2, "last_activity_date": 1501019298, "last_edit_date": 1501019298, "creation_date": 1501018866, "answer_id": 45313967, "question_id": 45313231, "link": "https://stackoverflow.com/questions/45313231/how-to-range-over-nested-struct-in-golang/45313967#45313967", "title": "How to range over nested struct in golang?", "body": "<p>I think you want:</p>\n\n<pre><code>for _ , i := range result {\n    for  _, j := range i.Host {\n        if j.Status == \"good\" {\n            server := j.Ip\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 4979070, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2b174fcee2d4adcddfb2dc9496bf7875?s=128&d=identicon&r=PG&f=1", "display_name": "techno", "link": "https://stackoverflow.com/users/4979070/techno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1063, "favorite_count": 0, "accepted_answer_id": 45313967, "answer_count": 1, "score": -2, "last_activity_date": 1501019298, "creation_date": 1501015721, "last_edit_date": 1501018879, "question_id": 45313231, "link": "https://stackoverflow.com/questions/45313231/how-to-range-over-nested-struct-in-golang", "title": "How to range over nested struct in golang?", "body": "<p>I am new to Golang:\nThese are my defined struct:</p>\n\n<pre><code>type Name map[string]Info\n\ntype Info struct {\n    Addresses string                             `json:\"addresses\"`\n    Host   map[string]Server                     `json:\"host\"`\n}\n\ntype Server struct {\n   Ipaddress     string        `json:\"ip\"`\n   Status        string        `json:\"status\"`\n}\n\nvar result Name\n</code></pre>\n\n<p>after unmarshalling Json i get:</p>\n\n<pre><code>result = [\n    user1:{\n        192.168.98.0/26\n        map[\n            xx.user1.domain.com:{192.168.98.1 good} \n            xx.user1.domain.com:{192.168.98.3 good} \n            xx.user1.domain.com:{192.168.98.4 Bad}\n        ]\n    } \n    user2: {\n        192.168.99.0/26\n        map[\n            xx.user2.domain.com:{192.168.99.1 good}\n        ]\n    }\n]\n</code></pre>\n\n<p>How to range over this Json to get the ipaddress which has a status==\"good\" for the particular user ?</p>\n\n<p>I am trying to do this way:</p>\n\n<pre><code>  for j , _ := range result[\"user1\"].Servers {\n     if a := result[\"user1\"].Servers[j]); a == \"good\" {\n      //Problem is here I am not sure how to further scan the ip and status\n      //do something\n</code></pre>\n\n<p>}</p>\n\n<pre><code>    }\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 3, "creation_date": 1501016241, "post_id": 45313167, "comment_id": 77589298, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/15452004/my-structures-are-not-marshalling-into-json\">My structures are not marshalling into json</a>"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 3096822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41b8f09dd426c7c172f6dad1fd641dd?s=128&d=identicon&r=PG&f=1", "display_name": "jrf", "link": "https://stackoverflow.com/users/3096822/jrf"}, "edited": false, "score": 0, "creation_date": 1501016389, "post_id": 45313209, "comment_id": 77589390, "body": "Thanks for the answer.  What happens if you attempt to Unmarshal a document that contains both &quot;model&quot; and &quot;Model&quot;?  Clearly, you wouldn&#39;t want to define this, but we&#39;re not always in control of how data sources are defined :)"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 21, "user_id": 3096822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41b8f09dd426c7c172f6dad1fd641dd?s=128&d=identicon&r=PG&f=1", "display_name": "jrf", "link": "https://stackoverflow.com/users/3096822/jrf"}, "edited": false, "score": 0, "creation_date": 1501016960, "post_id": 45313209, "comment_id": 77589663, "body": "Then field &quot;Model&quot; will not be stored anywhere AFAIK. You could add two fields (with appropriate tags) to your struct, but that would be messy. The library assumes that field names will be case sensitive, and there isn&#39;t an easy way to avoid that. If you really must handle both, see <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">this part of the documentation</a> for what you need."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 2, "last_activity_date": 1501015644, "creation_date": 1501015644, "answer_id": 45313209, "question_id": 45313167, "link": "https://stackoverflow.com/questions/45313167/go-json-unmarshal-field-case/45313209#45313209", "title": "Go json.Unmarshal field case", "body": "<p>Fields need to be exported (declared with an uppercase first letter) or the reflection library cannot edit them. Since the JSON (un)marshaller uses reflection, it cannot read or write unexported fields.</p>\n\n<p>So yes, it is expected, and no, you cannot change it. Sorry.</p>\n\n<p>You can add tags to a field to change the name the marshaller uses:</p>\n\n<pre><code>Model string `json:\"model\"`\n</code></pre>\n\n<p>See <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">the documentation</a> for more info on the field tags \"encoding/json\" supports.</p>\n"}], "owner": {"reputation": 21, "user_id": 3096822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41b8f09dd426c7c172f6dad1fd641dd?s=128&d=identicon&r=PG&f=1", "display_name": "jrf", "link": "https://stackoverflow.com/users/3096822/jrf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 0, "accepted_answer_id": 45313209, "answer_count": 1, "score": 0, "last_activity_date": 1501016176, "creation_date": 1501015437, "last_edit_date": 1501016176, "question_id": 45313167, "link": "https://stackoverflow.com/questions/45313167/go-json-unmarshal-field-case", "title": "Go json.Unmarshal field case", "body": "<p>I'm new to Go.  I was trying to fetch and marshal json data to a struct.  My sample data looks like this:</p>\n\n<pre><code>var reducedFieldData = []byte(`[\n    {\"model\":\"Traverse\",\"vin\":\"1gnkrhkd6ej111234\"}\n    ,{\"model\":\"TL\",\"vin\":\"19uua66265a041234\"}\n]`)\n</code></pre>\n\n<p>If I define the struct for receiving the data like this:</p>\n\n<pre><code>type Vehicle struct {\n    Model string\n    Vin   string\n}\n</code></pre>\n\n<p>The call to Unmarshal works as expected.  However, if I use lower case for the fields (\"model\" and \"vin\") which actually matches cases for the field names in the data it will return empty strings for the values.</p>\n\n<p>Is this expected behavior?  Can the convention be turned off?</p>\n"}, {"tags": ["java", "go", "protocol-buffers"], "comments": [{"owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1501009116, "post_id": 45310580, "comment_id": 77585336, "body": "What does your socket on the Java side look like?  It sounds like you are only getting a partial message back."}, {"owner": {"reputation": 89, "user_id": 8365421, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-h12Xw9mmDh0/AAAAAAAAAAI/AAAAAAAAAEE/4AXRaUeQJ60/photo.jpg?sz=128", "display_name": "Tam Le", "link": "https://stackoverflow.com/users/8365421/tam-le"}, "reply_to_user": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1501009429, "post_id": 45310580, "comment_id": 77585504, "body": "on the Java side, i request service by HttpRequestExecutor HttpHost server = new HttpHost(&quot;localhost&quot;, 8080);             Socket socket = new Socket(server.getHostName(), server.getPort());             connection.bind(socket);"}, {"owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1501010432, "post_id": 45310580, "comment_id": 77586030, "body": "At what point are you reading from the socket?  Can you edit your original post with that so it&#39;s formatted properly?"}, {"owner": {"reputation": 89, "user_id": 8365421, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-h12Xw9mmDh0/AAAAAAAAAAI/AAAAAAAAAEE/4AXRaUeQJ60/photo.jpg?sz=128", "display_name": "Tam Le", "link": "https://stackoverflow.com/users/8365421/tam-le"}, "reply_to_user": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1501011419, "post_id": 45310580, "comment_id": 77586579, "body": "thank you for your comment. i&#39;ve just post full version of java client side i get bytes from server via HttpResponse by httpexecutor.execute. It&#39;s like response from a request to restful service."}], "answers": [{"tags": [], "owner": {"reputation": 89, "user_id": 8365421, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-h12Xw9mmDh0/AAAAAAAAAAI/AAAAAAAAAEE/4AXRaUeQJ60/photo.jpg?sz=128", "display_name": "Tam Le", "link": "https://stackoverflow.com/users/8365421/tam-le"}, "is_accepted": false, "score": 0, "last_activity_date": 1501015914, "creation_date": 1501015914, "answer_id": 45313277, "question_id": 45310580, "link": "https://stackoverflow.com/questions/45310580/parsing-a-protocol-message-from-go-by-java/45313277#45313277", "title": "Parsing a protocol message from Go by Java", "body": "<p>Thank you all\nI found answer from all your comment.\nMy serialize and deserialize structure is different.\nI edited to\n    Addressbook.Person person = Addressbook.Person.parseFrom(data);\nand then it work.</p>\n"}], "owner": {"reputation": 89, "user_id": 8365421, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-h12Xw9mmDh0/AAAAAAAAAAI/AAAAAAAAAEE/4AXRaUeQJ60/photo.jpg?sz=128", "display_name": "Tam Le", "link": "https://stackoverflow.com/users/8365421/tam-le"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1274, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1501015914, "creation_date": 1501005668, "last_edit_date": 1501010368, "question_id": 45310580, "link": "https://stackoverflow.com/questions/45310580/parsing-a-protocol-message-from-go-by-java", "title": "Parsing a protocol message from Go by Java", "body": "<p>I write a server(Go)-client(Java) programe, and use protobuf for communication.\nDefine a proto file and share between server and client.\nIn server side:</p>\n\n<ul>\n<li>compile shared proto file into go by protoc</li>\n<li>serialize the object by proto.Marshal </li>\n<li>send it to client that make a request to its service</li>\n</ul>\n\n<p>In client side:</p>\n\n<ul>\n<li>compile shared proto file into java by protoc</li>\n<li>get bytes is transferred via http</li>\n<li>deserialize the bytes into object.</li>\n</ul>\n\n<p>Here i get following error:</p>\n\n<blockquote>\n  <p>\"com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.\"</p>\n</blockquote>\n\n<p>I confirmed http work fine and value of bytes received in client side are same to bytes send by server. Do you have same problem on this?</p>\n\n<p>Here is proto file</p>\n\n<pre><code>syntax = \"proto3\";\npackage tutorial;\n\nmessage Person {\n    string name = 1;\n    int32 id = 2; \n    string email = 3;\n\n    enum PhoneType {\n        MOBILE = 0;\n        HOME = 1;\n        WORK = 2;\n    }\n\n    message PhoneNumber {\n        string number = 1;\n        PhoneType type = 2;\n    }\n\n    repeated PhoneNumber phones = 4;\n}\n\nmessage AddressBook {\n    repeated Person people = 1;\n}\n</code></pre>\n\n<p>In Go server side : </p>\n\n<pre><code>func TodoIndex(w http.ResponseWriter, r *http.Request) {\n\n    w.Header().Set(\"Content-Type\", \"application/x-protobuf\")\n    w.WriteHeader(http.StatusOK)\n    p := &amp;Person{\n        Id:    1234,\n        Name:  \"John Doe\",\n        Email: \"jdoe@example.com\",\n        Phones: []*Person_PhoneNumber{\n            {Number: \"555-4321\", Type: Person_HOME},\n        },\n    }\n    out, err := proto.Marshal(p)\n    if err != nil {\n        panic(err)\n    }\n    w.Write(out)\n}\n</code></pre>\n\n<p>In Java client side:</p>\n\n<pre><code>public class MainJavaAndGo {\npublic static void main(String[] args){\n    try {\n        long start = (new Date()).getTime();\n        System.out.println(\"begin get\");\n        connect();\n\n        System.out.println(\"end get\");\n        long time = (new Date()).getTime() - start;\n    }catch(Exception e){\n        e.printStackTrace();\n    }\n}\n\npublic static void connect(){\n    DefaultBHttpClientConnection connection = new DefaultBHttpClientConnection(8 * 1024);\n    HttpHost server = hostForString(\"localhost:8080\");\n    try {\n\n        Socket socket = new Socket(server.getHostName(), server.getPort());\n        connection.bind(socket);\n\n        HttpCoreContext writeContext = HttpCoreContext.create();\n        writeContext.setTargetHost(server);\n\n        BasicHttpEntityEnclosingRequest httpRequest = new BasicHttpEntityEnclosingRequest(\"GET\",\n                \"/todos\");\n\n        HttpProcessor httpproc = makeHttpProcessor();\n        HttpRequestExecutor httpexecutor = new HttpRequestExecutor();\n        httpexecutor.preProcess(httpRequest, httpproc, writeContext);\n        HttpResponse response = httpexecutor.execute(httpRequest, connection, writeContext);\n        httpexecutor.postProcess(response, httpproc, writeContext);\n        InputStream inputStream = response.getEntity().getContent();\n        byte[] data = IOUtils.toByteArray(inputStream);\n        Addressbook.AddressBook addressBook = Addressbook.AddressBook.parseFrom(data);\n        int foo = 0;\n        foo++;\n\n\n    }catch(Exception e){\n        e.printStackTrace();\n        try {\n            connection.shutdown();\n        }catch (Exception ioe){\n            ioe.printStackTrace();\n        }\n    }\n}\npublic static  HttpHost hostForString(String hostStr) {\n    String[] host = hostStr.split(\":\", 2);\n    HttpHost httphost = new HttpHost(host[0], Integer.parseInt(host[1]));\n\n    return httphost;\n}\n\npublic static HttpProcessor makeHttpProcessor() {\n    return HttpProcessorBuilder.create().add(new RequestContent()).add(new RequestTargetHost())\n            .add(new RequestConnControl()).add(new RequestUserAgent(\"Test Protobuf/1.1\"))\n            .add(new RequestExpectContinue(true)).build();\n}\n}\n</code></pre>\n\n<p>I got InvalidProtocolBufferException</p>\n\n<pre><code>com.google.protobuf.InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly in the middle of a field.  This could mean either that the input has been truncated or that an embedded message misreported its own length.\n    at com.google.protobuf.InvalidProtocolBufferException.truncatedMessage(InvalidProtocolBufferException.java:82)\n    at com.google.protobuf.CodedInputStream$ArrayDecoder.skipRawBytes(CodedInputStream.java:1200)\n    at com.google.protobuf.CodedInputStream$ArrayDecoder.skipField(CodedInputStream.java:578)\n    at com.auth0.protobuf.Addressbook$Person.&lt;init&gt;(Addressbook.java:112)\n    at com.auth0.protobuf.Addressbook$Person.&lt;init&gt;(Addressbook.java:77)\n    at com.auth0.protobuf.Addressbook$Person$1.parsePartialFrom(Addressbook.java:1817)\n    at com.auth0.protobuf.Addressbook$Person$1.parsePartialFrom(Addressbook.java:1812)\n    at com.google.protobuf.CodedInputStream$ArrayDecoder.readMessage(CodedInputStream.java:816)\n    at com.auth0.protobuf.Addressbook$AddressBook.&lt;init&gt;(Addressbook.java:1914)\n    at com.auth0.protobuf.Addressbook$AddressBook.&lt;init&gt;(Addressbook.java:1871)\n    at com.auth0.protobuf.Addressbook$AddressBook$1.parsePartialFrom(Addressbook.java:2571)\n    at com.auth0.protobuf.Addressbook$AddressBook$1.parsePartialFrom(Addressbook.java:2566)\n    at com.google.protobuf.AbstractParser.parsePartialFrom(AbstractParser.java:163)\n    at com.google.protobuf.AbstractParser.parseFrom(AbstractParser.java:197)\n    at com.google.protobuf.AbstractParser.parseFrom(AbstractParser.java:209)\n    at com.google.protobuf.AbstractParser.parseFrom(AbstractParser.java:214)\n    at com.google.protobuf.AbstractParser.parseFrom(AbstractParser.java:49)\n    at com.auth0.protobuf.Addressbook$AddressBook.parseFrom(Addressbook.java:2065)\n    at com.auth0.MainJavaAndGo.connect(MainJavaAndGo.java:78)\n    at com.auth0.MainJavaAndGo.main(MainJavaAndGo.java:35)\n</code></pre>\n"}, {"tags": ["go", "testify"], "answers": [{"comments": [{"owner": {"reputation": 1725, "user_id": 373091, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/93af096a02c3c17be63904e07398f965?s=128&d=identicon&r=PG", "display_name": "Carmageddon", "link": "https://stackoverflow.com/users/373091/carmageddon"}, "edited": false, "score": 1, "creation_date": 1501009687, "post_id": 45310587, "comment_id": 77585640, "body": "Thanks! great answer.. should be in Go documentation :)"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 6, "last_activity_date": 1501005692, "creation_date": 1501005692, "answer_id": 45310587, "question_id": 45310329, "link": "https://stackoverflow.com/questions/45310329/difference-between-indelta-and-inepsilon/45310587#45310587", "title": "Difference between InDelta and InEpsilon", "body": "<p>They are related but not identical.</p>\n\n<p><code>InDelta</code> receives an absolute value and checks that the difference is less than that value.</p>\n\n<p><code>InEpsilon</code> receives a % of difference that would be acceptable.</p>\n\n<p>The behaviour of <code>InDelta</code> is quite straightforward:</p>\n\n<pre><code>InDelta(t, 100, 101, 2) // that's OK\nInDelta(t, 100, 103, 2) // fail!\n</code></pre>\n\n<p>But sometimes, you just care that the actual value is not too far away from the expected value.</p>\n\n<p>Depending on how small or large the expected value is \"not too far away\" might get tricky with <code>InDelta</code>.</p>\n\n<p>It might be a problem to use the same <code>delta</code> value for any number:</p>\n\n<pre><code>InDelta(t, 100, 101, 2) // ok, 101 is \"not too far away\" from 100\nInDelta(t,   1,   2, 2) // hm, 2 sounds \"too far away\" from 1...\n</code></pre>\n\n<p>If you use <code>InEpsilon</code>, you can always use the same %:</p>\n\n<pre><code>InEpsilon(t, 100, 101, 0.02) // ok, up to 102 would be acceptable\nInEpsilon(t,   1,   2, 0.02) // will not pass.. this time up to 1.02 would be acceptable\n</code></pre>\n\n<p>In summary, the use case for <code>\u00ccnEpsilon</code> is to discard small differences (and making \"small\" relative to the actual values compared).</p>\n"}], "owner": {"reputation": 1725, "user_id": 373091, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/93af096a02c3c17be63904e07398f965?s=128&d=identicon&r=PG", "display_name": "Carmageddon", "link": "https://stackoverflow.com/users/373091/carmageddon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 763, "favorite_count": 0, "accepted_answer_id": 45310587, "answer_count": 1, "score": 3, "last_activity_date": 1501008633, "creation_date": 1501004773, "last_edit_date": 1501008633, "question_id": 45310329, "link": "https://stackoverflow.com/questions/45310329/difference-between-indelta-and-inepsilon", "title": "Difference between InDelta and InEpsilon", "body": "<p>From documentation:</p>\n\n<p><a href=\"https://godoc.org/github.com/stretchr/testify/assert#InDelta\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/stretchr/testify/assert#InDelta</a></p>\n\n<blockquote>\n  <p>InDelta asserts that the two numerals are within delta of each other</p>\n</blockquote>\n\n<p><a href=\"https://godoc.org/github.com/stretchr/testify/assert#InEpsilon\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/stretchr/testify/assert#InEpsilon</a></p>\n\n<blockquote>\n  <p>InEpsilon asserts that expected and actual have a relative error less than epsilon</p>\n</blockquote>\n\n<p>And their code seems to be identical in purpose:</p>\n\n<pre><code>func InDelta(t TestingT, expected, actual interface{}, delta float64, msgAndArgs ...interface{}) bool {\n\n    af, aok := toFloat(expected)\n    bf, bok := toFloat(actual)\n\n    if !aok || !bok {\n        return Fail(t, fmt.Sprintf(\"Parameters must be numerical\"), msgAndArgs...)\n    }\n\n    if math.IsNaN(af) {\n        return Fail(t, fmt.Sprintf(\"Expected must not be NaN\"), msgAndArgs...)\n    }\n\n    if math.IsNaN(bf) {\n        return Fail(t, fmt.Sprintf(\"Expected %v with delta %v, but was NaN\", expected, delta), msgAndArgs...)\n    }\n\n    dt := af - bf\n    if dt &lt; -delta || dt &gt; delta {\n        return Fail(t, fmt.Sprintf(\"Max difference between %v and %v allowed is %v, but difference was %v\", expected, actual, delta, dt), msgAndArgs...)\n    }\n\n    return true\n}\n</code></pre>\n\n<hr>\n\n<pre><code>func calcRelativeError(expected, actual interface{}) (float64, error) {\n    af, aok := toFloat(expected)\n    if !aok {\n        return 0, fmt.Errorf(\"expected value %q cannot be converted to float\", expected)\n    }\n    if af == 0 {\n        return 0, fmt.Errorf(\"expected value must have a value other than zero to calculate the relative error\")\n    }\n    bf, bok := toFloat(actual)\n    if !bok {\n        return 0, fmt.Errorf(\"actual value %q cannot be converted to float\", actual)\n    }\n\n    return math.Abs(af-bf) / math.Abs(af), nil\n}\n\n// InEpsilon asserts that expected and actual have a relative error less than epsilon\n//\n// Returns whether the assertion was successful (true) or not (false).\nfunc InEpsilon(t TestingT, expected, actual interface{}, epsilon float64, msgAndArgs ...interface{}) bool {\n    actualEpsilon, err := calcRelativeError(expected, actual)\n    if err != nil {\n        return Fail(t, err.Error(), msgAndArgs...)\n    }\n    if actualEpsilon &gt; epsilon {\n        return Fail(t, fmt.Sprintf(\"Relative error is too high: %#v (expected)\\n\"+\n            \"        &lt; %#v (actual)\", epsilon, actualEpsilon), msgAndArgs...)\n    }\n\n    return true\n}\n</code></pre>\n\n<p>What is the difference? what are the use cases where one would be used over the other and vice versa?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1501005222, "post_id": 45310156, "comment_id": 77583034, "body": "see <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a> for details."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 6, "last_activity_date": 1501005188, "creation_date": 1501005188, "answer_id": 45310432, "question_id": 45310156, "link": "https://stackoverflow.com/questions/45310156/how-to-add-dependency-to-godep-json/45310432#45310432", "title": "How to add dependency to godep.json?", "body": "<p>That definitely won't work. GOPATH isn't just the path of some project; it's the root of a directory, which contains <code>bin</code>, <code>pkg</code>, and <code>src</code> directories; the <code>src</code> directory contains package-named directories for projects. So you should be running <code>godep</code> from your project directory, which (given your current GOPATH) should be <code>/Users/sarath/project/src/&lt;repopath&gt;</code> - e.g. <code>/Users/sarath/project/src/github.com/sarath/myproject</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5906464"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 538, "favorite_count": 1, "accepted_answer_id": 45310432, "answer_count": 1, "score": 3, "last_activity_date": 1501005188, "creation_date": 1501004146, "question_id": 45310156, "link": "https://stackoverflow.com/questions/45310156/how-to-add-dependency-to-godep-json", "title": "How to add dependency to godep.json?", "body": "<p>I'm having hard time to add a dependency to the <code>Godeps.json</code> file. I think I've messed up the <code>GOPATH</code>. I tried various suggestions on the warnings but none of them worked for me. \nMy GOPATH is <code>/Users/sarath/project</code>. \n<code>which go</code> is <code>/usr/local/bin/go</code>.  If I try to do <code>godep save ./...</code>, it is giving me the following warning: </p>\n\n<pre><code>godep: [WARNING]: godep should only be used inside a valid go package directory and\ngodep: [WARNING]: may not function correctly. You are probably outside of your $GOPATH.\ngodep: [WARNING]:   Current Directory: /Users/sarath/project\ngodep: [WARNING]:   $GOPATH: /Users/sarath/project\ngodep: Unable to find SrcRoot for package .\n</code></pre>\n\n<p>I have my <code>pkg</code> inside the <code>/Users/sarath/project</code>.</p>\n"}, {"tags": ["go", "signals"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1501003840, "post_id": 45309984, "comment_id": 77582158, "body": "Windows doesn&#39;t actually support POSIX-style IPC signals at all; SIGKILL is emulated in this case by terminating the target process."}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 5, "last_activity_date": 1501004017, "creation_date": 1501004017, "answer_id": 45310127, "question_id": 45309984, "link": "https://stackoverflow.com/questions/45309984/signal-other-than-sigkill-not-terminating-process-on-windows/45310127#45310127", "title": "Signal other than SIGKILL not terminating process on Windows", "body": "<p>This does not seem to be supported as stated in the documentation:</p>\n\n<p><a href=\"https://godoc.org/os#Process.Signal\" rel=\"noreferrer\">https://godoc.org/os#Process.Signal</a></p>\n\n<blockquote>\n  <p>Sending Interrupt on Windows is not implemented.</p>\n</blockquote>\n\n<p>Also, see this issue discussion to get more context on why it could not be done:</p>\n\n<p><a href=\"https://github.com/golang/go/issues/6720\" rel=\"noreferrer\">https://github.com/golang/go/issues/6720</a></p>\n"}, {"tags": [], "owner": {"reputation": 730, "user_id": 6161244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/990831a04db3b7c4a8ac83e67e00817d?s=128&d=identicon&r=PG", "display_name": "Constantin Konstantinidis", "link": "https://stackoverflow.com/users/6161244/constantin-konstantinidis"}, "is_accepted": false, "score": 3, "last_activity_date": 1593924958, "creation_date": 1593924958, "answer_id": 62736989, "question_id": 45309984, "link": "https://stackoverflow.com/questions/45309984/signal-other-than-sigkill-not-terminating-process-on-windows/62736989#62736989", "title": "Signal other than SIGKILL not terminating process on Windows", "body": "<p><code>syscall</code> package is tailored to the OS (<a href=\"https://golang.org/pkg/syscall/#pkg-overview\" rel=\"nofollow noreferrer\">https://golang.org/pkg/syscall/#pkg-overview</a>).\nAlthough interrupt is not implemented on Windows, signaling is usable.</p>\n<p>There is an <a href=\"https://github.com/golang/go/blob/master/src/os/signal/signal_windows_test.go\" rel=\"nofollow noreferrer\">example</a> in the signal package itself for Windows.\nAn interactive version (<code>go run</code>) is available <a href=\"https://github.com/iWdGo/sigint-windows\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 133, "user_id": 3845810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/264af3b003ac420379855e42f98ad11b?s=128&d=identicon&r=PG", "display_name": "Mike DiBaggio", "link": "https://stackoverflow.com/users/3845810/mike-dibaggio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1255, "favorite_count": 1, "accepted_answer_id": 45310127, "answer_count": 2, "score": 2, "last_activity_date": 1593924958, "creation_date": 1501003569, "question_id": 45309984, "link": "https://stackoverflow.com/questions/45309984/signal-other-than-sigkill-not-terminating-process-on-windows", "title": "Signal other than SIGKILL not terminating process on Windows", "body": "<p>I am launching a simple Java application through Go, with the goal of proving that Go can send a signal like SIGQUIT or SIGTERM, and the Java can catch that and handle it appropriately (i.e. shutdown gracefully). When I run the Java program on the command line and send it a CTRL+C, the Java program correctly catches the signal.</p>\n\n<p>However, when I launch the Java program through Go and attempt to send the process a signal, the Java process is neither terminated nor does it handle the signal. The only one that works is SIGKILL, which of course is not caught, and simply kills the process.</p>\n\n<p>Here are the relevant parts of my Go code:</p>\n\n<p><strong>Start:</strong></p>\n\n<pre><code>startChan := make(chan bool)\ngo func(startChan chan&lt;- bool) {\n    a.Cmd = exec.Command(\"java\", \"-jar\", \"C:\\\\Code\\\\sigterm\\\\TestApp.jar\")\n    a.Cmd.Stdout = os.Stdout\n    a.Cmd.Stderr = os.Stderr\n\n    launchErr := a.Cmd.Start()\n    if launchErr != nil {\n        fmt.Println(\"Unable to start app:\" + launchErr.Error())\n    }\n    startChan &lt;- true\n}(startChan)\n</code></pre>\n\n<p><strong>Stop:</strong></p>\n\n<pre><code>func (a *App) Stop(timeout time.Duration) {\n  a.Cmd.Process.Signal(syscall.SIGQUIT) //Does not work\n  a.Cmd.Process.Signal(syscall.SIGTERM) //Does not work\n  a.Cmd.Process.Signal(syscall.SIGKILL) //Works\n}\n</code></pre>\n\n<p>This is on Windows, by the way. I tried it by launching another program (notepad) and got the same results; that is, only SIGKILL worked. I have confirmed that Go is getting the correct PID and so forth, so the signal should be going to the right place.</p>\n\n<p>Any ideas about how I can get this to work?</p>\n"}, {"tags": ["html", "css", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1501002813, "post_id": 45309657, "comment_id": 77581491, "body": "Is the path correct relative to the <b>URL</b> that this page is loaded from? Remember, the browser is handling the relative path and using it to construct a new URL to request the resource from the server."}], "answers": [{"tags": [], "owner": {"reputation": 43, "user_id": 4008343, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05ce75e0c48cd769feeb7a297534e643?s=128&d=identicon&r=PG", "display_name": "Pascal Riesinger", "link": "https://stackoverflow.com/users/4008343/pascal-riesinger"}, "is_accepted": false, "score": 1, "last_activity_date": 1501025380, "creation_date": 1501025380, "answer_id": 45315040, "question_id": 45309657, "link": "https://stackoverflow.com/questions/45309657/css-and-images-from-a-different-folder-are-not-read-when-rendering-template-usin/45315040#45315040", "title": "CSS and images from a different folder are not read when rendering template using Golang", "body": "<p>Using <code>../css</code> on the web should be avoided and likely is your error source. Your go server likely cannot resolve the file (because you don't have a handler for the <code>../css</code> URI).\nSo you should change the <code>../css</code> part to <code>/css</code> and tell your server (you didn't provide details, so I cannot show you code) to handle <code>/css</code> URIs by serving the files. </p>\n\n<p>Assuming that you are using the default <code>net/http</code> mux, your code should look something like:</p>\n\n<pre><code>mux := http.NewServeMux()\nmux.Handle(\"/css/\", http.StripPrefix(\"/css/\", http.FileServer(http.Dir(\"css\"))))\nhttp.ListenAndServe(\":8080\", mux)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 8365171, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72472201c20e5db3a8761d50a96108a9?s=128&d=identicon&r=PG&f=1", "display_name": "Khalil ben ayed", "link": "https://stackoverflow.com/users/8365171/khalil-ben-ayed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1501025380, "creation_date": 1501002448, "question_id": 45309657, "link": "https://stackoverflow.com/questions/45309657/css-and-images-from-a-different-folder-are-not-read-when-rendering-template-usin", "title": "CSS and images from a different folder are not read when rendering template using Golang", "body": "<p>I am trying to render a template using the html/template module of Golang. But only CSS files and images from the same folder as the page i am rendering are executed, those located in a different folder are ignored. Here is my code:</p>\n\n<pre><code>func render(w http.ResponseWriter, filename string, data interface{}) {\n    tmpl, err := template.ParseFiles(filename)\n    if err != nil {\n      http.Error(w, err.Error(), http.StatusInternalServerError)\n    }\n    if err := tmpl.Execute(w, data); err != nil {\n      http.Error(w, err.Error(), http.StatusInternalServerError)\n    }\n  }\n</code></pre>\n\n<p>For this page for example:</p>\n\n<pre><code>&lt;head&gt;\n  &lt;meta charset=\"utf-8\"&gt;\n  &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"&gt;\n  &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;\n  &lt;meta name=\"description\" content=\"\"&gt;\n  &lt;meta name=\"author\" content=\"\"&gt;\n  &lt;title&gt;Start Connect&lt;/title&gt;\n  &lt;link href=\"../css/bootstrap.min.css\" rel=\"stylesheet\"&gt;\n  &lt;link href=\"one-page.css\" rel=\"stylesheet\"&gt;\n&lt;/head&gt;\n</code></pre>\n\n<p>The one-page.css is executed but not the bootstrap.</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1501017773, "post_id": 45309434, "comment_id": 77590000, "body": "What would this be used for?"}, {"owner": {"reputation": 125, "user_id": 4399545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e1ebf4600cc8dc9a9f17b8ed20c230ba?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Chatti", "link": "https://stackoverflow.com/users/4399545/suresh-chatti"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1501051240, "post_id": 45309434, "comment_id": 77600359, "body": "I used (if it is null device) for giving warning before prompting for input"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501073749, "post_id": 45309434, "comment_id": 77616824, "body": "What exactly would constitute a generic, cross platform, null device? In what case does it make sense to prompt for input when there is no way to get input?"}, {"owner": {"reputation": 125, "user_id": 4399545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e1ebf4600cc8dc9a9f17b8ed20c230ba?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Chatti", "link": "https://stackoverflow.com/users/4399545/suresh-chatti"}, "edited": false, "score": 0, "creation_date": 1501075210, "post_id": 45309434, "comment_id": 77617988, "body": "I would like to check input is redirect to null device or not.I think its specific to platform.Example for windows NUL and for unix /dev/null.I just want to know is there any common way"}], "owner": {"reputation": 125, "user_id": 4399545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e1ebf4600cc8dc9a9f17b8ed20c230ba?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Chatti", "link": "https://stackoverflow.com/users/4399545/suresh-chatti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1501014806, "creation_date": 1501001654, "last_edit_date": 1501014806, "question_id": 45309434, "link": "https://stackoverflow.com/questions/45309434/is-there-any-generic-way-to-check-os-stdin-or-input-redirected-from-null-device", "title": "is there any generic way to check os.Stdin or input redirected from null device?", "body": "<p>I would like to check input is redirected to null device or not in go language.I got one way for unix but I don't how to deal with windows or make it generic.This is what I did for unix</p>\n\n<pre><code>fd := os.Stdin.Fd()\nfmt.Print(fmt.Sprint(\"/proc/self/fd/\", fd))\nfileName, err1 := os.Readlink(fmt.Sprint(\"/proc/self/fd/\", fd))\n\nif err1 != nil {\n    fmt.Print(err1)\n}\nfmt.Println(\"fileName:\", fileName)\n</code></pre>\n"}, {"tags": ["go", "pprof"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1501002213, "post_id": 45309074, "comment_id": 77581168, "body": "What is &quot;evm-specification-miner&quot;? Is it possible that your program just doesn&#39;t spend much time in Go functions? What does the cumulative output look like?"}, {"owner": {"reputation": 1, "user_id": 8362465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ae6d4dae30d6e435e9635139e3a7c3?s=128&d=identicon&r=PG&f=1", "display_name": "Kegnarok", "link": "https://stackoverflow.com/users/8362465/kegnarok"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501056703, "post_id": 45309074, "comment_id": 77604056, "body": "<code>evm-specification-miner</code> is the name of my go application. I&#39;ve edited my question to add the cumulative output. I&#39;m not sure about what you call go functions, but it is highly unlikely that my program spends most of its time waiting for a goroutine or anything else."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501076525, "post_id": 45309074, "comment_id": 77619045, "body": "By Go functions, I mean code written in Go.  Does your code call into any C libraries or have any functionality implemented in assembly? Does it spend most of its time waiting for network? What do you expect to see in the profile? Can you share the code, or at least the part that creates the profile?"}, {"owner": {"reputation": 1, "user_id": 8362465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ae6d4dae30d6e435e9635139e3a7c3?s=128&d=identicon&r=PG&f=1", "display_name": "Kegnarok", "link": "https://stackoverflow.com/users/8362465/kegnarok"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501080541, "post_id": 45309074, "comment_id": 77622434, "body": "I use a library which itself calls C code. I wouldn&#39;t be surprised if the code spent most of its time in there, which might be the reason why I have this pprof output. I don&#39;t wait for the network, it is just a parallel thing I forgot to disable. I expect to see the name of my functions in the profile, such as:      <code>1.0hrs 15.12% 27.45% ... main.main</code>  I&#39;ve edited my post with the exact code used to generate the profile."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501081359, "post_id": 45309074, "comment_id": 77623159, "body": "If the bulk of time is in C code, then there&#39;s not going to be much to see in the profile. I&#39;m not sure offhand why you have <code>[evm-specification-miner]</code> rather than something like <code>main.main</code> or <code>package._Cfunc...</code>, but the output looks as I would expect otherwise. Are you using the latest Go release?"}, {"owner": {"reputation": 1, "user_id": 8362465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ae6d4dae30d6e435e9635139e3a7c3?s=128&d=identicon&r=PG&f=1", "display_name": "Kegnarok", "link": "https://stackoverflow.com/users/8362465/kegnarok"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501082039, "post_id": 45309074, "comment_id": 77623751, "body": "I&#39;m using go1.7.4, but I&#39;ll try with go1.8.3 and edit if it the profile is different."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501082127, "post_id": 45309074, "comment_id": 77623824, "body": "Try with the go1.9 rc while you&#39;re at it. There were some changes to pprof in there too."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 8362465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ae6d4dae30d6e435e9635139e3a7c3?s=128&d=identicon&r=PG&f=1", "display_name": "Kegnarok", "link": "https://stackoverflow.com/users/8362465/kegnarok"}, "is_accepted": true, "score": 0, "last_activity_date": 1501123976, "last_edit_date": 1501123976, "creation_date": 1501088509, "answer_id": 45333234, "question_id": 45309074, "link": "https://stackoverflow.com/questions/45309074/pprof-for-golang-doesnt-show-details-for-my-package/45333234#45333234", "title": "pprof (for golang) doesn&#39;t show details for my package", "body": "<p>Looks like updating to 1.9rc1 fixed it.</p>\n\n<p>I no longer have <code>[evm-specifiation-miner]</code> in the profile (for the record, the top functions do not even come from my own package, so it is even weirder than they did not appear before).</p>\n"}], "owner": {"reputation": 1, "user_id": 8362465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ae6d4dae30d6e435e9635139e3a7c3?s=128&d=identicon&r=PG&f=1", "display_name": "Kegnarok", "link": "https://stackoverflow.com/users/8362465/kegnarok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 0, "accepted_answer_id": 45333234, "answer_count": 1, "score": 0, "last_activity_date": 1501123976, "creation_date": 1501000604, "last_edit_date": 1501080825, "question_id": 45309074, "link": "https://stackoverflow.com/questions/45309074/pprof-for-golang-doesnt-show-details-for-my-package", "title": "pprof (for golang) doesn&#39;t show details for my package", "body": "<p>I've been trying to profile my go application (<code>evm-specification-miner</code>) with pprof, but the output is not really useful:</p>\n\n<pre><code>(pprof) top5\n108.59mins of 109.29mins total (99.36%)\nDropped 607 nodes (cum &lt;= 0.55mins)\nShowing top 5 nodes out of 103 (cum &gt;= 0.98mins)\n      flat  flat%   sum%        cum   cum%\n  107.83mins 98.66% 98.66% 108.64mins 99.40%  [evm-specification-miner]\n  0.36mins  0.33% 98.99%      6mins  5.49%  net.dialIP\n  0.30mins  0.28% 99.27%   4.18mins  3.83%  net.listenIP\n  0.06mins 0.052% 99.32%  34.66mins 31.71%  \ngithub.com/urfave/cli.BoolFlag.ApplyWithError\n  0.04mins 0.036% 99.36%   0.98mins   0.9%  net.probeIPv6Stack\n</code></pre>\n\n<p>And here is the cumulative output:</p>\n\n<pre><code>(pprof) top5 --cum\n1.80hrs of 1.82hrs total (98.66%)\nDropped 607 nodes (cum &lt;= 0.01hrs)\nShowing top 5 nodes out of 103 (cum &gt;= 1.53hrs)\n      flat  flat%   sum%        cum   cum%\n   1.80hrs 98.66% 98.66%    1.81hrs 99.40%  [evm-specification-miner]\n         0     0% 98.66%    1.53hrs 83.93%  net.IP.matchAddrFamily\n         0     0% 98.66%    1.53hrs 83.92%  net.(*UDPConn).WriteToUDP\n         0     0% 98.66%    1.53hrs 83.90%  net.sockaddrToUDP\n         0     0% 98.66%    1.53hrs 83.89%  net.(*UDPConn).readMsg\n</code></pre>\n\n<p>As you can see, most of the time is spent in <code>evm-specification-miner</code> (which is the name of my go application), but I've been unable to obtain more details or even understand what these square brackets meant (there is <a href=\"https://stackoverflow.com/questions/35139106/why-cant-i-see-my-own-application-functions-in-golangs-pprof\">a question</a> with a similar problem, but it didn't receive any answer).</p>\n\n<p>Here are the build and pprof commands:</p>\n\n<pre><code>go install evm-specification-miner\ngo tool pprof evm-specification-miner cpuprof\n</code></pre>\n\n<p>I've even tried the debug flags <code>-gcflags \"-N -l\"</code> (as noted here: <a href=\"https://golang.org/doc/gdb#Introduction\" rel=\"nofollow noreferrer\">https://golang.org/doc/gdb#Introduction</a>), to no avail.</p>\n\n<p>The profiling is done with calls to <code>pprof.StartCPUProfile()</code> and <code>pprof.StopCPUProfile()</code> as is explained by this blog post: <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">https://blog.golang.org/profiling-go-programs</a>:</p>\n\n<pre><code>func StartProfiling(cpuprof string) error {\n    f, err := os.Create(cpuprof)\n    if err != nil {\n        return err\n    }\n    return pprof.StartCPUProfile(f)\n}\n\nfunc StopProfiling() error {\n    pprof.StopCPUProfile()\n    return nil\n}\n</code></pre>\n\n<p><code>StartProfiling</code> is called at the beginning of <code>main()</code>, and <code>StopProfiling</code> when a signal (interrupt or kill) is received (or if the program terminates normally). This profile was obtained after an interruption.</p>\n"}, {"tags": ["ssl", "go", "tls1.2", "caddy"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1500997861, "post_id": 45308108, "comment_id": 77578193, "body": "To be clear is port 9000 listening http or https?"}, {"owner": {"reputation": 2786, "user_id": 257925, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/fdd2caab638636eef2caf5c221c48f51?s=128&d=identicon&r=PG", "display_name": "Ekin Koc", "link": "https://stackoverflow.com/users/257925/ekin-koc"}, "edited": false, "score": 3, "creation_date": 1500997919, "post_id": 45308108, "comment_id": 77578238, "body": "If it&#39;s listening to https, you should try <code>proxy &#47; https:&#47;&#47;localhost:9000</code>"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1500999526, "post_id": 45308108, "comment_id": 77579394, "body": "@captncraig HTTPS. Thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500999720, "post_id": 45308172, "comment_id": 77579525, "body": "Or get rid of caddy, since you&#39;re just using the Go http server to proxy the Go http server which doesn&#39;t get you any benefit."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500999926, "post_id": 45308172, "comment_id": 77579659, "body": "@Adrian presumably he likes the Let&#39;s Encrypt integration from caddy. Which could be gotten in other ways in his own code, but caddy is pretty easy to throw in."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501000011, "post_id": 45308172, "comment_id": 77579709, "body": "So is autocert, plus, <i>OP is already exposing HTTPS from their own app</i>, which is the problem stated (Caddy is sending HTTP traffic when the app expects HTTPS), which means <i>they already have to deal with certs</i>. In the scenario given, Caddy adds zero value."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2384183"}, "edited": false, "score": 0, "creation_date": 1501001853, "post_id": 45308172, "comment_id": 77580941, "body": "Or OP could <a href=\"https://github.com/mholt/caddy/wiki/Embedding-Caddy-in-your-Go-program\" rel=\"nofollow noreferrer\">embed Caddy</a>"}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 5, "last_activity_date": 1500997949, "creation_date": 1500997949, "answer_id": 45308172, "question_id": 45308108, "link": "https://stackoverflow.com/questions/45308108/https-proxy-with-caddy/45308172#45308172", "title": "HTTPS proxy with caddy", "body": "<p>From the <a href=\"https://caddyserver.com/docs/proxy\" rel=\"noreferrer\">caddy docs</a></p>\n\n<blockquote>\n  <p><strong>to</strong> is the destination endpoint to proxy to. At least one is required,\n  but multiple may be specified. If a scheme (http/https) is not\n  specified, http is used. Unix sockets may also be used by prefixing\n  \"unix:\".</p>\n</blockquote>\n\n<p>So maybe it is sending <strong>http</strong> requests to the proxied <strong>https</strong> endpoint.</p>\n\n<p>Does </p>\n\n<pre><code>mysite.com {\n    proxy / https://localhost:9000 {\n        max_fails 1\n    }\n    log logfile\n}\n</code></pre>\n\n<p>fix it?</p>\n\n<p>If that is the case, you may not strictly need your app on :9000 to listen https. It may simplify your deployment or cert management to just have it listen http and have caddy manage all the certs.</p>\n"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4563, "favorite_count": 0, "accepted_answer_id": 45308172, "answer_count": 1, "score": 1, "last_activity_date": 1500997949, "creation_date": 1500997782, "question_id": 45308108, "link": "https://stackoverflow.com/questions/45308108/https-proxy-with-caddy", "title": "HTTPS proxy with caddy", "body": "<p>I am working with a Golang app and Caddy as the HTTP server. The golang app rejects every http connection, it only can be used over HTTPS. This app is a kind of API/service that is consumed by other apps. As, it requires HTTPS I installed Caddy so I can take advantage of the automatic SSL certificate and use proxy to switch between the ports.</p>\n\n<p>The application is running in the port 9000, so, the consumers will only writte <code>mysite.com</code> and caddy should be in charge of redirect that petitions to the port 9000 but maintaining the HTTPS. The configuration in caddy for the site is:</p>\n\n<pre><code>mysite.com {\n    proxy / :9000 {\n        max_fails 1\n    }\n    log logfile\n}\n</code></pre>\n\n<p>Nevertheless, it seems like when the proxy is made the HTTPS is lost. I checked the logs for the application (no the logs of caddy) and I get this:</p>\n\n<pre><code>http: TLS handshake error from xxx.xxx.xxx.xxx:xxxx: tls: oversized record received with length 21536\n</code></pre>\n\n<p>So, based in this error, to me looks like the HTTP proxy  made by caddy is losing the HTTPS. What can I do?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1500995105, "post_id": 45307076, "comment_id": 77576028, "body": "Is <code>main.go</code> the file that was modified, and are you sure you&#39;re <code>go run</code>ing the correct <code>main.go</code> file?"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 1, "creation_date": 1500995152, "post_id": 45307076, "comment_id": 77576064, "body": "Did you happen to switch the location of the project while working on it? Your editor may be saving the changes in the old file location."}, {"owner": {"reputation": 286, "user_id": 5899150, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4380bc3fef16ee11788a3efea8e1cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Majonsi", "link": "https://stackoverflow.com/users/5899150/majonsi"}, "edited": false, "score": 0, "creation_date": 1500995316, "post_id": 45307076, "comment_id": 77576190, "body": "@Adian main.go is not the modified file (there is a lot of .go files into my project). And yes it is the correct main.go file"}, {"owner": {"reputation": 286, "user_id": 5899150, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4380bc3fef16ee11788a3efea8e1cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Majonsi", "link": "https://stackoverflow.com/users/5899150/majonsi"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1500995402, "post_id": 45307076, "comment_id": 77576256, "body": "@Gavin No I didn&#39;t switch my location of the project. I tried to directly change a file of the project but it didn&#39;t worked"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1500996803, "post_id": 45307076, "comment_id": 77577360, "body": "@Majonsi: Add the output from these commands to your question: <code>go version</code>, <code>go env</code>, and <code>SRC=main.go &amp;&amp; ls -l $SRC &amp;&amp; cat $SRC &amp;&amp; go run -x $SRC</code>"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1500996947, "post_id": 45307076, "comment_id": 77577461, "body": "Try deleting <code>$GOPATH&#47;pkg</code>"}, {"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 1, "creation_date": 1500997653, "post_id": 45307076, "comment_id": 77578022, "body": "That&#39;s only specific to this one project; in other projects you don&#39;t have that problem?"}, {"owner": {"reputation": 286, "user_id": 5899150, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4380bc3fef16ee11788a3efea8e1cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Majonsi", "link": "https://stackoverflow.com/users/5899150/majonsi"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1500997685, "post_id": 45307076, "comment_id": 77578046, "body": "@tkausl I tried but it didn&#39;t work. Same when I delete the entire $GOPATH folder and then extract it again from the go archive"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501000501, "post_id": 45307076, "comment_id": 77580021, "body": "My best recommendation would be not to use <code>go run</code> at all, honestly. Go is not a scripting language - just build the application and run it."}, {"owner": {"reputation": 286, "user_id": 5899150, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4380bc3fef16ee11788a3efea8e1cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Majonsi", "link": "https://stackoverflow.com/users/5899150/majonsi"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501060624, "post_id": 45307076, "comment_id": 77606932, "body": "@Adrian <code>go run</code> will compile the code (into a temporary folder) and then run it. So it change nothing. So I advise you to read (again?) the go documentation just <a href=\"https://golang.org/cmd/go/#hdr-Compile_and_run_Go_program\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1501069851, "post_id": 45307076, "comment_id": 77613845, "body": "But it doesn&#39;t work the same, because go run targets a file, while build/install targets a package, which is the level of granularity expected in Go. Go run is fine for a one off run of a single file script, but my recommendation stands: don&#39;t use go run. It implies a usage pattern that doesn&#39;t fit with Go. Just build and run your project normally."}], "answers": [{"comments": [{"owner": {"reputation": 1044, "user_id": 1949322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5b49c06625a28488b90d2b7f960163f?s=128&d=identicon&r=PG", "display_name": "WaltPurvis", "link": "https://stackoverflow.com/users/1949322/waltpurvis"}, "edited": false, "score": 0, "creation_date": 1501038677, "post_id": 45308750, "comment_id": 77595750, "body": "&quot;<i>take into account that go run usually does not need a file specification</i>\u2026&quot;   What??"}, {"owner": {"reputation": 286, "user_id": 5899150, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4380bc3fef16ee11788a3efea8e1cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Majonsi", "link": "https://stackoverflow.com/users/5899150/majonsi"}, "edited": false, "score": 0, "creation_date": 1501054041, "post_id": 45308750, "comment_id": 77602231, "body": "@Windys My GOPATH is pointing to the right folder. And I don&#39;t have to specify all the file of my project because my main function is only on my main.go file."}], "tags": [], "owner": {"reputation": 2107, "user_id": 1968354, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5bf273b96c177d846813c35f7d1d214d?s=128&d=identicon&r=PG", "display_name": "NeatNerd", "link": "https://stackoverflow.com/users/1968354/neatnerd"}, "is_accepted": false, "score": 1, "last_activity_date": 1500999732, "creation_date": 1500999732, "answer_id": 45308750, "question_id": 45307076, "link": "https://stackoverflow.com/questions/45307076/golang-go-run-is-always-running-old-code-even-after-changes/45308750#45308750", "title": "golang: go run is always running old code even after changes", "body": "<p>I think your <code>GOPATH</code> is pointing to a wrong folder. Please, run <code>go env</code> to make  sure that it is pointing to the right directory. If not set it to location where go files are. Please, take into account that <code>go run</code> usually does not need a file specification and if you do you have to list defacto all files of your app that main.go depends upon.</p>\n\n<p>Have a look ``<a href=\"https://golang.org/cmd/go/#hdr-Compile_and_run_Go_program\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"tags": [], "owner": {"reputation": 286, "user_id": 5899150, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4380bc3fef16ee11788a3efea8e1cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Majonsi", "link": "https://stackoverflow.com/users/5899150/majonsi"}, "is_accepted": true, "score": 2, "last_activity_date": 1501060220, "creation_date": 1501060220, "answer_id": 45322390, "question_id": 45307076, "link": "https://stackoverflow.com/questions/45307076/golang-go-run-is-always-running-old-code-even-after-changes/45322390#45322390", "title": "golang: go run is always running old code even after changes", "body": "<p>Okay! \nThe problem come from the imports. In the code some imports was calling old version of the code. </p>\n"}], "owner": {"reputation": 286, "user_id": 5899150, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4380bc3fef16ee11788a3efea8e1cf0?s=128&d=identicon&r=PG&f=1", "display_name": "Majonsi", "link": "https://stackoverflow.com/users/5899150/majonsi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2112, "favorite_count": 0, "accepted_answer_id": 45322390, "answer_count": 2, "score": 2, "last_activity_date": 1593795436, "creation_date": 1500994979, "last_edit_date": 1500996050, "question_id": 45307076, "link": "https://stackoverflow.com/questions/45307076/golang-go-run-is-always-running-old-code-even-after-changes", "title": "golang: go run is always running old code even after changes", "body": "<p>I have a weird issue with golang. I run the command (like everytime):</p>\n\n<pre><code>go run main.go\n</code></pre>\n\n<p>Then I made some change into my code and then I run again:</p>\n\n<pre><code>go run main.go\n</code></pre>\n\n<p>But the executed code is the old version of the code. So I tried some stuff:</p>\n\n<ul>\n<li>Reboot the computer</li>\n<li>Delete all the temporary binaries into temp folder</li>\n<li>Reinstall go</li>\n<li>Delete and put back my code</li>\n<li>Remove some file</li>\n</ul>\n\n<p>But it is still running my old version of the code. I didn't find solution about this issue, and the few post about it doesn't give a solution (<a href=\"https://www.reddit.com/r/golang/comments/5g7ci4/go_program_running_old_code/\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/womzrEYpfjc\" rel=\"nofollow noreferrer\">here</a>). </p>\n\n<p>About my configuration it is the following:</p>\n\n<ul>\n<li>Raspberry pi running Raspbian (updated)</li>\n<li>Go version 1.8.1</li>\n</ul>\n\n<p>I hope you can help me !\nThank in advance!</p>\n\n<p>Best regards,</p>\n"}, {"tags": ["go", "deadlock"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1500993516, "post_id": 45306497, "comment_id": 77574807, "body": "Is f1 guaranteed to exit? Does it call other functions that lock the mutex?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1500993569, "post_id": 45306497, "comment_id": 77574848, "body": "Deadlock may easily occur if one method of  <code>cache</code> calls another method, and both contain the <code>Lock()</code> call."}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "edited": false, "score": 3, "creation_date": 1500993725, "post_id": 45306497, "comment_id": 77574954, "body": "As above, depends on what <code>f1()</code> does. Also, you don&#39;t need to create a new mutex and use <code>Init()</code>. Simply use <code>sync.Mutex</code> instead of <code>*sync,Mutex</code> in your struct as the zero value by design is a valid unlocked mutex."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1500993762, "post_id": 45306497, "comment_id": 77574980, "body": "Have you run this under the race detector? I&#39;m not sure if it can detect possible multiple lock attempts, but it may reveal something..."}, {"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1500995263, "post_id": 45306497, "comment_id": 77576148, "body": "@MiloChristiansen thanks, but race detector didn&#39;t output anything"}, {"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1500995307, "post_id": 45306497, "comment_id": 77576182, "body": "@captncraig I have actually f1, f2, f3, but they are pretty easy and 100% sure they don&#39;t call each others somehow"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1500995358, "post_id": 45306497, "comment_id": 77576221, "body": "@Thomas It&#39;s not a requirement that the methods directly call each other. It may be <code>cache.f1()</code> calls <code>foo()</code> which is a &quot;standalone&quot; function, and if <code>foo()</code> calls <code>cache.f2()</code>, we&#39;re at the same deadlock. See edited answer. If even no such transitive calls exist in your code, then you need to post an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, else it becomes off-topic."}, {"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1500995400, "post_id": 45306497, "comment_id": 77576255, "body": "@icza sure thanks but no I checked for indirect calls too"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1500995465, "post_id": 45306497, "comment_id": 77576301, "body": "How are you observing &quot;deadlock&quot;? Is the app crashing with the &quot;all goroutines are asleep&quot; message, or are things just not responding, or what? What are your actual symptoms here?"}, {"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1500995922, "post_id": 45306497, "comment_id": 77576644, "body": "yes, all goroutines are asleep crash"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1500996915, "post_id": 45306497, "comment_id": 77577431, "body": "We really don&#39;t have enough info to help you. If you can share a reproducable example, we can help. Alternately, I highly recommend <a href=\"https://godoc.org/github.com/hashicorp/golang-lru\" rel=\"nofollow noreferrer\">this package</a> as a reliable, goroutine safe lru."}], "answers": [{"comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1501001183, "post_id": 45306574, "comment_id": 77580514, "body": "It exposes the mutex only at the package level, since it&#39;s not exported. Correct? Just clarifing for the OP since it could be confusing otherwise."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1501001574, "post_id": 45306574, "comment_id": 77580776, "body": "@reticentroot No, that is not true. Inside a package, all package-level identifiers are visible. Outside of it, only exported identifiers. The type <code>cache</code> itself is not exported, but for example if an exported function returns a value of type <code>cache</code> or <code>*cache</code>, its <code>Lock()</code> method can be called by anyone."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1501001775, "post_id": 45306574, "comment_id": 77580894, "body": "Ahh yes your right the mutex is embedded, you could circumvent that by using an unexported member of type mutex. Of course initialization would have to taken care of again... So I guess that&#39;s where good documentation comes in lol. Can it be abstracted in anyway to &quot;hide&quot; the lock?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 1, "creation_date": 1501002239, "post_id": 45306574, "comment_id": 77581186, "body": "@reticentroot In some cases it can be, e.g. you use a non-pointer field, but make sure you use a pointer to the wrapped struct to avoid accidentally copying the mutex, and make sure the field is addressable as the address is needed to call the <code>Lock()</code> and <code>Unlock()</code> methods which have pointer receivers. This is possible without initialization as the zero value of <code>sync.Mutex</code> is a valid, unlocked mutex."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1500996710, "last_edit_date": 1500996710, "creation_date": 1500993719, "answer_id": 45306574, "question_id": 45306497, "link": "https://stackoverflow.com/questions/45306497/how-can-this-pattern-result-in-a-deadlock/45306574#45306574", "title": "How can this pattern result in a deadlock?", "body": "<p>Deadlock may easily occur if one method of <code>cache</code> calls another method, and both contain the <code>Lock()</code> call.</p>\n\n<p>See this example:</p>\n\n<pre><code>func (this *cache) f1() {\n    this.mutex.Lock()\n    defer this.mutex.Unlock()\n    this.f2()\n}\n\nfunc (this *cache) f2() {\n    this.mutex.Lock()\n    defer this.mutex.Unlock()\n}\n\nfunc main() {\n    c := &amp;cache{}\n    c.Init()\n    c.f1()\n    fmt.Println(\"Hello, playground\")\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/RR_ohOhnot\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [semacquire]:\nsync.runtime_SemacquireMutex(0x1040a12c, 0x8)\n    /usr/local/go/src/runtime/sema.go:62 +0x40\nsync.(*Mutex).Lock(0x1040a128, 0x10429f5c)\n    /usr/local/go/src/sync/mutex.go:87 +0xa0\nmain.(*cache).f2(0x10429f94, 0x1100c0)\n    /tmp/sandbox647646735/main.go:23 +0x40\nmain.(*cache).f1(0x10429f94, 0xdf6e0)\n    /tmp/sandbox647646735/main.go:19 +0xa0\nmain.main()\n    /tmp/sandbox647646735/main.go:30 +0x60\n</code></pre>\n\n<p>Note that there does not need to have a direct call from one method to the other, it may also be a transitive call. For example <code>cache.f1()</code> may call <code>foo()</code> which may be a \"standalone\" function, and if <code>foo()</code> calls <code>cache.f2()</code>, we're at the same deadlock.</p>\n\n<p><strong>Improvements:</strong></p>\n\n<p>Don't name your receiver <code>this</code>, it is not idiomatic. You may simply call it <code>c</code>. Read more about it here: <a href=\"https://stackoverflow.com/questions/23482068/in-go-is-naming-the-receiver-variable-self-misleading-or-good-practice/23494386#23494386\">In Go is naming the receiver variable &#39;self&#39; misleading or good practice?</a></p>\n\n<p>You may embed mutexes, making it convenient to use and eliminate the need for initialization. Read more about it here: <a href=\"https://stackoverflow.com/questions/44949467/when-do-you-embed-mutex-in-struct-in-go/44950096#44950096\">When do you embed mutex in struct in Go?</a></p>\n\n<pre><code>type cache struct {\n    sync.Mutex\n}\n\nfunc (c *cache) f1() {\n    c.Lock()\n    defer c.Unlock()\n    c.f2()\n}\n\nfunc (c *cache) f2() {\n    c.Lock()\n    defer c.Unlock()\n}\n\nfunc main() {\n    c := &amp;cache{}\n    c.f1()\n    fmt.Println(\"Hello, playground\")\n}\n</code></pre>\n\n<p>Of course this also causes a deadlock. Try it on the <a href=\"https://play.golang.org/p/6RICGd0Fwm\" rel=\"nofollow noreferrer\">Go Playground</a>. Also note that this inherently exposes the mutex (as the embedded type starts with lowecae letter), so anyone will be able to call the <code>Lock()</code> and <code>Unlock()</code> methods. Depends on case whether this is a problem.</p>\n"}], "owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 45306574, "answer_count": 1, "score": 0, "last_activity_date": 1500996710, "creation_date": 1500993463, "last_edit_date": 1500995367, "question_id": 45306497, "link": "https://stackoverflow.com/questions/45306497/how-can-this-pattern-result-in-a-deadlock", "title": "How can this pattern result in a deadlock?", "body": "<p>I have a (LRU) cache object and I encounter a deadlock... How is this possible?</p>\n\n<pre><code>  type cache struct {\n    mutex *sync.Mutex\n    ...\n  }\n\n  func (this *cache) Init() {  // guaranteed to be called once, in main()\n    this.mutex = &amp;sync.Mutex{}\n  }\n\n  func (this *cache) f1() {\n     // Pattern for accessing mute, at the top of any function of 'cache' where needed.\n     this.mutex.Lock()\n     defer this.mutex.Unlock()\n     ...\n  }\n\n\n  func (this *cache) f2() {\n     this.mutex.Lock()\n     defer this.mutex.Unlock()\n     ...\n  }\n</code></pre>\n\n<p>In every function <code>mutex</code> appears, it is accessed with this pattern only.\nAnd yet... I get a deadlock. How come this is possible?</p>\n\n<p>Note: This code has been running on a production server for 10 months and it is the first time I get that.</p>\n\n<p><strong>EDIT</strong>: so f1() can call (indirectly) f2() to get a deadlock based on the answers. True but in my code this doesn't happen, so I really wonder</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "edited": false, "score": 0, "creation_date": 1500988912, "post_id": 45304319, "comment_id": 77570793, "body": "Is your <code>repository.connection.Query(query)</code> executing the query only once?"}, {"owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "edited": false, "score": 0, "creation_date": 1500988980, "post_id": 45304319, "comment_id": 77570865, "body": "Or what about the behaviour of the <code>@...</code> varaibles? Is it the same in Go as in DataGrip?"}, {"owner": {"reputation": 1236, "user_id": 1221253, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c05edd2a49079a60ee18c6609dc44e10?s=128&d=identicon&r=PG&f=1", "display_name": "Dina", "link": "https://stackoverflow.com/users/1221253/dina"}, "reply_to_user": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "edited": false, "score": 0, "creation_date": 1500989092, "post_id": 45304319, "comment_id": 77570969, "body": "Yes, just once. And my intuition also goes to blaming the @ but I pass the query as a string, so I&#39;m not sure how it can go wrong. The string is printed correctly by the logger. Why would it not pass correctly to the DB?"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1500990808, "post_id": 45304319, "comment_id": 77572534, "body": "On a side note, your whole else block is unnecessarily nested. Since you return in the if, you don&#39;t even need an else."}, {"owner": {"reputation": 1236, "user_id": 1221253, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c05edd2a49079a60ee18c6609dc44e10?s=128&d=identicon&r=PG&f=1", "display_name": "Dina", "link": "https://stackoverflow.com/users/1221253/dina"}, "edited": false, "score": 0, "creation_date": 1500992017, "post_id": 45304319, "comment_id": 77573653, "body": "I need the else because it uses the rows from the if. I agree it&#39;s a little annoying."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1500995166, "post_id": 45304319, "comment_id": 77576077, "body": "What driver are you using to connect to mysql? <a href=\"https://github.com/go-sql-driver/mysql\" rel=\"nofollow noreferrer\">This one</a> or some other one?"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1501001531, "post_id": 45304319, "comment_id": 77580749, "body": "@Dina Just get your <code>rows, err</code> and check the <code>err</code> on the next line. You do it in your else clause <code>err = rows.Err() ... </code> (which could actually be <code>if err = rows.Err(); err != nil ...</code>)"}, {"owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "edited": false, "score": 0, "creation_date": 1501002598, "post_id": 45304319, "comment_id": 77581379, "body": "Can you share the code where the <code>defaults</code> variable declared and used? Does it already has something int it?"}, {"owner": {"reputation": 1236, "user_id": 1221253, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c05edd2a49079a60ee18c6609dc44e10?s=128&d=identicon&r=PG&f=1", "display_name": "Dina", "link": "https://stackoverflow.com/users/1221253/dina"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1501132434, "post_id": 45304319, "comment_id": 77645249, "body": "@mkopriva Yes, that&#39;s the one. Good point. I will edit the question."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1501146013, "post_id": 45304319, "comment_id": 77653136, "body": "@Dina did you check <b>mysqld</b>&#39;s <i>general query log</i> to see what sql statements are sent to the mysql server by both the Go app and DataGrip? Seems like one is interpreting the query differently from the other before sending it to the server."}, {"owner": {"reputation": 1236, "user_id": 1221253, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c05edd2a49079a60ee18c6609dc44e10?s=128&d=identicon&r=PG&f=1", "display_name": "Dina", "link": "https://stackoverflow.com/users/1221253/dina"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1501157158, "post_id": 45304319, "comment_id": 77661447, "body": "@mkopriva You&#39;re right. I&#39;ve been planning to do this but didn&#39;t get a chance. Problem is this is actually an AuroraDB instance on Amazon and I don&#39;t have easy access to manage it. But I just installed a local MySQL so I have more control over it and I can turn on the logs."}], "owner": {"reputation": 1236, "user_id": 1221253, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c05edd2a49079a60ee18c6609dc44e10?s=128&d=identicon&r=PG&f=1", "display_name": "Dina", "link": "https://stackoverflow.com/users/1221253/dina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 193, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1501132523, "creation_date": 1500988042, "last_edit_date": 1501132523, "question_id": 45304319, "link": "https://stackoverflow.com/questions/45304319/different-result-from-golang-db-query-and-actually-running-on-db", "title": "Different result from Golang db.query and actually running on DB", "body": "<p>I have a MySQL DB on which I run a query which gets the top row from each group (according to some grouping criterion):</p>\n\n<pre><code>SELECT ranked.id, ranked.os, ranked.version, ranked.timestamp, agent_metadata.*\nFROM\n  (SELECT *,\n     @os_rank := IF(@current_os = os, @os_rank + 1, 1) AS os_rank,\n     @current_os := os\n   FROM default_version\n   ORDER BY os DESC, timestamp DESC\n  ) as ranked INNER JOIN agent_metadata ON ranked.os = agent_metadata.os AND ranked.version = agent_metadata.version\nWHERE os_rank = 1;\n</code></pre>\n\n<p>When I run this query on my DB (using DataGrip) I get the expected result.</p>\n\n<p>However, when I run the same query from my Go code using <code>db.query</code>, instead of getting 2 rows, I get 5 rows.</p>\n\n<p>I have some logic which builds the query but before running it I print it to the log:</p>\n\n<pre><code>// ... build query\nquery := qb.String()\n\nlogger.Debugf(\"Executing: %s\", query)\n\nif rows, err := repository.connection.Query(query); err != nil {\n    return defaults, errors.Wrap(err, \"get default versions\")\n} else {\n    defer rows.Close()\n    for rows.Next() {\n\n        result := DefaultVersionExtended{}\n\n        err := rows.Scan(\n            &amp;result.Id,\n            &amp;result.DefaultVersion.OS,\n            &amp;result.DefaultVersion.Version,\n            &amp;result.Timestamp,\n            &amp;result.AgentMetadata.OS,\n            &amp;result.AgentMetadataExtended.Version,\n            &amp;result.AgentMetadataExtended.Name,\n            &amp;result.AgentMetadataExtended.Description,\n            &amp;result.AgentMetadataExtended.ReleaseNotesUrl,\n            &amp;result.AgentMetadataExtended.UploadTime)\n\n        if err != nil {\n            return defaults, errors.Wrap(err, \"get default versions\")\n        }\n\n        defaults = append(defaults, result)\n    }\n\n    err = rows.Err()\n    if err != nil {\n        return defaults, errors.Wrap(err, \"get default versions\")\n    }\n\n    return defaults, errors.Wrap(err, \"get default versions\")\n}\n</code></pre>\n\n<p>This is the output from the log:</p>\n\n<blockquote>\n  <p>time=\"2017-07-25T15:07:47+03:00\" level=debug msg=\"Executing: SELECT\n  ranked.id, ranked.os, ranked.version, ranked.timestamp,\n  agent_metadata.* FROM (SELECT *, @os_rank := IF(@current_os = os,\n  @os_rank + 1, 1) AS os_rank, @current_os := os FROM default_version\n  ORDER BY os DESC, timestamp DESC) as ranked INNER JOIN agent_metadata\n  ON ranked.os = agent_metadata.os AND ranked.version =\n  agent_metadata.version WHERE os_rank = 1\"\n  class=\"auroradb.agent_repository\"</p>\n</blockquote>\n\n<p>If I copy-paste the query from the log into my DB console and run it I get the correct result (2 rows):</p>\n\n<p><a href=\"https://i.stack.imgur.com/h7y3R.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/h7y3R.png\" alt=\"enter image description here\"></a></p>\n\n<p>However, my unit test fails, because I expect the result to have 2 rows but it actually has 5:</p>\n\n<blockquote>\n  <p>Error:      \"[{%!s(int=1) {windows 1.2.3} {{windows 1.2.3 My name This is\n  a test agent for windows <a href=\"http://notes-heaven.com\" rel=\"nofollow noreferrer\">http://notes-heaven.com</a>} 2017-07-25\n  12:07:45.099 +0000 UTC} 2017-07-25 12:07:45.38 +0000 UTC} {%!s(int=3)\n  {windows 1.2.3.1} {{windows 1.2.3.1 My name 2 This is a second test\n  agent for windows <a href=\"http://notes-heaven.com/1\" rel=\"nofollow noreferrer\">http://notes-heaven.com/1</a>} 2017-07-25 12:07:46.237\n  +0000 UTC} 2017-07-25 12:07:46.519 +0000 UTC} {%!s(int=4) {windows 1.2.3.2} {{windows 1.2.3.2 My name 3 This is a second test agent for windows <a href=\"http://notes-heaven.com/3\" rel=\"nofollow noreferrer\">http://notes-heaven.com/3</a>} 2017-07-25 12:07:46.801 +0000 UTC}\n  2017-07-25 12:07:47.082 +0000 UTC} {%!s(int=2) {mac 1.2.3.2.M} {{mac\n  1.2.3.2.M My name 3.M This is a second test agent for windows <a href=\"http://notes-heaven.com/3\" rel=\"nofollow noreferrer\">http://notes-heaven.com/3</a>} 2017-07-25 12:07:45.662 +0000 UTC}\n  2017-07-25 12:07:45.944 +0000 UTC} {%!s(int=5) {mac 1.2.3.5.M} {{mac\n  1.2.3.5.M My name 3.M This is a second test agent for windows <a href=\"http://notes-heaven.com/3\" rel=\"nofollow noreferrer\">http://notes-heaven.com/3</a>} 2017-07-25 12:07:47.364 +0000 UTC}\n  2017-07-25 12:07:47.653 +0000 UTC}]\" should have 2 item(s), but has 5</p>\n</blockquote>\n\n<p>The returned result is in fact the entire data from agent_metadata. It's as if the entire logic selecting the top result or each group didn't work.</p>\n\n<p>I'm using <a href=\"https://github.com/go-sql-driver/mysql\" rel=\"nofollow noreferrer\">go-sql-driver</a> as driver.</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 2, "creation_date": 1500985969, "post_id": 45303326, "comment_id": 77568277, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/44705817/parsing-a-json-datetime-in-revel\">Parsing a json datetime in revel</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1500988978, "post_id": 45303326, "comment_id": 77570861, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/25845172/parsing-date-string-in-golang\">Parsing date string in golang</a>"}], "answers": [{"comments": [{"owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "edited": false, "score": 0, "creation_date": 1500988168, "post_id": 45304122, "comment_id": 77570136, "body": "Right, and for the <code>UnmarshalJSON</code> func, OP could add multiple  <code>time.Parse</code> attempts based on how many different formats need to be supported. I believe the format for <code>time.RFC3339</code> is the default parser and more formats can be found in the <a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"nofollow noreferrer\">docs</a>"}, {"owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "reply_to_user": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "edited": false, "score": 1, "creation_date": 1500988563, "post_id": 45304122, "comment_id": 77570477, "body": "Sure, when you have the custom un/marshal functions, you should try to cover every case that&#39;s possible."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1500992449, "post_id": 45304122, "comment_id": 77573959, "body": "Minor nit: it should be <code>JSONBirthDate</code>, not <code>JsonBirthDate</code>, as per <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#initialisms\" rel=\"nofollow noreferrer\">the code style</a>."}, {"owner": {"reputation": 1044, "user_id": 1949322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5b49c06625a28488b90d2b7f960163f?s=128&d=identicon&r=PG", "display_name": "WaltPurvis", "link": "https://stackoverflow.com/users/1949322/waltpurvis"}, "edited": false, "score": 4, "creation_date": 1501037543, "post_id": 45304122, "comment_id": 77595491, "body": "What is JB in the <code>*j = JB(t)</code> line?"}, {"owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "edited": false, "score": 1, "creation_date": 1501054156, "post_id": 45304122, "comment_id": 77602316, "body": "Since you have a type alias, you need to cast it. Read this, and the corresponding links to the documentation: <a href=\"https://stackoverflow.com/questions/19577423/how-to-cast-to-a-type-alias-in-go\" title=\"how to cast to a type alias in go\">stackoverflow.com/questions/19577423/&hellip;</a>"}, {"owner": {"reputation": 908, "user_id": 1354282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vyer0.jpg?s=128&g=1", "display_name": "danielcooperxyz", "link": "https://stackoverflow.com/users/1354282/danielcooperxyz"}, "edited": false, "score": 5, "creation_date": 1535729804, "post_id": 45304122, "comment_id": 91188354, "body": "The <code>MarshalJSON()</code> method causes a stack overflow panic, as it indirectly calls itself."}, {"owner": {"reputation": 11265, "user_id": 133234, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b926692d67a0b4051162b1560f943a88?s=128&d=identicon&r=PG", "display_name": "Leo Alekseyev", "link": "https://stackoverflow.com/users/133234/leo-alekseyev"}, "reply_to_user": {"reputation": 908, "user_id": 1354282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vyer0.jpg?s=128&g=1", "display_name": "danielcooperxyz", "link": "https://stackoverflow.com/users/1354282/danielcooperxyz"}, "edited": false, "score": 0, "creation_date": 1617672001, "post_id": 45304122, "comment_id": 118363208, "body": "@danielcooperxyz is right; you need a cast here: <code>return j.(time.Time).MarshalJSON()</code>"}], "tags": [], "owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "is_accepted": true, "score": 23, "last_activity_date": 1607679296, "last_edit_date": 1607679296, "creation_date": 1500987545, "answer_id": 45304122, "question_id": 45303326, "link": "https://stackoverflow.com/questions/45303326/how-to-parse-non-standard-time-format-from-json/45304122#45304122", "title": "How to parse non standard time format from json", "body": "<p>That's a case when you need to implement custom marshal and unmarshal functions.</p>\n<pre><code>UnmarshalJSON(b []byte) error { ... }\n\nMarshalJSON() ([]byte, error) { ... }\n</code></pre>\n<p>By following the example in the Golang documentation of <a href=\"https://golang.org/pkg/encoding/json/#pkg-overview\" rel=\"noreferrer\">json package</a> you get something like:</p>\n<pre><code>// First create a type alias\ntype JsonBirthDate time.Time\n\n// Add that to your struct\ntype Person struct {\n    Name string `json:&quot;name&quot;`\n    BirthDate JsonBirthDate `json:&quot;birth_date&quot;`\n}\n\n// Implement Marshaler and Unmarshaler interface\nfunc (j *JsonBirthDate) UnmarshalJSON(b []byte) error {\n    s := strings.Trim(string(b), &quot;\\&quot;&quot;)\n    t, err := time.Parse(&quot;2006-01-02&quot;, s)\n    if err != nil {\n        return err\n    }\n    *j = JsonBirthDate(t)\n    return nil\n}\n    \nfunc (j JsonBirthDate) MarshalJSON() ([]byte, error) {\n    return json.Marshal(j)\n}\n\n// Maybe a Format function for printing your date\nfunc (j JsonBirthDate) Format(s string) string {\n    t := time.Time(j)\n    return t.Format(s)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 9739158, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Liam Lian", "link": "https://stackoverflow.com/users/9739158/liam-lian"}, "is_accepted": false, "score": 2, "last_activity_date": 1525411881, "creation_date": 1525411881, "answer_id": 50167784, "question_id": 45303326, "link": "https://stackoverflow.com/questions/45303326/how-to-parse-non-standard-time-format-from-json/50167784#50167784", "title": "How to parse non standard time format from json", "body": "<p>If there are lots of struct and you just implement custom marshal und unmarshal functions, that's a lot of work to do so. You can use another lib instead\uff0csuch as a json-iterator extension <a href=\"https://github.com/liamylian/jsontime\" rel=\"nofollow noreferrer\">jsontime</a>:</p>\n\n<pre><code>import \"github.com/liamylian/jsontime\"\n\nvar json = jsontime.ConfigWithCustomTimeFormat\n\ntype Book struct {\n    Id        int           `json:\"id\"`\n    UpdatedAt *time.Time    `json:\"updated_at\" time_format:\"sql_date\" time_utc:\"true\"`\n    CreatedAt time.Time     `json:\"created_at\" time_format:\"sql_datetime\" time_location:\"UTC\"`\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3800, "user_id": 1037465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b68d0fdfc74f6a893936d043d2f545b?s=128&d=identicon&r=PG", "display_name": "a-h", "link": "https://stackoverflow.com/users/1037465/a-h"}, "is_accepted": false, "score": 1, "last_activity_date": 1538338312, "creation_date": 1538338312, "answer_id": 52581726, "question_id": 45303326, "link": "https://stackoverflow.com/questions/45303326/how-to-parse-non-standard-time-format-from-json/52581726#52581726", "title": "How to parse non standard time format from json", "body": "<p>I wrote a package for handling <code>yyyy-MM-dd</code> and <code>yyyy-MM-ddThh:mm:ss</code> dates at <a href=\"https://github.com/a-h/date\" rel=\"nofollow noreferrer\">https://github.com/a-h/date</a></p>\n\n<p>It uses the type alias approach in the answer above, then implements the <code>MarshalJSON</code> and <code>UnmarshalJSON</code> functions with a few alterations.</p>\n\n<pre><code>// MarshalJSON outputs JSON.\nfunc (d YYYYMMDD) MarshalJSON() ([]byte, error) {\n    return []byte(\"\\\"\" + time.Time(d).Format(formatStringYYYYMMDD) + \"\\\"\"), nil\n}\n\n// UnmarshalJSON handles incoming JSON.\nfunc (d *YYYYMMDD) UnmarshalJSON(b []byte) (err error) {\n    if err = checkJSONYYYYMMDD(string(b)); err != nil {\n        return\n    }\n    t, err := time.ParseInLocation(parseJSONYYYYMMDD, string(b), time.UTC)\n    if err != nil {\n        return\n    }\n    *d = YYYYMMDD(t)\n    return\n}\n</code></pre>\n\n<p>It's important to parse in the correct timezone. My code assumes UTC, but you may wish to use the computer's timezone for some reason.</p>\n\n<p>I also found that solutions which involved using the <code>time.Parse</code> function leaked Go's internal mechanisms as an error message which clients didn't find helpful, for example: <code>cannot parse \"sdfdf-01-01\" as \"2006\"</code>. That's only useful if you know that the server is written in Go, and that <code>2006</code> is the example date format, so I put in more readable error messages.</p>\n\n<p>I also implemented the <code>Stringer</code> interface so that it gets pretty printed in log or debug messages.</p>\n"}], "owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14257, "favorite_count": 11, "accepted_answer_id": 45304122, "answer_count": 3, "score": 19, "last_activity_date": 1607679296, "creation_date": 1500985723, "last_edit_date": 1569495888, "question_id": 45303326, "link": "https://stackoverflow.com/questions/45303326/how-to-parse-non-standard-time-format-from-json", "title": "How to parse non standard time format from json", "body": "<p>lets say i have the following json</p>\n\n<pre><code>{\n    name: \"John\",\n    birth_date: \"1996-10-07\"\n}\n</code></pre>\n\n<p>and i want to decode it into the following structure</p>\n\n<pre><code>type Person struct {\n    Name string `json:\"name\"`\n    BirthDate time.Time `json:\"birth_date\"`\n}\n</code></pre>\n\n<p>like this</p>\n\n<pre><code>person := Person{}\n\ndecoder := json.NewDecoder(req.Body);\n\nif err := decoder.Decode(&amp;person); err != nil {\n    log.Println(err)\n}\n</code></pre>\n\n<p>which gives me the error <code>parsing time \"\"1996-10-07\"\" as \"\"2006-01-02T15:04:05Z07:00\"\": cannot parse \"\"\" as \"T\"</code></p>\n\n<p>if i were to parse it manually i would do it like this</p>\n\n<pre><code>t, err := time.Parse(\"2006-01-02\", \"1996-10-07\")\n</code></pre>\n\n<p>but when the time value is from a json string <strong>how do i get the decoder to parse it in the above format?</strong></p>\n"}, {"tags": ["pointers", "go", "struct", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 4053673, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zfg5FopR3ew/AAAAAAAAAAI/AAAAAAAAAFI/iYFehY3jwTY/photo.jpg?sz=128", "display_name": "irfani arief", "link": "https://stackoverflow.com/users/4053673/irfani-arief"}, "edited": false, "score": 0, "creation_date": 1501137127, "post_id": 45302980, "comment_id": 77647261, "body": "Yep, that&#39;s it.  I&#39;m still grasping the concept of pointer in go, thanks for answering!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1500984883, "creation_date": 1500984883, "answer_id": 45302980, "question_id": 45302935, "link": "https://stackoverflow.com/questions/45302935/get-struct-tag-without-pointer/45302980#45302980", "title": "Get struct tag without pointer", "body": "<p>If you want it to work on values, don't call <code>Type.Elem()</code> on the reflect type. To handle both (pointers and non-pointers), check if it is of pointer type, and only then call <code>Type.Elem()</code>:</p>\n\n<pre><code>elemsType := reflect.TypeOf(obj)\nif elemsType.Kind() == reflect.Ptr {\n    elemsType = elemsType.Elem()\n}\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 4053673, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zfg5FopR3ew/AAAAAAAAAAI/AAAAAAAAAFI/iYFehY3jwTY/photo.jpg?sz=128", "display_name": "irfani arief", "link": "https://stackoverflow.com/users/4053673/irfani-arief"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "accepted_answer_id": 45302980, "answer_count": 1, "score": 1, "last_activity_date": 1560510380, "creation_date": 1500984741, "last_edit_date": 1560510380, "question_id": 45302935, "link": "https://stackoverflow.com/questions/45302935/get-struct-tag-without-pointer", "title": "Get struct tag without pointer", "body": "<p>I was creating a simple marshaler for fixed with text into struct in Go, as detailed <a href=\"https://github.com/iarief/tts\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>The marshaler functions as I expected now, albeit still lacking some features. What I got stuck in is in the marshal function.</p>\n\n<p>The relevant code is as follow</p>\n\n<pre><code>func Marshal(obj interface{}) (str string, err error) {\n...\n    elemsType := reflect.TypeOf(obj).Elem()\n</code></pre>\n\n<p>As you can see, I tried to mimic the json package's marshal signature. Then only problem is when I tried to pass by value to the marshal function, the <code>reflect.TypeOf</code> returns a different type than the one I pass into it. The function can only executed if I'm passing pointer to the marshal function.</p>\n\n<p>This works</p>\n\n<pre><code>user := User{\"johnjohnjohn\", \"the\", \"doe\", \"smart\", 26}\nres, err := Marshal(&amp;user)\n</code></pre>\n\n<p>This doesn't</p>\n\n<pre><code>user := User{\"johnjohnjohn\", \"the\", \"doe\", \"smart\", 26}\nres, err := Marshal(user)\n</code></pre>\n\n<p>Is there any way to just pass by value, and then get the struct tag inside the marshal function?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1364, "user_id": 4193473, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/809c47adff3412cabfe219351122672d?s=128&d=identicon&r=PG&f=1", "display_name": "hgl", "link": "https://stackoverflow.com/users/4193473/hgl"}, "edited": false, "score": 0, "creation_date": 1500985912, "post_id": 45303050, "comment_id": 77568219, "body": "haha, yeah, it&#39;s just for illustration purposes. Adding stdin.Close() works, thanks!"}], "tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": true, "score": 3, "last_activity_date": 1500985037, "creation_date": 1500985037, "answer_id": 45303050, "question_id": 45302931, "link": "https://stackoverflow.com/questions/45302931/how-to-use-a-file-as-stdin-when-exec-a-command/45303050#45303050", "title": "How to use a file as stdin when exec a command", "body": "<p>It's because you you don't close the stdin. Add <code>stdin.Close()</code> after <code>io.Copy</code>. <code>cat</code> will then terminate.</p>\n\n<p>Also, I know it's just an example but there is absolutely no error checking. I assume that's just for illustration purposes. :-)</p>\n"}], "owner": {"reputation": 1364, "user_id": 4193473, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/809c47adff3412cabfe219351122672d?s=128&d=identicon&r=PG&f=1", "display_name": "hgl", "link": "https://stackoverflow.com/users/4193473/hgl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 522, "favorite_count": 0, "accepted_answer_id": 45303050, "answer_count": 1, "score": 2, "last_activity_date": 1500985037, "creation_date": 1500984731, "question_id": 45302931, "link": "https://stackoverflow.com/questions/45302931/how-to-use-a-file-as-stdin-when-exec-a-command", "title": "How to use a file as stdin when exec a command", "body": "<p>I have this very simple code:</p>\n\n<pre><code>cmd := exec.Command(\"cat\")\ncmd.Stdout = os.Stdout\nstdin, _ := cmd.StdinPipe()\nfile, _ := os.Open(\"file\")\nio.Copy(stdin, file)\n_ = cmd.Run()\n</code></pre>\n\n<p>It works. But the problem is that <code>cmd.Run()</code> never returns. It seems after writing the file to stdin, <code>cat</code> still waits for more content.</p>\n\n<p>I'm trying to do what <code>cat &lt;file</code> does, in which case <code>cat</code> would exit after reading the file.</p>\n\n<p>I wonder how to achieve that in go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1500985428, "post_id": 45302708, "comment_id": 77567790, "body": "You should try and come up with and understandable and self-contained example."}, {"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1500985686, "post_id": 45302708, "comment_id": 77568031, "body": "@volker , I have added equivalent PHP Code too which works for my example at the end of code."}, {"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1500985825, "post_id": 45302708, "comment_id": 77568145, "body": "@volker , it&#39;s like storing value of child category as index of parent id in array."}], "answers": [{"comments": [{"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "edited": false, "score": 0, "creation_date": 1500986596, "post_id": 45303524, "comment_id": 77568797, "body": "Wow! How easy was that, <code>append</code> how can i ignore this. Thanks @dev.bmax"}], "tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": true, "score": 4, "last_activity_date": 1501055018, "last_edit_date": 1501055018, "creation_date": 1500986232, "answer_id": 45303524, "question_id": 45302708, "link": "https://stackoverflow.com/questions/45302708/creating-multi-dimensional-nested-map-slice-in-golang/45303524#45303524", "title": "Creating Multi dimensional Nested Map slice in Golang", "body": "<p>Slices in Go are dynamically-sized, you shouldn't treat them like arrays.</p>\n\n<p>In the first loop don't use <code>len(dadhu)</code> to initialize the slice if you don't know the exact size. </p>\n\n<p>Instead, make an empty slice:</p>\n\n<pre><code>patu[c.DadID] = make([]map[string]string, 0)\n</code></pre>\n\n<p>In the second loop, append maps to it:</p>\n\n<pre><code>patu[c.DadID] = append(patu[c.DadID], map[string]string{\"id\": cID, \"name\": c.Name})\n</code></pre>\n"}], "owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2465, "favorite_count": 0, "accepted_answer_id": 45303524, "answer_count": 1, "score": 2, "last_activity_date": 1501055018, "creation_date": 1500984163, "last_edit_date": 1501053102, "question_id": 45302708, "link": "https://stackoverflow.com/questions/45302708/creating-multi-dimensional-nested-map-slice-in-golang", "title": "Creating Multi dimensional Nested Map slice in Golang", "body": "<h2>TLDR; it's like storing value of child category as index of parent id in array. See equivalent PHP Code at end of block.</h2>\n\n<p>I need to store value of <code>dad-daughter</code> number. There are multiple person who are father and each father has multiple daughter. Some father may not have daughter either.So, I need to store value as :-</p>\n\n<pre><code>variableName[DadID][indexFrom0ToAvailableValue] = {\"id\": id, \"name\": name}\n</code></pre>\n\n<p>where <code>indexFrom0toAvailableValue</code> is index of number of daughter and their <code>id</code> and <code>name</code>.</p>\n\n<p>What i am doing :-</p>\n\n<pre><code>patu := make(map[int][]map[string]string)\n\np,n := 0,0\n\nfor _,c := range  dadhu {\n    // c.Daughter of value 2 means, current c is father\n    if( c.Daughter == 2 ) {\n\n        // Below i am using len(daddhu) to know\n        // number of rows available. This is creating another bug\n        // as it is creating lots of blank map.\n\n        patu[c.DadID] = make([]map[string]string, len(dadhu))\n\n        // Created array `patu` with `DadID` which will store \n        // their children below for range loop in above array\n\n        p++\n    }\n}\nfmt.Println(\"Total Father is : \", p)\n\nfor _,c := range dadhu {\n    // c.Daughter of value 1 means, current c is daughter\n\n    if ( c.Daughter == 1 ) {\n        cID = strconv.Itoa(c.ID)\n        patu[c.DadID][n] = map[string]string{\"id\": cID, \"name\" : c.Name}\n        n++\n    }\n}\n</code></pre>\n\n<p>This is working fine, but my problem is, it is creating map like below :-</p>\n\n<pre><code>map[44:[map[] map[] map[] map[] map[id: 45 name:Lana] map[] map[] map[] map[] map[id:46 name:Mana] map[] map[] map[] map[] map[id: 47 name:Bana].........] 28:[[map[] map[] map[] map[] map[id: 29 name:Lana] map[] map[] map[] map[] map[id:30 name:Mana] map[] map[] map[] map[] map[id: 31 name:Bana]........map[] map[] map[] map[]]] \n</code></pre>\n\n<p>and so on.</p>\n\n<p>There are total 5 Parent ID and 49 Total number of Rows in mysql.</p>\n\n<p>So, you can see, there are lots of blank map[] . Which get created. I need to clean this up. First 4 blank map each before storing daughter details. So daughter details are getting stored in 5th map . I am assuming if there will be 7 person who is father, than from 4 blank map it may become 6  blank map each.</p>\n\n<p>I am not finding any logical mistake here except one where i am using <code>len(dadhu)</code> as i need to provide some value but i am not sure, which father has how many daughter. </p>\n\n<p>Please let me know the alternate way to do this, if this is wrong in all ways in <code>golang</code>.</p>\n\n<p><strong>Just FYI :</strong> It's equivalent code in PHP - which is working fine is :</p>\n\n<pre><code>$patu = array();\n$wod = array();\nforeach ($dadhu as $e) {\n    if ($e-&gt;isChild == '2') {\n        $woc[] = $e-&gt;id;\n        $patu[$e-&gt;id] = array();\n    }\n}\nforeach($dadhu as $c) {\n    if($c-&gt;isChild == '1') {\n            if(in_array($c-&gt;dadID, $wod)) {\n                $patu[$c-&gt;dadID][] = array($c-&gt;id, $c-&gt;name);\n            }\n        }\n    }\n</code></pre>\n"}, {"tags": ["go", "leveldb"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 7004868, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1d5526b70fb222c3382d80858d344857?s=128&d=identicon&r=PG&f=1", "display_name": "wenyi liu", "link": "https://stackoverflow.com/users/7004868/wenyi-liu"}, "edited": false, "score": 0, "creation_date": 1501042042, "post_id": 45304958, "comment_id": 77596541, "body": "thanks a lot for your answer and it works.But why is the value changed? A little confused."}], "tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": false, "score": 0, "last_activity_date": 1500989661, "creation_date": 1500989661, "answer_id": 45304958, "question_id": 45302497, "link": "https://stackoverflow.com/questions/45302497/golang-leveldb-get-snapshot-error/45304958#45304958", "title": "golang leveldb get snapshot error", "body": "<p>Problem is with casting around types (<code>byte[]</code> to <code>string</code>, etc.).</p>\n\n<p>You are trying to print <code>string</code> values. To avoid unnecessary casting apply the following modifications:</p>\n\n<ul>\n<li>Change <code>data</code> initialization into <code>data := make(map[string]string)</code></li>\n<li>Assign values into <code>data</code> with `data[string(Key)] = string(Value) (by the way, don't use capitalization for variables you aren't intend to export)</li>\n<li>Print <code>data</code>'s values with <code>fmt.Println(k + \":\" + v))</code></li>\n</ul>\n\n<p>This should produce the following result:</p>\n\n<pre><code>key0:value0\nkey1:value1\nkey7:value7\nkey2:value2\nkey3:value3\nkey4:value4\nkey5:value5\nkey6:value6\nkey8:value8\nkey9:value9\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 7004868, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1d5526b70fb222c3382d80858d344857?s=128&d=identicon&r=PG&f=1", "display_name": "wenyi liu", "link": "https://stackoverflow.com/users/7004868/wenyi-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1500989661, "creation_date": 1500983615, "question_id": 45302497, "link": "https://stackoverflow.com/questions/45302497/golang-leveldb-get-snapshot-error", "title": "golang leveldb get snapshot error", "body": "<p>I am get leveldb's all key-val to a map[string][]byte, but it is not running as my expection.\ncode is as below</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"github.com/syndtr/goleveldb/leveldb\"\n)\nfunc main() {\n    db, err := leveldb.OpenFile(\"db\", nil)\n    if err != nil {\n        panic(err)\n    }\n    defer db.Close()\n    for i := 0; i &lt; 10; i++ {\n        err := db.Put([]byte(\"key\"+strconv.Itoa(i)), []byte(\"value\"+strconv.Itoa(i)), nil)\n        if err != nil {\n            panic(err)\n        }\n    }\n    snap, err := db.GetSnapshot()\n    if err != nil {\n        panic(err)\n    }\n    if snap == nil {\n        panic(\"snap shot is nil\")\n    }\n    data := make(map[string][]byte)\n    iter := snap.NewIterator(nil, nil)\n    for iter.Next() {\n        Key := iter.Key()\n        Value := iter.Value()\n        data[string(Key)] = Value\n    }\n    iter.Release()\n    if iter.Error() != nil {\n        panic(iter.Error())\n    }\n    for k, v := range data {\n        fmt.Println(string(k) + \":\" + string(v))\n    }\n}\n</code></pre>\n\n<p>but the result is below\n    key3:value9\n    key6:value9\n    key7:value9\n    key8:value9\n    key1:value9\n    key2:value9\n    key4:value9\n    key5:value9\n    key9:value9\n    key0:value9\nrather not key0:value0</p>\n"}, {"tags": ["pdf", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1500983199, "post_id": 45302083, "comment_id": 77565921, "body": "&quot;It doesn&#39;t work&quot; is not a problem description. What do you expect? What do you see instead?"}, {"owner": {"reputation": 691, "user_id": 5562092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6794fb661ad63d244a9bb592352f6d93?s=128&d=identicon&r=PG&f=1", "display_name": "A H Bensiali", "link": "https://stackoverflow.com/users/5562092/a-h-bensiali"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1500983629, "post_id": 45302083, "comment_id": 77566243, "body": "My bad, I could have swore I uploaded the images of &quot;it does work&quot; status on here. and yes..... it really doesnt work"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1500984040, "post_id": 45302083, "comment_id": 77566577, "body": "Thanks for the additional information. But please don&#39;t include screen shots of text. Copy and paste the text instead."}], "answers": [{"tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": false, "score": 8, "last_activity_date": 1500984697, "last_edit_date": 1500984697, "creation_date": 1500983928, "answer_id": 45302606, "question_id": 45302083, "link": "https://stackoverflow.com/questions/45302083/serving-up-pdfs-using-golang/45302606#45302606", "title": "serving up pdfs using golang", "body": "<p>The code is a bit inefficient but it appears to be working. However, some PDF viewers might be sensitive to the extraneous output you are adding to the end of the HTTP response stream. Remove <code>w.Write([]byte(\"PDF Generated\"))</code> as this will be corrupting the output. You could change this to a <code>fmt.Println</code> if you wanted for debugging purposes.</p>\n\n<p>The inefficiency is because you are loading the entire PDF file into memory to then send to the client. For large files this will waste memory. You would be better to open the file and stream directly from the file (an <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"noreferrer\">io.Reader</a>) to the response (an <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"noreferrer\">io.Writer</a>) using <a href=\"https://golang.org/pkg/io/#Copy\" rel=\"noreferrer\">io.Copy</a>. Something like:</p>\n\n<pre><code>    // Open file\n    f, err := os.Open(filename)\n    if err != nil {\n        fmt.Println(err)\n        w.WriteHeader(500)\n        return\n    }\n    defer f.Close()\n\n    //Set header\n    w.Header().Set(\"Content-type\", \"application/pdf\")\n\n    //Stream to response\n    if _, err := io.Copy(w, f); err != nil {\n        fmt.Println(err)\n        w.WriteHeader(500)\n    }\n</code></pre>\n\n<p>You would obviously want to handle errors better, this is just an example. However, it is important the client is provided an HTTP error response when you encounter an error so it is aware that the request failed.</p>\n"}], "owner": {"reputation": 691, "user_id": 5562092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6794fb661ad63d244a9bb592352f6d93?s=128&d=identicon&r=PG&f=1", "display_name": "A H Bensiali", "link": "https://stackoverflow.com/users/5562092/a-h-bensiali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3853, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1500986825, "creation_date": 1500982541, "last_edit_date": 1500986825, "question_id": 45302083, "link": "https://stackoverflow.com/questions/45302083/serving-up-pdfs-using-golang", "title": "serving up pdfs using golang", "body": "<p>just wondering if you guys can help with some code.</p>\n\n<p>It works serving up images but not a pdf brochure.\nThanks in advance</p>\n\n<pre><code>func main(){\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request){\n        filename    := \"/var/www/filedipenser/brochure.pdf\"\n\n        streamPDFbytes, err := ioutil.ReadFile( filename )\n\n        if err != nil {\n            fmt.Println(err)\n            os.Exit(1)\n        }\n\n        b := bytes.NewBuffer(streamPDFbytes)\n\n        w.Header().Set(\"Content-type\", \"application/pdf\")\n\n        if _, err := b.WriteTo(w); err != nil {\n            fmt.Fprintf(w, \"%s\", err)\n        }\n\n        w.Write([]byte(\"PDF Generated\"))\n    })\n\n    err := http.ListenAndServe(\":4111\", nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/lrTRE.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/lrTRE.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["c", "macos", "unix", "go"], "comments": [{"owner": {"reputation": 6258, "user_id": 1527018, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/62e4e73fe7386a5e9401f90dc98c7584?s=128&d=identicon&r=PG", "display_name": "mic4ael", "link": "https://stackoverflow.com/users/1527018/mic4ael"}, "edited": false, "score": 1, "creation_date": 1500979483, "post_id": 45300938, "comment_id": 77563218, "body": "are you running the script with administrator privileges?"}, {"owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "reply_to_user": {"reputation": 6258, "user_id": 1527018, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/62e4e73fe7386a5e9401f90dc98c7584?s=128&d=identicon&r=PG", "display_name": "mic4ael", "link": "https://stackoverflow.com/users/1527018/mic4ael"}, "edited": false, "score": 0, "creation_date": 1500979573, "post_id": 45300938, "comment_id": 77563289, "body": "@mic4ael Hi, I&#39;m using macOS, I run this with <code>go run main.go</code>, how can I run this with root ?"}, {"owner": {"reputation": 6258, "user_id": 1527018, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/62e4e73fe7386a5e9401f90dc98c7584?s=128&d=identicon&r=PG", "display_name": "mic4ael", "link": "https://stackoverflow.com/users/1527018/mic4ael"}, "edited": false, "score": 0, "creation_date": 1500979593, "post_id": 45300938, "comment_id": 77563307, "body": "<code>sudo go run main.go</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1500979663, "post_id": 45300938, "comment_id": 77563356, "body": "<code>data</code> has a length of 0 (it&#39;s nil), so you&#39;re trying to read 0 bytes."}, {"owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "reply_to_user": {"reputation": 6258, "user_id": 1527018, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/62e4e73fe7386a5e9401f90dc98c7584?s=128&d=identicon&r=PG", "display_name": "mic4ael", "link": "https://stackoverflow.com/users/1527018/mic4ael"}, "edited": false, "score": 0, "creation_date": 1500979753, "post_id": 45300938, "comment_id": 77563421, "body": "@mic4ael go: cannot find GOROOT directory: /usr/local/go got this error"}, {"owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500979795, "post_id": 45300938, "comment_id": 77563450, "body": "@JimB Yes, it shouldn&#39;t be 0 bytes.How can I read this file..."}, {"owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501038016, "post_id": 45300938, "comment_id": 77595604, "body": "@JimB you are right"}], "answers": [{"tags": [], "owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "is_accepted": true, "score": 3, "last_activity_date": 1500984448, "last_edit_date": 1500984448, "creation_date": 1500984056, "answer_id": 45302652, "question_id": 45300938, "link": "https://stackoverflow.com/questions/45300938/can-not-read-utmpx-file-in-go/45302652#45302652", "title": "Can not read utmpx file in go", "body": "<p>You can use the <code>ioutil.ReadFile</code> function for this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    fd, err := ioutil.ReadFile(\"/var/run/utmpx\")\n    fmt.Println(string(fd), err)\n}\n</code></pre>\n\n<p>The problem in your original code is that you read into <code>data</code> that is 0 bytes long. Since the reader interface reads only reads up to <code>len(data)</code>, it reads nothing. More on that: <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\">https://golang.org/pkg/io/#Reader</a></p>\n"}], "owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "accepted_answer_id": 45302652, "answer_count": 1, "score": -1, "last_activity_date": 1500984448, "creation_date": 1500979327, "last_edit_date": 1500980213, "question_id": 45300938, "link": "https://stackoverflow.com/questions/45300938/can-not-read-utmpx-file-in-go", "title": "Can not read utmpx file in go", "body": "<pre><code>package main\n\nimport (\n \"os\"\n \"fmt\"\n)\n\nfunc main() {\n  fd, err := os.Open(\"/var/run/utmpx\")\n  fmt.Println(fd, err)\n  var data []byte\n  len, err := fd.Read(data)\n  fmt.Println(len, err)\n}\n</code></pre>\n\n<blockquote>\n  <p>&amp;{0xc42000a240} nil</p>\n  \n  <p>0 nil</p>\n</blockquote>\n\n<p>There is no error, also no data.</p>\n\n<p>This path <code>/var/run/utmpx</code> is read from system header file. </p>\n\n<p>How to get this path is <a href=\"https://stackoverflow.com/q/44036358/5819540\">another question</a></p>\n\n<p>system: macOS el capiton, go version go1.8 darwin/amd64</p>\n\n<p>**My final goal is to read this file into go struct.**This file contains system users infomation.</p>\n\n<p><strong>Can I do that ?</strong> I will keep trying...</p>\n"}, {"tags": ["string", "go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1500978421, "last_edit_date": 1500978421, "creation_date": 1500975275, "answer_id": 45299348, "question_id": 45299185, "link": "https://stackoverflow.com/questions/45299185/slice-start-position-greater-than-length-of-the-string/45299348#45299348", "title": "Slice start position greater than length of the string", "body": "<p>It does not slices \"over\" the length, 2 is exactly the length (equals to it).</p>\n\n<blockquote>\n  <p>For arrays or strings, the indices are <em>in range</em> if <code>0 &lt;= low &lt;= high &lt;= len(a)</code>, otherwise they are out of range.</p>\n</blockquote>\n\n<p>Since you are slicing a <code>string</code>, indices are in range if:</p>\n\n<pre><code>0 &lt;= low &lt;= high &lt;= len(a)\n</code></pre>\n\n<p>This expression:</p>\n\n<pre><code>\"hi\"[2:]\n</code></pre>\n\n<p>Since the upper bound is missing, it defaults to length, which is 2, so it is equvivalent to:</p>\n\n<pre><code>\"hi\"[2:2]\n</code></pre>\n\n<p>This is perfectly valid by the spec, and it will result in an empty <code>string</code>. If you change it to <code>\"hi\"[3:]</code>, then it will be out of range and result in a compile-time error (as slicing a constant <code>string</code> can be checked at compile-time).</p>\n\n<p>Reasoning is that the upper bound is exclusive, e.g. <code>a[0:0]</code> is valid and will be 0-length, <code>a[0:1]</code> will have a length of 1, <code>a[0:len(a)]</code> valid and will have the same length as <code>a</code>.</p>\n\n<p>In case of slices, the lower bound can even be greater than the slice length (but must not exceed the slice capacity). For more details, see <a href=\"https://stackoverflow.com/questions/33859066/slicing-out-of-bounds-error-in-go/33859638#33859638\">Slicing: Out of bounds error in Go</a>.</p>\n"}], "owner": {"reputation": 107, "user_id": 4566048, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-vFaQTCQaz9k/AAAAAAAAAAI/AAAAAAAAACA/z6k7NsmafK0/photo.jpg?sz=128", "display_name": "xuefeng huang", "link": "https://stackoverflow.com/users/4566048/xuefeng-huang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1500986065, "creation_date": 1500974887, "last_edit_date": 1500986065, "question_id": 45299185, "link": "https://stackoverflow.com/questions/45299185/slice-start-position-greater-than-length-of-the-string", "title": "Slice start position greater than length of the string", "body": "<p>Anyone knows why the code below runs without panic, it accesses the index one over the length of the string.</p>\n\n<pre><code>import (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"hi\"[2:])\n}\n</code></pre>\n"}, {"tags": ["json", "dictionary", "go"], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 8362528, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9f912bf4957525ee6253cf18d46b138?s=128&d=identicon&r=PG&f=1", "display_name": "Weiwei", "link": "https://stackoverflow.com/users/8362528/weiwei"}, "edited": false, "score": 0, "creation_date": 1500975703, "post_id": 45299316, "comment_id": 77560450, "body": "<a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">JSON to Go tool</a> seems a simple way to get the struct of json data. Thanks for your sharing."}], "tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": true, "score": 2, "last_activity_date": 1500975186, "creation_date": 1500975186, "answer_id": 45299316, "question_id": 45299133, "link": "https://stackoverflow.com/questions/45299133/go-lang-json-decode-mapping/45299316#45299316", "title": "Go lang json decode mapping", "body": "<p>You can use the <code>map[string]interface{}</code> result and typecast the relevant parts, e.g.:</p>\n\n<pre><code>o[\"ret\"].([]interface{})\n</code></pre>\n\n<p>would get the array and continue so on. However, this is tedious and you need to check for values being set etc as well.</p>\n\n<p>Instead, I'd recommend you use the handy <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">JSON to Go tool</a> that can automatically generate a struct definition for you to paste into your Go code when given some input JSON. </p>\n\n<p>Obviously you might need to amend this to suit your needs as you know what valid formats the input can take. However, this tool saves a lot of tedious boilerplate code writing!</p>\n\n<p>For example, for the JSON above, it generates:</p>\n\n<pre><code>type AutoGenerated struct {\n    Profile struct {\n        ExecutionTime int `json:\"execution_time\"`\n        ServerName string `json:\"server_name\"`\n    } `json:\"profile\"`\n    Result string `json:\"result\"`\n    Ret []struct {\n        Alias string `json:\"alias\"`\n        AllParents []int `json:\"all_parents\"`\n        Bankrupt bool `json:\"bankrupt\"`\n        Block bool `json:\"block\"`\n        Card interface{} `json:\"card\"`\n    } `json:\"ret\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 8362528, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a9f912bf4957525ee6253cf18d46b138?s=128&d=identicon&r=PG&f=1", "display_name": "Weiwei", "link": "https://stackoverflow.com/users/8362528/weiwei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "accepted_answer_id": 45299316, "answer_count": 1, "score": 0, "last_activity_date": 1500975186, "creation_date": 1500974753, "question_id": 45299133, "link": "https://stackoverflow.com/questions/45299133/go-lang-json-decode-mapping", "title": "Go lang json decode mapping", "body": "<p>How can I map each element to struct or map. Base on the json data that has different types.</p>\n\n<pre><code>{\n  profile: {\n    execution_time: 34,\n    server_name: \"myServer.net\"\n  },\n  result: \"ok\",\n  ret: [\n    {\n      alias: \"asda444444\",\n      all_parents: [\n        123,\n        2433369,\n        243628,\n        2432267,\n        62\n      ],\n      bankrupt: false,\n      block: false,\n      card: null\n    }\n  ]\n}\n</code></pre>\n\n<p>I had tried this already. But not work as expected.</p>\n\n<pre><code>var o map[string]interface{}\nerr := json.Unmarshal(data, &amp;o)\nif err != nil {\n        revel.INFO.Println(\"Json Decode Error\", err)\n    }\nfmt.Println(o)\n</code></pre>\n\n<p>By this way, I can only get o[\"ret\"]. What I really want is o[\"ret\"][\"alias\"] or o[\"ret\"][\"all_parents\"].</p>\n\n<p>Any suggestions or tips will helps. Thanks.</p>\n"}, {"tags": ["image-processing", "go", "mozjpeg"], "answers": [{"tags": [], "owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "is_accepted": false, "score": 1, "last_activity_date": 1500974428, "last_edit_date": 1500974428, "creation_date": 1500974071, "answer_id": 45298874, "question_id": 45298749, "link": "https://stackoverflow.com/questions/45298749/how-to-wrap-exec-command-inside-an-io-writer/45298874#45298874", "title": "How to wrap exec.Command inside an io.Writer", "body": "<p>You should take a look at the <a href=\"https://golang.org/pkg/os/exec/#Cmd.StdinPipe\" rel=\"nofollow noreferrer\">Cmd.StdinPipe</a>. There is an example in the documentation, which suits your case:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"cat\")\n    stdin, err := cmd.StdinPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    go func() {\n        defer stdin.Close()\n        io.WriteString(stdin, \"values written to stdin are passed to cmd's standard input\")\n    }()\n\n    out, err := cmd.CombinedOutput()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%s\\n\", out)\n}\n</code></pre>\n\n<p>In this case, <code>CombinedOutput()</code> executes your command, and the execution is finished, when there are no more bytes to read from <code>out</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": false, "score": 0, "last_activity_date": 1500974768, "creation_date": 1500974768, "answer_id": 45299140, "question_id": 45298749, "link": "https://stackoverflow.com/questions/45298749/how-to-wrap-exec-command-inside-an-io-writer/45299140#45299140", "title": "How to wrap exec.Command inside an io.Writer", "body": "<p>As per Kiril's answer, use the <code>cmd.StdInPipe</code> to pass on the data you receive to <code>Write</code>.</p>\n\n<p>However, in terms of closing, I'd be tempted to implement <a href=\"https://golang.org/pkg/io/#Closer\" rel=\"nofollow noreferrer\">io.Closer</a>. This would make <code>*Compresser</code> automatically implement the <a href=\"https://golang.org/pkg/io/#WriteCloser\" rel=\"nofollow noreferrer\">io.WriteCloser</a> interface.</p>\n\n<p>I would use <code>Close()</code> as the notification that there is no more data to be sent and that the command should be terminated. Any non-zero exit code returned from the command that indicates failure could be caught and returned as an error.</p>\n\n<p>I would be wary of using <code>CombinedOutput()</code> inside <code>Write()</code> in case you have a slow input stream. The utility could finish processing the input stream and be waiting for more data. This would be incorrectly detected as command completion and would result in an invalid output. </p>\n\n<p>Remember, the <code>Write</code> method can be called an indeterminate number of times during IO operations.</p>\n"}], "owner": {"reputation": 1364, "user_id": 4193473, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/809c47adff3412cabfe219351122672d?s=128&d=identicon&r=PG&f=1", "display_name": "hgl", "link": "https://stackoverflow.com/users/4193473/hgl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1500974768, "creation_date": 1500973750, "question_id": 45298749, "link": "https://stackoverflow.com/questions/45298749/how-to-wrap-exec-command-inside-an-io-writer", "title": "How to wrap exec.Command inside an io.Writer", "body": "<p>I'm trying to compress a JPEG image in go using mozjpeg. Since it doesn't have official go binding, I think I'll just invoke its CLI to do the compression.</p>\n\n<p>I try to model the usage after <code>compress/gzip</code>:</p>\n\n<pre><code>c := jpeg.NewCompresser(destFile)\n_, err := io.Copy(c, srcFile)\n</code></pre>\n\n<p>Now the question is, how do I wrap the CLI inside Compresser so it can support this usage?</p>\n\n<p>I tried something like this:</p>\n\n<pre><code>type Compresser struct {\n    cmd exec.Command\n}\n\nfunc NewCompressor(w io.Writer) *Compresser {\n    cmd := exec.Command(\"jpegtran\", \"-copy\", \"none\")\n    cmd.Stdout = w\n    c := &amp;Compresser{cmd}\n    return c\n}\n\nfunc (c *Compresser) Write(p []byte) (n int, err error) {\n    if c.cmd.Process == nil {\n        err = c.cmd.Start()\n        if err != nil {\n            return\n        }\n    }\n    // How do I write p into c.cmd.Stdin?\n}\n</code></pre>\n\n<p>But couldn't finish it.</p>\n\n<p>Also, a second question is, when do I shut down the command? How to shut down the command?</p>\n"}, {"tags": ["forms", "go"], "answers": [{"tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": false, "score": 0, "last_activity_date": 1500971186, "creation_date": 1500971186, "answer_id": 45297825, "question_id": 45296886, "link": "https://stackoverflow.com/questions/45296886/send-map-with-specific-key-via-html-form/45297825#45297825", "title": "Send map with specific key via html form", "body": "<p>Why not simply change the form input names to remove the <code>metadata[]</code> part?</p>\n\n<p>If this can't be done for some reason (e.g. client side Javascript relies on these names) then you could create a new map with something like the below:</p>\n\n<pre><code>values := make(map[string]string)\nfor k, v := range r.Form {\n    if len(v) &gt; 0 {\n        k = strings.TrimPrefix(k, \"metadata[\")\n        k = strings.TrimSuffix(k, \"]\")\n        values[k] = v[0]\n    }\n}\n</code></pre>\n\n<p><em>Note this is assuming there is only one input with each name (<code>string</code> as opposed to <code>[]string</code>) as this is the format you indicated your map should be in.</em></p>\n"}], "owner": {"reputation": 614, "user_id": 6424168, "user_type": "registered", "accept_rate": 30, "profile_image": "https://lh6.googleusercontent.com/-Ma90L9K1ny8/AAAAAAAAAAI/AAAAAAAAABI/9ZMB4GR_z0M/photo.jpg?sz=128", "display_name": "Yur Gasparyan", "link": "https://stackoverflow.com/users/6424168/yur-gasparyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 708, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1500974120, "creation_date": 1500968448, "last_edit_date": 1500974120, "question_id": 45296886, "link": "https://stackoverflow.com/questions/45296886/send-map-with-specific-key-via-html-form", "title": "Send map with specific key via html form", "body": "<p>I have a form look like this </p>\n\n<pre><code>&lt;form action=\"/upload\" method=\"POST\" enctype=\"multipart/form-data\"&gt;\n    &lt;input type=\"hidden\" name=\"metadata[mimetype]\" value=\"text/plain\"/&gt;\n    &lt;input type=\"hidden\" name=\"metadata[size]\" value=\"1024\" /&gt;\n    &lt;input type=\"hidden\" name=\"metadata[type]\"  value=\"file\" /&gt;\n    &lt;input type=\"file\" name=\"file\" multiple/&gt;\n    &lt;input type=\"submit\"/&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>In my Go app I want to get a map look like this </p>\n\n<pre><code>[\"mimetype\":\"text/plain\",...]\n</code></pre>\n\n<p>but I am getting  <code>metadata[\"mimetype\"]</code> as key </p>\n\n<p>Here is a my logic in Go</p>\n\n<pre><code>for key, values := range rq.Form {\n            if len(values) &gt; 0 {\n                value := values[0]\n                fmt.Println(key, value)\n            }\n        }\n</code></pre>\n"}, {"tags": ["testing", "go", "fasthttp"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500989413, "post_id": 45296230, "comment_id": 77571268, "body": "This is the downside to third-party muxes that don&#39;t follow the stdlib Handler interface. If the library doesn&#39;t include its own equivalent to <code>httptest</code>, you&#39;re SOL, and most of them don&#39;t."}], "answers": [{"comments": [{"owner": {"reputation": 22034, "user_id": 21699, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1c27bc77c7d5d9506958e3f9164341b7?s=128&d=identicon&r=PG", "display_name": "Tigraine", "link": "https://stackoverflow.com/users/21699/tigraine"}, "edited": false, "score": 0, "creation_date": 1501077789, "post_id": 45297485, "comment_id": 77620146, "body": "Thanks for the recommendation. After looking at GitHub I decided to rewrite the application to go back to standard net/http as there is just more support behind it and the tool integration is also much better. But I am also doing the stubbing/faking on the handlers to simplify testing. Thanks!"}, {"owner": {"reputation": 1071, "user_id": 241993, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/zfpeC.jpg?s=128&g=1", "display_name": "Mohamed Bana", "link": "https://stackoverflow.com/users/241993/mohamed-bana"}, "edited": false, "score": 2, "creation_date": 1551803015, "post_id": 45297485, "comment_id": 96769658, "body": "Could you post a complete example of using an in-memory listener, please. Thanks a lot. I am having a bit of trouble understanding it. Also, do you think you could make it work with <code>WebSocket</code>s? It&#39;d save me a lot of trouble if you know the answer to the latter question already."}], "tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": true, "score": 5, "last_activity_date": 1500970231, "creation_date": 1500970231, "answer_id": 45297485, "question_id": 45296230, "link": "https://stackoverflow.com/questions/45296230/testing-fasthttp-with-httptest/45297485#45297485", "title": "Testing fasthttp with httptest", "body": "<p>There are two possible approaches. Unit testing a handler isn't really viable as you would need to create a <a href=\"https://godoc.org/github.com/valyala/fasthttp#RequestCtx\" rel=\"noreferrer\">RequestCtx</a> and stub/mock all necessary fields.</p>\n\n<p>Instead, I would unit test the code that your fasthttp handlers call out \nto. I would do e2e testing of the actual handlers themselves. </p>\n\n<p>There is an <a href=\"https://godoc.org/github.com/valyala/fasthttp/fasthttputil#InmemoryListener\" rel=\"noreferrer\">in memory listener</a> implementation that you could use to avoid actually listening on a TCP port or Unix socket. You would initialise the server but serve on this listener instead of on a network connection.</p>\n\n<p>You would then create a HTTP client and call the relevant methods as normal but use this listener as the transport.</p>\n\n<p>If you stub/fake anything that your handlers interact with then you could make this in-memory only with no external dependencies, i.e. like a unit test but it will actually doing a full system test. </p>\n"}], "owner": {"reputation": 22034, "user_id": 21699, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1c27bc77c7d5d9506958e3f9164341b7?s=128&d=identicon&r=PG", "display_name": "Tigraine", "link": "https://stackoverflow.com/users/21699/tigraine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1755, "favorite_count": 1, "accepted_answer_id": 45297485, "answer_count": 1, "score": 2, "last_activity_date": 1567271582, "creation_date": 1500966460, "last_edit_date": 1521176453, "question_id": 45296230, "link": "https://stackoverflow.com/questions/45296230/testing-fasthttp-with-httptest", "title": "Testing fasthttp with httptest", "body": "<p>I am wondering how I can test an application that's written with <a href=\"https://github.com/valyala/fasthttp\" rel=\"nofollow noreferrer\">fasthttp</a> using the <a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"nofollow noreferrer\">httptest package</a> in the base library of Go.</p>\n\n<p>I found <a href=\"https://elithrar.github.io/article/testing-http-handlers-go/\" rel=\"nofollow noreferrer\">this guide</a> which explains the testing pretty well, but the issue is that httptest does not satisfy the <code>http.Handler</code> interface so I have no idea how to do the <code>http.HandlerFunc</code> since fasthttp uses it's own <code>fasthttp.ListenAndServe</code> that's incompatible.</p>\n\n<p>Any ideas on how to create a wrapper, or how to otherwise test a fasthttp written library end to end?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 2, "last_activity_date": 1500965654, "creation_date": 1500965654, "answer_id": 45295960, "question_id": 45295185, "link": "https://stackoverflow.com/questions/45295185/assigning-types-to-variables-in-go/45295960#45295960", "title": "Assigning types to variables in Go", "body": "<blockquote>\n  <p>Is there such a mechanism in go that allows me to do that?</p>\n</blockquote>\n\n<p>No there is not.</p>\n"}, {"comments": [{"owner": {"reputation": 5580, "user_id": 26685, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/51bde710f2efaa9597f5f264937a8967?s=128&d=identicon&r=PG", "display_name": "schmoopy", "link": "https://stackoverflow.com/users/26685/schmoopy"}, "edited": false, "score": 0, "creation_date": 1574296481, "post_id": 45303589, "comment_id": 104185978, "body": "I see what your saying but I do think this could be supported in Go if they really wanted to.  In F# for instance (a compiled language) it uses Discriminated Unions:  type MyType = Person|Place|Thing type Something struct = {      Name string      MyObj MyType }  While it may be syntactic sugar in F# it is extremely useful.   Maybe I am misunderstanding?"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1500986383, "last_edit_date": 1592644375, "creation_date": 1500986383, "answer_id": 45303589, "question_id": 45295185, "link": "https://stackoverflow.com/questions/45295185/assigning-types-to-variables-in-go/45303589#45303589", "title": "Assigning types to variables in Go", "body": "<blockquote>\n<p>Is there such a mechanism in go that allows me to do that?</p>\n</blockquote>\n<p>The short answer is: <strong>No.</strong></p>\n<p>The long answer is: This sounds like an <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">XY Problem</a>, so depending on what you're actually trying to accomplish, there may be a way. Jump to the end to see where I address your specific use-case.</p>\n<p>I suspect that if you want to store a data type in a variable, it's because you either want to compare some other variable's type against it, or perhaps you want to create a variable of this otherwise unknown type. These two scenarios can be accomplished in Go.</p>\n<p>In the first case, just use a type switch:</p>\n<pre><code>switch someVar.(type) {\n    case string:\n        // Do stringy things\n    case int:\n        // Do inty things\n}\n</code></pre>\n<p>Semantically, this looks a lot like assigning the type of <code>someVar</code> to the implicit switch comparison variable, then comparing against various types.</p>\n<p>In the second case I mentioned, if you want to create a variable of an unknown type, this can be done in a round-about way using reflection:</p>\n<pre><code>type := reflect.TypeOf(someVar)\nnewVar := reflect.New(type).Interface()\n</code></pre>\n<p>Here <code>newVar</code> is now an <code>interface{}</code> that wraps a variable of the same type as <code>someVar</code>.</p>\n<p>In your specific example:</p>\n<blockquote>\n<p>I will use this mechanism to take &quot;type&quot; arguments. For example:</p>\n<pre><code>func Infer(value interface{}, type gotype) {...}\n</code></pre>\n</blockquote>\n<p>No, there's no way to do this. And it actually has much less to do with Go's variable support than it does with the fact that Go is compiled.</p>\n<p>Variables are entirely a runtime concept.  Function signatures (like all other types in Go) are fixed at compilation time.  It's therefore impossible for <em>runtime</em> variables to affect the compilation stage. This is true in any compiled language, not a special feature (or lack thereof) in Go.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6346338, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e58edfa222f8c3645e664e0be1d6c45c?s=128&d=identicon&r=PG", "display_name": "Thomas H&#246;henleitner", "link": "https://stackoverflow.com/users/6346338/thomas-h%c3%b6henleitner"}, "is_accepted": false, "score": 0, "last_activity_date": 1613691738, "creation_date": 1613691738, "answer_id": 66269768, "question_id": 45295185, "link": "https://stackoverflow.com/questions/45295185/assigning-types-to-variables-in-go/66269768#66269768", "title": "Assigning types to variables in Go", "body": "<p>Use the  empty interface:</p>\n<pre class=\"lang-c prettyprint-override\"><code>var x, y interface{}\nvar a uint32\na = 255\nx = int8(a)\ny = uint8(a)\n</code></pre>\n<p><a href=\"https://play.golang.org/p/lYGWRHhT6Tm\" rel=\"nofollow noreferrer\">Playground example</a></p>\n"}], "owner": {"reputation": 1309, "user_id": 4966877, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/02db551f2b05ae241c2b3dc0cadfbb5b?s=128&d=identicon&r=PG&f=1", "display_name": "Bora", "link": "https://stackoverflow.com/users/4966877/bora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2463, "favorite_count": 0, "accepted_answer_id": 45295960, "answer_count": 3, "score": 4, "last_activity_date": 1613691738, "creation_date": 1500963041, "question_id": 45295185, "link": "https://stackoverflow.com/questions/45295185/assigning-types-to-variables-in-go", "title": "Assigning types to variables in Go", "body": "<p>How to have a variable whose type is a variable type?</p>\n\n<p>What do I mean by that? I have a python and java background. In both languages I can do things like assigning a class name to variable.</p>\n\n<pre><code>#Python\nclass A:\n    def __init__(self):\n        self.a = \"Some Value\"\n\n# And asigning the class name to a variable\nclass_A = A\n\n# And create instance from class A by using class_A\na = class_A()\n</code></pre>\n\n<p>Is there such a mechanism in go that allows me to do that? I couldn't know where to look at for such things in their documentation. Honestly, generally I don't know what these are called in programming languages.</p>\n\n<p>For example I would like to be able to do:</p>\n\n<pre><code>// For example, what would be the type of myType?\nvar myType type = int\n</code></pre>\n\n<p>I will use this mechanism to take \"type\" arguments. For example:</p>\n\n<pre><code>func Infer(value interface{}, type gotype) {...}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1500966487, "post_id": 45294899, "comment_id": 77553933, "body": "In this case, the ReadFrom method is implemented by bytes.Buffer, see <a href=\"https://golang.org/src/bytes/buffer.go?s=5754:5813#L150\" rel=\"nofollow noreferrer\">ReadFrom</a>"}], "answers": [{"tags": [], "owner": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "is_accepted": false, "score": 2, "last_activity_date": 1500965651, "creation_date": 1500965651, "answer_id": 45295959, "question_id": 45294899, "link": "https://stackoverflow.com/questions/45294899/how-to-explain-this-program-to-implement-interface/45295959#45295959", "title": "how to explain this program to implement interface", "body": "<p>It is a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>. </p>\n\n<p>In your case it asserts that <code>w</code> is not nil and that the value stored in <code>w</code> is of interface <code>io.ReaderFrom</code>. <code>ok</code> is going to be <code>true</code> if it is, and <code>false</code> otherwise. This code doest not check <code>ok</code> variable because of the author's confidence it will be implementing  <code>io.ReaderFrom</code> interface.</p>\n"}, {"tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": false, "score": 0, "last_activity_date": 1500967148, "last_edit_date": 1500967148, "creation_date": 1500966453, "answer_id": 45296227, "question_id": 45294899, "link": "https://stackoverflow.com/questions/45294899/how-to-explain-this-program-to-implement-interface/45296227#45296227", "title": "how to explain this program to implement interface", "body": "<ul>\n<li><p><code>bytes.Buffer</code> implements <code>func (b *Buffer) Write(p []byte) (n int, err error)</code>, so it is of type <code>io.Writer</code> and can serve as parameter to <code>func NewWriter(w io.Writer) *Writer</code></p></li>\n<li><p><code>bytes.Buffer</code> also implements <code>func (b *Buffer) ReadFrom(r io.Reader) (n int64, err error)</code>, so it is of type <code>io.ReadFrom</code>, which enables the call for <code>fmt.Println(w.ReadFrom(s))</code></p></li>\n<li><p>as @akond mentioned <code>.(io.ReaderFrom)</code> is type assertion, and the expression <code>w, ok := bw.wr.(io.ReaderFrom)</code> asserts that the <code>wr</code> field of the <code>Writer</code> struct is also of type <code>io.ReaderFrom</code></p></li>\n</ul>\n\n<p>For further reading check <a href=\"http://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">laws-of-reflection</a>, it refers to similar code.</p>\n"}], "owner": {"reputation": 11, "user_id": 8287142, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/069d7c29d5c3764baa1455329e44535f?s=128&d=identicon&r=PG&f=1", "display_name": "dan.liu", "link": "https://stackoverflow.com/users/8287142/dan-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1500967148, "creation_date": 1500961921, "question_id": 45294899, "link": "https://stackoverflow.com/questions/45294899/how-to-explain-this-program-to-implement-interface", "title": "how to explain this program to implement interface", "body": "<p><a href=\"https://play.golang.org/p/LHkVGzmC7N\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LHkVGzmC7N</a></p>\n\n<p>look this source.</p>\n\n<p>specilly this scrap:</p>\n\n<pre><code>bw := NewWriter(b)\nw, ok := bw.wr.(io.ReaderFrom)\n</code></pre>\n\n<p>i dont understand b is bytes element\uff0cNewWrite() take a io.Writer\u3002\nand bw.wr.(io.ReaderFrom),how use is?</p>\n\n<p>what's mean the \".(io.ReaderFrom)\" 's function?</p>\n\n<p>and </p>\n\n<pre><code>   fmt.Println(w.ReadFrom(s))\n</code></pre>\n\n<p>w is io.write,in io/io.go the ReadFrom(s) is interface.</p>\n\n<pre><code>type ReaderFrom interface {\n    ReadFrom(r Reader) (n int64, err error)\n}\n</code></pre>\n\n<p>how in this source can  implement this interface?</p>\n\n<p>in this source ,i cant find anywhere to implement.</p>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "edited": false, "score": 0, "creation_date": 1500974697, "post_id": 45293772, "comment_id": 77559683, "body": "No need to do this manually, the <code>&quot;bytes&quot;.Join</code> function from the standard library is perfect for the job."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "edited": false, "score": 0, "creation_date": 1500986729, "post_id": 45293772, "comment_id": 77568900, "body": "True enough. Generally when I am doing things like this it is part of something larger or the type isn&#39;t <code>byte</code>, so the handy helpers aren&#39;t useful... So I kinda forgot it existed... I&#39;ll edit my answer to point out this is s generic solution."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 4, "last_activity_date": 1500986933, "last_edit_date": 1500986933, "creation_date": 1500955666, "answer_id": 45293772, "question_id": 45293485, "link": "https://stackoverflow.com/questions/45293485/how-to-convert-a-two-dimension-array-into-a-one-dimension-array-in-go/45293772#45293772", "title": "How to convert a two dimension array into a one dimension array in GO?", "body": "<p>Simple.</p>\n\n<pre><code>l := 0\nfor _, v := range chunks {\n    l += len(v)\n}\nresult := make([]byte, 0, l)\nfor _, v := range chunks {\n    result = append(result, v...)\n}\n</code></pre>\n\n<p>The first loop adds up all the lengths, the new slice is allocated, and then another loop is used to copy the old slices into the new one.</p>\n\n<p>While there is a simpler way to handle this particular case using functions from the <code>bytes</code> package, this solution will work with slices of any type.</p>\n"}, {"tags": [], "owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "is_accepted": true, "score": 3, "last_activity_date": 1500974576, "creation_date": 1500974576, "answer_id": 45299068, "question_id": 45293485, "link": "https://stackoverflow.com/questions/45293485/how-to-convert-a-two-dimension-array-into-a-one-dimension-array-in-go/45299068#45299068", "title": "How to convert a two dimension array into a one dimension array in GO?", "body": "<p>You can use the <code>\"bytes\".Join</code> function from the standard library:</p>\n\n<pre><code>result := bytes.Join(chunks, nil)\n</code></pre>\n\n<p>First argument is your slice of slices (<code>[][]byte</code>), second argument is the separator (aka glue). In your case, the separator is an empty slice of bytes (<code>nil</code> works as well).</p>\n\n<p>In the playground: <a href=\"https://play.golang.org/p/8pquRk7PDo\" rel=\"nofollow noreferrer\">https://play.golang.org/p/8pquRk7PDo</a>.</p>\n"}], "owner": {"reputation": 439, "user_id": 6438341, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/1181377385240542/picture?type=large", "display_name": "Qi Zhang", "link": "https://stackoverflow.com/users/6438341/qi-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 803, "favorite_count": 0, "accepted_answer_id": 45299068, "answer_count": 2, "score": 1, "last_activity_date": 1500997954, "creation_date": 1500953803, "last_edit_date": 1500997954, "question_id": 45293485, "link": "https://stackoverflow.com/questions/45293485/how-to-convert-a-two-dimension-array-into-a-one-dimension-array-in-go", "title": "How to convert a two dimension array into a one dimension array in GO?", "body": "<p>Here are two data structures</p>\n\n<pre><code>result []byte\nchunk  [][]byte\n</code></pre>\n\n<p>\"chunk\" is initialized as follows</p>\n\n<pre><code>chunk := make([][]byte, 3)\nfor i := 0 ; i &lt; 5; i++ {\n      chunk[i] = data //data is a byte array\n}\n</code></pre>\n\n<p>How can I concatenate <code>chunks</code> into to <code>result[]</code>?</p>\n\n<p>Example</p>\n\n<p>If chunks is <code>\"123\", \"456\", \"789\"</code>, then result should be <code>\"123456789\"</code></p>\n"}, {"tags": ["go", "microservices"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1500974813, "post_id": 45293123, "comment_id": 77559771, "body": "A microservices architecture for this type of problem is almost certainly overkill."}, {"owner": {"reputation": 489, "user_id": 1401162, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/34ccb916234d4117540155fed4e4ce1c?s=128&d=identicon&r=PG&f=1", "display_name": "Vipercold", "link": "https://stackoverflow.com/users/1401162/vipercold"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501017537, "post_id": 45293123, "comment_id": 77589900, "body": "@Flimzy i chose this architecture because i need to process different customers and i&#39;m trying to do not impact then each other."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501058481, "post_id": 45293123, "comment_id": 77605278, "body": "Well, do what you want, but that sounds like the entirely wrong reason to use microservices."}, {"owner": {"reputation": 489, "user_id": 1401162, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/34ccb916234d4117540155fed4e4ce1c?s=128&d=identicon&r=PG&f=1", "display_name": "Vipercold", "link": "https://stackoverflow.com/users/1401162/vipercold"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501077862, "post_id": 45293123, "comment_id": 77620213, "body": "@Flimzy ok i understand, but do you have any suggestions?"}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 1, "last_activity_date": 1500960085, "creation_date": 1500960085, "answer_id": 45294505, "question_id": 45293123, "link": "https://stackoverflow.com/questions/45293123/how-to-design-a-multi-file-processor-using-golang/45294505#45294505", "title": "How to design a multi-file processor using Golang?", "body": "<p>Plan internal data format to suit purpose of your application first, it should be convenient for next operations. All the application should work with internal data format and only specific input-output adapters should know about specific customers formats.\nThen write adapters from custom data formats A, B, C, ... to convert to basic internal format. These adapters should be as thin as possible, they should have minimal logics - just convert data and nothing more. This way it will be easier to maintain them. \nYou are right - if you change internal format you have to review and possibly change all adapters. That's why they should be very thin.\nThink which defaults can you have?\nI recommend to start with few customer formats to debug all concepts. \nWheather make the solution as a set of microservices of as modules in a single monilith - has no much sense in this way. </p>\n"}], "owner": {"reputation": 489, "user_id": 1401162, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/34ccb916234d4117540155fed4e4ce1c?s=128&d=identicon&r=PG&f=1", "display_name": "Vipercold", "link": "https://stackoverflow.com/users/1401162/vipercold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "closed_date": 1500979134, "accepted_answer_id": 45294505, "answer_count": 1, "score": 1, "last_activity_date": 1500974794, "creation_date": 1500951225, "last_edit_date": 1500974794, "question_id": 45293123, "link": "https://stackoverflow.com/questions/45293123/how-to-design-a-multi-file-processor-using-golang", "closed_reason": "Needs more focus", "title": "How to design a multi-file processor using Golang?", "body": "<p>I'm trying to figure out how to design a service that can handle multiples files format, using micro-services for example:</p>\n\n<p>I have a customer using a file format A, another using format B and other using format C.</p>\n\n<p>After processing a specific format for each customer, I need to transform this format into an common format, and insert into database.</p>\n\n<p>The first thing I tried is to design one service per customer but all of them need to know the base format and if an update is needed in this base format, I need to update all of there services.</p>\n\n<p>I'm trying to decouple the service processor and have a single place to translate to base format.</p>\n\n<p>If my customer services know about the base format, if this format changes,  I need to update all of them. If I have a service that translate the format, this service needs to know all customer formats.</p>\n\n<p>How to design this solution?</p>\n"}, {"tags": ["json", "rest", "loops", "go", "steam"], "comments": [{"owner": {"reputation": 1145, "user_id": 2872038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y9bqQ.jpg?s=128&g=1", "display_name": "Joshua Jones", "link": "https://stackoverflow.com/users/2872038/joshua-jones"}, "edited": false, "score": 0, "creation_date": 1500942871, "post_id": 45290144, "comment_id": 77546288, "body": "Why don&#39;t you unmarshall to structs that model the JSON response structure? That would be a much more simple way to access the data."}], "answers": [{"tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": true, "score": 4, "last_activity_date": 1500938397, "last_edit_date": 1500938397, "creation_date": 1500937880, "answer_id": 45291474, "question_id": 45290144, "link": "https://stackoverflow.com/questions/45290144/using-steam-rest-api-with-json/45291474#45291474", "title": "Using Steam Rest API with JSON", "body": "<p>Below is a working example. The crux is to declare a struct type that matches your JSON.</p>\n\n<p>You need to use a map type for your item since the key is not consistent.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n)\n\ntype Inventory struct {\n    Success      bool                    `json:\"success\"`\n    Items        map[string]*Item        `json:\"rgInventory\"`\n    Descriptions map[string]*Description `json:\"rgDescriptions\"`\n}\n\ntype Item struct {\n    ID         string `json:\"id\"`\n    ClassID    string `json:\"classid\"`\n    InstanceID string `json:\"instanceid\"`\n    Amount     string `json:\"amount\"`\n    Pos        int    `json:\"pos\"`\n}\n\ntype Description struct {\n    Descriptions []struct {\n        Value string `json:\"value\"`\n    } `json:\"descriptions\"`\n}\n\nfunc main() {\n    res, err := http.Get(\"http://steamcommunity.com/profiles/76561198096365603/inventory/json/730/2\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    inventory := &amp;Inventory{}\n    if err := json.NewDecoder(res.Body).Decode(&amp;inventory); err != nil {\n        log.Fatal(err)\n    }\n\n    for _, item := range inventory.Descriptions {\n        for _, d := range item.Descriptions {\n            fmt.Printf(d.Value)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 773, "favorite_count": 0, "accepted_answer_id": 45291474, "answer_count": 1, "score": 2, "last_activity_date": 1500974192, "creation_date": 1500930722, "last_edit_date": 1500974192, "question_id": 45290144, "link": "https://stackoverflow.com/questions/45290144/using-steam-rest-api-with-json", "title": "Using Steam Rest API with JSON", "body": "<p>I'm currently working on an educational project regarding Golang and using the Steam RESTAPI to retrieve a player's CounterStrike (CS:GO) inventory.</p>\n\n<p>After spending numerous hours this is the progress I have been able to gain:</p>\n\n<p>1) Calling a request to a url containing the users ID returns a JSON message with their inventory (but the JSON is a little tricky and is what I'm having trouble on).</p>\n\n<p>2) I need to loop through the rgDescriptions section of the JSON.</p>\n\n<p>3) I have constructed the following code <em>(located lower down)</em> that loops through the rgDescription, however I am unsure <strong>how to then get the value of everything inside of it</strong>.</p>\n\n<p>The code:</p>\n\n<pre><code>var data map[string]interface{}\nr, err := myClient.Get(\"http://steamcommunity.com/profiles/\" + id + \"/inventory/json/730/2\")\ndetectErr(err)\ndefer r.Body.Close()\n\nresult, err := ioutil.ReadAll(r.Body)\ndetectErr(err)\n\nerr = json.Unmarshal(result, &amp;data)\ndetectErr(err)\nmyMap := data[\"rgDescriptions\"]\nv := reflect.ValueOf(myMap)\nfor _, key := range v.MapKeys() {\n    value := v.MapIndex(key)\n    fmt.Println(key, \"-\", value)\n    //fmt.Println(reflect.ValueOf(value).MapIndex(varr[0])) // My idea for making this entire thing work, however it just spits out an error instead. :(\n    fmt.Println(\"----------------\\n\")\n}\n</code></pre>\n\n<p>The code above prints out something along the lines of:</p>\n\n<pre><code>1432174707_0 - map[classid:1432174707 market_hash_name:Revolver Case background_color: market_tradable_restriction:7 tags:[map[category_name:Type internal_name:CSGO_Type_WeaponCase name:Container category:Type] map[name:The Revolver Case Collection category:ItemSet category_name:Collection internal_name:set_community_10] map[internal_name:normal name:Normal category:Quality category_name:Category] map[category:Rarity color:b0c3d9 category_name:Quality internal_name:Rarity_Common name:Base Grade]] appid:730 instanceid:0 icon_url:-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXU5A1PIYQNqhpOSV-fRPasw8rsUFJ5KBFZv668FFYwnfKfcG9HvN7iktaOkqD1auLTxD5SvZYgiLvFpo7xjVLh-kdrYWnzcoGLMlhpsyM-5vg market_name:Revolver Case type:Base Grade Container marketable:1 commodity:1 icon_drag_url: name:Revolver Case name_color:D2D2D2 tradable:1 descriptions:[map[type:html value: ] map[type:html value:Container Series #111 color:99ccff] map[type:html value: ] map[type:html value:Contains one of the following:] map[type:html value:R8 Revolver | Crimson Web color:4b69ff] map[type:html value:AUG | Ricochet color:4b69ff] map[type:html value:Desert Eagle | Corinthian color:4b69ff] map[value:P2000 | Imperial color:4b69ff type:html] map[type:html value:Sawed-Off | Yorick color:4b69ff] map[color:4b69ff type:html value:SCAR-20 | Outbreak] map[type:html value:PP-Bizon | Fuel Rod color:8847ff] map[type:html value:Five-SeveN | Retrobution color:8847ff] map[type:html value:Negev | Power Loader color:8847ff] map[type:html value:SG 553 | Tiger Moth color:8847ff] map[type:html value:Tec-9 | Avalanche color:8847ff] map[type:html value:XM1014 | Teclu Burner color:8847ff] map[type:html value:AK-47 | Point Disarray color:d32ce6] map[type:html value:G3SG1 | The Executioner color:d32ce6] map[type:html value:P90 | Shapewood color:d32ce6] map[type:html value:M4A4 | Royal Paladin color:eb4b4b] map[type:html value:R8 Revolver | Fade color:eb4b4b] map[value:or an Exceedingly Rare Special Item! color:ffd700 type:html] map[type:html value: ] map[color:00a000 app_data:map[limited:1] type:html value:]]]\n</code></pre>\n\n<p>If you'd like to see an example of the JSON I am receiving here is an example URL. <a href=\"http://steamcommunity.com/profiles/76561198096365603/inventory/json/730/2\" rel=\"nofollow noreferrer\">http://steamcommunity.com/profiles/76561198096365603/inventory/json/730/2</a></p>\n\n<p>So in conclusion, I need to figure out how to loop through the contents of the value variable.</p>\n\n<p>Any help would be greatly appreciated.\nThank you.</p>\n"}, {"tags": ["pointers", "go"], "answers": [{"comments": [{"owner": {"reputation": 390, "user_id": 5955210, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60106a70864d0cb0dfbdaa945a1be824?s=128&d=identicon&r=PG&f=1", "display_name": "J. Eng", "link": "https://stackoverflow.com/users/5955210/j-eng"}, "edited": false, "score": 0, "creation_date": 1500925635, "post_id": 45288812, "comment_id": 77540102, "body": "I know, it is simply that I can&#39;t really see an example where this would be more readable than doing something else. I really want a concrete example where it makes sense to use point to pointers instead of other options."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 390, "user_id": 5955210, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60106a70864d0cb0dfbdaa945a1be824?s=128&d=identicon&r=PG&f=1", "display_name": "J. Eng", "link": "https://stackoverflow.com/users/5955210/j-eng"}, "edited": false, "score": 0, "creation_date": 1500925893, "post_id": 45288812, "comment_id": 77540231, "body": "There may not be a strong use case, which might be why you never see it used in the wild. Why are you searching for a reason to use something no one ever uses?"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1500926212, "post_id": 45288812, "comment_id": 77540401, "body": "Pointers to pointers are about as useful as pointers to interfaces. Both are rare, but sometimes they are the right tool for the job."}, {"owner": {"reputation": 1980, "user_id": 25818, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Y0MlY.jpg?s=128&g=1", "display_name": "3Doubloons", "link": "https://stackoverflow.com/users/25818/3doubloons"}, "edited": false, "score": 2, "creation_date": 1500926357, "post_id": 45288812, "comment_id": 77540486, "body": "This is C code, but the principles should transfer: Linux Torvalds&#39;s go to example of pointers to pointers <a href=\"https://grisha.org/blog/2013/04/02/linus-on-understanding-pointers/\" rel=\"nofollow noreferrer\">grisha.org/blog/2013/04/02/linus-on-understanding-pointers</a>"}, {"owner": {"reputation": 390, "user_id": 5955210, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60106a70864d0cb0dfbdaa945a1be824?s=128&d=identicon&r=PG&f=1", "display_name": "J. Eng", "link": "https://stackoverflow.com/users/5955210/j-eng"}, "edited": false, "score": 0, "creation_date": 1500926449, "post_id": 45288812, "comment_id": 77540541, "body": "It properly has its place in programming, but because people don&#39;t know about it and where to use it they might add some extra layer of complexity or do something in a harder way. That is why I want to know about it,"}, {"owner": {"reputation": 390, "user_id": 5955210, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60106a70864d0cb0dfbdaa945a1be824?s=128&d=identicon&r=PG&f=1", "display_name": "J. Eng", "link": "https://stackoverflow.com/users/5955210/j-eng"}, "edited": false, "score": 0, "creation_date": 1500926563, "post_id": 45288812, "comment_id": 77540590, "body": "I am new to low-level languages, do you have a good link to an article about &quot;pointers to interfaces&quot;?"}, {"owner": {"reputation": 390, "user_id": 5955210, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60106a70864d0cb0dfbdaa945a1be824?s=128&d=identicon&r=PG&f=1", "display_name": "J. Eng", "link": "https://stackoverflow.com/users/5955210/j-eng"}, "reply_to_user": {"reputation": 1980, "user_id": 25818, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Y0MlY.jpg?s=128&g=1", "display_name": "3Doubloons", "link": "https://stackoverflow.com/users/25818/3doubloons"}, "edited": false, "score": 0, "creation_date": 1500927494, "post_id": 45288812, "comment_id": 77541006, "body": "@3Doubloons I have just tried to read the example, but It is really just going over my head. I can see that it uses pointers to pointers though. Do you have other examples please?"}, {"owner": {"reputation": 12763, "user_id": 1097065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26becbd681062e6da684a000c6b03ea?s=128&d=identicon&r=PG", "display_name": "andybalholm", "link": "https://stackoverflow.com/users/1097065/andybalholm"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1500932591, "post_id": 45288812, "comment_id": 77543577, "body": "@TehSphinX, I rejected your edit because it doesn&#39;t really illustrate what I was trying to say very well. It may be good as <i>another</i> example of a situation where pointers to pointers are needed though."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "reply_to_user": {"reputation": 390, "user_id": 5955210, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60106a70864d0cb0dfbdaa945a1be824?s=128&d=identicon&r=PG&f=1", "display_name": "J. Eng", "link": "https://stackoverflow.com/users/5955210/j-eng"}, "edited": false, "score": 1, "creation_date": 1500946134, "post_id": 45288812, "comment_id": 77546996, "body": "@J.Eng The key in the last chunk of code is <code>pp = &amp;entry-&gt;next</code> and <code>*pp = entry-&gt;next</code>. <code>pp</code> will always be the address of either the &quot;head&quot; pointer or the &quot;next&quot; pointer. If it&#39;s a &quot;next&quot; pointer, you&#39;re always updating the &quot;next&quot; pointer of the previous entry. If you&#39;re still puzzled, try adding a <code>listEntry *prev = entry;</code> line before the <code>pp = &amp;entry-&gt;next;</code> line, and change things to <code>pp = &amp;prev-&gt;next;</code> and <code>entry = prev-&gt;next;</code> and see if it makes sense."}, {"owner": {"reputation": 390, "user_id": 5955210, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60106a70864d0cb0dfbdaa945a1be824?s=128&d=identicon&r=PG&f=1", "display_name": "J. Eng", "link": "https://stackoverflow.com/users/5955210/j-eng"}, "edited": false, "score": 0, "creation_date": 1501000719, "post_id": 45288812, "comment_id": 77580164, "body": "@ChronoKitsune The thing is that golang is the first low-level programming language. I have used node.js and happy with it as a backend. So when you come with C where there is <code>-&gt;</code> I don&#39;t know what you are saying, sorry. I will thumbs you up for taking the effort to help, but I do not get it. And I don&#39;t have C install on my mac, so I can&#39;t change it. I could go and download it, but the answer to this question is not worth downloading C."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1500925343, "creation_date": 1500925343, "answer_id": 45288812, "question_id": 45288751, "link": "https://stackoverflow.com/questions/45288751/what-use-case-does-pointers-to-pointer-eg-int-have/45288812#45288812", "title": "What use case does pointers to pointer (eg **int) have?", "body": "<p>In the same way a pointer to a value lets you have many references to the same value for a consistent view of the value when it changes, a pointer to a pointer lets you have many references to the same reference for a consistent view of the pointer when it changes to point to a different location in memory.</p>\n\n<p>I can't say I've ever seen it used in practice in Go that I can think of.</p>\n"}, {"tags": [], "owner": {"reputation": 12763, "user_id": 1097065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26becbd681062e6da684a000c6b03ea?s=128&d=identicon&r=PG", "display_name": "andybalholm", "link": "https://stackoverflow.com/users/1097065/andybalholm"}, "is_accepted": false, "score": 5, "last_activity_date": 1500926788, "creation_date": 1500926788, "answer_id": 45289162, "question_id": 45288751, "link": "https://stackoverflow.com/questions/45288751/what-use-case-does-pointers-to-pointer-eg-int-have/45289162#45289162", "title": "What use case does pointers to pointer (eg **int) have?", "body": "<p>Pointers to pointers make sense in function parameters sometimes; not <code>**int</code> probably, but a pointer to a pointer to some struct, where you want the function to be able to change what object a variable points to, not just to change the contents of the struct. For example, there are a few functions in the internals of the Go compiler that take a <code>**Node</code> (see cmd/compile/internal/gc/racewalk.go). </p>\n\n<p>I've also written a couple of functions myself that take a <code>**html.Node</code>; they operate on an HTML page that may or may not have already been parsed into a tree of <code>*html.Node</code>s, and they may or may not need to parse the page\u2014but if they do, I want to keep the parsed tree around so that I don't have to parse it again. These are in github.com/andybalholm/redwood/prune.go.</p>\n\n<p>They are much more common in languages that do not have multiple return values, since they can be used as a way to return an additional value that is a pointer. Many Objective-C methods take an <code>NSError**</code> as their last parameter so that they can optionally return an <code>NSError*</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1500972518, "post_id": 45297016, "comment_id": 77558074, "body": "What about a goroutine changing a value. You can&#39;t work with return values there. You could use a channel to pipe the value change out but that might be overkill. Of course you might need to use a mutex for access to the variable."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1500973151, "post_id": 45297016, "comment_id": 77558537, "body": "@TehSphinX I still think returning the pointer is easier to read and maintain even when running it in a goroutine. To make that convenient, I would simply use an anonymous function where you can deal with the return values, e.g. <code>go func() { i = alloc(1) }()</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1500969710, "last_edit_date": 1500969710, "creation_date": 1500968814, "answer_id": 45297016, "question_id": 45288751, "link": "https://stackoverflow.com/questions/45288751/what-use-case-does-pointers-to-pointer-eg-int-have/45297016#45297016", "title": "What use case does pointers to pointer (eg **int) have?", "body": "<p>The goal to pass a pointer to something is if there is <em>need</em> to modify the pointed value. (We also use pointers to avoid copying large data structures when passing, but that is just for optimization.)</p>\n\n<p>Like in this example:</p>\n\n<pre><code>func main() {\n    var i int\n    fmt.Println(i)\n    inc(&amp;i)\n    fmt.Println(i)\n}\n\nfunc inc(i *int) {\n    *i++\n}\n</code></pre>\n\n<p>Output is the expected (try it on the <a href=\"https://play.golang.org/p/r339Y4Z5N6\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0\n1\n</code></pre>\n\n<p>If parameter of <code>inc()</code> would receive an <code>int</code> only, it could only modify the copy and not the original value, and so the caller would not observe the changed value.</p>\n\n<p>Same goes with pointer to pointer to something. We use pointer to pointer to something, if we need to modify the pointed value, that is the pointed pointer. Like in this example:</p>\n\n<pre><code>func main() {\n    var i *int\n    fmt.Println(i)\n    alloc(&amp;i, 1)\n    fmt.Println(i, *i)\n\n    setToNil(&amp;i)\n    fmt.Println(i)\n}\n\nfunc alloc(i **int, initial int) {\n    *i = new(int)\n    **i = initial\n}\n\nfunc setToNil(i **int) {\n    *i = nil\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/97eCWAp8H2\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&lt;nil&gt;\n0x1040a130 1\n&lt;nil&gt;\n</code></pre>\n\n<p>The reason why pointer to pointer is not really used is because modifying a pointed value can be substituted by returning the value, and assigning it at the caller:</p>\n\n<pre><code>func main() {\n    var i *int\n    fmt.Println(i)\n    i = alloc(1)\n    fmt.Println(i, *i)\n\n    i = setToNil()\n    fmt.Println(i)\n}\n\nfunc alloc(initial int) *int {\n    i := new(int)\n    *i = initial\n    return i\n}\n\nfunc setToNil() *int {\n    return nil // Nothing to do here, assignment happens at the caller!\n}\n</code></pre>\n\n<p>Output is the same (address might be different) (try it on the <a href=\"https://play.golang.org/p/Ajog_7R37I\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&lt;nil&gt;\n0x1040a130 1\n&lt;nil&gt;\n</code></pre>\n\n<p>This variant is easier to read and maintain, so this is clearly the favored and wide-spread alternative to functions having to modify a pointer value.</p>\n\n<p>In languages where functions and methods can only have 1 return value, it usually requires additional \"work\" if the function also wants to return other values besides the pointer, e.g. a wrapper is to be created to accommodate the multiple return values. But since Go supports multiple return values, need for pointer to pointer basically drops to zero as it can be substituted with returning the pointer that would be set to the pointed pointer; and it does not require additional work and does not make code less readable.</p>\n\n<p>This is a very similar case to the builtin <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\"><code>append()</code></a> function: it appends values to a slice. And since the slice value changes (its length increases, also the pointer in it may also change if a new backing array needs to be allocated), <code>append()</code> returns the new slice value which you need to assign (if you want to keep the new slice).</p>\n\n<p>See this related question where a pointer to pointer is proposed (but also returning a pointer is also viable / preferred): <a href=\"https://stackoverflow.com/questions/35421495/golang-can-the-pointer-in-a-struct-pointer-method-be-reassigned-to-another-inst/35426997#35426997\">Golang: Can the pointer in a struct pointer method be reassigned to another instance?</a></p>\n"}], "owner": {"reputation": 390, "user_id": 5955210, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/60106a70864d0cb0dfbdaa945a1be824?s=128&d=identicon&r=PG&f=1", "display_name": "J. Eng", "link": "https://stackoverflow.com/users/5955210/j-eng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 45297016, "answer_count": 3, "score": 1, "last_activity_date": 1500969710, "creation_date": 1500925119, "question_id": 45288751, "link": "https://stackoverflow.com/questions/45288751/what-use-case-does-pointers-to-pointer-eg-int-have", "title": "What use case does pointers to pointer (eg **int) have?", "body": "<p>This is pointers to pointers</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var num int\n\n    fmt.Println(&amp;num) //  0x...0\n    makePointer(&amp;num)\n}\n\nfunc makePointer(firstPointer *int) {\n    fmt.Println(firstPointer)  //  0x...0\n    fmt.Println(&amp;firstPointer) //  0x...1\n\n    makePointerToAPointer(&amp;firstPointer)\n}\n\nfunc makePointerToAPointer(secondPointer **int) {\n    fmt.Println(secondPointer)  //  0x...1\n    fmt.Println(&amp;secondPointer) //  0x...2\n\n}\n</code></pre>\n\n<p>When would you actually use this? You can properly come up with something where it would be easier to do something else, but that is not what I asking about. I really want to know where in production you would use this?</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500922505, "post_id": 45287975, "comment_id": 77538464, "body": "I think this is way too broad for SO. If you&#39;re only checking status codes, you&#39;re right to be worried, you should be checking response bodies and side-effects (e.g. if you post a new Widget, does it get correctly persisted to the database, or whatever your case may be)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5906464"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500922739, "post_id": 45287975, "comment_id": 77538588, "body": "@Adrian I&#39;m trying to post the data in actual format and wrong format. If it doesn&#39;t get posted I&#39;m expecting a response code other than 200 and calling the error method. I edited the question with my test case."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500922823, "post_id": 45287975, "comment_id": 77538632, "body": "No one can answer this for you. The possible space of requests you might receive is infinite. You could always try something like <a href=\"https://en.wikipedia.org/wiki/Fuzzing\" rel=\"nofollow noreferrer\">Fuzz testing</a> but in the end it&#39;s up to you to decide what is &quot;enough&quot; testing."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5906464"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500923027, "post_id": 45287975, "comment_id": 77538726, "body": "@Adrian My api will definitely break if I do fuzzing. As of now, I&#39;m doing this with the remaining end points : &quot;(e.g. if you post a new Widget, does it get correctly persisted to the database, or whatever your case may be).&quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1500923255, "post_id": 45287975, "comment_id": 77538828, "body": "Whoaa... define &quot;break&quot;? Invalid requests shouldn&#39;t &quot;break&quot; anything, they should return a &quot;you gave me invalid input&quot; type of error. If fuzzing would break your API, then it&#39;s not stable."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5906464"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500926041, "post_id": 45287975, "comment_id": 77540308, "body": "@Adrian I got what you&#39;re saying. If a randomized input is given to the api, it should appropriately check the request body and send a proper response."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1500974958, "post_id": 45287975, "comment_id": 77559876, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/16154999/how-to-test-http-calls-in-go-using-httptest\">How to test http calls in go using httptest</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5906464"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501000375, "post_id": 45287975, "comment_id": 77579951, "body": "@Flimzy I don&#39;t think I asked how to use httptest. I asked how to make my test cases to give more information about my API."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501000457, "post_id": 45287975, "comment_id": 77579998, "body": "@Highsenberg: No, but httptest is the answer to your question."}, {"owner": {"user_type": "does_not_exist", "display_name": "user5906464"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1501000557, "post_id": 45287975, "comment_id": 77580049, "body": "@Flimzy <a href=\"https://codereview.stackexchange.com/questions/171055/testing-http-routes-in-go\" title=\"testing http routes in go\">codereview.stackexchange.com/questions/171055/&hellip;</a> I was using httptest to set up test server."}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 0, "last_activity_date": 1501005998, "creation_date": 1501005998, "answer_id": 45310694, "question_id": 45287975, "link": "https://stackoverflow.com/questions/45287975/proper-testing-of-http-routes-in-go/45310694#45310694", "title": "Proper testing of http routes in go", "body": "<p>I like to do this way:</p>\n\n<ol>\n<li><p>Establish Continuous Integration. If your project is Open Source, you may use services like <a href=\"https://travis-ci.org/\" rel=\"nofollow noreferrer\">Travis CI</a> - it has very easy installation. This helps you to see how changes affect code.</p></li>\n<li><p>Set code test coverage. It allows you to see what  source code lines are covered with tests and what are not and where very possible bugs will emerge. Of course, code coverage tool is not a panacea. And if line was checked it doesn't mean it is absolutely ok, and it will not fail with other input. But it helps much to maintain good code and look for bugs. For open source you may use coveralls.io. There's a special <a href=\"https://github.com/mattn/goveralls\" rel=\"nofollow noreferrer\">goveralls</a> plugin for it.</p></li>\n<li><p>To help the problem above you may use so-called Fuzzy testing - exploratory tests with random input to find a root cause. There're standard <a href=\"https://golang.org/pkg/testing/quick/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/testing/quick/</a> and non-standard packages <a href=\"https://github.com/dvyukov/go-fuzz\" rel=\"nofollow noreferrer\">https://github.com/dvyukov/go-fuzz</a>.</p></li>\n</ol>\n\n<p>Then I experiment with tests, they are both positive and negative. I try check situation with errors, timeouts, incorrect replies.</p>\n\n<p>For my tests I've used as usual client <code>http</code> so <code>httptest</code> package.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5906464"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 45310694, "answer_count": 1, "score": 0, "last_activity_date": 1501619297, "creation_date": 1500922316, "last_edit_date": 1592644375, "question_id": 45287975, "link": "https://stackoverflow.com/questions/45287975/proper-testing-of-http-routes-in-go", "title": "Proper testing of http routes in go", "body": "<p>I have 5 end points which have methods such as GET, POST, and DELETE to test. I wrote test cases using the go's in built testing package. I'm worried that I'm missing some cases which are not striking to my mind.I have posted in code review for my test case to be reviewed but I didn't get any response. I have also followed this post <a href=\"https://stackoverflow.com/questions/25337126/testing-http-routes-in-golang\">Testing HTTP routes in golang</a>. All these test cases are checking for the response codes.</p>\n<p>The problem is that, most of my test cases follow similar pattern where I post data in different formats and checking the response codes. I strongly feel like I'm missing something that will break my API when I push it to prod. I need some insight on testing these routes so that I can be confident to push the api to prod.</p>\n<h1>main_test.go</h1>\n<pre><code>func TestSigHandler(t *testing.T){\n\n    test_cases := []string{&quot;2021205&quot;}  \n    // GET Testing\n    for _, method := range test_cases{\n        usersUrl = fmt.Sprintf(&quot;%s/1/sig/id/%s&quot;, server.URL, method) //Grab the address for the API endpoint\n        request, err := http.NewRequest(&quot;GET&quot;, usersUrl, nil)\n        res, err := http.DefaultClient.Do(request)\n\n        if err != nil {\n            t.Error(err) //Something is wrong while sending request\n        }\n\n        if res.StatusCode != 200  {\n            t.Errorf(&quot;Something went wrong : &quot;, res.StatusCode) //Uh-oh this means our test failed\n        }\n    }\n\n    // POST Testing\n        sig := []byte( `{\n        &quot;raw&quot;: &quot;a new sig&quot;\n    }`)\n        usersUrl = fmt.Sprintf(&quot;%s/1/sig/id/2021205&quot;, server.URL) //Grab the address for the API endpoint\n        request, err := http.NewRequest(&quot;POST&quot;, usersUrl, bytes.NewBuffer(sig))\n        if err != nil{\n            t.Error(err)\n        }\n        request.Header.Set(&quot;Content-Type&quot;, &quot;application/json&quot;)\n        res, err := http.DefaultClient.Do(request)\n\n        if err != nil {\n            t.Error(err) //Something is wrong while sending request\n        }\n\n        if res.StatusCode != 200  {\n            t.Errorf(&quot; Something Went Wrong: &quot;, res.StatusCode) //Uh-oh this means our test failed\n        }\n\n        // DELETE Testing\n\n        sigs_delete_cases := []string{ &quot;1000345&quot;}\n        for _, sig_to_be_deleted := range sigs_delete_cases{\n            usersUrl = fmt.Sprintf(&quot;%s/1/sig/id/%s&quot;, server.URL, sig_to_be_deleted) //Grab the address for the API endpoint\n            request, err := http.NewRequest(&quot;DELETE&quot;, usersUrl, nil)\n            res, err := http.DefaultClient.Do(request)\n\n            if err != nil {\n                t.Error(err) //Something is wrong while sending request\n            }\n\n            if res.StatusCode != 200  {\n                t.Errorf(&quot;Tried to delete a reserved Id : &quot;, res.StatusCode) //Uh-oh this means our test failed\n            }\n        }\n\n\n}\n</code></pre>\n"}, {"tags": ["multithreading", "go", "thread-safety"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1500920240, "post_id": 45287348, "comment_id": 77537161, "body": "As long as your logic is OK with the potential for a worker to get stale data... That said, you may be dooming yourself and any future maintainers to some severe headaches if you don&#39;t fully lock it as the read behavior could be undefined. These issues are very difficult to debug once they start causing problems. It&#39;s better to just nip it in the bud and lock it."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1500920443, "post_id": 45287348, "comment_id": 77537262, "body": "The second approach does not work because it has a data race on the field <code>p</code>."}, {"owner": {"reputation": 2820, "user_id": 1804543, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/u2EW6.jpg?s=128&g=1", "display_name": "WhatABeautifulWorld", "link": "https://stackoverflow.com/users/1804543/whatabeautifulworld"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1500920640, "post_id": 45287348, "comment_id": 77537383, "body": "@CeriseLim&#243;n why? The reader will get either old p (which is fine) or new p"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1500921473, "post_id": 45287348, "comment_id": 77537850, "body": "When writing good solid code, there isn&#39;t really such a thing as an OK race condition. They are pretty much always bad and should be avoided despite the costs. I would suggest a slightly different approach though because many readers could starve the write lock. Only lock when writing, and disallow reading when the write lock is locked. This works with your data because you aren&#39;t concerned if a reader is already working on old data while the writer updates it."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1500921803, "post_id": 45287348, "comment_id": 77538054, "body": "@WhatABeautifulWorld There&#39;s no guarantee that the program will read either the old value or the new value.  See <a href=\"https://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong\" rel=\"nofollow noreferrer\">software.intel.com/en-us/blogs/2013/01/06/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": true, "score": 1, "last_activity_date": 1500924952, "creation_date": 1500924952, "answer_id": 45288698, "question_id": 45287348, "link": "https://stackoverflow.com/questions/45287348/golang-threading-model-comparison/45288698#45288698", "title": "golang threading model comparison", "body": "<p>Your first option is fine and perhaps simplest to do. However, it could lead to poor performance with many readers as it could struggle to obtain a write lock.</p>\n\n<p>As the comments on your question have stated, your second option (as-is) can cause a race condition and lead to unpredictable behaviour.</p>\n\n<p>You could implement your second option by using <a href=\"https://golang.org/pkg/sync/atomic/#Value\" rel=\"nofollow noreferrer\">atomic.Value</a>. This would allow you to store the pointer to some data struct and atomically update this for the next readers to use. For example:</p>\n\n<pre><code>// Data shared with readers\ntype data struct {\n   // all the fields\n}\n\n// Manager\ntype manager struct {\n    v atomic.Value\n}\n\n// Method used by readers to obtain a fresh copy of data to \n// work with, e.g. inside loop\nfunc (m *manager) Data() *data {\n    return m.v.Load().(*data)\n}\n\n// Internal method called to set new data for readers\nfunc (m *manager) update() {\n    d:=&amp;data{\n        // ... set values here\n    }\n    m.v.Store(d)\n}\n</code></pre>\n"}], "owner": {"reputation": 2820, "user_id": 1804543, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/u2EW6.jpg?s=128&g=1", "display_name": "WhatABeautifulWorld", "link": "https://stackoverflow.com/users/1804543/whatabeautifulworld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "accepted_answer_id": 45288698, "answer_count": 1, "score": 1, "last_activity_date": 1500924952, "creation_date": 1500920051, "question_id": 45287348, "link": "https://stackoverflow.com/questions/45287348/golang-threading-model-comparison", "title": "golang threading model comparison", "body": "<p>I have a piece of data</p>\n\n<pre><code>type data struct {\n    // all good data here\n    ...\n}\n</code></pre>\n\n<p>This data is owned by a manager and used by other threads for reading only. The manager needs to periodically update the data. How do I design the threading model for this? I can think of two options:</p>\n\n<p>1.</p>\n\n<pre><code>type manager struct {\n    // acquire read lock when other threads read the data.\n    // acquire write lock when manager wants to update.\n    lock sync.RWMutex\n    // a pointer holding a pointer to the data\n    p *data\n}\n</code></pre>\n\n<p>2. </p>\n\n<pre><code>type manager struct {\n    // copy the pointer when other threads want to use the data.\n    // When manager updates, just change p to point to the new data.\n    p *data\n}\n</code></pre>\n\n<p>Does the second approach work? It seems I don't need any lock. If other threads get a pointer pointing to the old data, it would be fine if manager updates the original pointer. As GoLang will do GC, after all other threads read the old data it will be auto released. Am I correct?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1500919341, "post_id": 45287124, "comment_id": 77536628, "body": "It will not work If I have many API calls, sync.WaitGroup solution will fire all of them. I need something to control how many API calls I do at once. And there semaphore really helps."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1500919706, "post_id": 45287124, "comment_id": 77536853, "body": "You can still have an outer <code>for</code> loop that does them in batches, say 10 at a time."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500919798, "post_id": 45287124, "comment_id": 77536902, "body": "OK, I misunderstood your use of the channel - in that case just put the work on the channel (like a queue) and only spawn as many go routines as you want concurrent calls, instead of spawning one per request and then having them wait to actually do anything."}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1500920055, "post_id": 45287124, "comment_id": 77537041, "body": "if you could share a code snippet, I have read a lot of info... still can&#39;t figure how to make it?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500921114, "post_id": 45287124, "comment_id": 77537658, "body": "Updated answer."}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1500963229, "post_id": 45287124, "comment_id": 77552027, "body": "well this looks less cleaner then semaphore approach. I was looking how to get rid of &quot;MAP&quot; and use a channel instead."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500983247, "post_id": 45287124, "comment_id": 77565953, "body": "I addressed the semaphore because it&#39;s what you asked about in the question. You never mentioned any issues with the map. I can update my answer but it&#39;d be very similar to @pavlo&#39;s."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500988788, "post_id": 45287124, "comment_id": 77570677, "body": "Updated to replace the map with a slice and results channel, and a waitgroup to manage closing the results channel when all workers are done."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 2, "last_activity_date": 1500988732, "last_edit_date": 1500988732, "creation_date": 1500919207, "answer_id": 45287124, "question_id": 45287088, "link": "https://stackoverflow.com/questions/45287088/go-channel-many-slow-api-queries-into-single-sql-transaction/45287124#45287124", "title": "Go: channel many slow API queries into single SQL transaction", "body": "<p>There's no need to use channels for a semaphore, <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">sync.WaitGroup</a> was made for waiting for a set of routines to complete.</p>\n\n<p>If you're using the channel to limit throughput, you're better off with a worker pool, and using the channel to pass jobs to the workers:</p>\n\n<pre><code>type job struct {\n    i int\n}\n\nfunc myFunc(N int) {\n    // Adjust as needed for total number of tasks\n    work := make(chan job, 10)\n    // res being whatever type slowAPICall returns\n    results := make(chan res, 10)\n    resBuff := make([]res, 0, N)\n\n    wg := new(sync.WaitGroup)\n\n    // 10 concurrent API calls\n    for i = 0; i &lt; 10; i++ {\n        wg.Add(1)\n        go func() {\n            for j := range work {\n                resp := slowAPICall(fmt.Sprintf(\"http://slow-api.me?%d\", j.i))\n                results &lt;- resp\n            }\n            wg.Done()\n        }()\n    }\n\n    go func() {\n        for r := range results {\n            resBuff = append(resBuff, r)\n        }\n    }\n\n    for i = 0; i &lt; N; i++ {\n        work &lt;- job{i}\n    }\n    close(work)\n\n    wg.Wait()\n    close(results)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1500963174, "post_id": 45289727, "comment_id": 77551997, "body": "Idea was to get rid of myMap and somehow use channel instead. Otherwise the semaphore approach works just well."}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1501005976, "post_id": 45289727, "comment_id": 77583442, "body": "Thanks! Well, I am not looking for &quot;working&quot; solution, it is already works.  Can not see what is the purpose of <code>respCollected</code>  channel?"}, {"owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "reply_to_user": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1501009988, "post_id": 45289727, "comment_id": 77585793, "body": "Because accumulation of responses goes in separate goroutine we need to wait until all of them will be received. Frankly saying It is not necessary to use a separate goroutine to accumulate responses, so you can use just a <code>for</code> loop"}], "tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": true, "score": 1, "last_activity_date": 1500969622, "last_edit_date": 1500969622, "creation_date": 1500929046, "answer_id": 45289727, "question_id": 45287088, "link": "https://stackoverflow.com/questions/45287088/go-channel-many-slow-api-queries-into-single-sql-transaction/45289727#45289727", "title": "Go: channel many slow API queries into single SQL transaction", "body": "<p>Maybe this will work for you. Now you can get rid of your concurrent map. Here is a code snippet: </p>\n\n<pre><code>func myFunc() {\n    //10 concurrent API calls\n    sem := make(chan bool, 10)\n    respCh := make(chan YOUR_RESP_TYPE, 10)\n    var responses []YOUR_RESP_TYPE\n\n    for i := 0; i &lt; N; i++ {\n        sem &lt;- true\n        go func(i int) {\n            defer func() {\n                &lt;-sem\n            }()\n            resp := slowAPICall(fmt.Sprintf(\"http://slow-api.me?%d\",i))\n            respCh &lt;- resp\n        }(i)\n    }\n\n    respCollected := make(chan struct{})\n    go func() {\n        for i := 0; i &lt; N; i++ {\n            responses = append(responses, &lt;-respCh)\n        }\n        close(respCollected)\n    }()\n\n    &lt;-respCollected\n    tx,_ := db.Begin()\n    for _, data := range responses {\n        tx.Exec(\"Insert data into database\")\n    }\n    tx.Commit()\n}\n</code></pre>\n\n<p>Than we need to use one more goroutine that will collect all responses in some slice or map from a response channel.</p>\n"}], "owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 0, "accepted_answer_id": 45289727, "answer_count": 2, "score": -1, "last_activity_date": 1500988732, "creation_date": 1500919070, "last_edit_date": 1500974464, "question_id": 45287088, "link": "https://stackoverflow.com/questions/45287088/go-channel-many-slow-api-queries-into-single-sql-transaction", "title": "Go: channel many slow API queries into single SQL transaction", "body": "<p>I wonder what would be idiomatic way to do as following. \nI have N slow API queries, and one database connection, I want to have a buffered channel, where responses will come, and one database transaction which I will use to write data. \nI could only come up with semaphore thing as following makeup example: </p>\n\n<pre><code>    func myFunc(){\n      //10 concurrent API calls\n      sem := make(chan bool, 10) \n     //A concurrent safe map as buffer\n      var myMap  MyConcurrentMap \n\n      for i:=0;i&lt;N;i++{\n        sem&lt;-true\n        go func(i int){\n          defer func(){&lt;-sem}()\n          resp:=slowAPICall(fmt.Sprintf(\"http://slow-api.me?%d\",i))\n          myMap.Put(resp)\n        }(i)\n      }\n\n      for j=0;j&lt;cap(sem);j++{\n        sem&lt;-true\n      }\n      tx,_ := db.Begin()    \n      for data:=range myMap{\n       tx.Exec(\"Insert data into database\")\n      }\n      tx.Commit()\n}\n</code></pre>\n\n<p>I am nearly sure there is simpler, cleaner and more proper solution, but it is seems complicated to grasp for me. </p>\n\n<p>EDIT:\nWell, I come with following solution, this way I do not need the buffer map, so once data comes to <code>resp</code> channel the data is printed or can be used to insert into a database, it works, I am still not sure if everything OK, at last there are no race. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"sync\"\n    \"time\"\n)\n\n//Gloab waitGroup\nvar wg sync.WaitGroup\n\nfunc init() {\n    //just for fun sake, make rand seeded\n    rand.Seed(time.Now().UnixNano())\n}\n\n//Emulate a slow API call\nfunc verySlowAPI(id int) int {\n    n := rand.Intn(5)\n    time.Sleep(time.Duration(n) * time.Second)\n    return n\n}\n\nfunc main() {\n    //Amount of tasks\n    N := 100\n\n    //Concurrency level\n    concur := 10\n\n    //Channel for tasks\n    tasks := make(chan int, N)\n\n    //Channel for responses\n    resp := make(chan int, 10)\n\n    //10 concurrent groutinezs\n    wg.Add(concur) \n    for i := 1; i &lt;= concur; i++ {\n        go worker(tasks, resp)\n    }\n\n    //Add tasks\n    for i := 0; i &lt; N; i++ {\n        tasks &lt;- i\n    }\n\n    //Collect data from goroutiens\n    for i := 0; i &lt; N; i++ {\n        fmt.Printf(\"%d\\n\", &lt;-resp)\n    }\n\n    //close the tasks channel\n    close(tasks)\n\n    //wait till finish\n    wg.Wait()\n\n}\n\nfunc worker(task chan int, resp chan&lt;- int) {\n    defer wg.Done()\n    for {\n        task, ok := &lt;-task\n        if !ok {\n            return\n        }\n        n := verySlowAPI(task)\n        resp &lt;- n\n    }\n}\n</code></pre>\n"}, {"tags": ["mongodb", "web-services", "go", "mongodb-query", "go-gin"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500918856, "post_id": 45286908, "comment_id": 77536311, "body": "I gave a guess at the answer but &quot;i still get errors&quot; isn&#39;t much to go on. Please update your question with the <i>specific errors</i> you&#39;re getting."}, {"owner": {"reputation": 1, "user_id": 8359202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aa058c3709663178ed0507ecd657cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Tech-P", "link": "https://stackoverflow.com/users/8359202/tech-p"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500920695, "post_id": 45286908, "comment_id": 77537418, "body": "the error is: &quot;not found&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1, "user_id": 8359202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aa058c3709663178ed0507ecd657cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Tech-P", "link": "https://stackoverflow.com/users/8359202/tech-p"}, "edited": false, "score": 0, "creation_date": 1500921157, "post_id": 45287019, "comment_id": 77537684, "body": "&quot;1&quot; is not a valid BSON ObjectId, and per the documentation I linked to, if it&#39;s not valid, <code>ObjectIdHex</code> will panic."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1, "user_id": 8359202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aa058c3709663178ed0507ecd657cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Tech-P", "link": "https://stackoverflow.com/users/8359202/tech-p"}, "edited": false, "score": 0, "creation_date": 1500921872, "post_id": 45287019, "comment_id": 77538086, "body": "OK... what did you change? Are you passing in a valid ObjectId for a document that exists in your collection? When you execute the query manually with the mongo client does it work?"}, {"owner": {"reputation": 1, "user_id": 8359202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aa058c3709663178ed0507ecd657cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Tech-P", "link": "https://stackoverflow.com/users/8359202/tech-p"}, "edited": false, "score": 0, "creation_date": 1500921939, "post_id": 45287019, "comment_id": 77538123, "body": "i did this &quot;<a href=\"http://localhost:5000/polls/58d9cf1cdf353f3d2f5951b4\" rel=\"nofollow noreferrer\">localhost:5000/polls/58d9cf1cdf353f3d2f5951b4</a>&quot; and still got same errors"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1, "user_id": 8359202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aa058c3709663178ed0507ecd657cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Tech-P", "link": "https://stackoverflow.com/users/8359202/tech-p"}, "edited": false, "score": 0, "creation_date": 1500922088, "post_id": 45287019, "comment_id": 77538215, "body": "<i>What errors?</i> Is that even the correct route, and correct route parameter? None of the routing is shown in your question. Are you sure the value is coming through in your handler? Have you checked what value you&#39;re passing in? Have you tried your query in the mongo shell?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1, "user_id": 8359202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aa058c3709663178ed0507ecd657cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Tech-P", "link": "https://stackoverflow.com/users/8359202/tech-p"}, "edited": false, "score": 0, "creation_date": 1500922179, "post_id": 45287019, "comment_id": 77538279, "body": "Sorry, just re-read and saw your routing, and no, it doesn&#39;t appear to be the same parameter. In your route you have <code>_id</code>, but then you call <code>Param(&quot;id&quot;)</code>. When you run into an issue, it&#39;s important to check what values are getting passed around and if they&#39;re correct."}, {"owner": {"reputation": 1, "user_id": 8359202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aa058c3709663178ed0507ecd657cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Tech-P", "link": "https://stackoverflow.com/users/8359202/tech-p"}, "edited": false, "score": 0, "creation_date": 1500922296, "post_id": 45287019, "comment_id": 77538339, "body": "new error &quot; Unsupported document type for unmarshalling: []main.Poll 7:51:00 PM web.1 |  [GIN] 2017/07/24 - 19:51:00 | 200 |     382.758&#181;s | 127.0.0.1 |   GET     /polls/58d9cf1cdf353f3d2f5951b4  &quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1, "user_id": 8359202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aa058c3709663178ed0507ecd657cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Tech-P", "link": "https://stackoverflow.com/users/8359202/tech-p"}, "edited": false, "score": 0, "creation_date": 1500922413, "post_id": 45287019, "comment_id": 77538407, "body": "I&#39;m guessing that&#39;s because it&#39;s a single result you&#39;re trying to unmarshal into a slice. But, it&#39;s progress: you&#39;ve gotten past the issue you originally posted about! You can accept this answer if it solved your problem, but any further issues you&#39;ll have to troubleshoot and then post a new question if necessary."}, {"owner": {"reputation": 1, "user_id": 8359202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aa058c3709663178ed0507ecd657cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Tech-P", "link": "https://stackoverflow.com/users/8359202/tech-p"}, "edited": false, "score": 0, "creation_date": 1500922539, "post_id": 45287019, "comment_id": 77538477, "body": "nope, thats not the question, &quot;Errors Getting polls by id from mongoDB with go-gin and mgo  &quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1, "user_id": 8359202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aa058c3709663178ed0507ecd657cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Tech-P", "link": "https://stackoverflow.com/users/8359202/tech-p"}, "edited": false, "score": 0, "creation_date": 1500922748, "post_id": 45287019, "comment_id": 77538595, "body": "But you just said you didn&#39;t get a not found error, you got a &quot;Unsupported document type for unmarshalling&quot; error."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1500918812, "creation_date": 1500918812, "answer_id": 45287019, "question_id": 45286908, "link": "https://stackoverflow.com/questions/45286908/errors-getting-polls-by-id-from-mongodb-with-go-gin-and-mgo/45287019#45287019", "title": "Errors Getting polls by id from mongoDB with go-gin and mgo", "body": "<p>Your ID is an <code>ObjectId</code>, but your input is a <code>string</code>. You need to use <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#ObjectIdHex\" rel=\"nofollow noreferrer\"><code>bson.ObjectIdHex</code></a> to parse the <code>string</code> into an <code>ObjectId</code>:</p>\n\n<pre><code>err := db.C(CollectionPoll).FindId(bson.ObjectIdHex(id)).One(&amp;poll)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 8359202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aa058c3709663178ed0507ecd657cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Tech-P", "link": "https://stackoverflow.com/users/8359202/tech-p"}, "is_accepted": true, "score": 0, "last_activity_date": 1501391645, "last_edit_date": 1501391645, "creation_date": 1501365054, "answer_id": 45394395, "question_id": 45286908, "link": "https://stackoverflow.com/questions/45286908/errors-getting-polls-by-id-from-mongodb-with-go-gin-and-mgo/45394395#45394395", "title": "Errors Getting polls by id from mongoDB with go-gin and mgo", "body": "<p>Change polls from an array:</p>\n\n<pre><code> polls := []Poll{}\n</code></pre>\n\n<p>TO:</p>\n\n<pre><code>polls := Poll{}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 8359202, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4aa058c3709663178ed0507ecd657cdf?s=128&d=identicon&r=PG&f=1", "display_name": "Tech-P", "link": "https://stackoverflow.com/users/8359202/tech-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 45394395, "answer_count": 2, "score": -2, "last_activity_date": 1501391645, "creation_date": 1500918464, "last_edit_date": 1500922176, "question_id": 45286908, "link": "https://stackoverflow.com/questions/45286908/errors-getting-polls-by-id-from-mongodb-with-go-gin-and-mgo", "title": "Errors Getting polls by id from mongoDB with go-gin and mgo", "body": "<p>How do i query polls by id with go-gin and MongoDB, i have tried several methods but i still get errors (not found), can't seem to find a walk around below is my code, with my database on mongoDB:</p>\n\n<pre><code>type Poll struct {\n    //ID        string `json:\"_id,omitempty\"`\n    ID        bson.ObjectId     `json:\"id,omitempty\" bson:\"_id,omitempty\"`\n    Firstname string            `json:\"firstname,omitempty\"`\n    Lastname  string            `json:\"lastname,omitempty\"`\n    Poll      string            `json:\"poll,omitempty\"`\n    //  Address   *Address `json:\"address,omitempty\"`\n}\n\nvar (\n    // Session stores mongo session\n    Session *mgo.Session\n\n    // Mongo stores the mongodb connection string information\n    Mongo *mgo.DialInfo\n)\n\nconst (\n    // MongoDBUrl is the default mongodb url that will be used to connect to the\n    // database.\n    MongoDBUrl = \"mongodb://localhost:27017/smartpoll\"\n\n        // CollectionPoll holds the name of the poll collection\n    CollectionPoll = \"polls\"\n)\n\n// Connect connects to mongodb\nfunc Connect() {\n    uri := os.Getenv(\"MONGODB_URL\")\n\n    if len(uri) == 0 {\n        uri = MongoDBUrl\n    }\n\n    mongo, err := mgo.ParseURL(uri)\n    s, err := mgo.Dial(uri)\n    if err != nil {\n        fmt.Printf(\"Can't connect to mongo, go error %v\\n\", err)\n        panic(err.Error())\n    }\n    s.SetSafe(&amp;mgo.Safe{})\n    fmt.Println(\"Connected to\", uri)\n    Session = s\n    Mongo = mongo\n}\n\n\nfunc init() {\n    Connect()\n}\n\nfunc main() {\n    port := os.Getenv(\"PORT\")\n\n    if port == \"\" {\n        log.Fatal(\"$PORT must be set\")\n    }\n\n\n\n    router := gin.Default()\n    router.Use(ConnectMiddleware)\n    router.GET(\"/\", func (c *gin.Context) {\n        c.JSON(http.StatusOK, gin.H{\"message\": \"OK\"})\n\n    })\n\n    router.GET(\"/polls/:_id\", pollsByID)\n    router.Run(\":\" + port)\n}\n\n\n\n\nfunc ConnectMiddleware(c * gin.Context) {\n    c.Set(\"db\", Session.DB(Mongo.Database))\n    c.Next()\n}\n\nfunc pollsByID(c * gin.Context) {\n    db := c.MustGet(\"db\").(*mgo.Database)\n    id := c.Param(\"id\")\n    poll := []Poll{}\n//  err := db.C(CollectionPoll).Find(id).One(&amp;poll)\n    err := db.C(CollectionPoll).Find(bson.M{\"_id\": id}).One(&amp;poll)\n\n\n\n    if err != nil {\n        //c.Error(err)\n        //panic(err)\n      log.Println(err)\n    }\n    result := gin.H{\"payload\": poll}\n  c.Writer.Header().Set(\"Content-Type\", \"application/json\")\n    c.JSON(200, result)\n\n}\n</code></pre>\n\n<p>my DB is as follows:</p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"58d9cf1cdf353f3d2f5951b4\"),\n    \"id\" : \"1\",\n    \"firstname\" : \"Sam\",\n    \"lastname\" : \"Smith\",\n    \"poll\" : \"Who is the Richest in the World\"\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "edited": false, "score": 0, "creation_date": 1500917506, "post_id": 45286582, "comment_id": 77535600, "body": "Thank you for explaining that to me. I heard of a race condition but didn&#39;t understand it until now."}], "tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": true, "score": 7, "last_activity_date": 1500917167, "creation_date": 1500917167, "answer_id": 45286582, "question_id": 45286540, "link": "https://stackoverflow.com/questions/45286540/golang-for-loop-with-inconsistent-adding-of-i/45286582#45286582", "title": "Golang for loop with inconsistent adding of i++", "body": "<p>Through the closures all the goroutines share the same variable <code>i</code>. Try that instead:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    a := []string{\n        \"apple\",\n        \"orange\",\n        \"grape\",\n        \"peach\",\n        \"lemon\",\n    }\n\n    wg := sync.WaitGroup{}\n    wg.Add(len(a))\n    for i, v := range a {\n        go func(a string, j int) {\n            fmt.Println(a, j)\n            wg.Done()\n        }(v,j)\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>Generally: In the program you posted you are reading <code>i</code> and writing <code>i</code> from different goroutines without any synchronisation. That is a data race. Anything could happen in that scenario.</p>\n\n<p>The go race detector even yells at you</p>\n\n<pre><code>go run -race test.go\napple 0\n==================\nWARNING: DATA RACE\nRead at 0x00c420010268 by goroutine 7:\n  main.main.func1()\n      /home/erwo/test.go:22 +0x6d\n\nPrevious write at 0x00c420010268 by goroutine 6:\n  main.main.func1()\n      /home/erwo/test.go:23 +0x191\n\nGoroutine 7 (running) created at:\n  main.main()\n      /home/erwo/test.go:25 +0x15f\n\nGoroutine 6 (finished) created at:\n  main.main()\n      /home/erwo/test.go:25 +0x15f\n==================\norange 1\n==================\nWARNING: DATA RACE\nRead at 0x00c420010268 by goroutine 8:\n  main.main.func1()\n      /home/erwo/test.go:22 +0x6d\n\nPrevious write at 0x00c420010268 by goroutine 6:\n  main.main.func1()\n      /home/erwo/test.go:23 +0x191\n\nGoroutine 8 (running) created at:\n  main.main()\n      /home/erwo/test.go:25 +0x15f\n\nGoroutine 6 (finished) created at:\n  main.main()\n      /home/erwo/test.go:25 +0x15f\n==================\npeach 2\ngrape 2\nlemon 4\nFound 2 data race(s)\nexit status 66\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "edited": false, "score": 0, "creation_date": 1500917456, "post_id": 45286611, "comment_id": 77535573, "body": "Thank You. My real program is processing thousands of lines which is why I  want go routines in my for loop just to save time. Krom example worked for me.  Thank you for explaining this better."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 5, "last_activity_date": 1500919245, "last_edit_date": 1500919245, "creation_date": 1500917274, "answer_id": 45286611, "question_id": 45286540, "link": "https://stackoverflow.com/questions/45286540/golang-for-loop-with-inconsistent-adding-of-i/45286611#45286611", "title": "Golang for loop with inconsistent adding of i++", "body": "<p>There are several things that are happening in each goroutine:</p>\n\n<ol>\n<li>It prints the value of <code>i</code> as it is <em>at the time the print statement executes</em>.</li>\n<li>It increments the value of <code>i</code>. </li>\n</ol>\n\n<p>There is no guarantee that those two things happen atomically, or in what order they will happen by which goroutines. </p>\n\n<p>In order to get your desired result, you can:</p>\n\n<ol>\n<li>Use a mutex to protect access to <code>i</code> (but that kinda defeats the point of paralellism sometimes)</li>\n<li>Pass <code>i</code> as an argument to your function (<code>go func(i int){}(i)</code>). (like Krom's answer)</li>\n<li>Use atomic operations to swap i to a new local in each goroutine and increment it (a bit tricky to get just right)</li>\n</ol>\n\n<p>I'd recommend 2. But I would also advise against using goroutine order as a source of randomness.</p>\n"}], "owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 794, "favorite_count": 0, "accepted_answer_id": 45286582, "answer_count": 2, "score": 1, "last_activity_date": 1500919245, "creation_date": 1500916967, "question_id": 45286540, "link": "https://stackoverflow.com/questions/45286540/golang-for-loop-with-inconsistent-adding-of-i", "title": "Golang for loop with inconsistent adding of i++", "body": "<p>I have for loop with goroutines. I create the go routines in the loop which prints a string and \"i\" which is an int. I know the strings and \"i\" will print in random order which it does. But \"i\" is not adding correctly as you can see below. The value stays the same for three or four of the five strings then jumps to 2 or 1. Shouldn't there be a 1, 2, 3, 4, 5 in the random order? What am I doing wrong?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    a := []string{\n        \"apple\",\n        \"orange\",\n        \"grape\",\n        \"peach\",\n        \"lemon\",\n    }\n\n    wg := sync.WaitGroup{}\n    wg.Add(len(a))\n    i := 0\n    for _, v := range a {\n        go func(a string) {\n            fmt.Println(a, i)\n            i++\n            wg.Done()\n        }(v)\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>Result 1:</p>\n\n<pre><code>orange 0\napple 0\nlemon 0\npeach 2\ngrape 0\n</code></pre>\n\n<p>Result 2:</p>\n\n<pre><code>lemon 0\ngrape 0\npeach 0\napple 0\norange 1\n</code></pre>\n\n<p>My Goal (random order)</p>\n\n<pre><code>lemon 2\ngrape 4\npeach 1\napple 0\norange 3\n</code></pre>\n"}, {"tags": ["macos", "go", "kubernetes", "gcloud"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1500914946, "post_id": 45285907, "comment_id": 77534172, "body": "If you&#39;re installing the <code>kubectl</code> binary, there&#39;s nothing wrong with go, because you&#39;re not building anything. If you are building <code>kubectl</code> yourself, then have you updated to the latest Go installation? Also, websense isn&#39;t the only anti-malware tool that has been known to interfere with Go binaries."}, {"owner": {"reputation": 648, "user_id": 3785222, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/n7dU4.jpg?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/3785222/michael"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500916557, "post_id": 45285907, "comment_id": 77535058, "body": "Did not build myself.  Any way to properly troubleshoot this rather than take shots in the dark?  This is an enterprise controlled laptop so it&#39;s not easy to just disable security software."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500918163, "post_id": 45285907, "comment_id": 77535951, "body": "You might be able to get around it yourself with the recommendation here: <a href=\"https://github.com/golang/go/issues/8801\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/8801</a>, though that will require familiarizing yourself with the k8s build system. There may be a way to whitelist the binary with your security software, but otherwise there&#39;s not really a programming related question here."}, {"owner": {"reputation": 648, "user_id": 3785222, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/n7dU4.jpg?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/3785222/michael"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500931153, "post_id": 45285907, "comment_id": 77542875, "body": "You seem certain this is related to security software, but that is an assumption and I&#39;m not convinced.  Why do you think this is related to security software?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500932019, "post_id": 45285907, "comment_id": 77543304, "body": "I suspect security software, because every instance of this issue coming up has been related to security software, except in the case of developers using dtrace on the process which you made no mention of. The only reason to have a <code>bsdthread_register</code> error is if <code>libSystem.dylib</code> was forced into the go process which would interfere with Go&#39;s own thread creation."}, {"owner": {"reputation": 648, "user_id": 3785222, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/n7dU4.jpg?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/3785222/michael"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1501020926, "post_id": 45285907, "comment_id": 77591220, "body": "You&#39;re right, the cylance policy on my system was causing the problem.  After upgrading to a newer version of cylance the problem was fixed."}], "owner": {"reputation": 648, "user_id": 3785222, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/n7dU4.jpg?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/3785222/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 255, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1500914633, "creation_date": 1500914633, "question_id": 45285907, "link": "https://stackoverflow.com/questions/45285907/kubectl-fatal-error-runtime-bsdthread-register-error", "title": "Kubectl: fatal error: runtime: bsdthread_register error", "body": "<p>I haven't used kubectl in about two months.  It was working well in June but now I get the following error:</p>\n\n<pre><code>$ kubectl\nfatal error: runtime: bsdthread_register error\n\nruntime stack:\nruntime.throw(0x2cb65a5, 0x21)\n    /usr/local/go/src/runtime/panic.go:596 +0x95 fp=0x7fff5fbff810 sp=0x7fff5fbff7f0\nruntime.goenvs()\n    /usr/local/go/src/runtime/os_darwin.go:108 +0xa0 fp=0x7fff5fbff840 sp=0x7fff5fbff810\nruntime.schedinit()\n    /usr/local/go/src/runtime/proc.go:486 +0xa1 fp=0x7fff5fbff880 sp=0x7fff5fbff840\nruntime.rt0_go(0x7fff5fbff8b0, 0x1, 0x7fff5fbff8b0, 0x0, 0x1, 0x7fff5fbffa38, 0x0, 0x7fff5fbffa40, 0x7fff5fbffa5c, 0x7fff5fbffa6c, ...)\n    /usr/local/go/src/runtime/asm_amd64.s:158 +0x183 fp=0x7fff5fbff888 sp=0x7fff5fbff880\n</code></pre>\n\n<p>I've read that this can be caused by websense but I don't have websense installed on my Mac.  The only thing that has changed to my knowledge was a routine update to Max OSX (10.12.6), and a routine update to gcloud (163).  </p>\n\n<p>I've tried reinstalling kubectl, gcloud, but it still fails.  As far as I can tell there is something wrong with Go, and I think Go is part of the core library included in gcloud sdk.</p>\n\n<p>Any ideas on how to troubleshoot/fix this?  I cannot connect to any of my pods due to this issue.</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1500907905, "post_id": 45283670, "comment_id": 77529733, "body": "What version of go are you using? <code>go env</code> ?"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1500908019, "post_id": 45283670, "comment_id": 77529838, "body": "@captncraig Just added the go env."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1500908095, "post_id": 45283670, "comment_id": 77529899, "body": "and <code>go version</code>? A lot of similar reports seem to recommend upgrading to go 1.8.1+"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1500908185, "post_id": 45283670, "comment_id": 77529972, "body": "go version go1.8.3 linux/amd64"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1500908612, "post_id": 45283670, "comment_id": 77530282, "body": "Though you shouldn&#39;t have to, can you try a <code>go install -a</code> for your project to make sure all your deps are re-built correctly?"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500908881, "post_id": 45283670, "comment_id": 77530457, "body": "@JimB when I run the command without <code>sudo</code>, i.e <code>$ go install -a</code> I get  <code>go install runtime&#47;internal&#47;sys: open &#47;usr&#47;local&#47;go&#47;pkg&#47;linux_amd64&#47;runtime&#47;internal&#47;sys.a: permission denied</code>. Could it be a cause of the problem?  Also note that the run command that causes singal killed is <code>go-reload -a main.go</code>. When I use <code>go build &amp;&amp; .&#47;proj</code> I do not get the <code>signal killed</code> issue."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1500908932, "post_id": 45283670, "comment_id": 77530494, "body": "Are you absolutely sure the error is in the function and not just after it returns?"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1500908973, "post_id": 45283670, "comment_id": 77530531, "body": "@MiloChristiansen No I&#39;m not sure about that."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500909050, "post_id": 45283670, "comment_id": 77530578, "body": "@Karlom: rebuild or reinstall your Go installation first. If <code>go-reload</code> is the faulty binary, you need to rebuild that too."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1500909187, "post_id": 45283670, "comment_id": 77530693, "body": "go-reload seems to be a shell script that kills the old process and starts the new one. This is almost certainly your problem, your own code is <i>probably</i> fine. See <a href=\"https://github.com/alexedwards/go-reload/blob/master/go-reload\" rel=\"nofollow noreferrer\">go-reload</a>"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500909544, "post_id": 45283670, "comment_id": 77530944, "body": "@JimB please have a look at to the result of  <code>sudo go install -a</code> which I just added to the question."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1500910172, "post_id": 45283670, "comment_id": 77531345, "body": "@Karlom: don&#39;t build things with sudo. It&#39;s easier if you can write to GOROOT as a normal user, otherwise limit the user of sudo to building the go installation. You also have either set GOROOT or have a multiple Go installations, because your GOROOT is different between the sudo command and your first command. Never set GOROOT unless you know you have to, and make sure you aren&#39;t accessing the <code>go</code> tools from multiple paths."}, {"owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "edited": false, "score": 1, "creation_date": 1500930390, "post_id": 45283670, "comment_id": 77542508, "body": "In some cases you do error check and then log error if it is exist, but do not do <code>return</code>. Don&#39;t think it is a cause of your issue, but still."}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1158, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1500909499, "creation_date": 1500907773, "last_edit_date": 1500909499, "question_id": 45283670, "link": "https://stackoverflow.com/questions/45283670/signal-killed-at-the-end-of-function", "title": "signal: killed at the end of function", "body": "<p>Using go-gin I have this function to receive posted jokes and saved them to database:</p>\n\n<pre><code>func PostJoke(c *gin.Context) {\n    var err error\n\n    userId, userName, userAvatar := shared.GetUserInfo(c)\n\n    if userId == 0 {\n        c.JSON(403, gin.H{\"error\": \"not authorized\"})\n    }\n\n    title := c.PostForm(\"title\")\n    content := c.PostForm(\"content\")\n    nsfwSt := c.PostForm(\"nsfw\")\n    nsfw, err := strconv.Atoi(nsfwSt)\n    if err != nil {\n        log.Panic(err)\n        c.JSON(http.StatusInternalServerError, gin.H{\"error\": \"internal server error\"})\n    }\n\n    file, err := c.FormFile(\"file\")\n    if err != nil {\n        log.Println(err)\n        c.String(http.StatusBadRequest, fmt.Sprintf(\"get form err: %s\", err.Error()))\n        return\n    }\n    dir, err := os.Getwd()\n    if err != nil {\n        log.Fatal(err)\n    }\n    filename := path.Join(shared.RandString(6) + path.Ext(file.Filename))\n    dest := dir + \"/media/photos/\" + filename\n    if err := c.SaveUploadedFile(file, dest); err != nil {\n        c.String(http.StatusBadRequest, fmt.Sprintf(\"upload file err: %s\", err.Error()))\n        return\n    }\n    _, err = shared.Dbmap.Exec(\"INSERT INTO joke (user_id, username, user_avatar, title, content, photo, nsfw) VALUES (?, ?, ?, ?, ?, ?, ?)\", userId, userName, userAvatar, title, content, filename, nsfw)\n    if err != nil {\n        log.Println(err)\n        c.JSON(http.StatusInternalServerError, gin.H{\"error\": \"internal server error\"})\n    }\n\n    fmt.Println(\"end of function\")\n    c.JSON(http.StatusOK, gin.H{\"sccess\": \"joke is created\"})\n\n}\n</code></pre>\n\n<p>The function works as expected: saves the data and returns <code>\"sccess\": \"joke is created\"</code>\nHowever at the end I receive this mysterious error at the terminal:</p>\n\n<pre><code>signal: killed\n</code></pre>\n\n<p>and does not respond anymore. </p>\n\n<p>I'm wondering what can cause this and how to fix it?</p>\n\n<p><strong>UPDATE:</strong> \n<code>go version go1.8.3 linux/amd64</code></p>\n\n<p>and here is my <code>go env</code>:</p>\n\n<pre><code>me@pc:~$ go env\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/me/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build842411537=/tmp/go-build -gno-record-gcc-switches\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nPKG_CONFIG=\"pkg-config\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\n</code></pre>\n\n<p>When I try to rebuild all packages using <code>sudo go install -a\n</code>, I get:</p>\n\n<pre><code>main.go:8:2: cannot find package \"github.com/gin-gonic/contrib/sessions\" in any of:\n    /usr/lib/go-1.6/src/github.com/gin-gonic/contrib/sessions (from $GOROOT)\n    ($GOPATH not set)\nmain.go:9:2: cannot find package \"github.com/gin-gonic/gin\" in any of:\n    /usr/lib/go-1.6/src/github.com/gin-gonic/gin (from $GOROOT)\n    ($GOPATH not set)\nmain.go:4:2: cannot find package \"proj/controller\" in any of:\n    /usr/lib/go-1.6/src/proj/controller (from $GOROOT)\n    ($GOPATH not set)\nmain.go:5:2: cannot find package \"proj/middleware\" in any of:\n    /usr/lib/go-1.6/src/proj/middleware (from $GOROOT)\n    ($GOPATH not set)\n</code></pre>\n"}, {"tags": ["go", "google-bigquery", "google-cloud-platform"], "answers": [{"comments": [{"owner": {"reputation": 6798, "user_id": 3282434, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/bd87b9229901acfa4c6f754da6bf3655?s=128&d=identicon&r=PG&f=1", "display_name": "codyc4321", "link": "https://stackoverflow.com/users/3282434/codyc4321"}, "edited": false, "score": 0, "creation_date": 1500907365, "post_id": 45283308, "comment_id": 77529340, "body": "I&#39;m calling it from a python script, and it&#39;ll normally run as part of a flask app. I put that setting in my bash_profile and it still isn&#39;t working. Do you know why Go clients can&#39;t find that setting in your bash_profile? I&#39;ve sourced my terminal and no help"}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "reply_to_user": {"reputation": 6798, "user_id": 3282434, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/bd87b9229901acfa4c6f754da6bf3655?s=128&d=identicon&r=PG&f=1", "display_name": "codyc4321", "link": "https://stackoverflow.com/users/3282434/codyc4321"}, "edited": false, "score": 1, "creation_date": 1500907617, "post_id": 45283308, "comment_id": 77529532, "body": "Your bash profile is normally only applied when you start a bash shell. No application that&#39;s ran outside a shell session could access any declared variables. Use the <code>&#47;etc&#47;profile.d</code> directory (or <code>&#47;etc&#47;profile</code>) if you want to make environmental variables available to all processes.  Does it work if you run the Go application and explicitly set the environmental variable as per the example above?"}, {"owner": {"reputation": 6798, "user_id": 3282434, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/bd87b9229901acfa4c6f754da6bf3655?s=128&d=identicon&r=PG&f=1", "display_name": "codyc4321", "link": "https://stackoverflow.com/users/3282434/codyc4321"}, "edited": false, "score": 0, "creation_date": 1500907961, "post_id": 45283308, "comment_id": 77529791, "body": "ya it works like that. putting it in /etc/profile doesnt help either, I can open a different question about the config"}], "tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": true, "score": 1, "last_activity_date": 1500906851, "creation_date": 1500906851, "answer_id": 45283308, "question_id": 45282854, "link": "https://stackoverflow.com/questions/45282854/pass-service-account-keyfile-to-go-bigquery-client/45283308#45283308", "title": "Pass service account keyfile to go bigquery client", "body": "<p>You need to create a service account in your project and furnish a new JSON private key. </p>\n\n<p>Then ensure that the <code>GOOGLE_APPLICATION_CREDENTIALS</code> environmental variable is set to the full path of this file. For example, on Linux:</p>\n\n<pre><code>GOOGLE_APPLICATION_CREDENTIALS=/home/user/Downloads/key.json go run main.go\n</code></pre>\n\n<p>As an aside, it is best practice to make sure you protect access to this private key file and ensure the service account has the minimum privileges required to perform its role.</p>\n"}], "owner": {"reputation": 6798, "user_id": 3282434, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/bd87b9229901acfa4c6f754da6bf3655?s=128&d=identicon&r=PG&f=1", "display_name": "codyc4321", "link": "https://stackoverflow.com/users/3282434/codyc4321"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 45283308, "answer_count": 1, "score": 0, "last_activity_date": 1555537190, "creation_date": 1500905599, "last_edit_date": 1555537190, "question_id": 45282854, "link": "https://stackoverflow.com/questions/45282854/pass-service-account-keyfile-to-go-bigquery-client", "title": "Pass service account keyfile to go bigquery client", "body": "<p>I am trying to use service account with go bigquery client. For some reason, there's no Go example of how to pass a service file in when you make a client. I see here <a href=\"https://cloud.google.com/docs/authentication/production\" rel=\"nofollow noreferrer\">https://cloud.google.com/docs/authentication/production</a> but this pattern doesn't follow anything shown. It also isn't shown at <a href=\"https://godoc.org/cloud.google.com/go/bigquery\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/bigquery</a></p>\n\n<p>I have</p>\n\n<pre><code>//bigquery_caller.go\npackage main\n\nimport \"C\"\nimport \"fmt\"\nimport \"cloud.google.com/go/bigquery\"\nimport \"golang.org/x/net/context\"\n\n\nfunc main() {\n    ctx := context.Background()\n    client, err := bigquery.NewClient(ctx, \"project-name\")\n    if err != nil {\n        fmt.Println(\"Had an error\")\n    }\n\n    q := client.Query(`\n        select * from mytables\n    `)\n\n    it, err := q.Read(ctx)\n\n    fmt.Println(it)\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>The code works, I get</p>\n\n<pre><code>googleapi: Error 403: Access Denied: Project project-name:\n</code></pre>\n\n<p>How can I pass a service key file in to go client? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1500908709, "post_id": 45282661, "comment_id": 77530339, "body": "For this situation I generally pass an <code>unsafe.Pointer</code>. This works, but you had better make sure to do sanity and error checking!"}], "tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": true, "score": 3, "last_activity_date": 1500904954, "creation_date": 1500904954, "answer_id": 45282661, "question_id": 45282409, "link": "https://stackoverflow.com/questions/45282409/how-do-i-pass-c-objects-between-go-packages/45282661#45282661", "title": "How do I pass C objects between go packages?", "body": "<p>Unfortunately you can't pass C types between packages. You'll need to perform any necessary type conversions within the package that is importing the C types. As per the <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>Cgo translates C types into equivalent unexported Go types. Because\n  the translations are unexported, a Go package should not expose C\n  types in its exported API: a C type used in one Go package is\n  different from the same C type used in another.</p>\n</blockquote>\n\n<p>If you have common C translation methods that you use, consider using <code>go generate</code> with a helper script to create these in each package where it is required from a master source file. Not as nice as solution as having a common library but much better than manually updating files in multiple packages. </p>\n"}], "owner": {"reputation": 6583, "user_id": 931721, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7890aab3c851571d48e6c4f7459f187f?s=128&d=identicon&r=PG&f=1", "display_name": "Jakob Weisblat", "link": "https://stackoverflow.com/users/931721/jakob-weisblat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 45282661, "answer_count": 1, "score": 0, "last_activity_date": 1500904954, "creation_date": 1500904218, "question_id": 45282409, "link": "https://stackoverflow.com/questions/45282409/how-do-i-pass-c-objects-between-go-packages", "title": "How do I pass C objects between go packages?", "body": "<p>When I try to pass a C.int from package <code>main</code> to a function in a helper package called <code>common</code>, I get the following error:</p>\n\n<pre><code>main.go:24: cannot use argc (type C.int) as type common.C.int in argument to common.GoStrings\n</code></pre>\n\n<p>From <code>common.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>/* \n    ...\n*/\nimport \"C\"\n\n...\n\nfunc GoStrings(argc C.int, argv **C.char) (args []string) {\n    // do stuff\n}\n</code></pre>\n\n<p>From <code>main.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>/*\n#cgo LDFLAGS: -lpam -fPIC\n#define PAM_SM_AUTH\n\n#include &lt;security/pam_appl.h&gt;\n*/\nimport \"C\"\n\n...\n\nfunc pam_sm_authenticate(pamh *C.pam_handle_t, flags, argc C.int, argv **C.char) C.int {\n    args := common.GoStrings(argc, argv)\n    ...\n}\n</code></pre>\n\n<p>Is there any way to pass these objects back and forth? I've tried type casting to e.g. <code>common.C.int</code>, but that doesn't seem to be valid syntax. I'd like to be able to call <code>GoStrings</code> from multiple different main programs, and it seems like that should be allowable.</p>\n"}, {"tags": ["go", "ibm-cloud", "blockchain", "hyperledger-fabric"], "answers": [{"comments": [{"owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "edited": false, "score": 0, "creation_date": 1500971143, "post_id": 45287427, "comment_id": 77557098, "body": "Thanks for the response. Planning to do an implementation with the iteration over a rang of blocks. But in this case I am getting the encrypted payload. How to decrypt the key value pairs from them. I have gone through the post <a href=\"https://stackoverflow.com/questions/38617428/decrypting-the-payload-in-hyperledger\" title=\"decrypting the payload in hyperledger\">stackoverflow.com/questions/38617428/&hellip;</a>, but still I am getting only the decrypted value. How can I get its key. Or is there any workaround to meet the requirement mentioned in this post."}], "tags": [], "owner": {"reputation": 3951, "user_id": 4774061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-ysO29qIyHS0/AAAAAAAAAAI/AAAAAAAAAZg/dKLJ5RtsR48/photo.jpg?sz=128", "display_name": "christo4ferris", "link": "https://stackoverflow.com/users/4774061/christo4ferris"}, "is_accepted": true, "score": 1, "last_activity_date": 1500920327, "creation_date": 1500920327, "answer_id": 45287427, "question_id": 45280079, "link": "https://stackoverflow.com/questions/45280079/how-to-query-states-for-a-period-of-time-in-hyperledger-fabric-v0-6-chaincode-im/45287427#45287427", "title": "how to query states for a period of time in hyperledger fabric v0.6 chaincode implementation", "body": "<p>The v0.6 implementation of Hyperledger Fabric does not include such function. The Hyperledger community recently published v1.0.0 of Hyperledger Fabric, which will also soon be available on IBM Bluemix that increases the capabilities of chaincode and the ledger. However, it does not to my knowledge provide a means of querying the ledger within a range of dates. It does provide a means of iterating over a range of blocks given a starting and ending keys.</p>\n"}], "owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 0, "accepted_answer_id": 45287427, "answer_count": 1, "score": 0, "last_activity_date": 1500920327, "creation_date": 1500897583, "last_edit_date": 1500908553, "question_id": 45280079, "link": "https://stackoverflow.com/questions/45280079/how-to-query-states-for-a-period-of-time-in-hyperledger-fabric-v0-6-chaincode-im", "title": "how to query states for a period of time in hyperledger fabric v0.6 chaincode implementation", "body": "<p>I am using the Hyperledger fabric V0.6 service in IBM-bluemix and deployed my go language chaincode to the peer as provided in the bluemix documentation.\nSince I am very new to this implementation, I could find only the <strong>PutState</strong> and <strong>GetState</strong> methods there in <a href=\"https://github.com/hyperledger/fabric/tree/v0.6/core/chaincode/shim\" rel=\"nofollow noreferrer\"><strong>ChaincodeStubInterface</strong></a>.<br/>\nBut my requirement is to query the states for a period of time.<br/>\neg:<br/>\n11-Feb-2017 10:00:00 : created Asset1<br/>\n11-Feb-2017 12:00:00 : created Asset2<br/>\n12-Feb-2017 10:00:00 : Modified Asset1<br/>\n13-Feb-2017 13:00:00 : Created Asset3<br/>\n....<br/>\n15-Feb-2017 14:00:00 : Created AssetN<br/></p>\n\n<p>Now I want to query the states for the range 12-Feb-2017 00:00:00 to current timestamp. I have gone through lots of documentations but I didn't find any solution for this.</p>\n\n<p>How can I get this data?\nThanks in advance. </p>\n"}, {"tags": ["go", "elf"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1500903863, "post_id": 45279385, "comment_id": 77526939, "body": "BTW, that issue about strip is very old, and no longer relevant. The generally accepted solution for <i>any</i> toolchain is to build the executable in a temporary or generic build path."}], "answers": [{"tags": [], "owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "is_accepted": true, "score": 10, "last_activity_date": 1500983409, "creation_date": 1500983409, "answer_id": 45302415, "question_id": 45279385, "link": "https://stackoverflow.com/questions/45279385/remove-file-paths-from-text-directives-in-go-binaries/45302415#45302415", "title": "Remove file paths from TEXT directives in go binaries", "body": "<p><strong>Use -trimpath flags to remove path information:</strong></p>\n\n<pre><code>CGO_ENABLED=0 go build -v -a -ldflags=\"-w -s\" \\\n    -gcflags=-trimpath=/Users/myuser/dev/go/src \\\n    -asmflags=-trimpath=/Users/myuser/dev/go/src \\\n    -o ./fooapi spikes/mongoapi.go\n</code></pre>\n\n<hr>\n\n<p><strong>More Information:</strong></p>\n\n<p>Passing <code>-trimpath</code> to <code>-gcflags</code> and <code>-asmflags</code> will remove any path information from the elf binary.</p>\n\n<pre><code>$ go tool asm -help 2&gt;&amp;1 | grep -A1 trimpath\n-trimpath string\n    remove prefix from recorded source file paths\n\n$ go tool compile -help|grep -A1 trimpath\n-trimpath string\n    remove prefix from recorded source file paths\n</code></pre>\n\n<p><strong>You can check the result with <code>go tool objdump</code>:</strong></p>\n\n<pre><code>$ go tool objdump ./fooapi\n.\n.\nTEXT main.init(SB) api/spikes/mongoapi.go\nmongoapi.go:60  0x12768c0   65488b0c25a0080000  GS MOVQ GS:0x8a0, CX\nmongoapi.go:60  0x12768c9   483b6110        CMPQ 0x10(CX), SP\nmongoapi.go:60  0x12768cd   7663            JBE 0x1276932\n.\n.\n</code></pre>\n\n<hr>\n\n<p>Using <code>strip</code> tool has still some controversies in go community, although it's been said that it's been fixed. Some say that unknown and unpredictable bugs occur sometimes. Read <a href=\"https://github.com/moby/moby/blob/2a95488f7843a773de2b541a47d9b971a635bfff/project/PACKAGERS.md#stripping-binaries\" rel=\"noreferrer\">here</a> and <a href=\"https://go-review.googlesource.com/c/20584/3\" rel=\"noreferrer\">here</a> for examples.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 3, "last_activity_date": 1556741539, "creation_date": 1556741539, "answer_id": 55942148, "question_id": 45279385, "link": "https://stackoverflow.com/questions/45279385/remove-file-paths-from-text-directives-in-go-binaries/55942148#55942148", "title": "Remove file paths from TEXT directives in go binaries", "body": "<p><code>trimpath</code> is a good approach, but had issues like <a href=\"https://github.com/golang/go/issues/24976#issuecomment-439189276\" rel=\"nofollow noreferrer\">go issue 24976</a></p>\n\n<blockquote>\n  <p>It appears that, when multiple <code>-trimpath</code> flags are passed to go tool compile, the last one wins</p>\n  \n  <p>Indeed; from what I can tell the <code>trimpath</code> flag is defined as an ordinary string flag, not a list.</p>\n</blockquote>\n\n<p>But with <a href=\"https://go-review.googlesource.com/c/go/+/173344/\" rel=\"nofollow noreferrer\">CL 173344</a>, this is now fixed (for the upcoming Go 1.13)</p>\n\n<blockquote>\n  <h2>cmd/internal/objabi: expand -trimpath syntax</h2>\n  \n  <p>This CL affects the low-level <code>-trimpath</code> flag provided\n  by both <code>cmd/asm</code> and <code>cmd/compile</code>.  </p>\n  \n  <p>Previously, the flag took the name of a single directory that would be trimmed\n  from recorded paths in the resulting object file.</p>\n  \n  <p>This CL <strong>makes the flag take a semicolon-separated list of paths</strong>.</p>\n  \n  <p>Further, each path can now end in an optional \"<code>=&gt;replacement</code>\"\n  to specify what to replace that leading path prefix with,\n  instead of only dropping it.</p>\n  \n  <p>A followup CL will add a mode to <code>cmd/go</code> that uses this\n  richer <code>-trimpath</code> to build binaries that do not contain any\n  local path names.</p>\n</blockquote>\n\n<p>This is <a href=\"https://go-review.googlesource.com/c/go/+/173345/\" rel=\"nofollow noreferrer\">CL 173345</a>:</p>\n\n<blockquote>\n  <h2><code>cmd/go</code>: add <code>-trimpath</code> build flag</h2>\n  \n  <p>\"<code>go build -trimpath</code>\" trims the recorded file paths in the resulting packages and executables to avoid recording the names of any local directories.<br>\n  Instead, the files appear to be stored in directories named either \"<code>go/src/...</code>\" (for the standard library) or named after the module or package in which the files appear.</p>\n</blockquote>\n\n<p>This fixes <a href=\"https://github.com/golang/go/issues/16860\" rel=\"nofollow noreferrer\">issue 16860</a>, which is about Go ability to  generate bit-for-bit identical binaries, as noted by <a href=\"https://twitter.com/idanyliuk/status/1123512636795236352\" rel=\"nofollow noreferrer\"><strong>Ivan Daniluk</strong></a>.</p>\n"}], "owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4146, "favorite_count": 7, "accepted_answer_id": 45302415, "answer_count": 2, "score": 14, "last_activity_date": 1556741539, "creation_date": 1500895506, "last_edit_date": 1500983745, "question_id": 45279385, "link": "https://stackoverflow.com/questions/45279385/remove-file-paths-from-text-directives-in-go-binaries", "title": "Remove file paths from TEXT directives in go binaries", "body": "<p>I want to <strong>remove</strong> all path information like <code>/Users/myuser/dev/go/src/fooapi/spikes/mongoapi.go</code> from the executable that I created with <code>go build</code>.</p>\n\n<p><strong>I'm compiling the code like this:</strong></p>\n\n<p><code>CGO_ENABLED=0 go build -v -a -ldflags=\"-w -s\" -o ./fooapi spikes/mongoapi.go</code></p>\n\n<p><strong>Some part of the example assembly from the go build command above:</strong></p>\n\n<pre><code>$ go tool objdump ./fooapi\n.\n.\nTEXT main.init(SB) /Users/myuser/dev/go/src/api/spikes/mongoapi.go\nmongoapi.go:60  0x12768c0   65488b0c25a0080000  GS MOVQ GS:0x8a0, CX\nmongoapi.go:60  0x12768c9   483b6110        CMPQ 0x10(CX), SP\nmongoapi.go:60  0x12768cd   7663            JBE 0x1276932\n.\n.\n</code></pre>\n\n<hr>\n\n<p>Note that: <code>strip</code> is not recommended and <a href=\"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=717172\" rel=\"noreferrer\">can lead to broken executables</a> if you're going to recommend it as a solution.</p>\n"}, {"tags": ["go", "redis"], "answers": [{"tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": true, "score": 1, "last_activity_date": 1500896236, "last_edit_date": 1500896236, "creation_date": 1500895008, "answer_id": 45279233, "question_id": 45278840, "link": "https://stackoverflow.com/questions/45278840/too-many-arguments-in-call/45279233#45279233", "title": "Too many arguments in call", "body": "<p>In Go you can use a slice for a variadic parameter. However, the slice must contain all the parameters you need to pass to the function. You cannot expand a slice and pass additional parameters as well.</p>\n\n<p>Hence your code should be something like:</p>\n\n<pre><code>args := make([]interface{}, 0, len(e.MapData) * 2 + 1)\nargs = append(args, e.Key)\nfor k, v := range e.MapData {\n    args = append(args, k, v)\n}\n_,err := redis.StringMap(client.Do(\"HMSET\", args...))\n</code></pre>\n"}], "owner": {"reputation": 255, "user_id": 7923318, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/da82868718b98cbd509e4a58f5b95d6c?s=128&d=identicon&r=PG&f=1", "display_name": "Marek", "link": "https://stackoverflow.com/users/7923318/marek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2575, "favorite_count": 0, "accepted_answer_id": 45279233, "answer_count": 1, "score": 1, "last_activity_date": 1500900487, "creation_date": 1500893911, "last_edit_date": 1500900487, "question_id": 45278840, "link": "https://stackoverflow.com/questions/45278840/too-many-arguments-in-call", "title": "Too many arguments in call", "body": "<p>I'm trying to load db data to redis cluster using <a href=\"https://stackoverflow.com/questions/45240642/error-unknown-type-go\">mysql2redis</a>.</p>\n\n<p>When i try the accepted solution, i.e., </p>\n\n<pre><code>} else if e.Command == \"HMSET\" {\n    // Build up a string slice to hold the key value pairs\n    args := make([]string, 0, len(e.MapData) * 2)\n    for k, v := range e.MapData {\n        args = append(args, k, v)\n    }\n    _,err := redis.StringMap(client.Do(\"HMSET\", e.Key, args...))\n    checkErr(err, \"hmset error:\")\n}\n</code></pre>\n\n<p>I get following exception, </p>\n\n<pre><code>too many arguments in call to client.Do\n    have (string, string, []string...)\n    want (string, ...interface {})\n</code></pre>\n\n<p>I'm a newbie when it comes to Go. So can the Go veterans take a look at this and suggest a solution?</p>\n"}, {"tags": ["go", "init"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 16, "last_activity_date": 1605008935, "last_edit_date": 1605008935, "creation_date": 1500893668, "answer_id": 45278760, "question_id": 45278540, "link": "https://stackoverflow.com/questions/45278540/whats-the-purpose-of-golang-allowing-multiple-init-in-one-package/45278760#45278760", "title": "What&#39;s the purpose of golang allowing multiple init in one package?", "body": "<p>This question may be somewhat opinion based, but using multiple package <code>init()</code> functions can make your code easier to read and maintain.</p>\n<p>If your source files are large, usually you arrange their content (e.g. types, variable declarations, methods etc.) in some logical order. Allowance of multiple <code>init()</code> functions gives you the possibility to put initialization code near to the parts they ought to initialize. If this would not be allowed, you would be forced to use a single <code>init()</code> function per package, and put everything in it, far from the variables they need to initialize.</p>\n<p>Yes, having multiple <code>init()</code> functions may require some care regarding the execution order, but know that using multiple <code>init()</code> functions is not a requirement, it's just a possibility. And you can write <code>init()</code> functions to not have &quot;side&quot; effects, to not rely on the completion of other <code>init()</code> functions.</p>\n<p>If that is unavoidable, you can create one &quot;master&quot; <code>init()</code> which explicitly controls the order of other, &quot;child&quot; <code>init()</code> functions.</p>\n<p>An example of a &quot;master&quot; <code>init()</code> controlling other initialization functions:</p>\n<pre><code>func init() {\n    initA()\n    initB()\n}\n\nfunc initA() {}\nfunc initB() {}\n</code></pre>\n<p>In the above example, <code>initA()</code> will always run before <code>initB()</code>.</p>\n<p>Relevant section from spec: <a href=\"https://golang.org/ref/spec#Program_initialization_and_execution\" rel=\"nofollow noreferrer\">Package initialization</a>.</p>\n<p>Also see related question: <a href=\"https://stackoverflow.com/questions/31650965/what-does-lexical-file-name-order-mean/31651094#31651094\">What does lexical file name order mean?</a></p>\n"}, {"comments": [{"owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 1, "creation_date": 1610962717, "post_id": 57273029, "comment_id": 116288730, "body": "You should probably have the <code>AddCommand</code> call in the first file also in a <code>init</code> function to showcase multiple inits, which is what this question is about. And also, deduplicating the commands you add there (either by removing the second or changing 1 to 2) would also be nice. I liked your usecase though."}, {"owner": {"reputation": 6112, "user_id": 13075, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/7Cove.jpg?s=128&g=1", "display_name": "Henrik Aasted S&#248;rensen", "link": "https://stackoverflow.com/users/13075/henrik-aasted-s%c3%b8rensen"}, "reply_to_user": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 0, "creation_date": 1610965290, "post_id": 57273029, "comment_id": 116289776, "body": "@Adirio : Nice suggestion, that would provide a bit more symmetry. Don&#39;t have an IDE handy to check the change, though, so it&#39;ll have to wait a bit. :)"}], "tags": [], "owner": {"reputation": 6112, "user_id": 13075, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/7Cove.jpg?s=128&g=1", "display_name": "Henrik Aasted S&#248;rensen", "link": "https://stackoverflow.com/users/13075/henrik-aasted-s%c3%b8rensen"}, "is_accepted": false, "score": 3, "last_activity_date": 1610970495, "last_edit_date": 1610970495, "creation_date": 1564493654, "answer_id": 57273029, "question_id": 45278540, "link": "https://stackoverflow.com/questions/45278540/whats-the-purpose-of-golang-allowing-multiple-init-in-one-package/57273029#57273029", "title": "What&#39;s the purpose of golang allowing multiple init in one package?", "body": "<p>Another use case for multiple <code>init()</code> functions is adding functionality based on build tags. The <code>init()</code> function can be used to add hooks into the existing package and extend its functionality.</p>\n<p>The following is a condensed example demonstrating the addition of more commands to a CLI utility based on build tags.</p>\n<pre><code>package main\n\nimport &quot;github.com/spf13/cobra&quot;\n\nvar (\n    rootCmd = &amp;cobra.Command{Use: &quot;foo&quot;, Short: &quot;foo&quot;}\n)\n\nfunc init() {\n    rootCmd.AddCommand(\n        &amp;cobra.Command{Use: &quot;CMD1&quot;, Short: &quot;Command1&quot;},\n        &amp;cobra.Command{Use: &quot;CMD2&quot;, Short: &quot;Command2&quot;},\n    )\n}\n\nfunc main() {\n    rootCmd.Execute()\n}\n</code></pre>\n<p>The above is the &quot;vanilla&quot; version of the utility.</p>\n<pre><code>// +build debugcommands\n\npackage main\n\nimport &quot;github.com/spf13/cobra&quot;\n\nfunc init() {\n    rootCmd.AddCommand(&amp;cobra.Command{Use: &quot;DEBUG-CMD1&quot;, Short: &quot;Debug command1&quot;})\n}\n</code></pre>\n<p>The contents of the second file extends the standard command with additional commands that are mostly relevant during development.</p>\n<p>Compiling using <code>go build -tags debugcommands</code> will produce a binary with the added commands, while omitting the <code>-tags</code> flag will produce a standard version.</p>\n"}], "owner": {"reputation": 535, "user_id": 7300655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Watfr.jpg?s=128&g=1", "display_name": "harrycmfan", "link": "https://stackoverflow.com/users/7300655/harrycmfan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5072, "favorite_count": 4, "accepted_answer_id": 45278760, "answer_count": 2, "score": 17, "last_activity_date": 1610970495, "creation_date": 1500893079, "question_id": 45278540, "link": "https://stackoverflow.com/questions/45278540/whats-the-purpose-of-golang-allowing-multiple-init-in-one-package", "title": "What&#39;s the purpose of golang allowing multiple init in one package?", "body": "<p>I know that golang allows multiple init in one package and even in one file.\nI am wondering why? \nFor example, if a pkg has many files, we could write multiple init then we could get lost in where to we should put init, and we could be also confused about the init order if we have multiple init in one pkg. (I mean is this better? we can only have 1 init, then we can have some initXXX, then put them into init, it seems quite clean.)\nWhat's the advantage of doing this in code struct view?</p>\n"}, {"tags": ["go", "go-gorm", "cockroachdb"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 8356567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f1679c9dcd146266fcca822166dd21e?s=128&d=identicon&r=PG&f=1", "display_name": "1tree", "link": "https://stackoverflow.com/users/8356567/1tree"}, "edited": false, "score": 0, "creation_date": 1500913303, "post_id": 45283344, "comment_id": 77533262, "body": "exactly what I am confused with. I have not defined any field named <code>DeletedAt</code> nor I&#39;m using <code>gorm.Model</code>. I have only defined one <code>Report struct</code> and wrapped gorm under <code>httprouter</code> to insert and query each.  <code>db.create</code> works fine. using error function in <code>db.Find</code> returns <code>record not found</code>. Btw I derived my code closely based on example-orm package provided by cockroachlabs."}, {"owner": {"reputation": 43, "user_id": 8356567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f1679c9dcd146266fcca822166dd21e?s=128&d=identicon&r=PG&f=1", "display_name": "1tree", "link": "https://stackoverflow.com/users/8356567/1tree"}, "edited": false, "score": 0, "creation_date": 1500920312, "post_id": 45283344, "comment_id": 77537204, "body": "I tried again but could not figure out the problem. Examples provided as <b>Query With Where (Struct &amp; Map)</b> in GORM&#39;s documentation also did not work. Meanwhile, I went with GORM&#39;s raw query as <code>db.Raw(&quot;SELECT * FROM reports&quot;).Scan(&amp;report)</code> and only this seems to work at the moment."}], "tags": [], "owner": {"reputation": 20703, "user_id": 2805033, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TasHL.jpg?s=128&g=1", "display_name": "Ben Darnell", "link": "https://stackoverflow.com/users/2805033/ben-darnell"}, "is_accepted": false, "score": 2, "last_activity_date": 1500906953, "creation_date": 1500906953, "answer_id": 45283344, "question_id": 45276775, "link": "https://stackoverflow.com/questions/45276775/db-query-commands-are-producing-strange-sql-queries/45283344#45283344", "title": "DB Query Commands are producing strange sql queries", "body": "<p>The <code>deleted_at</code> column is a part of GORM's <a href=\"http://jinzhu.me/gorm/models.html#conventions\" rel=\"nofollow noreferrer\">base <code>gorm.Model</code></a> struct and its <a href=\"http://jinzhu.me/gorm/crud.html#delete\" rel=\"nofollow noreferrer\">soft delete</a> feature. Are you using <code>gorm.Model</code> somewhere that we can't see in this example? This isn't supposed to happen unless you either define a field named <code>DeletedAt</code> or embed a <code>gorm.Model</code> in your model struct. </p>\n"}, {"tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": false, "score": 1, "last_activity_date": 1567009595, "creation_date": 1567009595, "answer_id": 57696611, "question_id": 45276775, "link": "https://stackoverflow.com/questions/45276775/db-query-commands-are-producing-strange-sql-queries/57696611#57696611", "title": "DB Query Commands are producing strange sql queries", "body": "<p>Since the model has the field deleted_at, gorm is using the <strong>soft delete ability</strong> automatically. You can use <code>Unscoped</code></p>\n\n<pre><code> db.Unscoped().Find(&amp;reports)\n</code></pre>\n\n<p>Which is the same as running the raw query</p>\n\n<pre><code>db.Raw(\"SELECT * FROM reports\").Scan(&amp;reports)\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 8356567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f1679c9dcd146266fcca822166dd21e?s=128&d=identicon&r=PG&f=1", "display_name": "1tree", "link": "https://stackoverflow.com/users/8356567/1tree"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 798, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1567009595, "creation_date": 1500888132, "last_edit_date": 1527756696, "question_id": 45276775, "link": "https://stackoverflow.com/questions/45276775/db-query-commands-are-producing-strange-sql-queries", "title": "DB Query Commands are producing strange sql queries", "body": "<p>I have my model as: </p>\n\n<pre><code>type Report struct {\n    ID    int     `json:\"id,omitempty\" gorm:\"primary_key\"`\n    Title *string `json:\"title\" gorm:\"not null\"`\n}\n</code></pre>\n\n<p>I have initialized variable <code>report</code> as <code>var report Report</code> I have successfully auto migrated this model as database table and have populated database as <code>sql INSERT</code> using GORM's <code>db.Create(&amp;report)</code>.</p>\n\n<p>The problem I am facing is while trying query commands. Every query commands supported by GORM such as <code>db.Find(&amp;report)</code> , <code>db.First(&amp;report, 1)</code> is resulting to queries such as folows: </p>\n\n<pre><code>SELECT * FROM \"reports\"  WHERE \"reports\".\"deleted_at\" IS NULL AND ((id = $1))\nSELECT * FROM \"reports\"  WHERE \"reports\".\"deleted_at\" IS NULL AND ((id = $1))\nSELECT * FROM reports WHERE (reports.deleted_at IS NULL) AND ((id = $1))\nSELECT * FROM reports WHERE (reports.deleted_at IS NULL) AND ((id = $1))\nSELECT 0 done\n</code></pre>\n\n<p>I am unable to query database. I am using GORM with cockroach db. This works fine when using GO pq driver and raw sql commands.</p>\n"}, {"tags": ["go", "ssh", "connection"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888180, "post_id": 45276754, "comment_id": 77515867, "body": "Yes. But I want to do something else when it doesn&#39;t work."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888198, "post_id": 45276754, "comment_id": 77515880, "body": "@user6942447 Great. So then do that, based on the error you receive."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888228, "post_id": 45276754, "comment_id": 77515897, "body": "<code>Do you know how I can solve this issue?</code> -- what issue?"}, {"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888233, "post_id": 45276754, "comment_id": 77515905, "body": "No. I really need that."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 2, "creation_date": 1500888248, "post_id": 45276754, "comment_id": 77515911, "body": "You really need what?"}, {"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888263, "post_id": 45276754, "comment_id": 77515922, "body": "The issue is that I do not know if the server is online. If not it would change/switch to another one"}, {"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888291, "post_id": 45276754, "comment_id": 77515941, "body": "I really need to check if the <code>randomServer</code> is reachable."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 2, "creation_date": 1500888306, "post_id": 45276754, "comment_id": 77515951, "body": "yes. The way to check that <i>is by connecting to it</i>."}, {"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888321, "post_id": 45276754, "comment_id": 77515967, "body": "Yes but how can I do that in the if clause"}, {"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888335, "post_id": 45276754, "comment_id": 77515976, "body": "I think we mean the same thing."}, {"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888380, "post_id": 45276754, "comment_id": 77516006, "body": "I want to know if the server is reachable and else to move on with another one. I do not know how to check if it is."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 1, "creation_date": 1500888406, "post_id": 45276754, "comment_id": 77516033, "body": "If you get an error when trying to connect, then the server isn&#39;t reachable."}, {"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888438, "post_id": 45276754, "comment_id": 77516062, "body": "I know. But how can I check that? You are really not helpful right now"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 1, "creation_date": 1500888449, "post_id": 45276754, "comment_id": 77516069, "body": "How can you check what? You are not asking good questions right now."}, {"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888504, "post_id": 45276754, "comment_id": 77516115, "body": "For the error. Look:   if serverIsReachable {   do something else {"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888584, "post_id": 45276754, "comment_id": 77516161, "body": "When you attempt <i>any</i> network connection in Go, as with most method calls, you&#39;ll get an error. Check if that error is nil:  <code>if err != nil { &#47;&#47; connection failed so do something else }</code>"}, {"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888744, "post_id": 45276754, "comment_id": 77516277, "body": "No. It doesn&#39;t work. I establish the connection in a different file"}, {"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888830, "post_id": 45276754, "comment_id": 77516321, "body": "okay. this is how i am establishing a connection (will edit question) and I will not be able to check for an error in the main function/file."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888909, "post_id": 45276754, "comment_id": 77516390, "body": "You&#39;re already checking for errors... I don&#39;t know what else you want."}, {"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888965, "post_id": 45276754, "comment_id": 77516429, "body": "yes. but it will stop then. how can i filter that in my main file?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500888991, "post_id": 45276754, "comment_id": 77516445, "body": "filter what? I don&#39;t know what that means.  If you don&#39;t want your program to stop when it encounters an error, then make it do something else. That&#39;s up to you."}, {"owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500889063, "post_id": 45276754, "comment_id": 77516509, "body": "I need to know in my main file if the connection can be established. How can I do that. That is what i need"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500889089, "post_id": 45276754, "comment_id": 77516526, "body": "Check the error. If you got an error, <i>the connection could not be established</i>. It&#39;s as simple as that."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "edited": false, "score": 0, "creation_date": 1500889184, "post_id": 45276754, "comment_id": 77516586, "body": "If you want to know more about <i>why</i> the connection could not be established, examine the error value directly. You may get an <a href=\"https://golang.org/pkg/net/#AddrError\" rel=\"nofollow noreferrer\">AddrError</a> indicating that the address is wrong, a <a href=\"https://golang.org/pkg/net/#DNSError\" rel=\"nofollow noreferrer\">DNS Error</a> indicating a problem doing DNS lookups, or any number of other error types which give you specific info."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1500892549, "last_edit_date": 1500892549, "creation_date": 1500888080, "answer_id": 45276754, "question_id": 45276599, "link": "https://stackoverflow.com/questions/45276599/check-for-network-connection/45276754#45276754", "title": "Check for Network Connection", "body": "<blockquote>\n  <p>How can I check if I am able to connect to a server via ssh before running a program on it?</p>\n</blockquote>\n\n<p>Don't.</p>\n\n<p>Just attempt the connection. If it doesn't work, you'll get an error. Based on that error, you can do whatever you want--retry the connection, try another server, exit the program, or make toast.</p>\n\n<p>If you were to use the standard SSH library, for instance it would look something like this:</p>\n\n<pre><code>cli := ssh.NewClient( ... )\nconn, err := cli.Dial( ... )\nif err != nil {\n    // The connection failed, so do something else\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1500892549, "creation_date": 1500887638, "last_edit_date": 1500890074, "question_id": 45276599, "link": "https://stackoverflow.com/questions/45276599/check-for-network-connection", "title": "Check for Network Connection", "body": "<p>How can I check if I am able to connect to a server via ssh before running a program on it? </p>\n\n<p>This is how I am connecting to a server:\n<code>cli := ssh.NewSSHClient(conf.User, randomServer)</code></p>\n\n<p>and I would like to either use switch or an if statement like:</p>\n\n<pre><code>switch cli := ssh.NewSSHClient(conf.User, randomServer) {\ncase successful:\n    fmt.Println(\"Good morning!\")\ncase fail:\n    fmt.Println(\"Good afternoon.\")\n}\n</code></pre>\n\n<p>establish connection:</p>\n\n<pre><code>func NewSSHClient(user string, hostname string) *SSHClient{\n  sock, err := net.Dial(\"unix\", os.Getenv(\"SSH_AUTH_SOCK\"))\n  if err != nil {\n    logrus.Fatal(err)\n  }\n\n  agent := agent.NewClient(sock)\n  signers, err := agent.Signers()\n  if err != nil {\n    logrus.Fatal(err)\n  }\n  auths := []ssh.AuthMethod{ssh.PublicKeys(signers...)}\n  cfg := &amp;ssh.ClientConfig{\n    User: user,\n    Auth: auths,\n    HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n\n  }\n  cfg.SetDefaults()\n\n  return &amp;SSHClient{\n    User: user,\n    Hostname: hostname,\n    Config: cfg,\n  }\n}\n\n// Use one connection per command.\n// Catch in the client when required.\nfunc (cli *SSHClient)ExecuteCmd(command string){\n  conn, err := ssh.Dial(\"tcp\", cli.Hostname+\":22\", cli.Config)\n  if err!=nil {\n    logrus.Infof(\"%s@%s\", cli.Config.User, cli.Hostname)\n    logrus.Info(\"Hint: Add you key to the ssh agent: 'ssh-add ~/.ssh/id_rsa'\")\n    logrus.Fatal(err)\n  }\n  session, _ := conn.NewSession()\n  defer session.Close()\n  var stdoutBuf bytes.Buffer\n  session.Stdout = &amp;stdoutBuf\n  err = session.Run(command)\n  if err != nil {\n    logrus.Fatalf(\"Run failed:%v\", err)\n  }\n  logrus.Infof(\"&gt;%s\", stdoutBuf.Bytes())\n}\n</code></pre>\n"}, {"tags": ["json", "string", "http", "testing", "go"], "comments": [{"owner": {"reputation": 759, "user_id": 3625477, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R3qio.jpg?s=128&g=1", "display_name": "Shinra tensei", "link": "https://stackoverflow.com/users/3625477/shinra-tensei"}, "edited": false, "score": 0, "creation_date": 1500883611, "post_id": 45275185, "comment_id": 77512896, "body": "<code>expected := `&quot;{&quot;status&quot;: &quot;OK&quot;}`</code> this has an extra &quot; before the {. Could that be a problem?"}, {"owner": {"reputation": 166, "user_id": 2004876, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9c9c70c1ff838eea3188ce9f4c5eb2d7?s=128&d=identicon&r=PG", "display_name": "Kmmel", "link": "https://stackoverflow.com/users/2004876/kmmel"}, "reply_to_user": {"reputation": 759, "user_id": 3625477, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R3qio.jpg?s=128&g=1", "display_name": "Shinra tensei", "link": "https://stackoverflow.com/users/3625477/shinra-tensei"}, "edited": false, "score": 0, "creation_date": 1500884006, "post_id": 45275185, "comment_id": 77513142, "body": "@Shinratensei: Thanks for the hint. Edited the snippet, but did not solve the problem :("}, {"owner": {"reputation": 759, "user_id": 3625477, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R3qio.jpg?s=128&g=1", "display_name": "Shinra tensei", "link": "https://stackoverflow.com/users/3625477/shinra-tensei"}, "edited": false, "score": 0, "creation_date": 1500884065, "post_id": 45275185, "comment_id": 77513180, "body": "Yeah I know, it was just something that looked weird to me. Look at the answers, they know more about golang"}], "answers": [{"comments": [{"owner": {"reputation": 166, "user_id": 2004876, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9c9c70c1ff838eea3188ce9f4c5eb2d7?s=128&d=identicon&r=PG", "display_name": "Kmmel", "link": "https://stackoverflow.com/users/2004876/kmmel"}, "edited": false, "score": 0, "creation_date": 1500883950, "post_id": 45275278, "comment_id": 77513111, "body": "Thanks for quick reponse: changed the expected but got  \thandlers_test.go:244: handler returned unexpected body: got &quot;{\\&quot;status\\&quot;: \\&quot;OK\\&quot;}&quot; \t\t want {\\&quot;status\\&quot;: \\&quot;OK\\&quot;}"}, {"owner": {"reputation": 166, "user_id": 2004876, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9c9c70c1ff838eea3188ce9f4c5eb2d7?s=128&d=identicon&r=PG", "display_name": "Kmmel", "link": "https://stackoverflow.com/users/2004876/kmmel"}, "edited": false, "score": 0, "creation_date": 1500884368, "post_id": 45275278, "comment_id": 77513351, "body": "Thanks, this solved it for this test, but I got another where I had to use json.encode. I found a solution to the problem by myself."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1500885252, "last_edit_date": 1500885252, "creation_date": 1500883635, "answer_id": 45275278, "question_id": 45275185, "link": "https://stackoverflow.com/questions/45275185/buffer-string-not-equal-string/45275278#45275278", "title": "Buffer string() not equal string", "body": "<p>The message you send:</p>\n\n<pre><code>message := `{\"status\": \"OK\"}`\n</code></pre>\n\n<p>Is already a valid JSON text, you don't need any further JSON encoding / processing on it. Just send it as-is:</p>\n\n<pre><code>func Index(w http.ResponseWriter, r *http.Request){\n    message := `{\"status\": \"OK\"}`\n    w.Header().Set(\"Content-Type\", \"application/json;charset=UTF-8\")\n    io.WriteString(w, message)\n}\n</code></pre>\n\n<p>Also note that if your response code is <code>http.StatusOK</code>, you don't need to set that explicitly, as that is the default if you don't set it.</p>\n\n<p>And then simply expect the following response:</p>\n\n<pre><code>expected := `{\"status\": \"OK\"}`\n</code></pre>\n\n<p><strong>Explaining your original code:</strong></p>\n\n<p>In your original code you JSON-marshaled a single <code>string</code> value, whose content was <code>{\"status\": \"OK\"}</code>. JSON encoding will quote this text into a valid JSON string (prefix quotation marks with a backslash), put inside quotes, and also appends a newline character. So this becomes the raw string:</p>\n\n<pre><code>expected := `\"{\\\"status\\\": \\\"OK\\\"}\"\n`\n</code></pre>\n\n<p>Using this <code>expected</code> value, your test passes, but again, what you want is in the first part of this answer.</p>\n\n<p>If you want to use an interpreted string literal to describe the <code>expected</code> value, this is how it could look like:</p>\n\n<pre><code>expected := \"\\\"{\\\\\\\"status\\\\\\\": \\\\\\\"OK\\\\\\\"}\\\"\\n\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 166, "user_id": 2004876, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9c9c70c1ff838eea3188ce9f4c5eb2d7?s=128&d=identicon&r=PG", "display_name": "Kmmel", "link": "https://stackoverflow.com/users/2004876/kmmel"}, "is_accepted": false, "score": 0, "last_activity_date": 1500884303, "creation_date": 1500884303, "answer_id": 45275479, "question_id": 45275185, "link": "https://stackoverflow.com/questions/45275185/buffer-string-not-equal-string/45275479#45275479", "title": "Buffer string() not equal string", "body": "<p>The linebreak was the problem. I managed to solve it with adding strings.TrimRight and cut if right off the string. </p>\n\n<pre><code>if strings.TrimRight(rr.Body.String(), \"\\n\") != expected {\n    t.Errorf(\"handler returned unexpected body: got %v want %v\",\n        rr.Body.String(), expected)\n    }\n</code></pre>\n"}], "owner": {"reputation": 166, "user_id": 2004876, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9c9c70c1ff838eea3188ce9f4c5eb2d7?s=128&d=identicon&r=PG", "display_name": "Kmmel", "link": "https://stackoverflow.com/users/2004876/kmmel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 0, "accepted_answer_id": 45275278, "answer_count": 2, "score": 1, "last_activity_date": 1500886953, "creation_date": 1500883332, "last_edit_date": 1500886953, "question_id": 45275185, "link": "https://stackoverflow.com/questions/45275185/buffer-string-not-equal-string", "title": "Buffer string() not equal string", "body": "<p>I try to test if my http handler is returning the right values inside the body. </p>\n\n<p>This is my handler function</p>\n\n<pre><code>func Index(w http.ResponseWriter, r *http.Request){\n    message := `{\"status\": \"OK\"}`\n    w.WriteHeader(http.StatusOK)\n    w.Header().Set(\"Content-Type\", \"application/json;charset=UTF-8\")\n    if err := json.NewEncoder(w).Encode(message); err != nil {\n            panic(err)\n    }\n}\n</code></pre>\n\n<p>This is my test </p>\n\n<pre><code>func TestIndex(t *testing.T){\n\n    req, err := http.NewRequest(\"GET\", \"/\", nil)\n    if err != nil {\n            t.Fatal(err)\n    }\n\n    rr := httptest.NewRecorder()\n    handler := http.HandlerFunc(Index)\n\n    handler.ServeHTTP(rr, req)\n\n    expected := `\"{\"status\": \"OK\"}\"`\n\n    if rr.Body.String() != expected {\n    t.Errorf(\"handler returned unexpected body: got %v want %v\",\n        rr.Body.String(), expected)\n    }\n}\n</code></pre>\n\n<p>The result of the test is:</p>\n\n<pre><code>handlers_test.go:244: handler returned unexpected body: got \"{\\\"status\\\": \\\"OK\\\"}\"\n     want {\"status\": \"OK\"}\n</code></pre>\n\n<p>I think the escaping of the \" is because of the json Encode, but even if I change the expected to</p>\n\n<pre><code>expected := `\"{\\\"status\\\": \\\"OK\\\"}\"`\n</code></pre>\n\n<p>it does not work, than the result of the test is</p>\n\n<pre><code>handlers_test.go:244: handler returned unexpected body: got \"{\\\"status\\\": \\\"OK\\\"}\"\n     want \"{\\\"status\\\": \\\"OK\\\"}\"\n</code></pre>\n\n<p>In the <a href=\"https://golang.org/src/encoding/json/stream.go?s=4388:4435#L178\" rel=\"nofollow noreferrer\">docs</a> I found something that json encode appends a newline character, but I did not manage to get the test working even with that information :-/</p>\n\n<p>In advance, thanks for your help.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4208, "user_id": 538570, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2edd809f45e37c99eefbd6e7c969b52a?s=128&d=identicon&r=PG", "display_name": "Sal Rahman", "link": "https://stackoverflow.com/users/538570/sal-rahman"}, "is_accepted": true, "score": 2, "last_activity_date": 1500878505, "creation_date": 1500878505, "answer_id": 45274122, "question_id": 45273724, "link": "https://stackoverflow.com/questions/45273724/how-to-open-images-in-webserver/45274122#45274122", "title": "How to open images in webserver", "body": "<p>It's because you <strong>do not</strong> have <em>any</em> dedicated route that handles requests for <em>any</em> images.</p>\n\n<p>My recommendation would be to initialize an HTTP handler that serves file based on the URI pathname. You can use that handler as a way to serve images.</p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"images\"))\n</code></pre>\n\n<p>And then to bind it:</p>\n\n<pre><code>http.Handle(\"/images/\", http.StripPrefix(\"/images/\", fs))\n</code></pre>\n\n<p>Here's your full code with my suggestions:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"html/template\"\n  \"net/http\"\n)\n\nfunc main() {\n  // We're creating a file handler, here.\n  fs := http.FileServer(http.Dir(\"images\"))\n\n  http.HandleFunc(\"/images\", images)\n\n  // We're binding the handler to the `/images` route, here.\n  http.Handle(\"/images/\", http.StripPrefix(\"/images/\", fs))\n\n  http.ListenAndServe(\":8080\", nil)\n}\n\nfunc images(w http.ResponseWriter, r *http.Request) {\n  t, err := template.ParseFiles(\"templates/link.html\")\n  if err != nil {\n    fmt.Fprintf(w, err.Error())\n    return\n  }\n\n  t.ExecuteTemplate(w, \"link\", nil)\n}\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 8287519, "user_type": "registered", "profile_image": "https://graph.facebook.com/1437802166280975/picture?type=large", "display_name": "Sultan Maidanov", "link": "https://stackoverflow.com/users/8287519/sultan-maidanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 45274122, "answer_count": 1, "score": 0, "last_activity_date": 1500886993, "creation_date": 1500876745, "last_edit_date": 1500886993, "question_id": 45273724, "link": "https://stackoverflow.com/questions/45273724/how-to-open-images-in-webserver", "title": "How to open images in webserver", "body": "<p>I have a simple webserver and I want to open imagesin browser. The problem is browser can't open an image I sent. </p>\n\n<pre><code>package main\n\nimport (\n\n  \"io/ioutil\"\n  \"net/http\"\n  \"io\"\n  \"html/template\"\n  \"fmt\"\n\n )  \nfunc main() {\n\n\n\nhttp.HandleFunc(\"/images\", images)\n\n\nhttp.ListenAndServe(\":8080\", nil)\n}\nfunc images(w http.ResponseWriter, r *http.Request) {\nt, err := template.ParseFiles(\"templates/link.html\")\nif err != nil {\n    fmt.Fprintf(w, err.Error())\n    return\n}\n\nt.ExecuteTemplate(w, \"link\", nil)\n}\n</code></pre>\n\n<p>Also my html template package, where I create a link to file on my computer. Called link.html </p>\n\n<pre><code>  {{ define \"link\" }}\n\n\n  &lt;!DOCTYPE html&gt;\n  &lt;html lang=\"en\"&gt;\n   &lt;head&gt;\n   &lt;meta charset=\"UTF-8\"&gt;\n   &lt;title&gt;Title&lt;/title&gt;\n   &lt;/head&gt;\n   &lt;body&gt;\n\n   &lt;p&gt; &lt;a href=\"/images/2.jpg\"&gt;apple&lt;/a&gt;&lt;/p&gt;\n   &lt;br&gt;\n\n   &lt;/body&gt;\n   &lt;/html&gt;\n\n\n   {{ end }}\n</code></pre>\n\n<p>I do not understand why it doesn't work. Will be very glad for help. In addition all files I wanted to add to server are lying in this golang project</p>\n"}, {"tags": ["go", "file-upload"], "comments": [{"owner": {"reputation": 2359, "user_id": 405454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/IDzwW.png?s=128&g=1", "display_name": "mhutter", "link": "https://stackoverflow.com/users/405454/mhutter"}, "edited": false, "score": 1, "creation_date": 1500881996, "post_id": 45273503, "comment_id": 77511968, "body": "You are never actually <i>writing</i> to <code>f</code> in this snippet..."}], "answers": [{"comments": [{"owner": {"reputation": 527, "user_id": 3591466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/977d21dd4dde36df3ae73e9bef6ecf49?s=128&d=identicon&r=PG&f=1", "display_name": "user3591466", "link": "https://stackoverflow.com/users/3591466/user3591466"}, "edited": false, "score": 0, "creation_date": 1500877499, "post_id": 45273614, "comment_id": 77510274, "body": "hmm, I tried that, seems like the same issue persist"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 527, "user_id": 3591466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/977d21dd4dde36df3ae73e9bef6ecf49?s=128&d=identicon&r=PG&f=1", "display_name": "user3591466", "link": "https://stackoverflow.com/users/3591466/user3591466"}, "edited": false, "score": 0, "creation_date": 1500878259, "post_id": 45273614, "comment_id": 77510651, "body": "@user3591466 f.Sync needs to be called before you use ioutil.ReadFile and also can you try closing the file using f.Close before accessing it."}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": false, "score": 1, "last_activity_date": 1500878591, "last_edit_date": 1500878591, "creation_date": 1500876245, "answer_id": 45273614, "question_id": 45273503, "link": "https://stackoverflow.com/questions/45273503/race-condition-between-creating-file-and-ioutil-readfile/45273614#45273614", "title": "Race condition between creating file and ioutil.ReadFile", "body": "<p>Have you tried using <a href=\"https://golang.org/pkg/os/#File.Sync\" rel=\"nofollow noreferrer\">File.Sync</a> ?</p>\n\n<blockquote>\n  <p>Sync commits the current contents of the file to stable storage.\n  Typically, this means flushing the file system's in-memory copy of\n  recently written data to disk.</p>\n</blockquote>\n\n<p><a href=\"https://stackoverflow.com/q/10862375/2285935\">Additional Reference</a></p>\n\n<pre><code>f, err := os.OpenFile(\"./img_dump/\"+handler.Filename, os.O_WRONLY|os.O_CREATE, 0666)\nif err != nil {...}\n\nerr = f.Sync()\nif err != nil {...}\n\nerr = f.Close()\nif err != nil {...}\n\ndata, err := ioutil.ReadFile(\"/myAbsolutePath/img_dump/\"  + handler.Filename)\n</code></pre>\n"}], "owner": {"reputation": 527, "user_id": 3591466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/977d21dd4dde36df3ae73e9bef6ecf49?s=128&d=identicon&r=PG&f=1", "display_name": "user3591466", "link": "https://stackoverflow.com/users/3591466/user3591466"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1500878593, "creation_date": 1500875730, "last_edit_date": 1500878593, "question_id": 45273503, "link": "https://stackoverflow.com/questions/45273503/race-condition-between-creating-file-and-ioutil-readfile", "title": "Race condition between creating file and ioutil.ReadFile", "body": "<p>I have a golang web app end point that allows uploading image, but I find that creating a file and immediately reading it using <code>ioutil.ReadFile</code> will result in <code>data</code> to be empty. But if I call it again in some time later it will contain the data.</p>\n\n<pre><code>    r.ParseMultipartForm(32 &lt;&lt; 20)\n    file, handler, err := r.FormFile(\"my_input_name\")\n\n    f, err := os.OpenFile(\"./img_dump/\"+handler.Filename, os.O_WRONLY|os.O_CREATE, 0666)\n    if err != nil {\n       return\n    }\n    // data is empty [] when first called\n    data, err := ioutil.ReadFile(\"/myAbsolutePath/img_dump/\"  + handler.Filename)\n    // This does not work, data is empty\n    fmt.Println(len(data))\n\n    f.Sync()\n\n    data, err = ioutil.ReadFile(\"/myAbsolutePath/img_dump/\"  + handler.Filename)\n\n    // This does not work, data is empty\n    fmt.Println(len(data))\n\n    c1 := make(chan string, 1)\n    go func() {\n        time.Sleep(time.Second * 5)\n        c1 &lt;- \"result 1\"\n    }()\n\n    go func(name string) {\n        select {\n        case _ = &lt;-c1:\n            data, err = ioutil.ReadFile(\"/myAbsolutePath/img_dump/\" + name)\n            fmt.Println(\"after sleep\")\n            // This only works if I don't try f.Close(), data is not empty\n            fmt.Println(len(data))\n        }\n    }(handler.Filename)\n</code></pre>\n\n<p>Is there a way to avoid race condition between creating and reading, maybe a promise?</p>\n\n<p>Edit: I tried Sync to flush file but same issue still exist.</p>\n"}, {"tags": ["javascript", "regex", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1500868091, "post_id": 45272267, "comment_id": 77507332, "body": "Show your best attempt."}, {"owner": {"reputation": 137853, "user_id": 615754, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SiiYj.jpg?s=128&g=1", "display_name": "nnnnnn", "link": "https://stackoverflow.com/users/615754/nnnnnn"}, "edited": false, "score": 0, "creation_date": 1500868537, "post_id": 45272267, "comment_id": 77507443, "body": "Repeating and/or optional groups or characters are a standard <a href=\"https://developer.mozilla.org/en/docs/Web/JavaScript/Guide/Regular_Expressions\" rel=\"nofollow noreferrer\">regular expression</a> feature that is regex 101. So maybe something like <code>&#47;^[a-z\\d]+((?:[._]|__|[-]*)[a-z\\d]+)*$&#47;</code>"}, {"owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "edited": false, "score": 0, "creation_date": 1500877983, "post_id": 45272267, "comment_id": 77510519, "body": "I presume <code>repeated()</code> means &quot;all&quot; so is normally implemented as the <code>g</code> flag in other languages. What does <code>optional()</code> do? Does it return an option monad?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "edited": false, "score": 0, "creation_date": 1500878131, "post_id": 45272267, "comment_id": 77510577, "body": "@slebetman <a href=\"https://github.com/docker/distribution/blob/master/reference/regexp.go#L120\" rel=\"nofollow noreferrer\">github.com/docker/distribution/blob/master/reference/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 1, "last_activity_date": 1500878461, "creation_date": 1500878461, "answer_id": 45274110, "question_id": 45272267, "link": "https://stackoverflow.com/questions/45272267/convert-golang-regex-to-js-regex/45274110#45274110", "title": "convert Golang regex to JS regex", "body": "<p>See how you build the <code>nameComponentRegexp</code>: you start with <code>alphaNumericRegexp</code> and then match 1 or 0 occurrences of 1 or more sequences of <code>separatorRegexp</code>+<code>alphaNumericRegexp</code>.</p>\n\n<p><a href=\"https://github.com/docker/distribution/blob/master/reference/regexp.go#L118\" rel=\"nofollow noreferrer\"><code>optional()</code></a> does the following:</p>\n\n<blockquote>\n  <p>// optional wraps the expression in a non-capturing group and makes the<br/>\n  // production optional.<br/></p>\n\n<pre>func optional(res ...*regexp.Regexp) *regexp.Regexp {\n  return match(group(expression(res...)).String() + `?`)\n}</pre>\n</blockquote>\n\n<p><a href=\"https://github.com/docker/distribution/blob/master/reference/regexp.go#L118\" rel=\"nofollow noreferrer\"><code>repeated()</code></a> does this:</p>\n\n<blockquote>\n  <p>// repeated wraps the regexp in a non-capturing group to get one or more<br/>\n  // matches.<br/></p>\n\n<pre>func repeated(res ...*regexp.Regexp) *regexp.Regexp {\n  return match(group(expression(res...)).String() + `+`)\n}</pre>\n</blockquote>\n\n<p>Thus, what you need is</p>\n\n<pre><code>/^[a-z0-9]+(?:(?:[._]|__|-*)[a-z0-9]+)*$/\n</code></pre>\n\n<p>See the <a href=\"https://regex101.com/r/cm1qY3/1\" rel=\"nofollow noreferrer\">regex demo</a></p>\n\n<p><strong>Details</strong>:</p>\n\n<ul>\n<li><code>^</code> - start of string</li>\n<li><code>[a-z0-9]+</code> - 1 or more alphanumeric symbols</li>\n<li><code>(?:(?:[._]|__|-*)[a-z0-9]+)*</code> - zero or more sequences of:\n\n<ul>\n<li><code>(?:[._]|__|-*)</code> - a <code>.</code>, <code>_</code>, <code>__</code>, or 0+ hyphens</li>\n<li><code>[a-z0-9]+</code>- 1 or more alphanumeric symbols</li>\n</ul></li>\n</ul>\n\n<p>If you want to disallow strings like <code>aaaa</code>, you need to replace all <code>*</code> in the pattern (2 occurrences) with <code>+</code> (<a href=\"https://regex101.com/r/Bcmdjb/1\" rel=\"nofollow noreferrer\">demo</a>).</p>\n\n<p>JS demo:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>var ss = ['a.a','a_a','a__a','a-a','a--a','a---a'];\r\nvar rx = /^[a-z0-9]+(?:(?:[._]|__|-*)[a-z0-9]+)*$/;\r\nfor (var s of ss) {\r\n console.log(s,\"=&gt;\", rx.test(s));\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}], "owner": {"reputation": 1387, "user_id": 3959385, "user_type": "registered", "accept_rate": 30, "profile_image": "https://graph.facebook.com/100000205094443/picture?type=large", "display_name": "Ertu\u011frul Alt\u0131nbo\u011fa", "link": "https://stackoverflow.com/users/3959385/ertu%c4%9frul-alt%c4%b1nbo%c4%9fa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1365, "favorite_count": 0, "accepted_answer_id": 45274110, "answer_count": 1, "score": 0, "last_activity_date": 1500878461, "creation_date": 1500867591, "question_id": 45272267, "link": "https://stackoverflow.com/questions/45272267/convert-golang-regex-to-js-regex", "title": "convert Golang regex to JS regex", "body": "<p>I have a regex from Golang (nameComponentRegexp). How can I convert it to JavaScript style regex? </p>\n\n<p>The main blocking problem for me:</p>\n\n<ol>\n<li>How can I do <code>optional</code> and <code>repeated</code> in JavaScript correctly</li>\n<li>I tried copy from <code>match(`(?:[._]|__|[-]*)`)</code> but it cannot match single period or single underscore. I tried it from online regex tester.</li>\n</ol>\n\n<p>The description from Golang:</p>\n\n<blockquote>\n  <p>nameComponentRegexp restricts registry path component names to start\n      with at least one letter or number, with following parts able to be\n      separated by one period, one or two underscore and multiple dashes.</p>\n</blockquote>\n\n<pre><code>alphaNumericRegexp = match(`[a-z0-9]+`)\nseparatorRegexp = match(`(?:[._]|__|[-]*)`)\n\nnameComponentRegexp = expression(\n    alphaNumericRegexp,\n    optional(repeated(separatorRegexp, alphaNumericRegexp)))\n</code></pre>\n\n<p>Some valid example:</p>\n\n<ul>\n<li>a.a</li>\n<li>a_a</li>\n<li>a__a</li>\n<li>a-a</li>\n<li>a--a</li>\n<li>a---a</li>\n</ul>\n"}, {"tags": ["multithreading", "go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 1, "creation_date": 1500856676, "post_id": 45271129, "comment_id": 77505205, "body": "I do not see <code>wg.Wait()</code> anywhere in your snippet but you&#39;re using <code>sync.WaitGroup</code>."}, {"owner": {"reputation": 123, "user_id": 6085440, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/ef8e54767d574352300bcf6a303f273d?s=128&d=identicon&r=PG&f=1", "display_name": "Khalil Claybon", "link": "https://stackoverflow.com/users/6085440/khalil-claybon"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1500857473, "post_id": 45271129, "comment_id": 77505352, "body": "where should I put it and will that solve my issues ? @jeevatkm"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1500858245, "post_id": 45271129, "comment_id": 77505488, "body": "It seems, as per your code snippet. I think in the method <code>BackFillParallel</code> after the <code>startWorker</code> line."}], "answers": [{"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 0, "last_activity_date": 1500916564, "last_edit_date": 1500916564, "creation_date": 1500916222, "answer_id": 45286325, "question_id": 45271129, "link": "https://stackoverflow.com/questions/45271129/goroutines-channels-select-statement/45286325#45286325", "title": "Goroutines, channels select statement", "body": "<p>First a comment on what main problem I see with the code:</p>\n\n<p>You are passing a <code>done</code> variable to the last <code>ProcessLead</code> call which in turn you use in <code>ProcessLead</code> to stop your worker via <code>quit</code> channel. The problem with this is, that the \"last\" <code>ProcessLead</code> call may finish BEFORE other <code>ProcessLead</code> calls as they are executed in parallel.</p>\n\n<h2>First improvement</h2>\n\n<p>Think of your problem as a pipeline. You have 3 steps:</p>\n\n<ol>\n<li>going through all the leads and starting a routine for each one</li>\n<li>the routines process their lead</li>\n<li>collecting the results</li>\n</ol>\n\n<p>After spreading out in step 2 the simplest way to synchronise is the <code>WaitGroup</code>. As already mentioned you are not calling the synchronise and if you would, you would currently create a deadlock in connection with your collecting routine. You need another goroutine separating the sync from the collecting routine for this to work.</p>\n\n<p>How that could look like (sry for removing some code, so I could better see the structure):</p>\n\n<pre><code>//BackFillParallel . . .\nfunc BackFillParallel(leads []Lead, verbose bool) {\n    gl, bl, d := make(chan LeadRes), make(chan LeadResErr), make(chan int)\n    // additional goroutine with wg.Wait() and closing the quit channel\n    go func(d chan int) {\n        var wg sync.WaitGroup\n        for i, lead := range leads {\n            wg.Add(1)\n            go func(lead Lead, wg *sync.WaitGroup) {\n                ProcessLead(lead, gl, bl, wg)\n            }(lead, &amp;wg)\n        }\n        wg.Wait()\n        // stop routine after all other routines are done\n        // if your channels have buffers you might want make sure there is nothing in the buffer before closing\n        close(d) // you can simply close a quit channel. just make sure to only close it once\n    }(d)\n\n    // now startworker is running parallel to wg.Wait() and close(d)\n    startWorker(gl, bl, d, verbose)\n}\n\nfunc startWorker(ok chan LeadRes, err chan LeadResErr, quit chan int, verbose bool) {\n    for {\n        select {\n        case lead := &lt;-ok:\n            fmt.Println(lead)\n        case err := &lt;-err:\n            fmt.Println(err)\n        case &lt;-quit:\n            return\n        }\n    }\n}\n\n//ProcessLead . . .\nfunc ProcessLead(lead Lead, c1 chan LeadRes, c2 chan LeadResErr, wg *sync.WaitGroup) {\n    defer wg.Done()\n    var payloads []Payload\n    for _, p := range lead.Payload {\n        decMDStr, err := base64.StdEncoding.DecodeString(p.MetaData)\n        if err != nil {\n            c2 &lt;- LeadResErr{lead, err.Error()}\n        }\n        var decMetadata Metadata\n        if err := json.Unmarshal(decMDStr, &amp;decMetadata); err != nil {\n            goodMetadata, err := FixMDStr(string(decMDStr))\n            if err != nil {\n                c2 &lt;- LeadResErr{lead, err.Error()}\n            }\n            p.MetaData = goodMetadata\n\n            payloads = append(payloads, p)\n        }\n    }\n\n    lead.Payload = payloads\n    c1 &lt;- LeadRes{lead}\n}\n</code></pre>\n\n<h2>Suggested Solution</h2>\n\n<p>As mentioned in a comment you might run into trouble if you have buffered channels. The complication comes with the two output channels you have (for Lead and LeadErr). You could avoid this with the following structure:</p>\n\n<pre><code>//BackFillParallel . . .\nfunc BackFillParallel(leads []Lead, verbose bool) {\n    gl, bl := make(chan LeadRes), make(chan LeadResErr)\n\n    // one goroutine that blocks until all ProcessLead functions are done\n    go func(gl chan LeadRes, bl chan LeadResErr) {\n        var wg sync.WaitGroup\n        for _, lead := range leads {\n            wg.Add(1)\n            go func(lead Lead, wg *sync.WaitGroup) {\n                ProcessLead(lead, gl, bl, wg)\n            }(lead, &amp;wg)\n        }\n        wg.Wait()\n    }(gl, bl)\n\n    // main routine blocks until all results and errors are collected\n    var wg sync.WaitGroup\n    res, errs := []LeadRes{}, []LeadResErr{}\n    wg.Add(2) // add 2 for resCollector and errCollector\n    go resCollector(&amp;wg, gl, res)\n    go errCollector(&amp;wg, bl, errs)\n    wg.Wait()\n\n    fmt.Println(res, errs) // in these two variables you will have the results.\n}\n\nfunc resCollector(wg *sync.WaitGroup, ok chan LeadRes, res []LeadRes) {\n    defer wg.Done()\n    for lead := range ok {\n        res = append(res, lead)\n    }\n}\n\nfunc errCollector(wg *sync.WaitGroup, ok chan LeadResErr, res []LeadResErr) {\n    defer wg.Done()\n    for err := range ok {\n        res = append(res, err)\n    }\n}\n\n// ProcessLead function as in \"First improvement\"\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 6085440, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/ef8e54767d574352300bcf6a303f273d?s=128&d=identicon&r=PG&f=1", "display_name": "Khalil Claybon", "link": "https://stackoverflow.com/users/6085440/khalil-claybon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 157, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1500916564, "creation_date": 1500856306, "question_id": 45271129, "link": "https://stackoverflow.com/questions/45271129/goroutines-channels-select-statement", "title": "Goroutines, channels select statement", "body": "<p>I am having trouble structuring my goroutines and channels. My select statement keeps quitting before all goroutines are finished, I know the problem is where I am sending the done signal. Where should I send the done signal.</p>\n\n<pre><code>func startWorker(ok chan LeadRes, err chan LeadResErr, quit chan int, verbose bool, wg *sync.WaitGroup) {\n    var results ProcessResults\n    defer wg.Done()\n    log.Info(\"Starting . . .\")\n    start := time.Now()\n\n    for {\n        select {\n        case lead := &lt;-ok:\n            results.BackFill = append(results.BackFill, lead.Lead)\n        case err := &lt;-err:\n            results.BadLeads = append(results.BadLeads, err)\n        case &lt;-quit:\n            if verbose {\n                log.Info(\"Logging errors from unprocessed leads . . .\")\n                logBl(results.BadLeads)\n            }\n            log.WithFields(log.Fields{\n                \"time-elapsed\":                time.Since(start),\n                \"number-of-unprocessed-leads\": len(results.BadLeads),\n                \"number-of-backfilled-leads\":  len(results.BackFill),\n            }).Info(\"Done\")\n            return\n        }\n    }\n}\n\n//BackFillParallel . . .\nfunc BackFillParallel(leads []Lead, verbose bool) {\n    var wg sync.WaitGroup\n    gl, bl, d := getChans()\n    for i, lead := range leads {\n        done := false\n        if len(leads)-1 == i {\n            done = true\n        }\n        wg.Add(1)\n        go func(lead Lead, done bool, wg *sync.WaitGroup) {\n            ProcessLead(lead, gl, bl, d, done, wg)\n        }(lead, done, &amp;wg)\n\n    }\n    startWorker(gl, bl, d, verbose, &amp;wg)\n}\n\n//ProcessLead . . .\nfunc ProcessLead(lead Lead, c1 chan LeadRes, c2 chan LeadResErr, c3 chan int, done bool, wg *sync.WaitGroup) {\n    defer wg.Done()\n    var payloads []Payload\n    for _, p := range lead.Payload {\n        decMDStr, err := base64.StdEncoding.DecodeString(p.MetaData)\n        if err != nil {\n            c2 &lt;- LeadResErr{lead, err.Error()}\n        }\n        var decMetadata Metadata\n        if err := json.Unmarshal(decMDStr, &amp;decMetadata); err != nil {\n            goodMetadata, err := FixMDStr(string(decMDStr))\n            if err != nil {\n                c2 &lt;- LeadResErr{lead, err.Error()}\n            }\n            p.MetaData = goodMetadata\n\n            payloads = append(payloads, p)\n        }\n    }\n\n    lead.Payload = payloads\n    c1 &lt;- LeadRes{lead}\n    if done {\n        c3 &lt;- 0\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "edited": false, "score": 0, "creation_date": 1500860889, "post_id": 45271090, "comment_id": 77505967, "body": "Pointers usually print fine (see p): <a href=\"https://play.golang.org/p/ZrWq2heDl2\" rel=\"nofollow noreferrer\">play.golang.org/p/ZrWq2heDl2</a>"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 1, "creation_date": 1500876888, "post_id": 45271090, "comment_id": 77509976, "body": "@kristen That&#39;s because *P does not implement <a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"nofollow noreferrer\">fmt.Stringer</a>. <a href=\"https://play.golang.org/p/CqWk9nP52a\" rel=\"nofollow noreferrer\">Reference</a>"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 4, "last_activity_date": 1500924767, "last_edit_date": 1500924767, "creation_date": 1500855890, "answer_id": 45271090, "question_id": 45271052, "link": "https://stackoverflow.com/questions/45271052/how-do-i-print-the-entire-url-url-struct/45271090#45271090", "title": "How do I print the entire url.URL struct?", "body": "<p>It seems to be because <code>Parse</code> is returning a pointer to the struct.</p>\n\n<p>Try with this (note the <code>*</code>):</p>\n\n<pre><code>fmt.Printf(\"%+v\\n\", *u)\n</code></pre>\n\n<p>Modified playground:</p>\n\n<p><a href=\"https://play.golang.org/p/Grjrp2QriK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Grjrp2QriK</a></p>\n\n<p><strong>EDIT</strong></p>\n\n<p>To expand on this, the reason for this is that <code>fmt</code> treats structs that implement <code>Stringer</code> differently when doing <code>%+v</code>.</p>\n\n<p>This is the relevant code: <a href=\"https://golang.org/src/fmt/print.go?s=4772:4849#L577\" rel=\"nofollow noreferrer\">https://golang.org/src/fmt/print.go?s=4772:4849#L577</a></p>\n\n<p>Since <code>*URL</code> implements Stringer: <a href=\"https://golang.org/pkg/net/url/#URL.String\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/url/#URL.String</a></p>\n\n<p>That's the string being used.</p>\n\n<p>By dereferencing the pointer, we get an <code>URL</code>, which does not implement the interface (cause the receiver in the <code>String</code> method is a pointer).</p>\n"}, {"tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": false, "score": 0, "last_activity_date": 1500885608, "creation_date": 1500885608, "answer_id": 45275895, "question_id": 45271052, "link": "https://stackoverflow.com/questions/45271052/how-do-i-print-the-entire-url-url-struct/45275895#45275895", "title": "How do I print the entire url.URL struct?", "body": "<p>You can always use the <code>%#v</code> formatting verb to print the Go syntax representation for any value. For example:</p>\n\n<pre><code>fmt.Printf(\"%#v\\n\",u)\n</code></pre>\n\n<p>This can be handy for debugging &amp; automatic code generation. Since the output is the Go representation, this could be pasted into a test or similar as a variable.</p>\n\n<p>This way you don't need to worry about type that override <a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"nofollow noreferrer\">fmt.Stringer</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 0, "accepted_answer_id": 45271090, "answer_count": 2, "score": 0, "last_activity_date": 1500924767, "creation_date": 1500855467, "question_id": 45271052, "link": "https://stackoverflow.com/questions/45271052/how-do-i-print-the-entire-url-url-struct", "title": "How do I print the entire url.URL struct?", "body": "<p>I have the following <a href=\"https://play.golang.org/p/utnlHJqlX1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/utnlHJqlX1</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/url\"\n)\n\nfunc main() {\n    u, err := url.Parse(\"http://www.something.com\")\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Printf(\"%+v\", u)\n}\n</code></pre>\n\n<p>I was expecting the \"%+v\" to print the struct and the fields. Instead it prints: \"<a href=\"http://www.something.com\" rel=\"nofollow noreferrer\">http://www.something.com</a>\"</p>\n"}, {"tags": ["go", "maps"], "comments": [{"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "edited": false, "score": 0, "creation_date": 1500856356, "post_id": 45270992, "comment_id": 77505146, "body": "How often is the map updated? Do you get the map once and then have to query multiple times? If that&#39;s the case, it might be worth re-arranging the map when you get it to then make the queries faster."}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1500856497, "post_id": 45270992, "comment_id": 77505168, "body": "I doubt your values unique? if it is by chance then create <code>map[string]bool</code> using values (may be you can have one map per party). BTW <code>val</code> from second <code>for</code> is not used in your snippet."}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "edited": false, "score": 0, "creation_date": 1500856538, "post_id": 45270992, "comment_id": 77505175, "body": "@eugenioy can you please give insight about <code>re-arranging the map</code>?"}, {"owner": {"reputation": 387, "user_id": 4777642, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c9f699765f124ae794d7393348c91467?s=128&d=identicon&r=PG&f=1", "display_name": "mg03", "link": "https://stackoverflow.com/users/4777642/mg03"}, "reply_to_user": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "edited": false, "score": 0, "creation_date": 1500919739, "post_id": 45270992, "comment_id": 77536871, "body": "@eugenioy :  the map is obtained every time an api call is made ... flow is : consumer calls myapi , myapi goes and gets the latest info and populates map, does a lookup and returns value to consumer .... i initially thought about re-arranging the map, but on every call, it gives a performance hit..."}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "edited": false, "score": 0, "creation_date": 1500920452, "post_id": 45270992, "comment_id": 77537266, "body": "@mg03: when you &quot;get the latest info and populate map&quot;, can&#39;t you populate it with a different structure like the one I suggested in my answer? If not, I don&#39;t see many options... Another alternative would be for you to avoid getting the latest information on each call (having a cached version of the map), but that of course would only work if your consumer can tolerate not getting 100% fresh information."}], "answers": [{"comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1500874281, "post_id": 45271212, "comment_id": 77509073, "body": "Thanks for giving an example."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 2, "last_activity_date": 1500857249, "creation_date": 1500857249, "answer_id": 45271212, "question_id": 45270992, "link": "https://stackoverflow.com/questions/45270992/go-map-search-using-values-in-a-map/45271212#45271212", "title": "go map search using values in a map", "body": "<p>If you will query that map multiple times, it might be worth spending some time re-arranging it when you get it so that you can then query it faster.</p>\n\n<p>It seems you need to invert the relationships, making the values in <code>allsvc</code> the keys in the new map, and having the keys as values so that you can then just make lookups in the new map.</p>\n\n<p>This can be a way to re-arrange the map:</p>\n\n<pre><code>func arrangeMap(oldMap map[string][]string) map[string][]string {\n    newMap := make(map[string][]string)\n    for k, v :=  range  oldMap {\n        for _, val := range v {\n            newMap[val] = append(newMap[val], k)\n        }\n    }\n    return newMap\n}\n</code></pre>\n\n<p>See here a playground showing the idea:</p>\n\n<p><a href=\"https://play.golang.org/p/0ThZlX9xUn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0ThZlX9xUn</a></p>\n"}], "owner": {"reputation": 387, "user_id": 4777642, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c9f699765f124ae794d7393348c91467?s=128&d=identicon&r=PG&f=1", "display_name": "mg03", "link": "https://stackoverflow.com/users/4777642/mg03"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2134, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1500857249, "creation_date": 1500854611, "question_id": 45270992, "link": "https://stackoverflow.com/questions/45270992/go-map-search-using-values-in-a-map", "title": "go map search using values in a map", "body": "<p>I have a map structured like map[string][]string. Now I have to find all keys which have the required values in the value slice. I can do something like this:</p>\n\n<pre><code>// allsvc is map[string][]string\nvar newsl []string\n\n\n    for k, v :=  range  allsvc {\n        for _, val := range v {\n            if v == \"type1\" || v == \"type2\" {\n                newsl.append(k)\n            }\n        }\n\n    }\n</code></pre>\n\n<p>The map allsvc has atleast a half million entries at any given time, and the lookup is quite frequent. I get the allsvc map as an ouput of a 3rd party library and then I have to search in it using values in my api and provide a response. Given the high frequency of lookup not using keys but with values, the way i have done it makes my api response time to be in the seconds. Is there a way to better performance (speed of lookup)? </p>\n"}, {"tags": ["go", "buffer"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500845755, "post_id": 45270023, "comment_id": 77503033, "body": "you aren&#39;t checking the error on line <code>fi, _ := os.Open(fn)</code> how do you know it even opens.. it could silently fail."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1500846266, "post_id": 45270134, "comment_id": 77503157, "body": "<code>os.Create</code> would be simpler if the file is simply being written and the contents should be discarded if it already exists. If it&#39;s being read and written, or if it needs to opened for appending, then <code>os.OpenFile</code> is definitely the way to go."}], "tags": [], "owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "is_accepted": true, "score": 5, "last_activity_date": 1506535317, "last_edit_date": 1506535317, "creation_date": 1500845918, "answer_id": 45270134, "question_id": 45270023, "link": "https://stackoverflow.com/questions/45270023/writing-buffer-to-file-doesnt-return-error-so-why-is-file-empty-afterwords/45270134#45270134", "title": "Writing buffer to file doesn&#39;t return error, so why is file empty afterwords?", "body": "<p><code>Open</code> opens a file in read-only mode.<br>\nRefer to documentation: <a href=\"https://golang.org/pkg/os/#Open\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#Open</a></p>\n\n<p>Instead, use <a href=\"https://golang.org/pkg/os/#OpenFile\" rel=\"nofollow noreferrer\"><code>OpenFile</code></a>.</p>\n\n<p>Also, always check for errors whenever you code. It'll save you at least weeks of work-hours in your lifetime.</p>\n\n<p>Here is a working code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    fn := os.Args[1]\n    var input bytes.Buffer\n    scanner := bufio.NewScanner(os.Stdin)\n\n    for scanner.Scan() {\n        fmt.Fprintf(&amp;input, scanner.Text())\n        fmt.Fprintf(&amp;input, \"\\n\")\n    }\n\n    fmt.Println(input.Bytes())\n    fi, err := os.OpenFile(fn, os.O_RDWR|os.O_CREATE, 0755)\n\n    if err != nil {\n        fmt.Println(\"Error with Open()\",err)\n    }\n    defer fi.Close()\n\n    n, err := fi.Write(input.Bytes())\n    if err != nil {\n        fmt.Println(\"Error with Write()\", err)\n    }\n    fmt.Println(\"Bytes written to file: \",n)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1500846831, "post_id": 45270156, "comment_id": 77503303, "body": "You&#39;re correct that the errors should be checked, but the errors would merely be a symptom of the problem in this case. That said, the OP probably hasn&#39;t seen <code>ioutil.WriteFile</code> yet, so +1 for illustrating an alternative to <code>os.Create</code>/<code>os.OpenFile</code>."}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 1, "last_activity_date": 1500846107, "creation_date": 1500846107, "answer_id": 45270156, "question_id": 45270023, "link": "https://stackoverflow.com/questions/45270023/writing-buffer-to-file-doesnt-return-error-so-why-is-file-empty-afterwords/45270156#45270156", "title": "Writing buffer to file doesn&#39;t return error, so why is file empty afterwords?", "body": "<p>In your code you can silently fail because you aren't checking the error.  It's likely a path issue. You can change your code slightly and let <code>ioutil</code> handle file creation so that paths aren't so much of an issue. Remember to always check the errs</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    fn := os.Args[1]\n    var input bytes.Buffer\n    scanner := bufio.NewScanner(os.Stdin)\n\n    for scanner.Scan() {\n        fmt.Fprintf(&amp;input, scanner.Text())\n        fmt.Fprintf(&amp;input, \"\\n\")\n    }\n\n    err := ioutil.WriteFile(fn, input.Bytes(), 0644)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8354568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b6df5e91fc9f0a529e696d249e8ce58?s=128&d=identicon&r=PG&f=1", "display_name": "Carl JR", "link": "https://stackoverflow.com/users/8354568/carl-jr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 536, "favorite_count": 0, "accepted_answer_id": 45270134, "answer_count": 2, "score": 0, "last_activity_date": 1506535317, "creation_date": 1500844983, "question_id": 45270023, "link": "https://stackoverflow.com/questions/45270023/writing-buffer-to-file-doesnt-return-error-so-why-is-file-empty-afterwords", "title": "Writing buffer to file doesn&#39;t return error, so why is file empty afterwords?", "body": "<p>While learning Go I'm trying to read all standard input and write it to a file. I'm sorry if this is a vague question, but I've spent a lot of time going over this code and I can't for the life of me understand why it's writing nothing to the file provided. Can someone please shed some light on what's wrong here?</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"bytes\"\n    \"fmt\"\n    \"bufio\"\n)\n\nfunc main() {\n    fn := os.Args[1]\n    var input bytes.Buffer\n    scanner := bufio.NewScanner(os.Stdin)\n\n    for scanner.Scan() {\n        fmt.Fprintf(&amp;input, scanner.Text())\n        fmt.Fprintf(&amp;input, \"\\n\")\n    }   \n\n    fi, _ := os.Open(fn)\n    defer fi.Close()\n\n    fi.Write(input.Bytes())\n}\n</code></pre>\n\n<p>And then...</p>\n\n<pre><code>touch writetothis.txt\necho \"input text\" | go run main.go writetothis.txt\n# writetothis.txt is empty\n</code></pre>\n"}, {"tags": ["mongodb", "postgresql", "go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500843176, "post_id": 45269528, "comment_id": 77502413, "body": "How are you getting your mongo session.. I don&#39;t see calls to session.Copy() or Session.Clone()... where Clone() can block because of the use of a shared socket."}, {"owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "edited": false, "score": 0, "creation_date": 1500844049, "post_id": 45269528, "comment_id": 77502615, "body": "Are you sure you have started consumer and producer in different goroutines?"}, {"owner": {"reputation": 10994, "user_id": 164165, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/3f8abbd6de5ad8ad92f59dd94eda9603?s=128&d=identicon&r=PG", "display_name": "Erik", "link": "https://stackoverflow.com/users/164165/erik"}, "edited": false, "score": 0, "creation_date": 1500876786, "post_id": 45269528, "comment_id": 77509938, "body": "I have edited my question to answer your comments"}, {"owner": {"reputation": 10994, "user_id": 164165, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/3f8abbd6de5ad8ad92f59dd94eda9603?s=128&d=identicon&r=PG", "display_name": "Erik", "link": "https://stackoverflow.com/users/164165/erik"}, "edited": false, "score": 0, "creation_date": 1500910745, "post_id": 45269528, "comment_id": 77531694, "body": "Added the dump to the question. Looking at the <i>writer</i> goroutine it loos like it pauses when the GC jumps in"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1500919345, "post_id": 45269528, "comment_id": 77536633, "body": "Perhaps <code>GenerateInsert</code> is taking a long time to execute. How many rows and columns are there?"}, {"owner": {"reputation": 10994, "user_id": 164165, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/3f8abbd6de5ad8ad92f59dd94eda9603?s=128&d=identicon&r=PG", "display_name": "Erik", "link": "https://stackoverflow.com/users/164165/erik"}, "edited": false, "score": 0, "creation_date": 1500925059, "post_id": 45269528, "comment_id": 77539778, "body": "Only 200, so not so many, should be a matter of seconds"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1500939495, "post_id": 45269528, "comment_id": 77545579, "body": "FWIW,  the stack dumps show that the goroutine is not blocked on map access.  Also, build the string up in a []byte instead of using string concatenation.  The latter allocates a large amount of memory."}], "answers": [{"tags": [], "owner": {"reputation": 10994, "user_id": 164165, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/3f8abbd6de5ad8ad92f59dd94eda9603?s=128&d=identicon&r=PG", "display_name": "Erik", "link": "https://stackoverflow.com/users/164165/erik"}, "is_accepted": false, "score": 0, "last_activity_date": 1500958079, "creation_date": 1500958079, "answer_id": 45294147, "question_id": 45269528, "link": "https://stackoverflow.com/questions/45269528/goroutine-blocks-on-accessing-map/45294147#45294147", "title": "Goroutine blocks on accessing map", "body": "<p>The problem is the garbage collector, which can be seen from the stack trace (after sending SIGQUIT to the program):</p>\n\n<pre><code>goroutine 37 [running]:\nruntime.systemstack_switch()\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/asm_amd64.s:281 fp=0xc420145608 sp=0xc420145600\nruntime.gcStart(0x0, 0xc420366000)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/mgc.go:1010 +0x208 fp=0xc420145640 sp=0xc420145608\nruntime.mallocgc(0x2500, 0x0, 0xc420106100, 0xc420145728)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/malloc.go:785 +0x491 fp=0xc4201456e0 sp=0xc420145640\nruntime.rawstring(0x20e9, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/string.go:237 +0x85 fp=0xc420145710 sp=0xc4201456e0\nruntime.rawstringtmp(0x0, 0x20e9, 0x29, 0xc4201457c0, 0xc4200bdb80, 0xc420106ff0, 0xc420106120)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/string.go:107 +0x78 fp=0xc420145750 sp=0xc420145710\nruntime.concatstrings(0x0, 0xc420145830, 0x2, 0x2, 0xc420106ff0, 0xc4201b8000)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/string.go:46 +0xf9 fp=0xc4201457e8 sp=0xc420145750\nruntime.concatstring2(0x0, 0xc42051d900, 0x20c0, 0xc420106ff0, 0x29, 0xc420106ff0, 0x29)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/string.go:55 +0x47 fp=0xc420145828 sp=0xc4201457e8\n_/Users/erikmuttersbach/Projects/mongo2psql-go/db.GenerateInsert(0xc4200c9730, 0x4, 0xc4200c9650, 0x4, 0xc4200e1860, 0x1, 0x4, 0xc42006c400, 0x3, 0x4, ...)\n    /Users/erikmuttersbach/Projects/mongo2psql-go/db/sql.go:27 +0x407 fp=0xc420145a10 sp=0xc420145828\nmain.writer(0xc4200e01a0, 0xc42015ccc0, 0xc420014320)\n    /Users/erikmuttersbach/Projects/mongo2psql-go/main.go:112 +0x3b4 fp=0xc420145fc8 sp=0xc420145a10\nruntime.goexit()\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/asm_amd64.s:2197 +0x1 fp=0xc420145fd0 sp=0xc420145fc8\ncreated by main.main\n    /Users/erikmuttersbach/Projects/mongo2psql-go/main.go:202 +0x135\n</code></pre>\n\n<p>The line <code>runtime.gcStart(0x0, 0xc420366000)</code> more specifically hints you to the fact that the GC wants to kick-in, but is blocked. \nThe GC in fact was blocked, because I started my \"never ending\" go routines like this:</p>\n\n<pre><code>func main() {\n...\ngo writer()\ngo producer()\n\nfor {}\n}\n</code></pre>\n\n<p>The infinite <code>for</code> loop blocks the proc and lets the garbage collector never time to kick in.</p>\n"}], "owner": {"reputation": 10994, "user_id": 164165, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/3f8abbd6de5ad8ad92f59dd94eda9603?s=128&d=identicon&r=PG", "display_name": "Erik", "link": "https://stackoverflow.com/users/164165/erik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1500958079, "creation_date": 1500841074, "last_edit_date": 1500910423, "question_id": 45269528, "link": "https://stackoverflow.com/questions/45269528/goroutine-blocks-on-accessing-map", "title": "Goroutine blocks on accessing map", "body": "<p>The following code snippets are taken from a program that aims at reading documents from a MongoDB and writing them to a Postgres database.\nThe program is implemented using the producer/consumer pattern: A <em>producer</em> Goroutine reads from Mongo and sends the documents fetched to a \nchannel.<br>\nThe <em>consumer</em> Goroutine reads from the channel, constructs an <code>INSERT INTO</code> sql statement and inserts the data into the Postgres database.</p>\n\n<p>Unfortunately the <em>consumer</em> seems to block indeterministically. I believe it happens when a <code>map</code> data structure that gets passed over a <code>chan</code> from <em>producer</em> to <em>consumer</em> is accessed, but can't tell for sure.</p>\n\n<p>The simplified code of the producer:</p>\n\n<pre><code>func producer(ops chan BatchOp, ...) {\n    // Iterate over all tables that we want to fetch documents from\n    for _, table := range schema.Schema[0].Tables {\n\n        // Run some aggregation to fetch the documents and create an iterator\n        pipe := mongoDb.C(table.Collection).Pipe(table.Pipeline)\n        iter := pipe.Batch(200).AllowDiskUse().Iter()\n\n        const RESULTS_BUFFER_SIZE = 200\n\n\n        result := bson.M{}\n        results := make([]bson.M, 0, RESULTS_BUFFER_SIZE)\n\n        // The flush function sends a batch of data into the channel\n        flush := func() {\n            fmt.Printf(\"Flushing %d items\\n\", len(results))\n            ops &lt;- BatchOp{\n                Insert,\n                table.Collection,\n                results,\n            }\n            results = make([]bson.M, 0, RESULTS_BUFFER_SIZE)\n        }\n\n        // Iterate over the results from MongoDB and append each document \n        // to the results slice\n        for iter.Next(&amp;result) {\n            results = append(results, bson.M{\n                \"_id\": result[\"_id\"],\n                \"name\": result[\"Name\"],\n                \"i\": result[\"i\"],\n            })\n\n            // ... flush the results slice as soon as its big enough\n            if len(results) == RESULTS_BUFFER_SIZE {\n                flush()\n            }\n        }\n\n        // Flush the last contents of the results slice\n        if len(results) &gt; 0 {\n            flush()\n        }\n\n        if err := iter.Close(); err != nil {\n            panic(err)\n        }\n    }\n}\n\n\ntype BatchOp struct {\n    data       []bson.M // bson.M is defined as: type M map[string]interface{} \n}\nops := make(chan BatchOp)\n</code></pre>\n\n<p>Unfortunately the program blocks indeterministically when the <em>consumer</em> accesses the <code>data</code>:</p>\n\n<pre><code>func writer(schema *db.SchemaSchema, ops chan BatchOp, psql *sql.DB) {\n    // ...\n\n    for {\n        op := &lt;-ops\n\n        fmt.Printf(\"Writing %d rows\\n\", len(op.data))\n        _, err := psql.Exec(db.GenerateInsert(table, op.data))\n        // ...\n        fmt.Printf(\"Wrote %d rows\\n\", len(op.data))\n    }\n}\n\n// Generate the INSERT INTO statement for a slice of documents from MongoDB\nfunc GenerateInsert(table Table, data []bson.M) (sql string) {\n    sql = fmt.Sprintf(`INSERT INTO \"%s\" (`, table.Table)\n    for i, column := range table.Columns {\n        sql += `\"` + column.SqlName + `\"`\n        if i &lt; len(table.Columns)-1 {\n            sql += \", \"\n        }\n    }\n\n    sql += \") VALUES \"\n    for i, row := range data {\n        sql += \"(\"\n        for j, column := range table.Columns {\n\n            // !!!!!! THIS !!!!!!! is the row that blocks and would just not get called sometimes\n            switch v := row[column.Name].(type) {\n            case nil:\n                sql += \"NULL\"\n            case int:\n                sql += fmt.Sprintf(`%v`, v)\n            default:\n                sql += fmt.Sprintf(`'%v'`, v)\n            }\n\n            if j &lt; len(table.Columns)-1 {\n                sql += \", \"\n            }\n        }\n        sql += \")\"\n\n        if i &lt; len(data)-1 {\n            sql += \", \"\n        }\n    }\n\n    return sql\n}\n</code></pre>\n\n<ul>\n<li>What could be problems that lead this statement <code>row[column.Name]</code> to block? I believe it has to do with the fact that a deeply hierarchical <code>map</code> is sent over a chan.</li>\n<li>How could I have debugged this? GDB?</li>\n<li>Is it best practice to implement producer-consumer like this?</li>\n</ul>\n\n<p><strong>Edit July 24</strong><br>\n * The reference to the full code, since commenters asked for it: <a href=\"https://github.com/erikmuttersbach/mongo2psql\" rel=\"nofollow noreferrer\">https://github.com/erikmuttersbach/mongo2psql</a>    </p>\n\n<ul>\n<li>Sample output that lead me to the conclusion that the code blocks: \nWhen I run <code>go run insert.go</code> 1111 documents are inserted into the <code>foos</code> collection.<br>\nWhen I subsequently run <code>go run main.go</code> I get the following output:\n<code>Creating table foos\nCreating table bars\nSeeding table foos from collection foos\nFlushing 200 items\nWriting 200 rows\nFlushing 200 items\nWrote 200 rows\nWriting 200 rows\nFlushing 200 items\nWrote 200 rows\nWriting 200 rows\nFlushing 200 items\nWrote 200 rows\nWriting 200 rows\nFlushing 200 items\nWrote 200 rows\nWriting 200 rows\nFlushing 111 items\nWrote 200 rows\nWriting 111 rows\nSeeding table bars from collection bars\nSeeding done</code><br>\nAfter the line <code>Writing 111 rows</code> I would expect another line <code>Wrote 111 rows</code> that does not appear (it also only happens sometimes).<br>\nYou CAN get <code>Wrote 111 rows</code> to show, when you replace the function body of <code>GenerateInsert</code> with a simple <code>return \"SELECT 1\"</code>. As access to the channel messages is omitted in this case I assumed that it has to do with the access to the <code>data</code> of the channel messages.</li>\n</ul>\n\n<p>** Edit July 24 (2)**\nWhen I kill the program with SIGQUIT, I get the following output:</p>\n\n<pre><code>^\\SIGQUIT: quit\nPC=0x10566a3 m=0 sigcode=0\n\ngoroutine 0 [idle]:\nruntime.mach_semaphore_timedwait(0xf03, 0x186a0, 0x7fff5fbff3ec, 0x0, 0x186a05fbff428, 0x1455b60, 0x7fff5fbff420, 0x1050d63, 0x186a0, 0xffffffff, ...)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/sys_darwin_amd64.s:425 +0x13\nruntime.semasleep1(0x186a0, 0xffffffff)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/os_darwin.go:402 +0xe1\nruntime.semasleep.func1()\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/os_darwin.go:432 +0x33\nruntime.systemstack(0x7fff5fbff448)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/asm_amd64.s:343 +0xab\nruntime.semasleep(0x186a0, 0xffffffff)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/os_darwin.go:433 +0x4d\nruntime.notetsleep_internal(0x1455808, 0x186a0, 0x1455b60, 0x14d44e02e4b89c75, 0x1455b00)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/lock_sema.go:198 +0x79\nruntime.notetsleep(0x1455808, 0x186a0, 0x0)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/lock_sema.go:246 +0x75\nruntime.stopTheWorldWithSema()\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/proc.go:1029 +0x274\nruntime.systemstack(0x1455b00)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/asm_amd64.s:327 +0x79\nruntime.mstart()\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/proc.go:1132\n\ngoroutine 26 [running]:\nruntime.systemstack_switch()\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/asm_amd64.s:281 fp=0xc42004d608 sp=0xc42004d600\nruntime.gcStart(0x0, 0x12ec200)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/mgc.go:1010 +0x208 fp=0xc42004d640 sp=0xc42004d608\nruntime.mallocgc(0x2000, 0x0, 0xc420114300, 0xc420248000)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/malloc.go:785 +0x491 fp=0xc42004d6e0 sp=0xc42004d640\nruntime.rawstring(0x1f60, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/string.go:237 +0x85 fp=0xc42004d710 sp=0xc42004d6e0\nruntime.rawstringtmp(0x0, 0x1f60, 0x13, 0x1f5e, 0xc420248000, 0x1f5e, 0x1f5e)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/string.go:107 +0x78 fp=0xc42004d750 sp=0xc42004d710\nruntime.concatstrings(0x0, 0xc42004d830, 0x2, 0x2, 0xc420248000, 0x1f5e)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/string.go:46 +0xf9 fp=0xc42004d7e8 sp=0xc42004d750\nruntime.concatstring2(0x0, 0xc420248000, 0x1f5e, 0x130caaa, 0x2, 0xc420248000, 0x1f5e)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/string.go:55 +0x47 fp=0xc42004d828 sp=0xc42004d7e8\n_/Users/erikmuttersbach/Projects/mongo2psql-go/db.GenerateInsert(0xc420103870, 0x4, 0xc420103790, 0x4, 0xc4201098c0, 0x1, 0x4, 0xc420124100, 0x3, 0x4, ...)\n    /Users/erikmuttersbach/Projects/mongo2psql-go/db/sql.go:31 +0x46f fp=0xc42004da10 sp=0xc42004d828\nmain.writer(0xc420108200, 0xc4200728a0, 0xc4200c0280)\n    /Users/erikmuttersbach/Projects/mongo2psql-go/main.go:111 +0x3b4 fp=0xc42004dfc8 sp=0xc42004da10\nruntime.goexit()\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/asm_amd64.s:2197 +0x1 fp=0xc42004dfd0 sp=0xc42004dfc8\ncreated by main.main\n    /Users/erikmuttersbach/Projects/mongo2psql-go/main.go:181 +0x135\n\ngoroutine 1 [running]:\n    goroutine running on other thread; stack unavailable\n\ngoroutine 17 [syscall, 10 minutes, locked to thread]:\nruntime.goexit()\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/asm_amd64.s:2197 +0x1\n\ngoroutine 20 [chan receive, 10 minutes]:\ndatabase/sql.(*DB).connectionOpener(0xc4200c0280)\n    /usr/local/Cellar/go/1.8.3/libexec/src/database/sql/sql.go:837 +0x4a\ncreated by database/sql.Open\n    /usr/local/Cellar/go/1.8.3/libexec/src/database/sql/sql.go:582 +0x212\n\ngoroutine 22 [sleep, 10 minutes]:\ntime.Sleep(0x1dcd6500)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/time.go:59 +0xf9\ngopkg.in/mgo%2ev2.(*mongoCluster).syncServersLoop(0xc42006c500)\n    /Users/erikmuttersbach/go/src/gopkg.in/mgo.v2/cluster.go:368 +0x471\ncreated by gopkg.in/mgo%2ev2.newCluster\n    /Users/erikmuttersbach/go/src/gopkg.in/mgo.v2/cluster.go:78 +0x188\n\ngoroutine 50 [sleep, 10 minutes]:\ntime.Sleep(0x37e11d600)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/time.go:59 +0xf9\ngopkg.in/mgo%2ev2.(*mongoServer).pinger(0xc42010e000, 0x1)\n    /Users/erikmuttersbach/go/src/gopkg.in/mgo.v2/server.go:301 +0x293\ncreated by gopkg.in/mgo%2ev2.newServer\n    /Users/erikmuttersbach/go/src/gopkg.in/mgo.v2/server.go:89 +0x166\n\ngoroutine 25 [select, 10 minutes]:\nmain.tailer(0xc4200728a0, 0xc4200fe0a0)\n    /Users/erikmuttersbach/Projects/mongo2psql-go/main.go:67 +0x4d0\ncreated by main.main\n    /Users/erikmuttersbach/Projects/mongo2psql-go/main.go:180 +0xff\n\ngoroutine 38 [IO wait]:\nnet.runtime_pollWait(0x1664df0, 0x72, 0xa)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/netpoll.go:164 +0x59\nnet.(*pollDesc).wait(0xc42006f5d8, 0x72, 0x1438e40, 0x14363d0)\n    /usr/local/Cellar/go/1.8.3/libexec/src/net/fd_poll_runtime.go:75 +0x38\nnet.(*pollDesc).waitRead(0xc42006f5d8, 0xc42007d6b0, 0x24)\n    /usr/local/Cellar/go/1.8.3/libexec/src/net/fd_poll_runtime.go:80 +0x34\nnet.(*netFD).Read(0xc42006f570, 0xc42007d6b0, 0x24, 0x24, 0x0, 0x1438e40, 0x14363d0)\n    /usr/local/Cellar/go/1.8.3/libexec/src/net/fd_unix.go:250 +0x1b7\nnet.(*conn).Read(0xc4200e0010, 0xc42007d6b0, 0x24, 0x24, 0x0, 0x0, 0x0)\n    /usr/local/Cellar/go/1.8.3/libexec/src/net/net.go:181 +0x70\ngopkg.in/mgo%2ev2.fill(0x143cce0, 0xc4200e0010, 0xc42007d6b0, 0x24, 0x24, 0x0, 0x53)\n    /Users/erikmuttersbach/go/src/gopkg.in/mgo.v2/socket.go:535 +0x53\ngopkg.in/mgo%2ev2.(*mongoSocket).readLoop(0xc420164000)\n    /Users/erikmuttersbach/go/src/gopkg.in/mgo.v2/socket.go:551 +0x107\ncreated by gopkg.in/mgo%2ev2.newSocket\n    /Users/erikmuttersbach/go/src/gopkg.in/mgo.v2/socket.go:194 +0x259\n\ngoroutine 3 [runnable]:\nnet.runtime_pollWait(0x1664eb0, 0x72, 0x9)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/netpoll.go:164 +0x59\nnet.(*pollDesc).wait(0xc4201060d8, 0x72, 0x1438e40, 0x14363d0)\n    /usr/local/Cellar/go/1.8.3/libexec/src/net/fd_poll_runtime.go:75 +0x38\nnet.(*pollDesc).waitRead(0xc4201060d8, 0xc4201000c0, 0x24)\n    /usr/local/Cellar/go/1.8.3/libexec/src/net/fd_poll_runtime.go:80 +0x34\nnet.(*netFD).Read(0xc420106070, 0xc4201000c0, 0x24, 0x24, 0x0, 0x1438e40, 0x14363d0)\n    /usr/local/Cellar/go/1.8.3/libexec/src/net/fd_unix.go:250 +0x1b7\nnet.(*conn).Read(0xc42000e010, 0xc4201000c0, 0x24, 0x24, 0x0, 0x0, 0x0)\n    /usr/local/Cellar/go/1.8.3/libexec/src/net/net.go:181 +0x70\ngopkg.in/mgo%2ev2.fill(0x143cce0, 0xc42000e010, 0xc4201000c0, 0x24, 0x24, 0x0, 0x0)\n    /Users/erikmuttersbach/go/src/gopkg.in/mgo.v2/socket.go:535 +0x53\ngopkg.in/mgo%2ev2.(*mongoSocket).readLoop(0xc420118000)\n    /Users/erikmuttersbach/go/src/gopkg.in/mgo.v2/socket.go:551 +0x107\ncreated by gopkg.in/mgo%2ev2.newSocket\n    /Users/erikmuttersbach/go/src/gopkg.in/mgo.v2/socket.go:194 +0x259\n\ngoroutine 52 [select, 10 minutes]:\ngithub.com/rwynn/gtm.FetchDocuments(0xc4200fe0a0, 0xc420063860, 0x131fa40, 0xc420100120, 0xc4201122a0, 0x0, 0x0)\n    /Users/erikmuttersbach/go/src/github.com/rwynn/gtm/gtm.go:498 +0x3a7\ncreated by github.com/rwynn/gtm.Start\n    /Users/erikmuttersbach/go/src/github.com/rwynn/gtm/gtm.go:673 +0x5fc\n\ngoroutine 53 [semacquire, 10 minutes]:\nsync.runtime_notifyListWait(0xc420150108, 0xc400000001)\n    /usr/local/Cellar/go/1.8.3/libexec/src/runtime/sema.go:298 +0x10b\nsync.(*Cond).Wait(0xc4201500f8)\n    /usr/local/Cellar/go/1.8.3/libexec/src/sync/cond.go:57 +0x89\ngopkg.in/mgo%2ev2.(*Iter).Next(0xc4201500f0, 0x12c45e0, 0xc42007d590, 0x0)\n    /Users/erikmuttersbach/go/src/gopkg.in/mgo.v2/session.go:3704 +0x9f\ngithub.com/rwynn/gtm.TailOps(0xc4200fe0a0, 0xc420063860, 0xc42010a008, 0x1, 0x1, 0xc420110090, 0x0, 0x0)\n    /Users/erikmuttersbach/go/src/github.com/rwynn/gtm/gtm.go:365 +0x1ea\ncreated by github.com/rwynn/gtm.Start\n    /Users/erikmuttersbach/go/src/github.com/rwynn/gtm/gtm.go:685 +0x8ea\n\nrax    0xe\nrbx    0x0\nrcx    0x7fff5fbff3c0\nrdx    0x186a0\nrdi    0xf03\nrsi    0x0\nrbp    0x7fff5fbff3f8\nrsp    0x7fff5fbff3c0\nr8     0x43a260\nr9     0x11\nr10    0x653ef1e26c7c\nr11    0x202\nr12    0x1ad50d58ee7b\nr13    0x1cbe784ba3b8\nr14    0x14d44e02db750c00\nr15    0x1\nrip    0x10566a3\nrflags 0x202\ncs     0x7\nfs     0x0\ngs     0x0\nexit status 2\n</code></pre>\n"}, {"tags": ["go", "slice", "in-place"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1500840930, "post_id": 45269506, "comment_id": 77501814, "body": "<code>removeDup</code> should return the new slice."}], "answers": [{"comments": [{"owner": {"reputation": 647, "user_id": 3917230, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/1e2e63f2fae2d66c1b77bb3ae464648c?s=128&d=identicon&r=PG&f=1", "display_name": "Photon Light", "link": "https://stackoverflow.com/users/3917230/photon-light"}, "edited": false, "score": 0, "creation_date": 1500846144, "post_id": 45269823, "comment_id": 77503122, "body": "I knew that returning new slice and assigning it to previously declared slice would do the work, but I wanted to do this in function. Pointers seems to be the desired solution, thank you! I&#39;ve got Python background, still can&#39;t get used to using pointers."}, {"owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "reply_to_user": {"reputation": 647, "user_id": 3917230, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/1e2e63f2fae2d66c1b77bb3ae464648c?s=128&d=identicon&r=PG&f=1", "display_name": "Photon Light", "link": "https://stackoverflow.com/users/3917230/photon-light"}, "edited": false, "score": 0, "creation_date": 1500849684, "post_id": 45269823, "comment_id": 77503951, "body": "You&#39;ll get them eventually and feel really dumb about yourself when you realize it&#39;s an awe(some/ful) concept in programming. That&#39;s what I felt! :)"}], "tags": [], "owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "is_accepted": true, "score": 4, "last_activity_date": 1500846545, "last_edit_date": 1500846545, "creation_date": 1500843266, "answer_id": 45269823, "question_id": 45269506, "link": "https://stackoverflow.com/questions/45269506/change-slice-content-and-capacity-inside-a-function-in-place/45269823#45269823", "title": "Change slice content and capacity inside a function in-place", "body": "<p><strong>Option 1</strong></p>\n\n<p>Return a new slice as suggested by @zerkms.<br>\n<a href=\"https://play.golang.org/p/uGJiD3WApS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uGJiD3WApS</a></p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc main() {\n    a := []int{0, 1, 1, 3, 3, 3}\n    a = removeDup(a)\n    fmt.Println(a)\n}\n\nfunc removeDup(s []int) []int {\n    n := len(s)\n    tmp := make([]int, 0, n)\n    tmp = append(tmp, s[0])\n    for i := 1; i &lt; n; i++ {\n        if s[i] != s[i-1] {\n            tmp = append(tmp, s[i])\n        }\n    }\n    return tmp\n}\n</code></pre>\n\n<p><strong>Option 2</strong><br>\nUse pointers for pass-by-reference.<br>\nThe same thing in effect as that of option1.  </p>\n\n<p><a href=\"https://play.golang.org/p/80bE5Qkuuj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/80bE5Qkuuj</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    a := []int{0, 1, 1, 3, 3, 3}\n    removeDup(&amp;a)\n    fmt.Println(a)\n}\n\nfunc removeDup(sp *[]int) {\n    s := *sp\n    n := len(s)\n    tmp := make([]int, 0, n)\n    tmp = append(tmp, s[0])\n    for i := 1; i &lt; n; i++ {\n        if s[i] != s[i-1] {\n            tmp = append(tmp, s[i])\n        }\n    }\n    *sp = tmp\n}\n</code></pre>\n\n<p>Also, refer to following SO thread:\n<a href=\"https://stackoverflow.com/questions/16748330/does-go-have-no-real-way-to-shrink-a-slice-is-that-an-issue\">Does Go have no real way to shrink a slice? Is that an issue?</a></p>\n"}, {"comments": [{"owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 0, "creation_date": 1500846744, "post_id": 45270027, "comment_id": 77503269, "body": "Just for the sake of curiosity, I want some feedback on the following thought-  While this is a perfectly acceptable solution to me as it makes the OOPSy, isn&#39;t it too much for such a case? Would it make sense to not have &#39;removeDup&#39; method associated with a type, but rather keep it in a separate??"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 0, "creation_date": 1500847123, "post_id": 45270027, "comment_id": 77503361, "body": "It might be overkill for such a small example, but what if this was a huge project, or what if you wanted to used this concurrently, or removeDups needed to operation on something more generic like an interface (we hope not), or removeDups is only one operation on a chain of operations that operate on a pointer.  On the larger project separation of types is easier to manage.  Concurrency can be handled by extending then named type was locks and semaphores. Chained pointer operations  are easier to write and maybe read. See here as well <a href=\"https://hunterloftis.github.io/2017/07/12/renamed-types/\" rel=\"nofollow noreferrer\">hunterloftis.github.io/2017/07/12/renamed-types</a>"}, {"owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 0, "creation_date": 1500847475, "post_id": 45270027, "comment_id": 77503446, "body": "Right, that makes sense, thanks for the detailed reply."}, {"owner": {"reputation": 647, "user_id": 3917230, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/1e2e63f2fae2d66c1b77bb3ae464648c?s=128&d=identicon&r=PG&f=1", "display_name": "Photon Light", "link": "https://stackoverflow.com/users/3917230/photon-light"}, "edited": false, "score": 0, "creation_date": 1500878200, "post_id": 45270027, "comment_id": 77510612, "body": "Thank you, looks like a nice answer, I just need some more go knowledge to understand ;)"}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 0, "last_activity_date": 1500845546, "last_edit_date": 1500845546, "creation_date": 1500845020, "answer_id": 45270027, "question_id": 45269506, "link": "https://stackoverflow.com/questions/45269506/change-slice-content-and-capacity-inside-a-function-in-place/45270027#45270027", "title": "Change slice content and capacity inside a function in-place", "body": "<p>Here's two more slightly different ways to achieve what you want using sets and named types.  The cool thing about named types is that you can create interfaces around them and can help with the readability of lots of code.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    // returning a list\n    a := []int{0, 1, 1, 3, 3, 3}\n    clean := removeDup(a)\n    fmt.Println(clean)\n    // creating and using a named type\n    nA := &amp;newArrType{0, 1, 1, 3, 3, 3}\n    nA.removeDup2()\n    fmt.Println(nA)\n\n    // or... casting your orginal array to the named type\n    nB := newArrType(a)\n    nB.removeDup2()\n    fmt.Println(nB)\n}\n\n// using a set\n// order is not kept, but a set is returned\nfunc removeDup(s []int) (newArr []int) {\n    set := make(map[int]struct{})\n    for _, n := range s {\n        set[n] = struct{}{}\n    }\n    newArr = make([]int, 0, len(set))\n    for k := range set {\n        newArr = append(newArr, k)\n    }\n    return\n}\n\n// using named a typed\ntype newArrType []int\n\nfunc (a *newArrType) removeDup2() {\n    x := *a\n    for i := range x {\n        f := i + 1\n        if f &lt; len(x) {\n            if x[i] == x[f] {\n                x = x[:f+copy(x[f:], x[f+1:])]\n            }\n        }\n    }\n    // check the last 2 indexes\n    if x[len(x)-2] == x[len(x)-1] {\n        x = x[:len(x)-1+copy(x[len(x)-1:], x[len(x)-1+1:])]\n    }\n    *a = x\n}\n</code></pre>\n"}], "owner": {"reputation": 647, "user_id": 3917230, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/1e2e63f2fae2d66c1b77bb3ae464648c?s=128&d=identicon&r=PG&f=1", "display_name": "Photon Light", "link": "https://stackoverflow.com/users/3917230/photon-light"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 532, "favorite_count": 0, "accepted_answer_id": 45269823, "answer_count": 2, "score": 1, "last_activity_date": 1500846584, "creation_date": 1500840867, "last_edit_date": 1500846584, "question_id": 45269506, "link": "https://stackoverflow.com/questions/45269506/change-slice-content-and-capacity-inside-a-function-in-place", "title": "Change slice content and capacity inside a function in-place", "body": "<p>I am trying to learn Go, so here is my very simple function for removing adjacent duplicates from slice for exercise from the book by Donovan &amp; Kernighan.<br>\nHere is the code: <a href=\"https://play.golang.org/p/avHc1ixfck\" rel=\"nofollow noreferrer\">https://play.golang.org/p/avHc1ixfck</a></p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc main() {\n    a := []int{0, 1, 1, 3, 3, 3}\n    removeDup(a)\n    fmt.Println(a)\n}\n\nfunc removeDup(s []int) {\n    n := len(s)\n    tmp := make([]int, 0, n)\n    tmp = append(tmp, s[0])\n    j := 1\n    for i := 1; i &lt; n; i++ {\n        if s[i] != s[i-1] {\n            tmp = append(tmp, s[i])\n            j++\n        }\n    }\n    s = s[:len(tmp)]\n    copy(s, tmp)\n}\n</code></pre>\n\n<p>It should print out <code>[0 1 3]</code> - and I checked, actually <code>tmp</code> at the end of the function it has desired form. However, the result is <code>[0 1 3 3 3 3]</code>. I guess there is something with <code>copy</code> function.  </p>\n\n<p>Can I somehow replace input slice <code>s</code> with the <code>temp</code> or trim it to desired length?</p>\n"}, {"tags": ["go", "random", "numbers", "generator", "seed"], "answers": [{"comments": [{"owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 1, "creation_date": 1500848878, "post_id": 45269323, "comment_id": 77503771, "body": "Is it possible to seed without relying on time? Playground has a deterministic behavior for above code because the time in playground always starts at 2009-11-10 23:00:00 UTC. So, while this code would work on most platforms, it fails to produce a random seed for rand."}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 0, "creation_date": 1500851000, "post_id": 45269323, "comment_id": 77504199, "body": "@hbagdi <code>rand.Seed</code> takes <code>int64</code>, so we can supply any compatible value other than time. Time is typically used for examples and sometimes as actually seed value too."}, {"owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 0, "creation_date": 1500851797, "post_id": 45269323, "comment_id": 77504327, "body": "How would you automate such a random in64 behavior for the random generator seed itself?"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 0, "creation_date": 1500852320, "post_id": 45269323, "comment_id": 77504428, "body": "@hbagdi What do you mean by automate? I didn&#39;t get your question. Can you please explain?"}, {"owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 0, "creation_date": 1500852448, "post_id": 45269323, "comment_id": 77504460, "body": "Is there another way truly random way to seed the random generator other than using time?"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 0, "creation_date": 1500855959, "post_id": 45269323, "comment_id": 77505077, "body": "Yes, you can use package <code>crypto&#47;rand</code> to generate random number (which internally uses <code>&#47;dev&#47;urandom</code> on *nix systems) and seed it to <code>rand.Seed</code>."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 1, "creation_date": 1500886532, "post_id": 45269323, "comment_id": 77514681, "body": "@jeevatkm, The topic&#39;s starter asked about seeding random randomly in the Go Playground what is not possible as far as I know. See my answer."}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1500910087, "post_id": 45269323, "comment_id": 77531289, "body": "@AlexanderTrakhimenok Thanks for your comment. I have added further explanation and one more example to the answer."}], "tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 8, "last_activity_date": 1573968601, "last_edit_date": 1573968601, "creation_date": 1500839639, "answer_id": 45269323, "question_id": 45268998, "link": "https://stackoverflow.com/questions/45268998/how-do-i-seed-random-number-generator-on-official-tour-of-go/45269323#45269323", "title": "How do I Seed random number generator on official Tour of Go?", "body": "<p>By default <code>rand.Intn</code> uses the <a href=\"https://github.com/golang/go/blob/master/src/math/rand/rand.go#L277\" rel=\"nofollow noreferrer\">globalRand.Intn</a>. Its created internally, <a href=\"https://github.com/golang/go/blob/master/src/math/rand/rand.go#L236\" rel=\"nofollow noreferrer\">refer here</a>. So when you set via <a href=\"https://github.com/golang/go/blob/master/src/math/rand/rand.go#L243\" rel=\"nofollow noreferrer\">rand.Seed</a></p>\n\n<pre><code>rand.Seed(time.Now().UTC().UnixNano())\n</code></pre>\n\n<p>Then <code>globalRand</code> uses the new seed value.</p>\n\n<p>When needed you can create your own rand generator with seed value. Refer to <a href=\"https://golang.org/pkg/math/rand/#example__rand\" rel=\"nofollow noreferrer\">godoc example</a>.</p>\n\n<hr>\n\n<p>Play Link (without seed): <a href=\"https://play.golang.org/p/2yg7xjvHoJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2yg7xjvHoJ</a></p>\n\n<p>Output:</p>\n\n<pre><code>My favorite number is 1\nMy favorite number is 7\nMy favorite number is 7\nMy favorite number is 9\nMy favorite number is 1\nMy favorite number is 8\nMy favorite number is 5\nMy favorite number is 0\nMy favorite number is 6\n</code></pre>\n\n<hr>\n\n<p>Play Link (with seed): <a href=\"https://play.golang.org/p/EpW6R5rvM4\" rel=\"nofollow noreferrer\">https://play.golang.org/p/EpW6R5rvM4</a></p>\n\n<p>Output:</p>\n\n<pre><code>My favorite number is 0\nMy favorite number is 8\nMy favorite number is 7\nMy favorite number is 2\nMy favorite number is 3\nMy favorite number is 9\nMy favorite number is 4\nMy favorite number is 7\nMy favorite number is 8\n</code></pre>\n\n<hr>\n\n<p><strong>EDIT:</strong></p>\n\n<p>As @AlexanderTrakhimenok mentioned, in playground program execution is <code>deterministic</code>. However, the playground doesn't stop you from supplying <code>rand.Seed</code> value. </p>\n\n<p>Remember Seed value is <code>int64</code>.</p>\n\n<p>When you <code>rand.Intn</code>, it uses default seed value <code>1</code> for <code>globalRand</code>.</p>\n\n<pre><code>var globalRand = New(&amp;lockedSource{src: NewSource(1).(Source64)})\n</code></pre>\n\n<p>And in playground <code>time.Now().UTC().UnixNano()</code> gives you same value <code>1257894000000000000</code> since <code>the start time is locked to a constant</code>. But it is different from default seed value, <strong><em>that's why second playground link produces the different result</em></strong>.</p>\n\n<p>So above two would produce the same result always.</p>\n\n<p><strong>How should we change the result in playground?</strong></p>\n\n<p>Yes, we can. Let's supply <code>UnixNano()</code> value <code>1500909006430687579</code> to <code>rand.Seed</code>, which is generated from my machine.</p>\n\n<p>Play Link: <a href=\"https://play.golang.org/p/-nTydej8YF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-nTydej8YF</a></p>\n\n<p>Output:</p>\n\n<pre><code>My favorite number is 3\nMy favorite number is 5\nMy favorite number is 3\nMy favorite number is 8\nMy favorite number is 0\nMy favorite number is 5\nMy favorite number is 4\nMy favorite number is 7\nMy favorite number is 1\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 5, "last_activity_date": 1500886416, "creation_date": 1500886416, "answer_id": 45276177, "question_id": 45268998, "link": "https://stackoverflow.com/questions/45268998/how-do-i-seed-random-number-generator-on-official-tour-of-go/45276177#45276177", "title": "How do I Seed random number generator on official Tour of Go?", "body": "<p>As you quoted yourself:</p>\n\n<blockquote>\n  <p>the environment in which these programs are executed is deterministic.</p>\n</blockquote>\n\n<p>So the <a href=\"https://play.golang.org/\" rel=\"noreferrer\">Go Playground</a> by design does not allow to create truly pseudo-random outputs.</p>\n\n<p>This is done intentionally for purpose of caching results to minimize CPU/memory usage for consequent runs. So the engine can evaluate your program just once and serve the same cached output every time when you or anyone else run it again.</p>\n\n<p>For the same purpose the start time is locked to a constant.</p>\n\n<p>You may want to read a blog post on how and why it's implemented this way: <a href=\"https://blog.golang.org/playground\" rel=\"noreferrer\">https://blog.golang.org/playground</a></p>\n"}], "owner": {"reputation": 445, "user_id": 7618122, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/7b7a75b55bdfd81040cc4c981e380541?s=128&d=identicon&r=PG", "display_name": "jonsanders101", "link": "https://stackoverflow.com/users/7618122/jonsanders101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4109, "favorite_count": 1, "accepted_answer_id": 45269323, "answer_count": 2, "score": 10, "last_activity_date": 1573968601, "creation_date": 1500837352, "question_id": 45268998, "link": "https://stackoverflow.com/questions/45268998/how-do-i-seed-random-number-generator-on-official-tour-of-go", "title": "How do I Seed random number generator on official Tour of Go?", "body": "<p>The official tour of Go gives the following code in the sandbox:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n)\n\nfunc main() {\n    fmt.Println(\"My favorite number is\", rand.Intn(10))\n}\n</code></pre>\n\n<p>And this instruction:</p>\n\n<blockquote>\n  <p>Note: the environment in which these programs are executed is deterministic, so each time you run the example program rand.Intn will return the same number. (To see a different number, seed the number generator; see rand.Seed.)</p>\n</blockquote>\n\n<p>After reading the entry under the official documentation for <a href=\"https://golang.org/pkg/math/rand/#Seed\" rel=\"noreferrer\">rand.Seed</a> and reading <a href=\"https://stackoverflow.com/questions/12321133/golang-random-number-generator-how-to-seed-properly\">this answer</a>, I still can't correctly seed the random number generator.</p>\n\n<p>Can someone please demonstrate how the rand.Seed function should be used to seed the random number generator?</p>\n\n<p>Many thanks,\nJon</p>\n"}, {"tags": ["go", "switch-statement", "fall-through"], "comments": [{"owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 1, "creation_date": 1500835413, "post_id": 45268681, "comment_id": 77500061, "body": "Read the doc: <a href=\"https://golang.org/doc/effective_go.html#switch\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#switch</a>  &quot;There is no automatic fall through, but cases can be presented in comma-separated lists.&quot;"}, {"owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "reply_to_user": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 0, "creation_date": 1500835909, "post_id": 45268681, "comment_id": 77500233, "body": "sure, but I want to do different things in each of those cases. and I used an explicit <code>fallthrough</code>.  Seems like the <code>fallthrough</code> statement makes <code>case 2==1</code> dead code."}, {"owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "edited": false, "score": 0, "creation_date": 1500836144, "post_id": 45268681, "comment_id": 77500311, "body": "Right, that&#39;s a missing piece in the documentation."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1500836227, "post_id": 45268681, "comment_id": 77500333, "body": "@ScottStensland: The conditions are in the <code>case</code>s. This is completely valid."}, {"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1500836531, "post_id": 45268681, "comment_id": 77500415, "body": "what bothers me is that 2 == 1 is never true so should never be chosen ... this implies the fallthrough says to ignore the following case&#39;s test and just blindly switch into it even when its case test is false ... bug ? ... to me a followthrough should continue checking following case tests for next true case not simply jump into body of following case block skipping its test"}, {"owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "reply_to_user": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 1, "creation_date": 1500836842, "post_id": 45268681, "comment_id": 77500516, "body": "@ScottStensland yeah, that&#39;s exactly why I asked"}], "answers": [{"comments": [{"owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "edited": false, "score": 1, "creation_date": 1500836377, "post_id": 45268807, "comment_id": 77500380, "body": "I don&#39;t disagree, and certainly there must be a reason for designing it that way - that&#39;s what I&#39;m really asking.  maybe the answer is &quot;its different than a bunch of if&#39;s, and we already have that&quot; but it would be cool to understand the type of case that makes this construct very useful."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 3, "last_activity_date": 1500836177, "creation_date": 1500836177, "answer_id": 45268807, "question_id": 45268681, "link": "https://stackoverflow.com/questions/45268681/golangs-fallthrough-seems-unexpected/45268807#45268807", "title": "golang&#39;s fallthrough seems unexpected", "body": "<p>From the <a href=\"https://golang.org/ref/spec#Fallthrough_statements\" rel=\"nofollow noreferrer\">language spec</a>:</p>\n\n<blockquote>\n  <p>A \"fallthrough\" statement transfers control to the first statement of the next case clause in an expression \"switch\" statement. It may be used only as the final non-empty statement in such a clause.</p>\n</blockquote>\n\n<p>That seems to perfectly describe your observed behavior.</p>\n"}, {"comments": [{"owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "edited": false, "score": 0, "creation_date": 1500836975, "post_id": 45268821, "comment_id": 77500566, "body": "sure, and <code>go</code> has goto statements as well, so I could write this - but it bothers me that the <code>2 == 1</code> seems like it&#39;s ignored."}], "tags": [], "owner": {"reputation": 7872, "user_id": 440302, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e785baf6d4a2626b8649d5b538c51858?s=128&d=identicon&r=PG", "display_name": "Rufflewind", "link": "https://stackoverflow.com/users/440302/rufflewind"}, "is_accepted": false, "score": 4, "last_activity_date": 1500836255, "creation_date": 1500836255, "answer_id": 45268821, "question_id": 45268681, "link": "https://stackoverflow.com/questions/45268681/golangs-fallthrough-seems-unexpected/45268821#45268821", "title": "golang&#39;s fallthrough seems unexpected", "body": "<p>Presumably, Go's fallthrough behavior is modeled after C, which always worked like this.  In C, <code>switch</code> statements are just shorthands for chains of conditional gotos, so your particular example would be compiled <em>as if</em> it was written like:</p>\n\n<pre><code>    # Pseudocode\n    if 1 == 1 goto alpha\n    if 2 == 1 goto beta\nalpha:\n    fmt.Println(\"1 == 1\")\nbeta:\n    fmt.Println(\"2 == 1\")\n</code></pre>\n\n<p>As you can see, once execution enters the <code>alpha</code> case, it would just keep flowing down, ignoring the <code>beta</code> label (since labels by themselves don't really do anything).  The conditional checks have already happened and won't happen again.</p>\n\n<p>Hence, the non-intuitive nature of fallthrough <code>switch</code> statements is simply because <code>switch</code> statements are thinly veiled goto statements.</p>\n"}, {"comments": [{"owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "edited": false, "score": 0, "creation_date": 1500998631, "post_id": 45302920, "comment_id": 77578787, "body": "exactly what i was looking for - thanks for the clear example."}], "tags": [], "owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "is_accepted": true, "score": 3, "last_activity_date": 1500984708, "creation_date": 1500984708, "answer_id": 45302920, "question_id": 45268681, "link": "https://stackoverflow.com/questions/45268681/golangs-fallthrough-seems-unexpected/45302920#45302920", "title": "golang&#39;s fallthrough seems unexpected", "body": "<p>Switch is not a bunch of ifs. It's more akin to <code>if {} else if {}</code> construct, but with a couple of twists - namely <code>break</code> and <code>fallthrough</code>. It's not possible to make switch execute first and third cases - a switch does not check each condition, it finds first match and executes it. That's all.</p>\n\n<p>It's primary purpose is to walk through a list of possible values and execute a different code for each value. In fact, in C (where switch statement came from) switch expression can only be of integral type and case values can only be constants that switch expression will be compared too. It's only relatively recently, languages started adding support for strings, boolean expressions etc in switch cases.</p>\n\n<p>As to fallthrough logic it also comes from C. There is no fallthrough operator in C. In C execution falls through into next case (without checking case values) unless break operator encountered. The reason for this design is that sometimes you need to do something special and then do same steps as in another case. So, this design merely allows that. Unfortunately, it's rather rarely useful, so falling through by default was causing more trouble when programmer forgotten to put a break statement in, then actually helping when truly omitted that break intentionally. So, many modern languages change this logic to never fall through by default and to require explicit fallthrough statement if falling through is actually required.</p>\n\n<p>Unfortunately, it's a it hard to come up with a non contrived example of fallthrough being useful that would be short enough to fit into an answer. As I said it's relatively rare. But sometimes you need to write code similar to this:</p>\n\n<pre><code>if x == a || x == b {\n  if x == a {\n    // do action a\n  }\n  // do action ab\n} else if x == c {\n   // do action c\n} else if x == d {\n  // do action d\n}\n</code></pre>\n\n<p>In fact, I needed code of similar structure quite recently in one of my projects. So, I used switch statement instead. And it looked like this:</p>\n\n<pre><code>switch x {\n  case a: // do action a\n          fallthrough\n  case b: // do action ab\n  case c: // do action c\n  case d: // do action d\n}\n</code></pre>\n\n<p>And your switch from the question is functionally equivalent to this:</p>\n\n<pre><code>if 1 == 1 || 2 == 1 {\n    if 1 == 1 {\n        fmt.Println(\"1 == 1\")\n    }\n    fmt.Println(\"2 == 1\")\n}\n</code></pre>\n"}], "owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1689, "favorite_count": 2, "accepted_answer_id": 45302920, "answer_count": 3, "score": 5, "last_activity_date": 1500984708, "creation_date": 1500835325, "last_edit_date": 1500839119, "question_id": 45268681, "link": "https://stackoverflow.com/questions/45268681/golangs-fallthrough-seems-unexpected", "title": "golang&#39;s fallthrough seems unexpected", "body": "<p>I have the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    switch {\n    case 1 == 1:\n        fmt.Println(\"1 == 1\")\n        fallthrough\n    case 2 == 1:\n        fmt.Println(\"2 == 1\")\n    }\n}\n</code></pre>\n\n<p>Which prints both lines on the go playground - <a href=\"https://play.golang.org/p/f5i7DBElRu\" rel=\"nofollow noreferrer\">see example here</a>. I would have expected the fallthrough statement to include evaluation of the next <code>case</code> statement, but this seems not to be the case.</p>\n\n<p>Of course, I can always use a bunch of <code>if</code> statements, so this is not a real impediment, but I am curious what the intention here is, since this seems to me to be a non-obvious result.</p>\n\n<p>Anyone care to explain?  For example: in <a href=\"https://play.golang.org/p/KwJBKcYjEB\" rel=\"nofollow noreferrer\">this</a> code, how can I get the 1st and 3rd cases to execute?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "edited": false, "score": 0, "creation_date": 1500834666, "post_id": 45268293, "comment_id": 77499802, "body": "There is no such feature in the language. See this : <a href=\"https://github.com/golang/go/issues/226\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/226</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1500875482, "post_id": 45268293, "comment_id": 77509457, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28099441/define-a-recursive-function-within-a-function-in-go/28099510#28099510\">Define a recursive function within a function in Go</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1500887356, "post_id": 45268293, "comment_id": 77515284, "body": "<code>So far my impression of go is that they prefer to avoid saying things if they can</code> That&#39;s an odd impression. Most people observe the opposite, and in fact, it&#39;s pretty much the exact opposite of a core Go philosophy, which is: &quot;don&#39;t hide complexity&quot;."}, {"owner": {"reputation": 11917, "user_id": 516433, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c292b959ecf29c86e4c0d093a6f24e19?s=128&d=identicon&r=PG", "display_name": "Lucas", "link": "https://stackoverflow.com/users/516433/lucas"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1500921422, "post_id": 45268293, "comment_id": 77537819, "body": "@Flimzy, I am admittedly new to <code>go</code>, but just going through the tour, things like <code>for (i := 0; i &lt; 10; i++)</code> -&gt; <code>for i := 0; i &lt; 10; i++</code> -&gt; <code>for ; sum &lt; 1000;</code> -&gt; <code>for sum &lt; 1000</code> -&gt; <code>for</code>,  and <code>var thing := x*x; if x &gt; 10</code> -&gt; <code>if v := x*x; x &gt; 10</code>...  Thats what i meant by <i>avoid saying things if they can</i>.  In any case I get your point about <i>don&#39;t hide complexity</i>.  Thanks!"}, {"owner": {"reputation": 11917, "user_id": 516433, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c292b959ecf29c86e4c0d093a6f24e19?s=128&d=identicon&r=PG", "display_name": "Lucas", "link": "https://stackoverflow.com/users/516433/lucas"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1500921729, "post_id": 45268293, "comment_id": 77538012, "body": "@icza, yup, definitely a duplicate.  My <code>googling</code> skillz failed me.  Thanks for pointing it out."}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 5, "last_activity_date": 1500833624, "creation_date": 1500833624, "answer_id": 45268398, "question_id": 45268293, "link": "https://stackoverflow.com/questions/45268293/can-an-anonymous-go-function-call-itself/45268398#45268398", "title": "Can an anonymous go function call itself?", "body": "<p>You cannot use a variable before it is declared, and it is not yet declared inside its initialization statement.</p>\n\n<p>So yes, the declaration line is required, and no, there is no way to avoid it.</p>\n"}, {"comments": [{"owner": {"reputation": 11917, "user_id": 516433, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c292b959ecf29c86e4c0d093a6f24e19?s=128&d=identicon&r=PG", "display_name": "Lucas", "link": "https://stackoverflow.com/users/516433/lucas"}, "edited": false, "score": 0, "creation_date": 1500852572, "post_id": 45268950, "comment_id": 77504486, "body": "Just for clarity, <code>Walker</code> should be <code>walker</code>, right?  You wouldn&#39;t want to expose the implementation detail...  Also, perhaps I am confused, but in your method example, shouldn&#39;t left walk come before the value?"}, {"owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "reply_to_user": {"reputation": 11917, "user_id": 516433, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c292b959ecf29c86e4c0d093a6f24e19?s=128&d=identicon&r=PG", "display_name": "Lucas", "link": "https://stackoverflow.com/users/516433/lucas"}, "edited": false, "score": 0, "creation_date": 1500910210, "post_id": 45268950, "comment_id": 77531372, "body": "Walker/walker: As you probably know, using <code>walker</code> with lower-case would mean the func isn&#39;t exported (i.e. can&#39;t be called by another package). Whether or not this should be exported would depend on your planned use of this func, which I&#39;m unaware of. However, it&#39;s also the case that having the <code>Walker</code> func is entirely unnecessary and I included it only to show how the small change of splitting the anonymous func out of <code>Walker</code> makes a difference in clarity and (from my perspective) adds to simplicity/maintainability, which is a key focus for Go."}, {"owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "reply_to_user": {"reputation": 11917, "user_id": 516433, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c292b959ecf29c86e4c0d093a6f24e19?s=128&d=identicon&r=PG", "display_name": "Lucas", "link": "https://stackoverflow.com/users/516433/lucas"}, "edited": false, "score": 0, "creation_date": 1500910493, "post_id": 45268950, "comment_id": 77531541, "body": "left walk before value: hmm.. it didn&#39;t occur to me that you might be wanting to feed values from left-to-right. My background is in file systems and online storage, so I always visualize moving from the root out to the nodes - perhaps this isn&#39;t the proper way to view a walker. I researched a bit and it appears there are different patterns for approaching this. I used the &quot;Pre-Order&quot; pattern while you were using &quot;In-Order&quot; traversal. I should&#39;ve followed the pattern you were already using - making adjustments to code now."}, {"owner": {"reputation": 11917, "user_id": 516433, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c292b959ecf29c86e4c0d093a6f24e19?s=128&d=identicon&r=PG", "display_name": "Lucas", "link": "https://stackoverflow.com/users/516433/lucas"}, "edited": false, "score": 0, "creation_date": 1500921013, "post_id": 45268950, "comment_id": 77537597, "body": "sweet, not nitpicking, just trying to get the idioms/patterns right and ensure I am understanding...  Thanks for the reply"}], "tags": [], "owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "is_accepted": false, "score": 4, "last_activity_date": 1500910553, "last_edit_date": 1500910553, "creation_date": 1500837072, "answer_id": 45268950, "question_id": 45268293, "link": "https://stackoverflow.com/questions/45268293/can-an-anonymous-go-function-call-itself/45268950#45268950", "title": "Can an anonymous go function call itself?", "body": "<p>I agree with @milo-chirstiansen that it isn't possible for an anonymous func to refer to its instance in its declaration.</p>\n\n<p>If you're trying to get a feel for writing idiomatic Go code, it might look a bit more like this, doing away with the anonymous func:</p>\n\n<pre><code>// Walk walks the tree t sending all values\n// from the tree to the channel ch.\nfunc Walk(t *tree.Tree, ch chan int) {\n    Walker(t, ch)\n    close(ch)\n}\n\n// Walker does the things, made to be called recursively\nfunc Walker(t *tree.Tree, ch chan int) {\n    if t.Left != nil {\n        Walker(t.Left, ch)\n    }\n    ch &lt;- t.Value\n    if t.Right != nil {\n        Walker(t.Right, ch)\n    }\n}\n</code></pre>\n\n<hr>\n\n<h2>You might find this interesting...</h2>\n\n<p>Go allows some interesting things that aren't possible in other languages. This sometimes requires thinking a little differently about your code.</p>\n\n<p>Frances Campoy gave a talk at GopherCon 2016 about his storied history with the concept of <code>nil</code> in Go. One of his examples of how <code>nil</code> can be used beautifully and idiomatically, involved a solution to receiving the sum for a binary tree. Below is a link starting with this piece of his talk and I'd recommend checking it out if you have the time.\nref: <a href=\"https://youtu.be/ynoY2xz-F8s?t=16m28s\" rel=\"nofollow noreferrer\">https://youtu.be/ynoY2xz-F8s?t=16m28s</a></p>\n\n<p>I realize you don't have control over the Tree struct in your example, but if you did, here's how your code might look: <a href=\"https://play.golang.com/p/iM10NQXfgw\" rel=\"nofollow noreferrer\">https://play.golang.com/p/iM10NQXfgw</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// A Tree is a binary tree with integer values.\ntype Tree struct {\n    Left  *Tree\n    Value int\n    Right *Tree\n}\n\n// Walk loads value into channel; caller is responsible for providing and closing chan\nfunc (t *Tree) Walk(ch chan int) {\n\n    // Super interesting: Go supports the calling of a func on a nil instance of a struct\n    if t == nil {\n        return // return nothing\n    }\n\n    t.Left.Walk(ch)  // recursively call Walk on left node\n    ch &lt;- t.Value\n    t.Right.Walk(ch) // recursively call Walk on right node\n}\n\nfunc main() {\n    // Initial value for our tree; I'm not being very idiomatic with this\n    tree := &amp;Tree{\n        Left:  &amp;Tree{Value: 2},\n        Value: 1,\n        Right: &amp;Tree{Left: &amp;Tree{Value: 4}, Value: 3},\n    }\n\n    ch := make(chan int)\n\n    // Load values into chan in separate goroutine\n    // to prevent blocking\n    go func() {\n        tree.Walk(ch)\n        close(ch)\n    }()\n\n    // Write each val added to chan until all values\n    // have been written and chan is closed\n    for val := range ch {\n        fmt.Println(val)\n    }\n}\n</code></pre>\n\n<blockquote>\n  <p>1</p>\n  \n  <p>2</p>\n  \n  <p>3</p>\n  \n  <p>4</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1500894786, "creation_date": 1500894786, "answer_id": 45279147, "question_id": 45268293, "link": "https://stackoverflow.com/questions/45268293/can-an-anonymous-go-function-call-itself/45279147#45279147", "title": "Can an anonymous go function call itself?", "body": "<p>It should be possible to avoid this, by combining <a href=\"https://golang.org/pkg/runtime/#Caller\" rel=\"nofollow noreferrer\"><code>runtime.Caller</code></a> and <a href=\"https://golang.org/pkg/reflect/#Value.Call\" rel=\"nofollow noreferrer\"><code>reflect.Call</code></a>.</p>\n\n<p>But this is nothing even resembling idiomatic Go, so I don't think it applies to your <em>practical</em> situation, although it does address the letter of your question. :)</p>\n"}], "owner": {"reputation": 11917, "user_id": 516433, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/c292b959ecf29c86e4c0d093a6f24e19?s=128&d=identicon&r=PG", "display_name": "Lucas", "link": "https://stackoverflow.com/users/516433/lucas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 662, "favorite_count": 2, "accepted_answer_id": 45268398, "answer_count": 3, "score": 3, "last_activity_date": 1523359793, "creation_date": 1500832984, "last_edit_date": 1523359793, "question_id": 45268293, "link": "https://stackoverflow.com/questions/45268293/can-an-anonymous-go-function-call-itself", "title": "Can an anonymous go function call itself?", "body": "<p>I'm just running through the Tour of Go, and got to the tree walker exercise.  Its obvious recursion, but closing the channel is a special case after the final pop off the call stack.  Anyway, I ended up implementing it thusly:</p>\n\n<pre><code>// Walk walks the tree t sending all values\n// from the tree to the channel ch.\nfunc Walk(t *tree.Tree, ch chan int) {\n    var walker func(t *tree.Tree, ch chan int)\n    walker = func(t *tree.Tree, ch chan int) {\n        if (t.Left != nil) {\n            walker(t.Left, ch)\n        }\n        ch &lt;- t.Value\n        if (t.Right != nil) {\n            walker(t.Right, ch)\n        }\n    }\n    walker(t, ch)\n    close(ch)\n}\n</code></pre>\n\n<p>So far my impression of go is that they prefer to avoid saying things if they can, so the declaration of <code>var walker</code> before the definition seems <em>off</em>.  Perhaps I missed some detail that would allow a function to refer to itself without the declaration?  It would be a little nicer if it could be:</p>\n\n<pre><code>// Walk walks the tree t sending all values\n// from the tree to the channel ch.\nfunc Walk(t *tree.Tree, ch chan int) {\n    func(t *tree.Tree, ch chan int) {\n        if (t.Left != nil) {\n            __me__(t.Left, ch)\n        }\n        ch &lt;- t.Value\n        if (t.Right != nil) {\n            __me__(t.Right, ch)\n        }\n    }(t, ch)\n    close(ch)\n}\n</code></pre>\n\n<p>This is a simple trivia question, but I'm new enough to the language that I am not finding the answer...</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "is_accepted": false, "score": 0, "last_activity_date": 1500834176, "creation_date": 1500834176, "answer_id": 45268486, "question_id": 45267983, "link": "https://stackoverflow.com/questions/45267983/code-to-generate-powerset-in-golang-gives-wrong-result/45268486#45268486", "title": "Code to generate powerset in Golang gives wrong result", "body": "<p>For instance, you can use algorithm like this one: <a href=\"https://stackoverflow.com/a/2779467/3805062\">https://stackoverflow.com/a/2779467/3805062</a>.</p>\n\n<pre><code>func PowerSet(original []string) [][]string {\n    powerSetSize := int(math.Pow(2, float64(len(original))))\n    result := make([][]string, 0, powerSetSize)\n\n    var index int\n    for index &lt; powerSetSize {\n        var subSet []string\n\n        for j, elem := range original {\n            if index&amp; (1 &lt;&lt; uint(j)) &gt; 0 {\n                subSet = append(subSet, elem)\n            }\n        }\n        result = append(result, subSet)\n        index++\n    }\n    return result\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1500835102, "last_edit_date": 1500835102, "creation_date": 1500834333, "answer_id": 45268501, "question_id": 45267983, "link": "https://stackoverflow.com/questions/45267983/code-to-generate-powerset-in-golang-gives-wrong-result/45268501#45268501", "title": "Code to generate powerset in Golang gives wrong result", "body": "<p>The problem with your program is not the algorithm itself but this line:</p>\n\n<pre><code>newSet := append(existingSet, element)\n</code></pre>\n\n<p>You should not <code>append</code> and assign to a different variable.</p>\n\n<p>As the <a href=\"https://godoc.org/builtin#append\" rel=\"nofollow noreferrer\">documentation</a> states (emphasis mine), \"The append built-in function appends elements to the end of a slice. <strong>If it has sufficient capacity, the destination is resliced to accommodate the new elements</strong>. If it does not, a new underlying array will be allocated.\".</p>\n\n<p>So, there might be cases where <code>newSet := append(existingSet, element)</code> will actually modify <code>existingSet</code> itself, which would break your logic.</p>\n\n<p>If you change that to instead create a new array and append to that one, it works as you expect it.</p>\n\n<pre><code>newSet := make([]string, 0)\nnewSet = append(newSet, existingSet...) \nnewSet = append(newSet, element)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 3019530, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c29c598630fe7d6a3a20328a41d1271?s=128&d=identicon&r=PG&f=1", "display_name": "TohaSt", "link": "https://stackoverflow.com/users/3019530/tohast"}, "edited": false, "score": 0, "creation_date": 1500844166, "post_id": 45268559, "comment_id": 77502643, "body": "Thanks for a link to that thread on Google Groups. I shouldn&#39;t assume any behaviour by function&#39;s name."}], "tags": [], "owner": {"reputation": 477, "user_id": 2837627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc1305a2799a4577f0970042c67d639?s=128&d=identicon&r=PG&f=1", "display_name": "hbagdi", "link": "https://stackoverflow.com/users/2837627/hbagdi"}, "is_accepted": false, "score": 1, "last_activity_date": 1500834646, "creation_date": 1500834646, "answer_id": 45268559, "question_id": 45267983, "link": "https://stackoverflow.com/questions/45267983/code-to-generate-powerset-in-golang-gives-wrong-result/45268559#45268559", "title": "Code to generate powerset in Golang gives wrong result", "body": "<p>Elaborating on @eugenioy's answer.<br>\nLook at <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/MbjT-S3l23A\" rel=\"nofollow noreferrer\">this</a> thread. Here is a working example : <a href=\"https://play.golang.org/p/dzoTk1kimf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/dzoTk1kimf</a></p>\n\n<pre><code>func copy_and_append_string(slice []string, elem string) []string {\n    // wrong: return append(slice, elem)\n    return append(append([]string(nil), slice...), elem)\n}\n\nfunc PowerSet(s []string) [][]string {\n    if s == nil {\n        return nil\n    }\n    r := [][]string{[]string{}}\n    for _, es := range s {\n        var u [][]string\n        for _, er := range r {\n            u = append(u, copy_and_append_string(er, es))\n        }\n        r = append(r, u...)\n    }\n    return r\n}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 3019530, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c29c598630fe7d6a3a20328a41d1271?s=128&d=identicon&r=PG&f=1", "display_name": "TohaSt", "link": "https://stackoverflow.com/users/3019530/tohast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 785, "favorite_count": 0, "accepted_answer_id": 45268501, "answer_count": 3, "score": 3, "last_activity_date": 1500835102, "creation_date": 1500831014, "question_id": 45267983, "link": "https://stackoverflow.com/questions/45267983/code-to-generate-powerset-in-golang-gives-wrong-result", "title": "Code to generate powerset in Golang gives wrong result", "body": "<p>Next code in Golang to generate powerset produces wrong result on input <code>{\"A\", \"B\", \"C\", \"D\", \"E\"}</code>. I see <code>[A B C E E]</code> as the last generated set.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    for _, s := range PowerSet([]string{\"A\", \"B\", \"C\", \"D\", \"E\"}) {\n        fmt.Println(s)  \n    }   \n}\n\nfunc PowerSet(set []string) [][]string {\n    var powerSet [][]string\n    powerSet = append(powerSet, make([]string, 0))\n    for _, element := range set {\n        var moreSets [][]string\n        for _, existingSet := range powerSet {\n            newSet := append(existingSet, element)\n            moreSets = append(moreSets, newSet)\n        }\n        powerSet = append(powerSet, moreSets...)\n    }\n    return powerSet\n}\n</code></pre>\n\n<p>How to fix it? How to write it idiomatically in Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 2, "creation_date": 1500827917, "post_id": 45267409, "comment_id": 77497649, "body": "Feasible, you may have to implement custom <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\">Marshaler</a> and <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">Unmarshaler</a> interface."}], "answers": [{"tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 3, "last_activity_date": 1500828942, "creation_date": 1500828942, "answer_id": 45267644, "question_id": 45267409, "link": "https://stackoverflow.com/questions/45267409/embed-struct-but-only-have-certain-fields-in-json/45267644#45267644", "title": "Embed struct but only have certain fields in json", "body": "<p>Expanding my comment with example.</p>\n\n<p>It is feasible, you have to implement <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\">Marshal</a> interface.</p>\n\n<p>For example:</p>\n\n<pre><code>func (u *MyStruct) MarshalJSON() ([]byte, error) {\n    return json.Marshal(&amp;struct {\n        Name   string `json:\"name\"`\n        Scheme string `json:\"scheme\"`\n    }{\n        Name:   u.Name,\n        Scheme: u.Scheme,\n    })\n}\n</code></pre>\n\n<p>Play Link: <a href=\"https://play.golang.org/p/LLchuOdYvf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LLchuOdYvf</a></p>\n\n<p>Output:</p>\n\n<pre><code>{\"name\":\"Bob\",\"scheme\":\"http\"}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 1, "accepted_answer_id": 45267644, "answer_count": 1, "score": 1, "last_activity_date": 1500828942, "creation_date": 1500827542, "question_id": 45267409, "link": "https://stackoverflow.com/questions/45267409/embed-struct-but-only-have-certain-fields-in-json", "title": "Embed struct but only have certain fields in json", "body": "<p>I have a struct that I want to embed but want to json encode only certain fields of that struct (and lowercase them). Is that possible?</p>\n\n<p><a href=\"https://play.golang.org/p/bEC4zlx2oC\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bEC4zlx2oC</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net/url\"\n)\n\ntype MyStruct struct {\n    Name string `json:\"name\"`\n    *url.URL\n}\n\nfunc main() {\n    m := &amp;MyStruct{\n        \"Bob\",\n        &amp;url.URL{\n            Scheme: \"http\", \n        },\n    }\n\n    j, err := json.Marshal(m)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(string(j))  // want {\"name\":\"Bob\",\"scheme\":\"http\"}\n}\n</code></pre>\n"}, {"tags": ["go", "token"], "comments": [{"owner": {"reputation": 158803, "user_id": 246342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8ba0aea3f521082f18dd7c186e7d4c3?s=128&d=identicon&r=PG", "display_name": "Alex K.", "link": "https://stackoverflow.com/users/246342/alex-k"}, "edited": false, "score": 2, "creation_date": 1500825918, "post_id": 45267125, "comment_id": 77497044, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/22892120/how-to-generate-a-random-string-of-a-fixed-length-in-golang\">How to generate a random string of a fixed length in golang?</a>"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 158803, "user_id": 246342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8ba0aea3f521082f18dd7c186e7d4c3?s=128&d=identicon&r=PG", "display_name": "Alex K.", "link": "https://stackoverflow.com/users/246342/alex-k"}, "edited": false, "score": 0, "creation_date": 1500826028, "post_id": 45267125, "comment_id": 77497075, "body": "@AlexK. The difference is that I want the token to be not only random, but also unique."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1500827286, "post_id": 45267125, "comment_id": 77497442, "body": "You may use URL-safe Base64 encoding on any random data. See the exported <code>encoding&#47;base64&#47;URLEncoding</code> variable. Using the output of that, you can safely include it in URLs."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1500827299, "post_id": 45267125, "comment_id": 77497448, "body": "If you can generate a unique number for each user, then you can use a URL safe version of base 64."}, {"owner": {"reputation": 468, "user_id": 450333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11263845c2ece6187c3b87b2be66f60a?s=128&d=identicon&r=PG", "display_name": "Kent", "link": "https://stackoverflow.com/users/450333/kent"}, "edited": false, "score": 1, "creation_date": 1500827390, "post_id": 45267125, "comment_id": 77497477, "body": "Shouldn&#39;t it be possible to simply urlencode that string?  And shouldn&#39;t it be possible for anyone to generate a token for anyone else with that algorithm ?"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1500829430, "post_id": 45267125, "comment_id": 77498167, "body": "@icza Can you elaborate your answer in a code snippet please?"}], "answers": [{"comments": [{"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500829405, "post_id": 45267661, "comment_id": 77498159, "body": "What about feeding the result into a MD5 to shorten the resulting token, like this: \t<code>hasher := md5.New(); \thasher.Write([]byte(token)); \treturn hex.EncodeToString(hasher.Sum(nil))</code> ?"}, {"owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500830329, "post_id": 45267661, "comment_id": 77498469, "body": "nice idea, @Karlom - I&#39;ll try that out also"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577115874, "post_id": 45267661, "comment_id": 105097034, "body": "consider adding time span validity <a href=\"https://github.com/anacrolix/dht/blob/master/tokens.go\" rel=\"nofollow noreferrer\">github.com/anacrolix/dht/blob/master/tokens.go</a>"}], "tags": [], "owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "is_accepted": false, "score": 6, "last_activity_date": 1500831115, "last_edit_date": 1500831115, "creation_date": 1500829114, "answer_id": 45267661, "question_id": 45267125, "link": "https://stackoverflow.com/questions/45267125/how-to-generate-unique-random-alphanumeric-tokens-in-golang/45267661#45267661", "title": "How to generate unique random alphanumeric tokens in Golang?", "body": "<h3>Option 1: md5 hash the bcrypt output</h3>\n\n<p>Props to OP for mostly answering his own question :)</p>\n\n<p>I think it'll satisfy everything you're looking for (32-character length):</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/md5\"\n    \"encoding/hex\"\n    \"fmt\"\n    \"log\"\n\n    \"golang.org/x/crypto/bcrypt\"\n)\n\n// GenerateToken returns a unique token based on the provided email string\nfunc GenerateToken(email string) string {\n    hash, err := bcrypt.GenerateFromPassword([]byte(email), bcrypt.DefaultCost)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"Hash to store:\", string(hash))\n\n    hasher := md5.New()\n    hasher.Write(hash)\n    return hex.EncodeToString(hasher.Sum(nil))\n}\n\nfunc main() {\n    fmt.Println(\"token:\", GenerateToken(\"bob@webserver.com\"))\n}\n</code></pre>\n\n<blockquote>\n  <p>$ go run main.go</p>\n  \n  <p>Hash to store: $2a$10$B23cv7lDpbY3iVvfZ7GYE.e4691ow8i7l6CQXkmz315fbg4jLzoue</p>\n  \n  <p>token: 90a514ab93e2c32fdd1072154b26a100</p>\n</blockquote>\n\n<hr>\n\n<p>Below are 2 of my previous suggestions that I doubt will work better for you, but could be helpful for others to consider.</p>\n\n<hr>\n\n<h3>Option 2: base64</h3>\n\n<p>In the past, I've used base64 encoding to make tokens more portable after encryption/hashing. Here's a working example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/base64\"\n    \"fmt\"\n    \"log\"\n\n    \"golang.org/x/crypto/bcrypt\"\n)\n\n// GenerateToken returns a unique token based on the provided email string\nfunc GenerateToken(email string) string {\n    hash, err := bcrypt.GenerateFromPassword([]byte(email), bcrypt.DefaultCost)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"Hash to store:\", string(hash))\n\n    return base64.StdEncoding.EncodeToString(hash)\n}\n\nfunc main() {\n    fmt.Println(\"token:\", GenerateToken(\"bob@webserver.com\"))\n}\n</code></pre>\n\n<blockquote>\n  <p>$ go run main.go</p>\n  \n  <p>Hash to store: $2a$10$cbVMU9U665VSqpfwrNZWOeU5cIDOe5iBJ8ZVa2yJCTsnk9MEZHvRq</p>\n  \n  <p>token: JDJhJDEwJGNiVk1VOVU2NjVWU3FwZndyTlpXT2VVNWNJRE9lNWlCSjhaVmEyeUpDVHNuazlNRVpIdlJx</p>\n</blockquote>\n\n<p>As you can see, this unfortunately <em>doesn't</em> provide you with a 16-32 character length. If you're okay with the length being 80 long, then this might work for you.</p>\n\n<hr>\n\n<h3>Option 3: url path/query escapes</h3>\n\n<p>I also tried url.PathEscape and url.QueryEscape to be thorough. While they have the same problem as the base64 example (length, though a bit shorter), at least they \"should\" work in the path:</p>\n\n<pre><code>// GenerateToken returns a unique token based on the provided email string\nfunc GenerateToken(email string) string {\n    hash, err := bcrypt.GenerateFromPassword([]byte(email), bcrypt.DefaultCost)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"Hash to store:\", string(hash))\n\n    fmt.Println(\"url.PathEscape:\", url.PathEscape(string(hash)))\n    fmt.Println(\"url.QueryEscape:\", url.QueryEscape(string(hash)))\n\n    return base64.StdEncoding.EncodeToString(hash)\n}\n</code></pre>\n\n<blockquote>\n  <p>url.PathEscape: $2a$10$wx1UL6%2F7RD6sFq7Bzpgcc.ibFSW114Tf6A521wRh9rVy8dp%2Fa82x2\n  url.QueryEscape: %242a%2410%24wx1UL6%2F7RD6sFq7Bzpgcc.ibFSW114Tf6A521wRh9rVy8dp%2Fa82x2</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 1487, "user_id": 3668541, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/ba66d28285a3e98b836178617d096b75?s=128&d=identicon&r=PG&f=1", "display_name": "haz", "link": "https://stackoverflow.com/users/3668541/haz"}, "edited": false, "score": 0, "creation_date": 1573347677, "post_id": 45276950, "comment_id": 103853072, "body": "Surely this is secure \u2013 it&#39;s just an expensive way to create a unique email verification token, no? Its not an authentication Bearer token sent on every request."}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "reply_to_user": {"reputation": 1487, "user_id": 3668541, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/ba66d28285a3e98b836178617d096b75?s=128&d=identicon&r=PG&f=1", "display_name": "haz", "link": "https://stackoverflow.com/users/3668541/haz"}, "edited": false, "score": 1, "creation_date": 1573375471, "post_id": 45276950, "comment_id": 103856417, "body": "The original question asked how to generate tokens to authenticate users, not create email verification tokens."}], "tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": false, "score": 5, "last_activity_date": 1500888545, "creation_date": 1500888545, "answer_id": 45276950, "question_id": 45267125, "link": "https://stackoverflow.com/questions/45267125/how-to-generate-unique-random-alphanumeric-tokens-in-golang/45276950#45276950", "title": "How to generate unique random alphanumeric tokens in Golang?", "body": "<h1>TL;DR</h1>\n\n<p>Please don't do this, it's <strong>not secure</strong>!. Use an existing authentication library or design a better approach.</p>\n\n<h2>Explaination</h2>\n\n<p>Authentication mechanisms can be tricky to implement properly. </p>\n\n<p>Since these tokens are for authentication purposes, you don't just want them to be <strong>unique</strong>, you also need them to be <strong>unguessable</strong>. An attacker should not be able to calculate a users authentication token.</p>\n\n<p>Your current implementation uses the users email address as the secret input for bcrypt. bcrypt was designed as a secure password hashing algorithm and is hence quite computationally expensive to run. Hence you probably don't want to be doing this in every request.</p>\n\n<p>More importantly, your tokens are <strong>not secure</strong>. If I know your algorithm then I can generate a token for anyone by simply knowing their email address! </p>\n\n<p>Also, with this approach, you cannot revoke or change a compromised token as it is calculated from the users email address. This is also a major security concern.</p>\n\n<p>There are a few different approaches you could take, depending on whether you need stateless authentication or the ability to revoke tokens.</p>\n\n<p>Additionally, as a matter as good practice, authentication/session tokens should not be placed in a URL as it is much easier for these to accidentally <em>leak</em> (e.g. cached, available to proxy servers, accidentally stored in browser history etc).</p>\n\n<h2>Identifiers Only?</h2>\n\n<p>If you aren't using your tokens for authentication then simply use a hash function on a users email address. For example, <a href=\"https://www.gravatar.com/\" rel=\"noreferrer\">Gravatar</a> that calculate the <code>MD5</code> of a the users lowercase email address and use this to uniquely identify a user. For example:</p>\n\n<pre><code>func GravatarMD5(email string) string {\n    h := md5.New()\n    h.Write([]byte(strings.ToLower(email)))\n    return hex.EncodeToString(h.Sum(nil))\n }\n</code></pre>\n\n<p>There is an infinitesimal chance of a hash collision (and hence not <em>guaranteed</em> to be unique) but obviously in a real life implementation this hasn't been an issue. </p>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577115814, "post_id": 59457748, "comment_id": 105097003, "body": "but this is super expensive as you need to store all that data...."}, {"owner": {"reputation": 357, "user_id": 4928227, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5Uo9u.jpg?s=128&g=1", "display_name": "Robin K", "link": "https://stackoverflow.com/users/4928227/robin-k"}, "edited": false, "score": 0, "creation_date": 1586676860, "post_id": 59457748, "comment_id": 108210625, "body": "Why is this super insecure? Predictability?"}], "tags": [], "owner": {"reputation": 3596, "user_id": 2481780, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/IlH4E.jpg?s=128&g=1", "display_name": "Andzej Maciusovic", "link": "https://stackoverflow.com/users/2481780/andzej-maciusovic"}, "is_accepted": false, "score": 9, "last_activity_date": 1577115009, "creation_date": 1577115009, "answer_id": 59457748, "question_id": 45267125, "link": "https://stackoverflow.com/questions/45267125/how-to-generate-unique-random-alphanumeric-tokens-in-golang/59457748#59457748", "title": "How to generate unique random alphanumeric tokens in Golang?", "body": "<p>As it was already mentioned you are doing it wrong and this is super insecure. </p>\n\n<ol>\n<li>Generate secure token using crypto package. This token completely random and not associated with any email.</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func GenerateSecureToken(length int) string {\n    b := make([]byte, length)\n    if _, err := rand.Read(b); err != nil {\n        return \"\"\n    }\n    return hex.EncodeToString(b)\n}\n</code></pre>\n\n<ol start=\"2\">\n<li>Create database table which maps this token to user identifier and during API request validate it.</li>\n</ol>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11170, "favorite_count": 2, "answer_count": 3, "score": 9, "last_activity_date": 1577115009, "creation_date": 1500825765, "last_edit_date": 1500826268, "question_id": 45267125, "link": "https://stackoverflow.com/questions/45267125/how-to-generate-unique-random-alphanumeric-tokens-in-golang", "title": "How to generate unique random alphanumeric tokens in Golang?", "body": "<p>For a RESTful backend API, I want to generate <strong>unique</strong> url tokens to be used to authenticate users. </p>\n\n<p>The unique data provided at registration to generate tokens are email addresses. But after generating tokens and sending that to the users, I don't need to decrypt received tokens to get email or other information. So the encryption can be one-way.</p>\n\n<p>Initially I used bcrypt to do so:</p>\n\n<pre><code>func GenerateToken(email string) string {\n    hash, err := bcrypt.GenerateFromPassword([]byte(email), bcrypt.DefaultCost)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"Hash to store:\", string(hash))\n\n    return string(hash)\n\n}\n</code></pre>\n\n<p>But since the tokens come as a url parameter (like <code>/api/path/to/{token}</code>) I can not use <a href=\"https://godoc.org/golang.org/x/crypto/bcrypt\" rel=\"noreferrer\">bcrypt</a> because it generates tokens containing <code>/</code> like this:</p>\n\n<p><code>\"$2a$10$NebCQ8BD7xOa82nkzRGA9OEh./zhBOPcuV98vpOKBKK6ZTFuHtqlK\"</code></p>\n\n<p>which will break the routing. </p>\n\n<p>So I'm wondering what is the best way to generate some unique 16-32 character alphanumeric tokens based on emails in Golang?</p>\n"}, {"tags": ["docker", "go", "docker-compose", "goland", "gopath"], "comments": [{"owner": {"reputation": 21378, "user_id": 3118209, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/3tgaf.jpg?s=128&g=1", "display_name": "Arpit Aggarwal", "link": "https://stackoverflow.com/users/3118209/arpit-aggarwal"}, "edited": false, "score": 0, "creation_date": 1500826504, "post_id": 45267060, "comment_id": 77497208, "body": "Do you want to access <code>Go</code> SDK in your local machine from <code>Docker</code> container?"}, {"owner": {"reputation": 1625, "user_id": 4175590, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2629234c95b90ab0868a1f70c9c6b86d?s=128&d=identicon&r=PG&f=1", "display_name": "Oleksandr Dashkov", "link": "https://stackoverflow.com/users/4175590/oleksandr-dashkov"}, "reply_to_user": {"reputation": 21378, "user_id": 3118209, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/3tgaf.jpg?s=128&g=1", "display_name": "Arpit Aggarwal", "link": "https://stackoverflow.com/users/3118209/arpit-aggarwal"}, "edited": false, "score": 0, "creation_date": 1500827854, "post_id": 45267060, "comment_id": 77497633, "body": "@Arpit Yes, go sdk and go path"}, {"owner": {"reputation": 1625, "user_id": 4175590, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2629234c95b90ab0868a1f70c9c6b86d?s=128&d=identicon&r=PG&f=1", "display_name": "Oleksandr Dashkov", "link": "https://stackoverflow.com/users/4175590/oleksandr-dashkov"}, "reply_to_user": {"reputation": 21378, "user_id": 3118209, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/3tgaf.jpg?s=128&g=1", "display_name": "Arpit Aggarwal", "link": "https://stackoverflow.com/users/3118209/arpit-aggarwal"}, "edited": false, "score": 0, "creation_date": 1500828784, "post_id": 45267060, "comment_id": 77497963, "body": "@Arpit thanks for your comment. But how can I take a go SDK link to add it in the goglang settings. &#39;-v&#39; it&#39;s a volumes part in the docker-compose file?"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 1, "creation_date": 1500852344, "post_id": 45267060, "comment_id": 77504435, "body": "I&#39;m just curious, what is the use-case for this? Why would you want to have the sources and Go only in containers?"}, {"owner": {"reputation": 1625, "user_id": 4175590, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2629234c95b90ab0868a1f70c9c6b86d?s=128&d=identicon&r=PG&f=1", "display_name": "Oleksandr Dashkov", "link": "https://stackoverflow.com/users/4175590/oleksandr-dashkov"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1500853413, "post_id": 45267060, "comment_id": 77504655, "body": "@dlsniper maybe it&#39;s just because I don&#39;t have yet another docker skill and I try to invent a bicycle. This way can solve my issue."}], "answers": [{"comments": [{"owner": {"reputation": 464, "user_id": 185333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e1f5636588cf15a48b2c827588abcbf?s=128&d=identicon&r=PG", "display_name": "waynethec", "link": "https://stackoverflow.com/users/185333/waynethec"}, "edited": false, "score": 0, "creation_date": 1512855289, "post_id": 45270754, "comment_id": 82427365, "body": "This is true, but docker also allows data to be copied from a <a href=\"https://docs.docker.com/engine/admin/volumes/volumes/#populate-a-volume-using-a-container\" rel=\"nofollow noreferrer\">container into a volume</a>.  It&#39;s then possible to share this data between containers/services using named volumes in docker-compose v3 or volumes_from in docker-compose v2.  If docker-compose expanded the mechanism to allow you bind a host directory to this volume much like how services can mount this populated data volume, it would satisfy what the OP wants."}, {"owner": {"reputation": 464, "user_id": 185333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e1f5636588cf15a48b2c827588abcbf?s=128&d=identicon&r=PG", "display_name": "waynethec", "link": "https://stackoverflow.com/users/185333/waynethec"}, "edited": false, "score": 0, "creation_date": 1512855399, "post_id": 45270754, "comment_id": 82427385, "body": "We technically can already do this by creating a volume from the golang container specifying /go so the volume is then populated with the go binaries. After that we would then find the mountpoint on the host and symlink from there, but as you hinted, it&#39;s messy to deal with."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 1, "last_activity_date": 1500852313, "creation_date": 1500852313, "answer_id": 45270754, "question_id": 45267060, "link": "https://stackoverflow.com/questions/45267060/how-can-i-configure-go-sdk-and-gopath-from-docker-container/45270754#45270754", "title": "How can I configure go sdk and GOPATH from docker container?", "body": "<p>At the moment this is not possible. Nor do I see how it could be possible in the future. Mounting a volume in docker means you \"hide\" the contents of that folder from the container and use the files on the host instead. As such, any time you'll mount the directory from your machine, your container files from that instance won't be available to the machine. This means you can't have Go installed in the container and then mount a folder and use that location for the Go sources. If you are thinking: I'll just mount things in another place, do some symlink magic / copy files around, that's just a bad idea that leads to nowhere.</p>\n\n<p>Gogland supports remote debugging as of EAP 10, released a a few weeks ago. This allows you to debug applications running in containers or on remote hosts. As such, you can install Go, and the source code on your machine but have them running in containers.</p>\n"}], "owner": {"reputation": 1625, "user_id": 4175590, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2629234c95b90ab0868a1f70c9c6b86d?s=128&d=identicon&r=PG&f=1", "display_name": "Oleksandr Dashkov", "link": "https://stackoverflow.com/users/4175590/oleksandr-dashkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 979, "favorite_count": 0, "accepted_answer_id": 45270754, "answer_count": 1, "score": 0, "last_activity_date": 1500852313, "creation_date": 1500825366, "last_edit_date": 1500829426, "question_id": 45267060, "link": "https://stackoverflow.com/questions/45267060/how-can-i-configure-go-sdk-and-gopath-from-docker-container", "title": "How can I configure go sdk and GOPATH from docker container?", "body": "<p>I'm trying to configure golang project with Jetbrains Gogland and docker compose. I want to use GOPATH and go from the docker container. I mean using the go installation from the container for the autocomplete etc without installing golang on the local machine.\nthe project structure is:</p>\n\n<pre><code>project root\n    docker-compose.yml\n    back|\n         Dockerfile\n         main.go\n         some other packages\n    front|\n         all the front files...\n</code></pre>\n\n<p>After that, I want to deploy my <code>back</code> folder to the <code>/go/src/app</code> in the docker container. The problem is that when I develop the project I can''t use autocomplete as this project is not in my local GOPATH and there are different golang versions in the docker container and on my local machine\nI already read <a href=\"https://stackoverflow.com/questions/35687929/how-to-retrieve-gopath-from-docker-container\">this</a> question but I still can't solve my issue.</p>\n"}, {"tags": ["go", "substring"], "answers": [{"tags": [], "owner": {"reputation": 6929, "user_id": 5749914, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/WvtTa.png?s=128&g=1", "display_name": "Warlike Chimpanzee", "link": "https://stackoverflow.com/users/5749914/warlike-chimpanzee"}, "is_accepted": true, "score": 229, "last_activity_date": 1584724035, "last_edit_date": 1584724035, "creation_date": 1500823658, "answer_id": 45266785, "question_id": 45266784, "link": "https://stackoverflow.com/questions/45266784/go-test-string-contains-substring/45266785#45266785", "title": "Go test string contains substring", "body": "<p>Use the function <code>Contains</code> from the <a href=\"https://golang.org/pkg/strings/?m=all#Contains\" rel=\"noreferrer\">strings</a> package.</p>\n\n<pre><code>import (\n    \"strings\"\n)\nstrings.Contains(\"something\", \"some\") // true\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1914, "user_id": 9811969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/184e2e46b8d8b8c483c85589709b8563?s=128&d=identicon&r=PG&f=1", "display_name": "Nik", "link": "https://stackoverflow.com/users/9811969/nik"}, "is_accepted": false, "score": 25, "last_activity_date": 1589657798, "creation_date": 1589657798, "answer_id": 61842548, "question_id": 45266784, "link": "https://stackoverflow.com/questions/45266784/go-test-string-contains-substring/61842548#61842548", "title": "Go test string contains substring", "body": "<p>To compare, there are more options:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"regexp\"\n    \"strings\"\n)\n\nconst (\n    str    = \"something\"\n    substr = \"some\"\n)\n\n// 1. Contains\nres := strings.Contains(str, substr)\nfmt.Println(res) // true\n\n// 2. Index: check the index of the first instance of substr in str, or -1 if substr is not present\ni := strings.Index(str, substr)\nfmt.Println(i) // 0\n\n// 3. Split by substr and check len of the slice, or length is 1 if substr is not present\nss := strings.Split(str, substr)\nfmt.Println(len(ss)) // 2\n\n// 4. Check number of non-overlapping instances of substr in str\nc := strings.Count(str, substr)\nfmt.Println(c) // 1\n\n// 5. RegExp\nmatched, _ := regexp.MatchString(substr, str)\nfmt.Println(matched) // true\n\n// 6. Compiled RegExp\nre = regexp.MustCompile(substr)\nres = re.MatchString(str)\nfmt.Println(res) // true\n</code></pre>\n\n<p>Benchmarks:\n<code>Contains</code> internally calls <code>Index</code>, so the speed is almost the same (btw Go 1.11.5 showed a bit bigger difference than on Go 1.14.3).</p>\n\n<pre><code>BenchmarkStringsContains-4              100000000               10.5 ns/op             0 B/op          0 allocs/op\nBenchmarkStringsIndex-4                 117090943               10.1 ns/op             0 B/op          0 allocs/op\nBenchmarkStringsSplit-4                  6958126               152 ns/op              32 B/op          1 allocs/op\nBenchmarkStringsCount-4                 42397729                29.1 ns/op             0 B/op          0 allocs/op\nBenchmarkStringsRegExp-4                  461696              2467 ns/op            1326 B/op         16 allocs/op\nBenchmarkStringsRegExpCompiled-4         7109509               168 ns/op               0 B/op          0 allocs/op\n</code></pre>\n"}], "owner": {"reputation": 6929, "user_id": 5749914, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/WvtTa.png?s=128&g=1", "display_name": "Warlike Chimpanzee", "link": "https://stackoverflow.com/users/5749914/warlike-chimpanzee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107251, "favorite_count": 12, "accepted_answer_id": 45266785, "answer_count": 2, "score": 136, "last_activity_date": 1589657798, "creation_date": 1500823658, "question_id": 45266784, "link": "https://stackoverflow.com/questions/45266784/go-test-string-contains-substring", "title": "Go test string contains substring", "body": "<p>How do I check if a string is a substring of another string in Go?\nFor example, I want to check <code>someString.contains(\"something\")</code>.</p>\n"}, {"tags": ["go", "race-condition", "goroutine"], "comments": [{"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 1, "creation_date": 1500825707, "post_id": 45266393, "comment_id": 77496962, "body": "Milo&#39;s answer is great, but Go can also tell you about this race condition even in cases where it doesn&#39;t bite you (the &quot;race&quot; always happens; it&#39;s just sometimes you win, sometimes you lose different ways). Try running this as <code>go run --race test.go</code> and you&#39;ll see the exact line of code that is impacted by the race."}, {"owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "reply_to_user": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1500863806, "post_id": 45266393, "comment_id": 77506497, "body": "@RobNapier thanks a lot"}], "answers": [{"comments": [{"owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "edited": false, "score": 0, "creation_date": 1500864330, "post_id": 45266853, "comment_id": 77506586, "body": "Single thread can only run on one core, right?  With  multiple thread it print 4(the correct result) more often. Why is this ? I have an update on my question. Thanks !"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "edited": false, "score": 0, "creation_date": 1500866713, "post_id": 45266853, "comment_id": 77507024, "body": "This is one of the &quot;joys&quot; of race conditions. There is no real way to tell what will happen or why. Why does it produce &quot;correct&quot; results more often on more cores? It probably has something to do with the exact relative speeds of various functions, and little details of the scheduler implementation. If you change the code or number and speed of cores the results will probably change randomly."}, {"owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "edited": false, "score": 0, "creation_date": 1500937537, "post_id": 45266853, "comment_id": 77545129, "body": "Hi, if I comment runtime.GoSched(), it will always be 4, no race condition, right?"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "edited": false, "score": 0, "creation_date": 1500938795, "post_id": 45266853, "comment_id": 77545435, "body": "Nope. The race will still be there, it just will be less likely to strike. To prevent data races you need explicit synchronization like mutexes or channels."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 2, "last_activity_date": 1500824078, "creation_date": 1500824078, "answer_id": 45266853, "question_id": 45266393, "link": "https://stackoverflow.com/questions/45266393/why-race-condition-with-goroutine-wont-happen-some-time/45266853#45266853", "title": "Why race condition with goroutine won&#39;t happen some time?", "body": "<p>Race conditions are, by definition, nondeterministic. This means that while you may get a particular answer most of the time, it will not always be so.</p>\n\n<p>By running racy code on multiple cores you greatly increases the number of possibilities, hence you get a broader selection of results.</p>\n\n<p>See <a href=\"https://stackoverflow.com/questions/34510/what-is-a-race-condition\">this post</a> or <a href=\"https://en.m.wikipedia.org/wiki/Race_condition\" rel=\"nofollow noreferrer\">this Wikipedia article</a> for more information on race conditions.</p>\n"}], "owner": {"reputation": 355, "user_id": 5819540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-qhhiN4wB3Fg/AAAAAAAAAAI/AAAAAAAAABg/agaXzdWPuSU/photo.jpg?sz=128", "display_name": "GZ Xue", "link": "https://stackoverflow.com/users/5819540/gz-xue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 45266853, "answer_count": 1, "score": 2, "last_activity_date": 1500863716, "creation_date": 1500821262, "last_edit_date": 1500863716, "question_id": 45266393, "link": "https://stackoverflow.com/questions/45266393/why-race-condition-with-goroutine-wont-happen-some-time", "title": "Why race condition with goroutine won&#39;t happen some time?", "body": "<p>I'm reading go-in-action. This example is from chapter6/listing09.go.</p>\n\n<pre><code>// This sample program demonstrates how to create race\n// conditions in our programs. We don't want to do this.\npackage main\n\nimport (\n  \"fmt\"\n  \"runtime\"\n  \"sync\"\n)\n\nvar (\n  // counter is a variable incremented by all goroutines.\n  counter int\n\n  // wg is used to wait for the program to finish.\n  wg sync.WaitGroup\n)\n\n// main is the entry point for all Go programs.\nfunc main() {\n  // Add a count of two, one for each goroutine.\n  wg.Add(2)\n\n  // Create two goroutines.\n  go incCounter(1)\n  go incCounter(2)\n\n  // Wait for the goroutines to finish.\n  wg.Wait()\n  fmt.Println(\"Final Counter:\", counter)\n }\n\n // incCounter increments the package level counter variable.\n func incCounter(id int) {\n    // Schedule the call to Done to tell main we are done.\n    defer wg.Done()\n\n    for count := 0; count &lt; 2; count++ {\n      // Capture the value of Counter.\n      value := counter\n\n      // Yield the thread and be placed back in queue.\n      runtime.Gosched()\n\n      // Increment our local value of Counter.\n      value++\n\n      // Store the value back into Counter.\n      counter = value\n  }\n}\n</code></pre>\n\n<p>If you run this code in play.golang.org, it will be 2, same as the book.\nBut my mac print 4 most of the time, some time 2, some time even 3.</p>\n\n<pre><code>$ go run listing09.go \nFinal Counter: 2\n$ go run listing09.go \nFinal Counter: 4\n$ go run listing09.go \nFinal Counter: 4\n$ go run listing09.go \nFinal Counter: 4\n$ go run listing09.go \nFinal Counter: 4\n$ go run listing09.go \nFinal Counter: 2\n$ go run listing09.go \nFinal Counter: 4\n$ go run listing09.go \nFinal Counter: 2\n$ go run listing09.go \nFinal Counter: 3\n</code></pre>\n\n<p>sysinfo\n    go version go1.8.1 darwin/amd64\n    macOS sierra\n    Macbook Pro</p>\n\n<p>Explanation from the book(p140)</p>\n\n<blockquote>\n  <p>Each goroutine overwrites the work of the other. This happens when the goroutine swap is taking place. Each goroutine makes its own copy of the counter variable and then is swapped out for the other goroutine. When the goroutine is given time to exe- cute again, the value of the counter variable has changed, but the goroutine doesn\u2019t update its copy. Instead it continues to increment the copy it has and set the value back to the counter variable, replacing the work the other goroutine performed.</p>\n</blockquote>\n\n<p>According to this explanation, this code should always print 2.</p>\n\n<ol>\n<li><p>Why I got 4 and 3? Is it because race condition didn't happen?</p></li>\n<li><p>Why go playground always get 2?</p></li>\n</ol>\n\n<hr>\n\n<p>update:</p>\n\n<p>After I set <code>runtime.GOMAXPROCS(1)</code>, it starts to print 2, no 4, some 3.\nI guess the play.golang.org is configured to have one logical processor.</p>\n\n<p>The right result 4 without race condition. One logical processor means one thread. GO has same logical processors as the physical cores by default.So, \nwhy one thread(one logical processor) leads to race condition while multiple thread print the right answer?</p>\n\n<p>Can we say the explanation from the book is wrong since we also get 3 and 4 ?\nHow it get 3 ? 4 is correct.</p>\n"}, {"tags": ["image", "go", "glide-golang"], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 0, "last_activity_date": 1500824537, "creation_date": 1500824537, "answer_id": 45266931, "question_id": 45266092, "link": "https://stackoverflow.com/questions/45266092/combining-two-pictures-in-golang/45266931#45266931", "title": "Combining two pictures in Golang", "body": "<p>To put it simply you need to draw one image partly overlapping the other, using a mask with a transparency gradient running from full transparency at the edge of the top image to full opaque at the edge of the bottom image.</p>\n\n<p>You will need to use <code>image/draw.DrawMask</code> to do this, and you will probably need to do some experimenting to get the amount of overlap looking right.</p>\n"}], "owner": {"reputation": 1, "user_id": 8353372, "user_type": "registered", "profile_image": "https://graph.facebook.com/1086298801469794/picture?type=large", "display_name": "Ezechiel Vaumi", "link": "https://stackoverflow.com/users/8353372/ezechiel-vaumi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 351, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1500824537, "creation_date": 1500819557, "question_id": 45266092, "link": "https://stackoverflow.com/questions/45266092/combining-two-pictures-in-golang", "title": "Combining two pictures in Golang", "body": "<p>I have been working for the past 15hrs trying to combine pitures so that it can have the same aspect like that of nametest</p>\n\n<p>my attempts\nIn golang , i have succeeded to combine two pictures by creating a bigger pictures and pasting the smaller pictures side by </p>\n\n<pre><code>src1, err := imaging.Open(\"public/images/g8.jpg\")\nif err != nil {\n    log.Fatalf(\"Open failed: %v\", err)\n}else{\n\n\n}\nsrc2, err := imaging.Open(\"public/images/f2.jpg\")\nif err != nil {\n    log.Fatalf(\"Open failed: %v\", err)\n}else{\ndstImage1 := imaging.Resize(src1, 256, 256, imaging.Lanczos)\ndstImage2 := imaging.Resize(src2, 256, 256, imaging.Lanczos)\n\n\n    dst := imaging.New(512, 256, color.NRGBA{0, 0, 0, 0})\n    dst = imaging.Paste(dst, dstImage1, image.Pt(0, 0))\n\n\n    dst = imaging.Paste(dst, dstImage2, image.Pt(256, 0)\n\nerr = imaging.Save(dst, \"public/images/g8.jpg\")\nif err != nil {\n    log.Fatalf(\"Save failed: %v\", err)\n}\n}\n</code></pre>\n\n<p>With this code, i was able to realise something like this\n <a href=\"http://scholar.myquotes.site/vaumi1.jpg\" rel=\"nofollow noreferrer\">http://scholar.myquotes.site/vaumi1.jpg</a> (sorry, i am not yet allowed to post images)\nbut it is clear that they are two completely different pictures, I want to be able to brush the meeting point of the images in such a way that there is no clear meeting part\n. In short i want a result like this one \n<a href=\"http://scholar.myquotes.site/vaumi.jpg\" rel=\"nofollow noreferrer\">http://scholar.myquotes.site/vaumi.jpg</a>\nthanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2643, "user_id": 1377323, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/963103a32936718819cd95ed38fb43fb?s=128&d=identicon&r=PG", "display_name": "herrbischoff", "link": "https://stackoverflow.com/users/1377323/herrbischoff"}, "edited": false, "score": 0, "creation_date": 1500817319, "post_id": 45264265, "comment_id": 77494337, "body": "Hello and welcome to StackOverflow. Please take some time to read the help page, especially the sections named <a href=\"http://stackoverflow.com/help/on-topic\">&quot;What topics can I ask about here?&quot;</a> and <a href=\"http://stackoverflow.com/help/dont-ask\">&quot;What types of questions should I avoid asking?&quot;</a>. And more importantly, please read <a href=\"http://meta.stackexchange.com/q/156810/204922\">the Stack Overflow question checklist</a>. You might also want to learn about <a href=\"http://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable Examples</a>."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 11, "user_id": 5202564, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204843570269332/picture?type=large", "display_name": "Sunil Raj", "link": "https://stackoverflow.com/users/5202564/sunil-raj"}, "edited": false, "score": 0, "creation_date": 1500813107, "post_id": 45264464, "comment_id": 77493147, "body": "No. I was trying to tell you to check the error. You&#39;re ignoring the error with <code>t, _ :=</code>.  Instead, <b>check the error</b> with <code>t, err := ...; if err != nil { ... }</code>"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1587627910, "last_edit_date": 1587627910, "creation_date": 1500808610, "answer_id": 45264464, "question_id": 45264265, "link": "https://stackoverflow.com/questions/45264265/invalid-memory-address-or-nil-pointer-deference-doing-tutorial/45264464#45264464", "title": "&quot;invalid memory address or nil pointer deference&quot; doing tutorial", "body": "<p>You appear to be executing an invalid or nil template. The error you're ignoring is probably the missing clue:</p>\n\n<pre><code>t, _ := template.ParseFiles(\"login.gtpl\")\n</code></pre>\n\n<p>Never ignore errors.</p>\n\n<p>Instead, <strong>check the error</strong> with</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>t, err := template.ParseFiles(\"login.gtpl\")\nif err != nil {\n    /* Report or handle the error here */\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 5202564, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204843570269332/picture?type=large", "display_name": "Sunil Raj", "link": "https://stackoverflow.com/users/5202564/sunil-raj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 45264464, "answer_count": 1, "score": -4, "last_activity_date": 1587627910, "creation_date": 1500807250, "last_edit_date": 1500807835, "question_id": 45264265, "link": "https://stackoverflow.com/questions/45264265/invalid-memory-address-or-nil-pointer-deference-doing-tutorial", "title": "&quot;invalid memory address or nil pointer deference&quot; doing tutorial", "body": "<p>This is the exact code copied from the tutorial. Im new in Go and web developing in general so im having a hard time debugging such error.</p>\n\n<pre><code> package main\n\nimport (\n    \"fmt\"\n    \"html/template\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n)\n\nfunc sayhelloName(w http.ResponseWriter, r *http.Request) {\n    r.ParseForm() //Parse url parameters passed, then parse the response packet for the POST body (request body)\n    // attention: If you do not call ParseForm method, the following data can not be obtained form\n    fmt.Println(r.Form) // print information on server side.\n    fmt.Println(\"path\", r.URL.Path)\n    fmt.Println(\"scheme\", r.URL.Scheme)\n    fmt.Println(r.Form[\"url_long\"])\n    for k, v := range r.Form {\n        fmt.Println(\"key:\", k)\n        fmt.Println(\"val:\", strings.Join(v, \"\"))\n    }\n    fmt.Fprintf(w, \"Hello astaxie!\") // write data to response\n}\n\nfunc login(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"method:\", r.Method) //get request method\n    if r.Method == \"GET\" {\n        t, _ := template.ParseFiles(\"login.gtpl\")\n        t.Execute(w, nil)\n    } else {\n        r.ParseForm()\n        // logic part of log in\n        fmt.Println(\"username:\", r.Form[\"username\"])\n        fmt.Println(\"password:\", r.Form[\"password\"])\n    }\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", sayhelloName) // setting router rule\n    http.HandleFunc(\"/login\", login)\n    err := http.ListenAndServe(\":9090\", nil) // setting listening port\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n\n<p>There is also another file called login.gtpl with basic html codes</p>\n\n<pre><code>&lt;html&gt;\n    &lt;head&gt;\n    &lt;title&gt;&lt;/title&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;form action=\"/login\" method=\"post\"&gt;\n            Username:&lt;input type=\"text\" name=\"username\"&gt;\n            Password:&lt;input type=\"password\" name=\"password\"&gt;\n            &lt;input type=\"submit\" value=\"Login\"&gt;\n        &lt;/form&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>here is the error message</p>\n\n<pre><code>2017/07/23 18:41:29 http: panic serving 127.0.0.1:61254: runtime error: invalid\nmemory address or nil pointer dereference\ngoroutine 18 [running]:\nnet/http.(*conn).serve.func1(0xc04203adc0)\n        C:/Go/src/net/http/server.go:1721 +0xd7\npanic(0x717940, 0x901950)\n        C:/Go/src/runtime/panic.go:489 +0x2dd\nhtml/template.(*Template).escape(0x0, 0x0, 0x0)\n        C:/Go/src/html/template/template.go:94 +0x3f\nhtml/template.(*Template).Execute(0x0, 0x8da500, 0xc0420fa0e0, 0x0, 0x0, 0xc0420\n08390, 0x90e480)\n        C:/Go/src/html/template/template.go:117 +0x36\nmain.login(0x8de180, 0xc0420fa0e0, 0xc042030400)\n        D:/sample/src/github.com/sunilrajramchandani/astaxie/web.go:29 +0x47e\nnet/http.HandlerFunc.ServeHTTP(0x786e68, 0x8de180, 0xc0420fa0e0, 0xc042030400)\n        C:/Go/src/net/http/server.go:1942 +0x4b\nnet/http.(*ServeMux).ServeHTTP(0x90e480, 0x8de180, 0xc0420fa0e0, 0xc042030400)\n        C:/Go/src/net/http/server.go:2238 +0x137\nnet/http.serverHandler.ServeHTTP(0xc04207ab00, 0x8de180, 0xc0420fa0e0, 0xc042030\n400)\n        C:/Go/src/net/http/server.go:2568 +0x99\nnet/http.(*conn).serve(0xc04203adc0, 0x8de740, 0xc04203e3c0)\n        C:/Go/src/net/http/server.go:1825 +0x619\ncreated by net/http.(*Server).Serve\n        C:/Go/src/net/http/server.go:2668 +0x2d5\nmethod: GET\n2017/07/23 18:41:29 http: panic serving 127.0.0.1:61255: runtime error: invalid\nmemory address or nil pointer dereference\ngoroutine 4 [running]:\nnet/http.(*conn).serve.func1(0xc0420f0000)\n        C:/Go/src/net/http/server.go:1721 +0xd7\npanic(0x717940, 0x901950)\n        C:/Go/src/runtime/panic.go:489 +0x2dd\nhtml/template.(*Template).escape(0x0, 0x0, 0x0)\n        C:/Go/src/html/template/template.go:94 +0x3f\nhtml/template.(*Template).Execute(0x0, 0x8da500, 0xc04213e000, 0x0, 0x0, 0xc0421\n36090, 0x90e480)\n        C:/Go/src/html/template/template.go:117 +0x36\nmain.login(0x8de180, 0xc04213e000, 0xc042030500)\n        D:/sample/src/github.com/sunilrajramchandani/astaxie/web.go:29 +0x47e\nnet/http.HandlerFunc.ServeHTTP(0x786e68, 0x8de180, 0xc04213e000, 0xc042030500)\n        C:/Go/src/net/http/server.go:1942 +0x4b\nnet/http.(*ServeMux).ServeHTTP(0x90e480, 0x8de180, 0xc04213e000, 0xc042030500)\n        C:/Go/src/net/http/server.go:2238 +0x137\nnet/http.serverHandler.ServeHTTP(0xc04207ab00, 0x8de180, 0xc04213e000, 0xc042030\n500)\n        C:/Go/src/net/http/server.go:2568 +0x99\nnet/http.(*conn).serve(0xc0420f0000, 0x8de740, 0xc04203e500)\n        C:/Go/src/net/http/server.go:1825 +0x619\ncreated by net/http.(*Server).Serve\n        C:/Go/src/net/http/server.go:2668 +0x2d5\nmethod: GET\n2017/07/23 18:41:29 http: panic serving 127.0.0.1:61257: runtime error: invalid\nmemory address or nil pointer dereference\ngoroutine 6 [running]:\nnet/http.(*conn).serve.func1(0xc0420f00a0)\n        C:/Go/src/net/http/server.go:1721 +0xd7\npanic(0x717940, 0x901950)\n        C:/Go/src/runtime/panic.go:489 +0x2dd\nhtml/template.(*Template).escape(0x0, 0x0, 0x0)\n        C:/Go/src/html/template/template.go:94 +0x3f\nhtml/template.(*Template).Execute(0x0, 0x8da500, 0xc0420fa2a0, 0x0, 0x0, 0xc0420\n084b0, 0x90e480)\n        C:/Go/src/html/template/template.go:117 +0x36\nmain.login(0x8de180, 0xc0420fa2a0, 0xc042162000)\n        D:/sample/src/github.com/sunilrajramchandani/astaxie/web.go:29 +0x47e\nnet/http.HandlerFunc.ServeHTTP(0x786e68, 0x8de180, 0xc0420fa2a0, 0xc042162000)\n        C:/Go/src/net/http/server.go:1942 +0x4b\nnet/http.(*ServeMux).ServeHTTP(0x90e480, 0x8de180, 0xc0420fa2a0, 0xc042162000)\n        C:/Go/src/net/http/server.go:2238 +0x137\nnet/http.serverHandler.ServeHTTP(0xc04207ab00, 0x8de180, 0xc0420fa2a0, 0xc042162\n000)\n        C:/Go/src/net/http/server.go:2568 +0x99\nnet/http.(*conn).serve(0xc0420f00a0, 0x8de740, 0xc04210c140)\n        C:/Go/src/net/http/server.go:1825 +0x619\ncreated by net/http.(*Server).Serve\n        C:/Go/src/net/http/server.go:2668 +0x2d5\nmethod: GET\n2017/07/23 18:41:29 http: panic serving 127.0.0.1:61259: runtime error: invalid\nmemory address or nil pointer dereference\ngoroutine 8 [running]:\nnet/http.(*conn).serve.func1(0xc0420f0140)\n        C:/Go/src/net/http/server.go:1721 +0xd7\npanic(0x717940, 0x901950)\n        C:/Go/src/runtime/panic.go:489 +0x2dd\nhtml/template.(*Template).escape(0x0, 0x0, 0x0)\n        C:/Go/src/html/template/template.go:94 +0x3f\nhtml/template.(*Template).Execute(0x0, 0x8da500, 0xc0420ec1c0, 0x0, 0x0, 0xc0420\n62f30, 0x90e480)\n        C:/Go/src/html/template/template.go:117 +0x36\nmain.login(0x8de180, 0xc0420ec1c0, 0xc042000400)\n        D:/sample/src/github.com/sunilrajramchandani/astaxie/web.go:29 +0x47e\nnet/http.HandlerFunc.ServeHTTP(0x786e68, 0x8de180, 0xc0420ec1c0, 0xc042000400)\n        C:/Go/src/net/http/server.go:1942 +0x4b\nnet/http.(*ServeMux).ServeHTTP(0x90e480, 0x8de180, 0xc0420ec1c0, 0xc042000400)\n        C:/Go/src/net/http/server.go:2238 +0x137\nnet/http.serverHandler.ServeHTTP(0xc04207ab00, 0x8de180, 0xc0420ec1c0, 0xc042000\n400)\n        C:/Go/src/net/http/server.go:2568 +0x99\nnet/http.(*conn).serve(0xc0420f0140, 0x8de740, 0xc04200a5c0)\n        C:/Go/src/net/http/server.go:1825 +0x619\ncreated by net/http.(*Server).Serve\n        C:/Go/src/net/http/server.go:2668 +0x2d5\nmethod: GET\n2017/07/23 18:41:34 http: panic serving 127.0.0.1:61264: runtime error: invalid\nmemory address or nil pointer dereference\ngoroutine 34 [running]:\nnet/http.(*conn).serve.func1(0xc042198000)\n        C:/Go/src/net/http/server.go:1721 +0xd7\npanic(0x717940, 0x901950)\n        C:/Go/src/runtime/panic.go:489 +0x2dd\nhtml/template.(*Template).escape(0x0, 0x0, 0x0)\n        C:/Go/src/html/template/template.go:94 +0x3f\nhtml/template.(*Template).Execute(0x0, 0x8da500, 0xc04213e1c0, 0x0, 0x0, 0xc0421\n361b0, 0x90e480)\n        C:/Go/src/html/template/template.go:117 +0x36\nmain.login(0x8de180, 0xc04213e1c0, 0xc042030600)\n        D:/sample/src/github.com/sunilrajramchandani/astaxie/web.go:29 +0x47e\nnet/http.HandlerFunc.ServeHTTP(0x786e68, 0x8de180, 0xc04213e1c0, 0xc042030600)\n        C:/Go/src/net/http/server.go:1942 +0x4b\nnet/http.(*ServeMux).ServeHTTP(0x90e480, 0x8de180, 0xc04213e1c0, 0xc042030600)\n        C:/Go/src/net/http/server.go:2238 +0x137\nnet/http.serverHandler.ServeHTTP(0xc04207ab00, 0x8de180, 0xc04213e1c0, 0xc042030\n600)\n        C:/Go/src/net/http/server.go:2568 +0x99\nnet/http.(*conn).serve(0xc042198000, 0x8de740, 0xc04203e780)\n        C:/Go/src/net/http/server.go:1825 +0x619\ncreated by net/http.(*Server).Serve\n        C:/Go/src/net/http/server.go:2668 +0x2d5\nmethod: GET\n2017/07/23 18:42:04 http: panic serving 127.0.0.1:61279: runtime error: invalid\nmemory address or nil pointer dereference\ngoroutine 36 [running]:\nnet/http.(*conn).serve.func1(0xc0421980a0)\n        C:/Go/src/net/http/server.go:1721 +0xd7\npanic(0x717940, 0x901950)\n        C:/Go/src/runtime/panic.go:489 +0x2dd\nhtml/template.(*Template).escape(0x0, 0x0, 0x0)\n        C:/Go/src/html/template/template.go:94 +0x3f\nhtml/template.(*Template).Execute(0x0, 0x8da500, 0xc0420fa460, 0x0, 0x0, 0xc0420\n085d0, 0x90e480)\n        C:/Go/src/html/template/template.go:117 +0x36\nmain.login(0x8de180, 0xc0420fa460, 0xc042162100)\n        D:/sample/src/github.com/sunilrajramchandani/astaxie/web.go:29 +0x47e\nnet/http.HandlerFunc.ServeHTTP(0x786e68, 0x8de180, 0xc0420fa460, 0xc042162100)\n        C:/Go/src/net/http/server.go:1942 +0x4b\nnet/http.(*ServeMux).ServeHTTP(0x90e480, 0x8de180, 0xc0420fa460, 0xc042162100)\n        C:/Go/src/net/http/server.go:2238 +0x137\nnet/http.serverHandler.ServeHTTP(0xc04207ab00, 0x8de180, 0xc0420fa460, 0xc042162\n100)\n        C:/Go/src/net/http/server.go:2568 +0x99\nnet/http.(*conn).serve(0xc0421980a0, 0x8de740, 0xc04210c3c0)\n        C:/Go/src/net/http/server.go:1825 +0x619\ncreated by net/http.(*Server).Serve\n        C:/Go/src/net/http/server.go:2668 +0x2d5\nmethod: GET\n2017/07/23 18:43:04 http: panic serving 127.0.0.1:61329: runtime error: invalid\nmemory address or nil pointer dereference\ngoroutine 10 [running]:\nnet/http.(*conn).serve.func1(0xc0420f01e0)\n        C:/Go/src/net/http/server.go:1721 +0xd7\npanic(0x717940, 0x901950)\n        C:/Go/src/runtime/panic.go:489 +0x2dd\nhtml/template.(*Template).escape(0x0, 0x0, 0x0)\n        C:/Go/src/html/template/template.go:94 +0x3f\nhtml/template.(*Template).Execute(0x0, 0x8da500, 0xc04213e380, 0x0, 0x0, 0xc0421\n362d0, 0x90e480)\n        C:/Go/src/html/template/template.go:117 +0x36\nmain.login(0x8de180, 0xc04213e380, 0xc042030700)\n        D:/sample/src/github.com/sunilrajramchandani/astaxie/web.go:29 +0x47e\nnet/http.HandlerFunc.ServeHTTP(0x786e68, 0x8de180, 0xc04213e380, 0xc042030700)\n        C:/Go/src/net/http/server.go:1942 +0x4b\nnet/http.(*ServeMux).ServeHTTP(0x90e480, 0x8de180, 0xc04213e380, 0xc042030700)\n        C:/Go/src/net/http/server.go:2238 +0x137\nnet/http.serverHandler.ServeHTTP(0xc04207ab00, 0x8de180, 0xc04213e380, 0xc042030\n700)\n        C:/Go/src/net/http/server.go:2568 +0x99\nnet/http.(*conn).serve(0xc0420f01e0, 0x8de740, 0xc04203e880)\n        C:/Go/src/net/http/server.go:1825 +0x619\ncreated by net/http.(*Server).Serve\n        C:/Go/src/net/http/server.go:2668 +0x2d5\n</code></pre>\n"}, {"tags": ["regex", "go", "literals"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1500808884, "post_id": 45263689, "comment_id": 77491834, "body": "@Flimzy: line 16"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1500824768, "post_id": 45263689, "comment_id": 77496668, "body": "Is it possible that you need to escape the backtick in the pattern?"}], "owner": {"reputation": 21, "user_id": 7483203, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_XkFT80wjJA/AAAAAAAAAAI/AAAAAAAAG2o/-F_8zPboVVA/photo.jpg?sz=128", "display_name": "\u5927\u7ef5\u7f8a", "link": "https://stackoverflow.com/users/7483203/%e5%a4%a7%e7%bb%b5%e7%be%8a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1331, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1500809748, "creation_date": 1500803181, "last_edit_date": 1500809748, "question_id": 45263689, "link": "https://stackoverflow.com/questions/45263689/go-literal-not-terminated-error", "title": "Go literal not terminated error", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"strings\"\n\n    \"github.com/oleksandr/conditions\"\n)\n\nfunc main() {\n    s := \"[test] =~ /^1`\\\\d+/\"\n\n    // Parse the condition language and get expression\n    p := conditions.NewParser(strings.NewReader(s))\n    expr, err := p.Parse()\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(-1)\n    }\n\n    test_data := map[string]interface{}{\n        \"test\": \"1`1499095372\",\n        \"2\":    \"1\",\n    }\n\n    r, err := conditions.Evaluate(expr, test_data)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(-1)\n    }\n\n    fmt.Println(\"result:\", r)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&lt;input&gt;:1:14: literal not terminated\n</code></pre>\n\n<p>How can I avoid this error in the regular expression literal <code>s</code> parsed by<code>conditions</code> package?</p>\n"}]