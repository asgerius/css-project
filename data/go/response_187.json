[{"tags": ["parsing", "go"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 5, "creation_date": 1533772901, "post_id": 51757136, "comment_id": 90473749, "body": "<a href=\"https://stackoverflow.com/questions/3730019/why-not-use-double-or-float-to-represent-currency\">I don&#39;t think you should use floats for currency values</a>."}, {"owner": {"reputation": 35, "user_id": 5486334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38cd3de94db3f1a746947bdfcc354790?s=128&d=identicon&r=PG&f=1", "display_name": "Alz_dev", "link": "https://stackoverflow.com/users/5486334/alz-dev"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1533773233, "post_id": 51757136, "comment_id": 90473806, "body": "great point, thank you. I&#39;ll make a change based off this"}, {"owner": {"reputation": 35, "user_id": 5486334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38cd3de94db3f1a746947bdfcc354790?s=128&d=identicon&r=PG&f=1", "display_name": "Alz_dev", "link": "https://stackoverflow.com/users/5486334/alz-dev"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1533779259, "post_id": 51757136, "comment_id": 90474932, "body": "So, for this example - the amount that the API is returning is unfortunately a string. I&#39;ve done a quick work around (just to have the ability to check if the actual amount is the same as the string amount).  Example is here: <a href=\"https://play.golang.org/p/7oxqCwX4QSx\" rel=\"nofollow noreferrer\">play.golang.org/p/7oxqCwX4QSx</a> I&#39;m not sure if this is the best solution, but this seemed to be the easiest way to get a float that was a string to a uint. Feel free to add constructive criticism!"}, {"owner": {"reputation": 35, "user_id": 5486334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38cd3de94db3f1a746947bdfcc354790?s=128&d=identicon&r=PG&f=1", "display_name": "Alz_dev", "link": "https://stackoverflow.com/users/5486334/alz-dev"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1533788196, "post_id": 51757136, "comment_id": 90476687, "body": "Not sure why this warranted a downvote"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533819692, "post_id": 51757136, "comment_id": 90494137, "body": "The question is founded on an expectation that binary floats have perfect precision, which they don&#39;t. You&#39;re seeing rounding which you are causing when converting a float to an int. That&#39;s just how floats work; the binary floating-point representation of e.g. decimal <code>1.23</code> is not exactly <code>1.23</code>."}, {"owner": {"reputation": 35, "user_id": 5486334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38cd3de94db3f1a746947bdfcc354790?s=128&d=identicon&r=PG&f=1", "display_name": "Alz_dev", "link": "https://stackoverflow.com/users/5486334/alz-dev"}, "edited": false, "score": 0, "creation_date": 1533853761, "post_id": 51757136, "comment_id": 90511576, "body": "Thanks! I&#39;ll keep this in mind for when I&#39;m working with Ints and Floats. Very useful information!"}], "answers": [{"tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": -1, "last_activity_date": 1533781532, "creation_date": 1533781532, "answer_id": 51757969, "question_id": 51757136, "link": "https://stackoverflow.com/questions/51757136/golang-parsefloat-not-accurate-in-example/51757969#51757969", "title": "Golang ParseFloat not accurate in example", "body": "<p>you can split the string, and parse them to an int.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n    )\n\nfunc main() {\n    a:=strings.Split(\"75.35\",\".\")\n    if len(a)&gt;2{\n    panic(\"badly formatted price\")    \n     }\n    v,_:=strconv.ParseInt(a[1],10,64)\n    w,_:=strconv.ParseInt(a[0],10,64)\n   fmt.Println(uint(w*100+v))\n}\n</code></pre>\n\n<p>its working in this link <a href=\"https://play.golang.org/p/5s_FTAKSo9M\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5s_FTAKSo9M</a></p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1533816650, "creation_date": 1533816650, "answer_id": 51766671, "question_id": 51757136, "link": "https://stackoverflow.com/questions/51757136/golang-parsefloat-not-accurate-in-example/51766671#51766671", "title": "Golang ParseFloat not accurate in example", "body": "<p>Go uses <a href=\"https://en.wikipedia.org/wiki/IEEE_754\" rel=\"nofollow noreferrer\">IEEE-754</a> binary floating-point numbers. Floating-point numbers are imprecise. Don't use them for financial transactions. Use integers.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc parseCents(s string) (int64, error) {\n    n := strings.SplitN(s, \".\", 3)\n    if len(n) != 2 || len(n[1]) != 2 {\n        err := fmt.Errorf(\"format error: %s\", s)\n        return 0, err\n    }\n    d, err := strconv.ParseInt(n[0], 10, 56)\n    if err != nil {\n        return 0, err\n    }\n    c, err := strconv.ParseUint(n[1], 10, 8)\n    if err != nil {\n        return 0, err\n    }\n    if d &lt; 0 {\n        c = -c\n    }\n    return d*100 + int64(c), nil\n}\n\nfunc main() {\n    s := \"79.35\"\n    fmt.Println(parseCents(s))\n    s = \"149.20\"\n    fmt.Println(parseCents(s))\n    s = \"-149.20\"\n    fmt.Println(parseCents(s))\n    s = \"149.2\"\n    fmt.Println(parseCents(s))\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/mGuO51QWyIv\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mGuO51QWyIv</a></p>\n\n<p>Output:</p>\n\n<pre><code>7935 &lt;nil&gt;\n14920 &lt;nil&gt;\n-14920 &lt;nil&gt;\n0 format error: 149.2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 1458633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0ee9bc2222395f74940b329bdca007e?s=128&d=identicon&r=PG", "display_name": "qiangwang", "link": "https://stackoverflow.com/users/1458633/qiangwang"}, "is_accepted": false, "score": 0, "last_activity_date": 1559993110, "creation_date": 1559993110, "answer_id": 56505909, "question_id": 51757136, "link": "https://stackoverflow.com/questions/51757136/golang-parsefloat-not-accurate-in-example/56505909#56505909", "title": "Golang ParseFloat not accurate in example", "body": "<p>Based on @peterSO's answer, with some bugfix and enhancement:</p>\n\n<p><a href=\"https://play.golang.org/p/YcRLeEJ7lTA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/YcRLeEJ7lTA</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc parseCents(s string) (int64, error) {\n    var ds string\n    var cs string\n\n    n := strings.SplitN(s, \".\", 3)\n    switch len(n) {\n    case 1:\n        ds = n[0]\n        cs = \"0\"\n    case 2:\n        ds = n[0]\n        switch len(n[1]) {\n        case 1:\n            cs = n[1] + \"0\"\n        case 2:\n            cs = n[1]\n        default:\n            return 0, fmt.Errorf(\"invalid format\uff1a%s\", s)\n        }\n    default:\n        return 0, fmt.Errorf(\"invalid format\uff1a%s\", s)\n    }\n\n    d, err := strconv.ParseInt(ds, 10, 0)\n    if err != nil {\n        return 0, err\n    }\n\n    c, err := strconv.ParseUint(cs, 10, 0)\n    if err != nil {\n        return 0, err\n    }\n\n    cents := d * 100\n\n    if strings.HasPrefix(s, \"-\") {\n        cents -= int64(c)\n    } else {\n        cents += int64(c)\n    }\n\n    return cents, nil\n}\n\nfunc main() {\n    examples := map[string]int64{\n        \"79.35\": 7935,\n        \"149.20\": 14920,\n        \"-149.20\": -14920,\n        \"149.2\": 14920,\n        \"-0.12\": -12,\n        \"12\": 1200,\n        \"1.234\": 0,\n        \"1.2.34\": 0,\n    }\n\n    for s, v := range examples {\n        cents, err := parseCents(s)\n        fmt.Println(cents, cents == v, err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 5486334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38cd3de94db3f1a746947bdfcc354790?s=128&d=identicon&r=PG&f=1", "display_name": "Alz_dev", "link": "https://stackoverflow.com/users/5486334/alz-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1048, "favorite_count": 1, "accepted_answer_id": 51766671, "answer_count": 3, "score": 0, "last_activity_date": 1559993110, "creation_date": 1533772525, "question_id": 51757136, "link": "https://stackoverflow.com/questions/51757136/golang-parsefloat-not-accurate-in-example", "title": "Golang ParseFloat not accurate in example", "body": "<p>I've been working on a project where I have to convert a string to a uint, to make sure some money values are matching:</p>\n\n<pre><code>total, err := strconv.ParseFloat(paymentResp.Transactions[0].Amount.Total, 64)\nif err != nil {\n    return ctx.JSON(http.StatusBadRequest, err.Error())\n}\n\nif o.TotalPrice != uint(total*100) {\n    return ctx.JSON(http.StatusBadRequest, \"Unable to verify amount paid\")\n}\n</code></pre>\n\n<p>But I've seemingly found a problem when trying to do the <code>strconv.ParseFloat()</code> on a couple of numbers, then attempting to multiply them by 100 (to get the cents value).</p>\n\n<p>I've created an example here: <a href=\"https://play.golang.org/p/MAzkicsnCb0\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<pre><code>f, _ := strconv.ParseFloat(\"79.35\", 64)\nfmt.Println(uint(f*100))  //7934\n\nf2, _ := strconv.ParseFloat(\"149.20\", 64)\nfmt.Println(uint(f2*100)) //14919\n</code></pre>\n\n<p>Is <code>ParseFloat()</code> what I should be using in this scenario? If not, I'd love to hear a brief explanation on this, as I'm still a programmer in learning.</p>\n"}, {"tags": ["google-app-engine", "go", "app-engine-flexible", "google-app-engine-go"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 1415923, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/062bca1c7fca0c9908b56731ace23761?s=128&d=identicon&r=PG", "display_name": "jcarlile", "link": "https://stackoverflow.com/users/1415923/jcarlile"}, "edited": false, "score": 0, "creation_date": 1533776243, "post_id": 51757330, "comment_id": 90474378, "body": "I have two separate projects, one that is Go Standard Environment, and one that is Go Flexible Environment.  The std env project has a dispatch file with the standard patterns like &#39;  # Project related requests go to project service   - url: &quot;<i>/api/project</i>&quot;     service: project-svc&#39; and the flexible environment project does not have a dispatch file"}], "tags": [], "owner": {"reputation": 4450, "user_id": 4458510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/GZUMI.png?s=128&g=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4458510/alex"}, "is_accepted": false, "score": 0, "last_activity_date": 1533774620, "creation_date": 1533774620, "answer_id": 51757330, "question_id": 51757088, "link": "https://stackoverflow.com/questions/51757088/routing-between-app-engine-standard-environment-and-flexible-environment-project/51757330#51757330", "title": "Routing between App Engine Standard Environment and Flexible Environment projects in production", "body": "<p>What does your dispatch.yaml &amp; yaml for your services look like?</p>\n\n<p>Did you mean that you have 2 services in the same project (not 2 separate projects)?</p>\n\n<p>If so you can do this</p>\n\n<p><a href=\"https://cloud.google.com/appengine/docs/standard/python/how-requests-are-routed\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/standard/python/how-requests-are-routed</a></p>\n\n<p><code>https://[SERVICE_ID]-dot-[MY_PROJECT_ID].appspot.com</code></p>\n"}, {"tags": [], "owner": {"reputation": 23, "user_id": 1415923, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/062bca1c7fca0c9908b56731ace23761?s=128&d=identicon&r=PG", "display_name": "jcarlile", "link": "https://stackoverflow.com/users/1415923/jcarlile"}, "is_accepted": false, "score": 1, "last_activity_date": 1533784705, "creation_date": 1533784705, "answer_id": 51758325, "question_id": 51757088, "link": "https://stackoverflow.com/questions/51757088/routing-between-app-engine-standard-environment-and-flexible-environment-project/51758325#51758325", "title": "Routing between App Engine Standard Environment and Flexible Environment projects in production", "body": "<p>I went with a reverse proxy approach, and it is now behaving as I'd hoped.  This blog post was very helpful in arriving at a solution <a href=\"https://blog.semanticart.com/2013/11/11/a-proper-api-proxy-written-in-go/\" rel=\"nofollow noreferrer\">https://blog.semanticart.com/2013/11/11/a-proper-api-proxy-written-in-go/</a> </p>\n"}], "owner": {"reputation": 23, "user_id": 1415923, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/062bca1c7fca0c9908b56731ace23761?s=128&d=identicon&r=PG", "display_name": "jcarlile", "link": "https://stackoverflow.com/users/1415923/jcarlile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1533784705, "creation_date": 1533771997, "question_id": 51757088, "link": "https://stackoverflow.com/questions/51757088/routing-between-app-engine-standard-environment-and-flexible-environment-project", "title": "Routing between App Engine Standard Environment and Flexible Environment projects in production", "body": "<p>I have two App Engine projects in Go that comprise a single user-facing app.  One project is a Standard Environment project and has the bulk of the functionality and also serves the React frontend static bundle.  The second project is a Flexible Environment project and serves a specific purpose of communicating with and transferring large files to a third-party API (it is a Flexible Environment project b/c we ran into size limitations using urlfetch).</p>\n\n<p>Now that I am deploying the app, I am running into a problem with api requests from the frontend.  In development, our frontend node server would proxy requests, e.g. /api/project and /api/user to the appropriate App Engine services running on different ports, but in production, my standard environment project is at something like <a href=\"https://my-project-std.appspot.com\" rel=\"nofollow noreferrer\">https://my-project-std.appspot.com</a>, and the flexible env project is at something like <a href=\"https://my-project-flex.appspot.com\" rel=\"nofollow noreferrer\">https://my-project-flex.appspot.com</a>.</p>\n\n<p>I use a dispatch.yaml file with the std env project to route api requests (e.g. /api/project and /api/user) to the appropriate service, but am not sure the best way to route requests that should go to the flexible environment service (e.g. /api/model).  Should I route them through the std env project and redirect? setup a reverse proxy? some other approach? </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "web", "server", "architecture", "synchronization"], "answers": [{"comments": [{"owner": {"reputation": 419, "user_id": 1376112, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w2teu.png?s=128&g=1", "display_name": "elmango", "link": "https://stackoverflow.com/users/1376112/elmango"}, "edited": false, "score": 0, "creation_date": 1533834557, "post_id": 51760249, "comment_id": 90503845, "body": "Thank you for your answer Peter. I had considered using some kind of queue too but not exactly the in the same way you propose.   Wouldn&#39;t it still be possible that clients receive messages that are already applied to the initial state though?. For instance, if the server generates an event while reg.init was preparing the initial payload (fetching stuff from the db, etc.), the event could be already applied to this bundle but it will be sent again to the client after init returns, because it was not in the list of recent messages."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 419, "user_id": 1376112, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w2teu.png?s=128&g=1", "display_name": "elmango", "link": "https://stackoverflow.com/users/1376112/elmango"}, "edited": false, "score": 0, "creation_date": 1533835566, "post_id": 51760249, "comment_id": 90504341, "body": "The assumption here was that you create the initial message from some sort of snapshot. If that&#39;s not the case then yes, there may be redundant messages. That&#39;s only a concern if the end result isn&#39;t idempotent though. But then again, is an inconsistent initial state really useful? It&#39;s hard to talk about this without knowing any details about your application."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 1, "last_activity_date": 1533796326, "creation_date": 1533796326, "answer_id": 51760249, "question_id": 51756075, "link": "https://stackoverflow.com/questions/51756075/race-conditions-in-client-synchronization/51760249#51760249", "title": "Race conditions in client synchronization", "body": "<p>I have used a write-ahead-log in the past to do something like this. In short, keep a ring buffer of messages in the hub. Then replay messages that where send to existing clients while the new one was initialized.</p>\n\n<p>You can expose this concept to the clients too if you wish. That way you can implement efficient re-connects (particularly nice for mobile connections). When clients loose the websocket connection they can reconnect and say \"Hey there, it's me again. Looks like we got interrupted. The last message I've seen was number 42. What's new?\"</p>\n\n<p>The following is from memory, so take this only as an illustration of the idea, not a finished implementation. In the intererest of brevity I've omited the select statements around <code>client.send</code>, for instance.</p>\n\n<pre><code>package main\n\nimport (\n    \"container/list\"\n    \"sync\"\n\n    \"github.com/gorilla/websocket\"\n)\n\ntype Client struct { // all unchanged\n    hub  *Hub\n    conn *websocket.Conn\n    send chan []byte\n}\n\ntype Hub struct {\n    mu      *sync.RWMutex\n    wal     list.List        // List if recent messages\n    clients map[*Client]bool // Registered clients.\n\n    register chan Registration // not a chan *Client anymore\n\n    broadcast  chan []byte\n    unregister chan *Client\n}\n\ntype Registration struct {\n    client *Client\n\n    // init is a function that is executed before the client starts to receive\n    // broadcast messages. All messages that are broadcast while init is\n    // running will be sent after init returns.\n    init func()\n}\n\nfunc (h *Hub) run() {\n    for {\n        select {\n        case reg := &lt;-h.register:\n            // Take note of the most recent message as of right now. \n            // initClient will replay all later messages\n            h.mu.RLock()\n            head := h.wal.Back()\n            h.mu.RUnlock()\n\n            go h.initClient(reg, head)\n        case client := &lt;-h.unregister:\n            h.mu.Lock()\n            if _, ok := h.clients[client]; ok {\n                delete(h.clients, client)\n                close(client.send)\n            }\n            h.mu.Unlock()\n        case message := &lt;-h.broadcast:\n            h.mu.Lock()\n            h.wal.PushBack(message)\n            // TODO: Trim list if too long by some metric (e.g. number of\n            // messages, age, total message size, etc.)\n\n            clients := make([]*Client, len(h.clients))\n            copy(clients, h.clients)\n            h.mu.Unlock()\n\n            for client := range clients {\n                // TODO: deal with backpressure\n                client.send &lt;- message\n            }\n        }\n    }\n}\n\nfunc (h *Hub) initClient(reg Registration, head *list.Element) {\n    reg.init()\n\n    // send messages in h.wal after head\n    for {\n        h.mu.RLock()\n        head = head.Next()\n        if head == nil {\n            // caught up\n            h.clients[reg.client] = true\n            h.mu.RUnlock()\n            return\n        }\n        h.mu.RUnlock()\n\n        // TODO: deal with backpressure\n        reg.client.send &lt;- head.Value.([]byte)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 419, "user_id": 1376112, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w2teu.png?s=128&g=1", "display_name": "elmango", "link": "https://stackoverflow.com/users/1376112/elmango"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1533796326, "creation_date": 1533764715, "question_id": 51756075, "link": "https://stackoverflow.com/questions/51756075/race-conditions-in-client-synchronization", "title": "Race conditions in client synchronization", "body": "<p>I have a web app whose server creates a Client for each websocket connection. A Client acts as an intermediary between the websocket connection and a single instance of a Hub. The Hub maintains a set of registered clients and broadcasts messages to the clients. This works pretty well but the problem is that a client might miss events between when the server generates the initial state bundle that the client receives on connection and when the client is registered with the hub and starts receiving broadcast events.</p>\n\n<p>My idea is to register the client with the hub before any information is fetched from the db. That would ensure that the client doesn't miss any broadcasts, though now it could receive messages that are already applied to the initial state it receives. To allow the client to disregard these messages I could include a monotonic timestamp in both the initial state bundle as well as broadcast events.</p>\n\n<p>Can you think of a more elegant/simpler solution?</p>\n"}, {"tags": ["pointers", "go", "struct"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 2, "creation_date": 1533760327, "post_id": 51755143, "comment_id": 90470022, "body": "They <i>do completely different things</i>, and they only look the same in trivial examples. So you should choose the one that does what you want, not based on performance."}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1533760531, "post_id": 51755143, "comment_id": 90470135, "body": "Can you please elaborate <code>they do completely different things</code>, I want to learn and know them, or if you can provide any reference URL, where I can know more about it based on my situation above or anything nearby. That will be great help. Thanks"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1533762352, "post_id": 51755143, "comment_id": 90470911, "body": "Neither one is &quot;better&quot; than the other, they&#39;re different."}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "edited": false, "score": 0, "creation_date": 1533763368, "post_id": 51755143, "comment_id": 90471242, "body": "any source or reference to learn more about it, why it&#39;s different based on golang perspective."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1533768006, "post_id": 51755143, "comment_id": 90472706, "body": "<a href=\"https://tour.golang.org/moretypes/1\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/1</a> ff"}], "answers": [{"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1533785355, "post_id": 51758080, "comment_id": 90476058, "body": "Advise 1 is wrong in the form stated. Pointers are not per se faster, they might be even slower (due to non-local memory access and cache misses e.g.)."}, {"owner": {"reputation": 153, "user_id": 4974261, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ewCosYzy7EI/AAAAAAAAAAI/AAAAAAAAAfQ/rvklfLv5qCU/photo.jpg?sz=128", "display_name": "Eli Davis", "link": "https://stackoverflow.com/users/4974261/eli-davis"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1533789370, "post_id": 51758080, "comment_id": 90476987, "body": "If I pass a struct instead and it&#39;s not in local memory, you still have a cache miss. Or am I mistaken?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1533792108, "post_id": 51758080, "comment_id": 90477815, "body": "If you have a struct with value types only like the second version of struct Discussion then everything in it, including fields of Owner will be laied out continuously in memory. This is a bad example as strings are non-local, but think of <code>struct A { X, Y int; V struct { W bool, Z float64}}</code> and a slice <code>[]A</code>. Reading through the whole slice is just one sequential memory access, even if you read A.V.Z. If you make V a pointer then iterating the slice and reading A.V.Z becomes non linear. It is not about passing argument to functions. That is slow always, well, because function."}], "tags": [], "owner": {"reputation": 153, "user_id": 4974261, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ewCosYzy7EI/AAAAAAAAAAI/AAAAAAAAAfQ/rvklfLv5qCU/photo.jpg?sz=128", "display_name": "Eli Davis", "link": "https://stackoverflow.com/users/4974261/eli-davis"}, "is_accepted": false, "score": -2, "last_activity_date": 1533782546, "creation_date": 1533782546, "answer_id": 51758080, "question_id": 51755143, "link": "https://stackoverflow.com/questions/51755143/pointer-or-no-pointer-for-golang-struct-to-reference-other-struct-and-why/51758080#51758080", "title": "Pointer or No Pointer for Golang Struct to reference other struct and Why", "body": "<ol>\n<li><p>Performance wise, it's better to use pointers as everything with golang is pass by value. So instead of golang having to look up the values of the User struct to then pass to the Discussion struct, it only passes the pointer to it. This also applies to how attaching methods to struct works. func (u *User)Example{} will execute faster as only the pointer has to be passed in. I think performance is negligible however</p></li>\n<li><p>No Clue, I've only read <a href=\"https://blog.twitch.tv/gos-march-to-low-latency-gc-a6fa96f06eb7\" rel=\"nofollow noreferrer\">one post about garbage collection</a> issues by twitch and they said they where all resolved by golang 1.7. There are very few situations where you are worried about this.</p></li>\n<li><p>If you don't use a pointer to User, updates to the User struct won't reflect inside of the Discussion struct. <a href=\"https://play.golang.org/p/6dmhWjd-8Fe\" rel=\"nofollow noreferrer\">See this example here</a>. Notice even though User's ID has been updated, it's not reflected in Discussion.</p></li>\n<li><p>/shrug</p></li>\n</ol>\n"}], "owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 413, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1533782546, "creation_date": 1533760078, "last_edit_date": 1533769320, "question_id": 51755143, "link": "https://stackoverflow.com/questions/51755143/pointer-or-no-pointer-for-golang-struct-to-reference-other-struct-and-why", "title": "Pointer or No Pointer for Golang Struct to reference other struct and Why", "body": "<p>I have read some of the stack overflow question related to \"<strong>why pointer and why not pointer</strong>\", but I could not understand much.</p>\n\n<p>So, I thought to understand and learn based on my situation on <code>golang</code> perspective.</p>\n\n<p>I have 2 struct</p>\n\n<pre><code>type Discussion struct {\n    ID      string `json:\"id\"`\n    Title   string `json:\"title\"`\n    Content string `json:\"content\"`\n    Owner   *User  `json:\"owner\"`\n}\n\ntype User struct {\n    ID   string `json:\"id\"`\n    Name string `json:\"name\"`\n}\n</code></pre>\n\n<p>In above <code>Discussion</code> struct you can see, I used <code>*User</code> for <code>Owner</code> field.</p>\n\n<p>Considering situation, I do not have to change data for <code>Owner</code> after creating value for <code>Discussion</code> like below, should I use only <code>User</code> or it's better to use <code>*User</code> like below</p>\n\n<pre><code>func main() {\n    u := User {\n        ID: \"2\",\n        Name: \"StackOverflow\",\n    }\n    d := Discussion{\n        ID: \"1\",\n        Title: \"This is my family\",\n        Content: \"I love my family\",\n        Owner: &amp;u,\n    }\n}\n</code></pre>\n\n<p><strong>or, Should I use like below -</strong></p>\n\n<pre><code>type Discussion struct {\n    ID      string `json:\"id\"`\n    Title   string `json:\"title\"`\n    Content string `json:\"content\"`\n    Owner   User   `json:\"owner\"`\n}\n\ntype User struct {\n    ID   string `json:\"id\"`\n    Name string `json:\"name\"`\n}\n\nfunc main() {\n    u := User {\n        ID: \"2\",\n        Name: \"StackOverflow\",\n    }\n    d := Discussion{\n        ID: \"1\",\n        Title: \"This is my family\",\n        Content: \"I love my family\",\n        Owner: u,\n    }\n}\n</code></pre>\n\n<p>I have following question based on above 2 situation</p>\n\n<ol>\n<li>Performance - which one is better &amp; why?</li>\n<li>Garbage Collection - which one is better &amp; why?</li>\n<li>Any Memory effects?</li>\n<li>Any other effects!</li>\n</ol>\n\n<p><strong>Which one should be used on above example and why?</strong></p>\n\n<h1><strong>Please put your answer only based on above example</strong>, which method would you have choosed above and why?</h1>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-storage"], "comments": [{"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 5, "creation_date": 1533760667, "post_id": 51754512, "comment_id": 90470207, "body": "Indeed: <a href=\"https://cloud.google.com/appengine/docs/standard/go/googlecloudstorageclient/read-write-to-cloud-storage\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/standard/go/&hellip;</a>"}, {"owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "edited": false, "score": 0, "creation_date": 1533818322, "post_id": 51754512, "comment_id": 90493111, "body": "Are you talking about App Engine Standard or Flex?"}], "answers": [{"tags": [], "owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "is_accepted": true, "score": 1, "last_activity_date": 1533822422, "creation_date": 1533822422, "answer_id": 51768768, "question_id": 51754512, "link": "https://stackoverflow.com/questions/51754512/using-buckets-in-google-cloud-platform-with-golang/51768768#51768768", "title": "Using Buckets in Google Cloud Platform with Golang", "body": "<p>As shared by Daz on the first comment, there's an intro on how to do this on <a href=\"https://cloud.google.com/appengine/docs/standard/go/googlecloudstorageclient/read-write-to-cloud-storage\" rel=\"nofollow noreferrer\">the docs for Standard</a>. This uses the <a href=\"https://godoc.org/cloud.google.com/go/storage\" rel=\"nofollow noreferrer\"><code>cloud.google.com/go/storage</code></a> library, although you could also use the superseded <a href=\"https://godoc.org/google.golang.org/appengine/blobstore\" rel=\"nofollow noreferrer\"><code>google.golang.org/appengine/blobstore</code></a> (as also explained in the <a href=\"https://cloud.google.com/appengine/docs/standard/go/blobstore/\" rel=\"nofollow noreferrer\">docs</a>).</p>\n\n<p>With those docs, you could simplify them until you get the following code (tested it and works as expected):</p>\n\n<pre><code>package minimal_gcs\n\nimport (\n        s \"cloud.google.com/go/storage\"\n        a \"google.golang.org/appengine\"\n        h \"net/http\"\n)\n\nfunc init() {\n        h.HandleFunc(\"/\", func(w h.ResponseWriter, r *h.Request) {\n                cx := a.NewContext(r)\n                c, _ := s.NewClient(cx)\n                wr := c.Bucket(\"&lt;bucket_id&gt;\").Object(\"&lt;object_id&gt;\").NewWriter(cx)\n                _, _ = wr.Write([]byte(\"Hello World!!1\"))\n                _ = wr.Close()\n        })\n}\n</code></pre>\n\n<p>Note that this is really bad code (no error handling, ...), but I think it's useful to show the basic steps to handle GCS files within GAE standard using Go.</p>\n"}], "owner": {"reputation": 71, "user_id": 9553592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2B8R1.jpg?s=128&g=1", "display_name": "leviathan34", "link": "https://stackoverflow.com/users/9553592/leviathan34"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 893, "favorite_count": 0, "accepted_answer_id": 51768768, "answer_count": 1, "score": 2, "last_activity_date": 1544062142, "creation_date": 1533757465, "last_edit_date": 1544062142, "question_id": 51754512, "link": "https://stackoverflow.com/questions/51754512/using-buckets-in-google-cloud-platform-with-golang", "title": "Using Buckets in Google Cloud Platform with Golang", "body": "<p>I'm trying to host a Go app on the Google Cloud Platform and I need it to do some file writing. GCP doesn't let you do file writing directly in the App Engine, but requires you to use a Bucket.</p>\n\n<p>From their documentation, you can access the buckets in PHP like so </p>\n\n<pre><code>$default_bucket = CloudStorageTools::getDefaultGoogleStorageBucketName();\n$fp = fopen(\"gs://${default_bucket}/hello_default_stream.txt\", 'w');\nfwrite($fp, $newFileContent);\nfclose($fp);\n</code></pre>\n\n<p>Is there a Golang equivalent for this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "edited": false, "score": 0, "creation_date": 1533756080, "post_id": 51754125, "comment_id": 90468024, "body": "Even setting <code>MaxAge</code> to <code>3600</code> in <code>SetSingleSignOn</code> doesn&#39;t change anything!"}], "answers": [{"tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": true, "score": 3, "last_activity_date": 1533757537, "last_edit_date": 1533757537, "creation_date": 1533757233, "answer_id": 51754449, "question_id": 51754125, "link": "https://stackoverflow.com/questions/51754125/golang-cookie-not-deleting/51754449#51754449", "title": "Golang cookie not deleting", "body": "<p>In your <code>DestorySingleSignOn</code> function, you begin with this block:</p>\n\n<pre><code>cookie, err := r.Cookie(ssoCookie)\nif err != nil || cookie.Value == \"\" {\n    return\n}\n</code></pre>\n\n<p>Notice, you are checking for the cookie on the <em>request</em>, but the cookie has only been set on the <em>response</em>. You would need to issue a request to get the initial cookie set, and then issue a second request with that cookie for this to work.</p>\n\n<pre><code>t.Run(\"SignedOnFirst\", func(t *testing.T) {\n\n    req := httptest.NewRequest(\"POST\",\n        \"localhost:42100\",\n        nil)\n    w := httptest.NewRecorder()\n\n    SetSingleSignOn(w, \"12446rewa12314\")\n\n    // get the initial cookie\n    res := w.Result()\n    cookie := res.Cookies()[0]\n\n    // issue a second request with the cookie\n    req = httptest.NewRequest(\"POST\",\n        \"localhost:42100\",\n        nil)\n    req.AddCookie(cookie)\n    w = httptest.NewRecorder()\n\n    // assert.NotPanics(t, func() { DestroySingleSignOn(req, w) })\n    DestroySingleSignOn(req, w)\n\n    // get the new cookie\n    res = w.Result()\n    fmt.Println(res.Cookies())\n\n    assert.Equal(t, 1, len(res.Cookies()))\n    cookie = *res.Cookies()[0]\n    // cookie should be named ssoCookie\n    assert.Equal(t,\n        ssoCookie,\n        cookie.Name)\n\n    // cookie should have already expired\n    assert.True(t,\n        time.Now().After(cookie.Expires))\n\n})\n</code></pre>\n"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 540, "favorite_count": 0, "accepted_answer_id": 51754449, "answer_count": 1, "score": 1, "last_activity_date": 1533757537, "creation_date": 1533755848, "question_id": 51754125, "link": "https://stackoverflow.com/questions/51754125/golang-cookie-not-deleting", "title": "Golang cookie not deleting", "body": "<p>In trying to test the following code: </p>\n\n<pre><code>//SetSingleSignOn Sets the cookie to allow for single sign cross applications.\nfunc SetSingleSignOn(w http.ResponseWriter, token string) {\n    http.SetCookie(w, &amp;http.Cookie{\n        Name:     ssoCookie,\n        Value:    token,\n        Path:     \"/\",\n        HttpOnly: false,\n        Secure:   false,\n        Domain:   \"localhost\",\n        Expires:  time.Now().AddDate(0, 0, 7),\n        MaxAge:   0,\n    })\n}\n\n//DestroySingleSignOn Gets rid of single sign on, in case a user logs out of the application.\nfunc DestroySingleSignOn(r *http.Request, w http.ResponseWriter) {\n    cookie, err := r.Cookie(ssoCookie)\n    if err != nil || cookie.Value == \"\" {\n        return\n    }\n\n    cookie = &amp;http.Cookie{\n        Name:     ssoCookie,\n        Path:     \"/\",\n        HttpOnly: false,\n        Secure:   false,\n        Domain:   \"localhost\",\n        Expires:  time.Now(),\n        MaxAge:   -1}\n\n    http.SetCookie(w, cookie)\n}\n</code></pre>\n\n<p>I come across an apparent false fail. </p>\n\n<p>All my tests against <code>SetSingleSignOn</code> pass, but the sanity test against <code>DestroySingleSignOn</code> fails.  </p>\n\n<p><strong>The test</strong></p>\n\n<p>looks something like this: </p>\n\n<pre><code>t.Run(\"SignedOnFirst\", func(t *testing.T) {\n\n    req := httptest.NewRequest(\"POST\",\n        \"localhost:42100\",\n        nil)\n    w := httptest.NewRecorder()\n\n    SetSingleSignOn(w, \"12446rewa12314\")\n\n    // assert.NotPanics(t, func() { DestroySingleSignOn(req, w) })\n    DestroySingleSignOn(req, w)\n\n    // get the cookie\n    res := w.Result()\n    fmt.Println(res.Cookies())\n\n    assert.Equal(t, 1, len(res.Cookies()))\n    cookie := *res.Cookies()[0]\n    // cookie should be named ssoCookie\n    assert.Equal(t,\n        ssoCookie,\n        cookie.Name)\n\n    // cookie should have already expired\n    assert.True(t,\n        time.Now().After(cookie.Expires))\n\n})\n</code></pre>\n\n<p>It's as if the <code>http.SetCookie(w, cookie)</code> was never invoked at all! Even more bizarre, is when I scrap the function call for straight up</p>\n\n<pre><code>http.SetCookie(w, &amp;http.Cookie{\n    Name:     ssoCookie,\n    Path:     \"/\",\n    HttpOnly: false,\n    Secure:   false,\n    Domain:   \"localhost\",\n    Expires:  time.Now(),\n    MaxAge:   -1}\n</code></pre>\n\n<p>it seems to work (the last cookie is inactive), but now there's <strong>two</strong> cookies in <code>res.Cookies()</code>!</p>\n\n<p>What could be causing this?</p>\n"}, {"tags": ["go", "grpc", "grpc-go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1533753491, "post_id": 51753461, "comment_id": 90466921, "body": "<a href=\"https://godoc.org/google.golang.org/grpc/peer#FromContext\" rel=\"nofollow noreferrer\">godoc.org/google.golang.org/grpc/peer#FromContext</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533753886, "post_id": 51753461, "comment_id": 90467116, "body": "The user agent is part of the <a href=\"https://godoc.org/google.golang.org/grpc/metadata#FromIncomingContext\" rel=\"nofollow noreferrer\">metadata</a> if I recall correctly."}, {"owner": {"reputation": 83, "user_id": 10173417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69c5625397dd32ee103094bd823601df?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/10173417/felix"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1534205821, "post_id": 51753461, "comment_id": 90618294, "body": "Thank you Peter. That&#39;s correct. I&#39;m testing it."}], "answers": [{"tags": [], "owner": {"reputation": 321, "user_id": 3895159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe6c1128f6a2e22592a5620fe642fd?s=128&d=identicon&r=PG", "display_name": "mbdrian", "link": "https://stackoverflow.com/users/3895159/mbdrian"}, "is_accepted": false, "score": 12, "last_activity_date": 1570784759, "creation_date": 1570784759, "answer_id": 58337813, "question_id": 51753461, "link": "https://stackoverflow.com/questions/51753461/how-can-i-get-the-client-ip-address-and-user-agent-in-golang-grpc/58337813#58337813", "title": "How can I get the client IP address and user-agent in Golang gRPC?", "body": "<p>In Golang GRPC, you can use</p>\n\n<pre><code>func (UserServicesServer) Login(ctx context.Context, request *sso.LoginRequest) (*sso.LoginResponse, error) {\np, _ := peer.FromContext(ctx)\nrequest.Frontendip = p.Addr.String()\n.\n.\n}\n</code></pre>\n\n<p>But, do not forget import <code>\"google.golang.org/grpc/peer\"</code></p>\n"}, {"tags": [], "owner": {"reputation": 301, "user_id": 1636320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69f33f92d2d79e17cbe82dc485437ab9?s=128&d=identicon&r=PG", "display_name": "morteza khadem", "link": "https://stackoverflow.com/users/1636320/morteza-khadem"}, "is_accepted": false, "score": 0, "last_activity_date": 1612428790, "creation_date": 1612428790, "answer_id": 66042228, "question_id": 51753461, "link": "https://stackoverflow.com/questions/51753461/how-can-i-get-the-client-ip-address-and-user-agent-in-golang-grpc/66042228#66042228", "title": "How can I get the client IP address and user-agent in Golang gRPC?", "body": "<p>In Golang GRPC, context has 3 values</p>\n<ol>\n<li><p>authority</p>\n</li>\n<li><p>content-type</p>\n</li>\n<li><p>user-agent</p>\n<pre><code>md,ok:=metadata.FromIncomingContext(ctx)\nfmt.Printf(&quot;%+v%+v&quot;,md,ok)\n</code></pre>\n</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 33451, "user_id": 3011380, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/oN76M.jpg?s=128&g=1", "display_name": "zangw", "link": "https://stackoverflow.com/users/3011380/zangw"}, "is_accepted": false, "score": 0, "last_activity_date": 1612441218, "creation_date": 1612441218, "answer_id": 66045508, "question_id": 51753461, "link": "https://stackoverflow.com/questions/51753461/how-can-i-get-the-client-ip-address-and-user-agent-in-golang-grpc/66045508#66045508", "title": "How can I get the client IP address and user-agent in Golang gRPC?", "body": "<p>For <a href=\"https://github.com/grpc-ecosystem/grpc-gateway\" rel=\"nofollow noreferrer\">grpc-gateway</a> is used, the clientIp may be retrieved through <code>x-forwarded-for</code></p>\n<pre><code>if headers, ok := metadata.FromIncomingContext(ctx); ok {\n    xForwardFor := headers.Get(&quot;x-forwarded-for&quot;)\n    if len(xForwardFor) &gt; 0 &amp;&amp; xForwardFor[0] != &quot;&quot; {\n        ips := strings.Split(xForwardFor[0], &quot;,&quot;)\n        if len(ips) &gt; 0 {\n            clientIp = ips[0]\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 10173417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69c5625397dd32ee103094bd823601df?s=128&d=identicon&r=PG&f=1", "display_name": "Felix", "link": "https://stackoverflow.com/users/10173417/felix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4875, "favorite_count": 0, "answer_count": 3, "score": 5, "last_activity_date": 1612441218, "creation_date": 1533753082, "last_edit_date": 1556004456, "question_id": 51753461, "link": "https://stackoverflow.com/questions/51753461/how-can-i-get-the-client-ip-address-and-user-agent-in-golang-grpc", "title": "How can I get the client IP address and user-agent in Golang gRPC?", "body": "<p>I set up a series of gRPC requests and responses which all work fine, but I'm stuck when I try to get the client IP address and user-agent who is calling my gRPC APIs.</p>\n\n<p>I read the Go gRPC documentation and other sources, but didn't find much valuable information. Few of them are talking about gRPC in Golang.</p>\n\n<p>Should I set up a key-value to store the IP address in the context when setting up the gRPC APIs?</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533753625, "post_id": 51753366, "comment_id": 90466987, "body": "I don&#39;t understand what this would measure. Do you have tests that cover your tests? And then tests for those tests? Is it turtles all the way down? Test coverage measures the code executed <i>by</i> the tests, not the code <i>in</i> the tests."}, {"owner": {"reputation": 2100, "user_id": 367543, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c0e20a575a8aa323cf62c319ffd8fba0?s=128&d=identicon&r=PG", "display_name": "andyortlieb", "link": "https://stackoverflow.com/users/367543/andyortlieb"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533822573, "post_id": 51753366, "comment_id": 90496246, "body": "Like I said before, I can see my statements hit in coverage reports from python test sources by including them in the coverage report, and I like that. It&#39;s assuring and comforting IMO.  It also shows me if I have dead wasteful tests. Code coverage is not the same thing as unit testing."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533822984, "post_id": 51753366, "comment_id": 90496525, "body": "They&#39;re not the same thing, one is a measure of the other. Code coverage is a measure of how much real code is exercised by your tests, not a measure of how much test code is executed."}, {"owner": {"reputation": 2100, "user_id": 367543, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c0e20a575a8aa323cf62c319ffd8fba0?s=128&d=identicon&r=PG", "display_name": "andyortlieb", "link": "https://stackoverflow.com/users/367543/andyortlieb"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533830454, "post_id": 51753366, "comment_id": 90501678, "body": "Another things I failed to clarify is that I&#39;m talking about visual code coverage, specifically the HTML report. I don&#39;t really care so much about percentage of code covered as much as certain pieces that I expect watch light up while writing tests. While there shouldn&#39;t be such messy code that I have conditionals in my tests it can happen at times. I like to see that my statements are being hit. Again, I do this in my python  py.test HTML coverage reports and I find it very useful, to show that my tests aren&#39;t unreachable, etc."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533830823, "post_id": 51753366, "comment_id": 90501883, "body": "End result is the same: that is not supported natively by the Go toolchain, and recommending third-party tools is off-topic for Stack Overflow."}], "answers": [{"comments": [{"owner": {"reputation": 2100, "user_id": 367543, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c0e20a575a8aa323cf62c319ffd8fba0?s=128&d=identicon&r=PG", "display_name": "andyortlieb", "link": "https://stackoverflow.com/users/367543/andyortlieb"}, "edited": false, "score": 0, "creation_date": 1533830537, "post_id": 51754134, "comment_id": 90501722, "body": "This would be a great answer if i was asking about how to write tests. What I&#39;m asking for is whether a specific feature parity exists for go&#39;s coverage profile as does with py.tests&#39;s for example."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 2100, "user_id": 367543, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c0e20a575a8aa323cf62c319ffd8fba0?s=128&d=identicon&r=PG", "display_name": "andyortlieb", "link": "https://stackoverflow.com/users/367543/andyortlieb"}, "edited": false, "score": 1, "creation_date": 1533830740, "post_id": 51754134, "comment_id": 90501836, "body": "There is no way that I know of to test your tests, no."}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": false, "score": 2, "last_activity_date": 1533755871, "creation_date": 1533755871, "answer_id": 51754134, "question_id": 51753366, "link": "https://stackoverflow.com/questions/51753366/how-to-include-test-go-files-in-html-coverage-reports/51754134#51754134", "title": "How to include *_test.go files in HTML coverage reports", "body": "<p>I'm not sure I understand the reasoning behind this.</p>\n\n<p>Unit tests, especially in Go, should be simple and straight-forward enough that by just reading them you should be able to spot if a statement is useless.</p>\n\n<p>If that is not the case, maybe you are implementing your unit tests in a way that is too complicated?</p>\n\n<p>If that is the case, I can recommend checking <a href=\"https://github.com/golang/go/wiki/TableDrivenTests\" rel=\"nofollow noreferrer\">table-driven tests</a> for most cases (not suited for most concurrency-heavy code or methods that depend a lot on manipulating the state, though) as well as trying out TDD (test-driven development).</p>\n\n<p>By using TDD, instead of building your tests in order to try to cover all of your code, you would be writing simple tests that simply validate the specs of your code.</p>\n"}, {"tags": [], "owner": {"reputation": 153, "user_id": 4974261, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ewCosYzy7EI/AAAAAAAAAAI/AAAAAAAAAfQ/rvklfLv5qCU/photo.jpg?sz=128", "display_name": "Eli Davis", "link": "https://stackoverflow.com/users/4974261/eli-davis"}, "is_accepted": false, "score": 0, "last_activity_date": 1533783336, "creation_date": 1533783336, "answer_id": 51758169, "question_id": 51753366, "link": "https://stackoverflow.com/questions/51753366/how-to-include-test-go-files-in-html-coverage-reports/51758169#51758169", "title": "How to include *_test.go files in HTML coverage reports", "body": "<p>You don't write tests for your tests. Where does it end at that point if you do? Those tests for tests aren't covered. You'll need to write tests for your tests for your tests. But wait! Those tests for your tests for your tests don't have coverage so you better write tests for your tests for your tests for your tests.</p>\n"}], "owner": {"reputation": 2100, "user_id": 367543, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c0e20a575a8aa323cf62c319ffd8fba0?s=128&d=identicon&r=PG", "display_name": "andyortlieb", "link": "https://stackoverflow.com/users/367543/andyortlieb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1561347823, "creation_date": 1533752736, "last_edit_date": 1561347823, "question_id": 51753366, "link": "https://stackoverflow.com/questions/51753366/how-to-include-test-go-files-in-html-coverage-reports", "title": "How to include *_test.go files in HTML coverage reports", "body": "<p>I would like to know if there is a way that I can generate an HTML coverage report that also includes statements covered on the tests themselves.</p>\n\n<p>Regarding the merits of doing such a thing, I would like to see that my tests are as useful as the rest of my code. I've become accustomed to including my test code coverage in python and this is something I find helpful.</p>\n\n<p><strong>Update for clarification:</strong></p>\n\n<p>People seem to think I'm talking about testing my tests. I'm not. I just want to see that the statements in my tests are definitely being hit in the HTML coverage report. For example, code coverage on a function in my application might show me that everything's been hit, but it won't necessarily show me that every boundary has been tested. Seeing statements lit up in my test sources show me that I wrote my test well enough. Yes, better factored code shouldn't be so complex as to need that assurance, but sometimes things just aren't better.</p>\n"}, {"tags": ["go", "sentry"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1533752278, "post_id": 51752779, "comment_id": 90466276, "body": "<a href=\"https://godoc.org/github.com/getsentry/raven-go#pkg-constants\" rel=\"nofollow noreferrer\">Severity</a> is a field of <a href=\"https://godoc.org/github.com/getsentry/raven-go#Packet\" rel=\"nofollow noreferrer\">Packet</a>. To set the severity you have to construct the packet manually and call <a href=\"https://godoc.org/github.com/getsentry/raven-go#Client.Capture\" rel=\"nofollow noreferrer\">Capture</a>."}, {"owner": {"reputation": 336, "user_id": 7143346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a01e970a819864e38e4b33fd915a81d?s=128&d=identicon&r=PG&f=1", "display_name": "xyz", "link": "https://stackoverflow.com/users/7143346/xyz"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533753080, "post_id": 51752779, "comment_id": 90466707, "body": "Thanks @Peter, I was hoping there was a more straightforward solution since specifying error level is quite essential for logging."}], "answers": [{"tags": [], "owner": {"reputation": 336, "user_id": 7143346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a01e970a819864e38e4b33fd915a81d?s=128&d=identicon&r=PG&f=1", "display_name": "xyz", "link": "https://stackoverflow.com/users/7143346/xyz"}, "is_accepted": false, "score": 0, "last_activity_date": 1547494922, "last_edit_date": 1547494922, "creation_date": 1547484402, "answer_id": 54185763, "question_id": 51752779, "link": "https://stackoverflow.com/questions/51752779/sentry-go-integration-how-to-specify-error-level/54185763#54185763", "title": "Sentry Go Integration, how to specify error level?", "body": "<p>I followed the advice in the comments, and came up with this:</p>\n\n<pre><code>// sentryErrorCapture sends error data to Sentry asynchronously. Use for non-Fatal errors.\nvar sentryErrorCapture = func(err error, severity raven.Severity, tags map[string]string, interfaces ...raven.Interface) string {\n    packet := newSentryPackage(err, severity, tags, interfaces...)\n    eventID, _ := raven.Capture(packet, tags)\n    return eventID\n}\n\n\nfunc newSentryPackage(err error, severity raven.Severity, tags map[string]string, interfaces ...raven.Interface) (packet *raven.Packet) {\n    interfaces = append(interfaces,\n        raven.NewException(err, raven.GetOrNewStacktrace(err, 1, 3, raven.IncludePaths())))\n\n    packet = &amp;raven.Packet{\n        Message:    err.Error(),\n        Level:      severity,\n        Interfaces: interfaces,\n        Extra:      getSentryExtraInfo(),\n    }\n    return\n}\n</code></pre>\n\n<p>When I want to log an error specifying the level I call: <strong>sentryErrorCapture(err, raven.ERROR, nil)</strong>.</p>\n"}, {"tags": [], "owner": {"reputation": 1081, "user_id": 963287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fTJWz.jpg?s=128&g=1", "display_name": "Rodolfo Carvalho", "link": "https://stackoverflow.com/users/963287/rodolfo-carvalho"}, "is_accepted": false, "score": 0, "last_activity_date": 1579877745, "creation_date": 1579877745, "answer_id": 59898862, "question_id": 51752779, "link": "https://stackoverflow.com/questions/51752779/sentry-go-integration-how-to-specify-error-level/59898862#59898862", "title": "Sentry Go Integration, how to specify error level?", "body": "<p>Using the <code>sentry-go</code> SDK, the Level is set on the Scope.</p>\n\n<p>Documentation:</p>\n\n<ul>\n<li><a href=\"https://pkg.go.dev/github.com/getsentry/sentry-go?tab=doc#Scope.SetLevel\" rel=\"nofollow noreferrer\">https://pkg.go.dev/github.com/getsentry/sentry-go?tab=doc#Scope.SetLevel</a></li>\n<li><a href=\"https://pkg.go.dev/github.com/getsentry/sentry-go?tab=doc#Level\" rel=\"nofollow noreferrer\">https://pkg.go.dev/github.com/getsentry/sentry-go?tab=doc#Level</a></li>\n</ul>\n\n<p>Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    sentry.WithScope(func(scope *sentry.Scope) {\n        scope.SetLevel(sentry.LevelFatal)\n        sentry.CaptureException(errors.New(\"example error\"))\n    })\n</code></pre>\n"}], "owner": {"reputation": 336, "user_id": 7143346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a01e970a819864e38e4b33fd915a81d?s=128&d=identicon&r=PG&f=1", "display_name": "xyz", "link": "https://stackoverflow.com/users/7143346/xyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1471, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1579877745, "creation_date": 1533750564, "question_id": 51752779, "link": "https://stackoverflow.com/questions/51752779/sentry-go-integration-how-to-specify-error-level", "title": "Sentry Go Integration, how to specify error level?", "body": "<p>According to the official docs <a href=\"https://docs.sentry.io/clients/go/\" rel=\"nofollow noreferrer\">https://docs.sentry.io/clients/go/</a> you can log errors in Sentry from a golang project with:</p>\n\n<pre><code>// For Errors\nraven.CapturePanic(func() {\n    // do all of the scary things here\n}, nil)\n\n// For panic\nif err != nil {\n   raven.CaptureErrorAndWait(err, nil)\n   log.Panic(err)\n}\n</code></pre>\n\n<p>This works like a charm, the problem is in Sentry both functions are logged with level 'Error'. Anyone knows how can the logging level be specified for each call? In Python is very explicit, but I don't see it for Go.</p>\n"}, {"tags": ["git", "go", "github", "go-git"], "answers": [{"tags": [], "owner": {"reputation": 156, "user_id": 2330648, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ZugEZ.jpg?s=128&g=1", "display_name": "Ryan Smith", "link": "https://stackoverflow.com/users/2330648/ryan-smith"}, "is_accepted": false, "score": -1, "last_activity_date": 1533773004, "creation_date": 1533773004, "answer_id": 51757186, "question_id": 51751828, "link": "https://stackoverflow.com/questions/51751828/clone-a-repository-from-github-enterprise-with-go-git/51757186#51757186", "title": "Clone a repository from GitHub Enterprise with go-git", "body": "<p>They have the ability to use a token:</p>\n\n<p><a href=\"https://github.com/src-d/go-git/blob/master/plumbing/transport/http/common.go#L204-L227\" rel=\"nofollow noreferrer\">https://github.com/src-d/go-git/blob/master/plumbing/transport/http/common.go#L204-L227</a></p>\n\n<pre><code>import (\n  git \"gopkg.in/src-d/go-git.v4\"\n  \"gopkg.in/src-d/go-git.v4/plumbing/transport/http\"\n)\n\nfunc main() {\n  ...\n  auth := http.TokenAuth{Token: \"TOKEN_HERE\"}\n  opts := git.CloneOptions{\n    URL:  \"https://github.com/user/repo\",\n    Auth: &amp;auth,\n  }\n  git.PlainClone(\"/tmp/cloneDir\", false, &amp;opts)\n  ..\n}\n</code></pre>\n\n<p>Not 100% sure if this will solve all your issues</p>\n"}, {"tags": [], "owner": {"reputation": 9575, "user_id": 459812, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jraVq.jpg?s=128&g=1", "display_name": "Bj&#246;rn Marschollek", "link": "https://stackoverflow.com/users/459812/bj%c3%b6rn-marschollek"}, "is_accepted": true, "score": 2, "last_activity_date": 1536313614, "creation_date": 1536313614, "answer_id": 52219873, "question_id": 51751828, "link": "https://stackoverflow.com/questions/51751828/clone-a-repository-from-github-enterprise-with-go-git/52219873#52219873", "title": "Clone a repository from GitHub Enterprise with go-git", "body": "<p>Turns out that Github uses the token as a password for your user, so it requires a basic authentication rather than a token in the header:</p>\n\n<pre><code>options := &amp;git.CloneOptions{\n    Auth:          &amp;http.BasicAuth{Username: \"myusername\", Token: \"mytoken\"},\n    URL:           repoURL,\n    Depth:         500,\n    ReferenceName: plumbing.ReferenceName(\"refs/heads/master\"),\n    SingleBranch:  true,\n    Tags:          git.NoTags,\n}\n</code></pre>\n"}], "owner": {"reputation": 9575, "user_id": 459812, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jraVq.jpg?s=128&g=1", "display_name": "Bj&#246;rn Marschollek", "link": "https://stackoverflow.com/users/459812/bj%c3%b6rn-marschollek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1900, "favorite_count": 0, "accepted_answer_id": 52219873, "answer_count": 2, "score": 5, "last_activity_date": 1536313614, "creation_date": 1533747028, "question_id": 51751828, "link": "https://stackoverflow.com/questions/51751828/clone-a-repository-from-github-enterprise-with-go-git", "title": "Clone a repository from GitHub Enterprise with go-git", "body": "<p>I'm trying to use <code>go-git</code> to clone a repository from GitHub Enterprise. To do that, I'm using the HTTPS protocol with an access token with appropriate permissions for my repos (verified on the command line). <code>go-git</code> fails when making the <code>git-upload-pack</code> RPC call because the server responds with a 400:</p>\n\n<pre><code>$ go run main.go\nunexpected client error: unexpected requesting \"https://github.mycompany.net/my-org/myrepo.git/info/refs?service=git-upload-pack\" status code: 400\n</code></pre>\n\n<p>The request it makes is equivalent to this:</p>\n\n<pre><code>GET /my-org/myrepo.git/info/refs?service=git-upload-pack HTTP/1.1\nHost: github.mycompany.net\nUser-Agent: git/1.0\nAccept: */*\nAuthorization: Bearer atokenthatisdefinitelyvalid\n</code></pre>\n\n<p>Without the token in the request header, I get the expected 401 (<code>Anonymous access denied</code>) response from the repository. With the token, it responds with a 400. </p>\n\n<p>I have found the same to be true for public repositories on non-Enterprise GitHub; with the difference that it (expectedly) works without an <code>Authorization</code> header since none is necessary. If I include a valid token, GitHub just like its Enterprise version responds with a 400.</p>\n\n<p>Below is a minimal example. Is there a way to use <code>go-git</code> with GitHub Enterprise that requires authentication? Ideally using an auth token?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n\n    git \"gopkg.in/src-d/go-git.v4\"\n    \"gopkg.in/src-d/go-git.v4/plumbing\"\n    \"gopkg.in/src-d/go-git.v4/plumbing/transport/http\"\n)\n\nconst (\n    repoURL           = \"https://github.mycompany.net/my-org/myrepo.git\"\n    githubAccessToken = \"atokenthatisdefinitelyvalid\"\n)\n\nfunc main() {\n    dir, _ := ioutil.TempDir(\"\", \"temp_dir\")\n\n    options := &amp;git.CloneOptions{\n        Auth:          &amp;http.TokenAuth{Token: githubAccessToken},\n        URL:           repoURL,\n        Depth:         500,\n        ReferenceName: plumbing.ReferenceName(\"refs/heads/master\"),\n        SingleBranch:  true,\n        Tags:          git.NoTags,\n    }\n\n    _, err := git.PlainClone(dir, false, options)\n    fmt.Println(err)\n}\n</code></pre>\n"}, {"tags": ["go", "glide-golang", "govendor"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1533745508, "post_id": 51751066, "comment_id": 90462662, "body": "You said your project is located at <code>&#47;Users&#47;robopuff&#47;Development&#47;GoRethink</code> but per the error message, that&#39;s not in your GOPATH."}, {"owner": {"reputation": 9, "user_id": 4511987, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-aEslncp_syA/AAAAAAAAAAI/AAAAAAAABCs/cWt7aWyKcaw/photo.jpg?sz=128", "display_name": "retest", "link": "https://stackoverflow.com/users/4511987/retest"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533755953, "post_id": 51751066, "comment_id": 90467976, "body": "Even when I change to a <code>GOPATH=&#47;Users&#47;robopuff&#47;Development&#47;GoRethink go run main.go</code> result is the same"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533756160, "post_id": 51751066, "comment_id": 90468056, "body": "That&#39;s still invalid. GOPATH needs to contain a folder <code>src</code> which can contain your projects. A quick search for GOPATH should yield all the info you need."}], "answers": [{"tags": [], "owner": {"reputation": 9, "user_id": 4511987, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-aEslncp_syA/AAAAAAAAAAI/AAAAAAAABCs/cWt7aWyKcaw/photo.jpg?sz=128", "display_name": "retest", "link": "https://stackoverflow.com/users/4511987/retest"}, "is_accepted": true, "score": -1, "last_activity_date": 1533806818, "creation_date": 1533806818, "answer_id": 51763402, "question_id": 51751066, "link": "https://stackoverflow.com/questions/51751066/go-with-glide-vendor-doesnt-work/51763402#51763402", "title": "Go with Glide - vendor doesnt work", "body": "<p>The proper answer for that one is to read through <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">Docs</a>, especially <a href=\"https://golang.org/doc/code.html#Workspaces\" rel=\"nofollow noreferrer\">Workspaces</a> and understand it.</p>\n"}], "owner": {"reputation": 9, "user_id": 4511987, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-aEslncp_syA/AAAAAAAAAAI/AAAAAAAABCs/cWt7aWyKcaw/photo.jpg?sz=128", "display_name": "retest", "link": "https://stackoverflow.com/users/4511987/retest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "accepted_answer_id": 51763402, "answer_count": 1, "score": 0, "last_activity_date": 1533806818, "creation_date": 1533744021, "question_id": 51751066, "link": "https://stackoverflow.com/questions/51751066/go-with-glide-vendor-doesnt-work", "title": "Go with Glide - vendor doesnt work", "body": "<p>I am using <code>go version go1.10.3 darwin/amd64</code> with <code>glide version v0.13.1</code>\nProject is located at <code>/Users/robopuff/Development/GoRethink</code> and it's tree looks like this:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 glide.lock\n\u251c\u2500\u2500 glide.yaml\n\u251c\u2500\u2500 main.go\n\u251c\u2500\u2500 rethinkdb_data\n\u2502   \u251c\u2500\u2500 001fbc34-bd63-445f-8590-709ac7475294\n\u2502   \u251c\u2500\u2500 log_file\n\u2502   \u251c\u2500\u2500 metadata\n\u2502   \u2514\u2500\u2500 tmp\n\u2514\u2500\u2500 vendor\n    \u251c\u2500\u2500 github.com\n    \u2502   \u251c\u2500\u2500 cenkalti\n    \u2502   \u2502   \u2514\u2500\u2500 backoff\n    \u2502   \u251c\u2500\u2500 golang\n    \u2502   \u2502   \u2514\u2500\u2500 protobuf\n    \u2502   \u251c\u2500\u2500 hailocab\n    \u2502   \u2502   \u2514\u2500\u2500 go-hostpool\n    \u2502   \u251c\u2500\u2500 opentracing\n    \u2502   \u2502   \u2514\u2500\u2500 opentracing-go\n    \u2502   \u2514\u2500\u2500 sirupsen\n    \u2502       \u2514\u2500\u2500 logrus\n    \u251c\u2500\u2500 golang.org\n    \u2502   \u2514\u2500\u2500 x\n    \u2502       \u251c\u2500\u2500 crypto\n    \u2502       \u251c\u2500\u2500 net\n    \u2502       \u2514\u2500\u2500 sys\n    \u2514\u2500\u2500 gopkg.in\n        \u251c\u2500\u2500 fatih\n        \u2502   \u2514\u2500\u2500 pool.v2\n        \u2514\u2500\u2500 gorethink\n            \u2514\u2500\u2500 gorethink.v4\n</code></pre>\n\n<p>After running <code>go run main.go</code> I am welcomed with an error </p>\n\n<pre><code>\u276f go run main.go\nmain.go:7:2: cannot find package \"gopkg.in/gorethink/gorethink.v4\" in any of:\n    /usr/local/go/src/gopkg.in/gorethink/gorethink.v4 (from $GOROOT)\n    /Users/robopuff/go/src/gopkg.in/gorethink/gorethink.v4 (from $GOPATH)\n</code></pre>\n\n<p>Shouldn't go compiler first of all look at <em>vendor</em>? </p>\n"}, {"tags": ["go", "kubernetes", "google-cloud-platform", "google-cloud-sql"], "comments": [{"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 1, "creation_date": 1533751219, "post_id": 51750622, "comment_id": 90465707, "body": "You&#39;re running the proxy as a sidecar but your Golang client is trying to connect to the database instance directly.... Your Golang wants to connect through the proxy that is <code>localhost</code> not <code>DB_INSTANCE</code>"}], "answers": [{"tags": [], "owner": {"reputation": 984, "user_id": 2069749, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/5861e5a979194471e8c3c60c269a70c0?s=128&d=identicon&r=PG", "display_name": "Prashant", "link": "https://stackoverflow.com/users/2069749/prashant"}, "is_accepted": false, "score": 1, "last_activity_date": 1534044613, "creation_date": 1534044613, "answer_id": 51805460, "question_id": 51750622, "link": "https://stackoverflow.com/questions/51750622/cloud-sql-connection-from-kubernetes-in-go-error-403-insufficient-permission/51805460#51805460", "title": "Cloud SQL connection from Kubernetes in Go - Error 403: Insufficient Permission", "body": "<p>I know you've solved your issue already, but wanted to provide another alternative for anyone else reading this thread.</p>\n\n<p>There are 2 ways you can connect to your instance:\n1: Through a TCP connection: You have that solution already and <a href=\"https://cloud.google.com/sql/docs/mysql/connect-kubernetes-engine\" rel=\"nofollow noreferrer\">this page</a> shows you the details. Since the cloud SQL proxy container runs on the same pod as your app container, your host should point to <code>localhost</code>.\n2: Unix socket: </p>\n\n<p>You should also be able to connect through the following code (<a href=\"https://cloud.google.com/sql/docs/mysql/connect-external-app#go\" rel=\"nofollow noreferrer\">details here</a>):</p>\n\n<pre><code>import (\n       \"database/sql\"\n        _ \"github.com/go-sql-driver/mysql\"\n)\n\ndsn := fmt.Sprintf(\"%s:%s@unix(/cloudsql/%s)/%s\",\n       dbUser,\n       dbPassword,\n       INSTANCE_CONNECTION_NAME,\n       dbName)\ndb, err := sql.Open(\"mysql\", dsn)\n</code></pre>\n\n<p>You may have to remove the <code>=tcp:3306</code> portion from your deployment.yaml file through.</p>\n"}], "owner": {"reputation": 791, "user_id": 1441597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/129c9d44240bafaa6ccf94fb89072c75?s=128&d=identicon&r=PG", "display_name": "SebScoFr", "link": "https://stackoverflow.com/users/1441597/sebscofr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 397, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1534044613, "creation_date": 1533742709, "last_edit_date": 1533757824, "question_id": 51750622, "link": "https://stackoverflow.com/questions/51750622/cloud-sql-connection-from-kubernetes-in-go-error-403-insufficient-permission", "title": "Cloud SQL connection from Kubernetes in Go - Error 403: Insufficient Permission", "body": "<p>I need to connect to Google Cloud SQL from a Kubernetes pod using Go.</p>\n\n<p>I have been following the following guides religiously:\n<a href=\"https://cloud.google.com/sql/docs/mysql/connect-kubernetes-engine\" rel=\"nofollow noreferrer\">https://cloud.google.com/sql/docs/mysql/connect-kubernetes-engine</a>\n<a href=\"https://cloud.google.com/sql/docs/mysql/connect-external-app#go\" rel=\"nofollow noreferrer\">https://cloud.google.com/sql/docs/mysql/connect-external-app#go</a></p>\n\n<p>Here is my <strong>Kubernetes deployment yaml</strong> file:</p>\n\n<pre><code>---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: my-service\n  labels:\n    app: my-service\nspec:\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 10%\n      maxSurge: 10%\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: my-service\n    spec:\n      imagePullSecrets:\n      - name: regsecret\n      containers:\n      - name: my-service\n        image: my-image\n        imagePullPolicy: IfNotPresent\n        env:\n          - name: DB_INSTANCE\n            value: \"my-project-id:europe-west1:uk\"\n          - name: DB_USERNAME\n            valueFrom:\n              secretKeyRef:\n                name: cloudsql-db-credentials\n                key: username\n          - name: DB_PASSWORD\n            valueFrom:\n              secretKeyRef:\n                name: cloudsql-db-credentials\n                key: password\n      - name: cloudsql-proxy\n        image: gcr.io/cloudsql-docker/gce-proxy:1.11\n        command: [\"/cloud_sql_proxy\",\n                  \"-instances=my-project-id:europe-west1:uk=tcp:3306\",\n                  \"-credential_file=/secrets/cloudsql/credentials.json\"]\n        volumeMounts:\n          - name: cloudsql-instance-credentials\n            mountPath: /secrets/cloudsql\n            readOnly: true\n      volumes:\n        - name: cloudsql-instance-credentials\n          secret:\n            secretName: cloudsql-instance-credentials\n</code></pre>\n\n<p>And here is my attempt to connect using <strong>Go</strong>:</p>\n\n<pre><code>import (\n    \"github.com/GoogleCloudPlatform/cloudsql-proxy/proxy/dialers/mysql\"\n    \"github.com/spf13/viper\"\n    \"log\"\n)\n\nfunc Connect() {\n    cfg := mysql.Cfg(\n        viper.GetString(\"DB_INSTANCE\"),\n        viper.GetString(\"DB_USERNAME\"),\n        viper.GetString(\"DB_PASSWORD\"))\n    cfg.DBName = \"my-db-name\"\n\n    db, err := mysql.DialCfg(cfg)\n    if err != nil {\n        log.Fatalf(\"Failed to create the Cloud SQL client: %v\", err)\n    }\n}\n</code></pre>\n\n<p>Unfortunately, running this code results in:</p>\n\n<pre><code>2018/08/08 15:19:45 Failed to create the Cloud SQL client: ensure that the Cloud SQL API is enabled for your project (https://console.cloud.google.com/flows/enableapi?apiid=sqladmin). Error during createEphemeral for my-project-id:europe-west1:uk: googleapi: Error 403: Insufficient Permission, insufficientPermissions\n</code></pre>\n\n<p>I can confirm that the database obviously exists in Cloud SQL, the <strong>Cloud SQL API</strong> is indeed enabled, and that the service account that I used to generate the credentials (as described in the links above) does have the <strong>Cloud SQL Client</strong> role attached to it (I have also tried with Cloud SQL Admin and even project Owner with no success).</p>\n\n<p>What am I missing?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Fixed it by updating my Go code to:</p>\n\n<pre><code>dsn := fmt.Sprintf(\"%s:%s@tcp(%s)/%s\",\n    viper.GetString(\"DB_USERNAME\"),\n    viper.GetString(\"DB_PASSWORD\"),\n    \"127.0.0.1:3306\",\n    \"my-db-name\")\ndb, err := sql.Open(\"mysql\", dsn)\nif err != nil {\n    log.Fatalf(\"Failed to create the Cloud SQL client: %v\", err)\n}\n</code></pre>\n\n<p>Thanks @DazWilkin for the tip.</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1533767274, "creation_date": 1533767274, "answer_id": 51756523, "question_id": 51748754, "link": "https://stackoverflow.com/questions/51748754/gorilla-websocket-manual-close-client-connect/51756523#51756523", "title": "Gorilla Websocket manual close client connect", "body": "<p>The peer closed the connection without sending a status.  You can suppress logging of this status by adding <code>websocket.CloseNoStatusReceived</code> to the <code>websocket.IsUnexpectedCloseError</code> arguments.</p>\n\n<pre><code>    if websocket.IsUnexpectedCloseError(err, websocket.CloseGoingAway, websocket.CloseNoStatusReceived) {\n        log.Printf(\"error: %v\", err)\n    }\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 6024428, "user_type": "registered", "profile_image": "https://graph.facebook.com/1560194037627986/picture?type=large", "display_name": "cxm", "link": "https://stackoverflow.com/users/6024428/cxm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 760, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1533767274, "creation_date": 1533737289, "question_id": 51748754, "link": "https://stackoverflow.com/questions/51748754/gorilla-websocket-manual-close-client-connect", "title": "Gorilla Websocket manual close client connect", "body": "<p>I try to close connect manual(use <a href=\"https://dwst.github.io/\" rel=\"nofollow noreferrer\">Dark WebSocket Terminal</a>),but the client tell me 1005 (No Status Rcvd)<br>\nServer:</p>\n\n<pre><code>ReadLoop:\nfor {\n    mt, message, err := c.ReadMessage()\n    if err != nil {\n        log.Println(\"read:\", err)\n        log.Println(\"messageType:\", mt)\n        if websocket.IsUnexpectedCloseError(err, websocket.CloseGoingAway, websocket.CloseAbnormalClosure) {\n            log.Printf(\"error: %v\", err)\n        }\n        c.WriteMessage(websocket.CloseMessage, websocket.FormatCloseMessage(websocket.CloseNormalClosure, \"\"))\n        break ReadLoop\n    }\n    log.Printf(\"recv: %s\", message)\n\n    //do sth in here\n\n    err = c.WriteMessage(mt, message)\n    if err != nil {\n        //WriteMessage wrong\n        log.Println(\"write:\", err)\n        break ReadLoop\n    }\n}\n</code></pre>\n\n<p>It is not work and show the expected outputting the following:</p>\n\n<pre><code>read: websocket: close 1005 (no status)\nmessageType: -1\nerror: websocket: close 1005 (no status)\n</code></pre>\n\n<p>How should i go about this?</p>\n"}, {"tags": ["go", "struct", "interface", "extension-methods"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 6, "creation_date": 1533735926, "post_id": 51748103, "comment_id": 90456358, "body": "You cannot dynamically add methods to an interface. If this were possible, types that previously implemented an interface would break at runtime.  You should instead write a function <code>func Check(err error)</code>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1533736783, "post_id": 51748103, "comment_id": 90456933, "body": "Out of curiosity: what does that <code>Check()</code> method do?"}, {"owner": {"reputation": 2804, "user_id": 2326753, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tzfnK.png?s=128&g=1", "display_name": "C4d", "link": "https://stackoverflow.com/users/2326753/c4d"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1533738650, "post_id": 51748103, "comment_id": 90458291, "body": "@kostix In the first step just compare the <code>error</code>  against <code>nil</code> and exit <code>log.fatal()</code>. Later I would&#39;ve planned how to deal with errors in my case the best. For the beginning I was just looking to sum up all occuring errors."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1533742551, "post_id": 51748103, "comment_id": 90460986, "body": "Summing up: This is a bad idea and luckily it is undoable."}], "answers": [{"comments": [{"owner": {"reputation": 2804, "user_id": 2326753, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tzfnK.png?s=128&g=1", "display_name": "C4d", "link": "https://stackoverflow.com/users/2326753/c4d"}, "edited": false, "score": 1, "creation_date": 1533738785, "post_id": 51748343, "comment_id": 90458384, "body": "Yeah I already got that utility function. I would like to not stay on the topic pointed to &quot;errors&quot; but rather to the possibilities of coding in GO. This one answers my question fully. Thank you! :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1533735952, "creation_date": 1533735952, "answer_id": 51748343, "question_id": 51748103, "link": "https://stackoverflow.com/questions/51748103/can-i-extend-the-error-interface-by-a-method-in-go/51748343#51748343", "title": "Can I extend the error-interface by a method in GO?", "body": "<p>You can't extend <code>error</code>, it's a built-in interface type.</p>\n\n<p>You can extend your own interface types by simply adding new methods. This is \"dangerous\" at first, because implementing interfaces in Go is implicit: there is no declaration of intent. This means if you have a <code>MyError</code> interface, some existing types might already implement it and build on this. If you add a new method to it, existing types will most likely not implement it anymore, which will most likely break existing code (unless you add the implementation of that new method).</p>\n\n<p>Judging from the name of your wanted method (<code>Check()</code>), best would be to create a utility function:</p>\n\n<pre><code>func check(err error) {\n    if err != nil {\n        panic(err) // Do something\n    }\n}\n</code></pre>\n\n<p>This \"pattern\" can be applied with your own interfaces too, it will not disturb existing implementations.</p>\n"}, {"comments": [{"owner": {"reputation": 2804, "user_id": 2326753, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tzfnK.png?s=128&g=1", "display_name": "C4d", "link": "https://stackoverflow.com/users/2326753/c4d"}, "edited": false, "score": 0, "creation_date": 1533738523, "post_id": 51748364, "comment_id": 90458180, "body": "I wouldn&#39;t do so. I would&#39;ve testet the error against being <code>nil</code> inside that <code>Check()</code> method and either just return or <code>log.fatal(..)</code> or similar. I&#39;m for sure not going to repeat this if-statement all over my code."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 2804, "user_id": 2326753, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tzfnK.png?s=128&g=1", "display_name": "C4d", "link": "https://stackoverflow.com/users/2326753/c4d"}, "edited": false, "score": 0, "creation_date": 1533739525, "post_id": 51748364, "comment_id": 90458923, "body": "@C4u you need not to return anything. It will do just to check error."}, {"owner": {"reputation": 2804, "user_id": 2326753, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tzfnK.png?s=128&g=1", "display_name": "C4d", "link": "https://stackoverflow.com/users/2326753/c4d"}, "edited": false, "score": 0, "creation_date": 1533740434, "post_id": 51748364, "comment_id": 90459518, "body": "I haven&#39;t said returning <code>something</code>. I just said <code>returning</code> in the meaning of letting the function run to its end which <i>returns</i> even if there&#39;s no object that gets returned."}, {"owner": {"reputation": 2804, "user_id": 2326753, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tzfnK.png?s=128&g=1", "display_name": "C4d", "link": "https://stackoverflow.com/users/2326753/c4d"}, "edited": false, "score": 0, "creation_date": 1533740551, "post_id": 51748364, "comment_id": 90459591, "body": "Also: This question is not ment to be a code-style discussion. I&#39;m very much into coding. I just needed a answer about the possibility to extend interfaces. Everything else is pretty much clear to me. But thanks for the information."}], "tags": [], "owner": {"reputation": 19, "user_id": 7302254, "user_type": "registered", "profile_image": "https://graph.facebook.com/1189473351120775/picture?type=large", "display_name": "grayMou5e", "link": "https://stackoverflow.com/users/7302254/graymou5e"}, "is_accepted": false, "score": 0, "last_activity_date": 1533736029, "creation_date": 1533736029, "answer_id": 51748364, "question_id": 51748103, "link": "https://stackoverflow.com/questions/51748103/can-i-extend-the-error-interface-by-a-method-in-go/51748364#51748364", "title": "Can I extend the error-interface by a method in GO?", "body": "<p>I would highly suggest to use casual if statement for error checking. </p>\n\n<pre><code>if err != nil {\n    log.Printf(\"Error received - [%v]\",err)\n    return err\n}\n</code></pre>\n\n<p>Because golang doesn't have try catch block familiar to C#. </p>\n\n<p>And if your method Check() will return bool - you will still need to check it against the if statement.</p>\n"}], "owner": {"reputation": 2804, "user_id": 2326753, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tzfnK.png?s=128&g=1", "display_name": "C4d", "link": "https://stackoverflow.com/users/2326753/c4d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 0, "accepted_answer_id": 51748343, "answer_count": 2, "score": 1, "last_activity_date": 1533736029, "creation_date": 1533735313, "question_id": 51748103, "link": "https://stackoverflow.com/questions/51748103/can-i-extend-the-error-interface-by-a-method-in-go", "title": "Can I extend the error-interface by a method in GO?", "body": "<p>I've worked with C# for years so I'm trying to find similarities in GO (I'm quite new to this).</p>\n\n<p><strong>My goal:</strong><br>\nI would like to extend the interface <code>error</code> by a method like <code>Check()</code> so I'm able to call <code>error.Check()</code> just because of a (in my opinion) better readable code.</p>\n\n<p><strong>My current state:</strong><br>\nI've already learned how to extend types by methods with this syntax:</p>\n\n<pre><code>func (foo T) MyExtension() returnType {\n    // return something\n}\n</code></pre>\n\n<p><strong>My problem:</strong><br>\nIt looks like this only applies to types but not interfaces. As I've seen so far <code>error</code> is an <code>interface</code> that's used by many packages to describe a base of their own error-types. I dont want to extend this error-types (from packages) but rather want to extend the interface to cover them all. I couldn't find any syntax for that. As I also don't know the technical term for this (its not <code>extension-method</code>) I'm a bit lost in googling around.</p>\n\n<p><strong>So is there a way to extend the <code>error</code> interface by a general method?</strong></p>\n"}, {"tags": ["go", "architecture"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1533733810, "post_id": 51747212, "comment_id": 90454910, "body": "What in the error message is unclear? You cannot have packages import each other recursively (a -&gt; b -&gt; c -&gt; a)."}, {"owner": {"reputation": 1393, "user_id": 1180020, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/gMiy1.jpg?s=128&g=1", "display_name": "mirt", "link": "https://stackoverflow.com/users/1180020/mirt"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1533733904, "post_id": 51747212, "comment_id": 90454968, "body": "@Volker could you suggest such project structure that handles &quot;Player can use his skills whilst Skill could affect players.&quot;"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1533742219, "post_id": 51747212, "comment_id": 90460758, "body": "If players and skills interact with each other it&#39;s quite obvious that they belong in the same package. If you are hell-bent on moving them to distinct packages, let one type depend on an interface instead of a concrete value from the other package. I would caution against that without good reason though."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1533742467, "post_id": 51747212, "comment_id": 90460930, "body": "Do what Peter suggests. Go is not Java where each class is separate."}, {"owner": {"reputation": 1393, "user_id": 1180020, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/gMiy1.jpg?s=128&g=1", "display_name": "mirt", "link": "https://stackoverflow.com/users/1180020/mirt"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533743837, "post_id": 51747212, "comment_id": 90461762, "body": "@Peter i hell-bent to move all skills in special directory for them but not to make distinct packages. But as far as i know it is impossible make subdirectories for package in golang. So golang forces me to make the another package."}], "answers": [{"tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": 1, "last_activity_date": 1533733944, "creation_date": 1533733944, "answer_id": 51747670, "question_id": 51747212, "link": "https://stackoverflow.com/questions/51747212/golang-directories-organization-for-game-server/51747670#51747670", "title": "Golang directories organization for game server", "body": "<p>your <code>main</code> package <code>imports</code> <code>logic</code> package. It also imports <code>skills</code> which also <code>imports</code> <code>logic</code>. Go is very strict about not allowing import cycles. </p>\n\n<ul>\n<li><p>If you are forced to <code>import</code> <code>logic</code> in <code>main</code>, because you are using some type declared in <code>logic</code> to init a function or handler in <code>skills</code>. You could, probably declare that type in <code>skills</code> rather than in <code>logic</code>. </p></li>\n<li><p>If you are <code>import</code>ing <code>logic</code> because some function from logic is being used in <code>main</code>. You could write a wrapper in <code>skills</code> (with a new function), which calls the function from <code>logic</code>(which is already being called). </p></li>\n</ul>\n\n<p>Either way you have to try and remove the import of <code>logic</code> in <code>main</code>. </p>\n"}], "owner": {"reputation": 1393, "user_id": 1180020, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/gMiy1.jpg?s=128&g=1", "display_name": "mirt", "link": "https://stackoverflow.com/users/1180020/mirt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "closed_date": 1533763770, "answer_count": 1, "score": 0, "last_activity_date": 1533733944, "creation_date": 1533732582, "last_edit_date": 1533733852, "question_id": 51747212, "link": "https://stackoverflow.com/questions/51747212/golang-directories-organization-for-game-server", "closed_reason": "Needs more focus", "title": "Golang directories organization for game server", "body": "<p>I making game server in golang and i have such entities as <code>Player</code> and <code>Skill</code>. <code>Player</code> can use his skills whilst <code>Skill</code> could affect players. <code>Player</code> file and skills files live in <code>logic</code> directory(and in <code>package logic</code>). I want to move skills files into separate directory <code>skills</code>. I could not place it in logic directory and keep logic package for them cause golang not allowed it. Also i could not make <code>package skills</code> and place the directory on same level as logic directory because i got:</p>\n\n<blockquote>\n  <p>import cycle not allowed</p>\n</blockquote>\n\n<pre><code>package main\nimports projname/server/logic\nimports projname/server/skills\nimports projname/server/logic\n</code></pre>\n\n<p>What's wrong with my project architecture and how could i fix it?</p>\n"}, {"tags": ["excel", "go", "math", "statistics"], "answers": [{"tags": [], "owner": {"reputation": 825, "user_id": 3147046, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c27df670ffd297ddef35823cbb190be7?s=128&d=identicon&r=PG", "display_name": "mcrunix", "link": "https://stackoverflow.com/users/3147046/mcrunix"}, "is_accepted": false, "score": 0, "last_activity_date": 1533729474, "creation_date": 1533729474, "answer_id": 51746145, "question_id": 51745855, "link": "https://stackoverflow.com/questions/51745855/calculate-inverse-log-norm-in-go/51746145#51746145", "title": "Calculate inverse log-norm in Go", "body": "<p>Try <code>gonum</code> package, It has various methods for <code>lognormal</code>.</p>\n\n<ul>\n<li><a href=\"https://github.com/gonum/gonum/\" rel=\"nofollow noreferrer\">https://github.com/gonum/gonum/</a></li>\n<li><a href=\"https://github.com/gonum/gonum/blob/master/stat/distuv/lognormal.go\" rel=\"nofollow noreferrer\">https://github.com/gonum/gonum/blob/master/stat/distuv/lognormal.go</a></li>\n<li><a href=\"https://godoc.org/gonum.org/v1/gonum/stat/distuv#LogNormal\" rel=\"nofollow noreferrer\">https://godoc.org/gonum.org/v1/gonum/stat/distuv#LogNormal</a></li>\n</ul>\n"}], "owner": {"reputation": 31, "user_id": 3104123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5de8185b8b659c9a29901d50aa49d9c?s=128&d=identicon&r=PG&f=1", "display_name": "user3104123", "link": "https://stackoverflow.com/users/3104123/user3104123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1533729474, "creation_date": 1533728526, "question_id": 51745855, "link": "https://stackoverflow.com/questions/51745855/calculate-inverse-log-norm-in-go", "title": "Calculate inverse log-norm in Go", "body": "<p>I'm attempting to convert an Excel formula to Go and need to calculate the inverse log-norm i.e. LOGNORM.INV in Excel.</p>\n\n<p>In Python this would be:</p>\n\n<pre><code>def lognorminv(x, mu, sigma):\n    return sp.lognorm(s=sigma, scale=np.exp(mu)).ppf(x)\n</code></pre>\n\n<p>But I can't seem to find an equivalent in Go.</p>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533736450, "post_id": 51745460, "comment_id": 90456713, "body": "Please take the Go tour. It covers all the basics, including this: <a href=\"https://tour.golang.org/moretypes/7\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/7</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1533727777, "post_id": 51745477, "comment_id": 90450785, "body": "Thanks a lot , I will use it. is there a better way to use the if(len) else , I dont like the <code>if else </code> in general and try to avoid as much as possible:)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1533727855, "post_id": 51745477, "comment_id": 90450836, "body": "@RaynD We are branching the code based on a condition, this is exactly what <code>if</code> is for. Note that if you have guarantee that the <code>args</code> slice will never be empty, you can omit this check."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1533727892, "last_edit_date": 1533727892, "creation_date": 1533727413, "answer_id": 51745477, "question_id": 51745460, "link": "https://stackoverflow.com/questions/51745460/send-array-from-index-1-to-function/51745477#51745477", "title": "Send array from index 1 to function", "body": "<p>Yes, simply <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">slice</a> the <code>args</code> slice, and pass that:</p>\n\n<pre><code>myFunc(args[1:])\n</code></pre>\n\n<p><code>args</code> is a <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">slice</a>, not an <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"nofollow noreferrer\">array</a>. You can (re-)slice slices, which will be a contiguous subpart of the original slice. For example:</p>\n\n<pre><code>args[1:4]\n</code></pre>\n\n<p>The above would be another slice, holding only the following elements from <code>args</code>:</p>\n\n<pre><code>args[1], args[2], args[3]\n</code></pre>\n\n<p>The upper limit is exclusive. A missing upper index defaults to the length, a missing lower index defaults to <code>0</code>. These are all detailed in <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">Spec: Slice expressions</a>.</p>\n\n<p>Note that slicing a slice does not copy the elements: it will point to the same underlying array which actually holds the elements. A slice is just a small, struct-like header containing a pointer to the underlying array.</p>\n\n<p>Note that if <code>args</code> is empty, the above would result in a run-time panic. To avoid that, first check its length:</p>\n\n<pre><code>if len(args) == 0 {\n    myFunc(nil) // or an empty slice: []string{}\n} else {\n    myFunc(args[1:])\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 51745477, "answer_count": 1, "score": 0, "last_activity_date": 1533752433, "creation_date": 1533727351, "last_edit_date": 1533752433, "question_id": 51745460, "link": "https://stackoverflow.com/questions/51745460/send-array-from-index-1-to-function", "title": "Send array from index 1 to function", "body": "<p>I've this function and and I got values which I need to use from <code>args</code></p>\n\n<pre><code>Run: func(cmd *cobra.Command, args []string) {\n\n   ....\n\n    myFunc(args)\n} \n</code></pre>\n\n<p>I need to pass to <code>myFunc</code> all the args from <code>index 1</code> and not <code>0</code>.\nof course I can loop and create another array from index 1 but\nthis duplicate almost all the values except index 0 , is there a way to avoid it in GO?</p>\n"}, {"tags": ["go", "select", "input"], "comments": [{"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 2, "creation_date": 1533728378, "post_id": 51745240, "comment_id": 90451173, "body": "Do you have any code that you could show us?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1533730389, "post_id": 51745240, "comment_id": 90452485, "body": "Good luck on doing a select(2) on a not jet established HTTP connection."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533730939, "post_id": 51745240, "comment_id": 90452902, "body": "The goroutine handling an HTTP requests finishes when the handler returns; no special action required. Why do you need to stop the goroutine reading from stdin? Just keep reading."}, {"owner": {"reputation": 942, "user_id": 1320685, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07168c459dcd35c128757f8529306160?s=128&d=identicon&r=PG", "display_name": "Kevin Lyda", "link": "https://stackoverflow.com/users/1320685/kevin-lyda"}, "edited": false, "score": 0, "creation_date": 1533734409, "post_id": 51745240, "comment_id": 90455309, "body": "Volker: Not really a helpful comment. For future reference you do the select(2) on the listen(2) socket. The http request comes in on the socket supplied by accept(2) and normally is a select-based server you would then add that socket to the list of sockets to select on."}, {"owner": {"reputation": 942, "user_id": 1320685, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07168c459dcd35c128757f8529306160?s=128&d=identicon&r=PG", "display_name": "Kevin Lyda", "link": "https://stackoverflow.com/users/1320685/kevin-lyda"}, "edited": false, "score": 0, "creation_date": 1533734555, "post_id": 51745240, "comment_id": 90455410, "body": "mbuechmann: I thought the problem description would get the idea across, but apparently not. So the code to do it follows below. But it&#39;s a good point; code with this probably would have helped."}], "answers": [{"comments": [{"owner": {"reputation": 942, "user_id": 1320685, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07168c459dcd35c128757f8529306160?s=128&d=identicon&r=PG", "display_name": "Kevin Lyda", "link": "https://stackoverflow.com/users/1320685/kevin-lyda"}, "edited": false, "score": 0, "creation_date": 1533734464, "post_id": 51746348, "comment_id": 90455350, "body": "Sorry, not really what I was trying to do."}, {"owner": {"reputation": 942, "user_id": 1320685, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07168c459dcd35c128757f8529306160?s=128&d=identicon&r=PG", "display_name": "Kevin Lyda", "link": "https://stackoverflow.com/users/1320685/kevin-lyda"}, "edited": false, "score": 0, "creation_date": 1533739844, "post_id": 51746348, "comment_id": 90459134, "body": "Ah, and I see the way I phrase the question is what lead to the stop goroutine answers. Sorry, I&#39;ll edit the question to fix that confusion. My bad."}], "tags": [], "owner": {"reputation": 825, "user_id": 3147046, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c27df670ffd297ddef35823cbb190be7?s=128&d=identicon&r=PG", "display_name": "mcrunix", "link": "https://stackoverflow.com/users/3147046/mcrunix"}, "is_accepted": false, "score": 0, "last_activity_date": 1533730107, "creation_date": 1533730107, "answer_id": 51746348, "question_id": 51745240, "link": "https://stackoverflow.com/questions/51745240/how-do-i-select-on-os-stdin-and-http-in-go/51746348#51746348", "title": "How do I select on os.Stdin and http in Go?", "body": "<p>You can stop goroutine with close <code>statement</code>.</p>\n\n<p>Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"sync\"\nfunc main() {\n    var wg sync.WaitGroup\n    wg.Add(1)\n\n    ch := make(chan int)\n    go func() {\n        for {\n            foo, ok := &lt;- ch\n            if !ok {\n                println(\"done\")\n                wg.Done()\n                return\n            }\n            println(foo)\n        }\n    }()\n    ch &lt;- 1\n    ch &lt;- 2\n    ch &lt;- 3\n    close(ch)\n\n    wg.Wait()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 942, "user_id": 1320685, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07168c459dcd35c128757f8529306160?s=128&d=identicon&r=PG", "display_name": "Kevin Lyda", "link": "https://stackoverflow.com/users/1320685/kevin-lyda"}, "is_accepted": true, "score": 1, "last_activity_date": 1533776985, "last_edit_date": 1533776985, "creation_date": 1533734146, "answer_id": 51747732, "question_id": 51745240, "link": "https://stackoverflow.com/questions/51745240/how-do-i-select-on-os-stdin-and-http-in-go/51747732#51747732", "title": "How do I select on os.Stdin and http in Go?", "body": "<p>OK, I figured out a solution for what I was trying to do.</p>\n\n<p>This might not be the most Go idiomatic way though. If the channels took a struct with input source and the string I could probably toss the select and the webinput channel.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"context\"\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"os\"\n    \"time\"\n)\n\nfunc getHTTPAnimal(input chan string) *http.Server {\n    srv := &amp;http.Server{Addr: \":1234\"}\n\n    http.HandleFunc(\"/animal\", func(w http.ResponseWriter, r *http.Request) {\n        animal, ok := r.URL.Query()[\"type\"]\n        if !ok || len(animal[0]) &lt;= 0 {\n            io.WriteString(w, \"Animal not understood.\\n\")\n            return\n        }\n        io.WriteString(w, \"Animal understood.\\n\")\n        input &lt;- string(animal[0])\n    })\n\n    go func() {\n        if err := srv.ListenAndServe(); err != nil {\n            if err.Error() != \"http: Server closed\" {\n                fmt.Printf(\"getHTTPAnimal error with ListenAndServe: %s\", err)\n            }\n        }\n    }()\n\n    return srv\n}\n\nfunc getTerminalInput(input chan string) {\n    scanner := bufio.NewScanner(os.Stdin)\n    for {\n        scanner.Scan()\n        input &lt;- scanner.Text()\n    }\n}\n\nfunc main() {\n    input := make(chan string)\n    webinput := make(chan string)\n\n    srv := getHTTPAnimal(webinput)\n    fmt.Print(\"Enter animal type: \")\n    go getTerminalInput(input)\n\n    var animal string\n    select {\n    case ta := &lt;-input:\n        animal = ta\n    case webta := &lt;-webinput:\n        animal = webta\n        fmt.Printf(\"%s\\n\", animal)\n    }\n\n    ctx, _ := context.WithTimeout(context.Background(), 5*time.Second)\n    srv.Shutdown(ctx)\n    close(webinput)\n\n    fmt.Printf(\"Enter animal name: \")\n    name := &lt;-input\n    fmt.Printf(\"Congrats on getting %s the half-%s\\n\", name, animal)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 942, "user_id": 1320685, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07168c459dcd35c128757f8529306160?s=128&d=identicon&r=PG", "display_name": "Kevin Lyda", "link": "https://stackoverflow.com/users/1320685/kevin-lyda"}, "edited": false, "score": 0, "creation_date": 1533738596, "post_id": 51748585, "comment_id": 90458249, "body": "The problem with this is that the <code>http</code> package&#39;s <code>ListenAndServe()</code> method doesn&#39;t allow for a channel to be selected. Neither does the <code>Scan()</code> method of a <code>bufio.Scanner</code>.  I do end up using a <code>select</code> in my answer, but not quite as you do here."}], "tags": [], "owner": {"reputation": 19, "user_id": 7302254, "user_type": "registered", "profile_image": "https://graph.facebook.com/1189473351120775/picture?type=large", "display_name": "grayMou5e", "link": "https://stackoverflow.com/users/7302254/graymou5e"}, "is_accepted": false, "score": 0, "last_activity_date": 1533736697, "creation_date": 1533736697, "answer_id": 51748585, "question_id": 51745240, "link": "https://stackoverflow.com/questions/51745240/how-do-i-select-on-os-stdin-and-http-in-go/51748585#51748585", "title": "How do I select on os.Stdin and http in Go?", "body": "<p>There is couple of ways to stop goroutine:</p>\n\n<p>1) by closing the read channel:</p>\n\n<pre><code>msgCh := make(chan string)\n\ngo func(){\n    for msg, ok := range msgCh {\n        if !ok {\n            return\n        }\n    }\n}()\n\nmsgCh &lt;- \"String\"\nclose(msgCh)\n</code></pre>\n\n<p>2) passing some sort of kill switch</p>\n\n<pre><code>msgCh := make(chan string)\nkillSwitch := make(chan struct{})\n\ngo func(){\n    for {\n        select{\n        case msg &lt;- msgCh:\n            log.Println(msg)\n        case &lt;-killSwitch:\n            return\n        }\n    }\n}\nmsgCh &lt;- \"String\"\nclose(killSwitch)\n</code></pre>\n\n<p>With approach NR2 you are avoiding writing to closed chan that would end up as panic. Also close signal is populated as fanout pattern (all places where that chan is used will receive that signal)</p>\n"}], "owner": {"reputation": 942, "user_id": 1320685, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07168c459dcd35c128757f8529306160?s=128&d=identicon&r=PG", "display_name": "Kevin Lyda", "link": "https://stackoverflow.com/users/1320685/kevin-lyda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 614, "favorite_count": 0, "accepted_answer_id": 51747732, "answer_count": 3, "score": 2, "last_activity_date": 1533776985, "creation_date": 1533726707, "last_edit_date": 1533740070, "question_id": 51745240, "link": "https://stackoverflow.com/questions/51745240/how-do-i-select-on-os-stdin-and-http-in-go", "title": "How do I select on os.Stdin and http in Go?", "body": "<p>Say I want to accept an animal. The user can either set the type of animal at the <code>What type of animal?</code> prompt on a terminal, or she can go to <code>http://localhost:1234/animal?type=kitten</code></p>\n\n<p>Whichever she does, the terminal will read <code>What type of animal? kitten</code> (assuming she chose a kitten) and the program will then prompt the user on the terminal (and only the terminal) <code>What is the kitten's name?</code></p>\n\n<p>My thought was to use channels to go routines, but since both go routines will be stuck in a function call (<code>Scan()</code> for the terminal, <code>ListenAndServe()</code> for http) then I'm not clear how to stop the go routine that is still in a function call once the input is received. The normal method of selecting on channels won't work.</p>\n\n<p>In C I'd just do a <code>select(2)</code> on the two relevant file descriptors (fd 0 and the fd from <code>listen()</code>) but I don't think that's how to do it in Go.</p>\n\n<p>Note: I answered this down below. If you're down voting the question this I'd be curious to know why as I would have found the answer I came up with useful. If you're down voting the answer, I'd really be interested in knowing why. If it's non-idiomatic Go or if it has other issues I'm missing, I'd really like to fix them.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1533727968, "post_id": 51745139, "comment_id": 90450906, "body": "There is nothing wrong with using if else when checking for empty slice."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1533728011, "post_id": 51745139, "comment_id": 90450941, "body": "@Himanshu - so how would you write it ? :) can you provide it as answer please?"}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1533731479, "post_id": 51745766, "comment_id": 90453291, "body": "According to the question that should be <code>i &gt;= len(mdl) || mod.Name == mdl[i]</code>; handle either matching values, or all of them if <code>mdl</code> is empty."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533732662, "post_id": 51745766, "comment_id": 90454082, "body": "@Peter this condition will fail when <code>i=0</code> because <code>mdl</code> length will be zero and the code will run even if the slice is empty. and it will not check for second condition if first will meet it will run the code."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533734608, "post_id": 51745766, "comment_id": 90455441, "body": "The code is supposed to run when the slice is empty: &quot;1. If mdl is empty (it can be without any value)loop on all the mStr value and prints to all.&quot;"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533734934, "post_id": 51745766, "comment_id": 90455664, "body": "@Peter What if the slice is not empty first condition will be true then the code should run for those values of slice which is equal to <code>mod.Name</code>. But your option will run for every value because second condition need not to be true."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533735412, "post_id": 51745766, "comment_id": 90456005, "body": "I don&#39;t get what you&#39;re trying to say. If <code>mdl</code> is not empty the first condition will only ever be true if <code>mStr</code> is larger than <code>mdl</code>. It prevents an out-of-bounds panic while also covering the first goal of the OP."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533735968, "post_id": 51745766, "comment_id": 90456391, "body": "@Peter I am not getting can you help me regenerate the condition you are saying. I am getting confused. Because if first condition is true should condition should also be true. if its wrong the loop will continue to next iteration. But in your case it will print the value even if second condition is false."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1533728274, "creation_date": 1533728274, "answer_id": 51745766, "question_id": 51745139, "link": "https://stackoverflow.com/questions/51745139/filter-values-in-range-loop-in-golang/51745766#51745766", "title": "Filter values in range loop in golang", "body": "<p>Check for length of slice that you are passing in the function if the slice is empty it will give the length as zero.</p>\n\n<pre><code>if len(mdl) &gt; 0 &amp;&amp; mod.Name == mdl[i] {\n        fmt.Fprint(file, \u201capp\u201d)\n        fmt.Fprint(file, \u201capp1\u201d)\n        // code\n}else{\n     // code\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1580074314, "creation_date": 1533726417, "last_edit_date": 1580074314, "question_id": 51745139, "link": "https://stackoverflow.com/questions/51745139/filter-values-in-range-loop-in-golang", "title": "Filter values in range loop in golang", "body": "<p>I\u2019ve the following code which runs ok, Im looping on the <code>mStr</code> and printing\nValue to a file</p>\n\n<pre><code>func setFile(file io.Writer, mStr []*mod.M, mdl []string) {\n\n    for i, mod := range mStr {\n            fmt.Fprint(file, \u201capp\u201d)\n            fmt.Fprint(file, \u201capp1\u201d)\n                        \u2026\n\n    }\n}\n</code></pre>\n\n<p>Now what I need is to provide a filter on the range ,\ne.g. just prints to file  if mod.Name ==\u201capp\u201d </p>\n\n<pre><code>func setFile(file io.Writer, mStr []*mod.M, mdl []string) {\n\n    for i, mod := range mStr {\n\n    if mod.Name == mdl[i] {\n            fmt.Fprint(file, \u201capp\u201d)\n            fmt.Fprint(file, \u201capp1\u201d)\n                        \u2026\n\n    }\n  }\n}\n</code></pre>\n\n<p>While this could work, it introduce a few <code>if else</code> forks in the code to support the following :</p>\n\n<ol>\n<li>If <code>mdl</code> is <strong>empty</strong> (it can be without any value)loop on all the mStr value and prints to all.</li>\n<li>If  mdl contain value , prints only when the <code>mod.Name == mdl[I]</code>  otherwise don\u2019t.</li>\n</ol>\n\n<p>Is there a <strong>cleaner</strong> way to do this kind of filtering on loop in Golang? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "edited": false, "score": 3, "creation_date": 1533721962, "post_id": 51743324, "comment_id": 90447202, "body": "Just use slice, array is not suitable to be passed as param, it will make a copy, waste space &amp; time, also there are two copy of undering data."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1533722294, "post_id": 51743324, "comment_id": 90447453, "body": "This answer <a href=\"https://stackoverflow.com/questions/48849493/go-variadic-function-argument-passing/48849643#48849643\" title=\"go variadic function argument passing\">stackoverflow.com/questions/48849493/&hellip;</a> might be of help."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1533724196, "post_id": 51743324, "comment_id": 90448571, "body": "Slicing an array is not inefficient at all. See <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">blog.golang.org/slices</a>."}], "answers": [{"comments": [{"owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "edited": false, "score": 5, "creation_date": 1533722062, "post_id": 51743476, "comment_id": 90447286, "body": "Another reason not to use array is, when pass array as param, it will make a copy, anyway this won&#39;t work."}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": true, "score": 3, "last_activity_date": 1533721370, "creation_date": 1533721370, "answer_id": 51743476, "question_id": 51743324, "link": "https://stackoverflow.com/questions/51743324/passing-a-fixed-length-array-to-a-function/51743476#51743476", "title": "Passing a fixed length array to a function", "body": "<p>No there is no way to pass different size arrays, because the length of an array is part of the type. </p>\n\n<p>For example <code>[3]int</code> is a different type then <code>[2]int</code>.</p>\n\n<p>At all in Go it is not recommended to use arrays you should use slices (<a href=\"https://golang.org/doc/effective_go.html#arrays\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#arrays</a>). </p>\n"}], "owner": {"reputation": 320, "user_id": 6402043, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-LX6LSiYkqPE/AAAAAAAAAAI/AAAAAAAAARg/_cO2uaBhukM/photo.jpg?sz=128", "display_name": "Blallo", "link": "https://stackoverflow.com/users/6402043/blallo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 630, "favorite_count": 0, "accepted_answer_id": 51743476, "answer_count": 1, "score": 2, "last_activity_date": 1533721370, "creation_date": 1533720989, "question_id": 51743324, "link": "https://stackoverflow.com/questions/51743324/passing-a-fixed-length-array-to-a-function", "title": "Passing a fixed length array to a function", "body": "<p>I want to write a function that can accept arrays of fixed length, but different arrays have different lengths.</p>\n\n<p>I know that i can pass the slice with arr[:] (the function will accept []T), but is there another way, maybe more efficient?</p>\n\n<p>I'm using a struct that i'd like to mantain with fixed length arrays (for documentation purposes), so using slices everywhere at declaration time is not optimal for my purpose.</p>\n"}, {"tags": ["go", "struct", "protocol-buffers", "composite-literals"], "answers": [{"comments": [{"owner": {"reputation": 3572, "user_id": 1037295, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8a4b0b11ae8fcdc4690db9fa4eb63280?s=128&d=identicon&r=PG", "display_name": "yong ho", "link": "https://stackoverflow.com/users/1037295/yong-ho"}, "edited": false, "score": 0, "creation_date": 1533888736, "post_id": 51742672, "comment_id": 90521410, "body": "Thanks for your answer. But it&#39;s not easy to write something like this in GoLand. Don&#39;t know how to change the settings."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1533719525, "last_edit_date": 1533719525, "creation_date": 1533719033, "answer_id": 51742672, "question_id": 51742263, "link": "https://stackoverflow.com/questions/51742263/go-build-with-protocol-buffer-error-too-few-values-in-struct-initializer/51742672#51742672", "title": "Go build with protocol buffer error: too few values in struct initializer", "body": "<p>In struct <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"noreferrer\">composite literals</a> you may omit the field names to which you list values for (this is called <em>unkeyed literal</em>), but then you have to list initial values for all fields and in their declaration order. Or you may use a keyed literal where you explicitly state which fields you specify initial values for. In the latter, you are allowed to omit any of the fields, you may just list the ones you want to give an initial value different from the field's <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\">zero value</a>).</p>\n\n<p>You used unkeyed composite literal, in which case you must list values for all fields, which you didn't. This is what the error message tells you: <em>\"too few values in struct initializer\"</em>.</p>\n\n<p>The field name (generated by protobuf) itself should give you the hint: <code>XXX_NoUnkeyedLiteral</code>. It suggests you should not use a composite literal without keys.</p>\n\n<p>So use a composite literal <em>with keys</em>, like this::</p>\n\n<pre><code>client := &amp;Client{\n    Id:    123,\n    Name:  \"John\",\n    Email: \"john@aol.com\",\n}\n</code></pre>\n\n<p>This form is more readable, and it is immune to struct changes. E.g. if the <code>Client</code> struct would get new fields, or fields would get rearranged, this code would still be valid and compile.</p>\n"}, {"tags": [], "owner": {"reputation": 306, "user_id": 6101819, "user_type": "registered", "profile_image": "https://graph.facebook.com/234836870197330/picture?type=large", "display_name": "Penny Qian", "link": "https://stackoverflow.com/users/6101819/penny-qian"}, "is_accepted": false, "score": 0, "last_activity_date": 1537434483, "creation_date": 1537434483, "answer_id": 52421429, "question_id": 51742263, "link": "https://stackoverflow.com/questions/51742263/go-build-with-protocol-buffer-error-too-few-values-in-struct-initializer/52421429#52421429", "title": "Go build with protocol buffer error: too few values in struct initializer", "body": "<p>Add field name before the value can solve the building error, as </p>\n\n<p><code>client := &amp;Client{Id: 123, Name: \"John\", Email: \"john@aol.com\"}</code></p>\n\n<p>I find this out by checking the <a href=\"https://github.com/grpc/grpc-go/blob/master/examples/route_guide/server/server.go#L73\" rel=\"nofollow noreferrer\">grpc golang example</a>, but maybe somebody can explain why? ;)</p>\n"}], "owner": {"reputation": 3572, "user_id": 1037295, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8a4b0b11ae8fcdc4690db9fa4eb63280?s=128&d=identicon&r=PG", "display_name": "yong ho", "link": "https://stackoverflow.com/users/1037295/yong-ho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4839, "favorite_count": 1, "accepted_answer_id": 51742672, "answer_count": 2, "score": 6, "last_activity_date": 1537434483, "creation_date": 1533717703, "last_edit_date": 1533719187, "question_id": 51742263, "link": "https://stackoverflow.com/questions/51742263/go-build-with-protocol-buffer-error-too-few-values-in-struct-initializer", "title": "Go build with protocol buffer error: too few values in struct initializer", "body": "<p>I have a proto file:</p>\n\n<pre><code>syntax = \"proto3\";\n\npackage main;\n\nmessage Client {\n    int32 Id = 1;\n    string Name = 2;\n    string Email = 3;\n}\n</code></pre>\n\n<p>The compiled <code>Client</code> struct like below:</p>\n\n<pre><code>type Client struct {\n    Id                   int32    `protobuf:\"varint,1,opt,name=Id,proto3\" json:\"Id,omitempty\"`\n    Name                 string   `protobuf:\"bytes,2,opt,name=Name,proto3\" json:\"Name,omitempty\"`\n    Email                string   `protobuf:\"bytes,3,opt,name=Email,proto3\" json:\"Email,omitempty\"`\n    XXX_NoUnkeyedLiteral struct{} `json:\"-\"`\n    XXX_unrecognized     []byte   `json:\"-\"`\n    XXX_sizecache        int32    `json:\"-\"`\n}\n</code></pre>\n\n<p>When I am trying to init this <code>Client</code> struct like below:</p>\n\n<p><code>client := &amp;Client{123, \"John\", \"john@aol.com\"}\n</code></p>\n\n<p>I am getting building error: <code>too few values in struct initializer</code>. I found a way to fix it by adding <code>XXX_NoUnkeyedLiteral</code>, <code>XXX_unrecognized</code>, <code>XXX_sizecache</code>. I don't know what these are, and wondering if this is the right way to do it:</p>\n\n<pre><code>client := &amp;Client{123, \"John\", \"john@aol.com\", struct{}{}, []byte{}, int32(0)}\n</code></pre>\n"}, {"tags": ["go", "jetbrains-ide", "goland"], "answers": [{"comments": [{"owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 1, "creation_date": 1533721854, "post_id": 51742771, "comment_id": 90447147, "body": "many thanks for info you provided: live template works fine for now. I thought about plugin before - now I know how to start :)"}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 2, "last_activity_date": 1533719386, "creation_date": 1533719386, "answer_id": 51742771, "question_id": 51742181, "link": "https://stackoverflow.com/questions/51742181/generate-server-go-base-on-grpc-proto-method-with-goland/51742771#51742771", "title": "Generate server.go base on grpc proto method with GoLand", "body": "<p>At the moment I don't know of any such plugin or functionality available.</p>\n\n<p>If you want to develop your own plugin, you can start by reading our <a href=\"http://www.jetbrains.org/intellij/sdk/docs/welcome.html\" rel=\"nofollow noreferrer\">SDK documentation</a>.</p>\n\n<p>As an alternative, I think you can use the <a href=\"https://www.jetbrains.com/help/go/settings-live-templates.html\" rel=\"nofollow noreferrer\">Live Templates</a> feature in order to achieve something very similar to that, with the content along the lines of the example below and define the template to be available for \"Go | File\" context:</p>\n\n<pre><code>func (s *$VAR4$) $VAR0$(ctx context.Context, req *$VAR1$) (*$VAR2$, error) {\n    return &amp;$VAR2${}\n}\n</code></pre>\n"}], "owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 51742771, "answer_count": 1, "score": 0, "last_activity_date": 1533728216, "creation_date": 1533717410, "last_edit_date": 1533728216, "question_id": 51742181, "link": "https://stackoverflow.com/questions/51742181/generate-server-go-base-on-grpc-proto-method-with-goland", "title": "Generate server.go base on grpc proto method with GoLand", "body": "<p>Are there some functional or plugin in GoLand to generate <code>server/server.go</code>  method base on proto rpc method?</p>\n\n<p>for example we have <code>some.proto</code>:</p>\n\n<pre><code>...\nrpc AnyMetod (AnyRequest) return (AnyResponse)\n...\n</code></pre>\n\n<p>and I want to have generated:</p>\n\n<pre><code>func (s *Server) AnyMethod(ctx context.Context, req *AnyRequest) (*AnyResponse, error) {\n    return &amp;AnyResponse{}\n}\n</code></pre>\n"}, {"tags": ["go", "go-pg"], "answers": [{"tags": [], "owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "is_accepted": true, "score": 0, "last_activity_date": 1533922276, "creation_date": 1533922276, "answer_id": 51791449, "question_id": 51741669, "link": "https://stackoverflow.com/questions/51741669/go-pg-belongs-to-2-fields-to-same-table/51791449#51791449", "title": "go-pg &quot;belongs to&quot; 2 fields to same table", "body": "<p>I forgot to add Id columns, here's a working example:</p>\n\n<pre><code>type Transaction struct {\n    Id              int\n    RecipientId     int    `json:\"recipient_id\"`\n    Recipient       *User  `pg:\"fk:recipient_id\"`\n    SenderId        int    `json:\"sender_id\"`\n    Sender          *User  `pg:\"fk:sender_id\"`\n    TransactionType int    `json:\"transaction_type\" validate:\"required\"`\n    Status          int    `json:\"status\" validate:\"required\"`\n    Ammount         int    `json:\"ammount\" validate:\"required\"`\n    CreatedAt       string `json:\"created_at\" validate:\"required\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 0, "accepted_answer_id": 51791449, "answer_count": 1, "score": 0, "last_activity_date": 1533922276, "creation_date": 1533715852, "question_id": 51741669, "link": "https://stackoverflow.com/questions/51741669/go-pg-belongs-to-2-fields-to-same-table", "title": "go-pg &quot;belongs to&quot; 2 fields to same table", "body": "<p>I am using <a href=\"https://github.com/go-pg/pg\" rel=\"nofollow noreferrer\">https://github.com/go-pg/pg</a> to handle this stuff, having huge issues making a basic belongs to relation.</p>\n\n<p>So basically i have one table that has columns receipient_id and sender_id, both point to the same users table. This is my code and result: </p>\n\n<pre><code>type Transaction struct {\n    Id              int\n    Receipient      *User  `json:\"receipient_id\" sql:\"-\" validate:\"required\"`\n    Sender          *User  `json:\"sender_id\" sql:\"-\" validate:\"required\"`\n    TransactionType int    `json:\"transaction_type\" validate:\"required\"`\n    Status          int    `json:\"status\" validate:\"required\"`\n    Ammount         int    `json:\"ammount\" validate:\"required\"`\n    CreatedAt       string `json:\"created_at\" validate:\"required\"`\n}\n\n\n\nerr = database.DBCon.Model(&amp;transactions).Select()\nif err != nil {\n    return transactions, err\n}\n\n\n\n16:51:15.754 V1TransactionListPOST \u25b6 ERRO 006 supppers [Transaction&lt;id:1 receipient:&lt;nil&gt; sender:&lt;nil&gt; transaction_type:0 status:1 ammount:100 created_at:1533650239\n]\n2018/08/07 16:51:15 http: panic serving [::1]:50157: runtime error: invalid memory address or nil pointer dereference\ngoroutine 5 [running]:\nnet/http.(*conn).serve.func1(0xc42036fd60)\n ...\n</code></pre>\n\n<p>And this is the actual db:</p>\n\n<pre><code>SELECT * FROM transactions;\n-[ RECORD 1 ]----+-----------\nid               | 1\nreceipient_id    | 23\nsender_id        | 24\ntransaction_type | 0\nstatus           | 1\nammount          | 100\ncreated_at       | 1533650239\n\n\nSELECT * FROM users;\n-[ RECORD 1 ]---------+-------------------------------------------------------------\nid                    | 23\nemail                 | testss@gmail.com\nusername              | damn here\npassword              | $2a$10$ABBHfgwhnepqKitBoiQ2bOcPfGjUIjio33uL52R88Lk2XhcfGwn26\nuser_type             | 2\nprofile_id            | 1\nstatus                | 2\nconfirm_token         |\nrecover_token         |\nrecover_token_expiry  |\nrecover_secret_answer | $2a$10$xPwZk2LanxXf1lvCvp29IuyHav88m5dGXo8Ao0f5A1aV1zwh5t6le\n-[ RECORD 2 ]---------+-------------------------------------------------------------\nid                    | 24\nemail                 | anotehrtsts@gmail.com\nusername              | removeusername\npassword              | $2a$10$1tmCvZy5xo5zGz9C3g6YeeV8Wb149VwSTFhT1pcjb0zVasT.fbTKy\nuser_type             | 2\nprofile_id            | 1\nstatus                | 2\nconfirm_token         |\nrecover_token         |\nrecover_token_expiry  |\nrecover_secret_answer | $2a$10$CeS5qgITVGBgWX7cumhbdOoAPOhg/Lc2NXDu.nY5RzK3PGCW26Ik2\n</code></pre>\n"}, {"tags": ["postgresql", "go", "sqlx"], "comments": [{"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 1, "creation_date": 1533715633, "post_id": 51741204, "comment_id": 90443125, "body": "I guess the problem lies in <code>createFakeDBObj</code>. Could you post this func?"}, {"owner": {"reputation": 4577, "user_id": 4147191, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zNy4Unw5fq8/AAAAAAAAAAI/AAAAAAAAAP8/kQW6cfxt280/photo.jpg?sz=128", "display_name": "\u0141ukasz Kami\u0144ski", "link": "https://stackoverflow.com/users/4147191/%c5%81ukasz-kami%c5%84ski"}, "edited": false, "score": 0, "creation_date": 1533715724, "post_id": 51741204, "comment_id": 90443167, "body": "Could be case sensitivity. Try executing same query in psql but double quote table and column names."}, {"owner": {"reputation": 3, "user_id": 7695074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/129fe085b1f340b8aabbeb57c7a04037?s=128&d=identicon&r=PG&f=1", "display_name": "N.Ihor", "link": "https://stackoverflow.com/users/7695074/n-ihor"}, "reply_to_user": {"reputation": 4577, "user_id": 4147191, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zNy4Unw5fq8/AAAAAAAAAAI/AAAAAAAAAP8/kQW6cfxt280/photo.jpg?sz=128", "display_name": "\u0141ukasz Kami\u0144ski", "link": "https://stackoverflow.com/users/4147191/%c5%81ukasz-kami%c5%84ski"}, "edited": false, "score": 0, "creation_date": 1533744519, "post_id": 51741204, "comment_id": 90462141, "body": "@\u0141ukaszKami\u0144ski Same stuff. Works fine in psql, doesn&#39;t woks from code."}, {"owner": {"reputation": 3, "user_id": 7695074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/129fe085b1f340b8aabbeb57c7a04037?s=128&d=identicon&r=PG&f=1", "display_name": "N.Ihor", "link": "https://stackoverflow.com/users/7695074/n-ihor"}, "reply_to_user": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1533744903, "post_id": 51741204, "comment_id": 90462347, "body": "@mbuechmann Added code of createFakeDBObj below EDITED"}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1533802093, "post_id": 51741204, "comment_id": 90482608, "body": "@N.Ihor thanks. I think <code>createFakeDBObj</code> is not the problem. I assume that the database name <code>final_project</code> is only used in tests, is that correct? In that case, how do you create the <code>users</code> table in the test database?"}], "owner": {"reputation": 3, "user_id": 7695074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/129fe085b1f340b8aabbeb57c7a04037?s=128&d=identicon&r=PG&f=1", "display_name": "N.Ihor", "link": "https://stackoverflow.com/users/7695074/n-ihor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1615, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1533744763, "creation_date": 1533714336, "last_edit_date": 1533744763, "question_id": 51741204, "link": "https://stackoverflow.com/questions/51741204/postgresql-pq-column-of-relation-does-not-exist-when-executing-query-from-co", "title": "PostgreSQL: &quot;pq: column of relation does not exist&quot; when executing query from code, but it works fine in console", "body": "<p>I'm writing simple models for interacting with postgresql db in my api, and all of them work fine except one table. When i try to run tests i get an error:</p>\n\n<pre><code>=== RUN   TestAddUser\ntime=\"2018-08-08T10:24:56+03:00\" level=info msg=\"db connection\" db: =\"&amp;{0xc4200c6dc0 postgres false 0xc4200912c0}\"\n--- FAIL: TestAddUser (0.00s)\n    require.go:794: \n            Error Trace:    users_test.go:19\n            Error:          Received unexpected error:\n                            pq: column \"user_name\" of relation \"users\" does not exist\n                            Error while trying to add new user\n                            gitlab.com/inn4sci-go/Nesterenko/course/api/models.AddUser\n                                /home/nestor/go/src/gitlab.com/inn4sci-go/Nesterenko/course/api/models/users.go:20\n                            gitlab.com/inn4sci-go/Nesterenko/course/api/models/tests.TestAddUser\n                                /home/nestor/go/src/gitlab.com/inn4sci-go/Nesterenko/course/api/models/tests/users_test.go:18\n                            testing.tRunner\n                                /usr/local/go/src/testing/testing.go:777\n                            runtime.goexit\n                                /usr/local/go/src/runtime/asm_amd64.s:2361\n            Test:           TestAddUser\nFAIL\n\nProcess finished with exit code 1\n</code></pre>\n\n<p>But if i run same query from psql console all works fine:</p>\n\n<pre><code>nestor=&gt; INSERT INTO users (user_name, user_pass) VALUES ('wrerw','wrwer');\nINSERT 0 1\nnestor=&gt;\n</code></pre>\n\n<p>Here the code of AddUser func and Users struct:</p>\n\n<pre><code>package models\n\nimport (\n    \"github.com/pkg/errors\"\n    \"gitlab.com/inn4sci-go/Nesterenko/course/api/db\"\n)\n\ntype Users struct {\n    Id        int    `db:\"id\" json:\"id\"`\n    ProfileId int    `db:\"profile_id\" json:\"profileId\"`\n    UserName  string `db:\"user_name\" json:\"nickname\"`\n    UserPass  string `db:\"user_pass\" json:\"password\"`\n}\n\nfunc AddUser(db db.DbInt, user Users) (int64, error) {\n    query := `INSERT INTO users (user_name, user_pass) VALUES (:user_name, :user_pass)`\n\n    res, err := db.GetDB().NamedExec(query, &amp;user)\n    if err != nil {\n        return 0, errors.Wrap(err, \"Error while trying to add new user\")\n    }\n\n    id, err := res.LastInsertId()\n    if err != nil {\n        return 0, errors.Wrap(err, \"Error while trying to obtain userId\")\n    }\n\n    return id, nil\n}\n</code></pre>\n\n<p>Here code of test func:</p>\n\n<pre><code>func TestAddUser(t *testing.T) {\n    mockDB := testutils.CreateFakeDBObj(t) //this func mocks db connection, and works fine in all test\n    user := models.Users{\n        UserName: \"test\",\n        UserPass: \"test\",\n    }\n\n    userId, err := models.AddUser(mockDB, user)\n    require.NoError(t, err)\n\n    logrus.WithField(\"User was successfully added with id = \", userId).Info(\"Users test\")\n}\n</code></pre>\n\n<p>And this is query for creating users table: </p>\n\n<pre><code>nestor=&gt; CREATE TABLE IF NOT EXISTS users (id SERIAL PRIMARY KEY, profile_id INTEGER REFERENCES profile(id), user_name TEXT UNIQUE NOT NULL, user_pass TEXT NOT NULL);\nCREATE TABLE\nnestor=&gt; \\dt users\n       List of relations\n Schema | Name  | Type  | Owner \n--------+-------+-------+-------\n public | users | table | ihor\n(1 row)\n</code></pre>\n\n<p>I suppose that i have got a mistake somewhere in AddUser func when trying to execute this query: <strong>INSERT INTO users (user_name, user_pass) VALUES (:user_name, :user_pass)</strong></p>\n\n<p>EDITED:\nEstablishing connection to db:</p>\n\n<pre><code>type MockingDBObj struct {\n    mock.Mock\n}\n\nfunc (m MockingDBObj) ConnectToDB(c configure.ConfigInt) error {\n    return nil\n}\n\nfunc (m MockingDBObj) GetDB() *sqlx.DB {\n    args := m.Called()\n    return args.Get(0).(*sqlx.DB)\n}\nfunc CreateFakeDBObj(t *testing.T) MockingDBObj {\n    mockObj := new(MockingDBObj)\n\n    host := \"localhost\"\n    port := 5432\n    user := \"ihor\"\n    password := \"ihor\"\n    dbname := \"final_project\"\n\n    psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\n        \"password=%s dbname=%s sslmode=disable\",\n        host, port, user, password, dbname)\n\n    db, err := sqlx.Connect(\"postgres\", psqlInfo)\n    require.NoError(t, err)\n    logrus.WithField(\"db: \", db).Info(\"db connection\")\n    mockObj.On(\"GetDB\").Return(db)\n\n    return *mockObj\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1533723551, "post_id": 51740953, "comment_id": 90448191, "body": "Thanks @Himanshu but this func just return a slice and not closed channel."}], "answers": [{"comments": [{"owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "edited": false, "score": 0, "creation_date": 1533723435, "post_id": 51741379, "comment_id": 90448131, "body": "I used select .It is works.Thanks. But if I do not close channel will not there be a problem in the future? @apxp"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "edited": false, "score": 0, "creation_date": 1533724414, "post_id": 51741379, "comment_id": 90448700, "body": "@elhamanari check the links for playground in my answer to see the problem on not closing the channels and the way you can close the channels after sending the values."}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": true, "score": 4, "last_activity_date": 1533715548, "last_edit_date": 1533715548, "creation_date": 1533714883, "answer_id": 51741379, "question_id": 51740953, "link": "https://stackoverflow.com/questions/51740953/golang-send-on-closed-channel-error-in-multi-goroutines/51741379#51741379", "title": "Golang : send on closed channel error in multi goroutines", "body": "<p>When you work with channels in Go always the sender should close the channel. Because that signals that no more data will be send over the channel. </p>\n\n<p>In your code the receiver is closing it. Just leave the channel here opened and remove the <code>close(ch)</code> there.</p>\n\n<pre><code>func FillNotCheckedDeliveryCh(data IntegrateRowsFields, ch chan&lt;- CommonType.BasicRequestParameters) {\n    ch &lt;- PackerForNotFinishedCh(data)\n    defer close(ch)\n}\n</code></pre>\n\n<p>If something is blocking at that part you could use <code>select</code>:</p>\n\n<pre><code>func FillNotCheckedDeliveryCh(data IntegrateRowsFields, ch chan&lt;- CommonType.BasicRequestParameters) {  \n    select {\n      case ch &lt;- PackerForNotFinishedCh(data):\n      default:\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1586087336, "last_edit_date": 1586087336, "creation_date": 1533719826, "answer_id": 51742920, "question_id": 51740953, "link": "https://stackoverflow.com/questions/51740953/golang-send-on-closed-channel-error-in-multi-goroutines/51742920#51742920", "title": "Golang : send on closed channel error in multi goroutines", "body": "<p>Closing the channels on the receiver side, and then trying to send on the same channel gives you the error. Better is to close the channel outside the go routine only after all values are sent on the channels.</p>\n\n<p>Close the channel after waiting for all go routines to be finished.</p>\n\n<pre><code>wg.Wait()\nclose(ch)\n</code></pre>\n\n<p>Always close the channel when there are no more values to be sent on the channel.</p>\n\n<blockquote>\n  <p>Receivers can test whether a channel has been closed by assigning a\n  second parameter to the receive expression: after</p>\n</blockquote>\n\n<pre><code>v, ok := &lt;-ch\n</code></pre>\n\n<p>In your case too you can check on the receiver side by using ok if there are more values in the channel or if it is closed.</p>\n\n<blockquote>\n  <p>Channels aren't like files; you don't usually need to close them.\n  Closing is only necessary when the receiver must be told there are no\n  more values coming, such as to terminate a range loop.</p>\n</blockquote>\n\n<p><a href=\"https://play.golang.org/p/l1p6JeR1M5D\" rel=\"nofollow noreferrer\">Go playground example</a> for generating the error when not closing a channel and range over it.</p>\n\n<p><a href=\"https://play.golang.org/p/BIdgoH47JCq\" rel=\"nofollow noreferrer\">Playground example</a> for closing the channels when all values are send.</p>\n"}], "owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3461, "favorite_count": 1, "accepted_answer_id": 51741379, "answer_count": 2, "score": 1, "last_activity_date": 1586087336, "creation_date": 1533713538, "question_id": 51740953, "link": "https://stackoverflow.com/questions/51740953/golang-send-on-closed-channel-error-in-multi-goroutines", "title": "Golang : send on closed channel error in multi goroutines", "body": "<p>I have 3 channels that get data from together . My code run for first time perfect but when after that I send another data , there is error : send on closed channel.In func  FillNotCheckedDeliveryCh that line I closed channel .If I do not close it app stopped and not continue.</p>\n\n<pre><code>func main() {\n    receiveBulkIdsCh := make(chan int64, 100)\n    NotCheckedDeliveryCh := make(chan CommonType.BasicRequestParameters, 100)\n    ResultCh := make(chan CommonType.MessageStateResult, 100)\n\n    var wg sync.WaitGroup\n    wg.Add(4)\n\n    /* Every BulkIds that receive from queue , save in  receiveBulkIdsChan channel*/\n    go func() {\n        defer wg.Done()\n        PopQueue(receiveBulkIdsCh)\n    }()\n    go func() {\n        defer wg.Done()\n        for BulkId := range receiveBulkIdsCh {\n            FillNotCheckedDeliveryCh(data, NotCheckedDeliveryCh)\n        }\n    }()\n    go func() {\n        defer wg.Done()\n        for item := range NotCheckedDeliveryCh {\n            for msgStatus := range DoFuncGetMessageState(item) {\n                ResultCh &lt;- msgStatus\n            }\n            close(ResultCh)\n        }\n    }()\n    go func() {\n        defer wg.Done()\n        for Result := range ResultCh {\n            ReadResultCh(Result)\n        }\n    }()\n    wg.Wait()\n}\n\nfunc FillNotCheckedDeliveryCh(data IntegrateRowsFields, ch chan&lt;- CommonType.BasicRequestParameters) {\n    ch &lt;- PackerForNotFinishedCh(data)\n    defer close(ch)\n}\n</code></pre>\n\n<p>can help what's wrong ?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 6, "last_activity_date": 1533703769, "creation_date": 1533703769, "answer_id": 51738820, "question_id": 51738797, "link": "https://stackoverflow.com/questions/51738797/do-i-need-to-add-gopkg-lock-to-git/51738820#51738820", "title": "Do I need to add gopkg.lock to Git?", "body": "<p>Yes, in order to ensure a <strong>reproducible build</strong>.</p>\n\n<blockquote>\n  <p>There's flexibility in manifests that isn't present in locks..., as the \"branch\": \"master\" constraint will match whatever revision master HAPPENS to be at right now, whereas the <strong>lock is nailed down to a specific revision</strong>.</p>\n</blockquote>\n\n<p>Anyone cloning your Go project repository with a lock file will get the exact SHA1 of the dependencies.<br>\nYou can still update that lock file anytime you want, and version its updated content.</p>\n"}], "owner": {"reputation": 942, "user_id": 3151462, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/56c6cc1f0f7c534dd90d392bd797f2a0?s=128&d=identicon&r=PG&f=1", "display_name": "Shihao Xu", "link": "https://stackoverflow.com/users/3151462/shihao-xu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2708, "favorite_count": 2, "answer_count": 1, "score": 5, "last_activity_date": 1533703769, "creation_date": 1533703634, "last_edit_date": 1592644375, "question_id": 51738797, "link": "https://stackoverflow.com/questions/51738797/do-i-need-to-add-gopkg-lock-to-git", "title": "Do I need to add gopkg.lock to Git?", "body": "<p>Given that:</p>\n<blockquote>\n<p>The manifest describes user intent, and the lock describes computed outputs. There's flexibility in manifests that isn't present in locks..., as the &quot;branch&quot;: &quot;master&quot; constraint will match whatever revision master HAPPENS to be at right now, whereas the lock is nailed down to a specific revision.</p>\n<p>This flexibility is important because it allows us to provide easy commands (e.g. dep ensure -update) that can manage an update process for you, within the constraints you specify, AND because it allows your project, when imported by someone else, to collaboratively specify the constraints for your own dependencies.</p>\n</blockquote>\n<p>Reference: <a href=\"https://github.com/golang/dep/blob/master/docs/FAQ.md\" rel=\"nofollow noreferrer\">https://github.com/golang/dep/blob/master/docs/FAQ.md</a></p>\n"}, {"tags": ["go", "build"], "comments": [{"owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "edited": false, "score": 0, "creation_date": 1533712866, "post_id": 51738607, "comment_id": 90441507, "body": "I get the same error if I try to use cgo."}, {"owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "edited": false, "score": 0, "creation_date": 1533713747, "post_id": 51738607, "comment_id": 90442043, "body": "I upgraded to go version go1.10.3 with the same results although in that case the command line that GoLand provides is slightly different: go build -race -o ___Race_Detector.exe -gcflags &quot;all=-N -l&quot; &lt;dir&gt;"}, {"owner": {"reputation": 2914, "user_id": 1162491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S3MH1.jpg?s=128&g=1", "display_name": "Momer", "link": "https://stackoverflow.com/users/1162491/momer"}, "edited": false, "score": 3, "creation_date": 1533908927, "post_id": 51738607, "comment_id": 90533188, "body": "Can you provide code which reproduces the issue?"}, {"owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "reply_to_user": {"reputation": 2914, "user_id": 1162491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S3MH1.jpg?s=128&g=1", "display_name": "Momer", "link": "https://stackoverflow.com/users/1162491/momer"}, "edited": false, "score": 0, "creation_date": 1533959668, "post_id": 51738607, "comment_id": 90549830, "body": "On a different system (without MSYS installed) I get a different error: exec: &quot;gcc&quot;: executable file not found in %PATH%"}, {"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1534472137, "post_id": 51738607, "comment_id": 90726352, "body": "I think the shown example is also using CGO, maybe you could try without it?  just a wild guess."}, {"owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "reply_to_user": {"reputation": 2914, "user_id": 1162491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S3MH1.jpg?s=128&g=1", "display_name": "Momer", "link": "https://stackoverflow.com/users/1162491/momer"}, "edited": false, "score": 0, "creation_date": 1569911978, "post_id": 51738607, "comment_id": 102738683, "body": "@Momer it happens with any project at all. I could include the &quot;hello world&quot; project if you like"}, {"owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "reply_to_user": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1569912156, "post_id": 51738607, "comment_id": 102738766, "body": "@Daniel - no it happens with any project - ie does not have to use CGO.  But it also happens with any project that uses CGO even if I don&#39;t use the race detector.  To summarize it happens with (1) Any project when I use <code>go build -race -a</code>, (2) Any project that uses CGO even without any special options"}], "answers": [{"comments": [{"owner": {"reputation": 381, "user_id": 5275047, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-KfdTsqQF050/AAAAAAAAAAI/AAAAAAAAABY/wZVb8f2rptA/photo.jpg?sz=128", "display_name": "Allen ZHU", "link": "https://stackoverflow.com/users/5275047/allen-zhu"}, "edited": false, "score": 0, "creation_date": 1609408188, "post_id": 58062621, "comment_id": 115835472, "body": "How to set &quot;-vet=off&quot; ?"}, {"owner": {"reputation": 730, "user_id": 6161244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/990831a04db3b7c4a8ac83e67e00817d?s=128&d=identicon&r=PG", "display_name": "Constantin Konstantinidis", "link": "https://stackoverflow.com/users/6161244/constantin-konstantinidis"}, "reply_to_user": {"reputation": 381, "user_id": 5275047, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-KfdTsqQF050/AAAAAAAAAAI/AAAAAAAAABY/wZVb8f2rptA/photo.jpg?sz=128", "display_name": "Allen ZHU", "link": "https://stackoverflow.com/users/5275047/allen-zhu"}, "edited": false, "score": 0, "creation_date": 1609430314, "post_id": 58062621, "comment_id": 115842732, "body": "Reference of go test -vet is here: <a href=\"https://golang.org/cmd/go/#hdr-Test_packages\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-Test_packages</a>"}], "tags": [], "owner": {"reputation": 730, "user_id": 6161244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/990831a04db3b7c4a8ac83e67e00817d?s=128&d=identicon&r=PG", "display_name": "Constantin Konstantinidis", "link": "https://stackoverflow.com/users/6161244/constantin-konstantinidis"}, "is_accepted": true, "score": 1, "last_activity_date": 1569242258, "creation_date": 1569242258, "answer_id": 58062621, "question_id": 51738607, "link": "https://stackoverflow.com/questions/51738607/build-error-using-golang-race-detector/58062621#58062621", "title": "Build error using golang race detector", "body": "<p>Details are in this <a href=\"https://github.com/golang/go/issues/27089\" rel=\"nofollow noreferrer\">issue</a>.\nA workaround is usually to set <code>-vet=off</code></p>\n"}, {"tags": [], "owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "is_accepted": false, "score": 1, "last_activity_date": 1588397896, "creation_date": 1588397896, "answer_id": 61554981, "question_id": 51738607, "link": "https://stackoverflow.com/questions/51738607/build-error-using-golang-race-detector/61554981#61554981", "title": "Build error using golang race detector", "body": "<p>Late update:  I got it to build (much later) by upgrading the version of GCC I had installed.</p>\n"}], "owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 752, "favorite_count": 2, "accepted_answer_id": 58062621, "answer_count": 2, "score": 6, "last_activity_date": 1588397896, "creation_date": 1533702319, "last_edit_date": 1533959812, "question_id": 51738607, "link": "https://stackoverflow.com/questions/51738607/build-error-using-golang-race-detector", "title": "Build error using golang race detector", "body": "<p>My software compiles and runs fine but when I add the -race option to check for race conditions it does not build:</p>\n\n<pre><code>GOROOT=C:\\Go\n\nGOPATH=&lt;deleted&gt;;D:\\Golang\n\nC:\\Go\\bin\\go.exe build -race -o C:\\Users\\Andrewp\\AppData\\Local\\Temp\\___1Race_Detector.exe -gcflags \"-N -l\" -a &lt;deleted&gt;\n\n# runtime/cgo\n\ngcc_libinit_windows.c: In function 'x_cgo_sys_thread_create':\ngcc_libinit_windows.c:56:12: error: implicit declaration of function '_beginthread' [-Werror=implicit-function-declaration]\n  thandle = _beginthread(func, 0, arg);\n            ^\ncc1: all warnings being treated as errors\n\nCompilation finished with exit code 2\n</code></pre>\n\n<p>Note that it worked previously but I have since upgraded to go version go1.9.2 windows/amd64 (though I don't think that is related).  Also have MSYS installed.</p>\n\n<p>Also I am building with GoLand (under Windows 10) but I get the same problem when I build from the command line.</p>\n\n<p>Does anyone have info on how the Go compiler works esp. when using race detector or cgo, so I can track down the cause of this?</p>\n\n<p>Extra info:\nI can build fine from the terminal using:</p>\n\n<blockquote>\n  <p>go build -race</p>\n</blockquote>\n\n<p>It seems that the problem is caused by the -a option that GoLand added to the command line since this almost identical command line fails:</p>\n\n<blockquote>\n  <p>go build -race -a .</p>\n</blockquote>\n\n<p>But this is OK:</p>\n\n<blockquote>\n  <p>go build -a .</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 3, "creation_date": 1533686829, "post_id": 51736912, "comment_id": 90434561, "body": "You can use <code>os.IsNotExist(err)</code>"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 0, "creation_date": 1533687135, "post_id": 51736912, "comment_id": 90434628, "body": "@AlexGuerra I had no idea that was a thing. Of course I should do that lol..."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1533707353, "post_id": 51736912, "comment_id": 90438859, "body": "Note that there plenty more errors (if not most) that can&#39;t be &quot;fixed&quot; by retrying, such as insufficient permissions, so don&#39;t retry indefinitely."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533741340, "post_id": 51736912, "comment_id": 90460127, "body": "@Peter fair, but in my situation there&#39;s little fear of that. My three failure scenarios are that the remote machine is offline, that the file doesn&#39;t exist, and that the file is in use (hooray Windows)"}], "answers": [{"comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1533740019, "post_id": 51748687, "comment_id": 90459247, "body": "Well, I think I like <code>os.IsNotExist()</code> better. Thanks!"}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 2, "last_activity_date": 1533737044, "creation_date": 1533737044, "answer_id": 51748687, "question_id": 51736912, "link": "https://stackoverflow.com/questions/51736912/checking-for-error-message-from-os-remove/51748687#51748687", "title": "Checking for error message from os.Remove", "body": "<p>The \"type\" <code>error</code> is an interface. Interfaces don't have an concrete type. To get the type of the value you could use a type assertion or a type switch:</p>\n\n<pre><code>// Type assertion\n_, ok := err.(*PathError)\n\n// Type switch\nswitch err.(type) {\ncase *PathError:\n    // You know the type now\n}\n</code></pre>\n\n<p>This is an idiomatic way to find out of which type an error is. As in the comments specified there is already a function inside the os package which does this for you (<a href=\"https://golang.org/pkg/os/#IsNotExist\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#IsNotExist</a>)</p>\n"}, {"tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": false, "score": 0, "last_activity_date": 1533739912, "creation_date": 1533739912, "answer_id": 51749711, "question_id": 51736912, "link": "https://stackoverflow.com/questions/51736912/checking-for-error-message-from-os-remove/51749711#51749711", "title": "Checking for error message from os.Remove", "body": "<p>I just dealt with this the other day. An error from <code>os.Remove()</code> will be <code>syscall.ENOENT</code> if the file did not exist.</p>\n\n<p>So you can use logic like this:</p>\n\n<pre><code>if err != nil {\n    e, ok := err.(*os.PathError)\n    if ok &amp;&amp; e.Err == syscall.ENOENT {\n        // The file didn't exist\n        w.WriteHeader(http.StatusNotFound)\n        return\n    } else {\n        // Error other than syscall.ENOENT\n    }\n}\n</code></pre>\n\n<p>Of course, as shown in another answer, <code>os.IsNotExist()</code> is simple and idiomatic. Wish I'd seen that before today.</p>\n"}], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1357, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1533739912, "creation_date": 1533686120, "question_id": 51736912, "link": "https://stackoverflow.com/questions/51736912/checking-for-error-message-from-os-remove", "title": "Checking for error message from os.Remove", "body": "<p>What's the most idiomatic way to check error messages? My use case is that in <code>err := os.Remove(path)</code>, I consider a success either:</p>\n\n<p>A) if <code>err == nil</code></p>\n\n<p>or</p>\n\n<p>B) if <code>err != nil</code> but the error is thrown because the file was not found.</p>\n\n<p>any other error should cause the removal to retry. Currently I've wrapped this in a <code>for { ... }</code> loop and am checking:</p>\n\n<pre><code>if err == nil || strings.Contains(err.Error(), \"no such file\") {\n    // Success\n} else {\n    // Fail\n}\n</code></pre>\n\n<p>Since <a href=\"https://golang.org/pkg/os/#Remove\" rel=\"nofollow noreferrer\">the docs</a> say:</p>\n\n<blockquote>\n  <p>If there is an error, it will be of type *PathError.</p>\n</blockquote>\n\n<p>I don't think there's a way to check by type assertion. Am I missing something fundamental? My error handling in Go has always felt somewhat slapdash.</p>\n"}, {"tags": ["android", "go"], "comments": [{"owner": {"reputation": 2947, "user_id": 10191554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0IbXJ.jpg?s=128&g=1", "display_name": "Angus Tay", "link": "https://stackoverflow.com/users/10191554/angus-tay"}, "edited": false, "score": 4, "creation_date": 1533690743, "post_id": 51736462, "comment_id": 90435224, "body": "Go edition is just a naming, it has nothing to do with Golang."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1533726801, "post_id": 51736519, "comment_id": 90450132, "body": "<a href=\"https://en.wikipedia.org/wiki/Google_Fuchsia\" rel=\"nofollow noreferrer\">Fuchsia</a> may (or may not) eventually displace Android, and parts of it are wtitten in Go; but only parts, and the other parts are written in C, C++, Dart, and may be something else. And since Android is the kernel plus some amount of Java API and userspace, I doubt it would even be a good idea to (re-)write <i>all</i> of this in Go, especially the kernel."}, {"owner": {"reputation": 897, "user_id": 1609153, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/7f27f99d230fd321eafead95ebbf566b?s=128&d=identicon&r=PG", "display_name": "Tom Russell", "link": "https://stackoverflow.com/users/1609153/tom-russell"}, "edited": false, "score": 0, "creation_date": 1534407462, "post_id": 51736519, "comment_id": 90696470, "body": "What a mess. Doesn&#39;t look like Fushia is going to save us. But a complete rewrite of kernel, APIs and user space in golang might not? How can C be better in any way than Go?"}, {"owner": {"reputation": 897, "user_id": 1609153, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/7f27f99d230fd321eafead95ebbf566b?s=128&d=identicon&r=PG", "display_name": "Tom Russell", "link": "https://stackoverflow.com/users/1609153/tom-russell"}, "edited": false, "score": 0, "creation_date": 1534407672, "post_id": 51736519, "comment_id": 90696603, "body": "I guess the Linux stack will need to all be rewritten as well."}, {"owner": {"reputation": 449, "user_id": 7623709, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3b869731c724b20a6dd447a3f87121e6?s=128&d=identicon&r=PG&f=1", "display_name": "mike", "link": "https://stackoverflow.com/users/7623709/mike"}, "edited": false, "score": 0, "creation_date": 1540136061, "post_id": 51736519, "comment_id": 92743765, "body": "The only choice could be a WebAssembly API accessible for userspace. That way any language compiled go wasm could use it. This is where the web goes so I see no reason why native OSes  wouldn&#39;t follow.  So it&#39;s not all lost but today looks like you need to use Java to write Android apps and Swift/Objective-C to write iOS apps...I already regret using Go in my latest mobile app."}], "tags": [], "owner": {"reputation": 905471, "user_id": 115145, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/wDnd8.png?s=128&g=1", "display_name": "CommonsWare", "link": "https://stackoverflow.com/users/115145/commonsware"}, "is_accepted": true, "score": 17, "last_activity_date": 1533682638, "creation_date": 1533682638, "answer_id": 51736519, "question_id": 51736462, "link": "https://stackoverflow.com/questions/51736462/are-there-plans-to-develop-a-golang-version-of-android/51736519#51736519", "title": "Are there plans to develop a golang version of Android?", "body": "<blockquote>\n  <p>I see there's an Android 9 (Go edition) version. But it looks like it's just more Java with Golang bindings</p>\n</blockquote>\n\n<p>No. Android Go is a line of Android apps designed for use on low-end Android devices. Android Go has nothing to do with:</p>\n\n<ul>\n<li>the Go programming language</li>\n<li>the Go strategy board game</li>\n<li>the Go square on a traditional Monopoly board</li>\n<li>etc.</li>\n</ul>\n\n<blockquote>\n  <p>I've looked around a bit but I can't find a discussion about a version of Android built directly from golang source code and little or no Java.</p>\n</blockquote>\n\n<p>That is because it does not exist.</p>\n"}, {"comments": [{"owner": {"reputation": 897, "user_id": 1609153, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/7f27f99d230fd321eafead95ebbf566b?s=128&d=identicon&r=PG", "display_name": "Tom Russell", "link": "https://stackoverflow.com/users/1609153/tom-russell"}, "edited": false, "score": 0, "creation_date": 1533705592, "post_id": 51737135, "comment_id": 90438268, "body": "Thanks. +1 for the effort though it didn&#39;t really address my question."}], "tags": [], "owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "is_accepted": false, "score": 6, "last_activity_date": 1533689009, "last_edit_date": 1592644375, "creation_date": 1533688658, "answer_id": 51737135, "question_id": 51736462, "link": "https://stackoverflow.com/questions/51736462/are-there-plans-to-develop-a-golang-version-of-android/51737135#51737135", "title": "Are there plans to develop a golang version of Android?", "body": "<p>Here is a wiki with clear steps to achieve compiling a golang app and installing onto android</p>\n<p><a href=\"https://github.com/golang/go/wiki/Mobile\" rel=\"noreferrer\">https://github.com/golang/go/wiki/Mobile</a></p>\n<p>The toy android app shows an animated triangle which follows your touch as it moves about ... this actually worked when I discovered above wiki I believe from <a href=\"https://news.ycombinator.com/item?id=9875886\" rel=\"noreferrer\">https://news.ycombinator.com/item?id=9875886</a>   To quote their wiki</p>\n<hr />\n<blockquote>\n<p>The Go mobile subrepository adds support for mobile platforms (Android and iOS) and provides tools to build mobile applications.</p>\n<p>There are two strategies you can follow to include Go into your mobile stack:</p>\n</blockquote>\n<ul>\n<li>Writing all-Go native mobile applications.</li>\n<li>Writing SDK applications by generating bindings from a Go package and invoke them from Java (on Android) and Objective-C (on iOS).</li>\n</ul>\n<p>Writing golang for mobile can be like writing c++ for mobile - great for writing firmware level servers say for HLS (http-live-streaming) which live below any app to which apps make calls to</p>\n"}, {"comments": [{"owner": {"reputation": 280, "user_id": 401842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e049c68f7751148951180b264649ef3?s=128&d=identicon&r=PG", "display_name": "CoCoMo", "link": "https://stackoverflow.com/users/401842/cocomo"}, "edited": false, "score": 2, "creation_date": 1557073921, "post_id": 54276235, "comment_id": 98635697, "body": "I suppose using WASM on mobile would result in performant apps that aren&#39;t native."}], "tags": [], "owner": {"reputation": 55899, "user_id": 58961, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5be12a5a883043ee47443e93217504b6?s=128&d=identicon&r=PG", "display_name": "John Leidegren", "link": "https://stackoverflow.com/users/58961/john-leidegren"}, "is_accepted": false, "score": 3, "last_activity_date": 1547985821, "creation_date": 1547985821, "answer_id": 54276235, "question_id": 51736462, "link": "https://stackoverflow.com/questions/51736462/are-there-plans-to-develop-a-golang-version-of-android/54276235#54276235", "title": "Are there plans to develop a golang version of Android?", "body": "<p>Note that it is possible to compile Go to both JavaScript and WASM. I've use the WASM support to build an application that work across all modern browsers. (incl. modern mobile browsers)</p>\n\n<p>The way I do it is that I load the Go program in a background worker, I then use a channel to talk to the Go program as it was an API running locally. My primary reason for doing so was to leverage some of the functionality in the standard library, specifically, the cryptographic APIs.</p>\n"}], "owner": {"reputation": 897, "user_id": 1609153, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/7f27f99d230fd321eafead95ebbf566b?s=128&d=identicon&r=PG", "display_name": "Tom Russell", "link": "https://stackoverflow.com/users/1609153/tom-russell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11145, "favorite_count": 2, "accepted_answer_id": 51736519, "answer_count": 3, "score": 12, "last_activity_date": 1547985821, "creation_date": 1533682348, "question_id": 51736462, "link": "https://stackoverflow.com/questions/51736462/are-there-plans-to-develop-a-golang-version-of-android", "title": "Are there plans to develop a golang version of Android?", "body": "<p>I've looked around a bit but I can't find a discussion about a version of Android built directly from <code>golang</code> source code and little or no Java.</p>\n\n<p>I see there's an Android 9 (Go edition) version. But it looks like it's just more Java with Golang bindings: <a href=\"https://www.android.com/versions/go-edition\" rel=\"noreferrer\">https://www.android.com/versions/go-edition</a>. Or is this a native <code>Go</code> Android?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1431, "user_id": 1748237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/fd62c4a7acebbb773c2d07a86c1238d4?s=128&d=identicon&r=PG", "display_name": "Alexander Tumin", "link": "https://stackoverflow.com/users/1748237/alexander-tumin"}, "edited": false, "score": 0, "creation_date": 1533669861, "post_id": 51734037, "comment_id": 90428818, "body": "Couldn&#39;t add <code>go-get</code> tag. If somebody with &gt;1500 reputation could do that, might be helpful, as we already got <code>go-build</code> one."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1533670195, "post_id": 51734037, "comment_id": 90428968, "body": "You cannot build a main package without a main function. Why don&#39;t you have one? What would be the point of such a package?"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 1, "creation_date": 1533671210, "post_id": 51734037, "comment_id": 90429444, "body": "<code>go get</code> works for all packages and it loads all dependecies by default. If you use the package in your program and you build your program everything should work then."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1533671422, "post_id": 51734037, "comment_id": 90429537, "body": "Did you run <code>go get -v .&#47;...</code> and that&#39;s a typo in the question, or did you actually run <code>go get v .&#47;...</code>? The latter might yield an error, the former should work. You don&#39;t need a <code>main</code> function to run <code>go get</code> to get your dependencies."}, {"owner": {"reputation": 1431, "user_id": 1748237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/fd62c4a7acebbb773c2d07a86c1238d4?s=128&d=identicon&r=PG", "display_name": "Alexander Tumin", "link": "https://stackoverflow.com/users/1748237/alexander-tumin"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533672800, "post_id": 51734037, "comment_id": 90430211, "body": "@Peter I don&#39;t want to build package without main function, I want to get &amp; build it&#39;s dependencies. @apxp i have a package &quot;myrepo&quot; in <code>generate.go</code>, but thats an error for <code>go get</code>. @Adrian it was a typo. And no, <code>go get -v .&#47;...</code> does not work work without a hitch: it prints error messages and returns error code 2 instead of successful 0 exit code."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1533673760, "post_id": 51734037, "comment_id": 90430638, "body": "What errors does it print? Because the errors you quoted in the question shouldn&#39;t be generated by <code>get</code>, only by <code>build</code>. Note that you can get your dependencies without building a main package, you can&#39;t build them - building would be meaningless in that case, but getting them should be sufficient to e.g. get autocomplete in your editor to work."}, {"owner": {"reputation": 1431, "user_id": 1748237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/fd62c4a7acebbb773c2d07a86c1238d4?s=128&d=identicon&r=PG", "display_name": "Alexander Tumin", "link": "https://stackoverflow.com/users/1748237/alexander-tumin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533680729, "post_id": 51734037, "comment_id": 90433155, "body": "@Adrian Those errors are after jut go get invocation, it builds and installs fetched packages into $GOPATH/bin by default, unless -d is specified. And it would not be meaningless before go generate, because they may be providing binaries required for //go:generate annotations"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1533680890, "post_id": 51734037, "comment_id": 90433205, "body": "That would require building those specific packages, and would imply a more complex build process which should be documented."}], "owner": {"reputation": 1431, "user_id": 1748237, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/fd62c4a7acebbb773c2d07a86c1238d4?s=128&d=identicon&r=PG", "display_name": "Alexander Tumin", "link": "https://stackoverflow.com/users/1748237/alexander-tumin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1533672643, "creation_date": 1533669821, "last_edit_date": 1533672643, "question_id": 51734037, "link": "https://stackoverflow.com/questions/51734037/how-to-get-and-build-all-dependencies-of-go-package-which-has-no-main-function", "title": "How to get and build all dependencies of go package which has no main function?", "body": "<p>I have a following project:</p>\n\n<pre><code>myrepo/     # root package, no main() function\n  |-common/ # common utilties package\n  |-cmd/    # CLI root\n  |   |-myrepo-a/   # CLI application A\n  |   |   |-main.go # CLI application A main package/function, \n  |   |             # setting up feature A for CLI use\n  |   |-myrepo-b/   # CLI application B\n  |       |-main.go # CLI application B main package/function,\n  |                 # setting up feature B for CLI use\n  |-aspecific/  # package with generic implementation for feature A\n  |-bspecific/  # package with generic implementation for feature B\n  |-generate.go # file dispatching //go:generate instructions\n</code></pre>\n\n<p>How to get and build dependencies of such myrepo project?</p>\n\n<p><code>go get -v ./...</code> invocation yields errors:</p>\n\n<pre><code>runtime.main_main\u00b7f: relocation target main.main not defined\nruntime.main_main\u00b7f: undefined: \"main.main\"\n</code></pre>\n\n<p>Can i avoid manually specifying each of subpackages for such invocation as in <code>go get ./common/... ./cmd/... ./aspecific/... ./bspecific/...</code>, as such hard-coding might result in desync between actual project state and packages getting built?</p>\n"}, {"tags": ["git", "go", "visual-studio-code", "delve"], "answers": [{"comments": [{"owner": {"reputation": 251, "user_id": 9229936, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/i0lv8.png?s=128&g=1", "display_name": "Matthew Mallimo", "link": "https://stackoverflow.com/users/9229936/matthew-mallimo"}, "edited": false, "score": 0, "creation_date": 1533665142, "post_id": 51732725, "comment_id": 90426503, "body": "I have tried this already. The application I am trying to debug uses a gui in the console. When I look at the debug console using this configuration that gui does not appear. That is why I was trying to attach to the exe. Any other suggestions?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 251, "user_id": 9229936, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/i0lv8.png?s=128&g=1", "display_name": "Matthew Mallimo", "link": "https://stackoverflow.com/users/9229936/matthew-mallimo"}, "edited": false, "score": 0, "creation_date": 1533665228, "post_id": 51732725, "comment_id": 90426539, "body": "@MatthewMallimo you can only debug the source code which is raw code. There is no way you can debug working gui application. Try to run the main file of project this will run the project with gui and then create breakpoints on the code."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1533664401, "creation_date": 1533664401, "answer_id": 51732725, "question_id": 51732631, "link": "https://stackoverflow.com/questions/51732631/golang-debug-console-application/51732725#51732725", "title": "GoLang debug console application", "body": "<p>You are using the <code>.exe</code> file for debugging the code. Use the raw code to denug the application. Also there is a debug console where you can see the output when debugging using breakpoints or in case of any error. The configurations for <code>launch.json</code> should be:</p>\n\n<pre><code>{\n    \"name\": \"Launch\",\n    \"type\": \"go\",\n    \"request\": \"launch\",\n    \"mode\": \"debug\",\n    \"remotePath\": \"\",\n    \"port\": 2345,\n    \"host\": \"127.0.0.1\",\n    \"program\": \"${workspaceFolder}\",\n    \"env\": {},\n    \"args\": [],\n    \"showLog\": true\n}\n</code></pre>\n\n<p>Debug console will show the output of debugging and stdout:</p>\n\n<p><a href=\"https://i.stack.imgur.com/wcnMD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wcnMD.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5107315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00ac10c5f1bab31e176a8aed609b0bb2?s=128&d=identicon&r=PG&f=1", "display_name": "Moshe Be", "link": "https://stackoverflow.com/users/5107315/moshe-be"}, "is_accepted": false, "score": 0, "last_activity_date": 1595454221, "last_edit_date": 1595454221, "creation_date": 1595451673, "answer_id": 63043129, "question_id": 51732631, "link": "https://stackoverflow.com/questions/51732631/golang-debug-console-application/63043129#63043129", "title": "GoLang debug console application", "body": "<p>Make sure you disable the compiler optimization in your <code>go build</code> command. It should be something like:</p>\n<pre><code>go build -gcflags=&quot;all=-N -l&quot;\n</code></pre>\n"}], "owner": {"reputation": 251, "user_id": 9229936, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/i0lv8.png?s=128&g=1", "display_name": "Matthew Mallimo", "link": "https://stackoverflow.com/users/9229936/matthew-mallimo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1481, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1595454221, "creation_date": 1533664040, "question_id": 51732631, "link": "https://stackoverflow.com/questions/51732631/golang-debug-console-application", "title": "GoLang debug console application", "body": "<p>I am trying to debug <a href=\"https://github.com/jesseduffield/lazygit\" rel=\"nofollow noreferrer\">this project</a></p>\n\n<p>I am using visual studio code, and have the Go extension setup. \nI am able to set a breakpoint in the main function and debug it, but I never see the visual command prompt. I used Delve, ran the exe that the project produces, and attached. This allowed me to debug it, but I would prefer to debug it in vscode. </p>\n\n<p>I tried using this vscode debug configuration:</p>\n\n<pre><code>    {\n        \"name\": \"Launch file\",\n        \"type\": \"go\",\n        \"request\": \"attach\",\n        \"mode\": \"exec\",\n        \"program\": \"${workspaceFolder}/lazygit.exe\"\n    },\n</code></pre>\n\n<p>and it is successful. But again, I cannot see the actual command window and actually use the project. </p>\n\n<p>Is there any way to attach to an already open process in vscode, like in delve, or for vscode to launch the exe in a command window?</p>\n"}, {"tags": ["html", "database", "go", "web-applications"], "comments": [{"owner": {"reputation": 512, "user_id": 7059839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87f616c02953102b0eae4f10db176e1b?s=128&d=identicon&r=PG&f=1", "display_name": "grandia", "link": "https://stackoverflow.com/users/7059839/grandia"}, "edited": false, "score": 0, "creation_date": 1533692151, "post_id": 51732484, "comment_id": 90435476, "body": "Please allow me to clarify your question, so you want your app to spit out the result of this DB query in a RESTful manner? and you need a framework for this REST service?"}, {"owner": {"reputation": 43, "user_id": 6889344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a4743b94402677e0bf0504a1f27779?s=128&d=identicon&r=PG&f=1", "display_name": "Maruf Saidov", "link": "https://stackoverflow.com/users/6889344/maruf-saidov"}, "reply_to_user": {"reputation": 512, "user_id": 7059839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87f616c02953102b0eae4f10db176e1b?s=128&d=identicon&r=PG&f=1", "display_name": "grandia", "link": "https://stackoverflow.com/users/7059839/grandia"}, "edited": false, "score": 0, "creation_date": 1533735096, "post_id": 51732484, "comment_id": 90455779, "body": "I try to avoid using any framework, however I want to  Yes, in restful manner Action is like this:     In  <a href=\"http://cltloylprog.com/api/analytics/newusers\" rel=\"nofollow noreferrer\">cltloylprog.com/api/analytics/newusers</a> Analytic set the period(for instance Jan-1-2018 till March-1-2018) and as result on html page it shows new registrated users in table    Month|Jan|Feb|Mar|    Users | 12 |45  | 21| I hope you got my idea"}], "answers": [{"tags": [], "owner": {"reputation": 426, "user_id": 2433331, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/B7ROj.jpg?s=128&g=1", "display_name": "shazbot", "link": "https://stackoverflow.com/users/2433331/shazbot"}, "is_accepted": false, "score": 0, "last_activity_date": 1533676902, "creation_date": 1533676902, "answer_id": 51735614, "question_id": 51732484, "link": "https://stackoverflow.com/questions/51732484/monitoring-new-user/51735614#51735614", "title": "monitoring new user", "body": "<p>I use gin-gonic for every RESTful API I make ( <a href=\"https://gin-gonic.github.io/gin/\" rel=\"nofollow noreferrer\">https://gin-gonic.github.io/gin/</a> ). Whether is 1 QPS or 100,000 QPS, it's a solid performer, simple to use with great documentation.</p>\n\n<p>You wouldn't want to use logrus.Fatal mind you as that would terminate the API. Use gin to handle the errors and output them using JSON or similar and the correct http code obviously.</p>\n"}], "owner": {"reputation": 43, "user_id": 6889344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a4743b94402677e0bf0504a1f27779?s=128&d=identicon&r=PG&f=1", "display_name": "Maruf Saidov", "link": "https://stackoverflow.com/users/6889344/maruf-saidov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1533676902, "creation_date": 1533663453, "last_edit_date": 1533669099, "question_id": 51732484, "link": "https://stackoverflow.com/questions/51732484/monitoring-new-user", "title": "monitoring new user", "body": "<p>I am a go student, so I am writing a simple API, that needs analytics\nI want to create a monitoring new users, to see how many users had registered by specific period. So I set date (init date and end date) and return number of new users.</p>\n\n<p>Here is my func only:</p>\n\n<pre><code>package db\n\nimport (\n    \"github.com/sirupsen/logrus\"\n    \"time\"\n)\n\nfunc NewUsersByPeriod(start time.Time, end time.Time) (count int) {\n    Qselect := `SELECT COUNT(*) FROM \"User\" WHERE datereg BETWEEN $1 and $2 ;`\n    row := connectionVar.QueryRowx(Qselect, start, end)\n    err := row.Scan(&amp;count)\n    if err != nil {\n        logrus.Fatal(err)\n    }\n\n    return count\n}\n</code></pre>\n\n<p>My question is about how to realize it correctly, what frameworks I could use?\nWrite any recommendation</p>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1533660403, "post_id": 51731701, "comment_id": 90424295, "body": "<code>mgo</code> definitely doesn&#39;t, it&#39;s just an interface to MongoDB. It exposes the functionality that MongoDB offers, plus the <code>bson</code> library for marshaling/unmarshalling Go types into Mongo&#39;s native BSON."}, {"owner": {"reputation": 1085, "user_id": 3169138, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wSAPm.jpg?s=128&g=1", "display_name": "byrnedo", "link": "https://stackoverflow.com/users/3169138/byrnedo"}, "edited": false, "score": 1, "creation_date": 1533739499, "post_id": 51731701, "comment_id": 90458906, "body": "FYI, in case you were thinking of manually sorting that <code>[]B</code>, don&#39;t forget you can make a custom slice type (eg <code>type BSlice []B</code>) and implement the sort interface: <a href=\"https://gobyexample.com/sorting-by-functions\" rel=\"nofollow noreferrer\">gobyexample.com/sorting-by-functions</a>"}], "answers": [{"tags": [], "owner": {"reputation": 75, "user_id": 1638680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3daa6d9e1fd176087a06f2bac4475895?s=128&d=identicon&r=PG", "display_name": "dgm", "link": "https://stackoverflow.com/users/1638680/dgm"}, "is_accepted": false, "score": 0, "last_activity_date": 1535663388, "creation_date": 1535663388, "answer_id": 52105398, "question_id": 51731701, "link": "https://stackoverflow.com/questions/51731701/does-mgo-have-the-functionality-to-sort-a-specific-slice-field-for-each-document/52105398#52105398", "title": "Does mgo have the functionality to sort a specific Slice field for each document from a query result?", "body": "<p>There is a way to do it with the aggregation engine.</p>\n\n<ol>\n<li>$match the documents you want</li>\n<li>$project the fields you want</li>\n<li>$unwind the slice</li>\n<li>$sort the unwound slice using the id and the unwound value as your sort keys</li>\n<li>$group your sorted slice elements together</li>\n</ol>\n"}], "owner": {"reputation": 21, "user_id": 2619464, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWPD1.png?s=128&g=1", "display_name": "Hugues Lavoie", "link": "https://stackoverflow.com/users/2619464/hugues-lavoie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535663388, "creation_date": 1533660219, "last_edit_date": 1533661562, "question_id": 51731701, "link": "https://stackoverflow.com/questions/51731701/does-mgo-have-the-functionality-to-sort-a-specific-slice-field-for-each-document", "title": "Does mgo have the functionality to sort a specific Slice field for each document from a query result?", "body": "<p>I'm not talking about how to sort <code>result</code>. That I know!<br>\nIt's one of the field in <code>result</code> that I want sorted in a specific order.<br>\nSo let say we have a <code>result := []A{}</code> returned by a mgo query:  </p>\n\n<pre><code>type A struct {\n    I  string\n    II []B\n}\ntype B struct {\n    X  string\n    XX int\n}\n</code></pre>\n\n<p>In that <code>result</code>, I want each <code>result[i].II</code> sorted by B.XX</p>\n\n<p>What I'm asking is can I get this kind of sort done by mgo or I'll have to loop on <code>result</code> and sort the <code>A.II</code> Slice my self ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 30756, "user_id": 5389997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d227900a17ca5c34bad6d2b27122c7f?s=128&d=identicon&r=PG&f=1", "display_name": "Shadow", "link": "https://stackoverflow.com/users/5389997/shadow"}, "edited": false, "score": 1, "creation_date": 1533659702, "post_id": 51731423, "comment_id": 90423937, "body": "@Shadow that is not an apt duplicate. This question is specifically about Go."}, {"owner": {"reputation": 30756, "user_id": 5389997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d227900a17ca5c34bad6d2b27122c7f?s=128&d=identicon&r=PG&f=1", "display_name": "Shadow", "link": "https://stackoverflow.com/users/5389997/shadow"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533660414, "post_id": 51731423, "comment_id": 90424301, "body": "@Adrian let me quote the question: &quot;Is it possible to do with database/sql ?&quot; The duplicate shows how to do this with sql. If that was not the intention of the OP, then the question should not have included sql and probably should not have been tagged as MySQL either."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 30756, "user_id": 5389997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d227900a17ca5c34bad6d2b27122c7f?s=128&d=identicon&r=PG&f=1", "display_name": "Shadow", "link": "https://stackoverflow.com/users/5389997/shadow"}, "edited": false, "score": 4, "creation_date": 1533660528, "post_id": 51731423, "comment_id": 90424349, "body": "@Shadow <code>database&#47;sql</code> is the name of the Go library for interacting with SQL databases. I see no reason it shouldn&#39;t have been tagged mysql, since the question is about using MySQL with Go. Using both tags seems entirely appropriate, and I see no reason they shouldn&#39;t have included the relevant query they&#39;re executing from their Go code. Just because the question isn&#39;t <i>only</i> about SQL doesn&#39;t mean it isn&#39;t about SQL <i>at all</i>."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1533660945, "post_id": 51731423, "comment_id": 90424573, "body": "<a href=\"https://golang.org/pkg/database/sql/#Rows.Columns\" rel=\"nofollow noreferrer\">Rows.Columns</a> returns the column names and <a href=\"https://golang.org/pkg/database/sql/#Rows.ColumnTypes\" rel=\"nofollow noreferrer\">Rows.ColumnTypes</a> the types along with the name. QueryRow is not appropriate without <code>LIMIT 1</code>; use Query instead."}, {"owner": {"reputation": 1491, "user_id": 629960, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/2i6rf.jpg?s=128&g=1", "display_name": "Roman Gelembjuk", "link": "https://stackoverflow.com/users/629960/roman-gelembjuk"}, "edited": false, "score": 0, "creation_date": 1533702057, "post_id": 51731423, "comment_id": 90437359, "body": "I updated the question. I don&#39;t agree it is duplicated of &quot;Get table column names in mysql? &quot;"}, {"owner": {"reputation": 30756, "user_id": 5389997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d227900a17ca5c34bad6d2b27122c7f?s=128&d=identicon&r=PG&f=1", "display_name": "Shadow", "link": "https://stackoverflow.com/users/5389997/shadow"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533879049, "post_id": 51731423, "comment_id": 90516800, "body": "@Adrian disagree. If you do not want to see a solution specific to a certain technology, then you must not tag your question with it. If you want an answer specific to a library in a language,  then use that to tag the question."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1533901232, "post_id": 51731423, "comment_id": 90528358, "body": "Pretty sure they&#39;re looking for a solution specific to <i>all</i> the tags they used, combined. That&#39;s how tags work, that&#39;s why you&#39;re able to put multiple tags on a question."}], "answers": [{"comments": [{"owner": {"reputation": 1491, "user_id": 629960, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/2i6rf.jpg?s=128&g=1", "display_name": "Roman Gelembjuk", "link": "https://stackoverflow.com/users/629960/roman-gelembjuk"}, "edited": false, "score": 0, "creation_date": 1534172534, "post_id": 51821171, "comment_id": 90604767, "body": "Yes. This is what i finally did. My solution is little different. I cast columns to bytes, if len() is more 0 than convert to string"}, {"owner": {"reputation": 2750, "user_id": 8645590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21294be3adc65e1d68b7de3199d5a28d?s=128&d=identicon&r=PG&f=1", "display_name": "Vikram Hosakote", "link": "https://stackoverflow.com/users/8645590/vikram-hosakote"}, "edited": false, "score": 1, "creation_date": 1549672265, "post_id": 51821171, "comment_id": 96000249, "body": "This worked great for me too, except, if you&#39;re using the gorm package (<a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm</a>) and if your <code>db</code> object is of type <code>*gorm.DB</code>, then,  replace <code>db.Query(sqlcommand)</code> above with <code>db.Raw(sqlcommand).Rows()</code>."}], "tags": [], "owner": {"reputation": 2032, "user_id": 3403369, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2f22e034ed5c2f2adc584dc721718fb4?s=128&d=identicon&r=PG", "display_name": "robx", "link": "https://stackoverflow.com/users/3403369/robx"}, "is_accepted": true, "score": 10, "last_activity_date": 1534159286, "creation_date": 1534159286, "answer_id": 51821171, "question_id": 51731423, "link": "https://stackoverflow.com/questions/51731423/how-to-read-a-row-from-a-table-to-a-map-without-knowing-columns/51821171#51821171", "title": "How to read a row from a table to a map, Without knowing columns", "body": "<p>You seem to be on the right track. According to the definition of <a href=\"https://godoc.org/database/sql#Rows.Scan\" rel=\"noreferrer\"><code>Rows.Scan</code></a>, you can supply values of the desired destination type, which would be <code>string</code> here. So changing the type of <code>columns</code> to <code>[]string</code> should work:</p>\n\n<pre><code>var db sql.DB\nvar sqlcommand string\n\nrows, _ := db.Query(sqlcommand)\ncols, _ := rows.Columns()\n\ndata := make(map[string]string)\n\nif rows.Next() {\n    columns := make([]string, len(cols))\n    columnPointers := make([]interface{}, len(cols))\n    for i, _ := range columns {\n        columnPointers[i] = &amp;columns[i]\n    }\n\n    rows.Scan(columnPointers...)\n\n    for i, colName := range cols {\n        data[colName] = columns[i]\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1491, "user_id": 629960, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/2i6rf.jpg?s=128&g=1", "display_name": "Roman Gelembjuk", "link": "https://stackoverflow.com/users/629960/roman-gelembjuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4728, "favorite_count": 0, "accepted_answer_id": 51821171, "answer_count": 1, "score": 7, "last_activity_date": 1534159286, "creation_date": 1533659093, "last_edit_date": 1534150895, "question_id": 51731423, "link": "https://stackoverflow.com/questions/51731423/how-to-read-a-row-from-a-table-to-a-map-without-knowing-columns", "title": "How to read a row from a table to a map, Without knowing columns", "body": "<p>In my golang app i need to do SQL query to MySQL to get single row and put result in a map[string]string keys are column names.</p>\n\n<p>But i don't know what will be columns. Query is like </p>\n\n<pre><code>SELECT * FROM mytable\n</code></pre>\n\n<p>I use \"database/sql\" .</p>\n\n<p>I found only Scan function </p>\n\n<pre><code>db.QueryRow(\"SELECT * FROM mytable\").Scan(&amp;var1, &amp;var2,...)\n</code></pre>\n\n<p>but this doesn't work for my condition. I don't know  how many variables will be there. And also I need column names.</p>\n\n<p>Is it possible to do with database/sql  ?</p>\n\n<p><strong>Update</strong>. I found how to solve part of this problem. How to get column names from a result set.</p>\n\n<pre><code>rows, err := db.Query(sqlcommand)\n\ncols, err := rows.Columns()\n</code></pre>\n\n<p>So, i can use to make keys for a map. But i still don't know how to get values. Because, values can have different type.</p>\n\n<pre><code>data = make(map[string]string)\n\nif rows.Next() {\n    columns := make([]interface{}, len(cols))\n    columnPointers := make([]interface{}, len(cols))\n    for i, _ := range columns {\n        columnPointers[i] = &amp;columns[i]\n    }\n\n    err = rows.Scan(columnPointers...)\n\n    for i, colName := range cols {\n        // value is in columns[i] of interface type.\n        // How to extract it from here? \n        // ....\n        data[colName] = val\n    }\n}\n</code></pre>\n\n<p>P.S. This question is not duplicate of \"Get table column names in mysql?\n\". I wanted to get columns of returned data set, not just a table.</p>\n"}, {"tags": ["mongodb", "go", "bson", "mgo"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1533654549, "post_id": 51730044, "comment_id": 90420807, "body": "Have you tried your query in mongo CLI (or some other mongo tool) directly? If you get the same result, then this is purely a mongodb question, not a Go question. If this is actually a Go issue though, we&#39;ll need to see the relevant Go code."}, {"owner": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "edited": false, "score": 2, "creation_date": 1533654675, "post_id": 51730044, "comment_id": 90420897, "body": "Please add more of your Go code. I think I know the issue but want to verify by seeing your Go code before I answer."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1533655405, "post_id": 51730044, "comment_id": 90421386, "body": "The Go code fragment you posted does not justify the result you get. If you want help, you need to post more of your code, aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. As it is now, this question is off topic."}, {"owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533656062, "post_id": 51730044, "comment_id": 90421780, "body": "@Adrian Added more go code as I do not have any issues with querying on mongo CLI"}, {"owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "reply_to_user": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "edited": false, "score": 0, "creation_date": 1533656084, "post_id": 51730044, "comment_id": 90421793, "body": "@AnonymousPenguin added more go code"}], "answers": [{"comments": [{"owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "edited": false, "score": 0, "creation_date": 1533656645, "post_id": 51730617, "comment_id": 90422164, "body": "Awesome! Thanks and Yes you are right. I will make changes as suggested. Thank ou!"}, {"owner": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "reply_to_user": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "edited": false, "score": 1, "creation_date": 1533656780, "post_id": 51730617, "comment_id": 90422248, "body": "@DoIt no problem! :) See the last paragraph I just added... I think you may have accidentally swapped the names of the Selector and Query fields in <code>MongoSpec</code>... fixing that will make your code easier to read."}, {"owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "edited": false, "score": 0, "creation_date": 1533656911, "post_id": 51730617, "comment_id": 90422327, "body": "Sure. My earlier comment was in response to the last paragraph"}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1533865218, "post_id": 51730617, "comment_id": 90513739, "body": "@AnonymousPenguin could you please modify the projection phrase to <code>Projection doesn&#39;t filter which documents are returned, it limits which values per document that are returned</code>. Projection happens in the server not just how it&#39;s shown, projection can help reduce network bandwidth and achieve covered query state. Thanks"}], "tags": [], "owner": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "is_accepted": true, "score": 1, "last_activity_date": 1534131693, "last_edit_date": 1534131693, "creation_date": 1533656257, "answer_id": 51730617, "question_id": 51730044, "link": "https://stackoverflow.com/questions/51730044/issue-getting-entire-element-from-mongo-using-golang-bson-instead-only-child-ele/51730617#51730617", "title": "Issue getting entire element from mongo using golang bson instead only child element is being returned", "body": "<p><code>$elemMatch</code> exists as both a <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/query/elemMatch\" rel=\"nofollow noreferrer\">query</a></strong> and a <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/projection/elemMatch/\" rel=\"nofollow noreferrer\">projection</a>.</strong> A query is used to actually filter <strong>which documents</strong> are returned, and a projection determines <strong>which part of the documents returned</strong> are shown. To reiterate: Projection doesn't filter which documents are returned, it limits which values per document are returned (similar to the <code>SELECT</code> part of SQL).</p>\n\n<p>mgo's <code>Find</code> function is the query, and <code>Select</code> is the projection. Therefore, you want your final code to look closer to this:</p>\n\n<pre><code>c.Find(\n    bson.M{\n        \"children\": bson.M{\n            \"$elemMatch\": bson.M{serialNo: \"abc123\"},\n        },\n    },\n).Select(\n    bson.M{\n        \"_id\": 0,\n    },\n)\n</code></pre>\n\n<p>With how you have your code set up, this is how it would look.</p>\n\n<pre><code>Find(\n    MongoSpec{\n        Selector: bson.M{\"children\": bson.M{\"$elemMatch\": fields}},\n        Query: bson.M{\"_id\": 0},\n    },\n)\n</code></pre>\n\n<p>However, I'd strongly advise you rename the fields in <code>MongoSpec</code> (dropping it and the Find function altogether might not be a bad idea, too). You use <code>Query</code> as your projection (the <code>.Select()</code> function) and you use <code>Selector</code> as your query (<code>.Find()</code>). That may be why you made this mistake in the first place.</p>\n"}], "owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 418, "favorite_count": 0, "accepted_answer_id": 51730617, "answer_count": 1, "score": 2, "last_activity_date": 1534131693, "creation_date": 1533654431, "last_edit_date": 1533656021, "question_id": 51730044, "link": "https://stackoverflow.com/questions/51730044/issue-getting-entire-element-from-mongo-using-golang-bson-instead-only-child-ele", "title": "Issue getting entire element from mongo using golang bson instead only child element is being returned", "body": "<p>I am working on a mongo query in golang using mgo to query a child element to return the entire element </p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"5b64a0d3931653c36bcaf0b5\"),\n    \"quantity\" : 2,\n    \"product\" : \"ABC\",   \n    \"children\" : [ \n        {           \n            \"isBlocked\" : true,\n            \"blockedMessage\" : \"Error occurred: TRACEID\",\n            \"serialNo\" : \"abc123\",\n            \"token\" : \"foo456\",            \n        }\n    ]\n}\n</code></pre>\n\n<p>The query I am using in below\n   bson.M{\"_id\": 0, \"children\": bson.M{\"$elemMatch\": {serialNo: 'abc123'}}}</p>\n\n<pre><code>Find(MongoSpec{Selector: bson.M{}, Query: bson.M{\"_id\": 0, \"children\": bson.M{\"$elemMatch\": fields}}})\n</code></pre>\n\n<p>Below is the find function</p>\n\n<pre><code>    documents := []interface{}{}\n        s := spec.(MongoSpec).Selector\n        q := spec.(MongoSpec).Query\n        query := session.\n            DB(repo.Config.DatabaseName).\n            C(repo.CollectionName).\n            Find(s)\n\n        if q != nil {\n            query = query.Select(q)\n        }\n\n        err := query.All(&amp;documents)\n</code></pre>\n\n<p>MongoSpec struct </p>\n\n<pre><code>  type MongoSpec struct {\n        Selector interface{}\n        Query    interface{}\n    }\n</code></pre>\n\n<p>The above query works fine but returns only children element as below</p>\n\n<pre><code>\"children\" : [ \n            {           \n                \"isBlocked\" : true,\n                \"blockedMessage\" : \"Error occurred: TRACEID\",\n                \"serialNo\" : \"abc123\",\n                \"token\" : \"foo456\",            \n            }\n        ]\n</code></pre>\n\n<p>I am not getting what is wrong with the query.</p>\n"}, {"tags": ["testing", "go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1533648740, "creation_date": 1533648740, "answer_id": 51728079, "question_id": 51727970, "link": "https://stackoverflow.com/questions/51727970/go-tests-clean-up-after-panic/51728079#51728079", "title": "go tests: clean up after panic", "body": "<p>As noted in the issue you linked to:</p>\n\n<blockquote>\n  <p>The panic could come from a goroutine started by a test and the\n  testing package can't add a defer to those goroutines to catch the\n  panic.</p>\n  \n  <p>Aadditionally, some panics are impossible to recover, e.g. out of\n  menory or runtime memory corruption.</p>\n</blockquote>\n\n<p>In short, you <em>cannot make sure</em> that any code will be executed in all circumstances.</p>\n\n<p>If your cleanup is non-critical, you can do it before &amp; after (i.e. at the start of your tests, check if your container already exists and destroy it before creating a new one, then make a best effort to destroy it at the end). If your cleanup is critical, then wrap your <code>go test</code> call with something (e.g. a shell script or makefile) and make the wrapper responsible for the setup &amp; teardown of external dependencies.</p>\n"}], "owner": {"reputation": 1662, "user_id": 4258834, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/LK9Tq.jpg?s=128&g=1", "display_name": "oopcode", "link": "https://stackoverflow.com/users/4258834/oopcode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 437, "favorite_count": 0, "accepted_answer_id": 51728079, "answer_count": 1, "score": 2, "last_activity_date": 1533648870, "creation_date": 1533648432, "last_edit_date": 1533648870, "question_id": 51727970, "link": "https://stackoverflow.com/questions/51727970/go-tests-clean-up-after-panic", "title": "go tests: clean up after panic", "body": "<p>Suppose that I set up a Docker container with a DB for my tests, and I do that in <a href=\"https://golang.org/pkg/testing/#hdr-Main\" rel=\"nofollow noreferrer\">testing.TestMain</a> because I want this to be done once and globally. I write a <code>defer</code> statement in this <code>testing.Main()</code> that does the cleanup (namely, removes the DB container).</p>\n\n<p>Now, suppose that something goes wrong and my tests panic. <a href=\"https://github.com/golang/go/issues/13149\" rel=\"nofollow noreferrer\">This issue</a> tells me that I can not write custom <code>recover</code> code to ensure that the container is removed. This is true: <code>testing.M.Run()</code> does its own <code>recover()</code> call, and it looks like there's no way to override its behaviour.</p>\n\n<p>The question is: what should I do to make sure that my cleanup code is executed no matter what?</p>\n"}, {"tags": ["mongodb", "go", "aggregation-framework", "mgo"], "comments": [{"owner": {"reputation": 2071, "user_id": 7478530, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cGr5i.png?s=128&g=1", "display_name": "Dragonthoughts", "link": "https://stackoverflow.com/users/7478530/dragonthoughts"}, "edited": false, "score": 5, "creation_date": 1533647318, "post_id": 51727427, "comment_id": 90415530, "body": "Stack overflow is not a free code design and writing service. Please show us what you have attempted and explain why it is wrong."}, {"owner": {"reputation": 25, "user_id": 10166198, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ct5Q0Yye3rM/AAAAAAAAAAI/AAAAAAAAAAw/Euee5XXC0VU/photo.jpg?sz=128", "display_name": "Vladimir Loct", "link": "https://stackoverflow.com/users/10166198/vladimir-loct"}, "reply_to_user": {"reputation": 2071, "user_id": 7478530, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cGr5i.png?s=128&g=1", "display_name": "Dragonthoughts", "link": "https://stackoverflow.com/users/7478530/dragonthoughts"}, "edited": false, "score": 0, "creation_date": 1533648277, "post_id": 51727427, "comment_id": 90416253, "body": "I&#39;m sorry, to be more precise, I do not understand how to transfer $concat  in golang, its always sees a syntax error I&#39;m doing like this :"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 3, "creation_date": 1533648323, "post_id": 51727427, "comment_id": 90416294, "body": "@VladimirLoct Please add the error you are getting along with the code you have tried in golang to accomplish that."}, {"owner": {"reputation": 25, "user_id": 10166198, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ct5Q0Yye3rM/AAAAAAAAAAI/AAAAAAAAAAw/Euee5XXC0VU/photo.jpg?sz=128", "display_name": "Vladimir Loct", "link": "https://stackoverflow.com/users/10166198/vladimir-loct"}, "reply_to_user": {"reputation": 2071, "user_id": 7478530, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cGr5i.png?s=128&g=1", "display_name": "Dragonthoughts", "link": "https://stackoverflow.com/users/7478530/dragonthoughts"}, "edited": false, "score": 0, "creation_date": 1533648359, "post_id": 51727427, "comment_id": 90416323, "body": "@Dragonthoughts bson.M{&quot;$concat&quot;:bson.M{[&quot;https ://www .someurl.com/&quot;, &quot;$data.aID&quot;]}}   but its wrong"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 10166198, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ct5Q0Yye3rM/AAAAAAAAAAI/AAAAAAAAAAw/Euee5XXC0VU/photo.jpg?sz=128", "display_name": "Vladimir Loct", "link": "https://stackoverflow.com/users/10166198/vladimir-loct"}, "edited": false, "score": 0, "creation_date": 1533715966, "post_id": 51729635, "comment_id": 90443303, "body": "it worked thanks, and sorry for too broad question :)"}, {"owner": {"reputation": 343, "user_id": 8411263, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nLuEd7kVkpA/AAAAAAAAAAI/AAAAAAAAACI/XGfe0AyH8n8/photo.jpg?sz=128", "display_name": "Manouchehr Rasouli", "link": "https://stackoverflow.com/users/8411263/manouchehr-rasouli"}, "edited": false, "score": 0, "creation_date": 1587452746, "post_id": 51729635, "comment_id": 108509282, "body": "ye i that&#39;s a correct presentation of what is mean in question !"}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 1, "last_activity_date": 1533653241, "creation_date": 1533653241, "answer_id": 51729635, "question_id": 51727427, "link": "https://stackoverflow.com/questions/51727427/aggregate-query-in-golang/51729635#51729635", "title": "Aggregate query in golang", "body": "<p>The syntax here is tricky because it's similar to JSON but different enough to be confusing.</p>\n\n<p>In particular, note that arrays use curly brace delimiters <code>[]bson.M{...}</code> and the <code>$concat</code> value is an array of strings <code>[]string{...}</code>:</p>\n\n<pre><code>query := []bson.M{ // NOTE: slice of bson.M here\n  bson.M{\n    \"$match\": bson.M{\"data.id\": \"11111\"},\n  },\n  bson.M{\n    \"$project\": bson.M{\n      \"_id\": 0,\n      \"url\": bson.M{\n        \"$concat\": []string{ // NOTE: slice of strings here\n          \"https://www.someurl.com/\",\n          \"$data.aID\",\n        },\n      },\n      \"items\": bson.M{\n        \"$map\": bson.M{\n          \"input\": \"$data.items\",\n          \"as\":    \"it\",\n          \"in\":    bson.M{\"item_title\": \"$$it.title\", \"item_id\": \"$$it.id\"},\n        },\n      },\n    },\n  },\n}\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 10166198, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ct5Q0Yye3rM/AAAAAAAAAAI/AAAAAAAAAAw/Euee5XXC0VU/photo.jpg?sz=128", "display_name": "Vladimir Loct", "link": "https://stackoverflow.com/users/10166198/vladimir-loct"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 686, "favorite_count": 0, "closed_date": 1533656488, "accepted_answer_id": 51729635, "answer_count": 1, "score": -1, "last_activity_date": 1533717877, "creation_date": 1533646721, "last_edit_date": 1533717877, "question_id": 51727427, "link": "https://stackoverflow.com/questions/51727427/aggregate-query-in-golang", "closed_reason": "Needs more focus", "title": "Aggregate query in golang", "body": "<p>I need to write a query in golang with mgo, here's the query in the mongo:</p>\n\n<pre><code>db.some.aggregate([\n{$match: { \"data.id\": \"11111\" }},\n    {$project: { \n            _id : 0,\n            url : { $concat: [ \"https://www.someurl.com/\",\"$data.aID\" ]},\n       items :{\n       \"$map\":{\n                \"input\":\"$data.items\",\n                \"as\":\"it\",\n                \"in\":{\n                  \"item_title\":\"$$it.title\",                             \n                  \"item_id\":\"$$it.id\"\n               }}}}])\n</code></pre>\n\n<p>I will be grateful if you will help in this problem.</p>\n\n<p>// I apologize for the incorrectly posed question, in the future I will follow the instructions, my problem was with $concat</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1533646255, "post_id": 51727178, "comment_id": 90414745, "body": "You cannot. Sorry. No need to try, its undoable."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 8483706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f1d1de7fa0f16452fda044b09010d59?s=128&d=identicon&r=PG&f=1", "display_name": "aswinmprabhu", "link": "https://stackoverflow.com/users/8483706/aswinmprabhu"}, "edited": false, "score": 0, "creation_date": 1533647457, "post_id": 51727328, "comment_id": 90415611, "body": "ioutil.ReadAll actually return bytes, right? So this means that I will have to write similar functions for all types in go."}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 63, "user_id": 8483706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f1d1de7fa0f16452fda044b09010d59?s=128&d=identicon&r=PG&f=1", "display_name": "aswinmprabhu", "link": "https://stackoverflow.com/users/8483706/aswinmprabhu"}, "edited": false, "score": 0, "creation_date": 1533647601, "post_id": 51727328, "comment_id": 90415712, "body": "@aswinmprabhu <code>[]byte</code> indeed, updated the answer. Yes, until Go gets some generic types, you will have to duplicate it for every type you need."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 1, "creation_date": 1533648010, "post_id": 51727328, "comment_id": 90416034, "body": "Just as a statement of intent, I&#39;d also change the arguments to <code>(b []byte, _ error)</code>. The underscore makes it obvious that the error is going to be ignored"}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1533648047, "post_id": 51727328, "comment_id": 90416067, "body": "@EliasVanOotegem good point, will update."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1533653016, "post_id": 51727328, "comment_id": 90419800, "body": "I&#39;d be very, very wary of any program that suppresses so many errors that it needs a helper (or multiple helpers) to do it. That&#39;s just asking for trouble."}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533654800, "post_id": 51727328, "comment_id": 90420981, "body": "@Adrian valid point, though in testing code redundancy is often pain, also some functions like <code>json.Marshal</code> are not likely to return error, even though it&#39;s in the signature."}], "tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": false, "score": 0, "last_activity_date": 1533648073, "last_edit_date": 1533648073, "creation_date": 1533646444, "answer_id": 51727328, "question_id": 51727178, "link": "https://stackoverflow.com/questions/51727178/how-can-i-use-the-result-of-a-multi-value-returning-function-as-the-argument-of/51727328#51727328", "title": "How can I use the result of a multi-value returning function as the argument of another function in Golang if I don&#39;t need error handling?", "body": "<p>If you want it only once, it makes little sense in my opinion. However if this is a common situation and you feel that it improves code readability a lot, try something like:</p>\n\n<pre><code>// perhaps, there's a better name for this\nfunc resultToString(b []byte, _ error) string { \n    return string(b)\n}\n\n// and later:\nfmt.Println(resultToString(ioutil.ReadAll(res.Body)))\n</code></pre>\n\n<p>Unfortunately, that's a string-specific function, so for any other type you'll need to duplicate it.</p>\n"}], "owner": {"reputation": 63, "user_id": 8483706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f1d1de7fa0f16452fda044b09010d59?s=128&d=identicon&r=PG&f=1", "display_name": "aswinmprabhu", "link": "https://stackoverflow.com/users/8483706/aswinmprabhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "closed_date": 1533665542, "answer_count": 1, "score": -1, "last_activity_date": 1533648073, "creation_date": 1533645967, "question_id": 51727178, "link": "https://stackoverflow.com/questions/51727178/how-can-i-use-the-result-of-a-multi-value-returning-function-as-the-argument-of", "closed_reason": "Duplicate", "title": "How can I use the result of a multi-value returning function as the argument of another function in Golang if I don&#39;t need error handling?", "body": "<p>The following is what I want to achieve</p>\n\n<pre><code>fmt.Println(string(ioutil.ReadAll(res.Body)))\n</code></pre>\n\n<p>But this throws the following error.</p>\n\n<pre><code>multiple-value ioutil.ReadAll() in single-value context\n</code></pre>\n\n<p>I know that ioutil.ReadAll() returns the bytes and the error. But I don't want to write an extra line as follows</p>\n\n<pre><code>bytes, _ := ioutil.ReadAll(resp.Body)\n</code></pre>\n\n<p>Is it possible to just pass the result of ioutil.ReadAll() to fmt.Println() if don't care abut error handling in Go?</p>\n"}, {"tags": ["postgresql", "docker", "go", "docker-swarm"], "comments": [{"owner": {"reputation": 53, "user_id": 10148345, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P5kqHKeJt_8/AAAAAAAAAAI/AAAAAAAAABU/pMdNXJcX5HU/photo.jpg?sz=128", "display_name": "Iurii Popov", "link": "https://stackoverflow.com/users/10148345/iurii-popov"}, "edited": false, "score": 0, "creation_date": 1533714693, "post_id": 51726607, "comment_id": 90442621, "body": "It seems to be an idle timeout issue: <a href=\"https://success.docker.com/article/ipvs-connection-timeout-issue\" rel=\"nofollow noreferrer\">success.docker.com/article/ipvs-connection-timeout-issue</a>"}, {"owner": {"reputation": 53, "user_id": 10148345, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P5kqHKeJt_8/AAAAAAAAAAI/AAAAAAAAABU/pMdNXJcX5HU/photo.jpg?sz=128", "display_name": "Iurii Popov", "link": "https://stackoverflow.com/users/10148345/iurii-popov"}, "edited": false, "score": 0, "creation_date": 1534516254, "post_id": 51726607, "comment_id": 90746080, "body": "It is an open issue: <a href=\"https://github.com/moby/moby/issues/33685\" rel=\"nofollow noreferrer\">github.com/moby/moby/issues/33685</a>"}], "owner": {"reputation": 53, "user_id": 10148345, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-P5kqHKeJt_8/AAAAAAAAAAI/AAAAAAAAABU/pMdNXJcX5HU/photo.jpg?sz=128", "display_name": "Iurii Popov", "link": "https://stackoverflow.com/users/10148345/iurii-popov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 276, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1533712405, "creation_date": 1533644241, "last_edit_date": 1533712405, "question_id": 51726607, "link": "https://stackoverflow.com/questions/51726607/go-lang-service-and-postgresql-via-docker-ssh-tunnel", "title": "Go lang service and PostgreSQL via Docker ssh tunnel", "body": "<p>I have got a resources release problem.</p>\n\n<ol>\n<li>PostgreSQL runs on a server 1.</li>\n<li>Go lang service runs on a server 2 in a Docker container.</li>\n<li>There is an ssh tunnel Docker container for a connection between the database and the service. It does not know anything except ssh.</li>\n</ol>\n\n<p>Docker is in swarm mode.</p>\n\n<p>The service (2) connects to the database via golang database/sql library. I call <code>sql.Open()</code>, <code>driverName = \"postgres\"</code>. Then everything is ok. In some time, may be in 30 minutes, <code>(*DB) Query()</code> returns an error <code>read: connection reset by peer</code>. If I call <code>(*DB) Ping()</code> previously, <code>Ping()</code> does not return an error, but the next call <code>Query()</code> does.</p>\n\n<p>If I call <code>Query()</code> again in some time, a new connection is created. I can see it in a <code>select * from pg_stat_activity;</code> query in the database  (<code>state = idle</code>). But the previous connection has not been removed.</p>\n\n<p>So I call <code>(*DB) Close()</code>, create a new DB object and call <code>sql.Open()</code>.</p>\n\n<blockquote>\n  <p>Close closes the database, releasing any open resources.</p>\n</blockquote>\n\n<p>(<a href=\"https://golang.org/pkg/database/sql/#Conn.Close\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/#Conn.Close</a>)</p>\n\n<p>But after the <code>Close</code> call I can still see the connection in a <code>select * from pg_stat_activity;</code> query in the database (<code>state = idle</code>).\nI see the bad connection and the new one.</p>\n\n<p>As the result there is a resources leak.</p>\n\n<p>What is the correct way to handle a <code>read: connection reset by peer</code> error? Why have I got this error?</p>\n"}, {"tags": ["sorting", "go", "interface"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1533641523, "post_id": 51725601, "comment_id": 90411667, "body": "<a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Method_sets</a>: &quot;The method set of the corresponding pointer type *T is the set of all methods declared with receiver *T or T (that is, it also contains the method set of T).&quot; So *reverse has also the methods of reverse."}, {"owner": {"reputation": 5043, "user_id": 474772, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/543126f859fa173bba7ad18b636ef59d?s=128&d=identicon&r=PG", "display_name": "Mariy", "link": "https://stackoverflow.com/users/474772/mariy"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1533642784, "post_id": 51725601, "comment_id": 90412471, "body": "Aha, I got it. I thought that *T and T always have non-overlapping method sets. If you expand this comment to an answer I will accept it. Thanks!"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1533643349, "post_id": 51725601, "comment_id": 90412826, "body": "@Marii no *T and T are different types of receivers. you cannot pass two methods with same name having T or *T type. It will show an error. Please check this link <a href=\"https://play.golang.org/p/VxRtiPhslun\" rel=\"nofollow noreferrer\">play.golang.org/p/VxRtiPhslun</a>"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1533645653, "post_id": 51725601, "comment_id": 90414361, "body": "This is a very good question. I hope there will be more upvotes. For a complete answer I recommend the chapter about embedding from effective go: <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#embedding</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": -2, "last_activity_date": 1533653846, "last_edit_date": 1533653846, "creation_date": 1533641296, "answer_id": 51725677, "question_id": 51725601, "link": "https://stackoverflow.com/questions/51725601/sort-reverse-in-go/51725677#51725677", "title": "sort.Reverse in Go", "body": "<p>For your comment:</p>\n\n<blockquote>\n  <p>As far as I understand reverse implements Interface (and overrides\n  Less)</p>\n</blockquote>\n\n<p>There is no method overriding in Golang. It is not overriding <code>Less</code>. It is implementing <code>Less</code> of <code>Interface</code> which is an <code>interface</code> type:</p>\n\n<pre><code>type Interface interface {\n        // Len is the number of elements in the collection.\n        Len() int\n        // Less reports whether the element with\n        // index i should sort before the element with index j.\n        Less(i, j int) bool\n        // Swap swaps the elements with indexes i and j.\n        Swap(i, j int)\n}\n</code></pre>\n\n<p>For the question asked:</p>\n\n<blockquote>\n  <p>Why does Reverse return *reverse (which somehow is Interface)</p>\n</blockquote>\n\n<p>Because to change the order of the data it should be an address of the reverse struct. That's why it is <code>*reverse</code>. Now you can pass any type implementing <code>Interface</code> interface. And for implementing the <code>Interface</code> you should implement all the methods defined inside <code>Interface</code>.</p>\n\n<pre><code>type IntSlice []int\n\nfunc (p IntSlice) Len() int           { return len(p) }\nfunc (p IntSlice) Less(i, j int) bool { return p[i] &lt; p[j] }\nfunc (p IntSlice) Swap(i, j int)      { p[i], p[j] = p[j], p[i] }\n</code></pre>\n\n<p>In above case you can see that <code>IntSlice</code> implements the <code>Interface</code>. Hence you can pass the <code>Intslice</code> as an argument to Reverse. </p>\n\n<p>As an example you can also implement using <code>Float</code> values as:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\nfunc main() {\n    //s := []int{5, 2, 6, 3, 1, 4} // unsorted\n    s1 := []float64{5.2, 2.6, .6, .03, 2.1 } // unsorted\n    sort.Sort(sort.Reverse(sort.Float64Slice(s1)))\n    fmt.Println(s1)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/JDd8GJ2GWLQ\" rel=\"nofollow noreferrer\">Playground example</a></p>\n"}], "owner": {"reputation": 5043, "user_id": 474772, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/543126f859fa173bba7ad18b636ef59d?s=128&d=identicon&r=PG", "display_name": "Mariy", "link": "https://stackoverflow.com/users/474772/mariy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 794, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1533653846, "creation_date": 1533641036, "question_id": 51725601, "link": "https://stackoverflow.com/questions/51725601/sort-reverse-in-go", "title": "sort.Reverse in Go", "body": "<p>I'm looking at the <code>sort.Reverse</code> code:</p>\n\n<pre><code>type reverse struct {\n    // This embedded Interface permits Reverse to use the methods of\n    // another Interface implementation.\n    Interface\n}\n\n// Less returns the opposite of the embedded implementation's Less method.\nfunc (r reverse) Less(i, j int) bool {\n    return r.Interface.Less(j, i)\n}\n\n// Reverse returns the reverse order for data.\nfunc Reverse(data Interface) Interface {\n    return &amp;reverse{data}\n}\n</code></pre>\n\n<p>As far as I understand <code>reverse</code> implements <code>Interface</code> (and overrides <code>Less</code>) and <code>*reverse</code> does not implement <code>Interface</code>. Why does <code>Reverse</code> return <code>*reverse</code> (which somehow is <code>Interface</code>)?</p>\n"}, {"tags": ["unit-testing", "http", "go", "stub"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533647774, "post_id": 51724299, "comment_id": 90415840, "body": "There&#39;s no reason to stub it, just use <code>context.WithValue</code> to add the value to a real context."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1533637156, "creation_date": 1533637156, "answer_id": 51724354, "question_id": 51724299, "link": "https://stackoverflow.com/questions/51724299/httptest-newrequest-set-context-stub/51724354#51724354", "title": "httptest.NewRequest set Context stub", "body": "<p>You have the <code>request</code>, you can do whatever you want to with it before you pass it along.</p>\n\n<p>Use <a href=\"https://golang.org/pkg/net/http/#Request.Context\" rel=\"noreferrer\"><code>Request.Context()</code></a> to access its context, use <a href=\"https://golang.org/pkg/context/#WithValue\" rel=\"noreferrer\"><code>context.WithValue()</code></a> to derive a new <a href=\"https://golang.org/pkg/context/#Context\" rel=\"noreferrer\"><code>context.Context</code></a> with your key-value in it, and use <a href=\"https://golang.org/pkg/net/http/#Request.WithContext\" rel=\"noreferrer\"><code>Request.WithContext()</code></a> to acquire a new <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"noreferrer\"><code>http.Request</code></a> with the new context:</p>\n\n<pre><code>request := httptest.NewRequest(\"GET\", \"http://example.com/foo\", nil)\nctx := request.Context()\nctx = context.WithValue(ctx, \"request-uuid\", \"myvalue\")\nrequest = request.WithContext(ctx)\n\n// now request's context contains the \"request-uuid\" key\n</code></pre>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 699, "favorite_count": 1, "accepted_answer_id": 51724354, "answer_count": 1, "score": 2, "last_activity_date": 1533637156, "creation_date": 1533636946, "question_id": 51724299, "link": "https://stackoverflow.com/questions/51724299/httptest-newrequest-set-context-stub", "title": "httptest.NewRequest set Context stub", "body": "<p>I am creating a request stub in order to pass it to function under the tested: </p>\n\n<pre><code>request := httptest.NewRequest(\"GET\", \"http://example.com/foo\", nil)\n</code></pre>\n\n<p><strong>Question</strong>: can I also stub <code>Context</code> object for this request by adding <code>request-uuid</code> Value to it?</p>\n"}, {"tags": ["string", "performance", "function", "go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1533636729, "post_id": 51724151, "comment_id": 90408673, "body": "dont convert it to string, keep a byte slice instead, all functions are available <a href=\"https://golang.org/pkg/bytes/\" rel=\"nofollow noreferrer\">golang.org/pkg/bytes</a>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1533637234, "post_id": 51724151, "comment_id": 90409004, "body": "What you are doing is converting the bytes to string and then working on the string to get the value is totally unnecessary."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1533639592, "post_id": 51724151, "comment_id": 90410470, "body": "Write a benchmark and use pprof to find what is slow."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1533645146, "post_id": 51724151, "comment_id": 90414003, "body": "Where does your string come from? File or http request? Maybe it would be better to use an io.Reader as input and not a string. Then you could parse the data with a bufio.Scanner"}, {"owner": {"reputation": 81, "user_id": 10150930, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgBBkpUW710/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7puoa8L7t1UYQZjYTO4431xkK3NpA/mo/photo.jpg?sz=128", "display_name": "bed", "link": "https://stackoverflow.com/users/10150930/bed"}, "edited": false, "score": 1, "creation_date": 1533645547, "post_id": 51724151, "comment_id": 90414290, "body": "the string comes from a http request, but the response is encrypted. It is read by ioutil.ReadAll and then decrypted with a decrypt function created by me and the result of all is the []byte in input in Datadecrypt()."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1533647969, "post_id": 51724151, "comment_id": 90416003, "body": "As @Volker notes, you&#39;ll have to measure to find out what&#39;s slow, try optimizing, and measure to see if it&#39;s faster. That is the way to optimize code. Keep in mind though that encryption/decryption of large ciphertexts is going to take time no matter what (that&#39;s the point of encryption in a way), so there will be definite limits to how fast this can run."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1533652913, "post_id": 51724151, "comment_id": 90419728, "body": "you can also perform stream decoding <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Decode\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Decoder.Decode</a>. It also exists libraries that are implemented with more efficient resulting algorithm for json decoding <a href=\"https://github.com/mailru/easyjson\" rel=\"nofollow noreferrer\">github.com/mailru/easyjson</a>"}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 10150930, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgBBkpUW710/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7puoa8L7t1UYQZjYTO4431xkK3NpA/mo/photo.jpg?sz=128", "display_name": "bed", "link": "https://stackoverflow.com/users/10150930/bed"}, "edited": false, "score": 1, "creation_date": 1533648466, "post_id": 51727498, "comment_id": 90416411, "body": "thanks for the reply, but I think you did not understand my goal. I would like what you printed as a string to end up in the Data struct, so without considering the count, I would like the part that is printed after Result to be transformed into map[string]string."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 81, "user_id": 10150930, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgBBkpUW710/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7puoa8L7t1UYQZjYTO4431xkK3NpA/mo/photo.jpg?sz=128", "display_name": "bed", "link": "https://stackoverflow.com/users/10150930/bed"}, "edited": false, "score": 1, "creation_date": 1533649038, "post_id": 51727498, "comment_id": 90416863, "body": "@bed It will not directly parse into <code>map[string]string</code> you should convert the string back to json and unmarshal the data."}, {"owner": {"reputation": 81, "user_id": 10150930, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgBBkpUW710/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7puoa8L7t1UYQZjYTO4431xkK3NpA/mo/photo.jpg?sz=128", "display_name": "bed", "link": "https://stackoverflow.com/users/10150930/bed"}, "edited": false, "score": 0, "creation_date": 1533650400, "post_id": 51727498, "comment_id": 90417879, "body": "I tried like this: <code>split := strings.Split(vals, &quot;\\&quot;&quot;)[1]      splitend := strings.Split(split, &quot;\\&quot;&quot;)[0]      var ciao []map[string]string      json.Unmarshal([]byte(splitend), &amp;ciao)       result := jsonmerge.Data{Count: count, Results: ciao}</code>  but not work, i have the string, but the map is not filled...  could you give me an example of what you said?"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1533670756, "post_id": 51727498, "comment_id": 90429232, "body": "I think split is not a good idea, because that causes the performance issues. You should range over each character of your string. I still think that you are doing here too much work, because the bug is before your function. Because what you are doing here is to parse something which is not correct."}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 0, "last_activity_date": 1533646887, "creation_date": 1533646887, "answer_id": 51727498, "question_id": 51724151, "link": "https://stackoverflow.com/questions/51724151/from-string-to-struct-golang/51727498#51727498", "title": "From String to Struct Golang", "body": "<p>This is not a answer to your question, but maybe a solution to your problem. Just leave a comment if I am totaly wrong.</p>\n\n<p>The input string looks like it is generated via <code>fmt.Printf()</code></p>\n\n<pre><code>\"Count=\\\"%!s(int=107)\\\"\\nResults=\\\"[map[MATRICOLA:2 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:7 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:5 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:6 NOMEmy:value COGNOMEmy:value]]\\\"\\n\"\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/pRWUtRKikEh\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pRWUtRKikEh</a></p>\n\n<pre><code>    count := 107\n    results := \"[map[MATRICOLA:2 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:7 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:5 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:6 NOMEmy:value COGNOMEmy:value]]\"\n\n    fmt.Printf(\"Count=%s\\nResults=%s\", count, results)\n</code></pre>\n\n<p>So if you would be able to change the print statement to <code>fmt.Printf(\"Count=%d\\nResults=%s\", count, results)</code> the output would be correct.\n<a href=\"https://play.golang.org/p/g45_TiHMFsG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/g45_TiHMFsG</a></p>\n"}], "owner": {"reputation": 81, "user_id": 10150930, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgBBkpUW710/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7puoa8L7t1UYQZjYTO4431xkK3NpA/mo/photo.jpg?sz=128", "display_name": "bed", "link": "https://stackoverflow.com/users/10150930/bed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 154, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1533646887, "creation_date": 1533636482, "last_edit_date": 1533638115, "question_id": 51724151, "link": "https://stackoverflow.com/questions/51724151/from-string-to-struct-golang", "title": "From String to Struct Golang", "body": "<p>I created a function to transform a particular string (derived from [] bytes) into a struct. In the program I am building an encryption and a decryption are carried out and between these two passages the data are transferred via JSON. The function that I propose works, but at the time when the string becomes very long, processing times are very long.\nWhat I would like to ask is if anyone has any idea how to speed up this function or how to manage the situation better.</p>\n\n<p>this is the function</p>\n\n<pre><code>func Datadecrypt(input []byte) Data {\n\n    s := string(input)\n\n    vals := strings.Replace(s,\"  \",\" \",-1)\n\n    part := strings.Fields(vals)\n\n    c := strings.Split(s, \"int=\")[1]\n    co := strings.Split(c, \")\")[0]\n\n    count, err := strconv.Atoi(co)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    var stringa string\n\n    for j := 0; j&lt;len(part); j++ {\n        if strings.ContainsAny(part[j], \":\") {\n            stringa = stringa+\" \"+part[j]\n        } else {\n            stringa = stringa+\",\"+part[j]\n        }\n    }\n\n    var interpart []map[string]string\n    var result Data\n\n    var i = 0\n\n    for {\n\n        split := strings.Split(stringa, \"[\")[2+i]\n\n        splitend := strings.Split(split, \"]\")[0]\n\n        control := strings.Replace(splitend,\"  \",\" \",-1)\n\n        mapst := mapstring.StrToMS(control)\n\n        interpart = append(interpart, mapst)\n\n        i++\n\n        if i &gt;= count {\n            break\n        }\n    }\n\n    result = Data{Count: count, Results: interpart}\n\n    return result\n}\n</code></pre>\n\n<p>this is the struct</p>\n\n<pre><code>type Data struct {\n    Count int `json:\"count\"`\n    Results []map[string]string `json:\"result\"`\n}\n</code></pre>\n\n<p>this is the string that derives from s: = string (input)</p>\n\n<pre><code>\"Count=\\\"%!s(int=107)\\\"\\nResults=\\\"[map[MATRICOLA:2 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:7 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:5 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:6 NOMEmy:value COGNOMEmy:value]]\\\"\\n\"\n</code></pre>\n\n<p>The string I wrote above is printed using JSON response</p>\n\n<p>This is the input string NOT JSON</p>\n\n<pre><code>Count=\"%!s(int=107)\"\nResults=\"[map[MATRICOLA:2 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:7 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:5 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:6 NOMEmy:value COGNOMEmy:value]]\"\n</code></pre>\n\n<p>this is the result I get through the function</p>\n\n<pre><code>{107 map[MATRICOLA:2 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:7 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:5 NOMEmy:value COGNOMEmy:value] map[MATRICOLA:6 NOMEmy:value COGNOMEmy:value]]}\n</code></pre>\n\n<p>Thanks, in advance</p>\n"}, {"tags": ["docker", "go", "makefile", "moby"], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 0, "last_activity_date": 1533635654, "creation_date": 1533635654, "answer_id": 51723886, "question_id": 51723041, "link": "https://stackoverflow.com/questions/51723041/tag-1-10-3-as-base-not-found-in-repository-docker-io-library-golang/51723886#51723886", "title": "Tag 1.10.3 AS base not found in repository docker.io/library/golang", "body": "<blockquote>\n  <p>Multi-stage builds are a new feature requiring Docker 17.05 or higher on the daemon and client.</p>\n</blockquote>\n\n<p><a href=\"https://docs.docker.com/develop/develop-images/multistage-build/\" rel=\"nofollow noreferrer\">https://docs.docker.com/develop/develop-images/multistage-build/</a></p>\n\n<p>Your (ancient) Docker version doesn't support multi-stage builds. You can update Docker, build everything in one stage, or use the builder pattern described in the article linked above.</p>\n"}], "owner": {"reputation": 97, "user_id": 8645601, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/92BVV.jpg?s=128&g=1", "display_name": "user8645601", "link": "https://stackoverflow.com/users/8645601/user8645601"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 51723886, "answer_count": 1, "score": 0, "last_activity_date": 1533635654, "creation_date": 1533633132, "question_id": 51723041, "link": "https://stackoverflow.com/questions/51723041/tag-1-10-3-as-base-not-found-in-repository-docker-io-library-golang", "title": "Tag 1.10.3 AS base not found in repository docker.io/library/golang", "body": "<p>when i try to compile moby (the latest version 2018.08.07), the outcome like this:</p>\n\n<pre><code>docker build   -t \"docker-dev:master\" -f \"Dockerfile\" .\nSending build context to Docker daemon 43.28 MB\nStep 1 : FROM golang:1.10.3 AS base\nPulling repository docker.io/library/golang\nTag 1.10.3 AS base not found in repository docker.io/library/golang\nmake: *** [build] Error 1\n</code></pre>\n\n<p>my host machine is : centos 6</p>\n\n<pre><code>Linux li1202-249.members.linode.com 4.15.13-x86_64-linode106 #1 SMP Tue Mar 27 14:42:14 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\n</code></pre>\n\n<p>my docker version is:</p>\n\n<pre><code>[root@li1202-249 ~]# docker version\nClient:\nVersion:      1.9.1\nAPI version:  1.21\nGo version:   go1.4.3\nGit commit:   a34a1d5\nBuilt:        Fri Nov 20 17:56:04 UTC 2015\nOS/Arch:      linux/amd64\n</code></pre>\n\n<p>Server:\n   Version:      1.9.1\n   API version:  1.21\n   Go version:   go1.4.3\n   Git commit:   a34a1d5\n   Built:        Fri Nov 20 17:56:04 UTC 2015\n   OS/Arch:      linux/amd64</p>\n\n<p>what's the wrong configuration i had set?</p>\n"}, {"tags": ["go", "glide-golang"], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 11433451, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bbhEt.jpg?s=128&g=1", "display_name": "Dave Hay", "link": "https://stackoverflow.com/users/11433451/dave-hay"}, "is_accepted": false, "score": 1, "last_activity_date": 1556648463, "creation_date": 1556648463, "answer_id": 55926714, "question_id": 51722970, "link": "https://stackoverflow.com/questions/51722970/glide-update-cannot-detect-vcs/55926714#55926714", "title": "Glide update Cannot detect VCS", "body": "<p>I saw something similar using <code>glide update</code> using Glide 0.13.2, and Go versions 1.10.6 and 1.11.5.</p>\n\n<p>Using the more detailed <code>glide --debug update</code>, I found a wee bit more detail: -</p>\n\n<pre><code>[DEBUG] ImportDir error on /Users/hayd/.glide/cache/src/https-crypto-tls: cannot find package \".\" in:\n    /Users/hayd/.glide/cache/src/https-crypto-tls\n\n</code></pre>\n\n<p><em>BUT</em> this did lead me to look at my Git source folder -  <code>$GOPATH/src</code> - which, amongst other things had this: -</p>\n\n<pre><code>drwxr-xr-x   3 hayd  staff   96 29 Mar 19:31 crypto\n</code></pre>\n\n<p>which was a directory containing a sinmgle empty subdirectory: -</p>\n\n<pre><code>drwxr-xr-x  2 hayd  staff   64 29 Mar 19:33 tls\n</code></pre>\n\n<p>So this kinda tied up with the symptom shown up in the <code>--debug</code> trace i.e. <code>cannot find package \".\"</code> even though it was in a completely different place.</p>\n\n<p>Once I did <code>rm -Rf $GOPATH/src/crypto</code>, the <code>glide update</code> worked a treat.</p>\n\n<p>I'd previously gone down a rabbit hole with <code>glide clear-cache</code> and <code>glide mirror</code>, both of which were poisson rouge.</p>\n\n<p>Hope this helps others in the same situation :-)</p>\n"}, {"tags": [], "owner": {"reputation": 142, "user_id": 6473840, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80dc27dc27b90036cf472be823fb133f?s=128&d=identicon&r=PG", "display_name": "M3nd3z", "link": "https://stackoverflow.com/users/6473840/m3nd3z"}, "is_accepted": false, "score": 0, "last_activity_date": 1580422255, "creation_date": 1580422255, "answer_id": 59995273, "question_id": 51722970, "link": "https://stackoverflow.com/questions/51722970/glide-update-cannot-detect-vcs/59995273#59995273", "title": "Glide update Cannot detect VCS", "body": "<p>I experienced this issue when I had a dependency with the <code>https://</code> at the start. I simply removed that so it looked like <code>github.com/dependency</code> and it resolved the issue.</p>\n"}], "owner": {"reputation": 2719, "user_id": 4177876, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/i7xAG.jpg?s=128&g=1", "display_name": "Seenu S", "link": "https://stackoverflow.com/users/4177876/seenu-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1507, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1580422255, "creation_date": 1533632914, "last_edit_date": 1592644375, "question_id": 51722970, "link": "https://stackoverflow.com/questions/51722970/glide-update-cannot-detect-vcs", "title": "Glide update Cannot detect VCS", "body": "<p>Trying to set up the go project using <code>Glide</code>. I have been finding the error <code>Cannot detect VCS</code> when I ran the command <code>glide up -v</code>.</p>\n<h1>Errors:</h1>\n<pre><code>[ERROR] Error looking for project/base: Cannot detect VCS\n[INFO]  --&gt; Fetching project/form\n[WARN]  Unable to checkout project/form\n[ERROR] Error looking for project/form: Cannot detect VCS\n[INFO]  --&gt; Fetching project/api\n[WARN]  Unable to checkout project/api\n[ERROR] Error looking for project/api/request: Cannot detect VCS\n[INFO]  --&gt; Fetching updates for github.com/go-openapi/analysis\n</code></pre>\n"}, {"tags": ["go", "mutex", "deferred"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 7, "creation_date": 1533631730, "post_id": 51722360, "comment_id": 90405538, "body": "It <i>looks</i> strange but it <i>is</i> fine. Longe time ago someone claimed that your defering first is faster (not sure if still -- or at all -- true). I think it is inferior because it violates a common linear reading of the code. Lock tan defer is &quot;Lets get the lock and one we have the lock: Don&#39;t foget to unlock it&quot;. The reversed version is &quot;Don&#39;t forget to unlock the lock I&#39;m going to lock next&quot;."}, {"owner": {"reputation": 98839, "user_id": 3848, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W10YY.jpg?s=128&g=1", "display_name": "Motti", "link": "https://stackoverflow.com/users/3848/motti"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1533632681, "post_id": 51722360, "comment_id": 90406131, "body": "Thanks @Volker, please consider adding this as an answer."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1533633783, "post_id": 51722360, "comment_id": 90406808, "body": "While @Volker is correct, I think that it&#39;s an anti-pattern. The reason is simple: you typically use <code>defer</code> to undo an operation which <i>was already done.</i> This is plain simple logic, after all. So while deferring unlocking of what is not yet locked is fine techincally, it&#39;s not so fine logically, and here we arrive at that principle that \u201cPrograms must be written for people to read, and only incidentally for machines to execute.\u201d"}], "answers": [{"comments": [{"owner": {"reputation": 98839, "user_id": 3848, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W10YY.jpg?s=128&g=1", "display_name": "Motti", "link": "https://stackoverflow.com/users/3848/motti"}, "edited": false, "score": 0, "creation_date": 1533715626, "post_id": 51725166, "comment_id": 90443122, "body": "So there&#39;s no chance that the <code>Lock</code> will be interrupted by a <code>panic</code> somehow? (I&#39;m pretty new to <a href=\"https://stackoverflow.com/questions/tagged/go\">go</a> and in other languages a thread may get an exception for multiple reasons)."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 98839, "user_id": 3848, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W10YY.jpg?s=128&g=1", "display_name": "Motti", "link": "https://stackoverflow.com/users/3848/motti"}, "edited": false, "score": 0, "creation_date": 1533715813, "post_id": 51725166, "comment_id": 90443217, "body": "@Motti: First off, the actual acquiring of a lock is, by definition, an atomic operation. Secondly in go, routines aren&#39;t exactly threads, and panics aren&#39;t exceptions. Panics generally cause your application to crash anyway. An uncaught panic would mean the lock is or is not obtained, and if it&#39;s obtained it might not be released. But who cares, the runtime is going to terminate everything anyway. I wouldn&#39;t worry about that at all"}], "tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": true, "score": 4, "last_activity_date": 1533660635, "last_edit_date": 1533660635, "creation_date": 1533639620, "answer_id": 51725166, "question_id": 51722360, "link": "https://stackoverflow.com/questions/51722360/is-it-ok-to-defer-an-unlock-before-a-lock/51725166#51725166", "title": "Is it OK to defer an Unlock before a Lock", "body": "<p>Short answer:</p>\n\n<p>Yes, it's OK. The <code>defer</code> call is made after the function returns (well, sort of).</p>\n\n<p>The longer, more nuanced answer:</p>\n\n<p>It's risky, and should be avoided. In your 2 line snippet, it's not going to be a problem, but consider the following code:</p>\n\n<pre><code>func (o *Obj) foo() error {\n    defer o.mu.Unlock()\n    if err := o.CheckSomething(); err != nil {\n        return err\n    }\n    o.mu.Lock()\n    // do stuff\n}\n</code></pre>\n\n<p>In this case, the mutex may not be locked at all, or worse still: it may be locked on another routine, and you end up unlocking it. Meanwhile yet another routine obtains a lock that it really shouldn't have, and you either get data races, or by the time that routine returns, the unlock call will panic.\nDebugging this kind of mess is a nightmare you can, and should avoid at all cost.</p>\n\n<p>In addition to the code looking intuitive and being more error prone, depending on what you're trying to achieve, a <code>defer</code> does come at a cost. In most cases the cost is fairly marginal, but if you're dealing with something that is absolutely time critical, it's often better to manually add the unlock calls where needed. A good example where I'd not use defer is if you're caching stuff in a <code>map[string]interface{}</code>: I'd create a struct with the cached values and an <code>sync.RWMutext</code> field for concurrent use. If I use this cache a lot, the defer calls could start adding up. It can look a bit messy, but it's on a case by case basis. Either performance is what you aim for, or shorter, more readable code.</p>\n\n<p>Other things to note about defers:</p>\n\n<ul>\n<li>if you have multiple defers in a function, the order in which they are invoked is defined (LIFO).</li>\n<li>Defers can alter the return values of the function you end up calling (if you use named returns)</li>\n</ul>\n"}], "owner": {"reputation": 98839, "user_id": 3848, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W10YY.jpg?s=128&g=1", "display_name": "Motti", "link": "https://stackoverflow.com/users/3848/motti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1144, "favorite_count": 0, "accepted_answer_id": 51725166, "answer_count": 1, "score": 6, "last_activity_date": 1533660635, "creation_date": 1533630956, "last_edit_date": 1533631772, "question_id": 51722360, "link": "https://stackoverflow.com/questions/51722360/is-it-ok-to-defer-an-unlock-before-a-lock", "title": "Is it OK to defer an Unlock before a Lock", "body": "<p>I'm going over some existing code and see this repeated several times</p>\n\n<pre><code>defer mtx.Unlock()\nmtx.Lock()\n</code></pre>\n\n<p>This looks wrong to me, I much prefer the idiomatic way of deferring the <code>Unlock</code> after performing the <code>Lock</code> but the documentation for <a href=\"https://golang.org/pkg/sync/#Mutex.Lock\" rel=\"noreferrer\"><code>Mutex.Lock</code></a> doesn't specify a situation where the <code>Lock</code> will fail. Therefor the behaviour of the <em>early <code>defer</code></em> pattern should be identical to the idiomatic way.</p>\n\n<p>My question is: is there a compelling case to say this pattern is inferior? (e.g. the <code>Lock</code> may fail and then the deferred <code>Unlock</code> will <code>panic</code>) and thus the code should be changed or should I leave it as is?</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1533629988, "post_id": 51720882, "comment_id": 90404485, "body": "No, no thread local nonsense in Go, forget that now and forever. You have to pass the request-id down your callstack. Either through context or explicit arguments or somehow other (e.g. your own HTTP header)."}, {"owner": {"reputation": 103, "user_id": 9394544, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Shanmugam Sundaram", "link": "https://stackoverflow.com/users/9394544/shanmugam-sundaram"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1533634690, "post_id": 51720882, "comment_id": 90407437, "body": "@Volker thank you."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1533639272, "post_id": 51720882, "comment_id": 90410279, "body": "@ShanmugamSundaram check how <a href=\"https://violetear.org/post/requestid/\" rel=\"nofollow noreferrer\">violetear.org/post/requestid</a> is implemented, probably can give you an idea <a href=\"https://violetear.org/post/structured-logging/\" rel=\"nofollow noreferrer\">violetear.org/post/structured-logging</a> about how to create/use a custom logger"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 8, "last_activity_date": 1533630296, "creation_date": 1533630296, "answer_id": 51722160, "question_id": 51720882, "link": "https://stackoverflow.com/questions/51720882/golang-requestid-logging/51722160#51722160", "title": "Golang requestId logging", "body": "<p>Go deliberately does not support the equivalent of thread locals, as they often get abused and used incorrectly. A code should not depend on which goroutine executes it. It would also limit a function from launching further goroutines (or it would complicate things to also setup goroutine-specific context).</p>\n\n<p>Instead if your functions need extra info (such as a logger), you have to pass the extra info them explicitly.</p>\n\n<p>Of course a function may need many extra info, and the things needed may change or \"grow\" over time, so best is to create a wrapper for such extra info, and pass this single extra wrapper value. Should you need another info (e.g. a logged in user ID or a database connection or anything else), you may simply add that to the wrapper, and you don't have to change any signatures.</p>\n\n<p>Whether this wrapper is a parameter, or you make your functions methods of the wrapper (and thus the wrapper will be the receiver) is entirely up to you and is only an implementation detail.</p>\n\n<p>See related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/51015548/why-does-a-goroutine-have-no-identity\">Why does a goroutine have no identity</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/31932945/does-go-have-something-like-threadlocal-from-java\">Does Go have something like ThreadLocal from Java?</a></p>\n"}], "owner": {"reputation": 103, "user_id": 9394544, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Shanmugam Sundaram", "link": "https://stackoverflow.com/users/9394544/shanmugam-sundaram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2449, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1533630296, "creation_date": 1533625887, "question_id": 51720882, "link": "https://stackoverflow.com/questions/51720882/golang-requestid-logging", "title": "Golang requestId logging", "body": "<p>I am writing a web application using golang. I am new to this language.  I am trying to find what is the best way followed to log requestid in golang webapp.\nI have decided to use either go's log library (<a href=\"https://golang.org/pkg/log/\" rel=\"noreferrer\">https://golang.org/pkg/log/</a>) or logrus (<a href=\"https://github.com/sirupsen/logrus\" rel=\"noreferrer\">https://github.com/sirupsen/logrus</a>). It looks to me both of these does not provide anything related to requestId logging.\nSo for generating requestId and using it through out the api's flow I have arrived to following approach for now</p>\n\n<p>Use any one of the uid generation library listed here(<a href=\"https://golanglibs.com/search?q=id+generator&amp;sort=top\" rel=\"noreferrer\">https://golanglibs.com/search?q=id+generator&amp;sort=top</a>) to generate requestid.\nAnd set it in the context(<a href=\"https://golang.org/pkg/context/\" rel=\"noreferrer\">https://golang.org/pkg/context/</a>) at the start of processing the request by using http.Handler wrapper . And use this context in all the places wherever I want to log.</p>\n\n<p>But to achieve this I need to pass the context object to all the functions where I need to log something. It does not sound good to me since I am touching all the function's prototype(i.e.adding context param).\nIs there any better way to do this? Something like ThreadLocal object. And it can be accessed from anywhere within the thread and using which we can get the request id wherever we need?</p>\n"}, {"tags": ["go", "amazon-ec2", "deployment"], "answers": [{"tags": [], "owner": {"reputation": 291, "user_id": 8682336, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-kl_8cldQJU8/AAAAAAAAAAI/AAAAAAAAB2M/x2CIyLdAbu0/photo.jpg?sz=128", "display_name": "Nguyen Dang Minh", "link": "https://stackoverflow.com/users/8682336/nguyen-dang-minh"}, "is_accepted": true, "score": 11, "last_activity_date": 1533616574, "creation_date": 1533616574, "answer_id": 51718890, "question_id": 51718659, "link": "https://stackoverflow.com/questions/51718659/how-to-deploy-a-go-program-on-amazon-ec2-without-compiling-it-on-ec2/51718890#51718890", "title": "How to deploy a Go program on amazon ec2 without compiling it on ec2?", "body": "<p>You are right. One of the selling points of Go is cross-compiling into a single binary file. It's better to compile at localhost then copy it to your server.</p>\n\n<pre><code>$ GOOS=linux GOARCH=amd64 go build -o my_app .\n$ scp my_app ec2@ip:~\n</code></pre>\n"}], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 629, "favorite_count": 0, "accepted_answer_id": 51718890, "answer_count": 1, "score": 1, "last_activity_date": 1533616574, "creation_date": 1533614657, "question_id": 51718659, "link": "https://stackoverflow.com/questions/51718659/how-to-deploy-a-go-program-on-amazon-ec2-without-compiling-it-on-ec2", "title": "How to deploy a Go program on amazon ec2 without compiling it on ec2?", "body": "<p>I am looking for a way to deploy the go binary on amazon ec2. Currently all the tutorials I have found (<a href=\"http://www.blog.labouardy.com/deploying-go-app-to-aws-ec2/\" rel=\"nofollow noreferrer\">1</a>, <a href=\"https://medium.com/@nathanborror/deploying-a-go-project-on-ec2-15ce381cf7a1\" rel=\"nofollow noreferrer\">2</a>) are explaining how to move the go sources on ec2 and to compile them there.</p>\n\n<p>This is not what I am looking for for a couple of reasons. Among them:</p>\n\n<ul>\n<li>I do not want to copy all the sources </li>\n<li>I do not want to install irrelevant binaries (go compiler and other things)</li>\n</ul>\n\n<p>In my opinion this is unnecessary because go has an ability to <a href=\"https://github.com/golang/go/wiki/WindowsCrossCompiling\" rel=\"nofollow noreferrer\">cross-compile binaries</a>. I think that is is better to build a binary locally and to upload it on ec2.</p>\n\n<p>Am I missing something here, are there any hidden pitfalls with my approach or is there a better way?</p>\n\n<p>P.S. if this question is better suited for serverfault, please let me know or move it there.</p>\n"}, {"tags": ["go", "google-cloud-pubsub"], "comments": [{"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1533614142, "post_id": 51717626, "comment_id": 90398012, "body": "Re: &quot;I thought that once the channel get full, it should block until the channel is emptied out&quot;...  almost.  Once a channel is full a send operation will block until the channel is not full -- doesn&#39;t have to be empty.  So what are you seeing, <code>rcv: 100</code> and it gets stuck?  Does the program exit?  Have you put a print statement as the first line in the <code>writeInflux</code> function and confirmed it never gets called?  Btw it doesn&#39;t look like <code>err</code> is updated before being checked after the <code>pullMsgs</code> call."}, {"owner": {"reputation": 2732, "user_id": 2061886, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/dkfiz.jpg?s=128&g=1", "display_name": "lightweight", "link": "https://stackoverflow.com/users/2061886/lightweight"}, "reply_to_user": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1533616835, "post_id": 51717626, "comment_id": 90398647, "body": "@jrefior, naw, the program doesn&#39;t exit...it keeps going as the the message count keeps going up <code>rcv: n</code>...looking at the google docs a bit more (<a href=\"https://cloud.google.com/pubsub/docs/pull\" rel=\"nofollow noreferrer\">cloud.google.com/pubsub/docs/pull</a>), it looks like the subscriber itself is non-block but i&#39;m not sure how to really handle that then?"}], "answers": [{"comments": [{"owner": {"reputation": 2732, "user_id": 2061886, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/dkfiz.jpg?s=128&g=1", "display_name": "lightweight", "link": "https://stackoverflow.com/users/2061886/lightweight"}, "edited": false, "score": 0, "creation_date": 1533659360, "post_id": 51726367, "comment_id": 90423764, "body": "so what do I do if I just want to program just run for ever as messages get put into pubsub..I tried to remove <code>cancel()</code> but got this then: <code>panic: send on closed channel</code>"}, {"owner": {"reputation": 2732, "user_id": 2061886, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/dkfiz.jpg?s=128&g=1", "display_name": "lightweight", "link": "https://stackoverflow.com/users/2061886/lightweight"}, "edited": false, "score": 0, "creation_date": 1533659751, "post_id": 51726367, "comment_id": 90423969, "body": "I tried to recreate the channel like this too: `\tfor {  \t\tvar messages = make(chan SensorData, 100)  \t\t// Pull messages via the subscription. \t\tpullMsgs(client, sub, messages) \t\tif err != nil { \t\t\tlog.Fatal(err) \t\t}  \t\twriteInflux(messages, bp) \t}` but that doesn&#39;t seem to work either...how do I keep this running?"}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 1, "last_activity_date": 1533644391, "last_edit_date": 1533644391, "creation_date": 1533643447, "answer_id": 51726367, "question_id": 51717626, "link": "https://stackoverflow.com/questions/51717626/using-channels-with-google-pubsub-poll-subscriber/51726367#51726367", "title": "using channels with google pubsub poll subscriber", "body": "<p>When you've sent the desired number of messages on the channel, close the channel and cancel the context.  Try using the technique demonstrated in <a href=\"https://cloud.google.com/pubsub/docs/pull\" rel=\"nofollow noreferrer\">the documentation</a> of canceling after some number of messages.  Since your buffer is 100 and you're trying to consume 100 messages at a time, that's the number.  If you want your program to exit, close the channel so that the <code>for e := range ch</code> loop in <code>writeInflux</code> hits a stopping point and doesn't block waiting for more elements to be added to the channel.</p>\n\n<p>Note this in <a href=\"https://godoc.org/cloud.google.com/go/pubsub\" rel=\"nofollow noreferrer\">the Go pubsub API doc</a>:</p>\n\n<blockquote>\n  <p>To terminate a call to Receive, cancel its context.</p>\n</blockquote>\n\n<p>That is not what's stalling your main goroutine, but your <code>pullMsgs</code> goroutine will not exit on its own without that cancel.</p>\n\n<p>Also, check for errors on <code>Unmarshal</code>.  If you don't want to handle unmarshal errors at this point in the code, consider changing the channel type and sending <code>msg</code> or <code>msg.Data</code> instead and unmarshaling upon channel receipt.</p>\n\n<pre><code>cctx, cancel := context.WithCancel(ctx)\nerr := sub.Receive(cctx, func(ctx context.Context, msg *pubsub.Message) {\n    msg.Ack()\n    err := json.Unmarshal(msg.Data, sensorinfo)\n    if err != nil {\n         fmt.Printf(\"Failed to unmarshal: %s\\n\", err)\n    }\n    mu.Lock()\n    defer mu.Unlock()\n    received++\n    fmt.Println(\"rcv: \", received)\n    messages &lt;- *sensorinfo\n    if received == 100 {\n        close(messages)  // no more messages will be sent on channel\n        cancel()\n    }\n</code></pre>\n"}], "owner": {"reputation": 2732, "user_id": 2061886, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/dkfiz.jpg?s=128&g=1", "display_name": "lightweight", "link": "https://stackoverflow.com/users/2061886/lightweight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 579, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1533644391, "creation_date": 1533605552, "question_id": 51717626, "link": "https://stackoverflow.com/questions/51717626/using-channels-with-google-pubsub-poll-subscriber", "title": "using channels with google pubsub poll subscriber", "body": "<p>I'm trying to create a google pubsub subscriber in golang where I take 100 messages at at a time and then write them to influx. I'm trying to use channels to do this like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"fmt\"\n    \"cloud.google.com/go/pubsub\"\n    \"log\"\n    \"sync\"\n    \"golang.org/x/net/context\"\n    \"encoding/json\"\n    clnt \"github.com/influxdata/influxdb/client/v2\"\n    \"time\"\n)\n\ntype SensorData struct {\n    Pressure      float64 `json:\"pressure\"`\n    Temperature   float64 `json:\"temperature\"`\n    Dewpoint      float64 `json:\"dewpoint\"`\n    Timecollected int64   `json:\"timecollected\"`\n    Latitude      float64 `json:\"latitude\"`\n    Longitude     float64 `json:\"longitude\"`\n    Humidity      float64 `json:\"humidity\"`\n    SensorID      string  `json:\"sensorId\"`\n    Zipcode       int     `json:\"zipcode\"`\n    Warehouse     string  `json:\"warehouse\"`\n    Area          string  `json:\"area\"`\n}\n\ntype SensorPoints struct {\n    SensorData      []SensorData\n}\n\nfunc main () {\n\n    messages := make(chan SensorData, 100)\n\n    // Create a new Influx HTTPClient\n    c, err := clnt.NewHTTPClient(clnt.HTTPConfig{\n        Addr:     \"http://localhost:8086\",\n        Username: \"user\",\n        Password: \"pass\",\n    })\n    if err != nil {\n        log.Fatal(err)\n    }\n\n\n    // Create pubsub subscriber\n    ctx := context.Background()\n    proj := os.Getenv(\"GOOGLE_CLOUD_PROJECT\")\n    if proj == \"\" {\n        fmt.Fprintf(os.Stderr, \"GOOGLE_CLOUD_PROJECT environment variable must be set.\\n\")\n        os.Exit(1)\n    }\n    client, err := pubsub.NewClient(ctx, proj)\n    if err != nil {\n        log.Fatalf(\"Could not create pubsub Client: %v\", err)\n    }\n    const sub = \"influxwriter\"\n\n\n    //create influx a blank batchpoint set\n    bp, err := clnt.NewBatchPoints(clnt.BatchPointsConfig{\n        Database:  \"sensordata\",\n        Precision: \"s\",\n    })\n    if err != nil {\n        log.Fatal(err)\n    }\n\n\n\n    // Pull messages via the subscription.\n    go pullMsgs(client, sub, messages)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    writeInflux(messages, bp)\n\n    c.Close()\n\n}\n\n\nfunc pullMsgs(client *pubsub.Client, name string, messages chan&lt;- SensorData) {\n    ctx := context.Background()\n\n    // [START pubsub_subscriber_async_pull]\n    // [START pubsub_quickstart_subscriber]\n    // Consume 10 messages.\n\n    var mu sync.Mutex\n    var sensorinfos SensorPoints\n    sensorinfo := &amp;SensorData{}\n\n    received := 0\n    sub := client.Subscription(name)\n    cctx, _ := context.WithCancel(ctx)\n    err := sub.Receive(cctx, func(ctx context.Context, msg *pubsub.Message) {\n        msg.Ack()\n\n        json.Unmarshal(msg.Data, sensorinfo)\n\n        //fmt.Println(string(msg.Data))\n        //fmt.Println(sensorinfo.SensorID)\n\n        sensorinfos.SensorData = append(sensorinfos.SensorData, *sensorinfo)\n\n        mu.Lock()\n        defer mu.Unlock()\n        received++\n        fmt.Println(\"rcv: \", received)\n        messages &lt;- *sensorinfo\n\n    })\n    if err != nil {\n        fmt.Println(err)\n    }\n    // [END pubsub_subscriber_async_pull]\n    // [END pubsub_quickstart_subscriber]\n}\n\nfunc writeInflux(sensorpoints &lt;- chan SensorData, bp clnt.BatchPoints) {\n\n    for p := range sensorpoints {\n\n        // Create a point and add to batch\n        tags := map[string]string{\n            \"sensorId\": p.SensorID,\n            \"warehouse\": p.Warehouse,\n            \"area\": p.Area,\n            \"zipcode\": string(p.Zipcode),\n        }\n\n        fields := map[string]interface{}{\n            \"pressure\":   p.Pressure,\n            \"humidity\": p.Humidity,\n            \"temperature\":   p.Temperature,\n            \"dewpoint\":   p.Dewpoint,\n            \"longitude\":   p.Longitude,\n            \"latitude\":   p.Latitude,\n        }\n\n        pt, err := clnt.NewPoint(\"sensordata\", tags, fields, time.Unix(p.Timecollected, 0))\n        if err != nil {\n            log.Fatal(err)\n        }\n        bp.AddPoint(pt)\n\n\n    }\n\n\n}\n</code></pre>\n\n<p>but it doesn't see to every get past the initial <code>pullMsgs</code> function and just keeps printing the output in there:</p>\n\n<pre><code>rcv:  1\nrcv:  2\nrcv:  3\nrcv:  4\nrcv:  5\nrcv:  6\nrcv:  7\n</code></pre>\n\n<p>I thought that once the channel get full, it should block until the channel is emptied out</p>\n\n<p>this is the pubsub pull code I'm using as a reference.</p>\n"}, {"tags": ["go"], "owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 218, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1533605680, "creation_date": 1533603636, "question_id": 51717446, "link": "https://stackoverflow.com/questions/51717446/scanning-a-bit8-postgresql-column-type-into-a-uint8-enum-in-go", "title": "Scanning a bit(8) Postgresql column type into a uint8 enum in Go", "body": "<p>I'm using a bitwise enum for a Golang project, and I'm storing the bitwise values as a <code>bit(8)</code> into Postgresql. The type of enum is a <code>uint8</code> as there are only 8 bits for the enum value.</p>\n\n<p>When I persist information to the database and get back values for the <code>bit(8)</code> column, it's returning a slice of values. The <code>Scan(...)</code> method should convert the <code>value</code> to a <code>uint8</code> so that the proper <code>Enum</code> can be created.</p>\n\n<p>Here is my code to explain it more:</p>\n\n<pre><code>type Enum uint8\n\nconst (\n    A       enum = 1 &lt;&lt; 0\n    B       enum = 1 &lt;&lt; 1\n    C       enum = 1 &lt;&lt; 2\n)\n// This method works great. This method is the value the driver uses to\n// persist information into the database.\nfunc (u Enum) Value() (driver.Value, error) {\n    return fmt.Sprintf(\"%08b\", u), nil\n}\n\n// This value is responsible for reading info from the database and \n// storing it in a Go type.\nfunc (u *Enum) Scan(value interface{}) error {\n    // This does NOT work as I'm getting back `[00110000 00110000 \n    //   00110000 00110000 00110000 00110000 00110001 00110001]` when I \n    //  fmt.Println(value).\n    *u = Enum(value.(uint8))\n    return nil\n}\n</code></pre>\n\n<p>The <code>value</code> literally looks like <code>00000011</code> in the database. So I'm having trouble for converting the the value received from the driver to into the proper enum value.</p>\n"}, {"tags": ["go", "authenticode"], "answers": [{"tags": [], "owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "is_accepted": true, "score": 6, "last_activity_date": 1533606332, "creation_date": 1533606332, "answer_id": 51717702, "question_id": 51717409, "link": "https://stackoverflow.com/questions/51717409/is-there-any-way-to-sign-the-windows-executables-generated-by-the-go-compiler/51717702#51717702", "title": "Is there any way to sign the windows executables generated by the Go compiler?", "body": "<p>Signing an executable is not the responsibility of the compiler, but it is part of the build process. Change your build script to run <code>signtool.exe</code> after the Go compiler has generated your EXE or DLL file. Provide the path and password to the private key file (if using a <code>.pfx</code> file) and it will sign it for you. This is the same process that Visual Studio uses.</p>\n\n<p><a href=\"https://docs.microsoft.com/en-us/windows/desktop/seccrypto/signtool\" rel=\"noreferrer\">https://docs.microsoft.com/en-us/windows/desktop/seccrypto/signtool</a></p>\n"}], "owner": {"reputation": 1105, "user_id": 2287138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f613ed050216de0a089e1574b394eca2?s=128&d=identicon&r=PG", "display_name": "MFT", "link": "https://stackoverflow.com/users/2287138/mft"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1298, "favorite_count": 1, "accepted_answer_id": 51717702, "answer_count": 1, "score": 3, "last_activity_date": 1533607199, "creation_date": 1533603279, "last_edit_date": 1533607199, "question_id": 51717409, "link": "https://stackoverflow.com/questions/51717409/is-there-any-way-to-sign-the-windows-executables-generated-by-the-go-compiler", "title": "Is there any way to sign the windows executables generated by the Go compiler?", "body": "<p>I am trying to find out if there is a possibility to sign executables produced by the Go compiler. I cannot see this in the build/compile options. Is this even possible?</p>\n"}, {"tags": ["go", "graphql"], "answers": [{"comments": [{"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "edited": false, "score": 1, "creation_date": 1533650091, "post_id": 51720792, "comment_id": 90417628, "body": "You sir, are absolutely right!! Thanks :), im gonna edit the question so if anyone has a problem like this the know how to solve it."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 3, "last_activity_date": 1533653550, "last_edit_date": 1533653550, "creation_date": 1533625590, "answer_id": 51720792, "question_id": 51715897, "link": "https://stackoverflow.com/questions/51715897/golang-mutation-with-a-list-as-a-param-variable-graphql/51720792#51720792", "title": "Golang Mutation with a list as a param variable (GRAPHQL)", "body": "<p>Your problem, according to the error message, is with this line:</p>\n\n<pre><code> list := p.Args[\"listTest\"].([]string)\n</code></pre>\n\n<p><code>p.Args[\"listTest\"]</code> is returning <code>[]interface{}</code>.</p>\n\n<p><code>interface{}</code> can store any other type. If you are familiar with java it's a little bit like <code>Object</code>.</p>\n\n<p>The problem here is that you have your field from <code>p.Args[\"listTest\"]</code> and you are trying to type assert it to <code>[]string</code>. This would work if the value stored in args were <code>interface{}</code> (any). But it's not, <code>p.Args</code> (according to the error) holds <code>[]interface{}</code>. This is a slice of interface values, where each of those can be anything (rather than a single interface value holding a slice of strings.)</p>\n\n<p>Instead try ranging over that list of interfaces, and type asserting each value.</p>\n\n<pre><code>var strs []string\nfor _, v := range p.Args[\"list\"].([]interface{}) {\n    strs = append(strs, v.(string))\n}\n</code></pre>\n\n<p>Or investigate another way to set up the graphQL types so that you get the values back in a more useable way.</p>\n"}], "owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 625, "favorite_count": 0, "accepted_answer_id": 51720792, "answer_count": 1, "score": 2, "last_activity_date": 1533653550, "creation_date": 1533590959, "last_edit_date": 1533650338, "question_id": 51715897, "link": "https://stackoverflow.com/questions/51715897/golang-mutation-with-a-list-as-a-param-variable-graphql", "title": "Golang Mutation with a list as a param variable (GRAPHQL)", "body": "<p>Basically what im trying to do is send a list of string ex:  <strong>[\"aa\",\"bb\",\"vv\"]</strong> into a graphql Mutation field, currently this is my Mutation Schema</p>\n\n<pre><code>\"listTest\": &amp;graphql.Field{\n            Type: QueryMessageType,\n            Args: graphql.FieldConfigArgument{\n                \"listNew\": &amp;graphql.ArgumentConfig{\n                    Description: \"Example List of Json String\",\n                    Type:        graphql.NewList(graphql.NewNonNull(graphql.String)),\n                },\n            },\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                list := p.Args[\"listTest\"].([]string)\n                return listTest(list)\n            },\n        },\n</code></pre>\n\n<p>and the Method <strong>listTest</strong></p>\n\n<pre><code>func listTest(testing[]string) (*QueryMessage, error) {\n    fmt.Println(testing)\n    return &amp;QueryMessage{\n        QueryBody: \"nothing to do here\",\n    }, nil\n}\n</code></pre>\n\n<p>However when i do the request in INSOMNIA the response is:</p>\n\n<pre><code>{\n    \"data\": {\n        \"listTest\": null\n    },\n    \"errors\": [\n        {\n            \"message\": \"interface conversion: interface {} is []interface {}, not []string\",\n            \"locations\": []\n        }\n    ]\n}\n</code></pre>\n\n<p>and the request is this:</p>\n\n<pre><code>mutation{\n    listTest(listNew: [\"aa\",\"bb\",\"vv\"]){\n        querybody\n    }\n}\n</code></pre>\n\n<p>can anyone tell me how to receive a List of String in my Go Server. Thanks! :)</p>\n\n<p><strong>UPDATE</strong>\nWhen i call a <strong>fmt.Println(p.Args[\"listTest\"])</strong></p>\n\n<p>the result is: <strong>[aa bb vv]</strong></p>\n\n<p><strong>SOLVED</strong></p>\n\n<p>Following the instructions of the voted answer, the script now do his job. This is the final result:</p>\n\n<pre><code>Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                var groupIDs []string\n                for _, gid := range p.Args[\"list\"].([]interface{}) {\n                    groupIDs = append(groupIDs, gid.(string))\n                }\n\n                for _, final := range groupIDs {\n                    fmt.Println(final)\n                }\n                return listTest(groupIDs)\n            },\n</code></pre>\n\n<p>and in the console i got this: </p>\n\n<pre><code>aa\nbb\nvv\n</code></pre>\n"}, {"tags": ["go", "tcp-ip"], "answers": [{"comments": [{"owner": {"reputation": 244, "user_id": 1575431, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f7058a49c1dc4696e4ec48fc5f8ce4f?s=128&d=identicon&r=PG", "display_name": "MattLock", "link": "https://stackoverflow.com/users/1575431/mattlock"}, "edited": false, "score": 0, "creation_date": 1533649481, "post_id": 51722586, "comment_id": 90417182, "body": "Thank you for the comment @shal, what would be the best way to handle this in binary if you are unsure of Contents size? So you could handle a large Vs. a small CSV file"}, {"owner": {"reputation": 66, "user_id": 10163689, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Z7cJI5HzQIs/AAAAAAAAAAI/AAAAAAAAACY/XjfwX3wL-9M/photo.jpg?sz=128", "display_name": "shal", "link": "https://stackoverflow.com/users/10163689/shal"}, "reply_to_user": {"reputation": 244, "user_id": 1575431, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f7058a49c1dc4696e4ec48fc5f8ce4f?s=128&d=identicon&r=PG", "display_name": "MattLock", "link": "https://stackoverflow.com/users/1575431/mattlock"}, "edited": false, "score": 0, "creation_date": 1533650534, "post_id": 51722586, "comment_id": 90417979, "body": "@MattLock U could send the file directly and add special characters at the end, such as <code>\\r\\n</code>. Client read the buffer and split it according to the special characters."}, {"owner": {"reputation": 244, "user_id": 1575431, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f7058a49c1dc4696e4ec48fc5f8ce4f?s=128&d=identicon&r=PG", "display_name": "MattLock", "link": "https://stackoverflow.com/users/1575431/mattlock"}, "edited": false, "score": 0, "creation_date": 1533652865, "post_id": 51722586, "comment_id": 90419690, "body": "I looked into io.Copy for sending the file directly but, I was hoping to keep the TCP connection open after the transfer, the copy calls seems to close it once the file has been transferred."}, {"owner": {"reputation": 66, "user_id": 10163689, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Z7cJI5HzQIs/AAAAAAAAAAI/AAAAAAAAACY/XjfwX3wL-9M/photo.jpg?sz=128", "display_name": "shal", "link": "https://stackoverflow.com/users/10163689/shal"}, "reply_to_user": {"reputation": 244, "user_id": 1575431, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f7058a49c1dc4696e4ec48fc5f8ce4f?s=128&d=identicon&r=PG", "display_name": "MattLock", "link": "https://stackoverflow.com/users/1575431/mattlock"}, "edited": false, "score": 1, "creation_date": 1533653889, "post_id": 51722586, "comment_id": 90420389, "body": "<code>io.Copy</code> won&#39;t close the TCP connection. Could you tell me where you think the code will close the connection. <a href=\"https://github.com/golang/go/blob/master/src/io/io.go#L363\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/io/io.go#L363</a>"}], "tags": [], "owner": {"reputation": 66, "user_id": 10163689, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Z7cJI5HzQIs/AAAAAAAAAAI/AAAAAAAAACY/XjfwX3wL-9M/photo.jpg?sz=128", "display_name": "shal", "link": "https://stackoverflow.com/users/10163689/shal"}, "is_accepted": true, "score": 1, "last_activity_date": 1533631733, "creation_date": 1533631733, "answer_id": 51722586, "question_id": 51715813, "link": "https://stackoverflow.com/questions/51715813/sending-a-csv-file-server-to-client/51722586#51722586", "title": "Sending a CSV file Server to Client", "body": "<h1>why you get the error</h1>\n\n<p>Visit <a href=\"https://golang.org/pkg/encoding/binary/#Write\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/binary/#Write</a></p>\n\n<blockquote>\n  <p>Write writes the binary representation of data into w. Data must be a fixed-size value or a slice of fixed-size values, or a pointer to such data. </p>\n</blockquote>\n\n<p><code>\ntype DataPack struct {\n    Length   int64\n    Contents []byte\n}\n</code></p>\n\n<p><code>Contents</code> isn't a fixed-size value, so you got the invalid type error.</p>\n\n<h1>how to solve it</h1>\n\n<ol>\n<li>go binary</li>\n<li>json</li>\n<li>others</li>\n</ol>\n"}], "owner": {"reputation": 244, "user_id": 1575431, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f7058a49c1dc4696e4ec48fc5f8ce4f?s=128&d=identicon&r=PG", "display_name": "MattLock", "link": "https://stackoverflow.com/users/1575431/mattlock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 589, "favorite_count": 0, "accepted_answer_id": 51722586, "answer_count": 1, "score": 1, "last_activity_date": 1533631733, "creation_date": 1533590576, "question_id": 51715813, "link": "https://stackoverflow.com/questions/51715813/sending-a-csv-file-server-to-client", "title": "Sending a CSV file Server to Client", "body": "<p>I've just recently started trying to learn Go and I'm trying to write a small server/client application for sending a csv file, from a server to a client. I'm running into an invalid type error when trying to encode a struct into BigEndian binary. My struct seems to already be in a binary format, I'm unsure why I get the following error: </p>\n\n<p>Error writing binary buffer to big endian  binary.Write: invalid type *main.DataPack</p>\n\n<p>Also, I'd like to keep the TCP connection open after sending the file, that's why I'm not using io.Copy.</p>\n\n<p>Currently I'm triggering the handling of the file upload through by sending a '\\x00' byte:</p>\n\n<pre><code>// Server\npackage main \n\nimport (\n    \"path/filepath\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net\"\n    \"os\"\n    \"encoding/binary\"\n    \"bytes\"\n\n)\n\n\ntype DataPack struct {\n    Length   int64\n    Contents []byte\n}\n\nfunc main() {\n\n    absPath, _ := filepath.Abs(\"./progs.csv\")\n\n    data, _ := ioutil.ReadFile(absPath)\n    fmt.Println(\"%s\",data)\n\n    tel, err := net.Listen(\"tcp\", \"0.0.0.0:23\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    for {\n        conn, err := tel.Accept()\n        if err != nil {\n            break\n        }\n        fmt.Println(\"above filehandler\")\n        go fileHandler(conn)\n    }\n}\n\nfunc fileHandler(conn net.Conn) {\n\n    buf := make([]byte, 0)\n    buf = append(buf, '\\x00')\n    conn.Write(buf)\n    absPath, _ := filepath.Abs(\"./progs.csv\")\n\n    file, err := os.Open(absPath)\n    defer file.Close()\n\n    fi, err := file.Stat()\n    if err != nil {\n        fmt.Println(\"Fatal error reading file: \", err)\n    }\n\n    fmt.Println(\"This is the length of the file: \", fi.Size())\n\n    data := &amp;DataPack{Length: fi.Size()} // , Contents: }\n\n    data.Contents = make([]byte, data.Length)\n    n, err := file.Read(data.Contents)\n    if err != nil {\n        fmt.Println(\"error reading contents into struct: \", err)\n    }\n    fmt.Println(\"tried to read file contents: \", n)\n    fmt.Println(\"DataPack: %+v\", data) \n\n    buf1 := new(bytes.Buffer)\n    err = binary.Write(buf1, binary.BigEndian, &amp;data)\n\n    if err != nil {\n        fmt.Println(\"Error writing binary buffer to big endian \", err)\n    }\n    conn.Write(buf1.Bytes())  \n}\n</code></pre>\n\n<p>Here is the client</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"fmt\"\n    \"net\"\n    \"strings\"\n    \"strconv\"\n    \"bufio\"\n)\n\nconst (\n    host = \"127.0.0.1\"\n    port = 23\n)\n\nfunc main() {\n\naddr := strings.Join([]string{host, strconv.Itoa(port)}, \":\")\nclient := NewClient()\nvar err error\n\nclient.socket, err = net.Dial(\"tcp\", addr)\nif err != nil {\n    log.Println(\"error setting up socket: %s\", err)\n}\n\nfor {\n\n    m := bufio.NewReader(client.socket)\n    b, err := m.ReadByte()\n    if err != nil {\n\n        fmt.Println(\"here is the error: \", err)\n    }\n    if b == '\\x00'{\n        fmt.Println(\"about to receive a file!!!\")\n        b, _ := m.ReadByte()\n        fmt.Println(\"just got another byte \", b )\n    }\n\n} \n\nlog.Printf(\"Over\")\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["multithreading", "go", "concurrency", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 0, "last_activity_date": 1533614113, "creation_date": 1533614113, "answer_id": 51718601, "question_id": 51715210, "link": "https://stackoverflow.com/questions/51715210/close-self-feeding-channels-in-go/51718601#51718601", "title": "Close self-feeding channels in Go", "body": "<p>You can use a <code>sync.WaitGroup</code> for waiting things done, say <code>wg := &amp;sync.WaitGroup{}</code></p>\n\n<p>As you are trying to print <code>finalNumber</code> times, you shall call <code>wg.Add(finalNumber)</code> and then in <code>print()</code>, each time you have done a print, call <code>wg.Done()</code>.</p>\n\n<p>Spawn another goroutine to wait <code>wg.Wait()</code> and then close the <code>read</code> channel and <code>print</code> channel.</p>\n\n<pre><code>func printingRoutine(print chan int,wg *sync.WaitGroup) {\n    for i := range print {\n        println(i)\n        wg.Done()\n    }\n}\n\nfunc main() {\n    read := make(chan int, count)\n    print := make(chan int, count)\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(finalNumber)\n\n    // Feed count numbers into the buffered channel\n    for i := 0; i &lt; count; i++ {\n        read &lt;- i\n    }\n\n    // count go routines will be processing the read channel\n    for i := 0; i &lt; count; i++ {\n        go readingRoutine(read, print)\n    }\n    go func() {\n        wg.Wait()\n        close(read)\n        close(print)\n    }()\n    printingRoutine(print,wg)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/BMSfz03egx0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/BMSfz03egx0</a></p>\n"}, {"tags": [], "owner": {"reputation": 2651, "user_id": 3482664, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/O1Qex.png?s=128&g=1", "display_name": "Tom Wright", "link": "https://stackoverflow.com/users/3482664/tom-wright"}, "is_accepted": false, "score": 0, "last_activity_date": 1533680432, "last_edit_date": 1533680432, "creation_date": 1533680113, "answer_id": 51736163, "question_id": 51715210, "link": "https://stackoverflow.com/questions/51715210/close-self-feeding-channels-in-go/51736163#51736163", "title": "Close self-feeding channels in Go", "body": "<p>I usually find that if you're having real problems making a design pattern or idea work, you're doing it wrong. In this case the idea of a self-feeding routine knowing when it should close itself.</p>\n\n<p>I think what you're looking for is the idea of a <code>worker pool</code>.</p>\n\n<p>Essentially you have a channel that contains your set of <code>work</code>, and then a number of <code>workers</code> in the form of go routines that read jobs from that channel and do something with them until all work has been completed.</p>\n\n<p>In the following example I am using the package <a href=\"https://github.com/tomwright/gopool\" rel=\"nofollow noreferrer\" title=\"github.com/tomwright/gopool\">gopool</a> to run 3 concurrent workers which are being fed by a 4th go routine.</p>\n\n<p>I wait for all workers to close themselves, which is caused by the input work channel being closed.</p>\n\n<pre><code>// create the channel to store the jobs\n// notice that we can only have 5 jobs in the channel at one time\nworkChan := make(chan int, 5)\n\n// here we define what should be happening in each of our workers.\n// each worker will be running concurrently\nvar work gopool.WorkFunc = func(ctx context.Context) error {\n    for {\n        select {\n        case &lt;-ctx.Done():\n            // this is just a get out clause in case we want to prematurely stop the workers while there is still work to do\n            return ctx.Err()\n        case work, ok := &lt;-workChan:\n            if !ok {\n                // we get here if the work channel has been closed\n                return nil\n            }\n            // do something with work here\n            fmt.Println(work)\n        }\n    }\n}\n\n// this func defines how many workers we want to be running concurrently\nvar workerCount gopool.WorkerCountFunc = func() uint64 {\n    return 3\n}\n\n// here we define a new worker pool\np := gopool.NewPool(\"test\", work, workerCount, nil, context.TODO())\n\n// here we start the worker pool\ncancel, err := p.StartOnce()\nif err != nil {\n        panic(err)\n}\n\n// the workers are now running and waiting for jobs\n\n// we'll defer the cancel to make sure that the pool will be closed eventually\ndefer cancel()\n\n// now we'll start a go routine to feed the workers\n// it does this by adding to the workChan, and closes workChan when there is no more work to do\n// when the workChan is closed the workers know that they should quit\ngo func(workChan chan&lt;- int, min int, max int) {\n    for i := min; i &lt;= max; i++ {\n        workChan &lt;- i\n    }\n    close(workChan)\n}(workChan, 3, 200)\n\n// now we wait for the pool to be finished with it's work\n&lt;-p.Done()\n\nfmt.Println(\"all work has been done\")\n</code></pre>\n\n<p>Example output:</p>\n\n<pre><code>$ go run main.go \n4\n6\n7\n8\n9\n10\n3\n5\n13\n14\n15\n16\n17\n18\n12\n20\n21\n19\n23\n24\n25\n22\n27\n28\n11\n30\n31\n26\n33\n29\n35\n36\n34\n38\n39\n32\n41\n42\n37\n44\n43\n46\n47\n40\n49\n50\n51\n52\n48\n54\n53\n56\n57\n58\n45\n60\n61\n62\n63\n64\n65\n55\n59\n68\n69\n66\n71\n72\n73\n70\n75\n76\n77\n67\n79\n80\n74\n82\n83\n81\n85\n84\n87\n88\n89\n78\n91\n90\n93\n94\n92\n96\n97\n95\n99\n98\n101\n102\n103\n104\n100\n106\n107\n108\n109\n105\n111\n112\n110\n114\n115\n116\n117\n118\n119\n120\n86\n122\n123\n124\n125\n126\n127\n121\n129\n113\n131\n128\n133\n134\n130\n136\n137\n132\n139\n138\n141\n140\n143\n144\n145\n146\n147\n148\n149\n150\n135\n151\n153\n142\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n152\n154\n167\n165\n166\n170\n171\n172\n173\n174\n169\n176\n177\n178\n179\n180\n168\n182\n183\n184\n181\n185\n187\n188\n189\n190\n175\n186\n193\n191\n195\n194\n197\n196\n199\n198\n200\n192\nall work has been done\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10188669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8b86ede377c134babd330f3b39df011?s=128&d=identicon&r=PG&f=1", "display_name": "Jo&#227;o Pedro", "link": "https://stackoverflow.com/users/10188669/jo%c3%a3o-pedro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 212, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1533680432, "creation_date": 1533587399, "question_id": 51715210, "link": "https://stackoverflow.com/questions/51715210/close-self-feeding-channels-in-go", "title": "Close self-feeding channels in Go", "body": "<p>I am trying to work with concurrency and channels in Go. The problem that I am facing is mainly the idea of concurrency, so I am not discarding that the following logic is wrong or should be changed.</p>\n\n<p>I have a buffered channel that has a buffer size of 'N' and it also represents the number of goroutines that will be created. All of the routines reads form One Channel and Writes in another One channel, and the main goroutine will be printing the values from the final channel.</p>\n\n<p>1 input channel --- N goroutines looking and adding to input and output --- 1 output channel</p>\n\n<p>The problem is that i always hit deadlock, since I don't know how to close a channel that is feeding itself, and does not know when it will stop, so I cannot close the output channel either.</p>\n\n<p>The code is the following example:</p>\n\n<pre><code>package main\n\nconst count = 3\nconst finalNumber = 100\n\n// There will be N routines running and reading from the one read channel\n// The finalNumber is not known, in this examples is 100, but in the main problem will keep self feeding until the operation gives a wrong output\n// readingRoutine will feed read channel and the print channel\nfunc readingRoutine(read, print chan int) {\n    for i := range read {\n        print &lt;- i\n        if i &lt; finalNumber &amp;&amp; i+count &lt; finalNumber {\n            read &lt;- i + count\n        }\n    }\n}\n\n// This is the main routine that will be printing the values from the print channel\nfunc printingRoutine(print chan int) {\n    for i := range print {\n        println(i)\n    }\n}\n\nfunc main() {\n    read := make(chan int, count)\n    print := make(chan int, count)\n\n    // Feed count numbers into the buffered channel\n    for i := 0; i &lt; count; i++ {\n        read &lt;- i\n    }\n\n    // count go routines will be processing the read channel\n    for i := 0; i &lt; count; i++ {\n        go readingRoutine(read, print)\n    }\n    printingRoutine(print)\n}\n</code></pre>\n\n<p>In this example it should print all numbers from 0 to 100 and finish. \nThanks</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 32193, "user_id": 2908724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1xBJR.png?s=128&g=1", "display_name": "bishop", "link": "https://stackoverflow.com/users/2908724/bishop"}, "edited": false, "score": 1, "creation_date": 1533575494, "post_id": 51712541, "comment_id": 90386546, "body": "For some general guidance on Go MySQL connection handling: <a href=\"https://github.com/go-sql-driver/mysql/issues/461\" rel=\"nofollow noreferrer\">github.com/go-sql-driver/mysql/issues/461</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533575700, "post_id": 51712541, "comment_id": 90386652, "body": "Explicitly giving all the connections max 500 open connections seems strange when, based on the given code, you need only 1 open connection per database."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1533575760, "post_id": 51712541, "comment_id": 90386684, "body": "Have you actually confirmed via netstat that the application has an escalating number of connections to the database open, or is that a guess based on the crash error?"}, {"owner": {"reputation": 5320, "user_id": 63377, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/fea0a34ae0b134c7a1e2c436eeec5baa?s=128&d=identicon&r=PG", "display_name": "Wabbitseason", "link": "https://stackoverflow.com/users/63377/wabbitseason"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1533577299, "post_id": 51712541, "comment_id": 90387352, "body": "@Adrian, it was just a guess, and looks like the number of connections is not escalating. Previously I had such problems and that 500 for the open connections seemed to help (As Someone Has Suggested On The Internet). This is something new though. Maybe I should check an alternative package for connecting to MySQL."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533577604, "post_id": 51712541, "comment_id": 90387498, "body": "Googling the error turned up [this issue]() which suggests <code>db.SetConnMaxLifetime(time.Second * 10)</code> might help, as well as tweaking mysqld&#39;s own timeouts in my.cnf. It could be the connections are idling out during long-running queries."}, {"owner": {"reputation": 5320, "user_id": 63377, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/fea0a34ae0b134c7a1e2c436eeec5baa?s=128&d=identicon&r=PG", "display_name": "Wabbitseason", "link": "https://stackoverflow.com/users/63377/wabbitseason"}, "edited": false, "score": 0, "creation_date": 1533592829, "post_id": 51712541, "comment_id": 90393665, "body": "I&#39;ve tried that, and also SetConnMaxLifetime(0) -- forever --, but it made no difference. Switching from <code>database&#47;sql</code> to <code>github.com&#47;siddontang&#47;go-mysql&#47;client</code> did the trick with the same queries, but this API somehow feels less elegant. Anyway, at least my data has been converted now, and I still need to learn a lot about Go."}], "owner": {"reputation": 5320, "user_id": 63377, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/fea0a34ae0b134c7a1e2c436eeec5baa?s=128&d=identicon&r=PG", "display_name": "Wabbitseason", "link": "https://stackoverflow.com/users/63377/wabbitseason"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 889, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1533575244, "creation_date": 1533575244, "question_id": 51712541, "link": "https://stackoverflow.com/questions/51712541/how-to-fix-leaking-mysql-conns-with-go", "title": "How to fix leaking MySQL conns with Go?", "body": "<p>I have data on my local computer in 2 MySQL databases (dbConnOuter and dbConnInner) that I want to process and collate into a 3rd database (dbConnTarget).</p>\n\n<p>The code runs for about 17000 cycles, then stops with these error messages:</p>\n\n<pre><code>[mysql] 2018/08/06 18:20:57 packets.go:72: unexpected EOF\n[mysql] 2018/08/06 18:20:57 packets.go:405: busy buffer\n</code></pre>\n\n<p>As far as I can tell I'm properly closing the connections where I'm reading from and I'm using <code>Exec</code> for writing, that I believe handles its own resources. I've also tried prepared statements, but it didn't help, the result was the same.</p>\n\n<p>Below is the relevant part of my code, and it does similar database operations prior to this without any issues.</p>\n\n<p>As this is one of my first experiments with Go, I can't yet see where I might be wasting my resources.</p>\n\n<pre><code>import (\n    \"database/sql\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nvar dbConnOuter *sql.DB\nvar dbConnInner *sql.DB\nvar dbConnTarget *sql.DB\n\nfunc main() {\n    dbConnOuter = connectToDb(dbUserDataOne)\n    dbConnInner = connectToDb(dbUserDataTwo)\n    dbConnTarget = connectToDb(dbUserDataThree)\n    // execute various db processing functions\n    doStuff()\n}\n\nfunc connectToDb(dbUser dbUser) *sql.DB {\n    dbConn, err := sql.Open(\"mysql\", fmt.Sprintf(\"%v:%v@tcp(127.0.0.1:3306)/%v\", dbUser.username, dbUser.password, dbUser.dbname))\n    if err != nil {\n        panic(err)\n    }\n    dbConn.SetMaxOpenConns(500)\n    return dbConn\n}\n\n// omitted similar db processing functions that work just fine\n\nfunc doStuff() {\n    outerRes, err := dbConnOuter.Query(\"SELECT some outer data\")\n    if err != nil {\n        panic(err)\n    }\n    defer outerRes.Close()\n\n    for outerRes.Next() {\n        outerRes.Scan(&amp;data1)\n        innerRes, err := dbConnInner.Query(\"SELECT some inner data using\", data1)\n        if err != nil {\n            panic(err)\n        }\n        innerRes.Scan(&amp;data2, &amp;data3)\n        innerRes.Close()\n\n        dbConnTarget.Exec(\"REPLACE INTO whatever\", data1, data2, data3)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "nosql", "singlestore"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533574495, "post_id": 51711919, "comment_id": 90386069, "body": "That error message seems pretty clear to me. <code>Prepare</code> is not supported for MemSQL."}, {"owner": {"reputation": 33, "user_id": 9675138, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "tony", "link": "https://stackoverflow.com/users/9675138/tony"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533574874, "post_id": 51711919, "comment_id": 90386272, "body": "I know, whats the solution ?  just use db.Query?"}], "answers": [{"tags": [], "owner": {"reputation": 1196, "user_id": 5302387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6161e7c6af146b816cdaefd47811a48?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Chen", "link": "https://stackoverflow.com/users/5302387/jack-chen"}, "is_accepted": false, "score": 1, "last_activity_date": 1533575082, "creation_date": 1533575082, "answer_id": 51712509, "question_id": 51711919, "link": "https://stackoverflow.com/questions/51711919/memsql-throws-error-memsql-does-not-support-server-side-prepared-statements/51712509#51712509", "title": "Memsql throws error MemSQL does not support server-side prepared statements", "body": "<p>In Go's driver, the interpolateParams=true option only applies to things like <code>Exec(\"INSERT INTO squareNum VALUES( ?, ? )\", 1, 2)</code> - it doesn't apply to <code>Prepare()</code>. So you'll have to stick with the former - just don't use explicit <code>Prepare()</code></p>\n"}], "owner": {"reputation": 33, "user_id": 9675138, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "tony", "link": "https://stackoverflow.com/users/9675138/tony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1533575082, "creation_date": 1533572606, "last_edit_date": 1533573700, "question_id": 51711919, "link": "https://stackoverflow.com/questions/51711919/memsql-throws-error-memsql-does-not-support-server-side-prepared-statements", "title": "Memsql throws error MemSQL does not support server-side prepared statements", "body": "<p>I am trying to execute query in memsql with golang. But i keep getting error.\n\"MemSQL does not support server-side prepared statements.\"</p>\n\n<p>I am even using \"interpolateParams=true\" but still the same error.</p>\n\n<pre><code>var Dbmysql, err = sql.Open(\"mysql\", \"root:@/memsql?interpolateParams=true\") \ntx,err := Dbmysql.Begin()\nfmt.Println(err)\nstmt, err := tx.Prepare(\"INSERT INTO squareNum VALUES( ?, ? )\") // ? = placeholder\nfmt.Println(err)\n\nfor i:=0;i&lt;1e6;i++{\n    _,err = stmt.Exec(\"test\",1)\n    log.Println(tx.Rollback())\n    fmt.Println(err)\n} \n\nerr = tx.Commit()\nfmt.Println(err)\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "edited": false, "score": 0, "creation_date": 1533570879, "post_id": 51711282, "comment_id": 90384229, "body": "Thanks! but this returns only the sub document &quot;children&quot;, is there way I could get the entire document?"}, {"owner": {"reputation": 15500, "user_id": 8486518, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QUM0SNPJsXo/AAAAAAAAAAI/AAAAAAAAABU/3rAlBsd0Qlg/photo.jpg?sz=128", "display_name": "M\u1ea1nh Quy\u1ebft Nguy\u1ec5n", "link": "https://stackoverflow.com/users/8486518/m%e1%ba%a1nh-quy%e1%ba%bft-nguy%e1%bb%85n"}, "reply_to_user": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "edited": false, "score": 0, "creation_date": 1533571338, "post_id": 51711282, "comment_id": 90384451, "body": "This should return entire document. You should double check yor query"}, {"owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "edited": false, "score": 0, "creation_date": 1533651938, "post_id": 51711282, "comment_id": 90419008, "body": "I tried this query but only get children <code>bson.M{&quot;_id&quot;: 0, &quot;children&quot;: bson.M{&quot;$elemMatch&quot;: {serialNo: &#39;abc123&#39;}}}</code>"}], "tags": [], "owner": {"reputation": 15500, "user_id": 8486518, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QUM0SNPJsXo/AAAAAAAAAAI/AAAAAAAAABU/3rAlBsd0Qlg/photo.jpg?sz=128", "display_name": "M\u1ea1nh Quy\u1ebft Nguy\u1ec5n", "link": "https://stackoverflow.com/users/8486518/m%e1%ba%a1nh-quy%e1%ba%bft-nguy%e1%bb%85n"}, "is_accepted": false, "score": 1, "last_activity_date": 1533570121, "creation_date": 1533570121, "answer_id": 51711282, "question_id": 51711220, "link": "https://stackoverflow.com/questions/51711220/unsupproted-projection-option-while-querying-children-elements-mongdb-with-mgo/51711282#51711282", "title": "unsupproted projection option while querying children elements mongdb with mgo", "body": "<p>Matching array element should be done with <a href=\"https://docs.mongodb.com/manual/reference/operator/query/elemMatch/\" rel=\"nofollow noreferrer\">$elemMatch</a></p>\n\n<p>Raw mongodb query looks like:</p>\n\n<pre><code>db.collection.find({_id: ObjectId('...'), children: {$elemMatch: {serialNo: 'abc123'}}});\n</code></pre>\n"}], "owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1533570121, "creation_date": 1533569922, "question_id": 51711220, "link": "https://stackoverflow.com/questions/51711220/unsupproted-projection-option-while-querying-children-elements-mongdb-with-mgo", "title": "unsupproted projection option while querying children elements mongdb with mgo", "body": "<p>I am working on a query to a mongodb with mgo using golang but it throws <code>Unsupported projection option</code> error while querying a sub document.</p>\n\n<p>I am working on below document</p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"5b64a0d3931653c36bcaf0b5\"),\n    \"quantity\" : 2,\n    \"product\" : \"ABC\",   \n    \"children\" : [ \n        {           \n            \"isBlocked\" : true,\n            \"blockedMessage\" : \"Error occurred: TRACEID\",\n            \"serialNo\" : \"abc123\",\n            \"token\" : \"foo456\",            \n        }\n    ]\n}\n</code></pre>\n\n<p>The query I am using is </p>\n\n<pre><code>bson.M{\"_id\": 0, \"children\": bson.M{\"serialNo\": \"abc123\"}}\n</code></pre>\n\n<p><strong>May I know where the mistake is?</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 2, "creation_date": 1533569872, "post_id": 51711154, "comment_id": 90383686, "body": "Can you provide sample JSON data and explain which types you would like to decode that data into?"}, {"owner": {"reputation": 11, "user_id": 8020619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24b7465133ab39faab5b8e1260c41737?s=128&d=identicon&r=PG&f=1", "display_name": "trophyfish", "link": "https://stackoverflow.com/users/8020619/trophyfish"}, "reply_to_user": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1533572270, "post_id": 51711154, "comment_id": 90384940, "body": "<a href=\"https://stackoverflow.com/questions/44027826/convert-interface-to-string-in-golang\" title=\"convert interface to string in golang\">stackoverflow.com/questions/44027826/&hellip;</a> found this. My problem being the response is always &quot;[ ]&quot; so maybe there isn&#39;t anything to get anyway.."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1533573880, "post_id": 51711154, "comment_id": 90385765, "body": "@trophyfish Please post the json response in your question post."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 2, "last_activity_date": 1533571007, "creation_date": 1533571007, "answer_id": 51711519, "question_id": 51711154, "link": "https://stackoverflow.com/questions/51711154/how-do-i-json-decode-interface-slice-in-go/51711519#51711519", "title": "How do I json decode interface slice in Go?", "body": "<p>Using the switch case you can fetch the value underlying the interface. The function will run recursively until it gets the original type of the parsed json.</p>\n\n<pre><code>func fetchValue(value interface{}) { // pass the interface value from the struct in this function as it will run recursively to get the value.\n    switch value.(type) {\n    case string:\n        fmt.Printf(\"%v is an string \\n \", value.(string))\n    case bool:\n        fmt.Printf(\"%v is bool \\n \", value.(bool))\n    case float64:\n        fmt.Printf(\"%v is float64 \\n \", value.(float64))\n    case []interface{}:\n        fmt.Printf(\"%v is a slice of interface \\n \", value)\n        for _, v := range value.([]interface{}) {\n            fetchValue(v)\n        }\n    case map[string]interface{}:\n        fmt.Printf(\"%v is a map \\n \", value)\n        for _, v := range value.(map[string]interface{}) {\n            fetchValue(v)\n        }\n    default:\n        fmt.Printf(\"%v is unknown \\n \", value)\n    }\n}\n</code></pre>\n\n<p>The reason behind the types in switch to be limited is defined in the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">golang spec for unmarshal</a> where it is clearly described what values the json will parse into when unmarshaling using interface{}:</p>\n\n<blockquote>\n  <p>To unmarshal JSON into an interface value, Unmarshal stores one of\n  these in the interface value:</p>\n</blockquote>\n\n<pre><code>bool, for JSON booleans\nfloat64, for JSON numbers\nstring, for JSON strings\n[]interface{}, for JSON arrays\nmap[string]interface{}, for JSON objects\nnil for JSON null\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8020619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24b7465133ab39faab5b8e1260c41737?s=128&d=identicon&r=PG&f=1", "display_name": "trophyfish", "link": "https://stackoverflow.com/users/8020619/trophyfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1533571103, "creation_date": 1533569701, "last_edit_date": 1533571103, "question_id": 51711154, "link": "https://stackoverflow.com/questions/51711154/how-do-i-json-decode-interface-slice-in-go", "title": "How do I json decode interface slice in Go?", "body": "<p>I am json.Decode()'ing (forgive the shorthand) a json response from an api into a large struct. Within that struct are a few types that are of type []interface{}. I can't figure out how to extract any data from those special nested structs. I have tried using a case switch type checking solution but came up empty handed still. Can someone share their experience with a similar case or point me in the right direction?</p>\n\n<pre><code>m := new(largestruct)\nif err := json.NewDecoder(resp.Body).Decode(&amp;m); err != nil{\nreturn err\n}\n</code></pre>\n\n<p>The struct field for interface is:</p>\n\n<pre><code>Strings []interface{} `json:\"strings\"`\n</code></pre>\n"}, {"tags": ["go", "logging"], "answers": [{"comments": [{"owner": {"reputation": 756, "user_id": 7832866, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4b22a97b1be4795d27f32ccb7a06e2a?s=128&d=identicon&r=PG&f=1", "display_name": "Priya", "link": "https://stackoverflow.com/users/7832866/priya"}, "edited": false, "score": 0, "creation_date": 1533566959, "post_id": 51710097, "comment_id": 90381811, "body": "This is for known error cases, how to log the errors of unexpected cases"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 756, "user_id": 7832866, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4b22a97b1be4795d27f32ccb7a06e2a?s=128&d=identicon&r=PG&f=1", "display_name": "Priya", "link": "https://stackoverflow.com/users/7832866/priya"}, "edited": false, "score": 0, "creation_date": 1533567013, "post_id": 51710097, "comment_id": 90381848, "body": "@Priya what do you mean by unexpected case. If you have encountered one, Please add some code snippet to recreate the case in your post."}, {"owner": {"reputation": 756, "user_id": 7832866, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4b22a97b1be4795d27f32ccb7a06e2a?s=128&d=identicon&r=PG&f=1", "display_name": "Priya", "link": "https://stackoverflow.com/users/7832866/priya"}, "edited": false, "score": 0, "creation_date": 1533567656, "post_id": 51710097, "comment_id": 90382247, "body": "The Application runs as .exe in windows environment . All my panic errors are logged by log15 into a log file. I faced a Runtime exception which I have not handled by <code>defer</code> . This has killed my application without writing any errors in logfile making it hard to debug"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 756, "user_id": 7832866, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4b22a97b1be4795d27f32ccb7a06e2a?s=128&d=identicon&r=PG&f=1", "display_name": "Priya", "link": "https://stackoverflow.com/users/7832866/priya"}, "edited": false, "score": 0, "creation_date": 1533567803, "post_id": 51710097, "comment_id": 90382342, "body": "@Priya On killing the application If the log is reporting <code>Fatal</code> error using <code>log.Fatal</code>. Then In case of error it will not log the error it will exit from the program."}, {"owner": {"reputation": 756, "user_id": 7832866, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4b22a97b1be4795d27f32ccb7a06e2a?s=128&d=identicon&r=PG&f=1", "display_name": "Priya", "link": "https://stackoverflow.com/users/7832866/priya"}, "edited": false, "score": 0, "creation_date": 1533567863, "post_id": 51710097, "comment_id": 90382379, "body": "In my case, the error is written to stderr, but not to file"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 756, "user_id": 7832866, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4b22a97b1be4795d27f32ccb7a06e2a?s=128&d=identicon&r=PG&f=1", "display_name": "Priya", "link": "https://stackoverflow.com/users/7832866/priya"}, "edited": false, "score": 0, "creation_date": 1533568192, "post_id": 51710097, "comment_id": 90382583, "body": "@Priya yes that will happen in case of Fatal error. Please check edited answer"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1533568386, "last_edit_date": 1533568386, "creation_date": 1533566252, "answer_id": 51710097, "question_id": 51709744, "link": "https://stackoverflow.com/questions/51709744/golang-write-stdout-and-stderr-to-log15-file/51710097#51710097", "title": "GoLang write STDOUT and STDERR to log15 file", "body": "<p>For creating a log file to log data of stderr or stdout. Create a file using <code>OpenFile</code> and then <code>SetOutput</code> to the file as.</p>\n\n<pre><code>f, err := os.OpenFile(\"EDUC_LOG\", os.O_RDWR|os.O_CREATE|os.O_APPEND, 0664)\n\nif err != nil {\n    panic(err)\n}\n\ndefer f.Close()\n\nlog.SetOutput(f)\n</code></pre>\n\n<p>This will print the output to log file everytime you try to log some value like in case of an error as</p>\n\n<pre><code>if err != nil{\n       log.Println(err) // this will create a file if not created to output the log in a file.\n}\n</code></pre>\n\n<p><strong>Edited:</strong></p>\n\n<p>Fatal error will print the output on stdout rather than in a file, Since the program will exit before writing anything to the file.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n)\n\nfunc main() {\n    log.Println(\"error1\")\n    log.Fatal(\"error1\")\n    log.Println(\"error2\") // this will not print since the program will exit the main with fatal error\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/EGTt_WJ3Aw_M\" rel=\"nofollow noreferrer\">Playground Example</a></p>\n"}, {"tags": [], "owner": {"reputation": 837, "user_id": 1108824, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/db03848c6bb955bc11ec52fee3ee401c?s=128&d=identicon&r=PG", "display_name": "r---------k", "link": "https://stackoverflow.com/users/1108824/r-k"}, "is_accepted": false, "score": 1, "last_activity_date": 1533571831, "creation_date": 1533571831, "answer_id": 51711724, "question_id": 51709744, "link": "https://stackoverflow.com/questions/51709744/golang-write-stdout-and-stderr-to-log15-file/51711724#51711724", "title": "GoLang write STDOUT and STDERR to log15 file", "body": "<p>You could capture <code>os.Stdout</code> with a pipe and redirect the output to the actual stdout and your file using a <code>io.MultiWriter</code></p>\n\n<pre><code>f, _ := os.OpenFile(\"my.log\", os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0664)\nmultiWriter := io.MultiWriter(os.Stdout, f)\nrd, wr, err := os.Pipe()\nif err != nil {\n    os.Exit(1)\n}\n\n// overwrite os.Stdout\nos.Stdout = wr\n\ngo func() {\n    scanner := bufio.NewScanner(rd)\n    for scanner.Scan() {\n        stdoutLine := scanner.Text()\n        multiWriter.Write([]byte(stdoutLine + \"\\n\"))\n    }\n}()\n\n\nfmt.Println(\"foobar\")\n\n// hacky sleep to ensure the go routine can write before program exits\ntime.Sleep(time.Second) \n</code></pre>\n\n<p>You can apply the same with <code>os.Stderr</code> of course</p>\n\n<p>You'll have to find how to get a handle on the <code>log15</code> file though, but that shouldn't be too hard</p>\n\n<p>The issue you might have with this approach is that there is no guarantee that the goroutine will do its job when the program ends (see the sleep hack), not sure how to achieve that</p>\n"}], "owner": {"reputation": 756, "user_id": 7832866, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4b22a97b1be4795d27f32ccb7a06e2a?s=128&d=identicon&r=PG&f=1", "display_name": "Priya", "link": "https://stackoverflow.com/users/7832866/priya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3701, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1533571831, "creation_date": 1533565033, "question_id": 51709744, "link": "https://stackoverflow.com/questions/51709744/golang-write-stdout-and-stderr-to-log15-file", "title": "GoLang write STDOUT and STDERR to log15 file", "body": "<p>I have GoLang Application where I use log15 to write logs to a file. The package I use for log15 is <code>gopkg.in/inconshreveable/log15.v2</code> I run into a situation where I want to write the information of STDERR and STDOUT to the same file where I write log15 logs. Is there any possible ways to achieve the same</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1533563843, "post_id": 51709033, "comment_id": 90379747, "body": "How interfaces are implemented is a compiler internal and might be even different between gc and gcc. Alos: Your test code relies on implementation details."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1533565396, "post_id": 51709033, "comment_id": 90380742, "body": "See also: <a href=\"https://github.com/golang/go/issues/12128\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/12128</a>"}, {"owner": {"reputation": 77, "user_id": 4589830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bef822d53ad0d4783af554b222ca675d?s=128&d=identicon&r=PG&f=1", "display_name": "collymy", "link": "https://stackoverflow.com/users/4589830/collymy"}, "edited": false, "score": 0, "creation_date": 1533571197, "post_id": 51709033, "comment_id": 90384393, "body": "There was a comment by PeterSO that I clicked on the up arrow to say that it added something useful and PeterSO&#39;s comment has disappeared. Don&#39;t know why that happened."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1533574827, "post_id": 51709033, "comment_id": 90386240, "body": "@collymy: I converted my comment to an answer."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1533570748, "post_id": 51710090, "comment_id": 90384159, "body": "For the qurious, that was done to enable GC being concurrent with the rest of the running code. See <a href=\"https://github.com/golang/go/issues/8405\" rel=\"nofollow noreferrer\">this issue</a> and <a href=\"https://github.com/golang/go/commit/75b72b1b27dd74ca9a1ebdba22f545233431a99f\" rel=\"nofollow noreferrer\">this commit</a> in particular."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1533566221, "creation_date": 1533566221, "answer_id": 51710090, "question_id": 51709033, "link": "https://stackoverflow.com/questions/51709033/go-interface-optimization/51710090#51710090", "title": "Go interface optimization", "body": "<blockquote>\n  <p><a href=\"https://github.com/golang/go/wiki/CompilerOptimizations\" rel=\"nofollow noreferrer\"><strong>Compiler And Runtime Optimizations</strong></a></p>\n  \n  <p>This page lists optimizations done by the compilers. Note that these\n  are not guaranteed by the language specification.</p>\n  \n  <p><strong>Interface values</strong></p>\n  \n  <p><strong>Word-sized value in an interface value</strong></p>\n  \n  <p>Putting a word-sized-or-less non-pointer type in an interface value\n  doesn't allocate.</p>\n\n<pre><code>gc: 1.0-1.3, but not in 1.4+\ngccgo: never\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>Go no longer performs that optimization for Go1.4+.</p>\n"}], "owner": {"reputation": 77, "user_id": 4589830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bef822d53ad0d4783af554b222ca675d?s=128&d=identicon&r=PG&f=1", "display_name": "collymy", "link": "https://stackoverflow.com/users/4589830/collymy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1533566221, "creation_date": 1533562854, "last_edit_date": 1533563434, "question_id": 51709033, "link": "https://stackoverflow.com/questions/51709033/go-interface-optimization", "title": "Go interface optimization", "body": "<p>With reference to Russ Cox's December 2009 article, <a href=\"https://research.swtch.com/interfaces\" rel=\"nofollow noreferrer\">Go Data Structures: Interfaces</a></p>\n\n<p>In the section on Memory Optimizations, Russ suggested that if the data being stored in the <code>interface{}</code> is smaller that the size of a <code>uintptr</code> then the value would be stored in the interface directly and no allocation of the data, followed by taking it's address would be needed.</p>\n\n<p>If I test this with the following code: -</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype iface struct {\n    _    unsafe.Pointer\n    data unsafe.Pointer\n}\n\nfunc main() {\n    var i interface{} = 12\n    var pi = (*iface)(unsafe.Pointer(&amp;i))\n    fmt.Printf(\"if.data: %p\", pi.data)\n}\n</code></pre>\n\n<p>The result is: -</p>\n\n<pre><code>if.data: 0x127e2c\n</code></pre>\n\n<p>Clearly an address and not the value 12 that would be expected had the optimization been performed.</p>\n\n<p>Does Go no longer support the interface optimization or am I missing something?</p>\n"}, {"tags": ["json", "go", "httprequest"], "comments": [{"owner": {"reputation": 91, "user_id": 9911189, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FpQ1Ants5QU/AAAAAAAAAAI/AAAAAAAAAAc/E4smqVInW44/photo.jpg?sz=128", "display_name": "Arthur Ruckman", "link": "https://stackoverflow.com/users/9911189/arthur-ruckman"}, "edited": false, "score": 0, "creation_date": 1533559644, "post_id": 51707795, "comment_id": 90376862, "body": "If using direct TCP connections between the microservices, rather than HTTP, is an option, you could use Gob to encode and decode the data without converting it to a string at all: <a href=\"https://medium.com/@kpbird/golang-serialize-struct-using-gob-part-2-f6134dd4f22c\" rel=\"nofollow noreferrer\">medium.com/@kpbird/&hellip;</a>"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1533565600, "post_id": 51707795, "comment_id": 90380889, "body": "To send binary data, use gob, protobuf, etc., but JSON is a text format!"}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 81, "user_id": 10150930, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgBBkpUW710/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7puoa8L7t1UYQZjYTO4431xkK3NpA/mo/photo.jpg?sz=128", "display_name": "bed", "link": "https://stackoverflow.com/users/10150930/bed"}, "edited": false, "score": 0, "creation_date": 1533567926, "post_id": 51709059, "comment_id": 90382418, "body": "I&#39;m unfamiliar with gin, but judging from the docs you would call <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.Data\" rel=\"nofollow noreferrer\"><code>Data</code></a> instead of <code>JSON</code>."}, {"owner": {"reputation": 81, "user_id": 10150930, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgBBkpUW710/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7puoa8L7t1UYQZjYTO4431xkK3NpA/mo/photo.jpg?sz=128", "display_name": "bed", "link": "https://stackoverflow.com/users/10150930/bed"}, "edited": false, "score": 0, "creation_date": 1533568749, "post_id": 51709059, "comment_id": 90382989, "body": "Thank you man, it&#39;s work!! I made some changes, but without help I would never have succeeded."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 4, "last_activity_date": 1533562906, "creation_date": 1533562906, "answer_id": 51709059, "question_id": 51707795, "link": "https://stackoverflow.com/questions/51707795/send-and-read-a-byte-between-two-microservices-golang/51709059#51709059", "title": "send and read a [] byte between two microservices golang", "body": "<p>You are not decoding the response before decrypting. In other words, you are handing the JSON encoding of the ciphertext to Decrypt. That is obviously not going to do what you want. To recover the plaintext you have to precisely undo all of the operations of the encryption and encoding in reverse order.</p>\n\n<p>Either decode before decrypting, or don't JSON encode on the server. For instance:</p>\n\n<pre><code>oJSON, err := ioutil.ReadAll(oracle.Body)\nif err != nil {\n    panic(err)\n}\n\nvar ciphertext string\nif err := json.Unmarshal(oJSON, &amp;ciphertext); err != nil {\n    // TODO: handle error\n}\n\noracleJSON := security.Decrypt(ciphertext, keyEn)\n</code></pre>\n\n<p>Although it is unclear why you even go through the trouble of JSON encoding in the first place. You might as well just write the ciphertext directly. If you really want to encode the ciphertext, you should not convert it to a string. The ciphertext is just a bunch of random bytes, not remotely resembling a UTF-8 encoded string, so don't treat it like one. encoding/json uses the base64 encoding for byte slices automatically, which is a much cleaner (and probably shorter) representation of the ciphertext than tons of unicode escape sequences.</p>\n\n<p>Independent of the encoding you choose (if any), your Encrypt function is broken.</p>\n\n<pre><code>// The plaintext and dst must overlap exactly or not at all. To reuse\n// plaintext's storage for the encrypted output, use plaintext[:0] as dst.\nSeal(dst, nonce, plaintext, additionalData []byte) []byte\n</code></pre>\n\n<p>The first argument is the destination for the encryption. If you don't need to retain the plaintext, pass <code>json[:0]</code>; otherwise pass <code>nil</code>.</p>\n\n<p>Also, Decrypt expects the ciphertext to be prefixed by the nonce, but Encrypt doesn't prepend it.</p>\n"}], "owner": {"reputation": 81, "user_id": 10150930, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgBBkpUW710/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7puoa8L7t1UYQZjYTO4431xkK3NpA/mo/photo.jpg?sz=128", "display_name": "bed", "link": "https://stackoverflow.com/users/10150930/bed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 0, "accepted_answer_id": 51709059, "answer_count": 1, "score": 2, "last_activity_date": 1533564385, "creation_date": 1533558931, "last_edit_date": 1533564385, "question_id": 51707795, "link": "https://stackoverflow.com/questions/51707795/send-and-read-a-byte-between-two-microservices-golang", "title": "send and read a [] byte between two microservices golang", "body": "<p>I have a data encryption function that returns a [] byte. Of course, what has been encrypted must be decrypted (through another function) in another micro-service.\nThe problem is created when I send the <code>[]byte</code> via JSON: the <code>[]byte</code> is transformed into a string and then when I go to read the JSON through the call, the result is no longer the same.</p>\n\n<p>I have to be able to pass the original <code>[]byte</code>, created by the encryption function, through JSON or otherwise pass the <code>[]byte</code> through a call like the one you can see below. Another possibility is to change the decryption function, but I have not succeeded.</p>\n\n<p>caller function</p>\n\n<pre><code>func Dati_mono(c *gin.Context) {\n   id := c.Param(\"id\")\n   oracle, err := http.Get(\"http://XXXX/\"+id)\n   if err != nil {\n       panic(err)\n   }\n   defer oracle.Body.Close()\n\n   oJSON, err := ioutil.ReadAll(oracle.Body)\n   if err != nil {\n       panic(err)\n   }\n\n   oracleJSON := security.Decrypt(oJSON, keyEn)\n\n   c.JSON(http.StatusOK, string(oJSON))\n}\n</code></pre>\n\n<p>function that is called with the url</p>\n\n<pre><code>func Dati(c *gin.Context) {\n    var (\n       person Person\n       result mapstring.Dati_Plus\n       mmap []map[string]interface{}\n    )\n\n    rows, err := db.DBConor.Query(\"SELECT COD_DIPENDENTE, MATRICOLA, COGNOME FROM ANDIP021_K\")\n\n    if err != nil {\n       fmt.Print(err.Error())\n    }\n\n    for rows.Next() {\n       err = rows.Scan(&amp;person.COD_DIPENDENTE, &amp;person.MATRICOLA, &amp;person.COGNOME)\n       ciao := structs.Map(&amp;person)\n       mmap = append(mmap, ciao)\n    }\n    defer rows.Close()\n\n    result = mapstring.Dati_Plus{\n       len(mmap),\n        mmap,\n    }\n\n    jsonEn := []byte(mapstring.Dati_PlustoStr(result))\n    keyEn := []byte(key)\n\n    cipherjson, err := security.Encrypt(jsonEn, keyEn)\n    if err != nil {\n       log.Fatal(err)\n    }\n\n    c.JSON(http.StatusOK, cipherjson)\n}\n</code></pre>\n\n<p>encryption and decryption functions</p>\n\n<pre><code>func Encrypt(json []byte, key []byte) (string, error) {\n    k, err := aes.NewCipher(key)\n    if err != nil {\n       return \"nil\", err\n    }\n\n    gcm, err := cipher.NewGCM(k)\n    if err != nil {\n       return \"nil\", err\n    }\n\n    nonce := make([]byte, gcm.NonceSize())\n    if _, err = io.ReadFull(rand.Reader, nonce); err != nil {\n       return \"nil\", err\n    }\nreturn gcm.Seal(nonce, nonce, json, nil), nil\n        }\n\nfunc Decrypt(cipherjson []byte, key []byte) ([]byte, error) {\n    k, err := aes.NewCipher(key)\n    if err != nil {\n       return nil, err\n    }\n\n    gcm, err := cipher.NewGCM(k)\n    if err != nil {\n       return nil, err\n    }\n\n    nonceSize := gcm.NonceSize()\n    if len(cipherjson) &lt; nonceSize {\n        return nil, errors.New(\"cipherjson too short\")\n    }\n\n    nonce, cipherjson := cipherjson[:nonceSize], cipherjson[nonceSize:]\n    return gcm.Open(nil, nonce, cipherjson, nil)\n}\n</code></pre>\n\n<p>Everything works, the problem is created when I print <code>cipherjson</code> in <code>c.JSON ()</code>: the <code>[]byte</code> is translated into a string.\nAt the time it is taken and read by the calling function it is read as string and ioutil.ReadAll () creates the [] byte of the read string.\nInstead I must be able to pass to the Decryot function the return of the Encrypt function used in the called function.</p>\n\n<p>I hope I was clear, thanks in advance</p>\n"}, {"tags": ["go", "goroutine", "gopacket"], "comments": [{"owner": {"reputation": 71, "user_id": 5966443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1a6f94d55e39f2f31cbc71e3bd1c44f?s=128&d=identicon&r=PG&f=1", "display_name": "HSAR", "link": "https://stackoverflow.com/users/5966443/hsar"}, "edited": false, "score": 0, "creation_date": 1617236548, "post_id": 51706203, "comment_id": 118251484, "body": "Did you fix your issue?"}], "owner": {"reputation": 11, "user_id": 8030565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0621eb61f1ce7a02629012b67aa1644?s=128&d=identicon&r=PG&f=1", "display_name": "Pooja", "link": "https://stackoverflow.com/users/8030565/pooja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 261, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1533556562, "creation_date": 1533553605, "last_edit_date": 1533556562, "question_id": 51706203, "link": "https://stackoverflow.com/questions/51706203/runtime-error-when-i-use-goroutines-to-capture-packets-from-multiple-interfaces", "title": "Runtime error when I use goroutines to capture packets from multiple interfaces device using &quot;github.com/google/gopacket/pcap&quot;", "body": "<p>I want to capture packets on 4 interfaces devices eth0, eth1, eth2, and eth3 by using \"github.com/google/gopacket/pcap\" . The machine I am using have large number of traffic. Lets say it is in lacks per minute. I used goroutines to capture packets on each device parallely. </p>\n\n<p>I get one of following error after some time (after 1 hour less or more) when I run my binary of code on centOS 7 machine.</p>\n\n<blockquote>\n  <p>1) runtime: pointer 0xc441198b80 to unallocated span idx=0x108cc\n  span.base()=0xc441196000 span.limit=0xc441197ff0 span.state=3 fatal\n  error: found bad pointer in Go heap (incorrect use of unsafe or cgo?)</p>\n  \n  <p>2) Segmentation fault</p>\n  \n  <p>3) fatal error: systemstack called from unexpected goroutine\n  Segmentation fault</p>\n</blockquote>\n\n<p>How I am using goroutines-</p>\n\n<pre><code>func main(){\n             done = make(chan bool)\n             var status bool = true\n             for _, interface_device := range util.ConfigDetails.InterfaceDeviceList{\n                   go func(device string) {           \n                       status = CapturePackets(device)\n                       fmt.Println(\"status is\", status)\n                       done &lt;- true\n                }(interface_device)\n              }\n             // wait for all goroutines to complete before exiting\n               for _ = range util.ConfigDetails.InterfaceDeviceList {\n                 &lt;-done\n               }\n\n    }\n\n    func CapturePackets(device string) bool {\n\n       handle, err = pcap.OpenLive(device, snapshot_len, promiscuous, pcap.BlockForever)\n        if err != nil {\n            util.Log.Errorf(\"%v\",err)\n        }\n\n        defer handle.Close()\n\n        packetSource := gopacket.NewPacketSource(handle, handle.LinkType())\n        parser := gopacket.NewDecodingLayerParser(\n                layers.LayerTypeEthernet,\n                &amp;ethLayer,\n                &amp;ipLayer,\n                &amp;ip6Layer,\n                &amp;tcpLayer,\n                &amp;udpLayer,\n                &amp;payload,\n            )\n    for packet := range packetSource.Packets() {\n     foundLayerTypes := []gopacket.LayerType{}\n     var ip_source,ip_dest net.IP\n\n            for _, layerType := range foundLayerTypes {\n\n                if layerType == layers.LayerTypeIPv4 {\n                    ip_source = ipLayer.SrcIP\n                    ip_dest = ipLayer.DstIP\n                }\n\n                if layerType == layers.LayerTypeIPv6 {\n                    ip_source = ip6Layer.SrcIP\n                    ip_dest = ip6Layer.DstIP\n                }\n          fmt.Println(ip_source)\n          fmt.Println(ip_dest)\n      }\n    }\n return true\n    }\n</code></pre>\n\n<p>Please do help me.</p>\n"}, {"tags": ["json", "go", "slice"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1533549219, "post_id": 51704860, "comment_id": 90370611, "body": "These are JSON arrays."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 2, "creation_date": 1533549257, "post_id": 51704860, "comment_id": 90370625, "body": "It can be decoded into a <code>[][] string</code>. Is that desired?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 2, "creation_date": 1533549401, "post_id": 51704860, "comment_id": 90370713, "body": "@leafbebop The JSON contains a JSON number, that can&#39;t be unmarshaled into <code>string</code> directly."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1533549492, "post_id": 51704860, "comment_id": 90370771, "body": "@icza on mobile and I didn&#39;t scroll it to the very end. I see. Still, the desired results remain unclear."}], "answers": [{"comments": [{"owner": {"reputation": 167, "user_id": 5057595, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZTul.jpg?s=128&g=1", "display_name": "Munosphere", "link": "https://stackoverflow.com/users/5057595/munosphere"}, "edited": false, "score": 1, "creation_date": 1533549766, "post_id": 51704936, "comment_id": 90370927, "body": "Or you can just declare <code>result</code> as <code>var result [][]interface{}</code> directly"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 167, "user_id": 5057595, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RZTul.jpg?s=128&g=1", "display_name": "Munosphere", "link": "https://stackoverflow.com/users/5057595/munosphere"}, "edited": false, "score": 1, "creation_date": 1533549832, "post_id": 51704936, "comment_id": 90370967, "body": "@BarryLau Yes it will work the same. Still OP need type assertion to fetch the underlying value."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 2, "last_activity_date": 1533550406, "last_edit_date": 1533550406, "creation_date": 1533549320, "answer_id": 51704936, "question_id": 51704860, "link": "https://stackoverflow.com/questions/51704860/decode-slice-of-string-and-integers/51704936#51704936", "title": "Decode slice of string and integers", "body": "<p>For your question:-</p>\n\n<blockquote>\n  <p>Can I decode this using the json decoder with [][]interface{}</p>\n</blockquote>\n\n<p>Yes you can there is nothing wrong with decoding the JSON output. This is an array of JSON.</p>\n\n<pre><code>[[\"9BC67ACD\", \"example1\", \"example1.co.uk\", \"2018-08-06 08:46:44\", \"2018-08-06 08:46:44\", \"2018-08-06 08:46:44\", \"FINISHED\", 1], [\"B339CBA2\", \"example2\", \"example2.co.uk\", \"2018-08-06 08:38:25\", \"2018-08-06 08:38:24\", \"2018-08-06 08:38:27\", \"FINISHED\", 1]]\n</code></pre>\n\n<p>Or you can Unmarshal the JSON into an interface{}. But in both cases you need type assertion to fetch the underlying value of an interface.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nvar jsonBytes string = `[[\"9BC67ACD\", \"example1\", \"example1.co.uk\", \"2018-08-06 08:46:44\", \"2018-08-06 08:46:44\", \"2018-08-06 08:46:44\", \"FINISHED\", 1], [\"B339CBA2\", \"example2\", \"example2.co.uk\", \"2018-08-06 08:38:25\", \"2018-08-06 08:38:24\", \"2018-08-06 08:38:27\", \"FINISHED\", 1]]`\n\nfunc main() {\n    var result interface{}\n    if err := json.Unmarshal([]byte(jsonBytes), &amp;result); err != nil{\n        fmt.Println(err)\n    }\n    fetchValue(result) // This function recursively get the underlying value of an interface.\n}\n\nfunc fetchValue(value interface{}) {\n    switch value.(type) {\n    case string:\n        fmt.Printf(\"%v is an string \\n \", value.(string))\n    case bool:\n        fmt.Printf(\"%v is bool \\n \", value.(bool))\n    case float64:\n        fmt.Printf(\"%v is float64 \\n \", value.(float64))\n    case []interface{}:\n        fmt.Printf(\"%v is a slice of interface \\n \", value)\n        for _, v := range value.([]interface{}) {\n            fetchValue(v)\n        }\n    case map[string]interface{}:\n        fmt.Printf(\"%v is a map \\n \", value)\n        for _, v := range value.(map[string]interface{}) {\n            fetchValue(v)\n        }\n    default:\n        fmt.Printf(\"%v is unknown \\n \", value)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/I6q4CPi2Gvo\" rel=\"nofollow noreferrer\">Playground example</a></p>\n"}], "owner": {"reputation": 457, "user_id": 4489733, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/10714df646d369c5a41225156d051cac?s=128&d=identicon&r=PG&f=1", "display_name": "mbudge", "link": "https://stackoverflow.com/users/4489733/mbudge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 51704936, "answer_count": 1, "score": 0, "last_activity_date": 1533573777, "creation_date": 1533549042, "last_edit_date": 1533573777, "question_id": 51704860, "link": "https://stackoverflow.com/questions/51704860/decode-slice-of-string-and-integers", "title": "Decode slice of string and integers", "body": "<p>How do you decode a slice of strings and integers which don't have field names?</p>\n\n<p>This is the output from the remote API I am trying to decode:</p>\n\n<pre><code>[[\"9BC67ACD\", \"example1\", \"example1.co.uk\", \"2018-08-06 08:46:44\", \"2018-08-06 08:46:44\", \"2018-08-06 08:46:44\", \"FINISHED\", 1], [\"B339CBA2\", \"example2\", \"example2.co.uk\", \"2018-08-06 08:38:25\", \"2018-08-06 08:38:24\", \"2018-08-06 08:38:27\", \"FINISHED\", 1]]\n</code></pre>\n\n<p>I get this as a slice of bytes after doing </p>\n\n<pre><code>rBody, err := ioutil.ReadAll(r.Body)\n</code></pre>\n\n<p>Can I decode this using the json decoder with <code>[][]interface{}</code>?</p>\n"}, {"tags": ["go", "etcd"], "comments": [{"owner": {"reputation": 733, "user_id": 1923870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c944e861fd936269ca103dad584f190b?s=128&d=identicon&r=PG&f=1", "display_name": "Kay", "link": "https://stackoverflow.com/users/1923870/kay"}, "edited": false, "score": 2, "creation_date": 1533549102, "post_id": 51704533, "comment_id": 90370535, "body": "Please let us know what kind of research have you already done in the matter, and where it led you. See also <a href=\"https://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a>"}, {"owner": {"reputation": 11, "user_id": 10185893, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64f2f483b9c28637dd92f8dc2c1d50dd?s=128&d=identicon&r=PG&f=1", "display_name": "tjrone", "link": "https://stackoverflow.com/users/10185893/tjrone"}, "reply_to_user": {"reputation": 733, "user_id": 1923870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c944e861fd936269ca103dad584f190b?s=128&d=identicon&r=PG&f=1", "display_name": "Kay", "link": "https://stackoverflow.com/users/1923870/kay"}, "edited": false, "score": 0, "creation_date": 1533555776, "post_id": 51704533, "comment_id": 90374247, "body": "I have set up my etcd cluster and i want to communicate with the etcd server on cloud provider using golang, so i looked for some demos and try to figure it out."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 10185893, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64f2f483b9c28637dd92f8dc2c1d50dd?s=128&d=identicon&r=PG&f=1", "display_name": "tjrone", "link": "https://stackoverflow.com/users/10185893/tjrone"}, "edited": false, "score": 0, "creation_date": 1533555506, "post_id": 51704850, "comment_id": 90374074, "body": "thx. I am a golang noob."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 2, "last_activity_date": 1533549001, "creation_date": 1533549001, "answer_id": 51704850, "question_id": 51704533, "link": "https://stackoverflow.com/questions/51704533/why-the-struct-client-in-coreos-etcd-clientv3-client-go-has-the-method-put/51704850#51704850", "title": "Why the struct Client (in coreos/etcd/clientv3/client.go) has the method PUT", "body": "<p>As per <a href=\"https://godoc.org/github.com/coreos/etcd/clientv3#Client\" rel=\"nofollow noreferrer\">godoc</a></p>\n\n<pre><code>type Client struct {\n    Cluster\n    KV\n    Lease\n    Watcher\n    Auth\n    Maintenance\n\n    // Username is a user name for authentication.\n    Username string\n    // Password is a password for authentication.\n    Password string\n    // contains filtered or unexported fields\n}\n</code></pre>\n\n<p>It means that a <code>Client</code> embeds a <code>KV</code>. So when calling <code>Client.Put()</code> the  <code>Put()</code> method of <code>KV</code> is promoted and used instead.</p>\n\n<p>Read more: <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Struct_types</a></p>\n"}], "owner": {"reputation": 11, "user_id": 10185893, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64f2f483b9c28637dd92f8dc2c1d50dd?s=128&d=identicon&r=PG&f=1", "display_name": "tjrone", "link": "https://stackoverflow.com/users/10185893/tjrone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "closed_date": 1533564540, "answer_count": 1, "score": 0, "last_activity_date": 1533549001, "creation_date": 1533547956, "last_edit_date": 1533548005, "question_id": 51704533, "link": "https://stackoverflow.com/questions/51704533/why-the-struct-client-in-coreos-etcd-clientv3-client-go-has-the-method-put", "closed_reason": "Needs details or clarity", "title": "Why the struct Client (in coreos/etcd/clientv3/client.go) has the method PUT", "body": "<p>The method PUT is in the interface KV, but the struct Client doesn't implement the the method in interface <code>KV</code>. So why it can use the method like this:</p>\n\n<pre><code>cli, err := clientv3.New(.....)\ncli.Put(...)\n</code></pre>\n"}, {"tags": ["go", "twitter", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1533547045, "post_id": 51704212, "comment_id": 90369291, "body": "For stopping go routines in the middle send a signal using channel to stop the go routine."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533559741, "post_id": 51704212, "comment_id": 90376938, "body": "Have you tried anything? If so, could you post the relevant code?"}, {"owner": {"reputation": 9, "user_id": 8016249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Cn7AL_ak3ow/AAAAAAAAAAI/AAAAAAAABVk/MKOL6eu1D90/photo.jpg?sz=128", "display_name": "Hafiz Jefri", "link": "https://stackoverflow.com/users/8016249/hafiz-jefri"}, "edited": false, "score": 0, "creation_date": 1533631113, "post_id": 51704212, "comment_id": 90405136, "body": "edited post with code"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1533547348, "last_edit_date": 1533547348, "creation_date": 1533547040, "answer_id": 51704258, "question_id": 51704212, "link": "https://stackoverflow.com/questions/51704212/cancelling-user-specific-goroutines/51704258#51704258", "title": "Cancelling user specific goroutines", "body": "<p>You can't stop a goroutine from the outside, the goroutine has to support the cancellation operation. For details, see: <a href=\"https://stackoverflow.com/questions/28240133/cancel-a-blocking-operation-in-go/28240299#28240299\">cancel a blocking operation in Go</a>. Common means to support cancellation is channels and the <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\"><code>context</code></a> package.</p>\n\n<p>As to which is better for you, that's too broad. That depends on many things, but for an example / reference, the standard lib's HTTP server serves each incoming HTTP request in its own goroutine, and has a decent performance.</p>\n\n<p>If you have a high request rate, it might worth creating and using a goroutine pool (or use a 3rd party lib / router that does this), but it really depends on your actual code, you should measure / profile your app to decide if it's needed or if it's worth it.</p>\n\n<p>Generally we can say that if the work that each goroutine does is \"big\" compared to the overhead of the creation / scheduling a goroutine requires, it is usually cleaner to just use a new goroutine for it. Accessing 3rd party services in a goroutine such as the Twitter API will likely have orders of magnitude more work and delay than launching a goroutine, so you should be fine launching a goroutine for each of those (without a performance penalty).</p>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1533547075, "creation_date": 1533547075, "answer_id": 51704267, "question_id": 51704212, "link": "https://stackoverflow.com/questions/51704212/cancelling-user-specific-goroutines/51704267#51704267", "title": "Cancelling user specific goroutines", "body": "<blockquote>\n  <p>how do I stop [...] go routines</p>\n</blockquote>\n\n<p>You start the goroutine with e.g. a done channel and you stop your goroutine once the done channel is closed.</p>\n\n<blockquote>\n  <p>what is the best practices of creating go routines in order to maximize the performance of the apps considering the http request and twitter API limit</p>\n</blockquote>\n\n<p>That question is too broad.</p>\n"}], "owner": {"reputation": 9, "user_id": 8016249, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Cn7AL_ak3ow/AAAAAAAAAAI/AAAAAAAABVk/MKOL6eu1D90/photo.jpg?sz=128", "display_name": "Hafiz Jefri", "link": "https://stackoverflow.com/users/8016249/hafiz-jefri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 0, "closed_date": 1533567324, "accepted_answer_id": 51704258, "answer_count": 2, "score": -2, "last_activity_date": 1533630962, "creation_date": 1533546875, "last_edit_date": 1533630962, "question_id": 51704212, "link": "https://stackoverflow.com/questions/51704212/cancelling-user-specific-goroutines", "closed_reason": "Needs more focus", "title": "Cancelling user specific goroutines", "body": "<p>I have an apps(web apps) that let user sign in using twitter oauth and provide automatic tweet deletion functionalities. After the user logged in into the web app I will spin up a goroutines (via REST api) for each user that will delete list of users tweets.</p>\n\n<p>let say there will be 100 users with 500++ tweets per user:</p>\n\n<ul>\n<li><p>how do I stop the deletion go routines in the middle of deletion process. </p>\n\n<p>eg: user 30 is requesting to stop deletion of tweets after initiating the delete process for 2mins (this should be done via an API call to my apps).</p></li>\n<li>what is the best practices of creating go routines in order to maximize the performance of the apps considering the http request and twitter API limit. should I create go routines per user or implement worker pool?</li>\n</ul>\n\n<p>info: I am using <a href=\"https://github.com/ChimeraCoder/anaconda\" rel=\"nofollow noreferrer\">anaconda</a> for the twitter client backend</p>\n\n<hr>\n\n<p>Edit:</p>\n\n<p>I have found a way to implement this using map with context. Here's the code for reference. credit to <a href=\"https://gist.github.com/montanaflynn/020e75c6605dbe2c726e410020a7a974\" rel=\"nofollow noreferrer\">https://gist.github.com/montanaflynn/020e75c6605dbe2c726e410020a7a974</a></p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\n// a concurrent safe map type by embedding sync.Mutex\ntype cancelMap struct {\n    sync.Mutex\n    internal map[string]context.CancelFunc\n}\n\nfunc newCancelMap() *cancelMap {\n    return &amp;cancelMap{\n        internal: make(map[string]context.CancelFunc),\n    }\n}\n\nfunc (c *cancelMap) Get(key string) (value context.CancelFunc, ok bool) {\n    c.Lock()\n    result, ok := c.internal[key]\n    c.Unlock()\n    return result, ok\n}\n\nfunc (c *cancelMap) Set(key string, value context.CancelFunc) {\n    c.Lock()\n    c.internal[key] = value\n    c.Unlock()\n}\n\nfunc (c *cancelMap) Delete(key string) {\n    c.Lock()\n    delete(c.internal, key)\n    c.Unlock()\n}\n\n// create global jobs map with cancel function\nvar jobs = newCancelMap()\n\n// the pretend worker will be wrapped here\n// https://siadat.github.io/post/context\nfunc work(ctx context.Context, id string) {\n\n    for {\n        select {\n        case &lt;-ctx.Done():\n            fmt.Printf(\"Cancelling job id %s\\n\", id)\n            return\n        case &lt;-time.After(time.Second):\n            fmt.Printf(\"Doing job id %s\\n\", id)\n        }\n    }\n}\n\nfunc startHandler(w http.ResponseWriter, r *http.Request) {\n\n    // get job id and name from query parameters\n    id := r.URL.Query().Get(\"id\")\n\n    // check if job already exists in jobs map\n    if _, ok := jobs.Get(id); ok {\n        fmt.Fprintf(w, \"Already started job id: %s\\n\", id)\n        return\n    }\n\n    // create new context with cancel for the job\n    ctx, cancel := context.WithCancel(context.Background())\n\n    // save it in the global map of jobs\n    jobs.Set(id, cancel)\n\n    // actually start running the job\n    go work(ctx, id)\n\n    // return 200 with message\n    fmt.Fprintf(w, \"Job id: %s has been started\\n\", id)\n}\n\nfunc stopHandler(w http.ResponseWriter, r *http.Request) {\n\n    // get job id and name from query parameters\n    id := r.URL.Query().Get(\"id\")\n\n    // check for cancel func from jobs map\n    cancel, found := jobs.Get(id)\n    if !found {\n        fmt.Fprintf(w, \"Job id: %s is not running\\n\", id)\n        return\n    }\n\n    // cancel the jobs\n    cancel()\n\n    // delete job from jobs map\n    jobs.Delete(id)\n\n    // return 200 with message\n    fmt.Fprintf(w, \"Job id: %s has been canceled\\n\", id)\n}\n\nfunc main() {\n    http.HandleFunc(\"/start\", startHandler)\n    http.HandleFunc(\"/stop\", stopHandler)\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n"}, {"tags": ["dictionary", "go", "methods", "interface"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1533546746, "post_id": 51704117, "comment_id": 90369122, "body": "&quot;the list of builtin map type method&quot; What exactly are you looking for?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1533546765, "post_id": 51704117, "comment_id": 90369130, "body": "go-maps-in-action provide all the relative information for methods. Other things depends on requirements. What are your requirements of using maps. You should implement the maps and then ask if something you wants to know about maps."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1533546784, "creation_date": 1533546784, "answer_id": 51704187, "question_id": 51704117, "link": "https://stackoverflow.com/questions/51704117/builtin-map-methods-reference/51704187#51704187", "title": "Builtin map methods reference", "body": "<p>Map types in Go do not implement any interfaces (except the empty interface <code>interface{}</code>) because map types have no methods.</p>\n\n<p>To verify:</p>\n\n<pre><code>fmt.Println(reflect.TypeOf(map[int]int{}).NumMethod())\n</code></pre>\n\n<p>Which prints (try it on the <a href=\"https://play.golang.org/p/HWvrTA4wZnV\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0\n</code></pre>\n\n<p>Setting / getting / removing elements from a map is covered by the language spec (e.g. <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">Index expressions</a>). Also the number of entries in a map is a builtin function: <a href=\"https://golang.org/pkg/builtin/#len\" rel=\"nofollow noreferrer\"><code>len()</code></a>.</p>\n"}], "owner": {"reputation": 2442, "user_id": 1616677, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/arb4K.jpg?s=128&g=1", "display_name": "VladimirLenin", "link": "https://stackoverflow.com/users/1616677/vladimirlenin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "closed_date": 1533562908, "answer_count": 1, "score": -2, "last_activity_date": 1533547459, "creation_date": 1533546528, "last_edit_date": 1533547459, "question_id": 51704117, "link": "https://stackoverflow.com/questions/51704117/builtin-map-methods-reference", "closed_reason": "Needs details or clarity", "title": "Builtin map methods reference", "body": "<p>Please help to find the list of builtin map type method. Sources are OK. I see <code>Add</code> and <code>Set</code> in different examples and I would like to know the difference.</p>\n\n<p>The following was found but gives no help:</p>\n\n<p><a href=\"https://golang.org/src/runtime/hashmap.go\" rel=\"nofollow noreferrer\">https://golang.org/src/runtime/hashmap.go</a> - implementation, but where is the interface?\n<a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-maps-in-action</a> - an article on maps, but can't find the complete method list.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1533543505, "post_id": 51702279, "comment_id": 90367397, "body": "Did you distribute the source to all your machines? or did you only distribute the binary executable? And if you did distribute the source, is it at the same location on each machine? with the same goenv (GOPATH, etc.)? (Not sure whether that&#39;s required but I imagine it would be)."}, {"owner": {"reputation": 117, "user_id": 1406669, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Fys97.jpg?s=128&g=1", "display_name": "El Gohr", "link": "https://stackoverflow.com/users/1406669/el-gohr"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1533560408, "post_id": 51702279, "comment_id": 90377426, "body": "The errors is happening when running the tests.    See <a href=\"https://travis-ci.org/maxbrunsfeld/counterfeiter/jobs/412389617\" rel=\"nofollow noreferrer\">travis-ci.org/maxbrunsfeld/counterfeiter/jobs/412389617</a>   Running the same on localhost works fine..."}], "owner": {"reputation": 117, "user_id": 1406669, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Fys97.jpg?s=128&g=1", "display_name": "El Gohr", "link": "https://stackoverflow.com/users/1406669/el-gohr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 162, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1533539383, "creation_date": 1533539383, "question_id": 51702279, "link": "https://stackoverflow.com/questions/51702279/could-not-import-path-config-importer-not-installed", "title": "could not import path (Config.Importer not installed)", "body": "<p>When I use </p>\n\n<pre><code>import (\n\"go/types\"\n\"go/importer\"\n)\n\nconf := types.Config{\n    Importer: importer.For(\"source\", nil),\n}\npkg, err := conf.Check(importSpec.Path.Value, fset, files, nil)\n</code></pre>\n\n<p>This errors on some machines saying </p>\n\n<blockquote>\n  <p>could not import path (Config.Importer not installed)  </p>\n</blockquote>\n\n<p>(see <a href=\"https://golang.org/src/go/types/resolver.go\" rel=\"nofollow noreferrer\">https://golang.org/src/go/types/resolver.go</a> - line 155)</p>\n\n<p>For my usecase I can't use the importer.Default().<br>\nWhy is this failing on some machines? What can I do to get the source importer on all machines?</p>\n"}, {"tags": ["go", "integration-testing"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1533538855, "post_id": 51702102, "comment_id": 90365312, "body": "Show us how your app reads from its standard input, and\u2013just in case\u2013the <code>setStdin()</code> implementation. Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1533538908, "post_id": 51702102, "comment_id": 90365334, "body": "Change the command to <code>cat</code> to see if <code>setStdin</code> works. If it works, it is your cli app&#39;s problem and we would need to see how it cosumes from stdin."}, {"owner": {"reputation": 2569, "user_id": 228648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1529c12e371e2e39c92230d292bdd77d?s=128&d=identicon&r=PG", "display_name": "Anis", "link": "https://stackoverflow.com/users/228648/anis"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1533539937, "post_id": 51702102, "comment_id": 90365749, "body": "@leafbebop , I guess, it&#39;s working (at least initially) because I am getting first answer correctly.   @icza , added <code>setStdin</code>   Thanks both of you!"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1533540023, "post_id": 51702102, "comment_id": 90365787, "body": "@Anis I doubt that. Try add a <code>tmpfile.Sync()</code> before <code>Seek</code>. And, in such a case, I would argue <code>bytes.Buffer</code> is far better than a temp file."}], "answers": [{"comments": [{"owner": {"reputation": 2569, "user_id": 228648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1529c12e371e2e39c92230d292bdd77d?s=128&d=identicon&r=PG", "display_name": "Anis", "link": "https://stackoverflow.com/users/228648/anis"}, "edited": false, "score": 0, "creation_date": 1533541378, "post_id": 51702545, "comment_id": 90366377, "body": "Perfectly worked! Thank you so much! BTW, using <code>strings.NewReader</code> instead of tmpFile and it&#39;s a lot handy +1"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1533540892, "last_edit_date": 1533540892, "creation_date": 1533540508, "answer_id": 51702545, "question_id": 51702102, "link": "https://stackoverflow.com/questions/51702102/getting-eof-on-2nd-prompt-when-using-a-file-as-stdin-golang/51702545#51702545", "title": "Getting EOF on 2nd prompt when using a file as Stdin (Golang)", "body": "<p>It pretty much looks like in your app your call <code>Ask()</code> whenever you want a <em>single</em> input line.</p>\n\n<p>Inside <code>Ask()</code> you create a <a href=\"https://golang.org/pkg/bufio/#Reader\" rel=\"nofollow noreferrer\"><code>bufio.Reader</code></a> to read from <code>os.Stdin</code>. Know that <code>bufio.Reader</code>\u2013as its name suggests\u2013uses buffered reading, meaning it may read more data from its source than what is returned by its methods (<a href=\"https://golang.org/pkg/bufio/#Reader.ReadString\" rel=\"nofollow noreferrer\"><code>Reader.ReadString()</code></a> in this case). Which means if you just use it to read one (or some) lines and you throw away the reader, <em>you will throw away buffered, unread data</em>.</p>\n\n<p>So next time you call <code>Ask()</code> again, attempting to read from <code>os.Stdin</code>, you will not continue from where you left off...</p>\n\n<p>To fix this issue, only create a single <code>bufio.Reader</code> from <code>os.Stdin</code>, store it in a global variable for example, and inside <code>Ask()</code>, always use this single reader. So buffered and unread data will not be lost between <code>Ask()</code> calls. Of course this solution will not be valid to call from multiple goroutines, but reading from a single <code>os.Stdin</code> isn't either.</p>\n\n<p>For example:</p>\n\n<pre><code>var reader = bufio.NewReader(os.Stdin)\n\nfunc Ask(question string, minLen int) string {\n    // use the global reader here...\n}\n</code></pre>\n\n<p>Also note that using <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"nofollow noreferrer\"><code>bufio.Scanner</code></a> would be easier in your case. But again, <code>bufio.Scanner</code> may also read more data from its source than needed, so you have to use a shared <code>bufio.Scanner</code> here too. Also note that <code>Reader.ReadString()</code> returns you a string containing the delimeter (a line ending with <code>\\n</code> in your case) which you probably have to trim, while <a href=\"https://golang.org/pkg/bufio/#Scanner.Text\" rel=\"nofollow noreferrer\"><code>Scanner.Text()</code></a> (with the default line splitting function) will strip that first before returning the line. That's also a simplification you can take advantage of.</p>\n"}], "owner": {"reputation": 2569, "user_id": 228648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1529c12e371e2e39c92230d292bdd77d?s=128&d=identicon&r=PG", "display_name": "Anis", "link": "https://stackoverflow.com/users/228648/anis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 356, "favorite_count": 0, "accepted_answer_id": 51702545, "answer_count": 1, "score": 0, "last_activity_date": 1533540892, "creation_date": 1533538647, "last_edit_date": 1533539606, "question_id": 51702102, "link": "https://stackoverflow.com/questions/51702102/getting-eof-on-2nd-prompt-when-using-a-file-as-stdin-golang", "title": "Getting EOF on 2nd prompt when using a file as Stdin (Golang)", "body": "<p>I am trying to do functional testing of a cli app similar to <a href=\"http://lucapette.me/writing-integration-tests-for-a-go-cli-application\" rel=\"nofollow noreferrer\">this way</a>.</p>\n\n<p>As the command asks a few input on command prompt, I am putting them in a file and setting it as os.Stdin.</p>\n\n<pre><code>cmd := exec.Command(path.Join(dir, binaryName), \"myArg\")\ntmpfile := setStdin(\"TheMasterPassword\\nSecondAnswer\\n12121212\\n\")\ncmd.Stdin = tmpfile\noutput, err := cmd.CombinedOutput()\n</code></pre>\n\n<p>The <code>setStdin</code> just creates a tmpFile, write the string in file and returns the <code>*os.File</code>.</p>\n\n<p>Now, I am expecting <code>TheMasterPassword</code> to be first input, and it's working. But for the second input always getting <code>Critical Error: EOF</code>. </p>\n\n<p>The function I am using for asking and getting user input this :</p>\n\n<pre><code>func Ask(question string, minLen int) string {\n    reader := bufio.NewReader(os.Stdin)\n\n    for {\n        fmt.Printf(\"%s: \", question)\n\n        response, err := reader.ReadString('\\n')\n        ExitIfError(err)\n\n        if len(response) &gt;= minLen {\n            return strings.TrimSpace(response)\n        } else {\n            fmt.Printf(\"Provide at least %d character.\\n\", minLen)\n        }\n    }\n}\n</code></pre>\n\n<p>Can you please help me to find out what's going wrong?\nThanks a lot!</p>\n\n<p>Adding <code>setStdin</code> as requested</p>\n\n<pre><code>func setStdin(userInput string) *os.File {\n    tmpfile, err := ioutil.TempFile(\"\", \"test_stdin_\")\n    util.ExitIfError(err)\n\n    _, err = tmpfile.Write([]byte(userInput))\n    util.ExitIfError(err)\n    _, err = tmpfile.Seek(0, 0)\n    util.ExitIfError(err)\n\n    return tmpfile\n}\n</code></pre>\n"}, {"tags": ["go", "visual-studio-code", "delve"], "answers": [{"tags": [], "owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "is_accepted": false, "score": 0, "last_activity_date": 1533534713, "creation_date": 1533534713, "answer_id": 51701249, "question_id": 51700516, "link": "https://stackoverflow.com/questions/51700516/how-to-debug-restapi-deployed-on-local-server-using-vs-code-for-go-language/51701249#51701249", "title": "How to debug RestApi deployed on local server using Vs code for Go Language", "body": "<p>VSCode has pretty good wiki page about it on their <a href=\"https://github.com/Microsoft/vscode-go/wiki/Debugging-Go-code-using-VS-Code\" rel=\"nofollow noreferrer\">GitHub</a></p>\n\n<p>I do not want to quote whole docs here. Quick summary of steps would be:</p>\n\n<ol>\n<li>Install delve</li>\n<li>Set up configurations in <code>launch.json</code></li>\n</ol>\n\n<p>And you are ready.</p>\n"}, {"tags": [], "owner": {"reputation": 4628, "user_id": 744534, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/iWWdZ.jpg?s=128&g=1", "display_name": "Thaadikkaaran", "link": "https://stackoverflow.com/users/744534/thaadikkaaran"}, "is_accepted": false, "score": 0, "last_activity_date": 1533535194, "creation_date": 1533535194, "answer_id": 51701350, "question_id": 51700516, "link": "https://stackoverflow.com/questions/51700516/how-to-debug-restapi-deployed-on-local-server-using-vs-code-for-go-language/51701350#51701350", "title": "How to debug RestApi deployed on local server using Vs code for Go Language", "body": "<p>Hope you have proper Go lang setup for VS Code. Otherwise just check <a href=\"https://www.jaganathanb.in/2018/07/how-to-start-with-go-language-googles.html\" rel=\"nofollow noreferrer\">this</a> link.</p>\n\n<p><strong>Note:</strong> You have to run your Go RestApi through VS Code</p>\n"}], "owner": {"reputation": 1, "user_id": 4989213, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SoeuRmtaBLY/AAAAAAAAAAI/AAAAAAAAAAA/cgeYg2qsEco/photo.jpg?sz=128", "display_name": "Ashish Sinha", "link": "https://stackoverflow.com/users/4989213/ashish-sinha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 598, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1533535194, "creation_date": 1533529309, "question_id": 51700516, "link": "https://stackoverflow.com/questions/51700516/how-to-debug-restapi-deployed-on-local-server-using-vs-code-for-go-language", "title": "How to debug RestApi deployed on local server using Vs code for Go Language", "body": "<p>How to debug RestApi deployed on local server using Vs code for Go Language.\nI have gone through delve docs and made the settings. I have a local server, With java client i am trying to get the response. The localhost server is running on debug mode but flow is not stopping on breakpoints. The code is in Go language and i am using VSCode IDE.</p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1533518862, "post_id": 51699457, "comment_id": 90360494, "body": "&quot;it doesn&#39;t work&quot; is not a problem statement. In what way does it not work? What do you see happening? What do you expect instead?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1533519146, "post_id": 51699457, "comment_id": 90360542, "body": "Pouching? I have no idea what that means. But I read your entire question. Your question decidedly does <i>not</i> answer the question I asked you. Specifically: <b>What do you see happening? What do you expect instead?</b>"}, {"owner": {"reputation": 982, "user_id": 6554662, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154470556032446/picture?type=large", "display_name": "Andy", "link": "https://stackoverflow.com/users/6554662/andy"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1533519375, "post_id": 51699457, "comment_id": 90360580, "body": "I expecting it to return to <code>h.Message</code> , for some reason, when a channel is used in there, it stops returning <code>h.Message</code> when a <code>GET</code> request is made to the server. By removing any <code>channel</code> from the code, it then works."}], "answers": [{"tags": [], "owner": {"reputation": 8276, "user_id": 2058552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rymLy.jpg?s=128&g=1", "display_name": "Mukesh Sharma", "link": "https://stackoverflow.com/users/2058552/mukesh-sharma"}, "is_accepted": true, "score": 6, "last_activity_date": 1533536008, "last_edit_date": 1533536008, "creation_date": 1533528718, "answer_id": 51700457, "question_id": 51699457, "link": "https://stackoverflow.com/questions/51699457/using-channel-with-websocket/51700457#51700457", "title": "Using channel with websocket", "body": "<p>Unbuffered channels are blocking in nature, i.e. writing to channel (<code>hom.ch &lt;- \"message sent\"</code>) and reading from channel (<code>fmt.Println(&lt;-h.ch)</code>) block the go-routine.</p>\n\n<p>In your case, <code>http</code> server is not running because <code>hom.ch &lt;- \"message sent\"</code> blocks the execution. That's why <code>GET</code> request is not working.</p>\n\n<p>One simple solution can be to make it buffered channel instead.</p>\n"}], "owner": {"reputation": 982, "user_id": 6554662, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154470556032446/picture?type=large", "display_name": "Andy", "link": "https://stackoverflow.com/users/6554662/andy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 51700457, "answer_count": 1, "score": 1, "last_activity_date": 1533536008, "creation_date": 1533517671, "last_edit_date": 1533519944, "question_id": 51699457, "link": "https://stackoverflow.com/questions/51699457/using-channel-with-websocket", "title": "Using channel with websocket", "body": "<p>If I use a chan anywhere on main or func home, the application runs, but it doesn't really work. No errors thrown, however, it won't work.\nIf I remove the channels references, it goes back to working.\nEither by using a chan in a struct or a global channel the application stops working.</p>\n\n<p>In a <code>GET</code> request, it returns <code>h.Message</code> from <code>func home</code>\nby adding any channel in the code, <code>GET</code> request wont return the message.</p>\n\n<p><a href=\"https://play.golang.org/p/-ZVcLhZRRRG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-ZVcLhZRRRG</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/gorilla/websocket\"\n    // _ \"github.com/go-sql-driver/mysql\"\n)\n\ntype WMessage struct {\n    Message string `json:\"message\"`\n    ch      chan string\n}\n\nvar upgrader = websocket.Upgrader{\n    ReadBufferSize:  1024,\n    WriteBufferSize: 1024,\n    CheckOrigin: func(r *http.Request) bool {\n        return true\n    },\n}\n\nvar Chann chan string\n\nfunc (h *WMessage) home(w http.ResponseWriter, r *http.Request) {\n    h.Message = \"hey this is the message from home\"\n\n    fmt.Fprintln(w, h.Message)\n    fmt.Println(&lt;-h.ch)\n}\n\nfunc main() {\n    hom := &amp;WMessage{}\n\n    hom.ch = make(chan string)\n\n    hom.ch &lt;- \"message sent\"\n\n    http.HandleFunc(\"/\", hom.home)\n    err := http.ListenAndServe(\":3000\", nil)\n    if err != nil {\n        fmt.Println(\"there was an error -&gt; \", err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "recursion", "data-structures"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1533546498, "post_id": 51698879, "comment_id": 90368992, "body": "What is the real question? Your code compiles and runs just fine, so you have managed to come up with a type supporting recursive SNMP messages. So, what is the problem you&#39;re having with it? If it&#39;s about printing, then the solution is to have a <a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"nofollow noreferrer\">type switch</a> which would branch into different code paths depending on the actual type of <code>Value</code>\u2014possibly resursively."}, {"owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1533562870, "post_id": 51698879, "comment_id": 90379074, "body": "@kostix my question is on how to recurse through the structure"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 1, "last_activity_date": 1533564150, "creation_date": 1533564150, "answer_id": 51709450, "question_id": 51698879, "link": "https://stackoverflow.com/questions/51698879/recursively-define-snmp-message/51709450#51709450", "title": "Recursively Define SNMP Message", "body": "<p>The solution is to have a\n<a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"nofollow noreferrer\">type switch</a>\nwhich would branch into different code paths depending on the actual type of Value\u2014possibly resursively.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"reflect\"\n)\n\n// ASN.1 BER encoded types.\ntype ASN1BER byte\n\nconst (\n    Integer          ASN1BER = 0x02\n    BitString                = 0x03\n    OctetString              = 0x04\n    Null                     = 0x05\n    ObjectIdentifier         = 0x06\n    Sequence                 = 0x30\n    GetRequest               = 0xa0\n)\n\n// SNMP versions.\ntype Version byte\n\nconst (\n    Version1  Version = 0x00\n    Version2c         = 0x01\n)\n\n// SNMP message field.\ntype Field struct {\n    Type  ASN1BER\n    Len   int\n    Value interface{}\n}\n\nfunc walk(f *Field, indent string) error {\n    switch f.Type {\n    case GetRequest, Sequence:\n        indent += \"\\t\"\n        switch v := f.Value.(type) {\n        case *Field:\n            return walk(v, indent)\n        case []*Field:\n            for _, f := range v {\n                err := walk(f, indent)\n                if err != nil {\n                    return err\n                }\n            }\n        default:\n            return &amp;ValueTypeError{\n                ASNType:   f.Type,\n                ValueType: reflect.TypeOf(v),\n            }\n        }\n    default:\n        fmt.Printf(\"%sType: %d; value: %v\\n\", indent, f.Type, f.Value)\n    }\n    return nil\n}\n\ntype ValueTypeError struct {\n    ASNType   ASN1BER\n    ValueType reflect.Type\n}\n\nfunc (e *ValueTypeError) Error() string {\n    return fmt.Sprintf(\"invalid Go type (%s) for ASN1BER type %d\",\n        e.ValueType.Name(), e.ASNType)\n}\n\nfunc main() {\n    // SNMP Message\n    msg := Field{Type: Sequence, Len: 44, Value: []*Field{\n        // SNMP Version\n        {Type: Integer, Len: 1, Value: Version2c},\n        // Community String\n        {Type: OctetString, Len: 7, Value: []byte(\"private\")},\n        // Get-Request PDU\n        {Type: GetRequest, Len: 30, Value: []*Field{\n            // Request ID\n            {Type: Integer, Len: 1, Value: []byte{0x01}},\n            // Error Status\n            {Type: Integer, Len: 1, Value: []byte{0x00}},\n            // Error Index\n            {Type: Integer, Len: 1, Value: []byte{0x00}},\n            // Varbind List\n            {Type: Sequence, Len: 19, Value: []*Field{\n                // Varbind\n                {Type: Sequence, Len: 17, Value: []*Field{\n                    // OID 1.3.6.1.4.1.2680.1.2.7.3.2.0\n                    {Type: ObjectIdentifier, Len: 13, Value: []byte{0x2b, 0x06, 0x01, 0x04, 0x01, 0x94, 0x78, 0x01, 0x02, 0x07, 0x03, 0x02, 0x00}},\n                    // Value\n                    {Type: Null, Len: 0},\n                }}},\n            }},\n        }},\n    }\n\n    bad := Field{\n        Type:  Sequence,\n        Value: 42,\n    }\n\n    for i, f := range [...]*Field{&amp;msg, &amp;bad} {\n        log.Println(\"walking:\", i)\n        err := walk(f, \"\")\n        if err != nil {\n            log.Println(\"error:\", err)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/juAMsunPvMV\" rel=\"nofollow noreferrer\">Playground link</a>.</p>\n"}], "owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 51709450, "answer_count": 1, "score": 0, "last_activity_date": 1533564150, "creation_date": 1533510294, "question_id": 51698879, "link": "https://stackoverflow.com/questions/51698879/recursively-define-snmp-message", "title": "Recursively Define SNMP Message", "body": "<p>I am messing around with an SNMP library in Go and came up with a type <code>Field</code> that defines an SNMP BER encoded field according to <a href=\"https://www.rane.com/note161.html\" rel=\"nofollow noreferrer\">this document</a>. Each field consists of a type, length, and value, where the type is an ASN.1 type, length is the length of the field's value, and the value can be another field, a sequence of fields, or a sequence of bytes. This made me think about the possibility of recursively defining an SNMP message. Here is some code I came up with, but I'm stuck trying to translate it into a recursive structure:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// ASN.1 BER encoded types.\ntype ASN1BER byte\n\nconst (\n    Integer          ASN1BER = 0x02\n    BitString                = 0x03\n    OctetString              = 0x04\n    Null                     = 0x05\n    ObjectIdentifier         = 0x06\n    Sequence                 = 0x30\n    GetRequest               = 0xa0\n)\n\n// SNMP versions.\ntype Version byte\n\nconst (\n    Version1  Version = 0x00\n    Version2c         = 0x01\n)\n\n// SNMP message field.\ntype Field struct {\n    Type  ASN1BER\n    Len   int\n    Value interface{}\n}\n\nfunc main() {\n    // SNMP Message\n    msg := &amp;Field{Type: Sequence, Len: 44, Value: []*Field{\n        // SNMP Version\n        {Type: Integer, Len: 1, Value: Version2c},\n        // Community String\n        {Type: OctetString, Len: 7, Value: []byte(\"private\")},\n        // Get-Request PDU\n        {Type: GetRequest, Len: 30, Value: []*Field{\n            // Request ID\n            {Type: Integer, Len: 1, Value: []byte{0x01}},\n            // Error Status\n            {Type: Integer, Len: 1, Value: []byte{0x00}},\n            // Error Index\n            {Type: Integer, Len: 1, Value: []byte{0x00}},\n            // Varbind List\n            {Type: Sequence, Len: 19, Value: []*Field{\n                // Varbind\n                {Type: Sequence, Len: 17, Value: []*Field{\n                    // OID 1.3.6.1.4.1.2680.1.2.7.3.2.0\n                    {Type: ObjectIdentifier, Len: 13, Value: []byte{0x2b, 0x06, 0x01, 0x04, 0x01, 0x94, 0x78, 0x01, 0x02, 0x07, 0x03, 0x02, 0x00}},\n                    // Value\n                    {Type: Null, Len: 0},\n                }}},\n            }},\n        }},\n    }\n    fmt.Println(msg)\n}\n</code></pre>\n\n<p>Is it possible to represent the SNMP message recursively? If so, what would be the base case(s) and the recursive case(s)? The goal is to be able to recursively print, encode, and decode SNMP messages.</p>\n"}, {"tags": ["go", "vgo"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1533485944, "post_id": 51696098, "comment_id": 90353567, "body": "Use <code>replace</code> in your module file to specify the path to the module."}, {"owner": {"reputation": 9672, "user_id": 1460955, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e8259b91a7595aae684de9b52cf52621?s=128&d=identicon&r=PG", "display_name": "exts", "link": "https://stackoverflow.com/users/1460955/exts"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1533486571, "post_id": 51696098, "comment_id": 90353725, "body": "@TimCooper I&#39;ve tried <code>replace example.com&#47;m&#47;example =&gt; .&#47;example</code> and I&#39;m not getting anywhere. You have a real example that I can work from."}, {"owner": {"reputation": 3123, "user_id": 8910547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fEm51.png?s=128&g=1", "display_name": "Inigo", "link": "https://stackoverflow.com/users/8910547/inigo"}, "edited": false, "score": 0, "creation_date": 1535754975, "post_id": 51696098, "comment_id": 91197849, "body": "I have a set of debug utility code that I import just during debuging. Previously I just had it in the GOPATH and I could import it. I moved the code outside of GOPATH, ran <code>go mod init</code>. But I can&#39;t import it into the project (also outside of GOPATH) I want to use it in. HELP!"}], "answers": [{"tags": [], "owner": {"reputation": 9672, "user_id": 1460955, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e8259b91a7595aae684de9b52cf52621?s=128&d=identicon&r=PG", "display_name": "exts", "link": "https://stackoverflow.com/users/1460955/exts"}, "is_accepted": true, "score": 0, "last_activity_date": 1535907065, "creation_date": 1535907065, "answer_id": 52139104, "question_id": 51696098, "link": "https://stackoverflow.com/questions/51696098/how-do-you-create-a-local-vgo-application-module/52139104#52139104", "title": "How do you create a local VGO application module", "body": "<p>I figured it out. Basically vgo allows you to include <code>package main</code> in the root, but by doing this you can only use 'main' packages in the root directory of your vgo project because golang only permits one package name per folder. Which is fine since you can remove the main file later if you want.</p>\n\n<p><strong>Answer</strong></p>\n\n<ul>\n<li><p>Create a <code>package main</code> file in the root directory of your vgo project with a <code>fn main</code></p></li>\n<li><p>Create any amount of sub packages in your vgo project ex.: <code>package example</code> in an <code>example</code> sub folder. For fun create an exported function that prints out \"Hello World\" and call it \"WorldGreeting\"</p></li>\n<li>Now in your main file you can import this package by calling your module name followed by the sub package name. So for instance if your module name is <code>bitbucket.com/User/MyVGOPackage</code> then you would import your sub package in the main file like <code>import \"bitbucket.com/User/MyVGOPackage/example\"</code> then call your function inside of main <code>example.WorldGreeting()</code></li>\n<li>Build using <code>go build</code> to build the full directory (in case you have more main packages in the directory) and vgo will spit out an exe called \"MyVGOPackage.exe\" </li>\n</ul>\n\n<p>Tip: If you just want to create an application without a weird module name just rename your module to something simple like \"MyApplication\" and vgo will understand your imports perfectly. then go back and replace \"bitbucket.com/User/MyVGOPackage/example\" to \"MyApplication/example\" and everything will build normally. Jetbrain's GoLand IDE understands this usage perfectly so give it a shot if vs code is having issues auto completing.</p>\n"}], "owner": {"reputation": 9672, "user_id": 1460955, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e8259b91a7595aae684de9b52cf52621?s=128&d=identicon&r=PG", "display_name": "exts", "link": "https://stackoverflow.com/users/1460955/exts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 52139104, "answer_count": 1, "score": 1, "last_activity_date": 1535907175, "creation_date": 1533485807, "last_edit_date": 1535907175, "question_id": 51696098, "link": "https://stackoverflow.com/questions/51696098/how-do-you-create-a-local-vgo-application-module", "title": "How do you create a local VGO application module", "body": "<p>Every example I've seen with <code>vgo</code> so far requires you to write your module, upload it then create a new application module to test a basic module.</p>\n\n<p>Is there a way to test a module by skipping the repo step and just adding a package main to your module just to spit out something to the console?</p>\n\n<p>I've tried creating my dummy module <code>module \"example.com/m\"</code> adding a dummy subpackage to the <code>package example</code> in <code>/example/testing.go</code> then added a simple main.go and tried importing the example package from my dummy module to no avail. </p>\n\n<p>If I had no internet, I'd be pretty lost with the vgo workflow (I'm lost without it tbh)</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 4, "last_activity_date": 1533483951, "creation_date": 1533483951, "answer_id": 51695816, "question_id": 51695717, "link": "https://stackoverflow.com/questions/51695717/why-do-we-return-a-pointer-not-a-value-in-this-example/51695816#51695816", "title": "Why do we return a pointer not a value in this example?", "body": "<p>error is an interface that asks to have an <code>Error() string</code> method.</p>\n\n<p>The problem here is that you declare the <code>Error() string</code> method on a pointer. <code>func (e *argError) Error() string</code>, thus only an <code>*argError</code> implements an <code>error</code>, but not an <code>argError</code>. So you can only return an <code>&amp;argError{...}</code>.</p>\n\n<p>You should know that <code>*error</code> and <code>error</code> of an pointer is different. The former is a pointer to an <code>interface</code> holding whatever concrete type and the latter is an <code>interface</code> holding a pointer. </p>\n\n<p>In practice, since an <code>interface</code> is all about methods, a pointer to an <code>interface</code> is rarely useful while an <code>interface</code> holding a pointer is widely used. </p>\n"}], "owner": {"reputation": 73, "user_id": 3027122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/033b36ee28138fb8e5e4e596fc6f34c2?s=128&d=identicon&r=PG&f=1", "display_name": "sax", "link": "https://stackoverflow.com/users/3027122/sax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 2, "accepted_answer_id": 51695816, "answer_count": 1, "score": 0, "last_activity_date": 1533483951, "creation_date": 1533483188, "question_id": 51695717, "link": "https://stackoverflow.com/questions/51695717/why-do-we-return-a-pointer-not-a-value-in-this-example", "title": "Why do we return a pointer not a value in this example?", "body": "<pre><code>package main\n\nimport \"fmt\"\n\n\ntype argError struct {\n    arg  int\n    prob string\n}\n\nfunc (e *argError) Error() string {\n    return fmt.Sprintf(\"%d - %s\", e.arg, e.prob)\n}\n\nfunc f2(arg int) (int, error) {\n    return -1, &amp;argError{arg, \"can't work with it\"}\n}\n\nfunc main() {\n\n    _, e := f2(42)\n    if ae, ok := e.(*argError); ok {\n        fmt.Println(ae.arg)\n        fmt.Println(ae.prob)\n    }\n}\n</code></pre>\n\n<p>in f2 we have pointer <strong>&amp;argError...</strong> as return value, but method declared to return <strong>error</strong>. Why f2 signature is not defined as </p>\n\n<p>func f2(arg int) (int, <strong>*error</strong>) instead? Or why do we return pointer not a value in this case?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1533482515, "post_id": 51695573, "comment_id": 90352639, "body": "Please clarify the question by recreating the issue with minimal code."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1533482660, "post_id": 51695573, "comment_id": 90352681, "body": "The most common way to do this is implement <code>encoding.TextMarshaler</code> and <code>encoding.TextUnmarshaler</code>. You can probably find a program that you can invoke via go generate to do this semi-automatically."}, {"owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "edited": false, "score": 0, "creation_date": 1533482661, "post_id": 51695573, "comment_id": 90352682, "body": "I just edited my existing post."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1533488613, "post_id": 51695573, "comment_id": 90354228, "body": "Unless your type of A is an int the value is also an int. You could check in your code <code>j == A</code>. Another way is that you make your <code>type Type string</code>."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 1, "creation_date": 1533488841, "post_id": 51695573, "comment_id": 90354298, "body": "I would also recomend not to use the name <code>Type</code> because you can mix that with the keyword <code>type</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1533489357, "post_id": 51696540, "comment_id": 90354426, "body": "I personaly would not write the code like this, but I wanted to be as close to the given example."}, {"owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "edited": false, "score": 0, "creation_date": 1533499506, "post_id": 51696540, "comment_id": 90357095, "body": "Yeah, the idea is that I&#39;m storing integers in the database and not strings."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "reply_to_user": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "edited": false, "score": 0, "creation_date": 1533504310, "post_id": 51696540, "comment_id": 90358172, "body": "Then you need to map the integers to strings, because the JSON includes strings and not integers."}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 0, "last_activity_date": 1533489204, "creation_date": 1533489204, "answer_id": 51696540, "question_id": 51695573, "link": "https://stackoverflow.com/questions/51695573/convert-type-int-to-a-string-of-the-name-of-a-const-when-marshaling-to-json/51696540#51696540", "title": "Convert type int to a string of the name of a const when marshaling to JSON", "body": "<p>So your JSON API gives you the type A:</p>\n\n<blockquote>\n  <p>I want fmt.Println(string(j)) to print {\"type\":\"A\"}, not {\"type\":0}.</p>\n</blockquote>\n\n<p>You could change your code like this, then your API works:</p>\n\n<p><a href=\"https://play.golang.org/p/ypvFvQpBw-C\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ypvFvQpBw-C</a></p>\n\n<pre><code>type JSONType string\n\nconst (\n    A JSONType = \"A\"\n    B JSONType = \"B\"\n    C JSONType = \"C\"\n)\n\ntype Character struct {\n    JSONType JSONType `json:\"type,string\"`\n}\n\nfunc main() {\n    c := Character{}\n    c.JSONType = A\n    j, err := json.Marshal(c)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(j))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 153, "user_id": 2291886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d94d277ece247295c9ca745b28c60067?s=128&d=identicon&r=PG", "display_name": "Gianfranco Reppucci", "link": "https://stackoverflow.com/users/2291886/gianfranco-reppucci"}, "is_accepted": false, "score": 1, "last_activity_date": 1533490577, "creation_date": 1533490577, "answer_id": 51696739, "question_id": 51695573, "link": "https://stackoverflow.com/questions/51695573/convert-type-int-to-a-string-of-the-name-of-a-const-when-marshaling-to-json/51696739#51696739", "title": "Convert type int to a string of the name of a const when marshaling to JSON", "body": "<p>Short reply: there's NO direct option to achieve your goal.</p>\n\n<p>Long reply: truth is, you can actually override the way Go can encode structs.</p>\n\n<p>Here's the working code:</p>\n\n<p><a href=\"https://play.golang.org/p/i92pUpNG-Wr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/i92pUpNG-Wr</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\n// please consider to rename this!\ntype Type int\n\nconst (\n    A Type = iota\n    B\n    C\n)\n\ntype Character struct {\n    Type Type `json:\"-\"`\n}\n\nfunc (c *Character) mapTypeToString() string {\n    switch c.Type {\n    case B:\n        return \"B\"\n    case C:\n        return \"C\"\n    }\n\n    // defaults on A\n    return \"A\"\n}\n\n// MarshalJSON overwrites the standard JSON marshal.\nfunc (c *Character) MarshalJSON() ([]byte, error) {\n    return json.Marshal(&amp;struct {\n        Type string `json:\"type\"`\n    }{\n        Type: c.mapTypeToString(),\n    })\n}\n\nfunc main() {\n    c := &amp;Character{}\n    c.Type = A\n    j, err := json.Marshal(c)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(j))\n}\n</code></pre>\n\n<p>Be aware of the <code>c := &amp;Character{}</code> initialization.</p>\n\n<p>The tradeoff would be to have the <code>mapTypeToString()</code> method that needs to be updated according to the different types of ... Type.</p>\n\n<p>Please, also consider to avoid naming structs and vars like <code>Type</code> :)</p>\n"}, {"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1533494510, "post_id": 51696985, "comment_id": 90355828, "body": "In this case a slice would suffice and be more efficient. An array might be even better."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 2, "last_activity_date": 1533494186, "last_edit_date": 1533494186, "creation_date": 1533492417, "answer_id": 51696985, "question_id": 51695573, "link": "https://stackoverflow.com/questions/51695573/convert-type-int-to-a-string-of-the-name-of-a-const-when-marshaling-to-json/51696985#51696985", "title": "Convert type int to a string of the name of a const when marshaling to JSON", "body": "<p>You need to define a custom marshaller for your type.</p>\n\n<pre><code>type Type int\n\nconst (\n    A Type = iota\n    B\n    C\n)\n\nvar typeToString = map[Type]string{\n    A: \"A\",\n    B: \"B\",\n    C: \"C\",\n}\n\nfunc (t Type) MarshalJSON() ([]byte, error) {\n    return json.Marshal(typeToString[t])\n}\n\ntype Character struct {\n    Type Type `json:\"type\"`\n}\n\nfunc main() {\n    c := Character{}\n    c.Type = A\n    j, err := json.Marshal(c)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(j))\n}\n</code></pre>\n\n<p>The function <code>MarshalJSON</code> defines how <code>json.Marshal</code> should marshal your type. You can do something similar for unmarshaling if you need to go the other direction as well.</p>\n\n<p>See <a href=\"https://play.golang.org/p/mLxThWA19by\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mLxThWA19by</a>.</p>\n"}], "owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "accepted_answer_id": 51696985, "answer_count": 3, "score": 0, "last_activity_date": 1533494186, "creation_date": 1533482181, "last_edit_date": 1533482684, "question_id": 51695573, "link": "https://stackoverflow.com/questions/51695573/convert-type-int-to-a-string-of-the-name-of-a-const-when-marshaling-to-json", "title": "Convert type int to a string of the name of a const when marshaling to JSON", "body": "<p>I have a struct that looks like this:</p>\n\n<pre><code>type Type int\n\nconst (\n    A Type = iota\n    B\n    C\n)\n\ntype Character struct {\n    Type Type   `json:\"type\"`\n}\n</code></pre>\n\n<p>When I call <code>json.Marshal(...)</code> on the struct, is there a way that the <code>json:\"type\"</code> representation is a string called either <code>\"A\"</code>, <code>\"B\"</code>, or \"<code>C</code>\"?</p>\n\n<p>When this is presented in JSON, nobody is going to know what <code>0</code>, <code>1</code>, or <code>2</code> is, so the name of the constant is more useful.</p>\n\n<p>Apologies if this has been asked before. I googled all over and couldn't find anything.</p>\n\n<p>Here is an example:</p>\n\n<pre><code>type Type int\n\nconst (\n    A Type = iota\n    B\n    C\n)\n\ntype Character struct {\n    Type Type   `json:\"type,string\"`\n}\n\nfunc main() {\n    c := Character{}\n    c.Type = A\n    j, err := json.Marshal(c)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(j))\n}\n</code></pre>\n\n<p>I want <code>fmt.Println(string(j))</code> to print <code>{\"type\":\"A\"}</code>, not <code>{\"type\":0}</code>. </p>\n"}, {"tags": ["go", "hyperledger-fabric", "blockchain"], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 9942350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c3691b98533432ee7d8e05f3a98a194?s=128&d=identicon&r=PG&f=1", "display_name": "Blockchaindeveloper", "link": "https://stackoverflow.com/users/9942350/blockchaindeveloper"}, "edited": false, "score": 0, "creation_date": 1533555311, "post_id": 51696764, "comment_id": 90373986, "body": "Thanks for the answer I updated the signature other way round and it worked. If it was downvoted by you Please remove the downvote as it discourages question askers and other newbies."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "reply_to_user": {"reputation": 97, "user_id": 9942350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c3691b98533432ee7d8e05f3a98a194?s=128&d=identicon&r=PG&f=1", "display_name": "Blockchaindeveloper", "link": "https://stackoverflow.com/users/9942350/blockchaindeveloper"}, "edited": false, "score": 0, "creation_date": 1533643979, "post_id": 51696764, "comment_id": 90413232, "body": "No downvotes from me. I totaly agree that downvotes do not encourage people to ask. But asking is one of the most important things while learning."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "reply_to_user": {"reputation": 97, "user_id": 9942350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c3691b98533432ee7d8e05f3a98a194?s=128&d=identicon&r=PG&f=1", "display_name": "Blockchaindeveloper", "link": "https://stackoverflow.com/users/9942350/blockchaindeveloper"}, "edited": false, "score": 0, "creation_date": 1533644566, "post_id": 51696764, "comment_id": 90413590, "body": "You could also upvote correct answers, because no upvote for an answer is almost as motivating as a downvote for a question.  ;-)"}, {"owner": {"reputation": 97, "user_id": 9942350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c3691b98533432ee7d8e05f3a98a194?s=128&d=identicon&r=PG&f=1", "display_name": "Blockchaindeveloper", "link": "https://stackoverflow.com/users/9942350/blockchaindeveloper"}, "edited": false, "score": 0, "creation_date": 1533655107, "post_id": 51696764, "comment_id": 90421182, "body": "Yes but my upvote was not visible because I had less than 15 reputation points"}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 1, "last_activity_date": 1533490764, "creation_date": 1533490764, "answer_id": 51696764, "question_id": 51695402, "link": "https://stackoverflow.com/questions/51695402/chaincode-in-go-hyperledger-v-1-0-too-many-arguments-to-return/51696764#51696764", "title": "Chaincode in go - Hyperledger v 1.0 - too many arguments to return", "body": "<p>The answer here is pretty simple. I explain it for the first error. The rest is similar.</p>\n\n<p>In your <code>func</code> you are defining one return type: <code>pb.Response</code></p>\n\n<p>But in your return statement you are returning 2 values.</p>\n\n<pre><code>func Checkuploadstatus(stub shim.ChaincodeStubInterface) pb.Response {\n...\nreturn nil, errors.New(\"Expected atleast 1 argument for user creation\")\n</code></pre>\n\n<p>To fix this you can change the signature of your func or the return statement</p>\n\n<p>Solution change the signature:</p>\n\n<pre><code>func Checkuploadstatus(stub shim.ChaincodeStubInterface) (pb.Response, error) {\n...\nreturn nil, errors.New(\"Expected atleast 1 argument for user creation\")\n</code></pre>\n\n<p>Solution change the return (then no error handling):</p>\n\n<pre><code>func Checkuploadstatus(stub shim.ChaincodeStubInterface) pb.Response {\n...\nreturn nil\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 97, "user_id": 9942350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c3691b98533432ee7d8e05f3a98a194?s=128&d=identicon&r=PG&f=1", "display_name": "Blockchaindeveloper", "link": "https://stackoverflow.com/users/9942350/blockchaindeveloper"}, "is_accepted": false, "score": 0, "last_activity_date": 1533555438, "creation_date": 1533555438, "answer_id": 51706746, "question_id": 51695402, "link": "https://stackoverflow.com/questions/51695402/chaincode-in-go-hyperledger-v-1-0-too-many-arguments-to-return/51706746#51706746", "title": "Chaincode in go - Hyperledger v 1.0 - too many arguments to return", "body": "<p>I updated the signature and return statements of my functions and it worked perfectly fine.</p>\n\n<pre><code>func CreateUser(stub shim.ChaincodeStubInterface, args []string) pb.Response {\n        if len(args) &lt; 2 {\n                logger.Error(\"Invalid number of args\")\n                return shim.Error(\"Expected atleast 1 argument for user creation\")\n        }\n\n        var Username = args[0]\n        var UsernameInput = args[1]\n        //trying to understand\n        err := stub.PutState(Username, []byte(UsernameInput))\n        if err != nil {\n                logger.Error(\"Could not save new User to ledger\", err)\n                return shim.Error(err.Error())\n        }\n\n        var customEvent = \"{eventType: 'UserCreation', description:\" + Username + \"' Successfully created'}\"\n        err = stub.SetEvent(\"evtSender\", []byte(customEvent))\n        if err != nil {\n                return shim.Error(err.Error())\n        }\n        logger.Info(\"Successfully saved a supply chain user\")\n        return shim.Success(nil)\n\n\n}\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 9942350, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c3691b98533432ee7d8e05f3a98a194?s=128&d=identicon&r=PG&f=1", "display_name": "Blockchaindeveloper", "link": "https://stackoverflow.com/users/9942350/blockchaindeveloper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1533555438, "creation_date": 1533481026, "last_edit_date": 1533482350, "question_id": 51695402, "link": "https://stackoverflow.com/questions/51695402/chaincode-in-go-hyperledger-v-1-0-too-many-arguments-to-return", "title": "Chaincode in go - Hyperledger v 1.0 - too many arguments to return", "body": "<p>I am getting below error stack by running one of my Chaincode program in Hyperledger. I am trying to build a small application that will insert a keyvalue pair of username and a status and using this I can insert or read values from the ledger:</p>\n\n<pre><code>go build\n# _/home/ubuntu/go/src/Chaincodeexample\n./Samplesupplychain.go:28:9: too many arguments to return\n        have (nil, error)\n        want (peer.Response)\n</code></pre>\n\n<p>.... This continues for all other functions in my code and final ones are below :</p>\n\n<pre><code> ./Samplesupplychain.go:80:33: too many arguments in call to Checkuploadstatus\n        have (shim.ChaincodeStubInterface, []string)\n        want (shim.ChaincodeStubInterface)\n./Samplesupplychain.go:90:26: too many arguments in call to CreateUser\n        have (shim.ChaincodeStubInterface, []string)\n        want (shim.ChaincodeStubInterface)\n./Samplesupplychain.go:92:36: undefined: username\n./Samplesupplychain.go:92:36: too many errors\n</code></pre>\n\n<p>My code is below :</p>\n\n<pre><code>package main\n\nimport(\n\"errors\"\n\"fmt\"\npb \"github.com/hyperledger/fabric/protos/peer\"\n\n//\"encoding/json\"\n\n\"github.com/hyperledger/fabric/core/chaincode/shim\"\n\n)\ntype SampleChaincode struct {\n}\nvar logger = shim.NewLogger(\"my logger\")\n//Create a struct for these 2 values\ntype testuser struct{\n    Username string `json:\"username\"`\n    Fileuploaded string `json:\"fileuploaded\"`\n}\n\n//A function to create user on the ledger\n\nfunc CreateUser(stub shim.ChaincodeStubInterface) pb.Response {\n    function, args := stub.GetFunctionAndParameters()\n    if len(args) &lt; 2 {\n        logger.Error(\"Invalid number of args\")\n        return nil, errors.New(\"Expected atleast 1 argument for user creation\")\n    }\n\n    var Username = args[0]\n    var UsernameInput = args[1]\n    //trying to understand\n    err := stub.PutState(Username, []byte(UsernameInput))\n    if err != nil {\n        logger.Error(\"Could not save new User to ledger\", err)\n        return nil, err\n    }\n\n    var customEvent = \"{eventType: 'UserCreation', description:\" + Username + \"' Successfully created'}\"\n    err = stub.SetEvent(\"evtSender\", []byte(customEvent))\n    if err != nil {\n        return nil, err\n    }\n    logger.Info(\"Successfully saved a supply chain user\")\n    return nil, nil\n\n\n}\n\nfunc Checkuploadstatus(stub shim.ChaincodeStubInterface) pb.Response {\n    function, args := stub.GetFunctionAndParameters()\n    logger.Debug(\"Entering supplychain application\")\n\n    if len(args) &lt; 1 {\n        logger.Error(\"Invalid number of arguments\")\n        return nil, errors.New(\"Missing details\")\n    }\n\n    var Fileuploadedstatusforuser = args[0] \n\n    bytes, err := stub.GetState(Fileuploadedstatusforuser)\n    if err != nil {\n        logger.Error(\"Could not fetch Fileuploadedstatus with \"+ Fileuploadedstatusforuser +\" from ledger\", err)\n        return nil, err\n    }\n    return bytes, nil\n}\n\nfunc (t *SampleChaincode) Init(stub shim.ChaincodeStubInterface) pb.Response {\n    function, args := stub.GetFunctionAndParameters()\n    return shim.Success(nil)\n\n}\n\nfunc (t *SampleChaincode) Query(stub shim.ChaincodeStubInterface) pb.Response {\n    function, args := stub.GetFunctionAndParameters()\n    if function == \"Checkuploadstatus\" {\n        return Checkuploadstatus(stub, args)\n    }\n    return shim.Success(nil)\n}\n\n\n\nfunc (t *SampleChaincode) Invoke(stub shim.ChaincodeStubInterface) pb.Response {\n    function, args := stub.GetFunctionAndParameters()\n    if function == \"CreateUser\" {\n        return CreateUser(stub, args)\n        } else {\n            return nil, errors.New(username + \" does not have access to create a User\")\n        }\n\n        return shim.Success(nil)\n}\n\nfunc main() {\n\n    lld, _ := shim.LogLevel(\"DEBUG\")\n    fmt.Println(lld)\n\n    logger.SetLevel(lld)\n    fmt.Println(logger.IsEnabledFor(lld))\n\n    err := shim.Start(new(SampleChaincode))\n    if err != nil {\n        logger.Error(\"Could not start SampleChaincode\")\n    } else {\n        logger.Info(\"SampleChaincode successfully started\")\n    }\n\n}\n</code></pre>\n\n<p>Any help will be appreciated as I am currently using Hyperledger v 1.0.0 </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1533481846, "last_edit_date": 1533481846, "creation_date": 1533481527, "answer_id": 51695475, "question_id": 51695366, "link": "https://stackoverflow.com/questions/51695366/how-do-i-f-type-string-directly-using-golang-reflect/51695475#51695475", "title": "How do I f.Type()==&quot;string&quot; directly using golang reflect?", "body": "<p>Declare variables for the types of interest. It's usually best to do this at package level.</p>\n\n<pre><code>var ( \n  stringType = reflect.TypeOf(\"\")\n  uint64Type = reflect.TypeOf(uint64(0))\n  ... and so on\n)\n</code></pre>\n\n<p>Compare to these types:</p>\n\n<pre><code>if f.Type() == stringType { \n    ...\n}\n</code></pre>\n\n<p>It's not possible to use <code>f.Type()== \"string\"</code> because strings are not assignable to reflect.Type values or vice versa.</p>\n\n<p>Another option is to call <a href=\"https://godoc.org/reflect#Type.String\" rel=\"nofollow noreferrer\">Type.String()</a>, but it's usually better to compare types than strings:</p>\n\n<pre><code>if f.Type().String == \"string\" { \n    ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1533481839, "creation_date": 1533481839, "answer_id": 51695529, "question_id": 51695366, "link": "https://stackoverflow.com/questions/51695366/how-do-i-f-type-string-directly-using-golang-reflect/51695529#51695529", "title": "How do I f.Type()==&quot;string&quot; directly using golang reflect?", "body": "<pre><code>f.Type().Kind().String()==\"Uint64\"\n</code></pre>\n\n<p>See <a href=\"https://golang.org/pkg/reflect/#Kind\" rel=\"nofollow noreferrer\">reflect.Kind</a></p>\n"}, {"tags": [], "owner": {"reputation": 26, "user_id": 2432891, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32f94e47d9ac3ea41ce6180c27b88060?s=128&d=identicon&r=PG", "display_name": "user2432891", "link": "https://stackoverflow.com/users/2432891/user2432891"}, "is_accepted": true, "score": 1, "last_activity_date": 1533538319, "creation_date": 1533538319, "answer_id": 51702029, "question_id": 51695366, "link": "https://stackoverflow.com/questions/51695366/how-do-i-f-type-string-directly-using-golang-reflect/51702029#51702029", "title": "How do I f.Type()==&quot;string&quot; directly using golang reflect?", "body": "<p>Change <code>f.Type()</code> to <code>f.Kind()</code>, then use reflect Type to do judgement, supported types could be found <a href=\"https://godoc.org/reflect#Kind\" rel=\"nofollow noreferrer\">https://godoc.org/reflect#Kind</a>.\nplease see full example <a href=\"https://play.golang.org/p/Zydi7t3UBNJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Zydi7t3UBNJ</a></p>\n\n<pre><code>      switch f.Kind() {\n    case reflect.Int64:\n        fmt.Println(\"got int64\")\n    case reflect.String:\n        fmt.Println(\"got string\")\n    case reflect.Uint64:\n        fmt.Println(\"got Unit64\")\n    default:\n        fmt.Println(\"found nothing\")        \n   }\n</code></pre>\n"}], "owner": {"reputation": 303, "user_id": 9111646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a0db9794a01a8d569e3081313b45911?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/9111646/john-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 51702029, "answer_count": 3, "score": 0, "last_activity_date": 1533538319, "creation_date": 1533480719, "last_edit_date": 1533482061, "question_id": 51695366, "link": "https://stackoverflow.com/questions/51695366/how-do-i-f-type-string-directly-using-golang-reflect", "title": "How do I f.Type()==&quot;string&quot; directly using golang reflect?", "body": "<p>Full code is here:\n<a href=\"https://pastebin.com/xC1uQVBC\" rel=\"nofollow noreferrer\">https://pastebin.com/xC1uQVBC</a></p>\n\n<pre><code>   type UDD struct {\n                        A string //content = \"John\"\n                        B string //content = \"Male\"\n                        C string //content = \"12345678\"\n                        D int64 //content = \"\"\n                        E uint64 //content = \"\"\n                        Z string //content = \"FIrst time user\"\n   }\n\n\n    reflect_UDD := reflect.ValueOf(&amp;UDD).Elem()\n    typeOf_UDD := reflect_UDD.Type()\n\n\n\n\n    for i := 0; i &lt; reflect_UDD.NumField(); i++ {\n           f := reflect_UDD.Field(i)\n\n           if(f.Type()==reflect.TypeOf(\"string\")){ \n                //i would like to f.Type()==\"string\" directly... \n                //how is this possible and also for uint64 and int64 etc\n           }\n     }\n</code></pre>\n\n<p>Basically, I would like to do something along the lines of</p>\n\n<pre><code>f.Type()==\"string\"\n</code></pre>\n\n<p>or </p>\n\n<pre><code>f.Type()==\"uint64\"\n</code></pre>\n\n<p>or</p>\n\n<pre><code>f.Type()==\"int64\"\n</code></pre>\n\n<p>directly instead</p>\n"}, {"tags": ["go", "kubernetes", "client-go"], "owner": {"reputation": 4600, "user_id": 310298, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/PkUnq.png?s=128&g=1", "display_name": "itaysk", "link": "https://stackoverflow.com/users/310298/itaysk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 555, "favorite_count": 0, "closed_date": 1533478358, "answer_count": 0, "score": 1, "last_activity_date": 1533474591, "creation_date": 1533474591, "question_id": 51694614, "link": "https://stackoverflow.com/questions/51694614/how-to-use-runtime-object-to-create-crd-generic-functions-in-go", "closed_reason": "Duplicate", "title": "How to use runtime.Object to create CRD generic functions in go", "body": "<p>I'm writing a Kubernetes controller in which I need to run a function over different kinds of resources, including my custom resources and other kinds of resources (This function is only interested in the resource name).</p>\n\n<p>My understanding is that this is doable using <code>runtime.Object</code> but I can't get it to work.<br>\nHere's the function signature:</p>\n\n<pre><code>func myFunc(foo []runtime.Object) []runtime.Object\n</code></pre>\n\n<p>When calling the function I pass a typed object, and expect it to be assignable to <code>runtime.Object</code>:</p>\n\n<pre><code>foo := []v1alpha1.MyCRD{}\nbar := myFunc(foo)\n</code></pre>\n\n<p>I'm getting compiler error:</p>\n\n<pre><code>cannot use foo (type []v1alpha1.MyCRD) as []runtime.Object in argument to myFunc\n</code></pre>\n\n<p>Looking at the definition of <code>runtime.Object</code>:</p>\n\n<pre><code>type Object interface {\n  GetObjectKind() schema.ObjectKind\n  DeepCopyObject() Object\n}\n</code></pre>\n\n<p>The <code>MyCRD</code> type is embedding <code>metav1.TypeMeta</code> so it has the required <code>GetObjectKind()</code> function. </p>\n\n<p>It is also annotated with:</p>\n\n<pre><code>// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n</code></pre>\n\n<p>So it also has the required <code>DeepCopyObject()</code> (which is see in the generated file).</p>\n\n<p>I've been struggling with this for a while and I think it might have to do with registering the type with <code>scheme</code> but I'm not sure how that works, and can't find any documentation on that. I've tried copying type registration code from other projects I found without really understanding what it does (as I said, can't find docs on this).. still doesn't work.</p>\n\n<hr>\n\n<p>related: </p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/48861383/how-can-deployment-satisfy-type-runtime-object-in-kubernetes-code\">How can &amp;deployment satisfy type runtime.Object in kubernetes code?</a></li>\n<li><a href=\"https://medium.com/@arschles/go-experience-report-generics-in-kubernetes-25da87430301\" rel=\"nofollow noreferrer\">https://medium.com/@arschles/go-experience-report-generics-in-kubernetes-25da87430301</a></li>\n</ul>\n"}, {"tags": ["go", "interface", "type-assertion"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 3, "creation_date": 1533474705, "post_id": 51694537, "comment_id": 90350538, "body": "Interfaces are used that way it is required to type assert the value to get underlying type. What is that you want to achieve ?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1533477258, "post_id": 51694537, "comment_id": 90351177, "body": "Apply explicit type assertion on the returned value is the way to do it. You will always have &quot;performance&quot; impact as you rely on runtime information to execute the implementation. This might be close to what you are looking for the type equality test <a href=\"https://github.com/mh-cbon/service-finder/blob/master/service-finder.go#L38\" rel=\"nofollow noreferrer\">github.com/mh-cbon/service-finder/blob/master/&hellip;</a>"}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1533479867, "post_id": 51694537, "comment_id": 90351902, "body": "isn&#39;t it better with something like <code>Is(&quot;red&quot;)</code> and call <code>Is</code> function on both objects ?"}, {"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "reply_to_user": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1533481292, "post_id": 51694537, "comment_id": 90352278, "body": "@danicheeta I just added the IsRed and IsYellow functions to show that the two structs should be able to have different methods (therefore require type assertion). Based on what you are suggesting, I realize how inefficient they are."}], "answers": [{"comments": [{"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1533481011, "post_id": 51694922, "comment_id": 90352199, "body": "@Himanshu the interface is there to allow additional structs to be introduced via new build tags and still assure it &quot;implements&quot; the Childable interface."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "edited": false, "score": 0, "creation_date": 1533481971, "post_id": 51694922, "comment_id": 90352484, "body": "@FanusduToit good for bringing that up. Please edit your question and add this requirement it will be helpful."}, {"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "edited": false, "score": 0, "creation_date": 1533482354, "post_id": 51694922, "comment_id": 90352596, "body": "@Uvelichitel Wouldn&#39;t the following line you are using result in essentially cloning the value instead of returning the pointer to the original value? <code>reflect.ValueOf(l).Elem().Set(reflect.ValueOf(c).Elem())</code>"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1533483117, "post_id": 51694922, "comment_id": 90352808, "body": "It fill the address which <code>l</code> point to with value dereferenced from <code>c</code>"}, {"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "edited": false, "score": 0, "creation_date": 1533483552, "post_id": 51694922, "comment_id": 90352934, "body": "Yes, so if I&#39;m understanding you correctly, the memory address of this <code>apple := &amp;Apple{}</code> will not be the same address as this <code>&amp;Apple{name: &quot;Appy&quot;}</code> since the former will allocate additional memory just for the sake of this slice lookup. Isn&#39;t that a bit excessive?"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1533486580, "post_id": 51694922, "comment_id": 90353728, "body": "If I correctly understand your question you want to use a value you are looking up. Sure you must allocate space for this value."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1533486916, "post_id": 51694922, "comment_id": 90353799, "body": "If you don&#39;t want to allocate and copy value from slice you can just return slice[index]. Code will be far more simple."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1533479821, "last_edit_date": 1533479821, "creation_date": 1533477073, "answer_id": 51694922, "question_id": 51694537, "link": "https://stackoverflow.com/questions/51694537/pattern-to-lookup-a-slice-element-by-an-injected-type/51694922#51694922", "title": "Pattern to lookup a slice element by an injected type", "body": "<p>As far <code>fmt.Sprintf(\"%T\", c)</code> used <code>reflect</code> under the hood there are no advantages to imply it - better use <code>reflect</code> directly.\nYou can use reference argument as a placeholder of a result instead of return value.</p>\n\n<pre><code>func (e *Entity) ChildByInterface(l Childable) error {\n    for _, c := range e.children {\n        if reflect.TypeOf(l) == reflect.TypeOf(c) {\n            fmt.Println(c)\n            reflect.ValueOf(l).Elem().Set(reflect.ValueOf(c).Elem())\n            return nil\n        }\n    }\n    return errors.New(\"child doesn't exist\")\n}\n</code></pre>\n\n<p>Now pass a placeholder</p>\n\n<pre><code>apple := &amp;Apple{}\nerr := ent.ChildByInterface(apple)\n//and use it\napple.IsRed()\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/P2PZtxxw9jV\" rel=\"nofollow noreferrer\">Working code</a></p>\n"}], "owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1533482584, "creation_date": 1533473893, "last_edit_date": 1533482584, "question_id": 51694537, "link": "https://stackoverflow.com/questions/51694537/pattern-to-lookup-a-slice-element-by-an-injected-type", "title": "Pattern to lookup a slice element by an injected type", "body": "<p>I've attempted to lookup objects inside a interface slice using the type of the object. This current solution I have looks as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n)\n\ntype Entity struct {\n    children []Childable\n}\n\nfunc (e *Entity) ChildByInterface(l interface{}) (Childable, error) {\n    for _, c := range e.children {\n        if fmt.Sprintf(\"%T\", c) == fmt.Sprintf(\"%T\", l) {\n            return c, nil\n        }\n    }\n    return nil, errors.New(\"child doesn't exist\")\n}\n\ntype Childable interface {\n    GetName() string\n}\n\nfunc main() {\n    ent := &amp;Entity{\n        []Childable{\n            &amp;Apple{name: \"Appy\"},\n            &amp;Orange{name: \"Orry\"},\n            // more types can by introduced based on build tags\n        },\n    }\n\n    appy, err := ent.ChildByInterface(&amp;Apple{})\n    if err != nil {\n        fmt.Println(err)\n    } else {\n        appy.(*Apple).IsRed()\n        fmt.Printf(\"%+v\", appy)\n    }\n}\n\ntype Apple struct {\n    name string\n    red  bool\n}\n\nfunc (a *Apple) GetName() string {\n    return a.name\n}\n\nfunc (a *Apple) IsRed() {\n    a.red = true\n}\n\ntype Orange struct {\n    name   string\n    yellow bool\n}\n\nfunc (o *Orange) GetName() string {\n    return o.name\n}\n\nfunc (o *Orange) IsYellow() {\n    o.yellow = true\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/FmkWILBqqA-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/FmkWILBqqA-</a></p>\n\n<p>More Childable types (Apple, Orange, ...) can be injected using build tags. So in order to keep the lookup type safe and avoid mistakes, I'm passing an <code>interface{}</code> to the lookup function. The Childable interface also assures the newly injected types implement the correct functions.</p>\n\n<p>This is where things start to get messy. Currently I'm doing a string comparison on both the interface's type and the Childable object's type to see if they match:\n<code>fmt.Sprintf(\"%T\", c) == fmt.Sprintf(\"%T\", l)</code></p>\n\n<p>Then I can still only return the Childable interface. So I have to use type assertion to get the correct type: <code>appy.(*Apple)</code></p>\n\n<p>The boiler plating is to get the child in its correct type has become very tedious and the string comparison to find a match is having a significant performance impact. What better solution can I use to match two interfaces with each other to avoid the performance knock?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1533470777, "post_id": 51694086, "comment_id": 90349626, "body": "<code>http.HandlerFunc(helloHandler)</code> returns a value of type <code>http.HandlerFunc</code>. That type happens to implement <code>http.Handler</code>, so you can pass it to <code>http.Handle</code>."}], "answers": [{"tags": [], "owner": {"reputation": 10507, "user_id": 56686, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/9nKtX.jpg?s=128&g=1", "display_name": "Mattias Wadman", "link": "https://stackoverflow.com/users/56686/mattias-wadman"}, "is_accepted": false, "score": 1, "last_activity_date": 1533470744, "creation_date": 1533470744, "answer_id": 51694148, "question_id": 51694086, "link": "https://stackoverflow.com/questions/51694086/how-handlerfuncf-convert-a-function-to-an-interface-type/51694148#51694148", "title": "How HandlerFunc(f) convert a function to an interface type?", "body": "<p>Not special or built-in feature. Instead <code>http.HandlerFunc</code> is a type that implements the <code>http.Handler</code> interface. Have a look at its implementation which is quite nifty <a href=\"https://github.com/golang/go/blob/d3c3aaa61f7598f275f30fabd3749379fe0f2720/src/net/http/server.go#L1956\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/d3c3aaa61f7598f275f30fabd3749379fe0f2720/src/net/http/server.go#L1956</a></p>\n"}, {"comments": [{"owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "edited": false, "score": 0, "creation_date": 1533476409, "post_id": 51694153, "comment_id": 90350940, "body": "A function could be converted into function type via <code>T(v)</code> is not clear to me originally, that&#39;s the major reason caused my confusion."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 2, "last_activity_date": 1533470778, "creation_date": 1533470778, "answer_id": 51694153, "question_id": 51694086, "link": "https://stackoverflow.com/questions/51694086/how-handlerfuncf-convert-a-function-to-an-interface-type/51694153#51694153", "title": "How HandlerFunc(f) convert a function to an interface type?", "body": "<p>It is a simple type-conversion.</p>\n\n<p>In Go you can define custom type besides <code>struct</code>s. In this case, <code>http.HandlerFunc</code> is a function type, <code>func(http.ResponseWriter,*http.Request)</code>. Since your function is of the same underlying type (signature) as the custom type, it can be converted to it.</p>\n\n<p>Furthermore, code can define methods on custom type, no matter what underlying type it is, or whether it is a <code>struct</code> or not. In this case, <code>http</code> package defines <code>ServeHTTP</code> method on it, and of course, it just calls the function itself.</p>\n\n<p>You can read the source code here: <a href=\"https://golang.org/src/net/http/server.go?s=58384:58444#L1936\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/server.go?s=58384:58444#L1936</a></p>\n\n<p>As for the adder in your sample code, you can do the same: Define a method on <code>AdderFunc</code>.</p>\n\n<pre><code>func (a AdderFunc) add(x, y int) int {\n    return a(x, y)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/5mf_afHLQA2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5mf_afHLQA2</a></p>\n"}, {"tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": false, "score": 1, "last_activity_date": 1533470808, "creation_date": 1533470808, "answer_id": 51694163, "question_id": 51694086, "link": "https://stackoverflow.com/questions/51694086/how-handlerfuncf-convert-a-function-to-an-interface-type/51694163#51694163", "title": "How HandlerFunc(f) convert a function to an interface type?", "body": "<p>As the <a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"nofollow noreferrer\">docs</a> say:</p>\n\n<blockquote>\n  <p>The HandlerFunc type is an adapter to allow the use of ordinary functions as HTTP handlers. If f is a function with the appropriate signature, HandlerFunc(f) is a Handler that calls f.</p>\n</blockquote>\n\n<p>So, it's not a function, but a wrapper type, declared as:</p>\n\n<pre><code>type HandlerFunc func(ResponseWriter, *Request)\n</code></pre>\n\n<p>But Go allows (and that's one of its greatest features, in my opinion) to make any newly declared type implement any possible interface just by defining the require method. So the type <code>HandlerFunc</code> implements the interface <code>Handler</code> by defining the method <a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"nofollow noreferrer\"><code>ServeHttp</code></a>. The implementation just calls the wrapped function.</p>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 2, "last_activity_date": 1533471497, "creation_date": 1533471497, "answer_id": 51694233, "question_id": 51694086, "link": "https://stackoverflow.com/questions/51694086/how-handlerfuncf-convert-a-function-to-an-interface-type/51694233#51694233", "title": "How HandlerFunc(f) convert a function to an interface type?", "body": "<p><code>http.HandlerFunc</code> is a type that satisfy interface <code>http.Handler</code> by providing method <code>http.ServeHTTP(ResponseWriter, *Request)</code>.</p>\n\n<p><code>http.HandlerFunc(helloHandler)</code> is a type conversion which convert types with same underlying base type but different method set. </p>\n\n<p>You example <a href=\"https://play.golang.org/p/kmLBTUIBsqN\" rel=\"nofollow noreferrer\">working</a></p>\n"}], "owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 640, "favorite_count": 0, "accepted_answer_id": 51694153, "answer_count": 4, "score": 2, "last_activity_date": 1533507519, "creation_date": 1533470203, "last_edit_date": 1533507519, "question_id": 51694086, "link": "https://stackoverflow.com/questions/51694086/how-handlerfuncf-convert-a-function-to-an-interface-type", "title": "How HandlerFunc(f) convert a function to an interface type?", "body": "<p>When check following code, got a doubt with type convert from function to interface.</p>\n\n<hr>\n\n<h2>Code</h2>\n\n<p><strong>http_hello.go:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n)\n\n// hello http,\nfunc helloHttp() {\n    // register handler,\n    http.Handle(\"/\", http.HandlerFunc(helloHandler))\n\n    // start server,\n    err := http.ListenAndServe(\":9090\", nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe:\", err)\n    }\n\n}\n\n// handler function - hello,\nfunc helloHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello, you've requested: %s\\n\", r.URL.Path)\n}\n\nfunc main() {\n    helloHttp()\n}\n</code></pre>\n\n<p>The above code works.</p>\n\n<p><em>(Then I tried to write a small program to check is this a general feature, but it won't work, check following code)</em></p>\n\n<p><strong>func_to_intf.go:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n// an interface,\ntype Adder interface {\n    add(a, b int) int\n}\n\n// alias of a function signature,\ntype AdderFunc func(int, int) int\n\n// a simple add function,\nfunc simpleAdd(a, b int) int {\n    return a + b\n}\n\n// call Adder interface to perform add,\nfunc doAdd(a, b int, f Adder) int {\n    return f.add(a, b)\n}\n\nfunc funcToIntf() {\n    fa := AdderFunc(simpleAdd)\n    fmt.Printf(\"%#v, type: %T\\n\", fa, fa)\n\n    a, b := 1, 2\n    sum := doAdd(a, b, fa)\n    fmt.Printf(\"%d + %d = %d\\n\", a, b, sum)\n}\n\nfunc main() {\n    funcToIntf()\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<blockquote>\n  <p>./func_to_intf.go:30:14: cannot use fa (type AdderFunc) as type Adder\n  in argument to doAdd:     AdderFunc does not implement Adder (missing add\n  method)</p>\n</blockquote>\n\n<hr>\n\n<h2>Questions</h2>\n\n<ol>\n<li><code>http.HandlerFunc(helloHandler)</code> get a value of type <code>http.Handler</code>, since that's what <code>http.Handle()</code> expect, is that correct?</li>\n<li>If yes, then means it convert a function into a value of an interface type, how did that happen?  \n\n<ul>\n<li>Is this a built-in feature of go?<br>\nI did a test (as in <code>func_to_intf.go</code> above), and seems not.</li>\n<li>Or, is <code>http.HandlerFunc</code>'s special implementation achieve that?</li>\n</ul></li>\n</ol>\n\n<hr>\n\n<h2>@Update - Summary</h2>\n\n<p><em>(Though the answer(s) addressed the questions pretty well, but after reviewing &amp; more testing, there are several other go features required to totally erase the original doubt, as following.)</em></p>\n\n<ul>\n<li>Function type.<br>\nFunction is value, and it has type.<br>\nFunction type could be defined via <code>type</code> keyword on a function signature.<br>\ne.g <code>type AdderFunc func(int, int) int</code></li>\n<li>Type convertor <code>\uff34(v)</code> on function.<br>\nAny function could be converted to a function type with the same signature, just via <code>T(v)</code>, use function type name as <code>T</code>, and actual function as <code>v</code>.<br>\nThen when the new value is called, the actual function <code>v</code> is called.<br>\ne.g <code>fa := AdderFunc(simpleAdd)</code><br>\n<em>(this is blur to me before asking the question, and that's one of the main reason I was confused)</em>.</li>\n</ul>\n"}, {"tags": ["dictionary", "go"], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 8493648, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-GW3DKqIwDHk/AAAAAAAAAAI/AAAAAAAAABg/a1pBr2c-PqA/photo.jpg?sz=128", "display_name": "TheeCodeDragon", "link": "https://stackoverflow.com/users/8493648/theecodedragon"}, "edited": false, "score": 0, "creation_date": 1533477370, "post_id": 51694486, "comment_id": 90351213, "body": "Thanks alot, Atleast i see one person interested in giving a solution, that&#39;s what i tried but i got to extra email only under this function:  <a href=\"https://github.com/rageix/ginAuth/blob/master/example/controllers/login.go#L49\" rel=\"nofollow noreferrer\">link</a>  Still trying to explore. Cheers"}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "reply_to_user": {"reputation": 97, "user_id": 8493648, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-GW3DKqIwDHk/AAAAAAAAAAI/AAAAAAAAABg/a1pBr2c-PqA/photo.jpg?sz=128", "display_name": "TheeCodeDragon", "link": "https://stackoverflow.com/users/8493648/theecodedragon"}, "edited": false, "score": 0, "creation_date": 1533479964, "post_id": 51694486, "comment_id": 90351927, "body": "cast your interface to <code>map[string]interface</code> and look it up with %v to see whats its type"}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": true, "score": 0, "last_activity_date": 1533473521, "creation_date": 1533473521, "answer_id": 51694486, "question_id": 51692308, "link": "https://stackoverflow.com/questions/51692308/get-a-single-key-value-from-mapstringstring/51694486#51694486", "title": "Get a single key value from map[string]string", "body": "<p>type casting in golang is done by appending <code>.(T)</code></p>\n\n<pre><code>ip := cookieData[\"ip\"].(map[string]string)\nemail := ip[\"email\"]\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 8493648, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-GW3DKqIwDHk/AAAAAAAAAAI/AAAAAAAAABg/a1pBr2c-PqA/photo.jpg?sz=128", "display_name": "TheeCodeDragon", "link": "https://stackoverflow.com/users/8493648/theecodedragon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 51694486, "answer_count": 1, "score": -5, "last_activity_date": 1533473521, "creation_date": 1533454053, "question_id": 51692308, "link": "https://stackoverflow.com/questions/51692308/get-a-single-key-value-from-mapstringstring", "title": "Get a single key value from map[string]string", "body": "<p>I have a map being stored in my cookie as followed:</p>\n\n<pre><code>cookieData:=   map[expiration:1533455712 ip:[ hash:dd363d13234566727743277e96 email:user@user.com]\n\nfmt.Println(reflect.TypeOf(cookie)) &gt;&gt; map[string]string\n</code></pre>\n\n<p>Can someone please help me understand how i can get only the email value from this map?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["json", "go", "escaping"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1533450970, "post_id": 51691901, "comment_id": 90345538, "body": "A slight improvement is to return <code>string(b[1:len(b)-1])</code>.  This reduces memory allocated by two bytes.  Otherwise, marshaling is the way to encoded form of a string (or any other value)."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1533454669, "post_id": 51691901, "comment_id": 90346201, "body": "try HTMLEscape maybe? <a href=\"https://golang.org/pkg/encoding/json/#HTMLEscape\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#HTMLEscape</a>"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1533461908, "post_id": 51691901, "comment_id": 90347668, "body": "You can simply copy what is used inside the json package to do the job. <a href=\"https://golang.org/src/encoding/json/encode.go#L876\" rel=\"nofollow noreferrer\">golang.org/src/encoding/json/encode.go#L876</a> It&#39;s around line 876. If you discount for unicodes, it&#39;s basically just a <code>switch</code>."}, {"owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "edited": false, "score": 0, "creation_date": 1534716394, "post_id": 51691901, "comment_id": 90794039, "body": "The json.HTMLEscape escapes additional characters with the purpose of making JSON safe for embedding into HTML. JSON only needs &quot;, backslash, and control characters escaped.  <a href=\"https://www.json.org\" rel=\"nofollow noreferrer\">json.org</a>"}], "answers": [{"tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": true, "score": 1, "last_activity_date": 1533464190, "creation_date": 1533464190, "answer_id": 51693395, "question_id": 51691901, "link": "https://stackoverflow.com/questions/51691901/how-do-you-escape-characters-within-a-string-json-format-in-golang/51693395#51693395", "title": "How do you escape characters within a string (JSON format) in golang", "body": "<p>I don't know if using backticks <code>`</code> is the most idiomatic way to escape characters but is more readable, for example, you could use something like:</p>\n\n<pre><code>fmt.Println(jsonEscape(`dog \"fish\" cat`))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/khG7qBROaIx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/khG7qBROaIx</a></p>\n\n<p>Check the <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">String literals</a> section.</p>\n"}], "owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9118, "favorite_count": 1, "accepted_answer_id": 51693395, "answer_count": 1, "score": 7, "last_activity_date": 1566524053, "creation_date": 1533450048, "last_edit_date": 1566524053, "question_id": 51691901, "link": "https://stackoverflow.com/questions/51691901/how-do-you-escape-characters-within-a-string-json-format-in-golang", "title": "How do you escape characters within a string (JSON format) in golang", "body": "<p>What is the idiomatic way to escape only the characters in a string require to be escaped by the  <a href=\"https://www.json.org\" rel=\"noreferrer\">JSON specification</a>.</p>\n\n<p>(I am not trying to marshal/unmarshal an object or string, I just want to escape the characters inside a string. </p>\n\n<p>This works, but surely there is a more idiomatic way? <a href=\"https://play.golang.org/p/rcHZbrjFyyH\" rel=\"noreferrer\">https://play.golang.org/p/rcHZbrjFyyH</a></p>\n\n<pre><code>func main() {\n    fmt.Println(jsonEscape(`dog \"fish\" cat`))\n    //output: dog \\\"fish\\\" cat\n}\n\nfunc jsonEscape(i string) string {\n    b, err := json.Marshal(i)\n    if err != nil {\n        panic(err)\n    }\n    // Trim the beginning and trailing \" character\n    return string(b[1:len(b)-1])\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 36, "user_id": 10181030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a21fd741b292d53da33a588a3b2fb2a?s=128&d=identicon&r=PG&f=1", "display_name": "xH7UuDv2CW", "link": "https://stackoverflow.com/users/10181030/xh7uudv2cw"}, "edited": false, "score": 0, "creation_date": 1533421863, "post_id": 51689181, "comment_id": 90341815, "body": "Thank you! I get it. Fantastic explanation."}], "tags": [], "owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "is_accepted": false, "score": 2, "last_activity_date": 1533414435, "last_edit_date": 1533414435, "creation_date": 1533413062, "answer_id": 51689181, "question_id": 51689131, "link": "https://stackoverflow.com/questions/51689131/golang-object-scoping-with-loops-and-threads/51689181#51689181", "title": "Golang object scoping with loops and threads", "body": "<p>I modified your code a bit, and now it works as your expectation.</p>\n\n<hr>\n\n<h2>Code</h2>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"time\"\n)\n\ntype mystruct struct {\n    mybool bool\n}\n\nfunc newThing() *mystruct {\n    var ms mystruct\n    go func() {\n        for {\n            time.Sleep(time.Second / 2)\n            log.Println(\"loop says:\", ms.mybool)\n        }\n    }()\n    return &amp;ms\n}\n\nfunc (m *mystruct) switchIt() {\n    if m.mybool {\n        m.mybool = false\n    } else {\n        m.mybool = true\n    }\n}\n\nfunc main() {\n    thing := newThing()\n\n    time.Sleep(2 * time.Second)\n    thing.switchIt()\n\n    time.Sleep(2 * time.Second)\n    thing.switchIt()\n\n    time.Sleep(2 * time.Second)\n    thing.switchIt()\n}\n</code></pre>\n\n<hr>\n\n<h2>Tips</h2>\n\n<p><strong>Issues of your code:</strong></p>\n\n<ul>\n<li>I changed your <code>new()</code> to <code>newThing()</code>, because it's confusing with the built-in <code>new()</code> function.<br>\nEven though you can write it that way, but it's error-prone.</li>\n<li>Your original <code>new()</code> returns a copy of the struct, thus after calling <code>new()</code>, there are 2 copies of the struct, that's why you can never change it.<br>\nIn this case it's better to return a pointer instead.</li>\n</ul>\n\n<p><strong>Tips on <code>go</code>:</strong></p>\n\n<ul>\n<li>For <code>struct</code>, when assign / pass as param / return from function, it always makes a copy.<br>\nYou have 2 options to conquer this:  \n\n<ul>\n<li>Use a pointer instead.<br>\nIn that case there is only one copy of the struct.</li>\n<li>Let fields in the struct be pointers or similar reference types <em>(e.g slice or map)</em>.<br>\nIn that case, there are 2 copies of the struct, but those fields refer to the same underling data structure.<br>\nBut in you code, <code>bool</code> is not a reference type, so can't use this.</li>\n</ul></li>\n<li>Similar to <code>struct</code>, <code>array</code> behavior similarly.<br>\nThough most of the time, you will only use <code>slice</code> instead.</li>\n<li>On the other, <code>slice</code> / <code>map</code> contain reference to underling data structure that hold the actual data.<br>\nSo, if you assign a slice to another slice variable, or return it from a function, there will be 2 <code>slice</code>, but they still refer to the same underling data structure <em>(an <code>array</code>)</em>.<br>\nThus, changes made to one slice would be visible to the other.</li>\n</ul>\n\n<p>BTW, <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">Effective go</a> is a good place to pick up these tricky details about go :)</p>\n"}], "owner": {"reputation": 36, "user_id": 10181030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a21fd741b292d53da33a588a3b2fb2a?s=128&d=identicon&r=PG&f=1", "display_name": "xH7UuDv2CW", "link": "https://stackoverflow.com/users/10181030/xh7uudv2cw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1533414435, "creation_date": 1533412609, "question_id": 51689131, "link": "https://stackoverflow.com/questions/51689131/golang-object-scoping-with-loops-and-threads", "title": "Golang object scoping with loops and threads", "body": "<p>It's clear I don't understand something about scoping. I've distilled the problem down to the following (<a href=\"https://play.golang.org/p/d4WMf5sIxe1\" rel=\"nofollow noreferrer\">run it at The Go Playground</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"time\"\n)\n\ntype mystruct struct {\n    mybool bool\n}\n\nfunc new() mystruct {\n    var ms mystruct\n    go func() {\n            for {\n                    time.Sleep(time.Second/2)\n                    log.Println(\"loop says:\",ms.mybool)\n            }\n    }()\n    return ms\n}\n\nfunc (m *mystruct) switchIt() {\n    if m.mybool {\n            m.mybool = false\n    } else {\n            m.mybool = true\n    }\n}\n\nfunc main() {\n    thing := new()\n\n    time.Sleep(2 * time.Second)\n    thing.switchIt()\n\n    time.Sleep(2 * time.Second)\n    thing.switchIt()\n\n    time.Sleep(2 * time.Second)\n    thing.switchIt()\n}\n</code></pre>\n\n<p>As it is now, the boolean is always <code>false</code> from the perspective of the endless loop in <code>new()</code>'s anonymous function. I'm trying to change that value with <code>switchIt()</code> while the loop runs.</p>\n\n<p>Moving the boolean to a global variable gives the behavior I want (value changed from the loop's perspective), but I need the boolean to be part of the object because there will be several instantiations of the object.</p>\n"}, {"tags": ["dictionary", "go", "mutex"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533560245, "post_id": 51688104, "comment_id": 90377307, "body": "There are two kinds of operations, reads and writes. Editing a value is a write operation, not a read operation."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1533405478, "creation_date": 1533405478, "answer_id": 51688259, "question_id": 51688104, "link": "https://stackoverflow.com/questions/51688104/golang-rwmutex-on-map-content-edit/51688259#51688259", "title": "Golang RWMutex on map content edit", "body": "<p>Since the only way to change the value associated with the key in the map is to reassign the changed value to the same key, that is a write / modification, so you have to obtain the write lock\u2013simply using the read lock will not be sufficient.</p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 4, "last_activity_date": 1533636238, "last_edit_date": 1533636238, "creation_date": 1533406223, "answer_id": 51688354, "question_id": 51688104, "link": "https://stackoverflow.com/questions/51688104/golang-rwmutex-on-map-content-edit/51688354#51688354", "title": "Golang RWMutex on map content edit", "body": "<p>You should approach the problem from another angle.</p>\n\n<p>A simple rule of thumb you seem to understand just fine is</p>\n\n<blockquote>\n  <p>You need to protect the map from <em>concurrent accesses</em> when at least one of them is a <em>modification.</em></p>\n</blockquote>\n\n<p>Now the real question is what constitutes a modification of a map.</p>\n\n<p>To answer it properly, it helps to notice that <em>values stored in maps are not addressable</em> \u2014 by design.\nThis was engineered that way simply due to the fact maps internally have intricate implementation which\n<a href=\"https://en.wikipedia.org/wiki/Tree_rotation\" rel=\"nofollow noreferrer\">might move values they contain in memory</a>\nto provide (amortized) fast access time\nwhen the map's structure changes due to insertions and/or deletions of its elements.</p>\n\n<p>The fact map values are not addressable means you <em>can not</em> do\nsomething like</p>\n\n<pre><code>m := make(map[int]string)\nm[42] = \"hello\"\ngo mutate(&amp;m[42]) // take a single element and go modifying it...\n// ...while other parts of the program change _other_ values\nm[123] = \"blah blah\"\n</code></pre>\n\n<p>The reason you are not allowed to do this is the\ninsertion operation <code>m[123] = ...</code> might trigger moving\nthe storage of the map's element around, and that might\ninvolve moving the storage of the element keyed by <code>42</code>\nto some other place in memory \u2014 pulling the rug\nfrom under the feet of the goroutine\nrunning the <code>mutate</code> function.</p>\n\n<p>So, in Go, maps really only support three operations:</p>\n\n<ul>\n<li>Insert \u2014 or replace \u2014 an element;</li>\n<li>Read an element;</li>\n<li>Delete an element.</li>\n</ul>\n\n<p>You cannot modify an element \"in place\" \u2014 you can only\ngo in three steps:</p>\n\n<ol>\n<li>Read the element;</li>\n<li>Modify the variable containing the (read) copy;</li>\n<li>Replace the element by the modified copy.</li>\n</ol>\n\n<p>As you can now see, the steps (1) and (3) are mere map accesses,\nand so the answer to your question is (hopefully) apparent:\nthe step (1) shall be done under at least an read lock,\nand the step (3) shall be done under a write (exclusive) lock.</p>\n\n<hr>\n\n<p>In contrast, elements of other compound types \u2014\narrays (and slices) and fields of <code>struct</code> types \u2014\ndo not have the restriction maps have: provided the storage\nof the \"enclosing\" variable is not relocated, it is fine to\nchange its different elements concurrently by different goroutines.</p>\n"}], "owner": {"reputation": 103, "user_id": 9215075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WbQUu.jpg?s=128&g=1", "display_name": "Onelio", "link": "https://stackoverflow.com/users/9215075/onelio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 901, "favorite_count": 0, "accepted_answer_id": 51688354, "answer_count": 2, "score": 0, "last_activity_date": 1533636407, "creation_date": 1533404302, "last_edit_date": 1533636407, "question_id": 51688104, "link": "https://stackoverflow.com/questions/51688104/golang-rwmutex-on-map-content-edit", "title": "Golang RWMutex on map content edit", "body": "<p>I'm starting to use <code>RWMutex</code> in my Go project with <code>map</code> since now I have more than one routine running at the same time and while making all of the changes for that a doubt came to my mind.</p>\n\n<p>The thing is that I know that we must use <code>RLock</code> when only reading to allow other routines to do the same task and <code>Lock</code> when writing to full-block the map. But what are we supposed to do when editing a previously created element in the map?</p>\n\n<p>For example... Let's say I have a <code>map[int]string</code> where I do <code>Lock</code>, put inside <code>\"hello \"</code> and then <code>Unlock</code>. What if I want to add <code>\"world\"</code> to it? Should I do <code>Lock</code> or can I do <code>RLock</code>?</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1533404110, "post_id": 51687856, "comment_id": 90337993, "body": "You\u2019ll have 4 OS threads running goroutines instead of 2"}], "answers": [{"comments": [{"owner": {"reputation": 5450, "user_id": 942317, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/SY5ID.jpg?s=128&g=1", "display_name": "STEEL", "link": "https://stackoverflow.com/users/942317/steel"}, "edited": false, "score": 0, "creation_date": 1533489436, "post_id": 51688461, "comment_id": 90354443, "body": "Your answer even cleared my other queries which you covered under performance :) Many Thanks"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 5450, "user_id": 942317, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/SY5ID.jpg?s=128&g=1", "display_name": "STEEL", "link": "https://stackoverflow.com/users/942317/steel"}, "edited": false, "score": 1, "creation_date": 1533493398, "post_id": 51688461, "comment_id": 90355536, "body": "@STEEL, you might also be interested in reading <a href=\"https://rakyll.org/scheduler/\" rel=\"nofollow noreferrer\">this</a> and <a href=\"https://morsmachine.dk/go-scheduler\" rel=\"nofollow noreferrer\">this</a> (older but still mostly correct, and more explanatory than the former) documents detailing how the Go runtime scheduler executes goroutines on OS threads."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 3, "last_activity_date": 1533407148, "creation_date": 1533407148, "answer_id": 51688461, "question_id": 51687856, "link": "https://stackoverflow.com/questions/51687856/running-go-runtime-gomaxprocs4-on-a-dual-core-cpu/51688461#51688461", "title": "Running GO runtime.GOMAXPROCS(4) on a dual core cpu", "body": "<p><code>runtime.GOMAXPROCS</code> controls how many operating system-level threads will be created to run goroutines of your program (and the runtime powering it). (The runtime itself will create several more threads for itself but this is beside the point.)</p>\n\n<p>Basically, that is all that will happen.</p>\n\n<p>But supposedly, you intended to actually ask something like \"how would that affect the performance of my program?\", right?\nIf yes, the answer is \"it depends\".\nI'm not sure whether you had a chance to work with systems having only a single CPU with a single core (basically most consumer-grade IBM PC-compatible computers up to the generation of the Pentium\u00ae CPUs which had the so-called \"hyper-threading\" technology), but those systems were routinely running hundreds to thousands of OS threads on a \"single core\" (the term did not really existed in mainstream then but OK).</p>\n\n<p>Another thing to consider is that your program does not run in isolation: there are other programs running on the same CPU, and the kernel itself has several in-kernel threads as well.\nYou may use a tool like <code>top</code> or <code>htop</code> to assess the number of threads your system is currently scheduling across all your cores.</p>\n\n<p>By this time, you might be wondering why the Go runtime defaults to creating as many threads to power the goroutines as there are physical cores.</p>\n\n<p>Presumably, this comes from a simple fact that in a typical server-side workload, your program will be sort of \"the main one\".\nIn other words, the contention of its threads with the threads\nof other processes and the kernel will be reasonably low.</p>\n"}], "owner": {"reputation": 5450, "user_id": 942317, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/SY5ID.jpg?s=128&g=1", "display_name": "STEEL", "link": "https://stackoverflow.com/users/942317/steel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 51688461, "answer_count": 1, "score": 0, "last_activity_date": 1533407148, "creation_date": 1533402551, "question_id": 51687856, "link": "https://stackoverflow.com/questions/51687856/running-go-runtime-gomaxprocs4-on-a-dual-core-cpu", "title": "Running GO runtime.GOMAXPROCS(4) on a dual core cpu", "body": "<p>Sorry, if this sounds stupid.</p>\n\n<p>What will happen if run <code>runtime.GOMAXPROCS(4)</code> while <code>runtime.NumCpu() == 2</code></p>\n"}, {"tags": ["go", "kubernetes"], "answers": [{"comments": [{"owner": {"reputation": 1118, "user_id": 1547081, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Nni98.jpg?s=128&g=1", "display_name": "mikejoh", "link": "https://stackoverflow.com/users/1547081/mikejoh"}, "edited": false, "score": 1, "creation_date": 1533451803, "post_id": 51691652, "comment_id": 90345694, "body": "That slide deck is really great, thanks for sharing!!"}, {"owner": {"reputation": 958, "user_id": 1544021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47ea4ebd29b27e3dc2ee0ebbacec1033?s=128&d=identicon&r=PG", "display_name": "Paulo Schreiner", "link": "https://stackoverflow.com/users/1544021/paulo-schreiner"}, "edited": false, "score": 0, "creation_date": 1569577127, "post_id": 51691652, "comment_id": 102650658, "body": "Could you add why <code>k8s.io&#47;client-go</code> is the correct one?"}], "tags": [], "owner": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "is_accepted": true, "score": 7, "last_activity_date": 1533447030, "creation_date": 1533447030, "answer_id": 51691652, "question_id": 51687798, "link": "https://stackoverflow.com/questions/51687798/kubernetes-go-api/51691652#51691652", "title": "Kubernetes Go API", "body": "<blockquote>\n  <p>which one should I use? k8s.io/client-go or k8s.io/kubernetes/pkg/client?</p>\n</blockquote>\n\n<p>Use <code>k8s.io/client-go</code>.</p>\n\n<blockquote>\n  <p>what's the difference between using the api.Pods(\"\").Watch method and using an informer?</p>\n</blockquote>\n\n<p>The informer is essentially a shared cache, reducing the load on the API server. Unless you're doing something trivial, this is the preferred way.</p>\n\n<blockquote>\n  <p>how can I fetch the name of the node I'm currently in? </p>\n</blockquote>\n\n<p>Use <a href=\"https://godoc.org/k8s.io/api/core/v1#Node\" rel=\"noreferrer\">k8s.io/api/core/v1.Node</a>, see for example <a href=\"https://github.com/openshift-talks/k8s-go/blob/master/client-go-basic/main.go\" rel=\"noreferrer\">this code</a>.</p>\n\n<p>BTW, a colleague of mine and myself gave a workshop on this topic (using the Kube API with Go) last week at GopherCon UK\u2014maybe the <a href=\"https://301.sh/2018-gopherconuk-slides\" rel=\"noreferrer\">slide deck</a> and the <a href=\"https://github.com/openshift-talks/k8s-go\" rel=\"noreferrer\">repo</a> are useful for you; also, there is an accompanying online <a href=\"https://www.katacoda.com/mhausenblas/scenarios/k8s-go\" rel=\"noreferrer\">Katacoda scenario</a> you can use to play around.</p>\n"}], "owner": {"reputation": 3386, "user_id": 4158603, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/6A1qm.png?s=128&g=1", "display_name": "areller", "link": "https://stackoverflow.com/users/4158603/areller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 2, "accepted_answer_id": 51691652, "answer_count": 1, "score": 2, "last_activity_date": 1533447172, "creation_date": 1533402009, "question_id": 51687798, "link": "https://stackoverflow.com/questions/51687798/kubernetes-go-api", "title": "Kubernetes Go API", "body": "<p>I have some questions about the golang API for kubernetes.</p>\n\n<ol>\n<li><p>which one should I use? k8s.io/client-go or k8s.io/kubernetes/pkg/client? What's the difference?</p></li>\n<li><p>I want to get list of all pods and then listen to add/update/delete events, what's the difference between using the api.Pods(\"\").Watch method and using an informer?</p></li>\n<li><p>I'm using the API from inside the cluster, how can I fetch the name of the node I'm currently in? is it just the hostname of the machine?</p></li>\n</ol>\n"}, {"tags": ["java", "go", "cryptography", "bouncycastle", "ecdsa"], "comments": [{"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 2, "creation_date": 1533413206, "post_id": 51687749, "comment_id": 90340124, "body": "Bouncy Castle doesn&#39;t complain about your public key, it complains about the format of the signature, which you  haven&#39;t shown to us. Please include the bytes of the signature, in hexadecimals."}, {"owner": {"reputation": 23625, "user_id": 2868801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ec5567811049b7ce8192be0bc0246d1?s=128&d=identicon&r=PG&f=1", "display_name": "dave_thompson_085", "link": "https://stackoverflow.com/users/2868801/dave-thompson-085"}, "edited": false, "score": 0, "creation_date": 1533417170, "post_id": 51687749, "comment_id": 90340898, "body": "Also printing one byte per line is very clunky; consider <code>Arrays.toString(byte[])</code> or for hex <code>javax.xml.bind.DatatypeConverter.printHexBinary(byte[])</code>. And don&#39;t (ever) try to convert arbitrary binary, like crypto signatures and other crypto objects, to Java <code>String</code> directly; that&#39;s an excellent way to destroy your data. And finally using ECDSA(P384) with SHA1 is effectively throwing away most of your security -- but leave that for another Stack after you get your code working."}, {"owner": {"reputation": 1955, "user_id": 8967928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c0acd9a5526f9cfc04266e4e2b83f60?s=128&d=identicon&r=PG&f=1", "display_name": "lockcmpxchg8b", "link": "https://stackoverflow.com/users/8967928/lockcmpxchg8b"}, "edited": false, "score": 0, "creation_date": 1533423187, "post_id": 51687749, "comment_id": 90342008, "body": "Java JCE will definitely not be expecting a JSON formatted signature...so <code>json_response.getBytes(&quot;UTF-8&quot;)</code> makes me nervous in your update call."}, {"owner": {"reputation": 23625, "user_id": 2868801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ec5567811049b7ce8192be0bc0246d1?s=128&d=identicon&r=PG&f=1", "display_name": "dave_thompson_085", "link": "https://stackoverflow.com/users/2868801/dave-thompson-085"}, "reply_to_user": {"reputation": 1955, "user_id": 8967928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c0acd9a5526f9cfc04266e4e2b83f60?s=128&d=identicon&r=PG&f=1", "display_name": "lockcmpxchg8b", "link": "https://stackoverflow.com/users/8967928/lockcmpxchg8b"}, "edited": false, "score": 0, "creation_date": 1533515274, "post_id": 51687749, "comment_id": 90359946, "body": "@lockcmpxchg8b+ JWS format for ECDSA signature is (base64url of) fixed-length big-endian unsigned r,s with no metadata such as tags, which is the format used by PKCS11 and IINM P1363, and is supported by Bouncy (but not SunEC) though not used by default. But JWA requires the hash match the curve, so ECDSA(P-384) requires SHA-384."}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1533687314, "post_id": 51687749, "comment_id": 90434649, "body": "I&#39;m voting to close this question as off-topic because without the signature this question cannot be answered."}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1533687786, "post_id": 51687749, "comment_id": 90434730, "body": "Wow, that&#39;s a lot of answers you&#39;ve provided! I&#39;m feeling bad now having to vote to close. Please edit the question and provide the required info!"}], "answers": [{"tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": false, "score": 1, "last_activity_date": 1534260064, "creation_date": 1534260064, "answer_id": 51844796, "question_id": 51687749, "link": "https://stackoverflow.com/questions/51687749/decoding-ecdsa-fails-with-exception-in-thread-main-java-security-signatureexc/51844796#51844796", "title": "Decoding ECDSA fails with: Exception in thread &quot;main&quot; java.security.SignatureException: error decoding signature bytes", "body": "<p>I think your problem is here:</p>\n\n<pre><code>hash := fmt.Sprintf(\"%x\", hashBytes)\n</code></pre>\n\n<p>And you have to pass hashBytes directly to</p>\n\n<pre><code>r, s, err = ecdsa.Sign(rand.Reader, priv, hashBytes)\n</code></pre>\n"}], "owner": {"reputation": 1693, "user_id": 5731861, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iKaMT.png?s=128&g=1", "display_name": "Felipe Valdes", "link": "https://stackoverflow.com/users/5731861/felipe-valdes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1534260064, "creation_date": 1533401684, "question_id": 51687749, "link": "https://stackoverflow.com/questions/51687749/decoding-ecdsa-fails-with-exception-in-thread-main-java-security-signatureexc", "title": "Decoding ECDSA fails with: Exception in thread &quot;main&quot; java.security.SignatureException: error decoding signature bytes", "body": "<p>I'm trying to verify a ECDSA signature, using java, the key was created using golang:</p>\n\n<pre><code>import (\n\"crypto/ecdsa\"\n\"crypto/elliptic\"\n\"crypto/rand\"\n\"crypto/x509\"\n\"encoding/pem\"\n\"fmt\"\n\"io/ioutil\"\n\"reflect\"\n)\n\nfunc doit(){\nprivateKey, _ := ecdsa.GenerateKey(elliptic.P384(), rand.Reader)\npublicKey := &amp;privateKey.PublicKey\n\nif !elliptic.P384().IsOnCurve(publicKey.X, publicKey.Y) {\n    fmt.Printf(\" public key invalid. \")\n}\n\nencPriv, encPub := encode(privateKey, publicKey)\n\nfmt.Println(encPriv)\nfmt.Println(encPub)\n}\n</code></pre>\n\n<p>the signature happens here: (message was encoded by golang, using this method):</p>\n\n<pre><code>func SignMessage(message []byte) (r *big.Int, s *big.Int, err error) {\nzero := big.NewInt(0)\n// Hash message:\nh := sha1.New()\nio.WriteString(h, string(message))\nhashBytes := h.Sum(nil)\nhash := fmt.Sprintf(\"%x\", hashBytes)\n\n// hash message\n// get private key from disk:\npemEncoded, err := ioutil.ReadFile(\"./ecc/eccpriv.pem\")\nif err != nil {\n    return zero, zero, err\n}\npemEncodedPub, err := ioutil.ReadFile(\"./ecc/eccpub.pem\")\nif err != nil {\n    return zero, zero, err\n}\n\nvar priv *ecdsa.PrivateKey\n//var _pub *ecdsa.PublicKey\npriv, _, err = ECCDecodeFromPem(pemEncoded, pemEncodedPub)\nif err != nil {\n    return zero, zero, err\n}\n\nr, s, err = ecdsa.Sign(rand.Reader, priv, []byte(hash))\nif err != nil {\n    return zero, zero, err\n}\n\nreturn r, s, nil\n\n}\n</code></pre>\n\n<p>the decoding aspect is happening here:</p>\n\n<pre><code>        //Verify Response\n        String signature = ac.getECCDSAPublicKeyFromServer();\n        String cleanSignature = ac.cleanBytes(signature);\n        byte[] bSignature = Base64.getDecoder().decode(cleanSignature);\n\n        System.out.println(cleanSignature);\n        PublicKey ecdsaPublicKey = ac.getPemPublicKeyFromString(signature,\"ECDSA\");\n\n        //PublicKey ecdsaPublicKey = ac.getECDSAKeyFromBytes(cleanSignature.getBytes(\"UTF-8\"));\n\n        Signature ecdsaVerify = Signature.getInstance(\"ECDSA\", \"BC\");\n        ecdsaVerify.initVerify(ecdsaPublicKey);\n        ecdsaVerify.update(json_response.getBytes(\"UTF-8\"));\n        System.out.println(\"SIG:\");\n        for(int i=0;i&lt;bSignature.length;i++){\n            System.out.println(bSignature[i]);\n        }\n        System.out.println(new String(bSignature, StandardCharsets.UTF_8));\n        System.out.println(\"/SIG\");\n\n        boolean result = ecdsaVerify.verify(bSignature);\n        System.out.println(\"Result is:\"+result);\n</code></pre>\n\n<p>however, unfortunately, the program fails because:</p>\n\n<pre><code> Exception in thread \"main\" java.security.SignatureException: error decoding signature bytes.\n at org.bouncycastle.jcajce.provider.asymmetric.util.DSABase.engineVerify(Unknown Source)\n at java.base/java.security.Signature$Delegate.engineVerify(Signature.java:1245)\n at java.base/java.security.Signature.verify(Signature.java:674)\n at ...\n</code></pre>\n\n<p>This causes an interesting dilema, since the Public key:</p>\n\n<pre><code>-----BEGIN PUBLIC KEY-----\nMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAEBiTlkxxYVLduJeiQ7V1AqG4bY9lxrxLX\nun+qd4BeaICC1Yx/nsDvvXEPwfCYwXgnyk3u7DV3ldUiaXCIr89OoNei6D2Xgrs3\nKYtpVEv7ylnUzo8xZH3/mMdLMUiy6fl8\n-----END PUBLIC KEY-----\n</code></pre>\n\n<p>Seems to be correct, according to this website:</p>\n\n<p><a href=\"https://lapo.it/asn1js/#3076301006072A8648CE3D020106052B81040022036200040624E5931C5854B76E25E890ED5D40A86E1B63D971AF12D7BA7FAA77805E688082D58C7F9EC0EFBD710FC1F098C17827CA4DEEEC357795D522697088AFCF4EA0D7A2E83D9782BB37298B69544BFBCA59D4CE8F31647DFF98C74B3148B2E9F97C\" rel=\"nofollow noreferrer\">https://lapo.it/asn1js/#3076301006072A8648CE3D020106052B81040022036200040624E5931C5854B76E25E890ED5D40A86E1B63D971AF12D7BA7FAA77805E688082D58C7F9EC0EFBD710FC1F098C17827CA4DEEEC357795D522697088AFCF4EA0D7A2E83D9782BB37298B69544BFBCA59D4CE8F31647DFF98C74B3148B2E9F97C</a></p>\n\n<p>the Key was generated correctly, and the ASN.1 Parse decodes it correctly.\nWhy doesn't java like my code?</p>\n\n<p>Also, please pardon my poor indentation.</p>\n"}, {"tags": ["go", "kubernetes", "client-go"], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 1231624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9d0dc5be89d18df62dfea916dd2b9e9?s=128&d=identicon&r=PG", "display_name": "Kyroy", "link": "https://stackoverflow.com/users/1231624/kyroy"}, "edited": false, "score": 0, "creation_date": 1533454022, "post_id": 51691264, "comment_id": 90346080, "body": "Thanks for the reference :) I upvoted the answer because I managed to get a file from a container with this. <a href=\"https://gist.github.com/kyroy/8453a0c4e075e91809db9749e0adcff2\" rel=\"nofollow noreferrer\">gist.github.com/kyroy/8453a0c4e075e91809db9749e0adcff2</a> But I still couldn&#39;t manage to send a file :/"}, {"owner": {"reputation": 22353, "user_id": 225016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77d3c3ab5ddcf93a8ca1bfe1b481be1c?s=128&d=identicon&r=PG", "display_name": "mdaniel", "link": "https://stackoverflow.com/users/225016/mdaniel"}, "reply_to_user": {"reputation": 123, "user_id": 1231624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9d0dc5be89d18df62dfea916dd2b9e9?s=128&d=identicon&r=PG", "display_name": "Kyroy", "link": "https://stackoverflow.com/users/1231624/kyroy"}, "edited": false, "score": 0, "creation_date": 1533528996, "post_id": 51691264, "comment_id": 90362203, "body": "In that case, it <i>should</i> be possible to do the opposite command, too (although I admit I&#39;ve never tried it): <code>cat my-local-file | kubectl exec -i $pod -- sh -c &#39;cat &gt; &#47;the&#47;pod&#47;file&#39;</code> (one may have to play around with the <code>-t</code> option to <code>exec</code>, since I&#39;m not 100% certain if it matters about the tty)"}], "tags": [], "owner": {"reputation": 22353, "user_id": 225016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77d3c3ab5ddcf93a8ca1bfe1b481be1c?s=128&d=identicon&r=PG", "display_name": "mdaniel", "link": "https://stackoverflow.com/users/225016/mdaniel"}, "is_accepted": false, "score": 1, "last_activity_date": 1533441532, "creation_date": 1533441532, "answer_id": 51691264, "question_id": 51686986, "link": "https://stackoverflow.com/questions/51686986/how-to-copy-file-to-container-with-kubernetes-client-go/51691264#51691264", "title": "How to copy file to container with kubernetes client-go?", "body": "<p>Ironically, someone just today upvoted <a href=\"https://stackoverflow.com/questions/49421365/kubernetes-java-api-for-kubectl-copy-command/49421557#49421557\">my answer to this question for Java</a>. I haven't opened the <code>client-go</code> repo to have a look, but I would be very, very surprised if it exposes the <code>cp</code> command any more than the Java library does.</p>\n"}, {"comments": [{"owner": {"reputation": 12075, "user_id": 8757883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gQGYY.png?s=128&g=1", "display_name": "Akber Iqbal", "link": "https://stackoverflow.com/users/8757883/akber-iqbal"}, "edited": false, "score": 1, "creation_date": 1568623188, "post_id": 57952887, "comment_id": 102318454, "body": "While this link may answer the question, it is better to include the essential parts of the answer here and provide the link for reference.  Link-only answers can become invalid if the linked page changes. - <a href=\"/review/low-quality-posts/24059549\">From Review</a>"}, {"owner": {"reputation": 12075, "user_id": 8757883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gQGYY.png?s=128&g=1", "display_name": "Akber Iqbal", "link": "https://stackoverflow.com/users/8757883/akber-iqbal"}, "edited": false, "score": 0, "creation_date": 1568637388, "post_id": 57952887, "comment_id": 102325846, "body": "Voted it up because of the improvement you made"}], "tags": [], "owner": {"reputation": 41, "user_id": 6154622, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/401108fe5c1e092d179b42366b2fac03?s=128&d=identicon&r=PG&f=1", "display_name": "ica10888", "link": "https://stackoverflow.com/users/6154622/ica10888"}, "is_accepted": false, "score": 3, "last_activity_date": 1568624281, "last_edit_date": 1568624281, "creation_date": 1568621884, "answer_id": 57952887, "question_id": 51686986, "link": "https://stackoverflow.com/questions/51686986/how-to-copy-file-to-container-with-kubernetes-client-go/57952887#57952887", "title": "How to copy file to container with kubernetes client-go?", "body": "<p>There is the code using client-go realizes copying file to container, also counld copying file from container.</p>\n\n<p><a href=\"https://github.com/ica10888/client-go-helper/blob/master/pkg/kubectl/cp.go\" rel=\"nofollow noreferrer\">https://github.com/ica10888/client-go-helper/blob/master/pkg/kubectl/cp.go</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\u251c\u2500kubectl\n   \u2502  client.go\n   \u2502  cp.go\n   \u2514\u2500 stub.s\n\n</code></pre>\n\n<p>client</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package kubectl \n\nimport (\n    corev1client \"k8s.io/client-go/kubernetes/typed/core/v1\"\n    \"k8s.io/client-go/rest\"\n    \"k8s.io/client-go/tools/clientcmd\"\n)\n\n\nfunc InitRestClient() (*rest.Config, error, *corev1client.CoreV1Client) {\n    // Instantiate loader for kubeconfig file.\n    kubeconfig := clientcmd.NewNonInteractiveDeferredLoadingClientConfig(\n        clientcmd.NewDefaultClientConfigLoadingRules(),\n        &amp;clientcmd.ConfigOverrides{},\n    )\n    // Get a rest.Config from the kubeconfig file.  This will be passed into all\n    // the client objects we create.\n    restconfig, err := kubeconfig.ClientConfig()\n    if err != nil {\n        panic(err)\n    }\n    // Create a Kubernetes core/v1 client.\n    coreclient, err := corev1client.NewForConfig(restconfig)\n    if err != nil {\n        panic(err)\n    }\n    return restconfig, err, coreclient\n}\n</code></pre>\n\n<p>copyToPod and copyFromPod </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package kubectl\n\nimport (\n    \"archive/tar\"\n    \"fmt\"\n    \"io\"\n    corev1 \"k8s.io/api/core/v1\"\n    \"k8s.io/client-go/kubernetes/scheme\"\n    \"k8s.io/client-go/tools/remotecommand\"\n    _ \"k8s.io/kubernetes/pkg/kubectl/cmd/cp\"\n    cmdutil \"k8s.io/kubernetes/pkg/kubectl/cmd/util\"\n    \"log\"\n    \"os\"\n    \"path\"\n    \"path/filepath\"\n    \"strings\"\n    _ \"unsafe\"\n)\n\nfunc (i *pod) copyToPod(srcPath string, destPath string) error {\n    restconfig, err, coreclient := InitRestClient()\n\n    reader, writer := io.Pipe()\n    if destPath != \"/\" &amp;&amp; strings.HasSuffix(string(destPath[len(destPath)-1]), \"/\") {\n        destPath = destPath[:len(destPath)-1]\n    }\n    if err := checkDestinationIsDir(i, destPath); err == nil {\n        destPath = destPath + \"/\" + path.Base(srcPath)\n    }\n    go func() {\n        defer writer.Close()\n        err := cpMakeTar(srcPath, destPath, writer)\n        cmdutil.CheckErr(err)\n    }()\n    var cmdArr []string\n\n    cmdArr = []string{\"tar\", \"-xf\", \"-\"}\n    destDir := path.Dir(destPath)\n    if len(destDir) &gt; 0 {\n        cmdArr = append(cmdArr, \"-C\", destDir)\n    }\n    //remote shell.\n    req := coreclient.RESTClient().\n        Post().\n        Namespace(i.Namespace).\n        Resource(\"pods\").\n        Name(i.Name).\n        SubResource(\"exec\").\n        VersionedParams(&amp;corev1.PodExecOptions{\n            Container: i.ContainerName,\n            Command:   cmdArr,\n            Stdin:     true,\n            Stdout:    true,\n            Stderr:    true,\n            TTY:       false,\n        }, scheme.ParameterCodec)\n\n    exec, err := remotecommand.NewSPDYExecutor(restconfig, \"POST\", req.URL())\n    if err != nil {\n        log.Fatalf(\"error %s\\n\", err)\n        return err\n    }\n    err = exec.Stream(remotecommand.StreamOptions{\n        Stdin:  reader,\n        Stdout: os.Stdout,\n        Stderr: os.Stderr,\n        Tty:    false,\n    })\n    if err != nil {\n        log.Fatalf(\"error %s\\n\", err)\n        return err\n    }\n    return nil\n}\n\nfunc checkDestinationIsDir(i *pod, destPath string) error {\n    return i.Exec([]string{\"test\", \"-d\", destPath})\n}\n\n//go:linkname cpMakeTar k8s.io/kubernetes/pkg/kubectl/cmd/cp.makeTar\nfunc cpMakeTar(srcPath, destPath string, writer io.Writer) error\n\nfunc (i *pod) copyFromPod(srcPath string, destPath string) error {\n    restconfig, err, coreclient := InitRestClient()\n    reader, outStream := io.Pipe()\n    //todo some containers failed : tar: Refusing to write archive contents to terminal (missing -f option?) when execute `tar cf -` in container\n    cmdArr := []string{\"tar\", \"cf\", \"-\", srcPath}\n    req := coreclient.RESTClient().\n        Get().\n        Namespace(i.Namespace).\n        Resource(\"pods\").\n        Name(i.Name).\n        SubResource(\"exec\").\n        VersionedParams(&amp;corev1.PodExecOptions{\n            Container: i.ContainerName,\n            Command:   cmdArr,\n            Stdin:     true,\n            Stdout:    true,\n            Stderr:    true,\n            TTY:       false,\n        }, scheme.ParameterCodec)\n\n    exec, err := remotecommand.NewSPDYExecutor(restconfig, \"POST\", req.URL())\n    if err != nil {\n        log.Fatalf(\"error %s\\n\", err)\n        return err\n    }\n    go func() {\n        defer outStream.Close()\n        err = exec.Stream(remotecommand.StreamOptions{\n            Stdin:  os.Stdin,\n            Stdout: outStream,\n            Stderr: os.Stderr,\n            Tty:    false,\n        })\n        cmdutil.CheckErr(err)\n    }()\n    prefix := getPrefix(srcPath)\n    prefix = path.Clean(prefix)\n    prefix = cpStripPathShortcuts(prefix)\n    destPath = path.Join(destPath, path.Base(prefix))\n    err = untarAll(reader, destPath, prefix)\n    return err\n}\n\nfunc untarAll(reader io.Reader, destDir, prefix string) error {\n    tarReader := tar.NewReader(reader)\n    for {\n        header, err := tarReader.Next()\n        if err != nil {\n            if err != io.EOF {\n                return err\n            }\n            break\n        }\n\n        if !strings.HasPrefix(header.Name, prefix) {\n            return fmt.Errorf(\"tar contents corrupted\")\n        }\n\n        mode := header.FileInfo().Mode()\n        destFileName := filepath.Join(destDir, header.Name[len(prefix):])\n\n        baseName := filepath.Dir(destFileName)\n        if err := os.MkdirAll(baseName, 0755); err != nil {\n            return err\n        }\n        if header.FileInfo().IsDir() {\n            if err := os.MkdirAll(destFileName, 0755); err != nil {\n                return err\n            }\n            continue\n        }\n\n        evaledPath, err := filepath.EvalSymlinks(baseName)\n        if err != nil {\n            return err\n        }\n\n        if mode&amp;os.ModeSymlink != 0 {\n            linkname := header.Linkname\n\n            if !filepath.IsAbs(linkname) {\n                _ = filepath.Join(evaledPath, linkname)\n            }\n\n            if err := os.Symlink(linkname, destFileName); err != nil {\n                return err\n            }\n        } else {\n            outFile, err := os.Create(destFileName)\n            if err != nil {\n                return err\n            }\n            defer outFile.Close()\n            if _, err := io.Copy(outFile, tarReader); err != nil {\n                return err\n            }\n            if err := outFile.Close(); err != nil {\n                return err\n            }\n        }\n    }\n\n    return nil\n}\n\nfunc getPrefix(file string) string {\n    return strings.TrimLeft(file, \"/\")\n}\n\n//go:linkname cpStripPathShortcuts k8s.io/kubernetes/pkg/kubectl/cmd/cp.stripPathShortcuts\nfunc cpStripPathShortcuts(p string) string\n\n\n</code></pre>\n\n<p>touch stub.s</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 1231624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9d0dc5be89d18df62dfea916dd2b9e9?s=128&d=identicon&r=PG", "display_name": "Kyroy", "link": "https://stackoverflow.com/users/1231624/kyroy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2742, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1568624281, "creation_date": 1533396046, "question_id": 51686986, "link": "https://stackoverflow.com/questions/51686986/how-to-copy-file-to-container-with-kubernetes-client-go", "title": "How to copy file to container with kubernetes client-go?", "body": "<p>I want to use <a href=\"https://github.com/kubernetes/client-go\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/client-go</a> to copy a file from my file system to a container and vice versa.</p>\n\n<pre><code>kubectl cp &lt;file-spec-src&gt; &lt;file-spec-dest&gt; -c &lt;specific-container&gt;\n</code></pre>\n\n<p>Is there a function in the go client that wraps the calls? Or can I use something like the <a href=\"https://godoc.org/k8s.io/client-go/kubernetes/typed/core/v1#CoreV1Interface.RESTClient\" rel=\"nofollow noreferrer\">RESTClient</a>?</p>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 1, "creation_date": 1533396928, "post_id": 51686129, "comment_id": 90336144, "body": "See also the extended description of the <code>golang:alpine</code> images on <a href=\"https://hub.docker.com/_/golang/\" rel=\"nofollow noreferrer\">hub.docker.com/_/golang</a> ...but that seems like a very clear error message to me."}], "answers": [{"tags": [], "owner": {"reputation": 19654, "user_id": 92837, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1375f202e61682cc4963295f4b0430dc?s=128&d=identicon&r=PG", "display_name": "Sathyajith Bhat", "link": "https://stackoverflow.com/users/92837/sathyajith-bhat"}, "is_accepted": true, "score": 13, "last_activity_date": 1611605463, "last_edit_date": 1611605463, "creation_date": 1533390770, "answer_id": 51686280, "question_id": 51686129, "link": "https://stackoverflow.com/questions/51686129/install-golang-external-packages-in-docker-container/51686280#51686280", "title": "Install golang external packages in docker container", "body": "<p>The error says that you don't have git as part of the base image</p>\n<pre><code>&quot;git&quot;: executable file not found in $PATH\n</code></pre>\n<p>Install it</p>\n<pre><code>FROM golang:1.8-alpine\nRUN apk update &amp;&amp; apk add git &amp;&amp; go get gopkg.in/natefinch/lumberjack.v2\nEXPOSE 8080\n</code></pre>\n<p>then when you build it should be fine</p>\n<pre><code>docker build .\nSending build context to Docker daemon  2.048kB\nStep 1/3 : FROM golang:1.8-alpine\n ---&gt; 4cb86d3661bf\nStep 2/3 : RUN apk update &amp;&amp; apk add git &amp;&amp; go get gopkg.in/natefinch/lumberjack.v2\n ---&gt; Running in 8f4b12af99af\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.5/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.5/community/x86_64/APKINDEX.tar.gz\nv3.5.2-356-ga384f1f9b9 [http://dl-cdn.alpinelinux.org/alpine/v3.5/main]\nv3.5.2-348-gf3907a61f6 [http://dl-cdn.alpinelinux.org/alpine/v3.5/community]\nOK: 7964 distinct packages available\n(1/5) Installing libssh2 (1.7.0-r2)\n(2/5) Installing libcurl (7.61.0-r0)\n(3/5) Installing expat (2.2.0-r1)\n(4/5) Installing pcre (8.39-r0)\n(5/5) Installing git (2.11.3-r1)\nExecuting busybox-1.25.1-r1.trigger\nOK: 28 MiB in 17 packages\nRemoving intermediate container 8f4b12af99af\n ---&gt; d8d5badecd71\nStep 3/3 : EXPOSE 8080\n ---&gt; Running in 0ebd5797b55e\nRemoving intermediate container 0ebd5797b55e\n ---&gt; 7187901edcf4\nSuccessfully built 7187901edcf4\n</code></pre>\n"}], "owner": {"reputation": 314, "user_id": 4115776, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-3Gk5yx6_Z78/AAAAAAAAAAI/AAAAAAAAABg/mHIiTNN0ack/photo.jpg?sz=128", "display_name": "Nirmal Vatsyayan", "link": "https://stackoverflow.com/users/4115776/nirmal-vatsyayan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4738, "favorite_count": 0, "accepted_answer_id": 51686280, "answer_count": 1, "score": 5, "last_activity_date": 1611605463, "creation_date": 1533389751, "question_id": 51686129, "link": "https://stackoverflow.com/questions/51686129/install-golang-external-packages-in-docker-container", "title": "Install golang external packages in docker container", "body": "<p>I am trying to get an external library in golang but when i fire below command :</p>\n\n<pre><code>FROM golang:1.8-alpine\nRUN go get gopkg.in/natefinch/lumberjack.v2\nEXPOSE 8080\n</code></pre>\n\n<p>it gives below error:</p>\n\n<pre><code>go: missing Git command. See https://golang.org/s/gogetcmd\npackage github.com/gin-gonic/gin: exec: \"git\": executable file not found in $PATH\n</code></pre>\n\n<p>I am using golang:1.8-alpine. Please help how to fix this.</p>\n"}, {"tags": ["python", "regex", "go"], "comments": [{"owner": {"reputation": 91778, "user_id": 354577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dI6cA.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/354577/chris"}, "edited": false, "score": 3, "creation_date": 1533387594, "post_id": 51685744, "comment_id": 90333664, "body": "Why the Python and Go tags? Which language are you using? Also, what are some sample inputs and expected outputs? Please <a href=\"https://stackoverflow.com/posts/51685744/edit\">edit</a> your question and add a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 3, "user_id": 10158180, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XXOkgIUgwPA/AAAAAAAAAAI/AAAAAAAAACM/wBlK5JwiHbU/photo.jpg?sz=128", "display_name": "PoormaJin Rao", "link": "https://stackoverflow.com/users/10158180/poormajin-rao"}, "reply_to_user": {"reputation": 91778, "user_id": 354577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dI6cA.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/354577/chris"}, "edited": false, "score": 0, "creation_date": 1533393401, "post_id": 51685744, "comment_id": 90335212, "body": "Hello, I have already modified the problem, I use golang now, but regular expressions are the same, python USES more regular expressions"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 2, "creation_date": 1533393794, "post_id": 51685744, "comment_id": 90335304, "body": "I can&#39;t make any sense of this question. Please take some time to <a href=\"/help/formatting\">format it properly</a>."}, {"owner": {"reputation": 3, "user_id": 10158180, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XXOkgIUgwPA/AAAAAAAAAAI/AAAAAAAAACM/wBlK5JwiHbU/photo.jpg?sz=128", "display_name": "PoormaJin Rao", "link": "https://stackoverflow.com/users/10158180/poormajin-rao"}, "edited": false, "score": 0, "creation_date": 1533395280, "post_id": 51685744, "comment_id": 90335718, "body": "I&#39;ve described it clearly, and it has nothing to do with the code. Regular expressions are the same in any language. Thank you for your reply. Let me think for myself. It should work out"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 2, "creation_date": 1533396247, "post_id": 51685744, "comment_id": 90335975, "body": "I can&#39;t understand your question. Please edit it so we can be sure of 1. <b>the regular expression you are using</b> 2. <b>the desired output</b> 3. <b>The input</b>."}, {"owner": {"reputation": 3, "user_id": 10158180, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XXOkgIUgwPA/AAAAAAAAAAI/AAAAAAAAACM/wBlK5JwiHbU/photo.jpg?sz=128", "display_name": "PoormaJin Rao", "link": "https://stackoverflow.com/users/10158180/poormajin-rao"}, "edited": false, "score": 0, "creation_date": 1533397776, "post_id": 51685744, "comment_id": 90336380, "body": "Okay, I&#39;m rearranging the problem"}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 0, "last_activity_date": 1533541595, "last_edit_date": 1533541595, "creation_date": 1533410741, "answer_id": 51688917, "question_id": 51685744, "link": "https://stackoverflow.com/questions/51685744/the-regular-expression-does-not-match/51688917#51688917", "title": "The regular expression does not match", "body": "<p>You probably want something like this regexp: </p>\n\n<pre><code>var re = regexp.MustCompile(`\\[ORM\\][^-]* -\\[[^]]*\\] - \\[ .* / .* / ([^]]*)] - \\[([^]]*)\\] - (.*)`)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/MUBzaiyyCWt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MUBzaiyyCWt</a></p>\n\n<p>This assumes well-formed data, one entry per line. If not you probably won't be able to parse it with a regexp, and even this makes some assumptions about queries not including the strings [] (which you might get away with). </p>\n\n<p>First I'd double check that you absolutely cannot get this data output in the right format in the first place - if you can it'd be far better to get the output you want directly, perhaps even have a separate log, or even better send metrics like this to a time series database for later analysis. Parsing logs for this sort of info isn't great, particularly if done on an ongoing basis. </p>\n\n<p>If you must parse logs, some advice on testing this: </p>\n\n<ul>\n<li>Use play.golang.org for a quick tests</li>\n<li>Use regexp.MustCompile to check your regexp works</li>\n<li>Create a function to parse the lines</li>\n<li>Write some tests which exercise your function, using lines from the log</li>\n</ul>\n"}], "owner": {"reputation": 3, "user_id": 10158180, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XXOkgIUgwPA/AAAAAAAAAAI/AAAAAAAAACM/wBlK5JwiHbU/photo.jpg?sz=128", "display_name": "PoormaJin Rao", "link": "https://stackoverflow.com/users/10158180/poormajin-rao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 1, "closed_date": 1533411666, "accepted_answer_id": 51688917, "answer_count": 1, "score": -4, "last_activity_date": 1533541595, "creation_date": 1533386959, "last_edit_date": 1533399034, "question_id": 51685744, "link": "https://stackoverflow.com/questions/51685744/the-regular-expression-does-not-match", "closed_reason": "Needs details or clarity", "title": "The regular expression does not match", "body": "<p>I tried to get SQL information from log files using regular expressions</p>\n\n<p>The information I need is the running time of the SQL, the SQL statement, the parameters of the SQL</p>\n\n<p>Here's my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"regexp\"\n)\n\nfunc main(){\n    file,err:=os.OpenFile(\"./log.txt\",os.O_RDWR,0755)\n    if err !=nil{\n        fmt.Println(err)\n    }\n    b,err:=ioutil.ReadAll(file)\n    str:=string(b)\n    r,err:=regexp.Compile(`\\[ORM\\][\\w\\W]+?(\\d*.\\d*ms|\\d*.\\d*s)\\][ -]+\\[([\\w\\W]+?)\\]`)\n\n    s:=r.FindAllStringSubmatch(str,-1)\n    fmt.Println(s[0][3])\n    fmt.Println(s[1][3])\n}\n</code></pre>\n\n<p>This is my log sample</p>\n\n<blockquote>\n  <p>[ORM]2018/08/03 10:23:50  -[Queries/read] - [  OK /    db.Query /   432.4ms] - [SELECT acc.*,gp.group_name,gp.group_id,org.org_name,group_concat(r.role_name) role_name\n              FROM sys_account acc\n              LEFT JOIN sys_org org on org.org_id=acc.org_id\n              LEFT JOIN sys_group gp on gp.group_id=org.group_id\n              LEFT JOIN sys_account_role ar on ar.acct_id=acc.acct_id and ar.is_del=0\n              LEFT JOIN sys_role r on r.role_id=ar.role_id  where 1=1  and acc.acct_type=1  group by acc.acct_id order by acc.create_time  desc  LIMIT 0, 15] - `1` `ASDFASDF`\n  nsq consumer2: INF   13 [RYOLST_Ch_admin/crm] (192.168.1.233:4150) received CLOSE_WAIT from nsqd\n  nsq consumer2: INF   13 [RYOLST_Ch_admin/crm] (192.168.1.233:4150) beginning close\n  nsq consumer2: INF   13 [RYOLST_Ch_admin/crm] (192.168.1.233:4150) readLoop exiting\n  nsq consumer2: INF   13 [RYOLST_Ch_admin/crm] (192.168.1.233:4150) breaking out of writeLoop\n  nsq consumer2: INF   13 [RYOLST_Ch_admin/crm] (192.168.1.233:4150) writeLoop exiting\n  [ORM]2018/08/03 10:23:50  -[Queries/default] - [  OK /    db.Query /     0.6ms] - [select * from sys_group where group_id=? ] - `111` `qwqwqw`</p>\n</blockquote>\n\n<p>I hope so Print out the</p>\n\n<p>`1` `ASDFASDF`</p>\n\n<p>`111` `qwqwqw`</p>\n\n<p>I'm now left with the last argument that I can't get</p>\n\n<p>These parameters may or may not be multiple\u3001You can also have too many arguments wrapping around the file</p>\n\n<p>I have tried this myself\uff1a</p>\n\n<pre><code>r,err:=regexp.Compile(`\\[ORM\\][\\w\\W]+?(\\d*.\\d*ms|\\d*.\\d*s)\\][ -]+\\[([\\w\\W]+?)\\][ -]*((\\W\\w*\\W{1,2})*)`)\nr,err:=regexp.Compile(`\\[ORM\\][\\w\\W]+?(\\d*.\\d*ms|\\d*.\\d*s)\\][ -]+\\[([\\w\\W]+?)\\][- ]*([^\\n]*)`)\n</code></pre>\n"}, {"tags": ["go", "docker-compose"], "answers": [{"comments": [{"owner": {"reputation": 314, "user_id": 4115776, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-3Gk5yx6_Z78/AAAAAAAAAAI/AAAAAAAAABg/mHIiTNN0ack/photo.jpg?sz=128", "display_name": "Nirmal Vatsyayan", "link": "https://stackoverflow.com/users/4115776/nirmal-vatsyayan"}, "edited": false, "score": 0, "creation_date": 1533393785, "post_id": 51685560, "comment_id": 90335302, "body": "Thanks it picks the file, but its unable to pick the dependencies installed by docker file. Do you have information about it ?"}], "tags": [], "owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "is_accepted": true, "score": 0, "last_activity_date": 1533408596, "last_edit_date": 1533408596, "creation_date": 1533385727, "answer_id": 51685560, "question_id": 51684590, "link": "https://stackoverflow.com/questions/51684590/docker-compose-working-dir-issue/51685560#51685560", "title": "Docker compose working_dir issue", "body": "<p>it works fine when your host dir layout is </p>\n\n<pre><code>oxo@thor ~/Dropbox/Documents/code/docker/golang_working_dir $ find .\n.\n./docker-compose.yaml\n./simple-golang-app\n./simple-golang-app/main.go\n</code></pre>\n\n<p>so here we</p>\n\n<pre><code>cd ~/Dropbox/Documents/code/docker/golang_working_dir\ndocker-compose up\n</code></pre>\n\n<p>for a more complex build involving dependancies I use a Dockerfile :</p>\n\n<pre><code>FROM golang:1.8-alpine\n\nRUN mkdir -p /go/src/simple-golang-app/\nCOPY simple-golang-app/main.go   /go/src/simple-golang-app\nWORKDIR  /go/src/simple-golang-app\nRUN apk add --no-cache git mercurial &amp;&amp; go get -v -t ./...  &amp;&amp; apk del git mercurial\nRUN go install ./...\nRUN go build \n\nENV PORT 9000\n</code></pre>\n\n<p>now update your docker-compose.yaml to use this new image : </p>\n\n<p>old</p>\n\n<pre><code>image: golang:1.8-alpine\n</code></pre>\n\n<p>new</p>\n\n<pre><code>image: nirmal_golang_alpine:latest\n</code></pre>\n\n<p>so your commands are</p>\n\n<pre><code>docker build --tag nirmal_golang_alpine\n\ndocker-compose up\n</code></pre>\n"}], "owner": {"reputation": 314, "user_id": 4115776, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-3Gk5yx6_Z78/AAAAAAAAAAI/AAAAAAAAABg/mHIiTNN0ack/photo.jpg?sz=128", "display_name": "Nirmal Vatsyayan", "link": "https://stackoverflow.com/users/4115776/nirmal-vatsyayan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3704, "favorite_count": 2, "accepted_answer_id": 51685560, "answer_count": 1, "score": 2, "last_activity_date": 1533408596, "creation_date": 1533377776, "question_id": 51684590, "link": "https://stackoverflow.com/questions/51684590/docker-compose-working-dir-issue", "title": "Docker compose working_dir issue", "body": "<p>I am trying to run a golang app using docker-compose, below is my compose configuration.</p>\n\n<pre><code>version: '2'\nservices:\n\n    #Application container\n    go:\n        image: golang:1.8-alpine\n        ports:\n            - \"80:8080\"\n        links:\n            - mongodb\n        environment:\n            DEBUG: 'true'\n            PORT: '8080'\n        working_dir: /go/src/simple-golang-app\n        command: go run main.go\n        volumes:\n            - ./simple-golang-app:/go/src/simple-golang-app\n\n    mongodb:\n        image: mvertes/alpine-mongo:3.2.3\n        restart: unless-stopped\n        ports:\n            - \"27017:27017\"\n</code></pre>\n\n<p>On running the compose using command \"docker-compose up\" i get error \"stat main.go: no such file or directory\" even when main.go is available in working directory.</p>\n"}, {"tags": ["sql", "regex", "go", "logging"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10158180, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XXOkgIUgwPA/AAAAAAAAAAI/AAAAAAAAACM/wBlK5JwiHbU/photo.jpg?sz=128", "display_name": "PoormaJin Rao", "link": "https://stackoverflow.com/users/10158180/poormajin-rao"}, "edited": false, "score": 0, "creation_date": 1533376766, "post_id": 51684368, "comment_id": 90331137, "body": "It is effective to try the method you provided, thank you  :P"}], "tags": [], "owner": {"reputation": 28228, "user_id": 7132550, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1063981417044495/picture?type=large", "display_name": "Micha\u0142 Turczyn", "link": "https://stackoverflow.com/users/7132550/micha%c5%82-turczyn"}, "is_accepted": true, "score": 0, "last_activity_date": 1533375811, "creation_date": 1533375811, "answer_id": 51684368, "question_id": 51684289, "link": "https://stackoverflow.com/questions/51684289/the-golang-regular-expression-gets-the-sql-statement-in-the-log-file/51684368#51684368", "title": "The golang regular expression gets the SQL statement in the log file", "body": "<p>Try this pattern: <code>\\[ORM\\][\\w\\W]+?\\wms\\][ -]+\\[([\\w\\W]+?)\\]</code>.</p>\n\n<p>Explanation:</p>\n\n<p><code>\\[ORM\\]</code> - match <code>[ORM]</code>,</p>\n\n<p><code>[\\w\\W]+?\\wms</code> - match any character (inlucding <code>\\n</code>) until <code>\\wms</code> is found (<code>\\w</code> is a word character, can be digit as well) - non greedy, so it stops at first occurence of <code>\\wms</code>, so it won't capture until the second SQL log.</p>\n\n<p><code>([\\w\\W]+?)\\]</code> - capturing group, that will contain full SQL statement, again non-greedy search for any character, similairly as above.</p>\n\n<p><a href=\"https://regex101.com/r/Py8IHO/5\" rel=\"nofollow noreferrer\">Demo</a></p>\n"}], "owner": {"reputation": 3, "user_id": 10158180, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XXOkgIUgwPA/AAAAAAAAAAI/AAAAAAAAACM/wBlK5JwiHbU/photo.jpg?sz=128", "display_name": "PoormaJin Rao", "link": "https://stackoverflow.com/users/10158180/poormajin-rao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 51684368, "answer_count": 1, "score": 0, "last_activity_date": 1533375811, "creation_date": 1533375160, "question_id": 51684289, "link": "https://stackoverflow.com/questions/51684289/the-golang-regular-expression-gets-the-sql-statement-in-the-log-file", "title": "The golang regular expression gets the SQL statement in the log file", "body": "<p>I tried to get the SQL statement in the log file through the regular expression of golang, but there were some problems with the matching results. If the SQL did not break lines in the code, the correct result could be obtained, but if it was long and divided into multiple lines in the code, my SQL could only be part of the first line\u3002my expectation is to get two full SQL\nBelow are my code and some sample logs</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"regexp\"\n)\n\nfunc main() {\n    file, err := os.OpenFile(\"/home/gopath/src/log.txt\", os.O_RDWR, 0766)\n    if err != nil {\n        fmt.Println(err)\n    }\n    res, err := ioutil.ReadAll(file)\n    reg := regexp.MustCompile(`\\[ORM\\].*`)\n    str := reg.FindAllStringSubmatch(string(res), -1)\n    fmt.Println(str)\n}\n</code></pre>\n\n<blockquote>\n  <p>[ORM]2018/08/03 10:23:50  -[Queries/read] - [  OK /    db.Query /   432.4ms] - [SELECT acc.*,gp.group_name,gp.group_id,org.org_name,group_concat(r.role_name) role_name\n              FROM sys_account acc\n              LEFT JOIN sys_org org on org.org_id=acc.org_id\n              LEFT JOIN sys_group gp on gp.group_id=org.group_id\n              LEFT JOIN sys_account_role ar on ar.acct_id=acc.acct_id and ar.is_del=0\n              LEFT JOIN sys_role r on r.role_id=ar.role_id  where 1=1  and acc.acct_type=1  group by acc.acct_id order by acc.create_time  desc  LIMIT 0, 15]\n  nsq consumer2: INF   13 [RYOLST_Ch_admin/crm] (192.168.1.233:4150) received CLOSE_WAIT from nsqd\n  nsq consumer2: INF   13 [RYOLST_Ch_admin/crm] (192.168.1.233:4150) beginning close\n  nsq consumer2: INF   13 [RYOLST_Ch_admin/crm] (192.168.1.233:4150) readLoop exiting\n  nsq consumer2: INF   13 [RYOLST_Ch_admin/crm] (192.168.1.233:4150) breaking out of writeLoop\n  nsq consumer2: INF   13 [RYOLST_Ch_admin/crm] (192.168.1.233:4150) writeLoop exiting\n  [ORM]2018/08/03 10:23:50  -[Queries/default] - [  OK /    db.Query /     0.6ms] - [select * from sys_group where group_id=? ] - <code>1</code></p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1533396540, "post_id": 51683762, "comment_id": 90336043, "body": "Like it is handling any interface combined with reflection. What is the actual question?"}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 5, "creation_date": 1533380294, "post_id": 51684031, "comment_id": 90331863, "body": "Which begs the question: how does reflect figure out the type? This answer is missing the fact that interface values are tuples of a concrete type and a value of that type. See <a href=\"https://tour.golang.org/methods/11\" rel=\"nofollow noreferrer\">tour.golang.org/methods/11</a>."}], "tags": [], "owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "is_accepted": true, "score": 2, "last_activity_date": 1533372949, "creation_date": 1533372949, "answer_id": 51684031, "question_id": 51683762, "link": "https://stackoverflow.com/questions/51683762/how-interfaces-represent-any-type-in-golang/51684031#51684031", "title": "how interfaces represent any type in Golang", "body": "<p>The answer is runtime reflection. </p>\n\n<p>From <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>Package reflect implements run-time reflection, allowing a program to manipulate objects with arbitrary types. The typical use is to take a value with static type interface{} and extract its dynamic type information by calling TypeOf, which returns a Type.</p>\n</blockquote>\n"}], "owner": {"reputation": 64, "user_id": 4098468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DMDPy.jpg?s=128&g=1", "display_name": "LENIN LAWRENCE", "link": "https://stackoverflow.com/users/4098468/lenin-lawrence"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 51684031, "answer_count": 1, "score": 2, "last_activity_date": 1533372949, "creation_date": 1533370617, "last_edit_date": 1533371349, "question_id": 51683762, "link": "https://stackoverflow.com/questions/51683762/how-interfaces-represent-any-type-in-golang", "title": "how interfaces represent any type in Golang", "body": "<p>It is said that <code>interface{}</code> represents any type in Go. For example, let us consider a <code>Marshal</code> function in <code>encoding/json</code> which is used to convert Go data structure into a JSON string. Its definition is </p>\n\n<pre><code>func Marshal(v interface{}) ([]byte, error) \n</code></pre>\n\n<p>But we are passing a struct to it as a parameter like below. </p>\n\n<pre><code>type hello struct{\n   Message string\n}\ndata,err:= json.Marshal(hello{Message:'Hello world'})\n</code></pre>\n\n<p>How is Go handling this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 382, "user_id": 658736, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/27b983816e19ddce98e022b4eceb3eae?s=128&d=identicon&r=PG", "display_name": "Scot", "link": "https://stackoverflow.com/users/658736/scot"}, "edited": false, "score": 0, "creation_date": 1617676268, "post_id": 51683305, "comment_id": 118363949, "body": "It&#39;s a small nit, but I really wouldn&#39;t call this a race condition. It&#39;s just bad concurrent programming.  If you did this any of several correct ways (as one example, by wrapping the counter read and write in the inner loop in a Mutex), you&#39;d end up with a deterministic result regardless of scheduling."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1533367082, "creation_date": 1533367082, "answer_id": 51683421, "question_id": 51683305, "link": "https://stackoverflow.com/questions/51683305/race-conditions-change-in-go/51683421#51683421", "title": "race conditions change in Go", "body": "<p>The book is wrong. The essential point about a data race is the result is undefined. </p>\n\n<p>For example, <code>Final Counter</code> could be any value.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"sync\"\n)\n\nvar (\n    counter int\n    wg      sync.WaitGroup\n)\n\nfunc main() {\n    wg.Add(2)\n    go incCounter(1)\n    go incCounter(2)\n\n    wg.Wait()\n    fmt.Println(\"Final Counter:\", counter)\n}\n\nfunc incCounter(id int) {\n    defer wg.Done()\n\n    for count := 0; count &lt; 2; count++ {\n        value := counter\n        //1 fmt.Println(\"value=\",value)\n        runtime.Gosched()\n\n        value++\n\n        counter = value\n        //2 fmt.Println(\"counter=\",counter)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go version\ngo version devel +65fa2b615b Fri Aug 3 23:35:53 2018 +0000 linux/amd64\n$ go run racer.go\nFinal Counter: 4\n$ go run racer.go\nFinal Counter: 2\n$ go run racer.go\nFinal Counter: 2\n$ go run racer.go\nFinal Counter: 2\n$ go run racer.go\nFinal Counter: 2\n$ go run racer.go\nFinal Counter: 4\n$ go run racer.go\nFinal Counter: 2\n$ go run racer.go\nFinal Counter: 4\n$ go run -race racer.go\n==================\nWARNING: DATA RACE\nRead at 0x0000005e4600 by goroutine 7:\n  main.incCounter()\n      /home/peter/gopath/src/racer.go:27 +0x6f\n\nPrevious write at 0x0000005e4600 by goroutine 6:\n  main.incCounter()\n      /home/peter/gopath/src/racer.go:33 +0x90\n\nGoroutine 7 (running) created at:\n  main.main()\n      /home/peter/gopath/src/racer.go:17 +0x89\n\nGoroutine 6 (finished) created at:\n  main.main()\n      /home/peter/gopath/src/racer.go:16 +0x68\n==================\nFinal Counter: 4\nFound 1 data race(s)\nexit status 66\n$\n</code></pre>\n"}], "owner": {"reputation": 805, "user_id": 4652536, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/daa7fc91b78414811ccea8c9853ba734?s=128&d=identicon&r=PG&f=1", "display_name": "yuxh", "link": "https://stackoverflow.com/users/4652536/yuxh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 1, "accepted_answer_id": 51683421, "answer_count": 1, "score": 0, "last_activity_date": 1533367082, "creation_date": 1533365948, "question_id": 51683305, "link": "https://stackoverflow.com/questions/51683305/race-conditions-change-in-go", "title": "race conditions change in Go", "body": "<p>\u300aGo in action\u300b's sample about race conditions:</p>\n\n<pre><code>var (\n    counter int\n    wg sync.WaitGroup\n)\n\nfunc main() {\n    wg.Add(2)\n    go incCounter(1)\n    go incCounter(2)\n\n    wg.Wait()\n    fmt.Println(\"Final Counter:\", counter)\n}\n\nfunc incCounter(id int) {\n    defer wg.Done()\n\n    for count := 0; count &lt; 2; count++ {\n        value := counter\n        //1 fmt.Println(\"value=\",value)\n        runtime.Gosched()\n\n        value++\n\n        counter = value\n        //2 fmt.Println(\"counter=\",counter)\n    }\n}\n</code></pre>\n\n<p>it is said Final Counter should be 2 in the end,here is explain:\n\"Each goroutine overwrites the work of the other. This happens when the goroutine\nswap is taking place. Each goroutine makes its own copy of the counter variable and\nthen is swapped out for the other goroutine. When the goroutine is given time to execute again, the value of the counter variable has changed, but the goroutine doesn\u2019t\nupdate its copy. Instead it continues to increment the copy it has and set the value\nback to the counter variable, replacing the work the other goroutine performed.\"   </p>\n\n<p>I guess it's environment reason,my machine output 4 with go 1.10.3+win10. I want to know what the go changed since the book released? And if I uncomment mark 1 Final Counter prints 2 or random if I uncomment mark  2. why?</p>\n"}, {"tags": ["http", "go", "web", "server"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533560605, "post_id": 51682786, "comment_id": 90377554, "body": "The quoted code doesn&#39;t serve any static files, so &quot;how do I modify this code to do something completely different&quot; is too broad a question. Can you narrow it down to some particular issue you&#39;re having?"}], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 2, "last_activity_date": 1533362013, "creation_date": 1533362013, "answer_id": 51682887, "question_id": 51682786, "link": "https://stackoverflow.com/questions/51682786/open-html-file-base-on-net-http-package-in-go/51682887#51682887", "title": "Open html file base on net/http package in Go", "body": "<p>To serve any static file to an endpoint, you can use <code>http.ServeFile</code> or <code>http.ServeContent</code> if you want more control.</p>\n\n<p>In this case, you can write:</p>\n\n<pre><code>func helloHandler(w http.ResponseWriter, r *http.Request) {\n    http.ServeFile(w,r,\"Home.html\")\n}\n</code></pre>\n\n<p>Be sure to set the name to the path of <code>Home.html</code>. It is possible for the program to not find the file when using a relative path when running from elsewhere.</p>\n"}], "owner": {"reputation": 329, "user_id": 10159479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/835dda9b64c9a803249e71b188548049?s=128&d=identicon&r=PG&f=1", "display_name": "Greg", "link": "https://stackoverflow.com/users/10159479/greg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 574, "favorite_count": 0, "closed_date": 1533582821, "answer_count": 1, "score": -3, "last_activity_date": 1533362013, "creation_date": 1533361135, "last_edit_date": 1533361435, "question_id": 51682786, "link": "https://stackoverflow.com/questions/51682786/open-html-file-base-on-net-http-package-in-go", "closed_reason": "Needs more focus", "title": "Open html file base on net/http package in Go", "body": "<p>I am a beginner for Go.\nI try to build a static web server in my local computer.\nActually, I have been read <a href=\"https://stackoverflow.com/questions/26559557/how-do-you-serve-a-static-html-file-using-a-go-web-server\">How do you serve a static html file using a go web server?\n</a></p>\n\n<p>My question is, if I have a <code>Home.html</code>.\nI want to open <code>Home.html</code> when I link <code>localhost:7777</code>.</p>\n\n<p>It's like <code>index.html</code>, but I want to replace <code>index.html</code> with <code>Home.html</code>.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"log\"\n)\n\nfunc helloHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"hello world!\")\n}\nfunc main() {\n\n    http.HandleFunc(\"/\", helloHandler)\n    // \n    err := http.ListenAndServe(\":7777\", nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe\", err)\n    } else {\n        log.Println(\"listen 7777\")\n    }\n}\n</code></pre>\n\n<p>How do I re-write this code?</p>\n\n<p>What keywords for this problem?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 17, "user_id": 4611671, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-s4oaFofnpQ0/AAAAAAAAAAI/AAAAAAAAAFs/6np636vmRMo/photo.jpg?sz=128", "display_name": "Najeeb Ullah Shah", "link": "https://stackoverflow.com/users/4611671/najeeb-ullah-shah"}, "edited": false, "score": 0, "creation_date": 1533339657, "post_id": 51681219, "comment_id": 90325538, "body": "For HTTP server I am using go lang build in net/http package."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1533340080, "post_id": 51681219, "comment_id": 90325590, "body": "Show the relevant code."}], "answers": [{"tags": [], "owner": {"reputation": 731, "user_id": 1137142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78afc3d3f69e007c5d548a75f865a497?s=128&d=identicon&r=PG", "display_name": "matb", "link": "https://stackoverflow.com/users/1137142/matb"}, "is_accepted": false, "score": 0, "last_activity_date": 1533341665, "creation_date": 1533341665, "answer_id": 51681403, "question_id": 51681219, "link": "https://stackoverflow.com/questions/51681219/redirect-to-login-with-user-credentials-after-signup/51681403#51681403", "title": "Redirect to login with user credentials after signup?", "body": "<p>Conceptually, 2 things can happen:</p>\n\n<ol>\n<li>Either you let new users to sign up and then you redirect them to a\nlogin page where they have to type their credentials, or</li>\n<li>You log people in right after they create a new account on the sign-up page.</li>\n</ol>\n\n<p>Sounds to me that you want to do something like 2., but are having trouble with implementation.</p>\n\n<p>I'm not sure how you do that with Gorilla Session API, but every authenticated page must have some code to look up a session cookie and determine if a given request is authenticated or not, so probably you want to create a session with <code>UserID</code> after a sign up and then redirect to your default page (a dashboard maybe?). Ideally, that session cookie would be encrypted.</p>\n"}], "owner": {"reputation": 17, "user_id": 4611671, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-s4oaFofnpQ0/AAAAAAAAAAI/AAAAAAAAAFs/6np636vmRMo/photo.jpg?sz=128", "display_name": "Najeeb Ullah Shah", "link": "https://stackoverflow.com/users/4611671/najeeb-ullah-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1533341665, "creation_date": 1533339460, "last_edit_date": 1533339648, "question_id": 51681219, "link": "https://stackoverflow.com/questions/51681219/redirect-to-login-with-user-credentials-after-signup", "title": "Redirect to login with user credentials after signup?", "body": "<p>I have a link <em>/signup</em>, if new user come and signup, I want it to <strong>redirect to <em>/login</em> with user credentials</strong>, and there I want to perform login operation which is running fine and redirects the user to the dashboard. </p>\n\n<p>The point at which I am stuck is I unable to redirect it to login with user credentials.</p>\n\n<p>To store session I am using this package: <a href=\"https://github.com/gorilla/sessions\" rel=\"nofollow noreferrer\">gorilla/sessions</a></p>\n"}, {"tags": ["go", "stdout", "stdin"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1533337767, "post_id": 51680991, "comment_id": 90325193, "body": "You read from stdin, you write to stdout. There&#39;s really only one way to do it, and that what this code appears to do. What exactly is the problem you&#39;re encountering?"}, {"owner": {"reputation": 731, "user_id": 1137142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78afc3d3f69e007c5d548a75f865a497?s=128&d=identicon&r=PG", "display_name": "matb", "link": "https://stackoverflow.com/users/1137142/matb"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1533337839, "post_id": 51680991, "comment_id": 90325203, "body": "@JimB I understood this as &quot;how does is this supposed to work together? i.e. actually pass data back and forth&quot;. Hopefully diane can chime in and add context."}, {"owner": {"reputation": 1159, "user_id": 2158478, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/aab8eb00b849fd0797099e958c0c8494?s=128&d=identicon&r=PG", "display_name": "bunny", "link": "https://stackoverflow.com/users/2158478/bunny"}, "edited": false, "score": 0, "creation_date": 1533338490, "post_id": 51680991, "comment_id": 90325314, "body": "What I understand is any program always write to stdout and read from stdin and both client and server see the same stdin and stdout. What I am confused is if the server write response to stdout and how can client can read from stdin? Or the server write response to stdout and the client should read from stdout? Does the server and client sees the same stdin and stdout?"}, {"owner": {"reputation": 731, "user_id": 1137142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78afc3d3f69e007c5d548a75f865a497?s=128&d=identicon&r=PG", "display_name": "matb", "link": "https://stackoverflow.com/users/1137142/matb"}, "edited": false, "score": 0, "creation_date": 1533340129, "post_id": 51680991, "comment_id": 90325598, "body": "Every program <i>can</i> write to stdout and read from stdin, but doesn&#39;t have to. Each program has its own stdin and stdout (more background <a href=\"https://stackoverflow.com/questions/3385201/confused-about-stdin-stdout-and-stderr?noredirect=1&amp;lq=1\">here</a>. When you execute a program you can pass it in a stdin or direct a stdout somewhere else. E.g. <code>cat &#47;etc&#47;hosts | wc -l</code> you take stdout of <code>cat</code> program and feed it into stdin of <code>wc</code> program that reads the number of lines in <code>etc&#47;hosts</code> file."}, {"owner": {"reputation": 7649, "user_id": 356218, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/dc0ec712fb6804d6131e6552e0a14e0a?s=128&d=identicon&r=PG", "display_name": "Thymine", "link": "https://stackoverflow.com/users/356218/thymine"}, "edited": false, "score": 0, "creation_date": 1533340204, "post_id": 51680991, "comment_id": 90325608, "body": "My initial impression is that A: the program is redefining stdin/stdout, to be the request/response of the http message, or B: stdin/stdin is being used for debugging. I&#39;m uncertain what &quot;scoping&quot; stdin/stdout have, so the former thought seems extremely risky with any multi-request/threaded app.  Might be from a very basic tutorial that is trying to teach <i>only</i> concepts?"}, {"owner": {"reputation": 1159, "user_id": 2158478, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/aab8eb00b849fd0797099e958c0c8494?s=128&d=identicon&r=PG", "display_name": "bunny", "link": "https://stackoverflow.com/users/2158478/bunny"}, "edited": false, "score": 0, "creation_date": 1533340547, "post_id": 51680991, "comment_id": 90325673, "body": "Yes, maybe what I don&#39;t know is the link part in the below answer. What I confused is if the server write response to stdout and how can client can read from stdin? I thought response server writes is all in stdout, server write nothing to stdin and how can client read it from stdin. Now I think I understand that usually server&#39;s stdout is linking to client&#39;s stdin."}], "answers": [{"comments": [{"owner": {"reputation": 1159, "user_id": 2158478, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/aab8eb00b849fd0797099e958c0c8494?s=128&d=identicon&r=PG", "display_name": "bunny", "link": "https://stackoverflow.com/users/2158478/bunny"}, "edited": false, "score": 1, "creation_date": 1533339867, "post_id": 51681053, "comment_id": 90325571, "body": "Oh, I see! Usually the stdout of a program is linked to stdin of another program! For example, the stdout of the server links to stdin of the client and the stdin of the server links to the stdout of the client. In the above program, os.Stdin is actually a file(&quot;/dev/stdin&quot;) and os.Stdout is a file(&quot;/dev/stdout&quot;) . When you say link, do you mean server&#39;s stdin and client&#39;s stdout points to &quot;/dev/stdin&quot; and server&#39;s stdout and client&#39;s stdin points to &quot;/dev/stdout&quot;?"}, {"owner": {"reputation": 731, "user_id": 1137142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78afc3d3f69e007c5d548a75f865a497?s=128&d=identicon&r=PG", "display_name": "matb", "link": "https://stackoverflow.com/users/1137142/matb"}, "reply_to_user": {"reputation": 1159, "user_id": 2158478, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/aab8eb00b849fd0797099e958c0c8494?s=128&d=identicon&r=PG", "display_name": "bunny", "link": "https://stackoverflow.com/users/2158478/bunny"}, "edited": false, "score": 0, "creation_date": 1533340444, "post_id": 51681053, "comment_id": 90325652, "body": "Yeah @diane, mental shortcut! By &quot;link&quot; I meant to say &quot;use a pipe&quot; - <a href=\"https://en.wikipedia.org/wiki/Pipeline_(Unix)\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Pipeline_(Unix)</a>"}, {"owner": {"reputation": 731, "user_id": 1137142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78afc3d3f69e007c5d548a75f865a497?s=128&d=identicon&r=PG", "display_name": "matb", "link": "https://stackoverflow.com/users/1137142/matb"}, "reply_to_user": {"reputation": 1159, "user_id": 2158478, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/aab8eb00b849fd0797099e958c0c8494?s=128&d=identicon&r=PG", "display_name": "bunny", "link": "https://stackoverflow.com/users/2158478/bunny"}, "edited": false, "score": 0, "creation_date": 1533340562, "post_id": 51681053, "comment_id": 90325677, "body": "Also, on Unix systems you can see file descriptors for std{in,out,err} for each process if you know your process PID with <code>ls &#47;proc&#47;&lt;PID&gt;&#47;fd&#47;</code> :D, they will be numbered 0, 1 and 2 (everything else is other files or connections that your program opened)"}, {"owner": {"reputation": 1159, "user_id": 2158478, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/aab8eb00b849fd0797099e958c0c8494?s=128&d=identicon&r=PG", "display_name": "bunny", "link": "https://stackoverflow.com/users/2158478/bunny"}, "edited": false, "score": 1, "creation_date": 1533340983, "post_id": 51681053, "comment_id": 90325753, "body": "Thanks so much! The information you provide is very helpful. I will read more about pipe and file descriptors to understand it better."}], "tags": [], "owner": {"reputation": 731, "user_id": 1137142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78afc3d3f69e007c5d548a75f865a497?s=128&d=identicon&r=PG", "display_name": "matb", "link": "https://stackoverflow.com/users/1137142/matb"}, "is_accepted": true, "score": 2, "last_activity_date": 1533337735, "creation_date": 1533337735, "answer_id": 51681053, "question_id": 51680991, "link": "https://stackoverflow.com/questions/51680991/server-client-connection-through-stdio/51681053#51681053", "title": "server client connection through stdio", "body": "<p>It's hard to say what this program is doing (as there's just a portion of it). Looks like you have an implementation of <code>ReadWriteCloser</code> that reads from stdin and writes to stdout (and a portion of a switch statement).</p>\n\n<p>Generally any program can read from stdin and write to stdout (and stderr). You can link stdout of one program to stdin of other program with a pipe (e.g. <code>client | server</code>), but that's unidirectional. In your case, it sounds like you want client's stdin to go to server's stdout and vice versa. In local development, Unix sockets are usually used for that, but you might be able to create a named pipe (with <code>mkfifo</code>) like shown <a href=\"https://unix.stackexchange.com/a/53646/255007\">here</a>.</p>\n\n<p>Also, it might be easier to start with a super simple toy program, that doesn't include <code>jsonrpc2</code> and any other packages.</p>\n\n<p>I hope that helps!</p>\n"}], "owner": {"reputation": 1159, "user_id": 2158478, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/aab8eb00b849fd0797099e958c0c8494?s=128&d=identicon&r=PG", "display_name": "bunny", "link": "https://stackoverflow.com/users/2158478/bunny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 51681053, "answer_count": 1, "score": 1, "last_activity_date": 1533337735, "creation_date": 1533337030, "last_edit_date": 1533337346, "question_id": 51680991, "link": "https://stackoverflow.com/questions/51680991/server-client-connection-through-stdio", "title": "server client connection through stdio", "body": "<p>There is a client and a server that communicates through stdio. I think I am basically confused about the stdin and stdout. I have some questions about the stdio. </p>\n\n<ol>\n<li>Does the server read the request from stdin or stdout where the client writes to?</li>\n<li>Does the server write response to stdin or stdout where the client can read?</li>\n</ol>\n\n<p>Below is the code snippet of connection part on server side.</p>\n\n<pre><code>case \"stdio\":\n    log.Println(\"server: reading on stdin, writing on stdout\")\n    &lt;-jsonrpc2.NewConn(context.Background(), jsonrpc2.NewBufferedStream(stdrwc{}, jsonrpc2.VSCodeObjectCodec{}), handler, connOpt...).DisconnectNotify()\n    log.Println(\"connection closed\")\n    return nil\n\n\ntype stdrwc struct{}\n\nfunc (stdrwc) Read(p []byte) (int, error) {\n    return os.Stdin.Read(p)\n}\n\nfunc (stdrwc) Write(p []byte) (int, error) {\n    return os.Stdout.Write(p)\n}\n\nfunc (stdrwc) Close() error {\n    if err := os.Stdin.Close(); err != nil {\n        return err\n    }\n    return os.Stdout.Close()\n}\n</code></pre>\n"}, {"tags": ["go", "google-drive-api", "gmail-api", "google-sheets-api"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1533332498, "post_id": 51680385, "comment_id": 90324025, "body": "Anything can create goroutines. What is &quot;too many goroutines&quot;?"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 2, "creation_date": 1533332951, "post_id": 51680385, "comment_id": 90324139, "body": "Come back when you have a few million goroutines and a load average of 1.0. :)"}, {"owner": {"reputation": 47, "user_id": 10173299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c916436902c3c958c0e40e5ea7cd79b7?s=128&d=identicon&r=PG&f=1", "display_name": "developer", "link": "https://stackoverflow.com/users/10173299/developer"}, "edited": false, "score": 0, "creation_date": 1533333064, "post_id": 51680385, "comment_id": 90324167, "body": "When our stack space will be filled due to having a bunch of goroutines"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1533333227, "post_id": 51680385, "comment_id": 90324223, "body": "Goroutines are not OS threads. You can have many goroutines on a single thread. Each requires only a few bytes of state. See also <a href=\"https://stackoverflow.com/q/24599645/1068283\">How do goroutines work? (or: goroutines and OS threads relation)</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1533334052, "post_id": 51680385, "comment_id": 90324437, "body": "@developer: The stack limit in go is 1,000,000,000 bytes. It takes a lot of goroutines to hit that, and usually only caused by runaway recursion."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1533343778, "creation_date": 1533343778, "answer_id": 51681558, "question_id": 51680385, "link": "https://stackoverflow.com/questions/51680385/do-api-calls-create-goroutines/51681558#51681558", "title": "Do API calls create goroutines?", "body": "<blockquote>\n  <p>Do API calls create goroutines?</p>\n</blockquote>\n\n<p>Not inherently. But many implementations of APIs of course will.</p>\n\n<blockquote>\n  <p>I was testing things ... my program would create 2 extra goroutines.</p>\n</blockquote>\n\n<p>Why do you think this is \"extra\"? It's probably exactly the right number of goroutines.</p>\n\n<blockquote>\n  <p>I feel like this would lead to a problem where too many goroutines are created.</p>\n</blockquote>\n\n<p>Don't. You are wrong to feel this way. There's absolutely nothing wrong with using goroutines--that's why they exist.</p>\n"}], "owner": {"reputation": 47, "user_id": 10173299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c916436902c3c958c0e40e5ea7cd79b7?s=128&d=identicon&r=PG&f=1", "display_name": "developer", "link": "https://stackoverflow.com/users/10173299/developer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "closed_date": 1533560462, "answer_count": 1, "score": -2, "last_activity_date": 1533343778, "creation_date": 1533332338, "question_id": 51680385, "link": "https://stackoverflow.com/questions/51680385/do-api-calls-create-goroutines", "closed_reason": "Needs more focus", "title": "Do API calls create goroutines?", "body": "<p>I was testing things out and noticed that when I made Google API calls, my program would create 2 extra goroutines (went from 1 to 3 goroutines).  I feel like this would lead to a problem where too many goroutines are created.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1533331731, "post_id": 51680226, "comment_id": 90323775, "body": "If <code>Tracker</code> is an interface, then <code>tracker</code> is <code>nil</code>, which means you&#39;re not adding a value."}, {"owner": {"reputation": 1, "user_id": 10178254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fa66d02fa919be8db26055afac0d5bf?s=128&d=identicon&r=PG&f=1", "display_name": "user10178254", "link": "https://stackoverflow.com/users/10178254/user10178254"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1533331883, "post_id": 51680226, "comment_id": 90323819, "body": "Ah I see so an object that is captured by Tracker needs to be associated with ctx.Value to not be nil?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1533332630, "post_id": 51680226, "comment_id": 90324060, "body": "It can be nil, but you&#39;re going to get nil back (the api always returns nil if it doesn&#39;t exit), so there&#39;s essentially no value. You need to pass a value to &quot;WithValue&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 0, "last_activity_date": 1533331830, "creation_date": 1533331830, "answer_id": 51680300, "question_id": 51680226, "link": "https://stackoverflow.com/questions/51680226/why-does-my-interface-not-contain-a-value-if-i-explicitly-associated/51680300#51680300", "title": "Why does my interface not contain a value if I explicitly &quot;associated&quot;", "body": "<p><code>Tracker</code> is an interface, and it's not set to anything, so it's <code>nil</code>.  So, it can't change <code>nil</code> to a <code>Tracker</code>, so it fails.</p>\n\n<p><a href=\"https://play.golang.org/p/4-KQXlCR8vD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4-KQXlCR8vD</a></p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 10178254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fa66d02fa919be8db26055afac0d5bf?s=128&d=identicon&r=PG&f=1", "display_name": "user10178254", "link": "https://stackoverflow.com/users/10178254/user10178254"}, "edited": false, "score": 0, "creation_date": 1533399577, "post_id": 51681454, "comment_id": 90336867, "body": "Something I left out is that I do have a defined tracker interface.  But what I did not understand is that unless you have an object that utilizes that tracker&#39;s methods your interface is nil. Is this correct thinking?"}, {"owner": {"reputation": 301, "user_id": 3833263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75d580fb2544563a80e0feb3296baae0?s=128&d=identicon&r=PG&f=1", "display_name": "Michael B.", "link": "https://stackoverflow.com/users/3833263/michael-b"}, "reply_to_user": {"reputation": 1, "user_id": 10178254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fa66d02fa919be8db26055afac0d5bf?s=128&d=identicon&r=PG&f=1", "display_name": "user10178254", "link": "https://stackoverflow.com/users/10178254/user10178254"}, "edited": false, "score": 0, "creation_date": 1533508302, "post_id": 51681454, "comment_id": 90358934, "body": "@user10178254 glad it helped. I&#39;ve updated and amended my answer to hopefully clear things up."}], "tags": [], "owner": {"reputation": 301, "user_id": 3833263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75d580fb2544563a80e0feb3296baae0?s=128&d=identicon&r=PG&f=1", "display_name": "Michael B.", "link": "https://stackoverflow.com/users/3833263/michael-b"}, "is_accepted": false, "score": 0, "last_activity_date": 1533508239, "last_edit_date": 1533508239, "creation_date": 1533342257, "answer_id": 51681454, "question_id": 51680226, "link": "https://stackoverflow.com/questions/51680226/why-does-my-interface-not-contain-a-value-if-i-explicitly-associated/51681454#51681454", "title": "Why does my interface not contain a value if I explicitly &quot;associated&quot;", "body": "<p>The problem isn't that <code>tracker</code> is nil, the problem is that it doesn't contain a value of a concrete type that implements <code>Tracker</code>. The value of <code>tracker</code> could be nil, and this would work, but it has to be a \"typed\" nil.</p>\n\n<p>The type assertion fails, because type assertions and type switches only work when the instance being asserted has a concrete type. A value can be of a concrete type by declaration , assignment, type assertion , or a type switch case.</p>\n\n<p>When you do the type assertion <code>ctx.Value(contextKey).(Tracker)</code>\nThere's (conceptually) a 2-step process to this:</p>\n\n<ol>\n<li>Determine the <code>ctx.Value(contextKey)</code>'s concrete type.</li>\n<li>Determine whether that concrete type implements <code>Tracker</code>.</li>\n</ol>\n\n<p>Here's a playground example that hopefully illustrates this better: <a href=\"https://play.golang.org/p/ojYzLObkisd\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ojYzLObkisd</a></p>\n\n<p>The <code>DoAny()</code> function in there is emulating what is happening when you put your <code>tracker</code> into context and then  try to retrieve it with the type assertion.</p>\n\n<p>I know this is just a basic example, but it's not very good practice to use <code>var something SomeInterfaceType</code>, even if you do assign it a value. You should use concrete types for that. Or even better, just use type inference, and you won't have to worry about it. For example:</p>\n\n<pre><code>type Foo interface {\n    DoFoo() string\n}\n\ntype MyFoo struct {}\n\nfunc (f *MyFoo) DoFoo() string {\n    return \"some foo value\"\n}\n\n// not so good\nvar f Foo = new(MyFoo)\n\n// good\nvar f *MyFoo = new(MyFoo)\n\n// better\nf := new(MyFoo)\n</code></pre>\n\n<p>This leverages the fact that interfaces are implicit in Go, and leads to much more obvious and maintainable code, especially in larger projects. Declaring a variable with an interface type is essentially making your variable poloymorphic, but the real power of interfaces isn't polymorphism. The real power is in using them as \"functional requirements\" for your package's exposed functions/methods. One rule that illustrates this really well is <a href=\"https://medium.com/@cep21/what-accept-interfaces-return-structs-means-in-go-2fe879e25ee8\" rel=\"nofollow noreferrer\">\"Accept interfaces, return structs\"</a>.</p>\n\n<p>EDIT:\nI've edited my original answer to correct some mistakes and make some improvements. I also would like to answer a follow-up question from the OP:</p>\n\n<blockquote>\n  <p>what I did not understand is that unless you have an object that utilizes that tracker's methods your interface is nil. Is this correct thinking?</p>\n</blockquote>\n\n<p>I think what you're trying to say is correct, but the words used aren't quite right. First, there are no <em>objects</em> in Go, as it is not object-oriented. Where in OOP languages, objects hold instances of types, Go uses <em>variables</em> and <em>constants</em> to hold instances of types. So the concept exists, but not by the same name. So your <code>tracker</code> variable will be an instance of a type that satisfies your <code>Tracker</code> interface, but its value with be <code>nil</code> unless you assign it a non-nil instance of a type that satisfies the <code>Tracker</code> interface.   </p>\n"}], "owner": {"reputation": 1, "user_id": 10178254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fa66d02fa919be8db26055afac0d5bf?s=128&d=identicon&r=PG&f=1", "display_name": "user10178254", "link": "https://stackoverflow.com/users/10178254/user10178254"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1533508239, "creation_date": 1533331389, "question_id": 51680226, "link": "https://stackoverflow.com/questions/51680226/why-does-my-interface-not-contain-a-value-if-i-explicitly-associated", "title": "Why does my interface not contain a value if I explicitly &quot;associated&quot;", "body": "<p>Hey guys this code is part of a mock client, mock server interaction.  I am having trouble understanding context.  </p>\n\n<p>Here I explicitly \"associate\" my tracker interface with context using 'WithValue' and then inject it into my request using WithContext.  But when I check if my request's context contains the tracker interface I am returned the  error \"This context should contain a tracker\" .  What is it about context and WithValue that I am just not understanding?</p>\n\n<pre><code>var tracker Tracker\n\nctx := context.WithValue(context.Background(), contextKey, tracker)\n\nreq := httptest.NewRequest(\"GET\", \"localhost:12345/test\", nil)\nreq.Header.Add(HEADER)\n\nreq = req.WithContext(ctx)\n\n_, ok := ctx.Value(contextKey).(Tracker)\nif !ok {\n    log.Fatal(\"1: This context should contain a tracker\")\n}\n</code></pre>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1533317836, "post_id": 51677555, "comment_id": 90318458, "body": "This string seems like from the output of log on console which you have assigned to result. Try to parse it there where you are creating this string. Are you parsing json to create this string."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1533318748, "post_id": 51677555, "comment_id": 90318819, "body": "Space-delimited string values may be impossible to parse - what happens if the key or value contains a space?"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 1, "creation_date": 1533319598, "post_id": 51677555, "comment_id": 90319159, "body": "Can you share the code that created this?"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1533322746, "post_id": 51677555, "comment_id": 90320446, "body": "The map part isn&#39;t a golang map at all, it&#39;s a string that you could parse into a <code>map[string]interface{}</code> variable. The latter is just a string, it&#39;s not a JSON representation of a map. A map should be represented as a JSON object"}, {"owner": {"reputation": 81, "user_id": 10150930, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgBBkpUW710/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7puoa8L7t1UYQZjYTO4431xkK3NpA/mo/photo.jpg?sz=128", "display_name": "bed", "link": "https://stackoverflow.com/users/10150930/bed"}, "edited": false, "score": 0, "creation_date": 1533375914, "post_id": 51677555, "comment_id": 90330982, "body": "Yes it is true, maybe I was a little inaccurate. I found the solution Thanks to everyone."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 10150930, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgBBkpUW710/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7puoa8L7t1UYQZjYTO4431xkK3NpA/mo/photo.jpg?sz=128", "display_name": "bed", "link": "https://stackoverflow.com/users/10150930/bed"}, "edited": false, "score": 0, "creation_date": 1533375821, "post_id": 51682771, "comment_id": 90330957, "body": "Thanks man, if I delete the string part out of map [] it works."}], "tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": true, "score": 0, "last_activity_date": 1533360926, "creation_date": 1533360926, "answer_id": 51682771, "question_id": 51677555, "link": "https://stackoverflow.com/questions/51677555/from-string-to-mapstringinterface-golang/51682771#51682771", "title": "From String to map[string]interface{} golang", "body": "<pre><code>package stackoverflow\n\nimport \"strings\"\n\nfunc StrToMap(in string) map[string]interface{} {\n    res := make(map[string]interface{})\n    array := strings.Split(in, \" \")\n    temp := make([]string, 2)\n    for _, val := range array {\n        temp = strings.Split(string(val), \":\")\n        res[temp[0]] = temp[1]\n    }\n    return res\n}\n</code></pre>\n\n<p>the above function returns an map of string to strings. It also doesn't handle the <code>map[]</code> part, which you can remove by either splitting the string before passing it or simply looking into why it gets printed that way(in the original code).</p>\n"}], "owner": {"reputation": 81, "user_id": 10150930, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgBBkpUW710/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7puoa8L7t1UYQZjYTO4431xkK3NpA/mo/photo.jpg?sz=128", "display_name": "bed", "link": "https://stackoverflow.com/users/10150930/bed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1109, "favorite_count": 0, "accepted_answer_id": 51682771, "answer_count": 1, "score": 0, "last_activity_date": 1533360926, "creation_date": 1533317680, "question_id": 51677555, "link": "https://stackoverflow.com/questions/51677555/from-string-to-mapstringinterface-golang", "title": "From String to map[string]interface{} golang", "body": "<p>I would like to turn this string into map [string] interface {}:</p>\n\n<pre><code>result=\"map[Value1:TestWS Value2:00060636 Value3:TestWS Value4:PIPPO Value5:TestWS]\"\n</code></pre>\n\n<p>the same string printed through the JSON</p>\n\n<pre><code>\"result=\\\"map[COD_DIPENDENTE:00060636 MATRICOLA:TestWS COGNOME:CAPPONI NOMEmy:TestWS COGNOMEmy:TestWS]\\\"\\n\"\n</code></pre>\n\n<p>I understand that it is a particular string. In reality it derives from a map [string] interface {}, but this has gone through an encryption and a decryption and the result is this.</p>\n\n<p>The \"result\" is not fundamental.</p>\n\n<p>advice??</p>\n"}, {"tags": ["go", "concurrency", "parallel-processing", "slice", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 7, "creation_date": 1533308650, "post_id": 51675437, "comment_id": 90313837, "body": "You have a data race, you can&#39;t write to a value concurrently in multiple goroutines. There is no expected output."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1533322870, "post_id": 51675437, "comment_id": 90320502, "body": "write a test, or compile with the race detector enabled. you&#39;re using a pointer to the same slice in all routines. That&#39;s actually quite unsafe. The go runtime might reallocate and move the slice when you call <code>append</code>, that&#39;s the whole reason why you have to reassing the slice every time you call append"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1533324985, "post_id": 51675437, "comment_id": 90321343, "body": "@HelloMyNameIs Your array example is explained here: <a href=\"https://stackoverflow.com/questions/49879322/can-i-concurrently-write-different-slice-elements/49879469#49879469\">Can I concurrently write different slice elements</a>"}, {"owner": {"reputation": 11, "user_id": 9842006, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d679c74a1364aaab17cfb9d9caeadab9?s=128&d=identicon&r=PG&f=1", "display_name": "HelloMyNameIs", "link": "https://stackoverflow.com/users/9842006/hellomynameis"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1533331090, "post_id": 51675437, "comment_id": 90323601, "body": "@icza yes that clears it, thx"}], "answers": [{"comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1533309899, "post_id": 51675622, "comment_id": 90314603, "body": "Shouldn&#39;t data race cause a panic? Can it produce incorrect result without panicing?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1533310570, "post_id": 51675622, "comment_id": 90314984, "body": "@Uvelichitel The runtime does not check for data race, so it doesn&#39;t know when it happens, unless you pass the <code>-race</code> param to the go tool. On the other hand the runtime does detect some misuse of maps, which crashes the app. But generally data races &quot;don&#39;t panic&quot;."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1533310814, "post_id": 51675622, "comment_id": 90315103, "body": "Shouldn&#39;t a system detect and prevent incorrect memory access on OS level?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1533311213, "post_id": 51675622, "comment_id": 90315355, "body": "@Uvelichitel This isn&#39;t an OS-level incorrect memory access. The app only accesses its own memory, but its &quot;internal&quot; goroutines are not synchronized, and the runtime does not guarantee valid results. And the runtime does not detect it because it significantly increases the memory and computation requirements. It only does this if you explicitly ask it to (using the <code>-race</code> flag), which is usually only done during tests, but not during &quot;normal&quot; operation."}, {"owner": {"reputation": 11, "user_id": 9842006, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d679c74a1364aaab17cfb9d9caeadab9?s=128&d=identicon&r=PG&f=1", "display_name": "HelloMyNameIs", "link": "https://stackoverflow.com/users/9842006/hellomynameis"}, "edited": false, "score": 0, "creation_date": 1533312518, "post_id": 51675622, "comment_id": 90316070, "body": "@icza i see, does this rule also apply when i want to process(read/write) singular key from a map ? ex. goroutine 1 process map[&quot;first&quot;], and goroutine 2 process map[&quot;second&quot;] etc. Do i need to wait for the goroutine 1 to finish to start the second one because they read/write different key but still in the same variable ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11, "user_id": 9842006, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d679c74a1364aaab17cfb9d9caeadab9?s=128&d=identicon&r=PG&f=1", "display_name": "HelloMyNameIs", "link": "https://stackoverflow.com/users/9842006/hellomynameis"}, "edited": false, "score": 0, "creation_date": 1533313313, "post_id": 51675622, "comment_id": 90316472, "body": "@HelloMyNameIs Yes, if the same map is read / written from multiple goroutines, access to the map itself must be synchronized. See related question: <a href=\"https://stackoverflow.com/questions/40442846/concurrent-access-to-maps-with-range-in-go/40456170#40456170\">Concurrent access to maps with &#39;range&#39; in Go</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1580126057, "last_edit_date": 1580126057, "creation_date": 1533309258, "answer_id": 51675622, "question_id": 51675437, "link": "https://stackoverflow.com/questions/51675437/length-of-slice-vary-while-already-using-waitgroup/51675622#51675622", "title": "length of slice vary while already using waitgroup", "body": "<blockquote>\n  <p>is there something that is missing for it to get the expected result ie 5 ?</p>\n</blockquote>\n\n<p>Yes, proper synchronization. If multiple goroutines access the same variable where at least one of them is a write, you need explicit synchronization.</p>\n\n<p>Your example can be \"secured\" with a single mutex:</p>\n\n<pre><code>var list []int\nwg := sync.WaitGroup{}\n\nmu := &amp;sync.Mutex{} // A mutex\n\nfor i := 0; i &lt; 5; i++ {\n    wg.Add(1)\n    go func(c *[]int, i int) {\n        mu.Lock() // Must lock before accessing shared resource\n        *c = append(*c, i)\n        mu.Unlock() // Unlock when we're done with it\n        wg.Done()\n    }(&amp;list, i)\n}\nwg.Wait()\n\nfmt.Println(len(list))\n</code></pre>\n\n<p>This will always print 5.</p>\n\n<p>Note: the same slice is read at the end to prints its length, yet we are not using the mutex there. This is because the use of waitgroup ensures that we can only get to that point after all goroutines that modify it have completed their job, so data race cannot occur there. But in general both reads and writes have to be synchronized.</p>\n\n<p><strong>See possible duplicates:</strong></p>\n\n<p><a href=\"https://stackoverflow.com/questions/46664742/go-routine-not-collecting-all-objects-from-channel/46664920#46664920\">go routine not collecting all objects from channel</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/44070323/server-instances-with-multiple-users/44070394#44070394\">Server instances with multiple users</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/46233680/why-does-this-code-cause-data-race/46233837#46233837\">Why does this code cause data race?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/36167200/how-safe-are-golang-maps-for-concurrent-read-write-operations/36167693#36167693\">How safe are Golang maps for concurrent Read/Write operations?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/51301328/golang-struct-concurrent-read-and-write-without-lock-is-also-running-ok/51301572#51301572\">golang struct concurrent read and write without Lock is also running ok?</a></p>\n\n<p><strong>See related questions:</strong></p>\n\n<p><a href=\"https://stackoverflow.com/questions/49879322/can-i-concurrently-write-different-slice-elements/49879469#49879469\">Can I concurrently write different slice elements</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/34039229/if-i-am-using-channels-properly-should-i-need-to-use-mutexes/34039377#34039377\">If I am using channels properly should I need to use mutexes?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/41406501/is-it-safe-to-read-a-function-pointer-concurrently-without-a-lock/41407827#41407827\">Is it safe to read a function pointer concurrently without a lock?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/40442846/concurrent-access-to-maps-with-range-in-go/40456170#40456170\">Concurrent access to maps with &#39;range&#39; in Go</a></p>\n"}], "owner": {"reputation": 11, "user_id": 9842006, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d679c74a1364aaab17cfb9d9caeadab9?s=128&d=identicon&r=PG&f=1", "display_name": "HelloMyNameIs", "link": "https://stackoverflow.com/users/9842006/hellomynameis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 592, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1580126057, "creation_date": 1533308555, "last_edit_date": 1533325647, "question_id": 51675437, "link": "https://stackoverflow.com/questions/51675437/length-of-slice-vary-while-already-using-waitgroup", "title": "length of slice vary while already using waitgroup", "body": "<p>I have a hard time understanding concurrency/paralel. in my code I made a loop of 5 cycle. Inside of the loop I added the <code>wg.Add(1)</code>, in total I have 5 <code>Add</code>s. Here's the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    var list []int\n    wg := sync.WaitGroup{}\n    for i := 0; i &lt; 5; i++ {\n        wg.Add(1)\n        go func(c *[]int, i int) {\n            *c = append(*c, i)\n            wg.Done()\n        }(&amp;list, i)\n    }\n    wg.Wait()\n    fmt.Println(len(list))\n}\n</code></pre>\n\n<p>The main func waits until all the goroutines finish but when I tried to print the length of slice I get random results. ex (1,3,etc) is there something that is missing for it to get the expected result ie 5 ?</p>\n"}, {"tags": ["go", "go-gorm", "galera"], "answers": [{"comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1533309317, "post_id": 51674982, "comment_id": 90314271, "body": "For MariaDB, this is usually <a href=\"https://mariadb.com/products/technology/maxscale\" rel=\"nofollow noreferrer\">MaxScale</a>."}, {"owner": {"reputation": 15, "user_id": 7544942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49575411fc07e4c62d554b265dadc884?s=128&d=identicon&r=PG&f=1", "display_name": "St&#233;phane MERLE", "link": "https://stackoverflow.com/users/7544942/st%c3%a9phane-merle"}, "edited": false, "score": 0, "creation_date": 1533311826, "post_id": 51674982, "comment_id": 90315703, "body": "@John Oss Thanks"}, {"owner": {"reputation": 15, "user_id": 7544942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49575411fc07e4c62d554b265dadc884?s=128&d=identicon&r=PG&f=1", "display_name": "St&#233;phane MERLE", "link": "https://stackoverflow.com/users/7544942/st%c3%a9phane-merle"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1533311972, "post_id": 51674982, "comment_id": 90315783, "body": "@MichaelHampton I setup galera : <a href=\"https://mariadb.com/kb/en/library/what-is-mariadb-galera-cluster/\" rel=\"nofollow noreferrer\">mariadb.com/kb/en/library/what-is-mariadb-galera-cluster</a>"}], "tags": [], "owner": {"reputation": 479, "user_id": 2911436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7440d55bf27c1d2b26fae3af24ca2fff?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/2911436/john"}, "is_accepted": true, "score": 2, "last_activity_date": 1533307030, "creation_date": 1533307030, "answer_id": 51674982, "question_id": 51674775, "link": "https://stackoverflow.com/questions/51674775/gorm-and-galera-connect/51674982#51674982", "title": "gorm and galera connect", "body": "<p>As recommended by the developer of gorm, you should use a load balancer to connect to multiple databases. After you have a load balancer, you can use that as the connection string. </p>\n\n<p>Source: <a href=\"https://github.com/jinzhu/gorm/issues/1055\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm/issues/1055</a> , <a href=\"https://github.com/jinzhu/gorm/issues/1024\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm/issues/1024</a></p>\n"}], "owner": {"reputation": 15, "user_id": 7544942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49575411fc07e4c62d554b265dadc884?s=128&d=identicon&r=PG&f=1", "display_name": "St&#233;phane MERLE", "link": "https://stackoverflow.com/users/7544942/st%c3%a9phane-merle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 51674982, "answer_count": 1, "score": 0, "last_activity_date": 1539070378, "creation_date": 1533306358, "last_edit_date": 1539070378, "question_id": 51674775, "link": "https://stackoverflow.com/questions/51674775/gorm-and-galera-connect", "title": "gorm and galera connect", "body": "<p>I am using GORM for my golang project with a mariadb bdd, but we are migrating to a galera cluster which seems to be exactly the same with multiples node... I cannot find any information on the connexion string to use ... \nfor now it looks like : </p>\n\n<pre><code>db, err = gorm.Open(\"mysql\", conf.BDDUSER+\":\"+conf.BDDPASS+\"@tcp(\"+conf.BDDHOST+\":\"+BDDPort+\")/\"+conf.BDDSCHEMA+\"?charset=utf8&amp;parseTime=True\")\n</code></pre>\n\n<p>but now we need to include all the 3 nodes in there.</p>\n"}]