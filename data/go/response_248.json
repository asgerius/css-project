[{"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570663228, "post_id": 58313428, "comment_id": 102987712, "body": "The service name is <code>fhir</code>. You should be able to connect it using <code>fhir</code>, not <code>cerner</code>."}], "answers": [{"comments": [{"owner": {"reputation": 191, "user_id": 5858411, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/jjyS2.jpg?s=128&g=1", "display_name": "Austin L", "link": "https://stackoverflow.com/users/5858411/austin-l"}, "edited": false, "score": 0, "creation_date": 1596819040, "post_id": 58313640, "comment_id": 111943074, "body": "in your answer, could you use the OPs example? the one you use is more confusing since you have two 8000 ports. also <code>postgres:&#47;&#47;{DOCKER_IP}:8001</code> why does this reference the image name? Thank you!"}, {"owner": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "reply_to_user": {"reputation": 191, "user_id": 5858411, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/jjyS2.jpg?s=128&g=1", "display_name": "Austin L", "link": "https://stackoverflow.com/users/5858411/austin-l"}, "edited": false, "score": 1, "creation_date": 1597204278, "post_id": 58313640, "comment_id": 112053885, "body": "@AustinL when you want to access Postgres container from outside of container network or from host machine you should use <code>8001</code> with because it the publish port that will see the outer world, while <code>5432</code> is only visible in container network."}], "tags": [], "owner": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "is_accepted": true, "score": 2, "last_activity_date": 1570665191, "creation_date": 1570665191, "answer_id": 58313640, "question_id": 58313428, "link": "https://stackoverflow.com/questions/58313428/docker-container-to-container-connect-connection-refused/58313640#58313640", "title": "Docker container to container connect: connection refused", "body": "<p>You should call the container service with <code>containerPort</code>, not with hostPort in service to service communication. in your case, it should be <code>7000 to 7002</code> for any container to connect using container name.</p>\n\n<blockquote>\n  <p>Get <a href=\"http://cerner:8602/api/v1/patient/search\" rel=\"nofollow noreferrer\">http://cerner:8602/api/v1/patient/search</a>: dial TCP\n  192.168.240.4:8602: connect: connection refused.</p>\n</blockquote>\n\n<p>As in the error, it tries to attempt connection using publish port.</p>\n\n<p>For example</p>\n\n<pre><code>version: \"3\"\nservices:\n  web:\n    build: .\n    ports:\n      - \"8000:8000\"\n  db:\n    image: postgres\n    ports:\n      - \"8001:5432\"\n</code></pre>\n\n<p>When you run docker-compose up, the following happens:</p>\n\n<blockquote>\n  <p>A network called myapp_default is created.</p>\n  \n  <p>A container is created\n  using web\u2019s configuration. It joins the network myapp_default under\n  the name web. A container is created using db\u2019s configuration. It\n  joins the network myapp_default under the name db.</p>\n  \n  <p>In v2.1+, overlay\n  networks are always attachable</p>\n  \n  <p>Each container can now look up the hostname web or db and get back the\n  appropriate container\u2019s IP address. For example, web\u2019s application\n  code could connect to the URL postgres://db:5432 and start using the\n  Postgres database.</p>\n</blockquote>\n\n<p>It is important to note the distinction <strong>between HOST_PORT and CONTAINER_PORT</strong>. In the above example, for db, the <strong>HOST_PORT</strong> is <code>8001</code> and the <strong>container port</strong> is <code>5432</code> (postgres default). Networked <strong>service-to-service</strong> communication use the <strong>CONTAINER_PORT</strong>. When HOST_PORT is defined, the service is accessible outside the swarm as well.</p>\n\n<p>Within the web container, your connection string to db would look like <code>postgres://db:5432</code>, and from the host machine, the connection string would look like <code>postgres://{DOCKER_IP}:8001</code>.</p>\n\n<p><a href=\"https://docs.docker.com/compose/networking/\" rel=\"nofollow noreferrer\">compose-networking</a></p>\n"}], "owner": {"reputation": 1515, "user_id": 1516001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6d465bb8df6bda89904c7aafea0dda6c?s=128&d=identicon&r=PG", "display_name": "Donald French", "link": "https://stackoverflow.com/users/1516001/donald-french"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 1, "accepted_answer_id": 58313640, "answer_count": 1, "score": 2, "last_activity_date": 1570665191, "creation_date": 1570662928, "question_id": 58313428, "link": "https://stackoverflow.com/questions/58313428/docker-container-to-container-connect-connection-refused", "title": "Docker container to container connect: connection refused", "body": "<p>When all are run standalone outside of docker it works with no problem when core attempts to do a get from cerner. However, doing the same when all are dockerized as below I get:</p>\n\n<p>Get <a href=\"http://cerner:8602/api/v1/patient/search\" rel=\"nofollow noreferrer\">http://cerner:8602/api/v1/patient/search</a>: dial TCP 192.168.240.4:8602: connect: connection refused.  The .4 is the IP of the cerner container and .2 is the IP of the core container</p>\n\n<p>Cerner is the name of the container being called from core. If I change the name to the ip-address of the host server and use the ports, it works fine also.  It just does not allow container to container using the containers DNS or IP. I have attempted with and without the private network and get the same thing.</p>\n\n<p>The containers are all scratch go.</p>\n\n<pre><code>version: '3.7'\n\nservices:    caConnector:\n      image: vertisoft/ca_connector:latest\n      ports:\n        - \"8601:7001\"\n      env_file:\n        - .env.ca_connector\n      networks:\n        - core-net\n\n   fhir:\n      image: vertisoft/fhir_connector:latest\n      container_name: cerner\n      ports:\n        - \"8602:7002\"\n      env_file:\n        - .env.fhir_connector\n      networks:\n        - core-net\n\n   core:\n      image: vertisoft/core:latest\n      ports:\n        - \"8600:7000\"\n      env_file:\n        - .env.core\n      networks:\n        - core-net\n\nnetworks:   core-net:\n    driver: bridge\n</code></pre>\n"}, {"tags": ["rest", "api", "security", "go", "mux"], "comments": [{"owner": {"reputation": 111, "user_id": 12136637, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCL9piiiQkAfMbF1_mXyDDN3R6eujR1Y7jFRKGsycw=k-s128", "display_name": "Justin Savala", "link": "https://stackoverflow.com/users/12136637/justin-savala"}, "edited": false, "score": 0, "creation_date": 1570660697, "post_id": 58312528, "comment_id": 102987211, "body": "How are you planning to serve the webpage? One idea would be to generate a nonce that is sent as a header with the webpage. The nonce is then used to access the API. The API would then return another nonce with every request for the subsequent request. This would essentially protect the API by requiring that you call it with the initial nonce from the webpage load. It&#39;s not perfect but works better than nothing."}, {"owner": {"reputation": 89, "user_id": 5208232, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/OMivV.png?s=128&g=1", "display_name": "Dirkx Senne", "link": "https://stackoverflow.com/users/5208232/dirkx-senne"}, "reply_to_user": {"reputation": 111, "user_id": 12136637, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCL9piiiQkAfMbF1_mXyDDN3R6eujR1Y7jFRKGsycw=k-s128", "display_name": "Justin Savala", "link": "https://stackoverflow.com/users/12136637/justin-savala"}, "edited": false, "score": 0, "creation_date": 1570706528, "post_id": 58312528, "comment_id": 103002247, "body": "@JustinSavala So essentially you&#39;re thinking generating a nonce on each request and this specific nonce would have a lifespan of 1 request?"}, {"owner": {"reputation": 56502, "user_id": 271475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b00f41e5f2a69734051f2a78f4f3785?s=128&d=identicon&r=PG", "display_name": "Chris Heald", "link": "https://stackoverflow.com/users/271475/chris-heald"}, "edited": false, "score": 0, "creation_date": 1570762028, "post_id": 58312528, "comment_id": 103024514, "body": "That&#39;s a way to do it, yes. An attacker would just have to grab the nonce before the React client consumes it, though, and then it could make requests and receive new nonces."}, {"owner": {"reputation": 111, "user_id": 12136637, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCL9piiiQkAfMbF1_mXyDDN3R6eujR1Y7jFRKGsycw=k-s128", "display_name": "Justin Savala", "link": "https://stackoverflow.com/users/12136637/justin-savala"}, "edited": false, "score": 0, "creation_date": 1570795946, "post_id": 58312528, "comment_id": 103037217, "body": "It&#39;s not an ideal way but it at least blocks the casual attack."}, {"owner": {"reputation": 89, "user_id": 5208232, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/OMivV.png?s=128&g=1", "display_name": "Dirkx Senne", "link": "https://stackoverflow.com/users/5208232/dirkx-senne"}, "edited": false, "score": 0, "creation_date": 1570796468, "post_id": 58312528, "comment_id": 103037497, "body": "Thanks a bunch, guys."}], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 5208232, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/OMivV.png?s=128&g=1", "display_name": "Dirkx Senne", "link": "https://stackoverflow.com/users/5208232/dirkx-senne"}, "edited": false, "score": 0, "creation_date": 1570706328, "post_id": 58312704, "comment_id": 103002141, "body": "This is the response I feared. Thank you for your answer."}], "tags": [], "owner": {"reputation": 56502, "user_id": 271475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b00f41e5f2a69734051f2a78f4f3785?s=128&d=identicon&r=PG", "display_name": "Chris Heald", "link": "https://stackoverflow.com/users/271475/chris-heald"}, "is_accepted": true, "score": 7, "last_activity_date": 1570657317, "creation_date": 1570657317, "answer_id": 58312704, "question_id": 58312528, "link": "https://stackoverflow.com/questions/58312528/rest-api-only-accessible-through-my-react-client/58312704#58312704", "title": "REST API only accessible through my React client", "body": "<p>This is an inherently unsolvable problem. React runs on the client. The client controls the code that it executes. Hence, any mechanism you use to restrict the API usage to just your React client will be discoverable and reusable in other client contexts. You cannot control the client, and attempts to do so will be broken if the payoff is valuable enough.</p>\n\n<p>You can attempt to harden it somewhat by using short-term authorization tokens, but there is nothing preventing that token from being grabbed and reused in another context.</p>\n\n<p>If you have to restrict access to an API, you should have a public API which is less dangerous or privileged, and the public API should make use of your private API, effectively proxying the calls to hide the private API, as well as to ensure that only validated queries are executed against the more privileged API.</p>\n\n<p>If you could describe the problem you're trying to mitigate, though, there may be other solutions available.</p>\n"}], "owner": {"reputation": 89, "user_id": 5208232, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/OMivV.png?s=128&g=1", "display_name": "Dirkx Senne", "link": "https://stackoverflow.com/users/5208232/dirkx-senne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 58312704, "answer_count": 1, "score": 0, "last_activity_date": 1570657317, "creation_date": 1570656319, "question_id": 58312528, "link": "https://stackoverflow.com/questions/58312528/rest-api-only-accessible-through-my-react-client", "title": "REST API only accessible through my React client", "body": "<p>I'm building a React.js application that will interact with my REST API built in Go.</p>\n\n<p>React will use Javascript Fetch API to send requests to my API.</p>\n\n<p>The problem is I would like to secure my API from being requested from elsewhere. No one should directly be able to access my API either through the URL or through any other client like Postman.</p>\n\n<p>I know what JWT is but this does not solve my problem because anyone can access the token through the browser and then continue to request the API outside the React client using the token.</p>\n\n<p>I have researched extensively but nothing has really fit my description.</p>\n\n<p>Thanks a lot for you help, in advance.</p>\n"}, {"tags": ["go", "indexoutofrangeexception"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1570648885, "last_edit_date": 1570648885, "creation_date": 1570648362, "answer_id": 58310779, "question_id": 58310733, "link": "https://stackoverflow.com/questions/58310733/im-not-sure-why-im-getting-an-index-out-of-range-error/58310779#58310779", "title": "I&#39;m not sure why I&#39;m getting an index out of range error", "body": "<p>First, never omit errors!</p>\n\n<p>To answer your question: if <code>lines</code> is empty (<code>len(lines) == 0</code>), then <code>len(lines)-1</code> will be <code>-1</code> which may trigger your error.</p>\n\n<p>Similarly if <code>lines</code> is empty, <code>lines[0]</code> is also out of range but the previous line panics so you won't end up here.</p>\n\n<p>I'm guessing if <code>lines</code> is empty, the whole code should be skipped (nothing to analyze), so first check that. For example:</p>\n\n<pre><code>if len(lines) == 0 {\n    return\n}\n\n// There are lines, it's safe to index it with 0 and len(lines)-1\n\n...\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 4864774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a54b259d961ce66b0779cd8c2b1cad73?s=128&d=identicon&r=PG&f=1", "display_name": "user4864774", "link": "https://stackoverflow.com/users/4864774/user4864774"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1570648885, "creation_date": 1570648167, "question_id": 58310733, "link": "https://stackoverflow.com/questions/58310733/im-not-sure-why-im-getting-an-index-out-of-range-error", "title": "I&#39;m not sure why I&#39;m getting an index out of range error", "body": "<p>I'm getting the error:</p>\n\n<p>panic: runtime error: index out of range</p>\n\n<p>goroutine 7 [running]:\nmain.start(0xc0000540e0, 0x8, 0xc0000542a0, 0x63, 0x1, 0xc00249a0c0)</p>\n\n<p>when I try to run my program on certain logs, but not all of them. </p>\n\n<p>The code that is causing this error seems to be:</p>\n\n<pre><code>end, _ := time.Parse(\"15:04:05\", lines[len(lines)-1].Timestamp)\nstart, _ := time.Parse(\"15:04:05\", lines[0].Timestamp)\nmidnight, _ := time.Parse(\"15:04:05\", \"00:00:00\")\nduration := end.Sub(start).Seconds()\nif start.Hour() &gt; end.Hour() {\n   toMidnight := 24*3600 - start.Sub(midnight).Seconds()\n   timeDuration = toMidnight + end.Sub(midnight).Seconds()\n}\n</code></pre>\n"}, {"tags": ["go", "proxy", "cors", "go-echo"], "answers": [{"comments": [{"owner": {"reputation": 1967, "user_id": 1031871, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7g8bJ.jpg?s=128&g=1", "display_name": "Arun Gopalpuri", "link": "https://stackoverflow.com/users/1031871/arun-gopalpuri"}, "edited": false, "score": 1, "creation_date": 1585859075, "post_id": 58331197, "comment_id": 107920532, "body": "Thanks for sharing this middleware. Helped me resolve this weird issue @RavenHursT"}], "tags": [], "owner": {"reputation": 2140, "user_id": 282250, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c46229bf9048c284b0700a8f4ac813dd?s=128&d=identicon&r=PG", "display_name": "RavenHursT", "link": "https://stackoverflow.com/users/282250/ravenhurst"}, "is_accepted": true, "score": 2, "last_activity_date": 1570742092, "creation_date": 1570742092, "answer_id": 58331197, "question_id": 58310173, "link": "https://stackoverflow.com/questions/58310173/echo-cors-w-proxy-middlewares-causes-problems-w-access-allow-origins-response/58331197#58331197", "title": "Echo CORS w/ Proxy middlewares causes problems w/ Access-Allow-Origins response header", "body": "<p>I ultimately solved this by writing a custom Echo middleware to hook into the response before Echo's proxy middleware could send the headers back to the client.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func setResponseACAOHeaderFromRequest (req http.Request, resp echo.Response) {\n    resp.Header().Set(echo.HeaderAccessControlAllowOrigin, \n    req.Header.Get(echo.HeaderOrigin))\n}\n\nfunc ACAOHeaderOverwriteMiddleware(next echo.HandlerFunc) echo.HandlerFunc {\n    return func(ctx echo.Context) error {\n        ctx.Response().Before(func() {\n            setResponseACAOHeaderFromRequest(*ctx.Request(), *ctx.Response())\n        })\n        return next(ctx)\n    }\n}\n</code></pre>\n\n<p>Then just put this middleware in <code>e.Use()</code> <em>right</em> before your proxy middleware:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>e.POST(\n        \"/\",\n        handlers.Noop,\n        ACAOHeaderOverwriteMiddleware,\n        middleware.ProxyWithConfig(middleware.ProxyConfig{\n             Balancer: singleTargetBalancer(\"[backend service URL]\"),\n        })\n)\n</code></pre>\n\n<p>Docs for Echo's <code>Request::Before()</code> hook: <a href=\"https://echo.labstack.com/guide/response#before-response\" rel=\"nofollow noreferrer\">https://echo.labstack.com/guide/response#before-response</a></p>\n"}], "owner": {"reputation": 2140, "user_id": 282250, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c46229bf9048c284b0700a8f4ac813dd?s=128&d=identicon&r=PG", "display_name": "RavenHursT", "link": "https://stackoverflow.com/users/282250/ravenhurst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1269, "favorite_count": 0, "accepted_answer_id": 58331197, "answer_count": 1, "score": 0, "last_activity_date": 1570742092, "creation_date": 1570645636, "question_id": 58310173, "link": "https://stackoverflow.com/questions/58310173/echo-cors-w-proxy-middlewares-causes-problems-w-access-allow-origins-response", "title": "Echo CORS w/ Proxy middlewares causes problems w/ Access-Allow-Origins response header", "body": "<p>I'm using LabStack's Golang Echo Framework to build out a service.</p>\n\n<p>One of the routes, needs to proxy requests and responses to and from a backend service.</p>\n\n<p>But I also need CORS to work on this service as well.</p>\n\n<p>So I'm using <code>middleware.CORSWithConfig</code> along w/ a <code>middleware.ProxyWithConfig</code> in my request/response stack.</p>\n\n<p>I'm seeing some oddness w/ the <code>Access-Control-Allow-Origins</code> header where the value for that header on the response from the proxied service to my Echo server <code>*</code>, but once it passes through the proxy, it changes to <code>*, *</code> by the time it gets back into the client. \nUpon which I start seeing the following browser errors related to CORS violations:</p>\n\n<pre><code>VM1627:362 Access to XMLHttpRequest at 'http://localhost:6273/' from origin 'http://localhost:8002' has been blocked by CORS policy: The 'Access-Control-Allow-Origin' header contains multiple values '*, *', but only one is allowed.\n</code></pre>\n\n<p>Has anyone come across this?  Anyone have any idea why this might be happening and maybe a way around it?</p>\n\n<p>Here's some example code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nfunc singleTargetBalancer(url *url.URL) middleware.ProxyBalancer {\n    targetURL := []*middleware.ProxyTarget{\n        {\n            URL: url,\n        },\n    }\n    return middleware.NewRoundRobinBalancer(targetURL)\n}\n\nfunc Noop(ctx echo.Context) (err error) {\n    ctx.String(\n        http.StatusNotImplemented,\n        \"No op handler should never be reached!\",\n    )\n\n    return err\n}\n\nfunc main() {\n        e := echo.New()\n    e.HideBanner = true\n    e.Use(\n        middleware.CORSWithConfig(middlewares.CustomCorsConfig),\n        middlewares.ThriftMetrics(),\n    )\n\n        // Have to use a Noop handler since we're not trying to set up a full-on proxy for the backend service.  We only want this one route to be proxied.\n        e.POST(\n        \"/\",\n        handlers.Noop,\n        middleware.ProxyWithConfig(middleware.ProxyConfig{\n             Balancer: singleTargetBalancer(\"[backend service URL]\"),\n            })\n    )\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570646619, "post_id": 58310043, "comment_id": 102982271, "body": "Are you sure you&#39;re getting the homepage? The /data/ page appears to be generated by javascript."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570646937, "post_id": 58310043, "comment_id": 102982385, "body": "The page returned from the Go program, a web browser and curl pretty much look the same.  Please describe what you expect and what you are getting."}, {"owner": {"reputation": 1, "user_id": 12190532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-INW_aEcSaJo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reGQ9okU0uBzgXu-BXlAQnBJA7Nfg/photo.jpg?sz=128", "display_name": "Swifty", "link": "https://stackoverflow.com/users/12190532/swifty"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570647516, "post_id": 58310043, "comment_id": 102982634, "body": "@bserdar that might be in part my misunderstanding here but I thought the http.get response would be the same as the source of the page. Also the .../ request returns the same as .../data request, and they both the same to the source code I can see of the homepage"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570647653, "post_id": 58310043, "comment_id": 102982694, "body": "You did not misunderstand, and it is returning the source of the page. The difference is that after your get command, there is nothing to run the javascript returned to build the page. The page is dynamically generated by Javascript."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570647714, "post_id": 58310043, "comment_id": 102982723, "body": "The page returned to the browser and the Go program are identical, byte for byte.  See <code>view-source:https:&#47;&#47;poe.ninja&#47;data</code>"}, {"owner": {"reputation": 1, "user_id": 12190532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-INW_aEcSaJo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reGQ9okU0uBzgXu-BXlAQnBJA7Nfg/photo.jpg?sz=128", "display_name": "Swifty", "link": "https://stackoverflow.com/users/12190532/swifty"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570647850, "post_id": 58310043, "comment_id": 102982775, "body": "@CeriseLim&#243;n I was expecting to get the source code for the &quot;<a href=\"https://poe.ninja/data\" rel=\"nofollow noreferrer\">poe.ninja/data</a>&quot; but its returning the html source code of the &quot;<a href=\"https://poe.ninja\" rel=\"nofollow noreferrer\">poe.ninja</a>&quot; instead."}, {"owner": {"reputation": 1, "user_id": 12190532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-INW_aEcSaJo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reGQ9okU0uBzgXu-BXlAQnBJA7Nfg/photo.jpg?sz=128", "display_name": "Swifty", "link": "https://stackoverflow.com/users/12190532/swifty"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570648168, "post_id": 58310043, "comment_id": 102982898, "body": "@bserdar I think I understand, is there anyway to get the html source of the data page as if I was visiting it on a web browser"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570648429, "post_id": 58310043, "comment_id": 102983009, "body": "There is no easy way to do that. You need to run the javascript."}, {"owner": {"reputation": 1, "user_id": 12190532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-INW_aEcSaJo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reGQ9okU0uBzgXu-BXlAQnBJA7Nfg/photo.jpg?sz=128", "display_name": "Swifty", "link": "https://stackoverflow.com/users/12190532/swifty"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570649214, "post_id": 58310043, "comment_id": 102983364, "body": "@bserdar fair enough, ill look for an alternative way of doing it, thanks"}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "edited": false, "score": 0, "creation_date": 1570652185, "post_id": 58310043, "comment_id": 102984492, "body": "Try using something like: <a href=\"https://github.com/chromedp/chromedp\" rel=\"nofollow noreferrer\">github.com/chromedp/chromedp</a>"}], "answers": [{"tags": [], "owner": {"reputation": 13086, "user_id": 1431239, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e0085b2fdc60b5c84310fa29529a6648?s=128&d=identicon&r=PG", "display_name": "Mike Mackintosh", "link": "https://stackoverflow.com/users/1431239/mike-mackintosh"}, "is_accepted": false, "score": 0, "last_activity_date": 1570689245, "creation_date": 1570689245, "answer_id": 58316800, "question_id": 58310043, "link": "https://stackoverflow.com/questions/58310043/http-gethttps-poe-ninja-data-returning-https-poe-ninja-rather-than-the/58316800#58316800", "title": "http.get(&quot;https://poe.ninja/data&quot;) returning &quot;https://poe.ninja&quot; rather than the desired path of the domain", "body": "<p>React, Vue and other front-end frameworks use client-side routing (JavaScript path detection) to render content into the browser. This prevents the need for the client to contact the web server on every click and navigation. This could mean one of two things:</p>\n\n<ul>\n<li>The client will make an API call to the server to fetch the data. Use something like Developer Tools' Network tab to keep dibs on what endpoints the client it communicating with</li>\n<li>Using a headless Chrome/WebKit, etc approach with JavaScript enabled. This will allow your tool to pull down the page contents, render using JavaScript, and ultimately return the computed front-end code. Due to the way that clients render single page apps, it may be difficult following specific <code>div#id</code> and <code>div#class</code> elements</li>\n</ul>\n"}], "owner": {"reputation": 1, "user_id": 12190532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-INW_aEcSaJo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reGQ9okU0uBzgXu-BXlAQnBJA7Nfg/photo.jpg?sz=128", "display_name": "Swifty", "link": "https://stackoverflow.com/users/12190532/swifty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 433, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570689245, "creation_date": 1570645051, "question_id": 58310043, "link": "https://stackoverflow.com/questions/58310043/http-gethttps-poe-ninja-data-returning-https-poe-ninja-rather-than-the", "title": "http.get(&quot;https://poe.ninja/data&quot;) returning &quot;https://poe.ninja&quot; rather than the desired path of the domain", "body": "<p>I'm trying to make a get request to \"<a href=\"https://poe.ninja/data\" rel=\"nofollow noreferrer\">https://poe.ninja/data</a>\" but its not working how I thought it would and not sure how to get to that page specifically.</p>\n\n<p>I'm relatively new to go and programming as a whole so if I'm missing anything obvious or completely off the track on how http.get works for this please let me know.</p>\n\n<p>I've tried :\nThe homepage and that seems to be working as I thought. <a href=\"https://poe.ninja/\" rel=\"nofollow noreferrer\">https://poe.ninja/</a>\n<a href=\"https://xkcd.com\" rel=\"nofollow noreferrer\">https://xkcd.com</a> and <a href=\"https://xkcd.com/100\" rel=\"nofollow noreferrer\">https://xkcd.com/100</a>\nThis works as I'd thought too getting the homepage and the 100 comic respectively</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    resp, err := http.Get(\"https://poe.ninja/data/\")\n    if err != nil {panic(err)}\n    defer resp.Body.Close()\n\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {panic(err)}\n\n    fmt.Println(string(body))\n\n//From said code I'd expect to get the /data path but instead only get the homepage\n</code></pre>\n"}, {"tags": ["function", "go", "struct", "parameters", "interface"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1570642916, "post_id": 58309482, "comment_id": 102980554, "body": "It&#39;s rare to use a pointer to an interface in Go. Nothing in the question indicates that there&#39;s a reason to use a pointer to an interface.  Fix by changing <code>*myinter</code> to <code>myinter</code>. This fixes the error  at <code>callHello(newMystruct)</code> and at <code>i.hello()</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1570644789, "post_id": 58309482, "comment_id": 102981443, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/52774819/interface-can-not-call-self-method\">Interface can not call self method</a>,"}], "answers": [{"comments": [{"owner": {"reputation": 3690, "user_id": 3960852, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/FhcvT.png?s=128&g=1", "display_name": "Kenny Worden", "link": "https://stackoverflow.com/users/3960852/kenny-worden"}, "edited": false, "score": 0, "creation_date": 1570717031, "post_id": 58309779, "comment_id": 103008620, "body": "But if I want to take an interface as a parameter in a function, wouldn&#39;t it be inefficient to pass a concrete type in by value? Interfaces represent abstract types, wouldn&#39;t passing a pointer be better than passing by value especially when we don&#39;t know the size of the concrete type?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 3690, "user_id": 3960852, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/FhcvT.png?s=128&g=1", "display_name": "Kenny Worden", "link": "https://stackoverflow.com/users/3960852/kenny-worden"}, "edited": false, "score": 0, "creation_date": 1570719316, "post_id": 58309779, "comment_id": 103010020, "body": "If you pass an interface to a function, what&#39;s passed is the pointer to the underlying value, and a pointer to the type. If the underlying value of the interface is a struct (not pointer), interface points to a copy of the struct. If you pass a concrete struct to the function, the struct will be copied. If you pass a pointer to the struct, only a pointer will be passed. So passing in a struct takes a copy, regardless if you pass it via an interface or not."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1570723073, "last_edit_date": 1570723073, "creation_date": 1570643939, "answer_id": 58309779, "question_id": 58309482, "link": "https://stackoverflow.com/questions/58309482/passing-an-interface-pointer-in-a-function-parameter/58309779#58309779", "title": "Passing an interface pointer in a function parameter", "body": "<p>It is related to the way the type system works. An interface type <code>I</code> defines a method set. The method set is defined for type <code>I</code>, and not for type <code>*I</code>. Because of this, the use of <code>*I</code> is limited. It can be used when a function is to set the interface value, but it is rare:</p>\n\n<pre><code>func f(x *error) {\n  *x = fmt.Errorf(\"Some error\")\n}\n</code></pre>\n\n<p>Note that the interface itself can have an underlying pointer value:</p>\n\n<pre><code>func f(x someInterface) {\n   *x.(*someType) = value\n}\n\nfunc main() {\n   x := someType{}\n   f(&amp;x)\n}\n</code></pre>\n\n<p>This is different for non-interface types. When you define a method for a non-interface type <code>T</code>, the method is defined for both <code>T</code> and <code>*T</code>. If you define a method for <code>*T</code>, it is only defined for <code>*T</code>, and not for <code>T</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 3690, "user_id": 3960852, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/FhcvT.png?s=128&g=1", "display_name": "Kenny Worden", "link": "https://stackoverflow.com/users/3960852/kenny-worden"}, "edited": false, "score": 0, "creation_date": 1570716915, "post_id": 58317120, "comment_id": 103008569, "body": "Can you elaborate <i>why</i> this is wrong? Coming from a heavy Java development past, it seems that interface pointers would be more common (passing pointers to abstract types)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 3690, "user_id": 3960852, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/FhcvT.png?s=128&g=1", "display_name": "Kenny Worden", "link": "https://stackoverflow.com/users/3960852/kenny-worden"}, "edited": false, "score": 0, "creation_date": 1570724800, "post_id": 58317120, "comment_id": 103012955, "body": "@KennyWorden Pointer-to-something is needed if you want to mutate the something. An interface value itself is seldomly modified. What is modified is the actual value contained <i>in</i> the interface value: It is common to store pointers inside an interface, but that is completely different from a pointer to an interface value itself."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1570690612, "creation_date": 1570690612, "answer_id": 58317120, "question_id": 58309482, "link": "https://stackoverflow.com/questions/58309482/passing-an-interface-pointer-in-a-function-parameter/58317120#58317120", "title": "Passing an interface pointer in a function parameter", "body": "<blockquote>\n  <p>Is Go trying to discourage me from passing interface pointers into functions?</p>\n</blockquote>\n\n<p>Yes.</p>\n\n<p>Pointer-to-interface os <em>wrong</em> in (almost*) all cases.</p>\n\n<p>(* There are very rare and delicate cases where pointer-to-interface makes sense but chances are high you won't see them more than once every 5 years.)</p>\n\n<p>(Nitpick: The language is called \"Go\". \"golang.org\" is the website. Basics like this are covered by the compatibility promise and do not depend on the version: Go 1.0, 1.12 and 1.16 behave exactly the same in this regard.)</p>\n"}], "owner": {"reputation": 3690, "user_id": 3960852, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/FhcvT.png?s=128&g=1", "display_name": "Kenny Worden", "link": "https://stackoverflow.com/users/3960852/kenny-worden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1570723073, "creation_date": 1570642738, "question_id": 58309482, "link": "https://stackoverflow.com/questions/58309482/passing-an-interface-pointer-in-a-function-parameter", "title": "Passing an interface pointer in a function parameter", "body": "<p>I am trying to understand Golang (1.12) interfaces. I found out that interface pointers must be explicitly dereferenced, unlike structs:</p>\n\n<pre><code>import \"fmt\"\n\n// A simple interface with one function\ntype myinter interface {\n    hello()\n}\n\n// Implement myinter\ntype mystruct struct {}\n\nfunc (mystruct) hello() {\n    fmt.Println(\"I am T!\")\n}\n\n// Some function that calls the hello function as defined by myinter\nfunc callHello(i *myinter) {   \n    i.hello()  // &lt;- cannot resolve reference 'hello'\n}\n\nfunc main() {\n    newMystruct := &amp;mystruct{}\n    callHello(newMystruct)\n}\n</code></pre>\n\n<p>Here, my <code>callHello</code> function cannot resolve the reference to my <code>hello</code> function as defined in the interface. Of course, dereferencing the interface works:</p>\n\n<pre><code>func callHello(i *myinter) {   \n    (*i).hello()  // &lt;- works!\n}\n</code></pre>\n\n<p>But in structs, we can call the function directly, <a href=\"https://tour.golang.org/moretypes/4\" rel=\"nofollow noreferrer\">none of this cumbersome dereference notation is necessary</a>:</p>\n\n<pre><code>func callHello(s *mystruct) {   \n    s.hello()  // &lt;- also works!\n}\n</code></pre>\n\n<p>Why is this the case? Is there a reason why we must explicitly dereference <code>interface</code> pointers? Is Go trying to discourage me from passing <code>interface</code> pointers into functions?</p>\n"}, {"tags": ["firebase", "go", "firebase-cloud-messaging", "firebase-admin"], "answers": [{"tags": [], "owner": {"reputation": 233128, "user_id": 807126, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpNqK.jpg?s=128&g=1", "display_name": "Doug Stevenson", "link": "https://stackoverflow.com/users/807126/doug-stevenson"}, "is_accepted": true, "score": 2, "last_activity_date": 1571007371, "creation_date": 1571007371, "answer_id": 58368417, "question_id": 58308835, "link": "https://stackoverflow.com/questions/58308835/using-firebase-for-notifications-getting-app-instance-has-been-unregistered/58368417#58368417", "title": "Using Firebase for notifications, getting `app instance has been unregistered`", "body": "<p>According to the <a href=\"https://firebase.google.com/docs/cloud-messaging/send-message#admin_sdk_error_reference\" rel=\"nofollow noreferrer\">documentation for FCM error codes</a>, registration-token-not-registered means:</p>\n\n<blockquote>\n  <p>The provided registration token is not registered. A previously valid\n  registration token can be unregistered for a variety of reasons,\n  including:</p>\n  \n  <ul>\n  <li>The client app unregistered itself from FCM.</li>\n  <li>The client app was automatically unregistered. This can happen if the user uninstalls the application or, on iOS, if the APNS Feedback\n  Service reported the APNS token as invalid.</li>\n  <li>The registration token expired. For example, Google might decide to refresh registration tokens or the APNS token may have expired for iOS\n  devices.</li>\n  <li>The client app was updated, but the new version is not configured to receive messages.</li>\n  </ul>\n  \n  <p>For all these cases, remove this registration token and stop using it\n  to send messages.</p>\n</blockquote>\n\n<p>Given that there are several possibilities here, it's not really possible for us to say which one it is.  If you need assistance troubleshooting with FCM, please <a href=\"https://support.google.com/firebase/contact/support\" rel=\"nofollow noreferrer\">contact Firebase support directly</a> with exact steps anyone can take to reproduce the issue.</p>\n"}], "owner": {"reputation": 601, "user_id": 1347268, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/abd1a63352cf4aa1e8e18228eb2c88c3?s=128&d=identicon&r=PG", "display_name": "Mark Fletcher", "link": "https://stackoverflow.com/users/1347268/mark-fletcher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 736, "favorite_count": 1, "accepted_answer_id": 58368417, "answer_count": 1, "score": 1, "last_activity_date": 1571007371, "creation_date": 1570639840, "last_edit_date": 1571007172, "question_id": 58308835, "link": "https://stackoverflow.com/questions/58308835/using-firebase-for-notifications-getting-app-instance-has-been-unregistered", "title": "Using Firebase for notifications, getting `app instance has been unregistered`", "body": "<p>Trying to use Firebase for cross-platform mobile notifications. The client code to get a device token seems to work, as we can send notifications from the Firebase web console. But I cannot figure out how to send notifications from our server. We get the error: <code>app instance has been unregistered; code: registration-token-not-registered; details: Requested entity was not found</code> when calling <code>messagingClient.Send</code> in the following Go code snippet:</p>\n\n<pre><code>    ctx := r.Context()\n    opt := option.WithCredentialsFile(\"serviceAccountKey.json\")\n    app, err := firebase.NewApp(context.Background(), nil, opt)\n    if err != nil {\n      return err\n    }\n\n    // Obtain a messaging.Client from the App.\n    messagingClient, err := app.Messaging(ctx)\n    if err != nil {\n      return err\n    }\n    // See documentation on defining a message payload.\n    message := &amp;messaging.Message{\n      Notification: &amp;messaging.Notification{\n        Title: \"Notification title\",\n        Body:  \"Notification body\",\n      },\n      Token: myDeviceToken,\n    }\n\n    // Send a message to the device corresponding to the provided\n    // registration token.\n    response, err := messagingClient.Send(ctx, message)\n    if err != nil {\n      return err\n    }\n</code></pre>\n\n<p>The credentials file that we're using is from the Firebase console, under Settings, Service Accounts, Firebase Admin SDK.</p>\n"}, {"tags": ["web-services", "http", "go", "connection"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570640044, "post_id": 58308763, "comment_id": 102979243, "body": "You seem to be loading all the data in memory, and then sending it. Maybe you&#39;re running out of memory when processing multiple requests this way."}, {"owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570640215, "post_id": 58308763, "comment_id": 102979318, "body": "@bserdar, We have 150Gb or RAM or so. So 10 to 100 requests won&#39;t kill the service because of memory. Also the service doesn&#39;t restart which I would imagine it would in your scenario."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570640248, "post_id": 58308763, "comment_id": 102979332, "body": "You don&#39;t show how <code>sendSize</code> is calculated.  Is it possible that it&#39;s incorrect?  Why does the application use io.CopyN instead of io.Copy?  It might be a concurrency error given that the problem only happens when there are concurrent requests. Run the application with the <a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">race detector</a>."}, {"owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "edited": false, "score": 0, "creation_date": 1570640947, "post_id": 58308763, "comment_id": 102979649, "body": "Sorry, I have support for <code>Range: ...</code> as well so the <code>sendSize</code> may be smaller whan a <code>Range: ...</code> request happen. However, I can see the size as I also stick it in <code>Content-Length: ...</code> (added to example above). So it is correct. This is also why I use <code>CopyN()</code> instead of <code>Copy()</code>. Note that at this time I&#39;ve not tested <code>Range: ...</code> at all. I send &quot;plain&quot; <code>GET</code> requests. As I mentioned, since it works when I send just one single request, I&#39;m confident that the logic is correct."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1570641841, "post_id": 58308763, "comment_id": 102980062, "body": "The code posted in the most recent edit looks good.  The problem is in code that we cannot see (it&#39;s either code in the ... or the actual code is different from what&#39;s posted here)."}], "owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1570641503, "creation_date": 1570639508, "last_edit_date": 1570641503, "question_id": 58308763, "link": "https://stackoverflow.com/questions/58308763/go-http-service-implemented-with-gin-sends-about-50-of-the-data-then-closes-the", "title": "Go HTTP service implemented with Gin sends about 50% of the data then closes the connection, why?", "body": "<p>I have an HTTP service which sends very large files to the client (most often between 50Mb and 100Mb). When I start several clients in parallel, I often get part of the file (500Kb to 25Mb) and then the server closes the connection.</p>\n\n<p>If I'm the only one to do a <code>GET</code> with a single connection, it doesn't close the connection until the entire file was transferred. So the service works when not under load.</p>\n\n<p>Here is how my Gin handler looks like:</p>\n\n<pre><code>func handler(c *gin.Context) {\n    ...some initialization...\n\n    // prepare list of readers\n    readers := []io.Reader{}\n    size := 0\n\n    ...load some data in a []byte buffer...\n\n    // create one reader and stack it in `readers`\n    readers = append(readers, bytes.NewReader(data))\n    size += len(data)\n\n    ...repeat as needed for this request...\n\n    // create stream\n    r := io.MultiReader(readers...)\n\n    // send data\n    c.Status(http.StatusOK)  // HTTP 200 response\n    c.Header(\"Content-Length\", strconv.FormatInt(size, 10))\n    io.CopyN(c.Writer, audioReader, size)\n}\n</code></pre>\n\n<p>As I mentioned, the process works just fine when I do one <code>GET</code> at a time and wait for completion.</p>\n\n<p>When I run two or more <code>GET</code> in parallel, that's when things break.</p>\n\n<p>I'm wondering whether the Gin TCP connection gets reused and thus the <code>io.CopyN()</code> get interrupted before it completed. If so, how would I wait to make sure <code>io.CopyN()</code> is done?!</p>\n\n<p>I know a <code>close()</code> is possible if I'm directly in control of the socket, but that doesn't work well if the HTTP protocol said <code>keep-alive</code> but especially, closing on my end, I may be walking on Gin's toes. I have some integration tests which send/receive hundreds of connections and transfers Mb of data and these work great. Only I don't ever send two requests in parallel in those tests (at least not yet).</p>\n"}, {"tags": ["go", "yaml", "kubernetes-helm", "go-templates"], "owner": {"reputation": 61, "user_id": 12076080, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c93a286a6713ee8193dabb620e6806ed?s=128&d=identicon&r=PG&f=1", "display_name": "CodeNewb", "link": "https://stackoverflow.com/users/12076080/codenewb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1455, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1570639111, "creation_date": 1570639111, "question_id": 58308666, "link": "https://stackoverflow.com/questions/58308666/kubernetes-helm-chart-use-helpers-tpl-to-concat-values-and-feed-back-into-valu", "title": "Kubernetes Helm chart: Use _helpers.tpl to concat values and feed back into Values.yaml", "body": "<p>I am new to Kubernetes, Helm, and Golang. Basically, I'm trying to concat strings in my values.yaml file to populate another value in my values.yaml file. I'm using _helpers.tpl to do this (in an attempt to understand Helm and Golang better).  I could just write \"users: \"datafeed:password:::incoming\" \" in my values.yaml file and be done with it; but would like to avoid that. </p>\n\n<p>I have the following in my values.yaml file:</p>\n\n<pre><code>sftp:\n  users: \"\"\n  username: \"datafeed\"\n  password: \"password\"\n  incoming: \"incoming\"\n</code></pre>\n\n<p>And want the <strong>final</strong> values.yaml file to read:</p>\n\n<pre><code>sftp:\n  users: \"datafeed:password:::incoming\"\n  username: \"datafeed\"\n  password: \"password\"\n  incoming: \"incoming\"\n</code></pre>\n\n<p>To do this, I am trying to edit the _helpers.tpl file. I have tried</p>\n\n<pre><code>{{- define \"sftp.users\" -}}\n{{- .Values.sftp.users: .Values.sftp.username+\":\"+.Values.sftp.password+\":::\"+.Values.sftp.incoming -}}\n{{- end -}}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>{{- define \"sftp.users\" -}}\n{{- .Values.sftp.users:= .Values.sftp.username+\":\"+.Values.sftp.password+\":::\"+.Values.sftp.incoming -}}\n{{- end -}}\n</code></pre>\n\n<p>Then I tried making each segment a variable (and deleted the explicit values in the values.yaml file):</p>\n\n<pre><code>{{- define \"sftp.users\" -}}\n{{ $username:= \"datafeed\" }}\n{{ $password:= \"password\" }}\n{{ $incoming:= \"incoming\" }}\n{{- .Values.sftp.users= {{$username}}+\":\"+{{$password}}\":::\"+{{$incoming}} -}}\n</code></pre>\n\n<p>and then setting the fields/keys explicitly:</p>\n\n<pre><code>username: {{ .Values.sftp.username | default \"datafeed\" }}\npassword: {{ .Values.sftp.password | default \"password\" }}\nincoming: {{ .Values.sftp.incoming | default \"incoming\" }}\n{{- .Values.sftp.users:= username+\":\"+password+\":::\"+incoming -}}\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>{{define \"username\"}}datafeed{{end}}\n{{define \"password\"}}password{{end}}\n{{define \"incoming\"}}incoming{{end}}\n{{define \"users\"}}{{template \"username\"}}:{{template \"password\"}}:::{{template \"incoming\"}}{{end}}\n{{- printf \"users\" -}}\n{{- .Values.sftp.users: users -}}\n</code></pre>\n\n<p>I have also looked at previous posts:\n<a href=\"https://stackoverflow.com/questions/46719082/helm-helpers-tpl-calling-defined-templates-in-other-template-definitions?rq=1\">Helm _helpers.tpl: Calling defined templates in other template definitions</a>\n<a href=\"https://stackoverflow.com/questions/45278655/kubernetes-helm-combine-two-variables-with-a-string-in-the-middle?newreg=1f09fb8852fa44f2871d96bec723d61c\">Kubernetes Helm, combine two variables with a string in the middle</a>\n<a href=\"https://stackoverflow.com/questions/56679428/how-to-get-values-from-values-yaml-to-helpers-tpl-in-helm-charts\">How to get values from values.yaml to _helpers.tpl in helm charts</a></p>\n\n<p>None of this seems to work. I can't tell if it's my approach or my syntax. Probably both.</p>\n"}, {"tags": ["go", "apple-push-notifications", "pem", "p8"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1570638662, "post_id": 58308470, "comment_id": 102978662, "body": "1) Have you tried this with one of the available jwt packages?  2) Are you sure you have all the claims required?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11042303"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570639761, "post_id": 58308470, "comment_id": 102979130, "body": "@bserdar I haven&#39;t tried any JWT packages, and yes, the claims are all there."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1570640221, "post_id": 58308470, "comment_id": 102979320, "body": "One way you can see if your jwt is broken or not is to try it on jwt.io, see if it can decode it. How are you sending the jwt? Is it bearer auth?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11042303"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570640499, "post_id": 58308470, "comment_id": 102979435, "body": "@bserdar I&#39;ve fixed it; I had to change the IAT claim type from string to int64, and use time.Now().Unix() instead of String(). I&#39;ve just now read Apple&#39;s documentation, probably should&#39;ve done that before. Thanks anyway :)"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user11042303"}, "is_accepted": true, "score": 0, "last_activity_date": 1570640801, "creation_date": 1570640801, "answer_id": 58309074, "question_id": 58308470, "link": "https://stackoverflow.com/questions/58308470/403-forbidden-error-when-making-a-push-request-to-apns-with-go-am-i-creating-th/58309074#58309074", "title": "403 Forbidden error when making a push request to APNS with Go. Am I creating the JWT correctly?", "body": "<p>The problem was incorrect IAT claim type. Instead of string it should be int64 and time should be in seconds. Calling String() on time.Now() returns a different format from what Apple expects the IAT claim to be, per their documentation: <a href=\"https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/establishing_a_token-based_connection_to_apns\" rel=\"nofollow noreferrer\">https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/establishing_a_token-based_connection_to_apns</a>. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11042303"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 58309074, "answer_count": 1, "score": 0, "last_activity_date": 1570640801, "creation_date": 1570638382, "question_id": 58308470, "link": "https://stackoverflow.com/questions/58308470/403-forbidden-error-when-making-a-push-request-to-apns-with-go-am-i-creating-th", "title": "403 Forbidden error when making a push request to APNS with Go. Am I creating the JWT correctly?", "body": "<p>I'm getting the following error when making a push notification request to APNS: &amp;{403 Forbidden 403 HTTP/2.0 2 0 map[Apns-Id:[7BF53274-A04B-7C1B-8312-DB01DA48A519]] {0xc0000c88c0} -1 [] false false map[] 0xc000132000 0xc0000ba370}</p>\n\n<p>I suspect my code to generate an authentication header is not correct</p>\n\n<p>Here's the relevant code:</p>\n\n<pre><code>func generateAuthenticationHeader() string {\n    b, _ := json.Marshal(Header{ ALG: \"ES256\", KID: authKeyId })\n    header := b64.StdEncoding.EncodeToString(b)\n\n    b, _ = json.Marshal(Claims{ ISS: teamId, IAT: time.Now().String() })\n    claims := b64.StdEncoding.EncodeToString(b)\n\n    pkey := getPrivateKey()\n\n    indata := fmt.Sprintf(\"%s.%s\", header, claims)\n    h := sha256.New()\n    h.Write([]byte(indata))\n    digest := h.Sum(nil)\n\n    r, s, err := ecdsa.Sign(rand.Reader, pkey, digest)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    signature := r.Bytes()\n    signature = append(signature, s.Bytes()...)\n\n    signed := b64.StdEncoding.EncodeToString(signature)\n\n    return fmt.Sprintf(\"%s.%s.%s\", header, claims, signed)\n}\n\nfunc getPrivateKey() *ecdsa.PrivateKey {\n    r, _ := ioutil.ReadFile(authKeyPath)\n    block, _ := pem.Decode(r)\n\n    key, err := x509.ParsePKCS8PrivateKey(block.Bytes)\n    if err != nil {\n        log.Fatal(err)\n    }\n    pkey := key.(*ecdsa.PrivateKey)\n\n    return pkey\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "edited": false, "score": 0, "creation_date": 1570636933, "post_id": 58307704, "comment_id": 102977848, "body": "Any chance you could post a key (obviously not a sensitive one)?  I&#39;m not sure it is necessary to import the brainpool library just to get a curve."}, {"owner": {"reputation": 1091, "user_id": 4474629, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3d1d6e41980939611b75370816b8843?s=128&d=identicon&r=PG&f=1", "display_name": "Little Code", "link": "https://stackoverflow.com/users/4474629/little-code"}, "reply_to_user": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "edited": false, "score": 0, "creation_date": 1570637249, "post_id": 58307704, "comment_id": 102977998, "body": "@PassKit Updated with contents of <code>&#47;tmp&#47;TEST.pem</code> which is a throw-away test key not being used for anything other than this test code."}], "answers": [{"comments": [{"owner": {"reputation": 1091, "user_id": 4474629, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3d1d6e41980939611b75370816b8843?s=128&d=identicon&r=PG&f=1", "display_name": "Little Code", "link": "https://stackoverflow.com/users/4474629/little-code"}, "edited": false, "score": 0, "creation_date": 1570693724, "post_id": 58316611, "comment_id": 102995511, "body": "Thanks for helping me get to the bottom of this conundrum !  I did experiment yesterday with various other parts of core <code>go</code> but never got anywhere, I guess because like you I thought a curve was readable by anything.  But you&#39;ve rightly ultimately identified that you need to drop down to a slightly lower level."}], "tags": [], "owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "is_accepted": true, "score": 2, "last_activity_date": 1571110939, "last_edit_date": 1571110939, "creation_date": 1570688469, "answer_id": 58316611, "question_id": 58307704, "link": "https://stackoverflow.com/questions/58307704/ecdh-in-golang-elliptic-curve-unmarshal-fails/58316611#58316611", "title": "ECDH in golang - elliptic/Curve unmarshal fails", "body": "<p>You are trying to unmarshal the raw ASN.1 message, not the public key part.  You should first unmarshal the ASN.1 block, then unmarshal the EC data.</p>\n\n<p>I was wrong in my comment, Go doesn't support the Brainpool functions. So I borrowed some code from their X509 package to build a custom parser for the 6 curves in the Brainpool package.</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/i-Zd4mTugjU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/i-Zd4mTugjU</a></p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/ecdsa\"\n    \"crypto/elliptic\"\n    \"crypto/rand\"\n    \"crypto/sha256\"\n    \"crypto/x509/pkix\"\n    \"encoding/asn1\"\n    \"encoding/pem\"\n    \"errors\"\n    \"fmt\"\n    \"log\"\n    \"math/big\"\n\n    \"github.com/keybase/go-crypto/brainpool\"\n)\n\nconst ecKey = `-----BEGIN PUBLIC KEY-----\nMIGbMBQGByqGSM49AgEGCSskAwMCCAEBDQOBggAEM/zOLT7nMN374k902oTRZXnG\n97DPzvqi8QQJaKXcq1BSrU/sNeUhOi6Y+hBcr7ZE+WZDYNoQkaMNrdhF+3x1XGx7\nBTBFL3U1w2ENmkIPiDa2o0Q/wpSOLo/RFabdK5Q3/yvq0hoSdXlpKozE7UTre5cU\nbJcUzjXvs9KDLEq54Fs=\n-----END PUBLIC KEY-----`\n\nfunc main() {\n    block, _ := pem.Decode([]byte(ecKey))\n    if block == nil || block.Type != \"PUBLIC KEY\" {\n        log.Fatal(\"failed to decode PEM\")\n    }\n\n    pub, err := parseBrainpoolPKIXPublicKey(block.Bytes)\n    if err != nil {\n        log.Fatalf(\"failed to parse key: %v\", err)\n    }\n\n    pubb := ecdsa.PublicKey{Curve: brainpool.P512r1(), X: pub.X, Y: pub.Y}\n    priva, _ := ecdsa.GenerateKey(brainpool.P512r1(), rand.Reader)\n    b, _ := pubb.Curve.ScalarMult(pubb.X, pubb.Y, priva.D.Bytes())\n\n    shared1 := sha256.Sum256(b.Bytes())\n\n    fmt.Printf(\"\\nShared key %x\\n\", shared1)\n}\n\ntype publicKeyInfo struct {\n    Raw       asn1.RawContent\n    Algorithm pkix.AlgorithmIdentifier\n    PublicKey asn1.BitString\n}\n\ntype pkcs1PublicKey struct {\n    N *big.Int\n    E int\n}\n\nvar (\n    oidNamedCurveBrainpoolP256r1 = asn1.ObjectIdentifier{1, 3, 36, 3, 3, 2, 8, 1, 1, 7}\n    oidNamedCurveBrainpoolP256t1 = asn1.ObjectIdentifier{1, 3, 36, 3, 3, 2, 8, 1, 1, 8}\n    oidNamedCurveBrainpoolP384r1 = asn1.ObjectIdentifier{1, 3, 36, 3, 3, 2, 8, 1, 1, 11}\n    oidNamedCurveBrainpoolP384t1 = asn1.ObjectIdentifier{1, 3, 36, 3, 3, 2, 8, 1, 1, 12}\n    oidNamedCurveBrainpoolP512r1 = asn1.ObjectIdentifier{1, 3, 36, 3, 3, 2, 8, 1, 1, 13}\n    oidNamedCurveBrainpoolP512t1 = asn1.ObjectIdentifier{1, 3, 36, 3, 3, 2, 8, 1, 1, 14}\n)\n\nfunc parseBrainpoolPKIXPublicKey(derBytes []byte) (pub *ecdsa.PublicKey, err error) {\n    var pki publicKeyInfo\n    if rest, err := asn1.Unmarshal(derBytes, &amp;pki); err != nil {\n        if _, err := asn1.Unmarshal(derBytes, &amp;pkcs1PublicKey{}); err == nil {\n            return nil, errors.New(\"failed to parse public key\")\n        }\n        return nil, err\n    } else if len(rest) != 0 {\n        return nil, errors.New(\"trailing data after ASN.1 of public-key\")\n    }\n    if !pki.Algorithm.Algorithm.Equal(asn1.ObjectIdentifier{1, 2, 840, 10045, 2, 1}) {\n        return nil, errors.New(\"not an ECDSA public key\")\n    }\n    return parseBrainpoolPublicKey(&amp;pki)\n}\n\nfunc parseBrainpoolPublicKey(keyData *publicKeyInfo) (*ecdsa.PublicKey, error) {\n    asn1Data := keyData.PublicKey.RightAlign()\n    paramsData := keyData.Algorithm.Parameters.FullBytes\n    namedCurveOID := new(asn1.ObjectIdentifier)\n    rest, err := asn1.Unmarshal(paramsData, namedCurveOID)\n    if err != nil {\n        return nil, errors.New(\"failed to parse ECDSA parameters as named curve\")\n    }\n    if len(rest) != 0 {\n        return nil, errors.New(\"trailing data after ECDSA parameters\")\n    }\n    namedCurve := namedCurveFromOID(*namedCurveOID)\n    if namedCurve == nil {\n        return nil, errors.New(\"unsupported elliptic curve\")\n    }\n    x, y := elliptic.Unmarshal(namedCurve, asn1Data)\n    if x == nil {\n        return nil, errors.New(\"failed to unmarshal elliptic curve point\")\n    }\n    pub := &amp;ecdsa.PublicKey{\n        Curve: namedCurve,\n        X:     x,\n        Y:     y,\n    }\n    return pub, nil\n}\n\nfunc namedCurveFromOID(oid asn1.ObjectIdentifier) elliptic.Curve {\n    switch {\n    case oid.Equal(oidNamedCurveBrainpoolP256r1):\n        return brainpool.P256r1()\n    case oid.Equal(oidNamedCurveBrainpoolP256t1):\n        return brainpool.P256t1()\n    case oid.Equal(oidNamedCurveBrainpoolP384r1):\n        return brainpool.P384r1()\n    case oid.Equal(oidNamedCurveBrainpoolP384t1):\n        return brainpool.P384t1()\n    case oid.Equal(oidNamedCurveBrainpoolP512r1):\n        return brainpool.P512r1()\n    case oid.Equal(oidNamedCurveBrainpoolP512t1):\n        return brainpool.P512t1()\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 1091, "user_id": 4474629, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3d1d6e41980939611b75370816b8843?s=128&d=identicon&r=PG&f=1", "display_name": "Little Code", "link": "https://stackoverflow.com/users/4474629/little-code"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 433, "favorite_count": 0, "accepted_answer_id": 58316611, "answer_count": 1, "score": 1, "last_activity_date": 1571110939, "creation_date": 1570635587, "last_edit_date": 1570637200, "question_id": 58307704, "link": "https://stackoverflow.com/questions/58307704/ecdh-in-golang-elliptic-curve-unmarshal-fails", "title": "ECDH in golang - elliptic/Curve unmarshal fails", "body": "<p>Unfortunaltey there is no built-in brainpool support in <code>go</code> so I'm trying to get ECDH working with the help of a fork from <code>keybase</code>.</p>\n\n<p>Maybe I'm making a newbie mistake here but by code is falling at the first hurdle (i.e. <code>elliptic.Unmarshal</code> returns nil) ?</p>\n\n<pre><code>package main\n\nimport (\n \"fmt\"\n \"io/ioutil\"\n \"log\"\n\"encoding/pem\"\n\"crypto/ecdsa\"\n\"crypto/rand\"\n\"github.com/keybase/go-crypto/brainpool\"\n\"crypto/elliptic\"\n\"crypto/sha256\"\n)\n\nfunc main() {\nfmt.Println(\"Hello\")\ncontent, err := ioutil.ReadFile(\"/tmp/TEST.pem\")\n    if err != nil {\n        log.Fatal(err)\n    }\nfmt.Printf(\"File contents: %s\", content)\n\n    block, _ := pem.Decode(content)\n    if block == nil || block.Type != \"PUBLIC KEY\" {\n        log.Fatal(\"failed to decode PEM\")\n    }\n\nx,y := elliptic.Unmarshal(brainpool.P512r1(),block.Bytes)\nif x == nil {\n     log.Fatal(\"failed to unmarshal\")\n}\npubb := ecdsa.PublicKey {brainpool.P512r1(),x,y}\n\n\npriva, _ := ecdsa.GenerateKey(brainpool.P512r1(), rand.Reader)\nb, _ := pubb.Curve.ScalarMult(pubb.X, pubb.Y, priva.D.Bytes())\n\nshared1 := sha256.Sum256(b.Bytes())\n\nfmt.Printf(\"\\nShared key %x\\n\",  shared1)\n</code></pre>\n\n<p>Update to show the test key:</p>\n\n<pre><code>-----BEGIN PUBLIC KEY-----\nMIGbMBQGByqGSM49AgEGCSskAwMCCAEBDQOBggAEM/zOLT7nMN374k902oTRZXnG\n97DPzvqi8QQJaKXcq1BSrU/sNeUhOi6Y+hBcr7ZE+WZDYNoQkaMNrdhF+3x1XGx7\nBTBFL3U1w2ENmkIPiDa2o0Q/wpSOLo/RFabdK5Q3/yvq0hoSdXlpKozE7UTre5cU\nbJcUzjXvs9KDLEq54Fs=\n-----END PUBLIC KEY-----\n</code></pre>\n"}, {"tags": ["string", "pointers", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1570634307, "post_id": 58307302, "comment_id": 102976441, "body": "See possible duplicates: <a href=\"https://stackoverflow.com/questions/47352449/immutable-string-and-pointer-address/47352588#47352588\">Immutable string and pointer address</a>; and <a href=\"https://stackoverflow.com/questions/51249918/immutability-of-string-and-concurrency/51250031#51250031\">Immutability of string and concurrency</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1570636559, "post_id": 58307302, "comment_id": 102977678, "body": "<code>&amp;s1</code> is a pointer to the local variable <code>s1</code>. Every time you do <code>&amp;s1</code> you&#39;re going to get the same address because it&#39;s the same variable you&#39;re taking the address of."}], "answers": [{"comments": [{"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "edited": false, "score": 0, "creation_date": 1570634786, "post_id": 58307419, "comment_id": 102976679, "body": "Worth mentioning here that a <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">Type Assertion</a> was used to make sure we access args[0] as a string pointer."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1570634984, "post_id": 58307419, "comment_id": 102976800, "body": "Natski, see <a href=\"https://en.wikipedia.org/wiki/Pointer_(computer_programming)\" rel=\"nofollow noreferrer\">this</a> for more background\u2014it&#39;s a crucial thing to grasp."}, {"owner": {"reputation": 19555, "user_id": 2428549, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/P4lp0.jpg?s=128&g=1", "display_name": "natsuki_2002", "link": "https://stackoverflow.com/users/2428549/natsuki-2002"}, "edited": false, "score": 0, "creation_date": 1570635105, "post_id": 58307419, "comment_id": 102976866, "body": "Thank you for your responses and answer. I was following this blog post which does the same thing but with structs (it just seems to work): <a href=\"https://goinbigdata.com/golang-pass-by-pointer-vs-pass-by-value/\" rel=\"nofollow noreferrer\">goinbigdata.com/golang-pass-by-pointer-vs-pass-by-value</a>. Am I correct to assume that structs and strings are behaving differently between my example and the blog post?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 19555, "user_id": 2428549, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/P4lp0.jpg?s=128&g=1", "display_name": "natsuki_2002", "link": "https://stackoverflow.com/users/2428549/natsuki-2002"}, "edited": false, "score": 0, "creation_date": 1570638687, "post_id": 58307419, "comment_id": 102978676, "body": "@natsuki_2002 regarding the linked post, if you do <code>p = &amp;Person{firstName: &quot;Bob&quot;}</code> you get the same outcome as with the string pointer, so in this respect there&#39;s no difference between structs and strings. However the <i>selector</i> expression <code>s.f</code> is something different, here <code>s</code> can be a pointer to a struct and the language will still allow you to access the field <code>f</code> without having to first dereference the pointer, e.g. you don&#39;t have to do <code>(*s).f</code>, that&#39;s done automatically. <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">more here</a>"}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 5, "last_activity_date": 1570634614, "creation_date": 1570634614, "answer_id": 58307419, "question_id": 58307302, "link": "https://stackoverflow.com/questions/58307302/mutate-a-string-in-golang/58307419#58307419", "title": "Mutate a string in Golang?", "body": "<p><code>args[0] = &amp;s2</code></p>\n\n<p>This does nothing outside of <code>MockScan</code>. You're changing what <code>args[0]</code> points to, you're not changing <em>the thing pointed to by <code>args[0]</code></em>.</p>\n\n<p>You want to do something like</p>\n\n<pre><code>func MockScan(args ...interface{}) {\n    // In real life, there would be some logic here to figure out what\n    // kind of pointer we're dealing with, or some error handling to\n    // handle the case where the user didn't pass a *string\n    dst := args[0].(*string)\n    *dst = \"A new value\"\n}\n\nfunc main() {\n    var s1 string = \"An old value\"\n    fmt.Println(s1)\n    MockScan(&amp;s1)\n    fmt.Println(s1)\n}\n</code></pre>\n\n<p>Note that if we printed <code>&amp;s1</code> in main before and after the call, it <em>still wouldn't change</em>. It's still the same variable, it's still at the same address. We've passed a pointer, <code>&amp;s1</code> into <code>MockScan</code>, so that <code>MockScan</code> can use that pointer to write a value into <code>s1</code>.</p>\n"}], "owner": {"reputation": 19555, "user_id": 2428549, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/P4lp0.jpg?s=128&g=1", "display_name": "natsuki_2002", "link": "https://stackoverflow.com/users/2428549/natsuki-2002"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 0, "accepted_answer_id": 58307419, "answer_count": 1, "score": 0, "last_activity_date": 1590791241, "creation_date": 1570634147, "last_edit_date": 1590791241, "question_id": 58307302, "link": "https://stackoverflow.com/questions/58307302/mutate-a-string-in-golang", "title": "Mutate a string in Golang?", "body": "<p>For testing purposes, I'm trying to mock the <a href=\"https://golang.org/pkg/database/sql/#Rows.Scan\" rel=\"nofollow noreferrer\">Rows.Scan</a> method from the <code>database/sql</code> library. The signature looks like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (r *Rows) Scan(dest ...interface{}) error\n</code></pre>\n\n<p>Many examples of how to use this show that you pass a pointer to a string (for example) to the Scan method and it will assign the value through the pointer.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var name string\nrows.Scan(&amp;name)\n</code></pre>\n\n<p>I've been trying to recreate something similar for my own understanding and eventually for mocking but it is not working.</p>\n\n<pre><code>func MockScan(args ...interface{}) {\n    var s2 string\n    fmt.Println(args[0])\n    args[0] = &amp;s2\n    fmt.Println(args[0])\n}\n\nfunc main() {\n    var s1 string\n    fmt.Println(&amp;s1)\n    MockScan(&amp;s1)\n    fmt.Println(&amp;s1)\n}\n</code></pre>\n\n<p>Results in:</p>\n\n<pre><code>0xc000012950\n0xc000012950\n0xc000012960\n0xc000012950\n</code></pre>\n\n<p>Where my initial string never takes on its new value. I understand that strings are immutable (although my true understanding of this concept is a little shakey) but somehow the actual <code>Rows.Scan</code> method manages to mutate the string.</p>\n"}, {"tags": ["json", "dictionary", "parsing", "go"], "comments": [{"owner": {"reputation": 143, "user_id": 9955131, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155750291782956/picture?type=large", "display_name": "Shide Foo", "link": "https://stackoverflow.com/users/9955131/shide-foo"}, "edited": false, "score": 1, "creation_date": 1570634402, "post_id": 58307298, "comment_id": 102976489, "body": "seems like &quot;58&quot; is a string and not an int64 as specified by <code>Count</code>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1570634930, "post_id": 58307298, "comment_id": 102976772, "body": "go doc encoding/json.Number"}, {"owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "edited": false, "score": 0, "creation_date": 1570646223, "post_id": 58307298, "comment_id": 102982120, "body": "The downvotes strike me as rather harsh: Given that <code>,string</code> exists, this seems like something that could potentially work, and there&#39;s <a href=\"https://stackoverflow.com/q/49415573/5085211\">a similarly fair question on how to do this with slices</a> instead of maps."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 12189512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46775e7c89650d733c090547a450ef15?s=128&d=identicon&r=PG&f=1", "display_name": "Pradip Biswas", "link": "https://stackoverflow.com/users/12189512/pradip-biswas"}, "edited": false, "score": 0, "creation_date": 1570636239, "post_id": 58307369, "comment_id": 102977497, "body": "Thanks. Yes, changing the struct seems to be the way to go."}], "tags": [], "owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "is_accepted": false, "score": 1, "last_activity_date": 1570634726, "last_edit_date": 1570634726, "creation_date": 1570634415, "answer_id": 58307369, "question_id": 58307298, "link": "https://stackoverflow.com/questions/58307298/issues-in-go-with-json-unmarshal-of-mapstringint64/58307369#58307369", "title": "Issues in Go with JSON unmarshal of map[string]int64", "body": "<p>As you've noted yourself, this is happening because you are not passing in the JSON integer <code>58</code>, but a JSON string <code>\"58\"</code>.</p>\n\n<p>If you modify your example input to</p>\n\n<pre><code>s := `{\"count\":{\"FAN\":58}}`\n</code></pre>\n\n<p>then your code <a href=\"https://play.golang.org/p/TZvLgvXDjfZ\" rel=\"nofollow noreferrer\">works as expected</a>.</p>\n\n<p>You could write a custom unmarshaller, but fixing the issue while unmarshalling might not be what you want; rather find a way to modify your data pipeline and ensure that the JSON object is sanitized properly. Or, if that's impossible, do as you suggest yourself and use a <code>map[string]string</code> instead, then fix up the data types after unmashalling.</p>\n"}], "owner": {"reputation": 1, "user_id": 12189512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46775e7c89650d733c090547a450ef15?s=128&d=identicon&r=PG&f=1", "display_name": "Pradip Biswas", "link": "https://stackoverflow.com/users/12189512/pradip-biswas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1570634726, "creation_date": 1570634128, "last_edit_date": 1570634249, "question_id": 58307298, "link": "https://stackoverflow.com/questions/58307298/issues-in-go-with-json-unmarshal-of-mapstringint64", "title": "Issues in Go with JSON unmarshal of map[string]int64", "body": "<p>I am having issue with JSON unmarshal to a Go structure. Visibly the source of the issue is understable - a string is coming for the int64, except that I am not finding ways to solve it without changing the datatype of Count to map[string]string. I saw similar discussions on SO, but they didn't help much. Here is a representative code and the issue. Please suggest how I can get through.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Product struct {\n    Count  map[string]int64 `json:\",string\"`\n}\n\nfunc main() {\n    s := `{\"count\":{\"FAN\":\"58\"}}`\n\n    var pro Product\n    err := json.Unmarshal([]byte(s), &amp;pro)\n    if err == nil {\n        fmt.Printf(\"%+v\\n\", pro)\n    } else {\n        fmt.Println(err)\n        fmt.Printf(\"%+v\\n\", pro)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<blockquote>\n  <p>json: cannot unmarshal string into Go struct field Product.Count of type int64\n  {Count:map[FAN:0]}</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 6, "creation_date": 1570632053, "post_id": 58306649, "comment_id": 102975186, "body": "Remove the <code>go</code> keyword. You can&#39;t launch a goroutine to not wait for it to complete <i>and</i> wait for it to complete (to examine the result) at the same time. If you do want concurrent execution, use a channel to communicate the result."}, {"owner": {"reputation": 895, "user_id": 5117502, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/3af1c137fcafdd6975f358e1fb43ca4c?s=128&d=identicon&r=PG&f=1", "display_name": "Jay266", "link": "https://stackoverflow.com/users/5117502/jay266"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1570632655, "post_id": 58306649, "comment_id": 102975537, "body": "Could you add an example for how this would work with a channel @icza ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570633051, "post_id": 58306649, "comment_id": 102975765, "body": "You can wrap the code into an anon func and execute that in a new goroutine <a href=\"https://play.golang.com/p/8Buh9wEM3hM\" rel=\"nofollow noreferrer\">play.golang.com/p/8Buh9wEM3hM</a>."}], "answers": [{"tags": [], "owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "is_accepted": false, "score": 3, "last_activity_date": 1570635876, "last_edit_date": 1570635876, "creation_date": 1570633010, "answer_id": 58306981, "question_id": 58306649, "link": "https://stackoverflow.com/questions/58306649/how-to-return-values-in-a-goroutine/58306981#58306981", "title": "how to return values in a goroutine", "body": "<p>If you want to wait until a go-routine has completed, you need to return results in a channel.  The basic pattern, without complicating with wait groups, etc. is:</p>\n\n<pre><code>func myFunc() {\n    // make a channel to receive errors\n    errChan := make(chan error)\n\n    // launch a go routine\n    go doSomething(myVar, errChan)\n\n    // block until something received on the error channel\n    if err := &lt;- errChan; err != nil {\n        // something bad happened\n    }\n}\n\n// your async funciton\nfunc doSomething(myVar interface{}, errChan chan error) {\n    // Do stuff\n    if something, err := someOtherFunc(myVar); err != nil {\n         errChan &lt;- err\n         return\n    }\n\n    // all good - send nil to the error channel\n    errChan &lt;- nil\n\n}\n</code></pre>\n\n<p>In your case if you just want to fire off a go-routine and log if an error happens, you can use an anonymous function:</p>\n\n<pre><code>go func() {\n    if ok, err := s.addItemSync(ch, cs.ResponseQueue, user); !ok {\n        if err != nil {\n            log.Log.Error(\"Error adding channel\", zap.Error(err))\n        }\n    }\n}()\n</code></pre>\n\n<p>Or if you want to wait for the result:</p>\n\n<pre><code>errChan := make(chan error)\ngo func() {\n    if ok, err := s.addItemSync(ch, cs.ResponseQueue, user); !ok {\n        if err != nil {\n            errChan &lt;- err\n            return\n        }\n    }\n    errChan &lt;- nil\n}()\n\n// do some other stuff while we wait...\n\n// block until go routine returns\nif err := &lt;- errChan; err != nil {\n    log.Log.Error(\"Error adding channel\", zap.Error(err))\n}\n</code></pre>\n\n<p><strong>Note:</strong>\nYour code as written, may have unexpected results if it is possible that a response where <code>ok == false</code> would not return an error.  If this is a concern, I would suggest creating and returning a new error for cases where <code>!ok &amp;&amp; err == nil</code></p>\n"}], "owner": {"reputation": 895, "user_id": 5117502, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/3af1c137fcafdd6975f358e1fb43ca4c?s=128&d=identicon&r=PG&f=1", "display_name": "Jay266", "link": "https://stackoverflow.com/users/5117502/jay266"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1570635876, "creation_date": 1570631929, "last_edit_date": 1570632297, "question_id": 58306649, "link": "https://stackoverflow.com/questions/58306649/how-to-return-values-in-a-goroutine", "title": "how to return values in a goroutine", "body": "<p>I have the code:</p>\n\n<pre><code>    go s.addItemSync(ch, cs.ResponseQueue, user)\n</code></pre>\n\n<p>This calls the func:</p>\n\n<pre><code>func (s *Services) addItemSync(ch types.ChannelInsertion, statusQueueName, user string) {\n   //func body here\n}\n</code></pre>\n\n<p>I would however like to do this:</p>\n\n<pre><code>if ok, err := go s.addItemSync(ch, cs.ResponseQueue, user); !ok {\n    if err != nil {\n        log.Log.Error(\"Error adding channel\", zap.Error(err))\n        return\n}\n</code></pre>\n\n<p>Which would change the other func to this</p>\n\n<pre><code>func (s *Services) addItemSync(ch types.ChannelInsertion, statusQueueName, user string) (bool, error) {\n\n}\n</code></pre>\n\n<p>As in, I would like to be able to declare a <code>go func</code> but this errors out every time. Any idea how you can declare a variable while able to call the <code>go func</code> ability for synchronous calls? as seen in the     <code>if ok, err := go s.addItemSync(ch, cs.ResponseQueue, user); !ok {</code> line?</p>\n"}, {"tags": ["go", "environment-variables", "go-modules"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1570629899, "post_id": 58305567, "comment_id": 102973927, "body": "<code>man $(basename $SHELL)</code>"}, {"owner": {"reputation": 795, "user_id": 4297035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/my4fZ.jpg?s=128&g=1", "display_name": "Soroush", "link": "https://stackoverflow.com/users/4297035/soroush"}, "edited": false, "score": 2, "creation_date": 1583166756, "post_id": 58305567, "comment_id": 107016110, "body": "There&#39;s a <i>go help</i> for that: <code>go help module-private</code>"}, {"owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "edited": false, "score": 0, "creation_date": 1598240738, "post_id": 58305567, "comment_id": 112382964, "body": "Or just to make live easier, <code>export GOPRIVATE=*</code>"}, {"owner": {"reputation": 15140, "user_id": 1126971, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/738f6908cdcc3651abf6293370c59f97?s=128&d=identicon&r=PG", "display_name": "John Smith Optional", "link": "https://stackoverflow.com/users/1126971/john-smith-optional"}, "edited": false, "score": 0, "creation_date": 1615734329, "post_id": 58305567, "comment_id": 117777336, "body": "That&#39;s an excellent question."}], "answers": [{"comments": [{"owner": {"reputation": 2778, "user_id": 4704510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WBcGH.jpg?s=128&g=1", "display_name": "UsamaAmjad", "link": "https://stackoverflow.com/users/4704510/usamaamjad"}, "edited": false, "score": 2, "creation_date": 1570634504, "post_id": 58306008, "comment_id": 102976542, "body": "Thanks! Working now so the trick was to use wildcard url with organization name. <code>go env -w GOPRIVATE=github.com&#47;{OrgNameHere}&#47;*</code>"}, {"owner": {"reputation": 17696, "user_id": 84118, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/49489bce90d3514596cb1ed0ead0d0db?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/84118/jay"}, "edited": false, "score": 0, "creation_date": 1598240771, "post_id": 58306008, "comment_id": 112382970, "body": "Probably easier for people who code primarily with private code <code>export GOPRIVATE=*</code>"}, {"owner": {"reputation": 7804, "user_id": 34372, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/433f1fe3d3df1054ded10f69cd60d2b4?s=128&d=identicon&r=PG", "display_name": "Dean Schulze", "link": "https://stackoverflow.com/users/34372/dean-schulze"}, "edited": false, "score": 1, "creation_date": 1599517919, "post_id": 58306008, "comment_id": 112792446, "body": "Using <code>export GOPRIVATE=*</code> assigns all file names in the current directory to GOPRIVATE, which isn&#39;t what you want."}, {"owner": {"reputation": 15140, "user_id": 1126971, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/738f6908cdcc3651abf6293370c59f97?s=128&d=identicon&r=PG", "display_name": "John Smith Optional", "link": "https://stackoverflow.com/users/1126971/john-smith-optional"}, "edited": false, "score": 0, "creation_date": 1615734513, "post_id": 58306008, "comment_id": 117777390, "body": "That is an excellent answer. Thank you for that answer. I liked that answer."}, {"owner": {"reputation": 15140, "user_id": 1126971, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/738f6908cdcc3651abf6293370c59f97?s=128&d=identicon&r=PG", "display_name": "John Smith Optional", "link": "https://stackoverflow.com/users/1126971/john-smith-optional"}, "edited": false, "score": 0, "creation_date": 1615734552, "post_id": 58306008, "comment_id": 117777400, "body": "I still like that answer even now and will probably continue to like it for a long time. Maybe years."}], "tags": [], "owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "is_accepted": true, "score": 77, "last_activity_date": 1585340479, "last_edit_date": 1592644375, "creation_date": 1570629901, "answer_id": 58306008, "question_id": 58305567, "link": "https://stackoverflow.com/questions/58305567/how-to-set-goprivate-environment-variable/58306008#58306008", "title": "How to set GOPRIVATE environment variable", "body": "<h3>Short Answer:</h3>\n<pre class=\"lang-sh prettyprint-override\"><code>go env -w GOPRIVATE=github.com/repoURL/private-repo\n</code></pre>\n<p><strong>OR</strong></p>\n<p>If you want to allow all private repos from your organization</p>\n<pre class=\"lang-sh prettyprint-override\"><code>go env -w GOPRIVATE=github.com/&lt;OrgNameHere&gt;/*\n</code></pre>\n<hr />\n<h3>Long Answer:</h3>\n<p>Check <a href=\"https://tip.golang.org/cmd/go/#hdr-Module_configuration_for_non_public_modules\" rel=\"noreferrer\">&quot;Module configuration for non-public modules&quot;</a> for more information:</p>\n<blockquote>\n<p>The GOPRIVATE environment variable controls which modules the go command considers to be private (not available publicly) and should therefore not use the proxy or checksum database. The variable is a comma-separated list of glob patterns (in the syntax of Go's path.Match) of module path prefixes. For example,</p>\n<pre><code> GOPRIVATE=*.corp.example.com,rsc.io/private\n</code></pre>\n<p>causes the go command to treat as private any module with a path prefix matching either pattern, including git.corp.example.com/xyzzy, rsc.io/private, and rsc.io/private/quux.</p>\n</blockquote>\n<p>.\n.</p>\n<blockquote>\n<p>The 'go env -w' command (see 'go help env') can be used to set these variables for future go command invocations.</p>\n</blockquote>\n<hr />\n<h3>Note on the usage of ssh:</h3>\n<p>If you use <strong>ssh</strong> to access git repo (locally hosted), you might want to add the following to your <code>~/.gitconfig</code>:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>[url &quot;ssh://git@git.local.intranet/&quot;]\n       insteadOf = https://git.local.intranet/\n</code></pre>\n<p>for the <code>go</code> commands to be able to access the git server.</p>\n"}, {"tags": [], "owner": {"reputation": 185, "user_id": 7658539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/957914d94e8c65015282b977a637da98?s=128&d=identicon&r=PG&f=1", "display_name": "JFW", "link": "https://stackoverflow.com/users/7658539/jfw"}, "is_accepted": false, "score": 5, "last_activity_date": 1594381003, "creation_date": 1594381003, "answer_id": 62833461, "question_id": 58305567, "link": "https://stackoverflow.com/questions/58305567/how-to-set-goprivate-environment-variable/62833461#62833461", "title": "How to set GOPRIVATE environment variable", "body": "<p>Just a follow up on the usage of ssh, this is the command used to get it working:</p>\n<p>GitHub:</p>\n<pre><code>git config --global url.&quot;git@github.com:&quot;.insteadOf &quot;https://github.com/&quot;\n</code></pre>\n<p>Bitbucket:</p>\n<pre><code>git config --global url.&quot;git@bitbucket.org:&quot;.insteadOf &quot;https://bitbucket.org/&quot;\n</code></pre>\n"}], "owner": {"reputation": 2778, "user_id": 4704510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WBcGH.jpg?s=128&g=1", "display_name": "UsamaAmjad", "link": "https://stackoverflow.com/users/4704510/usamaamjad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33789, "favorite_count": 24, "accepted_answer_id": 58306008, "answer_count": 2, "score": 46, "last_activity_date": 1594381003, "creation_date": 1570628528, "last_edit_date": 1586245744, "question_id": 58305567, "link": "https://stackoverflow.com/questions/58305567/how-to-set-goprivate-environment-variable", "title": "How to set GOPRIVATE environment variable", "body": "<p>I started working on a <code>Go</code> project and it uses some private modules from Github private repos and whenever I try to run <code>go run main.go</code> it gives me a below <code>410 Gone</code> error:</p>\n\n<blockquote>\n  <p>verifying github.com/repoURL/go-proto@v2.86.0+incompatible/go.mod: github.com/repoURL/go-proto@v2.86.0+incompatible/go.mod: reading <a href=\"https://sum.golang.org/lookup/github.com/!repoURL/go-proto@v2.86.0+incompatible\" rel=\"noreferrer\">https://sum.golang.org/lookup/github.com/!repoURL/go-proto@v2.86.0+incompatible</a>: 410 Gone</p>\n</blockquote>\n\n<p>I can easily clone private repo from terminal which means my <code>ssh</code> keys are configured correctly. I read <a href=\"https://tip.golang.org/cmd/go/#hdr-Module_configuration_for_non_public_modules\" rel=\"noreferrer\">here</a> that I need to set <code>GOPRIVATE</code> environment variable but I am not sure how to do that.</p>\n\n<p>Can anyone answer or point to the relevant tutorial?</p>\n\n<p><strong>Go:</strong> v1.13, <strong>OS:</strong> macOS Mojave</p>\n"}, {"tags": ["go", "go-gorm", "go-sqlite3"], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 5036616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064e95e6a156cbf991ff5a815bec3e01?s=128&d=identicon&r=PG&f=1", "display_name": "riccardo_92", "link": "https://stackoverflow.com/users/5036616/riccardo-92"}, "edited": false, "score": 0, "creation_date": 1570692344, "post_id": 58316980, "comment_id": 102994866, "body": "Both <code>--tags</code> and <code>--flags</code> with any of the values <code>sqlite_json</code>, <code>sqlite_json1</code> and <code>json1</code> still produce a build with the same errors.  Strangely enough, doing it directly in the C amalgamation does work, ie: <code>#define SQLITE_ENABLE_JSON1 1</code> in <code>sqlite3-binding.c</code> and running <code>go build -a</code> in the <code>src</code> directory."}], "tags": [], "owner": {"reputation": 13086, "user_id": 1431239, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/e0085b2fdc60b5c84310fa29529a6648?s=128&d=identicon&r=PG", "display_name": "Mike Mackintosh", "link": "https://stackoverflow.com/users/1431239/mike-mackintosh"}, "is_accepted": false, "score": 0, "last_activity_date": 1570690010, "creation_date": 1570690010, "answer_id": 58316980, "question_id": 58303609, "link": "https://stackoverflow.com/questions/58303609/json1-support-go-sqlite3-using-gorm/58316980#58316980", "title": "JSON1 support go-sqlite3 using gorm", "body": "<p>According to <code>go-sqlite3</code>'s docs, any of the following flags will work:</p>\n\n<ul>\n<li><code>sqlite_json</code> </li>\n<li><code>sqlite_json1</code></li>\n<li><code>json1</code></li>\n</ul>\n\n<p>Here is the contents of <code>sqlite3_opt.json1.go</code> which define the tags that include this file.</p>\n\n<pre><code>// Copyright (C) 2014 Yasuhiro Matsumoto &lt;mattn.jp@gmail.com&gt;.\n//\n// Use of this source code is governed by an MIT-style\n// license that can be found in the LICENSE file.\n\n// +build sqlite_json sqlite_json1 json1\n\npackage sqlite3\n\n/*\n#cgo CFLAGS: -DSQLITE_ENABLE_JSON1\n*/\nimport \"C\"\n</code></pre>\n\n<p>Reference: <a href=\"https://github.com/mattn/go-sqlite3/blob/master/sqlite3_opt_json1.go\" rel=\"nofollow noreferrer\">https://github.com/mattn/go-sqlite3/blob/master/sqlite3_opt_json1.go</a></p>\n\n<p>Also to point out, you're using <code>--flags</code> in your <code>go build</code> command, but give <code>--tags</code> a try instead.</p>\n"}], "owner": {"reputation": 67, "user_id": 5036616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064e95e6a156cbf991ff5a815bec3e01?s=128&d=identicon&r=PG&f=1", "display_name": "riccardo_92", "link": "https://stackoverflow.com/users/5036616/riccardo-92"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 586, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570751226, "creation_date": 1570622225, "last_edit_date": 1570751226, "question_id": 58303609, "link": "https://stackoverflow.com/questions/58303609/json1-support-go-sqlite3-using-gorm", "title": "JSON1 support go-sqlite3 using gorm", "body": "<p>In the following example I use <code>json_extract(...)</code> using the <code>go-sqlite3</code> driver in Golang.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>package main\n\nimport (\n    _ \"github.com/mattn/go-sqlite3\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n    \"fmt\"\n    \"encoding/json\"\n    \"net/http\"\n)\n\nfunc main() {\n\n    var db *gorm.DB\n\n    type Session struct {\n        gorm.Model\n        SessionID string `json:\"session_id\"`\n        Options string `json:\"options\"`\n    }\n\n    db, err := gorm.Open(\"sqlite3\", \"./app.db\")\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    defer db.Close() \n    db.AutoMigrate(&amp;Session{})\n\n    var m map[string]int\n    m = make(map[string]int)\n    m[\"a\"] = 1\n    m[\"b\"] = 2\n    m[\"c\"] = 3\n\n    js, err := json.Marshal(m)\n\n    sess := Session{\n        SessionID: \"test\",\n        Options: string(js),\n    }\n\n    db.Create(&amp;sess)\n    db.Save(&amp;sess)\n\n    var b = &amp;Session{}\n\n    type Result struct {\n        Options string\n    }\n\n    // JSON test\n    var res Result\n    db.Raw(\"SELECT json_extract(options, '$.a') as Options from sessions\").Scan(&amp;res)\n\n    fmt.Println(sess.ID)\n    fmt.Println(res)\n\n}\n</code></pre>\n\n<p>The problem is that I cannot get the JSON1 module to be activated when rebuilding the <code>go-sqlite3</code> driver. It will error <code>undefined function: json_extract</code> on the <code>db.Raw(...)</code> line.</p>\n\n<p>In any case, I know that for JSON support, <code>github.com/mattn/go-sqlite3</code> has to be compiled with <code>-flags \"sqlite_json1\"</code>. I've tried several variations:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go build -a -flags \"sqlite_json1\"  github.com/mattn/go-sqlite3\ngo install -a -flags \"sqlite_json1\"  github.com/mattn/go-sqlite3\ngo build -a --flags \"sqlite_json1\"  github.com/mattn/go-sqlite3\ngo install -a --flags \"sqlite_json1\"  github.com/mattn/go-sqlite3\n</code></pre>\n\n<p>and more variations in <code>flags</code>, such as <code>sqlite_json</code>, <code>json</code>, <code>json1</code>, etc. Nothing will get rid of the undefined function error. Any ideas how to properly rebuild <code>go-sqlite3</code>?</p>\n\n<p>Obviously I rebuild my own code after that as well.</p>\n\n<hr>\n\n<p>Some info:</p>\n\n<p>go version: <code>go version go1.13.1 linux/amd64</code> (platform: Kubuntu 18.04)</p>\n\n<p>go-sqlite3 version: github.com/mattn/go-sqlite3 current master</p>\n\n<p>gorm version: github.com/jinzhu/gorm current master</p>\n"}, {"tags": ["go", "interface", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570617186, "post_id": 58302137, "comment_id": 102966807, "body": "I&#39;m not sure I understood your question, but if you have problems implementing the <code>Scan</code> method, then that&#39;s because you&#39;re using a non-pointer receiver."}, {"owner": {"reputation": 197, "user_id": 6213176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5524a528bd15219e53c4ad75e1408bcd?s=128&d=identicon&r=PG&f=1", "display_name": "Noobie", "link": "https://stackoverflow.com/users/6213176/noobie"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570617809, "post_id": 58302137, "comment_id": 102967081, "body": "Thanks for the correction... the question was when I perform <code>DB.Create(&amp;record)</code>  unless the Scanner interface is implemented <code>start_date</code> and <code>end_date</code> both appear (in the above case) as NULL in DB. If I implemented the Scanner interface I see the correct value in the DB.   The Question is I don&#39;t need Scanner interface. Since the project just dump record in DB .. not reading anything back from DB."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570625959, "post_id": 58302137, "comment_id": 102971546, "body": "Your question is confusing. But the title seems straight forward. <code>sql.Scanner</code> and <code>driver.Valuer</code> are two sides of the same coin, analogous to <code>json.Unmarshaler</code> and <code>json.Marshaler</code>. That is to say, <code>sql.Scanner</code> is used when reading a value from the database, and <code>driver.Valuer</code> is used when writing a value to the database. Whether you need both depends on whether you need to both read and write data to the database."}, {"owner": {"reputation": 197, "user_id": 6213176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5524a528bd15219e53c4ad75e1408bcd?s=128&d=identicon&r=PG&f=1", "display_name": "Noobie", "link": "https://stackoverflow.com/users/6213176/noobie"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570627814, "post_id": 58302137, "comment_id": 102972703, "body": "@Flimzy, here is the thing.. If you can run the above code 2 time. 1 time without Scan method and 2 time with Scan method you would see that only the last inserted record would have value <code>2019-05-29</code> in the <code>start_date</code> column. That is my question.."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1570795470, "post_id": 58302137, "comment_id": 103036972, "body": "I still don&#39;t know what you&#39;re asking. I&#39;ve answered the title in a comment. The rest of your question seems unrelated to the title. I gather you&#39;re having trouble inserting data? All that matters for that (per my comment above) is the <code>Valuer</code> interface. But you haven&#39;t included the relevant code, so it&#39;s hard to tell why it&#39;s not working."}], "answers": [{"comments": [{"owner": {"reputation": 197, "user_id": 6213176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5524a528bd15219e53c4ad75e1408bcd?s=128&d=identicon&r=PG&f=1", "display_name": "Noobie", "link": "https://stackoverflow.com/users/6213176/noobie"}, "edited": false, "score": 0, "creation_date": 1570933177, "post_id": 58344443, "comment_id": 103072408, "body": "Thanks for the answer but I believe we still haven&#39;t address the real question. The question that <b>why do I need to implement Scanner interface</b> to insert the record in DB (my project does not deal with reading data from database).   If I <b>do not</b> implement the Scanner interface. The record in DB goes are nil.   On hindsight if you write a <i>bare dummy</i> <b>Scan() function with <code>return nil</code> that works.</b>  And you would see the DB contain the correct value inside of NULL. As I had explained in my question."}, {"owner": {"reputation": 197, "user_id": 6213176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5524a528bd15219e53c4ad75e1408bcd?s=128&d=identicon&r=PG&f=1", "display_name": "Noobie", "link": "https://stackoverflow.com/users/6213176/noobie"}, "edited": false, "score": 0, "creation_date": 1571022131, "post_id": 58344443, "comment_id": 103089103, "body": "?? any thought on the comment?"}, {"owner": {"reputation": 197, "user_id": 6213176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5524a528bd15219e53c4ad75e1408bcd?s=128&d=identicon&r=PG&f=1", "display_name": "Noobie", "link": "https://stackoverflow.com/users/6213176/noobie"}, "edited": false, "score": 0, "creation_date": 1571204509, "post_id": 58344443, "comment_id": 103157084, "body": "any clue on this?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 197, "user_id": 6213176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5524a528bd15219e53c4ad75e1408bcd?s=128&d=identicon&r=PG&f=1", "display_name": "Noobie", "link": "https://stackoverflow.com/users/6213176/noobie"}, "edited": false, "score": 0, "creation_date": 1571217035, "post_id": 58344443, "comment_id": 103163055, "body": "<code>why do I need to implement Scanner interface</code> someone has to read gorm source code to check if it asserts the value type to scannable before inserting data."}, {"owner": {"reputation": 197, "user_id": 6213176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5524a528bd15219e53c4ad75e1408bcd?s=128&d=identicon&r=PG&f=1", "display_name": "Noobie", "link": "https://stackoverflow.com/users/6213176/noobie"}, "edited": false, "score": 0, "creation_date": 1571219320, "post_id": 58344443, "comment_id": 103164340, "body": "Yes tried reading it mostly callback .. stuff.. I don&#39;t have a proper doc somewhere explaining the how gorm internally work."}, {"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1571298791, "post_id": 58344443, "comment_id": 103196260, "body": "It&#39;s all on github. &quot;Use the source&quot; :)"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571299668, "post_id": 58344443, "comment_id": 103196704, "body": "it is also a very important skill."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1571299810, "post_id": 58344443, "comment_id": 103196769, "body": "see the last answer"}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 1, "last_activity_date": 1570870176, "last_edit_date": 1570870176, "creation_date": 1570807909, "answer_id": 58344443, "question_id": 58302137, "link": "https://stackoverflow.com/questions/58302137/is-it-necessay-to-implement-scanner-interface-along-with-valuer-interface/58344443#58344443", "title": "is it necessay to implement Scanner interface along with Valuer interface", "body": "<p>Pre: I ran <code>go get -u github.com/jinzhu/gorm</code>. I will use <code>sqlite</code> instead of <code>pgsql</code>. fyi, <code>go version go1.12.7 linux/amd64</code></p>\n\n<ol>\n<li><p>your annotations are not using the correct syntax. The gorm-property-value pair's separator is <strong>not</strong> the <code>comma</code>, but the <code>semi-colon</code>. <a href=\"https://github.com/jinzhu/gorm/blob/master/model_struct.go#L644\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm/blob/master/model_struct.go#L644</a></p></li>\n<li><p>The implementation of <code>Date.Scan()</code> must use a pointer receiver, otherwise you loose the updated value. <a href=\"https://github.com/jinzhu/gorm/blob/0fd395ab37aefd2d50854f0556a4311dccc6f45a/scaner_test.go#L57\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm/blob/0fd395ab37aefd2d50854f0556a4311dccc6f45a/scaner_test.go#L57</a></p></li>\n<li><p>during my tests, <code>Scan</code> method received a <code>time.Time</code>, thus no need of <code>nil</code> case, nor <code>string</code> case (might be a matter of db driver). However, <strong>and more importantly</strong>, i added a <code>default</code> case to catch for unsupported types.</p></li>\n<li><p>The <code>Scan</code> method is involved during the assignation of the data read from the database to the objects you provided. Commenting it has nothing to do with the missing date issue you demonstrated in your last sql results copy-paste. I think this is somehow related to the previously mentioned issues i wrote about.</p></li>\n<li><p>I listened all errors to ensure things were working as expected.</p></li>\n</ol>\n\n<p>Here is my test code, </p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql/driver\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"time\"\n\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n)\n\nvar DB *gorm.DB\n\ntype CustomerBroker struct {\n    gorm.Model\n    StartDate Date `gorm:\"type:date;column:start_date\" json:\"start_date\"`\n    EndDate   Date `gorm:\"type:date;column:end_date\" json:\"end_date\"`\n}\n\ntype Date struct {\n    time.Time\n}\n\nfunc (d *Date) UnmarshalJSON(b []byte) (err error) {\n    if b[0] == '\"' &amp;&amp; b[len(b)-1] == '\"' {\n        b = b[1 : len(b)-1]\n    }\n\n    // take care of null..\n    if len(b) == 0 || string(b) == \"null\" {\n        d.Time = time.Time{}\n        return\n    }\n\n    d.Time, err = time.Parse(\"2006-01-02\", string(b))\n    return\n}\n\nfunc (d *Date) Scan(b interface{}) (err error) {\n    switch x := b.(type) {\n    case time.Time:\n        d.Time = x\n  default:\n    err = fmt.Errorf(\"unsupported scan type %T\", b)\n    }\n    return\n}\n\nfunc (d Date) Value() (driver.Value, error) {\n    // check if the date was not set..\n    if d.Time.IsZero() {\n        return nil, nil\n    }\n    return d.Time.Format(\"2006-01-02\"), nil\n}\n\nfunc main() {\n    var dberr error\n    DB, dberr = gorm.Open(\"sqlite3\", \":memory:\")\n    if dberr != nil {\n        panic(dberr)\n    }\n    defer DB.Close()\n    record := CustomerBroker{}\n    errs := DB.CreateTable(record).GetErrors()\n    fmt.Println(\"create error \", errs)\n    data := []byte(`{\"start_date\": \"2019-05-29\", \"end_date\": null}`)\n    err := json.Unmarshal(data, &amp;record)\n    fmt.Println(\"unmarshal error \", err)\n    log.Printf(\"record start %v end %v\\n\", record.StartDate, record.EndDate)\n    errs = DB.Create(&amp;record).GetErrors()\n    fmt.Println(\"insert error \", errs)\n    all := []CustomerBroker{}\n    errs = DB.Find(&amp;all).GetErrors()\n    fmt.Println(\"find error \", errs)\n    log.Printf(\"records count %v\\n\", len(all))\n    for _, a := range all {\n        log.Printf(\"found start %v end %v\\n\", a.StartDate, a.EndDate)\n    }\n}\n</code></pre>\n\n<p>Outputs :</p>\n\n<pre><code>$ go run main.go \ncreate error  []\nunmarshal error  &lt;nil&gt;\n2019/10/11 17:22:51 record start 2019-05-29 00:00:00 +0000 UTC end 0001-01-01 00:00:00 +0000 UTC\ninsert error  []\nfind error  []\n2019/10/11 17:22:51 records count 1\n2019/10/11 17:22:51 found start 2019-05-29 00:00:00 +0000 UTC end 0001-01-01 00:00:00 +0000 UTC\n</code></pre>\n\n<p>If you find a different behavior when running this against <code>pqsql</code>, please share the corresponding docker image so future attempts can occur against the same version.</p>\n"}, {"comments": [{"owner": {"reputation": 197, "user_id": 6213176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5524a528bd15219e53c4ad75e1408bcd?s=128&d=identicon&r=PG&f=1", "display_name": "Noobie", "link": "https://stackoverflow.com/users/6213176/noobie"}, "edited": false, "score": 0, "creation_date": 1571311431, "post_id": 58413611, "comment_id": 103203461, "body": "@frerorubigd this seem like a legit answer to me.. but I&#39;ll cross check the code.. give me some time."}], "tags": [], "owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "is_accepted": true, "score": 2, "last_activity_date": 1571230468, "last_edit_date": 1571230468, "creation_date": 1571229778, "answer_id": 58413611, "question_id": 58302137, "link": "https://stackoverflow.com/questions/58302137/is-it-necessay-to-implement-scanner-interface-along-with-valuer-interface/58413611#58413611", "title": "is it necessay to implement Scanner interface along with Valuer interface", "body": "<p>Enabling the <code>DB.LogMode(true)</code> shows these two queries</p>\n\n<p>with scan:  </p>\n\n<pre><code>[2019-10-16 14:03:34]  [0.97ms]  INSERT  INTO \"custom_brokers\" (\"created_at\",\"updated_at\",\"deleted_at\",\"start_date\",\"end_date\") VALUES ('2019-10-16 14:03:34','2019-10-16 14:03:34',NULL,'2019-05-29',NULL) RETURNING \"custom_brokers\".\"id\"\n</code></pre>\n\n<p>without scan: </p>\n\n<pre><code>[2019-10-16 14:02:53]  [0.76ms]  INSERT  INTO \"custom_brokers\" (\"created_at\",\"updated_at\",\"deleted_at\") VALUES ('2019-10-16 14:02:53','2019-10-16 14:02:53',NULL) RETURNING \"custom_brokers\".\"id\"\n</code></pre>\n\n<p>the second one shows that the gorm completely ignores the other column in the model (except for embeded gorm model) </p>\n\n<p>After debuging it, I reaized on model creation, <a href=\"https://github.com/jinzhu/gorm/blob/ac78f05986ab456936afd148e629533d8d819289/model_struct.go#L219-L231\" rel=\"nofollow noreferrer\">here</a>, gorm checks if the field is <code>sql.Scanner</code> and then set the <code>IsNormal</code> field, which is used in query creation phase. if the field is not a <code>sql.Scanner</code>, the <code>IsNormal</code> is false so it's ignored <a href=\"https://github.com/jinzhu/gorm/blob/712c4655605f094d283047501ae613db9c798850/callback_create.go#L62\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>so, the answer to your question is yes, you have to implement a <code>Scan</code> method even if you don't need to scan it. </p>\n"}], "owner": {"reputation": 197, "user_id": 6213176, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5524a528bd15219e53c4ad75e1408bcd?s=128&d=identicon&r=PG&f=1", "display_name": "Noobie", "link": "https://stackoverflow.com/users/6213176/noobie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1510, "favorite_count": 1, "accepted_answer_id": 58413611, "answer_count": 2, "score": 0, "last_activity_date": 1571230468, "creation_date": 1570616942, "last_edit_date": 1570795340, "question_id": 58302137, "link": "https://stackoverflow.com/questions/58302137/is-it-necessay-to-implement-scanner-interface-along-with-valuer-interface", "title": "is it necessay to implement Scanner interface along with Valuer interface", "body": "<p>I'm working on requirement wherein I receive a JSON object which contains a date value as a string. My task is to store the Date object in the DB.</p>\n\n<p>Something of this sort:</p>\n\n<pre><code>{\"start_date\": \"2019-05-29\", \"end_date\": \"2019-08-30\"}\n{\"start_date\": \"2019-05-29\", \"end_date\": null}\n</code></pre>\n\n<p>I have implemented the Custom <code>Date</code> type </p>\n\n<pre><code>type Date struct {\n    time.Time\n}\n</code></pre>\n\n<p>I have implemented UnmarshalJSON interface</p>\n\n<pre><code>func (d *Date) UnmarshalJSON(b []byte) (err error) {\n    if b[0] == '\"' &amp;&amp; b[len(b)-1] == '\"' {\n        b = b[1 : len(b)-1]\n    }\n\n    // take care of null..\n    if len(b) == 0 || string(b) == \"null\" {\n        d.Time = time.Time{}\n        return\n    }\n\n    d.Time, err = time.Parse(\"2006-01-02\", string(b))\n    return\n}\n</code></pre>\n\n<p>also implemented the Valuer interface to return the Value to the sql.Driver.</p>\n\n<pre><code>func (d Date) Value() (driver.Value, error) {\n    // check if the date was not set..\n    if d.Time.IsZero() {\n        return nil, nil\n    }\n    return d.Time.Format(\"2006-01-02\"), nil\n}\n</code></pre>\n\n<p>But for some reason, <strong>until</strong> the Date implement the Scanner interface,\nsomething like this:</p>\n\n<pre><code>func (d Date) Scan(b interface{}) (err error) {\n    ...\n    return\n}\n</code></pre>\n\n<p>Question:</p>\n\n<p>The ORM adapter (GORM) does not store the record in the DB. Any clue?</p>\n\n<p>Full code listed <a href=\"https://gist.github.com/meetme2meat/2ff1004baef56a18b87de0e415ba43a2\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>To further elaborate..</p>\n\n<p>If I run the above code 2 twice I see a different behaviour depending upon whether of not the Scan() function exist.</p>\n\n<p><strong>1 time :</strong>\ndatabase result </p>\n\n<pre><code>repl_test=# select id, start_date from customer_brokers;\n id | start_date\n----+------------\n  1 | 2019-05-29\n\n</code></pre>\n\n<p>All good now.. run the same code.. (commented the <code>Scan()</code> function)</p>\n\n<p><strong>2nd time.</strong></p>\n\n<pre><code>repl_test=# select id, start_date from customer_brokers;\n id | start_date\n----+------------\n  1 | 2019-05-29\n  2 |             &lt;- start_date empty here..\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1570616029, "post_id": 58301766, "comment_id": 102966201, "body": "go doc math/big.Rat.Abs"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1570616113, "post_id": 58301766, "comment_id": 102966238, "body": "Well, all functions on Rat, Nat, Float in Big work the same way and allow reusing existing variables to reuse their allocated memory."}, {"owner": {"reputation": 4609, "user_id": 1699956, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oBr6e.jpg?s=128&g=1", "display_name": "Mangat Rai Modi", "link": "https://stackoverflow.com/users/1699956/mangat-rai-modi"}, "edited": false, "score": 1, "creation_date": 1570616116, "post_id": 58301766, "comment_id": 102966242, "body": "I think the question is valid. May be he needs rephrase it to - &quot;Why do go takes an argument to Abs(), when it has the value with the receiver&quot;"}, {"owner": {"reputation": 3635, "user_id": 440621, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/0ace3707d59b250045159a8493d8a6ea?s=128&d=identicon&r=PG", "display_name": "Akhil K Nambiar", "link": "https://stackoverflow.com/users/440621/akhil-k-nambiar"}, "reply_to_user": {"reputation": 4609, "user_id": 1699956, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oBr6e.jpg?s=128&g=1", "display_name": "Mangat Rai Modi", "link": "https://stackoverflow.com/users/1699956/mangat-rai-modi"}, "edited": false, "score": 0, "creation_date": 1570616205, "post_id": 58301766, "comment_id": 102966285, "body": "@MangatRaiModi yes exactly. I find that bit weird coming from Java."}, {"owner": {"reputation": 4609, "user_id": 1699956, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oBr6e.jpg?s=128&g=1", "display_name": "Mangat Rai Modi", "link": "https://stackoverflow.com/users/1699956/mangat-rai-modi"}, "edited": false, "score": 0, "creation_date": 1570616334, "post_id": 58301766, "comment_id": 102966344, "body": "I guess just setting <code>z.a.neg = false</code> should be enough in <a href=\"https://golang.org/src/math/big/rat.go?s=9365:9395#L349\" rel=\"nofollow noreferrer\">golang.org/src/math/big/rat.go?s=9365:9395#L349</a>."}, {"owner": {"reputation": 3635, "user_id": 440621, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/0ace3707d59b250045159a8493d8a6ea?s=128&d=identicon&r=PG", "display_name": "Akhil K Nambiar", "link": "https://stackoverflow.com/users/440621/akhil-k-nambiar"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1570616340, "post_id": 58301766, "comment_id": 102966349, "body": "@Volker I read the docs. But since value already available why does it need another parameter. Doesn&#39;t it make code less readable. if I write like a.Abs(b) what does it return. Abs of A or of B."}, {"owner": {"reputation": 4609, "user_id": 1699956, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oBr6e.jpg?s=128&g=1", "display_name": "Mangat Rai Modi", "link": "https://stackoverflow.com/users/1699956/mangat-rai-modi"}, "edited": false, "score": 1, "creation_date": 1570616433, "post_id": 58301766, "comment_id": 102966397, "body": "@AkhilKNambiar it returns Abs of B, but mutates A to contain that. This is to save memory. I guess better functions would have been A.Abs(), A.Set(B)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1570617713, "post_id": 58301766, "comment_id": 102967041, "body": "All functions have the same type of signature. This is for consistency and to reduce allocations and there is nothing more to say."}], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 2, "last_activity_date": 1570625880, "creation_date": 1570625880, "answer_id": 58304694, "question_id": 58301766, "link": "https://stackoverflow.com/questions/58301766/use-big-rat-with-go-to-get-abs-value/58304694#58304694", "title": "Use big.Rat with Go to get Abs() value", "body": "<p>Go's <code>big</code> package is concerned with memory allocation when it comes to its function signatures. A <code>big.Rat</code> consists of two <code>big.Int</code>s which each contain an array of <code>uint</code>s. Unlike an <code>int</code> (native 32 or 64 bit integer), a <code>big.Int</code> must thus be allocated dynamically, depending on its value. For large values this means more elements in the array.</p>\n\n<p>Your proposed function signature <code>n.Abs()</code> would mean that a new array of the same size as <code>n</code>'s would have to be allocated for this operation. In reality we often have the case that the original <code>n</code> is no longer needed, thus we can reuse its existing memory. To allow this, the <code>Abs</code> function takes a pointer to an existing <code>big.Rat</code> which might be <code>n</code> itself. The implementation can now reuse the memory. The caller is now in full control of what memory to use for these operations.</p>\n\n<p>This might not make the nicest API for all use cases, in fact if you just want to do a quick calculation for a few large numbers, on a computer with Gigabytes of RAM, you might have preferred the <code>n.Abs()</code> version, but if you do numerically expensive computations with a lot of large numbers, you must be able to control your memory. Imagine doing some image manipulation on a Raspberry for example, where you are more constraint by the available memory. In this case the existing API allows you to be more efficient.</p>\n"}], "owner": {"reputation": 3635, "user_id": 440621, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/0ace3707d59b250045159a8493d8a6ea?s=128&d=identicon&r=PG", "display_name": "Akhil K Nambiar", "link": "https://stackoverflow.com/users/440621/akhil-k-nambiar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1570625880, "creation_date": 1570615641, "question_id": 58301766, "link": "https://stackoverflow.com/questions/58301766/use-big-rat-with-go-to-get-abs-value", "title": "Use big.Rat with Go to get Abs() value", "body": "<p>I am a beginner with Go and a java developer.\nI am currently working with big.Rat.</p>\n\n<p>I need to get the <code>Abs</code> of a Rat <strong>n</strong> for which I have to write something like </p>\n\n<p><code>n.Abs(n)</code> or something like <code>big.Rat{}.Abs(n)</code></p>\n\n<p>Why didn't go provide something like just <code>n.Abs()</code>?\nOr am I going wrong somewhere?</p>\n"}, {"tags": ["mongodb", "go", "bson", "mgo", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 99, "user_id": 8503984, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2x9ia.png?s=128&g=1", "display_name": "Malikiah", "link": "https://stackoverflow.com/users/8503984/malikiah"}, "edited": false, "score": 0, "creation_date": 1570618916, "post_id": 58301782, "comment_id": 102967653, "body": "So I was using primitive before and I switched because I saw everyone using this. but This is the issue I run into using the primitive.ObjectIDFromHex(request.FormValue(&quot;_id&quot;)) ``` multiple-value primitive.ObjectIDFromHex() in single-value context ```"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 99, "user_id": 8503984, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2x9ia.png?s=128&g=1", "display_name": "Malikiah", "link": "https://stackoverflow.com/users/8503984/malikiah"}, "edited": false, "score": 0, "creation_date": 1570619089, "post_id": 58301782, "comment_id": 102967733, "body": "@Malikiah See <a href=\"https://stackoverflow.com/questions/28227095/multiple-values-in-single-value-context/28233172#28233172\">Multiple values in single-value context</a>. See edited answer."}, {"owner": {"reputation": 99, "user_id": 8503984, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2x9ia.png?s=128&g=1", "display_name": "Malikiah", "link": "https://stackoverflow.com/users/8503984/malikiah"}, "edited": false, "score": 0, "creation_date": 1570619326, "post_id": 58301782, "comment_id": 102967845, "body": "Yeah, Think It needs to be like this ``` objectID, _ := primitive.ObjectIDFromHex(request.FormValue(&quot;_id&quot;)) ```"}, {"owner": {"reputation": 99, "user_id": 8503984, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2x9ia.png?s=128&g=1", "display_name": "Malikiah", "link": "https://stackoverflow.com/users/8503984/malikiah"}, "edited": false, "score": 0, "creation_date": 1570619487, "post_id": 58301782, "comment_id": 102967930, "body": "So now I am getting this error from my query result.... &quot;cannot decode invalid into a string type&quot; not sure what is happening now D:"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 99, "user_id": 8503984, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2x9ia.png?s=128&g=1", "display_name": "Malikiah", "link": "https://stackoverflow.com/users/8503984/malikiah"}, "edited": false, "score": 0, "creation_date": 1570621408, "post_id": 58301782, "comment_id": 102969009, "body": "@Malikiah I don&#39;t see your actual code now, but the one you posted in the question mixes <code>mgo</code> and <code>mongo-go</code> (the official driver). Be sure you don&#39;t do that."}, {"owner": {"reputation": 99, "user_id": 8503984, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2x9ia.png?s=128&g=1", "display_name": "Malikiah", "link": "https://stackoverflow.com/users/8503984/malikiah"}, "edited": false, "score": 0, "creation_date": 1570622131, "post_id": 58301782, "comment_id": 102969399, "body": "I changed it to only use the import of &quot;go.mongodb.org/mongo-driver/bson/primitive&quot; and it now comes back as an ObjectID(), which is correct. but maybe I dont understand what I should be doing for the decoding of the mongodb document result on my Find function."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 99, "user_id": 8503984, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2x9ia.png?s=128&g=1", "display_name": "Malikiah", "link": "https://stackoverflow.com/users/8503984/malikiah"}, "edited": false, "score": 0, "creation_date": 1570622243, "post_id": 58301782, "comment_id": 102969461, "body": "@Malikiah The problem seems to be that you try to decode into <code>result</code>, which is a <code>string</code>. Query returns documents, which may be decoded into <code>struct</code>s for example. You can&#39;t decode a document into a <code>string</code>."}, {"owner": {"reputation": 99, "user_id": 8503984, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2x9ia.png?s=128&g=1", "display_name": "Malikiah", "link": "https://stackoverflow.com/users/8503984/malikiah"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1570622853, "post_id": 58301782, "comment_id": 102969781, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/200603/discussion-between-malikiah-and-icza\">continue this discussion in chat</a>."}, {"owner": {"reputation": 99, "user_id": 8503984, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2x9ia.png?s=128&g=1", "display_name": "Malikiah", "link": "https://stackoverflow.com/users/8503984/malikiah"}, "edited": false, "score": 0, "creation_date": 1570622973, "post_id": 58301782, "comment_id": 102969855, "body": "Any idea where I can get more information on decoding into this and what I can and cant decode to?"}, {"owner": {"reputation": 99, "user_id": 8503984, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2x9ia.png?s=128&g=1", "display_name": "Malikiah", "link": "https://stackoverflow.com/users/8503984/malikiah"}, "edited": false, "score": 0, "creation_date": 1570623094, "post_id": 58301782, "comment_id": 102969925, "body": "Are you saying I should make a struct and then decode this information to a specific struct?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1570619081, "last_edit_date": 1570619081, "creation_date": 1570615687, "answer_id": 58301782, "question_id": 58301536, "link": "https://stackoverflow.com/questions/58301536/mgo-is-setting-objectid-to-objectidhex-which-doesnt-seem-to-get-read-by-mongodb/58301782#58301782", "title": "mgo is setting objectid to objectidhex, which doesnt seem to get read by Mongodb", "body": "<p>Note that <code>labix.org/v2/mgo</code> is not maintained anymore, if you want to use <code>mgo</code>, use <code>github.com/globalsign/mgo</code> instead. Or the new, official <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">mongo-go driver</a>.</p>\n\n<p><a href=\"https://godoc.org/github.com/globalsign/mgo/bson#ObjectId\" rel=\"nofollow noreferrer\"><code>bson.ObjectId</code></a> is a type having <code>string</code> as its underlying type:</p>\n\n<pre><code>type ObjectId string\n</code></pre>\n\n<p>So when you fill your object like this:</p>\n\n<pre><code>databaseQuery := databasestructs.Find{\n    ID: bson.ObjectId(request.FormValue(\"_id\")),\n    MongoCollection: \"users\",\n    Criteria: \"_id\",\n    CriteriaValue: \"\",\n    FindAll: false,\n}\n</code></pre>\n\n<p><code>bson.ObjectId(request.FormValue(\"_id\"))</code> is \"nothing more\" then a type <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a>. You convert the hex object ID string to <code>bson.ObjectId</code>, but this is <strong>not</strong> what you want. You want to <em>parse</em> the hex object ID. For that, use the <a href=\"https://godoc.org/github.com/globalsign/mgo/bson#ObjectIdHex\" rel=\"nofollow noreferrer\"><code>bson.ObjectIdHex()</code></a> <strong>function</strong>:</p>\n\n<pre><code>databaseQuery := databasestructs.Find{\n    ID: bson.ObjectIdHex(request.FormValue(\"_id\")),\n    MongoCollection: \"users\",\n    Criteria: \"_id\",\n    CriteriaValue: \"\",\n    FindAll: false,\n}\n</code></pre>\n\n<p>Note that <code>bson.ObjectIdHex()</code> will panic if the passed string is an invalid hex object ID. Use <a href=\"https://godoc.org/github.com/globalsign/mgo/bson#IsObjectIdHex\" rel=\"nofollow noreferrer\"><code>bson.IsObjectIdHex()</code></a> to check it prior to calling <code>bson.ObjectId()</code>. For details, see <a href=\"https://stackoverflow.com/questions/53701764/prevent-runtime-panic-in-bson-objectidhex/53701933#53701933\">Prevent runtime panic in bson.ObjectIdHex</a>.</p>\n\n<p>If you would use the official driver instead of <code>mgo</code>, you could use <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson/primitive#ObjectIDFromHex\" rel=\"nofollow noreferrer\"><code>primitive.ObjectIDFromHex()</code></a> function to create the <code>ObjectId</code>, e.g.:</p>\n\n<pre><code>id, err := primitive.ObjectIDFromHex(request.FormValue(\"_id\"))\nif err != nil {\n    // Handle error\n    return\n}\n// If no error, you may use it:\ndatabaseQuery := databasestructs.Find{\n    ID: id,\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 99, "user_id": 8503984, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2x9ia.png?s=128&g=1", "display_name": "Malikiah", "link": "https://stackoverflow.com/users/8503984/malikiah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 719, "favorite_count": 0, "accepted_answer_id": 58301782, "answer_count": 1, "score": 2, "last_activity_date": 1570619081, "creation_date": 1570614834, "last_edit_date": 1570616209, "question_id": 58301536, "link": "https://stackoverflow.com/questions/58301536/mgo-is-setting-objectid-to-objectidhex-which-doesnt-seem-to-get-read-by-mongodb", "title": "mgo is setting objectid to objectidhex, which doesnt seem to get read by Mongodb", "body": "<p>I am trying to make a query using the ObjectId, and normally in mongodb you would do something like this</p>\n\n<pre><code>db.collection.findOne({\"_id\":objectid(\"5d9d90e5ed645489aae6df64\")})\n</code></pre>\n\n<p>Which this works when I do a normal query but in go lang it gives it the value of </p>\n\n<pre><code>ObjectIdHex(\"5d9d90e5ed645489aae6df64\")\n</code></pre>\n\n<p>instead which does not lead to a valid query.</p>\n\n<p>i have read through the mgo documentation many times trying to use</p>\n\n<pre><code>bson.ObjectId(\"5d9d90e5ed645489aae6df64\")\n</code></pre>\n\n<p>but it still makes it a hex which I don't understand. I have tried a few different combination of things with no like they were pretty much just shots in the dark.</p>\n\n<p>Go Lang Handlers</p>\n\n<pre><code>package userhandlers\n\nimport (\n    \"log\"\n    \"net/http\"\n    //\"fmt\"\n    //\"go.mongodb.org/mongo-driver/bson/primitive\"\n    //\"go.mongodb.org/mongo-driver/bson\"\n    \"labix.org/v2/mgo/bson\"\n\n    //Services\n    databaseservice \"malikiah.io/services/databaseService\"\n    passwordservice \"malikiah.io/services/passwordService\"\n\n    //Structs\n    userstructs \"malikiah.io/structs/userStructs\"\n    databasestructs \"malikiah.io/structs/databaseStructs\"\n)\n\nfunc LoginHandler(response http.ResponseWriter, request *http.Request) {\n    response.Header().Set(\"Content-Type\", \"application/json\")\n    response.WriteHeader(http.StatusOK)\n\n    databaseQuery := databasestructs.Find{\n        ID: bson.ObjectId(request.FormValue(\"_id\")),\n        MongoCollection: \"users\",\n        Criteria: \"_id\",\n        CriteriaValue: \"\",\n        FindAll: false,\n    }\n    log.Println(databaseQuery)\n    databaseservice.Login(databaseQuery)\n}\n</code></pre>\n\n<p>Go Lang Structs</p>\n\n<pre><code>package databasestructs\n\nimport (\n    //\"go.mongodb.org/mongo-driver/bson/primitive\"\n    \"labix.org/v2/mgo/bson\"\n)\n\ntype Find struct {\n    ID                      bson.ObjectId   `json:\"_id,omitempty\" bson:\"_id,omitempty\"`\n    MongoCollection         string              `json:\"mongoCollection,omitempty\" bson:\"mongoCollection,omitempty\"`\n    Criteria                string              `json:\"criteria,omitempty\" bson:\"criteria,omitempty\"`\n    CriteriaValue           string              `json:\"criteriaValue,omitempty\" bson:\"criteriaValue,omitempty\"`\n    FindAll                 bool                `json:\"findAll,omitempty\" bson:\"findAll,omitempty\"`\n}\n\n</code></pre>\n\n<p>Go Lang Functions</p>\n\n<pre><code>package databaseservice\n\nimport (\n    \"context\"\n    \"log\"\n\n    //Structs\n    userstructs \"malikiah.io/structs/userStructs\"\n    databasestructs \"malikiah.io/structs/databaseStructs\"\n\n    //\"go.mongodb.org/mongo-driver/bson\"\n    \"go.mongodb.org/mongo-driver/mongo\"\n    \"go.mongodb.org/mongo-driver/mongo/options\"\n    \"gopkg.in/mgo.v2/bson\"\n\n)\n\nfunc Find(databaseQuery databasestructs.Find) (result string) {\n    // Set client options\n    clientOptions := options.Client().ApplyURI(\"mongodb://localhost:27017\")\n\n    // Connect to MongoDB\n    client, err := mongo.Connect(context.TODO(), clientOptions)\n\n    // Database name\n    db := client.Database(\"malikiah\")\n    collection := db.Collection(databaseQuery.MongoCollection)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if databaseQuery.Criteria == \"_id\" {\n        log.Println(databaseQuery.ID)\n        result := collection.FindOne(context.TODO(), bson.M{databaseQuery.Criteria: databaseQuery.ID}).Decode(&amp;result)\n        log.Println(result)\n    } else if databaseQuery.Criteria == \"\" {\n\n    } else if databaseQuery.FindAll == true {\n\n    } else {\n\n    }\n    return\n}\n</code></pre>\n"}, {"tags": ["go", "type-conversion", "math.sqrt"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570613068, "post_id": 58300933, "comment_id": 102964532, "body": "Why are you using ints?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570613096, "post_id": 58300933, "comment_id": 102964548, "body": "Just off the cuff, this seems easier to read, and probably more accurate: <code>if float(i) &lt; math.Sqrt(float64(n))</code> (certainly one doesn&#39;t have to wonder why <code>math.Ceil</code> was used, and if it&#39;s appropriate). Then you could also do <code>for i := 2.0; i &lt; math.Sqrt(float64(n)); {</code>, unless you really need i to be an int for some reason."}, {"owner": {"reputation": 353, "user_id": 6111733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fQ9mJ.jpg?s=128&g=1", "display_name": "cryptograthor", "link": "https://stackoverflow.com/users/6111733/cryptograthor"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570614040, "post_id": 58300933, "comment_id": 102965107, "body": "Hmm. Perhaps because later I was intending to do some modular arithmetic, and then I\u2019d just be converting to ints for the arithmetic."}], "owner": {"reputation": 353, "user_id": 6111733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fQ9mJ.jpg?s=128&g=1", "display_name": "cryptograthor", "link": "https://stackoverflow.com/users/6111733/cryptograthor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1570676183, "creation_date": 1570612902, "last_edit_date": 1570613017, "question_id": 58300933, "link": "https://stackoverflow.com/questions/58300933/whats-the-best-way-to-take-the-square-root-of-an-int", "title": "What&#39;s the best way to take the square root of an int?", "body": "<p>I ended up writing this recently to get around a problem that math.sqrt deals in floats:</p>\n\n<pre><code>for i := 2; i &lt; int(math.Ceil(math.Sqrt(float64(n)))); {\n</code></pre>\n\n<p>I had to look away from the editor while doing it, but it worked. \nIf a wandering helpful Gopher happens across this, what should I do instead? </p>\n\n<p>(Context: was doing a quick prime factoring algorithm for a project euler problem.)</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "aws-code-deploy", "aws-codepipeline"], "answers": [{"tags": [], "owner": {"reputation": 5018, "user_id": 12072431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Svf7M.png?s=128&g=1", "display_name": "shariqmaws", "link": "https://stackoverflow.com/users/12072431/shariqmaws"}, "is_accepted": false, "score": 1, "last_activity_date": 1570620992, "creation_date": 1570620992, "answer_id": 58303249, "question_id": 58300554, "link": "https://stackoverflow.com/questions/58300554/cannot-build-and-deploy-go-lambda-using-aws-codepipeline-bundletype-must-be-ei/58303249#58303249", "title": "Cannot build and deploy Go Lambda using AWS CodePipeline - BundleType must be either YAML or JSON", "body": "<p>The problem you are facing is well known when connecting CodePipeline with CodeDeploy for Lambda deployment as CodeDeploy is looking for a Yaml or Json appspec file whereas the artifact presented by CodePipeline is a zip file containing the appspec:</p>\n\n<ul>\n<li><a href=\"https://forums.aws.amazon.com/thread.jspa?messageID=864336\" rel=\"nofollow noreferrer\">https://forums.aws.amazon.com/thread.jspa?messageID=864336</a></li>\n<li><a href=\"https://stackoverflow.com/questions/53136089/codepipeline-codedeploy-reports-bundletype-must-be-either-yaml-or-json\">CodePipeline: CodeDeploy reports &quot;BundleType must be either YAML or JSON&quot;</a></li>\n</ul>\n\n<p>For now, you can use CloudFormation as a Deployment tool for your Lambda function in your Pipeline. The basic idea to deploy a Lambda function will be as follows:</p>\n\n<ol>\n<li><p>Create a a SAM template of your Lambda function</p></li>\n<li><p>A basic SAM template looks like:</p>\n\n<pre><code>AWSTemplateFormatVersion: '2010-09-09'\nTransform: 'AWS::Serverless-2016-10-31'\nResources:\n    FunctionName:\n        Type: 'AWS::Serverless::Function'\n        Properties:\n            Handler: index.handler\n            Runtime: nodejs6.10\n            CodeUri: ./code\n</code></pre></li>\n<li><p>Add a directory \"code\" and keep the lambda code files in this directory</p></li>\n<li><p>Run the command to package and upload: </p>\n\n<pre><code>$ aws cloudformation package --template-file template.yaml --output-template packaged.yaml --s3-bucket {your_S3_bucket}\n</code></pre></li>\n<li><p>Deploy the package:</p>\n\n<pre><code>$ aws cloudformation deploy --template-file packaged.yaml --stack-name stk1 --capabilities CAPABILITY_IAM\n</code></pre></li>\n</ol>\n\n<p>You can keep the Template Code (Step1-2) in CodeCommit/Github and do the Step4 in a CodeBuild Step. For Step5, I recommend to do it via a CloudFormation action in CodePipeline that is fed the \"packaged.yaml\" file as input artifact.</p>\n\n<p>The above process is detailed here: <a href=\"https://docs.aws.amazon.com/en_us/lambda/latest/dg/build-pipeline.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/en_us/lambda/latest/dg/build-pipeline.html</a></p>\n"}], "owner": {"reputation": 1564, "user_id": 1317697, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/IUndO.png?s=128&g=1", "display_name": "Bram Vandewalle", "link": "https://stackoverflow.com/users/1317697/bram-vandewalle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 538, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570620992, "creation_date": 1570611685, "question_id": 58300554, "link": "https://stackoverflow.com/questions/58300554/cannot-build-and-deploy-go-lambda-using-aws-codepipeline-bundletype-must-be-ei", "title": "Cannot build and deploy Go Lambda using AWS CodePipeline - BundleType must be either YAML or JSON", "body": "<p>I am trying to build the most simple of Lambda functions in Go using AWS CodePipeline. Despite playing with it for about 2 weeks I still haven't managed to get it deployed.</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n\n    \"github.com/aws/aws-lambda-go/lambda\"\n)\n\nfunc HandleRequest(ctx context.Context) (string, error) {\n    return \"Hello from Go!\", nil\n}\n\nfunc main() {\n    lambda.Start(HandleRequest)\n}\n</code></pre>\n\n<p><strong>buildspec.yml</strong></p>\n\n<pre><code>version: 0.2\n\nenv:\n  variables:\n    S3_BUCKET: dlp-queuetime\n    PACKAGE: dlp-queuetime-fetcher\n\nphases:\n  install: \n    runtime-versions:\n      golang: 1.12\n    commands:\n      # AWS Codebuild Go images use /go for the $GOPATH so copy the src code into that dir structure\n      - mkdir -p \"/go/src/$(dirname ${PACKAGE})\"\n      - ln -s \"${CODEBUILD_SRC_DIR}\" \"/go/src/${PACKAGE}\"\n      # Print all environment variables (handy for AWS CodeBuild logs)\n      - env\n      # Install Lambda Go\n      - go get github.com/aws/aws-lambda-go/lambda\n  pre_build:\n    commands:\n      # Make sure we're in the project directory within our GOPATH\n      - cd \"/go/src/${PACKAGE}\"\n      # Fetch all dependencies\n      - go get -t ./...\n  build:\n    commands:\n      # Build our Go app\n      - go build -o main\n  post_build:\n    commands:\n      - echo Build completed on `date`\nartifacts:\n  type: zip\n  files:\n    - appspec.yml\n    - main\n</code></pre>\n\n<p><strong>appspec.yml</strong></p>\n\n<pre><code>version: 0.0\nResources:\n  - dlpQueueTimeFetcher:\n      Type: AWS::Lambda::Function\n      Properties:\n        Name: \"dlpQueueTimeFetcher\"\n        Alias: \"v0\"\n        CurrentVersion: \"1\"\n        TargetVersion: \"2\"\n</code></pre>\n\n<p>During the deployment CodeDeploy throws the following error: <em>Action execution failed - <strong>BundleType must be either YAML or JSON</em></strong>.</p>\n\n<p>It seems like CodeDeploy cannot find my <code>appspec.yml</code> file despite it being defined in the <code>artifacts</code> sections of my buildspec. What am I doing wrong here?</p>\n"}, {"tags": ["go", "interface", "embedding"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1570610800, "post_id": 58299791, "comment_id": 102963292, "body": "Your question is very broad. Embedding is nice syntactic sugar to make a composite and expose the method of the embedded type on the one embedding it. If this is an appropriate data model of your domain then this is fine. If not, then it is not. There is nothing &quot;idiomatic&quot; here. It either fits or doesn&#39;t. If GameDetails does not bring lots of method directly exposed on each Game it probably is not a good approach. If it is, it is. The String method of your OnlineGame &quot;breaks&quot; the clean embedding a bit. If this is the exception: It is fine."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1570611180, "post_id": 58299791, "comment_id": 102963494, "body": "Take a look at how <code>testing.T</code> and <code>testing.B</code> both embed <code>common</code>. This works nicely as both <code>T</code> and <code>B</code> can delegate a set of work to a <code>common</code> living inside them. This is not inheritance. Especially your example is not &quot;inheritance like&quot;. You model polymorphism via a <code>Game</code> interface. Different implementations of <code>Game</code> hand several methods to a standalone <code>GameDetails</code>. To me this looks fine; at least if you do not have to reimplement lots if embedded methods on the embedding type."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 1, "creation_date": 1570611798, "post_id": 58299791, "comment_id": 102963833, "body": "Just a tip: I really wouldn&#39;t use a pointer receiver on my <code>String</code> functions. Those funcs will never modify the actual value anyway, and using value receivers make the types safe for concurrent use. With a pointer receiver, there&#39;s a chance of simultaneous write/read access to occur."}, {"owner": {"reputation": 15, "user_id": 10904897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b467e89eb951dc8e68e0f2a8ba0b30b?s=128&d=identicon&r=PG&f=1", "display_name": "John Fitzgerald", "link": "https://stackoverflow.com/users/10904897/john-fitzgerald"}, "edited": false, "score": 0, "creation_date": 1570611811, "post_id": 58299791, "comment_id": 102963840, "body": "OnlineGame breaks it because it wants to print its own details, is there a better way? I&#39;ll take a look at the testing package, thanks for that!"}, {"owner": {"reputation": 15, "user_id": 10904897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b467e89eb951dc8e68e0f2a8ba0b30b?s=128&d=identicon&r=PG&f=1", "display_name": "John Fitzgerald", "link": "https://stackoverflow.com/users/10904897/john-fitzgerald"}, "edited": false, "score": 0, "creation_date": 1570611846, "post_id": 58299791, "comment_id": 102963864, "body": "Yes Elias, I&#39;m aware but it&#39;s better to keep the receiver types consistent. Tax method needs to have a pointer receiver."}], "owner": {"reputation": 15, "user_id": 10904897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b467e89eb951dc8e68e0f2a8ba0b30b?s=128&d=identicon&r=PG&f=1", "display_name": "John Fitzgerald", "link": "https://stackoverflow.com/users/10904897/john-fitzgerald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1570613799, "creation_date": 1570608994, "last_edit_date": 1570613799, "question_id": 58299791, "link": "https://stackoverflow.com/questions/58299791/what-is-the-idiomatic-way-of-embedding-in-go-unlike-classical-oop", "title": "What is the idiomatic way of embedding in Go (unlike classical-OOP)?", "body": "<p>I'm creating an e-commerce store and want to find out the most idiomatic way to structure my types.</p>\n\n<p>I'm embedding the Game type because the other game types almost have the same set of fields and methods.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type GameDetails struct {\n  Title string\n  Price int\n}\n\nfunc (g *GameDetails) String() string {\n  return g.Title\n}\n\nfunc (g *GameDetails) Tax(ratio float64) {\n  g.Price = float64(g.Price) * ratio\n}\n\n// other Game methods...\n\ntype BoardGame struct {\n  GameDetails\n}\n\ntype OnlineGame struct {\n  GameDetails\n}\n\ntype VideoGame struct {\n  GameDetails\n  Genre string\n}\n\nfunc (g *OnlineGame) String() string {\n  return g.Title +\", \"+ g.Genre\n}\n</code></pre>\n\n<p>I'm representing the games in an interface so I can use them together:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Game interface {\n  String() string\n  Tax(ratio float64)\n}\n\nfunc main() {\n  games := []Game{\n    &amp;VideoGame{...},\n    &amp;BoardGame{...},\n    &amp;OnlineGame{...},\n  }\n\n  // ... print games to a user\n}\n</code></pre>\n\n<p>I can easily marshal the games as JSON, and I'm implementing the <code>UnmarshalJSON</code> method in a concrete slice to get the concrete games back from JSON.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Games []Game\n\nfunc (g *Games) UnmarshalJSON(data []byte) error {\n  // ...\n}\n</code></pre>\n\n<p><strong>My question is: Is this an idiomatic way to structure my code? What is the best way to structure my code using Go idioms?</strong></p>\n\n<p>I feel like I'm building an inheritance hierarchy instead of composing. How to get away from my old OOP habits? Can you show me an example? What is wrong with this code?</p>\n\n<p>I read other answers but people only say: \"don't do that in Go, there is no inheritance\" etc. I know that, but I couldn't find a good example to explain this in a code example.</p>\n\n<hr>\n\n<p>For anyone reading this question, there are similar implementations in the <a href=\"https://golang.org/src/testing/testing.go\" rel=\"nofollow noreferrer\">testing</a> and <a href=\"https://golang.org/src/text/template/parse/node.go\" rel=\"nofollow noreferrer\">template</a> packages.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1570605733, "post_id": 58298488, "comment_id": 102960682, "body": "There&#39;s no difference between <code>new(T)</code> and <code>&amp;T{}</code>. It&#39;s hard to tell you what&#39;s wrong with pseudo code. Make a small <i>working</i> example."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 3, "creation_date": 1570606271, "post_id": 58298488, "comment_id": 102960947, "body": "To quote a wise man: Do not try to emulate inheritance in Go. It will hurt."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1570612747, "post_id": 58298488, "comment_id": 102964356, "body": "<code>new</code> has a few valid use-cases, but 99% of the time, it&#39;s better to create a literal (<code>ob := &amp;ObjBase{}</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 74, "user_id": 3068162, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WXbNn.jpg?s=128&g=1", "display_name": "Easwar Swaminathan", "link": "https://stackoverflow.com/users/3068162/easwar-swaminathan"}, "is_accepted": false, "score": 0, "last_activity_date": 1570644064, "creation_date": 1570644064, "answer_id": 58309818, "question_id": 58298488, "link": "https://stackoverflow.com/questions/58298488/how-to-set-struct-member-dynamically/58309818#58309818", "title": "How to set struct member dynamically", "body": "<p>Please take a look at this doc which talks the Go generated code for protobufs. <a href=\"https://developers.google.com/protocol-buffers/docs/reference/go-generated\" rel=\"nofollow noreferrer\">https://developers.google.com/protocol-buffers/docs/reference/go-generated</a></p>\n\n<p>You should be able to set a protobuf message field in the generated code by directly accessing the corresponding member field (which is exported).</p>\n"}], "owner": {"reputation": 407, "user_id": 4255102, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/a926a59d004dd47d1e6d6193bd69572d?s=128&d=identicon&r=PG&f=1", "display_name": "batmancn", "link": "https://stackoverflow.com/users/4255102/batmancn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1570644064, "creation_date": 1570603640, "question_id": 58298488, "link": "https://stackoverflow.com/questions/58298488/how-to-set-struct-member-dynamically", "title": "How to set struct member dynamically", "body": "<p>Now I'm working on GO RPC, I'm using gRPC+Protobuf. And I follow <a href=\"https://github.com/openconfig/public\" rel=\"nofollow noreferrer\">openconfig</a>'s data struct, so I could NOT redesign.</p>\n\n<p>I need to fill protobuf struct and Marshal it and send it out, and then client will Unmarshal it and read datas.</p>\n\n<p>My protobuf file(xxx.pb.go) is complicated, for example, just like this:</p>\n\n<pre><code>type ObjBase struct {\n    a *ObjChildAlice,\n    b *ObjChildBob,\n    ... // there are many variables like ObjChildCheer, ObjChildDog ...\n}\n\ntype ObjChildAlice struct {\n    child *ObjChildChild,\n}\n\ntype ObjChildBob struct {\n    child *ObjChildChild,\n}\n\n// there are many types like ObjChildCheer, ObjChildDog ...\n\ntype ObjChildChild {\n    int i,\n}\n</code></pre>\n\n<p>In server side, I need to fill <code>ObjBase</code> and send it out, this is my task:</p>\n\n<pre><code>// Code 1\nfunc () {\n    init ob with ObjBase\n\n    if DataBase has Alice {\n        fill ob.a with ObjChildAlice\n    }\n    if DataBase has Bob {\n        fill ob.a with ObjChildBob\n    }\n    // there are many if..else.. DataBase has Cheer...\n    return ob\n}\n</code></pre>\n\n<p>So I code like this first:</p>\n\n<pre><code>// Code 2\nfunc () {\n    ob := new(ObjBase)\n    oba := new(ObjChildAlice)\n    obb := new(ObjChildBob)\n    if DataBase has Alice {\n        ob.a = oba\n    }\n    if DataBase has Bob {\n        ob.b = obb\n    }\n    ...\n    return ob\n}\n</code></pre>\n\n<p>But this code could NOT work, as I check member of ob.a and ob.b are all zero. </p>\n\n<p>So I change like this:</p>\n\n<pre><code>// Code 3\nfunc () {\n    if DataBase has Alice &amp;&amp; DataBase has Bob {\n        ob := &amp;ObjBase{\n            a: &amp;ObjChildAlice{},\n            b: &amp;ObjChildBob{},\n        }\n    } else if DataBase has Alice &amp;&amp; NOT DataBase has Bob {\n        ob := &amp;ObjBase{\n            a: &amp;ObjChildAlice{},\n        }\n    } else if ...\n    return ob\n}\n</code></pre>\n\n<p>This works. But in database, there are kinds of variables like Alice, Bob, Cheer, Dog ... It's impossible to use if..else.. to do this work.</p>\n\n<p>So I have questions:</p>\n\n<ol>\n<li><p>Why ob'member in Code2 is zero?</p></li>\n<li><p>is there any way to set Go struct's member object dynamically?</p></li>\n</ol>\n"}, {"tags": ["go", "profiling"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1570598999, "post_id": 58296808, "comment_id": 102957954, "body": "Make sure you program runs long enough to actually collect some samples. Short (in runtime) programs cannot be profiled."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1570606304, "post_id": 58296808, "comment_id": 102960966, "body": "If your program is already quick, use a <a href=\"https://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"nofollow noreferrer\">benchmark</a> to produce significant profiles (see the flags for Go test; be need to create the profiles yourself)."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1570614207, "last_edit_date": 1570614207, "creation_date": 1570613388, "answer_id": 58301075, "question_id": 58296808, "link": "https://stackoverflow.com/questions/58296808/unable-to-get-data-from-cpu-profiling/58301075#58301075", "title": "Unable to get data from CPU profiling", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">Defer statements</a></p>\n  \n  <p>A \"defer\" statement invokes a function whose execution is deferred to\n  the moment the surrounding function returns, either because the\n  surrounding function executed a return statement, reached the end of\n  its function body, or because the corresponding goroutine is\n  panicking.</p>\n</blockquote>\n\n<hr>\n\n<p>Fix the premature Close of the CPU file:</p>\n\n<pre><code>func CPUprofiling() {\n    fd, err := os.Create(\".cpu.prof\")\n    if err != nil {\n        log.Fatalln(err.Error())\n    }\n    defer fd.Close()\n    pprof.StartCPUProfile(fd)\n    defer pprof.StopCPUProfile()\n}\n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"runtime/pprof\"\n    \"strings\"\n)\n\nvar filename string\n\nfunc main() {\n    cpu, err := os.Create(\".cpu.prof\")\n    if err != nil {\n        log.Fatalln(err.Error())\n    }\n    defer cpu.Close()\n    pprof.StartCPUProfile(cpu)\n    defer pprof.StopCPUProfile()\n\n    flag.StringVar(&amp;filename, \"f\", \"\", \"Path to the input file\")\n    flag.Parse()\n    if filename == \"\" {\n        flag.Usage()\n        log.Fatalln()\n    }\n    for w, c := range getResults(filename) {\n        fmt.Printf(\"%-20s\\t%d\\n\", w, c)\n    }\n\n    mem, err := os.Create(\".mem.prof\")\n    if err != nil {\n        log.Fatalln(err.Error())\n    }\n    defer mem.Close()\n    pprof.WriteHeapProfile(mem)\n}\n\nfunc getResults(path string) map[string]int {\n    results := make(map[string]int)\n    file, err := os.Open(filename)\n    defer file.Close()\n    if err != nil {\n        log.Fatalln(err.Error())\n    }\n    scanner := bufio.NewScanner(file)\n    scanner.Split(bufio.ScanWords)\n    for scanner.Scan() {\n        results[removeNonWordChars(scanner.Text())]++\n    }\n    delete(results, \"\")\n    return results\n}\n\nfunc removeNonWordChars(input string) string {\n    var result strings.Builder\n    result.Grow(len(input))\n    for _, r := range strings.ToLower(input) {\n        if r &gt;= 'a' &amp;&amp; r &lt;= 'z' {\n            _, err := result.WriteRune(r)\n            if err != nil {\n                log.Fatalln(err.Error())\n            }\n        }\n    }\n    return result.String()\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go tool pprof .cpu.prof\nFile: main\nType: cpu\nTime: Oct 9, 2019 at 5:39am (EDT)\nDuration: 600.79ms, Total samples = 390ms (64.91%)\nEntering interactive mode (type \"help\" for commands, \"o\" for options)\n(pprof) top\nShowing nodes accounting for 320ms, 82.05% of 390ms total\nShowing top 10 nodes out of 43\n      flat  flat%   sum%        cum   cum%\n     110ms 28.21% 28.21%      110ms 28.21%  syscall.Syscall\n      60ms 15.38% 43.59%       90ms 23.08%  runtime.mapassign_faststr\n      40ms 10.26% 53.85%       40ms 10.26%  unicode/utf8.DecodeRune\n      30ms  7.69% 61.54%       30ms  7.69%  strings.(*Builder).WriteRune\n      20ms  5.13% 66.67%       20ms  5.13%  runtime.slicebytetostring\n      20ms  5.13% 71.79%       20ms  5.13%  strings.ToLower\n      10ms  2.56% 74.36%       60ms 15.38%  bufio.ScanWords\n      10ms  2.56% 76.92%       10ms  2.56%  bufio.isSpace\n      10ms  2.56% 79.49%       10ms  2.56%  fmt.(*buffer).writeString\n      10ms  2.56% 82.05%       10ms  2.56%  memeqbody\n(pprof) quit\n$ \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 196, "user_id": 9121201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2698ee8824af5a9a99d798e9217db503?s=128&d=identicon&r=PG", "display_name": "Amit Davidson", "link": "https://stackoverflow.com/users/9121201/amit-davidson"}, "is_accepted": true, "score": 5, "last_activity_date": 1586632231, "creation_date": 1586632231, "answer_id": 61162307, "question_id": 58296808, "link": "https://stackoverflow.com/questions/58296808/unable-to-get-data-from-cpu-profiling/61162307#61162307", "title": "Unable to get data from CPU profiling", "body": "<p>For me, the problem was my code was executing too fast. What I did is changing the sampling rate using <a href=\"https://golang.org/pkg/runtime/#SetCPUProfileRate\" rel=\"noreferrer\">runtime.SetCPUProfileRate</a>. Note that in <a href=\"https://golang.org/pkg/runtime/pprof/#StartCPUProfile\" rel=\"noreferrer\">runtime.pprof.StartCPUProfile</a> the sampling rate is 100 Hz and recommended to be 500 Hz.</p>\n\n<pre><code>func StartCPUProfile(w io.Writer) error {\n    // The runtime routines allow a variable profiling rate,\n    // but in practice operating systems cannot trigger signals\n    // at more than about 500 Hz, and our processing of the\n    // signal is not cheap (mostly getting the stack trace).\n    // 100 Hz is a reasonable choice: it is frequent enough to\n    // produce useful data, rare enough not to bog down the\n    // system, and a nice round number to make it easy to\n    // convert sample counts to seconds. Instead of requiring\n    // each client to specify the frequency, we hard code it.\n    const hz = 100\n\n    cpu.Lock()\n    defer cpu.Unlock()\n    if cpu.done == nil {\n         cpu.done = make(chan bool)\n    }\n    // Double-check.\n    if cpu.profiling {\n         return fmt.Errorf(\"cpu profiling already in use\")\n     }\n    cpu.profiling = true\n    runtime.SetCPUProfileRate(hz)\n    go profileWriter(w)\n    return nil\n}\n</code></pre>\n\n<p>But setting it to 500 Hz wasn't fast enough in my case. After looking into the code of <a href=\"https://golang.org/pkg/runtime/#SetCPUProfileRate\" rel=\"noreferrer\">runtime.SetCPUProfileRate</a> it seems that you can provide frequencies up to 100000 Hz. After setting it to a large enough value it solved my issue.</p>\n\n<pre><code>// SetCPUProfileRate sets the CPU profiling rate to hz samples per second.\n// If hz &lt;= 0, SetCPUProfileRate turns off profiling.\n// If the profiler is on, the rate cannot be changed without first turning it off.\n//\n// Most clients should use the runtime/pprof package or\n// the testing package's -test.cpuprofile flag instead of calling\n// SetCPUProfileRate directly.\n\nfunc SetCPUProfileRate(hz int) {\n\n    // Clamp hz to something reasonable.\n    if hz &lt; 0 {\n        hz = 0\n    }\n    if hz &gt; 1000000 {\n        hz = 1000000\n    }\n\n    lock(&amp;cpuprof.lock)\n    if hz &gt; 0 {\n        if cpuprof.on || cpuprof.log != nil {\n            print(\"runtime: cannot set cpu profile rate until previous profile has finished.\\n\")\n            unlock(&amp;cpuprof.lock)\n            return\n        }\n\n        cpuprof.on = true\n        cpuprof.log = newProfBuf(1, 1&lt;&lt;17, 1&lt;&lt;14)\n        hdr := [1]uint64{uint64(hz)}\n        cpuprof.log.write(nil, nanotime(), hdr[:], nil)\n        setcpuprofilerate(int32(hz))\n    } else if cpuprof.on {\n        setcpuprofilerate(0)\n        cpuprof.on = false\n        cpuprof.addExtra()\n        cpuprof.log.close()\n    }\n    unlock(&amp;cpuprof.lock)\n}\n</code></pre>\n"}], "owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 884, "favorite_count": 3, "accepted_answer_id": 61162307, "answer_count": 2, "score": 1, "last_activity_date": 1586632231, "creation_date": 1570593020, "question_id": 58296808, "link": "https://stackoverflow.com/questions/58296808/unable-to-get-data-from-cpu-profiling", "title": "Unable to get data from CPU profiling", "body": "<p>Im trying to learn to use Go's profiling capabilities.\nWith that in mind I crated this simple app : <a href=\"https://github.com/Matias-Barrios/countWords\" rel=\"nofollow noreferrer\">https://github.com/Matias-Barrios/countWords</a>\nwhich simply count the number of word occurrences for a given <strong>txt</strong> file.</p>\n\n<p>The problem is, I can not see anything once the <em>.cpu.prof</em> file has been created.\nAs soon as I open the file I get this error :</p>\n\n<pre><code>(0) matias #&gt; go tool pprof .cpu.prof \nFile: main\nType: cpu\nTime: Oct 9, 2019 at 12:38am (-03)\nDuration: 201.31ms, Total samples = 0 \nNo samples were found with the default sample value type.\nTry \"sample_index\" command to analyze different sample values.\nEntering interactive mode (type \"help\" for commands, \"o\" for options)\n(pprof) top\nShowing nodes accounting for 0, 0% of 0 total\n      flat  flat%   sum%        cum   cum%\n(pprof) \n</code></pre>\n\n<p>What am I doing wrong here?</p>\n\n<p>Note : My Go version is <strong>go version go1.13.1 linux/amd64</strong></p>\n"}, {"tags": ["go", "jenkins", "go-modules"], "comments": [{"owner": {"reputation": 39, "user_id": 11645655, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-9WEpriKP5Ws/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re1eUPuaONHAnQI6P55n6ZX9QJBpA/mo/photo.jpg?sz=128", "display_name": "Yosafat Vincent Saragih", "link": "https://stackoverflow.com/users/11645655/yosafat-vincent-saragih"}, "edited": false, "score": 0, "creation_date": 1570605870, "post_id": 58296485, "comment_id": 102960731, "body": "update: I have check my workspace and see there&#39;s something wrong with my go.mod file. In my git repo, it exists with several list of modules are needed. But when I check my Jenkins workspace, there&#39;s only my repo name and the go version that Jenkins workspace use"}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1570596562, "creation_date": 1570596562, "answer_id": 58297239, "question_id": 58296485, "link": "https://stackoverflow.com/questions/58296485/incorrect-path-name-where-build-in-jenkins/58297239#58297239", "title": "Incorrect path name where build in Jenkins", "body": "<p>Considering that <code>[[</code> is <a href=\"https://unix.stackexchange.com/a/306141/7490\">zsh/ksh/bash built-in</a>, make sure your script runs with bash.</p>\n\n<p>It should start with the proper <a href=\"https://en.wikipedia.org/wiki/Shebang_(Unix)\" rel=\"nofollow noreferrer\">shebang</a>:</p>\n\n<pre><code>#!/bin/bash\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 11645655, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-9WEpriKP5Ws/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re1eUPuaONHAnQI6P55n6ZX9QJBpA/mo/photo.jpg?sz=128", "display_name": "Yosafat Vincent Saragih", "link": "https://stackoverflow.com/users/11645655/yosafat-vincent-saragih"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1570596562, "creation_date": 1570590191, "question_id": 58296485, "link": "https://stackoverflow.com/questions/58296485/incorrect-path-name-where-build-in-jenkins", "title": "Incorrect path name where build in Jenkins", "body": "<p>I cannot build my apps on Jenkins. I try build it locally and it works. My apps using go wrapper and go mod</p>\n\n<p>this is what jenkins result according to the failure:</p>\n\n<pre><code>./build.sh: 6: ./build.sh: [[: not found\ngo get .: path /var/lib/jenkins/workspace/_XXX_develop is not a package in module rooted at /var/lib/jenkins/workspace/_XXX_develop\nERROR: go get\n</code></pre>\n\n<p>I using custom build.sh like this (only from line 1-6 when the problem occurs):</p>\n\n<pre><code>CWD=$(cd . &amp;&amp; pwd)\nPRG=$0\nBASEDIR=$(cd \"$(dirname ${PRG})\" &amp;&amp; pwd)\nBASENAME=$(basename ${PRG})\nAPPNAME=${BASENAME}\nwhile [[ -L \"$BASEDIR/$BASENAME\" ]]; do\n    PRG=$(readlink \"$BASEDIR/$BASENAME\")\n    BASEDIR=$(cd \"$BASEDIR\" &amp;&amp; cd \"$(dirname ${PRG})\" &amp;&amp; pwd)\n    BASENAME=$(basename \"$PRG\")\ndone\n</code></pre>\n\n<p>I never use $GOPATH due i using go-mod instead. I have use this build.sh and jenkinsfile easily, but after go update to 1.13.1, it seems it show problem.</p>\n"}, {"tags": ["python", "go", "hash"], "comments": [{"owner": {"reputation": 10846, "user_id": 4799172, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/17539586d5bb4e528d94f3bc4131e6c0?s=128&d=identicon&r=PG&f=1", "display_name": "roganjosh", "link": "https://stackoverflow.com/users/4799172/roganjosh"}, "edited": false, "score": 3, "creation_date": 1570567413, "post_id": 58293806, "comment_id": 102951651, "body": "I don&#39;t know the answer, but I&#39;m curious about why you would need this"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1570567501, "post_id": 58293806, "comment_id": 102951683, "body": "How it works is in internal implementation detail, not to mention objects can have a <code>__hash__()</code> method which means it could return anything."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1570570461, "post_id": 58293806, "comment_id": 102952566, "body": "Looks like an <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">XY Problem</a>. What is your actual goal?"}, {"owner": {"reputation": 77, "user_id": 7480297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f1d9a07c6ab82234db85c7bf54bc2c0?s=128&d=identicon&r=PG&f=1", "display_name": "jm21356", "link": "https://stackoverflow.com/users/7480297/jm21356"}, "edited": false, "score": 0, "creation_date": 1570571016, "post_id": 58293806, "comment_id": 102952707, "body": "Thanks for the replies. I&#39;m trying to determine which shard a string should be stored on. So it&#39;s just to evenly distribute data across a series of MySQL databases. I&#39;m going for <code>shard = md5(\u201c1.2.3.4&quot;) % 4096</code>. It&#39;s from this section of a <a href=\"https://medium.com/pinterest-engineering/sharding-pinterest-how-we-scaled-our-mysql-fleet-3f341e96ca6f\" rel=\"nofollow noreferrer\">pinterest blog</a> (please see the bottom of the post)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1570607514, "post_id": 58293806, "comment_id": 102961615, "body": "In that case, the Python hash function is <i>the wrong solution</i>, since it will change for each invocation. You need a stable hashing function. md5 is fine, but there are no doubt faster alternatives. CRC16 or CRC32 is probably fine, unless you&#39;re hashing input that may be user-manipulated (in which case MD5 isn&#39;t safe, either)"}, {"owner": {"reputation": 77, "user_id": 7480297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f1d9a07c6ab82234db85c7bf54bc2c0?s=128&d=identicon&r=PG&f=1", "display_name": "jm21356", "link": "https://stackoverflow.com/users/7480297/jm21356"}, "edited": false, "score": 0, "creation_date": 1570738113, "post_id": 58293806, "comment_id": 103018664, "body": "Ok great, many thanks for your help guys, I&#39;ll go for the crc32 method."}], "answers": [{"comments": [{"owner": {"reputation": 10846, "user_id": 4799172, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/17539586d5bb4e528d94f3bc4131e6c0?s=128&d=identicon&r=PG&f=1", "display_name": "roganjosh", "link": "https://stackoverflow.com/users/4799172/roganjosh"}, "edited": false, "score": 0, "creation_date": 1570567506, "post_id": 58293849, "comment_id": 102951687, "body": "I <i>think</i> you can stop the randomisation, no?"}, {"owner": {"reputation": 10846, "user_id": 4799172, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/17539586d5bb4e528d94f3bc4131e6c0?s=128&d=identicon&r=PG&f=1", "display_name": "roganjosh", "link": "https://stackoverflow.com/users/4799172/roganjosh"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1570567628, "post_id": 58293849, "comment_id": 102951741, "body": "@AdamSmith which would be relevant in a general application but internally it would seem strange to me that you couldn&#39;t either a) fix the seed or b) at least grasp the seed and transmit it if you&#39;re <i>sure</i> that such a situation wouldn&#39;t arise"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "reply_to_user": {"reputation": 10846, "user_id": 4799172, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/17539586d5bb4e528d94f3bc4131e6c0?s=128&d=identicon&r=PG&f=1", "display_name": "roganjosh", "link": "https://stackoverflow.com/users/4799172/roganjosh"}, "edited": false, "score": 1, "creation_date": 1570567641, "post_id": 58293849, "comment_id": 102951748, "body": "@roganjosh You can set <code>PYTHONHASHSEED</code> (either as an environment variable or from the command line) to get a reproducible random sequence, but I haven&#39;t yet found a way to disable salting all together."}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1570567810, "post_id": 58293849, "comment_id": 102951794, "body": "@AdamSmith I luckily stumbled on that as I clicked links and scanned the docs."}, {"owner": {"reputation": 10846, "user_id": 4799172, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/17539586d5bb4e528d94f3bc4131e6c0?s=128&d=identicon&r=PG&f=1", "display_name": "roganjosh", "link": "https://stackoverflow.com/users/4799172/roganjosh"}, "edited": false, "score": 0, "creation_date": 1570568983, "post_id": 58293849, "comment_id": 102952134, "body": "<a href=\"https://stackoverflow.com/a/27522708/4799172\">this</a> shows how to disable it: &quot;... but you can set it to a fixed positive integer value, with 0 disabling the feature altogether.&quot;"}, {"owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "reply_to_user": {"reputation": 10846, "user_id": 4799172, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/17539586d5bb4e528d94f3bc4131e6c0?s=128&d=identicon&r=PG&f=1", "display_name": "roganjosh", "link": "https://stackoverflow.com/users/4799172/roganjosh"}, "edited": false, "score": 0, "creation_date": 1570569546, "post_id": 58293849, "comment_id": 102952300, "body": "@roganjosh So in general, what the OP asks isn&#39;t possible because even Python itself won&#39;t replicate the same hash for a given string between invocations of the same script."}], "tags": [], "owner": {"reputation": 69207, "user_id": 1440565, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ec430cc01ef4cf4ae63ebbe9e8596f72?s=128&d=identicon&r=PG", "display_name": "Code-Apprentice", "link": "https://stackoverflow.com/users/1440565/code-apprentice"}, "is_accepted": true, "score": 4, "last_activity_date": 1570567714, "last_edit_date": 1570567714, "creation_date": 1570567443, "answer_id": 58293849, "question_id": 58293806, "link": "https://stackoverflow.com/questions/58293806/python-hash-function-equivelant/58293849#58293849", "title": "python hash function equivelant", "body": "<blockquote>\n  <p>By default, the <code>__hash__()</code> values of str, bytes and datetime objects are \u201csalted\u201d with an unpredictable random value. Although they remain constant within an individual Python process, they are not predictable between repeated invocations of Python.</p>\n</blockquote>\n\n<p>You will get different numbers between different invocations of the Python script. So I don't think what you want is even possible.</p>\n\n<p>Source: <a href=\"https://docs.python.org/3.5/reference/datamodel.html#object.__hash__\" rel=\"nofollow noreferrer\">https://docs.python.org/3.5/reference/datamodel.html#object.__hash__</a></p>\n"}], "owner": {"reputation": 77, "user_id": 7480297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f1d9a07c6ab82234db85c7bf54bc2c0?s=128&d=identicon&r=PG&f=1", "display_name": "jm21356", "link": "https://stackoverflow.com/users/7480297/jm21356"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 58293849, "answer_count": 1, "score": -1, "last_activity_date": 1570570376, "creation_date": 1570567244, "last_edit_date": 1570570376, "question_id": 58293806, "link": "https://stackoverflow.com/questions/58293806/python-hash-function-equivelant", "title": "python hash function equivelant", "body": "<p>I'm trying to find the Go equivalent to python's hash function:</p>\n\n<pre><code>hash(\"test\")\n</code></pre>\n\n<p>I've found <a href=\"https://stackoverflow.com/questions/13582519/how-to-generate-hash-number-of-a-string-in-go\">this post</a> which is a very similar function in the sense that it returns an integer, however, it uses fnv which appears to be a different hashing method to the <a href=\"https://docs.python.org/3.5/library/functions.html#hash\" rel=\"nofollow noreferrer\">python version</a></p>\n\n<p>What I'm trying to do is pass a string to the hash function whereby it returns exactly the same integer in both languages for the same string.</p>\n"}, {"tags": ["unit-testing", "go", "goroutine", "hystrix"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 4, "creation_date": 1570561787, "post_id": 58292558, "comment_id": 102949439, "body": "From the unit test, you don&#39;t have access to the channel. Maybe you can refactor methA() to create a channel and call a methB(channel) so that you can create a channel in the test, and test methB instead."}], "answers": [{"tags": [], "owner": {"reputation": 84, "user_id": 11484375, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ci0LH8WkltQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfXUaM9_bZrD__rzBzJESn9PAQB_w/mo/photo.jpg?sz=128", "display_name": "polo xue", "link": "https://stackoverflow.com/users/11484375/polo-xue"}, "is_accepted": false, "score": 0, "last_activity_date": 1570591551, "last_edit_date": 1570591551, "creation_date": 1570590154, "answer_id": 58296480, "question_id": 58292558, "link": "https://stackoverflow.com/questions/58292558/set-data-in-a-channel-which-is-actually-set-by-a-mocked-function-for-unit-tests/58296480#58296480", "title": "Set data in a channel which is actually set by a mocked function for unit tests", "body": "<p>Test code which uses channel? Maybe you can try to mock <code>A.somefunc</code>.</p>\n\n<p>An example is as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestMethA(t testing.T) {\n    // All possibilities\n    cases := struct {\n        data []interface{}  // data that send to channel\n        want interface{}\n    } {\n        // ...\n    }\n\n    somefunc := A.somefunc\n    defer func () {\n        A.somefunc = somefunc\n    }()\n\n    for c := range cases {\n        A.somefunc = func(c chan) error {\n            // set data into the channel.\n        }\n\n        // call methodA\n        methodA()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 177, "user_id": 7071127, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/986173e162dac0ba1158be9da78e9d62?s=128&d=identicon&r=PG&f=1", "display_name": "user304611", "link": "https://stackoverflow.com/users/7071127/user304611"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1570591551, "creation_date": 1570561400, "question_id": 58292558, "link": "https://stackoverflow.com/questions/58292558/set-data-in-a-channel-which-is-actually-set-by-a-mocked-function-for-unit-tests", "title": "Set data in a channel which is actually set by a mocked function for unit tests", "body": "<p>I am trying to write unit tests for a method(methA) which makes a call through hystrix.Go. The external function i'm calling inside Hystrix func()[somefunc] takes channel as parameter and inserts the data in the channel in actual code flow. While writing units i want to set data into channel and test out all possibilities, Is that even possible?    </p>\n\n<pre><code>func methA() {\n    // some code\n    channel := make(chan []string, 1)\n    hystrix.Go(\"x\", func() error {\n        return A.somefunc(channel)\n    }, nil)\n    // some code which uses channel\n}\n</code></pre>\n"}, {"tags": ["javascript", "go"], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 11814211, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dt3al.jpg?s=128&g=1", "display_name": "Lau", "link": "https://stackoverflow.com/users/11814211/lau"}, "edited": false, "score": 0, "creation_date": 1570636077, "post_id": 58292821, "comment_id": 102977397, "body": "Thanks for your answer, Adrian. The problem is that the response I get from the go code is an HTML (this I know it because I tried printing the data on the console logs of javascript). I mean, I know I can use, for example, &quot;location.href&quot; to change the url, but i don&#39;t get any url."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 15, "user_id": 11814211, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dt3al.jpg?s=128&g=1", "display_name": "Lau", "link": "https://stackoverflow.com/users/11814211/lau"}, "edited": false, "score": 0, "creation_date": 1570636481, "post_id": 58292821, "comment_id": 102977637, "body": "Right - the redirect is already done when you get the response in your script, that&#39;s how redirects are supposed to work. If you want to redirect the browser to some URL based on the response you get from your AJAX request, you&#39;ll need to actually return the URL in the reponse instead of trying to redirect the AJAX request itself."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1570562633, "creation_date": 1570562633, "answer_id": 58292821, "question_id": 58292544, "link": "https://stackoverflow.com/questions/58292544/how-to-redirect-the-browser-after-a-json-post-with-go-and-javascript/58292821#58292821", "title": "How to redirect the browser after a json post with go and javascript?", "body": "<p>When you issue an AJAX request, that's all JavaScript, not the page the user sees. So when your AJAX request gets a redirect response, it's the AJAX request that gets redirected. The page the user sees will only redirected if the URL they navigate to returns a redirect. If you want a JavaScript to change the browser page, you'll have to write the JS so that it does that, it won't happen automatically.</p>\n"}], "owner": {"reputation": 15, "user_id": 11814211, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dt3al.jpg?s=128&g=1", "display_name": "Lau", "link": "https://stackoverflow.com/users/11814211/lau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 58292821, "answer_count": 1, "score": -1, "last_activity_date": 1570562633, "creation_date": 1570561324, "question_id": 58292544, "link": "https://stackoverflow.com/questions/58292544/how-to-redirect-the-browser-after-a-json-post-with-go-and-javascript", "title": "How to redirect the browser after a json post with go and javascript?", "body": "<p>We are trying to send an HTML form in JSON to a GO code. We already achieve that, but, now we're confused because we can't make the browser to redirect to corresponding webpage. The redirect instruction works fine sending the json directly on Insomnia (it returns the success state and displays the new page), but not in the browser. Perhaps we're missing some code, but we can't find what are we missing. Please, help.</p>\n\n<p>The javascript code that sends the json:</p>\n\n<pre><code>  jQuery(document).on('submit', '#login', function(event){\n        event.preventDefault();\n\n        jQuery.ajax({\n            url: '/login/',\n            type: 'POST',\n            dataType: 'json',\n            data: JSON.stringify($(this).serializeFormJSON())\n        })\n        .done(function(response){\n            location.href = 'response';\n        })\n        .fail(function(resp){\n            console.log(\"resp\");\n        })\n        .always(function(){\n            console.log(\"complete\");\n        })\n    });\n</code></pre>\n\n<p>The Go code that validates this form:</p>\n\n<pre><code>    func POSTLoginHandler(w http.ResponseWriter, r *http.Request) {\n        var user users.User\n        err := json.NewDecoder(r.Body).Decode(&amp;user)\n        if err != nil {\n            w.WriteHeader(http.StatusBadRequest)\n        } else {\n            validCredentials, err := users.ValidarCredenciales(user)\n            if err != nil {\n                w.WriteHeader(http.StatusInternalServerError)\n            } else if validCredentials {\n                err = cookies.GenerarCookie(w, r, user.Email)\n                if err != nil {\n                    w.WriteHeader(http.StatusInternalServerError)\n                } else {\n                    http.Redirect(w, r, \"/dashboard/\", http.StatusSeeOther)\n                }\n            } else {\n                http.Redirect(w, r, \"/forbidden/\", http.StatusSeeOther)\n            }\n        }\n    }\n\n\n    func GetDashboardUser(w http.ResponseWriter, r *http.Request) {\n        exists, err := cookies.VerifyCookie(r)\n        if err != nil {\n            w.WriteHeader(http.StatusInternalServerError)\n        } else if exists {\n            http.ServeFile(w, r, \"static/template.html\")\n        } else {\n            http.Redirect(w, r, \"/\", http.StatusSeeOther)\n        }\n    }\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1570560507, "post_id": 58292253, "comment_id": 102948904, "body": "Without the goroutine <code>next &lt;- n &#47; 2</code> blocks because there&#39;s nothing reading from <code>next</code>, why is nothing reading from <code>next</code>? because <code>divide</code> didn&#39;t exist, why? because it&#39;s waiting for <code>next &lt;- n &#47; 2</code> to stop blocking."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 8014264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99ebe08b6c4e70e85c620f47fb9076c2?s=128&d=identicon&r=PG", "display_name": "user17156", "link": "https://stackoverflow.com/users/8014264/user17156"}, "edited": false, "score": 0, "creation_date": 1570562601, "post_id": 58292467, "comment_id": 102949766, "body": "Thank you for your answer. I have a question. <code>divide() waits to write to next</code> Why is this waiting for writing to next when calls divide without goroutine ?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 3, "user_id": 8014264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99ebe08b6c4e70e85c620f47fb9076c2?s=128&d=identicon&r=PG", "display_name": "user17156", "link": "https://stackoverflow.com/users/8014264/user17156"}, "edited": false, "score": 0, "creation_date": 1570562830, "post_id": 58292467, "comment_id": 102949845, "body": "A write to a channel blocks until another goroutine reads from it. It is a synchronization mechanism."}, {"owner": {"reputation": 3, "user_id": 8014264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99ebe08b6c4e70e85c620f47fb9076c2?s=128&d=identicon&r=PG", "display_name": "user17156", "link": "https://stackoverflow.com/users/8014264/user17156"}, "edited": false, "score": 0, "creation_date": 1570563379, "post_id": 58292467, "comment_id": 102950057, "body": "Oh, I understand! Because there was not a channel to be able to write, I need to make a new goroutine ?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 3, "user_id": 8014264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99ebe08b6c4e70e85c620f47fb9076c2?s=128&d=identicon&r=PG", "display_name": "user17156", "link": "https://stackoverflow.com/users/8014264/user17156"}, "edited": false, "score": 0, "creation_date": 1570564121, "post_id": 58292467, "comment_id": 102950349, "body": "Without the goroutine, write to <code>next</code> blocks, because the read from that channel is also in that same goroutine."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1570560997, "creation_date": 1570560997, "answer_id": 58292467, "question_id": 58292253, "link": "https://stackoverflow.com/questions/58292253/about-the-behavior-of-go-routine-in-go-routine/58292467#58292467", "title": "About the behavior of go routine in go routine", "body": "<p>Without <code>go divide()</code> inside execute:</p>\n\n<ul>\n<li>execute() reads from the <code>next</code> channel, calls <code>divide</code></li>\n<li>divide() waits to write to <code>next</code></li>\n<li>execute() is still waiting for divide() to return, so program is now deadlocked.</li>\n</ul>\n\n<p>With <code>go divide()</code> inside execute:</p>\n\n<ul>\n<li>execute() reads from the <code>next</code> channel, starts <code>divide</code> in new goroutine, continues waiting</li>\n<li>divide() writes to <code>next</code></li>\n<li>execute() reads from <code>next</code>, starts another goroutine, etc.</li>\n</ul>\n\n<p>Note that as soon as <code>divide</code> writes to <code>next</code>, it continues to write to <code>quit</code> so you may receive multiple quit messages before everything is done.</p>\n"}], "owner": {"reputation": 3, "user_id": 8014264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99ebe08b6c4e70e85c620f47fb9076c2?s=128&d=identicon&r=PG", "display_name": "user17156", "link": "https://stackoverflow.com/users/8014264/user17156"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 58292467, "answer_count": 1, "score": -1, "last_activity_date": 1570560997, "creation_date": 1570559920, "question_id": 58292253, "link": "https://stackoverflow.com/questions/58292253/about-the-behavior-of-go-routine-in-go-routine", "title": "About the behavior of go routine in go routine", "body": "<p>I'm newie to golang and studying the goroutine.<br>\nI wrote the simple code that divide the number using goroutine on purpose.<br>\nFirst of all, I give the base number and keep on dividing its number until it is not divisible<br>\nBut, I change <code>go split(n)</code> to <code>split(n)</code>, it is not working like the following, is this why?</p>\n\n<p>\u25a0 source code</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"strconv\"\n)\n\nvar next = make(chan int)\nvar quit = make(chan int)\n\nfunc divide(n int) {\n    defer func(){ quit &lt;- 1 }()\n\n    fmt.Println(\"[divide] n = \" + strconv.Itoa(n))\n\n    r := n % 2\n    if r == 0 {\n        next &lt;- n / 2\n    }\n}\n\nfunc execute() {\n\n    fmt.Println(\"[execute] start\")\n    count := 0\n    end   := false\n    for !end {\n        select {\n        case n := &lt;- next:\n            count++\n            fmt.Println(\"[execute] n = \" + strconv.Itoa(n) + \", count = \" + strconv.Itoa(count))\n            go divide(n)\n        case _ = &lt;- quit:\n            count--\n            fmt.Println(\"[execute] end. count = \" + strconv.Itoa(count))\n            if count &lt;= 0 {\n                end = true\n            }\n        }\n    }\n    fmt.Println(\"complete\")\n    os.Exit(0)\n}\n\nfunc main() {\n\n    base := flag.Int(\"n\", 1, \"Input the number\")\n    flag.Parse()\n\n    if *base &lt;= 0 {\n        fmt.Println(\"please more than 1\")\n        os.Exit(0)\n    }\n\n    go execute()\n    next &lt;- *base\n\n    if err := http.ListenAndServe(\":8080\", nil); err != nil {\n        log.Fatal(\"ListenAndSearver:\", err)\n    }\n}\n</code></pre>\n\n<p>\u25a0 result(work fine)</p>\n\n<pre><code>$ go run main.go -n 6\n[execute] start\n[execute] n = 6, count = 1\n[divide] n = 6\n[execute] n = 3, count = 2\n[execute] end. count = 1\n[divide] n = 3\n[execute] end. count = 0\ncomplete\n</code></pre>\n\n<p>\u25a0 result(not work)</p>\n\n<pre><code>$ go run main.go -n 6\n[execute] start\n[execute] n = 6, count = 1\n[divide] n = 6\n\n</code></pre>\n"}, {"tags": ["go", "google-cloud-platform"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1570561469, "post_id": 58292053, "comment_id": 102949320, "body": "<a href=\"https://cloud.google.com/compute/docs/reference/rest/v1/\" rel=\"nofollow noreferrer\">cloud.google.com/compute/docs/reference/rest/v1</a> <a href=\"https://cloud.google.com/compute/docs/concepts\" rel=\"nofollow noreferrer\">cloud.google.com/compute/docs/concepts</a>"}], "answers": [{"tags": [], "owner": {"reputation": 716, "user_id": 11633487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/22NOT.jpg?s=128&g=1", "display_name": "Ernesto U", "link": "https://stackoverflow.com/users/11633487/ernesto-u"}, "is_accepted": false, "score": 0, "last_activity_date": 1571759102, "creation_date": 1571759102, "answer_id": 58507927, "question_id": 58292053, "link": "https://stackoverflow.com/questions/58292053/how-to-write-gcp-cloud-api-implementation-for-network-storage-and-compute/58507927#58507927", "title": "How to write GCP cloud API implementation for network, storage and compute", "body": "<p>I would stick to GCP official APIs and <a href=\"https://developers.google.com/api-client-library\" rel=\"nofollow noreferrer\">Client Libraries</a>. In this case you need <a href=\"https://cloud.google.com/compute/docs/reference/rest/v1/\" rel=\"nofollow noreferrer\">Compute Engine API</a></p>\n\n<p>To create an instance you need to use the <a href=\"https://cloud.google.com/compute/docs/reference/rest/v1/instances/insert\" rel=\"nofollow noreferrer\">method instance.insert</a> you can try the API with the link I provided at the bottom of this link there are examples in the most popular computer languagues supported by GCP Client Libraries. To add more parameters with the \"Try this API\" UI just click on the + symbol</p>\n\n<p>Below are is my Request body used with this UI that works</p>\n\n<pre><code>{\n  \"kind\": \"compute#instance\",\n  \"name\": \"new-instance-1\",\n  \"zone\": \"projects/xxxxxxxxxxxxxxx/zones/us-central1-f\",\n  \"machineType\": \"projects/xxxxxxxxxx/zones/us-central1-f/machineTypes/n1-standard-1\",\n  \"displayDevice\": {\n    \"enableDisplay\": false\n  },\n  \"metadata\": {\n    \"kind\": \"compute#metadata\",\n    \"items\": []\n  },\n  \"tags\": {\n    \"items\": []\n  },\n  \"disks\": [\n    {\n      \"kind\": \"compute#attachedDisk\",\n      \"type\": \"PERSISTENT\",\n      \"boot\": true,\n      \"mode\": \"READ_WRITE\",\n      \"autoDelete\": true,\n      \"deviceName\": \"new-instance-1\",\n      \"initializeParams\": {\n        \"sourceImage\": \"projects/eip-images/global/images/debian-9-drawfork-v20191004\",\n        \"diskType\": \"projects/xxxxxxxxxx/zones/us-central1-f/diskTypes/pd-standard\",\n        \"diskSizeGb\": \"10\"\n      },\n      \"diskEncryptionKey\": {}\n    }\n  ],\n  \"canIpForward\": false,\n  \"networkInterfaces\": [\n    {\n      \"kind\": \"compute#networkInterface\",\n      \"subnetwork\": \"projects/xxxxxxxxxxxx/regions/us-central1/subnetworks/default\",\n      \"accessConfigs\": [\n        {\n          \"kind\": \"compute#accessConfig\",\n          \"name\": \"External NAT\",\n          \"type\": \"ONE_TO_ONE_NAT\",\n          \"networkTier\": \"PREMIUM\"\n        }\n      ],\n      \"aliasIpRanges\": []\n    }\n  ],\n  \"description\": \"\",\n  \"labels\": {},\n  \"scheduling\": {\n    \"preemptible\": false,\n    \"onHostMaintenance\": \"MIGRATE\",\n    \"automaticRestart\": true,\n    \"nodeAffinities\": []\n  },\n  \"deletionProtection\": false,\n  \"reservationAffinity\": {\n    \"consumeReservationType\": \"ANY_RESERVATION\"\n  },\n  \"serviceAccounts\": [\n    {\n      \"email\": \"1060078476845-compute@developer.gserviceaccount.com\",\n      \"scopes\": [\n        \"https://www.googleapis.com/auth/devstorage.read_only\",\n        \"https://www.googleapis.com/auth/logging.write\",\n        \"https://www.googleapis.com/auth/monitoring.write\",\n        \"https://www.googleapis.com/auth/servicecontrol\",\n        \"https://www.googleapis.com/auth/service.management.readonly\",\n        \"https://www.googleapis.com/auth/trace.append\"\n      ]\n    }\n</code></pre>\n\n<p>Now moving into storage there are many types suck as disks and buckets, I will assume you are refering to disks with my previous command a boot disk is created during the creation of the instance and you can add multiple disks during the creation.</p>\n\n<p>Here is the <a href=\"https://cloud.google.com/compute/docs/reference/rest/v1/disks/insert\" rel=\"nofollow noreferrer\">method to create just a disk</a> , to attach an existing disk to an instance use the <a href=\"https://cloud.google.com/compute/docs/reference/rest/v1/instances/attachDisk\" rel=\"nofollow noreferrer\">instances.attachDisk</a> method. Again if you specified multiple disks during the creation time you may skip this paragraph</p>\n\n<blockquote>\n  <blockquote>\n    <p>Also what is faster way creating bulk virtual machines and disks?</p>\n  </blockquote>\n</blockquote>\n\n<p>It will depend on your preferences, you may use both but personally I like to use the <a href=\"https://cloud.google.com/sdk/gcloud/reference/compute/instances/create\" rel=\"nofollow noreferrer\">gcloud commands</a> from the <a href=\"https://cloud.google.com/shell/docs/\" rel=\"nofollow noreferrer\">Cloud Shell</a>.</p>\n"}], "owner": {"reputation": 1, "user_id": 2438325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e7a778dad32f799c9d2d3d17ee650f8?s=128&d=identicon&r=PG", "display_name": "user2438325", "link": "https://stackoverflow.com/users/2438325/user2438325"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571759102, "creation_date": 1570559093, "last_edit_date": 1570560830, "question_id": 58292053, "link": "https://stackoverflow.com/questions/58292053/how-to-write-gcp-cloud-api-implementation-for-network-storage-and-compute", "title": "How to write GCP cloud API implementation for network, storage and compute", "body": "<p>I am writing a client for GCP Golang sdk APIs for network, storage and compute. I need help with the right sequence of calls. </p>\n\n<p>Is below code the right way to create the disks? Is there any efficient way of writing this code. </p>\n\n<p><code>disk := new(compute.Disk)\noperation, e := service.Disks.Insert(project, zone, disk).Do()</code></p>\n\n<p>What are these other constructs like - \nDisksInsertCall etc.. Are they more efficient for bulk disk creation?</p>\n\n<p>I am using library <a href=\"https://godoc.org/google.golang.org/api/compute/\" rel=\"nofollow noreferrer\">https://godoc.org/google.golang.org/api/compute/</a>. This does not give me proper parameters and sequence needed for creating an instance or a disk. </p>\n\n<p>Also what is faster way creating bulk virtual machines and disks?\n1. using deployment manager OR\n2. making direct API calls using go routines</p>\n"}, {"tags": ["go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 1775, "user_id": 11928088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd5f5ed70a37e684199988a6973e4da?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Tigau", "link": "https://stackoverflow.com/users/11928088/andrei-tigau"}, "edited": false, "score": 0, "creation_date": 1570612782, "post_id": 58291770, "comment_id": 102964375, "body": "Could you, please provide some code where are you doing the projection queries? Could you, also, give some data example? What is returned as []byte, what is returned as string?"}, {"owner": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "reply_to_user": {"reputation": 1775, "user_id": 11928088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd5f5ed70a37e684199988a6973e4da?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Tigau", "link": "https://stackoverflow.com/users/11928088/andrei-tigau"}, "edited": false, "score": 0, "creation_date": 1570631738, "post_id": 58291770, "comment_id": 102974991, "body": "Thank you Andrei. Updated the post with the test case and sample data."}], "answers": [{"comments": [{"owner": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "edited": false, "score": 0, "creation_date": 1570697990, "post_id": 58317491, "comment_id": 102997661, "body": "&quot;type []byte is not indexed&quot; is not correct. <a href=\"https://godoc.org/cloud.google.com/go/datastore\" rel=\"nofollow noreferrer\">godoc.org/cloud.google.com/go/datastore</a> states strings and byte slices more than 1500 bytes can&#39;t be indexed. My data is well within that. As I mentioned, the projection is working and returning correct data, just the data type has mismatch. Changing string to []byte and then loading to the struct works correctly (correct data)."}, {"owner": {"reputation": 1775, "user_id": 11928088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd5f5ed70a37e684199988a6973e4da?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Tigau", "link": "https://stackoverflow.com/users/11928088/andrei-tigau"}, "reply_to_user": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "edited": false, "score": 0, "creation_date": 1570700018, "post_id": 58317491, "comment_id": 102998758, "body": "It is correct. Please read this official Datastore documentation. It is not a Go thing, it is a Datastore thing. --<a href=\"https://cloud.google.com/appengine/docs/standard/go/datastore/entities#Properties_and_value_types\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/standard/go/datastore/&hellip;</a> . It that table it shows in the Note colomn for []byte - &quot;Note indexed&quot;. Then, if you read further, there will be the phrase : &quot;Because long byte slices and long strings are not indexed.....&quot;."}, {"owner": {"reputation": 1775, "user_id": 11928088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd5f5ed70a37e684199988a6973e4da?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Tigau", "link": "https://stackoverflow.com/users/11928088/andrei-tigau"}, "reply_to_user": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "edited": false, "score": 0, "creation_date": 1570700135, "post_id": 58317491, "comment_id": 102998829, "body": "Anyhow, that is not so important. All I was suggesting is that, as projection query does not fetch with the actual entity value, in order for it to work, it may be automatically converted to string behind the scenes( as you have a string key , as I can see). So this is a possible reason for your type mismatch."}, {"owner": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "edited": false, "score": 0, "creation_date": 1570702643, "post_id": 58317491, "comment_id": 103000243, "body": "appengine go sdk had datastore.ByteString which is for byte arrays up to 1500 and that field can be indexed. In Cloud Datastore Client Library, there is no datastore.ByteArray. Instead, []byte type is used and based on the length it will be stored as either of those types. What I don&#39;t get is some rows are projected with correct type while others are not."}, {"owner": {"reputation": 1775, "user_id": 11928088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd5f5ed70a37e684199988a6973e4da?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Tigau", "link": "https://stackoverflow.com/users/11928088/andrei-tigau"}, "reply_to_user": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "edited": false, "score": 0, "creation_date": 1570719833, "post_id": 58317491, "comment_id": 103010341, "body": "I agree with you about the datastore.ByteString. But you are using []byte which are not indexed ( it is stated very clearly on Google Cloud official documentation ). Projected queries can be used only on indexed properties ( very clearly stated in the Google Cloud official documentation,also). I understand your question clearly, and the reason why your result is that way, is because you are misusing the projected queries. You cannot use projected queries on []byte."}, {"owner": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "edited": false, "score": 0, "creation_date": 1570732206, "post_id": 58317491, "comment_id": 103016230, "body": "This response seems misleading. <a href=\"https://github.com/googleapis/google-cloud-go/blob/32c4871cc0f0b65184fbf116be8651e98305a7e9/datastore/save.go#L401\" rel=\"nofollow noreferrer\">github.com/googleapis/google-cloud-go/blob/&hellip;</a> explicitly checks for []byte array size and only if it&#39;s more than 1500 and called without setting NoIndex, it throws an error."}, {"owner": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "edited": false, "score": 0, "creation_date": 1570736320, "post_id": 58317491, "comment_id": 103017967, "body": "Another documentation supporting that it is possible to project on byte arrays less than or equal to 1500, <a href=\"https://cloud.google.com/datastore/docs/concepts/queries#datastore-datastore-array-value-inequality-range-go\" rel=\"nofollow noreferrer\">cloud.google.com/datastore/docs/concepts/&hellip;</a> &quot;Projection is not supported for strings that are longer than 1500 bytes, byte arrays that have more than 1500 elements, and other properties explicitly marked as unindexed.&quot;"}, {"owner": {"reputation": 1775, "user_id": 11928088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd5f5ed70a37e684199988a6973e4da?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Tigau", "link": "https://stackoverflow.com/users/11928088/andrei-tigau"}, "reply_to_user": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "edited": false, "score": 0, "creation_date": 1570784833, "post_id": 58317491, "comment_id": 103031649, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/200695/discussion-between-andrei-tigau-and-siva\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 1775, "user_id": 11928088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd5f5ed70a37e684199988a6973e4da?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Tigau", "link": "https://stackoverflow.com/users/11928088/andrei-tigau"}, "is_accepted": false, "score": -1, "last_activity_date": 1570692097, "creation_date": 1570692097, "answer_id": 58317491, "question_id": 58291770, "link": "https://stackoverflow.com/questions/58291770/type-mismatch-with-projection-on-a-byte-property/58317491#58317491", "title": "Type mismatch with projection on a []byte property", "body": "<p>In order to understand why this works fine on normal queries and not on projection queries you might want firstly to read about what is the actual difference between those two. As it is mentioned in this <a href=\"https://stackoverflow.com/questions/51780085/projection-queries-vs-regular-queries\">post</a>:</p>\n\n<blockquote>\n  <p>Whereas \"regular\" (which I'm taking to mean SELECT * ...) queries against Cloud Datastore typically use indexes that only contain a sorted subset of the properties of the queried entities, plus pointers to the full entities, projection queries run against indexes that contain all the fields requested by the query. So it appears the significant latency gain comes from the elimination of the need to fetch the queried entities once the set of entities matching the query has been discerned via the index.</p>\n</blockquote>\n\n<p>So, basically, when you do your projection query, your queried entities are not fetched. </p>\n\n<p>As I was reading through this <a href=\"https://godoc.org/cloud.google.com/go/datastore#Property\" rel=\"nofollow noreferrer\">official documentation</a>, I found some really interesting phrases related to your question :</p>\n\n<blockquote>\n  <p>A field of slice type corresponds to a Datastore array property, except for []byte, which corresponds to a Datastore blob. If a non-array value is loaded into a slice field, the result will be a slice with one element, containing the value.</p>\n  \n  <p>Key Field\n  If the struct contains a *datastore.Key field tagged with the name \"<strong>key</strong>\", its value will be ignored on Put. When reading the Entity back into the Go struct, the field will be populated with the *datastore.Key value used to query for the Entity.</p>\n</blockquote>\n\n<p>What I understood from here is that maybe in your case, the fields are populated with the key value for that query ( string ).</p>\n\n<p>Another interesting thing that I have discoverd is that according to the <a href=\"https://cloud.google.com/appengine/docs/standard/go/datastore/entities#Properties_and_value_types\" rel=\"nofollow noreferrer\">properties and values type documentation</a> the type []byte is not indexed. And as it is told <a href=\"https://cloud.google.com/appengine/docs/standard/python/ndb/projectionqueries#Limitations_on_projections\" rel=\"nofollow noreferrer\">here</a>, unindexed properties cannot be projected. So projected queries should not work for this particular use case at all.</p>\n"}], "owner": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 119, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570692097, "creation_date": 1570557715, "last_edit_date": 1570632110, "question_id": 58291770, "link": "https://stackoverflow.com/questions/58291770/type-mismatch-with-projection-on-a-byte-property", "title": "Type mismatch with projection on a []byte property", "body": "<p>I have a struct as follows</p>\n\n<pre><code>  type MyEntity struct {\n     PF []byte `json:\"-\" datastore:\"_pf\"`\n  }\n</code></pre>\n\n<p>Querying without a Projection works fine. However, when I query with projection on \"_pf\" field, I get \"type mismatch: string versus []uint8\" error. I implemented the PropertyLoadSaver and examined the prop.Value for \"_pf\" property and found that some rows return []byte type and some return string. So, why is projected query failing with this error while non-projected queries are fine? At the moment I am resolving this by implementing PropertyLoadSaver interface and explicitly checking types and converting string type to []byte type to solve this problem.</p>\n\n<p>Here is the complete test case. This is reproduced on cloud datastore emulator. Use appropriate value for datastoreProject variable below. Rest all should directly work. You can see the behavior by inserting both entities or one of the types of the entities. The error that is displayed is</p>\n\n<pre><code>panic: datastore: cannot load field \"_pf\" into a \"tests.MyEntity\": type mismatch: string versus []uint8 [recovered]\n    panic: datastore: cannot load field \"_pf\" into a \"tests.MyEntity\": type mismatch: string versus []uint8\n</code></pre>\n\n<p>Following is the code.</p>\n\n<pre><code>type MyEntity struct {\n    PF []byte `json:\"-\" datastore:\"_pf\"`\n}\n\nfunc TestPackedField(t *testing.T) {\n    e1 := &amp;MyEntity{PF: []byte{83, 0, 0, 0, 93, 150, 154, 206, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 3}} // returns []byte on projection\n    e2 := &amp;MyEntity{PF: []byte{83, 0, 0, 0, 93, 120, 79, 87, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 3}}   // returns string on projection\n\n    ctx := context.Background()\n\n    conn, err := datastore.NewClient(ctx, datastoreProject)\n    if err != nil {\n        panic(err)\n    }\n\n    bkey := datastore.NameKey(\"Bytes\", \"bytearray\", nil)\n    if true {\n        conn.Put(ctx, bkey, e1)\n    }\n    skey := datastore.NameKey(\"Bytes\", \"string\", nil)\n    if true {\n        conn.Put(ctx, skey, e2)\n    }\n\n    q1 := datastore.NewQuery(\"Bytes\").Order(\"-_pf\").Limit(2)\n    var elfull []*MyEntity\n    if _, err := conn.GetAll(ctx, q1, &amp;elfull); err != nil {\n        panic(err)\n    }\n\n    q2 := datastore.NewQuery(\"Bytes\").Project(\"_pf\").Order(\"-_pf\").Limit(2)\n    var elprojected []*MyEntity\n    if _, err := conn.GetAll(ctx, q2, &amp;elprojected); err != nil {\n        conn.Delete(ctx, bkey)\n        conn.Delete(ctx, skey)\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570556941, "post_id": 58291508, "comment_id": 102947436, "body": "What problem did you have using a package level variable?"}, {"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570557320, "post_id": 58291508, "comment_id": 102947616, "body": "thanks, could you please show me what package level variable to use here?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1570557532, "post_id": 58291508, "comment_id": 102947712, "body": "We are referring to the same thing when mentioned that you tried a global variable.  What problem did you encounter with that approach?  Show the code."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1570565341, "creation_date": 1570565341, "answer_id": 58293397, "question_id": 58291508, "link": "https://stackoverflow.com/questions/58291508/go-udp-connection-dial-once-and-send-many/58293397#58293397", "title": "Go udp connection dial once, and send many", "body": "<p>You are almost there.  Move the setup code to a function and call it before starting the goroutines.</p>\n\n<pre><code>func main() {\n    if err := setupLog(); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"Hello\")\n    ... same as before\n}\n\nfunc setupLog() error {\n    fmt.Println(\"Setting up myconn!\")\n    RemoteAddr, err := net.ResolveUDPAddr(\"udp\", udp_dest)\n    if err != nil {\n        return err\n    }\n    myconn, err = net.DialUDP(\"udp\", nil, RemoteAddr)\n    return err\n}\n\nfunc log_message(message *string) {\n    udp_message := fmt.Sprintf(\"&lt;30&gt; %s\", *message)\n    Bytes, _ := myconn.Write([]byte(udp_message))\n    log.Printf(\"Sent %d Bytes to %s\\n\", Bytes, udp_dest)\n}\n</code></pre>\n\n<p>The code in the question does not work because there's a data race on <code>myconn</code>.  </p>\n"}], "owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570565341, "creation_date": 1570556622, "last_edit_date": 1570563247, "question_id": 58291508, "link": "https://stackoverflow.com/questions/58291508/go-udp-connection-dial-once-and-send-many", "title": "Go udp connection dial once, and send many", "body": "<p>please consider this code below, it is a simplified version of a service. I launch a no. of goroutines as needed during its lifetime, and as they go about doing things, they need to send udp messages to a set destination. </p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"log\"\n        \"net\"\n        \"time\"\n)\n\nconst (\n        udp_dest = \"192.168.1.200:514\"\n)\n\nfunc main() {\n        fmt.Println(\"Hello\")\n        message := \"this is a test\"\n        log_message(&amp;message)\n        go worker(1)\n        go worker(2)\n        go worker(3)\n        go worker(4)\n        time.Sleep(3009 * time.Second)\n}\n\nfunc log_message(message *string) {\n        RemoteAddr, err := net.ResolveUDPAddr(\"udp\", udp_dest)\n        if err != nil {\n                //fmt.Println(\"Err,  net.ResolveUDPAddr\", err)\n                return\n        }\n        conn, err := net.DialUDP(\"udp\", nil, RemoteAddr)\n        if err != nil {\n                return\n        }\n        udp_message := fmt.Sprintf(\"&lt;30&gt; %s\", *message)\n        Bytes, _ := conn.Write([]byte(udp_message))\n        log.Printf(\"Sent %d Bytes to %s\\n\", Bytes, udp_dest)\n}\n\nfunc worker(tag int) {\n        i := 0\n        for {\n                worker_message := fmt.Sprintf(\"Some message from worker%d, loop: %d\", tag, i)\n                log_message(&amp;worker_message)\n                // do some work..\n                time.Sleep(300 * time.Second)\n                i += 1\n        }\n}\n</code></pre>\n\n<p>In my <code>log_message</code>, everytime it gets called we're calling <code>net.DialUDP</code> which I feel is wasteful. I tried experimenting with global variables <code>&amp;net.UDPConn</code> et al, but could not get to work.</p>\n\n<p>Please show how to achieve/optimize this? There's only one UDP destination, and I'd like the daemon to <code>Dial</code> once at its start, and then just <code>Write</code> as needed. </p>\n\n<p>Thanks!</p>\n\n<hr>\n\n<p>here's what I got so far:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"log\"\n        \"net\"\n        \"time\"\n)\n\nconst (\n        udp_dest = \"192.168.1.200:514\"\n)\n\nvar (\n        myconn *net.UDPConn\n)\n\nfunc main() {\n        fmt.Println(\"Hello\")\n        message := \"this is a test\"\n        log_message(&amp;message)\n        go worker(1)\n        go worker(2)\n        go worker(3)\n        go worker(4)\n        time.Sleep(3009 * time.Second)\n}\n\nfunc log_message(message *string) {\n\n        if myconn == nil {\n\n                fmt.Println(\"Setting up myconn!\")\n                RemoteAddr, err := net.ResolveUDPAddr(\"udp\", udp_dest)\n                if err != nil {\n                        //fmt.Println(\"Err,  net.ResolveUDPAddr\", err)\n                        return\n                }\n                myconn, err = net.DialUDP(\"udp\", nil, RemoteAddr)\n\n                if err != nil {\n                        return\n                }\n        }\n\n        udp_message := fmt.Sprintf(\"&lt;30&gt; %s\", *message)\n        Bytes, _ := myconn.Write([]byte(udp_message))\n        log.Printf(\"Sent %d Bytes to %s\\n\", Bytes, udp_dest)\n}\n\nfunc worker(tag int) {\n        i := 0\n        for {\n                worker_message := fmt.Sprintf(\"Some message from worker%d, loop: %d\", tag, i)\n                log_message(&amp;worker_message)\n                // do some work..\n                time.Sleep(10 * time.Second)\n                i += 1\n        }\n}\n</code></pre>\n"}, {"tags": ["mysql", "sql", "go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1570550743, "post_id": 58289676, "comment_id": 102944625, "body": "Does that even compile? To pass args to <code>tx.Exec(string,...interface{})</code>, you should create an <code>args:=[]interface{}{ all known params }</code>, then append all elements of []string in a for loop, and pass  <code>args...</code>."}, {"owner": {"reputation": 441, "user_id": 7022570, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfc0519d31ed01850ea8f6940aee08fa?s=128&d=identicon&r=PG&f=1", "display_name": "Zander Wong", "link": "https://stackoverflow.com/users/7022570/zander-wong"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570550876, "post_id": 58289676, "comment_id": 102944689, "body": "thx, Im trying now"}], "answers": [{"comments": [{"owner": {"reputation": 394, "user_id": 4794989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kl1aC.jpg?s=128&g=1", "display_name": "Alireza Bashiri", "link": "https://stackoverflow.com/users/4794989/alireza-bashiri"}, "edited": false, "score": 0, "creation_date": 1570554184, "post_id": 58290824, "comment_id": 102946212, "body": "If that&#39;s the case why wouldn&#39;t he take a <code>arr {}interface</code> at the first place?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 394, "user_id": 4794989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kl1aC.jpg?s=128&g=1", "display_name": "Alireza Bashiri", "link": "https://stackoverflow.com/users/4794989/alireza-bashiri"}, "edited": false, "score": 0, "creation_date": 1570554465, "post_id": 58290824, "comment_id": 102946342, "body": "I do not understand this question."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1570553756, "creation_date": 1570553756, "answer_id": 58290824, "question_id": 58289676, "link": "https://stackoverflow.com/questions/58289676/how-to-bind-multi-variables-and-slice-variable-at-the-same-time-in-go-when-excut/58290824#58290824", "title": "how to bind multi-variables and slice variable at the same time in go when excute mysql update sql stament like update .. where .. in?", "body": "<p>Since you have a fixed number of arguments and a variadic one, you have to collect them all into an array, and pass them because go variadics cannot deal with what you're trying to do:</p>\n\n<pre><code>args:=[]interface{}{foo,baz,bar}\nfor _,x:=range pars {\n  args=append(args,x)\n}\ntx.Exec(stmt,args...)\n</code></pre>\n"}], "owner": {"reputation": 441, "user_id": 7022570, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfc0519d31ed01850ea8f6940aee08fa?s=128&d=identicon&r=PG&f=1", "display_name": "Zander Wong", "link": "https://stackoverflow.com/users/7022570/zander-wong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 0, "accepted_answer_id": 58290824, "answer_count": 1, "score": 0, "last_activity_date": 1570553860, "creation_date": 1570549041, "last_edit_date": 1570550119, "question_id": 58289676, "link": "https://stackoverflow.com/questions/58289676/how-to-bind-multi-variables-and-slice-variable-at-the-same-time-in-go-when-excut", "title": "how to bind multi-variables and slice variable at the same time in go when excute mysql update sql stament like update .. where .. in?", "body": "<p>I have some string variables and a slice variable as SQL params in golang, but got errors <code>corresponding parameter is non-variadic</code> returned when I attempt to execute.<br>\nso how can I bind these variables in this case? </p>\n\n<p><strong>mysql connector</strong>: go-sql-driver/mysql<br>\n<strong>fake code</strong>:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func UpdateTblNm (foo, baz string, bar int, pars []string) error {\n    stmt:= `update tbl_nm set foo=?, bar=? where baz=? and par in (?`+ strings.Repeat(\", ?\", len(pars)-1) + `)`\n    if _, err := tx.Exec(stmt, foo, bar, baz, pars...); err!=nil {\n        return err\n    }\n    ... ...\n}\n</code></pre>\n\n<p>im new guy of gopher..<br>\nHoping your help, thx</p>\n"}, {"tags": ["go", "url", "browser", "command"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1570540546, "post_id": 58286846, "comment_id": 102938976, "body": "Simple answer: no."}, {"owner": {"reputation": 1828, "user_id": 3236818, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c8c062d0722ae02e3b5fafe312528b9e?s=128&d=identicon&r=PG&f=1", "display_name": "tharinduwijewardane", "link": "https://stackoverflow.com/users/3236818/tharinduwijewardane"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1570544211, "post_id": 58286846, "comment_id": 102941167, "body": "no workarounds?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1570546703, "post_id": 58286846, "comment_id": 102942614, "body": "See <a href=\"https://dwheeler.com/essays/open-files-urls.html\" rel=\"nofollow noreferrer\">dwheeler.com/essays/open-files-urls.html</a> which was the first result I got searching Google for <code>browse to a URL by command line</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1570551023, "post_id": 58286846, "comment_id": 102944754, "body": "@tharinduwijewardane I didn&#39;t downvote, there&#39;s no for rage capslock. Good luck."}], "answers": [{"comments": [{"owner": {"reputation": 1828, "user_id": 3236818, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c8c062d0722ae02e3b5fafe312528b9e?s=128&d=identicon&r=PG&f=1", "display_name": "tharinduwijewardane", "link": "https://stackoverflow.com/users/3236818/tharinduwijewardane"}, "edited": false, "score": 0, "creation_date": 1570587726, "post_id": 58288624, "comment_id": 102955842, "body": "Thank you for your detailed answer. I am sure someone will benefit from it. But my requirement is to open the url in a CLI application which runs on an user&#39;s machine. I cannot be sure he has installed chrome on it."}], "tags": [], "owner": {"reputation": 1360, "user_id": 923275, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bdff2cc237e0f423706563be675e6648?s=128&d=identicon&r=PG", "display_name": "17xande", "link": "https://stackoverflow.com/users/923275/17xande"}, "is_accepted": false, "score": 1, "last_activity_date": 1570546578, "last_edit_date": 1570546578, "creation_date": 1570545501, "answer_id": 58288624, "question_id": 58286846, "link": "https://stackoverflow.com/questions/58286846/how-to-open-an-url-in-a-browser-with-an-authentication-header/58288624#58288624", "title": "How to open an URL in a browser with an authentication header?", "body": "<p>If you're using Chrome, you could use <a href=\"https://chromedevtools.github.io/devtools-protocol/\" rel=\"nofollow noreferrer\">Chrome DevTools Protocol</a> to attach to a running Chrome instance and issue a command to navigate to a URL with specific headers.</p>\n\n<p>First, Launch Chrome with Chrome Devtools Protocol enabled by using the flag <code>--remote-debugging-port=9222</code></p>\n\n<p>You'll get a response similar to <code>DevTools listening on ws://127.0.0.1:9222/devtools/browser/2393d6e8-a85d-40a2-a79e-13f1585ff336</code></p>\n\n<p>Pass that <code>ws://...</code> URL into the program below:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"flag\"\n    \"log\"\n\n    \"github.com/chromedp/cdproto/network\"\n    \"github.com/chromedp/chromedp\"\n)\n\nfunc main() {\n    var devToolWsURL string\n    flag.StringVar(&amp;devToolWsURL, \"devtools-ws-url\", \"\", \"DevTools Websocket URL\")\n    flag.Parse()\n\n    // Create contexts.\n    actxt, cancelActxt := chromedp.NewRemoteAllocator(context.Background(), devToolWsURL)\n    defer cancelActxt()\n\n    // Create new tab.\n    ctxt, _ := chromedp.NewContext(actxt)\n\n    // Custom header.\n    headers := map[string]interface{}{\n        \"X-Header\": \"my request header\",\n    }\n\n    task := chromedp.Tasks{\n        network.Enable(),\n        network.SetExtraHTTPHeaders(network.Headers(headers)),\n        chromedp.Navigate(\"http://google.com\"),\n    }\n\n    // Run task.\n    err := chromedp.Run(ctxt, task)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p><strong>Notes:</strong></p>\n\n<ul>\n<li>9222 is the default port for this protocol but you can use any port\nyou want.</li>\n<li>I didn't include the <code>exec.Command</code> code for brevity.</li>\n</ul>\n\n<p><strong>References:</strong></p>\n\n<ul>\n<li><a href=\"https://github.com/chromedp/examples/blob/master/headers/main.go\" rel=\"nofollow noreferrer\">Header example</a></li>\n<li><a href=\"https://github.com/chromedp/examples/blob/master/remote/main.go\" rel=\"nofollow noreferrer\">Remote Chrome control example</a></li>\n</ul>\n\n<p><strong>UPDATE</strong></p>\n\n<p><a href=\"https://github.com/chromedp/chromedp/issues/422#issuecomment-511176490\" rel=\"nofollow noreferrer\">Found a simpler way</a>. You can just launch Chrome straight from <code>chromedp</code> by overriding the default <em>headless</em> option:</p>\n\n<pre><code>func main() {\n    // Create contexts.\n    opts := append(chromedp.DefaultExecAllocatorOptions[:], chromedp.Flag(\"headless\", false))\n    actx, cancel := chromedp.NewExecAllocator(context.Background(), opts...)\n    ctx, cancel := chromedp.NewContext(actx)\n\n    // Call cancel() to close Chrome on some condition.\n    if false {\n        cancel()\n    }\n\n    // Custom header.\n    headers := map[string]interface{}{\n        \"X-Header\": \"my request header\",\n    }\n\n    task := chromedp.Tasks{\n        network.Enable(),\n        network.SetExtraHTTPHeaders(network.Headers(headers)),\n        chromedp.Navigate(\"http://tested.com\"),\n    }\n\n    // Run task.\n    err := chromedp.Run(ctx, task)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1828, "user_id": 3236818, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c8c062d0722ae02e3b5fafe312528b9e?s=128&d=identicon&r=PG&f=1", "display_name": "tharinduwijewardane", "link": "https://stackoverflow.com/users/3236818/tharinduwijewardane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1327, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1598511630, "creation_date": 1570539550, "question_id": 58286846, "link": "https://stackoverflow.com/questions/58286846/how-to-open-an-url-in-a-browser-with-an-authentication-header", "title": "How to open an URL in a browser with an authentication header?", "body": "<p>In Golang we can launch a browser window to open an URL using <code>exec.Command</code> method. An example can be found <a href=\"https://gist.github.com/hyg/9c4afcd91fe24316cbf0\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>My question is how can we open that URL with a header?</p>\n"}, {"tags": ["docker", "go", "ssl", "kubernetes"], "comments": [{"owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "edited": false, "score": 0, "creation_date": 1570548175, "post_id": 58285332, "comment_id": 102943371, "body": "you can use <code>acme&#47;autocert</code> to setup renewing TLS certificates by simply adding a bit of logic to an existing server. Here is a decent explanation: <a href=\"https://blog.kowalczyk.info/article/Jl3G/https-for-free-in-go-with-little-help-of-lets-encrypt.html\" rel=\"nofollow noreferrer\">blog.kowalczyk.info/article/Jl3G/&hellip;</a> I&#39;m not familiar with kubernetes, but using docker volumes you can share the certificate between other docker services easily"}], "answers": [{"tags": [], "owner": {"reputation": 4854, "user_id": 11714114, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qKzVA.jpg?s=128&g=1", "display_name": "mario", "link": "https://stackoverflow.com/users/11714114/mario"}, "is_accepted": false, "score": 0, "last_activity_date": 1570725226, "creation_date": 1570725226, "answer_id": 58327427, "question_id": 58285332, "link": "https://stackoverflow.com/questions/58285332/ssl-with-tcp-connection-on-kubernetes/58327427#58327427", "title": "SSL with TCP connection on Kubernetes?", "body": "<p>As you can read in the <a href=\"https://kubernetes.io/docs/concepts/services-networking/ingress/#what-is-ingress\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>An Ingress does not expose arbitrary ports or protocols. Exposing\n  services other than HTTP and HTTPS to the internet typically uses a\n  service of type <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/#nodeport\" rel=\"nofollow noreferrer\">Service.Type=NodePort</a> or <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer\" rel=\"nofollow noreferrer\">Service.Type=LoadBalancer</a>.</p>\n</blockquote>\n\n<p>Depending on the platform you are using you have different kind of <code>LoadBalancers</code> available which you can use to terminate your SSL traffic. If you have <strong>on-premise cluster</strong> you can set up additional <strong>nginx</strong> or <strong>haproxy</strong> server before your Kubernetes cluster which will handle SSL traffic.</p>\n"}], "owner": {"reputation": 171, "user_id": 4040546, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/513f200fdf77efd25af432f5a87551a7?s=128&d=identicon&r=PG&f=1", "display_name": "Yako", "link": "https://stackoverflow.com/users/4040546/yako"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570725226, "creation_date": 1570533491, "question_id": 58285332, "link": "https://stackoverflow.com/questions/58285332/ssl-with-tcp-connection-on-kubernetes", "title": "SSL with TCP connection on Kubernetes?", "body": "<p>I'm running a TCP server (Docker instance / Go) on Kubernetes.. It's working and clients can connect and do intended stuff. I would like to make the TCP connection secure with an SSL certificate. I already got SSL working with a HTTP Rest API service running on the same Kubernetes cluster by using ingress controllers, but I'm not sure how to set it up with a regular TCP connection. Can anyone point me in the right direction ? </p>\n"}, {"tags": ["docker", "go", "protobuf-go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570609060, "post_id": 58282660, "comment_id": 102962376, "body": "<i>sigh</i> <code>sudo</code> is not the *NIX way of  \u201eI really mean what I am saying.\u201c It changes your euid to 0, making the process you start running as superuser. The docker image you are using obviously runs as root, hence the files generated by it belong to root (0==0 about everywhere ;)). Simply do a <code>sudo chown yourUser:yourGroup -r gen</code>"}, {"owner": {"reputation": 815, "user_id": 3497437, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/1cb53d3fad95ea4db4d8a9506527c233?s=128&d=identicon&r=PG&f=1", "display_name": "EI-01", "link": "https://stackoverflow.com/users/3497437/ei-01"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570686480, "post_id": 58282660, "comment_id": 102992475, "body": "@MarkusWMahlberg but it seems i will have to run this command <code>sudo chown yourUser:yourGroup -r gen</code> everytime i run the script which will override the user."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570689806, "post_id": 58282660, "comment_id": 102993803, "body": "That is inherent by the use of Prototool from within a docker container. Simply add the chown part to your script or use one of the other installation methods."}, {"owner": {"reputation": 815, "user_id": 3497437, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/1cb53d3fad95ea4db4d8a9506527c233?s=128&d=identicon&r=PG&f=1", "display_name": "EI-01", "link": "https://stackoverflow.com/users/3497437/ei-01"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1571461066, "post_id": 58282660, "comment_id": 103257663, "body": "@MarkusWMahlberg what other installation methods are you referring to?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1571487042, "post_id": 58282660, "comment_id": 103262525, "body": "<a href=\"https://github.com/uber/prototool/blob/dev/docs/install.md\" rel=\"nofollow noreferrer\">github.com/uber/prototool/blob/dev/docs/install.md</a>"}], "owner": {"reputation": 815, "user_id": 3497437, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/1cb53d3fad95ea4db4d8a9506527c233?s=128&d=identicon&r=PG&f=1", "display_name": "EI-01", "link": "https://stackoverflow.com/users/3497437/ei-01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 370, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1570523093, "creation_date": 1570523093, "question_id": 58282660, "link": "https://stackoverflow.com/questions/58282660/permission-denied-when-attempting-to-access-generated-protobufs-using-uber-proto", "title": "Permission denied when attempting to access generated protobufs using Uber Prototool", "body": "<p>I am attempting to play around with <a href=\"https://github.com/uber/prototool\" rel=\"nofollow noreferrer\">https://github.com/uber/prototool</a> that i came across. I created a simple repo called <code>protobufs</code> and wrote a simple script to generate my proto files in a docker container that pulls the image <code>uber-prototool. \nCode in</code>generate.sh` file:</p>\n\n<pre><code>#!/bin/bash\n\nrm -rf gen\n\necho Generating Go code for all repos...\n\ndocker run --rm -v \"$(pwd):/work\" \"uber/prototool:1.8.0\" prototool generate proto\n</code></pre>\n\n<p>and also have a prototool.yaml file that looks like</p>\n\n<pre><code>excludes:\n  - node_modules\n\nprotoc:\n  version: 3.8.0\n\nlint:\n  group: uber2\n\n  file_header:\n    content: |\n      //\n      //\n      //\n    is_commented: true\n\ngenerate:\n  plugins:\n    - name: go\n      output: ../gen/go\n      flags: plugins=grpc\n</code></pre>\n\n<p>I successfully generate the proto files but i get a <code>Permission Denied</code> when attempting to <code>cd</code> into the generated folder called <code>gen</code>. It's a hidden file and only can have access when i use <code>sudo</code>. It fails to show the hidden folder in <code>vscode</code> as well. I don't want to have to sudo into the hidden folder all the time and rather want a non root user to have access. How can i solve this?</p>\n\n<p>Here is a screenshot of the repo being generated as a root user:\n<a href=\"https://i.stack.imgur.com/0hBjx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0hBjx.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["git", "go", "git-lfs", "go-modules"], "comments": [{"owner": {"reputation": 900, "user_id": 2761930, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c838e9dc1d38f75c5c559078f242e493?s=128&d=identicon&r=PG&f=1", "display_name": "kuba_ceg", "link": "https://stackoverflow.com/users/2761930/kuba-ceg"}, "edited": false, "score": 0, "creation_date": 1570519142, "post_id": 58280942, "comment_id": 102928974, "body": "How did You add LDS module to go.mod? By <code>go get</code> command? DId You use LFS module in Your code? When I add dependencies to my code i make only <code>go get</code> and than I can use this module in code."}, {"owner": {"reputation": 1781, "user_id": 548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e23a341ace069bf45ba72f0fa9ef66c?s=128&d=identicon&r=PG", "display_name": "Ramiro Berrelleza", "link": "https://stackoverflow.com/users/548/ramiro-berrelleza"}, "reply_to_user": {"reputation": 900, "user_id": 2761930, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c838e9dc1d38f75c5c559078f242e493?s=128&d=identicon&r=PG&f=1", "display_name": "kuba_ceg", "link": "https://stackoverflow.com/users/2761930/kuba-ceg"}, "edited": false, "score": 0, "creation_date": 1570555542, "post_id": 58280942, "comment_id": 102946813, "body": "No, in my repo I&#39;m not using LFS. The dependency I want to import into my go project is the one that&#39;s using LFS. It&#39;s something similar to <a href=\"https://github.com/coconaut/gobig\" rel=\"nofollow noreferrer\">github.com/coconaut/gobig</a>, but imagine that <a href=\"https://github.com/coconaut/gobig/blob/master/models/big_binary_1.bin\" rel=\"nofollow noreferrer\">github.com/coconaut/gobig/blob/master/models/big_binary_1.bi&zwnj;&#8203;n</a> is an actual go class, so it&#39;s needed during build."}], "answers": [{"comments": [{"owner": {"reputation": 1781, "user_id": 548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e23a341ace069bf45ba72f0fa9ef66c?s=128&d=identicon&r=PG", "display_name": "Ramiro Berrelleza", "link": "https://stackoverflow.com/users/548/ramiro-berrelleza"}, "edited": false, "score": 0, "creation_date": 1570585963, "post_id": 58293235, "comment_id": 102955571, "body": "Where does <code>git lfs install</code> needs to be installed? In the repo or is it a computer-wide setting?"}, {"owner": {"reputation": 30588, "user_id": 8705432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14e0f95975d80525786e419222821ff4?s=128&d=identicon&r=PG&f=1", "display_name": "bk2204", "link": "https://stackoverflow.com/users/8705432/bk2204"}, "reply_to_user": {"reputation": 1781, "user_id": 548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e23a341ace069bf45ba72f0fa9ef66c?s=128&d=identicon&r=PG", "display_name": "Ramiro Berrelleza", "link": "https://stackoverflow.com/users/548/ramiro-berrelleza"}, "edited": false, "score": 0, "creation_date": 1570611016, "post_id": 58293235, "comment_id": 102963407, "body": "<code>git lfs install --skip-repo</code> will install its configuration into your <code>~&#47;.gitconfig</code>, so it can run from anywhere.  It&#39;s per-user; if you want a system-wide setting, add <code>--system</code> and run it with appropriate privileges."}], "tags": [], "owner": {"reputation": 30588, "user_id": 8705432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14e0f95975d80525786e419222821ff4?s=128&d=identicon&r=PG&f=1", "display_name": "bk2204", "link": "https://stackoverflow.com/users/8705432/bk2204"}, "is_accepted": false, "score": 0, "last_activity_date": 1570564564, "creation_date": 1570564564, "answer_id": 58293235, "question_id": 58280942, "link": "https://stackoverflow.com/questions/58280942/import-a-golang-module-with-lfs-objects/58293235#58293235", "title": "Import a golang module with LFS objects", "body": "<p>Assuming <code>go get</code> uses the standard Git commands to download and fetch repositories, it should be sufficient to have installed Git LFS and run <code>git lfs install</code>.  That will install the Git filter configuration that Git LFS needs in your per-user Git configuration and then cloning or pulling the changes should result in the proper LFS files being checked out.</p>\n\n<p>You may also want to use the <code>--skip-repo</code> option if you run the command outside of a repository.</p>\n"}], "owner": {"reputation": 1781, "user_id": 548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e23a341ace069bf45ba72f0fa9ef66c?s=128&d=identicon&r=PG", "display_name": "Ramiro Berrelleza", "link": "https://stackoverflow.com/users/548/ramiro-berrelleza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 292, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1570564564, "creation_date": 1570514759, "question_id": 58280942, "link": "https://stackoverflow.com/questions/58280942/import-a-golang-module-with-lfs-objects", "title": "Import a golang module with LFS objects", "body": "<p>I need to import a module with LFS objects into my go project. I already added the module to <code>go.mod</code>, but when the go tools download the dependencies into my <code>~/go/pkg/...</code> folder, the LFS objects are not downloaded. Instead of the full object, I get the LFS metadata.  This causes my build to fail.</p>\n\n<p>I already went through the <code>go get</code> and <code>go mod</code> docs but couldn't find anything on this topic. The only workaround I've found to far is to manually download the files post  <code>go mod download</code>, but I'm looking for a more official solution.</p>\n"}, {"tags": ["go", "ssl", "https", "proxy", "request"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1570507896, "post_id": 58280066, "comment_id": 102925950, "body": "What error did you get? You didn&#39;t include the actual client.Do(request) call, does it fail there, or does it fail at request creation?"}, {"owner": {"reputation": 11, "user_id": 12180127, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fTGrV.png?s=128&g=1", "display_name": "wagdev", "link": "https://stackoverflow.com/users/12180127/wagdev"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570508245, "post_id": 58280066, "comment_id": 102926016, "body": "It&#39;s timeout error, I test again and then paste the error string here."}, {"owner": {"reputation": 11, "user_id": 12180127, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fTGrV.png?s=128&g=1", "display_name": "wagdev", "link": "https://stackoverflow.com/users/12180127/wagdev"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570508647, "post_id": 58280066, "comment_id": 102926102, "body": "I&#39;v got this error. &quot;net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)&quot;"}, {"owner": {"reputation": 2953, "user_id": 5133088, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d0efad94ced5dcd194c0a482cafd4f7b?s=128&d=identicon&r=PG&f=1", "display_name": "Jeroen Heier", "link": "https://stackoverflow.com/users/5133088/jeroen-heier"}, "edited": false, "score": 0, "creation_date": 1570508762, "post_id": 58280066, "comment_id": 102926117, "body": "Add the request call to your code."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 1, "creation_date": 1570511129, "post_id": 58280066, "comment_id": 102926562, "body": "Are you sure that the proxy URL is <code>https:&#47;&#47;</code> and not <code>http:&#47;&#47;</code>? HTTPS is typically tunneled via <code>http:&#47;&#47;</code> proxy (single end-to-end-encryption through proxy-generated tunnel), not via <code>https:&#47;&#47;</code> proxy (connection to proxy is additionally encrypted, not only connection from client to server)."}, {"owner": {"reputation": 11, "user_id": 12180127, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fTGrV.png?s=128&g=1", "display_name": "wagdev", "link": "https://stackoverflow.com/users/12180127/wagdev"}, "edited": false, "score": 0, "creation_date": 1570511759, "post_id": 58280066, "comment_id": 102926714, "body": "the proxy is support https, and tested it with python, it works good. but golang doesn&#39;t work."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570518362, "post_id": 58280066, "comment_id": 102928660, "body": "Uhm, just to be precise: It is your code that is not working, not Go."}, {"owner": {"reputation": 900, "user_id": 2761930, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c838e9dc1d38f75c5c559078f242e493?s=128&d=identicon&r=PG&f=1", "display_name": "kuba_ceg", "link": "https://stackoverflow.com/users/2761930/kuba-ceg"}, "edited": false, "score": 1, "creation_date": 1570518758, "post_id": 58280066, "comment_id": 102928823, "body": "Paste your Python code maybe we&#39;ll spot the difference"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570519346, "post_id": 58280066, "comment_id": 102929055, "body": "Furthermore, this is just a code excerpt. Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}], "owner": {"reputation": 11, "user_id": 12180127, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fTGrV.png?s=128&g=1", "display_name": "wagdev", "link": "https://stackoverflow.com/users/12180127/wagdev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 681, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1573073641, "creation_date": 1570507551, "last_edit_date": 1570519282, "question_id": 58280066, "link": "https://stackoverflow.com/questions/58280066/http-request-through-https-proxy-in-go-doesnt-work", "title": "HTTP request through https Proxy in Go doesn&#39;t work", "body": "<p>I'm going to send http request via ssl proxy in Go.\nUnfortunately, it always fails. Here is my code I have tried.</p>\n\n<pre><code>proxyUrl, err := url.Parse(\"https://\" + proxyURLStr)\n\ntransport := &amp;http.Transport{\n    Proxy: http.ProxyURL(proxyUrl),\n}\n\n//adding the Transport object to the http Client\nclient := &amp;http.Client{\n    Transport: transport,\n    Timeout:   60 * time.Second,\n}\n\nrequest, err := http.NewRequest(\"GET\", \"https://test.com\", nil)\nif err != nil {\n    log.Print(\"Create Request Error - test.com \")\n    return -2, invalid_data\n}\n\nrandom_agent := browser.Random()\nrequest.Header.Set(\"User-Agent\", random_agent)\n\n// Make request\nresponse, err := client.Do(request)\nif err != nil {\n    log.Println(err)\n    current := time.Now()\n    elapsed := current.Sub(start)\n    log.Printf(\"test.com is not available. %02d, %02d \", int(elapsed.Minutes()), int(elapsed.Seconds()))\n    return -2, invalid_data\n}\n</code></pre>\n\n<p>I get this error:</p>\n\n<blockquote>\n  <p>net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)</p>\n</blockquote>\n\n<p>I coded the same function in Python and tested it \u2014 works good.\nBut the Go code does not work.</p>\n"}, {"tags": ["go", "goa"], "answers": [{"tags": [], "owner": {"reputation": 788, "user_id": 6661361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfa148415c5b15036813bc3a60128a68?s=128&d=identicon&r=PG", "display_name": "Gerardo Roza", "link": "https://stackoverflow.com/users/6661361/gerardo-roza"}, "is_accepted": true, "score": 1, "last_activity_date": 1570927372, "creation_date": 1570927372, "answer_id": 58359728, "question_id": 58279707, "link": "https://stackoverflow.com/questions/58279707/using-multipartrequest-to-upload-file/58359728#58359728", "title": "Using MultipartRequest to upload file", "body": "<p>Ok, I finally understood how the <code>multipart.Reader</code> works, and I came up with a solution.</p>\n\n<p>First let's clarify that differently from how Goa usually works (mapping 'automatically' the requests params with the <code>Payload</code> fields), with <code>MultipartRequest()</code>, I have to make the mapping on my own, so the <code>Payload</code> can actually have any structure.</p>\n\n<p>In my case, I re-defined my <code>Payload</code> structure as follows:</p>\n\n<pre><code>// ImageUpload single image upload element\nvar ImageUpload = Type(\"ImageUpload\", func() {\n    Description(\"A single Image Upload type\")\n    Attribute(\"type\", String)\n    Attribute(\"bytes\", Bytes)\n    Attribute(\"name\", String)\n})\n\n// ImageUploadPayload is a list of files\nvar ImageUploadPayload = Type(\"ImageUploadPayload\", func() {\n    Description(\"Image Upload Payload\")\n\n    Attribute(\"Files\", ArrayOf(ImageUpload), \"Collection of uploaded files\")\n})\n</code></pre>\n\n<p>In a nutshell, I want to support uploading several files, each with its mime-type, filename and data.</p>\n\n<p>To achieve this, I implemented the <code>multipart.go</code> decoder function like this:</p>\n\n<pre><code>func ImagesUploadDecoderFunc(mr *multipart.Reader, p **images.ImageUploadPayload) error {\n    res := images.ImageUploadPayload{}\n\n    for {\n        p, err := mr.NextPart()\n        if err == io.EOF {\n            break\n        }\n\n        if err != nil {\n            fmt.Fprintln(os.Stderr, err)\n            return err\n        }\n\n        _, params, err := mime.ParseMediaType(p.Header.Get(\"Content-Disposition\"))\n        if err != nil {\n            // can't process this entry, it probably isn't an image\n            continue\n        }\n\n        disposition, _, err := mime.ParseMediaType(p.Header.Get(\"Content-Type\"))\n        // the disposition can be, for example 'image/jpeg' or 'video/mp4'\n        // I want to support only image files!\n        if err != nil || !strings.HasPrefix(disposition, \"image/\") {\n            // can't process this entry, it probably isn't an image\n            continue\n        }\n\n        if params[\"name\"] == \"file\" {\n            bytes, err := ioutil.ReadAll(p)\n            if err != nil {\n                // can't process this entry, for some reason\n                fmt.Fprintln(os.Stderr, err)\n                continue\n            }\n            filename := params[\"filename\"]\n            imageUpload := images.ImageUpload{\n                Type:  &amp;disposition,\n                Bytes: bytes,\n                Name:  &amp;filename,\n            }\n            res.Files = append(res.Files, &amp;imageUpload)\n        }\n    }\n    *p = &amp;res\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 788, "user_id": 6661361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfa148415c5b15036813bc3a60128a68?s=128&d=identicon&r=PG", "display_name": "Gerardo Roza", "link": "https://stackoverflow.com/users/6661361/gerardo-roza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 58359728, "answer_count": 1, "score": 1, "last_activity_date": 1570927372, "creation_date": 1570504020, "last_edit_date": 1570518915, "question_id": 58279707, "link": "https://stackoverflow.com/questions/58279707/using-multipartrequest-to-upload-file", "title": "Using MultipartRequest to upload file", "body": "<p>I'm using Goa v3 to design an endpoint that allows me to upload files (more precisely, images) with a <code>multipart/form-data</code> POST request.\nI have declared the following <code>Service</code>:</p>\n\n<pre><code>var _ = Service(\"images\", func() {\n    HTTP(func() {\n        Path(\"/images\")\n    })\n\n    Method(\"upload\", func() {  \n        HTTP(func() {\n            POST(\"/\")\n            MultipartRequest()\n        })\n\n        Payload(func() {\n            Description(\"Multipart request Payload\")\n            Attribute(\"File\", Bytes, \"File\")\n        })\n\n        Result(ImageList)\n    })\n})\n</code></pre>\n\n<p>I run the <code>goa gen</code> and the <code>goa example</code> commands to generate the boilerplate code. Apart from the <code>cmd</code> directory, the <code>example</code> code generates the <code>images.go</code> main file and a <code>multipart.go</code> file to declare the encoder and decoder logic, e.g.:</p>\n\n<pre><code>func ImagesUploadDecoderFunc(mr *multipart.Reader, p **images.UploadPayload) error {\n    // Add multipart request decoder logic here\n    return nil\n}\n</code></pre>\n\n<p>I can use the <code>mr.NextPart()</code> and obtain a reference to the image file apparently, but I'm still not sure how should I map this to the <code>Bytes</code> field in the <code>images.UploadPayload</code> type (or maybe I should declare another type of field to handle Files??).</p>\n\n<p>I can't find any example in the Goa documentation.</p>\n"}, {"tags": ["go", "winapi", "native"], "answers": [{"tags": [], "owner": {"reputation": 6168, "user_id": 10611792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r727s.jpg?s=128&g=1", "display_name": "Drake Wu", "link": "https://stackoverflow.com/users/10611792/drake-wu"}, "is_accepted": false, "score": 0, "last_activity_date": 1570517259, "creation_date": 1570517259, "answer_id": 58281359, "question_id": 58278819, "link": "https://stackoverflow.com/questions/58278819/syscall-vs-call/58281359#58281359", "title": "Syscall() vs Call()?", "body": "<p>They basically don't make much difference, <code>Syscall</code> may just be a layer of encapsulation for the <code>Call</code>. Both variants have a limit on the number of parameters.</p>\n\n<pre><code>syscall.Syscall\nsyscall.Syscall6\nsyscall.Syscall9\nsyscall.Syscall12\nsyscall.Syscall15\n</code></pre>\n\n<p>Corresponding to parameters &lt;= 3/6/9/12/15.</p>\n\n<p><code>Call()</code> method has up to 15 parameters.</p>\n"}], "owner": {"reputation": 2854, "user_id": 6923555, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-N8FUb3l8l44/AAAAAAAAAAI/AAAAAAAAAio/1HlhcKxsTPo/photo.jpg?sz=128", "display_name": "rodrigocfd", "link": "https://stackoverflow.com/users/6923555/rodrigocfd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1570517259, "creation_date": 1570495579, "question_id": 58278819, "link": "https://stackoverflow.com/questions/58278819/syscall-vs-call", "title": "Syscall() vs Call()?", "body": "<p>I've been experimenting with Go and Win32, and I found these two variants for calling OS functions (code is abbreviated):</p>\n\n<pre><code>modUser32 = syscall.NewLazyDLL(\"user32.dll\")\nprocMessageBox = modUser32.NewProc(\"MessageBoxW\")\n\n// 1st variant\nsyscall.Syscall6(procMessageBox.Addr(), 4,\n    uintptr(hwnd), toUtf16(msg), toUtf16(caption), uintptr(flags),\n    0, 0)\n\n// 2nd variant\nprocMessageBox.Call(uintptr(hwnd), uintptr(hwnd),\n    toUtf16(msg), toUtf16(caption), uintptr(flags))\n</code></pre>\n\n<p>2nd variant is obviously simpler, but are there any disadvantages to it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1570494797, "post_id": 58278573, "comment_id": 102923532, "body": "&quot;this may get fixed in the future&quot;  Unlikely: <a href=\"https://golang.org/doc/go1compat\" rel=\"nofollow noreferrer\">Go 1 and the Future of Go Programs</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570543355, "post_id": 58278573, "comment_id": 102940650, "body": "The &quot;workarounds&quot; are the correct way to fix the code."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 5, "last_activity_date": 1570493504, "creation_date": 1570493504, "answer_id": 58278611, "question_id": 58278573, "link": "https://stackoverflow.com/questions/58278573/looping-over-pointers/58278611#58278611", "title": "Looping over pointers", "body": "<p>The code in the question passes the address of the local variable <code>dest</code> to the goroutines. This local variable is set on each iteration of the loop.</p>\n\n<p>Fix by passing the address of the array elements to the goroutines:</p>\n\n<pre><code>for i := range dests {\n    fmt.Println(\"dest is\", dests[i])\n    go func(dest_ptr *string) {\n        fmt.Println(\"Trying\", *dest_ptr, dest_ptr)\n    }(&amp;dests[i])\n}\n</code></pre>\n\n<p>Another approach is to create a variable on each iteration of the loop:</p>\n\n<pre><code>for _, dest := range dests {\n    dest := dest  // &lt;-- create new variable inside the loop\n    fmt.Println(\"dest is\", dest)\n    go func(dest_ptr *string) {\n        fmt.Println(\"Trying\", *dest_ptr, dest_ptr)\n    }(&amp;dest)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1570494484, "last_edit_date": 1592644375, "creation_date": 1570493767, "answer_id": 58278634, "question_id": 58278573, "link": "https://stackoverflow.com/questions/58278573/looping-over-pointers/58278634#58278634", "title": "Looping over pointers", "body": "<blockquote>\n<p><a href=\"https://golang.org/doc/faq\" rel=\"nofollow noreferrer\">Go: Frequently Asked Questions (FAQ)</a></p>\n<p><a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow noreferrer\">What happens with closures running as goroutines?</a></p>\n<p>each iteration of the loop uses the same instance of the variable v,\nso each closure shares that single variable.</p>\n</blockquote>\n<hr />\n<p>For your example, for a new variable, add the <code>dest := dest</code> statement,</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;time&quot;\n)\n\nvar (\n    dests = [...]string{&quot;word1&quot;, &quot;word2&quot;, &quot;word3&quot;, &quot;word4&quot;, &quot;word5&quot;, &quot;word6&quot;, &quot;word7&quot;, &quot;word8&quot;}\n)\n\nfunc main() {\n    fmt.Println(&quot;dests&quot;, dests)\n\n    for _, dest := range dests {\n        dest := dest\n        fmt.Println(&quot;dest is&quot;, dest)\n\n        go func(dest_ptr *string) {\n            fmt.Println(&quot;Trying&quot;, *dest_ptr, dest_ptr)\n        }(&amp;dest)\n\n    }\n\n    time.Sleep(200 * time.Second)\n}\n</code></pre>\n<p>Playground: <a href=\"https://play.golang.org/p/bDI3SB1PR7X\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bDI3SB1PR7X</a></p>\n<p>Output:</p>\n<pre><code>dests [word1 word2 word3 word4 word5 word6 word7 word8]\ndest is word1\ndest is word2\ndest is word3\ndest is word4\ndest is word5\ndest is word6\ndest is word7\ndest is word8\nTrying word1 0x40c140\nTrying word2 0x40c150\nTrying word3 0x40c160\nTrying word4 0x40c170\nTrying word5 0x40c180\nTrying word6 0x40c190\nTrying word7 0x40c1a0\nTrying word8 0x40c1b0\n</code></pre>\n"}], "owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1570519117, "creation_date": 1570493211, "last_edit_date": 1570519117, "question_id": 58278573, "link": "https://stackoverflow.com/questions/58278573/looping-over-pointers", "title": "Looping over pointers", "body": "<p>Please consider snippet <a href=\"https://play.golang.org/p/GnhA1Tgw4sz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/GnhA1Tgw4sz</a>, it is a simplified version of a problem that I ran into. My original issue was trying to send UDP messages to destinations in an array, and I noticed trouble with even distribution. </p>\n\n<p>Also, the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar (\n    dests = [...]string{\"word1\", \"word2\", \"word3\", \"word4\", \"word5\", \"word6\", \"word7\", \"word8\"}\n)\n\nfunc main() {\n    fmt.Println(\"Hello!\")\n    fmt.Println(\"dests\", dests)\n\n    for _, dest := range dests {\n        fmt.Println(\"dest is\", dest)\n\n        go func(dest_ptr *string) {\n            fmt.Println(\"Trying\", *dest_ptr, dest_ptr)\n        }(&amp;dest)\n\n    }\n\n    time.Sleep(200 * time.Second)\n}\n</code></pre>\n\n<p>When I run,</p>\n\n<pre><code>Trying word8 0x40c140\nTrying word8 0x40c140\nTrying word8 0x40c140\nTrying word8 0x40c140\nTrying word8 0x40c140\nTrying word8 0x40c140\nTrying word8 0x40c140\nTrying word8 0x40c140\n</code></pre>\n\n<p>Notice here that I am hitting <code>word8</code> all the time, likely since the <code>&amp;dest</code> gets overwritten. I know I won't have this problem without pointers, as demo'd @ <a href=\"https://play.golang.org/p/ZD9JIuvdypJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ZD9JIuvdypJ</a>. </p>\n\n<p>I'd like to use pointers, as my original problem requires it. What's the correct way to achieve this?</p>\n\n<p>Coming from C, this was a good problem to have! As I've learned, Go does not create a new variable for each iteration, this may get fixed in the future. </p>\n\n<p>here are the two workarounds,</p>\n\n<pre><code>$ cat fixa.go\npackage main\n\nimport (\n        \"fmt\"\n        \"time\"\n)\n\nvar (\n        dests = [...]string{\"word1\", \"word2\", \"word3\", \"word4\", \"word5\", \"word6\", \"word7\", \"word8\"}\n)\n\nfunc main() {\n        fmt.Println(\"Hello!\")\n        fmt.Println(\"dests\", dests)\n\n        for i := range(dests){\n                go func(dest_ptr * string){\n                        fmt.Println(\"Handling\", * dest_ptr, dest_ptr)\n                }(&amp;dests[i])\n\n        }\n\n        time.Sleep(200 * time.Second)\n}\n</code></pre>\n\n<p>and, </p>\n\n<pre><code>$ cat fixb.go\npackage main\n\nimport (\n        \"fmt\"\n        \"time\"\n)\n\nvar (\n        dests = [...]string{\"word1\", \"word2\", \"word3\", \"word4\", \"word5\", \"word6\", \"word7\", \"word8\"}\n)\n\nfunc main() {\n        fmt.Println(\"Hello!\")\n        fmt.Println(\"dests\", dests)\n\n        for _, dest := range dests {\n                dest := dest //  create a new variable, using a declaration style that may seem odd but works fine in Go: \n                go func(dest_ptr *string) {\n                        fmt.Println(\"Trying\", *dest_ptr, dest_ptr)\n                }(&amp;dest)\n        }\n\n        time.Sleep(200 * time.Second)\n}\n</code></pre>\n"}, {"tags": ["sql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 587, "user_id": 1663898, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HR2fj.jpg?s=128&g=1", "display_name": "Deslyxia", "link": "https://stackoverflow.com/users/1663898/deslyxia"}, "is_accepted": true, "score": 0, "last_activity_date": 1570636237, "creation_date": 1570636237, "answer_id": 58307911, "question_id": 58278457, "link": "https://stackoverflow.com/questions/58278457/gorm-ping-db-shards/58307911#58307911", "title": "Gorm Ping Db Shards", "body": "<p>As a follow up the syntax for this is </p>\n\n<pre><code>shard.DB().Ping()    \n</code></pre>\n"}], "owner": {"reputation": 587, "user_id": 1663898, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HR2fj.jpg?s=128&g=1", "display_name": "Deslyxia", "link": "https://stackoverflow.com/users/1663898/deslyxia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 58307911, "answer_count": 1, "score": 0, "last_activity_date": 1570636237, "creation_date": 1570492210, "last_edit_date": 1570519130, "question_id": 58278457, "link": "https://stackoverflow.com/questions/58278457/gorm-ping-db-shards", "title": "Gorm Ping Db Shards", "body": "<p>I am looking to manage a map of DB shards in my application. When utilizing GORM what is the process to actively PING all of the shards to verify connection. </p>\n\n<p>I am looking for something like :</p>\n\n<pre><code>import (\n   \"github.com.jinzhu/gorm\"\n   _ \"github.com/jinzhu/gorm/dialects/mysql\"\n\n)\n\nfor _, shard := range shardMap {\n   if err := shard.Ping() {\n      //DO SOMETHING\n   }\n}\n</code></pre>\n\n<p>The issue is that shard.Ping() isnt a thing. I feel like im missing an import somewhere. </p>\n"}, {"tags": ["pointers", "go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1570498870, "last_edit_date": 1570498870, "creation_date": 1570487661, "answer_id": 58277954, "question_id": 58277798, "link": "https://stackoverflow.com/questions/58277798/dynamic-argument-and-generic-type/58277954#58277954", "title": "Dynamic argument and Generic type", "body": "<p>You are setting the interface, not the underlying value. Instead you should do</p>\n\n<pre><code>func test(data interface{}){\n  *data.(*string) = \"aaa\"\n}\n</code></pre>\n\n<p>That is, first get the underlying string pointer, then set the string pointed by it.</p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1570542635, "post_id": 58278048, "comment_id": 102940242, "body": "Though, if you use this solution, the program will panic if <code>data</code> is not a <code>string</code>, in which case, the function <i>should</i> be <code>test(data string)</code> since that is what it expects as a parameter."}, {"owner": {"reputation": 199, "user_id": 2307766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a2e9f60431167f4112627d713249362?s=128&d=identicon&r=PG", "display_name": "Ming M Zheng", "link": "https://stackoverflow.com/users/2307766/ming-m-zheng"}, "edited": false, "score": 0, "creation_date": 1570542742, "post_id": 58278048, "comment_id": 102940312, "body": "thank you for your replay,  I am using interface{}, because I like the argument to accept any possible type,  I saw <code>json.Unmarshal(data []byte, v interface{}) </code> function in the library, and it accepts all type and persist the pointer there, I am wondering how they implement it. I am new to Golang by the way. was Java developer"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1570549029, "post_id": 58278048, "comment_id": 102943817, "body": "As Adrian (almost?) said, by using <code>interface{}</code>, you get an opportunity, in your function <code>test</code>, to inspect what type-and-value you actually got. Doing <code>data.(*string)</code> asserts\u2014without first testing\u2014that the type you got was <code>*string</code>. The compiler inserts a runtime type-check to see if that was true and if not, to call <code>panic</code>."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1570549179, "post_id": 58278048, "comment_id": 102943889, "body": "Typically, one would use <code>interface{}</code> if <code>test</code> should be able to handle, e.g., both <code>*string</code> and, say, <code>*int</code>. Then you would write <code>test</code> to <i>check</i> whether it got <code>*string</code> or <code>*int</code>, and do whatever you deem The Right Thing based on that. To be even more general\u2014at a noticeable runtime cost\u2014you can do what <code>json.Unmarshal</code> does and use the <code>reflect</code> package to inspect the interface value you got. The more general you make function <code>test</code>, the harder it is to write it and the more runtime code you need, so be sure the result is as valuable as the expense."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1570549353, "post_id": 58278048, "comment_id": 102943976, "body": "Note that if you just want to handle <code>*string</code> and <code>*int</code>, it&#39;s much easier\u2014and compile-time safe\u2014to write two separate functions, one that takes <code>*string</code> and one that takes <code>*int</code>. Generics, which let you get compile-time safety <i>and</i> type flexibility (at some compile-time cost), are coming in Go 2."}, {"owner": {"reputation": 199, "user_id": 2307766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a2e9f60431167f4112627d713249362?s=128&d=identicon&r=PG", "display_name": "Ming M Zheng", "link": "https://stackoverflow.com/users/2307766/ming-m-zheng"}, "edited": false, "score": 0, "creation_date": 1570550000, "post_id": 58278048, "comment_id": 102944271, "body": "thank you for explaining! right, because my Java mindset,  I was wondering how Golang manage Generic type, I get the &quot;reflect&quot; part, since it&#39;s similar to &quot;reflection&quot; in Java"}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 3, "last_activity_date": 1570488261, "creation_date": 1570488261, "answer_id": 58278048, "question_id": 58277798, "link": "https://stackoverflow.com/questions/58277798/dynamic-argument-and-generic-type/58278048#58278048", "title": "Dynamic argument and Generic type", "body": "<p>I think you are expecting <code>interface</code> to be much more magic than it actually is.</p>\n\n<p>Consider this variant of your program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc test(p *string) {\n    s := \"test\"\n    p = &amp;s\n}\n\nfunc main() {\n    t := \"org\"\n    test(&amp;t)\n    fmt.Println(t)\n}\n</code></pre>\n\n<p>Do you expect this to print <code>test</code>?  If so, we have a bigger problem. :-)  If not, why do you expect the version with <code>p interface{}</code> to change <code>t</code> when assigning directly to <code>p</code>?</p>\n\n<p>If we change <code>test</code> to write <em>through</em> <code>*p</code>:</p>\n\n<pre><code>func test(p *string) {\n    *p = \"test\"\n}\n</code></pre>\n\n<p>the program <em>does</em> print <code>test</code>, as you expected.</p>\n\n<p>All that remains now is to handle the case when <code>p</code> is declared instead as <code>data interface{}</code>.  As in <a href=\"https://stackoverflow.com/a/58277954/1256452\">bserdar's answer</a>, you must first extract the underlying <code>*string</code> pointer from the interface object in <code>data</code>.  You can then use that pointer to set <code>main</code>'s variable <code>t</code>.  You could do this with two steps:</p>\n\n<pre><code>func test(data interface{}) {\n    p := data.(*string)\n    *p = \"test\"\n}\n</code></pre>\n\n<p>for instance, or you can do it all in one line.</p>\n"}], "owner": {"reputation": 199, "user_id": 2307766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a2e9f60431167f4112627d713249362?s=128&d=identicon&r=PG", "display_name": "Ming M Zheng", "link": "https://stackoverflow.com/users/2307766/ming-m-zheng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 1, "accepted_answer_id": 58278048, "answer_count": 2, "score": -1, "last_activity_date": 1570550474, "creation_date": 1570486407, "last_edit_date": 1570550474, "question_id": 58277798, "link": "https://stackoverflow.com/questions/58277798/dynamic-argument-and-generic-type", "title": "Dynamic argument and Generic type", "body": "<p>I have following code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc test(data interface{}) {\n    data = \"123\"\n}\n\nfunc main() {\n    t := \"org\"\n    test(&amp;t)\n    fmt.Println(t)\n\n    e := 1\n    test(&amp;e)\n    fmt.Println(e)\n}\n</code></pre>\n\n<p>I tried to add pointer to *interface{} but it throws errors, how can I assign string \"test\" to <code>t</code> when I print it? right now <code>t</code> will be printed out as \"org\"</p>\n\n<p>I am asking because I am not sure how I can use dynamic type here, for instance, <code>josn.Unmarshal(data []byte, v interface{})</code> I used this function, and it can convert databyte to any type we want as long as we pass the reference. </p>\n"}, {"tags": ["go", "canvas", "html5-canvas", "webassembly"], "comments": [{"owner": {"reputation": 41032, "user_id": 3877726, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/C7qq2.png?s=128&g=1", "display_name": "Blindman67", "link": "https://stackoverflow.com/users/3877726/blindman67"}, "edited": false, "score": 1, "creation_date": 1570484350, "post_id": 58277286, "comment_id": 102921268, "body": "The 2D context state is reset when the canvas is resized (resolution changed, not the display size as set by CSS rules). This is normal behavior as set out in the specifications."}, {"owner": {"reputation": 41032, "user_id": 3877726, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/C7qq2.png?s=128&g=1", "display_name": "Blindman67", "link": "https://stackoverflow.com/users/3877726/blindman67"}, "edited": false, "score": 0, "creation_date": 1570484997, "post_id": 58277286, "comment_id": 102921474, "body": "The spec re size change  &quot;When the user agent is to reset the rendering context to its default state, it must clear the drawing state stack and everything that drawing state consists of to initial values&quot;. Source <a href=\"https://html.spec.whatwg.org/multipage/canvas.html#reset-the-rendering-context-to-its-default-state\" rel=\"nofollow noreferrer\">html.spec.whatwg.org/multipage/&hellip;</a>"}], "owner": {"reputation": 3239, "user_id": 1478636, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7651e5295fced56136e81d876c5c7c95?s=128&d=identicon&r=PG", "display_name": "Paul Nelson Baker", "link": "https://stackoverflow.com/users/1478636/paul-nelson-baker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 1, "closed_date": 1570549861, "answer_count": 0, "score": 1, "last_activity_date": 1570483506, "creation_date": 1570483155, "last_edit_date": 1570483506, "question_id": 58277286, "link": "https://stackoverflow.com/questions/58277286/why-are-my-html-canvas-drawing-styles-being-reset-after-resize", "closed_reason": "Duplicate", "title": "Why are my HTML Canvas drawing styles being reset after resize?", "body": "<p>I'm using GoLang and WASM, I want to essentially write a \"Hello, World\"-esque example by drawing a checkerboard to the HTML canvas.</p>\n\n<p>I set <code>fillStyle</code> and <code>strokeStyle</code> to <code>'red'</code>, and <code>lineWidth</code> to <code>5</code>. It works until I resize the window and my values get reset.</p>\n\n<p><a href=\"https://i.stack.imgur.com/fWp7z.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fWp7z.png\" alt=\"Correctly drawing to canvas\"></a>\n<a href=\"https://i.stack.imgur.com/qhNZ2.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/qhNZ2.png\" alt=\"No longer drawing to canvas\"></a></p>\n\n<p>I have found through trial and error that if I set my styles after I call <code>clearRect</code> it will work as I expect it to. From what I've been reading <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Drawing_shapes#Drawing_paths\" rel=\"nofollow noreferrer\">from MDN</a>, you should only need to worry if you are using paths. I'm just drawing fill and stroke rectangles so this shouldn't be the issue.</p>\n\n<p>It doesn't make sense, but this works by setting the styles every iteration (note the placement of the <code>canvasCtx.Set</code> calls within the loop):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    runForever := make(chan bool)\n    window := js.Global()\n    canvas := window.Get(\"document\").Call(\"getElementById\", \"canvas\")\n    window.Call(\"addEventListener\", \"resize\", js.FuncOf(func(this js.Value, args []js.Value) interface{} {\n        width, height := updateCanvasSize(window, canvas)\n        fmt.Printf(\"resize triggered: %f x %f\\n\", width, height)\n        return nil\n    }))\n    _, _ = updateCanvasSize(window, canvas)\n\n    canvasCtx := canvas.Call(\"getContext\", \"2d\")\n\n    var renderer js.Func\n    renderer = js.FuncOf(func(this js.Value, args []js.Value) interface{} {\n        width, height := getWindowInnerSize(window)\n        canvasCtx.Call(\"clearRect\", 0, 0, width, height)\n        fmt.Printf(\"Rendering with: Canvas Size %fx%f  fillStyle=%s strokeStyle%s lineWidth=%f\\n\",\n            width, height,\n            canvasCtx.Get(\"fillStyle\").String(),\n            canvasCtx.Get(\"strokeStyle\").String(),\n            canvasCtx.Get(\"lineWidth\").Float(),\n        )\n        canvasCtx.Set(\"fillStyle\", \"red\")\n        canvasCtx.Set(\"strokeStyle\", \"red\")\n        canvasCtx.Set(\"lineWidth\", 5)\n\n        squareWidth := width / 8\n        squareHeight := height / 8\n        offsetWidth := squareWidth * 0.15\n        offsetHeight := squareHeight * 0.15\n        for i := 0; i &lt; 8; i++ {\n            for j := 0; j &lt; 8; j++ {\n                if (i+j)%2 == 0 {\n                    canvasCtx.Call(\"strokeRect\", float64(i)*squareWidth+offsetWidth, float64(j)*squareHeight+offsetHeight,\n                        squareWidth-(2*offsetWidth), squareHeight-(2*offsetHeight))\n                } else {\n                    canvasCtx.Call(\"fillRect\", float64(i)*squareWidth, float64(j)*squareHeight, squareWidth, squareHeight)\n                }\n            }\n        }\n        window.Call(\"requestAnimationFrame\", renderer)\n        return nil\n    })\n    window.Call(\"requestAnimationFrame\", renderer)\n\n    &lt;-runForever\n}\n</code></pre>\n\n<p>However setting the canvas values upfront instead of for every iteration does not work:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"syscall/js\"\n)\n\nfunc main() {\n    runForever := make(chan bool)\n    window := js.Global()\n    canvas := window.Get(\"document\").Call(\"getElementById\", \"canvas\")\n    window.Call(\"addEventListener\", \"resize\", js.FuncOf(func(this js.Value, args []js.Value) interface{} {\n        width, height := updateCanvasSize(window, canvas)\n        fmt.Printf(\"resize triggered: %f x %f\\n\", width, height)\n        return nil\n    }))\n    _, _ = updateCanvasSize(window, canvas)\n\n    canvasCtx := canvas.Call(\"getContext\", \"2d\")\n    canvasCtx.Set(\"fillStyle\", \"red\")\n    canvasCtx.Set(\"strokeStyle\", \"red\")\n    canvasCtx.Set(\"lineWidth\", 5)\n\n    var renderer js.Func\n    renderer = js.FuncOf(func(this js.Value, args []js.Value) interface{} {\n        width, height := getWindowInnerSize(window)\n        canvasCtx.Call(\"clearRect\", 0, 0, width, height)\n        fmt.Printf(\"Rendering with: Canvas Size %fx%f  fillStyle=%s strokeStyle%s lineWidth=%f\\n\",\n            width, height,\n            canvasCtx.Get(\"fillStyle\").String(),\n            canvasCtx.Get(\"strokeStyle\").String(),\n            canvasCtx.Get(\"lineWidth\").Float(),\n        )\n        squareWidth := width / 8\n        squareHeight := height / 8\n        offsetWidth := squareWidth * 0.15\n        offsetHeight := squareHeight * 0.15\n        for i := 0; i &lt; 8; i++ {\n            for j := 0; j &lt; 8; j++ {\n                if (i+j)%2 == 0 {\n                    canvasCtx.Call(\"strokeRect\", float64(i)*squareWidth+offsetWidth, float64(j)*squareHeight+offsetHeight,\n                        squareWidth-(2*offsetWidth), squareHeight-(2*offsetHeight))\n                } else {\n                    canvasCtx.Call(\"fillRect\", float64(i)*squareWidth, float64(j)*squareHeight, squareWidth, squareHeight)\n                }\n            }\n        }\n        window.Call(\"requestAnimationFrame\", renderer)\n        return nil\n    })\n    window.Call(\"requestAnimationFrame\", renderer)\n\n    &lt;-runForever\n}\n\nfunc getWindowInnerSize(window js.Value) (float64, float64) {\n    width := window.Get(\"innerWidth\").Float()\n    height := window.Get(\"innerHeight\").Float()\n    return width, height\n}\n\nfunc updateCanvasSize(window js.Value, canvas js.Value) (float64, float64) {\n    width, height := getWindowInnerSize(window)\n    canvas.Set(\"width\", width)\n    canvas.Set(\"height\", height)\n    return width, height\n}\n</code></pre>\n\n<p>Explicitly setting these values every time isn't really that big of a deal, but my question is why does this happen? Is this what is supposed to happen (EG: are these side-effects documented somewhere I haven't yet seen) or is there a combination of things <em>I'm</em> doing that's causing these unintended side effects (if so, how do I rectify myself so I don't run into more weird side-effects)?</p>\n"}, {"tags": ["go", "types", "type-conversion"], "comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1594259366, "post_id": 58276531, "comment_id": 111065990, "body": "<code>byte(i)</code> or <code>[]byte(string(i))</code> to set an int to a byte. See <a href=\"https://stackoverflow.com/a/62737936/12817546\">stackoverflow.com/a/62737936/12817546</a>. <code>int(b)</code> or <code>int(b[0])</code> to set a byte to an int. See <a href=\"https://stackoverflow.com/a/62725637/12817546\">stackoverflow.com/a/62725637/12817546</a>."}], "answers": [{"comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1570480248, "post_id": 58276573, "comment_id": 102919905, "body": "<code>string</code> will convert the integer to a string data type, which is a <code>[]byte</code> underneath, so it&#39;s kind of overkill if the OP just wants one byte."}, {"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "edited": false, "score": 0, "creation_date": 1570481025, "post_id": 58276573, "comment_id": 102920159, "body": "I agree that it\u2019s overkill, but it does return a slice of bytes, which then you could get first byte from like <code>character[0]</code>... still, just using <code>byte</code> type conversion is cleaner."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "edited": false, "score": 0, "creation_date": 1570488129, "post_id": 58276573, "comment_id": 102922252, "body": "@openwonk string(n)[0] only works as an integer to byte conversion when the integer n is in the ASCII range.  See <a href=\"https://play.golang.org/p/vCHaK8CVyJx\" rel=\"nofollow noreferrer\">play.golang.org/p/vCHaK8CVyJx</a>."}, {"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570488765, "post_id": 58276573, "comment_id": 102922426, "body": "@CeriseLim&#243;n makes sense. I think you can make it work, however using <code>byte</code> to convert is preferred."}], "tags": [], "owner": {"reputation": 185, "user_id": 1779689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/792ab21743631090583bbb56663071f0?s=128&d=identicon&r=PG", "display_name": "relisher", "link": "https://stackoverflow.com/users/1779689/relisher"}, "is_accepted": false, "score": 1, "last_activity_date": 1570479417, "creation_date": 1570479417, "answer_id": 58276573, "question_id": 58276531, "link": "https://stackoverflow.com/questions/58276531/how-do-i-convert-an-integer-to-a-byte-in-go/58276573#58276573", "title": "How do I convert an integer to a byte in Go", "body": "<p>You should be able to convert any of those integers to the char value by simply doing <code>character := string(asciiNum)</code> where asciiNum is the integer that you've generated, and character will be the character with the byte value corresponding to the generated int </p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1570480052, "creation_date": 1570480052, "answer_id": 58276689, "question_id": 58276531, "link": "https://stackoverflow.com/questions/58276531/how-do-i-convert-an-integer-to-a-byte-in-go/58276689#58276689", "title": "How do I convert an integer to a byte in Go", "body": "<p>Use the <code>byte()</code> <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a> to convert an integer to a <code>byte</code>:</p>\n\n<pre><code>var n int = 66\nb := byte(n)                // b is a byte\nfmt.Printf(\"%c %d\\n\", b, b) // prints B 66\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4142722"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 589, "favorite_count": 0, "accepted_answer_id": 58276689, "answer_count": 2, "score": 1, "last_activity_date": 1570480052, "creation_date": 1570479190, "question_id": 58276531, "link": "https://stackoverflow.com/questions/58276531/how-do-i-convert-an-integer-to-a-byte-in-go", "title": "How do I convert an integer to a byte in Go", "body": "<p>I'm generating a random number in the range of 65 to 90 (which corresponds to the byte representations of uppercase characters as bytes). The random number generator returns an integer value and I want to convert it to a byte.</p>\n\n<p>When I say I want to convert the integer to a byte, I don't mean the byte representation of the number - i.e. I don't mean int 66 becoming byte [54 54]. I mean, if the RNG returns the integer 66, I want a byte with the value 66 (which would correspond to an uppercase <strong>B</strong>).</p>\n"}, {"tags": ["go", "many-to-many", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 1407, "user_id": 889074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/YwYtO.jpg?s=128&g=1", "display_name": "kalelc", "link": "https://stackoverflow.com/users/889074/kalelc"}, "is_accepted": false, "score": 0, "last_activity_date": 1572893621, "creation_date": 1572893621, "answer_id": 58699457, "question_id": 58276325, "link": "https://stackoverflow.com/questions/58276325/gorm-extra-where-1-1-in-many2many/58699457#58699457", "title": "Gorm extra where 1 &lt;&gt; 1 in many2many", "body": "<p>The problem is fixed.</p>\n\n<p>I have eliminated <code>gorm.Model</code> in struct:</p>\n\n<pre><code>type Group struct {\n    ID    uint   `json:\"id\"`\n    Name  string `json:\"name\"`\n    Users []User `gorm:\"many2many:user_groups;association_jointable_foreignkey:owner_id\"`\n}\n</code></pre>\n\n<p>And In the query:</p>\n\n<pre><code>db.Model(&amp;group).Related(&amp;users)\n</code></pre>\n\n<p>Regards.</p>\n"}], "owner": {"reputation": 1407, "user_id": 889074, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/YwYtO.jpg?s=128&g=1", "display_name": "kalelc", "link": "https://stackoverflow.com/users/889074/kalelc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572893621, "creation_date": 1570478209, "last_edit_date": 1570519163, "question_id": 58276325, "link": "https://stackoverflow.com/questions/58276325/gorm-extra-where-1-1-in-many2many", "title": "Gorm extra where 1 &lt;&gt; 1 in many2many", "body": "<p>I have two models (structs). <code>User</code> and <code>Group</code>. Those models have many to many relationships.</p>\n\n<p>When I try to create query <code>db.Unscoped().Model(&amp;group).Related(&amp;users, \"Users\")</code> this returns:</p>\n\n<p><code>SELECT users.* FROM users INNER JOIN user_groups ON user_groups.owner_id = users.id WHERE (1 &lt;&gt; 1)</code>.</p>\n\n<p>The entities are:</p>\n\n<pre><code>type Group struct {\n    gorm.Model\n    ID    uint   `json:\"id\"`\n    Name  string `json:\"name\"`\n    Users []User `gorm:\"many2many:user_groups;association_jointable_foreignkey:owner_id\"`\n}\n</code></pre>\n\n<pre><code>type User struct {\n...\nGroups                    []Group `gorm:\"many2many:user_groups;association_jointable_foreignkey:group_id\"`\n}\n\n</code></pre>\n\n<p>Handler</p>\n\n<pre><code>users := []models.User{}\ngroup := models.Group{}\n\ndb.Unscoped().Model(&amp;group).Related(&amp;users, \"Users\")\n\n</code></pre>\n\n<p>I don't know the reason to generate extra <code>where</code>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570476913, "post_id": 58276035, "comment_id": 102918704, "body": "<code>val</code> is redeclared in the if statement and that shadows the <code>val</code> declared before. Add a <code>var ok bool</code> before the <code>if</code>, and do not use <code>:=</code>, so <code>val</code> and <code>ok</code> will not be redeclared."}, {"owner": {"reputation": 264, "user_id": 1733746, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/151127ed618c728e00422b7d6f71e932?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/1733746/alexander"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570477231, "post_id": 58276035, "comment_id": 102918830, "body": "according to <a href=\"https://golang.org/doc/effective_go.html#redeclaration\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#redeclaration</a>, <code>val</code> should only be redeclared. The whole idea was that I do not need to declare <code>ok</code> in the higher context."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1570477563, "post_id": 58276035, "comment_id": 102918965, "body": "&quot;In a := declaration a variable v may appear even if it has already been declared, provided: this declaration is in the same scope as the existing declaration of v (if v is already declared in an outer scope, the declaration will create a new variable)&quot;. The if statement creates a new scope."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570477606, "post_id": 58276035, "comment_id": 102918979, "body": "Sorry, I missed the fmt.Println at the bottom. What it is complaining about is the <code>val</code> declared with the <code>if</code> statement. <code>val</code> is assigned the value 3, but it is never used. Add a fmt.Println(val) inside the if statement, and it should work."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1570670590, "post_id": 58276035, "comment_id": 102989016, "body": "Read <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a>."}], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 0, "last_activity_date": 1570477885, "creation_date": 1570477885, "answer_id": 58276260, "question_id": 58276035, "link": "https://stackoverflow.com/questions/58276035/unclear-declared-but-not-used-when-reassignment/58276260#58276260", "title": "Unclear declared but not used when reassignment", "body": "<p>It is a scope thing. \nTo fix this you should also declare <code>ok</code> and then your code is working. In this case you don't need the short declaration inside your if-statement. </p>\n\n<pre><code>func main() {\n    myMap := map[string]int{\n        \"A\": 1,\n        \"B\": 2,\n    }\n    var val int\n    var ok bool\n    key := \"A\"\n\n    if val, ok = myMap[key]; !ok {\n        val = 3\n    }\n\n    fmt.Println(val)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/7iTYwxfOEnc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7iTYwxfOEnc</a></p>\n\n<p>The example in your code declares a variable <code>val</code> just for the <code>if</code> block. So the scope of that val is just inside that block. So for the compiler you are not using the <code>val</code> of the main function.</p>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1570490644, "last_edit_date": 1570490644, "creation_date": 1570479106, "answer_id": 58276506, "question_id": 58276035, "link": "https://stackoverflow.com/questions/58276035/unclear-declared-but-not-used-when-reassignment/58276506#58276506", "title": "Unclear declared but not used when reassignment", "body": "<p>The declared and never used <code>val</code> is the <code>val</code> in the <code>if</code>-statement. It is a new scope:</p>\n\n<pre><code>if val, ok := myMap[key]; !ok {\n    val = 3 \n}\n</code></pre>\n\n<p>Above, the <code>val</code> redeclaration shadows the <code>val</code> declared in the outer scope. The <code>val = 3</code> assignment uses the <code>val</code> declared in the nested scope, and it is never used after this assignment, so the compiler complaining about this.</p>\n\n<p>Simply declare <code>ok</code> in the outer scope, or create a new scope to deal with it:</p>\n\n<pre><code>var val int\n{\n   var ok bool\n   if val, ok = myMap[key]; !ok {\n     val = 3\n   }\n}\n</code></pre>\n"}], "owner": {"reputation": 264, "user_id": 1733746, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/151127ed618c728e00422b7d6f71e932?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/1733746/alexander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 267, "favorite_count": 0, "closed_date": 1570519224, "answer_count": 2, "score": -2, "last_activity_date": 1570521678, "creation_date": 1570476815, "last_edit_date": 1570521678, "question_id": 58276035, "link": "https://stackoverflow.com/questions/58276035/unclear-declared-but-not-used-when-reassignment", "closed_reason": "Duplicate", "title": "Unclear declared but not used when reassignment", "body": "<p><strong>EDIT (Why this is not a duplicate of the above):</strong>  </p>\n\n<ul>\n<li>In <a href=\"https://stackoverflow.com/questions/21743841/how-to-avoid-annoying-error-declared-and-not-used\">How to avoid annoying error \u201cdeclared and not used\u201d</a> questions the existence of this error. I am not - I have a specific case, where it's reason is unclear and I want to understand why and find a lean way to fix it.</li>\n<li>In <a href=\"https://stackoverflow.com/questions/6177815/go-compiler-says-declared-and-not-used-but-they-are-being-used\">Go compiler says \u201cdeclared and not used\u201d but they are being used</a> the error occurs because the variable is declared in the <code>if</code>-scope. My (possibly wrong) understanding is, that a scope is enclosed in <code>{</code> and <code>}</code>. This is not the case in my question. If my understanding is wrong, I'm happy if someone explains it (I can't find anything about that in effective-go). However, it is a different question.</li>\n</ul>\n\n<p><strong>EDIT (Why the current answers are not satisfying):</strong></p>\n\n<ul>\n<li>The answer by <code>apxp</code> solves this by declaring <code>ok</code> in the outside scope. I know that I can do this and this is why I asked for a <em>lean</em> way to solve this. I don't want the <code>ok</code> variable float around in the higher scope, where it is just baggage.</li>\n<li>The answer by <code>bserdar</code> addresses this with the extra scope. I like this better, but I find it less easy to read.</li>\n</ul>\n\n<p><strong>EDIT (What I derived from the comments and answers):</strong></p>\n\n<p>Inspired by the acivity here, I came up with this code to set a default value (few lines and no unnecessary variables in the higher scope):</p>\n\n<pre><code>...\n    val := 3\n    if v, ok := myMap[key]; ok {\n        val = v\n    }\n...\n</code></pre>\n\n<p>An <strong>open question</strong> for me is still: Where can I read about the scope definition of an if statement, which seems to be a key to understanding this error?</p>\n\n<p><strong>EDIT (META)</strong>:</p>\n\n<p>As explained above, my question is quite different from the linked ones. I may have not explained detailed enough what my question is about, but also I assess that it was not tried to understand my question correctly or benevolent. Thus I would like the [duplicate] tag to be removed and that the people that downvoted to revisit their judgement.</p>\n\n<hr>\n\n<p>I am getting an error that I can not explain. Code and running example below.</p>\n\n<p>The goal ist that I want to save into <code>val</code> the value from a map with the key <code>key</code> and if the key does not exist, <code>val</code> should be assigned a default value. But I am getting the error <code>val declared and not used</code></p>\n\n<pre><code>myMap := map[string]int{\n    \"A\": 1,\n    \"B\": 2,\n}\nvar val int\nkey := \"A\"\n\nif val, ok := myMap[key]; !ok {\n    val = 3\n}\n\nfmt.Println(val)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/nOVpWwgCSSe\" rel=\"nofollow noreferrer\">https://play.golang.org/p/nOVpWwgCSSe</a></p>\n\n<p>What is going on here? Why is it not working? What would be the lean way?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1570490594, "last_edit_date": 1570490594, "creation_date": 1570476823, "answer_id": 58276038, "question_id": 58275984, "link": "https://stackoverflow.com/questions/58275984/setting-field-on-struct-gets-lost/58276038#58276038", "title": "Setting field on struct gets lost?", "body": "<p>From your description, it looks like <code>commits</code> is of type <code>[]Commit</code>. If that's the case, the <code>commit</code> in the for loop is a copy of the array element, and changing that will change the copy, not the Commit in the array. So, use indexed access and modify the commit in the array:</p>\n\n<pre><code>for i, _ := range commits {\n    commits[i].SetProject(project)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 0, "last_activity_date": 1570479358, "last_edit_date": 1570479358, "creation_date": 1570477880, "answer_id": 58276259, "question_id": 58275984, "link": "https://stackoverflow.com/questions/58275984/setting-field-on-struct-gets-lost/58276259#58276259", "title": "Setting field on struct gets lost?", "body": "<p>If you have a type which requires a pointer receiver, it's better to always handle values of that type via a pointer to prevent unexpected copies. Even if you were to call the method directly on the value in the slice via the index, you're going to always have the chance that the values need to be used elsewhere in your code requiring you to ensure that you're mutating the correct value. </p>\n\n<p>In this case, it's advisable to use a slice of of pointers for <code>commits</code> to avoid the issue altogether:</p>\n\n<pre><code>var commits []*Commit\n</code></pre>\n"}], "owner": {"reputation": 6083, "user_id": 1736601, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/898ece53307a59a16aae6fe549c5283d?s=128&d=identicon&r=PG", "display_name": "atkayla", "link": "https://stackoverflow.com/users/1736601/atkayla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 58276038, "answer_count": 2, "score": -3, "last_activity_date": 1570490594, "creation_date": 1570476585, "last_edit_date": 1570477096, "question_id": 58275984, "link": "https://stackoverflow.com/questions/58275984/setting-field-on-struct-gets-lost", "title": "Setting field on struct gets lost?", "body": "<pre><code>type Project struct {\n    ID   int    `json:\"id\"`\n    Name string `json:\"name\"`\n}\n\ntype Commit struct {\n    ID            string `json:\"id\"`\n    Message       string `json:\"message\"`\n    CommitterName string `json:\"committer_name\"`\n    CommittedDate string `json:\"committed_date\"`\n    Project       Project\n}\n\nfunc (c *Commit) SetProject(project Project) {\n    c.Project = project\n}\n</code></pre>\n\n<pre><code>var commits []Commit // pre-populated list of commits\n\n// goroutine 1\nfor _, commit := range commits {\n  fmt.Println(project) // this prints out with the expected result\n  commit.SetProject(project)\n  fmt.Println(commit) // this prints out with the expected result\n}\nch &lt;- commits\n\n// goroutine 2\nfor commits := range ch {\n  fmt.Println(commits[0].Project) // =&gt; {0 }, project is not there\n}\n</code></pre>\n\n<p>How can I set the project on the commits?</p>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 343, "user_id": 7624033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc953e4ff3857eb2a3d212dadb46eee?s=128&d=identicon&r=PG&f=1", "display_name": "caisil", "link": "https://stackoverflow.com/users/7624033/caisil"}, "edited": false, "score": 0, "creation_date": 1570464125, "post_id": 58272987, "comment_id": 102913158, "body": "<code>nil</code> is a zero for specific type. Assignning <code>b</code> to <code>dv</code> means, assign <code>[]byte</code> zero value to <code>dv</code>, not <code>driver.Value</code>. This may help <a href=\"https://stackoverflow.com/questions/35983118/what-does-nil-mean-in-golang?answertab=active#tab-top\" title=\"what does nil mean in golang\">stackoverflow.com/questions/35983118/&hellip;</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1570464430, "post_id": 58272987, "comment_id": 102913302, "body": "Related questions: <a href=\"https://stackoverflow.com/questions/21460787/nil-slice-when-passed-as-interface-is-not-nil-why-golang\">1</a>, <a href=\"https://stackoverflow.com/questions/33426977/how-to-golang-check-a-variable-is-nil/33427907\">2</a>,  <a href=\"https://stackoverflow.com/questions/53892508/golang-returning-nil-does-not-return-nil\">3</a>, and more."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 5, "last_activity_date": 1570490656, "last_edit_date": 1570490656, "creation_date": 1570463871, "answer_id": 58273154, "question_id": 58272987, "link": "https://stackoverflow.com/questions/58272987/assigning-nil-value-to-driver-value-makes-driver-value-not-equal-nil/58273154#58273154", "title": "Assigning nil value to driver.Value makes driver.Value not equal nil", "body": "<p><code>driver.Value</code> is an interface. Go interfaces contain two values: a type and a pointer to the underlying value. An interface is nil if both of those are nil.</p>\n\n<p>In your case, after</p>\n\n<pre><code>dv = b\n</code></pre>\n\n<p>where <code>b</code> is a nil <code>[]byte</code>, the interface <code>dv</code> has type <code>[]byte</code> with value nil. So the interface itself is not nil.</p>\n\n<p><a href=\"https://golang.org/doc/faq#nil_error\" rel=\"nofollow noreferrer\">https://golang.org/doc/faq#nil_error</a></p>\n"}], "owner": {"reputation": 67, "user_id": 8095115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7705f2d7525805f22d70ccb604fc8823?s=128&d=identicon&r=PG&f=1", "display_name": "Knut Zuidema", "link": "https://stackoverflow.com/users/8095115/knut-zuidema"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "closed_date": 1570468445, "accepted_answer_id": 58273154, "answer_count": 1, "score": 0, "last_activity_date": 1570490656, "creation_date": 1570463222, "question_id": 58272987, "link": "https://stackoverflow.com/questions/58272987/assigning-nil-value-to-driver-value-makes-driver-value-not-equal-nil", "closed_reason": "Duplicate", "title": "Assigning nil value to driver.Value makes driver.Value not equal nil", "body": "<p>After assigning a <code>nil</code> value to a <code>driver.Value</code> variable, the variable does not equal <code>nil</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"database/sql/driver\"\n    \"fmt\"\n)\n\nfunc main() {\n    var dv driver.Value\n    dv = nil\n    if dv == nil {\n        fmt.Println(\"driver.Value nil\")\n    }\n    var b []byte\n    if b == nil {\n        fmt.Println(\"byte slice nil\")\n    }\n    dv = b\n    if dv == nil {\n        fmt.Println(\"driver.Value nil\")\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<blockquote>\n  <p>driver.Value nil<br>\n  byte slice nil</p>\n</blockquote>\n\n<p>Playground: <a href=\"https://play.golang.org/p/oTweLQLA8Qj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/oTweLQLA8Qj</a></p>\n\n<p>Why is that the case?</p>\n"}, {"tags": ["go", "external", "openldap", "sasl"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1570502936, "post_id": 58272670, "comment_id": 102925069, "body": "It&#39;s a bit dense, but the RFC has the SASL spec &amp; message format: <a href=\"https://tools.ietf.org/html/rfc4511\" rel=\"nofollow noreferrer\">tools.ietf.org/html/rfc4511</a>. Cross referencing that with the go-ldap package source may get you further along."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 6997788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44293e4dec6ddb2bab27581c1c4ee93e?s=128&d=identicon&r=PG", "display_name": "regeda", "link": "https://stackoverflow.com/users/6997788/regeda"}, "is_accepted": false, "score": 0, "last_activity_date": 1570544842, "creation_date": 1570544842, "answer_id": 58288408, "question_id": 58272670, "link": "https://stackoverflow.com/questions/58272670/how-to-implement-sasl-external-for-openldap-client-over-ipc-on-golang/58288408#58288408", "title": "How to implement SASL/EXTERNAL for OpenLDAP client over IPC on Golang?", "body": "<p>I found the solution.</p>\n\n<p>First of all, you need to connect to the unix socket. Usually, the socket locates on <code>/var/run/slapd/ldapi</code> path.</p>\n\n<p>Then you need to make a simple bind with two changes:</p>\n\n<ol>\n<li>username should be empty</li>\n<li>need specify that you want to use <code>sasl</code> authentication</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>pkt := ber.Encode(ber.ClassApplication, ber.TypeConstructed, ApplicationBindRequest, nil, \"Bind Request\")\npkt.AppendChild(ber.NewInteger(ber.ClassUniversal, ber.TypePrimitive, ber.TagInteger, 3, \"Version\"))\npkt.AppendChild(ber.NewString(ber.ClassUniversal, ber.TypePrimitive, ber.TagOctetString, \"\", \"User Name\"))\n\nsaslAuth := ber.Encode(ber.ClassContext, ber.TypeConstructed, 3, \"\", \"authentication\")\nsaslAuth.AppendChild(ber.NewString(ber.ClassUniversal, ber.TypePrimitive, ber.TagOctetString, \"EXTERNAL\", \"SASL Mech\"))\nsaslAuth.AppendChild(ber.NewString(ber.ClassUniversal, ber.TypePrimitive, ber.TagOctetString, \"\", \"SASL Cred\"))\n\npkt.AppendChild(saslAuth)\n\n</code></pre>\n\n<p>This is the PR <a href=\"https://github.com/go-ldap/ldap/pull/232\" rel=\"nofollow noreferrer\">https://github.com/go-ldap/ldap/pull/232</a>.</p>\n"}], "owner": {"reputation": 21, "user_id": 6997788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44293e4dec6ddb2bab27581c1c4ee93e?s=128&d=identicon&r=PG", "display_name": "regeda", "link": "https://stackoverflow.com/users/6997788/regeda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 300, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1574199043, "creation_date": 1570462058, "question_id": 58272670, "link": "https://stackoverflow.com/questions/58272670/how-to-implement-sasl-external-for-openldap-client-over-ipc-on-golang", "title": "How to implement SASL/EXTERNAL for OpenLDAP client over IPC on Golang?", "body": "<p>I'm currently trying to implement <code>SASL/EXTERNAL</code> auth for OpenLDAP client written in Golang.</p>\n\n<p>By other words, I want to load the following data:</p>\n\n<pre><code>ldapsearch -Y EXTERNAL -H ldapi:// -s base -b 'olcDatabase={1}mdb,cn=config' olcSyncRepl\n</code></pre>\n\n<p>I'm using <a href=\"https://github.com/go-ldap/ldap\" rel=\"nofollow noreferrer\">https://github.com/go-ldap/ldap</a> library. Unfortunately, the library supports simple authentication only. I'm happy to implement <code>SASL/EXTERNAL</code> but I could not recognize how the protocol works? For example, there is <a href=\"https://ldap.com/ldapv3-wire-protocol-reference-bind/\" rel=\"nofollow noreferrer\">https://ldap.com/ldapv3-wire-protocol-reference-bind/</a> <code>CRAM-MD5</code> authentication process. </p>\n\n<p>I want to get the same explanation for <code>SASL/EXTERNAL</code>. </p>\n\n<p>I connected to the unix socket (<code>ldapi://</code>) successfully. But I don't understand what kind of commands need to send programmatically to complete authentication.</p>\n"}, {"tags": ["go", "pam"], "answers": [{"comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1570461829, "post_id": 58272535, "comment_id": 102911908, "body": "I think this answer gets to the point. I also guessed that PAM is just a middle man."}, {"owner": {"reputation": 43, "user_id": 6798064, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-UNtYC2qU6sI/AAAAAAAAAAI/AAAAAAAAGp0/KTiNPMabwaY/photo.jpg?sz=128", "display_name": "Sterisk", "link": "https://stackoverflow.com/users/6798064/sterisk"}, "edited": false, "score": 0, "creation_date": 1570473140, "post_id": 58272535, "comment_id": 102917033, "body": "Do I need to compile my go program as an .so to be compiled with PAM in mind?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1570482377, "post_id": 58272535, "comment_id": 102920633, "body": "it will be <i>FAR</i> easier for your web-app to talk to a DB than through the PAM system. Trust me. Unless there is a compelling reason to take advantage of PAM&#39;s Audit logging etc - I would <i>strongly</i> advise against this route."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 1, "last_activity_date": 1570468655, "last_edit_date": 1570468655, "creation_date": 1570461610, "answer_id": 58272535, "question_id": 58272260, "link": "https://stackoverflow.com/questions/58272260/can-i-use-pam-for-authentication-in-my-web-application/58272535#58272535", "title": "Can I use PAM for authentication in my web application?", "body": "<p>PAM, by its very name, is a pluggable authentication module for Linux/Unix. Modules include local (e.g. /etc/passwd) or network-based (LDAP etc.) solutions.</p>\n\n<p>It sounds like you want to delegate authentication/authorization to the *NIX system PAM system. You can certainly do this by binding to a cgo library that talks to the native PAM system.</p>\n\n<p>But this may be a an <a href=\"https://en.wikipedia.org/wiki/XY_problem\" rel=\"nofollow noreferrer\">XY problem</a> and connecting directly to the database may be easier. LDAP, for example has plenty of supported native Go packages: <a href=\"https://godoc.org/gopkg.in/ldap.v2\" rel=\"nofollow noreferrer\">gopkg.in/ldap.v2</a></p>\n"}], "owner": {"reputation": 43, "user_id": 6798064, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-UNtYC2qU6sI/AAAAAAAAAAI/AAAAAAAAGp0/KTiNPMabwaY/photo.jpg?sz=128", "display_name": "Sterisk", "link": "https://stackoverflow.com/users/6798064/sterisk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 692, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570468655, "creation_date": 1570460604, "last_edit_date": 1570461074, "question_id": 58272260, "link": "https://stackoverflow.com/questions/58272260/can-i-use-pam-for-authentication-in-my-web-application", "title": "Can I use PAM for authentication in my web application?", "body": "<p>I am writing a web application in Go, and was wondering if it was possible for me to use PAM to authenticate users as opposed to using a database to store user credentials. If so, how would I go about doing this?</p>\n"}, {"tags": ["multithreading", "go", "assembly", "parallel-processing", "x86"], "comments": [{"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 3, "creation_date": 1570456994, "post_id": 58270779, "comment_id": 102909343, "body": "That&#39;s dumb, normal people use <code>lock addl $0, (SP)</code> as a (sometimes faster) equivalent for MFENCE.  The other inefficiency is using <code>testl</code> instead of <code>testb</code> to check the low bits of EAX: there is no <code>test r32, imm8</code> encoding so it wastes several bytes of code size."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1570457048, "post_id": 58270779, "comment_id": 102909373, "body": "Also, I would have used <code>fild</code> / <code>fistp</code> instead of needing MMX EMMS, if I needed to avoid SSE2.  Or SSE1 movlps load/store into xmm0, although that has a false dependency vs. an SSE2 <code>movq</code> or <code>movsd</code> load into xmm0.  And I would have put the crash-on-misalignment load after the <code>ret</code> so the branch is not-taken in the normal case."}], "answers": [{"tags": [], "owner": {"reputation": 9461, "user_id": 8422330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c0f90445d03447c587d1e595d531f69?s=128&d=identicon&r=PG&f=1", "display_name": "prl", "link": "https://stackoverflow.com/users/8422330/prl"}, "is_accepted": true, "score": 2, "last_activity_date": 1570457062, "last_edit_date": 1570457062, "creation_date": 1570456521, "answer_id": 58271069, "question_id": 58270779, "link": "https://stackoverflow.com/questions/58270779/how-does-xorl-ax-ax-work-as-a-memory-fence/58271069#58271069", "title": "How does &quot;XORL AX, AX&quot; work as a memory fence?", "body": "<p>It isn\u2019t the <strong><code>XOR</code></strong> that acts as a memory fence. It is the locked <strong><code>XADD</code></strong> instruction that does that. The <code>XOR</code> instruction clears <strong><code>EAX</code></strong> so that the <code>XADD</code> instruction doesn\u2019t actually change the contents of memory.</p>\n\n<p>The memory-ordering behavior of locked instructions is described in the answer to this question: <a href=\"https://stackoverflow.com/questions/50323347/how-many-memory-barriers-instructions-does-an-x86-cpu-have\">How many memory barriers instructions does an x86 CPU have?</a></p>\n"}], "owner": {"reputation": 1572, "user_id": 1354445, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2ddd831999b590a537efc3d42f981e02?s=128&d=identicon&r=PG", "display_name": "tna0y", "link": "https://stackoverflow.com/users/1354445/tna0y"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "closed_date": 1570456549, "accepted_answer_id": 58271069, "answer_count": 1, "score": 0, "last_activity_date": 1570457062, "creation_date": 1570455617, "question_id": 58270779, "link": "https://stackoverflow.com/questions/58270779/how-does-xorl-ax-ax-work-as-a-memory-fence", "closed_reason": "Duplicate", "title": "How does &quot;XORL AX, AX&quot; work as a memory fence?", "body": "<p>Recently I've been browsing through Go's source code and in particular <a href=\"https://github.com/golang/go/blob/master/src/runtime/internal/atomic/asm_386.s#L201\" rel=\"nofollow noreferrer\">runtime/internal/atomic/asm_386.s</a>.\nBelow is an implementation of an <code>internal.atomic.Store64</code> function. </p>\n\n<pre><code>// void runtime\u2215internal\u2215atomic\u00b7Store64(uint64 volatile* addr, uint64 v);\nTEXT runtime\u2215internal\u2215atomic\u00b7Store64(SB), NOSPLIT, $0-12\n    MOVL    ptr+0(FP), AX\n    TESTL   $7, AX\n    JZ  2(PC)\n    MOVL    0, AX // crash with nil ptr deref\n    // MOVQ and EMMS were introduced on the Pentium MMX.\n    MOVQ    val+4(FP), M0\n    MOVQ    M0, (AX)\n    EMMS\n    // This is essentially a no-op, but it provides required memory fencing.\n    // It can be replaced with MFENCE, but MFENCE was introduced only on the Pentium4 (SSE2).\n    XORL    AX, AX\n    LOCK\n    XADDL   AX, (SP)\n    RET\n</code></pre>\n\n<p>The question is related to the second comment in the function. Could someone explain how does <code>XORL AX, AX</code> work as a memory fence? </p>\n\n<p>I guess it has something to do with the <code>LOCK</code> that goes right after, but how does it work?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1570452746, "post_id": 58269694, "comment_id": 102906856, "body": "The question is bit broad. But the answer is simple: Provide a context.Context to both produce and consume when started and make them stop if the context is done. Then stop your context in the stop command."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1570452883, "post_id": 58269694, "comment_id": 102906955, "body": "You also need to keep track of started processes and specify which one to stop, or do you intend the stop-command to stop all started processes?"}], "answers": [{"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 3, "last_activity_date": 1570453995, "last_edit_date": 1570453995, "creation_date": 1570453480, "answer_id": 58270154, "question_id": 58269694, "link": "https://stackoverflow.com/questions/58269694/how-to-start-and-stop-a-function/58270154#58270154", "title": "How to start and stop a function", "body": "<p>Here how to start and stop a function using context, try <a href=\"https://play.golang.org/p/FI0HQt5IHQv\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    ctx, cancel := context.WithCancel(context.Background())\n    var wg sync.WaitGroup\n    dataChannel := make(chan MyObject, 5)\n    wg.Add(2)\n    go produce(ctx, &amp;wg, dataChannel)\n    go consume(&amp;wg, dataChannel)\n\n    time.Sleep(1 * time.Second)\n    cancel() // cancel when we are finished consuming data\n\n    wg.Wait()\n}\n\nfunc produce(ctx context.Context, wg *sync.WaitGroup, dataChannel chan MyObject) {\n    defer wg.Done()\n    i := 1\n    for {\n        select {\n        case &lt;-ctx.Done():\n            close(dataChannel)\n            return // returning not to leak the goroutine\n        case dataChannel &lt;- MyObject{i}:\n            i++\n            time.Sleep(250 * time.Millisecond)\n        }\n    }\n}\n\nfunc consume(wg *sync.WaitGroup, dataChannel chan MyObject) {\n    defer wg.Done()\n    for v := range dataChannel {\n        fmt.Println(v)\n    }\n}\n\ntype MyObject struct {\n    i int\n}\n\n</code></pre>\n\n<hr>\n\n<p>For HTTP you need to do it yourself!<br>\nIt needs to have some <strong>concurrent safe</strong> ID or map or something to keep track of how many functions you called and then call a <code>cancel()</code> to stop it.</p>\n"}], "owner": {"reputation": 1115, "user_id": 7766158, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1084df74b3f8d86911c6662fdc848b9?s=128&d=identicon&r=PG&f=1", "display_name": "Nakeuh", "link": "https://stackoverflow.com/users/7766158/nakeuh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 58270154, "answer_count": 1, "score": 1, "last_activity_date": 1570453995, "creation_date": 1570451831, "last_edit_date": 1570452877, "question_id": 58269694, "link": "https://stackoverflow.com/questions/58269694/how-to-start-and-stop-a-function", "title": "How to start and stop a function", "body": "<p>I have a go function <code>processing</code> that use two distinct goroutines. <code>produce</code> will push some data into a channel and <code>consume</code> will read these data. Here is an example: </p>\n\n<pre><code>type MyObject struct{\n    ...\n}\n\nfunc processing() {\n    var wg sync.WaitGroup\n    dataChannel := make(chan MyObject, 5)\n\n    wg.Add(2)\n\n    go produce(wg, dataChannel)\n    go consume(wg, dataChannel)\n\n    wg.Wait()\n}\n\nfunc produce (wg *sync.WaitGroup, dataChannel chan MyObject){\n    for{\n        // Produce data in dataChannel\n    }\n}\n\nfunc consume (wg *sync.WaitGroup, dataChannel chan MyObject){\n    for{\n        // Consume data from dataChannel\n    }\n}\n</code></pre>\n\n<p>I want my <code>processing</code> function to be started and stoped by an HTTP call. So I am looking to do something as follow: </p>\n\n<pre><code>func main() {\n\n    // echo instance\n    e := echo.New()\n    e.GET(\"/\", startProcessing)\n    e.Logger.Fatal(e.Start(\":8099\"))\n}\n\nfunc startProcessing(c echo.Context) error{\n\n    command := c.QueryParam(\"command\")\n\n    if(command == \"start\"){\n        processing()\n    }else if(command == \"stop\"){\n        if (/* ? processing is running ? */){\n            /* ? stop processing process? */\n        }\n    }       \n}\n</code></pre>\n\n<p>What is the correct way to do this with Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1570448522, "post_id": 58268837, "comment_id": 102904784, "body": "<code>client.foo()</code> cannot work, not in the described scenario, not even in your first &quot;working&quot; example. Did you mean <code>client.Foo()</code>?"}, {"owner": {"reputation": 45, "user_id": 3949377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e257adb48327f0c1894a3a717647b763?s=128&d=identicon&r=PG&f=1", "display_name": "koko riko", "link": "https://stackoverflow.com/users/3949377/koko-riko"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570448805, "post_id": 58268837, "comment_id": 102904919, "body": "yes. you are right. fixed it"}, {"owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "edited": false, "score": 0, "creation_date": 1570448965, "post_id": 58268837, "comment_id": 102904978, "body": "There is no <code>Foo()</code> method on <code>interface{}</code>. Why did you use <code>interface{}</code> here instead of the type returned by <code>package.New()</code>?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1570448967, "post_id": 58268837, "comment_id": 102904979, "body": "@kokoriko ok, you have to let <code>hello</code> know what <code>client</code> can do, you can do this by declaring an interface, which you can declare either in the client&#39;s package or even in the hello&#39;s package. Then use that interface as the argument type to <code>hello</code>. Something like this: <a href=\"https://play.golang.com/p/HTkxWr3rxop\" rel=\"nofollow noreferrer\">play.golang.com/p/HTkxWr3rxop</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1570448983, "post_id": 58268837, "comment_id": 102904986, "body": "You cannot do this. in hello your client is of type interface{} and you simply cannot ever get back the original type (because it is unexported) to call Foo on it. Best advice: Don&#39;t get too obsessed by hiding stuff."}, {"owner": {"reputation": 45, "user_id": 3949377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e257adb48327f0c1894a3a717647b763?s=128&d=identicon&r=PG&f=1", "display_name": "koko riko", "link": "https://stackoverflow.com/users/3949377/koko-riko"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570453802, "post_id": 58268837, "comment_id": 102907432, "body": "@mkopriva what you showed does not work. hello(client) will not compile since client from the package is not of type fooer."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1570453873, "post_id": 58268837, "comment_id": 102907482, "body": "@kokoriko no it is not fooer but, it <i>implements</i> fooer because in Go interaces are satisfied <i>implicitly</i>. (just keep in mind that if <code>Foo</code>&#39;s receiver is a pointer then so should be the return value from `New)."}, {"owner": {"reputation": 45, "user_id": 3949377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e257adb48327f0c1894a3a717647b763?s=128&d=identicon&r=PG&f=1", "display_name": "koko riko", "link": "https://stackoverflow.com/users/3949377/koko-riko"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1570454875, "post_id": 58268837, "comment_id": 102908074, "body": "@mkopriva you are right. I tested it and this worked"}], "answers": [{"tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": false, "score": 1, "last_activity_date": 1570453090, "creation_date": 1570453090, "answer_id": 58270061, "question_id": 58268837, "link": "https://stackoverflow.com/questions/58268837/how-to-use-function-of-unexported-struct/58270061#58270061", "title": "how to use function of unexported struct", "body": "<p>What your <code>hello</code> function essentially needs is something that has a <code>Foo</code> function. That's why go has interfaces. There's nothing wrong with returning an unexported type (in fact, it's common and often the right thing to do). What I'd do is this:</p>\n\n<pre><code>package foobar\n\n// whatever thing that has a Foo function\ntype FClient interface {\n    Foo()\n}\n\nfunc Hello(client FClient) {\n    client.Foo() // will work\n}\n</code></pre>\n\n<p>The reason why you'd do it like this is to be able to unit-test this code:</p>\n\n<pre><code>package foobar_test\n\nimport (\n    \"testing\"\n)\n\ntype testFC struct {\n    callCount uint64\n}\n\n// implement interface\nfunc (t testFC) Foo() {\n    testFC.callCount++\n}\n\nfunc TestHello(t *testing.T) {\n    client := testFC{}\n    Hello(client)\n    if client.callCount != 1 {\n        t.Fail(\"dependency not called\")\n    }\n}\n</code></pre>\n\n<p>Of course, for more complex dependencies you'd use tools like mockgen or stuff like that, but you get the idea. By definition, a UNIT test focuses on a single UNIT of code. The last thing you'd need to do to test a package unit is to instantiate a type from another package. You should be able to mock everything your code depends on. The best way to do so is interfaces.</p>\n"}], "owner": {"reputation": 45, "user_id": 3949377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e257adb48327f0c1894a3a717647b763?s=128&d=identicon&r=PG&f=1", "display_name": "koko riko", "link": "https://stackoverflow.com/users/3949377/koko-riko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1570453090, "creation_date": 1570448283, "last_edit_date": 1570448782, "question_id": 58268837, "link": "https://stackoverflow.com/questions/58268837/how-to-use-function-of-unexported-struct", "title": "how to use function of unexported struct", "body": "<p>I have a package where I have unexported struct and exported New function to create it and exported function that runs on this struct (as advised for example here: <a href=\"https://stackoverflow.com/questions/21470398/return-an-unexported-type-from-a-function\">Return an unexported type from a function</a>).\nIf I run the function in the same place the New is called I can run the package function but I am unable to send this entity to another function.\nwhat is the best way to achieve this behavior without the need to have all my code in one function</p>\n\n<p>this for example works:</p>\n\n<pre><code>client := package.New()\n\nclient.Foo()\n</code></pre>\n\n<p>but this cannot work:</p>\n\n<pre><code>client := package.New()\n\nhello(client)\n\n\nfunc hello(client interface{}) {\n\n    client.Foo()\n\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1570443476, "post_id": 58267463, "comment_id": 102902358, "body": "You are passing copies of the slice values to <code>koken</code>. Modifying that copy doesn&#39;t do anything to the copy in the slice. That&#39;s expected."}, {"owner": {"reputation": 21, "user_id": 12172324, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAVfwk64fe-a60-akryKCVY0h0ITrb6-k8_gxnuMA=k-s128", "display_name": "ManuSwaG", "link": "https://stackoverflow.com/users/12172324/manuswag"}, "edited": false, "score": 0, "creation_date": 1570444901, "post_id": 58267463, "comment_id": 102903065, "body": "sorry for sounding stupid.  But what is the right way to do this without discarding the data? i just started programming so i don&#39;t know all the rules."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570448153, "post_id": 58267463, "comment_id": 102904615, "body": "@ManuSwaG If you want <code>koken</code> to update the passed in string, either pass in a pointer, or have it return the new string and have the caller assign the returned string to where you want to have it. <a href=\"https://play.golang.com/p/_OzQCGcm2Pg\" rel=\"nofollow noreferrer\">play.golang.com/p/_OzQCGcm2Pg</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12140837, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-MlJG3RhauNM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rek9kzPVlgEXz5nuabUgKsIBm7_0w/photo.jpg=k-s128", "display_name": "holdonbush", "link": "https://stackoverflow.com/users/12140837/holdonbush"}, "is_accepted": false, "score": 0, "last_activity_date": 1570448815, "creation_date": 1570448815, "answer_id": 58268948, "question_id": 58267463, "link": "https://stackoverflow.com/questions/58267463/appending-slice-with-user-input-with-functions/58268948#58268948", "title": "Appending Slice with User input with functions", "body": "<p>Maybe the reason is that parameter passing in Go is value transfer. When you use function koken, it only pass a copy of <code>vriendinnen[0](/[1]/[2])</code>. Operation in the function won't influence the original value of the slice.<br>\nIf you want to change the value of the slice, passing the whole slice to function koken then do change operation will solve. If you want to append to the slice, method above can't finish that job. Then you may need to use a slice as the return value of function, and assign the return value to the original slice. This is related to the structure of slice in Go. </p>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 1, "last_activity_date": 1570448999, "creation_date": 1570448999, "answer_id": 58268995, "question_id": 58267463, "link": "https://stackoverflow.com/questions/58267463/appending-slice-with-user-input-with-functions/58268995#58268995", "title": "Appending Slice with User input with functions", "body": "<p>1/ Go passes everything by value.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Calls\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Calls</a></p>\n\n<blockquote>\n  <p>In a function call, the function value and arguments are evaluated in\n  the usual order. After they are evaluated, the parameters of the call\n  are passed by value to the function and the called function begins\n  execution</p>\n</blockquote>\n\n<p>So to write the value of each string entry of the slices, you could make use of pointers. In this example a pointer to the value is created and passed to the function. The function updates the value stored at the pointers address. </p>\n\n<p>The function is not safe to nil pointers.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    vriendinnen := []string{\"vriendin1\", \"vriendin2\", \"vriendin3\"}\n    koken(&amp;vriendinnen[0])\n    koken(&amp;vriendinnen[1])\n    koken(&amp;vriendinnen[2])\n\n    log.Println(vriendinnen)\n}\n\nfunc koken(vriendinnen *string) {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Wat Zijn de namen van de vriendinnen: \")\n    *vriendinnen, _ = reader.ReadString('\\n')\n    // vriendinnen[1], _ = reader.ReadString('\\n')\n    // vriendinnen[2], _ = reader.ReadString('\\n')\n    // reader.WriteTo(w)\n}\n</code></pre>\n\n<p>2/ The bufio.Reader is buffered, thus failing to properly manage it can lead to data loss.</p>\n\n<p>this version of the program prints some more details</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    vriendinnen := []string{\"vriendin1\", \"vriendin2\", \"vriendin3\"}\n    koken(&amp;vriendinnen[0])\n    koken(&amp;vriendinnen[1])\n    koken(&amp;vriendinnen[2])\n    log.Println(vriendinnen)\n}\n\nfunc koken(vriendinnen *string) {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Wat Zijn de namen van de vriendinnen: \")\n    *vriendinnen, _ = reader.ReadString('\\n')\n    fmt.Println()\n    log.Println(reader.Buffered())\n    reader.WriteTo(os.Stdout)\n}\n</code></pre>\n\n<p>Run it with <code>echo -e \"1\\n2\\n3\" | go run main.go</code>, it outputs</p>\n\n<pre><code>Wat Zijn de namen van de vriendinnen: \n2019/10/07 13:36:53 4\n2\n3\nWat Zijn de namen van de vriendinnen: \n2019/10/07 13:36:53 0\nWat Zijn de namen van de vriendinnen: \n2019/10/07 13:36:53 0\n2019/10/07 13:36:53 [1\n  ]\n</code></pre>\n\n<p>At first read line, the <code>bufio.Reader</code> instance has still 4 unread bytes into its internal buffer (<a href=\"https://golang.org/src/bufio/bufio.go#L32\" rel=\"nofollow noreferrer\">https://golang.org/src/bufio/bufio.go#L32</a>).</p>\n\n<p>The 4 bytes are <code>\"2\\n3\"+\"\\n\"</code> (<code>echo</code> adds a trailing NL).</p>\n\n<p>Those four bytes has been read from the stdin and saved into the <code>bufio.Reader</code>. This buffered reader and its state are lost when the function exits. </p>\n\n<p>On the next read line, it outputs <code>0</code> unread bytes, in fact it has reached <code>io.EOF</code> on <code>os.Stdin</code> and does not have anything else to read.</p>\n\n<p>To fix this, adjust your code to reuse the <code>bufio.Reader</code>. </p>\n\n<p>Additionally care should be taken to properly handle errors in order to properly handle <code>io.EOF</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n\n    vriendinnen := []string{\"vriendin1\", \"vriendin2\", \"vriendin3\"}\n    reader := bufio.NewReader(os.Stdin)\n    var err error\n    for i := 0; i &lt; len(vriendinnen); i++ {\n        fmt.Print(\"Wat Zijn de namen van de vriendinnen: \")\n        vriendinnen[i], err = reader.ReadString('\\n')\n        if err != nil {\n            if err == io.EOF {\n                err = nil\n            }\n            break\n        }\n    }\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Println(vriendinnen)\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 12172324, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAVfwk64fe-a60-akryKCVY0h0ITrb6-k8_gxnuMA=k-s128", "display_name": "ManuSwaG", "link": "https://stackoverflow.com/users/12172324/manuswag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 58268995, "answer_count": 2, "score": -1, "last_activity_date": 1570448999, "creation_date": 1570443106, "question_id": 58267463, "link": "https://stackoverflow.com/questions/58267463/appending-slice-with-user-input-with-functions", "title": "Appending Slice with User input with functions", "body": "<p>When is run this code the slice data is not replaced by the user input.\nBut when remove the comments and run the code normally without the functions the data is replaced in the slice.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    vriendinnen := []string{\"vriendin1\", \"vriendin2\", \"vriendin3\"}\n    koken(vriendinnen[0])\n    koken(vriendinnen[1])\n    koken(vriendinnen[2])\n\n}\n\nfunc koken(vriendinnen string) {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Wat Zijn de namen van de vriendinnen: \")\n    vriendinnen, _ = reader.ReadString('\\n')\n    // vriendinnen[1], _ = reader.ReadString('\\n')\n    // vriendinnen[2], _ = reader.ReadString('\\n') \n}\n</code></pre>\n\n<p>This Works</p>\n\n<pre><code>\n    vriendinnen := []string{\"vriendin1\", \"vriendin2\", \"vriendin3\"}\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Wat Zijn de namen van de vriendinnen: \")\n    vriendinnen[0], _ = reader.ReadString('\\n')\n    vriendinnen[1], _ = reader.ReadString('\\n')\n    vriendinnen[2], _ = reader.ReadString('\\n')\n    fmt.Println(vriendinnen)\n</code></pre>\n"}, {"tags": ["string", "go", "rune"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1570441849, "post_id": 58267109, "comment_id": 102901602, "body": "Why would you need <code>[]rune</code>? If you need <code>string</code>, use <code>string</code>. Please clarify your question."}, {"owner": {"reputation": 395, "user_id": 7197834, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2860b131f48ded5f6f8075f398b2ab82?s=128&d=identicon&r=PG&f=1", "display_name": "Myrfy", "link": "https://stackoverflow.com/users/7197834/myrfy"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1570442363, "post_id": 58267109, "comment_id": 102901850, "body": "Because I need to deal with web pages mixed with emoji"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1570442433, "post_id": 58267109, "comment_id": 102901891, "body": "Having to deal with emojis does not warrant for <code>[]rune</code>. A <code>string</code> may contain emojis. So I still don&#39;t see why you should use <code>[]rune</code>."}, {"owner": {"reputation": 395, "user_id": 7197834, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2860b131f48ded5f6f8075f398b2ab82?s=128&d=identicon&r=PG&f=1", "display_name": "Myrfy", "link": "https://stackoverflow.com/users/7197834/myrfy"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1570442648, "post_id": 58267109, "comment_id": 102901985, "body": "There are many cases that I have to get the character at a index, I&#39;m writing something like a parser to parse the text with emoji"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1570443766, "post_id": 58267109, "comment_id": 102902518, "body": "When you really have to deal with Unicode: Stop now and forever to thing of &quot;characters&quot; there is no such thing. Converting a string to a rune slice is of basically no help in dealing with Unicode."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570454023, "post_id": 58267109, "comment_id": 102907571, "body": "If you should ALWAYS use rune instead of string, string wouldn&#39;t exist."}], "answers": [{"tags": [], "owner": {"reputation": 3488, "user_id": 477035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cYpss.jpg?s=128&g=1", "display_name": "RedGrittyBrick", "link": "https://stackoverflow.com/users/477035/redgrittybrick"}, "is_accepted": true, "score": 4, "last_activity_date": 1570460096, "last_edit_date": 1570460096, "creation_date": 1570446910, "answer_id": 58268465, "question_id": 58267109, "link": "https://stackoverflow.com/questions/58267109/should-i-always-use-rune-instead-of-string-except-doing-i-o/58268465#58268465", "title": "Should I ALWAYS use rune instead of string except doing I/O", "body": "<blockquote>\n  <p>Should I ALWAYS use rune instead of string except doing I/O</p>\n</blockquote>\n\n<p>There are several very useful packages that work with strings which you would find awkward to work with if your data is in arrays (or slices) of runes.</p>\n\n<blockquote>\n  <p>There are many cases that I have to get the character at a index, </p>\n</blockquote>\n\n<p>It isn't safe to do that in general, partly because of <a href=\"https://en.wikipedia.org/wiki/Combining_character\" rel=\"nofollow noreferrer\">combining characters</a> but also because strings (or Unicode text in general) can contain many other difficult situations - perhaps a mix of left-to-right and right-to-left text etc. </p>\n\n<p><a href=\"https://blog.golang.org/normalization\" rel=\"nofollow noreferrer\">Normalizing</a> the text to one of the several normal forms might help deal with most combining characters but there will be some combinations that don't reduce to a single rune.</p>\n\n<blockquote>\n  <p>I'm writing something like a parser to parse the text with emoji </p>\n</blockquote>\n\n<p>Unicode <a href=\"https://en.wikipedia.org/wiki/Emoticons_(Unicode_block)\" rel=\"nofollow noreferrer\">emoticons</a> are just another codepoint - so can be treated like most ordinary characters.</p>\n\n<p>In many cases it is probably best to use the <code>range</code> operator to walk through a string. </p>\n\n<p>If you wanted to, for example, replace all \ud83d\ude00 with <code>:-)</code>, this could perhaps be handled using <a href=\"https://golang.org/pkg/strings/#Replace\" rel=\"nofollow noreferrer\"><code>strings.Replace()</code></a> or by using <code>for ... range</code> with <code>strings.Builder</code>.</p>\n\n<hr>\n\n<p>For me the most persuasive argument is that once you venture outside of ASCII, text is weird, Unicode is almost unfathomably weird, plumbing its depths is something best left to experts who spend their lives grappling with its madness. If you want to spend your time on business-end features that usually more clearly matter to you, your business and customers, use standard packages.</p>\n\n<hr>\n\n<p>Useful references:</p>\n\n<ul>\n<li><a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\"><em>Strings, bytes, runes and characters in Go</em>. Rob Pike. 23 October 2013</a></li>\n<li><a href=\"https://golang.org/pkg/unicode/\" rel=\"nofollow noreferrer\"><em>Package unicode</em>. Go authors.</a></li>\n<li><a href=\"https://eev.ee/blog/2015/09/12/dark-corners-of-unicode/\" rel=\"nofollow noreferrer\"><em>Dark corners of Unicode</em>. Eevee. Sep 12, 2015</a></li>\n<li><a href=\"http://www.benfrederickson.com/unicode-insanity/\" rel=\"nofollow noreferrer\"><em>Unicode is kind of insane</em>. Ben Frederickson. 26 May 2015</a></li>\n<li><a href=\"https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/\" rel=\"nofollow noreferrer\"><em>The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!)</em>. Joel Spolsky. October 8, 2003</a></li>\n</ul>\n"}], "owner": {"reputation": 395, "user_id": 7197834, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2860b131f48ded5f6f8075f398b2ab82?s=128&d=identicon&r=PG&f=1", "display_name": "Myrfy", "link": "https://stackoverflow.com/users/7197834/myrfy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 58268465, "answer_count": 1, "score": -3, "last_activity_date": 1570460096, "creation_date": 1570441692, "last_edit_date": 1570443679, "question_id": 58267109, "link": "https://stackoverflow.com/questions/58267109/should-i-always-use-rune-instead-of-string-except-doing-i-o", "title": "Should I ALWAYS use rune instead of string except doing I/O", "body": "<p>In Python3, all strings are Unicode so you only need to do decode or encode when doing I/O operation, and in the main part of you code, you only do with Unicode.</p>\n\n<p>So, I want to know that in Go, should I do the same? Should I convert all the strings to <code>[]rune</code> at the input and all my functions only receive <code>[]rune</code> type?</p>\n\n<p>Because I'm new to Go, so I don't know how many 3rd party library support rune as string. If I use rune all the way in my code, when I need to interact with a 3rd party library, will the overhead of converting rune to string be a problem?</p>\n"}, {"tags": ["go", "github", "microservices"], "comments": [{"owner": {"reputation": 2818, "user_id": 3743683, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/1a2184dc575adac6e364c25d1708397d?s=128&d=identicon&r=PG&f=1", "display_name": "Abhyudit Jain", "link": "https://stackoverflow.com/users/3743683/abhyudit-jain"}, "edited": false, "score": 0, "creation_date": 1570442166, "post_id": 58267056, "comment_id": 102901752, "body": "According to 12Factor (<a href=\"https://12factor.net/codebase\" rel=\"nofollow noreferrer\">12factor.net/codebase</a>), each repo should be an app. One to one correlation."}, {"owner": {"reputation": 2818, "user_id": 3743683, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/1a2184dc575adac6e364c25d1708397d?s=128&d=identicon&r=PG&f=1", "display_name": "Abhyudit Jain", "link": "https://stackoverflow.com/users/3743683/abhyudit-jain"}, "edited": false, "score": 0, "creation_date": 1570442277, "post_id": 58267056, "comment_id": 102901805, "body": "If you have all the services in the project directory then there&#39;s tight coupling. What if you want to right one of those services in a different language in the future or a new stack? It won&#39;t compile, right?"}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "reply_to_user": {"reputation": 2818, "user_id": 3743683, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/1a2184dc575adac6e364c25d1708397d?s=128&d=identicon&r=PG&f=1", "display_name": "Abhyudit Jain", "link": "https://stackoverflow.com/users/3743683/abhyudit-jain"}, "edited": false, "score": 0, "creation_date": 1570443143, "post_id": 58267056, "comment_id": 102902186, "body": "By nature of the project the packages share some common resources, which is why they are grouped under the same path. But each one serves one purpose. I think this is not so atypical of microservices. I wouldn&#39;t mind having each service as a Go module, it can be moved outside the path, or be used alone in another project, it is not so tightly coupled."}, {"owner": {"reputation": 796, "user_id": 2140009, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k4g7W.jpg?s=128&g=1", "display_name": "Vipul Patil", "link": "https://stackoverflow.com/users/2140009/vipul-patil"}, "edited": false, "score": 1, "creation_date": 1570444355, "post_id": 58267056, "comment_id": 102902806, "body": "To follow micro-service architecture ,one should separate out the each-n-every service to an individual git repo. along with individual CI/CD pipeline."}, {"owner": {"reputation": 2818, "user_id": 3743683, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/1a2184dc575adac6e364c25d1708397d?s=128&d=identicon&r=PG&f=1", "display_name": "Abhyudit Jain", "link": "https://stackoverflow.com/users/3743683/abhyudit-jain"}, "edited": false, "score": 0, "creation_date": 1570445902, "post_id": 58267056, "comment_id": 102903509, "body": "If these modules can be used by other projects and/or they are independent modules then I would suggest you to extract those out and use them as dependencies in your current project."}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "reply_to_user": {"reputation": 796, "user_id": 2140009, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k4g7W.jpg?s=128&g=1", "display_name": "Vipul Patil", "link": "https://stackoverflow.com/users/2140009/vipul-patil"}, "edited": false, "score": 0, "creation_date": 1570446024, "post_id": 58267056, "comment_id": 102903576, "body": "@VipulPatil That&#39;s what I would like to do, but it forces me to remove the <code>project</code> layer of the paths structure, which I thought added semantics. Perhaps that&#39;s where I&#39;m wrong."}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "reply_to_user": {"reputation": 2818, "user_id": 3743683, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/1a2184dc575adac6e364c25d1708397d?s=128&d=identicon&r=PG&f=1", "display_name": "Abhyudit Jain", "link": "https://stackoverflow.com/users/3743683/abhyudit-jain"}, "edited": false, "score": 0, "creation_date": 1570446111, "post_id": 58267056, "comment_id": 102903618, "body": "@AbhyuditJain I guess so, thanks!"}, {"owner": {"reputation": 2818, "user_id": 3743683, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/1a2184dc575adac6e364c25d1708397d?s=128&d=identicon&r=PG&f=1", "display_name": "Abhyudit Jain", "link": "https://stackoverflow.com/users/3743683/abhyudit-jain"}, "edited": false, "score": 0, "creation_date": 1570448501, "post_id": 58267056, "comment_id": 102904772, "body": "@Cl&#233;ment Please go through <a href=\"https://12factor.net/\" rel=\"nofollow noreferrer\">12factor.net</a>. Especially Codebase and Dependencies sections. Your doubts are answered there."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1570504642, "post_id": 58267056, "comment_id": 102925391, "body": "I noticed go modules was not mentioned in the answers of this discussion. Versioning of sub packages with go modules uses git commit tagging. If you want to control a particular version of a sub package, that sub package would need to be in its own git repo. Basically a single git repo housing your app &amp; all sub packages would not have the granularity that go modules provides."}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1570773514, "post_id": 58267056, "comment_id": 103026932, "body": "@colminator This is huge actually, that alone is enough to decide for me."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1570806091, "post_id": 58267056, "comment_id": 103042984, "body": "@Cl&#233;ment since this comment was helpful, I expanded it into an answer for future reference."}], "answers": [{"tags": [], "owner": {"reputation": 710, "user_id": 7595191, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Vnc0n.png?s=128&g=1", "display_name": "Mikah Barnett", "link": "https://stackoverflow.com/users/7595191/mikah-barnett"}, "is_accepted": true, "score": 3, "last_activity_date": 1570447940, "last_edit_date": 1570447940, "creation_date": 1570447346, "answer_id": 58268581, "question_id": 58267056, "link": "https://stackoverflow.com/questions/58267056/keeping-go-microservices-in-different-repositories-on-github/58268581#58268581", "title": "Keeping Go microservices in different repositories on Github", "body": "<p>What you're talking about is popularly called \"monorepo\" these days.  While I personally like having all my projects in the own independent repositories (including microservices and everything else), there are a number of proponents of having all code for a company in a single repository.  Interestingly, both <a href=\"https://cacm.acm.org/magazines/2016/7/204032-why-google-stores-billions-of-lines-of-code-in-a-single-repository/fulltext\" rel=\"nofollow noreferrer\">Google</a> and Facebook use monorepos though it must be said they have built a lot of fancy tooling to make that work for them.</p>\n\n<p>One important thing to note is that your repository is a separate thing from your architecture.  There is not necessarily any correlation between them.  You can have microservices all in a single repo and you can have a monolith divided up into several repos; the repository is only a tool to store and document your code base, nothing more.</p>\n\n<p>While researching the topic, here are some of the advantages and disadvantages taken from a number of articles across the web:</p>\n\n<p><strong>Monorepo Advantages</strong></p>\n\n<ul>\n<li>Ease of sharing modules between projects (even in microservices, there are often cross-cutting concerns)</li>\n<li>One single place to see and know what code exists - especially useful in large companies with lots of code</li>\n<li>Simplifies automated and manual code review processes</li>\n<li>Simplifies documentation rather than pulling from multiple, disconnected repos</li>\n</ul>\n\n<p><strong>Monorepo Disadvantages</strong></p>\n\n<ul>\n<li>Massive codebase can be challenging/slow to check in/out to local</li>\n<li>Without very clear, strict guidelines it can be easy to cause tight coupling between products</li>\n<li>Requires (slightly) more complex CI/CD tooling to partial-release</li>\n<li>Depending on repository platform, very large codebases can affect performance</li>\n</ul>\n\n<p>And <a href=\"https://dev.to/ben/why-might-a-projectcompany-use-a-monorepo-5b97\" rel=\"nofollow noreferrer\">here's a good discussion</a> on the pros and cons of monorepos, and <a href=\"http://blog.shippable.com/our-journey-to-microservices-and-a-mono-repository\" rel=\"nofollow noreferrer\">here's one</a> specifically related to switching TO a monorepo with microservices architecture.  <a href=\"https://hoangbkit.com/monorepo-is-a-new-trend-emerging-recently-in-many-open-source-projects\" rel=\"nofollow noreferrer\">Here's one more</a> with lots of links both pro- and against-monorepo.</p>\n\n<p>Like so many other things in programming and especially in SOA, the right solution for you depends on a number of factors that only you can determine.  The main takeaway is that big and small companies have been successful with both options and many in between, so choose carefully but don't worry too much about it.</p>\n"}, {"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 1, "last_activity_date": 1570806049, "creation_date": 1570806049, "answer_id": 58343932, "question_id": 58267056, "link": "https://stackoverflow.com/questions/58267056/keeping-go-microservices-in-different-repositories-on-github/58343932#58343932", "title": "Keeping Go microservices in different repositories on Github", "body": "<p>Versioning sub-packages that a Go project depends on can be track by <a href=\"https://git-scm.com/book/en/v2/Git-Basics-Tagging\" rel=\"nofollow noreferrer\">git tagging</a>. So using Go-modules one is encouraged to move sub-packages into their own git repos.</p>\n\n<p>If the majority of your solution will be written in go, I'd suggest leveraging <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">go modules</a>.</p>\n\n<p>This blog post explains how to manage Go-modules' <code>go.mod</code> with regard to package dependencies and their associated <em>version</em> git tags:</p>\n\n<ul>\n<li><a href=\"https://blog.golang.org/migrating-to-go-modules\" rel=\"nofollow noreferrer\">https://blog.golang.org/migrating-to-go-modules</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 5104, "user_id": 166442, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/26f56518d4bf628fd60319872bcf3734?s=128&d=identicon&r=PG", "display_name": "knipknap", "link": "https://stackoverflow.com/users/166442/knipknap"}, "is_accepted": false, "score": 1, "last_activity_date": 1595776771, "creation_date": 1595776771, "answer_id": 63102051, "question_id": 58267056, "link": "https://stackoverflow.com/questions/58267056/keeping-go-microservices-in-different-repositories-on-github/63102051#63102051", "title": "Keeping Go microservices in different repositories on Github", "body": "<p>There is a good way to work with separate repositories and Go microservices: Go plugins. In short:</p>\n<ul>\n<li>Build a base image that implements shared functionality.</li>\n<li>Have that base image look for a <a href=\"https://golang.org/pkg/plugin/\" rel=\"nofollow noreferrer\">Go plugin</a> somewhere in the container</li>\n<li>In derived images, compile the functionality as a Go plugin and place it where the base image can find it.</li>\n</ul>\n<p>For Go/gRPC, I have put <a href=\"https://github.com/knipknap/grpc-server-go\" rel=\"nofollow noreferrer\">a base image that does this here</a>.</p>\n"}], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1120, "favorite_count": 0, "accepted_answer_id": 58268581, "answer_count": 3, "score": 1, "last_activity_date": 1595776771, "creation_date": 1570441487, "last_edit_date": 1570443882, "question_id": 58267056, "link": "https://stackoverflow.com/questions/58267056/keeping-go-microservices-in-different-repositories-on-github", "title": "Keeping Go microservices in different repositories on Github", "body": "<p>I'm working on a micro-services project. For this, I'd like to have one Go package per service, all included in a parent package for the project. It looks like this:</p>\n\n<pre><code>.\n\u2514\u2500\u2500 github.com\n    \u2514\u2500\u2500 username\n \u00a0\u00a0 \u00a0\u00a0  \u2514\u2500\u2500 project\n \u00a0\u00a0         \u251c\u2500\u2500 service1\n \u00a0\u00a0         \u2514\u2500\u2500 service2\n</code></pre>\n\n<p>I think this structure allows to comply with the Go conventions on package names and paths. A consequence of this is that all my microservices end on the same repository on Github, as the repository will be at depth 3 in the URL. I think this may become an issue in the future if the codebase becomes large. It may also add complexity for the CI/CD pipeline, for example a change to one service would trigger a build for all other services and the code to clone would be unnecessarily large.</p>\n\n<p>Is there a way to avoid this conflict between the Go conventions and the way Github works ? Or this a problem that have to be solved during the CI/CD work ?</p>\n"}, {"tags": ["go", "signals"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1570435233, "post_id": 58263925, "comment_id": 102898699, "body": "Catching window-close events is tricky: see <a href=\"https://stackoverflow.com/questions/10792361/how-do-i-gracefully-exit-an-x11-event-loop\" title=\"how do i gracefully exit an x11 event loop\">stackoverflow.com/questions/10792361/&hellip;</a> and <a href=\"https://docs.microsoft.com/en-us/dotnet/api/system.windows.window.closing?view=netframework-4.8\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/dotnet/api/&hellip;</a>. Note that running from CLI means you don&#39;t get direct interaction with the window manager, though; on Unix systems you&#39;ll generally get SIGTERM or SIGHUP: see <a href=\"https://unix.stackexchange.com/questions/82952/is-it-harmful-to-close-a-terminal-window-without-properly-exiting-an-application\" title=\"is it harmful to close a terminal window without properly exiting an application\">unix.stackexchange.com/questions/82952/&hellip;</a>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1570435358, "post_id": 58263925, "comment_id": 102898750, "body": "It&#39;s also no longer commonly used this way, but: consider that the disposition of SIGINT might be SIG_IGN at the time your program starts up. If so, it&#39;s a bit rude to just start catching SIGINT signals. You can prefix your catching with <code>if !signal.Ignored(s)</code> where <code>s</code> is the <code>syscall.SIGINT</code>, <code>syscall.SIGTERM</code>, etc., number."}], "answers": [{"comments": [{"owner": {"reputation": 4113, "user_id": 10305477, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--qRrIlzhZP8/AAAAAAAAAAI/AAAAAAAAAbg/OMHxlGTcZp4/photo.jpg?sz=128", "display_name": "Chase", "link": "https://stackoverflow.com/users/10305477/chase"}, "edited": false, "score": 0, "creation_date": 1570429037, "post_id": 58264244, "comment_id": 102896503, "body": "Will it work when you close the window itself? (through the red cross)"}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 4113, "user_id": 10305477, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--qRrIlzhZP8/AAAAAAAAAAI/AAAAAAAAAbg/OMHxlGTcZp4/photo.jpg?sz=128", "display_name": "Chase", "link": "https://stackoverflow.com/users/10305477/chase"}, "edited": false, "score": 0, "creation_date": 1570429157, "post_id": 58264244, "comment_id": 102896548, "body": "Let me try that out."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 4113, "user_id": 10305477, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--qRrIlzhZP8/AAAAAAAAAAI/AAAAAAAAAbg/OMHxlGTcZp4/photo.jpg?sz=128", "display_name": "Chase", "link": "https://stackoverflow.com/users/10305477/chase"}, "edited": false, "score": 0, "creation_date": 1570429269, "post_id": 58264244, "comment_id": 102896575, "body": "No, it doesn&#39;t, probably because it sends a different signal."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 4113, "user_id": 10305477, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--qRrIlzhZP8/AAAAAAAAAAI/AAAAAAAAAbg/OMHxlGTcZp4/photo.jpg?sz=128", "display_name": "Chase", "link": "https://stackoverflow.com/users/10305477/chase"}, "edited": false, "score": 0, "creation_date": 1570429713, "post_id": 58264244, "comment_id": 102896712, "body": "You need to try and log the signal it gets when the window is closed."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 4113, "user_id": 10305477, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--qRrIlzhZP8/AAAAAAAAAAI/AAAAAAAAAbg/OMHxlGTcZp4/photo.jpg?sz=128", "display_name": "Chase", "link": "https://stackoverflow.com/users/10305477/chase"}, "edited": false, "score": 0, "creation_date": 1570430336, "post_id": 58264244, "comment_id": 102896895, "body": "I wrote a Python script to write the signal to a text file before it gets killed off. I can see the values if it was interrupted. But when the terminal closes, I get nothing, I assume it&#39;s because it doesn&#39;t get any signals at all. Gets killed off directly."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 4113, "user_id": 10305477, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--qRrIlzhZP8/AAAAAAAAAAI/AAAAAAAAAbg/OMHxlGTcZp4/photo.jpg?sz=128", "display_name": "Chase", "link": "https://stackoverflow.com/users/10305477/chase"}, "edited": false, "score": 0, "creation_date": 1570431001, "post_id": 58264244, "comment_id": 102897108, "body": "My suggestion would be to build a GUI that can handle the close event. Run the go program through that GUI and pass SIGTERM when the GUI closes."}], "tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": true, "score": 1, "last_activity_date": 1570428441, "creation_date": 1570428441, "answer_id": 58264244, "question_id": 58263925, "link": "https://stackoverflow.com/questions/58263925/how-to-create-a-lock-file-in-golang-and-remove-it-before-exiting/58264244#58264244", "title": "How to create a .lock file in golang and remove it before exiting?", "body": "<p>I think it's because your main function exists soon after launching the goroutine. If the main function ends, all running goroutines will die too.</p>\n\n<p>Here's code that works for me: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/signal\"\n    \"sync\"\n)\n\nfunc main() {\n\n    exitsig := make(chan os.Signal, 1)\n    signal.Notify(exitsig, os.Interrupt)\n    var (\n        lockstate bool = false\n    )\n\n    if _, err := os.Stat(\"ms.lock\"); err == nil {\n        return\n\n    } else if os.IsNotExist(err) {\n        var file, err = os.Create(\"ms.lock\")\n        if err != nil {\n            return\n        }\n        file.Close()\n        lockstate = true\n    }\n\n    go func() {\n        &lt;-exitsig\n        if lockstate {\n            var err = os.Remove(\"ms.lock\")\n            if err != nil {\n                fmt.Println(\"Error removing file: \", err)\n            }\n        }\n        os.Exit(0)\n    }()\n\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(1)\n    wg.Wait()\n\n}\n\n</code></pre>\n\n<p>I added the waitgroup to wait in the main thread. Works fine on MacOS - creates <code>ms.lock</code> file and waits. Killing it with Cmd + C removes the file.</p>\n\n<p>Should work anywhere as long as the signal fires. </p>\n"}], "owner": {"reputation": 4113, "user_id": 10305477, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--qRrIlzhZP8/AAAAAAAAAAI/AAAAAAAAAbg/OMHxlGTcZp4/photo.jpg?sz=128", "display_name": "Chase", "link": "https://stackoverflow.com/users/10305477/chase"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 0, "accepted_answer_id": 58264244, "answer_count": 1, "score": -1, "last_activity_date": 1570428441, "creation_date": 1570426097, "last_edit_date": 1570426510, "question_id": 58263925, "link": "https://stackoverflow.com/questions/58263925/how-to-create-a-lock-file-in-golang-and-remove-it-before-exiting", "title": "How to create a .lock file in golang and remove it before exiting?", "body": "<p>I'm trying to prevent a program from opening another instance if it's already open, to do this I create a file with <code>.lock</code> extension and remove it when exiting the program. However everything except the remove works.</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"os/signal\"\n    \"fmt\"\n)\n\nfunc main() {\n    var test string\n    exitsig := make(chan os.Signal, 1)\n    signal.Notify(exitsig, os.Interrupt)\n    var (\n        lockstate bool = false\n    )\n\n    if _, err := os.Stat(\"ms.lock\"); err == nil {\n      return\n\n    } else if os.IsNotExist(err) {\n      var file, err = os.Create(\"ms.lock\")\n        if err != nil {\n            return\n        }\n        file.Close()\n        lockstate = true\n    }\n\n    go func() {\n      &lt;- exitsig\n        fmt.Println(\"Error removing file\")\n        fmt.Scanf(\"%s\", &amp;test)\n        if lockstate {\n            var err = os.Remove(\"ms.lock\")\n            if err != nil {\n                fmt.Println(\"Error removing file\")\n                fmt.Scanf(\"%s\", &amp;test)\n            }\n        }\n      os.Exit(0)\n    }()\n\n}\n</code></pre>\n\n<p>I've tried exiting by <code>ctrl+c</code>, exiting by pressing the close button on the top right corner of the window but it never sends a signal, the <code>os.Interrupt</code> signal is never caught. What is the reason for this?</p>\n\n<p>Also, I need the signal to be non-platform specific, so it should work on both windows and unix based systems.</p>\n"}, {"tags": ["http", "go", "http-headers", "axios"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1570421339, "post_id": 58263373, "comment_id": 102894914, "body": "Just a guess, but capitalizing those header strings using http.CanonicalHeaderKey before using them to set headers might help."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570422095, "post_id": 58263373, "comment_id": 102895035, "body": "@CeriseLim&#243;n What I meant is the headers set for Access-Control-Allow-Headers and Access-Control-Expose-Headers, they have <code>x-custom-token</code>, etc. Those are as header values, not header keys."}, {"owner": {"reputation": 105, "user_id": 8101284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e88cc1dc52549a44c9502864f0498f7a?s=128&d=identicon&r=PG", "display_name": "J.Langford", "link": "https://stackoverflow.com/users/8101284/j-langford"}, "edited": false, "score": 0, "creation_date": 1570423581, "post_id": 58263373, "comment_id": 102895255, "body": "I have updated the post with screenshots of the response headers shown in chrome and the console output from axios"}, {"owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570510750, "post_id": 58263373, "comment_id": 102926487, "body": "@CeriseLim&#243;n it works with an OPTIONS request, but the headers are not exposed on a GET (or any other method), which is what is needed by axios <a href=\"https://play.golang.org/p/SwDHlWfVVlx\" rel=\"nofollow noreferrer\">play.golang.org/p/SwDHlWfVVlx</a>"}, {"owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570516222, "post_id": 58263373, "comment_id": 102927902, "body": "@bserdar Headers are case-insensitive. See RFC2616 Sec 4.2 <a href=\"https://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2\" rel=\"nofollow noreferrer\">w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4.2</a>"}], "answers": [{"tags": [], "owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "is_accepted": true, "score": 1, "last_activity_date": 1570506635, "creation_date": 1570506635, "answer_id": 58279969, "question_id": 58263373, "link": "https://stackoverflow.com/questions/58263373/unable-to-access-custom-response-header-in-frontend-application/58279969#58279969", "title": "Unable to access custom response header in frontend application", "body": "<p>Your issue is that you are only exposing for OPTIONS requests.</p>\n\n<p>In your if statement, one of your criteria are <code>r.Header.Get(\"Access-Control-Request-Method\") != \"\"</code>.</p>\n\n<p>This header is typically only ever used in pre-flight requests and so your expose headers are not getting written on GET or other methods.</p>\n\n<p>In addition, your statement returns after writing the headers. This is correct for pre-flight but would cause no content to be sent for other methods. </p>\n\n<p>Solution - adjust your logic to handle exposing headers separately from the pre-flight headers.</p>\n"}], "owner": {"reputation": 105, "user_id": 8101284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e88cc1dc52549a44c9502864f0498f7a?s=128&d=identicon&r=PG", "display_name": "J.Langford", "link": "https://stackoverflow.com/users/8101284/j-langford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "accepted_answer_id": 58279969, "answer_count": 1, "score": 0, "last_activity_date": 1570506635, "creation_date": 1570420690, "last_edit_date": 1570427987, "question_id": 58263373, "link": "https://stackoverflow.com/questions/58263373/unable-to-access-custom-response-header-in-frontend-application", "title": "Unable to access custom response header in frontend application", "body": "<p>I am having trouble getting access to a custom respoone header being provided by our backend server. Server is written in Go. I am attempting to access it using axios as my HTTP client. I can see the header in the chrome dev-tools console, but I cannot get access to the header through axios. </p>\n\n<p>chrome dev tools response headers. I am looking to get the x-***-token at the bottom\n<a href=\"https://i.stack.imgur.com/ysbEO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ysbEO.png\" alt=\"chrome dev tools . response headers\"></a></p>\n\n<p>headers I have access to through axios (cors enabled)\n<a href=\"https://i.stack.imgur.com/ynvoc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ynvoc.png\" alt=\"headers I have access to through axios\"></a></p>\n\n<p>I can, however, access the header through axios when I run chrome with cors disabled: </p>\n\n<p><code>open -n -a /Applications/Google\\ Chrome.app/Contents/MacOS/Google\\ Chrome --args --user-data-dir=\"/tmp/chrome_dev_test\" --disable-web-security</code></p>\n\n<p>headers I have access to through axios (cors disabled)\n<a href=\"https://i.stack.imgur.com/tD6gg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/tD6gg.png\" alt=\"enter image description here\"></a></p>\n\n<p>This tells me that its not an issue with axios, but with the header configuration I have.</p>\n\n<p>Below is how we have configured our headers, I am trying to get access the <strong><em>x-custom-token</em></strong> header:</p>\n\n<pre><code>func allowCORS(h http.Handler) http.Handler {\nreturn http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    if origin := r.Header.Get(\"Origin\"); origin != \"\" &amp;&amp; contains(cors, origin) {\n        w.Header().Set(\"Access-Control-Allow-Origin\", origin)\n    }\n    if contains(cors, \"*\") {\n        w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    }\n\n    if r.Method == \"OPTIONS\" || r.Method == \"GET\" &amp;&amp; r.Header.Get(\"Access-Control-Request-Method\") != \"\" &amp;&amp;\n        w.Header().Get(\"Access-Control-Allow-Origin\") != \"\" {\n        headers := []string{\"Content-Type\", \"Accept-Encoding\", \"X-CSRF-Token\", \"Authorization\", \"accept\", \"origin\", \"Cache-Control\", \"X-Requested-With\", \"x-custom-token\"}\n        w.Header().Set(\"Access-Control-Allow-Headers\", strings.Join(headers, \",\"))\n        methods := []string{\"GET\", \"HEAD\", \"POST\", \"PUT\", \"DELETE\"}\n        w.Header().Set(\"Access-Control-Allow-Methods\", strings.Join(methods, \",\"))\n        expose := []string{\"x-custom-token\"}\n        w.Header().Set(\"Access-Control-Expose-Headers\", strings.Join(expose, \",\"))\n        return\n    }\n    h.ServeHTTP(w, r)\n})}\n</code></pre>\n\n<p>Can anyone tell me what header I have set incorrectly?</p>\n"}, {"tags": ["html", "mysql", "go", "post"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1570411349, "post_id": 58262490, "comment_id": 102893332, "body": "Do you have a request handler that also handles the GET request that displays the template you have? When you load the page, it will be a GET request for that URL, and for that you should execute your template and return the HTML page. When it is submitted, it will be the POST request, and the function you included here should run and insert the record to the db (or fail)."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1570411450, "post_id": 58262490, "comment_id": 102893354, "body": "The expression <code>struct{Value: value}</code> is not valid Go.  Please post your actual code."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1570434584, "post_id": 58262490, "comment_id": 102898452, "body": "you said you have rebuilt from scratch to narrow the problem, can you share the whole minimal reproducible example you are compiling ?"}, {"owner": {"reputation": 1, "user_id": 6801316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bc2a31cc213ba5ea1e2086374cd7fec?s=128&d=identicon&r=PG&f=1", "display_name": "domusicman", "link": "https://stackoverflow.com/users/6801316/domusicman"}, "edited": false, "score": 0, "creation_date": 1570548009, "post_id": 58262490, "comment_id": 102943296, "body": "I have updated my code for those of you who were saying I didn&#39;t have enough there. My index function/handler works with my html page as intended. Let me know if you need more info. Thank you so much!"}], "owner": {"reputation": 1, "user_id": 6801316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bc2a31cc213ba5ea1e2086374cd7fec?s=128&d=identicon&r=PG&f=1", "display_name": "domusicman", "link": "https://stackoverflow.com/users/6801316/domusicman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1570632993, "creation_date": 1570410963, "last_edit_date": 1570632993, "question_id": 58262490, "link": "https://stackoverflow.com/questions/58262490/blank-page-without-errors-when-using-post-in-go-code", "title": "Blank page without errors when using post in go code", "body": "<p>I'm new to Go programming and I am writing a function to post into an alternate key as the primary key auto-increments using Go, Mysql, and template.HTML package. </p>\n\n<p>After troubleshooting for the last few days I am loading a blank html page. </p>\n\n<p>Any suggestions on best practice or ways I should troubleshoot in the future would be so appreciated. </p>\n\n<p>Thank you so much for any help you are willing to offer!</p>\n\n<p>I used linters and formatters to ensure that the code is correctly formatted, used print statements, and rebuilt the function and html content from scratch to narrow it down.</p>\n\n<p>HTTP handler</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"text/template\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\ntype watchInfo struct {\n    ID    int\n    Brand string\n}\n\nvar (\n    tpl *template.Template\n    // cnn, err = sql.Open(\"mysql\", \"root:root@tcp(db:3306)/appdb\")\n)\n\n//function to connect to db\nfunc dbConn() (db *sql.DB) {\n    dbDriver := \"mysql\"\n    dbUser := \"root\"\n    dbPass := \"root\"\n    dbName := \"appdb\"\n    db, err := sql.Open(dbDriver, dbUser+\":\"+dbPass+\"@tcp\"+\"(db:3306)/\"+dbName)\n    if err != nil {\n        fmt.Println(\"dbConn not work\")\n    }\n    return db\n}\n\nfunc init() {\n    tpl = template.Must(template.ParseGlob(\"/go/templates/*\"))\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", index)\n    http.HandleFunc(\"/upload\", uploadWatchInfo)\n    http.ListenAndServe(\":8080\", nil)\n}\n\n//This function get watch id and brand using getWatch function and passes them to the gohtml template file\nfunc index(w http.ResponseWriter, r *http.Request) {\n    db := dbConn()\n    defer db.Close()\n    scanWatches, err := db.Query(\"SELECT * FROM watches order by id\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = db.Ping()\n    if err != nil {\n        fmt.Println(err.Error())\n    }\n\n    watch := watchInfo{}\n    watchSlice := []watchInfo{}\n\n    for scanWatches.Next() {\n        var id int\n        var brand string\n        err = scanWatches.Scan(&amp;id, &amp;brand)\n        if err != nil {\n            fmt.Println(\"sW.Scan didn't work\")\n        }\n        watch.ID = id\n        watch.Brand = brand\n        watchSlice = append(watchSlice, watch)\n\n    }\n    tpl.ExecuteTemplate(w, \"pic.gohtml\", watchSlice)\n\n}\n\nfunc uploadWatchInfo(w http.ResponseWriter, r *http.Request) {\n    db := dbConn()\n    defer db.Close()\n    if r.Method == \"POST\" {\n        brand := r.FormValue(\"brand\")\n        insForm, err := db.Prepare(\"INSERT INTO watches(brand) VALUES(?)\")\n        if err != nil {\n            panic(err.Error)\n        }\n        insForm.Exec(brand)\n        err = tpl.ExecuteTemplate(w, \"upload.gohtml\", watchInfo{Brand: brand})\n        if err != nil {\n            panic(err.Error)\n        }\n    }\n\n}\n\n//this is handling an error and can be called in other page functions\nfunc HandleError(w http.ResponseWriter, err error) {\n    if err != nil {\n        fmt.Println(\"Index did not work. error in index\")\n    }\n}\n</code></pre>\n\n<p>HTML Template</p>\n\n<pre><code>&lt;!doctype html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Upload page&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n&lt;h1&gt;upload page&lt;/h1&gt;\n\n&lt;form method=\"POST\" action=\"insert\"&gt;\n      &lt;label&gt; brand &lt;/label&gt;&lt;input type=\"text\" name=\"brand\"/&gt;&lt;br /&gt;\n      &lt;input type=\"submit\" value=\"Save brand\"/&gt;\n    &lt;/form&gt;\n\n&lt;a href=\"/\"&gt;Index&lt;/a&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>I Expect my handler to insert the string value into the database and print the confirmation in the terminal.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 2, "last_activity_date": 1570408460, "creation_date": 1570408460, "answer_id": 58262335, "question_id": 58262298, "link": "https://stackoverflow.com/questions/58262298/how-does-bytes-split-work-on-bytes-converted-from-utf-8-string/58262335#58262335", "title": "How does bytes.Split() work on bytes converted from UTF-8 string?", "body": "<blockquote>\n  <p>If sep is empty, Split splits after each UTF-8 sequence.</p>\n</blockquote>\n\n<p>\u2014 <a href=\"https://golang.org/pkg/bytes/#Split\" rel=\"nofollow noreferrer\">the docs</a>.</p>\n\n<p>So although <code>bytes.Split</code> does let you split at arbitrary points and break UTF-8 sequences apart, calling it with a separator of <code>[]byte(\"\")</code> won't do so.</p>\n"}], "owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 58262335, "answer_count": 1, "score": -1, "last_activity_date": 1570408460, "creation_date": 1570408071, "question_id": 58262298, "link": "https://stackoverflow.com/questions/58262298/how-does-bytes-split-work-on-bytes-converted-from-utf-8-string", "title": "How does bytes.Split() work on bytes converted from UTF-8 string?", "body": "<pre><code>$ cat main.go \n#!/usr/bin/env gorun\n// vim: set noexpandtab tabstop=2:\n\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"bytes\"\n)\n\nfunc main() {\n    fmt.Printf(\"%q\\n\", bytes.Split([]byte(os.Args[1]), []byte(os.Args[2])))\n}\n$ ./main.go \u7a0b\u5e8f ''\n[\"\u7a0b\" \"\u5e8f\"]\n</code></pre>\n\n<p>I'd expect that <code>main.go</code> print multple bytes per UTF-8 character. But it just prints the two UTF-8 character <code>\u7a0b</code> and <code>\u5e8f</code>.</p>\n\n<p>Could anybody help me understand why it is the case? Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1570419182, "post_id": 58262202, "comment_id": 102894588, "body": "<code>http.NewRequest</code> returns two values: a request, and an error. If the returned error is not nil, the request value <i>is</i> nil. (See actual implementation <a href=\"https://golang.org/src/net/http/request.go?s=28198:28299#L828\" rel=\"nofollow noreferrer\">here</a>.)"}], "answers": [{"comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1570418779, "post_id": 58262367, "comment_id": 102894515, "body": "In particular the <a href=\"https://github.com/cavaliercoder/grab/blob/228f991ef22e03a6e6454847f36e3fd17facabf7/util.go#L46-L69\" rel=\"nofollow noreferrer\"><code>guessFilename</code> function</a> is not happy when called with an errored response (because the <code>req</code> inside it is nil, presumably)."}], "tags": [], "owner": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "is_accepted": true, "score": 3, "last_activity_date": 1570408913, "creation_date": 1570408913, "answer_id": 58262367, "question_id": 58262202, "link": "https://stackoverflow.com/questions/58262202/invalid-memory-address-or-nil-pointer-dereference-running-grab-unit-tests/58262367#58262367", "title": "&quot;invalid memory address or nil pointer dereference&quot; running grab unit tests?", "body": "<p>Add this err print:</p>\n\n<pre><code>            req, err1 := http.NewRequest(\"GET\", tc, nil)\n            if err1 != nil {\n                log.Println(err1.Error())\n            }\n</code></pre>\n\n<p>It would print:</p>\n\n<blockquote>\n  <p>parse <a href=\"http://test.com/filename\" rel=\"nofollow noreferrer\">http://test.com/filename</a>: net/url: invalid control character in URL</p>\n</blockquote>\n\n<p>which means this url <code>\"http://test.com/filename\\x00\"</code> is not allowed.</p>\n\n<p>Comment this line then it works:</p>\n\n<pre><code>[p1gd0g@p1gd0g-pc grab]$ go test\nPASS\nok      github.com/cavaliercoder/grab   2.586s\n</code></pre>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 593, "favorite_count": 0, "accepted_answer_id": 58262367, "answer_count": 1, "score": -2, "last_activity_date": 1570408913, "creation_date": 1570406995, "question_id": 58262202, "link": "https://stackoverflow.com/questions/58262202/invalid-memory-address-or-nil-pointer-dereference-running-grab-unit-tests", "title": "&quot;invalid memory address or nil pointer dereference&quot; running grab unit tests?", "body": "<p>I'm interested in running the unit tests for the package <a href=\"https://github.com/cavaliercoder/grab\" rel=\"nofollow noreferrer\">https://github.com/cavaliercoder/grab</a> in Go 1.13. Although my <code>GO111MODULE</code> environment is usually <code>on</code>, I've downloaded the package to my <code>GOPATH</code> using the following command:</p>\n\n<pre><code>env GO111MODULE=off go get -u -d github.com/cavaliercoder/grab\n</code></pre>\n\n<p>In the resuting <code>grab</code> directory, I've run <code>go mod init</code> which produces the following <code>go.mod</code>:</p>\n\n<pre><code>module github.com/cavaliercoder/grab\n\ngo 1.13\n</code></pre>\n\n<p>Now if I try to run <code>go test</code>, I get the following error:</p>\n\n<pre><code>&gt; go test\npanic: runtime error: invalid memory address or nil pointer dereference [recovered]\n    panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x10 pc=0x12cc70d]\n\ngoroutine 1556 [running]:\ntesting.tRunner.func1(0xc00010ea00)\n    /usr/local/Cellar/go/1.13/libexec/src/testing/testing.go:874 +0x3a3\npanic(0x132ba20, 0x1629ed0)\n    /usr/local/Cellar/go/1.13/libexec/src/runtime/panic.go:679 +0x1b2\ngithub.com/cavaliercoder/grab.guessFilename(0xc00052aed0, 0xc0000aa008, 0x13951b5, 0x3, 0x139c440)\n    /Users/kurt/go/src/github.com/cavaliercoder/grab/util.go:51 +0x2d\ngithub.com/cavaliercoder/grab.TestURLFilenames.func2(0xc00010ea00)\n    /Users/kurt/go/src/github.com/cavaliercoder/grab/util_test.go:54 +0x123\ntesting.tRunner(0xc00010ea00, 0x13afdf8)\n    /usr/local/Cellar/go/1.13/libexec/src/testing/testing.go:909 +0xc9\ncreated by testing.(*T).Run\n    /usr/local/Cellar/go/1.13/libexec/src/testing/testing.go:960 +0x350\nexit status 2\nFAIL    github.com/cavaliercoder/grab   2.531s\n</code></pre>\n\n<p>I've had a look at the offending test file, <code>util_test.go</code>, but couldn't find anything wrong with it:</p>\n\n<pre><code>package grab\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"net/url\"\n    \"testing\"\n)\n\nfunc TestURLFilenames(t *testing.T) {\n    t.Run(\"Valid\", func(t *testing.T) {\n        expect := \"filename\"\n        testCases := []string{\n            \"http://test.com/filename\",\n            \"http://test.com/path/filename\",\n            \"http://test.com/deep/path/filename\",\n            \"http://test.com/filename?with=args\",\n            \"http://test.com/filename#with-fragment\",\n            \"http://test.com/filename?with=args&amp;and#with-fragment\",\n        }\n\n        for _, tc := range testCases {\n            req, _ := http.NewRequest(\"GET\", tc, nil)\n            resp := &amp;http.Response{\n                Request: req,\n            }\n            actual, err := guessFilename(resp)\n            if err != nil {\n                t.Errorf(\"%v\", err)\n            }\n\n            if actual != expect {\n                t.Errorf(\"expected '%v', got '%v'\", expect, actual)\n            }\n        }\n    })\n\n    t.Run(\"Invalid\", func(t *testing.T) {\n        testCases := []string{\n            \"http://test.com\",\n            \"http://test.com/\",\n            \"http://test.com/filename/\",\n            \"http://test.com/filename/?with=args\",\n            \"http://test.com/filename/#with-fragment\",\n            \"http://test.com/filename\\x00\",\n        }\n\n        for _, tc := range testCases {\n            req, _ := http.NewRequest(\"GET\", tc, nil)\n            resp := &amp;http.Response{\n                Request: req,\n            }\n\n            _, err := guessFilename(resp)\n            if err != ErrNoFilename {\n                t.Errorf(\"expected '%v', got '%v'\", ErrNoFilename, err)\n            }\n        }\n    })\n}\n</code></pre>\n\n<p>The error message seems to be saying that <code>req</code> is a null pointer, but since it's defined using <code>http.NewRequest()</code> I don't see how that can be the case?</p>\n"}, {"tags": ["templates", "go", "go-gin"], "comments": [{"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 0, "creation_date": 1570403453, "post_id": 58261897, "comment_id": 102892261, "body": "&quot;foo&quot;:   template.HTML(&quot;&lt;script&gt;bar&lt;/script&gt;&quot;), seems to work if you render the entire script tag and remove the script tags from the template."}], "answers": [{"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 1, "last_activity_date": 1570432892, "creation_date": 1570432892, "answer_id": 58265073, "question_id": 58261897, "link": "https://stackoverflow.com/questions/58261897/in-golang-gin-simple-template-example-how-do-you-render-a-string-without-quotes/58265073#58265073", "title": "In golang gin simple template example, how do you render a string without quotes?", "body": "<p>the template package implements an HTML context aware engine to provide injection safe html. </p>\n\n<p>In other words it knows it executes inside a script tag, thus it does not output raw string but json encoded strings compatible with js. </p>\n\n<p>To fix it, unlike the comment suggests, make the string a <code>template.JS</code> value and the security measures will not attempt to protect the strings.</p>\n\n<p>ref\n- <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/html/template/</a></p>\n\n<blockquote>\n  <p>Package template (html/template) implements data-driven templates for\n  generating HTML output safe against code injection.</p>\n</blockquote>\n\n<ul>\n<li><a href=\"https://golang.org/pkg/html/template/#JS\" rel=\"nofollow noreferrer\">https://golang.org/pkg/html/template/#JS</a></li>\n</ul>\n\n<blockquote>\n  <p>Use of this type presents a security risk: the encapsulated content\n  should come from a trusted source, as it will be included verbatim in\n  the template output.</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"html/template\"\n    \"os\"\n)\n\nfunc main() {\n\n    c := `&lt;script&gt;\n{{.foo}}\n{{.oof}}\n&lt;/script&gt;`\n    d := map[string]interface{}{\"foo\": \"bar\", \"oof\": template.JS(\"rab\")}\n    template.Must(template.New(\"\").Parse(c)).Execute(os.Stdout, d)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6qLnc9ALCeC\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6qLnc9ALCeC</a></p>\n"}], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 798, "favorite_count": 1, "accepted_answer_id": 58265073, "answer_count": 1, "score": 1, "last_activity_date": 1570432892, "creation_date": 1570402756, "last_edit_date": 1570403407, "question_id": 58261897, "link": "https://stackoverflow.com/questions/58261897/in-golang-gin-simple-template-example-how-do-you-render-a-string-without-quotes", "title": "In golang gin simple template example, how do you render a string without quotes?", "body": "<p>Using example golang gin code from README:</p>\n\n<pre><code>func main() {\n\n  router := gin.Default()\n\n  router.LoadHTMLGlob(\"templates/*\")\n  router.GET(\"/\", func(c *gin.Context) {\n    c.HTML(http.StatusOK, \"index.tmpl\",\n      gin.H{\n        \"foo\": \"bar\",\n      })\n  }\n}\n\n// in template index.tmpl\n\n&lt;script&gt;\n{{.foo}}\n&lt;/script&gt;\n\n// result in html\n\n&lt;script&gt;\n\"bar\"\n&lt;/script&gt;\n</code></pre>\n\n<p>But how can I get it without the quotes, I need just <code>bar</code> vs <code>\"bar\"</code>?</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "is_accepted": false, "score": 2, "last_activity_date": 1570402194, "creation_date": 1570402194, "answer_id": 58261837, "question_id": 58261752, "link": "https://stackoverflow.com/questions/58261752/go-ticker-example-doesnt-select-the-done-case/58261837#58261837", "title": "Go ticker example doesn&#39;t select the &#39;done&#39; case?", "body": "<p>When <code>done &lt;- true</code> happened, the main function returned directly.</p>\n\n<p>You could add another time.Sleep() to see what happened.</p>\n\n<pre><code>    time.Sleep(1600 * time.Millisecond)\n    // ticker.Stop()\n    done &lt;- true\n    // fmt.Println(\"Ticker stopped.\")\n    time.Sleep(1600 * time.Millisecond)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 1, "last_activity_date": 1570402223, "creation_date": 1570402223, "answer_id": 58261840, "question_id": 58261752, "link": "https://stackoverflow.com/questions/58261752/go-ticker-example-doesnt-select-the-done-case/58261840#58261840", "title": "Go ticker example doesn&#39;t select the &#39;done&#39; case?", "body": "<blockquote>\n  <p>... why does it not print Received 'done' to the terminal?</p>\n</blockquote>\n\n<p>It does\u2014or rather, it <em>tries</em>.</p>\n\n<p>A Go program exits when the main goroutine (which called <code>main</code> of package <code>main</code>) returns (or sooner in various cases not occurring here).  Your <code>main</code> returns after calling <code>time.Sleep()</code> and then sending <code>true</code> on <code>done</code>.</p>\n\n<p>Meanwhile, the goroutine that's in the <code>for</code> loop awakens when the <code>true</code> value arrives on the <code>done</code> channel.  This happens after the main goroutine has sent it, after which the main goroutine is in the process of exiting.</p>\n\n<p>If, in this process of exiting, the main goroutine takes long enough, the anonymous goroutine will have time to print <code>Received 'done'</code>.  If, in this process of exiting, the main goroutine is speedy enough, the anonymous goroutine never finishes, or maybe never even starts, printing anything, and you see nothing.  (The actual output is accomplished by a single underlying system call so you either get all of it, or none of it.)</p>\n\n<p>You can make sure the goroutine you spun off finishes before having your main one exit by any number of mechanisms, but the simplest is probably to use <code>sync.WaitGroup</code> since it's kind of designed for that.  Create a waitgroup, set its counter to 1 (add 1 to its initial zero), and then call the <code>Done</code> function on the way out of the anonymous goroutine.  Have the main goroutine wait for it.</p>\n\n<p>See <a href=\"https://play.golang.org/p/WD_biHCp44e\" rel=\"nofollow noreferrer\">Go Playground example</a>.</p>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 58261840, "answer_count": 2, "score": 0, "last_activity_date": 1570402223, "creation_date": 1570401244, "question_id": 58261752, "link": "https://stackoverflow.com/questions/58261752/go-ticker-example-doesnt-select-the-done-case", "title": "Go ticker example doesn&#39;t select the &#39;done&#39; case?", "body": "<p>I've adapted this example, <a href=\"https://gobyexample.com/tickers\" rel=\"nofollow noreferrer\">https://gobyexample.com/tickers</a>, to the following script:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    ticker := time.NewTicker(500 * time.Millisecond)\n    done := make(chan bool)\n\n    go func() {\n        for {\n            select {\n            case &lt;-done:\n                fmt.Println(\"Received 'done'\")\n                return\n            case t := &lt;-ticker.C:\n                fmt.Println(\"Tick at\", t)\n            }\n        }\n    }()\n\n    time.Sleep(1600 * time.Millisecond)\n    // ticker.Stop()\n    done &lt;- true\n    // fmt.Println(\"Ticker stopped.\")\n}\n</code></pre>\n\n<p>Two differences with the referenced example are that I've commented out the <code>ticker.Stop()</code> line and added a <code>fmt.Println(\"Received 'done'\")</code> line in the <code>case &lt;-done</code> block. If I run this, I observe the following output:</p>\n\n<pre><code>&gt; go run tickers.go\nTick at 2019-10-06 15:25:50.576798 -0700 PDT m=+0.504913907\nTick at 2019-10-06 15:25:51.074993 -0700 PDT m=+1.003102855\nTick at 2019-10-06 15:25:51.576418 -0700 PDT m=+1.504521538\n</code></pre>\n\n<p>My question: why does it not print <code>Received 'done'</code> to the terminal?</p>\n\n<p>Strangely, if I comment in the <code>Ticker stopped</code> Println statement, I do see <code>Received 'done'</code> as well:</p>\n\n<pre><code>&gt; go run tickers.go\nTick at 2019-10-06 15:27:30.735163 -0700 PDT m=+0.504666656\nTick at 2019-10-06 15:27:31.234076 -0700 PDT m=+1.003573649\nTick at 2019-10-06 15:27:31.735342 -0700 PDT m=+1.504833296\nTicker stopped.\nReceived 'done'\n</code></pre>\n\n<p>As a I recall, the code within a Goroutine can be assuming to run synchronously, so I'm perplexed that I don't see the effect of the <code>Println</code> statement in the former case since it happens before the Goroutine returns. Can someone explain this?</p>\n"}, {"tags": ["javascript", "go", "cryptojs", "sha-3"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570394849, "post_id": 58260989, "comment_id": 102890766, "body": "Funny enough, i get a third value with Python\u2018s <code>hashlib.sha3_512(b\u201cfoo\u201c).hexdigest()</code>..."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1570402810, "post_id": 58260989, "comment_id": 102892152, "body": "Assuming your Go package implements <a href=\"https://golang.org/pkg/hash/#Hash\" rel=\"nofollow noreferrer\">hash.Hash</a> you have to call Write before Sum (passing the hash input to Sum is nonsensical)."}], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 3, "last_activity_date": 1570403341, "creation_date": 1570403341, "answer_id": 58261931, "question_id": 58260989, "link": "https://stackoverflow.com/questions/58260989/cryptojs-and-golang-give-different-sha3-hash-values/58261931#58261931", "title": "cryptojs and golang give different sha3 hash values", "body": "<p>I don't know whose sha3 package you're using.  Here's what I get with <a href=\"https://play.golang.org/p/fEI1gUwLycu\" rel=\"nofollow noreferrer\">this code</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"golang.org/x/crypto/sha3\"\n)\n\nfunc main() {\n    h := sha3.New512()\n    h.Write([]byte(\"foo\"))\n    sum := h.Sum(nil)\n    fmt.Printf(\"hash = %x\\n\", sum)\n}\n</code></pre>\n\n<p><code>hash = 4bca2b137edc580fe50a88983ef860ebaca36c857b1f492839d6d7392452a63c82cbebc68e3b70a2a1480b4bb5d437a7cba6ecf9d89f9ff3ccd14cd6146ea7e7</code></p>\n\n<p>Compare with Python3:</p>\n\n<pre><code>&gt;&gt;&gt; import hashlib\n&gt;&gt;&gt; print(hashlib.sha3_512(b\"foo\").hexdigest())\n</code></pre>\n\n<p>which prints:</p>\n\n<p><code>4bca2b137edc580fe50a88983ef860ebaca36c857b1f492839d6d7392452a63c82cbebc68e3b70a2a1480b4bb5d437a7cba6ecf9d89f9ff3ccd14cd6146ea7e7</code></p>\n"}, {"tags": [], "owner": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "is_accepted": true, "score": 2, "last_activity_date": 1570405260, "creation_date": 1570405260, "answer_id": 58262073, "question_id": 58260989, "link": "https://stackoverflow.com/questions/58260989/cryptojs-and-golang-give-different-sha3-hash-values/58262073#58262073", "title": "cryptojs and golang give different sha3 hash values", "body": "<p>Obviously, your output is 134-width which should be 128-width.</p>\n\n<p>Let us decode your output:</p>\n\n<pre><code>bytes, _ := hex.DecodeString(\"666f6fa69f73cca23a9ac5c8b567dc185a756e97c982164fe25859e0d1dcc1475c80a615b2123af1f5f94c11e3e9402c3ac558f500199d95b6d3e301758586281dcd26\")\nfmt.Printf(\"%s\\n\", bytes)\n</code></pre>\n\n<p>We found the output is <code>foo\ufffd\ufffds\u0322:\ufffd\ufffd\u0235g\ufffdZun\ufffd\u0242O\ufffdXY\ufffd\ufffd\ufffd\ufffdG\\\ufffd\ufffd\ufffd:\ufffd\ufffd\ufffdL\ufffd\ufffd@,:\ufffdX\ufffd\ufffd\ufffd\ufffd\ufffd\ufffdu\ufffd\ufffd(\ufffd&amp;</code>.</p>\n\n<p>That means what you did actually is to output:</p>\n\n<p>\"foo\" + sha3(\"\")</p>\n\n<p>where sha3_512(\"\") is \"a69f73cca23a9ac5c8b567dc185a756e97c982164fe25859e0d1dcc1475c80a615b2123af1f5f94c11e3e9402c3ac558f500199d95b6d3e301758586281dcd26\" from <a href=\"https://en.wikipedia.org/wiki/SHA-3\" rel=\"nofollow noreferrer\">Examples of SHA-3 variants</a>.</p>\n"}], "owner": {"reputation": 47, "user_id": 1044459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f07ea00f517691df6db1d598f18da142?s=128&d=identicon&r=PG", "display_name": "user1044459", "link": "https://stackoverflow.com/users/1044459/user1044459"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 1, "accepted_answer_id": 58262073, "answer_count": 2, "score": 0, "last_activity_date": 1570470968, "creation_date": 1570393837, "last_edit_date": 1570470968, "question_id": 58260989, "link": "https://stackoverflow.com/questions/58260989/cryptojs-and-golang-give-different-sha3-hash-values", "title": "cryptojs and golang give different sha3 hash values", "body": "<p>I'm trying to generate a sha3-512 hash in JS and check it in a golang server. However, cryptoJS is producing different hashes than golang.</p>\n\n<p>CryptoJS:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>CryptoJS.algo.SHA3.create().update(\"foo\").finalize().toString(CryptoJS.enc.Hex)\n</code></pre>\n\n<p>Output: </p>\n\n<p><code>1597842aac52bc9d13fe249d808afbf44da13524759477404c3592ee331173e89fe1cbf21a7e4360990d565fad4643cdb209d80fa41a91dea97e665022c92135</code></p>\n\n<hr>\n\n<p>Golang:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>hex.EncodeToString(crypto.SHA3_512.New().Sum([]byte(\"foo\")))\n</code></pre>\n\n<p>Output:</p>\n\n<p><code>666f6fa69f73cca23a9ac5c8b567dc185a756e97c982164fe25859e0d1dcc1475c80a615b2123af1f5f94c11e3e9402c3ac558f500199d95b6d3e301758586281dcd26</code></p>\n\n<p>I expect these hashes to be equal, but they aren't</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1570388982, "last_edit_date": 1570388982, "creation_date": 1570388250, "answer_id": 58260353, "question_id": 58260325, "link": "https://stackoverflow.com/questions/58260325/pass-data-and-a-variable-to-a-template/58260353#58260353", "title": "Pass data and a variable to a template", "body": "<p>Pass a value containing the query results and user name to the template:</p>\n\n<pre><code>err := temp.ExecuteTemplate(w, \"user.html\", &amp;struct {\n    Orders []Order\n    Username string\n}{\n    results,\n    username,\n})\nif err != nil {\n   // handle error\n}\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>&lt;body&gt;\n    &lt;h2&gt;Hello {{.Username}}!&lt;/h2&gt;\n    &lt;h4&gt;Here's a list of your orders with us:&lt;/h4&gt;\n    &lt;ul&gt;\n        {{ range .Orders }}\n        &lt;li&gt;&lt;a href=\"product?order={{ .Order_id }}\"&gt;{{ .Order_id }}&lt;/a&gt;&lt;/li&gt;\n        {{ end }}\n    &lt;/ul&gt;\n&lt;/body&gt;\n</code></pre>\n"}], "owner": {"reputation": 1087, "user_id": 5205011, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/968219f104811ae38a507aae54cef85b?s=128&d=identicon&r=PG&f=1", "display_name": "davidb", "link": "https://stackoverflow.com/users/5205011/davidb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 58260353, "answer_count": 1, "score": 0, "last_activity_date": 1570391294, "creation_date": 1570388053, "last_edit_date": 1570391294, "question_id": 58260325, "link": "https://stackoverflow.com/questions/58260325/pass-data-and-a-variable-to-a-template", "title": "Pass data and a variable to a template", "body": "<p>I have a page where I get a variable from URL and use it to fetch some data from a database. I then pass the data to the template and display the results.\nWhat I want to do is to pass the variable AND the data to the template.\nIn my code I have the following:</p>\n\n<pre><code>type Username struct {\n    Username string\n}\n\ntype Order struct {\n    Order_id int\n    Customer string\n    Date_of_purchase string\n}\n\nfunc OrderPage(w http.ResponseWriter, r *http.Request) {\n    db := dbConnection()\n    username := r.URL.Query().Get(\"username\")\n    query, err := db.Query(\"SELECT * FROM orders WHERE customer=?\", username)\n    if err != nil {\n        panic(err.Error())\n    }\n    defer query.Close()\n\n    order := Order{}\n    results := []Order{}\n    for query.Next(){\n        var order_id int\n        var customer, date_of_purchase string\n        query.Scan(&amp;order_id, &amp;customer, &amp;date_of_purchase)\n        order.Order_id = order_id\n        order.Customer = customer\n        order.Date_of_purchase = date_of_purchase\n        results = append(results, order)\n    }\n    fmt.Println(results)\n    temp.ExecuteTemplate(w, \"user.html\", results)\n}\n</code></pre>\n\n<p>I am not sure how to pass <code>username := r.URL.Query().Get(\"username\")</code> so that I could later access it from the template:</p>\n\n<pre><code>&lt;body&gt;\n    &lt;h2&gt;Hello!&lt;/h2&gt;\n    &lt;h4&gt;Here's a list of your orders with us:&lt;/h4&gt;\n    &lt;ul&gt;\n        {{ range . }}\n        &lt;li&gt;&lt;a href=\"product?order={{ .Order_id }}\"&gt;{{ .Order_id }}&lt;/a&gt;&lt;/li&gt;\n        {{ end }}\n    &lt;/ul&gt;\n&lt;/body&gt;\n</code></pre>\n\n<p>I'm still learning this so I'm not even sure how to approach this. Can I do something like that and how would I access the variable and the data in the template?</p>\n"}, {"tags": ["go", "logging"], "answers": [{"tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": true, "score": 1, "last_activity_date": 1570389908, "last_edit_date": 1570389908, "creation_date": 1570389427, "answer_id": 58260501, "question_id": 58260137, "link": "https://stackoverflow.com/questions/58260137/how-to-extend-log-api-with-new-function/58260501#58260501", "title": "how to extend log api with new function", "body": "<p>One way to do it would be to use <code>WithFields</code> and <code>logrus.Fields</code> like this: </p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/sirupsen/logrus\"\n    \"os\"\n    \"runtime\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    lgr().Log(logrus.InfoLevel, \"info\")\n}\n\nfunc lgr() *logrus.Entry {\n\n    pc, file, line, ok := runtime.Caller(1)\n    if !ok {\n        panic(\"Could not get context info for logger!\")\n    }\n    filename := file[strings.LastIndex(file, \"/\")+1:] + \":\" + strconv.Itoa(line)\n    funcname := runtime.FuncForPC(pc).Name()\n    fn := funcname[strings.LastIndex(funcname, \".\")+1:]\n\n    loggerImpl := &amp;logrus.Logger{\n        Out:   os.Stdout,\n        Hooks: nil,\n        Formatter: &amp;logrus.JSONFormatter{\n            TimestampFormat: \"2006-01-02 15:04:05\",\n            PrettyPrint:     true,\n        },\n        Level:    logrus.InfoLevel,\n        ExitFunc: nil,\n    }\n\n    return loggerImpl.WithFields(logrus.Fields{\n        \"file\":     filename,\n        \"function\": fn,\n    })\n}\n\n</code></pre>\n\n<p>In the above code <code>*logrus.Entry</code> has all the methods you would expect from a logger. You can also use the interface <code>logrus.FieldLogger</code> but if we do so, we will need to stick to the methods on that interface, (no <code>Log</code> method for example - have to use Info / Error etc). </p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/sirupsen/logrus\"\n    \"os\"\n    \"runtime\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    lgr().Infoln(\"Hello world\")\n}\n\nfunc lgr() logrus.FieldLogger {\n\n    pc, file, line, ok := runtime.Caller(1)\n    if !ok {\n        panic(\"Could not get context info for logger!\")\n    }\n    filename := file[strings.LastIndex(file, \"/\")+1:] + \":\" + strconv.Itoa(line)\n    funcname := runtime.FuncForPC(pc).Name()\n    fn := funcname[strings.LastIndex(funcname, \".\")+1:]\n\n    loggerImpl := &amp;logrus.Logger{\n        Out:   os.Stdout,\n        Hooks: nil,\n        Formatter: &amp;logrus.JSONFormatter{\n            TimestampFormat: \"2006-01-02 15:04:05\",\n            PrettyPrint:     true,\n        },\n        Level:    logrus.InfoLevel,\n        ExitFunc: nil,\n    }\n\n    return loggerImpl.WithFields(logrus.Fields{\n        \"file\":     filename,\n        \"function\": fn,\n    })\n}\n\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>{\n  \"file\": \"main.go:12\",\n  \"function\": \"main\",\n  \"level\": \"info\",\n  \"msg\": \"Hello world\",\n  \"time\": \"2019-10-07 01:24:10\"\n}\n</code></pre>\n"}], "owner": {"reputation": 351, "user_id": 10816571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45aa02b808aa538cdaa37ed33a8557e9?s=128&d=identicon&r=PG&f=1", "display_name": "Rayn D", "link": "https://stackoverflow.com/users/10816571/rayn-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 1, "accepted_answer_id": 58260501, "answer_count": 1, "score": 0, "last_activity_date": 1570389908, "creation_date": 1570386400, "last_edit_date": 1570387803, "question_id": 58260137, "link": "https://stackoverflow.com/questions/58260137/how-to-extend-log-api-with-new-function", "title": "how to extend log api with new function", "body": "<p>Im using the following code with <code>logrus</code>, and I want to extend it i.e. that \non each usage of this logrus log it will add by default the <code>function</code> \nand the <code>file</code> but it doesn't works as </p>\n\n<p><strong>I got</strong> </p>\n\n<pre><code>{\n  \"level\": \"info\",\n  \"msg\": \"info\",\n  \"time\": \"2019-10-06 17:14:25\"\n}\n</code></pre>\n\n<p><strong>I want</strong> </p>\n\n<pre><code>{\n  \"file\": \u201cmyfile.go\",\n  \"func\": \u201cmyfunc:95\",\n  \"level\": \"info\",\n  \"msg\": \"info\",\n  \"time\": \"2019-10-06 17:17:53\"\n}\n</code></pre>\n\n<p>Im not talking about using ReportCaller: true, I just want to extend the logger with my function</p>\n\n<p>How Can I do it ?</p>\n\n<p>This is what I try</p>\n\n<pre><code>package main\n\nimport (\n   \"os\"\n   \"runtime\"\n   \"strconv\"\n   \"strings\"\n   \"github.com/sirupsen/logrus\"\n)\n\nfunc main() {\n   lgr().Log(logrus.InfoLevel,\"info\")\n}\n\nfunc lgr() *logrus.Logger {\n\n\n   loggerImpl := &amp;logrus.Logger{\n      Out:   os.Stdout,\n      Hooks: nil,\n      Formatter: &amp;logrus.JSONFormatter{\n         TimestampFormat: \"2006-01-02 15:04:05\",\n         CallerPrettyfier: func(f *runtime.Frame) (string, string) {\n\n            pc, file, line, ok := runtime.Caller(1)\n            if !ok {\n               panic(\"Could not get context info for logger!\")\n            }\n            filename := file[strings.LastIndex(file, \"/\")+1:] + \":\" + strconv.Itoa(line)\n            funcname := runtime.FuncForPC(pc).Name()\n            fn := funcname[strings.LastIndex(funcname, \".\")+1:]\n            return filename, fn\n         },\n\n\n         PrettyPrint: true,\n      },\n      Level:        logrus.InfoLevel,\n      ExitFunc:     nil,\n   }\n   return loggerImpl\n}\n</code></pre>\n"}, {"tags": ["go", "networking", "blocking"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570383204, "post_id": 58259681, "comment_id": 102888058, "body": "Yes, this can be done in the way you illustrated already. Did you run into problems with this approach?"}, {"owner": {"reputation": 110, "user_id": 6804547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qHZ1W.jpg?s=128&g=1", "display_name": "Amer", "link": "https://stackoverflow.com/users/6804547/amer"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570383254, "post_id": 58259681, "comment_id": 102888071, "body": "Yes, I get stuck in the listen function. The other function never runs."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "edited": false, "score": 0, "creation_date": 1570383508, "post_id": 58259681, "comment_id": 102888145, "body": "What is the value of <code>port</code>?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570383610, "post_id": 58259681, "comment_id": 102888175, "body": "How are you stuck? Any errors? One thing you might do is that once you accept a connection, you should start a new goroutine to process that connection while the listen() function should go back to listening."}, {"owner": {"reputation": 110, "user_id": 6804547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qHZ1W.jpg?s=128&g=1", "display_name": "Amer", "link": "https://stackoverflow.com/users/6804547/amer"}, "edited": false, "score": 0, "creation_date": 1570383850, "post_id": 58259681, "comment_id": 102888240, "body": "But I want the whole listen function to run in the background. Right now, the whole program gets stuck on the listener.Accept() and keeps waiting until a new connection is made. The other function is not run during the waiting."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570383871, "post_id": 58259681, "comment_id": 102888248, "body": "You are ignoring the error from net.Listen. You shouldn&#39;t."}, {"owner": {"reputation": 110, "user_id": 6804547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qHZ1W.jpg?s=128&g=1", "display_name": "Amer", "link": "https://stackoverflow.com/users/6804547/amer"}, "edited": false, "score": 0, "creation_date": 1570384132, "post_id": 58259681, "comment_id": 102888325, "body": "I tried to print the error but no error is occurring."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570384354, "post_id": 58259681, "comment_id": 102888384, "body": "How do you know it is stuck at Accept()? After a few edits, I can run this without problems."}, {"owner": {"reputation": 110, "user_id": 6804547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qHZ1W.jpg?s=128&g=1", "display_name": "Amer", "link": "https://stackoverflow.com/users/6804547/amer"}, "edited": false, "score": 0, "creation_date": 1570384578, "post_id": 58259681, "comment_id": 102888445, "body": "Ok I figured it out and it was pretty dumb of me. The receiver string was being printed somewhere else and I thought it was stuck whereas it was just waiting for the user input. Thanks for all the help man!"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570384775, "post_id": 58259681, "comment_id": 102888508, "body": "The function<code>getNewTransaction</code> discards a bufio.Reader and possibly buffered data on every iteration of the loop.  Create the bufio.Reader outside the loop to avoid discarding buffered data."}, {"owner": {"reputation": 110, "user_id": 6804547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qHZ1W.jpg?s=128&g=1", "display_name": "Amer", "link": "https://stackoverflow.com/users/6804547/amer"}, "edited": false, "score": 0, "creation_date": 1570385544, "post_id": 58259681, "comment_id": 102888719, "body": "Thanks, I&#39;ll keep that in mind!"}], "answers": [{"comments": [{"owner": {"reputation": 110, "user_id": 6804547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qHZ1W.jpg?s=128&g=1", "display_name": "Amer", "link": "https://stackoverflow.com/users/6804547/amer"}, "edited": false, "score": 0, "creation_date": 1570429546, "post_id": 58260430, "comment_id": 102896666, "body": "Thanks for the reply. I was actually taking the port as a command line argument so I didn&#39;t think it was necessary to include it. The code was working fine, I was just misinterpreting the output."}], "tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": false, "score": 0, "last_activity_date": 1570388873, "creation_date": 1570388873, "answer_id": 58260430, "question_id": 58259681, "link": "https://stackoverflow.com/questions/58259681/program-that-listens-for-connections-in-background-and-also-waits-for-user-input/58260430#58260430", "title": "Program that listens for connections in background and also waits for user input", "body": "<p>Your original code doesn't show how the <code>port</code> is being available inside the <code>listen</code> function. So I am pretty sure the code is erroring out in that function.</p>\n\n<p>I updated the <code>listen</code> function, and the one that takes user input. Replaces the <code>select{}</code> with wait group.  </p>\n\n<p>Here's working code: </p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"sync\"\n)\n\nfunc listen(port string) {\n    listener, _ := net.Listen(\"tcp4\", \":\"+port)\n    defer listener.Close()\n\n    fmt.Println(\"Telnet to: \", port)\n\n    for {\n        conn, err := listener.Accept()\n        if err != nil {\n            fmt.Println(err)\n        } else {\n            conn.Write([]byte(\"kthx bye!\"))\n        }\n\n        conn.Close()\n\n    }\n}\n\nfunc getNewTransaction() {\n    for {\n        reader := bufio.NewReader(os.Stdin)\n        fmt.Println(\"Type something and press enter: \")\n        input, _ := reader.ReadString('\\n')\n\n        fmt.Println(input)\n    }\n}\n\nfunc main() {\n    go listen(\"8080\")\n    go getNewTransaction()\n\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(1)\n    wg.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 110, "user_id": 6804547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qHZ1W.jpg?s=128&g=1", "display_name": "Amer", "link": "https://stackoverflow.com/users/6804547/amer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570388873, "creation_date": 1570382953, "last_edit_date": 1570383223, "question_id": 58259681, "link": "https://stackoverflow.com/questions/58259681/program-that-listens-for-connections-in-background-and-also-waits-for-user-input", "title": "Program that listens for connections in background and also waits for user input", "body": "<p>I want to create a program that waits for user input and at the same time, listens for connections in the background. Neither of my functions depends on the other. I'm new to Go so I'm not sure how I can accomplish this. Can this even be done?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func listen() {\n    listener, _ := net.Listen(\"tcp4\", \":\" + port)\n    defer listener.Close()\n\n    for {\n        conn, err := listener.Accept()\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n        // Some stuff\n    }\n}\n\n\nfunc getNewTransaction() {\n    for {\n        reader := bufio.NewReader(os.Stdin)\n        fmt.Println(\"Receiver: \")\n        receiver, _ := reader.ReadString('\\n')\n\n        var amount float32\n        fmt.Println(\"Amount: \")\n        fmt.Scanf(\"%f\", &amp;amount)\n\n    }\n}\n\n\nfunc main() {\n    go listen()\n    go getNewTransaction()\n\n    select{}\n}\n</code></pre>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1570374205, "post_id": 58258437, "comment_id": 102885688, "body": "<code>NewDepartment</code> in the json is an object, not an array. So similarly the <code>NewDeps</code> field in your Go code should be a struct, not a slice. That is, change <code>NewDeps []NewDepartment</code> to <code>NewDeps NewDepartment</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2009, "user_id": 518469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d25f5f2f0ff49caee819e3e1805cb436?s=128&d=identicon&r=PG&f=1", "display_name": "yname", "link": "https://stackoverflow.com/users/518469/yname"}, "is_accepted": true, "score": 2, "last_activity_date": 1570385364, "last_edit_date": 1570385364, "creation_date": 1570375516, "answer_id": 58258695, "question_id": 58258437, "link": "https://stackoverflow.com/questions/58258437/how-to-unmarshall-json-in-golang/58258695#58258695", "title": "How to unmarshall JSON in golang", "body": "<p>You're almost there.</p>\n\n<p>First update is to make <code>NewDeps.NewDeps</code> a single object, not an array (according to the provided JSON).</p>\n\n<p>The second update is to deserialize JSON into <code>NewDeps</code>, not into <code>NewDepartment</code>.</p>\n\n<p>Working code: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type NewDepartment struct {\n    NewDepName string      `json:\"newDepName\"`\n    NewDepCompany int      `json:\"newDepCompany\"`\n    NewDepMail string      `json:\"newDepMail\"`\n}\n\ntype NewDeps struct {\n    NewDeps NewDepartment  `json:\"NewDepartment\"`\n}\n\nfunc main() {\n    var data NewDeps\n    json.Unmarshal([]byte(body), &amp;data)\n\n    fmt.Println(\"AddDepartment JSON string got: \" + data.NewDeps.NewDepName)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Sn02hwETRv1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Sn02hwETRv1</a></p>\n"}], "owner": {"reputation": 33, "user_id": 11973944, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-TmPqH3ADmhE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcHZhv_RsnSAT_sxpTW7fNUAyJqmw/photo.jpg?sz=128", "display_name": "Jo Jo", "link": "https://stackoverflow.com/users/11973944/jo-jo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 58258695, "answer_count": 1, "score": -1, "last_activity_date": 1570436761, "creation_date": 1570373669, "last_edit_date": 1570436761, "question_id": 58258437, "link": "https://stackoverflow.com/questions/58258437/how-to-unmarshall-json-in-golang", "title": "How to unmarshall JSON in golang", "body": "<p>I have trouble unmarshal access the values of a JSON string in my golang service.</p>\n\n<p>I read the documentation for golang but the JSON objects in the examples are all differently formated.</p>\n\n<p>from my api i get the following JSON string:</p>\n\n<pre><code>{\"NewDepartment\":\n    {\n    \"newDepName\":\"Testabt\",\n    \"newDepCompany\":2,\n    \"newDepMail\":\"Bla@bla.org\"\n    }\n}\n</code></pre>\n\n<p>in go I defined the following data types:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type NewDepartment struct {\n    NewDepName string `json:\"newDepName\"`\n    NewDepCompany   int `json:\"newDepCompany\"`\n    NewDepMail string `json:\"newDepMail\"`\n}\n\ntype NewDeps struct {\n    NewDeps   []NewDepartment `json:\"NewDepartment\"`\n}\n</code></pre>\n\n<p>I try to unmarshal the JSON (from request Body) and access the values, but I can't get any results</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var data types.NewDepartment\n    errDec := json.Unmarshal(reqBody, &amp;data)\n\nfmt.Println(\"AddDepartment JSON string got: \" + data.NewDepName)\n</code></pre>\n\n<p>but it contains no string - nothing is displayed but no error on unmarshaling or Println.</p>\n\n<p>Thanks for the help.</p>\n"}, {"tags": ["xml", "go", "marshalling", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 8496766, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1941938429402414/picture?type=large", "display_name": "Kasper Gyselinck", "link": "https://stackoverflow.com/users/8496766/kasper-gyselinck"}, "edited": false, "score": 0, "creation_date": 1570428167, "post_id": 58262021, "comment_id": 102896252, "body": "I&#39;ve also considered that the marshaler adds the xmlns:xsi=&quot;xsi&quot; tag because it is missing from this example, but adding it in a higher level element, or in the same element for that matter did not seem to solve the issue. Could you provide an example in which this works? In my case I compare the text snippets because I want to build a library of structs not only suited for decoding, but also encoding xml to the same format. The xsi tag should look like this: xmlns:xsi=&quot;<a href=\"http://www.w3.org/2001/XMLSchema-instance\" rel=\"nofollow noreferrer\">w3.org/2001/XMLSchema-instance</a>&quot;"}, {"owner": {"reputation": 24922, "user_id": 4001, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3b2c4583cd2eee64afe2ff888d590cf9?s=128&d=identicon&r=PG", "display_name": "abbot", "link": "https://stackoverflow.com/users/4001/abbot"}, "reply_to_user": {"reputation": 135, "user_id": 8496766, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1941938429402414/picture?type=large", "display_name": "Kasper Gyselinck", "link": "https://stackoverflow.com/users/8496766/kasper-gyselinck"}, "edited": false, "score": 1, "creation_date": 1570485504, "post_id": 58262021, "comment_id": 102921643, "body": "You can&#39;t force Go standard marshaler to use specific namespace prefixes for xmlns&#39;es it generates in output. Note that this still produces compliant XML. You need to specify full namespace URLs in struct tags for that. Fully working example: <a href=\"https://play.golang.org/p/laS_hX9heyv\" rel=\"nofollow noreferrer\">play.golang.org/p/laS_hX9heyv</a>"}], "tags": [], "owner": {"reputation": 24922, "user_id": 4001, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3b2c4583cd2eee64afe2ff888d590cf9?s=128&d=identicon&r=PG", "display_name": "abbot", "link": "https://stackoverflow.com/users/4001/abbot"}, "is_accepted": false, "score": 2, "last_activity_date": 1570404483, "creation_date": 1570404483, "answer_id": 58262021, "question_id": 58257627, "link": "https://stackoverflow.com/questions/58257627/xml-marshaling-and-unmarshaling-xsitype/58262021#58262021", "title": "xml marshaling and unmarshaling xsi:type", "body": "<p>Technically the golden result in the example (I mean the <a href=\"https://play.golang.org/p/ORQsINYS-9o\" rel=\"nofollow noreferrer\">first one</a>) doesn't seem to be a well-formed XML. It has an unbound xml element prefix <code>xsi</code> for the <code>xsi:type</code> attribute. I think, <a href=\"https://www.w3.org/TR/xml-names/#scoping-defaulting\" rel=\"nofollow noreferrer\">this spec</a> sets the authoritative rule for that. This XML snippet looks to be taken out of contest, if it is a part of a larger document then the <code>xsi</code> prefix is likely to be bound elsewhere - it is very common for SOAP documents.</p>\n\n<p>Note that the Go Marshaller produces a well-formed XML. This documents is still not a valid XML, because of missing DTDs in the snippet and so on, but it least it will not confuse any XML parser.</p>\n\n<p>As a broader suggestion, matching the exact textual representation of XML documents for tests or anything is most likely to produce poor results, because there is more than one syntactically correct (and well-formed) way to encode a document in XML. Different marshallers can tweak the specific encoding approach to the liking of their authors, and this does not make the generated XML broken or incompatible with any other compliant decoder. Instead of comparing the text snippets, try to compare the unmarhsalled structures. Something like <a href=\"https://godoc.org/github.com/google/go-cmp/cmp\" rel=\"nofollow noreferrer\">github.com/google/go-cmp/cmp</a> package can make it simple.</p>\n"}], "owner": {"reputation": 135, "user_id": 8496766, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1941938429402414/picture?type=large", "display_name": "Kasper Gyselinck", "link": "https://stackoverflow.com/users/8496766/kasper-gyselinck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 389, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1570404483, "creation_date": 1570367991, "question_id": 58257627, "link": "https://stackoverflow.com/questions/58257627/xml-marshaling-and-unmarshaling-xsitype", "title": "xml marshaling and unmarshaling xsi:type", "body": "<p>This is about the <strong>xsi:type</strong> attribute, but if you have an element named &lt;<strong>soap:envelope</strong> ...> similar issues arise where it seems necessary to implement custom unmarshaler functions.</p>\n\n<p>here's the code with the problem (on the go playground: <a href=\"https://play.golang.org/p/ORQsINYS-9o\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ORQsINYS-9o</a>)</p>\n\n<pre><code>type PayloadPublication struct {\n    XMLName xml.Name `json:\"xmlName\"`\n    XsiType xml.Attr `xml:\"xsi type,attr\" json:\"xsiType\"`\n    Lang    xml.Attr `xml:\"lang,attr\" json:\"lang\"`\n}\n\nfunc main() {\n    payload := PayloadPublication{}\n\n    expectedXML := `&lt;payloadPublication xmlns=\"http://datex2.eu/schema/2/2_0\" xsi:type=\"MeasurementSiteTablePublication\" lang=\"nl\"&gt;&lt;/payloadPublication&gt;`\n\n    // 1. Unmarshal - 2. Marshal - 3. Compare\n    err := xml.Unmarshal([]byte(expectedXML), &amp;payload)\n    if err != nil {\n        fmt.Print(err.Error())\n    }\n\n    result, err := xml.Marshal(payload)\n    if err != nil {\n        fmt.Print(err.Error())\n    }\n\n    fmt.Printf(\"expected: %v\\n\", expectedXML)\n    fmt.Printf(\"result:   %v\\n\", string(result))\n}\n</code></pre>\n\n<p>the outcome</p>\n\n<pre><code>expected: &lt;payloadPublication xmlns=\"http://datex2.eu/schema/2/2_0\" xsi:type=\"MeasurementSiteTablePublication\" lang=\"nl\"&gt;&lt;/payloadPublication&gt;\nresult:   &lt;payloadPublication xmlns=\"http://datex2.eu/schema/2/2_0\" xmlns:xsi=\"xsi\" xsi:type=\"MeasurementSiteTablePublication\" lang=\"nl\"&gt;&lt;/payloadPublication&gt;\n</code></pre>\n\n<p>as you can see the attribute <strong>xmlns:xsi=\"xsi\"</strong> was added which is not what I want</p>\n\n<p>A workaround for this would be using a custom unmarshaler but this seems needlessly complex and verbose. (code below).\nIs there an easier way to do this? What would be the conventional way to deal with this kind of XML?</p>\n\n<p>workaround code (on the playground: <a href=\"https://play.golang.org/p/d4OtYPtYBDg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/d4OtYPtYBDg</a>)</p>\n\n<pre><code>type PayloadPublication struct {\n    XMLName xml.Name `json:\"xmlName\"`\n    XsiType xml.Attr `xml:\"xsi type,attr\" json:\"xsiType\"`\n    Lang    xml.Attr `xml:\"lang,attr\" json:\"lang\"`\n}\n\nfunc (pp *PayloadPublication) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    // Attributes\n    for _, attr := range start.Attr {\n        if attr.Name.Local == \"type\" {\n            pp.XsiType = xml.Attr{Name: xml.Name{Local: \"xsi:type\"}, Value: attr.Value}\n        }\n    }\n\n    var dummy struct {\n        // attributes\n        XMLName xml.Name `json:\"xmlName\"`\n        XsiType xml.Attr `xml:\"xsi type,attr\" json:\"xsiType\"`\n        Lang    xml.Attr `xml:\"lang,attr\" json:\"lang\"`\n    }\n\n    err := d.DecodeElement(&amp;dummy, &amp;start)\n    if err != nil {\n        return err\n    }\n\n    pp.XMLName = dummy.XMLName\n    pp.Lang = dummy.Lang\n\n    return nil\n}\n\nfunc main() {\n    payload := PayloadPublication{}\n\n    expectedXML := `&lt;payloadPublication xmlns=\"http://datex2.eu/schema/2/2_0\" xsi:type=\"MeasurementSiteTablePublication\" lang=\"nl\"&gt;&lt;/payloadPublication&gt;`\n\n    // 1. Unmarshal - 2. Marshal - 3. Compare\n    err := xml.Unmarshal([]byte(expectedXML), &amp;payload)\n    if err != nil {\n        fmt.Print(err.Error())\n    }\n\n    result, err := xml.Marshal(payload)\n    if err != nil {\n        fmt.Print(err.Error())\n    }\n\n    fmt.Printf(\"expected: %v\\n\", expectedXML)\n    fmt.Printf(\"result:   %v\\n\", string(result))\n}\n</code></pre>\n"}, {"tags": ["go", "factory", "abstraction"], "answers": [{"comments": [{"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "edited": false, "score": 0, "creation_date": 1570386800, "post_id": 58258919, "comment_id": 102889041, "body": "Thanks a lot! 1+ you recommended to use just log(of go-kit), so what are the  benfit of the <code>go-kit</code> when they extend the <code>logrus</code> and <code>zap</code>?"}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "edited": false, "score": 0, "creation_date": 1570387046, "post_id": 58258919, "comment_id": 102889100, "body": "I think they just provided an interface so you can connect your favorite logger with it. And that&#39;s why they had to build a very common interface and couldn&#39;t allow per logger based features. If my answer helped, please accept it as the answer."}, {"owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "edited": false, "score": 0, "creation_date": 1570387223, "post_id": 58258919, "comment_id": 102889142, "body": "I accept the answer :-) , one question, if I want to switch between the usage of the logger sometime <code>zap</code> and sometime <code>logrus</code> I need to use just log ? nothing else , so I dont really understand the benfit here ?"}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "edited": false, "score": 0, "creation_date": 1570387775, "post_id": 58258919, "comment_id": 102889272, "body": "If you want to switch between loggers, you will also need to initiate the respective logger. Specially here: <code>logger := log.NewLogrusLogger(logrusLogger)</code> - you would create a new ZapLogger or whatever else you want to use. With that, you will only get the <code>Log</code> method. The benefit is that you don&#39;t need to change your code anywhere. If you used logrus specific features and then switched to zap, you needed to change those. But with one common interface, you don&#39;t have to."}], "tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": true, "score": 1, "last_activity_date": 1570377208, "creation_date": 1570377208, "answer_id": 58258919, "question_id": 58257555, "link": "https://stackoverflow.com/questions/58257555/using-go-kit-logger-api-missing-methods/58258919#58258919", "title": "Using go-kit logger api missing methods", "body": "<p>It's because <code>log.NewLogrusLogger()</code> creates the unexported <code>logruslogger</code> which has only one method <code>Log</code> (satisfying the <code>log.Logger</code> interface). It doesn't support the other methods from logrus itself. </p>\n\n<p>This <code>Log</code> method can take arguments in key value pairs and put them in <code>logrus.Fields</code> while logging. So if you do <code>Log(\"hello\", \"world\")</code>, it would set <code>hello</code> field's value to <code>world</code>. But this wouldn't work for <code>level</code> or other features. </p>\n\n<p>However, since <code>logrus.FieldLogger</code> is embedded in the implementation of the <code>logruslogger</code>, we can assert our logger to behave like <code>logrus.FieldLogger</code> and then do this: </p>\n\n<pre><code>package main\n\nimport (\n    log \"github.com/go-kit/kit/log/logrus\"\n    \"github.com/sirupsen/logrus\"\n)\n\nfunc main() {\n\n    logrusLogger := logrus.New()\n\n    logrusLogger.Formatter = &amp;logrus.JSONFormatter{TimestampFormat: \"02-01-2006 15:04:05\"}\n    logger := log.NewLogrusLogger(logrusLogger).(logrus.FieldLogger)\n\n    logger.Error(\"Hello\")\n    logger.Warn(\"Warning you\")\n\n    logger.WithField(\"good\", \"bad\").Infoln(\"is it good or bad?\")\n\n}\n\n</code></pre>\n\n<p>I hope this helps. But since they only exposed the <code>Log</code> method, there might be conscious design decisions behind those. You may keep using just <code>Log</code> or if you want more flexibility, I would suggest setting up your own logger (using logrus) instead of what I just did above. That would be a cleaner approach IMO. </p>\n"}], "owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 2, "accepted_answer_id": 58258919, "answer_count": 1, "score": 1, "last_activity_date": 1570377208, "creation_date": 1570367367, "last_edit_date": 1570371246, "question_id": 58257555, "link": "https://stackoverflow.com/questions/58257555/using-go-kit-logger-api-missing-methods", "title": "Using go-kit logger api missing methods", "body": "<p>I want to use the logger from <a href=\"https://github.com/go-kit/kit/tree/master/log\" rel=\"nofollow noreferrer\">go kit</a> repository and I saw that\nthat the author provided also <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">logrus</a> API/factory , while trying to test it with some common API functionality of logrus like ,<code>withFields</code> and <code>error</code> / <code>info</code> / <code>panic</code> etc\nI couldn't use them only log\nAny idea how can I add the missing log functionality ?</p>\n\n<p><a href=\"https://github.com/sirupsen/logrus#fields\" rel=\"nofollow noreferrer\">logrus.WithField</a> API.</p>\n\n<p>this is what I miss </p>\n\n<pre><code>  log.WithFields(log.Fields{\n    \"animal\": \"walrus\",\n  }).Info(\"A walrus appears\")\n</code></pre>\n\n<p>and also the info / error / debug etc</p>\n\n<p>This is what I've tried </p>\n\n<pre><code>package main\n\nimport (\n   log \"github.com/go-kit/kit/log/logrus\"\n   \"github.com/sirupsen/logrus\"\n)\n\nfunc main() {\n\n   logrusLogger := logrus.New()\n\n   logrusLogger.Formatter = &amp;logrus.JSONFormatter{TimestampFormat: \"02-01-2006 15:04:05\"}\n   logger := log.NewLogrusLogger(logrusLogger)\n\n    logger.Log(\"hello\", \"world\u201d)  //working\n\n   logger.WithFields(    //doesnt work\n\n    logger.Info(      //doesnt work\n\n}\n\n</code></pre>\n\n<p>The logger is type <code>logrus</code> but I cannot use <code>withFields</code> OR <strong>info/error/debug</strong> etc, any idea what am I missing here? \nas the log kit create some factory is there a way to use the logrus api ?</p>\n"}, {"tags": ["api", "go", "jwt", "app-store-connect", "jwt-go"], "answers": [{"tags": [], "owner": {"reputation": 63, "user_id": 6130472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HHDzp.jpg?s=128&g=1", "display_name": "Sah4ez", "link": "https://stackoverflow.com/users/6130472/sah4ez"}, "is_accepted": false, "score": 1, "last_activity_date": 1570368478, "creation_date": 1570368478, "answer_id": 58257708, "question_id": 58257445, "link": "https://stackoverflow.com/questions/58257445/itunesconnectapi-jwt/58257708#58257708", "title": "ItunesConnectApi JWT", "body": "<p>Seems this problem from the <a href=\"https://github.com/dgrijalva/jwt-go/issues/304\" rel=\"nofollow noreferrer\">issue</a> from jwt-go library.</p>\n\n<p>Author said:</p>\n\n<blockquote>\n  <p>The library will not automatically parse your key from a byte slice. For ES256, I believe you need to provide a key of type *ecdsa.PrivateKey. As of v4, this will also accept a crypto.Signer so long as it produces a valid signature for that signing method.</p>\n</blockquote>\n\n<p>And you can try <a href=\"https://github.com/dgrijalva/jwt-go/issues/256#issuecomment-379496868\" rel=\"nofollow noreferrer\">this code example</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1189, "user_id": 1643303, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/2414642a4b540efa027f5694582b4e49?s=128&d=identicon&r=PG", "display_name": "Cawa", "link": "https://stackoverflow.com/users/1643303/cawa"}, "is_accepted": true, "score": 1, "last_activity_date": 1570374441, "creation_date": 1570374441, "answer_id": 58258550, "question_id": 58257445, "link": "https://stackoverflow.com/questions/58257445/itunesconnectapi-jwt/58258550#58258550", "title": "ItunesConnectApi JWT", "body": "<p>Found the problem, replaced <code>\"exp\": time.Now().Unix()+6000,</code> with <code>\"exp\": time.Now().Add(time.Minute * 20).Unix(),</code></p>\n"}], "owner": {"reputation": 1189, "user_id": 1643303, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/2414642a4b540efa027f5694582b4e49?s=128&d=identicon&r=PG", "display_name": "Cawa", "link": "https://stackoverflow.com/users/1643303/cawa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 58258550, "answer_count": 2, "score": 1, "last_activity_date": 1588055851, "creation_date": 1570366532, "last_edit_date": 1588055851, "question_id": 58257445, "link": "https://stackoverflow.com/questions/58257445/itunesconnectapi-jwt", "title": "ItunesConnectApi JWT", "body": "<p>I'm trying to use App Store Connect API.\nAccording to the <a href=\"https://developer.apple.com/documentation/appstoreconnectapi/generating_tokens_for_api_requests\" rel=\"nofollow noreferrer\">docs</a>, first I'm trying to generate JWT token.\nHere's the code in golang:</p>\n\n<pre><code>    package main\n\n    import (\n        \"fmt\"\n        \"io/ioutil\"\n        \"log\"\n        \"time\"\n        \"github.com/dgrijalva/jwt-go\"\n    )\nvar iss = \"xxxxxxxxxxxxxxxxxxxxx\"\nvar kid = \"xxxxx\"\n\nfunc main() {\n\n        bytes, err := ioutil.ReadFile(\"AuthKey.p8\")\n        if err!=nil {\n            fmt.Println(err)\n        }\n\n        token := jwt.NewWithClaims(jwt.SigningMethodES256, jwt.MapClaims{\n            \"iss\": iss,\n            \"exp\": time.Now().Unix()+6000,\n            \"aud\": \"appstoreconnect-v1\",\n        })\n\n        token.Header[\"kid\"] = kid\n\n        tokenString, err := token.SignedString(bytes)\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Println(tokenString)\n\n    }\n</code></pre>\n\n<p>AuthKey.p8 - p8 private key from <a href=\"https://appstoreconnect.apple.com/access/api\" rel=\"nofollow noreferrer\">https://appstoreconnect.apple.com/access/api</a></p>\n\n<p>Seems jwt lib can't use this p8 at a sign key, so Im getting error:\n<code>key is of invalid type</code></p>\n\n<p>Maybe someone already hade same problems? Or got example in other langusge?</p>\n\n<p><strong>UPD:</strong>\n <a href=\"https://stackoverflow.com/a/58257708/1643303\">After this suggestin</a> I've updated the code to:</p>\n\n<pre><code>func main() {\n\n    bytes, err := ioutil.ReadFile(\"AuthKey.p8\")\n    if err!=nil {\n        fmt.Println(err)\n    }\n\n    block, _ := pem.Decode(bytes)\n    key, err := x509.ParsePKCS8PrivateKey(block.Bytes)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    token := jwt.NewWithClaims(jwt.SigningMethodES256, jwt.MapClaims{\n        \"iss\": iss,\n        \"exp\": time.Now().Unix()+6000,\n        \"aud\": \"appstoreconnect-v1\",\n    })\n\n    token.Header[\"kid\"] = kid\n\n    tokenString, err := token.SignedString(key)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(tokenString)\n\n}\n</code></pre>\n\n<p>And getting the JWT token, but when I'm trying to use it got 401 from apple api.</p>\n\n<pre><code> {\n        \"errors\": [{\n                \"status\": \"401\",\n                \"code\": \"NOT_AUTHORIZED\",\n                \"title\": \"Authentication credentials are missing or invalid.\",\n                \"detail\": \"Provide a properly configured and signed bearer token, and make sure that it has not expired. Learn more about Generating Tokens for API Requests https://developer.apple.com/go/?id=api-generating-tokens\"\n        }]\n}\n</code></pre>\n"}, {"tags": ["http", "go"], "answers": [{"comments": [{"owner": {"reputation": 158, "user_id": 10245760, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RNQ3BJ-mSGQ/AAAAAAAAAAI/AAAAAAAAAAw/B-wcw98aIqQ/photo.jpg?sz=128", "display_name": "Karl Anthony Baluyot", "link": "https://stackoverflow.com/users/10245760/karl-anthony-baluyot"}, "edited": false, "score": 0, "creation_date": 1570370203, "post_id": 58257471, "comment_id": 102884613, "body": "In terms of accessing the API response using postman, I configured it with a server to server authentication, thus rest-clients cant access it even requests that are programmed (bot requests). For your last suggestion, if you are in your browser with successful login status, you can still get response because it is a GET method and in this case, authorized since user is logged in."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 158, "user_id": 10245760, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RNQ3BJ-mSGQ/AAAAAAAAAAI/AAAAAAAAAAw/B-wcw98aIqQ/photo.jpg?sz=128", "display_name": "Karl Anthony Baluyot", "link": "https://stackoverflow.com/users/10245760/karl-anthony-baluyot"}, "edited": false, "score": 0, "creation_date": 1570376128, "post_id": 58257471, "comment_id": 102886194, "body": "If the token is sent over in the request header, that should require the browser to manually put that in the header since the browser wouldn&#39;t know to do that itself. For the server to server communication part, that would also mean any other clients can&#39;t access the API from a browser or a mobile device directly. They have to be proxied via another server. And if the user authenticates with that proxy server, it will still happen."}, {"owner": {"reputation": 158, "user_id": 10245760, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RNQ3BJ-mSGQ/AAAAAAAAAAI/AAAAAAAAAAw/B-wcw98aIqQ/photo.jpg?sz=128", "display_name": "Karl Anthony Baluyot", "link": "https://stackoverflow.com/users/10245760/karl-anthony-baluyot"}, "edited": false, "score": 0, "creation_date": 1570376214, "post_id": 58257471, "comment_id": 102886218, "body": "yes the token is sent over the request header but the request is sent via server-to-server communication."}], "tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": false, "score": 0, "last_activity_date": 1570366742, "creation_date": 1570366742, "answer_id": 58257471, "question_id": 58257369, "link": "https://stackoverflow.com/questions/58257369/how-to-secure-get-request-when-queried-in-a-browser-tab/58257471#58257471", "title": "How to secure GET request when queried in a browser tab", "body": "<p>It's a good idea to move to <code>POST</code> if you want to hide the output in the browser window. As with <code>GET</code>, the browser will always show the output directly. </p>\n\n<p>However, please note that if anyone want to see the API response, they can still simulate the API calls using JS and see the response in their browser console, or use a client like Postman to get the response. If they have proper tokens, they can always inspect your response, there's no way around it. </p>\n\n<p>I believe it's working in the new tab as well because the user is logged in and the JWT token is stored in cookie / localstorage / in a way that is accessible from new tabs. And your server is also being able to access that. </p>\n\n<p>If you send the token using a JS application (React may be?) and tweak your server to accept the token through a request header every time, in that case, just opening that url will no longer work because it will have the token missing in request header.</p>\n"}, {"tags": [], "owner": {"reputation": 2030, "user_id": 1083552, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/fa1da8ea46204b46fe976585274c3bfb?s=128&d=identicon&r=PG", "display_name": "Abhinav Kulshreshtha", "link": "https://stackoverflow.com/users/1083552/abhinav-kulshreshtha"}, "is_accepted": true, "score": 1, "last_activity_date": 1570366848, "creation_date": 1570366848, "answer_id": 58257487, "question_id": 58257369, "link": "https://stackoverflow.com/questions/58257369/how-to-secure-get-request-when-queried-in-a-browser-tab/58257487#58257487", "title": "How to secure GET request when queried in a browser tab", "body": "<p>For private stuff like stock market data, My first choice would have been a post request.</p>\n\n<p>I had once blocked GET API request from browsers by detecting a browser, based on stuff like  having a useragent string, and custom head metadata, but based on experience, it isn't a perfect solution. </p>\n\n<p>Another trick I had used in past was using a simple encryption algorithm,(it wasn't secure but was fast. It was merely a distraction ) to encrypt values. So if someone did extract the json response, the data would be garbage, unless decrypted with key, which could be jwt token in your case.</p>\n\n<p>Again, These tricks will do nothing for security against highly technical person, but will be enough of a distraction to regular to average reverse engg tricks. Also disclaimer, I never used GET for anything important as financial and stocks related information. My rule was GET for normal filler stuff, and POST for important stuff.</p>\n"}], "owner": {"reputation": 158, "user_id": 10245760, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RNQ3BJ-mSGQ/AAAAAAAAAAI/AAAAAAAAAAw/B-wcw98aIqQ/photo.jpg?sz=128", "display_name": "Karl Anthony Baluyot", "link": "https://stackoverflow.com/users/10245760/karl-anthony-baluyot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 58257487, "answer_count": 2, "score": 1, "last_activity_date": 1570366848, "creation_date": 1570365969, "last_edit_date": 1570366208, "question_id": 58257369, "link": "https://stackoverflow.com/questions/58257369/how-to-secure-get-request-when-queried-in-a-browser-tab", "title": "How to secure GET request when queried in a browser tab", "body": "<p>I am currently assigned in developing stock market data API with security in top of all. I was able to secure incoming GET requests using JWT, API keys,middleware auths. </p>\n\n<p>Let's say when the user is not logged in, as we all know, all http methods esp GET are responding with http status 401 unauthorized access. </p>\n\n<p>My problem is when the user is logged in in our app, the API requests can be now queried successfully (server to server) but <strong>when I copy the request link to the browser new tab (say chrome), I can see the reply</strong>. It is expected since the user is logged in but I want that the request response will not be seen in the browser. Other competitors of ours use POST to counter the browser GET default. </p>\n\n<p>Should we move to POST? Im struggling since GET is the proper http method for requesting stuffs.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1570367188, "post_id": 58257235, "comment_id": 102883832, "body": "Cross posted: <a href=\"https://github.com/golang/go/issues/34719\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/34719</a>"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 11519194, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-76UyaWXr7Iw/AAAAAAAAAAI/AAAAAAAAAA8/N5vXSh8csig/photo.jpg?sz=128", "display_name": "chezi chezi", "link": "https://stackoverflow.com/users/11519194/chezi-chezi"}, "edited": false, "score": 0, "creation_date": 1570413581, "post_id": 58259041, "comment_id": 102893654, "body": "Thank you very much for your detailed explanation, which helped me out of the logical confusion. Thank you."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1570378191, "creation_date": 1570378191, "answer_id": 58259041, "question_id": 58257235, "link": "https://stackoverflow.com/questions/58257235/when-using-iota-i-am-confused/58259041#58259041", "title": "When using iota, I am confused", "body": "<p><code>T.State</code> is of type <code>State</code>. This has got nothing to do with the field <code>T.State</code> being part of a struct or not. The zero value for the type <code>State</code> is 0, which is also equal to <code>Running</code>. So when you assign <code>t</code> to an instance of <code>T</code> with <code>T.State</code> left uninitialized, <code>T.State</code> gets the zero value, which is <code>Running</code>.</p>\n\n<p>As far as I can tell from the code, you seem to have an 'Unknown' value for <code>State</code> that is any value other than those that are declared. If you want to print <code>Unknown</code> for zero-value of the <code>State</code>, change your declaration of constants so <code>Unknown</code> gets the zero value (i.e. iota).</p>\n"}], "owner": {"reputation": 51, "user_id": 11519194, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-76UyaWXr7Iw/AAAAAAAAAAI/AAAAAAAAAA8/N5vXSh8csig/photo.jpg?sz=128", "display_name": "chezi chezi", "link": "https://stackoverflow.com/users/11519194/chezi-chezi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 58259041, "answer_count": 1, "score": -4, "last_activity_date": 1570391682, "creation_date": 1570364933, "last_edit_date": 1570391682, "question_id": 58257235, "link": "https://stackoverflow.com/questions/58257235/when-using-iota-i-am-confused", "title": "When using iota, I am confused", "body": "\n\n<h3>What version of Go are you using (<code>go version</code>)?</h3>\n\n<pre><code>$ go version\n1.13\n</code></pre>\n\n<h3>Does this issue reproduce with the latest release?</h3>\n\n<p>yes</p>\n\n<h3>What operating system and processor architecture are you using (<code>go env</code>)?</h3>\n\n<p><code>go env</code> Output</p>\n\n<pre><code>$ go env\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGONOPROXY=\"\"\nGONOSUMDB=\"\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/chezixin/go\"\nGOPRIVATE=\"\"\nGOPROXY=\"https://goproxy.io\"\nGOROOT=\"/usr/local/go\"\nGOSUMDB=\"sum.golang.org\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nAR=\"ar\"\nCC=\"clang\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"/Users/chezixin/go/src/go.mod\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/mr/_x323k891dq9yvmvlgwqf4f40000gn/T/go-build490011880=/tmp/go-build -gno-record-gcc-switches -fno-common\"\n</code></pre>\n\n<h3>What did you do?</h3>\n\n\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype T struct {\n    Name  string\n    Port  int\n    State State\n}\n\ntype State int\n\nconst (\n    Running State = iota\n    Stopped\n    Rebooting\n    Terminated\n)\nfunc (s State) String() string {\n    switch s {\n    case Running:\n        return \"Running\"\n    case Stopped:\n        return \"Stopped\"\n    case Rebooting:\n        return \"Rebooting\"\n    case Terminated:\n        return \"Terminated\"\n    default:\n        return \"Unknown\"\n    }\n}\n\nfunc main() {\n    t := T{Name: \"example\", Port: 6666}\n    fmt.Printf(\"t %+v\\n\", t)\n}\n</code></pre>\n\n<h3>Result\uff1a</h3>\n\n<pre><code>t {Name:example Port:6666 State:Running}\n</code></pre>\n\n<h3>What did you expect to see?</h3>\n\n<h3>What did you see instead?</h3>\n\n<pre><code>Although the string is rewritten, this is related to State.const.\nI am printing a T struct in main. The zero value is 0.\nBut why do you want to display State:Running\n\nWhen T.State = 0, why does the program think T.State = const.Running?\n\nI understand this now:\nString is an interface type, T.State=0, const.Running=0, the two types are the same, the value is the same, the program will think that the two are equal? Doesn't it distinguish between const and struct at the moment?\nAccording to logic, you should distinguish between const and struct, but the program thinks they are equal. Is this a bug? Or am I getting into a misunderstanding?\n\nCan you tell me how to understand it correctly?\nthank you very much\nThank you\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "edited": false, "score": 0, "creation_date": 1570364815, "post_id": 58257212, "comment_id": 102883297, "body": "Yes but won&#39;t this use at least double the memory than a pointer?"}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "edited": false, "score": 0, "creation_date": 1570365165, "post_id": 58257212, "comment_id": 102883377, "body": "I do not have deep expertise in Go but as far as I know things are different in Go compared to C/C++ in regards to how pointers work.  So to understand your point better, which part might be consuming more memory in your opinion?"}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "edited": false, "score": 1, "creation_date": 1570365781, "post_id": 58257212, "comment_id": 102883487, "body": "I don&#39;t think using pointers would save memory. It might help in performance since every function gets a copy of the data and memory addresses are faster to copy. But dereferencing those are not free either. Apart from that, the data is still stored in memory and the pointer is the address to that memory. Not sure if that may somehow consume more memory."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "edited": false, "score": 0, "creation_date": 1570365927, "post_id": 58257212, "comment_id": 102883530, "body": "Do you mean storing a pointer in map vs storing a struct in map?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1570366003, "post_id": 58257212, "comment_id": 102883546, "body": "using a <code>*Vertex</code> as an index to your map would be a bad idea - as an <code>ok</code> check would need the exact same <code>*Vertex</code> memory pointer to return <code>true</code>. With this answer you can use <code>Vertex{0, 0}</code> in the second call - and it will get a match. Using say <code>&amp;Vertex{0, 0}</code> will create a brand new memory pointer (of the same point) and fail."}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1570366205, "post_id": 58257212, "comment_id": 102883594, "body": "Yes, but still if you want to use <code>*Vertex</code>, here&#39;s a version where everything is a <code>*Vertex</code> but remember to make sure that you&#39;re pointing to the same address. Creating a new <code>*Vertex</code> with the same <code>(x,y)</code> would have different memory address. That might cause more confusions and issues like @colminator mentioned above. Code: <a href=\"https://play.golang.org/p/y9UCNUVIMVP\" rel=\"nofollow noreferrer\">play.golang.org/p/y9UCNUVIMVP</a>"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1570366767, "post_id": 58257212, "comment_id": 102883718, "body": "Here&#39;s some coding style suggestions on method receivers etc. <a href=\"https://play.golang.org/p/y0lHPLhJRu2\" rel=\"nofollow noreferrer\">play.golang.org/p/y0lHPLhJRu2</a>"}, {"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "edited": false, "score": 0, "creation_date": 1570367013, "post_id": 58257212, "comment_id": 102883784, "body": "I just modified the original codes in the places I needed to. These are good suggestions. Thanks mate!"}, {"owner": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "edited": false, "score": 0, "creation_date": 1570367089, "post_id": 58257212, "comment_id": 102883804, "body": "@masnun you have changed the client code rather than the implementation - it doesn&#39;t really do what I am asking. I will receive incoming new coordinates through an API which may or may not exist in the <code>map</code>. So I won&#39;t be able to reuse references in the way you have done."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "edited": false, "score": 0, "creation_date": 1570396649, "post_id": 58257212, "comment_id": 102891111, "body": "@david_adler <code>Vertex{i, j}</code> (where i &amp; j are provided by some input stream) can be used by this answer (see my comment above). So sounds like you want to use a value (i.e. not a pointer). So go with the version that is value based."}], "tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": false, "score": 1, "last_activity_date": 1570366345, "last_edit_date": 1570366345, "creation_date": 1570364757, "answer_id": 58257212, "question_id": 58256943, "link": "https://stackoverflow.com/questions/58256943/using-pointers-in-a-map-in-golang/58257212#58257212", "title": "Using pointers in a map in golang", "body": "<p>Since these are just vertices comprised of coordinates, do you really need the memory access? </p>\n\n<p>Here's your test case passing without using pointers: <a href=\"https://play.golang.org/p/RBV0NNf9F_m\" rel=\"nofollow noreferrer\">https://play.golang.org/p/RBV0NNf9F_m</a> </p>\n\n<p>Here's a version with pointers but please note how I passed the same <code>v1</code> and <code>v2</code> instance in the second call. With pointers, even the same <code>(x,y)</code> would cause a new memory address. So please be aware of the consequences of that. </p>\n\n<p>Here's the code with pointers: <a href=\"https://play.golang.org/p/y9UCNUVIMVP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/y9UCNUVIMVP</a></p>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 2, "last_activity_date": 1570490687, "last_edit_date": 1570490687, "creation_date": 1570378442, "answer_id": 58259078, "question_id": 58256943, "link": "https://stackoverflow.com/questions/58256943/using-pointers-in-a-map-in-golang/58259078#58259078", "title": "Using pointers in a map in golang", "body": "<p>Do you really need this many indirections? If you change vertex representation to keep its own edges, I think the representation becomes much cleaner, it is easier to work with, and with a small memory footprint.</p>\n\n<pre><code>type Vertex struct {\n   Values [2]float64\n   Edges  map[*Vertex]struct{}\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "edited": false, "score": 0, "creation_date": 1570396224, "post_id": 58260159, "comment_id": 102891037, "body": "Updated question - I have 1,335,262 nodes and 4,895,070 edges and about 800MB of RAM."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "edited": false, "score": 0, "creation_date": 1570397920, "post_id": 58260159, "comment_id": 102891359, "body": "Only 800 MB?  Are you on a 32-bit system?  If so, the pointers will be just 32 bits. In any case: 5 million <i>unique</i> edges will consume at least 80 MB for the edge values (5 * 16). To store them via pointers, add another 20 or 40 MB for the pointers."}, {"owner": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "edited": false, "score": 0, "creation_date": 1570398058, "post_id": 58260159, "comment_id": 102891395, "body": "Free tier on heroku \ud83d\ude1c demo of what I am building here <a href=\"https://7gl5f.csb.app\" rel=\"nofollow noreferrer\">7gl5f.csb.app</a> source code here <a href=\"https://github.com/mfbx9da4/brightpath-backend\" rel=\"nofollow noreferrer\">github.com/mfbx9da4/brightpath-backend</a>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "edited": false, "score": 1, "creation_date": 1570398192, "post_id": 58260159, "comment_id": 102891410, "body": "If you have 5 million vertices but only, say, 1 million of them are <i>unique</i>, the deduplication would save ~64 MB of data while costing either 16 or 32 MB of pointers."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 2, "last_activity_date": 1570386589, "creation_date": 1570386589, "answer_id": 58260159, "question_id": 58256943, "link": "https://stackoverflow.com/questions/58256943/using-pointers-in-a-map-in-golang/58260159#58260159", "title": "Using pointers in a map in golang", "body": "<p>Worth noting: the size of <code>Vertex</code> is the size of 2 float64s, or 16 bytes.  The size of a pointer to Vertex is probably 8 bytes. So de-duplicating Vertex instances could, at least potentially, cut the size in half, <em>if</em> there are lots of duplicate vertices.</p>\n\n<p>If you choose to do this, you do need something like your second version of your code.  You can, however, either use a <em>per-graph</em> de-duplicator, as you are doing here, or you could simply use a global vertex de-duplicator.  The latter means that the de-duplicator cannot be garbage collected when any one graph is discarded.</p>\n\n<p>How many vertices will be active in any one graph?  How many graphs will you create and destroy over time, in what pattern?  The answers to these two questions will determine whether the space-savings from de-duplication / interning Vertex instances is worthwhile.</p>\n"}, {"tags": [], "owner": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "is_accepted": true, "score": 0, "last_activity_date": 1570402912, "last_edit_date": 1570402912, "creation_date": 1570401995, "answer_id": 58261813, "question_id": 58256943, "link": "https://stackoverflow.com/questions/58256943/using-pointers-in-a-map-in-golang/58261813#58261813", "title": "Using pointers in a map in golang", "body": "<p>I managed to find a way to keep my compact representation, it does unfortunately come with cost <code>degree(Vertex)</code> to see if an edge exists. </p>\n\n<p><a href=\"https://play.golang.org/p/xnw2p6Ut78p\" rel=\"nofollow noreferrer\">https://play.golang.org/p/xnw2p6Ut78p</a></p>\n\n<pre><code>type Vertex [2]float64\ntype Edges map[Vertex]BagOfVertices\ntype BagOfVertices map[*Vertex]bool\n\nfunc (e *Edges) AddEdge(v1 Vertex, v2 *Vertex) {\n    edges := *e\n    if edges[v1] == nil {\n        edges[v1] = make(BagOfVertices)\n    }\n    if edges[*v2] == nil {\n        edges[*v2] = make(BagOfVertices)\n    }\n    edges[v1][v2] = true\n}\n\nfunc (e *Edges) HasEdge(v0 Vertex, v1 Vertex) bool {\n    edges := *e\n    found := false\n    for child := range edges[v0] {\n        if *child == v1 {\n            found = true\n        }\n    }\n    return found\n}\n\nfunc TestEdges(t *testing.T) {\n    var edges Edges = make(Edges)\n\n    // Create edge from vertex 0 to vertex 1\n    v0 := Vertex{0, 0}\n    v1 := Vertex{1, 1}\n    edges.AddEdge(v0, &amp;v1)\n\n    // Check edge exist from vertex 0 to vertex 1\n    v0 = Vertex{0, 0}\n    v1 = Vertex{1, 1}\n    if !edges.HasEdge(v0, v1) {\n        t.Errorf(\"Edge from %v to %v does not exist\", v0, v1)\n    }\n}\n</code></pre>\n\n<p>In my case I am iterating through all children so checking <code>HasEdge</code> will rarely get called and space is a more important constraint so this works best for me, though might not be suited to all cases.</p>\n"}, {"tags": [], "owner": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "is_accepted": false, "score": 0, "last_activity_date": 1572357361, "last_edit_date": 1572357361, "creation_date": 1570543885, "answer_id": 58288121, "question_id": 58256943, "link": "https://stackoverflow.com/questions/58256943/using-pointers-in-a-map-in-golang/58288121#58288121", "title": "Using pointers in a map in golang", "body": "<p>One way to tackle this is to add a reference to the Vector key in its value like so</p>\n\n<p><a href=\"https://play.golang.org/p/s4T8cV8uYm8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/s4T8cV8uYm8</a></p>\n\n<pre><code>type Vertex [2]float64\ntype Edges map[Vertex]EdgeVal\ntype EdgeVal struct {\n    Ref *Vertex\n    BagOfVertices BagOfVertices\n}\ntype BagOfVertices map[*Vertex]bool\n\nfunc (e *Edges) GetOrCreateVertex(vertex Vertex) *Vertex {\n    edges := *e\n    if val, ok := edges[vertex]; ok {\n        fmt.Println(\"Found val\")\n        return val.Ref\n    }\n    edges[vertex] = EdgeVal{&amp;vertex, make(BagOfVertices)}\n    fmt.Println(\"Create val\")\n    return &amp;vertex\n}\n\nfunc TestEdges(t *testing.T) {\n    var edges Edges = make(map[Vertex]EdgeVal)\n\n    // Create edge from vertex 0 to vertex 1\n    v0 := edges.GetOrCreateVertex(Vertex{0, 0})\n    v1 := edges.GetOrCreateVertex(Vertex{1, 1})\n    edges[*v0].BagOfVertices[v1] = true\n\n    // Check edge exist from vertex 0 to vertex 1\n    v0 = edges.GetOrCreateVertex(Vertex{0, 0})\n    v1 = edges.GetOrCreateVertex(Vertex{1, 1})\n    if _, ok := edges[*v0].BagOfVertices[v1]; !ok {\n        t.Errorf(\"Edge from %v to %v does not exist\", v0, v1)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 5245, "user_id": 1376627, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/HLKGd.jpg?s=128&g=1", "display_name": "david_adler", "link": "https://stackoverflow.com/users/1376627/david-adler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 689, "favorite_count": 1, "accepted_answer_id": 58261813, "answer_count": 5, "score": 0, "last_activity_date": 1572357361, "creation_date": 1570362636, "last_edit_date": 1570396146, "question_id": 58256943, "link": "https://stackoverflow.com/questions/58256943/using-pointers-in-a-map-in-golang", "title": "Using pointers in a map in golang", "body": "<p>I am new to golang and I am writing some graph routing algorithms. My graph representation looks like so</p>\n\n<pre><code>type Vertex [2]float64\ntype Edges map[Vertex]BagOfVertices\ntype BagOfVertices map[*Vertex]bool\n</code></pre>\n\n<p>I want to be able to represent edges from a particular Vertex, as a set of references to other Vertices. I am very memory constrained. To avoid memory costs of allocating lots of duplicate <code>Vertex</code> objects, I want to use pointers to vertex objects.</p>\n\n<p>I have 1,335,262 nodes and 4,895,070 edges and about 800MB of RAM.</p>\n\n<p>Here is my attempt at doing that</p>\n\n<pre><code>func (e *Edges) GetOrCreateVertex(vertex Vertex) *Vertex {\n    edges := *e\n    if _, ok := edges[vertex]; ok {\n        fmt.Println(\"Found val\")\n        return &amp;vertex\n    }\n    edges[vertex] = make(BagOfVertices)\n    fmt.Println(\"Create val\")\n    return &amp;vertex\n}\n\nfunc TestEdges(t *testing.T) {\n    var edges Edges = make(map[Vertex]BagOfVertices)\n\n    // Create edge from vertex 0 to vertex 1\n    v0 := edges.GetOrCreateVertex(Vertex{0, 0})\n    v1 := edges.GetOrCreateVertex(Vertex{1, 1})\n    edges[*v0][v1] = true\n\n    // Check edge exist from vertex 0 to vertex 1\n    v0 = edges.GetOrCreateVertex(Vertex{0, 0})\n    v1 = edges.GetOrCreateVertex(Vertex{1, 1})\n    if _, ok := edges[*v0][v1]; !ok {\n        t.Errorf(\"Edge from %v to %v does not exist\", v0, v1)\n    }\n}\n</code></pre>\n\n<p>Clearly the pointer returned by <code>GetOrCreateVertex</code> points to the value which was just created rather than the key of <code>Edges</code>. How can I get <code>GetOrCreateVertex</code> to return the pointer to the key in the <code>Edges</code> map?</p>\n\n<p>My work around was to create </p>\n\n<p><a href=\"https://play.golang.org/p/jAjB-l51bMR\" rel=\"nofollow noreferrer\">Demo of failing test</a></p>\n\n<hr>\n\n<p>My workaround is to have a second map to store the pointers to the vertices.</p>\n\n<pre><code>type Vertex [2]float64\ntype GraphType struct {\n    vertices Vertices\n    edges    Edges\n}\ntype Vertices map[Vertex]*Vertex\ntype Edges map[*Vertex]BagOfVertices\ntype BagOfVertices map[*Vertex]bool\n\nfunc (graph *GraphType) Init() {\n    graph.vertices = make(Vertices)\n    graph.edges = make(Edges)\n}\nfunc (graph *GraphType) GetOrCreateVertex(vertex Vertex) *Vertex {\n    if val, ok := graph.vertices[vertex]; ok {\n        fmt.Println(\"Found val\")\n        return val\n    }\n    graph.vertices[vertex] = &amp;vertex\n    graph.edges[&amp;vertex] = make(BagOfVertices)\n    fmt.Println(\"Create val\")\n    return &amp;vertex\n}\n\nfunc TestEdges(t *testing.T) {\n    var graph GraphType\n    graph.Init()\n    // Create vertex 0 and vertex 1\n    graph.GetOrCreateVertex(Vertex{0, 0})\n    graph.GetOrCreateVertex(Vertex{1, 1})\n\n    // Create edge from vertex 0 to vertex 1\n    v0 := graph.GetOrCreateVertex(Vertex{0, 0})\n    v1 := graph.GetOrCreateVertex(Vertex{1, 1})\n    graph.edges[v0][v1] = true\n\n    // Check edge exist from vertex 0 to vertex 1\n    v0 = graph.GetOrCreateVertex(Vertex{0, 0})\n    v1 = graph.GetOrCreateVertex(Vertex{1, 1})\n    if _, ok := graph.edges[v0][v1]; !ok {\n        t.Errorf(\"Edge from %v to %v does not exist\", v0, v1)\n    }\n}\n</code></pre>\n"}, {"tags": ["templates", "go"], "answers": [{"tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": false, "score": 1, "last_activity_date": 1570361735, "last_edit_date": 1570361735, "creation_date": 1570361089, "answer_id": 58256762, "question_id": 58256706, "link": "https://stackoverflow.com/questions/58256706/go-template-doesnt-work-correctly-with-if-and-range/58256762#58256762", "title": "Go template doesn&#39;t work correctly with if and range", "body": "<p>Using a template function might be a better way to do this.</p>\n\n<p>In the following code example, I defined a <code>font</code> function which would determine the color from a <code>Yield</code> type (which I extracted and moved to top for this example). </p>\n\n<p>Code example: </p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"html/template\"\n)\n\ntype Yield struct {\n    Currency string  `json:\"currency\"`\n    Value    float64 `json:\"value\"`\n}\n\nconst portfolioJson = `{\n    \"payload\": {\n        \"positions\": [\n            {\n                \"balance\": 300,\n                \"expectedYield\": {\n                    \"currency\": \"RUB\",\n                    \"value\": 1314\n                },\n                \"ticker\": \"SBERP\"\n            },\n            {\n                \"balance\": 4,\n                \"expectedYield\": {\n                    \"currency\": \"USD\",\n                    \"value\": -14.87\n                },\n                \"ticker\": \"MA\"\n            }\n        ]\n    }\n}`\n\nconst PortfolioTemplate = `\n&lt;ol&gt;\n    {{range .Payload.Positions}}\n        &lt;li&gt;\n            &lt;strong&gt;{{.Ticker}}&lt;/strong&gt; {{.Balance}} ( \n\n                &lt;font color=\"{{.ExpectedYield | font }}\"&gt;\n\n                {{.ExpectedYield.Value}}&lt;/font&gt; {{.ExpectedYield.Currency}}\n            )   \n        &lt;/li&gt;\n    {{end}}\n&lt;/ol&gt;\n`\n\ntype Portfolio struct {\n    Payload struct {\n        Positions []struct {\n            Ticker        string  `json:\"ticker\"`\n            Balance       float64 `json:\"balance\"`\n            ExpectedYield Yield   `json:\"expectedYield\"`\n        }\n    } `json:\"payload\"`\n}\n\nfunc (portfolio *Portfolio) Prettify() string {\n    fontColor := func(y Yield) string {\n        if y.Value &gt; 0 {\n            return \"green\"\n        }\n\n        return \"red\"\n    }\n\n    t := template.New(\"Portfolio\")\n\n    buff := bytes.Buffer{}\n    tpl := template.Must(t.Funcs(template.FuncMap{\"font\": fontColor}).Parse(PortfolioTemplate))\n    _ = tpl.Execute(&amp;buff, portfolio)\n    return buff.String()\n}\n\nfunc main() {\n    var portfolio Portfolio\n    _ = json.Unmarshal([]byte(portfolioJson), &amp;portfolio)\n    fmt.Println(portfolio.Prettify())\n}\n\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>&lt;ol&gt;\n\n        &lt;li&gt;\n            &lt;strong&gt;SBERP&lt;/strong&gt; 300 (\n\n                &lt;font color=\"green\"&gt;\n\n                1314&lt;/font&gt; RUB\n            )\n        &lt;/li&gt;\n\n        &lt;li&gt;\n            &lt;strong&gt;MA&lt;/strong&gt; 4 (\n\n                &lt;font color=\"red\"&gt;\n\n                -14.87&lt;/font&gt; USD\n            )\n        &lt;/li&gt;\n\n&lt;/ol&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 974, "user_id": 4229825, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/dMNcM.jpg?s=128&g=1", "display_name": "0x1337", "link": "https://stackoverflow.com/users/4229825/0x1337"}, "is_accepted": false, "score": 1, "last_activity_date": 1570361471, "creation_date": 1570361471, "answer_id": 58256808, "question_id": 58256706, "link": "https://stackoverflow.com/questions/58256706/go-template-doesnt-work-correctly-with-if-and-range/58256808#58256808", "title": "Go template doesn&#39;t work correctly with if and range", "body": "<p>Replacing <code>0</code> to <code>0.0</code> in comparison helped.</p>\n"}], "owner": {"reputation": 974, "user_id": 4229825, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/dMNcM.jpg?s=128&g=1", "display_name": "0x1337", "link": "https://stackoverflow.com/users/4229825/0x1337"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1570361735, "creation_date": 1570360591, "last_edit_date": 1570361068, "question_id": 58256706, "link": "https://stackoverflow.com/questions/58256706/go-template-doesnt-work-correctly-with-if-and-range", "title": "Go template doesn&#39;t work correctly with if and range", "body": "<p><a href=\"https://play.golang.org/p/iQConmYgIN0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iQConmYgIN0</a></p>\n\n<p><code>PortfolioTemplate</code> does not handle <code>if</code> properly. This <code>if</code> brakes outer <code>Range</code>. How to fix this?</p>\n"}, {"tags": ["go", "memory", "slice"], "answers": [{"tags": [], "owner": {"reputation": 234, "user_id": 6628349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e88d4443473648a6a488a8c91d494af?s=128&d=identicon&r=PG&f=1", "display_name": "vincent163", "link": "https://stackoverflow.com/users/6628349/vincent163"}, "is_accepted": false, "score": 3, "last_activity_date": 1570352320, "creation_date": 1570352320, "answer_id": 58255734, "question_id": 58255555, "link": "https://stackoverflow.com/questions/58255555/why-this-golang-code-could-leak-value-of-variable-which-is-in-memory/58255734#58255734", "title": "Why this Golang code could leak value of variable which is in memory", "body": "<p>In Go, the expression <code>s.w.Write(p[:64])</code> can expand the slice beyond its length without an error (till the slice's capacity). In this case the provided buffer's length is only 1, but you expanded it to 64 (as in the second line of your output). The content in the extra 63 bytes is undefined, and it happens to be the output of some <code>fmt</code> methods.</p>\n\n<p>The solution is to check the slice's length. If you want to make the slice foolproof and ensure it's impossible to see the content beyond its length, you can use the three index syntax for slices to set its capacity, such as <code>p = p[::len(p)]</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1570358001, "post_id": 58256255, "comment_id": 102881806, "body": "I tried to run without <code>Sprintln</code> and it seemed to have removed the <code>&quot;info{SSSSSSSSSSSSSSSSSSSSSSSSSSS}&quot;</code> part from the output.   <a href=\"https://play.golang.org/p/Nz0y_MfDjP1\" rel=\"nofollow noreferrer\">play.golang.org/p/Nz0y_MfDjP1</a>"}, {"owner": {"reputation": 195, "user_id": 11159056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a3198d20158059f533b4b9df3bddd9?s=128&d=identicon&r=PG&f=1", "display_name": "Iv4n", "link": "https://stackoverflow.com/users/11159056/iv4n"}, "edited": false, "score": 1, "creation_date": 1570359367, "post_id": 58256255, "comment_id": 102882125, "body": "yes, so i think it&#39;s about XprintY functions&#39; buffer. And while using <code>fmt.Println</code> to print into stdout, the value is also leaked. <a href=\"https://play.golang.org/p/cmMwp6Tidnr\" rel=\"nofollow noreferrer\">play.golang.org/p/cmMwp6Tidnr</a>. Seems that only <code>printer.buf</code> will share the memory with the local variable <code>p[:64]</code>"}], "tags": [], "owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "is_accepted": false, "score": 0, "last_activity_date": 1570356819, "creation_date": 1570356819, "answer_id": 58256255, "question_id": 58255555, "link": "https://stackoverflow.com/questions/58255555/why-this-golang-code-could-leak-value-of-variable-which-is-in-memory/58256255#58256255", "title": "Why this Golang code could leak value of variable which is in memory", "body": "<p>If you assign to the variable directly instead of doing <code>fmt.Sprintln</code>, the variable will not leak. </p>\n\n<p>Code: <a href=\"https://play.golang.org/p/Nz0y_MfDjP1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Nz0y_MfDjP1</a> </p>\n\n<p>So I believe <code>fmt.Sprintln</code> is causing the leak. This function calls a another unexported function <code>newPrinter</code> to get a <code>printer</code> which in turn maintains it's own pool and caches. I haven't gone deep enough but my guess would be somehow the buffer you created manually might be getting overlapped / shared here somehow. </p>\n\n<p>(I will update the answer if I find anything else)</p>\n"}, {"comments": [{"owner": {"reputation": 195, "user_id": 11159056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a3198d20158059f533b4b9df3bddd9?s=128&d=identicon&r=PG&f=1", "display_name": "Iv4n", "link": "https://stackoverflow.com/users/11159056/iv4n"}, "edited": false, "score": 0, "creation_date": 1570373545, "post_id": 58258045, "comment_id": 102885492, "body": "I know the tamplate engine will recognize &quot;Hi{{.Name}}Bye&quot; to <code>TextNode, ActionNode, TextNode</code>, and will write 3 times. But, in your code, in the second time writing: the <code>[]byte(&quot;50 22222222&quot;)</code> is in the local variable <code>p</code>, and it was <b>written into stdout</b> in last loop. So I don&#39;t think it&#39;s because of the slice used by the template that&#39;s not initialized."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 195, "user_id": 11159056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a3198d20158059f533b4b9df3bddd9?s=128&d=identicon&r=PG&f=1", "display_name": "Iv4n", "link": "https://stackoverflow.com/users/11159056/iv4n"}, "edited": false, "score": 0, "creation_date": 1570375603, "post_id": 58258045, "comment_id": 102886051, "body": "The <code>t.Execute(my, my)</code> calls <code>func (m *myWriter) Write(p []byte)</code> so the <code>p</code> with <code>len=3</code> and <code>cap=128</code> generated by the tamplate engine."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 195, "user_id": 11159056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a3198d20158059f533b4b9df3bddd9?s=128&d=identicon&r=PG&f=1", "display_name": "Iv4n", "link": "https://stackoverflow.com/users/11159056/iv4n"}, "edited": false, "score": 0, "creation_date": 1570378740, "post_id": 58258045, "comment_id": 102886901, "body": "See the Solution, and try it yourself and let me know. Your code output with the solution: <code>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&zwnj;&#8203;AAAA 64 64 1 1 128 buf:  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&zwnj;&#8203;AAAA1</code>"}, {"owner": {"reputation": 195, "user_id": 11159056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a3198d20158059f533b4b9df3bddd9?s=128&d=identicon&r=PG&f=1", "display_name": "Iv4n", "link": "https://stackoverflow.com/users/11159056/iv4n"}, "edited": false, "score": 0, "creation_date": 1570426546, "post_id": 58258045, "comment_id": 102895846, "body": "I&#39;m sorry I didn&#39;t get back to you in time. Thank you for your efforts! So if I understand correctly: on the 1st invoke of <code>myWriter.Write</code>, fmt.Sprint set the buffer to &quot;info{SSSSS}&quot;, then on the 2nd invoke, fmt.printer get the cache from <code>ppFree sync.Pool</code> and not set the buffer all to byte(0). But there is still something that confuses me: 1. if I  invoke fmt.Sprintln in the function <code>index</code> instead of <code>Write</code>(<a href=\"https://play.golang.org/p/u6jJDaBHfk5\" rel=\"nofollow noreferrer\">play.golang.org/p/u6jJDaBHfk5</a>), the memory in fmt.buffer is not leaked; 2. why the memory in fmt.buffer is readed in a local variable <code>p []byte</code> generated by template engine?"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 195, "user_id": 11159056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a3198d20158059f533b4b9df3bddd9?s=128&d=identicon&r=PG&f=1", "display_name": "Iv4n", "link": "https://stackoverflow.com/users/11159056/iv4n"}, "edited": false, "score": 0, "creation_date": 1570428470, "post_id": 58258045, "comment_id": 102896329, "body": "The <code>&quot;info{SSSSS}&quot;</code> in your code <code>tmp := fmt.Sprintln(&quot;info{SSSSSSSSSSSSSSSSSSSSSSSSSSS}&quot;)</code> or ` fmt.Println(&quot;gen:&quot;, no, gen())` in my code is the function call parameters which, compiler puts to the stack (as expected) to call the function <code>fmt.Sprintln()</code> or my code <code>fmt.Println()</code>  so when the function call is done (return from that function) the stack (memory) footprint is there (without any problem) and the next memory for the new slice takes it and use it (it is OK), but we expected that the new slice initilized to zero (which is not initialized probably for performance reasons)."}, {"owner": {"reputation": 195, "user_id": 11159056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a3198d20158059f533b4b9df3bddd9?s=128&d=identicon&r=PG&f=1", "display_name": "Iv4n", "link": "https://stackoverflow.com/users/11159056/iv4n"}, "edited": false, "score": 0, "creation_date": 1570431448, "post_id": 58258045, "comment_id": 102897253, "body": "oh you mean the memory of local variable <code>&quot;info{SSSSSSSSS}&quot;</code> on stack is used by the new slice before the GC collects it, and the memory is reused by <code>fmt.ppFree sync.Pool</code> without initilizing to &#39;0&#39;. I think this can explain this issue. And it is caused by overreading, probably more like an UB"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 195, "user_id": 11159056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a3198d20158059f533b4b9df3bddd9?s=128&d=identicon&r=PG&f=1", "display_name": "Iv4n", "link": "https://stackoverflow.com/users/11159056/iv4n"}, "edited": false, "score": 0, "creation_date": 1570434099, "post_id": 58258045, "comment_id": 102898246, "body": "Yes. exactly. Normally this is not a problem. Because we use <code>Write(p)</code> not <code>Write(p[:cap(p)]</code> and we may use <code>Read(p[:cap(p)]</code> and this is OK."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 3, "last_activity_date": 1570430169, "last_edit_date": 1570430169, "creation_date": 1570370877, "answer_id": 58258045, "question_id": 58255555, "link": "https://stackoverflow.com/questions/58255555/why-this-golang-code-could-leak-value-of-variable-which-is-in-memory/58258045#58258045", "title": "Why this Golang code could leak value of variable which is in memory", "body": "<p>There is <strong>no memory leak</strong>, <a href=\"https://play.golang.org/p/y2GrscBpOEh\" rel=\"nofollow noreferrer\">this</a> proves it.<br>\nBut there is an <a href=\"https://github.com/golang/go/issues/34720\" rel=\"nofollow noreferrer\">issue</a>: The call to <code>p := newPrinter()</code> initialized here <code>p.fmt.init(&amp;p.buf)</code> in <code>func Fprint(w io.Writer, a ...interface{}) (n int, err error)</code> returns the free memory (underlying array of a slice) without initializing it to zero (which is not initialized probably for performance reasons - <strong>which we expected to be all zero</strong>).</p>\n\n<p>TL;DR:<br>\nTwo solutions:<br>\n1. Workaround: Use <code>s.w.Write(p)</code> instead of <code>s.w.Write(p[:64])</code>, or edit your code and set <code>p[len(p):cap(p)]</code> all to zero (if you don't or cannot touch the 2nd solution):</p>\n\n<pre><code>func (s *SecWriter) Write(p []byte) (n int, err error) {\n    b := p[len(p):cap(p)]\n    for i := range b {\n        b[i] = 0\n    }\n    fmt.Println(string(p), len(p), cap(p))\n    // here\n    tmp := fmt.Sprintln(\"info{SSSSSSSSSSSSSSSSSSSSSSSSSSS}\")\n    if tmp == \"\" {\n    }\n    s.w.Write(p[:64])\n    return 64, nil\n}\n</code></pre>\n\n<hr>\n\n<ol start=\"2\">\n<li>In Windows (<code>C:\\Go\\src\\fmt\\format.go</code>) or Linux (<code>/usr/local/go/src/fmt/format.go</code>) file at line 58 set the buffer to all zero:</li>\n</ol>\n\n<pre><code>    b := (*buf)[:cap(*buf)]\n    for i := range b {\n        b[i] = 0\n    }\n</code></pre>\n\n<p>Inside this function:</p>\n\n<pre><code>func (f *fmt) init(buf *buffer) {\n    b := (*buf)[:cap(*buf)]\n    for i := range b {\n        b[i] = 0\n    }\n    f.buf = buf\n    f.clearflags()\n}\n</code></pre>\n\n<p>Your code output with this applied:</p>\n\n<pre><code>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 64 64\n1 1 128\nbuf:  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA1\n</code></pre>\n\n<hr>\n\n<p>Long answer:<br>\nYou're watching the slice data beyond the assigned length, and you are allowed to see the slice data to the slice capacity.<br>\nYou may replace: <code>m.Writer.Write(p[:8])</code> with: <code>m.Writer.Write(p)</code> which makes your code works correctly. The following code shows that <code>template.Parse()</code> tokenizes the template to 3 parts and calls <code>my.Write()</code> three times. the interesting part here is the <strong>second</strong> call to the <code>my.Write()</code> shows a compiler-generated slice with different slice capacity which is not initialized to zero, \"maybe this is a minor harmless <a href=\"https://github.com/golang/go/issues/34720\" rel=\"nofollow noreferrer\">issue</a>\":</p>\n\n<p>If you want to spy on your computer's memory, try <a href=\"https://play.golang.org/p/HOeK23IkZBN\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"text/template\"\n)\n\nfunc main() {\n    buf := &amp;bytes.Buffer{}\n    my := &amp;myWriter{\"You\", buf}\n    template.Must(template.New(\"my\").Parse(\"Hi{{.Name}}Bye.\")).Execute(my, my)\n    fmt.Printf(\"&lt;&lt;%q&gt;&gt;\\n\", buf.String())\n}\nfunc (m *myWriter) Write(p []byte) (n int, err error) {\n    fmt.Printf(\"len=%v cap=%v\\t%v %v\\n\", len(p), cap(p), string(p), p[:cap(p)])\n    no++\n    fmt.Println(\"gen:\", no, gen())\n    m.Writer.Write(p)\n    // m.Writer.Write(p[:8])\n    return 8, nil\n}\n\ntype myWriter struct {\n    Name string\n    io.Writer\n}\n\nconst genLen = 8\n\nfunc gen() string {\n    b := [genLen]byte{}\n    for i := range b {\n        b[i] = no\n    }\n    return string(b[:])\n}\n\nvar no = byte(49) //'1'\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>len=2 cap=8 Hi [72 105 0 0 0 0 0 0]\ngen: 50 22222222\nlen=3 cap=64    You [89 111 117 58 32 53 48 32 50 50 50 50 50 50 50 50 10 50 32 49 48 53 32 48 32 48 32 48 32 48 32 48 32 48 93 10 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\ngen: 51 33333333\nlen=4 cap=8 Bye. [66 121 101 46 0 0 0 0]\ngen: 52 44444444\n&lt;&lt;\"HiYouBye.\"&gt;&gt;\n</code></pre>\n\n<p>And change <code>const genLen = 64</code> try <a href=\"https://play.golang.org/p/d1O2D1tsEqQ\" rel=\"nofollow noreferrer\">this</a>\n<strong>intersting</strong>: the <code>cap=64</code> changes to <code>cap=128</code> (which is not expected):</p>\n\n<p>Output:</p>\n\n<pre><code>len=2 cap=8 Hi [72 105 0 0 0 0 0 0]\ngen: 50 2222222222222222222222222222222222222222222222222222222222222222\nlen=3 cap=128   You [89 111 117 58 32 53 48 32 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 10 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\ngen: 51 3333333333333333333333333333333333333333333333333333333333333333\nlen=4 cap=8 Bye. [66 121 101 46 0 0 0 0]\ngen: 52 4444444444444444444444444444444444444444444444444444444444444444\n&lt;&lt;\"HiYouBye.\"&gt;&gt;\n</code></pre>\n\n<hr>\n\n<p>The <code>t.Execute(my, my)</code> calls <code>func (m *myWriter) Write(p []byte)</code> so the <code>p</code> with <code>len=3</code> and <code>cap=128</code> generated by the tamplate engine.</p>\n\n<p>After debugging the 2nd code inside <code>/usr/local/go/src/fmt/print.go</code> file at line 230, it seems it is <code>fmt.buffer</code> with <code>length=3</code>, and <code>cap=128</code>, here:</p>\n\n<pre><code>func Fprint(w io.Writer, a ...interface{}) (n int, err error) {\n    p := newPrinter()\n    p.doPrint(a)\n    n, err = w.Write(p.buf)\n    p.free()\n    return\n}\n</code></pre>\n\n<p>The call to <code>p := newPrinter()</code> initialized here <code>p.fmt.init(&amp;p.buf)</code>:</p>\n\n<pre><code>// newPrinter allocates a new pp struct or grabs a cached one.\nfunc newPrinter() *pp {\n    p := ppFree.Get().(*pp)\n    p.panicking = false\n    p.erroring = false\n    p.wrapErrs = false\n    p.fmt.init(&amp;p.buf)\n    return p\n}\n</code></pre>\n\n<p>Gets and returns the free memory without initializing it to zero.</p>\n"}], "owner": {"reputation": 195, "user_id": 11159056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a3198d20158059f533b4b9df3bddd9?s=128&d=identicon&r=PG&f=1", "display_name": "Iv4n", "link": "https://stackoverflow.com/users/11159056/iv4n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 481, "favorite_count": 1, "accepted_answer_id": 58258045, "answer_count": 3, "score": 4, "last_activity_date": 1570430169, "creation_date": 1570350801, "last_edit_date": 1570383142, "question_id": 58255555, "link": "https://stackoverflow.com/questions/58255555/why-this-golang-code-could-leak-value-of-variable-which-is-in-memory", "title": "Why this Golang code could leak value of variable which is in memory", "body": "<p>This code could leak the value of the variable which is in memory.</p>\n\n<p>I think maybe the <code>fmt.XprintY</code> doesn't reset the buffer, but my attempt at debugging is fruitless.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"text/template\"\n)\n\ntype SecWriter struct {\n    w io.Writer\n}\n\nfunc (s *SecWriter) Write(p []byte) (n int, err error) {\n    fmt.Println(string(p), len(p), cap(p))\n\n    // here\n    tmp := fmt.Sprintln(\"info{SSSSSSSSSSSSSSSSSSSSSSSSSSS}\")\n    if tmp == \"\"{}\n\n    s.w.Write(p[:64])\n    return 64, nil\n}\n\nfunc index() {\n    exp := \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA{{1}}\"\n\n    b := &amp;bytes.Buffer{}\n    s := &amp;SecWriter{\n        w: b,\n    }\n\n\n    t := template.Must(template.New(\"index\").Parse(exp))\n    t.Execute(s, nil)\n\n    fmt.Println(\"buf: \", b.String())\n}\n\nfunc main() {\n    index()\n}\n</code></pre>\n\n<p>My <code>go env</code>:</p>\n\n<pre><code>set GOARCH=amd64\nset GOOS=windows\n</code></pre>\n\n<p>go version</p>\n\n<pre><code>go version go1.12.5 windows/amd64\n</code></pre>\n\n<p>And the output is: </p>\n\n<pre><code>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 64 64\n1 1 128\nbuf: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA1nfo{SSSSSSSSSSSSSSSSSSSSSSSSSSS}                 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n</code></pre>\n\n<p>As you can see, part of the value of the variable in memory:</p>\n\n<pre><code>tmp := fmt.Sprintln(\"info{SSSSSSSSSSSSSSSSSSSSSSSSSSS}\")\n</code></pre>\n\n<p>Leaks to the buffer.</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1570342554, "post_id": 58253972, "comment_id": 102878982, "body": "There are no <i>modules</i> with the required versions. The git tags exist, but point to versions before the introduction of the respective go.mod files. Run <code>go get -u -t .&#47;...</code> to update the dependencies to their latest versions, or re-create the module (you probably want a different name anyway)."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1597215896, "last_edit_date": 1597215896, "creation_date": 1570336387, "answer_id": 58254233, "question_id": 58253972, "link": "https://stackoverflow.com/questions/58253972/getting-go-error-loading-module-requirements/58254233#58254233", "title": "Getting: go: error loading module requirements", "body": "<p>Make sure you are using the latest Go 1.13.1.</p>\n<p>If <code>go mod tidy</code> does not solve the issue, check that a simple <code>go get github.com/gorilla/websocket@v1.2.0</code> works.</p>\n<p>If it does not, it could be, <a href=\"https://forum.golangbridge.org/t/trouble-with-go-module-version-in-docker-build/14239/2\" rel=\"nofollow noreferrer\">as in this thread</a>, a proxy configuration issue: it depends on your local environment, you might need to set a company proxy server to get anything.</p>\n<hr />\n<p>Update August 2020: note that <a href=\"https://golang.org/doc/go1.15#go-command\" rel=\"nofollow noreferrer\">with Go 1.15</a>:</p>\n<blockquote>\n<p>The <code>GOPROXY</code> environment variable now supports skipping proxies that return errors.</p>\n<p>Proxy URLs may now be separated with either commas (<code>,</code>) or pipe characters (<code>|</code>).</p>\n<ul>\n<li>If a proxy URL is followed by a comma, the <code>go</code> command will only try the next proxy in the list after a 404 or 410 HTTP response.</li>\n<li>If a proxy URL is followed by a pipe character, the <code>go</code> command will try the next proxy in the list after any error.</li>\n</ul>\n<p>Note that the default value of GOPROXY remains <code>https://proxy.golang.org,direct</code>, which does not fall back to direct in case of errors.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 166, "user_id": 11904651, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WUMVN-fvfNk/AAAAAAAAAAI/AAAAAAAAAOY/j_7iNZcBCGU/photo.jpg?sz=128", "display_name": "Ankush Chadha", "link": "https://stackoverflow.com/users/11904651/ankush-chadha"}, "is_accepted": false, "score": 1, "last_activity_date": 1570474543, "creation_date": 1570474543, "answer_id": 58275555, "question_id": 58253972, "link": "https://stackoverflow.com/questions/58253972/getting-go-error-loading-module-requirements/58275555#58275555", "title": "Getting: go: error loading module requirements", "body": "<p>It seems to be an issue with the GOPROXY set. What's the output of <code>go env</code>?</p>\n"}], "owner": {"reputation": 53, "user_id": 2133194, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/180118cb6648e48a7297d166603691b2?s=128&d=identicon&r=PG", "display_name": "rchughtai", "link": "https://stackoverflow.com/users/2133194/rchughtai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7804, "favorite_count": 1, "accepted_answer_id": 58254233, "answer_count": 2, "score": 2, "last_activity_date": 1597215896, "creation_date": 1570332324, "last_edit_date": 1570366782, "question_id": 58253972, "link": "https://stackoverflow.com/questions/58253972/getting-go-error-loading-module-requirements", "title": "Getting: go: error loading module requirements", "body": "<p>I am trying to run a go script for SLACK bot that downloaded from git.\n<a href=\"https://github.com/nlopes/slack/blob/master/examples/websocket/websocket.go#L34\" rel=\"nofollow noreferrer\">https://github.com/nlopes/slack/blob/master/examples/websocket/websocket.go#L34</a></p>\n\n<p>I replaced the auth code of my bot in the websocket.go</p>\n\n<pre><code>rchughta@C02WW32YHTD6 ~/g/s/e/websocket&gt; go run websocket.go\ngo: finding github.com/pmezard/go-difflib v1.0.0\ngo: finding github.com/davecgh/go-spew v1.1.1\ngo: finding github.com/stretchr/testify v1.2.2\ngo: finding github.com/pkg/errors v0.8.0\ngo: finding github.com/gorilla/websocket v1.2.0\ngo: github.com/gorilla/websocket@v1.2.0: unknown revision v1.2.0\ngo: github.com/davecgh/go-spew@v1.1.1: unknown revision v1.1.1\ngo: github.com/pkg/errors@v0.8.0: unknown revision v0.8.0\ngo: github.com/stretchr/testify@v1.2.2: unknown revision v1.2.2\ngo: github.com/pmezard/go-difflib@v1.0.0: unknown revision v1.0.0\ngo: error loading module requirements\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1570322788, "post_id": 58253403, "comment_id": 102876830, "body": "Please edit the question to limit it to a specific problem with enough detail to identify an adequate answer."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570357248, "post_id": 58253403, "comment_id": 102881638, "body": "So I understand that your waiting goroutines need a value returned by some other goroutine?"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1570490713, "last_edit_date": 1570490713, "creation_date": 1570322905, "answer_id": 58253424, "question_id": 58253403, "link": "https://stackoverflow.com/questions/58253403/goroutines-listening-for-the-same-result-on-a-channel/58253424#58253424", "title": "Goroutines listening for the same result on a channel", "body": "<p>Instead of a channel to send the result to each goroutine, you can store the result to a shared variable, and use a condition variable to broadcast that the result is ready, so all goroutines can read it from the shared variable.</p>\n\n<p>Something like this:</p>\n\n<pre><code>var resultVar *ResultType // resultVar = nil means result not ready\nvar c sync.Cond // initialize this before using it\n\nfunc f() {\n  // compute result\n  c.L.Lock()\n  resultVar = result\n  c.L.Unlock()\n  c.Broadcast()\n}\n\nfunc goroutine() {\n  ...\n  c.L.Lock()\n  for resultVar == nil {\n    c.Wait()\n  }\n  c.L.Unlock()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "edited": false, "score": 0, "creation_date": 1570358159, "post_id": 58254069, "comment_id": 102881844, "body": "Would context be a better alternative than a channel? I know a context also uses a channel but context would also allow passing request scoped variables along with better control (timeouts, deadlines, a cancel function etc)."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 10017, "user_id": 301107, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2c87e8db57897b08332340b2c4b508ff?s=128&d=identicon&r=PG", "display_name": "masnun", "link": "https://stackoverflow.com/users/301107/masnun"}, "edited": false, "score": 0, "creation_date": 1570368541, "post_id": 58254069, "comment_id": 102884179, "body": "@masnun The <code>ready</code> channel is the simpler and more direct solution to the problem as stated in the question.  It&#39;s trivial to add timeout/deadline and cancel.  It may that context is the better alternative given the broader scope fo the OP&#39;s program, but nothing in the question suggests that the extra complexity is warranted."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1570365993, "last_edit_date": 1570365993, "creation_date": 1570334032, "answer_id": 58254069, "question_id": 58253403, "link": "https://stackoverflow.com/questions/58253403/goroutines-listening-for-the-same-result-on-a-channel/58254069#58254069", "title": "Goroutines listening for the same result on a channel", "body": "<p>Use channel close to coordinate multiple goroutines waiting on an event.  </p>\n\n<p>Here's an example. The <code>printer</code> function represents the goroutines waiting on a result. The first argument is a channel that will be closed after the result is set. The second argument is a pointer to the result.</p>\n\n<pre><code>func printer(ready chan struct{}, result *string) {\n    &lt;-ready\n    fmt.Println(*result)\n}\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>ready := make(chan struct{})\nvar result string\n\n// Start the goroutines.\n\ngo printer(ready, &amp;result)\ngo printer(ready, &amp;result)\n\n// Set the result and close the channel to signal that the value is ready.\n\nresult = \"Hello World!\"\nclose(ready)\n</code></pre>\n\n<p>This works because receive on a closed channel returns the zero value of the channel's type.</p>\n\n<p><a href=\"https://play.golang.org/p/M3bxObMCIf9\" rel=\"nofollow noreferrer\">Run it on the playground</a></p>\n"}], "owner": {"reputation": 651, "user_id": 6119503, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c823ba11dd321ef4f4964185f9941a5c?s=128&d=identicon&r=PG&f=1", "display_name": "JC1", "link": "https://stackoverflow.com/users/6119503/jc1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1570490713, "creation_date": 1570322445, "question_id": 58253403, "link": "https://stackoverflow.com/questions/58253403/goroutines-listening-for-the-same-result-on-a-channel", "title": "Goroutines listening for the same result on a channel", "body": "<p>I currently have multiple goroutines of the same function that need to wait at some point in their execution for a result from a separate part of the program before continuing. My first thoughts would be to have a channel for each of the goroutines and then once we get the result, we iterate over all channels, write into them and close after?</p>\n\n<p>How do I 'share' the result with the goroutines effectively/efficiently? Is the only way to write to their respective channels that they're listening/blocked on before moving on with the next part of their execution? Seems a bit excessive. </p>\n\n<p>Thank you</p>\n"}, {"tags": ["go", "tcp"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570299433, "post_id": 58251045, "comment_id": 102872553, "body": "It looks like the function adds bytes so that  the peer knows where a command starts and stops in the data stream.  Each command starts with two 0xFF bytes and ends with a new line.  This is just a guess.  Show more context."}, {"owner": {"reputation": 23, "user_id": 12169696, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UDo8FXt-uws/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdf65kL8SUV81qxlFdZlYkQbYWXFw/photo.jpg?sz=128", "display_name": "Robin", "link": "https://stackoverflow.com/users/12169696/robin"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1570344373, "post_id": 58251045, "comment_id": 102879236, "body": "Yes that&#39;s what the function was returning. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 12169696, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UDo8FXt-uws/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdf65kL8SUV81qxlFdZlYkQbYWXFw/photo.jpg?sz=128", "display_name": "Robin", "link": "https://stackoverflow.com/users/12169696/robin"}, "edited": false, "score": 0, "creation_date": 1570344257, "post_id": 58251577, "comment_id": 102879217, "body": "Thanks Peter! That makes it really simple to understand."}, {"owner": {"reputation": 23, "user_id": 12169696, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UDo8FXt-uws/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdf65kL8SUV81qxlFdZlYkQbYWXFw/photo.jpg?sz=128", "display_name": "Robin", "link": "https://stackoverflow.com/users/12169696/robin"}, "edited": false, "score": 0, "creation_date": 1570344520, "post_id": 58251577, "comment_id": 102879261, "body": "Is it possible to send &quot;\\xff\\xffXYZ\\n&quot; directly to device through socket? Or do I need some byte conversion?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1570303379, "last_edit_date": 1570303379, "creation_date": 1570303077, "answer_id": 58251577, "question_id": 58251045, "link": "https://stackoverflow.com/questions/58251045/why-is-go-language-function-used-in-iot-tcp-commands/58251577#58251577", "title": "Why is go language function used in IOT TCP commands?", "body": "<p>Communications rely on agreed upon protocols. TCP and other similar protocols wrap and unwrap data in protocol layers (see the <a href=\"https://en.wikipedia.org/wiki/OSI_model\" rel=\"nofollow noreferrer\">OSI model</a>) as data is transmitted from source to destination.</p>\n\n<p>Let's rewrite the code to make it more readable and efficient.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc MakeCMD(inst string) []byte {\n    cmd := make([]byte, 0, 2+len(inst)+1)\n    cmd = append(cmd, '\\xFF')\n    cmd = append(cmd, '\\xFF')\n    cmd = append(cmd, inst...)\n    cmd = append(cmd, '\\n')\n    return cmd\n}\n\nfunc main() {\n    inst := \"XYZ\"\n    fmt.Printf(\"%q\\n\", MakeCMD(inst))\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/--RnhF1b37A\" rel=\"nofollow noreferrer\">https://play.golang.org/p/--RnhF1b37A</a></p>\n\n<p>Output:</p>\n\n<pre><code>\"\\xff\\xffXYZ\\n\"\n</code></pre>\n\n<p>It looks like data (\"XYZ\") is wrapped in flow-control bytes, like newline (<code>'\\n'</code>) to terminate the data.</p>\n\n<p>You need to look at the IOT device specification to interpret the data sent to the IOT device. What communications protocol is the IOT device using?</p>\n"}], "owner": {"reputation": 23, "user_id": 12169696, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UDo8FXt-uws/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdf65kL8SUV81qxlFdZlYkQbYWXFw/photo.jpg?sz=128", "display_name": "Robin", "link": "https://stackoverflow.com/users/12169696/robin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 2, "answer_count": 1, "score": -1, "last_activity_date": 1570303379, "creation_date": 1570299144, "question_id": 58251045, "link": "https://stackoverflow.com/questions/58251045/why-is-go-language-function-used-in-iot-tcp-commands", "title": "Why is go language function used in IOT TCP commands?", "body": "<p>Let's say I have a command xyz.\nThe command is always passed into this function and stored in the variable and then sent to the socket. I am not sure why it's used in TCP commands. Can't we just directly pass string commands into the TCP socket ?\n// MakeCMD makes IoT command</p>\n\n<pre><code>func MakeCMD(inst string) []byte {\n    src := []byte(inst)\n    arr := []byte{}\n    arr = append(arr, 255)\n    arr = append(arr, 255)\n    for i := 0; i &lt; len(src); i++ {\n        arr = append(arr, src[i])\n    }\n    arr = append(arr, 10)\n\n    return arr\n}\n</code></pre>\n"}, {"tags": ["go", "heroku", "database-migration"], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 5100389, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-NMKRMBJ0HbE/AAAAAAAAAAI/AAAAAAAAABM/Hn1Kr9cDj_E/photo.jpg?sz=128", "display_name": "Nikola Lukic", "link": "https://stackoverflow.com/users/5100389/nikola-lukic"}, "edited": false, "score": 0, "creation_date": 1619082787, "post_id": 61941207, "comment_id": 118799157, "body": "I followed your example, but I am getting:  -----&gt; Running: go install -v -tags heroku ./vendor/github.com/golang-migrate/migrate/v4/cmd/migrate .  stat /tmp/build_2038f68e/vendor/github.com/golang-migrate/migrate&zwnj;&#8203;/v4/cmd/migrate: directory not found.   I have vendor/golang-migrate/migrate/v4/cmd/migrate folder with main.go inside"}], "tags": [], "owner": {"reputation": 17289, "user_id": 45849, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/4PHVX.jpg?s=128&g=1", "display_name": "Tony", "link": "https://stackoverflow.com/users/45849/tony"}, "is_accepted": false, "score": 2, "last_activity_date": 1590085303, "creation_date": 1590085303, "answer_id": 61941207, "question_id": 58250793, "link": "https://stackoverflow.com/questions/58250793/how-to-run-go-migrations-on-heroku-on-release/61941207#61941207", "title": "How to run Go migrations on heroku on release?", "body": "<p>You have to tell Heroku to build it, and it's a bit of a pain. Here's how you make it happen using go modules.</p>\n\n<p>First you have to tell go modules to include it even though it's not referenced in the source. This is discussed <a href=\"https://github.com/go-modules-by-example/index/blob/master/010_tools/README.md\" rel=\"nofollow noreferrer\">here</a>. This is my tools package which lives in <code>tools.go</code> in the root of my project:</p>\n\n<pre><code>// +build tools\n\npackage tools\n\n// See this https://github.com/go-modules-by-example/index/blob/master/010_tools/README.md\n\nimport (\n    _ \"github.com/golang-migrate/migrate/v4\"\n    _ \"github.com/golang-migrate/migrate/v4/cmd/migrate\"\n)\n</code></pre>\n\n<p>I then vendored my dependencies.</p>\n\n<pre><code>go mod tidy\ngo mod vendor\n</code></pre>\n\n<p>Finally, you have to tell Heroku to build the binary for <code>migrate</code> which is <a href=\"https://elements.heroku.com/buildpacks/heroku/heroku-buildpack-go\" rel=\"nofollow noreferrer\">not documented very thoroughly</a>. For this you not only need to specify the path where migrate lives, you need to include a \".\" which tells heroku you also want to look for <code>main</code> packages in the working directory. This is because (I'm guessing) using that directive overrides their default package search behavior. This is what my modules file looks like:</p>\n\n<pre><code>module ...\n\n// +heroku goVersion 1.14\n// +heroku install -tags 'postgres' ./vendor/github.com/golang-migrate/migrate/v4/cmd/migrate .\n\ngo 1.14\n\nrequire (\n...\n</code></pre>\n"}], "owner": {"reputation": 702, "user_id": 4710144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/u0YcI.jpg?s=128&g=1", "display_name": "mrEvgenX", "link": "https://stackoverflow.com/users/4710144/mrevgenx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 441, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1590085303, "creation_date": 1570297157, "question_id": 58250793, "link": "https://stackoverflow.com/questions/58250793/how-to-run-go-migrations-on-heroku-on-release", "title": "How to run Go migrations on heroku on release?", "body": "<p>I'm writing a webapp in Go which uses Postgres for data storage and deploy in on Heroku. How can I run migrations automatically?</p>\n\n<p>I use Go 1.13, for dependency management I want to use Go Modules.</p>\n\n<p>As a migration tool I tried this <a href=\"https://github.com/golang-migrate/migrate\" rel=\"noreferrer\">https://github.com/golang-migrate/migrate</a>.\nLocally I just downloaded latest binary from github releases and run CLI utility <code>./migrate -database $DATABASE_URL -path migrations up</code>.</p>\n\n<p>Heroku Procfile content</p>\n\n<pre><code>release: migrate -database $DATABASE_URL -path migrations up\nweb: bin/myawesomegoapp\n</code></pre>\n\n<p>Of course, when I launch <code>git push heroku master</code> I get an error, that \"migrate\" no such file or directory, release command failed and push rejected.</p>\n\n<p>So, how can I set up project to install <code>migrate</code> command to be able to run it on heroku on every release?</p>\n"}, {"tags": ["go", "build", "telegram", "tdlib"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1570327177, "post_id": 58250414, "comment_id": 102877249, "body": "Try building correctly with a package rather than a single file?"}, {"owner": {"reputation": 421, "user_id": 5279759, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/de3fd7e849f1161ad666e44f6a001c84?s=128&d=identicon&r=PG&f=1", "display_name": "Fominykh Maxim", "link": "https://stackoverflow.com/users/5279759/fominykh-maxim"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1570346312, "post_id": 58250414, "comment_id": 102879552, "body": "@JimB doesn&#39;t help still 250seconds rebuild, tries file, package and directory build, nothing changes"}, {"owner": {"reputation": 1036, "user_id": 11248508, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SXDlR.jpg?s=128&g=1", "display_name": "Kolay.Ne", "link": "https://stackoverflow.com/users/11248508/kolay-ne"}, "edited": false, "score": 0, "creation_date": 1593534513, "post_id": 58250414, "comment_id": 110813170, "body": "@FominykhMaxim have you found a solution?"}, {"owner": {"reputation": 421, "user_id": 5279759, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/de3fd7e849f1161ad666e44f6a001c84?s=128&d=identicon&r=PG&f=1", "display_name": "Fominykh Maxim", "link": "https://stackoverflow.com/users/5279759/fominykh-maxim"}, "reply_to_user": {"reputation": 1036, "user_id": 11248508, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SXDlR.jpg?s=128&g=1", "display_name": "Kolay.Ne", "link": "https://stackoverflow.com/users/11248508/kolay-ne"}, "edited": false, "score": 0, "creation_date": 1593579869, "post_id": 58250414, "comment_id": 110827171, "body": "@Kolay.Ne I can&#39;t remember surely, but the problem was only on my home PC, on other PC everything worked fine, still dunno what the problem was, my guess is some Go/CGO cache"}], "owner": {"reputation": 421, "user_id": 5279759, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/de3fd7e849f1161ad666e44f6a001c84?s=128&d=identicon&r=PG&f=1", "display_name": "Fominykh Maxim", "link": "https://stackoverflow.com/users/5279759/fominykh-maxim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 290, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1570296546, "creation_date": 1570294230, "last_edit_date": 1570296546, "question_id": 58250414, "link": "https://stackoverflow.com/questions/58250414/go-build-tdlib-very-slow-rebuild", "title": "Go build tdlib very slow rebuild", "body": "<p>I am using 2 go bindings for tdlib: each of them builds like 270seconds each time I change a line in my main.go file. TDLib is built using gcc. Is there a way not to rebuild it every time I change a line? I am using go build -v main.go command for it. \nI build TDLib using guide from <a href=\"https://tdlib.github.io/td/build.html\" rel=\"nofollow noreferrer\">https://tdlib.github.io/td/build.html</a></p>\n\n<p>Go Example I'm building is</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"path/filepath\"\n\n    \"github.com/zelenin/go-tdlib/client\"\n)\n\nfunc main() {\n    authorizer := client.ClientAuthorizer()\n    go client.CliInteractor(authorizer)\n    const (\n        // apiId   = MyApiID from my.telegram.org\n        // apiHash = \"My hash from my.telegram.org\"\n    )\n    authorizer.TdlibParameters &lt;- &amp;client.TdlibParameters{\n        UseTestDc:              false,\n        DatabaseDirectory:      filepath.Join(\".tdlib\", \"database\"),\n        FilesDirectory:         filepath.Join(\".tdlib\", \"files\"),\n        UseFileDatabase:        true,\n        UseChatInfoDatabase:    true,\n        UseMessageDatabase:     true,\n        UseSecretChats:         false,\n        ApiId:                  apiId,\n        ApiHash:                apiHash,\n        SystemLanguageCode:     \"en\",\n        DeviceModel:            \"Server\",\n        SystemVersion:          \"1.0.0\",\n        ApplicationVersion:     \"1.0.0\",\n        EnableStorageOptimizer: true,\n        IgnoreFileNames:        false,\n    }\n    logVerbosity := client.WithLogVerbosity(&amp;client.SetLogVerbosityLevelRequest{\n        NewVerbosityLevel: 0,\n    })\n    tdlibClient, err := client.NewClient(authorizer, logVerbosity)\n    if err != nil {\n        log.Fatalf(\"NewClient error: %s\", err)\n    }\n    optionValue, err := tdlibClient.GetOption(&amp;client.GetOptionRequest{\n        Name: \"version\",\n    })\n    if err != nil {\n        log.Fatalf(\"GetOption error: %s\", err)\n    }\n    log.Printf(\"TDLib version: %s\", optionValue.(*client.OptionValueString).Value)\n\n    me, err := tdlibClient.GetMe()\n    if err != nil {\n        log.Fatalf(\"GetMe error: %s\", err)\n    }\n    log.Printf(\"Me: %s %s [%s]\", me.FirstName, me.LastName, me.Username)\n    listener := tdlibClient.GetListener()\n    defer listener.Close()\n\n    for update := range listener.Updates {\n        if update.GetClass() == client.ClassUpdate {\n            log.Printf(\"%#v\", update)\n        }\n    }\n\n}\n\n</code></pre>\n\n<p>Then i use time go build -v main.go, and got this result:</p>\n\n<pre><code>time go build -v main.go\ncommand-line-arguments\ngo build -v main.go  257.16s user 9.45s system 99% cpu 4:28.81 total\n</code></pre>\n\n<p>Is it possible to build concurrently (not with 1 CPU)?\nDuring rebuild it gets the same result, as I add some new lines. I want it to build much faster than 257s for one line change.</p>\n"}, {"tags": ["go", "struct", "interface", "slice"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570282795, "post_id": 58248794, "comment_id": 102868337, "body": "If I&#39;m not mistaken this is not possible with <code>[]IFoo</code> and <code>encoding&#47;json</code> because the <code>json</code> package won&#39;t look &quot;further&quot; than <code>IFoo</code> to try to figure out the element type of the slice. What you could do is use <code>*interface{}</code> as the argument to <code>FooFactory</code> and then simply set that as <code>*p = &amp;[]Foo{}</code> and then passing <code>o</code>, without the <code>&amp;</code> to <code>Unmarshal</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1570282978, "post_id": 58248794, "comment_id": 102868370, "body": "... that said, without knowing <i>why</i> you&#39;re doing what you&#39;re doing the way you&#39;re doing it, this looks like a very bad idea and I would recommend you rethink and redesign."}, {"owner": {"reputation": 86, "user_id": 155223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eeea12563722143ca5bec3c65b1678d7?s=128&d=identicon&r=PG", "display_name": "Roman Golubin", "link": "https://stackoverflow.com/users/155223/roman-golubin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570283496, "post_id": 58248794, "comment_id": 102868488, "body": "@mkopriva thanks. I want create an abstract factory to pass it fo some complex functions in loop. I need more than some hunders of different factories and I don`t want copy/paste for identical hundres rows of code for each type struct. But I want strong types nor &quot;interface{}&quot; at same time."}, {"owner": {"reputation": 86, "user_id": 155223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eeea12563722143ca5bec3c65b1678d7?s=128&d=identicon&r=PG", "display_name": "Roman Golubin", "link": "https://stackoverflow.com/users/155223/roman-golubin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570283662, "post_id": 58248794, "comment_id": 102868538, "body": "I understand than I can unmarshal data directly in factory code but I don&#39;t want &quot;dirty&quot; factory )"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1570284295, "post_id": 58248794, "comment_id": 102868692, "body": "You want to use strong types and you don&#39;t want to dirty your factory, that&#39;s fine, just keep in mind, as I&#39;ve already said, <code>encoding&#47;json</code> doesn&#39;t work the way <i>you want</i>. Either write your own unmarshaler or scale down your wants."}, {"owner": {"reputation": 86, "user_id": 155223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eeea12563722143ca5bec3c65b1678d7?s=128&d=identicon&r=PG", "display_name": "Roman Golubin", "link": "https://stackoverflow.com/users/155223/roman-golubin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570286033, "post_id": 58248794, "comment_id": 102869147, "body": "Thank you. I keep in mind )"}], "answers": [{"tags": [], "owner": {"reputation": 86, "user_id": 155223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eeea12563722143ca5bec3c65b1678d7?s=128&d=identicon&r=PG", "display_name": "Roman Golubin", "link": "https://stackoverflow.com/users/155223/roman-golubin"}, "is_accepted": true, "score": 0, "last_activity_date": 1571320237, "creation_date": 1571320237, "answer_id": 58434283, "question_id": 58248794, "link": "https://stackoverflow.com/questions/58248794/how-to-change-slice-of-interface-to-slice-of-struct/58434283#58434283", "title": "How to change slice of interface to slice of struct", "body": "<p>I found solution</p>\n\n<p><a href=\"https://play.golang.org/p/syNVY0KTtM2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/syNVY0KTtM2</a></p>\n\n<p>Thank you all for assistance</p>\n"}], "owner": {"reputation": 86, "user_id": 155223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eeea12563722143ca5bec3c65b1678d7?s=128&d=identicon&r=PG", "display_name": "Roman Golubin", "link": "https://stackoverflow.com/users/155223/roman-golubin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 1, "accepted_answer_id": 58434283, "answer_count": 1, "score": -2, "last_activity_date": 1571320237, "creation_date": 1570282288, "last_edit_date": 1571319984, "question_id": 58248794, "link": "https://stackoverflow.com/questions/58248794/how-to-change-slice-of-interface-to-slice-of-struct", "title": "How to change slice of interface to slice of struct", "body": "<p>How to set slice of interface to slice of struct? </p>\n\n<p>I define interface</p>\n\n<pre><code>type IFoo interface{\n  //something methods\n}\n</code></pre>\n\n<p>I define struct</p>\n\n<pre><code>type Foo struct{\n  Id int `json:\"Id\"`\n  //somethig fields\n}\n</code></pre>\n\n<p>I create factory of structs and I want change IFoo slice to slice of concrette struct type</p>\n\n<pre><code>func FooFactory (p *[]IFoo) {\n  *p = *(*[]IFoo)(unsafe.Pointer(&amp;[]Foo{})\n  //here I try something like unsafe.Pointer, reflect.SliceHeader but nothing does not works\n}\n</code></pre>\n\n<p>and then I want to use result for Unmarshal json:</p>\n\n<pre><code>func main() {\n  var o []IFoo\n  FooFactory(&amp;o)\n  j := []byte(`[{\"Id\":1}, {\"Id\":2}]`)\n  json.Unmarshal (j, &amp;o)\n  fmt.Println(o)\n}\n</code></pre>\n\n<p>I get [map[Id:1] map[Id:2]]\nBut I want to get [{1} {2}]</p>\n\n<p>If I define var o as []Foo I get expected result but I can't use concrete struct type as abstraction.</p>\n\n<p>How to do? Thanks and sory for my bad english.</p>\n"}, {"tags": ["git", "go", "go-git"], "answers": [{"tags": [], "owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "is_accepted": true, "score": 1, "last_activity_date": 1570270743, "last_edit_date": 1570270743, "creation_date": 1570270385, "answer_id": 58247337, "question_id": 58247194, "link": "https://stackoverflow.com/questions/58247194/go-git-is-it-possible-to-perform-a-hard-reset-to-origin-branch/58247337#58247337", "title": "go-git: Is it possible to perform a hard reset to origin branch?", "body": "<p>When using Git from the command line you'd need to use <code>rev-parse</code> (see <a href=\"https://stackoverflow.com/questions/9110478/how-to-find-the-hash-of-branch-in-git\">How to find the hash of branch in Git?</a>).</p>\n\n<p>It seems to be implemented partially in go-git:</p>\n\n<blockquote>\n  <p>There exists a method <a href=\"https://godoc.org/gopkg.in/src-d/go-git.v4#Repository.ResolveRevision\" rel=\"nofollow noreferrer\">(*Repository).ResolveRevision</a> which satisfies\n  part of the behavior of <code>rev-parse</code></p>\n</blockquote>\n\n<p>Source: <a href=\"https://github.com/src-d/go-git/issues/599\" rel=\"nofollow noreferrer\">https://github.com/src-d/go-git/issues/599</a></p>\n"}], "owner": {"reputation": 2275, "user_id": 3190146, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QQgqK.png?s=128&g=1", "display_name": "Kludge", "link": "https://stackoverflow.com/users/3190146/kludge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 58247337, "answer_count": 1, "score": 0, "last_activity_date": 1570270743, "creation_date": 1570269424, "question_id": 58247194, "link": "https://stackoverflow.com/questions/58247194/go-git-is-it-possible-to-perform-a-hard-reset-to-origin-branch", "title": "go-git: Is it possible to perform a hard reset to origin branch?", "body": "<p>I'm trying to achieve the result of the following git commands programmatically using go-git:</p>\n\n<pre><code>git fetch\ngit reset --hard origin/&lt;some_branch&gt;\n</code></pre>\n\n<p>So there's <code>git.Worktree.Reset()</code>, which gets <code>git.ResetOptions</code>, which has a <code>Commit</code> property which is of type <code>plumbing.Hash</code>. Unfortunately, I can't figure out how to get the hash for <code>origin/&lt;some_branch&gt;</code>.</p>\n\n<p>How can I do that?</p>\n"}, {"tags": ["go", "filenames"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1570230226, "post_id": 58243875, "comment_id": 102860102, "body": "Your innermost for loop is broken. It either never runs at all or never terminates because j doesn&#39;t change."}], "answers": [{"tags": [], "owner": {"reputation": 2865, "user_id": 12155142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4be55648d441d1e9de6e0937d5702694?s=128&d=identicon&r=PG&f=1", "display_name": "chash", "link": "https://stackoverflow.com/users/12155142/chash"}, "is_accepted": false, "score": 0, "last_activity_date": 1570230075, "creation_date": 1570230075, "answer_id": 58244001, "question_id": 58243875, "link": "https://stackoverflow.com/questions/58243875/making-a-filename-truncator-in-go/58244001#58244001", "title": "Making a filename truncator in go", "body": "<p>Your <code>s</code> variable should  be moved into the outermost loop since its lifetime should be tied to a single <code>oldName</code>. The innermost loop has no exit condition once a non <code>-</code> character is encountered. That should be an <code>if</code> statement with a corresponding <code>break</code> if a <code>-</code> is found. As for building up the new filename, you ought to use <code>+= string(j)</code> instead of quoting the rune.</p>\n\n<pre><code>func changeFilename() {\n    file, err := os.Open(\".\")\n    if err != nil {\n        log.Fatalf(\"failed opening directory: %s\", err)\n    }\n    defer file.Close()\n\n    oldNames, _ := file.Readdirnames(0)\n\n    for _, i := range oldNames {\n        var s string\n        for _, j := range i {\n            if j != '-' {\n                s += string(j)\n            } else {\n                    break\n            }\n        }\n        err := os.Rename(i, s)\n        if err != nil {\n        log.Fatal(\"failed to rename: %s\", err)\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 3, "user_id": 10997723, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GucDuHUtR5I/AAAAAAAAAAI/AAAAAAAAM4s/x1fsdaV-ImM/photo.jpg?sz=128", "display_name": "dartharva", "link": "https://stackoverflow.com/users/10997723/dartharva"}, "edited": false, "score": 2, "creation_date": 1570250363, "post_id": 58244452, "comment_id": 102862596, "body": "@AtharV: You accepted an answer from <code>@hmm</code> which renames more than files. For example, sub-directories. You asked for &quot;all files in the directory.&quot;"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1570249854, "last_edit_date": 1570249854, "creation_date": 1570235372, "answer_id": 58244452, "question_id": 58243875, "link": "https://stackoverflow.com/questions/58243875/making-a-filename-truncator-in-go/58244452#58244452", "title": "Making a filename truncator in go", "body": "<p>Fixing your logic to correspond to your description of the problem:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"path/filepath\"\n)\n\n// changeFilename truncates filenames after (and including) the character \"-\"\n// of all files in the directory. File extensions are preserved.\nfunc changeFilename(dir string) {\n    file, err := os.Open(dir)\n    if err != nil {\n        log.Fatalf(\"failed opening directory: %s\", err)\n    }\n    defer file.Close()\n\n    fis, err := file.Readdir(0)\n    if err != nil {\n        log.Fatalf(\"failed reading directory: %s\", err)\n    }\n\n    for _, fi := range fis {\n        if !fi.Mode().IsRegular() {\n            continue\n        }\n        old := fi.Name()\n        ext := filepath.Ext(old)\n        for i, r := range old[:len(old)-len(ext)] {\n            if r == '-' {\n                new := old[:i] + ext\n                err := os.Rename(old, new)\n                if err != nil {\n                    log.Fatalf(\"failed to rename: %s\", err)\n                }\n                fmt.Printf(\"%q %q\\n\", old, new)\n                break\n            }\n        }\n    }\n}\n\nfunc main() {\n    changeFilename(\".\")\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>\"trunc-ate.typ\" \"trunc.typ\"\n\"hyp-hen.ext\" \"hyp.ext\"\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 10997723, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GucDuHUtR5I/AAAAAAAAAAI/AAAAAAAAM4s/x1fsdaV-ImM/photo.jpg?sz=128", "display_name": "dartharva", "link": "https://stackoverflow.com/users/10997723/dartharva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 58244452, "answer_count": 2, "score": 0, "last_activity_date": 1570249854, "creation_date": 1570228919, "last_edit_date": 1570231521, "question_id": 58243875, "link": "https://stackoverflow.com/questions/58243875/making-a-filename-truncator-in-go", "title": "Making a filename truncator in go", "body": "<p>I am new to Go, and I've been trying to make a program that truncates filenames after (and including) the character \"-\" of all files in its directory. It's not working, and I don't know where I'm going wrong.</p>\n\n<pre><code>func changeFilename() {\n    file, err := os.Open(\".\")\n    if err != nil {\n        log.Fatalf(\"failed opening directory: %s\", err)\n    }\n    defer file.Close()\n\n    oldNames, _ := file.Readdirnames(0)\n\n    var s string\n    for _, i := range oldNames {\n        for _, j := range i {\n            for j != '-' {\n                k := strconv.QuoteRune(j)\n                s += k\n                j++\n            }\n        }\n        err := os.Rename(i, s)\n        if err != nil {\n        log.Fatal(\"failed to rename: %s\", err)\n        }\n    }\n}\n</code></pre>\n\n<p>I expected filenames in the test directory to be changed when I ran the executable, but they didn't. The program builds without any error messages.</p>\n"}, {"tags": ["go", "struct", "slice"], "answers": [{"comments": [{"owner": {"reputation": 4742, "user_id": 1335189, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/f98526aa898553a64cc6bfb6c0815f4b?s=128&d=identicon&r=PG", "display_name": "JorgeeFG", "link": "https://stackoverflow.com/users/1335189/jorgeefg"}, "edited": false, "score": 0, "creation_date": 1570228353, "post_id": 58243802, "comment_id": 102859753, "body": "Could you please provide an implementation example mixing types? I cannot see how it works... because well... I am newbie in go"}], "tags": [], "owner": {"reputation": 2865, "user_id": 12155142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4be55648d441d1e9de6e0937d5702694?s=128&d=identicon&r=PG&f=1", "display_name": "chash", "link": "https://stackoverflow.com/users/12155142/chash"}, "is_accepted": true, "score": 1, "last_activity_date": 1570228284, "creation_date": 1570228284, "answer_id": 58243802, "question_id": 58243675, "link": "https://stackoverflow.com/questions/58243675/is-there-a-way-to-have-a-dynamic-type-slice-in-go/58243802#58243802", "title": "Is there a way to have a dynamic type slice in Go?", "body": "<p>An <code>interface{}</code> is one way to do it. Something like:</p>\n\n<pre><code>type StandardResponse struct {\n   Error    bool\n   ErrorMsg string\n   Data     interface{}\n}\n</code></pre>\n\n<p>Marshaling this to JSON will work assuming the underlying type of <code>interface{}</code> supports it.</p>\n"}], "owner": {"reputation": 4742, "user_id": 1335189, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/f98526aa898553a64cc6bfb6c0815f4b?s=128&d=identicon&r=PG", "display_name": "JorgeeFG", "link": "https://stackoverflow.com/users/1335189/jorgeefg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 58243802, "answer_count": 1, "score": -3, "last_activity_date": 1570228284, "creation_date": 1570227131, "question_id": 58243675, "link": "https://stackoverflow.com/questions/58243675/is-there-a-way-to-have-a-dynamic-type-slice-in-go", "title": "Is there a way to have a dynamic type slice in Go?", "body": "<p>I have a standard response built in PHP for microservices that I want to replicate in Go.\nIn particular, the \"data\" element of the response array can have anything.</p>\n\n<p>Example</p>\n\n<pre><code>$response['data'] = [];\n$response['data']['entities'] = [ objects that implements toArray() ]\n$response['data']['quantity'] = 1\n</code></pre>\n\n<p>Problem is that Data differs per endpoint.</p>\n\n<p>So one option I was thinking is in each endpoint (controller, action, etc) declare a Data struct that I would use in the <code>StandardResponse.Data</code> struct.</p>\n\n<p>But how can I achieve that? Using interfaces?</p>\n\n<p>Sorry I am new to Go.</p>\n"}, {"tags": ["file", "go"], "comments": [{"owner": {"reputation": 1434, "user_id": 7212665, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KrLoI.jpg?s=128&g=1", "display_name": "Demi-Lune", "link": "https://stackoverflow.com/users/7212665/demi-lune"}, "edited": false, "score": 4, "creation_date": 1570221480, "post_id": 58242892, "comment_id": 102858050, "body": "You could check it&#39;s mime-type? With e.g. <a href=\"https://golang.org/pkg/mime/\" rel=\"nofollow noreferrer\">golang.org/pkg/mime</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1570222051, "post_id": 58242892, "comment_id": 102858224, "body": "I found this: <a href=\"https://godoc.org/golang.org/x/tools/godoc/util#IsTextFile\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/tools/godoc/util#IsTextFile</a> , or if you&#39;ve already pulled the bytes: <a href=\"https://godoc.org/golang.org/x/tools/godoc/util#IsText\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/tools/godoc/util#IsText</a>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 3, "creation_date": 1570225848, "post_id": 58242892, "comment_id": 102859182, "body": "You can try http.DetectContentType, and check if the content type is text/plain."}, {"owner": {"reputation": 29, "user_id": 12166408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8117e8dea3c0c9873888c770f6b2d399?s=128&d=identicon&r=PG&f=1", "display_name": "Tahi Ayam", "link": "https://stackoverflow.com/users/12166408/tahi-ayam"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1570256034, "post_id": 58242892, "comment_id": 102863277, "body": "thank you all, i use util from @RayfenWindspear"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1570316420, "post_id": 58242892, "comment_id": 102876052, "body": "Depending on what exactly you are really doing here, it&#39;s more conservative to initially start with the other two suggestions, as they merely check small header information. If those fail, don&#39;t exist, or aren&#39;t an option for whatever reason, <i>then</i> fallback to the methods I linked, as those are significantly heavier across the spectrum of CPU/Memory/IO. Not to mention it&#39;s an import from outside the std libs, so more code as well."}, {"owner": {"reputation": 29, "user_id": 12166408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8117e8dea3c0c9873888c770f6b2d399?s=128&d=identicon&r=PG&f=1", "display_name": "Tahi Ayam", "link": "https://stackoverflow.com/users/12166408/tahi-ayam"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1571192875, "post_id": 58242892, "comment_id": 103154602, "body": "@RayfenWindspear IsText doesn&#39;t works in windows"}], "owner": {"reputation": 29, "user_id": 12166408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8117e8dea3c0c9873888c770f6b2d399?s=128&d=identicon&r=PG&f=1", "display_name": "Tahi Ayam", "link": "https://stackoverflow.com/users/12166408/tahi-ayam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 492, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1570221164, "creation_date": 1570221164, "question_id": 58242892, "link": "https://stackoverflow.com/questions/58242892/go-check-if-file-is-a-text-file", "title": "Go check if file is a text file", "body": "<p>how do I check if a file is a text file, not images, video nor other than a text file?</p>\n\n<p>what I already tried is to check a-Z 0-9 and special chars is contained in the file</p>\n"}, {"tags": ["mongodb", "docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1570232278, "post_id": 58242737, "comment_id": 102860435, "body": "Just a wild guess, but could you try to use all lowercase names for the services?"}, {"owner": {"reputation": 742, "user_id": 1507066, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2aa876aa0d2187ccd991e64b8008a0bc?s=128&d=identicon&r=PG", "display_name": "achempion", "link": "https://stackoverflow.com/users/1507066/achempion"}, "edited": false, "score": 0, "creation_date": 1570237288, "post_id": 58242737, "comment_id": 102861198, "body": "try to remove <code>hostname</code> option from configuration"}, {"owner": {"reputation": 541, "user_id": 1280343, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/wpNOe.png?s=128&g=1", "display_name": "SomeGuyWhoCodes", "link": "https://stackoverflow.com/users/1280343/someguywhocodes"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570254925, "post_id": 58242737, "comment_id": 102863131, "body": "hey @MarkusWMahlberg thanks. That was it. I changed it to all lower and it starts working. I did not see that mentioned anywhere, but also I haven&#39;t read all the documentation , but I did find lot of unresolved issues on github related to casing. Btw how did you guess it?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570271564, "post_id": 58242737, "comment_id": 102865939, "body": "The error message. The name was all lowercase. Since it did not get the service by that name, my assumption was that the hostname was taken literally from the service name. Which turned out to be true ;).  This seems like a bug in docker to me - I would have to read up, but iirc, DNS is supposed to be case insensitive."}], "owner": {"reputation": 541, "user_id": 1280343, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/wpNOe.png?s=128&g=1", "display_name": "SomeGuyWhoCodes", "link": "https://stackoverflow.com/users/1280343/someguywhocodes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1570255088, "creation_date": 1570220135, "last_edit_date": 1570255088, "question_id": 58242737, "link": "https://stackoverflow.com/questions/58242737/unable-to-connect-to-mongodb-service-from-another-service", "title": "Unable to connect to mongodb service from another service", "body": "<p>OS: MacOS mojave</p>\n\n<pre><code>version: '3.1'\n\nservices:  \n  apiWithKubernetesMongodb:\n    container_name: apiWithKubernetesMongodb\n    image: mongo\n    ports:\n      - \"27018:27018\"\n    expose:\n      - \"27018\"\n    command: --bind_ip_all --port 27018\n    hostname: mongodb\n    environment:\n      MONGO_INITDB_ROOT_USERNAME: mongousradmin\n      MONGO_INITDB_ROOT_PASSWORD: mongopassadmin\n      MONGO_INITDB_DATABASE: admin\n    networks:\n      - apinet\n\n  apiWithKubernetes: \n    container_name: api_with_kubernetes\n    image: sherryummen/api_with_kubernetes:v1\n    build: \n      context: .\n      dockerfile: Dockerfile\n    networks:\n      - apinet\n    volumes:\n      - .:/go/src/api_with_kubernetes\n    ports:\n      - 8080:8080\n    depends_on:\n      - apiWithKubernetesMongodb\n    links:\n      - apiWithKubernetesMongodb\n\nnetworks:\n  apinet:\n    driver: bridge\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>const (\n    HOST           = \"apiWithKubernetesMongodb\"\n    PORT           = 27018\n    DBNAME         = \"service_db\"\n    COLLECTIONNAME = \"user_info\"\n    ROOTUSER       = \"mongousradmin\"\n    ROOTPASSWORD   = \"mongopassadmin\"\n)\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>client, err := mongo.NewClient(options.Client().ApplyURI(fmt.Sprintf(\"mongodb://%s:%s@%s:%d/admin\", ROOTUSER, ROOTPASSWORD, HOST, PORT)))\n</code></pre>\n\n<p>I have thee above docker file and go api which should connect to mongodb.</p>\n\n<p>But my go code gives error \"server selection timeout\\ncurrent topology: Type: Unknown\\nServers:\\nAddr: apiwithkubernetesmongodb:27018, Type: Unknown, State: Connected, Average RTT: 0, Last error: connection(apiwithkubernetesmongodb:27018[-249]) connection is closed\"</p>\n\n<p><strong>Note: For those who stumble to this, it was all about casing of the name of the service, after switching to all lower case naming, it starts working.</strong></p>\n"}, {"tags": ["go", "ssl", "x509"], "answers": [{"tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 1, "last_activity_date": 1570218531, "creation_date": 1570218531, "answer_id": 58242422, "question_id": 58241987, "link": "https://stackoverflow.com/questions/58241987/convert-the-x509-certpool-to-pembytes/58242422#58242422", "title": "Convert the x509 certPool to pemBytes", "body": "<p>The <a href=\"https://golang.org/src/crypto/x509/cert_pool.go#L14\" rel=\"nofollow noreferrer\">struct field containing the <code>[]*Certificate</code> is unexported</a>, and there are no functions that expose them. Likely to protect them from exactly what you are wanting to do. Thus, using the package as-is, there is no way to do this. There are also no <code>interface</code>s defined, so you wouldn't be able to provide your own implementation of a <code>CertPool</code> with this added functionality either.</p>\n"}], "owner": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 58242422, "answer_count": 1, "score": 0, "last_activity_date": 1570218531, "creation_date": 1570216121, "last_edit_date": 1570218477, "question_id": 58241987, "link": "https://stackoverflow.com/questions/58241987/convert-the-x509-certpool-to-pembytes", "title": "Convert the x509 certPool to pemBytes", "body": "<p>In Go there is a function:</p>\n\n<pre><code>func (s *CertPool) AppendCertsFromPEM(pemCerts []byte) (ok bool)\n</code></pre>\n\n<p>but there is no way to do the opposite. </p>\n\n<p>How would I convert the x509.CertPool to PEM bytes?</p>\n"}, {"tags": ["go", "hash", "cryptography"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1570216067, "post_id": 58241897, "comment_id": 102856156, "body": "<a href=\"https://godoc.org/crypto/sha512#New512_256\" rel=\"nofollow noreferrer\">godoc.org/crypto/sha512#New512_256</a> Then a quick definition search. It&#39;s sha512, that is truncated to 256. Probably just use plain sha512, the concept of generating a sha512 hash and then cutting the tail end of it off just seems cryptographically unsound."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1570216704, "post_id": 58241897, "comment_id": 102856372, "body": "I stand corrected. Further looking into this, it&#39;s not simply chopped off, and sha512 is vulnerable to &quot;length extension attacks&quot;, whereas sha512/256 is not &quot;(<a href=\"https://pycryptodome.readthedocs.io/en/latest/src/hash/sha512.html\" rel=\"nofollow noreferrer\">pycryptodome.readthedocs.io/en/latest/src/hash/sha512.html</a>&zwnj;&#8203;). However, when used in combination with <code>hmac</code> it is not vulnerable, so it should be fine."}, {"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1570223868, "post_id": 58241897, "comment_id": 102858742, "body": "@RayfenWindspear: Yes, it is simply chopped off."}, {"owner": {"reputation": 3791, "user_id": 1820553, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-NZb6uZzo4Gg/AAAAAAAAAAI/AAAAAAAAAo0/xTr6RvgMTRw/photo.jpg?sz=128", "display_name": "kelalaka", "link": "https://stackoverflow.com/users/1820553/kelalaka"}, "reply_to_user": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1570224593, "post_id": 58241897, "comment_id": 102858910, "body": "@JamesKPolk, not that simply. There is also a domain separation. See, in the answer."}, {"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "reply_to_user": {"reputation": 3791, "user_id": 1820553, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-NZb6uZzo4Gg/AAAAAAAAAAI/AAAAAAAAAo0/xTr6RvgMTRw/photo.jpg?sz=128", "display_name": "kelalaka", "link": "https://stackoverflow.com/users/1820553/kelalaka"}, "edited": false, "score": 1, "creation_date": 1570225508, "post_id": 58241897, "comment_id": 102859114, "body": "@kelalaka: Yes, my apologies, you&#39;re correct as usual."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1570259543, "post_id": 58241897, "comment_id": 102863767, "body": "@RayfenWindspear truncating hashes is common practice, and not unsound if done reasonably. <a href=\"https://security.stackexchange.com/a/72685/25107\">security.stackexchange.com/a/72685/25107</a> . One of the properties of a good hash is that every bit of its output is as good as any other."}], "answers": [{"tags": [], "owner": {"reputation": 3791, "user_id": 1820553, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-NZb6uZzo4Gg/AAAAAAAAAAI/AAAAAAAAAo0/xTr6RvgMTRw/photo.jpg?sz=128", "display_name": "kelalaka", "link": "https://stackoverflow.com/users/1820553/kelalaka"}, "is_accepted": true, "score": 3, "last_activity_date": 1570530781, "last_edit_date": 1570530781, "creation_date": 1570222317, "answer_id": 58243052, "question_id": 58241897, "link": "https://stackoverflow.com/questions/58241897/using-this-code-how-do-you-know-if-sha256-or-sha512-would-be-used/58243052#58243052", "title": "using this code how do you know if sha256 or sha512 would be used?", "body": "<p>SHA512 is in the SHA-2 families. Variants are listed in <a href=\"https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf\" rel=\"nofollow noreferrer\">NIST FIPS 180-4</a></p>\n\n<pre><code>- SHA-512/256 truncated from SHA-512 with different initial values \n- SHA-512/224 truncated from SHA-512 with different initial values\n- SHA-384     truncated from SHA-512 with different initial values\n- SHA-512\n\n- SHA-224     truncated from SHA-256 with different initial values\n- SHA-256\n</code></pre>\n\n<p>To separate the domains (called <strong>domain separation</strong>) of these hash functions from their truncated version, different initial values are used. Otherwise, an attack on the truncated version can be carried into other versions, v.v.</p>\n\n<ul>\n<li><strong><em>first question</em></strong></li>\n</ul>\n\n<p>With <code>sha512.New512_256</code> you actually choose a hash function from <code>SHA-512</code> and in this case, it is <code>SHA-512/256</code>, You can select the others from the <a href=\"https://godoc.org/crypto/sha512#New512_256\" rel=\"nofollow noreferrer\">list</a> of godoc.org by looking their string.</p>\n\n<ul>\n<li><strong><em>second question</em></strong></li>\n</ul>\n\n<p>You may need <code>hash</code> not <code>hmac</code>. HMAC is a <a href=\"https://en.wikipedia.org/wiki/HMAC\" rel=\"nofollow noreferrer\">keyed hash-based message authentication</a> code and it useful to authenticate with a key. For every time to control the hash (or checksum), you will need the key.</p>\n\n<p>The library, however, uses <code>Sum512</code> or <code>Sum512_256</code> etc. to calculate the checksum (hash) of a given data. Sample code to calculate the hash is:</p>\n\n<pre><code>sha_512 := sha512.New()\nsha_512.Write([]byte(input))\nhash := base64.URLEncoding.EncodeToString(sha_512.Sum(nil))\n</code></pre>\n\n<hr>\n\n<p><strong>On Truncation</strong></p>\n\n<p>At first, the idea of truncation may seem <a href=\"https://stackoverflow.com/questions/58241897/using-this-code-how-do-you-know-if-sha256-or-sha512-would-be-used#comment102856156_58241897\">unsound</a>. Actually it is not. SHA-512 and SHA-256 have <a href=\"https://en.wikipedia.org/wiki/Length_extension_attack\" rel=\"nofollow noreferrer\">length extension attacks</a>. However, the truncated versions have <a href=\"https://en.wikipedia.org/wiki/SHA-2#Comparison_of_SHA_functions\" rel=\"nofollow noreferrer\">resistances, see table on wikipedia</a>.</p>\n\n<p>It should also be noted that the SHA3 family is designed to have resistance against the length extension attacks. The <a href=\"https://crypto.stackexchange.com/a/62624/18298\">capacity prevents</a> the attacks.</p>\n"}], "owner": {"reputation": 63, "user_id": 5712008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a40d42247dda539ee396a634609b1c6?s=128&d=identicon&r=PG&f=1", "display_name": "DJC", "link": "https://stackoverflow.com/users/5712008/djc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 0, "accepted_answer_id": 58243052, "answer_count": 1, "score": 1, "last_activity_date": 1570530781, "creation_date": 1570215686, "question_id": 58241897, "link": "https://stackoverflow.com/questions/58241897/using-this-code-how-do-you-know-if-sha256-or-sha512-would-be-used", "title": "using this code how do you know if sha256 or sha512 would be used?", "body": "<ol>\n<li><p>Stupid question, in the code below, considering the name is sha512.New512_256, is 512 or 256 used? How do you control which you want? I know I'm missing something elementary here..</p></li>\n<li><p>Also, as I'm looking more at this I'm wondering if hmac is not what I want at all... I'm looking to create some small hashing utilities that will hash any string input or files given as parameters. I would specify the type of hash to use as an input parameter as well... so I would expect the same hash result for the same hash algo used on the same file or string every time... should I be using something else?</p></li>\n</ol>\n\n<p>thanks</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"crypto/hmac\"\n    \"crypto/sha512\"\n)\n\nfunc Hash(tag string, data []byte) []byte {\n    h := hmac.New(sha512.New512_256, []byte(tag))\n    h.Write(data)\n    return h.Sum(nil)\n}\n</code></pre>\n"}, {"tags": ["json", "go", "marshalling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 9, "creation_date": 1570209615, "post_id": 58240704, "comment_id": 102853803, "body": "Just give it a try, <code>encoding&#47;json</code> works without tags as well. (and your tags are invalid anyway)"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1570213259, "post_id": 58240704, "comment_id": 102855216, "body": "You may omit tags, but it is not recommended to do so, as it takes the field&#39;s name as-is (&quot;Name&quot; and &quot;Value&quot;). Consider the repercussions of suddenly deciding to rename a struct field. With no tags, you&#39;ve just changed the <code>json</code> output. With tags, the <code>json</code> stays the same. Also note that fields must be exported, and uppercase <code>json</code> fields is unconventional."}, {"owner": {"reputation": 1172, "user_id": 5004410, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/101a8b8589ddbba5e188469fa0f78e60?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/5004410/dan"}, "edited": false, "score": 0, "creation_date": 1570286556, "post_id": 58240704, "comment_id": 102869296, "body": "There isn&#39;t a library that can automatically look for &quot;Name&quot; or &quot;name&quot; when the struct field is &quot;Name&quot;? Libraries like Java Spring do this for you automatically. This really can&#39;t be done in golang?"}, {"owner": {"reputation": 1172, "user_id": 5004410, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/101a8b8589ddbba5e188469fa0f78e60?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/5004410/dan"}, "edited": false, "score": 0, "creation_date": 1570286989, "post_id": 58240704, "comment_id": 102869406, "body": "Also not sure why this is getting downvotes.. I couldn&#39;t find any reference material that talked about this explicitly as to why it can or can&#39;t be done. If you have any explicit reference material that talks about this topic, please send it my way and document it here for others to find."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1570296612, "post_id": 58240704, "comment_id": 102871803, "body": "@Dan as I&#39;ve already mentioned in my previous comment, <code>encoding&#47;json</code> does what you want, at least as far as I understand your question (<a href=\"https://play.golang.com/p/8HpPv_4fXGu\" rel=\"nofollow noreferrer\">play.golang.com/p/8HpPv_4fXGu</a>). When it comes to <i>marshaling</i> it translates the fields verbatim, which is only logical since there&#39;s no &quot;guide&quot; other than the field name by which to decide how to generate the json. Also the fact that what you want works for unmarshal is mentioned in the package&#39;s documentation. (<a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Unmarshal</a>)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570296769, "post_id": 58240704, "comment_id": 102871845, "body": "@Dan also note that questions seeking recommendations for libraries, books, etc. are off-topic on SO, if you don&#39;t want to use <code>encoding&#47;json</code> but you want to find a library that does &quot;automatically&quot; what you want it to do, you should try another venue."}], "answers": [{"comments": [{"owner": {"reputation": 1172, "user_id": 5004410, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/101a8b8589ddbba5e188469fa0f78e60?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/5004410/dan"}, "edited": false, "score": 0, "creation_date": 1570286648, "post_id": 58241632, "comment_id": 102869323, "body": "I&#39;m not looking for something hacky but more of an official library or framework that can automatifcally try to serialize an object based on its name. For example if I have a field &quot;Value&quot; in my struct, it can&#39;t automatically look for &quot;Value&quot; or &quot;value&quot; in the JSON object and try to associate it without me being explicit?"}], "tags": [], "owner": {"reputation": 45, "user_id": 6169066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/73fd9b8daaf440e6f6a3da6dda6184a6?s=128&d=identicon&r=PG&f=1", "display_name": "Oleg Baranov", "link": "https://stackoverflow.com/users/6169066/oleg-baranov"}, "is_accepted": false, "score": 0, "last_activity_date": 1570214961, "last_edit_date": 1570214961, "creation_date": 1570214280, "answer_id": 58241632, "question_id": 58240704, "link": "https://stackoverflow.com/questions/58240704/is-json-tag-in-struct-really-necessary-for-marshaling/58241632#58241632", "title": "Is json tag in struct really necessary for marshaling?", "body": "<p>By default it will be encoded as </p>\n\n<pre><code>{ \n    \"Name\": \"\",\n    \"Value\": \"\"\n}\n</code></pre>\n\n<p>But go is writen on go and if you really really want lowercase without tags, you can just 'fork' <code>encoding/json</code> package, recreate it as your own package and change behavior in <code>encode.go</code> (line 1151 in go 1.13):</p>\n\n<pre><code>// Record found field and index sequence.    \nif name != \"\" || !sf.Anonymous || ft.Kind() != reflect.Struct {\n        tagged := name != \"\"\n        if name == \"\" {\n           name = sf.Name &lt;-- here, for example to strings.ToLower(sf.Name)\n        }\n        ....\n</code></pre>\n\n<p>I not recommend you to do that, but it works :)</p>\n"}], "owner": {"reputation": 1172, "user_id": 5004410, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/101a8b8589ddbba5e188469fa0f78e60?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/5004410/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 201, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1570286838, "creation_date": 1570209332, "last_edit_date": 1570286838, "question_id": 58240704, "link": "https://stackoverflow.com/questions/58240704/is-json-tag-in-struct-really-necessary-for-marshaling", "title": "Is json tag in struct really necessary for marshaling?", "body": "<p>I was interested to learn if there is a way to have this:</p>\n\n<pre><code>type Example struct {\n  Name    string   `json:\"name\"`\n  Value   string   `json:\"value\"`\n}\n</code></pre>\n\n<p>become this:</p>\n\n<pre><code>type Example struct {\n  Name    string\n  Value   string\n}\n</code></pre>\n\n<p>and still allow for JSON marhaling/unmarshaling? Is there a library or a way to automatically assume or inject these tags without having to be explicit in every struct field?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1570205241, "post_id": 58239778, "comment_id": 102852171, "body": "Maybe try the &quot;Tour of Go&quot; first, this is covered in the section on concurrency: <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">tour.golang.org/concurrency/2</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2865, "user_id": 12155142, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4be55648d441d1e9de6e0937d5702694?s=128&d=identicon&r=PG&f=1", "display_name": "chash", "link": "https://stackoverflow.com/users/12155142/chash"}, "is_accepted": false, "score": 5, "last_activity_date": 1570205072, "creation_date": 1570205072, "answer_id": 58239861, "question_id": 58239778, "link": "https://stackoverflow.com/questions/58239778/some-questions-about-channel-of-golang/58239861#58239861", "title": "some questions about channel of golang", "body": "<p>The channel is unbuffered, meaning one routine must receive in order for the other routine's send to complete. If you remove the <code>pong</code> player, the <code>ping</code> player is blocked sending on the channel (<code>pong</code> is not there to receive), so it will never move to the next iteration of the loop to receive its own message.</p>\n\n<p>If you were to make the channel buffered, the send would be non-blocking if there is room in the buffer: <code>table := make(chan *Ball, 1)</code>. This would allow one ball to be \"held\" in the channel's buffer until a receiver is ready.</p>\n"}], "owner": {"reputation": 21, "user_id": 4478775, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xr1dCAW31Z4/AAAAAAAAAAI/AAAAAAAABhM/xQi6pukTFeg/photo.jpg?sz=128", "display_name": "DU Xia", "link": "https://stackoverflow.com/users/4478775/du-xia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1570223306, "creation_date": 1570204687, "last_edit_date": 1570223306, "question_id": 58239778, "link": "https://stackoverflow.com/questions/58239778/some-questions-about-channel-of-golang", "title": "some questions about channel of golang", "body": "<p>I'm watching a video on YouTube which is talking about concurrency patterns.\nThere is a ping-pong example:</p>\n\n<pre><code>type Ball struct{ hits int }\nfunc main() {\n    table := make(chan *Ball)\n    go player(\"ping\", table)\n    go player(\"pong\", table)\n\n    table &lt;- new(Ball)\n    time.Sleep(1 * time.Second)\n    &lt;-table\n}\n\nfunc player(name string, table chan *Ball) {\n    for {\n        ball := &lt;-table\n        ball.hits++\n        fmt.Println(name, ball.hits)\n        time.Sleep(100 * time.Millisecond)\n        table &lt;- ball\n    }\n}\n</code></pre>\n\n<p>Which should gives the result:</p>\n\n<pre><code>Ping 1\nPong 2\nPing 3\nPong 4\n...\n</code></pre>\n\n<p>However, if I remove one goroutine of player, \"pong\" for example:</p>\n\n<pre><code>// go player(\"pong\", table) // remove this line\n</code></pre>\n\n<p>I got only one result:</p>\n\n<pre><code>Ping 1\n</code></pre>\n\n<p>I don't understand there is a for loop in the func player, and 'table' channel gives the Ball out to ball, at the end of loop, we put the Ball back to the channel table. Why the player \"ping\" can't player with himself?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1570202617, "post_id": 58239194, "comment_id": 102851037, "body": "It is unlikely that your problem is related to your templates. It is more likely that your handler is registered for a different path than you&#39;re trying, or it is not registered at all. That is, you&#39;re either looking at the wrong url, or there is no handler for the courses url."}, {"owner": {"reputation": 9, "user_id": 12148154, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YKxs30LxSYc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfKKGGNE5X4W6Xw86-hu5Y1RdAL4g/photo.jpg?sz=128", "display_name": "Christina Grechishnikova", "link": "https://stackoverflow.com/users/12148154/christina-grechishnikova"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570202982, "post_id": 58239194, "comment_id": 102851213, "body": "@bserdar I registered my handlers and the path seems to be correct, I also provided the code"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1570203232, "post_id": 58239194, "comment_id": 102851330, "body": "You registered POST /course, but with href, it&#39;ll do a GET /course"}, {"owner": {"reputation": 9, "user_id": 12148154, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YKxs30LxSYc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfKKGGNE5X4W6Xw86-hu5Y1RdAL4g/photo.jpg?sz=128", "display_name": "Christina Grechishnikova", "link": "https://stackoverflow.com/users/12148154/christina-grechishnikova"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570204433, "post_id": 58239194, "comment_id": 102851841, "body": "@bserdar thank you!"}], "owner": {"reputation": 9, "user_id": 12148154, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YKxs30LxSYc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfKKGGNE5X4W6Xw86-hu5Y1RdAL4g/photo.jpg?sz=128", "display_name": "Christina Grechishnikova", "link": "https://stackoverflow.com/users/12148154/christina-grechishnikova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1570202705, "creation_date": 1570202371, "last_edit_date": 1570202705, "question_id": 58239194, "link": "https://stackoverflow.com/questions/58239194/create-a-personalised-page-for-an-element", "title": "Create a personalised page for an element", "body": "<p>I'm not sure if the caption is correct so you are very welcome to suggest another one.</p>\n\n<p>Basically, I have a small web-service which is a catalogue of courses. The catalogue page is displayed correctly but I cannot make a course-page work correctly. </p>\n\n<p>Here is my handler for the course page:</p>\n\n<pre><code>func courseHandler(w http.ResponseWriter, r *http.Request) {\n    err := templates.ExecuteTemplate(w, \"course\", courses)\n    if err != nil {\n        fmt.Fprintf(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n}\n</code></pre>\n\n<p>Here is how I parse templates and store courses:</p>\n\n<pre><code>var courses map[string]*models.Course\n\nvar templates = template.Must(template.ParseGlob(\"templates/*.html\"))\n</code></pre>\n\n<p>I also have templates for catalogue and course pages where I put the values in {{...}} format. </p>\n\n<p>Here is an example of a course element in a catalogue HTML page which is a link to a course page.</p>\n\n<pre><code>{{ range $key, $value := . }}\n    &lt;div class=\"row mb-2\"&gt;\n      &lt;div class=\"col-md-8 mx-auto\"&gt;\n        &lt;div\n          class=\"row no-gutters border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative\"&gt;\n          &lt;div class=\"col p-4 d-flex flex-column position-static\"&gt;\n            &lt;strong class=\"d-inline-block mb-2 text-success\"&gt;{{ $value.Category }}&lt;/strong&gt;\n            &lt;h3 class=\"mb-0\"&gt;{{ $value.Title }}&lt;/h3&gt;\n            &lt;div class=\"mb-1 text-muted\"&gt;{{ $value.StartDate }}&lt;/div&gt;\n            &lt;p class=\"card-text mb-auto\"&gt;{{ $value.Description }}&lt;/p&gt;\n            &lt;a href=\"/course?id={{$key}}\" class=\"stretched-link\"&gt;\u0423\u0437\u043d\u0430\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435&lt;/a&gt;\n          &lt;/div&gt;\n          &lt;img class=\"float-right\" width=\"200\" height=\"250\" src=\"{{$value.Image}}\"&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n    {{ end }}\n</code></pre>\n\n<p>I also register my handlers using martini framework:</p>\n\n<pre><code>staticOptions := martini.StaticOptions{Prefix: \"templates\"}\n    m.Use(martini.Static(\"templates\", staticOptions))\n    m.Get(\"/\", indexHandler)\n    m.Get(\"/add\", addHandler)\n    m.Get(\"/courses\", coursesHandler)\n    m.Get(\"/edit\", editHandler)\n    m.Get(\"/delete\", deleteHandler)\n    m.Post(\"/SaveCourse\", saveCourseHandler)\n    m.Post(\"/course\", courseHandler\n</code></pre>\n\n<p>When I try to proceed to the course page I get a \"404 Not Found\" error.</p>\n"}, {"tags": ["windows", "go", "console"], "answers": [{"tags": [], "owner": {"reputation": 804, "user_id": 1486988, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/17b8f96e718c52687081967e991a6b22?s=128&d=identicon&r=PG&f=1", "display_name": "Idan Yadgar", "link": "https://stackoverflow.com/users/1486988/idan-yadgar"}, "is_accepted": true, "score": 5, "last_activity_date": 1570197955, "creation_date": 1570197955, "answer_id": 58237997, "question_id": 58237670, "link": "https://stackoverflow.com/questions/58237670/terminal-raw-mode-does-not-support-arrows-on-windows/58237997#58237997", "title": "Terminal raw mode does not support arrows on Windows", "body": "<p>Used <code>github.com/containerd/console</code> package to make the terminal raw and now it works like a charm.</p>\n\n<p>New code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"github.com/containerd/console\"\n    \"golang.org/x/crypto/ssh/terminal\"\n)\n\nfunc main() {\n    current := console.Current()\n    defer current.Reset()\n\n    if err := current.SetRaw(); err != nil {\n        panic(err)\n    }\n\n    term := terminal.NewTerminal(current, \"\")\n    term.AutoCompleteCallback = func(line string, pos int, key rune) (newLine string, newPos int, ok bool) {\n        // fmt.Println(\"callback:\", line, pos, key)\n\n        return \"\", 0, false\n    }\n\n    line, err := term.ReadLine()\n    fmt.Println(\"result:\", line, err)\n}\n\n</code></pre>\n"}], "owner": {"reputation": 804, "user_id": 1486988, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/17b8f96e718c52687081967e991a6b22?s=128&d=identicon&r=PG&f=1", "display_name": "Idan Yadgar", "link": "https://stackoverflow.com/users/1486988/idan-yadgar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 492, "favorite_count": 0, "accepted_answer_id": 58237997, "answer_count": 1, "score": 2, "last_activity_date": 1570223386, "creation_date": 1570196704, "last_edit_date": 1570223386, "question_id": 58237670, "link": "https://stackoverflow.com/questions/58237670/terminal-raw-mode-does-not-support-arrows-on-windows", "title": "Terminal raw mode does not support arrows on Windows", "body": "<p>I am trying to make my console raw (on Windows), and I'm using ssh/terminal package:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"golang.org/x/crypto/ssh/terminal\"\n)\n\ntype sh struct{}\n\nfunc (sh *sh) Read(b []byte) (int, error) {\n    return os.Stdin.Read(b)\n}\n\nfunc (sh *sh) Write(b []byte) (int, error) {\n    return os.Stdout.Write(b)\n}\n\nfunc main() {\n    oldstate, err := terminal.MakeRaw(int(os.Stdin.Fd()))\n    if err != nil {\n        panic(err)\n    }\n\n    defer terminal.Restore(int(os.Stdin.Fd()), oldstate)\n\n    term := terminal.NewTerminal(&amp;sh{}, \"\")\n    term.AutoCompleteCallback = func(line string, pos int, key rune) (newLine string, newPos int, ok bool) {\n        fmt.Println(\"callback:\", line, pos, key)\n\n        return \"\", 0, false\n    }\n\n    line, err := term.ReadLine()\n    fmt.Println(\"result:\", line, err)\n}\n</code></pre>\n\n<p>It works great, and I can catch Ctrl-C and other special keys, but I can't use the arrow keys.</p>\n\n<p>I want the arrow keys to move the cursor or at least invoke <code>AutoCompleteCallback</code> where I can move the cursor my self.</p>\n"}, {"tags": ["regex", "go", "regex-lookarounds"], "comments": [{"owner": {"reputation": 18299, "user_id": 2191572, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/TWbVr.png?s=128&g=1", "display_name": "MonkeyZeus", "link": "https://stackoverflow.com/users/2191572/monkeyzeus"}, "edited": false, "score": 0, "creation_date": 1570197645, "post_id": 58237638, "comment_id": 102848576, "body": "So what differentiates <code>name1</code> from <code>p1</code>? Do you have a whitelist? What should happen with <code>option p1</code>?"}, {"owner": {"reputation": 18299, "user_id": 2191572, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/TWbVr.png?s=128&g=1", "display_name": "MonkeyZeus", "link": "https://stackoverflow.com/users/2191572/monkeyzeus"}, "edited": false, "score": 0, "creation_date": 1570197769, "post_id": 58237638, "comment_id": 102848633, "body": "is <code>option jhfgudfbs4 ^%#*$)</code> valid?"}, {"owner": {"reputation": 558, "user_id": 1988395, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bdb25eca099d7a254d2ea77818ee69d?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/1988395/coder"}, "reply_to_user": {"reputation": 18299, "user_id": 2191572, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/TWbVr.png?s=128&g=1", "display_name": "MonkeyZeus", "link": "https://stackoverflow.com/users/2191572/monkeyzeus"}, "edited": false, "score": 0, "creation_date": 1570197771, "post_id": 58237638, "comment_id": 102848635, "body": "It should fail. option and name are mandatory. Other options afterward should be exact matched as I wrote in question. I will update my question, so it is clear."}, {"owner": {"reputation": 18299, "user_id": 2191572, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/TWbVr.png?s=128&g=1", "display_name": "MonkeyZeus", "link": "https://stackoverflow.com/users/2191572/monkeyzeus"}, "edited": false, "score": 0, "creation_date": 1570197889, "post_id": 58237638, "comment_id": 102848699, "body": "It is still not clear whatsoever. You state that &quot;while <b>name</b> is valid any ASCII char combination&quot;. Well <code>p1</code> is an ASCII char combination."}, {"owner": {"reputation": 18299, "user_id": 2191572, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/TWbVr.png?s=128&g=1", "display_name": "MonkeyZeus", "link": "https://stackoverflow.com/users/2191572/monkeyzeus"}, "edited": false, "score": 0, "creation_date": 1570197921, "post_id": 58237638, "comment_id": 102848720, "body": "Did you mean to specify that <code>name</code> must be followed by a digit?"}, {"owner": {"reputation": 558, "user_id": 1988395, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bdb25eca099d7a254d2ea77818ee69d?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/1988395/coder"}, "reply_to_user": {"reputation": 18299, "user_id": 2191572, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/TWbVr.png?s=128&g=1", "display_name": "MonkeyZeus", "link": "https://stackoverflow.com/users/2191572/monkeyzeus"}, "edited": false, "score": 0, "creation_date": 1570198098, "post_id": 58237638, "comment_id": 102848796, "body": "I mean you can chose any letter and digits as combination for name. I updated my question."}, {"owner": {"reputation": 18299, "user_id": 2191572, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/TWbVr.png?s=128&g=1", "display_name": "MonkeyZeus", "link": "https://stackoverflow.com/users/2191572/monkeyzeus"}, "edited": false, "score": 0, "creation_date": 1570198360, "post_id": 58237638, "comment_id": 102848925, "body": "Your question makes even less sense now. If name can be any string then why is <code>foo</code> not allowed? <code>foo</code> <b>is</b> &quot;any string&quot;. If you have a whitelist of names and valid string after name then share it because your requirements are impossible to achieve per your question and clarifications."}, {"owner": {"reputation": 558, "user_id": 1988395, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bdb25eca099d7a254d2ea77818ee69d?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/1988395/coder"}, "reply_to_user": {"reputation": 18299, "user_id": 2191572, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/TWbVr.png?s=128&g=1", "display_name": "MonkeyZeus", "link": "https://stackoverflow.com/users/2191572/monkeyzeus"}, "edited": false, "score": 0, "creation_date": 1570198707, "post_id": 58237638, "comment_id": 102849072, "body": "@MonkeyZeus It might look worst question to you, but I tried to demystify anything that might confuse you. I am not good in regex. That is the reason I asked question. If you read carefully, you could understand as I stated with &quot; Any string after these two is optional if match&quot;. So it should match."}], "answers": [{"comments": [{"owner": {"reputation": 558, "user_id": 1988395, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bdb25eca099d7a254d2ea77818ee69d?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/1988395/coder"}, "edited": false, "score": 0, "creation_date": 1570197111, "post_id": 58237701, "comment_id": 102848307, "body": "Thanks for answer. Sorry for misleading question :( p1,p2,p3 are just examples. In my scenario it should match different strings e.g foo baz bar."}, {"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "reply_to_user": {"reputation": 558, "user_id": 1988395, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bdb25eca099d7a254d2ea77818ee69d?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/1988395/coder"}, "edited": false, "score": 0, "creation_date": 1570197162, "post_id": 58237701, "comment_id": 102848341, "body": "Why do you use the <code>p</code> in the question and in the your regex? In that case you have to list all the options instead of a character class but still use the alternation part to match either one of the left side and one of the right side, or vice versa."}, {"owner": {"reputation": 558, "user_id": 1988395, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bdb25eca099d7a254d2ea77818ee69d?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/1988395/coder"}, "edited": false, "score": 0, "creation_date": 1570197293, "post_id": 58237701, "comment_id": 102848404, "body": "I tried to simplify it. Since I am not expert in regex, I overlooked this possibility. I will update my question."}, {"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "reply_to_user": {"reputation": 558, "user_id": 1988395, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bdb25eca099d7a254d2ea77818ee69d?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/1988395/coder"}, "edited": false, "score": 0, "creation_date": 1570197627, "post_id": 58237701, "comment_id": 102848566, "body": "@coder Do you mean like this? <a href=\"https://regex101.com/r/NBgyZe/1\" rel=\"nofollow noreferrer\">regex101.com/r/NBgyZe/1</a>"}, {"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "reply_to_user": {"reputation": 558, "user_id": 1988395, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bdb25eca099d7a254d2ea77818ee69d?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/1988395/coder"}, "edited": false, "score": 0, "creation_date": 1570197918, "post_id": 58237701, "comment_id": 102848717, "body": "@coder Then you can make the whole part after it optional <a href=\"https://regex101.com/r/rlKk0m/1\" rel=\"nofollow noreferrer\">regex101.com/r/rlKk0m/1</a>"}, {"owner": {"reputation": 558, "user_id": 1988395, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bdb25eca099d7a254d2ea77818ee69d?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/1988395/coder"}, "edited": false, "score": 0, "creation_date": 1570198058, "post_id": 58237701, "comment_id": 102848780, "body": "Yep. That is correct :) Thanks. Accepted &amp; upvoted."}, {"owner": {"reputation": 558, "user_id": 1988395, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bdb25eca099d7a254d2ea77818ee69d?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/1988395/coder"}, "edited": false, "score": 1, "creation_date": 1570199118, "post_id": 58237701, "comment_id": 102849289, "body": "Thank you very much for explanation too :) Couldn&#39;t upvote twice :)"}], "tags": [], "owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "is_accepted": true, "score": 1, "last_activity_date": 1570198772, "last_edit_date": 1570198772, "creation_date": 1570196849, "answer_id": 58237701, "question_id": 58237638, "link": "https://stackoverflow.com/questions/58237638/match-regex-in-any-order-in-golang/58237701#58237701", "title": "Match regex in any order in Golang", "body": "<p>If you want to match both variants, you could use an or <code>|</code> to list each of the 2 variants.</p>\n\n<p>To make the second part optional you could use an optional non capturing group <code>(?:...)?</code></p>\n\n<p>An example without all the capturing groups:</p>\n\n<pre><code>^option\\s+[a-zA-Z0-9]+(?:\\s?(?:(?:foo|bar|baz)(?:\\s?test)?|test(?:\\s?(?:foo|bar|baz))?))?$\n</code></pre>\n\n<p>In parts it will look like</p>\n\n<ul>\n<li><code>^</code> Start of string</li>\n<li><code>option\\s+[a-zA-Z0-9]+</code> Match option, 1+ whitespace chars and a+ chars a-zA-Z or digits 0-9</li>\n<li><code>(?:</code> Non capturing group\n\n<ul>\n<li><code>\\s?</code> Match optional whitespace char</li>\n<li><code>(?:</code> Non capturing group\n\n<ul>\n<li><code>(?:foo|bar|baz)(?:\\s?test)?</code> Match for example for, bar etc and optional test</li>\n<li><code>|</code> Or </li>\n<li><code>test(?:\\s?(?:foo|bar|baz))?</code> Match test and optionally foo, bar etc</li>\n</ul></li>\n<li><code>)</code> Close non capturing group</li>\n</ul></li>\n<li><code>)?</code> Close non capturing group and make the whole part optional</li>\n<li><code>$</code> End of string</li>\n</ul>\n\n<p><a href=\"https://regex101.com/r/rlKk0m/1\" rel=\"nofollow noreferrer\">Regex demo</a></p>\n"}], "owner": {"reputation": 558, "user_id": 1988395, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bdb25eca099d7a254d2ea77818ee69d?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/1988395/coder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 58237701, "answer_count": 1, "score": 0, "last_activity_date": 1570200049, "creation_date": 1570196576, "last_edit_date": 1570200049, "question_id": 58237638, "link": "https://stackoverflow.com/questions/58237638/match-regex-in-any-order-in-golang", "title": "Match regex in any order in Golang", "body": "<p>I have something like this:</p>\n\n<pre><code>option name [p1|p2|p3] | [p4]\n</code></pre>\n\n<p>where <strong>option</strong> and <strong>name</strong> are mandatory. <strong>option</strong> must be exactly matched, while <strong>name</strong> is valid any ASCII character combination. Any string after these two is optional if match and it can appear in any order. So, it should match:</p>\n\n<pre><code>option name1 p1\noption name1 p1 p4\noption name1 p4 p1\n</code></pre>\n\n<p>My regex attempt:</p>\n\n<pre><code>^(option)\\s+(([a-zA-Z0-9]+))\\s?(((p1|p2|p3)?)\\s?((p4))?)\\s?$\n</code></pre>\n\n<p>This works if optional strings are provided in particular order e.g:</p>\n\n<pre><code>option name1 p1 p4\noption name1\noption name1 p1\noption name1 p4\n</code></pre>\n\n<p>but this one doesn't work:</p>\n\n<pre><code>option name1 p4 p1\n</code></pre>\n\n<p>Is there a way to write regex to support any order of these optional strings?</p>\n\n<p><strong>Edit</strong>:\np1,p2,p3,p4 are just for example. It could be any of exact strings provided e.g. foo, bar, baz.</p>\n\n<p><strong>More clarification:</strong></p>\n\n<p>name could be any string. In perfect scenario it should be different then foo, bar, baz and other options.</p>\n"}, {"tags": ["api", "go", "testing", "client", "session-cookies"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570193774, "post_id": 58236152, "comment_id": 102846546, "body": "AFAIK <code>Set-Cookie</code> is a response header, not a request header. (<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#The_Set-Cookie_and_Cookie_headers\" rel=\"nofollow noreferrer\">developer.mozilla.org/en-US/docs/Web/HTTP/&hellip;</a>) so the problem seems to be <code>req.Header.Add(&quot;Set-Cookie&quot;, Session)</code>. You should probably use <code>req.Header.Add(&quot;Cookie&quot;, Session)</code> instead."}, {"owner": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570198233, "post_id": 58236152, "comment_id": 102848868, "body": "@mkopriva that was it! Resolved, Now why can&#39;t i mark as solved?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1570199032, "post_id": 58236152, "comment_id": 102849243, "body": "Handling cookies correctly is complicated. You should definitely use a <a href=\"https://golang.org/pkg/net/http/#Client.Jar\" rel=\"nofollow noreferrer\">cookie jar</a>. You current test fails to notice if the server accidentally sends an invalid path, or domain, or expiration time, for instance."}], "owner": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 511, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1570191962, "creation_date": 1570190962, "last_edit_date": 1570191962, "question_id": 58236152, "link": "https://stackoverflow.com/questions/58236152/golang-client-api-test-session-tracking", "title": "Golang Client API Test Session Tracking", "body": "<p>I am making an automated API test suite. I want to simulate actual end-user calls and do not want to use <code>httptest.NewRecorder()</code>. Everything is working fine except for the session (not authenticated from server) even though the first test run was testing the authenticate endpoint that only continues with a successful login (basic/Bearer) and session.</p>\n\n<p>How do you track the session from one response to the next request? Included is full source as well as related output and server logs. </p>\n\n<p>Everything works fine in Postman, but if I export as Go code and run, I get the same issue. It must be something with tracking session.</p>\n\n<p>In the request setup I have:</p>\n\n<pre><code>req.Header.Add(\"Set-Cookie\", Session)\n</code></pre>\n\n<p>the Session is updated in the response:</p>\n\n<pre><code>cookie := res.Header.Get(\"Set-Cookie\")\nif len(cookie) &gt; 0 {\n   Session = cookie\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>=== RUN   TestAuthenticate\n\ngolang-api-&gt;TestAuthenticate: Testing endpoint /authenticate...\ngolang-api-&gt;TestAuthenticate: &gt; No Authorization provided in header...\n\ngolang-api-&gt;TestAuthenticate: &gt; Basic missing and bearer present in header...\n\ngolang-api-&gt;TestAuthenticate: &gt; Bearer missing and basic present in header...\n\ngolang-api-&gt;TestAuthenticate: &gt; Invalid Authorization Header (Bad Basic)...\n\ngolang-api-&gt;TestAuthenticate: &gt; Invalid Authorization Header (Bad Bearer)...\n\ngolang-api-&gt;TestAuthenticate: &gt; Invalid Authorization Header (Bad Basic &amp; Bearer)...\n\ngolang-api-&gt;TestAuthenticate: &gt; Valid Authorization Header (Good Basic &amp; Bearer)...\n\ngolang-api-&gt;TestAuthenticate: SUCCESS Ok\n--- PASS: TestAuthenticate (0.03s)\n=== RUN   TestBonus\n\ngolang-api-&gt;TestBonus: Testing endpoint /bonus...\ngolang-api-&gt;TestBonus: &gt; No Basic Authorization provided in header...\n\ngolang-api-&gt;TestBonus: &gt; Invalid Basic Authorization Header (Bad Basic)...\n\ngolang-api-&gt;TestBonus: &gt; Valid Basic Authorization Header (Good Basic)...\n\ngolang-api-&gt;TestBonus: ERROR Expected Status Code 200 got 401 instead\nExiting on GET request http://10.11.2.148:8080/bonus ...\n\nREQUEST: &amp;{Method:GET URL:http://10.11.2.148:8080/bonus Proto:HTTP/1.1 ProtoMajor:1 ProtoMinor:1 Header:map[User-Agent:[GoLang API Test/0.1.0] Cache-Control:[no-cache] Authorization:[Basic YXNoaXNoOmEyNkIpbl5BPyU2V2YhQXNKdw==]] Body:&lt;nil&gt; GetBody:&lt;nil&gt; ContentLength:0 TransferEncoding:[] Close:false Host:10.11.2.148:8080 Form:map[] PostForm:map[] MultipartForm:&lt;nil&gt; Trailer:map[] RemoteAddr: RequestURI: TLS:&lt;nil&gt; Cancel:&lt;nil&gt; Response:&lt;nil&gt; ctx:&lt;nil&gt;}\n\nRESPONSE: &amp;{Status:401 Unauthorized StatusCode:401 Proto:HTTP/1.1 ProtoMajor:1 ProtoMinor:1 Header:map[X-Xss-Protection:[1; mode=block] Referrer-Policy:[same-origin] Set-Cookie:[session=x4XJfYZsDpSqf_cWigHS3yuT5hqlEntU_WNfJW3j-661sGalr-NcvF6Ey1R340jmvjw8x6O1vie2ctHCW0C0hCjekfDESa3dxIKWt__7FSeidYg1VN-aaTljYeKHfQzuCPvjVak; Path=/; HttpOnly] Strict-Transport-Security:[max-age=31536000; includeSubDomains] X-Content-Type-Options:[nosniff] Content-Type:[application/json; charset=UTF-8] X-Frame-Options:[deny] Date:[Fri, 04 Oct 2019 11:29:01 GMT] Content-Length:[71]] Body:0xc000055100 ContentLength:71 TransferEncoding:[] Close:false Uncompressed:false Trailer:map[] Request:0xc0000e6c00 TLS:&lt;nil&gt;}\n\nFAIL    command-line-arguments  0.038s\n</code></pre>\n\n<p><strong>Server Logs</strong></p>\n\n<pre><code>2019/10/04 12:01:54  INFO: Handlers.HandleError(): Sent-&gt; {\"message\":\"Error: Invalid authorization, none provided\",\"status\":\"Bad Request\"}\n2019/10/04 12:01:54  INFO: Handlers.HandleError(): Sent-&gt; {\"message\":\"Error: Invalid authorization, 1 provided, requires 2\",\"status\":\"Bad Request\"}\n2019/10/04 12:01:54  INFO: Handlers.HandleError(): Sent-&gt; {\"message\":\"Error: Invalid authorization, 1 provided, requires 2\",\"status\":\"Bad Request\"}\n2019/10/04 12:01:54  INFO: Handlers.HandleError(): Sent-&gt; {\"message\":\"Error: Issue decoding API Key: illegal base64 data at input byte 7\",\"status\":\"Bad Request\"}\n2019/10/04 12:01:54  INFO: Handlers.HandleError(): Sent-&gt; {\"message\":\"Error: Invalid JWT timestamp: Expired\",\"status\":\"Bad Request\"}\n2019/10/04 12:01:54  INFO: Handlers.HandleError(): Sent-&gt; {\"message\":\"Error: Issue decoding API Key: illegal base64 data at input byte 7\",\"status\":\"Bad Request\"}\n2019/10/04 12:01:54 NOTIC: Auth   [4537722] via Redis cached value\n2019/10/04 12:01:54  INFO: Handlers.HandleError(): Sent-&gt; {\"message\":\"Error: Invalid authorization, none provided\",\"status\":\"Forbidden\"}\n2019/10/04 12:01:54  INFO: Handlers.HandleError(): Sent-&gt; {\"message\":\"Error: Issue decoding API Key: illegal base64 data at input byte 7\",\"status\":\"Forbidden\"}\n2019/10/04 12:01:54  INFO: Handlers.HandleError(): Sent-&gt; {\"message\":\"Error: Session not authenticated\",\"status\":\"Unauthorized\"}\n</code></pre>\n\n<p><strong>Full Source</strong>\nProvided to show what I am attempting in it's entirety. However it will obviously not work from your machine as the server is private.</p>\n\n<pre><code>package api\n\n\nimport (\n    \"time\"\n    \"os\"\n    \"fmt\"\n    \"net/http\"\n    \"testing\"\n)\n\n// TODO: Create config loaded from yaml that allows external settings without recompile\n// Make sure to update constants for your environment\nconst (\n    UseHost             = \"http://10.11.2.148:8080\"\n    ValidBasic          = \"cWFfVGVzdDplaih4cVE+JyZzNS9QdThu\"\n    InvalidBasic        = \"INVALID_BASIC\"\n    ValidBearer         = \"eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.X3Jca1o8Db3AdypEu_yYCiOXmy00wgOxHS-3i2cC519UUupBKvYEx1V9x1OysrVWAmJSe7v0fs3iikq6L0Ky6zD6G75B4zmYqAbROFVCuwEKUWgVaykpJI-8u6NKkjGs5qNNxzAiHDQECv7AUUPhOuEeGpxq7y4OSMTDt4ZEYxml_5rNN-g057ViKZiBw9Q0J7FNKqWDf8XK852jcZi8VMM8dHaIv0pBP9M28lP6TaMmEqZRzIJbs2V4YxcMO5KkZhNySNeafycVAZyatiZKYyB0M7_qLSC7A1UEbK1U17n7u2FdE1JCdqKdxONvSFNzInJYwWcY9EU2qsACkRTULQ.pej62Nk9Ra_xVl5P.ZYzrJqx93_GSHgpznT2ZNq9lRWeIPd6r1bEnww0sXczsA84bYMrwLeN_Zb0nl2vvRFem32qUcWfkADVTvYl_3YgQ372darr7TW6geUEG8kQ72LcJ356iHRQ.KFzdokMLDhUlc8xkQ24uYQ\"\n    InvalidBearer       = \"eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.ckkQI8TMs7kawGrI6ZA18zVk7NizpwF11aiU015lz2NM6s7gcN0OE0g2td5__TUIIjduHHKt8jCLaeyV0G_j_ai3-GMRLBEiMFizOUZqTUcPpwv0B-DQZ22B-exd-URtZL5RyxxT8FXoLnn7gMEXhURnj06Z0HbSuVIlryzQDwsfFsStw0CpxA1ZCEV3kC54xQetvBiptqJ1IDZaUh0fbAjFDURl9Q5tngyKvG8k6NZE8fpR3hbAukhuAU5cLP8P8DPeHY4wgSXN-xBJIG4vh2EAElHFDcBem_Hf6StkjPltMzUe1qbrLJOpmDNTgHqysCF7xvnJjkuYphGZa_W77g.WZvcU-KICyHg_OFu.LqQc7szbYzP8W3hsSRKWhJsKwFY_Vk38gO2y_-M_HdhgVATYzokKPladyEnOq5fuTegkd69TNwCb8ltC08n_gRLIwqdwgeJDIylWB4Lj_eTW.IJH0URIMFTnrSevMjxgt5Q\"\n)\n\ntype AuthorizationTest int\nconst (\n    AuthorizationTestNone AuthorizationTest = 1 + iota      // No Authorization in header\n    AuthorizationTestNoBasic                                // No Basic in Authorization\n    AuthorizationTestNoBearer                               // No Bearer in Authorization\n    AuthorizationTestInvalidBasic                           // Invalid Basic in Authorization\n    AuthorizationTestInvalidBearer                          // Invalid Bearer in Authorization\n    AuthorizationTestInvalidBasicBearer                     // Invalid Basic &amp; Bearer in Authorization\n    AuthorizationTestValid                                  // valid Basic &amp; Bearer in Authorization\n    AuthorizationTestBasicNone                              // Just Basic, none provided\n    AuthorizationTestBasicInvalid                           // Just Basic, Invalid Provided\n    AuthorizationTestBasicValid                             // Just Basic, Valid Provided\n)\n\ntype LogType int\nconst (\n    LogTypeEndpoint LogType = 1 + iota\n    LogTypeSubEvent\n    LogTypeError\n    LogTypeSuccess\n)\n\nvar (\n    Session string\n)\n\nfunc Log(lt LogType, who string, what string) {\n    if lt == LogTypeEndpoint {\n        fmt.Printf(\"\\n%s: Testing endpoint /%s...\", who, what)\n    } else if lt == LogTypeSubEvent {\n        fmt.Printf(\"\\n%s: &gt; %s...\", who, what)\n    } else if lt == LogTypeError {\n        fmt.Printf(\"\\n%s: ERROR %s\\n\", who, what)\n    } else if lt == LogTypeSuccess {\n        fmt.Printf(\"\\n%s: SUCCESS %s\\n\", who, what)\n    } else {\n        panic(\"Unknown Log Type\")\n    }\n}\n\nfunc addCookie(w http.ResponseWriter, name string, value string) {\n    expire := time.Now().AddDate(0, 0, 1)\n    cookie := http.Cookie{\n        Name:    name,\n        Value:   value,\n        Expires: expire,\n    }\n    http.SetCookie(w, &amp;cookie)\n}\n\nfunc doRequest(test, method string, url string, desiredStatus int, at AuthorizationTest) *http.Response {\n    req, _ := http.NewRequest(method, url, nil)\n    req.Header.Add(\"User-Agent\", \"GoLang API Test/0.1.0\")\n    req.Header.Add(\"Cache-Control\", \"no-cache\")\n    if len(Session) &gt; 0 {\n        //cookie, _ := req.Cookie(\"session\")\n        req.Header.Add(\"Set-Cookie\", Session)\n    }\n    //req.Header.Add(\"Accept\", \"*/*\")\n    //req.Header.Add(\"Host\", UseHost)\n    //req.Header.Add(\"Accept-Encoding\", \"gzip, deflate\")\n    //req.Header.Add(\"Connection\", \"keep-alive\")\n\n    switch at {\n    // Basic &amp; Bearer\n    case AuthorizationTestNone:\n        break\n    case AuthorizationTestNoBasic:\n        req.Header.Add(\"Authorization\", fmt.Sprintf(\"Bearer %s\", ValidBearer))  \n    case AuthorizationTestNoBearer:\n        req.Header.Add(\"Authorization\", fmt.Sprintf(\"Basic %s\", ValidBasic))    \n    case AuthorizationTestInvalidBasic:\n        req.Header.Add(\"Authorization\", fmt.Sprintf(\"Basic %s; Bearer %s\", InvalidBasic, ValidBearer))  \n    case AuthorizationTestInvalidBearer:\n        req.Header.Add(\"Authorization\", fmt.Sprintf(\"Basic %s; Bearer %s\", ValidBasic, InvalidBearer))  \n    case AuthorizationTestInvalidBasicBearer:\n        req.Header.Add(\"Authorization\", fmt.Sprintf(\"Basic %s; Bearer %s\", InvalidBasic, InvalidBearer))    \n    case AuthorizationTestValid:\n        req.Header.Add(\"Authorization\", fmt.Sprintf(\"Basic %s; Bearer %s\", ValidBasic, ValidBearer))\n    // Just Basic\n    case AuthorizationTestBasicNone:\n        break\n    case AuthorizationTestBasicInvalid:\n        req.Header.Add(\"Authorization\", fmt.Sprintf(\"Basic %s\", InvalidBasic))\n    case AuthorizationTestBasicValid:\n        req.Header.Add(\"Authorization\", \"Basic YXNoaXNoOmEyNkIpbl5BPyU2V2YhQXNKdw==\")   \n    }   \n\n    res, err := http.DefaultClient.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    defer res.Body.Close()\n\n    // Did we just try to authenticate?\n    //if at == AuthorizationTestValid {\n        // Was it successful?\n        //if res.StatusCode == http.StatusOK {\n            //Kewl, Save the Session for remaining tests\n            //cookie := res.Header.Get(\"Set-Cookie\")\n            cookie, err := req.Cookie(\"session\")\n            if err != nil {\n                //cookie, err := req.Cookie(\"session\")\n                Session = cookie.String()\n                //req.Header.Add(\"Set-Cookie\", cookie.String())\n                //addCookie(res.Write,\"session\",cookie)\n                //session=IOY2A55EKzTrqS1YLjWSq-axdDQAGLqLN5EyHdY5hd4sUTrVIPps3P1EhSP3pyFDFgIyW-EhpqzZeyVGsR_JyueVitAX6MWhpBFQiW2N8KDhedv2LviS_dhM0KGoMtTlRfYlQo-3cySIvA5oPOS_BSEuT2HmjlNCr2DzxDGX1Ig; Path=/; HttpOnly\n                //Session = cookie\n                fmt.Println(Session)\n            }\n        //} \n    //}\n\n    if res.StatusCode != desiredStatus {\n        Log(LogTypeError,test,fmt.Sprintf(\"Expected Status Code %d got %d instead\",desiredStatus,res.StatusCode))\n        fmt.Printf(\"Exiting on %s request %s ...\\n\", method, url)\n        fmt.Printf(\"\\nREQUEST: %+v\\n\",req)\n        fmt.Printf(\"\\nRESPONSE: %+v\\n\\n\",res)\n        os.Exit(1)\n    }   \n\n    return res\n}\n\nfunc doRequestAuthorization(caller string, method string, endpoint string) {\n\n    url := fmt.Sprintf(\"%s/%s\", UseHost, endpoint)\n    if endpoint == \"authenticate\" {\n        // User Basic &amp; Bearer for Authorization\n        Log(LogTypeSubEvent,caller,\"No Authorization provided in header\")\n        _ = doRequest(caller, method, url, http.StatusBadRequest, AuthorizationTestNone)\n\n        Log(LogTypeSubEvent,caller,\"Basic missing and bearer present in header\")\n        _ = doRequest(caller, method, url, http.StatusBadRequest, AuthorizationTestNoBasic)\n\n        Log(LogTypeSubEvent,caller,\"Bearer missing and basic present in header\")\n        _ = doRequest(caller, method, url, http.StatusBadRequest, AuthorizationTestNoBearer)\n\n        Log(LogTypeSubEvent,caller,\"Invalid Authorization Header (Bad Basic)\")\n        _ = doRequest(caller, method, url, http.StatusBadRequest, AuthorizationTestInvalidBasic)\n\n        Log(LogTypeSubEvent,caller,\"Invalid Authorization Header (Bad Bearer)\")\n        _ = doRequest(caller, method, url, http.StatusBadRequest, AuthorizationTestInvalidBearer)\n\n        Log(LogTypeSubEvent,caller,\"Invalid Authorization Header (Bad Basic &amp; Bearer)\")\n        _ = doRequest(caller, method, url, http.StatusBadRequest, AuthorizationTestInvalidBasicBearer)\n\n        Log(LogTypeSubEvent,caller,\"Valid Authorization Header (Good Basic &amp; Bearer)\")\n        _ = doRequest(caller, method, url, http.StatusOK, AuthorizationTestValid)\n    } else {\n        // Use Basic only for Authorization\n        Log(LogTypeSubEvent,caller,\"No Basic Authorization provided in header\")\n        _ = doRequest(caller, method, url, http.StatusForbidden, AuthorizationTestBasicNone)\n\n        Log(LogTypeSubEvent,caller,\"Invalid Basic Authorization Header (Bad Basic)\")\n        _ = doRequest(caller, method, url, http.StatusForbidden, AuthorizationTestBasicInvalid)\n\n        Log(LogTypeSubEvent,caller,\"Valid Basic Authorization Header (Good Basic)\")\n        _ = doRequest(caller, method, url, http.StatusOK, AuthorizationTestBasicValid)\n    }\n}\n\n// doRequestNoParameters tests endpoints that do not accept any parameters\nfunc doRequestNoParameters(caller string, method string, endpoint string) *http.Response {\n    Log(LogTypeSubEvent, caller, \"No query parameters specified\")\n    url := fmt.Sprintf(\"%s/%s?foo=bar\", UseHost, endpoint)\n    return doRequest(caller, method, url, http.StatusBadRequest, AuthorizationTestInvalidBasicBearer)\n}\nfunc TestAuthenticate(t *testing.T) {\n    caller := fmt.Sprintf(\"%s-&gt;%s\", os.Getenv(\"REPOSITORY\"), t.Name())\n    Log(LogTypeEndpoint, caller, \"authenticate\")\n    doRequestAuthorization(caller, \"POST\", \"authenticate\")\n    Log(LogTypeSuccess, caller, \"Ok\")\n}\n\n// Test \"GET\", \"/bonus\"\nfunc TestBonus(t *testing.T) {\n    endpoint := \"bonus\"\n    caller := fmt.Sprintf(\"%s-&gt;%s\", os.Getenv(\"REPOSITORY\"), t.Name())\n\n    Log(LogTypeEndpoint, caller, endpoint)\n    doRequestAuthorization(caller, \"GET\", endpoint)\n    Log(LogTypeSubEvent,caller,\"Valid Query\")\n    url := fmt.Sprintf(\"%s/%s\", UseHost, endpoint)\n    _ = doRequest(caller, \"GET\", url, http.StatusOK, AuthorizationTestBasicValid)\n}\n\n// TODO: Test \"GET\", \"/category\"\nfunc TestCategory(t *testing.T) {\n    endpoint := \"category\"\n    caller := fmt.Sprintf(\"%s-&gt;%s\", os.Getenv(\"REPOSITORY\"), t.Name())\n\n    Log(LogTypeEndpoint, caller, endpoint)\n    doRequestAuthorization(caller, \"GET\", endpoint)\n    Log(LogTypeSubEvent,caller,\"Valid Query\")\n    url := fmt.Sprintf(\"%s/%s\", UseHost, endpoint)\n    _ = doRequest(caller, \"GET\", url, http.StatusOK, AuthorizationTestBasicValid)\n}\n</code></pre>\n"}, {"tags": ["go", "google-cloud-platform", "google-kubernetes-engine", "google-cloud-pubsub", "horizontal-scaling"], "comments": [{"owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "edited": false, "score": 0, "creation_date": 1570202800, "post_id": 58234853, "comment_id": 102851120, "body": "How many pods are sitting? in average?"}, {"owner": {"reputation": 121, "user_id": 10907445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e37ae7842168f820d588d3784f8a23f5?s=128&d=identicon&r=PG&f=1", "display_name": "mdtp", "link": "https://stackoverflow.com/users/10907445/mdtp"}, "reply_to_user": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "edited": false, "score": 0, "creation_date": 1570226432, "post_id": 58234853, "comment_id": 102859310, "body": "Most of the time 8 out of 10 are sitting. In the worst case, only one pod is running, rest are waiting. When I kill the one which is consuming messages, the others start to consume messages."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570694992, "post_id": 58234853, "comment_id": 102996136, "body": "Is it possible that all your clients have the same subscription ID? Please add an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> to your question by <a href=\"https://stackoverflow.com/posts/58234853/edit\">editing it</a>."}, {"owner": {"reputation": 1370, "user_id": 1337514, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/5a8ab8859ee93127eac1fc785a1f078d?s=128&d=identicon&r=PG", "display_name": "code muncher", "link": "https://stackoverflow.com/users/1337514/code-muncher"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1593715151, "post_id": 58234853, "comment_id": 110884715, "body": "@mdtp did you find the answer? @Markus I have created one subscription on GCP. My service is subscribing to that subscription and calling <code>recieve</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1370, "user_id": 1337514, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/5a8ab8859ee93127eac1fc785a1f078d?s=128&d=identicon&r=PG", "display_name": "code muncher", "link": "https://stackoverflow.com/users/1337514/code-muncher"}, "edited": false, "score": 0, "creation_date": 1593715234, "post_id": 58248249, "comment_id": 110884756, "body": "```\t// If the value is negative, then there will be no limit on the number of \t// unprocessed messages.```"}, {"owner": {"reputation": 1370, "user_id": 1337514, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/5a8ab8859ee93127eac1fc785a1f078d?s=128&d=identicon&r=PG", "display_name": "code muncher", "link": "https://stackoverflow.com/users/1337514/code-muncher"}, "edited": false, "score": 0, "creation_date": 1593715290, "post_id": 58248249, "comment_id": 110884776, "body": "I am facing same exact problem. It is one subcription that my service is using and pulling sync. So GCP should distribute messages but I see all of them going to mostly one pod."}], "tags": [], "owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "is_accepted": false, "score": 0, "last_activity_date": 1570278270, "creation_date": 1570278270, "answer_id": 58248249, "question_id": 58234853, "link": "https://stackoverflow.com/questions/58234853/horizontally-autoscaled-kubernetes-pods-not-pulling-messages-from-google-cloud-p/58248249#58248249", "title": "Horizontally Autoscaled Kubernetes pods not pulling messages from Google Cloud Pub/Sub subscription", "body": "<p>Can you try to set this:</p>\n\n<pre><code>    sub.ReceiveSettings.NumGoroutines = 10 * runtime.NumCPU()\n    sub.ReceiveSettings.MaxOutstandingMessages = -1\n    sub.ReceiveSettings.MaxOutstandingBytes = -1\n</code></pre>\n\n<p>Maybe by removing some limit, it could be better?</p>\n\n<p>let me know</p>\n"}], "owner": {"reputation": 121, "user_id": 10907445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e37ae7842168f820d588d3784f8a23f5?s=128&d=identicon&r=PG&f=1", "display_name": "mdtp", "link": "https://stackoverflow.com/users/10907445/mdtp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 188, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1570278270, "creation_date": 1570185829, "last_edit_date": 1570188195, "question_id": 58234853, "link": "https://stackoverflow.com/questions/58234853/horizontally-autoscaled-kubernetes-pods-not-pulling-messages-from-google-cloud-p", "title": "Horizontally Autoscaled Kubernetes pods not pulling messages from Google Cloud Pub/Sub subscription", "body": "<p>Our application is running on <code>Google Kubernetes Engine</code> and pulling messages from a <code>Google Cloud Pub/Sub</code> Subscription. We have one pod running in idle state, and horizontal pod autoscaling is set up to 10 pods depending on cpu usage. The subscription is mostly empty, and when a batch job kicks in, it writes into to Pub/Sub topic. The autoscaling is working well. It immediately (within 30 seconds) scales up to 10 pods once there are outstanding messages in the Pub/Sub subscription. But the issue is only a few pods are pulling the messages from the subscription and rest of them are just sitting even though there are still messages in the subscription.</p>\n\n<p>Pub/Sub Client settings are:</p>\n\n<pre><code>MaxExtension: 600\nMaxOutstandingMessages: 100 (also tried with 25)\nSynchronous: true (also tried with false)\n</code></pre>\n\n<p>Google Cloud Pub/Sub Subscription Settings:</p>\n\n<pre><code>Pull-based\nAck Deadline is 600 seconds\n</code></pre>\n\n<p>And once the batch job kicks in, it writes 20k messages into the Pub/Sub topic. And the application can process 2 messages/sec in average.</p>\n\n<p>The application is written in <code>golang</code> and we're using <code>cloud.google.com/go v0.44.1</code> package version.</p>\n\n<p>Do you know why the pods are sitting and not pulling messages even though there's a backlog in the Cloud Pub/Sub subscription?</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1570637145, "post_id": 58234339, "comment_id": 102977946, "body": "Something kinda-off topic, Gorm is kinda outdated... It doesn&#39;t support the Context API which is very useful. Unless u have the project built with Gorm, try moving to something new and good like Facebook&#39;s Ent. <a href=\"https://entgo.io/\" rel=\"nofollow noreferrer\">entgo.io</a>"}, {"owner": {"reputation": 732, "user_id": 1442435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/01c2824c79133dd9014ed6c5652ebfe4?s=128&d=identicon&r=PG", "display_name": "eclaude", "link": "https://stackoverflow.com/users/1442435/eclaude"}, "reply_to_user": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1570798617, "post_id": 58234339, "comment_id": 103038607, "body": "@Seaskyways gorm outdated ?"}], "answers": [{"tags": [], "owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "is_accepted": false, "score": 1, "last_activity_date": 1570812919, "creation_date": 1570812919, "answer_id": 58345571, "question_id": 58234339, "link": "https://stackoverflow.com/questions/58234339/access-to-many2many-table-data/58345571#58345571", "title": "Access to many2many table data", "body": "<p>You have the following problems: </p>\n\n<ul>\n<li>You missed adding <code>AutoMigrate</code> for <code>DocumentsFolders</code>.</li>\n<li>Don't use slices with pointers.</li>\n</ul>\n\n<p>Check the below fixed example for more reference:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n    \"math/rand\"\n    \"time\"\n)\n\ntype UUID = string\n\ntype Model struct {\n    ID        UUID       `gorm:\"type:char(36);primary_key;\" json:\"id\"`\n    CreatedAt time.Time  `json:\"created_at\"`\n    UpdatedAt time.Time  `json:\"update_at\"`\n    DeletedAt *time.Time `sql:\"index\" json:\"deleted_at\"`\n}\n\ntype Folder struct {\n    Model\n    Name      string     `json:\"name\" form:\"name\" gorm:\"name;\"`\n    Documents []Document `json:\"documents\" gorm:\"many2many:documents_folders;\"`\n}\n\ntype Document struct {\n    Model\n    Name    string   `json:\"name\" form:\"name\" gorm:\"name;\"`\n    Folders []Folder `json:\"folders\" gorm:\"many2many:documents_folders;\"`\n}\n\ntype DocumentsFolders struct {\n    DocumentID string    `json:\"document_id\" sql:\"type:char(36) REFERENCES documents(id)\"`\n    Document   *Document `json:\"document\"`\n    FolderID   string    `json:\"folder_id\" sql:\"type:char(36) REFERENCES folders(id)\"`\n    Folder     *Folder   `json:\"folder\"`\n    State      string    `json:\"state\" form:\"state\" gorm:\"state;\"`\n}\n\nvar i = rand.Int()\n\nfunc genId() string {\n    id := i\n    i++\n    return fmt.Sprintf(\"%036d\", id)\n}\n\nfunc main() {\n    db, _ := gorm.Open(\"sqlite3\", \"./db.sqlite\")\n    db.AutoMigrate(&amp;Document{}, &amp;Folder{}, &amp;DocumentsFolders{})\n\n    folder1 := &amp;Folder{\n        Model:     Model{ID: genId()},\n        Name:      \"myFolder\",\n        Documents: nil,\n    }\n    db.FirstOrCreate(&amp;folder1, folder1.ID)\n\n    doc1 := &amp;Document{\n        Model:   Model{ID: genId()},\n        Name:    \"doc1\",\n    }\n    db.FirstOrCreate(doc1, doc1.ID)\n\n    doc2 := &amp;Document{\n        Model:   Model{ID: genId()},\n        Name:    \"doc2\",\n    }\n    db.FirstOrCreate(doc2, doc2.ID)\n\n    // join them\n    db.Create(&amp;DocumentsFolders{\n        DocumentID: doc1.ID,\n        FolderID:   folder1.ID,\n        State:      \"happy!\",\n    })\n    db.Create(&amp;DocumentsFolders{\n        DocumentID: doc2.ID,\n        FolderID:   folder1.ID,\n        State:      \"happy!\",\n    })\n\n    // get the new folder to check\n    db.Preload(\"Documents\").First(folder1, folder1.ID)\n\n    // two documents are printed\n    fmt.Printf(\"Documents count: %d\\n\", len(folder1.Documents)) // prints 2\n}\n</code></pre>\n"}], "owner": {"reputation": 732, "user_id": 1442435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/01c2824c79133dd9014ed6c5652ebfe4?s=128&d=identicon&r=PG", "display_name": "eclaude", "link": "https://stackoverflow.com/users/1442435/eclaude"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1570812919, "creation_date": 1570183929, "last_edit_date": 1570340761, "question_id": 58234339, "link": "https://stackoverflow.com/questions/58234339/access-to-many2many-table-data", "title": "Access to many2many table data", "body": "<p>I want to work on a table <code>many2many</code> generated automatically by GORM <code>db.AutoMigrate(&amp;Document{}, &amp;Folder{})</code>.</p>\n\n<p>In this scenario, a folder has documents and documents have folders, so far it's good, but the association has a status (valid, invalid ...) so I have to look at the <code>documents_folders</code> table to know the state.</p>\n\n<h2>Database:</h2>\n\n<pre><code>+-----------------------+\n| Table                 |\n+-----------------------+\n| documents             |\n| documents_folders     |\n| folders               |\n+-----------------------+\n</code></pre>\n\n<h2>Models :</h2>\n\n<h3>Stuff</h3>\n\n<p><em>(ID primary_key == UUID)</em></p>\n\n<pre><code>type Stuff struct {\n    ID          uuid.UUID  `gorm:\"type:char(36);primary_key;\" json:\"id\"`\n    CreatedAt   time.Time  `json:\"created_at\"`\n    UpdatedAt   time.Time  `json:\"update_at\"`\n    DeletedAt   *time.Time `sql:\"index\" json:\"deleted_at\"`\n}\n</code></pre>\n\n<h3>Folder</h3>\n\n<pre><code>type Folder struct {\n    Stuff\n    Name      string      `json:\"name\" form:\"name\" gorm:\"name;\"`\n    Documents []*Document `json:\"documents\" gorm:\"many2many:documents_folders;\"`\n}\n</code></pre>\n\n<h3>Document</h3>\n\n<pre><code>type Document struct {\n    Stuff\n    Name        string    `json:\"name\" form:\"name\" gorm:\"name;\"`\n    Folders     []*Folder `json:\"folders\" gorm:\"many2many:documents_folders;\"`\n}\n</code></pre>\n\n<h3>DocumentsFolders</h3>\n\n<p><em>I created this model to access the table, it is generated automatically but I have to add the column State</em></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type DocumentsFolders struct {\n    DocumentID string    `json:\"document_id\" sql:\"type:char(36) REFERENCES documents(id)\"`\n    Document   *Document `json:\"document\"`\n    FolderID   string    `json:\"folder_id\" sql:\"type:char(36) REFERENCES folders(id)\"`\n    Folder     *Folder   `json:\"folder\"`\n    State      string    `json:\"state\" form:\"state\" gorm:\"state;\"`\n}\n</code></pre>\n\n<p>I can not access it when I preload the <code>document</code> and <code>folder</code> like :</p>\n\n<pre><code>folder := Folder{}\ndb.Preload(\"Documents\").Where(\"id = ?\", \"myUUID\").First(&amp;folder)\n</code></pre>\n\n<p>I would like to see the State of the document association.</p>\n\n<p>Thanks for your help</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11896097"}, "edited": false, "score": 0, "creation_date": 1570167582, "post_id": 58229907, "comment_id": 102835123, "body": "when I run <code>go env</code> it says <code>GOPATH=&quot;&#47;Users&#47;username&#47;go&quot;</code> so I guess GOPATH is set already"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1570169119, "post_id": 58229907, "comment_id": 102835542, "body": "@camila OK, but is <code>&#47;Users&#47;username&#47;go&#47;bin</code> path of your <code>$PATH</code>? What does <code>echo $PATH</code> returns?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11896097"}, "edited": false, "score": 0, "creation_date": 1570171571, "post_id": 58229907, "comment_id": 102836414, "body": "<code>echo $PATH</code> returns <code>:&#47;usr&#47;local&#47;go&#47;bin</code>"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1570171808, "post_id": 58229907, "comment_id": 102836508, "body": "@camila Do you see <code>protoc-gen-go</code> in <code>&#47;usr&#47;local&#47;go&#47;bin</code>?  Do you see <code>protoc-gen-go</code> in <code>&#47;Users&#47;username&#47;go&#47;bin</code>? Could you <a href=\"https://apple.stackexchange.com/a/119126\">add $GOPATH/bin, that is <code>&#47;Users&#47;username&#47;go&#47;bin</code>, to your PATH</a>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11896097"}, "edited": false, "score": 0, "creation_date": 1570173370, "post_id": 58229907, "comment_id": 102837132, "body": "yes, <code>echo $PATH</code> also has <code>:&#47;Users&#47;username&#47;go&#47;bin&#47;protoc-gen-go</code> too"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1570173749, "post_id": 58229907, "comment_id": 102837280, "body": "@camila No: I meant: add <code>&#47;Users&#47;username&#47;go&#47;bin</code>, <i>not</i> <code>&#47;Users&#47;username&#47;go&#47;bin&#47;protoc-gen-go</code>: you need to add the <i>path</i> to the executable, <i>not</i> the executable itself."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 0, "last_activity_date": 1570173843, "last_edit_date": 1570173843, "creation_date": 1570163305, "answer_id": 58229907, "question_id": 58229740, "link": "https://stackoverflow.com/questions/58229740/when-compile-protocol-buffer-missing-input-or-program-is-not-executable-error/58229907#58229907", "title": "when compile protocol buffer, missing input or program is not executable error", "body": "<p>This was mentioned in <a href=\"https://github.com/golang/protobuf/issues/795\" rel=\"nofollow noreferrer\"><code>golang/protobuf</code> issue 795</a></p>\n\n<blockquote>\n  <p>See the <a href=\"https://github.com/golang/protobuf#installation\" rel=\"nofollow noreferrer\"><code>Installation</code> section of the page <code>README</code></a>: </p>\n  \n  <p>Grab the code from the repository and install the proto package.<br>\n  The simplest way is to run <code>go get -u github.com/golang/protobuf/protoc-gen-go</code>. </p>\n  \n  <p>The compiler plugin, <code>protoc-gen-go</code>, will be installed in <code>$GOPATH/bin</code> unless <code>$GOBIN</code> is set. It must be in your <code>$PATH</code> for the protocol compiler, <code>protoc</code>, to find it.</p>\n</blockquote>\n\n<p>So double-check the value of your <code>$GOPATH</code> (<code>~/go</code> by default if not set)</p>\n\n<p>If <code>$GOPATH/bin</code> (or <code>~/go/bin</code>) in your <code>$PATH</code>?</p>\n\n<p>The <a href=\"https://stackoverflow.com/users/11896097/camila\">OP camilla</a> confirms it is not: </p>\n\n<blockquote>\n  <p><code>$PATH</code> also has <code>:/Users/username/go/bin/protoc-gen-go</code></p>\n</blockquote>\n\n<p>It should have <code>:/Users/username/go/bin</code></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11896097"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 798, "favorite_count": 1, "accepted_answer_id": 58229907, "answer_count": 1, "score": 1, "last_activity_date": 1570173843, "creation_date": 1570161648, "last_edit_date": 1570166798, "question_id": 58229740, "link": "https://stackoverflow.com/questions/58229740/when-compile-protocol-buffer-missing-input-or-program-is-not-executable-error", "title": "when compile protocol buffer, missing input or program is not executable error", "body": "<p>I'm trying to make golang+grpc server on mac. I installed golang, grpc, protocol buffer and checked that grpc server following this example <a href=\"https://grpc.io/docs/quickstart/go/\" rel=\"nofollow noreferrer\">https://grpc.io/docs/quickstart/go/</a> \nThe problem is when I try to compile .proto file using protocol buffer it said 'missing input' or 'program is not executable'. </p>\n\n<p>install protocol buffer and grpc</p>\n\n<pre><code>brew install grpc protobuf\n</code></pre>\n\n<p>install golang based protoc plugin  </p>\n\n<pre><code>go get github.com/golang/protobuf/protoc-gen-go\n</code></pre>\n\n<p>protoc path</p>\n\n<pre><code>which protoc\n/usr/local/bin/protoc\n</code></pre>\n\n<p>example location</p>\n\n<pre><code>/Users/usrname/go/src/google.golang.org/grpc/examples/helloworld\n</code></pre>\n\n<p>run proto compiler</p>\n\n<pre><code>protoc -I=/Users/username/go/src/google.golang.org/grpc/examples/helloworld/helloworld/ --go_out=/Users/username/go/src/google.golang.org/grpc/examples/helloworld/helloworld/ /Users/username/go/src/google.golang.org/grpc/examples/helloworld/helloworld/helloworld.proto\n</code></pre>\n\n<p>error message</p>\n\n<pre><code>protoc-gen-go: program not found or is not executable\nPlease specify a program using absolute path or make sure the program is available in your PATH system variable\n--go_out: protoc-gen-go: Plugin failed with status code 1.\n</code></pre>\n"}, {"tags": ["go", "memory", "memory-leaks"], "comments": [{"owner": {"reputation": 102, "user_id": 3234726, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RRZNz.gif?s=128&g=1", "display_name": "Hengqi Chen", "link": "https://stackoverflow.com/users/3234726/hengqi-chen"}, "edited": false, "score": 2, "creation_date": 1570152192, "post_id": 58228621, "comment_id": 102832265, "body": "There is no such limit in pprof, you can use it whether you have network connections or not. See <a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/pprof</a>"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1570168044, "post_id": 58228621, "comment_id": 102835249, "body": "It may be useful if you mention some details about the game, especially its gui part."}], "answers": [{"tags": [], "owner": {"reputation": 1169, "user_id": 498109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100036fbeed75b1abf5bf0161d1fb560?s=128&d=identicon&r=PG", "display_name": "Vadyus", "link": "https://stackoverflow.com/users/498109/vadyus"}, "is_accepted": false, "score": 0, "last_activity_date": 1570171715, "creation_date": 1570171715, "answer_id": 58231240, "question_id": 58228621, "link": "https://stackoverflow.com/questions/58228621/right-way-of-finding-memory-leaks-in-game-written-in-go/58231240#58231240", "title": "Right way of finding memory leaks in game written in Go", "body": "<p>You can use <a href=\"https://golang.org/pkg/runtime/pprof/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/runtime/pprof/</a> package to write memory profiles on disk (you can do it let's say once in a minute). After that just run <code>go tool pprof</code> (inuse_space mode) on few of them and look if there are some parts where inuse_space is growing</p>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 3, "last_activity_date": 1570178104, "creation_date": 1570178104, "answer_id": 58232700, "question_id": 58228621, "link": "https://stackoverflow.com/questions/58228621/right-way-of-finding-memory-leaks-in-game-written-in-go/58232700#58232700", "title": "Right way of finding memory leaks in game written in Go", "body": "<p>You can certainly create profiles without an http server using the <a href=\"https://golang.org/pkg/runtime/pprof/\" rel=\"nofollow noreferrer\">runtime/pprof package</a>. There's also <a href=\"https://godoc.org/github.com/pkg/profile\" rel=\"nofollow noreferrer\">github.com/pkg/profile</a> by Dave Cheney, a wrapper for runtime/pprof with a simpler API. You can use signal handlers to enable and disable profiling, for instance.</p>\n\n<p>That being said, nothing stops you from starting an HTTP server, just for pprof. I find that much more convenient because then you can easily create any profile on demand. </p>\n\n<pre><code>// +build debug\n\npackage main\n\nimport (\n    \"log\"\n    \"net/http\"\n    _ \"net/http/pprof/\"\n)\n\nfunc init() {\n    log.Println(\"Launching pprof server\")\n    go func() { log.Fatal(http.ListenAndServe(\"localhost:3030\", nil)) }()\n}\n</code></pre>\n\n<p>This uses a build tag so you can enable the server in development but exclude it from production builds. Compile with <code>-tags debug</code> to enable the server. See <a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"nofollow noreferrer\">Build Constraints</a> for details.</p>\n"}, {"tags": [], "owner": {"reputation": 1720, "user_id": 6205738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a08adf9353636c19dc5a4e45df11d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Saty", "link": "https://stackoverflow.com/users/6205738/saty"}, "is_accepted": false, "score": 2, "last_activity_date": 1570188238, "creation_date": 1570188238, "answer_id": 58235482, "question_id": 58228621, "link": "https://stackoverflow.com/questions/58228621/right-way-of-finding-memory-leaks-in-game-written-in-go/58235482#58235482", "title": "Right way of finding memory leaks in game written in Go", "body": "<p>Apart from the pprof discussed before, it might also be useful to check <strong>heap</strong> <strong>allocation</strong> by doing an escape analysis of your code (e.g. if file is main.go) by: </p>\n\n<p><code>go build -gcflags=-m main.go</code></p>\n\n<p>This immediately gives you an idea of things like if you are passing <strong>pointers</strong> around <strong>unnecessarily</strong> which can be avoided. </p>\n\n<p><a href=\"https://tennexas.com/how-to-check-improve-performance-in-go/\" rel=\"nofollow noreferrer\">Here is a short article</a> which goes through various ways you can make your program more efficient.</p>\n"}], "owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 2, "accepted_answer_id": 58232700, "answer_count": 3, "score": 1, "last_activity_date": 1570188238, "creation_date": 1570150829, "question_id": 58228621, "link": "https://stackoverflow.com/questions/58228621/right-way-of-finding-memory-leaks-in-game-written-in-go", "title": "Right way of finding memory leaks in game written in Go", "body": "<p>I am writing a game in Go. I was told my code was leaking memory. What would be the right approach to pinpoint the cause of the leaks?</p>\n\n<p>I know <strong>pprof</strong> exists but as far as I know it can be used when your app uses the http package and my app is a simple game and it does not make use of any netowrk connectivity.</p>\n"}]